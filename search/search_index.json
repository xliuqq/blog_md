{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"index.html","title":"\u68a6\u60f3","text":""},{"location":"code_guide/lessons_learned.html","title":"Borg\u3001Omega\u3001K8s\uff1aGoogle \u5341\u5e74\u4e09\u4ee3\u5bb9\u5668\u7ba1\u7406\u7cfb\u7edf\u7684\u8bbe\u8ba1\u4e0e\u601d\u8003","text":"<p>\u539f\u6587\u526f\u6807\u9898\u4e3a Lessons learned from three container-management systems over a decade\u3002</p> <p>\u53c2\u8003\u94fe\u63a5\uff1ahttps://arthurchiao.art/blog/borg-omega-k8s-zh</p> <p>\u4ecb\u7ecd Google \u5728\u8bbe\u8ba1\u548c\u4f7f\u7528\u4e09\u4ee3\u5bb9\u5668\u7ba1\u7406\u7cfb\u7edf\u65f6\u5b66\u5230\u7684\u7ecf\u9a8c\u548c\u6559\u8bad\u3002</p>"},{"location":"code_guide/lessons_learned.html#1","title":"1. \u5341\u5e74\u4e09\u4ee3\u5bb9\u5668\u7ba1\u7406\u7cfb\u7edf","text":""},{"location":"code_guide/lessons_learned.html#borg","title":"Borg","text":"<p>Google \u7b2c\u4e00\u4ee3\u7edf\u4e00\u5bb9\u5668\u7ba1\u7406\u7cfb\u7edf\uff0cBorg \u5f53\u524d\u4ecd\u7136\u662f Google \u5185\u90e8\u4e3b\u8981\u7684\u5bb9\u5668\u7ba1\u7406\u7cfb\u7edf\uff08\u5de8\u5927\u7684\u89c4\u6a21\u3001\u51fa\u8272\u7684\u529f\u80fd\u548c\u6781\u5176\u7684\u5065\u58ee\u6027\uff09</p> <ul> <li>\u7ba1\u7406 long-running service \u4e5f\u53ef\u4ee5\u7ba1\u7406 batch job</li> <li>Linux \u5185\u6838\u4e2d\u65b0\u51fa\u73b0\u7684\u5bb9\u5668\u6280\u672f\uff08Google \u7ed9 Linux \u5bb9\u5668\u6280\u672f\u8d21\u732e\u4e86\u5927\u91cf\u4ee3\u7801\uff09\uff0c\u5b9e\u73b0\u5ef6\u8fdf\u654f\u611f\u578b\u5e94\u7528\u548c CPU \u5bc6\u96c6\u578b\u6279\u5904\u7406\u4efb\u52a1\u4e4b\u95f4\u7684\u66f4\u597d\u9694\u79bb\u3002</li> </ul>"},{"location":"code_guide/lessons_learned.html#omega","title":"Omega","text":"<p>\u4f7f Borg \u7684\u751f\u6001\u7cfb\u7edf\u66f4\u52a0\u7b26\u5408\u8f6f\u4ef6\u5de5\u7a0b\u89c4\u8303\uff0c\u5f00\u53d1\u4e86 Omega</p> <ul> <li>\u5c06\u96c6\u7fa4\u72b6\u6001\u5b58\u50a8\u5728\u4e00\u4e2a\u57fa\u4e8e Paxos \u7684\u4e2d\u5fc3\u5f0f\u9762\u5411\u4e8b\u52a1 store\uff08\u6570\u636e\u5b58\u50a8\uff09\u5185\uff1b</li> <li>\u63a7\u5236\u5e73\u9762\u7ec4\u4ef6\uff08\u4f8b\u5982\u8c03\u5ea6\u5668\uff09\u90fd\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u8fd9\u4e2a store\uff1b</li> <li>\u7528\u4e50\u89c2\u5e76\u53d1\u63a7\u5236\u6765\u5904\u7406\u5076\u53d1\u7684\u8bbf\u95ee\u51b2\u7a81\u3002</li> </ul> <p>Borgmaster \u7684\u529f\u80fd\u62c6\u5206\u4e3a\u4e86\u51e0\u4e2a\u5f7c\u6b64\u4ea4\u4e92\u7684\u7ec4\u4ef6\uff0c \u800c\u4e0d\u518d\u662f\u4e00\u4e2a\u5355\u4f53\u7684\u3001\u4e2d\u5fc3\u5f0f\u7684 master\uff0c\u4fee\u6539\u548c\u8fed\u4ee3\u66f4\u52a0\u65b9\u4fbf\u3002</p>"},{"location":"code_guide/lessons_learned.html#kubernetes","title":"Kubernetes","text":"<p>\u5f00\u53d1\u8fd9\u5957\u7cfb\u7edf\u7684\u80cc\u666f\uff1a</p> <ul> <li>\u5168\u7403\u8d8a\u6765\u8d8a\u591a\u7684\u5f00\u53d1\u8005\u4e5f\u5f00\u59cb\u5bf9 Linux \u5bb9\u5668\u611f\u5174\u8da3\uff0c</li> <li>Google \u5df2\u7ecf\u628a\u516c\u6709\u4e91\u57fa\u7840\u8bbe\u65bd\u4f5c\u4e3a\u4e00\u95e8\u4e1a\u52a1\u5728\u5356\uff0c\u4e14\u5728\u6301\u7eed\u589e\u957f\uff1b</li> </ul> <p>Kubernetes \u662f\u5f00\u6e90\u7684\uff0c\u4e0d\u662f Google \u5185\u90e8\u7cfb\u7edf\u3002\u76f8\u6bd4 Omega \u7684\u6539\u8fdb</p> <ul> <li>\u4e0e Omega \u7c7b\u4f3c\uff0ck8s \u7684\u6838\u5fc3\u4e5f\u662f\u4e00\u4e2a\u5171\u4eab\u6301\u4e45\u6570\u636e\u4ed3\u5e93\uff08store\uff09\uff0c \u51e0\u4e2a\u7ec4\u4ef6\u4f1a\u76d1\u542c\u8fd9\u4e2a store \u91cc\u7684 object \u53d8\u5316\uff1b</li> <li>Omega \u5c06\u81ea\u5df1\u7684 store \u76f4\u63a5\u66b4\u9732\u7ed9\u4e86\u53d7\u4fe1\u4efb\u7684\u63a7\u5236\u5e73\u9762\u7ec4\u4ef6\uff0c\u4f46 k8s \u4e2d\u7684\u72b6\u6001 \u53ea\u80fd\u901a\u8fc7\u4e00\u4e2a domain-specific REST API \u8bbf\u95ee\uff0c\u8fd9\u4e2a API \u4f1a\u6267\u884c <code>higher-level versioning, validation, semantics, policy</code> \u7b49\u64cd\u4f5c\uff0c\u652f\u6301\u591a\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u5ba2\u6237\u7aef\uff1b</li> <li>\u66f4\u91cd\u8981\u7684\u662f\uff0ck8s \u5728\u8bbe\u8ba1\u65f6\u5c31\u975e\u5e38\u6ce8\u91cd\u5e94\u7528\u5f00\u53d1\u8005\u7684\u4f53\u9a8c\uff1a \u9996\u8981\u8bbe\u8ba1\u76ee\u6807\u5c31\u662f\u5728\u4eab\u53d7\u5bb9\u5668\u5e26\u6765\u7684\u8d44\u6e90\u5229\u7528\u7387\u63d0\u5347\u7684\u540c\u65f6\uff0c\u8ba9\u90e8\u7f72\u548c\u7ba1\u7406\u590d\u6742\u5206\u5e03\u5f0f\u7cfb\u7edf\u66f4\u7b80\u5355</li> </ul>"},{"location":"code_guide/lessons_learned.html#2-linux","title":"2. \u5e95\u5c42 Linux \u5185\u6838\u5bb9\u5668\u6280\u672f","text":""},{"location":"code_guide/lessons_learned.html#21-chroot-cgroups","title":"2.1 \u4ece <code>chroot</code> \u5230 cgroups","text":"<ul> <li>\u6700\u521d\u7684\u5bb9\u5668\u53ea\u662f\u63d0\u4f9b\u4e86 root file system \u7684\u9694\u79bb\u80fd\u529b \uff08\u901a\u8fc7 <code>chroot</code>\uff09</li> <li>FreeBSD jails \u5c06\u8fd9\u4e2a\u7406\u5ff5\u6269\u5c55\u5230\u4e86\u5bf9\u5176\u4ed6 namespaces\uff08\u4f8b\u5982 PID\uff09\u7684\u9694\u79bb</li> <li>Linux control groups (<code>cgroups</code>) \u5438\u6536\u4e86\u8fd9\u4e9b\u7406\u5ff5\uff0c\u6210\u4e3a\u96c6\u5927\u6210\u8005</li> </ul>"},{"location":"code_guide/lessons_learned.html#22","title":"2.2 \u8d44\u6e90\u9694\u79bb","text":"<p>Borg \u80fd\u5229\u7528\u5bb9\u5668\u5b9e\u73b0\u5ef6\u8fdf\u654f\u611f\u578b\u5e94\u7528\u548cCPU \u5bc6\u96c6\u578b\u6279\u5904\u7406\u4efb\u52a1\u7684\u6df7\u5e03\uff08co-locate\uff09\uff0c \u4ece\u800c\u63d0\u5347\u8d44\u6e90\u5229\u7528\u7387\u3002</p> <ul> <li>request \u548c limits \u673a\u5236\uff1f</li> </ul> <p>\u8fd9\u79cd\u9694\u79bb\u5e76\u672a\u8fbe\u5230\u5b8c\u7f8e\u7684\u7a0b\u5ea6\uff1a\u5bb9\u5668\u65e0\u6cd5\u907f\u514d\u90a3\u4e9b\u4e0d\u53d7\u5185\u6838\u7ba1\u7406\u7684\u8d44\u6e90\u7684\u5e72\u6270\uff0c\u4f8b\u5982\u4e09\u7ea7\u7f13\u5b58\uff08L3 cache\uff09\u3001 \u5185\u5b58\u5e26\u5bbd\uff1b\u6b64\u5916\uff0c\u8fd8\u9700\u8981\u5bf9\u5bb9\u5668\u52a0\u4e00\u4e2a\u5b89\u5168\u5c42\uff08\u4f8b\u5982\u865a\u62df\u673a\uff09\u624d\u80fd\u907f\u514d\u516c\u6709\u4e91\u4e0a\u5404\u79cd\u5404\u6837\u7684\u6076\u610f\u653b\u51fb\u3002</p>"},{"location":"code_guide/lessons_learned.html#23","title":"2.3 \u5bb9\u5668\u955c\u50cf","text":"<p>\u73b0\u4ee3\u5bb9\u5668\u5df2\u7ecf\u4e0d\u4ec5\u4ec5\u662f\u4e00\u79cd\u9694\u79bb\u673a\u5236\u4e86\uff1a\u8fd8\u5305\u62ec\u955c\u50cf \u2014\u2014 \u5c06\u5e94\u7528\u8fd0\u884c\u6240\u9700\u7684\u6240\u6709\u6587\u4ef6\u6253\u5305\u6210\u4e00\u4e2a\u955c\u50cf\u3002</p> <p>\u5728 Google\uff0c\u7528 MPM (Midas Package Manager) \u6765\u6784\u5efa\u548c\u90e8\u7f72\u5bb9\u5668\u955c\u50cf\u3002 \u9694\u79bb\u673a\u5236\u548c MPM packages \u7684\u5173\u7cfb\uff0c\u5c31\u50cf\u662f Docker daemon \u548c Docker image registry \u7684\u5173\u7cfb\u3002</p>"},{"location":"code_guide/lessons_learned.html#3","title":"3. \u9762\u5411\u5e94\u7528\u7684\u57fa\u7840\u8bbe\u65bd","text":"<p>\u4ece\u539f\u6765\u7684\u9762\u5411\u673a\u5668\uff08machine oriented\uff09 \u8f6c\u5411\u4e86\u9762\u5411\u5e94\u7528\uff08application oriented\uff09</p>"},{"location":"code_guide/lessons_learned.html#31","title":"3.1 \u4ece\u201c\u9762\u5411\u673a\u5668\u201d\u5230\u201c\u9762\u5411\u5e94\u7528\u201d\u7684\u8f6c\u53d8","text":"<p>\u5bb9\u5668\u5316\u4f7f\u6570\u636e\u4e2d\u5fc3\u7684\u89c2\u5ff5\u4ece\u539f\u6765\u7684\u9762\u5411\u673a\u5668\uff08machine oriented\uff09 \u8f6c\u5411\u4e86\u9762\u5411\u5e94\u7528\uff08application oriented\uff09\uff0c</p> <ul> <li>\u5bb9\u5668\u5c01\u88c5\u4e86\u5e94\u7528\u73af\u5883\uff08application environment\uff09\uff0c \u5411\u5e94\u7528\u5f00\u53d1\u8005\u548c\u90e8\u7f72\u57fa\u7840\u8bbe\u65bd\u5c4f\u853d\u4e86\u5927\u91cf\u7684\u64cd\u4f5c\u7cfb\u7edf\u548c\u673a\u5668\u7ec6\u8282\uff0c</li> <li>\u6bcf\u4e2a\u8bbe\u8ba1\u826f\u597d\u7684\u5bb9\u5668\u548c\u5bb9\u5668\u955c\u50cf\u90fd\u5bf9\u5e94\u7684\u662f\u5355\u4e2a\u5e94\u7528\uff0c\u56e0\u6b64 \u7ba1\u7406\u5bb9\u5668\u5176\u5b9e\u5c31\u662f\u5728\u7ba1\u7406\u5e94\u7528\uff0c\u800c\u4e0d\u518d\u662f\u7ba1\u7406\u673a\u5668\u3002</li> </ul> <p>Management API \u7684\u8fd9\u79cd\u4ece\u9762\u5411\u673a\u5668\u5230\u9762\u5411\u5e94\u7528\u7684\u8f6c\u53d8\uff0c\u663e\u8457\u63d0\u5347\u4e86\u5e94\u7528\u7684\u90e8\u7f72\u6548\u7387\u548c\u95ee\u9898\u6392\u67e5\u80fd\u529b\u3002</p>"},{"location":"code_guide/lessons_learned.html#32","title":"3.2 \u5e94\u7528\u73af\u5883","text":""},{"location":"code_guide/lessons_learned.html#_1","title":"\u8d44\u6e90\u9694\u79bb + \u5bb9\u5668\u955c\u50cf\uff1a\u89e3\u8026\u5e94\u7528\u548c\u8fd0\u884c\u73af\u5883","text":"<p>\u8d44\u6e90\u9694\u79bb\u80fd\u529b\u4e0e\u5bb9\u5668\u955c\u50cf\u76f8\u7ed3\u5408\uff0c\u521b\u9020\u4e86\u4e00\u4e2a\u5168\u65b0\u7684\u62bd\u8c61\uff1a</p> <ul> <li>\u5185\u6838 cgroup\u3001chroot\u3001namespace \u7b49\u57fa\u7840\u8bbe\u65bd\u7684\u6700\u521d\u76ee\u7684\u662f\u4fdd\u62a4\u5e94\u7528\u514d\u53d7 noisy\u3001nosey\u3001messy neighbors \u7684\u5e72\u6270\u3002</li> <li>\u800c\u8fd9\u4e9b\u6280\u672f\u4e0e\u5bb9\u5668\u955c\u50cf\u76f8\u7ed3\u5408\uff0c\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684\u62bd\u8c61\uff0c \u5c06\u5e94\u7528\u4e0e\u5b83\u6240\u8fd0\u884c\u7684\uff08\u5f02\u6784\uff09\u64cd\u4f5c\u7cfb\u7edf\u9694\u79bb\u5f00\u6765\u3002</li> </ul> <p>\u62bd\u8c61\u80fd\u6210\u529f\u7684\u5173\u952e\u662f\u4e00\u4e2ahermetic\uff08\u5c01\u95ed\u7684\uff0c\u4e0d\u53d7\u5916\u754c\u5f71\u54cd\u7684\uff09\u5bb9\u5668\u955c\u50cf\uff1a</p> <ul> <li>\u8fd9\u4e2a\u955c\u50cf\u80fd\u5c01\u88c5\u4e00\u4e2a\u5e94\u7528\u7684\u51e0\u4e4e\u6240\u6709\u4f9d\u8d56\uff08\u6587\u4ef6\u3001\u51fd\u6570\u5e93\u7b49\u7b49\uff09\uff1b</li> <li>\u90a3\u552f\u4e00\u5269\u4e0b\u7684\u5916\u90e8\u4f9d\u8d56\u5c31\u662f Linux \u7cfb\u7edf\u8c03\u7528\u63a5\u53e3\uff1a\u6709\u9650\u7684\u63a5\u53e3\u6781\u5927\u63d0\u5347\u4e86\u955c\u50cf\u7684\u53ef\u79fb\u690d\u6027\uff0c\u4f46\u5e76\u975e\u5b8c\u7f8e</li> <li>\u5e94\u7528\u4ecd\u7136\u53ef\u80fd\u901a\u8fc7 socket option\u3001<code>/proc</code>\u3001<code>ioctl</code> \u53c2\u6570\u7b49\u7b49\u4ea7\u751f\u5f88\u5927\u7684\u66b4\u9732\u9762\uff0c\u5e0c\u671b Open Container Initiative \u7b49\u5de5\u4f5c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u660e\u786e\u5bb9\u5668\u62bd\u8c61\u7684 surface area\u3002</li> </ul>"},{"location":"code_guide/lessons_learned.html#_2","title":"\u5bb9\u5668\u955c\u50cf\u5b9e\u73b0\u65b9\u5f0f","text":"<p>Borg container image \u5e76\u6ca1\u6709\u505a\u5230\u5b8c\u5168\u72ec\u7acb\uff1a\u6240\u6709\u5e94\u7528\u5171\u4eab\u4e00\u4e2a\u6240\u8c13\u7684 base image\uff0c\u57fa\u7840\u955c\u50cf\u662f\u5b89\u88c5\u5728\u6bcf\u4e2a node \u4e0a\u7684\uff0c\u800c\u975e\u6253\u5230\u6bcf\u4e2a\u955c\u50cf\u91cc\u3002</p> <p>Docker \u548c ACI \u73b0\u4ee3\u5bb9\u5668\u955c\u50cf\u6d88\u9664\u4e86\u9690\u85cf\u7684 host OS \u4f9d\u8d56\uff0c \u660e\u786e\u8981\u6c42\u7528\u6237\u5728\u5bb9\u5668\u95f4\u5171\u4eab\u955c\u50cf\u65f6\uff0c\u5fc5\u987b\u663e\u5f0f\u6307\u5b9a\u8fd9\u79cd\u4f9d\u8d56\u5173\u7cfb\u3002</p>"},{"location":"code_guide/lessons_learned.html#33","title":"3.3 \u5bb9\u5668\u4f5c\u4e3a\u57fa\u672c\u7ba1\u7406\u5355\u5143","text":"<p>\u56f4\u7ed5\u5bb9\u5668\u800c\u975e\u673a\u5668\u6784\u5efa management API\uff0c\u5c06\u6570\u636e\u4e2d\u5fc3\u7684\u6838\u5fc3\u4ece\u673a\u5668\u8f6c\u79fb\u5230\u4e86\u5e94\u7528</p> <ol> <li>\u5e94\u7528\u5f00\u53d1\u8005\u548c\u5e94\u7528\u8fd0\u7ef4\u56e2\u961f\u65e0\u9700\u518d\u5173\u5fc3\u673a\u5668\u548c\u64cd\u4f5c\u7cfb\u7edf\u7b49\u5e95\u5c42\u7ec6\u8282\uff1b</li> <li>\u57fa\u7840\u8bbe\u65bd\u56e2\u961f\u5f15\u5165\u65b0\u786c\u4ef6\u548c\u5347\u7ea7\u64cd\u4f5c\u7cfb\u7edf\u66f4\u52a0\u7075\u6d3b\uff0c \u53ef\u4ee5\u6700\u5927\u9650\u5ea6\u51cf\u5c11\u5bf9\u7ebf\u4e0a\u5e94\u7528\u548c\u5e94\u7528\u5f00\u53d1\u8005\u7684\u5f71\u54cd\uff1b</li> <li>\u5c06\u6536\u96c6\u5230\u7684 telemetry \u6570\u636e\uff08\u4f8b\u5982 CPU\u3001memory usage \u7b49 metrics\uff09\u5173\u8054\u5230\u5e94\u7528\u800c\u975e\u673a\u5668\uff0c \u663e\u8457\u63d0\u5347\u4e86\u5e94\u7528\u76d1\u63a7\u548c\u53ef\u89c2\u6d4b\u6027\uff0c\u5c24\u5176\u662f\u5728\u5782\u76f4\u6269\u5bb9\u3001 \u673a\u5668\u6545\u969c\u6216\u4e3b\u52a8\u8fd0\u7ef4\u7b49\u9700\u8981\u8fc1\u79fb\u5e94\u7528\u7684\u573a\u666f\u3002</li> </ol>"},{"location":"code_guide/lessons_learned.html#api","title":"\u901a\u7528 API \u548c\u81ea\u6108\u80fd\u529b","text":"<p>\u5bb9\u5668\u80fd\u63d0\u4f9b\u4e00\u4e9b\u901a\u7528\u7684 API \u6ce8\u518c\u673a\u5236\uff0c\u4f7f\u7ba1\u7406\u7cfb\u7edf\u548c\u5e94\u7528\u4e4b\u95f4\u65e0\u9700\u77e5\u9053\u5f7c\u6b64\u7684\u5b9e\u73b0\u7ec6\u8282\u5c31\u80fd\u4ea4\u6362\u6709\u7528\u4fe1\u606f</p> <ul> <li><code>health check</code>\uff1aHTTP endpoint \u6216 shell \u547d\u4ee4\uff08\u5230\u5bb9\u5668\u5185\u6267\u884c\uff09</li> </ul>"},{"location":"code_guide/lessons_learned.html#annotation","title":"\u7528 annotation \u63cf\u8ff0\u5e94\u7528\u7ed3\u6784\u4fe1\u606f","text":"<p>\u5bb9\u5668\u8fd8\u80fd\u63d0\u4f9b\u6216\u5c55\u793a\u5176\u4ed6\u4e00\u4e9b\u4fe1\u606f\u3002\u4f8b\u5982\uff0c</p> <ul> <li>Borg \u5e94\u7528\u53ef\u4ee5\u63d0\u4f9b\u4e00\u4e2a\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u72b6\u6001\u6d88\u606f\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u53ef\u4ee5\u52a8\u6001\u66f4\u65b0\uff1b</li> <li>K8s \u63d0\u4f9b\u4e86 key-value <code>annotation</code>\uff0c \u5b58\u50a8\u5728\u6bcf\u4e2a object metadata \u4e2d\uff0c\u53ef\u4ee5\u7528\u6765\u4f20\u9012\u5e94\u7528\u7ed3\u6784\uff08application structure\uff09\u4fe1\u606f\u3002 </li> </ul>"},{"location":"code_guide/lessons_learned.html#metrics","title":"\u5e94\u7528\u7ef4\u5ea6 metrics \u805a\u5408","text":"<p>\u5bb9\u5668\u8fd8\u80fd\u7528\u5176\u4ed6\u65b9\u5f0f\u63d0\u4f9b\u9762\u5411\u5e94\u7528\u7684\u76d1\u63a7\uff1a\u4f8b\u5982\uff0c cgroups \u63d0\u4f9b\u4e86\u5e94\u7528\u7684 resource-utilization \u6570\u636e\u3002</p> <p>\u57fa\u4e8e\u8fd9\u4e9b\u76d1\u63a7\u6570\u636e\u5c31\u80fd\u5f00\u53d1\u4e00\u4e9b\u901a\u7528\u5de5\u5177\uff0c\u4f8b\u5982 auto-scaler \u548c cAdvisor</p> <ul> <li>\u5e94\u7528\u6536\u655b\u5230\u4e86\u5bb9\u5668\u5185\uff0c\u56e0\u6b64\u5c31\u65e0\u9700\u5728\u5bbf\u4e3b\u673a\u4e0a\u5206\u53d1\u4fe1\u53f7\u5230\u4e0d\u540c\u5e94\u7528</li> <li>\u66f4\u7b80\u5355\u3001\u66f4\u5065\u58ee\uff0c \u4e5f\u66f4\u5bb9\u6613\u5b9e\u73b0\u7ec6\u7c92\u5ea6\u7684 metrics/logs \u63a7\u5236</li> </ul> <p>\u9762\u5411\u5e94\u7528\u7684\u8f6c\u53d8\u5728\u7ba1\u7406\u57fa\u7840\u8bbe\u65bd\uff08management infrastructure\uff09\u4e2d\u4ea7\u751f\u6d9f\u6f2a\u6548\u5e94</p> <ul> <li>load balancer \u4e0d\u518d\u9488\u5bf9 machine \u8f6c\u53d1\u6d41\u91cf\uff0c\u800c\u662f\u9488\u5bf9 application instance \u8f6c\u53d1\u6d41\u91cf\uff1b</li> <li>Log \u81ea\u5e26\u5e94\u7528\u4fe1\u606f\uff0c\u56e0\u6b64\u5f88\u5bb9\u6613\u6536\u96c6\u548c\u6309\u5e94\u7528\u7ef4\u5ea6\uff08\u800c\u4e0d\u662f\u673a\u5668\u7ef4\u5ea6\uff09\u805a\u5408\uff0c \u4ece\u800c\u66f4\u5bb9\u6613\u770b\u51fa\u5e94\u7528\u5c42\u9762\u7684\u6545\u969c\uff1b</li> <li>\u5b9e\u4f8b\u5728\u7f16\u6392\u7cfb\u7edf\u4e2d\u7684 identity \u548c\u7528\u6237\u671f\u671b\u7684\u5e94\u7528\u7ef4\u5ea6 identity \u80fd\u591f\u5bf9\u5e94\u8d77\u6765\uff0c \u56e0\u6b64\u66f4\u5bb9\u6613\u6784\u5efa\u3001\u7ba1\u7406\u548c\u8c03\u8bd5\u5e94\u7528\u3002</li> </ul>"},{"location":"code_guide/lessons_learned.html#pod-vs-container","title":"\u5355\u5b9e\u4f8b\u591a\u5bb9\u5668\uff08pod vs. container\uff09","text":"<p>\u4f7f\u7528\u5d4c\u5957\u5bb9\u5668\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5e94\u7528\uff1a</p> <ul> <li>\u5916\u5c42\u5bb9\u5668\u63d0\u4f9b\u4e00\u4e2a\u8d44\u6e90\u6c60\uff1b\u5728 Borg \u4e2d\u6210\u4e3a <code>alloc</code>\uff0c\u5728 K8s \u4e2d\u6210\u4e3a <code>pod</code>\uff1b</li> <li>\u5185\u5c42\u5bb9\u5668\u4eec\u90e8\u7f72\u548c\u9694\u79bb\u5177\u4f53\u670d\u52a1\u3002</li> </ul> <p>K8s \u5c31\u7edf\u4e00\u89c4\u5b9a\u5e94\u7528\u5bb9\u5668\u5fc5\u987b\u8fd0\u884c\u5728 pod \u5185\uff0c\u5373\u4f7f\u4e00\u4e2a pod \u5185\u53ea\u6709\u4e00\u4e2a\u5bb9\u5668\u3002 \u5e38\u89c1\u65b9\u5f0f\u662f\u4e00\u4e2a pod hold \u4e00\u4e2a\u590d\u6742\u5e94\u7528\u7684\u5b9e\u4f8b\u3002</p> <ul> <li>\u5e94\u7528\u7684\u4e3b\u4f53\u4f5c\u4e3a\u4e00\u4e2a pod \u5185\u7684\u5bb9\u5668\u3002</li> <li>\u5176\u4ed6\u8f85\u52a9\u529f\u80fd\uff08\u4f8b\u5982 log rotate\u3001click-log offloading\uff09\u4f5c\u4e3a\u72ec\u7acb\u5bb9\u5668\u3002</li> </ul> <p>\u76f8\u6bd4\u4e8e\u628a\u6240\u6709\u529f\u80fd\u6253\u5230\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u8fd9\u79cd\u65b9\u5f0f\u80fd\u8ba9\u4e0d\u540c\u56e2\u961f\u5f00\u53d1\u548c\u7ba1\u7406\u4e0d\u540c\u529f\u80fd\uff0c\u597d\u5904\uff1a</p> <ul> <li>\u5065\u58ee\uff1a\u4f8b\u5982\uff0c\u5e94\u7528\u5373\u4f7f\u51fa\u4e86\u95ee\u9898\uff0clog offloading \u529f\u80fd\u8fd8\u80fd\u7ee7\u7eed\u5de5\u4f5c\uff1b</li> <li>\u53ef\u7ec4\u5408\u6027\uff1a\u6dfb\u52a0\u65b0\u7684\u8f85\u52a9\u670d\u52a1\u5f88\u5bb9\u6613\uff0c\u56e0\u4e3a\u64cd\u4f5c\u90fd\u662f\u5728\u5b83\u81ea\u5df1\u7684 container \u5185\u5b8c\u6210\u7684\uff1b</li> <li>\u7ec6\u7c92\u5ea6\u8d44\u6e90\u9694\u79bb\uff1a\u6bcf\u4e2a\u5bb9\u5668\u90fd\u6709\u81ea\u5df1\u7684\u8d44\u6e90\u9650\u989d\uff0c\u6bd4\u5982 logging \u670d\u52a1\u4e0d\u4f1a\u5360\u7528\u4e3b\u5e94\u7528\u7684\u8d44\u6e90\u3002</li> </ul>"},{"location":"code_guide/lessons_learned.html#34","title":"3.4 \u7f16\u6392\u662f\u5f00\u59cb\uff0c\u4e0d\u662f\u7ed3\u675f","text":"<p>Borg \u672c\u8eab\u53ea\u662f\u5f00\u53d1\u548c\u7ba1\u7406\u53ef\u9760\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u5f00\u59cb\uff0c \u5404\u56e2\u961f\u6839\u636e\u81ea\u8eab\u9700\u6c42\u5f00\u53d1\u51fa\u7684\u56f4\u7ed5 Borg \u7684\u4e0d\u540c\u7cfb\u7edf\u4e0e Borg \u672c\u8eab\u4e00\u6837\u91cd\u8981</p> <ul> <li>\u670d\u52a1\u547d\u540d\uff08naming\uff09\u548c\u670d\u52a1\u53d1\u73b0\uff08Borg Name Service, BNS\uff09\uff1b\u81ea\u52a8\u6269\u7f29\u5bb9\uff1bWorkflow\u5de5\u5177\uff1b\u76d1\u63a7\u5de5\u5177</li> </ul> <p>K8s \u5c1d\u8bd5\u901a\u8fc7\u5f15\u5165\u4e00\u81f4 API \u7684\u65b9\u5f0f\u6765\u964d\u4f4e\u8fd9\u91cc\u7684\u590d\u6742\u5ea6\u3002\u4f8b\u5982\uff0c\u6bcf\u4e2a K8s \u5bf9\u8c61\u90fd\u6709\u4e09\u4e2a\u57fa\u672c\u5b57\u6bb5\uff1a<code>Object Metadata</code>\uff0c<code>Spec</code>\uff0c<code>Status</code></p> <p>K8s \u8fd8\u8fdb\u884c\u4e86\u6269\u5c55\uff0c\u652f\u6301\u7528\u6237\u52a8\u6001\u6ce8\u518c\u4ed6\u4eec\u81ea\u5df1\u7684 API\uff0c \u8fd9\u4e9b API \u548c\u5b83\u5185\u7f6e\u7684\u6838\u5fc3 API \u4f7f\u7528\u76f8\u540c\u7684\u65b9\u5f0f\u5de5\u4f5c\u3002API \u7ec4\u4ef6\u7684\u89e3\u8026\u8003\u8651\u610f\u5473\u7740\u4e0a\u5c42\u670d\u52a1\u53ef\u4ee5\u5171\u4eab\u76f8\u540c\u7684\u57fa\u7840\u6784\u5efa\u6a21\u5757\uff1a\u5982replica controller \u548c horizontal auto-scaling (HPA) \u7684\u89e3\u8026\u3002</p> <ul> <li>Replication controller \u786e\u4fdd\u7ed9\u5b9a\u89d2\u8272\uff08\u4f8b\u5982\uff0c\u201dfront end\u201d\uff09\u7684 pod \u526f\u672c\u6570\u91cf\u7b26\u5408\u9884\u671f\uff1b</li> <li>Autoscaler \u8fd9\u5229\u7528\u8fd9\u79cd\u80fd\u529b\uff0c\u7b80\u5355\u5730\u8c03\u6574\u671f\u671b\u7684 pod \u6570\u91cf\uff0c\u800c\u65e0\u9700\u5173\u5fc3\u8fd9\u4e9b pod \u662f\u5982\u4f55\u521b\u5efa\u6216\u5220\u9664\u7684\u3002</li> </ul> <p>\u901a\u8fc7\u8ba9\u4e0d\u540c k8s \u7ec4\u4ef6\u4f7f\u7528\u540c\u4e00\u5957\u8bbe\u8ba1\u6a21\u5f0f\u6765\u5b9e\u73b0\u4e00\u81f4\u6027\uff1a<code>reconciliation controller loop</code></p> <ul> <li><code>reconcile</code>\uff08\u8c03\u8c10\uff09\uff1a\u9996\u5148\u5bf9\u89c2\u6d4b\u5230\u7684\u5f53\u524d\u72b6\u6001\uff08\u201c\u5f53\u524d\u80fd\u627e\u5230\u7684\u8fd9\u79cd pod \u7684\u6570\u91cf\u201d\uff09\u548c\u671f\u671b\u72b6\u6001\uff08\u201clabel-selector \u5e94\u8be5\u9009\u4e2d\u7684 pod \u6570\u91cf\u201d\uff09\u8fdb\u884c\u6bd4\u8f83\uff1b\u5982\u679c\u5f53\u524d\u72b6\u6001\u548c\u671f\u671b\u72b6\u6001\u4e0d\u4e00\u81f4\uff0c\u5219\u6267\u884c\u76f8\u5e94\u7684\u884c\u52a8 \uff08\u4f8b\u5982\u6269\u5bb9 2 \u4e2a\u65b0\u5b9e\u4f8b\uff09\u6765\u4f7f\u5f53\u524d\u72b6\u6001\u4e0e\u671f\u671b\u76f8\u7b26\uff1b</li> <li>\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u57fa\u4e8e\u89c2\u5bdf\uff08observation\uff09\u800c\u975e\u72b6\u6001\u673a\uff0c \u56e0\u6b64 reconcile \u673a\u5236\u975e\u5e38\u5065\u58ee\uff1acontroller \u91cd\u542f\u4e4b\u540e\u4ecd\u80fd\u63a5\u7740\u4e4b\u524d\u72b6\u6001\u7ee7\u7eed\u5de5\u4f5c\uff1b</li> </ul> <p>choreography\uff08\u821e\u8e48\u7f16\u6392\uff09\u7684\u4e00\u4e2a\u4f8b\u5b50 \u2014\u2014 \u901a\u8fc7\u591a\u4e2a\u72ec\u7acb\u548c\u81ea\u6cbb\u7684\u5b9e\u4f53\u4e4b\u95f4\u7684\u534f\u4f5c\uff08collaborate\uff09\u5b9e\u73b0\u6700\u7ec8\u5e0c\u671b\u8fbe\u5230\u7684\u72b6\u6001\u3002</p> <p>\u821e\u8e48\u7f16\u6392\uff1a\u573a\u4e0a\u6ca1\u6709\u6307\u6325\u8001\u5e08\uff0c\u6bcf\u4e2a\u8df3\u821e\u7684\u4eba\u90fd\u662f\u72ec\u7acb\u4e2a\u4f53\uff0c\u5927\u5bb6\u5171\u540c\u534f\u4f5c\u5b8c\u6210\u4e00\u6b21\u8868\u6f14\u3002 \u4ee3\u8868\u5206\u5e03\u5f0f\u3001\u975e\u547d\u4ee4\u5f0f\u3002</p> <p>\u7ba1\u5f26\u4e50\u7f16\u6392\u4e2d\u5fc3\u5f0f\u7f16\u6392\u7cfb\u7edf\uff08centralized orchestration system\uff09\uff0c\u540e\u8005\u5728\u521d\u671f\u5f88\u5bb9\u6613\u8bbe\u8ba1\u548c\u5f00\u53d1\uff0c \u4f46\u968f\u7740\u65f6\u95f4\u63a8\u79fb\u4f1a\u53d8\u5f97\u8106\u5f31\u548c\u6b7b\u677f\uff0c\u5c24\u5176\u5728\u6709\u72b6\u6001\u53d8\u5316\u6216\u53d1\u751f\u9884\u671f\u5916\u7684\u9519\u8bef\u65f6</p> <p>\u7ba1\u5f26\u4e50\u7f16\u6392\uff1a\u573a\u4e0a\u6709\u4e00\u4e2a\u6307\u6325\u5bb6\uff0c\u6bcf\u4e2a\u6f14\u594f\u4e50\u5668\u7684\u4eba\u90fd\u662f\u6839\u636e\u6307\u6325\u5bb6\u7684\u547d\u4ee4\u5b8c\u6210\u6f14\u594f\u3002 \u4ee3\u8868\u96c6\u4e2d\u5f0f\u3001\u547d\u4ee4\u5f0f\u3002</p>"},{"location":"code_guide/lessons_learned.html#4","title":"4. \u907f\u5751\u6307\u5357","text":""},{"location":"code_guide/lessons_learned.html#41-pod-ipport","title":"4.1 \u521b\u5efa Pod \u65f6\u5e94\u8be5\u5206\u914d\u552f\u4e00 IP\uff0c\u800c\u4e0d\u662f\u552f\u4e00\u7aef\u53e3\uff08port\uff09","text":"<p>\u5728 Borg \u4e2d\uff0c\u5bb9\u5668\u6ca1\u6709\u72ec\u7acb IP\uff0c\u6240\u6709\u5bb9\u5668\u5171\u4eab node \u7684 IP\u3002 Borg \u53ea\u80fd\u5728\u8c03\u5ea6\u65f6\uff0c\u7ed9\u6bcf\u4e2a\u5bb9\u5668\u5206\u914d\u552f\u4e00\u7684 port\u3002 \u5f53\u4e00\u4e2a\u5bb9\u5668\u6f02\u79fb\u5230\u53e6\u4e00\u53f0 node \u65f6\uff0c\u4f1a\u83b7\u5f97\u4e00\u4e2a\u65b0\u7684 port\uff08\u5bb9\u5668\u539f\u5730\u91cd\u542f\u4e5f\u53ef\u80fd\u4f1a\u5206\u5230\u65b0 port\uff09</p> <ul> <li>\u7c7b\u4f3c DNS\uff08\u8fd0\u884c\u5728 <code>53</code> \u7aef\u53e3\uff09\u8fd9\u6837\u7684\u4f20\u7edf\u670d\u52a1\uff0c\u53ea\u80fd\u7528\u4e00\u4e9b\u5185\u90e8\u9b54\u6539\u7684\u7248\u672c\uff1b</li> <li>\u5ba2\u6237\u7aef\u65e0\u6cd5\u63d0\u524d\u77e5\u9053\u4e00\u4e2a service \u7684\u7aef\u53e3\uff0c\u53ea\u6709\u5728 service \u521b\u5efa\u597d\u4e4b\u540e\u518d\u544a\u8bc9\u5b83\u4eec\uff1b</li> <li>URL \u4e2d\u4e0d\u80fd\u5305\u542b port\uff08\u5bb9\u5668\u91cd\u542f port \u53ef\u80fd\u5c31\u53d8\u4e86\uff0c\u5bfc\u81f4 URL \u65e0\u6548\uff09\uff0c\u5fc5\u987b\u5f15\u5165\u4e00\u4e9b name-based redirection \u673a\u5236\uff1b</li> <li>\u4f9d\u8d56 IP \u5730\u5740\u7684\u5de5\u5177\u90fd\u5fc5\u987b\u505a\u4e00\u4e9b\u4fee\u6539\uff0c\u4ee5\u4fbf\u80fd\u5904\u7406 <code>IP:port</code>\u3002</li> </ul> <p>\u8bbe\u8ba1 k8s \u65f6\uff0c\u6211\u4eec\u51b3\u5b9a\u7ed9\u6bcf\u4e2a pod \u5206\u914d\u4e00\u4e2a IP\uff0c</p> <ul> <li>\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u7f51\u7edc\u8eab\u4efd\uff08IP\uff09\u4e0e\u5e94\u7528\u8eab\u4efd\uff08\u5b9e\u4f8b\uff09\u7684\u4e00\u4e00\u5bf9\u5e94\uff1b</li> <li>\u907f\u514d\u4e86\u524d\u9762\u63d0\u5230\u7684\u9b54\u6539 DNS \u7b49\u670d\u52a1\u7684\u95ee\u9898\uff0c\u5e94\u7528\u53ef\u4ee5\u968f\u610f\u4f7f\u7528 well-known ports\uff08\u4f8b\u5982\uff0cHTTP 80\uff09\uff1b</li> <li>\u73b0\u6709\u7684\u7f51\u7edc\u5de5\u5177\uff08\u4f8b\u5982\u7f51\u7edc\u9694\u79bb\u3001\u5e26\u5bbd\u63a7\u5236\uff09\u4e5f\u65e0\u9700\u505a\u4fee\u6539\uff0c\u76f4\u63a5\u53ef\u4ee5\u7528\uff1b</li> </ul>"},{"location":"code_guide/lessons_learned.html#42-index-labels","title":"4.2\u5bb9\u5668\u7d22\u5f15\u4e0d\u8981\u7528\u6570\u5b57 index\uff0c\u7528 labels","text":""},{"location":"code_guide/lessons_learned.html#borg-index","title":"Borg \u57fa\u4e8e index \u7684\u5bb9\u5668\u7d22\u5f15\u8bbe\u8ba1","text":"<p>Borg \u63d0\u4f9b\u4e86 jobs \u6765\u5bf9\u5bb9\u5668\u540d\u5b57\u76f8\u540c\u7684 tasks \u8fdb\u884c\u5206\u7ec4\u3002</p> <ul> <li>\u6bcf\u4e2a job \u7531\u4e00\u4e2a\u6216\u591a\u4e2a\u5b8c\u5168\u76f8\u540c\u7684 task \u7ec4\u6210\uff0c\u7528\u5411\u91cf\uff08vector\uff09\u65b9\u5f0f\u7ec4\u7ec7\uff0c\u4ece index=0 \u5f00\u59cb\u7d22\u5f15\u3002</li> </ul>"},{"location":"code_guide/lessons_learned.html#k8s-label","title":"K8s \u57fa\u4e8e label \u7684\u5bb9\u5668\u7d22\u5f15\u8bbe\u8ba1","text":"<p>k8s \u4e3b\u8981\u4f7f\u7528 labels \u6765\u8bc6\u522b\u4e00\u7ec4\u5bb9\u5668\uff08groups of containers\uff09</p> <ul> <li>Label \u662f key/value pair\uff0c\u5305\u542b\u4e86\u53ef\u4ee5\u7528\u6765\u9274\u522b\u8fd9\u4e2a object \u7684\u4fe1\u606f\uff1b </li> <li>Label \u53ef\u4ee5\u52a8\u6001\u6dfb\u52a0\u3001\u5220\u9664\u548c\u4fee\u6539\uff0c\u53ef\u4ee5\u901a\u8fc7\u5de5\u5177\u6216\u7528\u6237\u624b\u52a8\u64cd\u4f5c\uff1b</li> <li>\u4e0d\u540c\u56e2\u961f\u53ef\u4ee5\u7ba1\u7406\u5404\u81ea\u7684 label\uff0c\u57fa\u672c\u53ef\u4ee5\u505a\u5230\u4e0d\u91cd\u53e0\uff1b</li> </ul> <p>\u901a\u8fc7 <code>label selector</code> \uff08\u4f8b\u5982\uff0c<code>stage==production &amp;&amp; role==frontend</code>\uff09\u6765\u9009\u4e2d\u4e00\u7ec4 objects</p> <ul> <li>\u7ec4\u53ef\u4ee5\u91cd\u5408\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a object \u53ef\u80fd\u51fa\u73b0\u5728\u591a\u4e2a label selector \u7b5b\u9009\u51fa\u7684\u7ed3\u679c\u4e2d\uff0c\u56e0\u6b64\u8fd9\u79cd\u57fa\u4e8e label \u7684\u65b9\u5f0f\u66f4\u52a0\u7075\u6d3b\uff1b</li> <li>label selector \u662f\u52a8\u6001\u67e5\u8be2\u8bed\u53e5\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ea\u8981\u7528\u6237\u6709\u9700\u8981\uff0c\u4ed6\u4eec\u968f\u65f6\u53ef\u4ee5\u6309\u81ea\u5df1\u7684\u9700\u6c42\u7f16\u5199\u65b0\u7684\u67e5\u8be2\u8bed\u53e5\uff08selector\uff09\uff1b</li> <li>Label selector \u662f k8s \u7684 grouping mechanism\uff0c\u4e5f\u5b9a\u4e49\u4e86\u6240\u6709\u7ba1\u7406\u64cd\u4f5c\u7684\u8303\u56f4\uff08\u591a\u4e2a objects\uff09\u3002</li> </ul> <p>Labels \u548c label selectors \u63d0\u4f9b\u4e86\u4e00\u79cd\u901a\u7528\u673a\u5236\uff0c \u65e2\u4fdd\u7559\u4e86 Borg \u57fa\u4e8e index \u7d22\u5f15\u7684\u80fd\u529b\uff0c\u53c8\u83b7\u5f97\u4e86\u4e0a\u9762\u4ecb\u7ecd\u7684\u7075\u6d3b\u6027\u3002</p>"},{"location":"code_guide/lessons_learned.html#43-ownership","title":"4.3 Ownership \u8bbe\u8ba1\u8981\u683c\u5916\u5c0f\u5fc3","text":"<p>\u5728 Borg \u4e2d\uff0ctask \u5e76\u4e0d\u662f\u72ec\u7acb\u4e8e job \u7684\u5b58\u5728\uff1a</p> <ul> <li>\u521b\u5efa\u4e00\u4e2a job \u4f1a\u521b\u5efa\u76f8\u5e94\u7684 tasks\uff0c\u8fd9\u4e9b tasks \u6c38\u8fdc\u4e0e\u8fd9\u4e2a job \u7ed1\u5b9a\uff1b</li> <li>\u5220\u9664\u8fd9\u4e2a jobs \u65f6\u4f1a\u5220\u9664\u5b83\u6240\u6709\u7684 tasks\u3002</li> </ul> <p>\u5f53\u8fd9\u4e2a vector index \u7684 grouping \u673a\u5236\u62bd\u8c61\u65e0\u6cd5\u6ee1\u8db3\u67d0\u4e9b\u573a\u666f\uff08\u5982DaemonSet \u9700\u8981\u5c06\u4e00\u4e2a pod \u5728\u6bcf\u4e2a node \u4e0a\u90fd\u8d77\u4e00\u4e2a\u5b9e\u4f8b\uff09\u65f6\uff0c \u7528\u6237\u5fc5\u987b\u5f00\u53d1\u4e00\u4e9b workaround\u3002</p> <p>Kubernetes \u4e2d\uff0c\u90a3\u4e9b pod-lifecycle \u7ba1\u7406\u7ec4\u4ef6 \u2014\u2014 \u4f8b\u5982 replication controller \u2014\u2014 \u901a\u8fc7 label selector \u6765\u5224\u65ad\u54ea\u4e9b pod \u5f52\u81ea\u5df1\u7ba1\uff1b</p> <ul> <li>\u591a\u4e2a controller \u53ef\u80fd\u4f1a\u9009\u4e2d\u540c\u4e00\u4e2a pod\uff0c\u8ba4\u4e3a\u8fd9\u4e2a pod \u90fd\u5e94\u8be5\u5f52\u81ea\u5df1\u7ba1\uff0c \u8fd9\u79cd\u51b2\u7a81\u7406\u5e94\u5728\u914d\u7f6e\u5c42\u9762\u89e3\u51b3\u3002</li> </ul> <p>label\u7075\u6d3b\u6027\u7684\u597d\u5904\uff1acontroller \u548c pod \u5206\u79bb\u610f\u5473\u7740\u53ef\u4ee5 \"orphan\" \u548c \"adopt\" container</p> <ul> <li>service\uff0c \u5982\u679c\u5176\u4e2d\u4e00\u4e2a pod \u6709\u95ee\u9898\u4e86\uff0c\u90a3\u53ea\u9700\u8981\u628a\u76f8\u5e94\u7684 label \u4ece\u8fd9\u4e2a pod \u4e0a\u53bb\u6389\uff0c k8s service \u5c31\u4e0d\u4f1a\u518d\u5c06\u6d41\u91cf\u8f6c\u53d1\u7ed9\u8fd9\u4e2a pod</li> <li>pod \u4e0d\u518d\u63a5\u751f\u4ea7\u6d41\u91cf\uff0c\u4f46\u4ecd\u7136\u6d3b\u5728\u7ebf\u4e0a\uff0c\u56e0\u6b64\u5c31\u53ef\u4ee5\u5bf9\u5b83\u8fdb\u884c debug </li> <li>\u8d1f\u8d23\u7ba1\u7406\u8fd9\u4e9b pod \u7684 replication controller \u5c31\u4f1a\u7acb\u5373\u518d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 pod \u51fa\u6765\u63a5\u6d41\u91cf</li> </ul>"},{"location":"code_guide/lessons_learned.html#44","title":"4.4 \u4e0d\u8981\u66b4\u9732\u539f\u59cb\u72b6\u6001","text":"<p>Borg\u3001Omega \u548c k8s \u7684\u4e00\u4e2a\u6838\u5fc3\u533a\u522b\u662f\u5b83\u4eec\u7684 API \u67b6\u6784\u3002</p> <p>Borgmaster \u662f\u4e00\u4e2a\u5355\u4f53\u7ec4\u4ef6\uff0c\u7406\u89e3\u6bcf\u4e2a API \u64cd\u4f5c\u7684\u8bed\u4e49</p> <ul> <li>\u5305\u542b\u96c6\u7fa4\u7ba1\u7406\u903b\u8f91\uff0c\u4f8b\u5982 job/task/machine \u7684\u72b6\u6001\u673a\uff1b</li> <li>\u8fd0\u884c\u57fa\u4e8e Paxos \u7684 replicated storage system\uff0c\u7528\u6765\u5b58\u50a8 master \u7684\u72b6\u6001\u3002</li> </ul> <p>Omega \u9664\u4e86 store \u4e4b\u5916\u6ca1\u6709\u4e2d\u5fc3\u5f0f\u7ec4\u4ef6</p> <ul> <li>store \u5b58\u50a8\u4e86 passive \u72b6\u6001\u4fe1\u606f\uff0c\u6267\u884c\u4e50\u89c2\u5e76\u53d1\u63a7\u5236\uff1b</li> <li>\u6240\u6709\u903b\u8f91\u548c\u8bed\u4e49\u90fd\u4e0b\u653e\u5230\u4e86\u64cd\u4f5c store \u7684 client \u4e0a\uff0c\u540e\u8005\u4f1a\u76f4\u63a5\u8bfb\u5199 store \u5185\u5bb9\uff1b</li> </ul> <p>k8s \u5728 Omega \u7684\u5206\u5e03\u5f0f\u67b6\u6784\u548c Borg \u7684\u4e2d\u5fc3\u5f0f\u67b6\u6784\u4e4b\u95f4\u505a\u4e86\u4e00\u4e2a\u6298\u4e2d</p> <ul> <li>\u7cfb\u7edf\u7ea7\u522b\u7684\u89c4\u8303\u3001\u7b56\u7565\u3001\u6570\u636e\u8f6c\u6362\u7b49\u65b9\u9762\u8fd8\u662f\u96c6\u4e2d\u5f0f\uff1a store \u524d\u9762\u52a0\u4e86\u4e00\u5c42\u96c6\u4e2d\u5f0f\u7684 API server\uff0c\u5c4f\u853d\u6389\u6240\u6709 store \u5b9e\u73b0\u7ec6\u8282\uff0c \u63d0\u4f9b object validation\u3001defaulting \u548c versioning \u670d\u52a1\u3002</li> <li>\u4e0e Omega \u7c7b\u4f3c\uff0c\u5ba2\u6237\u7aef\u7ec4\u4ef6\u90fd\u5f7c\u6b64\u72ec\u7acb\uff0c\u53ef\u4ee5\u72ec\u7acb\u5f00\u53d1\u3001\u5347\u7ea7\uff08\u5728\u5f00\u6e90\u573a\u666f\u5c24\u5176\u91cd\u8981\uff09\uff0c \u4f46\u5404\u7ec4\u4ef6\u90fd\u8981\u7ecf\u8fc7 apiserver \u8fd9\u4e2a\u4e2d\u5fc3\u5f0f\u670d\u52a1\u7684\u8bed\u4e49\u3001\u89c4\u8303\u548c\u7b56\u7565</li> </ul>"},{"location":"code_guide/lessons_learned.html#5","title":"5 \u5f00\u653e\u95ee\u9898\u8ba8\u8bba","text":""},{"location":"code_guide/lessons_learned.html#51","title":"5.1 \u5e94\u7528\u914d\u7f6e\u7ba1\u7406","text":"<p>\u5e94\u7528\u914d\u7f6e\uff0c\u5373\u5982\u4f55\u628a\u5e94\u7528\u7684\u53c2\u6570\u5728\u521b\u5efa\u5bb9\u5668\u65f6\u4f20\u7ed9\u5b83\uff0c \u800c\u4e0d\u662f hard-code\u3002</p> <p>\u627f\u8ba4 <code>programmatic configuration</code> \u7684\u4e0d\u53ef\u907f\u514d\u6027\uff0c \u5728\u8ba1\u7b97\u548c\u6570\u636e\u4e4b\u95f4\u7ef4\u62a4\u4e00\u6761\u6e05\u6670\u8fb9\u754c\u3002 \u8868\u793a\u6570\u636e\u7684\u8bed\u8a00\u5e94\u8be5\u662f\u7b80\u5355\u3001data-only \u7684\u683c\u5f0f\uff0c\u4f8b\u5982 JSON or YAML\uff0c \u800c\u9488\u5bf9\u8fd9\u4e9b\u6570\u636e\u7684\u8ba1\u7b97\u548c\u4fee\u6539\u5e94\u8be5\u5728\u4e00\u95e8\u771f\u6b63\u7684\u7f16\u7a0b\u8bed\u8a00\u4e2d\u5b8c\u6210\uff0c\u540e\u8005\u6709 \u5b8c\u5584\u7684\u8bed\u4e49\u548c\u914d\u5957\u5de5\u5177\u3002</p>"},{"location":"code_guide/lessons_learned.html#52","title":"5.2 \u4f9d\u8d56\u7ba1\u7406","text":"<p>\u4e0a\u7ebf\u4e00\u4e2a\u65b0\u670d\u52a1\u901a\u5e38\u4e5f\u610f\u5473\u7740\u9700\u8981\u4e0a\u7ebf\u4e00\u7cfb\u5217\u76f8\u5173\u7684\u670d\u52a1\uff08\u76d1\u63a7\u3001\u5b58\u50a8\u3001CI/CD \u7b49\u7b49\uff09</p> <ul> <li>\u81ea\u52a8\u521d\u59cb\u5316\u4f9d\u8d56\uff08dependencies\uff09\u5e76\u4e0d\u662f\u4ec5\u4ec5\u542f\u52a8\u4e00\u4e2a\u65b0\u5b9e\u4f8b</li> </ul> <p>\u4e00\u79cd\u53ef\u80fd\u7684\u89e3\u51b3\u65b9\u5f0f\u662f\uff1a\u6bcf\u4e2a\u5e94\u7528\u663e\u5f0f\u58f0\u660e\u5b83\u4f9d\u8d56\u7684\u670d\u52a1\uff0c\u57fa\u7840\u8bbe\u65bd\u5c42\u7981\u6b62\u5b83\u8bbf\u95ee\u9664\u6b64\u4e4b\u5916\u7684\u6240\u6709\u670d\u52a1 \uff08\u6211\u4eec\u7684\u6784\u5efa\u7cfb\u7edf\u4e2d\uff0c\u7f16\u8bd1\u5668\u4f9d\u8d56\u5c31\u662f\u8fd9\u4e48\u505a\u7684\uff09\u3002 \u597d\u5904\u5c31\u662f\u57fa\u7840\u8bbe\u65bd\u80fd\u505a\u4e00\u4e9b\u6709\u76ca\u7684\u5de5\u4f5c\uff0c\u4f8b\u5982\u81ea\u52a8\u5316\u8bbe\u7f6e\u3001\u8ba4\u8bc1\u548c\u8fde\u63a5\u6027\u3002</p> <ul> <li>\u8868\u8fbe\u3001\u5206\u6790\u548c\u4f7f\u7528\u7cfb\u7edf\u4f9d\u8d56\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u7684\u590d\u6742\u6027\u5347\u9ad8\uff0c\u5e76\u6ca1\u6709\u4efb\u4f55\u4e00\u4e2a\u4e3b\u6d41\u7684\u5bb9\u5668\u7ba1\u7406\u7cfb\u7edf\u505a\u4e86\u8fd9\u4e2a\u4e8b\u60c5</li> </ul>"},{"location":"data_query/index.html","title":"\u7d22\u5f15","text":""},{"location":"data_query/index.html#_2","title":"\u5012\u6392\u7d22\u5f15","text":"<p>\u7d22\u5f15\u65b9\u6cd5\uff0c\u88ab\u7528\u6765\u5b58\u50a8\u5728\u5168\u6587\u641c\u7d22\u4e0b\u67d0\u4e2a\u5355\u8bcd\u5728\u4e00\u4e2a\u6587\u6863\u6216\u8005\u4e00\u7ec4\u6587\u6863\u4e2d\u7684\u5b58\u50a8\u4f4d\u7f6e\u7684\u6620\u5c04\u3002</p> <p>\u4e00\u822c\u7528\u5728\u6587\u6863\u6570\u636e\u5e93\uff0c\u5982MongoDB\u4e2d\u3002</p>"},{"location":"data_query/index.html#_3","title":"\u6811\u72b6\u7d22\u5f15","text":""},{"location":"data_query/index.html#b","title":"B\u6811\u7cfb\u5217\u7d22\u5f15","text":"<p>\u6570\u636e\u5e93\u7cfb\u7edf\u5de7\u5999\u5229\u7528\u4e86\u78c1\u76d8\u9884\u8bfb\u539f\u7406\uff0c\u5c06\u4e00\u4e2a\u8282\u70b9\u7684\u5927\u5c0f\u8bbe\u4e3a\u7b49\u4e8e\u4e00\u4e2a\u9875\uff08\u78c1\u76d8\u7684\u4e00\u4e2a\u5757\uff09\uff0c\u8fd9\u6837\u6bcf\u4e2a\u8282\u70b9\u53ea\u9700\u8981\u4e00\u6b21I/O\u5c31\u53ef\u4ee5\u5b8c\u5168\u8f7d\u5165\u3002\u4e3a\u4e86\u8fbe\u5230\u8fd9\u4e2a\u76ee\u7684\uff0c\u5728\u5b9e\u9645\u5b9e\u73b0B- Tree\u8fd8\u9700\u8981\u4f7f\u7528\u5982\u4e0b\u6280\u5de7\uff1a</p> <ul> <li>\u6bcf\u6b21\u65b0\u5efa\u8282\u70b9\u65f6\uff0c\u76f4\u63a5\u7533\u8bf7\u4e00\u4e2a\u9875\u7684\u7a7a\u95f4\uff0c\u4fdd\u8bc1\u4e00\u4e2a\u8282\u70b9\u7269\u7406\u4e0a\u4e5f\u5b58\u50a8\u5728\u4e00\u4e2a\u9875\u91cc\uff0c\u52a0\u4e4b\u8ba1\u7b97\u673a\u5b58\u50a8\u5206\u914d\u90fd\u662f\u6309\u9875\u5bf9\u9f50\u7684\uff0c\u5c31\u5b9e\u73b0\u4e86\u4e00\u4e2anode\u53ea\u9700\u4e00\u6b21I/O\u3002</li> <li>B-Tree\u4e2d\u4e00\u6b21\u68c0\u7d22\u6700\u591a\u9700\u8981 h-1 \u6b21I/O\uff08\u6839\u8282\u70b9\u5e38\u9a7b\u5185\u5b58\uff09\uff0c\u6e10\u8fdb\u590d\u6742\u5ea6\u4e3aO\uff08h\uff09=O\uff08logmN\uff09\u3002\u4e00\u822c\u5b9e\u9645\u5e94\u7528\u4e2d\uff0cm\u662f\u975e\u5e38\u5927\u7684\u6570\u5b57\uff0c\u901a\u5e38\u8d85\u8fc7100\uff0c\u56e0\u6b64h\u975e\u5e38\u5c0f\uff08\u901a\u5e38\u4e0d\u8d85\u8fc73\uff09\u3002</li> </ul>"},{"location":"data_query/index.html#innodbb","title":"InnoDB\u4e00\u68f5B+\u6811\u53ef\u4ee5\u5b58\u653e\u591a\u5c11\u884c\u6570\u636e","text":"<p>InnoDB\u7684\u4e3b\u952e\u7d22\u5f15\uff1aB+\u6811\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u4e86\u5b8c\u6574\u7684\u6570\u636e\u8bb0\u5f55\u3002</p> <p>InnoDB\u7684\u8f85\u52a9\u7d22\u5f15\uff1a\u5f15\u7528\u4e3b\u952e\u4f5c\u4e3adata\u57df\uff0c\u56e0\u6b64\u9700\u8981\u4e24\u6b21\u7684\u7d22\u5f15\u68c0\u7d22\u3002</p> <p>\u6587\u4ef6\u7cfb\u7edf\u5757\u7684\u5927\u5c0f\u662f4k\uff0cInnoDB\u6700\u5c0f\u50a8\u5b58\u5355\u5143\u9875\uff08Page\uff09\u7684\u5927\u5c0f\u662f16K\u3002</p> <p>\u5355\u884c\u7684\u5b57\u8282\u6570\uff1a1KB</p> <p>\u4e00\u9875\u5b58\u50a8\u7684\u884c\u6570\uff1a16KB / 1KB = 16</p> <p>\u4e3b\u952e\uff1abigInt 8\u5b57\u8282</p> <p>\u6307\u9488\uff1a\u5728InnoDB\u6e90\u7801\u4e2d\u8bbe\u7f6e\u4e3a6\u5b57\u8282</p> <p>\u4e00\u9875\u7684\u7d22\u5f15\u4e2a\u6570\uff1a16KB = 16384/(6+8) = 1170</p> <p>\u9ad8\u5ea6\u4e3a3\u7684B+\u6811\uff1a1170\uff08\u7d22\u5f15\u4e2a\u6570\uff09*1170\uff08\u7d22\u5f15\u4e2a\u6570\uff09*16\uff08\u6bcf\u9875\u884c\u6570\uff09= 21902400\uff082\u5343\u4e07\uff09\u6761\u8fd9\u6837\u7684\u8bb0\u5f55</p>"},{"location":"data_query/index.html#_4","title":"\u4f4d\u56fe\u7d22\u5f15","text":"<p>\u4e3b\u8981\u9488\u5bf9\u5927\u91cf\u76f8\u540c\u503c\u7684\u5217\u800c\u521b\u5efa\u7684\u7d22\u5f15\uff0c\u6b64\u65f6B+\u6811\u7d22\u5f15\u4ecd\u7136\u4f1a\u53d6\u51fa\u5927\u90e8\u5206\u6570\u636e\u3002</p> <ul> <li>\u65e0\u9700\u6392\u5e8f\uff1b</li> <li>\u5bf9\u4f4d\u56fe\u7d22\u5f15\u5217\u8fdb\u884cis null\u67e5\u8be2\u65f6,\u5219\u53ef\u4ee5\u4f7f\u7528\u7d22\u5f15\uff1b</li> <li>\u5f53\u4f7f\u7528count(XX),\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u7d22\u5f15\u5c31\u5feb\u901f\u5f97\u51fa\u7edf\u8ba1\u6570\u636e\uff1b</li> <li>\u5f53\u6839\u636e\u4f4d\u56fe\u7d22\u5f15\u7684\u5217\u8fdb\u884cand,or\u6216 in(x,y,..)\u67e5\u8be2\u65f6,\u76f4\u63a5\u7528\u7d22\u5f15\u7684\u4f4d\u56fe\u8fdb\u884c\u6216\u8fd0\u7b97,\u5728\u8bbf\u95ee\u6570\u636e\u4e4b\u524d\u53ef\u4e8b\u5148\u8fc7\u6ee4\u6570\u636e\uff1b</li> <li>\u4f4d\u56fe\u7d22\u5f15\uff0c\u7531\u4e8e\u7528\u4f4d\u56fe\u53cd\u6620\u6570\u636e,\u4e0d\u540c\u4f1a\u8bdd\u66f4\u65b0\u76f8\u540c\u952e\u503c\u7684\u540c\u4e00\u4f4d\u56fe\u6bb5\uff0cinsert\u3001update\u3001delete\u76f8\u4e92\u64cd\u4f5c\u90fd\u4f1a\u53d1\u9501\u5b9a\u3002</li> </ul>"},{"location":"data_query/index.html#_5","title":"\u539f\u7406","text":"<ul> <li>\u7d22\u5f15\u5757\u7684\u4e00\u4e2a\u7d22\u5f15\u884c\u4e2d\u5b58\u50a8\u952e\u503c\u3001\u8d77\u6b62Rowid,\u4ee5\u53ca\u8fd9\u4e9b\u952e\u503c\u7684\u4f4d\u7f6e\u7f16\u7801\uff1b</li> <li>\u4f4d\u7f6e\u7f16\u7801\u4e2d\u7684\u6bcf\u4e00\u4f4d\u8868\u793a\u952e\u503c\u5bf9\u5e94\u7684\u6570\u636e\u884c\u7684\u6709\u65e0.\u4f4d\u6570=\u8868\u7684\u603b\u8bb0\u5f55\u6570\uff1b</li> <li>\u6240\u9700\u7684\u4f4d\u56fe\u4e2a\u6570=\u7d22\u5f15\u5217\u7684\u4e0d\u540c\u952e\u503c\u591a\u5c11\uff0c\u5217\u7684\u4e0d\u540c\u503c\u8d8a\u5c11\uff0c\u6240\u9700\u7684\u4f4d\u56fe\u5c31\u8d8a\u5c11\uff1b</li> <li>\u4e0eB\u6811\u90a3\u6837\u76f4\u63a5\u4fdd\u5b58rowid\u7684\u533a\u522b\u5c31\u5728\u4e8e\u6bcf\u6b21\u90fd\u8981\u8fdb\u884crowid\u7684\u6362\u7b97\u5de5\u4f5c*\u3002</li> </ul>"},{"location":"data_query/index.html#_6","title":"\u573a\u666f","text":"<p>\u4f4d\u56fe\u7d22\u5f15\u4e0d\u9002\u5408OLTP\uff0c\u6bd4\u8f83\u9002\u5408OLAP\u3002</p> <ul> <li>\u4f4d\u56fe\u7d22\u5f15\uff0c\u7531\u4e8e\u7528\u4f4d\u56fe\u53cd\u6620\u6570\u636e\uff0c\u4e0d\u540c\u4f1a\u8bdd\u66f4\u65b0\u76f8\u540c\u952e\u503c\u7684\u540c\u4e00\u4f4d\u56fe\u6bb5\uff0cinsert\u3001update\u3001delete\u76f8\u4e92\u64cd\u4f5c\u90fd\u4f1a\u53d1\u9501\u5b9a\u3002</li> </ul>"},{"location":"data_query/TPC.html","title":"TPC","text":""},{"location":"data_query/TPC.html#tpc-ds","title":"TPC-DS","text":"<p>TPC-DS\u662f\u4e00\u4e2a\u9762\u5411\u51b3\u7b56\u652f\u6301\u7cfb\u7edf(decision support system)\u7684\u5305\u542b\u591a\u7ef4\u5ea6\u5e38\u89c4\u5e94\u7528\u6a21\u578b\u7684\u51b3\u7b56\u652f\u6301\u57fa\u51c6\uff0c\u5305\u62ec\u67e5\u8be2(queries)\u4e0e\u6570\u636e\u7ef4\u62a4\u3002</p> <p>\u91c7\u7528\u661f\u578b\u3001\u96ea\u82b1\u578b\u7b49\u591a\u7ef4\u6570\u636e\u6a21\u5f0f\u3002\u5b83\u5305\u542b7\u5f20\u4e8b\u5b9e\u8868\uff0c17\u5f20\u7eac\u5ea6\u8868\u5e73\u5747\u6bcf\u5f20\u8868\u542b\u670918\u5217\u3002</p> <p>\u5176\u5de5\u4f5c\u8d1f\u8f7d\u5305\u542b99\u4e2aSQL\u67e5\u8be2\uff0c\u8986\u76d6SQL99\u548c2003\u7684\u6838\u5fc3\u90e8\u5206\u4ee5\u53caOLAP\u3002</p> <p>\u8fd9\u4e2a\u6d4b\u8bd5\u96c6\u5305\u542b\u5bf9\u5927\u6570\u636e\u96c6\u7684\u7edf\u8ba1\u3001\u62a5\u8868\u751f\u6210\u3001\u8054\u673a\u67e5\u8be2\u3001\u6570\u636e\u6316\u6398\u7b49\u590d\u6742\u5e94\u7528\uff0c\u6d4b\u8bd5\u7528\u7684\u6570\u636e\u548c\u503c\u662f\u6709\u503e\u659c\u7684\uff0c\u4e0e\u771f\u5b9e\u6570\u636e\u4e00\u81f4\u3002\u53ef\u4ee5\u8bf4TPC-DS\u662f\u4e0e\u771f\u5b9e\u573a\u666f\u975e\u5e38\u63a5\u8fd1\u7684\u4e00\u4e2a\u6d4b\u8bd5\u96c6\uff0c\u4e5f\u662f\u96be\u5ea6\u8f83\u5927\u7684\u4e00\u4e2a\u6d4b\u8bd5\u96c6\u3002</p> <p>TPC-DS\u7684\u8fd9\u4e2a\u7279\u70b9\u8ddf\u5927\u6570\u636e\u7684\u5206\u6790\u6316\u6398\u5e94\u7528\u975e\u5e38\u7c7b\u4f3c\u3002Hadoop\u7b49\u5927\u6570\u636e\u5206\u6790\u6280\u672f\u4e5f\u662f\u5bf9\u6d77\u91cf\u6570\u636e\u8fdb\u884c\u5927\u89c4\u6a21\u7684\u6570\u636e\u5206\u6790\u548c\u6df1\u5ea6\u6316\u6398\uff0c\u4e5f\u5305\u542b\u4ea4\u4e92\u5f0f\u8054\u673a\u67e5\u8be2\u548c\u7edf\u8ba1\u62a5\u8868\u7c7b\u5e94\u7528\uff0c\u540c\u65f6\u5927\u6570\u636e\u7684\u6570\u636e\u8d28\u91cf\u4e5f\u8f83\u4f4e\uff0c\u6570\u636e\u5206\u5e03\u662f\u771f\u5b9e\u800c\u4e0d\u5747\u5300\u7684\u3002\u56e0\u6b64TPC-DS\u6210\u4e3a\u5ba2\u89c2\u8861\u91cf\u591a\u4e2a\u4e0d\u540cHadoop\u7248\u672c\u4ee5\u53caSQL on Hadoop\u6280\u672f\u7684\u6700\u4f73\u6d4b\u8bd5\u96c6\u3002\u8fd9\u4e2a\u57fa\u51c6\u6d4b\u8bd5\u6709\u4ee5\u4e0b\u51e0\u4e2a\u4e3b\u8981\u7279\u70b9\uff1a</p> <ul> <li>\u4e00\u517199\u4e2a\u6d4b\u8bd5\u6848\u4f8b\uff0c\u9075\u5faaSQL\u201999\u548cSQL 2003\u7684\u8bed\u6cd5\u6807\u51c6\uff0cSQL\u6848\u4f8b\u6bd4\u8f83\u590d\u6742\uff1b</li> <li>\u5206\u6790\u7684\u6570\u636e\u91cf\u5927\uff0c\u5e76\u4e14\u6d4b\u8bd5\u6848\u4f8b\u662f\u5728\u56de\u7b54\u771f\u5b9e\u7684\u5546\u4e1a\u95ee\u9898\uff1b</li> <li>\u6d4b\u8bd5\u6848\u4f8b\u4e2d\u5305\u542b\u5404\u79cd\u4e1a\u52a1\u6a21\u578b\uff08\u5982\u5206\u6790\u62a5\u544a\u578b\uff0c\u8fed\u4ee3\u5f0f\u7684\u8054\u673a\u5206\u6790\u578b\uff0c\u6570\u636e\u6316\u6398\u578b\u7b49\uff09\uff1b</li> <li>\u51e0\u4e4e\u6240\u6709\u7684\u6d4b\u8bd5\u6848\u4f8b\u90fd\u6709\u5f88\u9ad8\u7684IO\u8d1f\u8f7d\u548cCPU\u8ba1\u7b97\u9700\u6c42\uff1b</li> </ul>"},{"location":"data_query/TPC.html#_1","title":"\u5b89\u88c5\u4f7f\u7528","text":"<ul> <li>\u4e0b\u8f7d\uff08https://github.com/gregrahn/tpcds-kit\uff0c\u5b98\u7f51\u7684\u53ef\u80fd\u6709\u4e9bbug\uff09\uff1b</li> <li>\u89e3\u538b\u5e76\u8fdb\u5165<code>tools</code>\uff0c\u6267\u884c<code>make</code>\u547d\u4ee4\uff1b</li> <li>\u751f\u6210<code>dsdgen, dsqgen, distcompare, checksum, mkheader</code>\u7b49\u547d\u4ee4\uff1b</li> </ul>"},{"location":"data_query/TPC.html#_2","title":"\u6570\u636e\u751f\u6210","text":"<p><pre><code>dsdgen -DIR /path/store -SCALE 1\n</code></pre> \u53c2\u6570\uff1a</p> <ul> <li>-DIR\uff1a\u751f\u6210\u6587\u4ef6\u7684\u76ee\u5f55\uff1b</li> <li>-SCALE\uff1a\u6570\u636e\u89c4\u6a21\uff0c\u4ee5GB\u4e3a\u57fa\u672c\u5355\u4f4d1\uff1b</li> <li>-PARALLEL\uff1a\u751f\u6210\u7684\u6570\u636e\u4e00\u5171\u5206\u4e3a\u591a\u5c11\u4efd\uff0c\u4e00\u822c\u751f\u6210TB\u7ea7\u6570\u636e\u624d\u4f1a\u7528\u5230\u3002</li> <li>-CHILD\uff1a\u5f53\u524d\u6570\u636e\u662f\u7b2c\u51e0\u4efd\uff0c\u4e0ePARALLEL\u914d\u5bf9\u4f7f\u7528\u3002</li> <li>-DELIMITER\uff1a\u6307\u5b9a\u5206\u9694\u7b26\uff0c\u9ed8\u8ba4'|'\uff1b</li> <li>-TERMINATE\uff1a\u662f\u5426\u6bcf\u4e2a\u8bb0\u5f55\u672b\u5c3e\u4ee5\u5206\u9694\u7b26\u7ed3\u675f\uff1b</li> </ul> <p>\u4f1a\u5728\u76ee\u5f55\u4e2d\u751f\u621025\u4e2a.dat\u6587\u4ef6\u3002</p>"},{"location":"data_query/TPC.html#_3","title":"\u6570\u636e\u5bfc\u5165","text":""},{"location":"data_query/TPC.html#sql","title":"SQL\u751f\u6210","text":"<pre><code>for i in `seq 1 99`; do \n    ./dsqgen  -DIRECTORY ../query_templates/ -TEMPLATE \"query${i}.tpl\" -DIALECT netezza -FILTER Y &gt; ../sql/query${i}.sql; \ndone\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li>-DIRECTORY\uff1aSQL\u6a21\u677f\u7684\u8def\u5f84\uff1b</li> <li>-TEMPLATE\uff1aSQL\u6a21\u677f\u7684\u540d\u79f0\uff1b</li> <li>-DIALECT\uff1a\u4e0d\u540c\u7684SQL\u8bed\u6cd5\uff0c\u7528netezza\uff1b</li> <li>-FILTER\uff1a\u5c06\u751f\u6210\u7684SQL\u5199\u5230\u63a7\u5236\u53f0\uff1b</li> </ul>"},{"location":"data_query/TPC.html#faq","title":"FAQ","text":"<p>\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u7528TPC\u5b98\u7f51\u4e0b\u8f7d\uff1f</p> <p>\u5b98\u7f51\u76f4\u63a5\u4e0b\u8f7d\u540e\u751f\u6210SQL\u8bed\u53e5\u4f1a\u51fa\u73b0\uff1a</p> <p>ERROR: Substitution'_END' is used before being initialized at line ...</p> <p>\u89e3\u51b3\u65b9\u5f0f\uff1a(\u6279\u91cf\u5728\u6bcf\u4e2aquery\u8bed\u53e5\u540e\u9762\u6dfb\u52a0<code>define _END = \"\";</code>\u6216\u8005\u5728\u5bf9\u5e94\u7684DIALECT\u4e2d\u6dfb\u52a0)</p> <pre><code>#!/bin/bash\nCOUNTER=1\nwhile [ $COUNTER -lt 100 ]\ndo\necho $COUNTER\necho \"define _END = \\\"\\\";\"&gt;&gt;query$COUNTER.tpl\nCOUNTER=`expr $COUNTER + 1`\ndone    \n</code></pre>"},{"location":"data_query/apache_openLooKeng.html","title":"OpenLooKong","text":"<p>\u534e\u4e3a\u5f00\u6e90\uff0c\u65e9\u671f\u6e90\u81eaPresto\u6784\u5efa\u57fa\u7840\u7684\u4ea4\u4e92\u5f0f\u67e5\u8be2\u80fd\u529b</p> <p>\u529f\u80fd\uff1a</p> <ul> <li>\u652f\u6301\u6570\u636e\u63a2\u7d22\u3001\u5373\u5e2d\u67e5\u8be2\u548c\u6279\u5904\u7406\uff0c\u5177\u6709100+\u6beb\u79d2\u81f3\u5206\u949f\u7ea7\u7684\u8fd1\u5b9e\u65f6\u65f6\u5ef6\uff0c\u800c\u65e0\u9700\u79fb\u52a8\u6570\u636e\uff1b</li> <li>\u5177\u6709\u9ad8\u53ef\u7528\u6027\u3001\u81ea\u52a8\u4f38\u7f29\u3001\u5185\u7f6e\u7f13\u5b58\u548c\u7d22\u5f15\u652f\u6301\uff0c\u4e3a\u4f01\u4e1a\u5de5\u4f5c\u8d1f\u8f7d\u63d0\u4f9b\u4e86\u6240\u9700\u7684\u53ef\u9760\u6027\uff1b</li> </ul> <p>\u9002\u7528\u4e8e\uff1a</p> <ul> <li> <p>\u8de8\u6e90\u5f02\u6784\u67e5\u8be2\u573a\u666f\uff1aRDBMS\u3001NoSQL\u3001Hive\u3001MPPDB\u7b49\u6570\u636e\u4ed3\u5e93\u7684\u8054\u5408\u67e5\u8be2</p> </li> <li> <p>\u8de8\u57df\u8de8DC\u67e5\u8be2\uff1aopenLooKeng\u96c6\u7fa4\u90e8\u7f72\u5728\u591a\u4e2aDC\u4e2d\uff1b</p> </li> <li> <p>\u5b58\u50a8\u8ba1\u7b97\u5206\u79bb\uff1a\u672c\u8eab\u6ca1\u6709\u5b58\u50a8\u5f15\u64ce\uff0c\u4f46\u53ef\u4ee5\u67e5\u8be2\u5b58\u50a8\u5728\u4e0d\u540c\u6570\u636e\u6e90\u4e2d\u7684\u6570\u636e\uff1b</p> </li> <li> <p>\u5feb\u901f\u6570\u636e\u63a2\u7d22\uff1a\u4f7f\u7528\u6807\u51c6SQL\u5b9a\u4e49\u4e00\u4e2a\u865a\u62df\u6570\u636e\u5e02\u573a\uff0c\u901a\u8fc7\u8de8\u6e90\u5f02\u6784\u67e5\u8be2\u80fd\u529b\u8fde\u63a5\u5404\u4e2a\u6570\u636e\u6e90</p> </li> </ul>"},{"location":"data_query/basic.html","title":"\u57fa\u7840","text":""},{"location":"data_query/basic.html#_2","title":"\u6570\u636e\u7c7b\u578b\u5206\u7c7b","text":""},{"location":"data_query/basic.html#_3","title":"\u7ed3\u6784\u5316\u6570\u636e","text":"<p>\u7ed3\u6784\u5316\u6570\u636e\u53ef\u4ee5\u901a\u8fc7\u56fa\u6709\u952e\u503c\u83b7\u53d6\u76f8\u5e94\u4fe1\u606f\uff0c\u4e14\u6570\u636e\u7684\u683c\u5f0f\u56fa\u5b9a\u3002</p> <ul> <li>\u8868\u6a21\u578b\u3002</li> </ul>"},{"location":"data_query/basic.html#_4","title":"\u534a\u7ed3\u6784\u5316\u6570\u636e","text":"<p>\u534a\u7ed3\u6784\u5316\u6570\u636e\u662f\u7ed3\u6784\u5316\u6570\u636e\u7684\u4e00\u79cd\u5f62\u5f0f\uff0c\u5b83\u5e76\u4e0d\u7b26\u5408\u5173\u7cfb\u578b\u6570\u636e\u5e93\u6216\u5176\u4ed6\u6570\u636e\u8868\u7684\u5f62\u5f0f\u5173\u8054\u8d77\u6765\u7684\u6570\u636e\u6a21\u578b\u7ed3\u6784\uff0c\u4f46\u5305\u542b\u76f8\u5173\u6807\u8bb0\uff0c\u7528\u6765\u5206\u9694\u8bed\u4e49\u5143\u7d20\u4ee5\u53ca\u5bf9\u8bb0\u5f55\u548c\u5b57\u6bb5\u8fdb\u884c\u5206\u5c42\u3002\u56e0\u6b64\uff0c\u5b83\u4e5f\u88ab\u79f0\u4e3a\u81ea\u63cf\u8ff0\u7684\u7ed3\u6784\u3002</p> <ul> <li>json\u3001html\u3001xml\u7b49\uff0c\u6811\u6a21\u578b\u3001\u56fe\u6a21\u578b</li> </ul>"},{"location":"data_query/basic.html#_5","title":"\u975e\u7ed3\u6784\u5316\u6570\u636e","text":"<p>\u6ca1\u6709\u4e00\u4e2a\u9884\u5148\u5b9a\u4e49\u597d\u7684\u6570\u636e\u6a21\u578b\u6216\u8005\u6ca1\u6709\u4ee5\u4e00\u4e2a\u9884\u5148\u5b9a\u4e49\u7684\u65b9\u5f0f\u6765\u7ec4\u7ec7\u3002</p> <ul> <li>\u6587\u672c\u3001\u56fe\u50cf\u3001\u97f3\u9891\u3001\u89c6\u9891\u7b49\u3002</li> </ul>"},{"location":"data_query/basic.html#_6","title":"\u8bfb\u65f6\u6a21\u5f0f\u548c\u5199\u65f6\u6a21\u5f0f","text":"<p>\"\u5199\u65f6\u6a21\u5f0f\"\uff1a\u6570\u636e\u5728\u5199\u5165\u6570\u636e\u5e93\u65f6\u5bf9\u7167\u8868\u6a21\u5f0f\u8fdb\u884c\u68c0\u67e5\uff0c\u6570\u636e\u6444\u5165\uff08\u5199\u5165\uff09\u901f\u5ea6\u6162\uff0c\u503e\u5411\u4e8e\u8bfb\u6548\u7387\uff1b</p> <ul> <li>\u8981\u662f\u6240\u6709\u8bb0\u5f55\u90fd\u5177\u6709\u76f8\u540c\u7684\u7ed3\u6784\uff0c\u90a3\u4e48\u6a21\u5f0f\u662f\u8bb0\u5f55\u5e76\u5f3a\u5236\u8fd9\u79cd\u7ed3\u6784\u7684\u6709\u6548\u673a\u5236\u3002</li> </ul> <p>\"\u8bfb\u65f6\u6a21\u5f0f\"\uff1a\u5728\u9700\u8981\u67e5\u8be2\u5206\u6790\u7684\u65f6\u5019\u518d\u4e3a\u6570\u636e\u8bbe\u7f6eschema\u8fdb\u884c\u9a8c\u8bc1\uff08\u5931\u8d25\u8bbe\u7f6e\u4e3aNULL\uff09\uff0c\u5e95\u5c42\u5b58\u50a8\u4e0d\u4f1a\u5728\u6570\u636e\u52a0\u8f7d\u65f6\u8fdb\u884c\u9a8c\u8bc1\u3002</p> <ul> <li>\u5b58\u5728\u8bb8\u591a\u4e0d\u540c\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u5c06\u6bcf\u79cd\u7c7b\u578b\u7684\u5bf9\u8c61\u653e\u5728\u81ea\u5df1\u7684\u8868\u4e2d\u662f\u4e0d\u73b0\u5b9e\u7684\uff1b</li> <li>\u6570\u636e\u7684\u7ed3\u6784\u7531\u5916\u90e8\u7cfb\u7edf\u51b3\u5b9a\u3002\u4f60\u65e0\u6cd5\u63a7\u5236\u5916\u90e8\u7cfb\u7edf\u4e14\u5b83\u968f\u65f6\u53ef\u80fd\u53d8\u5316\uff1b</li> </ul>"},{"location":"data_query/basic.html#dqldmlddldcl","title":"DQL\u3001DML\u3001DDL\u3001DCL\u7684\u6982\u5ff5\u4e0e\u533a\u522b","text":"<p>SQL(Structure Query Language)\u8bed\u8a00\u662f\u6570\u636e\u5e93\u7684\u6838\u5fc3\u8bed\u8a00\u3002</p> <p>SQL\u8bed\u8a00\u5171\u5206\u4e3a\u56db\u5927\u7c7b\uff1a\u6570\u636e\u67e5\u8be2\u8bed\u8a00DQL\uff0c\u6570\u636e\u64cd\u7eb5\u8bed\u8a00DML\uff0c\u6570\u636e\u5b9a\u4e49\u8bed\u8a00DDL\uff0c\u6570\u636e\u63a7\u5236\u8bed\u8a00DCL\u3002</p>"},{"location":"data_query/basic.html#1-dql","title":"1. \u6570\u636e\u67e5\u8be2\u8bed\u8a00DQL","text":"<p>\u6570\u636e\u67e5\u8be2\u8bed\u8a00DQL\u57fa\u672c\u7ed3\u6784\u662f\u7531SELECT\u5b50\u53e5\uff0cFROM\u5b50\u53e5\uff0cWHERE \u5b50\u53e5\u7ec4\u6210\u7684\u67e5\u8be2\u5757\uff1a SELECT &lt;\u5b57\u6bb5\u540d\u8868&gt; FROM &lt;\u8868\u6216\u89c6\u56fe\u540d&gt; WHERE &lt;\u67e5\u8be2\u6761\u4ef6&gt;</p>"},{"location":"data_query/basic.html#2-dml","title":"2 .\u6570\u636e\u64cd\u7eb5\u8bed\u8a00DML","text":"<p>\u6570\u636e\u64cd\u7eb5\u8bed\u8a00DML\u4e3b\u8981\u6709\u4e09\u79cd\u5f62\u5f0f\uff1a 1) \u63d2\u5165\uff1aINSERT 2) \u66f4\u65b0\uff1aUPDATE 3) \u5220\u9664\uff1aDELETE</p>"},{"location":"data_query/basic.html#3-ddl","title":"3. \u6570\u636e\u5b9a\u4e49\u8bed\u8a00DDL","text":"<p>\u6570\u636e\u5b9a\u4e49\u8bed\u8a00DDL\u7528\u6765\u521b\u5efa\u6570\u636e\u5e93\u4e2d\u7684\u5404\u79cd\u5bf9\u8c61-----\u8868\u3001\u89c6\u56fe\u3001\u7d22\u5f15\u3001\u540c\u4e49\u8bcd\u3001\u805a\u7c07\u7b49\u5982\uff1a</p> <p>CREATE TABLE/VIEW/INDEX/SYN/CLUSTER</p> <p>DDL\u64cd\u4f5c\u662f\u9690\u6027\u63d0\u4ea4\u7684\uff01\u4e0d\u80fdrollback </p>"},{"location":"data_query/basic.html#4-dcl","title":"4. \u6570\u636e\u63a7\u5236\u8bed\u8a00DCL","text":"<p>\u6570\u636e\u63a7\u5236\u8bed\u8a00DCL\u7528\u6765\u6388\u4e88\u6216\u56de\u6536\u8bbf\u95ee\u6570\u636e\u5e93\u7684\u67d0\u79cd\u7279\u6743\uff0c\u5e76\u63a7\u5236\u6570\u636e\u5e93\u64cd\u7eb5\u4e8b\u52a1\u53d1\u751f\u7684\u65f6\u95f4\u53ca\u6548\u679c\uff0c\u5bf9\u6570\u636e\u5e93\u5b9e\u884c\u76d1\u89c6\u7b49\u3002\u5982\uff1a 1) GRANT\uff1a\u6388\u6743\u3002</p> <p>2) ROLLBACK [WORK] TO [SAVEPOINT]\uff1a\u56de\u9000\u5230\u67d0\u4e00\u70b9\u3002</p> <p>3) COMMIT [WORK]\uff1a\u63d0\u4ea4\u3002</p> <p>\u63d0\u4ea4\u6570\u636e\u6709\u4e09\u79cd\u7c7b\u578b\uff1a\u663e\u5f0f\u63d0\u4ea4\u3001\u9690\u5f0f\u63d0\u4ea4\u53ca\u81ea\u52a8\u63d0\u4ea4\u3002\u4e0b\u9762\u5206\u522b\u8bf4\u660e\u8fd9\u4e09\u79cd\u7c7b\u578b\u3002</p> <p>(1) \u663e\u5f0f\u63d0\u4ea4</p> <p>\u7528COMMIT\u547d\u4ee4\u76f4\u63a5\u5b8c\u6210\u7684\u63d0\u4ea4\u4e3a\u663e\u5f0f\u63d0\u4ea4\u3002\u5176\u683c\u5f0f\u4e3a\uff1a</p> <p>SQL&gt;COMMIT\uff1b</p> <p>(2) \u9690\u5f0f\u63d0\u4ea4</p> <p>\u7528SQL\u547d\u4ee4\u95f4\u63a5\u5b8c\u6210\u7684\u63d0\u4ea4\u4e3a\u9690\u5f0f\u63d0\u4ea4\u3002\u8fd9\u4e9b\u547d\u4ee4\u662f\uff1a</p> <p>ALTER\uff0cAUDIT\uff0cCOMMENT\uff0cCONNECT\uff0cCREATE\uff0cDISCONNECT\uff0cDROP\uff0cEXIT\uff0cGRANT\uff0cNOAUDIT\uff0cQUIT\uff0cREVOKE\uff0cRENAME\u3002</p> <p>(3) \u81ea\u52a8\u63d0\u4ea4</p> <p>\u82e5\u628aAUTOCOMMIT\u8bbe\u7f6e\u4e3aON\uff0c\u5219\u5728\u63d2\u5165\u3001\u4fee\u6539\u3001\u5220\u9664\u8bed\u53e5\u6267\u884c\u540e\uff0c\u7cfb\u7edf\u5c06\u81ea\u52a8\u8fdb\u884c\u63d0\u4ea4\uff0c\u8fd9\u5c31\u662f\u81ea\u52a8\u63d0\u4ea4\u3002\u5176\u683c\u5f0f\u4e3a\uff1a</p> <p>SQL&gt;SET AUTOCOMMIT ON\uff1b</p>"},{"location":"data_query/basic.html#_7","title":"\u6570\u636e\u5b57\u5178","text":"<p>\u5c06\u5c5e\u6027\u503c\u548c\u4e3b\u4f53\u5206\u79bb\uff0c\u4e3b\u4f53\u8868\u53ea\u4fdd\u5b58\u5c5e\u6027\u7684\u7684\u4ee3\u7801\uff0c\u8fd9\u5c31\u662f\u4e00\u79cd\u6570\u636e\u5b57\u5178\u3002</p>"},{"location":"data_query/basic.html#_8","title":"\u80cc\u666f","text":"<p>User\u8868\uff0cUser\u4e3b\u4f53\u6709\u5f88\u591a\u5c5e\u6027\uff0c\u6bd4\u5982\u8bc1\u4ef6\uff08\u8eab\u4efd\u8bc1\u3001\u5c45\u4f4f\u8bc1\u3001\u6e2f\u6fb3\u901a\u884c\u8bc1...\uff09\uff0c\u5730\u533a\uff08\u6cb3\u5317\u3001\u6cb3\u5357\u3001\u5317\u4eac...\uff09\u7b49\uff0c\u7136\u540e\u8868\u5efa\u597d\u4e86\uff0c\u6570\u636e\u4e5f\u586b\u8fdb\u53bb\u4e86\uff0c\u9879\u76ee\u4ee3\u7801\u4e5f\u6572\u51e0\u4e07\u884c\u3002\u4f46\u662f\u6709\u4e00\u5929\uff0c\u5ba2\u6237\u8bf4\u8fd9\u4e2a\u201c\u8eab\u4efd\u8bc1\u201d\u8868\u8ff0\u4e0d\u591f\u5b98\u65b9\uff0c\u8981\u6539\u6210\u201c\u5c45\u6c11\u8eab\u4efd\u8bc1\u201d\u6bd4\u8f83\u597d\uff0c\u4f5c\u4e3a\u8fd9\u4e2a\u9879\u76ee\u5f00\u53d1\u4eba\u5458\uff0c\u8981\u628a\u4ee3\u7801\u91cc\u548c\u6570\u636e\u5e93\u4e2d\u6240\u6709\u7684\u201c\u8eab\u4efd\u8bc1\u201d\u6539\u6210\u201c\u5c45\u6c11\u8eab\u4efd\u8bc1\u201d\uff0c\u8fd9\u5de5\u4f5c\u91cf\u4f30\u8ba1\u5f88\u8ba9\u4eba\u6293\u72c2\u3002</p>"},{"location":"data_query/basic.html#_9","title":"\u4e24\u79cd\u5f62\u5f0f","text":"<p>\u7b2c\u4e00\u79cd\uff1a\u300a\u4e3b\u4f53\u8868\u300b\u91cc\u5305\u542b\u4e3b\u4f53\u548c\u5c5e\u6027\u4ee3\u7801\uff0c\u300a\u5c5e\u6027\u8868\u300b\u91cc\u5305\u542b\u5c5e\u6027\u4ee3\u7801\u548c\u5c5e\u6027Value\uff0c\u4e0d\u540c\u5c5e\u6027\u5206\u522b\u5efa\u8868\u3002</p> <ul> <li>\u7531\u4e8e\u5c5e\u6027id\u662f\u5b58\u50a8\u5728\u4e3b\u4f53\u8868\u91cc\u7684\uff0c\u5c5e\u6027\u7684\u6570\u91cf\u662f\u4e0d\u53d8\u7684\uff0c\u800c\u5c5e\u6027\u53d6\u503c\u7684\u6570\u91cf\u53ef\u4ee5\u662f\u53d8\u5316\u3002</li> <li>\u4f46\u662f\u5982\u679c\u8be5\u4e3b\u4f53\u7684\u5c5e\u6027\u975e\u5e38\u591a\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u5efa\u5f88\u591a\u7684\u5c5e\u6027\u8868\uff0c\u5728\u5f00\u53d1\u4e2d\u8fd8\u8981\u8bbe\u8ba1\u5f88\u591a\u5c5e\u6027\u7c7b\uff0c\u90a3\u5f53\u60f3\u8981\u53d6\u5f97\u4e00\u6761\u4e3b\u4f53\u7684\u5b8c\u5168\u6570\u636e\u65f6\uff0c\u90a3\u5c06\u8fdb\u884c\u51e0\u5341\u4e2a\u8868\u7684\u8054\u63a5\uff08join\uff09\u64cd\u4f5c\u3002\u6027\u80fd\u8017\u635f\u4e25\u91cd\u3002</li> <li>\u5f53\u5c5e\u6027\u7684\u6570\u91cf\u4e0d\u591a\u65f6\uff0c\u7528\u7b2c\u4e00\u79cd\u6570\u636e\u5b57\u5178\u5373\u53ef\u3002</li> </ul> &lt;\u8bc1\u4ef6\u8868&gt; &lt;\u8eab\u4efd\u8868&gt; <p>\u7b2c\u4e8c\u79cd\uff1a\u300a\u4e3b\u4f53\u8868\u300b\u91cc\u4ec5\u5305\u542b\u4e3b\u4f53\uff0c\u300a\u7cfb\u7edf\u4ee3\u7801\u5206\u7c7b\u8868\u300b\u91cc\u5b58\u50a8\u5c5e\u6027\u6807\u8bc6\u548c\u5c5e\u6027\u540d\u79f0\uff0c\u300a\u7cfb\u7edf\u4ee3\u7801\u8868\u300b\u91cc\u5305\u542b\u6240\u6709\u5c5e\u6027\u4ee3\u7801\u3001\u5c5e\u6027\u6807\u8bc6\u548c\u5c5e\u6027Value\uff0c\u300a\u5c5e\u6027\u8868\u300b\u662f\u300a\u4e3b\u4f53\u300b\u548c\u300a\u7cfb\u7edf\u4ee3\u7801\u8868\u300b\u7684\u5173\u7cfb\u8868\uff0c\u5305\u542b\u5c5e\u6027id\uff0c\u4e3b\u4f53id,\u5c5e\u6027\u4ee3\u7801\u3002</p> <ul> <li>\u7531\u4e8e\u8fd9\u79cd\u8bbe\u8ba1\u65b9\u5f0f\u5c5e\u6027\u548c\u4e3b\u9898\u8868\u662f\u5206\u5f00\u7684\uff0c\u6240\u4ee5\u5c5e\u6027\u7684\u6570\u91cf\u662f\u53ef\u53d8\u7684\uff0c\u800c\u5c5e\u6027\u53d6\u503c\u7684\u6570\u91cf\u53ef\u4ee5\u662f\u53d8\u5316\u7684\u3002</li> <li>\u5f15\u5165\u300a\u7cfb\u7edf\u4ee3\u7801\u5206\u7c7b\u8868\u300b\u548c\u300a\u7cfb\u7edf\u4ee3\u7801\u8868\u300b\uff0c\u4e5f\u89e3\u51b3\u4e86\u7b2c\u4e00\u79cd\u8bbe\u8ba1\u65b9\u5f0f\u7684\u5c40\u9650\u6027\u3002</li> </ul> &lt;\u7cfb\u7edf\u4ee3\u7801\u5206\u7c7b\u8868&gt; &lt;\u7cfb\u7edf\u4ee3\u7801\u8868&gt; &lt;\u5c5e\u6027\u8868&gt;"},{"location":"data_query/basic.html#_10","title":"\u6570\u4ed3","text":"<p>\u6570\u636e\u4ed3\u5e93\u4e2d\u6709\u8fd9\u4e9b\u6982\u5ff5\uff1a\uff08\u901a\u4fd7\u7684\u8bb2\uff0c\u5177\u4f53\u7684\u6982\u5ff5\u53ef\u4ee5\u770b\u6570\u636e\u4ed3\u5e93\u7684\u4e66\uff09</p> <p>\u4e3b\u9898\uff1a\u4f60\u8981\u5206\u6790\u4ec0\u4e48\uff1f\u5982\uff1a\u67d0\u5e74\u67d0\u6708\u67d0\u4e2a\u5730\u533a\u7684\u67d0\u79cd\u5546\u54c1\u7684\u9500\u552e\u91cf\uff0c\u8fd9\u6837\u7684\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\u4e00\u4e2a\u4e3b\u4f53\u3002</p> <p>\u7ef4\u5ea6\uff1a\u4ece\u54ea\u4e2a\u89d2\u5ea6\u6765\u5224\u65ad\u3002\u5982\uff1a\u65f6\u95f4\u89d2\u5ea6\uff08\u67d0\u5e74\u3001\u67d0\u6708\u2026\u2026\uff09\uff0c\u5730\u533a\uff08\u54ea\u4e2a\u56fd\u5bb6\u3001\u90a3\u4e2a\u7701\u2026\u2026\uff09</p> <p>\u5c42\u6b21\uff1a\u7ef4\u5ea6\u7684\u5177\u4f53\u6d4b\u91cf\u5355\u4f4d\uff0c\u7c7b\u4f3c\u4e8e\u91cf\u957f\u5ea6\u65f6\u91c7\u7528\u7684\u54ea\u79cd\u5355\u4f4d\u3002\u5982\u65f6\u95f4\u7ef4\u5ea6\uff0c\u5e74\u3001\u5b63\u5ea6\u3001\u6708\u5c31\u662f\u4e0d\u540c\u7684\u5c42\u6b21\u3002</p> <p>\u4e8b\u5b9e\uff1a\u5c31\u662f\u4f60\u8981\u5206\u6790\u4e3b\u9898\u7684\u5177\u4f53\u6570\u5b57\u3002\u5982\u9500\u552e\u91cf\u3001\u4eba\u5747\u6d88\u8d39\u91cf\u3001\u8d44\u4ea7\u603b\u6570\u2026\u2026</p>"},{"location":"data_query/basic.html#_11","title":"\u4e8b\u5b9e\u8868\u4e0e\u7ef4\u5ea6\u8868","text":"<p>\u9700\u8981\u884c\u548c\u5217\u6765\u5b9a\u4f4d\u6570\u503c\u7684\uff0c\u5c31\u662f\u4e8c\u7ef4\u8868\uff1b\u4ec5\u9760\u5355\u884c\u5c31\u80fd\u9501\u5b9a\u5168\u90e8\u4fe1\u606f\u7684\uff0c\u5c31\u662f\u4e00\u7ef4\u8868\u3002</p> <ul> <li> <p>\u4e00\u7ef4\u8868\u79f0\u4e3a\u6e90\u6570\u636e\uff0c\u7279\u70b9\u662f\u6570\u636e\u4e30\u5bcc\u8be6\u5b9e\uff0c\u9002\u5408\u505a\u6d41\u6c34\u8d26\uff0c\u65b9\u4fbf\u5b58\u50a8\uff0c\u6709\u5229\u4e8e\u505a\u7edf\u8ba1\u5206\u6790\uff1b</p> </li> <li> <p>\u4e8c\u7ef4\u8868\u79f0\u4e3a\u5c55\u793a\u6570\u636e\uff0c\u7279\u70b9\u662f\u660e\u786e\u76f4\u89c2\uff0c\u9002\u5408\u6253\u5370\u3001\u6c47\u62a5</p> </li> </ul> <p>\u4e8b\u5b9e\u8868\uff1a\u8868\u683c\u91cc\u5b58\u50a8\u4e86\u80fd\u4f53\u73b0\u5b9e\u9645\u6570\u636e\u6216\u8be6\u7ec6\u6570\u503c\uff0c\u4e00\u822c\u7531\u7ef4\u5ea6\u7f16\u7801\u548c\u4e8b\u5b9e\u6570\u636e\u7ec4\u6210</p> <p>\u7ef4\u5ea6\u8868\uff1a\u8868\u683c\u91cc\u5b58\u653e\u4e86\u5177\u6709\u72ec\u7acb\u5c5e\u6027\u548c\u5c42\u6b21\u7ed3\u6784\u7684\u6570\u636e\uff0c\u4e00\u822c\u7531\u7ef4\u5ea6\u7f16\u7801\u548c\u5bf9\u5e94\u7684\u7ef4\u5ea6\u8bf4\u660e(\u6807\u7b7e)\u7ec4\u6210</p>"},{"location":"data_query/basic.html#_12","title":"\u661f\u578b\u6a21\u578b\u548c\u96ea\u82b1\u6a21\u578b","text":"<p>\u661f\u578b\u6a21\u578b\uff1a\u662f\u4e00\u79cd\u591a\u7ef4\u7684\u6570\u636e\u5173\u7cfb\uff0c\u5b83\u7531\u4e00\u4e2a\u4e8b\u5b9e\u8868\uff08Fact Table\uff09\u548c\u4e00\u7ec4\u7ef4\u8868\uff08Dimension Table\uff09\u7ec4\u6210</p> <ul> <li>\u6bcf\u4e2a\u7ef4\u8868\u90fd\u6709\u4e00\u4e2a\u7ef4\u4f5c\u4e3a\u4e3b\u952e\uff0c\u6240\u6709\u8fd9\u4e9b\u7ef4\u7684\u4e3b\u952e\u7ec4\u5408\u6210\u4e8b\u5b9e\u8868\u7684\u4e3b\u952e\uff1b</li> <li> <p>\u4e8b\u5b9e\u8868\u7684\u975e\u4e3b\u952e\u5c5e\u6027\u79f0\u4e3a\u4e8b\u5b9e\uff08Fact\uff09\uff0c\u5b83\u4eec\u4e00\u822c\u90fd\u662f\u6570\u503c\u6216\u5176\u4ed6\u53ef\u4ee5\u8fdb\u884c\u8ba1\u7b97\u7684\u6570\u636e\uff1b</p> </li> <li> <p>\u4e00\u79cd\u975e\u6b63\u89c4\u5316\u7684\u7ed3\u6784\uff0c\u591a\u7ef4\u6570\u636e\u96c6\u7684\u6bcf\u4e00\u4e2a\u7ef4\u5ea6\u90fd\u76f4\u63a5\u4e0e\u4e8b\u5b9e\u8868\u76f8\u8fde\u63a5\uff0c\u6240\u4ee5\u6570\u636e\u6709\u4e00\u5b9a\u7684\u5197\u4f59\u3002</p> </li> </ul> <p></p> <p>\u96ea\u82b1\u578b\u6a21\u578b\uff1a\u5f53\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u7ef4\u8868\u6ca1\u6709\u76f4\u63a5\u8fde\u63a5\u5230\u4e8b\u5b9e\u8868\u4e0a\uff0c\u800c\u662f\u901a\u8fc7\u5176\u4ed6\u7ef4\u8868\u8fde\u63a5\u5230\u4e8b\u5b9e\u8868\u4e0a\u65f6\uff0c\u5176\u56fe\u89e3\u5c31\u50cf\u591a\u4e2a\u96ea\u82b1\u8fde\u63a5\u5728\u4e00\u8d77\uff0c\u6545\u79f0\u96ea\u82b1\u6a21\u578b\u3002</p> <ul> <li>\u539f\u6709\u7684\u5404\u7ef4\u8868\u53ef\u80fd\u88ab\u6269\u5c55\u4e3a\u5c0f\u7684\u4e8b\u5b9e\u8868\uff0c\u5f62\u6210\u4e00\u4e9b\u5c40\u90e8\u7684 \"\u5c42\u6b21 \" \u533a\u57df\uff1b</li> <li>\u51cf\u5c11\u6570\u636e\u5b58\u50a8\u91cf\u4ee5\u53ca\u8054\u5408\u8f83\u5c0f\u7684\u7ef4\u8868\u6765\u6539\u5584\u67e5\u8be2\u6027\u80fd\uff0c\u96ea\u82b1\u578b\u7ed3\u6784\u53bb\u9664\u4e86\u6570\u636e\u5197\u4f59\u3002</li> </ul> <p></p> <p>\u5bf9\u6bd4\uff1a</p> <ul> <li>\u67e5\u8be2\u6027\u80fd\uff1a\u5728OLTP-DW\u73af\u8282\uff0c\u7531\u4e8e\u96ea\u82b1\u578b\u8981\u505a\u591a\u4e2a\u8868\u8054\u63a5\uff0c\u6027\u80fd\u4f1a\u4f4e\u4e8e\u661f\u578b\u67b6\u6784\uff1b\u4f46\u4eceDW-OLAP\u73af\u8282\uff0c\u7531\u4e8e\u96ea\u82b1\u578b\u67b6\u6784\u66f4\u6709\u5229\u4e8e\u5ea6\u91cf\u503c\u7684\u805a\u5408\uff0c\u56e0\u6b64\u6027\u80fd\u8981\u9ad8\u4e8e\u661f\u578b\u67b6\u6784\u3002</li> <li>\u6a21\u578b\u590d\u6742\u5ea6\uff1a\u661f\u578b\u67b6\u6784\u66f4\u7b80\u5355\u65b9\u4fbf\u5904\u7406</li> <li>\u5c42\u6b21\u7ed3\u6784\uff1a\u96ea\u82b1\u578b\u67b6\u6784\u66f4\u52a0\u8d34\u8fd1OLTP\u7cfb\u7edf\u7684\u7ed3\u6784\uff0c\u6bd4\u8f83\u7b26\u5408\u4e1a\u52a1\u903b\u8f91\uff0c\u5c42\u6b21\u6bd4\u8f83\u6e05\u6670\u3002</li> <li>\u5b58\u50a8\u89d2\u5ea6\uff1a\u96ea\u82b1\u578b\u67b6\u6784\u5177\u6709\u5173\u7cfb\u6570\u636e\u6a21\u578b\u7684\u6240\u6709\u4f18\u70b9\uff0c\u4e0d\u4f1a\u4ea7\u751f\u5197\u4f59\u6570\u636e\uff0c\u800c\u76f8\u6bd4\u4e4b\u4e0b\u661f\u578b\u67b6\u6784\u4f1a\u4ea7\u751f\u6570\u636e\u5197\u4f59\u3002</li> </ul> <p>\u6839\u636e\u9879\u76ee\u7ecf\u9a8c\uff0c\u4e00\u822c\u5efa\u8bae\u4f7f\u7528\u661f\u578b\u6a21\u578b\u3002\u56e0\u4e3a\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u5f80\u5f80\u6700\u5173\u6ce8\u7684\u662f\u67e5\u8be2\u6027\u80fd\u95ee\u9898\u3002</p>"},{"location":"data_query/basic.html#_13","title":"\u672f\u8bed","text":"<ul> <li>\u6570\u636e\u52a0\u8f7d\u5c42\uff1aETL\uff08Extract-Transform-Load\uff09</li> <li>\u6570\u636e\u8fd0\u8425\u5c42\uff1aODS\uff08Operational Data Store\uff09</li> <li> <p>\u6570\u636e\u4ed3\u5e93\u5c42\uff1aDW\uff08Data Warehouse\uff09</p> </li> <li> <p>\u6570\u636e\u660e\u7ec6\u5c42\uff1aDWD\uff08Data Warehouse Detail\uff09</p> </li> <li>\u6570\u636e\u4e2d\u95f4\u5c42\uff1aDWM\uff08Data WareHouse Middle\uff09    </li> <li>\u6570\u636e\u670d\u52a1\u5c42\uff1aDWS\uff08Data WareHouse Service\uff09</li> <li>\u6570\u636e\u5e94\u7528\u5c42\uff1aAPP\uff08Application\uff09</li> <li>\u7ef4\u8868\u5c42\uff1aDIM\uff08Dimension\uff09</li> </ul>"},{"location":"data_query/kylin.html","title":"Apache Kylin","text":"<p>\u200b    Kylin \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\u5927\u6570\u636e\u5206\u6790\u5f15\u64ce\uff0c\u63d0\u4f9b\u5728 Hadoop \u4e4b\u4e0a\u7684 SQL \u63a5\u53e3\u548c\u591a\u7ef4\u5206\u6790\u80fd\u529b\uff08OLAP\uff09\uff0c\u53ef\u4ee5\u505a\u5230\u5728 TB \u7ea7\u7684\u6570\u636e\u91cf\u4e0a\u5b9e\u73b0\u4e9a\u79d2\u7ea7\u7684\u67e5\u8be2\u54cd\u5e94\u3002 </p> <p></p> <p>\u200b   Kylin \u5229\u7528 MapReduce/Spark \u5c06\u539f\u59cb\u6570\u636e\u8fdb\u884c\u805a\u5408\u8ba1\u7b97\uff0c\u8f6c\u6210\u4e86 OLAP Cube \u5e76\u52a0\u8f7d\u5230 HBase \u4e2d\uff0c\u4ee5 Key-Value \u7684\u5f62\u5f0f\u5b58\u50a8\u3002 Cube \u6309\u7167\u65f6\u95f4\u8303\u56f4\u5212\u5206\u4e3a\u591a\u4e2a segment\uff0c\u6bcf\u4e2a segment \u662f\u4e00\u5f20 HBase \u8868 </p>"},{"location":"data_query/phoenix.html","title":"Apache Phoenix","text":"<p>Phoenix \u662f\u4e00\u4e2a Hadoop \u4e0a\u7684 OLTP \u548c\u4e1a\u52a1\u6570\u636e\u5206\u6790\u5f15\u64ce\uff0c\u4e3a\u7528\u6237\u63d0\u4f9b\u64cd\u4f5c HBase \u7684 SQL \u63a5\u53e3\uff0c\u7ed3\u5408\u4e86\u5177\u6709\u5b8c\u6574 ACID \u4e8b\u52a1\u529f\u80fd\u7684\u6807\u51c6 SQL \u548c JDBC API\uff0c\u4ee5\u53ca\u6765\u81ea NoSQL \u7684\u540e\u671f\u7ed1\u5b9a\uff0c\u5177\u6709\u8bfb\u53d6\u6a21\u5f0f\u7075\u6d3b\u7684\u4f18\u70b9\u3002</p> <p></p>"},{"location":"data_query/phoenix.html#_1","title":"\u7279\u6027","text":""},{"location":"data_query/phoenix.html#_2","title":"\u4e8c\u7ea7\u7d22\u5f15","text":""},{"location":"data_query/phoenix.html#_3","title":"\u8986\u76d6\u7d22\u5f15","text":"<p>\u8986\u76d6\u7d22\u5f15\u662f\u628a\u539f\u6570\u636e\u5b58\u50a8\u5728\u7d22\u5f15\u6570\u636e\u8868\u4e2d\uff0c\u8fd9\u6837\u5728\u67e5\u8be2\u65f6\u4e0d\u9700\u8981\u518d\u53bbHBase\u7684\u539f\u8868\u83b7\u53d6\u6570\u636e\u5c31\uff0c\u76f4\u63a5\u8fd4\u56de\u67e5\u8be2\u7ed3\u679c\u3002</p> <p>\u67e5\u8be2\u662f select \u7684\u5217\u548c where \u7684\u5217\u90fd\u9700\u8981\u5728\u7d22\u5f15\u4e2d\u51fa\u73b0\u3002</p> <pre><code>CREATE INDEX my_index ON my_table ( v2,v3 ) INCLUDE ( v1 );\n</code></pre>"},{"location":"data_query/phoenix.html#_4","title":"\u51fd\u6570\u7d22\u5f15","text":"<p>\u662f\u7d22\u5f15\u7684\u5185\u5bb9\u4e0d\u5c40\u9650\u4e8e\u5217\uff0c\u80fd\u6839\u636e\u8868\u8fbe\u5f0f\u521b\u5efa\u7d22\u5f15\u3002\u9002\u7528\u4e8e\u5bf9\u67e5\u8be2\u8868\u65f6\u8fc7\u6ee4\u6761\u4ef6\u662f\u8868\u8fbe\u5f0f\u3002\u5982\u679c\u4f60\u4f7f\u7528\u7684\u8868\u8fbe\u5f0f\u6b63\u597d\u5c31\u662f\u7d22\u5f15\u7684\u8bdd\uff0c\u6570\u636e\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4ece\u8fd9\u4e2a\u7d22\u5f15\u83b7\u53d6\uff0c\u800c\u4e0d\u9700\u8981\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u3002</p> <pre><code>CREATE INDEX my_index ON my_table(substr(v3,1,9)) INCLUDE ( v1 );\n</code></pre>"},{"location":"data_query/phoenix.html#_5","title":"\u5168\u5c40\u7d22\u5f15","text":"<p>\u5168\u5c40\u7d22\u5f15\u9002\u5408\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f\u3002\u5982\u679c\u4f7f\u7528\u5168\u5c40\u7d22\u5f15\uff0c\u8bfb\u6570\u636e\u57fa\u672c\u4e0d\u635f\u8017\u6027\u80fd\uff0c\u6240\u6709\u7684\u6027\u80fd\u635f\u8017\u90fd\u6765\u6e90\u4e8e\u5199\u6570\u636e\u3002</p> <p>\u6570\u636e\u8868\u7684\u6dfb\u52a0\u3001\u5220\u9664\u548c\u4fee\u6539\u90fd\u4f1a\u66f4\u65b0\u76f8\u5173\u7684\u7d22\u5f15\u8868\uff08\u6570\u636e\u5220\u9664\u4e86\uff0c\u7d22\u5f15\u8868\u4e2d\u7684\u6570\u636e\u4e5f\u4f1a\u5220\u9664\uff1b\u6570\u636e\u589e\u52a0\u4e86\uff0c\u7d22\u5f15\u8868\u7684\u6570\u636e\u4e5f\u4f1a\u589e\u52a0\uff09\u3002</p> <p>\u5bf9\u4e8e\u5168\u5c40\u7d22\u5f15\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728\u67e5\u8be2\u8bed\u53e5\u4e2d\u68c0\u7d22\u7684\u5217\u5982\u679c\u4e0d\u5728\u7d22\u5f15\u8868\u4e2d\uff0cPhoenix\u4e0d\u4f1a\u4f7f\u7528\u7d22\u5f15\u8868\uff0c\u9664\u975e\u4f7f\u7528hint\u3002</p> <pre><code>CREATE INDEX my_index ON my_table ( v3 );\n</code></pre>"},{"location":"data_query/phoenix.html#_6","title":"\u672c\u5730\u7d22\u5f15","text":"<p>\u9002\u5408\u5199\u591a\u8bfb\u5c11\u7684\u573a\u666f\uff0c\u6216\u8005\u5b58\u50a8\u7a7a\u95f4\u6709\u9650\u7684\u573a\u666f\u3002\u548c\u5168\u5c40\u7d22\u5f15\u4e00\u6837\uff0cPhoenix\u4e5f\u4f1a\u5728\u67e5\u8be2\u7684\u65f6\u5019\u81ea\u52a8\u9009\u62e9\u662f\u5426\u4f7f\u7528\u672c\u5730\u7d22\u5f15\u3002</p> <p>\u672c\u5730\u7d22\u5f15\u56e0\u4e3a\u7d22\u5f15\u6570\u636e\u548c\u539f\u6570\u636e\u5b58\u50a8\u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\uff08\u6570\u636e\u8868\u7684\u5f71\u5b50(shadow)\u5217\u65cf\uff09\uff0c\u907f\u514d\u7f51\u7edc\u6570\u636e\u4f20\u8f93\u7684\u5f00\u9500\uff0c\u6240\u4ee5\u66f4\u9002\u5408\u5199\u591a\u7684\u573a\u666f\u3002</p> <p>\u65e0\u6cd5\u63d0\u524d\u786e\u5b9a\u6570\u636e\u5728\u54ea\u4e2aRegion\u4e0a\uff0c\u6240\u4ee5\u5728\u8bfb\u6570\u636e\u7684\u65f6\u5019\uff0c\u9700\u8981\u68c0\u67e5\u6bcf\u4e2aRegion\u4e0a\u7684\u6570\u636e\u4ece\u800c\u5e26\u6765\u4e00\u4e9b\u6027\u80fd\u635f\u8017\u3002</p> <pre><code>CREATE LOCAL INDEX LOCAL_IDEX ON my_table(v3);\n</code></pre>"},{"location":"data_query/phoenix.html#_7","title":"\u7d22\u5f15\u6784\u5efa","text":""},{"location":"data_query/phoenix.html#_8","title":"\u540c\u6b65\u7d22\u5f15","text":"<pre><code>CREATE INDEX SYNC_IDX ON SCHEMA_NAME.TABLE_NAME(BASICINFO.\"s1\",BASICINFO.\"s2\") ;\n</code></pre> <p>\u521b\u5efa\u540c\u6b65\u7d22\u5f15\u8d85\u65f6\u600e\u4e48\u529e\uff1f</p> <p>\u5728\u5ba2\u6237\u7aef\u914d\u7f6e\u6587\u4ef6hbase-site.xml\u4e2d\uff0c\u628a\u8d85\u65f6\u53c2\u6570\u8bbe\u7f6e\u5927\u4e00\u4e9b\uff0c\u8db3\u591f Build \u7d22\u5f15\u6570\u636e\u7684\u65f6\u95f4\u3002</p> <pre><code>&lt;property&gt;\n    &lt;name&gt;hbase.rpc.timeout&lt;/name&gt;\n    &lt;value&gt;60000000&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n    &lt;name&gt;hbase.client.scanner.timeout.period&lt;/name&gt;\n    &lt;value&gt;60000000&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n    &lt;name&gt;phoenix.query.timeoutMs&lt;/name&gt;\n    &lt;value&gt;60000000&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"data_query/phoenix.html#_9","title":"\u5f02\u6b65\u7d22\u5f15","text":"<p>\u5f02\u6b65Build\u7d22\u5f15\u9700\u8981\u501f\u52a9MapReduce\uff0c\u521b\u5efa\u5f02\u6b65\u7d22\u5f15\u8bed\u6cd5\u548c\u540c\u6b65\u7d22\u5f15\u76f8\u5dee\u4e00\u4e2a\u5173\u952e\u5b57\uff1aASYNC\u3002</p> <pre><code>CREATE INDEX ASYNC_IDX ON SCHEMA_NAME.TABLE_NAME ( BASICINFO.\"s1\", BASICINFO.\"s2\" ) ASYNC;\n</code></pre> <p>\u6267\u884cMR\uff1a</p> <pre><code>hbase org.apache.phoenix.mapreduce.index.IndexTool \\\n--schema SCHEMA_NAME\\\n--data-table TABLE_NAME\\\n--index-table ASYNC_IDX \\\n--output-path ASYNC_IDX_HFILES\n</code></pre>"},{"location":"data_query/phoenix.html#kylin-vs-phoenix","title":"Kylin VS Phoenix","text":"<p>\u6211\u4eec\u5148\u6765\u770b\u770b Kylin \u548c Phoenix \u5404\u81ea\u7684\u4f18\u70b9\u662f\u4ec0\u4e48\u3002Kylin \u7684\u4f18\u70b9\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u70b9\uff1a</p> <ol> <li> <p>\u652f\u6301\u96ea\u82b1/\u661f\u578b\u6a21\u578b\uff1b</p> </li> <li> <p>\u4e9a\u79d2\u7ea7\u67e5\u8be2\u54cd\u5e94\uff1b</p> </li> <li> <p>\u652f\u6301 ANSI-SQL\uff0c\u53ef\u901a\u8fc7 ODBC\uff0cJDBC \u4ee5\u53ca RESTful API \u8fdb\u884c\u8bbf\u95ee\uff1b</p> </li> <li> <p>\u652f\u6301\u767e\u4ebf\u3001\u5343\u4ebf\u751a\u81f3\u4e07\u4ebf\u7ea7\u522b\u4ea4\u4e92\u5f0f\u5206\u6790\uff1b</p> </li> <li> <p>\u65e0\u7f1d\u4e0e BI \u5de5\u5177\u96c6\u6210\uff1b</p> </li> <li> <p>\u652f\u6301\u589e\u91cf\u5237\u65b0\uff1b</p> </li> <li> <p>\u65e2\u652f\u6301\u5386\u53f2\u6570\u636e\u4e5f\u652f\u6301\u6d41\u5f0f\u6570\u636e\uff1b</p> </li> <li> <p>\u6613\u7528\u7684\u7ba1\u7406\u9875\u9762\u548c API\u3002</p> </li> </ol> <p>Phoenix \u7684\u4f18\u70b9\u5219\u4e3b\u8981\u662f\u4ee5\u4e0b\u51e0\u70b9\uff1a</p> <ol> <li> <p>\u652f\u6301\u660e\u7ec6\u548c\u805a\u5408\u67e5\u8be2\uff1b</p> </li> <li> <p>\u652f\u6301 insert\uff0cupdate\uff0cdelete \u64cd\u4f5c\uff0c\u5176\u4f7f\u7528 upsert \u6765\u4ee3\u66ff insert \u548c update\uff1b</p> </li> <li> <p>\u8f83\u597d\u7684\u5229\u7528 HBase \u7684\u4f18\u70b9\uff0c\u5982 row timestamp\uff0c\u5c06\u5176\u4e0e HBase \u539f\u751f\u7684 row timestamp \u6620\u5c04\u8d77\u6765\uff0c\u6709\u52a9\u4e8e Phoenix \u5229\u7528 HBase \u9488\u5bf9\u5b58\u50a8\u6587\u4ef6\u7684\u65f6\u95f4\u8303\u56f4\u63d0\u4f9b\u7684\u591a\u79cd\u4f18\u5316\u548c Phoenix \u5185\u7f6e\u7684\u5404\u5f0f\u5404\u6837\u7684\u67e5\u8be2\u4f18\u5316\uff1b</p> </li> <li> <p>\u652f\u6301\u591a\u79cd\u51fd\u6570\uff1a\u805a\u5408\u3001String\u3001\u65f6\u95f4\u548c\u65e5\u671f\u3001\u6570\u5b57\u3001\u6570\u7ec4\u3001\u6570\u5b66\u548c\u5176\u5b83\u51fd\u6570\uff1b</p> </li> <li> <p>\u652f\u6301\u5177\u6709\u5b8c\u6574 ACID \u8bed\u4e49\u7684\u8de8\u884c\u53ca\u8de8\u8868\u4e8b\u52a1\uff1b</p> </li> <li> <p>\u652f\u6301\u591a\u79df\u6237\uff1b</p> </li> <li> <p>\u652f\u6301\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\uff0c\u6e38\u6807\u3002</p> </li> </ol> <p>\u5f53\u7136\uff0cKylin \u548c Phoenix \u4e5f\u90fd\u6709\u4e00\u4e9b\u8fd8\u6709\u5f85\u63d0\u5347\u7684\u4e0d\u8db3\u4e4b\u5904\uff0cKylin \u7684\u4e0d\u8db3\u4e3b\u8981\u662f\u4f53\u73b0\u5728\u9996\u5148\u7531\u4e8e Kylin \u662f\u4e00\u4e2a\u5206\u6790\u5f15\u64ce\uff0c\u53ea\u8bfb\uff0c\u4e0d\u652f\u6301 insert, update, delete \u7b49 SQL \u64cd\u4f5c\uff0c\u7528\u6237\u4fee\u6539\u6570\u636e\u7684\u8bdd\u9700\u8981\u91cd\u65b0\u6279\u91cf\u5bfc\u5165\uff08\u6784\u5efa\uff09\uff1b\u5176\u6b21\uff0cKylin \u7528\u6237\u9700\u8981\u9884\u5148\u5efa\u7acb\u6a21\u578b\u540e\u52a0\u8f7d\u6570\u636e\u5230 Cube \u540e\u624d\u53ef\u8fdb\u884c\u67e5\u8be2\uff1b\u6700\u540e\uff0c\u4f7f\u7528 Kylin \u7684\u5efa\u6a21\u4eba\u5458\u9700\u8981\u4e86\u89e3\u4e00\u5b9a\u7684\u6570\u636e\u4ed3\u5e93\u77e5\u8bc6\u3002</p> <p>Phoenix \u7684\u4e0d\u8db3\u5219\u4e3b\u8981\u4f53\u73b0\u5728\uff1a\u9996\u5148\uff0c\u5176\u4e8c\u7ea7\u7d22\u5f15\u7684\u4f7f\u7528\u6709\u4e00\u5b9a\u7684\u9650\u5236\uff0c\u53ea\u6709\u5f53\u67e5\u8be2\u4e2d\u6240\u6709\u7684\u5217\u90fd\u5728\u7d22\u5f15\u6216\u8986\u76d6\u7d22\u5f15\u4e2d\u624d\u751f\u6548\u4e14\u6210\u672c\u8f83\u9ad8\uff0c\u5728\u4f7f\u7528\u4e4b\u524d\u8fd8\u9700\u914d\u7f6e\uff1b\u5176\u6b21\uff0c\u8303\u56f4\u626b\u63cf\u7684\u4f7f\u7528\u6709\u4e00\u5b9a\u7684\u9650\u5236\uff0c\u53ea\u6709\u5f53\u4f7f\u7528\u4e86\u4e0d\u5c11\u4e8e\u4e00\u4e2a\u5728\u4e3b\u952e\u7ea6\u675f\u4e2d\u7684\u5148\u5bfc\u5217\u65f6\u624d\u751f\u6548\uff1b\u6700\u540e\uff0c\u521b\u5efa\u8868\u65f6\u5fc5\u987b\u5305\u542b\u4e3b\u952e \uff0c\u5bf9\u522b\u540d\u652f\u6301\u4e0d\u53cb\u597d\u3002</p>"},{"location":"data_query/sql_compare.html","title":"SQL Compare","text":""},{"location":"data_query/sql_compare.html#2020819","title":"\u5bf9\u6bd4\u8868 2020/8/19","text":"SQL\u5f15\u64ce\\\u6307\u6807 SQL\u8bed\u53e5 \u9002\u7528\u8303\u56f4 \u6700\u8fd1\u7248\u672c(Release) \u6570\u636e\u6e90 \u6570\u636e\u89c4\u6a21 \u5907\u6ce8 Hive HiveQL OLAP HDFS Spark SQL OLAP Presto ANSI SQL OLAP Hive/Kafka/RDBMS Impala OLAP HDFS/HBase/Kudu HAWQ ANSI SQL OLAP\uff0c\u4e8b\u52a1ACID 2018/9 HDFS Greenplum \u57fa\u4e8ePostgreSQL OLAP 2020/8 \u81ea\u5b9a\u4e49 Doris MySQL OLAP \u81ea\u5b9a\u4e49 ClickHouse OLAP \u81ea\u5b9a\u4e49 Kylin OLAP \u6570\u636e\u9884\u805a\u5408 Phoenix 2019/12 Cassandra OLAP Ignite HTAP 2020/5 \u5206\u5e03\u5f0f\u5185\u5b58\u8ba1\u7b97\u5e73\u53f0 Mongodb TiDB MySQL HTAP \u81ea\u5b9a\u4e49 Calcite OLAP Drill OLAP Druid OLAP \u81ea\u5b9a\u4e49 Gobblin <p>\u5f00\u6e90OLAP\u5f15\u64ce\u6d4b\u8bc4\u62a5\u544a</p> <p>\u91c7\u7528 TPC-DS</p> <ul> <li>\u751f\u6210\u6570\u636e\uff0cdsdgen\u751f\u6210\uff0chive-testbench\u91c7\u7528mapreduce\u5206\u5e03\u5f0f\u751f\u6210\u5230hdfs\u4e2d\uff1b</li> <li>\u9002\u914d TPC-DS \u7684SQL\uff0cdsqgen\u53ef\u4ee5\u751f\u6210\u5efa\u8868\u548c\u67e5\u8be2\u7684SQL\uff0c\u4f46\u662f\u8981\u6839\u636e\u6570\u636e\u5e93\u8fdb\u884c\u9002\u914d\uff1b</li> <li>hive-testbench\u5305\u542bHive\u548cSparkSQK\u768499\u6761SQL\uff1b</li> <li>impala\u768499\u6761SQL -- https://github.com/fayson/cdhproject/tree/master/impala-tpcds</li> </ul>"},{"location":"data_query/sql_compare.html#mpp","title":"MPP","text":"<p>\u5bf9\u4e8eMPP\u67b6\u6784\u6765\u8bf4\uff0c\u56e0\u4e3atask\u548cExecutor\u662f\u7ed1\u5b9a\u7684\uff0c\u5982\u679c\u67d0\u4e2aExecutor\u6267\u884c\u8fc7\u6162\u6216\u6545\u969c\uff0c\u5c06\u4f1a\u5bfc\u81f4\u6574\u4e2a\u96c6\u7fa4\u7684\u6027\u80fd\u5c31\u4f1a\u53d7\u9650\u4e8e\u8fd9\u4e2a\u6545\u969c\u8282\u70b9\u7684\u6267\u884c\u901f\u5ea6(\u6240\u8c13\u6728\u6876\u7684\u77ed\u677f\u6548\u5e94)\uff0c\u6240\u4ee5MPP\u67b6\u6784\u7684\u6700\u5927\u7f3a\u9677\u5c31\u662f\u2014\u2014\u77ed\u677f\u6548\u5e94\u3002\u53e6\u4e00\u70b9\uff0c\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u8d8a\u591a\uff0c\u5219\u67d0\u4e2a\u8282\u70b9\u51fa\u73b0\u95ee\u9898\u7684\u6982\u7387\u8d8a\u5927\uff0c\u800c\u4e00\u65e6\u6709\u8282\u70b9\u51fa\u73b0\u95ee\u9898\uff0c\u5bf9\u4e8eMPP\u67b6\u6784\u6765\u8bf4\uff0c\u5c06\u5bfc\u81f4\u6574\u4e2a\u96c6\u7fa4\u6027\u80fd\u53d7\u9650\uff0c\u6240\u4ee5\u4e00\u822c\u5b9e\u9645\u751f\u4ea7\u4e2dMPP\u67b6\u6784\u7684\u96c6\u7fa4\u8282\u70b9\u4e0d\u6613\u8fc7\u591a\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\u6765\u8bf4\u4e0b\u4e24\u79cd\u67b6\u6784\u7684\u6570\u636e\u843d\u76d8\uff1a\u8981\u5b9e\u73b0\u4e24\u4e2a\u5927\u8868\u7684join\u64cd\u4f5c\uff0c\u5bf9\u4e8e\u6279\u5904\u7406\u800c\u8a00\uff0c\u5982Spark\u5c06\u4f1a\u5199\u78c1\u76d8\u4e09\u6b21(\u7b2c\u4e00\u6b21\u5199\u5165\uff1a\u88681\u6839\u636e<code>join key</code>\u8fdb\u884cshuffle\uff1b\u7b2c\u4e8c\u6b21\u5199\u5165\uff1a\u88682\u6839\u636e<code>join key</code>\u8fdb\u884cshuffle\uff1b\u7b2c\u4e09\u6b21\u5199\u5165\uff1aHash\u8868\u5199\u5165\u78c1\u76d8)\uff0c \u800cMPP\u53ea\u9700\u8981\u4e00\u6b21\u5199\u5165(Hash\u8868\u5199\u5165)\u3002\u8fd9\u662f\u56e0\u4e3aMPP\u5c06mapper\u548creducer\u540c\u65f6\u8fd0\u884c\uff0c\u800cMapReduce\u5c06\u5b83\u4eec\u5206\u6210\u6709\u4f9d\u8d56\u5173\u7cfb\u7684tasks(DAG)\uff0ctask\u95f4\u662f\u987a\u5e8f\u6267\u884c\u7684\uff0c\u56e0\u6b64\u5fc5\u987b\u901a\u8fc7\u5199\u5165\u4e2d\u95f4\u6570\u636e\u5171\u4eab\u5185\u5b58\u6765\u89e3\u51b3\u6570\u636e\u7684\u4f9d\u8d56\u3002</p>"},{"location":"data_query/tech_report.html","title":"\u674e\u98de\u98de\u62a5\u544a-\u6570\u636e\u5e93","text":""},{"location":"data_query/tech_report.html#_1","title":"\u4e91\u539f\u751f\u5206\u5e03\u5f0f\u6570\u636e\u5e93\u7cfb\u7edf\u7684\u53d1\u5c55\u5386\u7a0b","text":"<p>\u7ed3\u6784\u5316\u6570\u636e\u5728\u7ebf\u5904\u7406\uff1aRDBMS(SQL + OLTP)</p> <p>\u6d77\u91cf\u6570\u636e\u5206\u6790\uff1aData Warehouse(ETL + OLAP)</p> <p>\u5f02\u6784\u6570\u636e\u7c7b\u578b\uff1a\uff08Multi-Model + HTAP)</p> <p>\u6570\u636e\u5e93\u53d1\u5c55-\u4e1a\u52a1\u89c6\u89d2</p> <ul> <li>\u4e8b\u52a1\u6027\u6570\u636e\u5e93(OLTP\uff09</li> <li>\u7ed3\u6784\u5316\u6570\u636e\u5e93\uff0c\u9ad8\u5e76\u53d1\u3001\u9ad8\u53ef\u7528\u3001\u5f3a\u4e00\u81f4\u6027</li> <li>NoSQL\u6570\u636e\u5e93\u53ca\u4e13\u7528\u578b\u6570\u636e\u5e93</li> <li>\u7ed3\u6784\u5316\u6216\u534a\u7ed3\u6784\u5316\uff0c\u4e0d\u5f3a\u5236\u6570\u636e\u4e00\u81f4\u6027</li> <li>\u5206\u6790\u578b\u6570\u636e\u5e93\uff08OLAP\uff09</li> <li>\u6d77\u91cf\u6570\u636e\uff0c\u6570\u636e\u7c7b\u578b\u590d\u6742\uff1b\u5206\u6790\u6761\u4ef6\u590d\u6742\uff1b</li> <li>\u6570\u636e\u5e93\u670d\u52a1+\u7ba1\u7406\u7c7b\u5de5\u5177</li> <li>\u6570\u636e\u4f20\u8f93\u3001\u5907\u4efd</li> <li>\u6570\u636e\u5e93\u7ba1\u63a7\u5e73\u53f0</li> <li>\u5b9e\u4f8b\u3001\u8d44\u7ba1\u7ba1\u7406\u548c\u8c03\u5ea6</li> </ul>"},{"location":"data_query/tech_report.html#_2","title":"\u6570\u636e\u5e93\u7cfb\u7edf\u67b6\u6784","text":""},{"location":"data_query/tech_report.html#_3","title":"\u6570\u636e\u5e93\u7cfb\u7edf\u7684\u6a21\u5757","text":"<p>\u5e94\u7528\u63a5\u53e3</p> <p>SQL\u63a5\u53e3</p> <p>\u67e5\u8be2\u6267\u884c\u5f15\u64ce</p> <ul> <li>\u8ba1\u5212\u751f\u6210\u5668</li> <li>\u8ba1\u5212\u4f18\u5316\u5668</li> <li>\u8ba1\u5212\u6267\u884c\u5668</li> </ul> <p>\u6570\u636e\u8bbf\u95ee\u6a21\u5757</p> <ul> <li>\u4e8b\u52a1\u5904\u7406\uff1a\u5d29\u6e83\u6062\u590d\u3001\u5e76\u53d1\u63a7\u5236</li> <li>\u5185\u5b58\u5904\u7406</li> <li>\u5b89\u5168\u7ba1\u7406</li> <li>\u6587\u4ef6\u548c\u7d22\u5f15\u7ba1\u7406</li> </ul> <p>\u5b58\u50a8\u5f15\u64ce</p> <ul> <li>\u6570\u636e\u6587\u4ef6</li> <li>\u7d22\u5f15\u6587\u4ef6</li> <li>\u7cfb\u7edf\u53ca\u5143\u6570\u636e\u6587\u4ef6</li> </ul>"},{"location":"data_query/tech_report.html#_4","title":"\u6570\u636e\u5e93\u7cfb\u7edf\u6311\u6218","text":"<p>\u5e76\u884c\u51b2\u7a81\uff08concurrent with\uff09</p> <ul> <li>\u8bfb/\u5199\u51b2\u7a81</li> </ul> <p>\u7cfb\u5217SQL</p> <ul> <li>\u4e2d\u9014\u5931\u8d25\uff0c\u8282\u70b9\u5b95\u673a</li> </ul> <p>\u4e8b\u52a1\u673a\u5236\uff1a</p> <ul> <li>Atomicity</li> <li>Consistency</li> <li>Isolation</li> <li>Durablility</li> </ul> <p>\u591a\u8868join\u6027\u80fd</p>"},{"location":"data_query/tech_report.html#_5","title":"\u9762\u5411\u672a\u6765\u7684\u4e91\u539f\u751f\u6570\u636e\u5e93","text":"<p>\u5f39\u6027-\u9ad8\u53ef\u7528</p> <p>\u7ba1\u63a7\u5e73\u53f0</p>"},{"location":"data_query/tech_report.html#vs","title":"\u884c\u5b58\u50a8 VS \u5217\u5b58\u50a8","text":"<p>OLTP\uff1a\u884c\u5b58\u50a8</p> <p>OLAP\uff1a\u5217\u5b58\u50a8 </p>"},{"location":"data_query/tech_report.html#htap","title":"HTAP\uff1a\u4e8b\u52a1\u5904\u7406\u4e0e\u5206\u6790\u5904\u7406\u4e00\u4f53\u5316","text":"<p>\u6570\u636e\u4e00\u81f4\u6027\u6311\u6218</p>"},{"location":"data_query/tech_report.html#htap_1","title":"\u4e0b\u4e00\u4ee3\u4f01\u4e1a\u7ea7\u6570\u636e\u5e93\uff1a\u4e91\u539f\u751f + \u5206\u5e03\u5f0f + HTAP","text":""},{"location":"data_query/tech_report.html#polardb","title":"PolarDB\uff1a\u5171\u4eab\u5b58\u50a8+\u4e00\u5199\u591a\u8bfb","text":""},{"location":"data_query/tech_report.html#polardb-x-htap","title":"PolarDB-X: \u5206\u5e03\u5f0f\u7248\u672c\u652f\u6301\u6c34\u5e73\u62d3\u5c55+HTAP","text":"<p>SQL\u5f15\u64ce\uff08DRDS\uff09</p> <p></p> <p>\u5b58\u50a8\u5f15\u64ce\uff08X-Engine\uff09</p> <p></p> <p>\u8de8AZ\uff1a\u4e3bAZ\u91c7\u7528\u4e09\u526f\u672c\uff0c\u526fAZ\u91c7\u7528\u65e5\u5fd7\u540c\u6b65\uff08\u89e3\u6790binlog\u683c\u5f0f\uff0c\u4f20\u8f93\u518dreplay\uff09\u3002</p> <p>\u6570\u636e\u4ed3\u5e93\uff1a\u5143\u6570\u636e\u7ba1\u7406+\u5b58\u50a8\u5f15\u64ce</p> <ul> <li>AnalyticDB</li> </ul> <p>\u6570\u636e\u6e56\uff1a\u5143\u6570\u636e\u7ba1\u7406\uff0c\u4e0d\u72ec\u7acb\u5b58\u50a8\u6570\u636e</p> <ul> <li>Presto\uff0cSpark SQL</li> </ul> <p></p> <p>\u6570\u636e\u5e93\u8fc1\u79fb</p> <p></p> <p>\u963f\u91cc\u7684\u6570\u636e\u5e93</p> <p></p>"},{"location":"data_query/transcation.html","title":"\u4e8b\u52a1","text":""},{"location":"data_query/transcation.html#_2","title":"\u9501\u673a\u5236","text":"<p>\u5728\u5199\u5165\u6570\u636e\u5e93\u7684\u65f6\u5019\u9700\u8981\u6709\u9501\uff0c\u6bd4\u5982\u540c\u65f6\u5199\u5165\u6570\u636e\u5e93\u7684\u65f6\u5019\u4f1a\u51fa\u73b0\u4e22\u6570\u636e\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u9501\u673a\u5236\u3002</p>"},{"location":"data_query/transcation.html#_3","title":"\u4e50\u89c2\u9501","text":"<p>CAS + \u7248\u672c\u53f7</p> <ul> <li>CAS \u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u540c\u4e00\u65f6\u95f4\u7684\u66f4\u6539\u53ea\u6709\u4e00\u4e2a\u751f\u6548</li> </ul> <p>\u9002\u7528\u4e8e\u5199\u5c11\u8bfb\u591a\uff0c\u91c7\u7528\u7248\u672c\u53f7\u7684\u65b9\u5f0f\uff0c\u5373\u5f53\u524d\u7248\u672c\u53f7\u5982\u679c\u5bf9\u5e94\u4e0a\u4e86\u5c31\u53ef\u4ee5\u5199\u5165\u6570\u636e\uff0c\u5982\u679c\u5224\u65ad\u5f53\u524d\u7248\u672c\u53f7\u4e0d\u4e00\u81f4\uff0c\u90a3\u4e48\u5c31\u4e0d\u4f1a\u66f4\u65b0\u6210\u529f</p> <pre><code># \u540c\u6837\u7684\u8bed\u53e5\u5e76\u53d1\u6267\u884c\u4e0d\u4f1a\u6267\u884c\nupdate goods set num = num - 1, version = version - 1 where id = 1 and version = 0;\n</code></pre>"},{"location":"data_query/transcation.html#_4","title":"\u60b2\u89c2\u9501","text":"<p>\u9002\u7528\u4e8e\u5199\u591a\u8bfb\u5c11\u3002</p> <pre><code># \u6392\u5b83\u9501\uff0c\u5176\u5b83\u4e8b\u52a1\u4e0d\u53ef\u8bfb\u5199\nselect num from goods where id = 1 for update;\nupdate goods set num=num-1 where id = 1;\n</code></pre>"},{"location":"data_query/calcite/calcite.html","title":"Apache Calcite","text":"<p>Apache Calcite : A Foundational Framework for Optimized Query Processing Over Heterogeneous Data Sources\uff08\u4e00\u4e2a\u7528\u4e8e\u4f18\u5316\u5f02\u6784\u6570\u636e\u6e90\u7684\u67e5\u8be2\u5904\u7406\u7684\u57fa\u7840\u6846\u67b6\uff09</p> <p>\u63d0\u4f9b\u4e86OLAP\u548c\u6d41\u5904\u7406\u7684\u67e5\u8be2\u5f15\u64ce\uff0c\u652f\u6301\u5f02\u6784\u6570\u636e\u6e90\u67e5\u8be2</p> <ul> <li>SQL \u89e3\u6790\u5668\u3001\u9a8c\u8bc1\u5668\u548c JDBC \u9a71\u52a8\uff1b</li> <li>\u67e5\u8be2\u4f18\u5316\u5de5\u5177\uff0c\u5305\u62ec\u5173\u7cfb\u4ee3\u6570API\uff0c\u57fa\u4e8e\u89c4\u5219\u7684\u8ba1\u5212\u5668\u548c\u57fa\u4e8e\u6210\u672c\u7684\u67e5\u8be2\u4f18\u5316\u5668\uff1b</li> <li>\u4e0d\u5305\u62ec\u6570\u636e\u5904\u7406\u3001\u6570\u636e\u5b58\u50a8\u7b49 DBMS \u7684\u6838\u5fc3\u529f\u80fd\uff1b</li> </ul> <p>Apache Hive \u4f7f\u7528 Calcite \u8fdb\u884c\u57fa\u4e8e\u6210\u672c\u7684\u67e5\u8be2\u4f18\u5316\uff0c\u800cApache Drill \u548cApache Kylin \u4f7f\u7528SQL \u89e3\u6790\u5668\u3002</p>"},{"location":"data_query/calcite/calcite.html#_1","title":"\u8d77\u6e90","text":"<p>\u4e00\u4e2a\u7528\u4e8e\u4f18\u5316\u5f02\u6784\u6570\u636e\u6e90\u7684\u67e5\u8be2\u5904\u7406\u7684\u57fa\u7840\u6846\u67b6\u3002</p> <p>Calcite \u4e4b\u524d\u53eb\u505a optiq\uff1a</p> <ul> <li> <p>optiq \u8d77\u521d\u7528\u4e8e Apache Hive \u9879\u76ee\u4e2d\uff0c\u4e3a Hive \u63d0\u4f9b\u57fa\u4e8e\u6210\u672c\u6a21\u578b\u7684\u4f18\u5316\uff0c\u5373CBO\uff08cost based optimizations\uff09\uff1b</p> </li> <li> <p>2014 \u5e74 5 \u6708 optiq \u72ec\u7acb\u51fa\u6765\uff0c\u6210\u4e3a Apache \u793e\u533a\u7684\u5b75\u5316\u9879\u76ee\uff0c2014 \u5e74 9 \u6708\u6b63\u5f0f\u66f4\u540d\u4e3a Calcite\u3002</p> </li> </ul> <p>\u8be5\u9879\u76ee\u7684\u76ee\u6807\u662f one size fits all\uff08\u4e00\u79cd\u65b9\u6848\u9002\u5e94\u6240\u6709\u9700\u6c42\u573a\u666f\uff09\uff0c\u5e0c\u671b\u80fd\u4e3a\u4e0d\u540c\u8ba1\u7b97\u5e73\u53f0\u548c\u6570\u636e\u6e90\u63d0\u4f9b\u7edf\u4e00\u7684\u67e5\u8be2\u5f15\u64ce\u3002</p>"},{"location":"data_query/calcite/calcite.html#_2","title":"\u80cc\u666f","text":"<p>\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u5206\u4e3a\u4ee5\u4e0b\u4e94\u90e8\u5206\uff0c\u5176\u4e2d\u524d\u4e09\u90e8\u5206\u662fCalcite\u8d1f\u8d23\u7684\u90e8\u5206\uff0c\u540e\u4e24\u90e8\u5206\u63d0\u4f9b\u9002\u914d\u5668\u53ef\u96c6\u6210\uff1a</p> <ul> <li>\u67e5\u8be2\u8bed\u8a00</li> <li>\u67e5\u8be2\u4f18\u5316\u5668</li> <li>\u67e5\u8be2\u6267\u884c</li> <li>\u6570\u636e\u7ba1\u7406</li> <li>\u6570\u636e\u5b58\u50a8</li> </ul> <p>Apache Calcite \u4e3a\u8bb8\u591a\u6d41\u884c\u7684\u5f00\u6e90\u6570\u636e\u5904\u7406\u7cfb\u7edf(\u5982Apache Hive\u3001Apache Storm\u3001Apache Flink\u3001Druid\u548cMapD)\u63d0\u4f9b\u67e5\u8be2\u5904\u7406\u3001\u4f18\u5316\u548c\u67e5\u8be2\u8bed\u8a00\u652f\u6301\u3002</p> <ul> <li>\u652f\u6301\u591a\u79cd\u6570\u636e\u6a21\u578b\uff1a\u6d41\u5f0f\u3001\u6279\u5f0f\u6570\u636e\uff1b</li> <li>\u8de8\u5e73\u53f0\u652f\u6301\uff0c\u67e5\u8be2\u4f18\u5316\u7075\u6d3b\u3001\u53ef\u6269\u5c55\uff1b</li> <li>\u652f\u6301ANSI SQL\u53ca\u5176\u6269\u5c55\uff1b</li> <li>\u652f\u6301SQL\u89e3\u6790\u4e3a\u5173\u7cfb\u7b97\u5b50\u6811\uff0c\u5e76\u5c06\u4f18\u5316\u540e\u7684\u6811\u7ffb\u8bd1\u56deSQL\uff1b</li> </ul> <p>\u4e0d\u8d1f\u8d23\uff1a</p> <ul> <li>\u6570\u636e\u5b58\u50a8\u3001\u5904\u7406\u6570\u636e\u7684\u7b97\u6cd5\u3001\u5143\u6570\u636e\u5b58\u50a8</li> </ul> <p>\u4ea7\u751f\u80cc\u666f\uff1a</p> <ul> <li>\u5206\u5e03\u5f0f\u8ba1\u7b97\u4ea7\u54c1\u9700\u8981\u7c7b\u4f3c SQL \u89e3\u6790\u3001\u6267\u884c\u7684\u529f\u80fd\uff0c\u4e00\u6761SQL\u80fd\u591f\u88ab\u89e3\u6790\u6210\u591a\u4e2a\u8bed\u6cd5\u6811\uff0c\u9700\u8981\u8fdb\u884c\u4f18\u5316\uff1b</li> <li>\u5927\u6570\u636e\u5904\u7406\u4e2d\u7684\u6279\u91cf\u8ba1\u7b97\u3001\u6d41\u8ba1\u7b97\u3001\u4ea4\u4e92\u67e5\u8be2\u7b49\u9886\u57df\u90fd\u4f1a\u5b58\u5728\u4e00\u4e9b\u5171\u6027\u95ee\u9898\uff1b</li> <li>\u591a\u79cd\u5f02\u6784\u6570\u636e\u6e90\u9700\u8981\u6574\u5408\uff0c\u5b58\u5728\u8de8\u5e73\u53f0\u7684\u67e5\u8be2\u8bed\u53e5\u5206\u53d1\u53ca\u6267\u884c\u4f18\u5316\u7b49\u8bfe\u9898\uff1b</li> </ul>"},{"location":"data_query/calcite/calcite.html#_3","title":"\u67b6\u6784","text":"<ul> <li>JDBC client \u8868\u793a\u5916\u90e8\u7684\u5e94\u7528\uff0c\u8bbf\u95ee\u65f6\u4e00\u822c\u4f1a\u4ee5 SQL \u8bed\u53e5\u7684\u5f62\u5f0f\u8f93\u5165\uff0c\u901a\u8fc7 JDBC Client \u8bbf\u95ee Calcite \u5185\u90e8\u7684 JDBC Server\uff1b</li> <li>\u63a5\u4e0b\u6765 JDBC Server  \u4f1a\u628a\u4f20\u5165\u7684 SQL \u8bed\u53e5\u7ecf\u8fc7 SQL Parser and Validator \u6a21\u5757\u505a SQL \u7684\u89e3\u6790\u548c\u6821\u9a8c\uff1b</li> <li>\u65c1\u8fb9\u7684 Expressions Builder \u7528\u4e8e\u652f\u6301 Calcite \u505a SQL \u89e3\u6790\u548c\u6821\u9a8c\u7684\u6846\u67b6\u5bf9\u63a5\uff1b</li> <li>\u63a5\u7740\u662f Operator Expressions \u6a21\u5757\u6765\u5904\u7406\u5173\u7cfb\u8868\u8fbe\u5f0f\uff1b</li> <li>Metadata Providers \u7528\u6765\u652f\u6301\u5916\u90e8\u81ea\u5b9a\u4e49\u5143\u6570\u636e\uff1b</li> <li>Pluggable Rules \u7528\u6765\u5b9a\u4e49\u4f18\u5316\u89c4\u5219\uff1b</li> <li>\u6700\u6838\u5fc3\u7684 Query Optimizer \u5219\u4e13\u6ce8\u67e5\u8be2\u4f18\u5316\u3002</li> </ul>"},{"location":"data_query/calcite/calcite.html#optimizer","title":"\u4f18\u5316\u5668\uff08Optimizer\uff09","text":"<ul> <li>\u91c7\u7528\u5173\u7cfb\u7b97\u5b50\u6811\u4f5c\u4e3a\u5185\u90e8\u8868\u793a\uff1b</li> </ul> <p>\u4f18\u5316\u5f15\u64ce\u6784\u6210\uff1a</p> <ul> <li>\u89c4\u5219\uff08rules\uff09\uff1a</li> <li>\u5143\u6570\u636e\u63d0\u4f9b\u8005\uff08metadata providers\uff09\uff1a</li> <li>\u8ba1\u5212\u5668\u5f15\u64ce\uff08planner engines\uff09\uff1a</li> </ul>"},{"location":"data_query/calcite/calcite.html#query-algebra","title":"\u67e5\u8be2\u4ee3\u6570\uff08Query Algebra\uff09","text":"<p>Operators\uff1a</p> <ul> <li>\u5e38\u7528\u7684\u5173\u7cfb\u578b\u4ee3\u6570\u7684\u7b97\u5b50\uff1a\u5982 join, project, filter \u7b49\uff1b</li> <li>\u590d\u6742\u64cd\u4f5c/\u7279\u5b9a\u573a\u666f\u7684\u7b97\u5b50\uff1a\u5982 window \u7b49\uff1b</li> </ul> <p>Traits\uff08\uff1f\u4e0d\u662f\u5f88\u660e\u767d\uff1f\uff09\uff1a</p> <ul> <li>\u4f7f\u7528\u7279\u8d28\uff08Trait\uff09\u6765\u63cf\u8ff0\u4e0e\u64cd\u4f5c\u7b26\u5173\u8054\u7684\u7269\u7406\u5c5e\u6027\uff1b</li> <li>\u4f18\u5316\u8fc7\u7a0b\u4e2d\uff0cCalcite \u5c1d\u8bd5\u5bf9\u5173\u7cfb\u8868\u8fbe\u5f0f\u5f3a\u5236\u6267\u884c\u67d0\u4e9b\u7279\u8d28\uff1b</li> <li>calling convention\uff08\u8c03\u7528\u7ea6\u5b9a\u7279\u8d28\uff09</li> </ul>"},{"location":"data_query/calcite/calcite.html#adapters","title":"\u9002\u914d\u5668\uff08Adapters\uff09","text":"<p>Adapter\uff1a</p> <ul> <li>\u6a21\u578b\uff08model\uff09\uff1a\u8bbf\u95ee\u7684\u6570\u636e\u6e90\u7684\u7269\u7406\u5c5e\u6027\u7684\u89c4\u8303\u8bf4\u660e\uff1b</li> <li>\u8303\u5f0f\uff08schema\uff09\uff1amodel\u4e2d\u6570\u636e\uff08\u683c\u5f0f\u548c\u5e03\u5c40\uff09\u7684\u5b9a\u4e49\uff1b</li> <li>\u8303\u5f0f\u5de5\u5382\uff08schema factory\uff09\uff1a\u4ece\u6a21\u578b\u4e2d\u83b7\u53d6\u5143\u6570\u636e\u4fe1\u606f\u5e76\u751f\u6210\u4e00\u4e2a\u6a21\u5f0f\uff1b</li> </ul> <p></p>"},{"location":"data_query/calcite/calcite.html#_4","title":"\u67e5\u8be2\u5904\u7406\u548c\u4f18\u5316","text":"<p>\u8ba1\u5212\u5668\u89c4\u5219\uff08planner rules\uff09</p> <ul> <li>\u89c4\u5219\u5339\u914d\u6811\u4e2d\u7684\u7ed9\u5b9a\u6a21\u5f0f\uff0c\u8fdb\u884c\u8868\u8fbe\u5f0f\u6811\u7684\u7b49\u4ef7\u8f6c\u6362\uff1b</li> </ul> <p></p> <p>\u5143\u6570\u636e\u63d0\u4f9b\u8005\uff08Metadata providers\uff09</p> <ul> <li>\u6307\u5bfc\u8ba1\u5212\u8005\u5b9e\u73b0\u964d\u4f4e\u603b\u4f53\u67e5\u8be2\u8ba1\u5212\u6210\u672c\u7684\u76ee\u6807\uff1b</li> <li>\u5728\u5e94\u7528\u89c4\u5219\u65f6\u5411\u89c4\u5219\u63d0\u4f9b\u4fe1\u606f\uff1b</li> <li>\u5141\u8bb8\u6570\u636e\u5904\u7406\u7cfb\u7edf\u5c06\u5176\u5143\u6570\u636e\u4fe1\u606f\u63d2\u5165\u6846\u67b6\uff0c\u63d0\u4f9b\u5728\u4f18\u5316\u9636\u6bb5\u4f7f\u7528\u65b0\u7684\u5143\u6570\u636e\u529f\u80fd</li> <li>\u5143\u6570\u636e\u63d0\u4f9b\u7a0b\u5e8f\u53ef\u63d2\u5165\uff0c\u4f7f\u7528Java\u8f7b\u91cf\u7ea7\u7f16\u8bd1\u5668Janino\u5728\u8fd0\u884c\u65f6\u5bf9\u5176\u8fdb\u884c\u7f16\u8bd1\u548c\u5b9e\u4f8b\u5316</li> </ul> <p>\u89c4\u5212\u5668\u5f15\u64ce\uff08Planner engines\uff09 </p> <ul> <li>\u89e6\u53d1\u63d0\u4f9b\u7ed9\u5f15\u64ce\u7684\u89c4\u5219\uff0c\u76f4\u5230\u8fbe\u5230\u7ed9\u5b9a\u76ee\u6807\u4e3a\u6b62\uff1b</li> <li>\u57fa\u4e8e\u6210\u672c\u7684\u8ba1\u5212\u5668\u5f15\u64ce\uff08COB\uff09\uff1a</li> <li>\u7c7b\u4f3c\u4e8eVolcano \u7684\u52a8\u6001\u7f16\u7a0b\u7b97\u6cd5\u6765\u521b\u5efa\u548c\u8ddf\u8e2a\u901a\u8fc7\u89e6\u53d1\u63d0\u4f9b\u7ed9\u5f15\u64ce\u7684\u89c4\u5219\u800c\u521b\u5efa\u7684\u4e0d\u540c\u66ff\u4ee3\u8ba1\u5212</li> <li>\u8be6\u7ec6\u7684\u8ba1\u5212\u7a0b\u5e8f\uff0c\u4f1a\u5faa\u73af\u5730\u89e6\u53d1\u89c4\u5219\uff0c\u76f4\u5230\u5b83\u751f\u6210\u4e0d\u518d\u88ab\u4efb\u4f55\u89c4\u5219\u4fee\u6539\u7684\u8868\u8fbe\u5f0f\u4e3a\u6b62\u3002 </li> </ul> <p>\u7269\u5316\u89c6\u56fe\uff08Materialized views\uff09</p> <p>\u5bf9\u6570\u636e\u6458\u8981\u6216\u7269\u5316\u89c6\u56fe\u8fdb\u884c\u9884\u8ba1\u7b97\u662f\u52a0\u901f\u6570\u636e\u4ed3\u5e93\u4e2d\u67e5\u8be2\u5904\u7406\u7684\u6700\u5f3a\u5927\u6280\u672f\u4e4b\u4e00\uff0calcite \u63d0\u4f9b\u4e86\u4e24\u79cd\u4e0d\u540c\u7684\u57fa\u4e8e\u7269\u5316\u89c6\u56fe\u7684\u91cd\u5199\u7b97\u6cd5\u7684\u5b9e\u73b0\uff1a</p> <ul> <li>\u57fa\u4e8e\u89c6\u56fe\u66ff\u6362\uff0c\u7528\u4e00\u4e2a\u7269\u5316\u89c6\u56fe\u7684\u7b49\u6548\u8868\u8fbe\u5f0f\u66ff\u6362\u5173\u7cfb\u4ee3\u6570\u6811\u7684\u4e00\u90e8\u5206\uff1b</li> <li>\u57fa\u4e8e\u683c\u5b50\uff08lattices\uff09</li> </ul>"},{"location":"data_query/calcite/calcite.html#_5","title":"\u4f7f\u7528\u65b9\u5f0f","text":""},{"location":"data_query/calcite/calcite.html#lib","title":"Lib\u5e93","text":"<p>\u628a Calcite \u5f53\u4f5c lib \u5e93\uff0c\u5d4c\u5165\u5230\u81ea\u5df1\u7684\u9879\u76ee\u4e2d\u3002</p> <p></p>"},{"location":"data_query/calcite/calcite.html#_6","title":"\u96c6\u6210","text":"<p>\u5b9e\u73b0\u4e00\u4e2a\u9002\u914d\u5668\uff08Adapter\uff09\uff0c\u9879\u76ee\u901a\u8fc7\u8bfb\u53d6\u6570\u636e\u6e90\u7684\u9002\u914d\u5668\u4e0e Calcite \u96c6\u6210\u3002</p> <p></p>"},{"location":"data_query/calcite/calcite.html#_7","title":"\u529f\u80fd","text":"<p>Calcite\u2019s core module (<code>calcite-core</code>) supports SQL queries (<code>SELECT</code>) and DML operations (<code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>MERGE</code>) but does not support DDL operations such as <code>CREATE SCHEMA</code> or <code>CREATE TABLE</code>\u3002</p> <p>The server module (<code>calcite-server</code>) adds DDL support to Calcite\u3002</p>"},{"location":"data_query/calcite/calcite.html#jdbc-driver","title":"JDBC Driver","text":"<p>Calcite \u5bf9\u7528\u6237\u63d0\u4f9b jdbc driver\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u5176\u8fde\u63a5Calcite\u8fdb\u884c\u6570\u636e\u67e5\u8be2\u3002</p> <pre><code>jdbc:calcite:schemaType=JDBC; schema.jdbcUser=SCOTT; schema.jdbcPassword=TIGER; schema.jdbcUrl=jdbc:hsqldb:res:foodmart\n</code></pre>"},{"location":"data_query/calcite/calcite.html#sql-language","title":"SQL Language","text":"<p>TODO</p>"},{"location":"data_query/calcite/calcite.html#_8","title":"\u793a\u4f8b","text":"<p>maven\u4f9d\u8d56</p> <pre><code>&lt;groupId&gt;org.apache.calcite&lt;/groupId&gt;\n&lt;artifactId&gt;calcite-core&lt;/artifactId&gt;\n&lt;version&gt;1.29.0&lt;/version&gt;\n</code></pre> <p>java demo</p> <pre><code>package edu.xliu.lifelearning.cs.calcite;\n\nimport org.apache.calcite.adapter.java.ReflectiveSchema;\nimport org.apache.calcite.jdbc.CalciteConnection;\nimport org.apache.calcite.schema.SchemaPlus;\n\nimport java.sql.*;\nimport java.util.Properties;\n\npublic class HrSchema {\n\n    public static class Employee {\n        public final int emp_id;\n        public final String name;\n        public final int dept_no;\n\n        public Employee(int emp_id, String name, int dept_no) {\n            this.emp_id = emp_id;\n            this.name = name;\n            this.dept_no = dept_no;\n        }\n    }\n\n    public static class Department {\n        public final String name;\n        public final int dept_no;\n\n        public Department(int dept_no, String name) {\n            this.dept_no = dept_no;\n            this.name = name;\n        }\n    }\n\n    public final Employee[] employee = {\n            new Employee(100, \"joe\", 1),\n            new Employee(200, \"oliver\", 2),\n            new Employee(300, \"twist\", 1),\n            new Employee(301, \"king\", 3),\n            new Employee(305, \"kelly\", 1)\n    };\n\n    public final Department[] department = {\n            new Department(1, \"dev\"),\n            new Department(2, \"market\"),\n            new Department(3, \"test\")\n    };\n\n    public static void main(String[] args) throws ClassNotFoundException, SQLException {\n        Class.forName(\"org.apache.calcite.jdbc.Driver\");\n        Properties info = new Properties();\n        info.setProperty(\"lex\", \"JAVA\");\n        Connection connection = DriverManager.getConnection(\"jdbc:calcite:\", info);\n        CalciteConnection calciteConnection = connection.unwrap(CalciteConnection.class);\n        SchemaPlus rootSchema = calciteConnection.getRootSchema();\n//        Class.forName(\"com.mysql.jdbc.Driver\");\n//        BasicDataSource dataSource = new BasicDataSource();\n//        dataSource.setUrl(\"jdbc:mysql://localhost\");\n//        dataSource.setUsername(\"username\");\n//        dataSource.setPassword(\"password\");\n//        Schema schema = JdbcSchema.create(rootSchema, \"hr\", dataSource, null, \"name\");\n\n        // \u57fa\u4e8e\u5185\u5b58\u5c06Java\u5bf9\u8c61\u6ce8\u518c\u4e3aschema\uff0c\u5c06emps\u548cdepts\u4f5c\u4e3a\u8868\n        rootSchema.add(\"hr\", new ReflectiveSchema(new HrSchema()));\n\n        try(Statement statement = calciteConnection.createStatement()) {\n            ResultSet resultSet = statement.executeQuery(\n                    \"select e.emp_id, e.name as emp_name, e.dept_no, d.name as dept_name \"\n                            + \"from hr.employee as e left join hr.department as d on e.dept_no = d.dept_no\");\n\n            while (resultSet.next()) {\n                for (int i = 1; i &lt;= resultSet.getMetaData().getColumnCount(); i++) {\n                    System.out.print(resultSet.getMetaData().getColumnName(i) + \":\" + resultSet.getObject(i));\n                    System.out.print(\" | \");\n                }\n                System.out.println();\n            }\n            resultSet.close();\n        }\n        connection.close();\n    }\n}\n</code></pre> <p>\u5176\u5b83SQL\u7cfb\u7edf\u53ef\u4ee5\u901a\u8fc7Adapter\u7684\u65b9\u5f0f\uff0c\u7ee7\u627f\u5230Calcite\u4e2d\uff0c\u53ef\u4ee5\u53c2\u8003 example/csv \u7684 Adapter\u3002</p>"},{"location":"data_query/clickhouse/clickhouse.html","title":"ClickHouse","text":"<p>ClickHouse\u662f\u4e00\u4e2a\u7528\u4e8e\u8054\u673a\u5206\u6790(OLAP)\u7684\u5217\u5f0f\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf(DBMS)\uff0c\u4f7f\u7528MPP\u67b6\u6784\u3002</p> <p>clickhouse\u4e0d\u9002\u5408\u7684\u573a\u666f</p> <ul> <li>Transactional workloads (OLTP)</li> <li>Key-value access with high request rate</li> <li>Blob or document storage</li> <li>Over-normalized data</li> </ul> <p>\u7528\u6237\u901a\u8fc7\u6267\u884cSQL\u8bed\u53e5\uff0c\u53ef\u4ee5\u5728ClickHouse\u4e2d\u76f4\u63a5\u8bfb\u53d6HDFS\u7684\u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u5c06\u8bfb\u53d6\u7684\u6570\u636e\u5bfc\u5165\u5230ClickHouse\u672c\u5730\u8868\u3002</p>"},{"location":"data_query/clickhouse/start.html","title":"\u5f00\u59cb","text":""},{"location":"data_query/clickhouse/start.html#_2","title":"\u5b89\u88c5","text":""},{"location":"data_query/doris/apache_doris.html","title":"Apache doris","text":"<p>[toc]</p>"},{"location":"data_query/doris/apache_doris.html#apache-doris","title":"Apache Doris","text":"<p>\u652f\u6301\u5bf9\u6d77\u91cf\u5927\u6570\u636e\u8fdb\u884c\u5feb\u901f\u5206\u6790\u7684MPP\u6570\u636e\u5e93</p>"},{"location":"data_query/doris/dorisdb.html","title":"Dorisdb","text":"<p>[toc]</p>"},{"location":"data_query/doris/dorisdb.html#dorisdb","title":"DorisDB","text":"<p>DorisDB\u662f\u7531Apache Doris\u6838\u5fc3\u7814\u53d1\u56e2\u961f\u6253\u9020\u7684\u65b0\u4e00\u4ee3\u4f01\u4e1a\u7ea7MPP\u6570\u636e\u5e93\u3002</p>"},{"location":"data_query/graphdb/JanusGraph.html","title":"JanusGraph","text":"<p>\u524d\u8eab\u662fTitan\u3002</p> <p>https://github.com/JanusGraph/janusgraph</p>"},{"location":"data_query/graphdb/JanusGraph.html#_1","title":"\u67b6\u6784","text":"<p>\u5b58\u50a8\u5c42</p> <ul> <li>Apache Cassandra</li> <li>Apache HBase</li> <li>Oracle Berkeley DB Java Edition</li> </ul> <p>\u7d22\u5f15\u5c42</p> <ul> <li>Elasticsearch</li> <li>Apache Solr</li> <li>Apache Lucene</li> </ul> <p></p>"},{"location":"data_query/graphdb/nebulaGraph.html","title":"Nebula Graph","text":"<p>\u4e16\u754c\u4e0a\u552f\u4e00\u80fd\u591f\u5bb9\u7eb3\u5343\u4ebf\u4e2a\u9876\u70b9\u548c\u4e07\u4ebf\u6761\u8fb9\uff0c\u5e76\u63d0\u4f9b\u6beb\u79d2\u7ea7\u67e5\u8be2\u5ef6\u65f6\u7684\u56fe\u6570\u636e\u5e93\u89e3\u51b3\u65b9\u6848\u3002</p>"},{"location":"data_query/graphdb/nebulaGraph.html#_1","title":"\u67b6\u6784","text":""},{"location":"data_query/graphdb/nebulaGraph.html#_2","title":"\u601d\u7ef4\u5bfc\u56fe","text":""},{"location":"data_query/graphdb/plato.html","title":"Plato","text":""},{"location":"data_query/hive/conf.html","title":"\u914d\u7f6e","text":"<p>Hive\u5168\u91cf\u7684\u914d\u7f6e\u4fe1\u606f\uff1a</p> <p>https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-HiveServer2</p>"},{"location":"data_query/hive/conf.html#hiveserver2","title":"HiveServer2","text":""},{"location":"data_query/hive/conf.html#_2","title":"\u6027\u80fd","text":"<ul> <li>hive.server2.thrift.min.worker.threads \u2013 Minimum number of worker threads, default 5.</li> <li>hive.server2.thrift.max.worker.threads \u2013 Maximum number of worker threads, default 500.</li> </ul>"},{"location":"data_query/hive/conf.html#_3","title":"\u5b89\u5168","text":"<ul> <li>hive.server2.authentication : default NONE. Options are NONE (uses plain SASL), NOSASL, KERBEROS, LDAP, PAM and CUSTOM.</li> </ul>"},{"location":"data_query/hive/conf.html#log","title":"Log","text":""},{"location":"data_query/hive/conf.html#perf-log","title":"Perf Log","text":"<ul> <li>log4j.logger.org.apache.hadoop.hive.ql.log.PerfLogger=DEBUG</li> </ul>"},{"location":"data_query/hive/faq.html","title":"Hive FAQ","text":""},{"location":"data_query/hive/faq.html#user-root-is-not-allowed-to-impersonate-anonymous","title":"\u95ee\u9898\uff1aUser root is not allowed to impersonate anonymous","text":"<p>\u89e3\u51b3\uff1a\u4fee\u6539hadoop \u914d\u7f6e\u6587\u4ef6 <code>etc/hadoop/core-site.xml</code>\uff0c\u52a0\u5165\u5982\u4e0b\u914d\u7f6e\u9879\uff1a</p> <pre><code>&lt;property&gt;\n\u3000\u3000&lt;name&gt;hadoop.proxyuser.root.hosts&lt;/name&gt;\n\u3000\u3000&lt;value&gt;*&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;property&gt;\n\u3000\u3000&lt;name&gt;hadoop.proxyuser.root.groups&lt;/name&gt;\n\u3000\u3000&lt;value&gt;*&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\u7136\u540e\uff0c\u52a8\u6001\u5237\u65b0HDFS\u7684\u7528\u6237\u6743\u9650\u914d\u7f6e</p> <pre><code>bin/hdfs dfsadmin \u2013refreshSuperUserGroupsConfiguration\nbin/yarn rmadmin \u2013refreshSuperUserGroupsConfiguration\n</code></pre>"},{"location":"data_query/hive/faq.html#hive-schema-version-120-does-not-match-metastores-schema-version-210","title":"\u95ee\u9898\uff1aHive Schema version 1.2.0 does not match metastore's schema version 2.1.0","text":"<p>\u89e3\u51b3\u65b9\u68481\uff1a\u4fee\u6539mysql\u6570\u636e\u5e93\u4e2d\u7684Schame version</p> <pre><code># root\u8eab\u4efd\u8bbf\u95eemysql\nmysql -u root -p\n\n# \u8f93\u5165\u5bc6\u7801\nEnter password:\n\n# \u4f7f\u7528hive\u6570\u636e\u5e93\n# use hive\n\n# \u67e5\u770bversion\u8868\u4e2dSchema\u7684\u7248\u672c\nselect * from version;\n\n# \u66f4\u65b0version\u8868\u4e2dschema\u7248\u672c\nupdate VERSION set SCHEMA_VERSION='2.1.1' where VER_ID=1;\n</code></pre> <p>\u89e3\u51b3\u65b9\u68482\uff1a\u5728<code>hvie-site.xml</code>\u4e2d\u5c06<code>hive.metastore.schema.verification</code>\u53c2\u6570\u8bbe\u7f6e\u4e3a<code>false</code></p> <pre><code>&lt;property&gt;\n    &lt;name&gt;hive.metastore.schema.verification&lt;/name&gt;\n    &lt;value&gt;false&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"data_query/hive/hive.html","title":"Hive","text":""},{"location":"data_query/hive/hive.html#_1","title":"\u67b6\u6784","text":""},{"location":"data_query/hive/hive.html#_2","title":"\u7ec4\u4ef6","text":""},{"location":"data_query/hive/hive.html#hiveserver2","title":"HiveServer2","text":"<p>\u901a\u8fc7Thrift RPC \u63d0\u4f9b\u670d\u52a1\u7aef\u80fd\u529b\uff0c\u652f\u6301\u591a\u7528\u6237\u5e76\u53d1\u548c\u5b89\u5168\u8ba4\u8bc1\u3002\u7528\u6237\u53ef\u4ee5\u901a\u8fc7hiveserver2\u6267\u884cSQL\u8bed\u53e5\u83b7\u5f97\u8fd4\u56de\u7ed3\u679c\u3002</p>"},{"location":"data_query/hive/hive.html#metastore","title":"MetaStore","text":"<p>\u5143\u6570\u636e\u5305\u542b\u7528Hive\u521b\u5efa\u7684database\u3001table\u7b49\u7684\u5143\u4fe1\u606f\u3002\u5143\u6570\u636e\u5b58\u50a8\u5728\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u3002\u5982Derby\u3001MySQL\u7b49\u3002</p> <p>Embedded Metastore Database (Derby) \u5185\u5d4c\u6a21\u5f0f</p> <p>\u9ed8\u8ba4\u914d\u7f6e\uff0c\u53ea\u80fd\u4e00\u6b21\u542f\u52a8\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0chive\u670d\u52a1\u548cmetastore\u670d\u52a1\u8fd0\u884c\u5728\u540c\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\uff0c\u9ed8\u8ba4\u6570\u636e\u5b58\u50a8\u5230<code>./metastore_db</code>\u76ee\u5f55\u4e0b\u3002</p> <p>Local Metastore Server \u672c\u5730\u5143\u5b58\u50a8</p> <p>hive\u670d\u52a1\u548cmetastore\u670d\u52a1\u8fd0\u884c\u5728\u540c\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\uff0c\u8fde\u63a5\u7b2c\u4e09\u65b9\u7684\u6570\u636e\u5e93\uff08MySQL\u7b49\uff09\u3002</p> <p>Remote Metastore Server \u8fdc\u7a0b\u5143\u5b58\u50a8</p> <p>hive\u670d\u52a1\u548cmetastore\u670d\u52a1\u4e0d\u8fd0\u884c\u5728\u540c\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\uff0c\u8fde\u63a5\u7b2c\u4e09\u65b9\u7684\u6570\u636e\u5e93\uff08MySQL\u7b49\uff09\u3002</p>"},{"location":"data_query/hive/hive.html#hcatalog","title":"HCatalog","text":"<p>Hadoop\u7684\u8868\u5b58\u50a8\u7ba1\u7406\u5de5\u5177\uff0c\u5c06Hive Metastore\u7684\u8868\u683c\u6570\u636e\u516c\u5f00\u7ed9\u5176\u5b83\u7684\u6570\u636e\u5904\u7406\u5de5\u5177\u3002</p> <p>HCatalog\u7684\u8868\u4e3a\u7528\u6237\u63d0\u4f9b\u4e86\uff08HDFS\uff09\u4e2d\u6570\u636e\u7684\u5173\u7cfb\u89c6\u56fe\uff0c\u5e76\u786e\u4fdd\u7528\u6237\u4e0d\u5fc5\u62c5\u5fc3\u4ed6\u4eec\u7684\u6570\u636e\u5b58\u50a8\u5728\u4f55\u5904\u6216\u91c7\u7528\u4f55\u79cd\u683c\u5f0f\uff08\u4e0d\u9700\u8981\u4fee\u6539\u5ba2\u6237\u7aef\u6e90\u7801\u8fdb\u884c\u8bfb\u5199\uff09\u3002</p>"},{"location":"data_query/hive/hive.html#webhcat","title":"WebHCat","text":"<p>HCatalog\u7684REST API\u3002</p>"},{"location":"data_query/hive/hive.html#_3","title":"\u8868\u7684\u6027\u8d28","text":""},{"location":"data_query/hive/hive.html#_4","title":"\u5185\u90e8\u8868\u548c\u5916\u90e8\u8868","text":"<p>\u672a\u88abexternal\u4fee\u9970\u7684\u662f\u5185\u90e8\u8868\uff08managed table\uff09\uff0c\u88abexternal\u4fee\u9970\u7684\u4e3a\u5916\u90e8\u8868\uff08external table\uff09\uff1b </p> <p>\u533a\u522b\uff1a </p> <ul> <li>\u5185\u90e8\u8868\u6570\u636e\u7531Hive\u81ea\u8eab\u7ba1\u7406\uff0c\u5916\u90e8\u8868\u6570\u636e\u7531HDFS\u7ba1\u7406\uff1b </li> <li>\u5185\u90e8\u8868\u6570\u636e\u5b58\u50a8\u7684\u4f4d\u7f6e\u662fhive.metastore.warehouse.dir\uff08\u9ed8\u8ba4\uff1a/user/hive/warehouse\uff09\uff0c\u5916\u90e8\u8868\u6570\u636e\u7684\u5b58\u50a8\u4f4d\u7f6e\u7531\u81ea\u5df1\u5236\u5b9a\uff1b     </li> <li>\u5220\u9664\u5185\u90e8\u8868\u4f1a\u76f4\u63a5\u5220\u9664\u5143\u6570\u636e\uff08metadata\uff09\u53ca\u5b58\u50a8\u6570\u636e\uff1b\u5220\u9664\u5916\u90e8\u8868\u4ec5\u4ec5\u4f1a\u5220\u9664\u5143\u6570\u636e\uff0cHDFS\u4e0a\u7684\u6587\u4ef6\u5e76\u4e0d\u4f1a\u88ab\u5220\u9664\uff1b     </li> <li>\u5bf9\u5185\u90e8\u8868\u7684\u4fee\u6539\u4f1a\u5c06\u4fee\u6539\u76f4\u63a5\u540c\u6b65\u7ed9\u5143\u6570\u636e\uff0c\u800c\u5bf9\u5916\u90e8\u8868\u7684\u8868\u7ed3\u6784\u548c\u5206\u533a\u8fdb\u884c\u4fee\u6539\uff0c\u5219\u9700\u8981\u4fee\u590d\uff08MSCK     REPAIR TABLE table_name;\uff09</li> </ul>"},{"location":"data_query/hive/hive.html#_5","title":"\u5206\u533a\u8868","text":"<p>\u8868\u53ef\u4ee5\u8fdb\u4e00\u6b65\u88ab\u5206\u533a\uff08Partitioned By\uff09\uff0c\u5206\u6210\u591a\u7ea7\u5b50\u76ee\u5f55\uff0c\u907f\u514d\u65e0\u9700\u7684\u67e5\u627e\u3002</p>"},{"location":"data_query/hive/hive.html#_6","title":"\u5206\u6876\u8868","text":"<p>\u8868\u548c\u5206\u533a\u90fd\u53ef\u4ee5\u88ab\u5206\u6876\uff08CLUSTERED BY columns\uff09\uff0c\u6876\u91cc\u7684\u6570\u636e\u53ef\u4ee5\u901a\u8fc7 SORT BY \u6392\u5e8f\u3002</p> <pre><code>create tablebucketed_user(id int,name string) clustered by (id) sorted by(name) into 4 buckets row format delimited fields terminated by ' ' stored as textfile; \n</code></pre>"},{"location":"data_query/hive/hive.html#hive_1","title":"Hive \u8fd0\u884c\u6a21\u5f0f","text":"<p>./bin/hive  --service metastore`</p> <p>hive\u5ba2\u6237\u7aef\u5728hive-site.xml\u914d\u7f6ehive.metastore.uris=thrift://ipxxx:9083  \u7684\u65b9\u5f0f\u94fe\u63a5\u5230hive\u3002motestore \u867d\u7136\u80fd\u4f7fhive\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u5206\u522b\u90e8\u7f72\u5230\u4e0d\u540c\u7684\u8282\u70b9\uff0c\u5ba2\u6237\u7aef\u4e0d\u9700\u8981\u5173\u6ce8metadata\u7684\u76f8\u5173\u914d\u7f6e\u3002\u4f46\u662fmetastore\u53ea\u80fd\u901a\u8fc7\u53ea\u80fd\u901a\u8fc7\u914d\u7f6ehive.metastore.uris\u7684\u65b9\u5f0f\u8fde\u63a5\uff0c\u65e0\u6cd5\u901a\u8fc7jdbc\u7684\u65b9\u5f0f\u8bbf\u95ee\u3002</p> <p><code>./bin/hiveserver2</code> hiveserver2 \u4f1a\u542f\u52a8\u4e00\u4e2ahive\u670d\u52a1\u7aef\u9ed8\u8ba4\u7aef\u53e3\u4e3a\uff1a10000\uff0c\u53ef\u4ee5\u901a\u8fc7beeline\uff0cjdbc\uff0codbc\u7684\u65b9\u5f0f\u94fe\u63a5\u5230hive\u3002hiveserver2\u542f\u52a8\u7684\u65f6\u5019\u4f1a\u5148\u68c0\u67e5\u6709\u6ca1\u6709\u914d\u7f6ehive.metastore.uris\uff0c\u5982\u679c\u6ca1\u6709\u4f1a\u5148\u542f\u52a8\u4e00\u4e2ametastore\u670d\u52a1\uff0c\u7136\u540e\u5728\u542f\u52a8hiveserver2\u3002\u5982\u679c\u6709\u914d\u7f6ehive.metastore.uris\u3002\u4f1a\u8fde\u63a5\u5230\u8fdc\u7a0b\u7684metastore\u670d\u52a1\u3002</p>"},{"location":"data_query/hive/install.html","title":"\u5b89\u88c5\u90e8\u7f72","text":""},{"location":"data_query/hive/install.html#_2","title":"\u4e0b\u8f7d","text":"<ul> <li>\u4e0b\u8f7d\u76f8\u5e94\u7248\u672c\u7684\u9884\u7f16\u8bd1\u5305\uff0c\u89e3\u538b\uff0c\u5e76\u914d\u7f6e\u73af\u5883\u53d8\u91cf(\u53ef\u9009)</li> </ul> <pre><code>export HIVE_HOME = \nPATH=${HIVE_HOME}/bin:$PATH\n</code></pre> <ul> <li> <p>\u521b\u5efa\u76f8\u5e94\u7684\u914d\u7f6e\u6587\u4ef6</p> </li> <li> <p><code>hive-env.sh, hive-site.xml, hive-log4j.properties</code></p> </li> </ul>"},{"location":"data_query/hive/install.html#_3","title":"\u4f9d\u8d56","text":"<ul> <li>Hadoop\u4f9d\u8d56</li> <li><code>hadoop</code>\u547d\u4ee4\u5728<code>PATH</code>\u4e2d\uff1b</li> <li>\u5728<code>hive-env.sh</code>\u4e2d\u914d\u7f6e<code>HADOOP_HOME</code></li> <li>\u5b58\u50a8\u4f9d\u8d56\uff0cHDFS\uff08<code>chmod g+w</code>\uff09</li> <li><code>/tmp</code>\u76ee\u5f55</li> <li><code>/user/hive/warehouse</code>\u76ee\u5f55\uff08<code>hive.metastore.warehouse.dir</code>\u53c2\u6570\u914d\u7f6e\uff09</li> </ul>"},{"location":"data_query/hive/install.html#_4","title":"\u914d\u7f6e","text":"<ul> <li> <p>hive.execution.mode: \u9ed8\u8ba4mr\uff0c\u6539\u6210 tez \u6216\u8005 spark\uff1b</p> </li> <li> <p>hive.server2.transport.mode :  binary\uff08\u9ed8\u8ba4\uff09 \u6216\u8005 http</p> </li> <li> <p>hive.server2.thrift.bind.host </p> </li> <li> <p>hive.server2.thrift.port</p> </li> </ul>"},{"location":"data_query/hive/install.html#metastore","title":"metastore","text":"<ul> <li>javax.jdo.option.ConnectionURL</li> <li>javax.jdo.option.ConnectionDriverName</li> <li>hive.metastore.uris</li> <li>hive.metastore.warehouse.dir</li> </ul>"},{"location":"data_query/hive/install.html#_5","title":"\u542f\u52a8","text":""},{"location":"data_query/hive/install.html#hiveserver2-beeline","title":"hiveserver2 &amp; beeline","text":"<p>hiveserver2\u662f\u4e2a\u670d\u52a1\u7aef\uff08\u652f\u6301\u591a\u7528\u6237\u3001\u5b89\u5168\uff09\uff0cbeeline\u662f\u4e2a\u5ba2\u6237\u7aef\u3002</p> <pre><code>$HIVE_HOME/bin/hiveserver2\n$HIVE_HOME/bin/beeline -u jdbc:hive2://$HS2_HOST:$HS2_PORT\n</code></pre>"},{"location":"data_query/hive/sql.html","title":"Sql","text":""},{"location":"data_query/hive/sql.html#sql","title":"SQL","text":""},{"location":"data_query/hive/sql.html#ddl","title":"DDL","text":"<p>https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL</p> <ul> <li>CREATE DATABASE/SCHEMA, TABLE, VIEW, FUNCTION, INDEX</li> <li>DROP DATABASE/SCHEMA, TABLE, VIEW, INDEX</li> <li>TRUNCATE TABLE</li> <li>ALTER DATABASE/SCHEMA, TABLE, VIEW</li> <li>MSCK REPAIR TABLE (or ALTER TABLE RECOVER PARTITIONS)</li> <li>SHOW DATABASES/SCHEMAS, TABLES, TBLPROPERTIES, VIEWS, PARTITIONS, FUNCTIONS, INDEX[ES], COLUMNS, CREATE TABLE</li> <li>DESCRIBE DATABASE/SCHEMA, table_name, view_name, materialized_view_name</li> </ul>"},{"location":"data_query/hive/sql.html#create-table","title":"Create Table","text":""},{"location":"data_query/hive/sql.html#_1","title":"Sql","text":""},{"location":"data_query/hive/sql.html#sort-by-order-by-cluster-by-distributed-by","title":"Sort By &amp; Order By &amp; Cluster By &amp; Distributed By","text":"<ul> <li>Sort By \u662f\u5355Reducer\u5185\u6709\u5e8f\u7684\uff0cOrder By\u662f\u5168\u5c40\u6709\u5e8f\uff1b</li> <li>Distributed By\u4fdd\u8bc1\u76f8\u540c\u5217\u503c\u7684\u884c\u4f1a\u53d1\u9001\u5230\u540c\u4e00\u4e2areducer\u4e2d\uff1b</li> <li>Cluster By is a short-cut for both Distribute By and Sort By.</li> </ul>"},{"location":"data_query/kyuubi/Apache_Kyuubi.html","title":"Kyuubi","text":"<p>\u53c2\u8003\u6587\u6863\uff1a</p> <ol> <li>Kyuubi \u4e0e Spark Thrift Server \u7684\u5168\u9762\u5bf9\u6bd4\u5206\u6790</li> <li>Kyuubi: \u7f51\u6613\u6570\u5e06\u5f00\u6e90\u7684\u4f01\u4e1a\u7ea7\u6570\u636e\u6e56\u63a2\u7d22\u5e73\u53f0\uff08\u67b6\u6784\u7bc7\uff09</li> </ol>"},{"location":"data_query/kyuubi/Apache_Kyuubi.html#todo","title":"TODO:","text":""},{"location":"data_query/mysql/conf.html","title":"\u914d\u7f6e","text":""},{"location":"data_query/mysql/conf.html#_2","title":"\u5f00\u542f\u65e5\u5fd7","text":"<p>\u67e5\u770b\u662f\u5426\u662f\u5f00\u542f\u72b6\u6001\uff1a</p> <pre><code>show global variables like '%general%';\n</code></pre> <p>\u67e5\u8be2\u65e5\u5fd7\u5f00\u542f</p> <pre><code>set global general_log_file='/tmp/general.lg';  #\u8bbe\u7f6e\u8def\u5f84\nset global general_log=on;  # \u5f00\u542fgeneral log\u6a21\u5f0f\nset global general_log=off;  # \u5173\u95edgeneral log\u6a21\u5f0f\n</code></pre>"},{"location":"data_query/mysql/conf.html#_3","title":"\u65f6\u533a","text":"<pre><code>// \u65b9\u6cd5\u4e00\uff1a\u4f7f\u7528\u547d\u4ee4\uff08\u4f18\u70b9\uff1a\u4e0d\u9700\u8981\u91cd\u542fMySQL\u670d\u52a1\uff0c\u7f3a\u70b9\uff1a\u4e00\u65e6MySQL\u670d\u52a1\u88ab\u91cd\u542f\uff0c\u8bbe\u7f6e\u5c31\u4f1a\u6d88\u5931\uff09\nmysql&gt; set time_zone = '+8:00';\nmysql&gt; set global time_zone = '+8:00';\n// \u65b9\u6cd5\u4e8c\uff1a\u4fee\u6539my.ini\u914d\u7f6e\u6587\u4ef6\uff08\u4f18\u70b9\uff1a\u6c38\u4e45\u4fdd\u5b58\u8bbe\u7f6e\uff0c\u7f3a\u70b9\uff1a\u9700\u91cd\u542fMySQL\u670d\u52a1\uff09\n[mysqld]\n// \u8bbe\u7f6e\u9ed8\u8ba4\u65f6\u533a\ndefault-time_zone='+8:00'\n</code></pre>"},{"location":"data_query/mysql/high_available.html","title":"\u9ad8\u53ef\u7528","text":""},{"location":"data_query/mysql/high_available.html#_2","title":"\u4e3b\u5907\u590d\u5236\u539f\u7406","text":"<ul> <li>MySQL master \u5c06\u6570\u636e\u53d8\u66f4\u5199\u5165\u4e8c\u8fdb\u5236\u65e5\u5fd7(binary log\uff0c\u5176\u4e2d\u8bb0\u5f55\u53eb\u505a\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e8b\u4ef6binary log events\uff0c\u53ef\u4ee5\u901a\u8fc7 show binlog events \u8fdb\u884c\u67e5\u770b)\uff1b</li> <li>MySQL slave \u5c06 master \u7684 binary log events \u62f7\u8d1d\u5230\u5b83\u7684\u4e2d\u7ee7\u65e5\u5fd7(replay log)\uff1b</li> <li>MySQL slave \u91cd\u653e relay log \u4e2d\u4e8b\u4ef6\uff0c\u5c06\u6570\u636e\u53d8\u66f4\u53cd\u6620\u5b83\u81ea\u5df1\u7684\u6570\u636e\uff08\u6570\u636e\u5ef6\u8fdf\uff09\uff1b</li> </ul>"},{"location":"data_query/mysql/high_available.html#binlog","title":"Binlog","text":"<p>Binlog\u662f\u4e8c\u8fdb\u5236\u683c\u5f0f\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u7528\u6765\u8bb0\u5f55\u6570\u636e\u5e93\u7684\u6570\u636e\u66f4\u65b0\u6216\u8005\u6f5c\u5728\u66f4\u65b0(\u6bd4\u5982DELETE\u8bed\u53e5\u6267\u884c\u5220\u9664\u800c\u5b9e\u9645\u5e76\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e)\uff0c\u4e3b\u8981\u7528\u4e8e\u6570\u636e\u5e93\u7684\u4e3b\u4ece\u590d\u5236\u4ee5\u53ca\u589e\u91cf\u6062\u590d\u3002</p> <p>\u4e00\u5171\u6709\u4e24\u79cd\u7c7b\u578b\u4e8c\u8fdb\u5236\u8bb0\u5f55\u65b9\u5f0f\uff1a</p> <ul> <li>Statement\u6a21\u5f0f\uff08\u9ed8\u8ba4)</li> <li>\u6bcf\u4e00\u6761\u4f1a\u4fee\u6539\u6570\u636e\u7684sql\u90fd\u4f1a\u88ab\u8bb0\u5f55\u5728binlog\u4e2d\uff0c\u5982 inserts, updates, deletes\uff1b</li> <li>\u4fee\u6539\u6570\u636e\u7684\u65f6\u5019\u4f7f\u7528\u4e86\u67d0\u4e9b\u5b9a\u7684\u51fd\u6570\u6216\u8005\u529f\u80fd\uff0c\u4f1a\u9020\u6210MySQL\u7684\u590d\u5236\u51fa\u73b0\u95ee\u9898\uff1b</li> <li>Row\u6a21\u5f0f:</li> <li>\u6bcf\u4e00\u884c\u7684\u5177\u4f53\u53d8\u66f4\u4e8b\u4ef6\u90fd\u4f1a\u88ab\u8bb0\u5f55\u5728binlog\u4e2d\uff0c\u5305\u542b\u6240\u6709\u7684\u6570\u636e\uff1b</li> <li> <p>\u4ee5\u6bcf\u884c\u8bb0\u5f55\u7684\u4fee\u6539\u6765\u8bb0\u5f55\uff0c\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u65e5\u5fd7\u5185\u5bb9\u3002</p> </li> <li> <p>Mixed\u6a21\u5f0f\u662f\u4ee5\u4e0a\u4e24\u79cdlevel\u7684\u6df7\u5408\u4f7f\u7528\uff0c\u9ed8\u8ba4\u4f7f\u7528Statement\u6a21\u5f0f\uff0c\u6839\u636e\u5177\u4f53\u573a\u666f\u81ea\u52a8\u5207\u6362\u5230Row\u6a21\u5f0f\u3002</p> </li> </ul>"},{"location":"data_query/mysql/mysql.html","title":"Mysql","text":""},{"location":"data_query/mysql/mysql.html#_1","title":"\u539f\u7406","text":"<p>msyql \u4e2d\u7684\u6570\u636e\u662f\u4ee5\u9875(16k)\u4e3a\u5355\u4f4d\u4fdd\u5b58\u7684\uff0c\u65e0\u8bba\u8bfb\u5199\uff0c\u90fd\u9700\u8981\u627e\u5230\u6570\u636e\u6240\u5728\u7684\u9875\u624d\u884c\uff0c\u6570\u636e\u5728\u7f13\u5b58\u6c60\u4e2d\u4e5f\u662f\u4ee5\u9875\u4e3a\u5355\u4f4d\u4fdd\u5b58\u7684\u3002</p> <p></p>"},{"location":"data_query/mysql/mysql.html#_2","title":"\u6570\u636e\u6587\u4ef6\u968f\u673a\u8bfb\u5199","text":"<p>\u5bf9\u8868\u7a7a\u95f4\u7684\u78c1\u76d8\u6587\u4ef6\u91cc\u7684\u6570\u636e\u9875\u8fdb\u884c\u7684\u78c1\u76d8\u968f\u673a\u8bfb\u5199</p> <p>MySQL\u6267\u884c\u589e\u5220\u6539\u64cd\u4f5c\u65f6\uff0c\u5148\u4ece\u8868\u7a7a\u95f4\u7684\u78c1\u76d8\u6587\u4ef6\u91cc\u8bfb\u6570\u636e\u9875\u51fa\u6765\uff0c \u8fd9\u5c31\u662f\u78c1\u76d8\u968f\u673a\u8bfb\u3002</p> <ul> <li>\u8bfb\u53d6\u4e00\u4e2a\u6570\u636e\u9875\u4e4b\u540e\uff0c\u653e\u5230BP\u7684\u7f13\u5b58\uff0c\u4e0b\u6b21\u8981\u66f4\u65b0\u65f6\uff0c\u76f4\u63a5\u66f4\u65b0BP\u91cc\u7684\u7f13\u5b58\u9875\uff1b</li> <li>\u5982\u679c\u6570\u636e\u9875\u4e0d\u5728\u7f13\u5b58\u6c60\u4e2d\uff0c\u5219\u628a\u4fee\u6539\u8bb0\u5f55\u6682\u65f6\u4fdd\u5b58\u5728 change buffer \u7f13\u5b58\u4e2d\uff0c\u7b49\u6570\u636e\u9875\u88ab\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u65f6\u4fee\u6539\uff1b</li> <li>redo log  \u9632\u6b62\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u810f\u9875\u4e22\u5931</li> </ul> <p></p>"},{"location":"data_query/mysql/mysql.html#_3","title":"\u65e5\u5fd7\u987a\u5e8f\u8bfb\u5199","text":"<p>\u5bf9redo log\u3001binlog\u8fd9\u79cd\u65e5\u5fd7\u8fdb\u884c\u7684\u78c1\u76d8\u987a\u5e8f\u8bfb\u5199</p> <p>\u5f53\u4f60\u5728BP\u7684\u7f13\u5b58\u9875\u91cc\u66f4\u65b0\u6570\u636e\u540e\uff0c\u5fc5\u987b\u8981\u5199\u6761redo log\u65e5\u5fd7\uff0c\u5b83\u5c31\u662f\u987a\u5e8f\u5199\uff1a\u5728\u4e00\u4e2a\u78c1\u76d8\u65e5\u5fd7\u6587\u4ef6\u91cc\uff0c\u4e00\u76f4\u5728\u672b\u5c3e\u8ffd\u52a0\u65e5\u5fd7\u3002</p> <p></p>"},{"location":"data_query/nosql/mongoDB.html","title":"MongoDB","text":"<p>MongoDB \u662f\u7531C++\u8bed\u8a00\u7f16\u5199\u7684\uff0c\u662f\u4e00\u4e2a\u57fa\u4e8e\u5206\u5e03\u5f0f\u6587\u4ef6\u5b58\u50a8\u7684\u5f00\u6e90\u6570\u636e\u5e93\u7cfb\u7edf\u3002</p> SQL\u672f\u8bed/\u6982\u5ff5 MongoDB\u672f\u8bed/\u6982\u5ff5 \u89e3\u91ca/\u8bf4\u660e database database \u6570\u636e\u5e93 table collection \u6570\u636e\u5e93\u8868/\u96c6\u5408 row document \u6570\u636e\u8bb0\u5f55\u884c/\u6587\u6863 column field \u6570\u636e\u5b57\u6bb5/\u57df index index \u7d22\u5f15 table joins \u8868\u8fde\u63a5\uff0cMongoDB\u4e0d\u652f\u6301 primary key primary key \u4e3b\u952e\uff0cMongoDB\u81ea\u52a8\u5c06_id\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u4e3b\u952e <p>MongoDB\u7684\u9ed8\u8ba4\u6570\u636e\u5e93\u4e3a\"db\"\uff0c\u8be5\u6570\u636e\u5e93\u5b58\u50a8\u5728data\u76ee\u5f55\u4e2d\u3002</p> <p>MongoDB \u4e2d\u5b58\u50a8\u7684\u6587\u6863\u5fc5\u987b\u6709\u4e00\u4e2a _id \u952e\u3002\u8fd9\u4e2a\u952e\u7684\u503c\u53ef\u4ee5\u662f\u4efb\u4f55\u7c7b\u578b\u7684\uff0c\u9ed8\u8ba4\u662f\u4e2a ObjectId \u5bf9\u8c61\uff0c\u5305\u542b 12 bytes\uff1a</p> <ul> <li>\u524d 4 \u4e2a\u5b57\u8282\u8868\u793a\u521b\u5efa unix \u65f6\u95f4\u6233,\u683c\u6797\u5c3c\u6cbb\u65f6\u95f4 UTC \u65f6\u95f4\uff0c\u6bd4\u5317\u4eac\u65f6\u95f4\u665a\u4e86 8 \u4e2a\u5c0f\u65f6</li> <li>\u63a5\u4e0b\u6765\u7684 3 \u4e2a\u5b57\u8282\u662f\u673a\u5668\u6807\u8bc6\u7801</li> <li>\u7d27\u63a5\u7684\u4e24\u4e2a\u5b57\u8282\u7531\u8fdb\u7a0b id \u7ec4\u6210 PID</li> <li>\u6700\u540e\u4e09\u4e2a\u5b57\u8282\u662f\u968f\u673a\u6570</li> </ul>"},{"location":"data_query/nosql/mongoDB.html#_1","title":"\u5143\u6570\u636e","text":"<p>\u6570\u636e\u5e93\u7684\u4fe1\u606f\u662f\u5b58\u50a8\u5728\u96c6\u5408\u4e2d\u3002\u5b83\u4eec\u4f7f\u7528\u4e86\u7cfb\u7edf\u7684\u547d\u540d\u7a7a\u95f4\uff1a</p> <pre><code>dbname.system.*\n</code></pre> <p>\u5728MongoDB\u6570\u636e\u5e93\u4e2d\u540d\u5b57\u7a7a\u95f4 .system.* \u662f\u5305\u542b\u591a\u79cd\u7cfb\u7edf\u4fe1\u606f\u7684\u7279\u6b8a\u96c6\u5408(Collection)\uff0c\u5982\u4e0b: \u96c6\u5408\u547d\u540d\u7a7a\u95f4 \u63cf\u8ff0 dbname.system.namespaces \u5217\u51fa\u6240\u6709\u540d\u5b57\u7a7a\u95f4\u3002 dbname.system.indexes \u5217\u51fa\u6240\u6709\u7d22\u5f15\u3002 dbname.system.profile \u5305\u542b\u6570\u636e\u5e93\u6982\u8981(profile)\u4fe1\u606f\u3002 dbname.system.users \u5217\u51fa\u6240\u6709\u53ef\u8bbf\u95ee\u6570\u636e\u5e93\u7684\u7528\u6237\u3002 dbname.local.sources \u5305\u542b\u590d\u5236\u5bf9\u7aef\uff08slave\uff09\u7684\u670d\u52a1\u5668\u4fe1\u606f\u548c\u72b6\u6001\u3002"},{"location":"data_query/nosql/mongoDB.html#mongodb_1","title":"MongoDB \u6570\u636e\u7c7b\u578b","text":"<p>\u4e0b\u8868\u4e3aMongoDB\u4e2d\u5e38\u7528\u7684\u51e0\u79cd\u6570\u636e\u7c7b\u578b\u3002</p> \u6570\u636e\u7c7b\u578b \u63cf\u8ff0 String \u5b57\u7b26\u4e32\u3002\u5b58\u50a8\u6570\u636e\u5e38\u7528\u7684\u6570\u636e\u7c7b\u578b\u3002\u5728 MongoDB \u4e2d\uff0cUTF-8 \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u624d\u662f\u5408\u6cd5\u7684\u3002 Integer \u6574\u578b\u6570\u503c\u3002\u7528\u4e8e\u5b58\u50a8\u6570\u503c\u3002\u6839\u636e\u4f60\u6240\u91c7\u7528\u7684\u670d\u52a1\u5668\uff0c\u53ef\u5206\u4e3a 32 \u4f4d\u6216 64 \u4f4d\u3002 Boolean \u5e03\u5c14\u503c\u3002\u7528\u4e8e\u5b58\u50a8\u5e03\u5c14\u503c\uff08\u771f/\u5047\uff09\u3002 Double \u53cc\u7cbe\u5ea6\u6d6e\u70b9\u503c\u3002\u7528\u4e8e\u5b58\u50a8\u6d6e\u70b9\u503c\u3002 Min/Max keys \u5c06\u4e00\u4e2a\u503c\u4e0e BSON\uff08\u4e8c\u8fdb\u5236\u7684 JSON\uff09\u5143\u7d20\u7684\u6700\u4f4e\u503c\u548c\u6700\u9ad8\u503c\u76f8\u5bf9\u6bd4\u3002 Array \u7528\u4e8e\u5c06\u6570\u7ec4\u6216\u5217\u8868\u6216\u591a\u4e2a\u503c\u5b58\u50a8\u4e3a\u4e00\u4e2a\u952e\u3002 Timestamp \u65f6\u95f4\u6233\u3002\u8bb0\u5f55\u6587\u6863\u4fee\u6539\u6216\u6dfb\u52a0\u7684\u5177\u4f53\u65f6\u95f4\u3002 Object \u7528\u4e8e\u5185\u5d4c\u6587\u6863\u3002 Null \u7528\u4e8e\u521b\u5efa\u7a7a\u503c\u3002 Symbol \u7b26\u53f7\u3002\u8be5\u6570\u636e\u7c7b\u578b\u57fa\u672c\u4e0a\u7b49\u540c\u4e8e\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u4f46\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u4e00\u822c\u7528\u4e8e\u91c7\u7528\u7279\u6b8a\u7b26\u53f7\u7c7b\u578b\u7684\u8bed\u8a00\u3002 Date \u65e5\u671f\u65f6\u95f4\u3002\u7528 UNIX \u65f6\u95f4\u683c\u5f0f\u6765\u5b58\u50a8\u5f53\u524d\u65e5\u671f\u6216\u65f6\u95f4\u3002\u4f60\u53ef\u4ee5\u6307\u5b9a\u81ea\u5df1\u7684\u65e5\u671f\u65f6\u95f4\uff1a\u521b\u5efa Date \u5bf9\u8c61\uff0c\u4f20\u5165\u5e74\u6708\u65e5\u4fe1\u606f\u3002 Object ID \u5bf9\u8c61 ID\u3002\u7528\u4e8e\u521b\u5efa\u6587\u6863\u7684 ID\u3002 Binary Data \u4e8c\u8fdb\u5236\u6570\u636e\u3002\u7528\u4e8e\u5b58\u50a8\u4e8c\u8fdb\u5236\u6570\u636e\u3002 Code \u4ee3\u7801\u7c7b\u578b\u3002\u7528\u4e8e\u5728\u6587\u6863\u4e2d\u5b58\u50a8 JavaScript \u4ee3\u7801\u3002 Regular expression \u6b63\u5219\u8868\u8fbe\u5f0f\u7c7b\u578b\u3002\u7528\u4e8e\u5b58\u50a8\u6b63\u5219\u8868\u8fbe\u5f0f\u3002 <p>BSON \u5b57\u7b26\u4e32\u90fd\u662f UTF-8 \u7f16\u7801\u3002</p>"},{"location":"data_query/nosql/hbase/index.html","title":"HBase","text":"<p>Hadoop database, a distributed, scalable, big data store.</p> <p>Billion rows with millions columns.</p> <p>HBase 2.0\u7248\u672c\u652f\u6301\u5c06\u4e0d\u540c\u7684\u8868\uff0c\u5e95\u5c42\u5b58\u50a8\u5728\u4e0d\u540c\u7684\u4ecb\u8d28\u4e0a\uff08HDFS\u7684\u5206\u5c42\u5b58\u50a8\uff09\uff1b</p>"},{"location":"data_query/nosql/hbase/index.html#_1","title":"\u573a\u666f","text":""},{"location":"data_query/nosql/hbase/index.html#_2","title":"\u7279\u6027","text":"<ul> <li>\u5bb9\u91cf\u5de8\u5927\uff1a\u5355\u8868\u652f\u6301\u5343\u4ebf\u884c\u3001\u767e\u4e07\u5217\uff0c\u8fbeTB\u751a\u81f3PB\u7ea7\u522b\uff1b</li> <li>\u53ef\u6269\u5c55\u6027\uff1a\u6570\u636e\u53ef\u6269\u5c55\u6027\uff08HDFS\uff09\uff0c\u8bfb\u5199\u670d\u52a1\u53ef\u6269\u5c55\u6027\uff08RegionServer\uff09\uff0c\u5b58\u7b97\u5206\u79bb\uff1b</li> <li>\u7a00\u758f\u6027\uff1a\u5141\u8bb8\u5217\u503c\u4e3a\u7a7a\uff0c\u4e0d\u8fdb\u884c\u5b58\u50a8\uff1b</li> <li>\u9ad8\u6027\u80fd\uff1aOLAP\u573a\u666f\uff0c\u5199\u64cd\u4f5c\u6027\u80fd\u597d\uff0c\u968f\u673a\u8bfb\u4ee5\u53ca\u5c0f\u8303\u56f4\u626b\u63cf\uff0c\u6027\u80fd\u4e5f\u6709\u4fdd\u8bc1\uff1b</li> <li>\u591a\u7248\u672c\uff1a\u65f6\u95f4\u6233\u5b9e\u73b0\u591a\u7248\u672c\u6570\u636e\uff0c\u9009\u62e9\u6700\u65b0\u6216\u8005\u5386\u53f2\u7248\u672c\u6570\u636e\uff1b</li> <li>\u8fc7\u671f\uff1a\u652f\u6301\u6570\u636eTTL\u7279\u6027\uff1b</li> <li>Hadoop\u539f\u751f\u652f\u6301\uff1a</li> <li>\u76f4\u63a5\u64cd\u4f5cHDFS\u6587\u4ef6\uff0c\u5b9e\u73b0\u6570\u636e\u626b\u63cf\u6216\u8005\u6570\u636e\u5bfc\u5165\uff1b</li> <li>HBase\u6570\u636e\u5206\u7ea7\u5b58\u50a8\uff0c\u91cd\u8981\u4e1a\u52a1\u6216\u6700\u8fd1\u6570\u636e\u653eSSD\uff0c\u4e0d\u91cd\u8981\u4e1a\u52a1\u6216\u5f52\u6863\u6570\u636e\u653eHDD\uff1b</li> </ul>"},{"location":"data_query/nosql/hbase/index.html#_3","title":"\u7f3a\u70b9","text":"<ul> <li>HBase\u672c\u8eab\u4e0d\u652f\u6301\u590d\u6742\u7684\u805a\u5408\u8fd0\u7b97\uff08\u5982Join\u3001GroupBy\u7b49\uff09\uff0c\u53ef\u4ee5\u901a\u8fc7HBase+Phoenix\uff08\u5c0f\u89c4\u6a21\u805a\u5408OLTP\uff09\u6216\u5355\u72ec\u7684Spark\uff08\u5927\u89c4\u6a21OLAP\uff09\u8fdb\u884c\uff1b</li> <li>HBase\u672c\u8eab\u6ca1\u6709\u4e8c\u7ea7\u7d22\u5f15\u529f\u80fd\uff0c\u53ef\u4ee5\u901a\u8fc7 Phoenix \u5b9e\u73b0\uff1b</li> <li>HBase\u539f\u751f\u4e0d\u652f\u6301\u5168\u5c40\u7684\u8de8\u884c\u4e8b\u52a1\uff0c\u53ea\u652f\u6301\u5355\u884c\u4e8b\u52a1\u6a21\u578b\uff0c\u53ef\u4ee5\u901a\u8fc7 Phoenix \u5b9e\u73b0\u3002</li> </ul>"},{"location":"data_query/nosql/hbase/index.html#_4","title":"\u6570\u636e\u6a21\u578b","text":""},{"location":"data_query/nosql/hbase/index.html#_5","title":"\u6982\u5ff5","text":""},{"location":"data_query/nosql/hbase/index.html#_6","title":"\u7269\u7406\u89c6\u56fe","text":""},{"location":"data_query/nosql/hbase/index.html#_7","title":"\u540d\u7a7a\u95f4","text":""},{"location":"data_query/nosql/hbase/index.html#table","title":"Table","text":"<p>\u8868\uff0c\u4e00\u5f20\u8868\u5305\u542b\u591a\u884c\u6570\u636e\u3002</p>"},{"location":"data_query/nosql/hbase/index.html#row","title":"Row","text":"<p>\u884c\uff0c\u4e00\u884c\u6570\u636e\u5305\u542b\u552f\u4e00\u6807\u8bc6RowKey\u3001\u591a\u4e2acolumn\u548c\u5bf9\u5e94\u7684\u503c\u3002\u4e0d\u540c\u884c\u6309Rowkey\u7684\u5b57\u5178\u5e8f\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u3002</p>"},{"location":"data_query/nosql/hbase/index.html#column","title":"Column","text":"<p>\u5217\uff0c\u7531\u5217\u7c07\uff08column family\uff09\u548c\u5217\u540d\uff08qualifier\uff09\u7ec4\u6210\uff0c\u901a\u8fc7\":\"\u8fde\u63a5\u3002</p> <ul> <li>\u5217\u7c07\u662f\u5efa\u8868\u65f6\u6307\u5b9a\uff0c\u7528\u6237\u4e0d\u80fd\u968f\u610f\u589e\u51cf\uff1b\u4f46\u5217\u540d\uff08qualifier\uff09\u53ef\u4ee5\u52a8\u6001\u6269\u5145\u3002</li> <li>\u6bcf\u4e2a\u5217\u7c07\u7684\u6570\u636e\u96c6\u4e2d\u5b58\u653e\u5728\u4e00\u4e2a\u5b58\u50a8\u5355\u5143Store\u4e2d\uff0c\u5efa\u8bae\u5c06\u5177\u6709\u76f8\u540c\u7279\u6027\u7684\u6570\u636e\u8bbe\u7f6e\u5728\u540c\u4e00\u4e2a\u5217\u7c07\u4e2d\u3002</li> <li>\u5217\u7c07\u5185\u662f\u884c\u5b58\uff0c\u5217\u7c07\u95f4\u662f\u5217\u5b58\u3002</li> </ul>"},{"location":"data_query/nosql/hbase/index.html#timestamp","title":"Timestamp","text":"<p>\u65f6\u95f4\u6233\uff0c\u6bcf\u4e2acell\u5199\u5165HBase\u7684\u65f6\u5019\u4f1a\u9ed8\u8ba4\u5206\u914d\u65f6\u95f4\u6233\u4f5c\u4e3a\u7248\u672c\u4fe1\u606f\uff0c\u65f6\u95f4\u6233\u4e5f\u53ef\u4ee5\u7528\u6237\u5199\u5165\u65f6\u6307\u5b9a\u3002</p> <p>\u901a\u8fc7\u65f6\u95f4\u6233\uff0c\u652f\u6301\u591a\u7248\u672c\u7279\u6027\uff0c\u540c\u4e00\u4e2arowkey\u3001column\u4e0b\u6709\u591a\u4e2avalue\u5b58\u5728\uff0c\u7248\u672c\u53f7\u8d8a\u5927\uff0c\u6570\u636e\u8d8a\u65b0\u3002</p>"},{"location":"data_query/nosql/hbase/index.html#cell","title":"Cell","text":"<p>\u5355\u5143\u683c\uff0c\u7531\uff08row\uff0ccolumn\uff0ctimestamp\uff0ctype\uff0cvalue\uff09\u7ec4\u6210\u7684\u7ed3\u6784\uff0ctype\u8868\u793a\u662fPUT\u6216DELETE\u3002</p> <ul> <li>\u7a00\u758f\u7279\u6027\u3002</li> </ul> <p>KeyValue\uff1a\u4e00\u4e9bKey\u76f8\u540c\u7684\u4efb\u610f\u6570\u91cf\u7684\u72ec\u7acbKeyValue\u5c31\u53ef\u4ee5\u6784\u6210\u4e00\u884c\u6570\u636e\uff0c\u6bcf\u4e00\u4e2aKeyValue\u6240\u643a\u5e26\u7684\u81ea\u6211\u63cf\u8ff0\u4fe1\u606f\uff0c\u4f1a\u5e26\u6765\u663e\u8457\u7684\u6570\u636e\u81a8\u80c0\u3002\uff08\u5b58\u50a8\u7684\u65f6\u5019\u4f1a\u6709\u538b\u7f29\u4e48\uff1f\uff09</p>"},{"location":"data_query/nosql/hbase/index.html#_8","title":"\u67b6\u6784","text":""},{"location":"data_query/nosql/hbase/index.html#zookeeper","title":"Zookeeper","text":"<ul> <li>Master\u9ad8\u53ef\u7528\uff1a\u901a\u8fc7ZK\u5206\u5e03\u5f0f\u9501\uff0c\u9009\u4e3e\u51faMaster\uff1b</li> <li>\u6838\u5fc3\u5143\u6570\u636e\uff1aRegionServer\u96c6\u5408\uff0c\u5143\u6570\u636e\u8868<code>hbase:meta</code>\u6240\u5728\u7684RegionServer\u96c6\u5408\uff1b</li> <li>RegionServer\u5b95\u673a\u6062\u590d\uff1aZK\u901a\u8fc7\u5fc3\u8df3\u611f\u77e5RegionServer\u5b58\u6d3b\uff0c\u5b95\u673a\u540e\u901a\u77e5Master\u8fdb\u884c\u5904\u7406\uff1b</li> <li>\u5206\u5e03\u5f0f\u8868\u9501\uff1aHBase\u4e2d\u5bf9\u8868\u8fdb\u884c\u7ba1\u7406\u64cd\u4f5c\u65f6\uff0c\u9700\u8981\u9501\u8868\uff0c\u9632\u6b62\u5176\u4ed6\u7528\u6237\u540c\u65f6\u8fdb\u884c\u8868\u7ba1\u7406\u64cd\u4f5c\u3002</li> </ul>"},{"location":"data_query/nosql/hbase/index.html#master","title":"Master","text":"<ul> <li>\u8868\u7ba1\u7406\u8bf7\u6c42\u5904\u7406\uff1a\u5982\u5efa\u8868\u3001\u4fee\u6539\u8868\u3001\u6743\u9650\u64cd\u4f5c\u3001\u5207\u5206\u8868\u3001\u5408\u5e76\u6570\u636e\u5206\u7247\u4ee5\u53caCompaction\u7b49\uff1b</li> <li>\u7ba1\u7406RegionSever\uff1a\u5982RegionServer\u7684\u8d1f\u8f7d\u5747\u8861\u3001RegionServer\u7684\u5b95\u673a\u6062\u590d\u548cRegion\u7684\u8fc1\u79fb\uff1b</li> <li>\u6e05\u7406\u5de5\u4f5c\uff1a\u6e05\u7406\u8fc7\u671f\u65e5\u5fd7\u548c\u6587\u4ef6\uff0c\u5982HLog\u662f\u5426\u8fc7\u671f\u3001HFile\u662f\u5426\u5df2\u7ecf\u88ab\u5220\u9664\uff0c\u5e76\u5728\u8fc7\u671f\u4e4b\u540e\u8fdb\u884c\u5220\u9664\u3002</li> </ul>"},{"location":"data_query/nosql/hbase/index.html#regionserver","title":"RegionServer","text":"<ul> <li>WAL\uff08HLog\uff09\uff1aWrite-Ahead Log\uff0c</li> <li>\u6570\u636e\u9ad8\u53ef\u9760\u6027\uff1a\u968f\u673a\u5199\u65f6\uff0c\u6570\u636e\u5148\u987a\u5e8f\u5199\u5165HLog\uff08\u9632\u6b62\u7f13\u5b58\u6570\u636e\u4e22\u5931\uff09\uff0c\u518d\u5199\u5165\u7f13\u5b58\uff0c\u518d\u5f02\u6b65\u5237\u65b0\u843d\u76d8\u3002</li> <li>\u96c6\u7fa4\u95f4\u4e3b\u4ece\u590d\u5236\uff1a\u901a\u8fc7\u56de\u653e\u4e3b\u96c6\u7fa4\u63a8\u9001\u8fc7\u6765\u7684HLog\u65e5\u5fd7\u5b9e\u73b0\u4e3b\u4ece\u590d\u5236\u3002</li> <li>BlockCache\uff1a\u8bfb\u7f13\u5b58\uff0c\u65f6\u95f4\u5c40\u90e8\u6027\u548c\u7a7a\u95f4\u5c40\u90e8\u6027\u539f\u7406\uff0c\u7531<code>LRUBlockCache</code>\u548c<code>BucketCache</code>\u4e24\u79cd\u3002</li> <li>Region\uff1a\u6570\u636e\u8868\u7684\u4e00\u4e2a\u5206\u7247\uff0c\u662f\u96c6\u7fa4\u8d1f\u8f7d\u805a\u6052\u7684\u57fa\u672c\u5355\u4f4d\u3002Region\u7531Store\u7ec4\u6210\uff0c\u4e00\u4e2a\u5217\u7c07\u5bf9\u5e94\u4e00\u4e2aStore\uff1a</li> <li>Store\uff1aStore\u7531\u4e00\u4e2aMemStore\u548c\u591a\u4e2aHFile\u7ec4\u6210\uff1a<ul> <li>MemStore\uff1a\u5199\u7f13\u5b58\uff0c\u8d85\u8fc7\u9608\u503c\u65f6\uff0c\u5f02\u6b65\u5c06\u6570\u636eflush\u6210HFile\u6587\u4ef6\uff1b</li> <li>HFile\uff1a\u78c1\u76d8\u6570\u636e\u6587\u4ef6\uff0cHFile\u6587\u4ef6\u6570\u8fc7\u591a\u65f6\uff0c\u4f1a\u89e6\u53d1Compact\u64cd\u4f5c\uff0c\u591a\u4e2a\u6587\u4ef6\u5408\u6210\u4e00\u4e2a\u6587\u4ef6\u3002</li> </ul> </li> </ul>"},{"location":"data_query/nosql/hbase/index.html#hdfs","title":"HDFS","text":"<ul> <li>\u5e95\u5c42\u6570\u636e\u5b58\u50a8\u7cfb\u7edf\uff0c\u901a\u8fc7HDFS\u4fdd\u8bc1\u6570\u636e\uff08HFile/HLog\uff09\u7684\u9ad8\u53ef\u7528\u6027\u3002</li> </ul>"},{"location":"data_query/nosql/hbase/index.html#data-model-operations","title":"Data Model Operations","text":""},{"location":"data_query/nosql/hbase/index.html#versions","title":"Versions","text":""},{"location":"data_query/nosql/hbase/index.html#sort-order","title":"Sort Order","text":""},{"location":"data_query/nosql/hbase/index.html#column-metadata","title":"Column Metadata","text":""},{"location":"data_query/nosql/hbase/index.html#joins","title":"Joins","text":""},{"location":"data_query/nosql/hbase/index.html#acid","title":"ACID","text":""},{"location":"data_query/nosql/hbase/architecture.html","title":"\u67b6\u6784","text":""},{"location":"data_query/nosql/hbase/architecture.html#overview","title":"Overview","text":"<p>HBase\u7684\u7279\u6027\uff1a</p> <ul> <li>\u5f3a\u4e00\u81f4\u6027\u7684\u8bfb/\u5199\uff1aHBase\u4e0d\u662f\u6700\u7ec8\u4e00\u81f4\u6027\u7684\u6570\u636e\u5b58\u50a8(DataStore)\uff0c high-speed counter aggregation\uff1b</li> <li>\u81ea\u52a8\u7684\u5206\u7247\uff1a\u8868\u5206\u5e03\u7531regions\u6784\u6210\uff0cregions\u81ea\u52a8\u5206\u88c2\u4e14\u81ea\u52a8\u5728\u96c6\u7fa4\u4e2d\u91cd\u65b0\u5206\u5e03\uff1b</li> <li>\u81ea\u52a8RegionServer \u5bb9\u9519\uff1b</li> <li>Hadoop/HDFS\u7ee7\u627f\uff1a\u4f7f\u7528HDFS\u4f5c\u4e3a\u5e95\u5c42\u5b58\u50a8\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff1b</li> </ul>"},{"location":"data_query/nosql/hbase/architecture.html#regions","title":"Regions","text":""},{"location":"data_query/nosql/hbase/architecture.html#store","title":"Store","text":"<p>A Store = A MemStore + 0 or more StoreFiles ( HFiles ) </p> <p>\u200b              =  A column family for a table for a given region</p>"},{"location":"data_query/nosql/hbase/architecture.html#memstore","title":"MemStore","text":"<p>\u4fdd\u5b58\u5bf9\u4e8eStore\u7684\u5728\u5185\u5b58\u4e2d\u7684\u4fee\u6539\uff0c\u4fee\u6539\u662f\u4ee5KeyValue/Cell\u4e3a\u5355\u4f4d\u3002\u5f53flush\u65f6\uff0cMemStore\u4f1a\u5f62\u6210\u4e00\u4e2a\u5feb\u7167\u5e76\u6e05\u7a7a\uff0c\u4e14region\u4e0b\u7684\u6240\u6709MemStores\u90fd\u4f1a\u88abflush\u3002</p> <p>HBase continues to serve edits from the new MemStore and backing snapshot until the flusher reports that the flush succeeded. </p> <p>\u6bcf\u4e2aregion\u7684memstore\u7684\u4e2a\u6570 = \u8868\u7684\u5217\u65cf\u7684\u4e2a\u6570 </p>"},{"location":"data_query/nosql/hbase/architecture.html#memstore-flush","title":"MemStore Flush","text":"<p>\u89e6\u53d1 Flush\u9700\u8981\u6ee1\u8db3\u4ee5\u4e0b\u4efb\u4e00\u6761\u4ef6\uff1a\u6700\u5c0f\u7684flush\u5355\u5143\u662fregion\uff0cnot at individual MemStore Level</p> <ul> <li>\u5f53\u4e00\u4e2aMemStore\u8fbe\u5230hbase.hregion.memstore.flush.size</li> <li>\u6240\u6709\u5c5e\u4e8e\u8be5region\u7684memstore\u90fd\u4f1a\u88abflush\u5230\u78c1\u76d8\uff1b</li> <li>\u5982\u679c\u6570\u636e\u8d85\u8fc7hbase.hregion.memstore.flush.size * hbase.hregion.memstore.block.multiplier\uff0c\u5219\u4f1a\u963b\u585e\u6240\u6709\u5199\u5165Store\u7684\u8bf7\u6c42\uff1b</li> <li>\u5f53\u6240\u6709MemStore\u7684\u7528\u91cf\u8d85\u8fc7hbase.regionserver.global.memstore.size</li> <li>\u591a\u4e2aregions\u7684MemStores\u4f1a\u88abflush\u5230\u78c1\u76d8\u51cf\u5c11\u4e00\u4e2aRegionServer\u7684\u6574\u4f53MemStore\u7528\u91cf\uff1b</li> <li>flush\u7684\u987a\u5e8f\u662f\u6309\u7167region\u7684MemStore\u7528\u91cf\u964d\u5e8f\uff1b</li> <li>Regions\u4f1aflush\u81ea\u5df1\u7684MemStores\uff0c\u76f4\u5230\u6574\u4f53\u7684MemStore\u7528\u91cf\u5c0f\u4e8e\u7b49\u4e8ehbase.regionserver.global.memstore.size.lower.limit\uff1b</li> <li>RegionServer\u7684WAL log\u7684\u6570\u91cf\u8d85\u8fc7hbase.regionserver.max.logs</li> <li>\u591a\u4e2aregions\u7684MemStores\u4f1a\u88abflush\u5230\u78c1\u76d8\u6765\u51cf\u5c11WAL log\u6570\u91cf\uff1b</li> <li>flush\u7684\u987a\u5e8f\u662f\u6839\u636e\u65f6\u95f4\uff1b\u6700\u8001\u7684MemStores\u7684Regions\u9996\u5148\u88abflush\uff0c\u76f4\u5230WAL log\u6570\u5c0f\u4e8e\u9608\u503c\uff1b</li> </ul> <p>TODO\uff1a\u5237\u5199\u7684\u903b\u8f91\uff0c\u548c\u963b\u585e\u7684\u5224\u65ad\uff1f\uff1f</p>"},{"location":"data_query/nosql/hbase/architecture.html#scans","title":"Scans","text":""},{"location":"data_query/nosql/hbase/architecture.html#storefilehfile","title":"StoreFile(HFile)","text":"<p>StoreFile\u662f\u6570\u636e\u5b58\u6d3b\u7684\u5730\u65b9</p>"},{"location":"data_query/nosql/hbase/architecture.html#hfile","title":"HFile\u5408\u5e76\u7b56\u7565","text":"<p>minor compaction</p> <p>major compaction</p> <p>ExploringCompactionPolicy\uff1a\u628a\u6240\u6709\u7684HFile\u90fd\u904d\u5386\u4e00\u904d\u4e4b\u540e\u624d\u4f1a\u53bb\u8003\u8651\u5408\u5e76\u54ea\u4e2aHFile,\u7b26\u5408\u5408\u5e76\u6761\u4ef6\u7684\u8ba1\u7b97\u516c\u5f0f\u662f</p> <pre><code>if current_hfile_size &lt; hbase.hstore.compaction.min.size :\n    return \"Compaction\"\nif current_hfile_size &gt; hbase.hstore.compaction.max.size:\n    return \"NoCompaction\"\n\n# TODO: \u8be6\u7ec6\u7684\u89c4\u5219\nif current_hfile_size &lt; (sum_hfile - current_hfile_size) * \u6bd4\u4f8b\u56e0\u5b50\n</code></pre> <p>TODO\uff1a\u5176\u4ed6\u7b56\u7565</p>"},{"location":"data_query/nosql/hbase/architecture.html#region-split","title":"Region Split","text":"<p>Region Split \u7684\u914d\u7f6e\u89c1Region_Split_Configuration</p>"},{"location":"data_query/nosql/hbase/architecture.html#_2","title":"\u5207\u5206\u70b9\u7684\u5b9a\u4e49","text":"<p>\u6574\u4e2aregion\u4e2d\u6700\u5927store\u4e2d\uff08\u4e0d\u540c\u5217\u65cf\uff09\u7684\u6700\u5927\u6587\u4ef6\u4e2d\uff08\u4e0d\u540cstoreFile\uff09\u6700\u4e2d\u5fc3\u7684\u4e00\u4e2ablock\u7684\u9996\u4e2arowkey\u3002</p> <p>\u6ce8\u610f\uff1a\u5982\u679c\u5b9a\u4f4d\u5230\u7684rowkey\u662f\u6574\u4e2a\u6587\u4ef6\u7684\u9996\u4e2arowkey\u6216\u8005\u6700\u540e\u4e00\u4e2arowkey\u7684\u8bdd\uff0c\u5c31\u8ba4\u4e3a\u6ca1\u6709\u5207\u5206\u70b9\u3002\u5982\u4e00\u4e2a\u6587\u4ef6\u53ea\u6709\u4e00\u4e2ablock\u7684\u60c5\u51b5\u3002</p>"},{"location":"data_query/nosql/hbase/architecture.html#_3","title":"\u5199\u5165\u6d41\u7a0b","text":"<p>\u5ba2\u6237\u7aef\u901a\u8fc7\u53d1\u8bf7\u6c42\u5230RegionServer\u7aef\uff0c\u5199\u5165\u7684\u65f6\u5019\u4f1a\u5148\u5199\u5165WAL\u65e5\u5fd7\u4e2d\uff0c\u5176\u6b21\u4f1a\u5c06\u6570\u636e\u5199\u5165memstore\u5185\u5b58\uff0c\u5f53\u6570\u636e\u8fbe\u5230\u4e00\u5b9a\u5927\u5c0f\u540e\u4f1aflush\u6210\u4e00\u4e2a\u4e2a\u7684HFile\u6587\u4ef6\uff0c\u5f53\u6587\u4ef6\u8fbe\u5230\u4e00\u5b9a\u6570\u91cf\u540e\uff0c\u901a\u8fc7compaction\u7684\u64cd\u4f5c\u5408\u5e76\u6210\u66f4\u5927\u6587\u4ef6\uff0c\u8fd9\u6837\u6570\u636e\u8bfb\u53d6\u4f1a\u66f4\u5feb\u3002</p>"},{"location":"data_query/nosql/hbase/architecture.html#_4","title":"\u8bfb\u53d6\u6d41\u7a0b","text":"<p>\u5f53\u8fdb\u884c\u8bfb\u53d6\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u5148\u53d1\u9001scan\u8bf7\u6c42\u5230RegionServer\uff0c\u6253\u5f00scanner\uff0c\u7136\u540e\u8c03next\u8bf7\u6c42\u83b7\u53d6\u4e00\u884c\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u5c06\u4e00\u6279\u6570\u636e\u5148\u653e\u5165Result\u7684Cache\u4e2d\u53bb\uff0c\u5ba2\u6237\u7aef\u4e0d\u65ad\u8fed\u4ee3\u83b7\u53d6\u5185\u5bb9\u3002</p>"},{"location":"data_query/nosql/hbase/architecture.html#blockcache","title":"BlockCache","text":"<p>\u8bfb\u53d6\u7684\u65f6\u5019\uff0c\u5148\u53bbMemStore\u4e2d\u83b7\u53d6\uff0c\u518d\u53bbBlockCache\uff0c\u6700\u540e\u5230HFile\u4e2d\u3002</p> <p>BlockCache \u4e2d\u7684Block \u662fHBase\u4ece\u786c\u76d8\u5b8c\u6210\u4e00\u6b21\u8bfb\u53d6\u7684\u6570\u636e\u5355\u4f4d\u3002HFile \u7269\u7406\u5b58\u653e\u5f62\u5f0f\u662f\u4e00\u4e2aBlock \u7684\u5e8f\u5217\u5916\u52a0\u8fd9\u4e9bBlock\u7684\u7d22\u5f15\u3002</p> <p>LRUBlock Cache\uff1a\u57fa\u4e8eJVM Heap\u7684Cache\uff1b</p> <p>Bucket Cache\uff1a\u57fa\u4e8e\u5806\u5916\u5185\u5b58\uff0c\u4e8c\u7ea7\u7d22\u5f15\u673a\u5236\uff0c\u4e00\u7ea7\u7d22\u5f15\u662fLRUBlockCache\uff08\u5b58\u653eIndex Block \u548c Bloom Block\uff09\uff1b</p> <p><code>-XX:MaxDirectMemorySize</code>\uff1a\u5b9a\u4e49JVM\u53ef\u4ee5\u83b7\u5f97\u7684\u5806\u5916\u5185\u5b58\u4e0a\u9650\uff0c\u5982\u679c\u4e0d\u914d\u7f6e\u8fd9\u4e2a\u53c2\u6570\uff0cJVM\u4f1a\u6309\u9700\u7d22\u53d6\u5806\u5916\u5185\u5b58\uff0c\u8fd9\u4e2a\u53c2\u6570\u503c\u5fc5\u987b\u6bd4<code>hbase.bucketcache.size</code>\u5927\u3002</p>"},{"location":"data_query/nosql/hbase/bloom_filter.html","title":"\u5e03\u9686\u8fc7\u6ee4\u5668","text":"<p>\u4f7f\u7528\u573a\u666f\uff1a</p>"},{"location":"data_query/nosql/hbase/client_api.html","title":"\u4f7f\u7528\uff08API\uff09","text":""},{"location":"data_query/nosql/hbase/client_api.html#shell","title":"Shell","text":"<p>\u542f\u52a8hbase shell</p> <pre><code>./bin/hbase shell\n</code></pre> <p>\u76f8\u5173\u547d\u4ee4</p> <pre><code>create 'table_name', 'column_family'\n\nlist 'table_name'\n\ndescribe 'table_name'\n\nput 'table_name', 'row_key', cf:a', 'value1'\n\nscan 'table_name'\n\nget 'table_name', 'row_key'\n\ndisable 'table_name'\n\nenable 'table_name'\n\ndrop 'table_name'\n</code></pre> <p>\u7edf\u8ba1\u884c\u6570</p> <pre><code>hbase org.apache.hadoop.hbase.mapreduce.RowCounter 'table_name'\n</code></pre>"},{"location":"data_query/nosql/hbase/client_api.html#java-client","title":"Java Client","text":"<p>HBase 2.0\uff0c\u4e0d\u518d\u7528HTable\u4f5c\u4e3aclient API\uff0c\u901a\u8fc7ConnectionFactory\u521b\u5efaConnection\uff0c\u5728getTable\uff1b</p> <ul> <li>\u5c3d\u91cf\u4f7f\u7528\u6279\u5904\u7406\u66f4\u65b0\u6765\u51cf\u5c11\u5355\u72ec\u64cd\u4f5c\u540c\u4e00\u884c\u7684\u6570\u636e\uff1b</li> <li>\u4fee\u6539\u64cd\u4f5c\u53ea\u4fdd\u8bc1\u884c\u7ea7\u7684\u539f\u5b50\u6027\uff1b</li> </ul>"},{"location":"data_query/nosql/hbase/client_api.html#connection","title":"Connection","text":"<p>\u5728\u6574\u4e2a\u5e94\u7528\uff08\u8fdb\u7a0b\uff09\u7684\u8303\u56f4\u5185\u53ea\u7ef4\u62a4\u4e00\u4e2a\u5171\u7528\u7684Connection </p> <ul> <li>Connection\u5bf9\u8c61\u9700\u8981\u77e5\u9053\u5982\u4f55\u627e\u5230HMaster\u3001\u5982\u4f55\u5728RegionServer\u4e0a\u5b9a\u4f4dRegion\uff0c\u4ee5\u53ca\u611f\u77e5Region\u7684\u53d8\u52a8\u3002\u6240\u4ee5\uff0cConnection\u9700\u8981\u540c\u65f6\u4e0eHMaster\u3001RegionServer\u548cZK\u5efa\u7acb\u8fde\u63a5\u3002</li> <li>\u521b\u5efaConnection\u662f\u91cd\u91cf\u7ea7\u7684\uff0c\u5df2\u7ecf\u5b9e\u73b0\u4e86\u5bf9\u8fde\u63a5\u7684\u7ba1\u7406\u529f\u80fd\uff0c\u5e76\u4e14\u5b83\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002</li> <li>\u7531Connection\u53d6\u5f97\u7684Table\u548cAdmin\u5bf9\u8c61\u662f\u8f7b\u91cf\u7ea7\u7684\uff0c\u5e76\u4e14\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u6240\u4ee5\u5b83\u4eec\u5e94\u8be5\u5373\u7528\u5373\u5f03\u3002</li> </ul> <p>\u5728\u5e76\u53d1\u7cfb\u7edf\u4e2d\uff0c\u591a\u4e2a\u7ebf\u7a0b\u6bcf\u4e2a\u90fd\u53bb\u521b\u5efa\u4e00\u4e2aConnection\u5bf9\u8c61\uff0cHBase Zookeeper\u7684\u8fde\u63a5\u88ab\u5927\u91cf\u5360\u7528\uff0c\u67d0\u4e00\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5Zookeeper\u7684\u8fde\u63a5\u6570\u8d85\u8fc7\u4e86zk\u914d\u7f6e\uff0c\u5927\u91cf\u8fde\u63a5\u521b\u5efa\u7684\u8bf7\u6c42\u88ab\u62d2\u7edd\u3002\u8fd9\u6837\u4f1a\u589e\u52a0ZK\u7684\u538b\u529b\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u5ba2\u6237\u7aef\u7cfb\u7edf\u6027\u80fd\u6025\u5267\u4e0b\u964d\u3002</p>"},{"location":"data_query/nosql/hbase/client_api.html#put","title":"\u589e/\u6539\uff08PUT\uff09","text":"<ul> <li>HBase 2.0 \u6ca1\u6709\u5199\u7f13\u51b2\u533a\uff0c Table.put\u548cTable.batch\u662fnon-writeBuffer</li> <li>\u539f\u5b50\u6027\u64cd\u4f5c\uff0c<code>checkAndMutate</code></li> </ul>"},{"location":"data_query/nosql/hbase/client_api.html#get","title":"\u67e5\uff08GET\uff09","text":""},{"location":"data_query/nosql/hbase/client_api.html#delete","title":"\u5220\uff08DELETE\uff09","text":""},{"location":"data_query/nosql/hbase/client_api.html#batch","title":"\u6279\u91cf\u64cd\u4f5c\uff08Batch\uff09","text":"<p>batch</p> <ul> <li>\u4e0d\u53ef\u4ee5\u5c06\u9488\u5bf9\u540c\u4e00\u884c\u7684Put\u548cDelete\u64cd\u4f5c\u653e\u5728\u540c\u4e00\u4e2a\u6279\u91cf\u5904\u7406\u8bf7\u6c42\uff0c\u56e0\u64cd\u4f5c\u7684\u5904\u7406\u987a\u5e8f\u53ef\u80fd\u4e0d\u540c\uff1b</li> <li>batch\u8bf7\u6c42\u662f\u540c\u6b65\u7684\uff0cPUT\u5b9e\u4f8b\u4e0d\u4f1a\u88ab\u653e\u5230\u7f13\u51b2\u533a\u4e2d\uff1b</li> </ul>"},{"location":"data_query/nosql/hbase/client_api.html#scan","title":"\u626b\u63cf\uff08Scan\uff09","text":"<p>Scan\uff0c\u8bbe\u7f6e\u8d77\u59cb\u884c\u3001\u7ec8\u6b62\u884c\u3001\u8fc7\u6ee4\u5668\uff0c\u5b9e\u73b0\u6761\u4ef6\u67e5\u8be2\u529f\u80fd</p> <ul> <li>setCaching\uff08\u5168\u5c40\u6216\u8005Scan\u8bbe\u7f6e\uff09\uff0c\u4e00\u6b21RPC\u83b7\u53d6\u591a\u884c\u6570\u636e\uff1b</li> <li>setBatch\uff08\u5168\u5c40\u6216\u8005Scan\u8bbe\u7f6e\uff09\uff0c\u9762\u5411\u5217\u4e00\u7ea7\u7684\u64cd\u4f5c\uff0c\u53d6\u56de\u591a\u5c11\u5217\uff1b</li> </ul> <p>\u83b7\u53d6\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u5148\u83b7\u53d6\u884c\u5bf9\u5e94\u7684region\u4fe1\u606f\uff0c\u6240\u4ee5\u5f00\u59cb\u4f1a\u6bd4\u8f83\u6162\uff1f</p>"},{"location":"data_query/nosql/hbase/client_api.html#_1","title":"\u9ad8\u7ea7","text":"<p>HBase\u7684\u8868\u4e2d\u7684\u6570\u636e\u5206\u5272\u4e3b\u8981\u4f7f\u7528\u5217\u65cf\u800c\u4e0d\u662f\u5217\uff0c\u4e0d\u540c\u4e8e\u4f20\u7edf\u7684\u5217\u5f0f\u5b58\u50a8\u6570\u636e\u5e93\u3002</p> <ul> <li>\u6309\u884c\u952e\u68c0\u7d22\uff0c\u6709\u6548\u51cf\u5c11\u67e5\u8be2\u7279\u5b9a\u884c\u548c\u884c\u8303\u56f4\u7684\u65f6\u95f4\uff1b\u8bbe\u5b9a\u5217\u65cf\u53ef\u4ee5\u6709\u6548\u51cf\u5c11\u67e5\u8be2\u7684\u5b58\u50a8\u6587\u4ef6\uff1b</li> <li>\u7528\u6237\u5e94\u5c06\u9700\u8981\u67e5\u8be2\u7684\u7ef4\u5ea6\u6216\u4fe1\u606f\u5b58\u50a8\u5728\u884c\u952e\uff08\u5de6\u5bf9\u9f50\u7d22\u5f15\uff09\u4e2d\uff0c\u7b5b\u9009\u6548\u7387\u9ad8\uff08\u5373\u9ad8\u8868&gt;\u5bbd\u8868\uff09\uff1b</li> </ul> <p>TODO\uff1a\u56fe9-2</p>"},{"location":"data_query/nosql/hbase/client_api.html#thrift","title":"Thrift","text":"<p>The HBase Thrift interface allows other languages to access HBase over Thrift by connecting to a Thrift server that interfaces with the Java client.</p> <p></p> <p>Thrift API \u8c8c\u4f3c\u4e0d\u53ef\u4ee5\u4fee\u6539 HBase\u7684client\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u800c Java \u7684\u5ba2\u6237\u7aef\u53ef\u4ee5\u4fee\u6539\u3002</p>"},{"location":"data_query/nosql/hbase/conf.html","title":"HBase \u914d\u7f6e\u9879","text":""},{"location":"data_query/nosql/hbase/conf.html#_1","title":"\u7cfb\u7edf\u8981\u6c42","text":"<ul> <li> <p>NTP\uff1a\u96c6\u7fa4\u8282\u70b9\u7684\u65f6\u949f\u5e94\u8be5\u540c\u6b65</p> </li> <li> <p>ulimit\uff1a\u8bbe\u7f6e-n\u548c-u\uff0c\u7528\u6237\u540c\u65f6\u53ef\u4ee5\u6253\u5f00\u6587\u4ef6\u6570\u548c\u8fdb\u7a0b\u6570</p> </li> <li> <p>\u6bcf\u4e2aregionserver\u6253\u5f00\u7684\u6587\u4ef6\u6570   <pre><code>(StoreFiles per ColumnFamily) * (regions per RegionServer)\n</code></pre></p> </li> <li> <p>\u96c6\u7fa4\u90e8\u7f72\uff0c\u9700\u8981\u5c06HBase\u7684lib\u4e0bhadoop\u7684jar\u5305\u66ff\u6362\u6210\u5b9e\u9645\u4f7f\u7528\u7684hadoop\u7248\u672c\u7684jar\u5305</p> </li> <li> <p>hdfs\u7684DataNode\u5bf9\u968f\u65f6\u63d0\u4f9b\u670d\u52a1\u7684\u6587\u4ef6\u6570\u91cf\u6709\u4e0a\u9650\uff0c\u901a\u8fc7\u4ee5\u4e0b\u914d\u7f6e\uff08\u9700\u8981\u91cd\u542fHDFS\uff09   <pre><code>&lt;!--&gt; hdfs-site.xml, hdfs\u9ed8\u8ba4\u662f4096&lt;!--&gt;\n&lt;property&gt;\n  &lt;name&gt;dfs.datanode.max.transfer.threads&lt;/name&gt;\n  &lt;value&gt;4096&lt;/value&gt;\n&lt;/property&gt;\n</code></pre></p> </li> <li> <p>\u5982\u679cHadoop\u96c6\u7fa4\u4fee\u6539\u4e86HDFS\u5ba2\u6237\u7aef\u7684\u914d\u7f6e\uff0c\u5728HBase\u4e2d\u9700\u8981\u540c\u6b65\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u540c\u6837\u4f7f\u7528\u8fd9\u4e9b\u914d\u7f6e\uff1a</p> </li> <li>hbase-env.sh\u914d\u7f6eHADOOP_CONF\u76ee\u5f55\u5230HBASE_CLASSPATH\u4e2d</li> <li>\u5c06hdfs-site.xml\u590d\u5236\u6216\u94fe\u63a5\u5230${HBASE_HOME}/conf\u4e0b</li> <li>\u76f4\u63a5\u5c06\u914d\u7f6e\u6dfb\u52a0\u5230hbase-site.xml\u4e2d</li> </ul>"},{"location":"data_query/nosql/hbase/conf.html#hbase-default-conf","title":"HBase Default Conf","text":"<p>\u4fee\u6539\u914d\u7f6e\uff0c\u9700\u8981\u91cd\u542fHBase\u96c6\u7fa4</p> <pre><code>hbase.tmp.dir\nhbase.rootdir\nhbase.cluster.distributed\nhbase.zookeeper.quorum\nhbase.zookeeper.property.dataDir\n...\n</code></pre> <p>\u5806\u5185\u5b58\u7684\u8bbe\u7f6e</p> <pre><code># \u8be5\u914d\u7f6e\u5bf9Master\u548cRegionServer\u90fd\u751f\u6548\nexport HBASE_HEAPSIZE=4G\n# \u8be5\u914d\u7f6e\u53ea\u5bf9Master\u751f\u6548\nexport HBASE_MASTER_OPTS=\"$HBASE_MASTER_OPTS -Xms4g -Xmx4g\"\n# \u8be5\u914d\u7f6e\u53ea\u5bf9RegionServer\u751f\u6548\nexport HBASE_REGIONSERVER_OPTS=\"$HBASE_REGIONSERVER_OPTS -Xms8g -Xmx8g\"\n</code></pre> <p>hfile.block.cache.size \uff1a \u9ed8\u8ba40.4\uff0cStoreFile\u4e2d\u7528\u6765\u5206\u914dBlock Cache\u7684\u6700\u5927\u5806\u7684\u767e\u5206\u6bd4</p> <ol> <li>hbase.regionserver.global.memstore.size\uff1a\u9ed8\u8ba4\u5806\u5927\u5c0f\u768440%</li> </ol> <p>regionServer\u7684\u5168\u5c40memstore\u7684\u5927\u5c0f\uff0c\u8d85\u8fc7\u8be5\u5927\u5c0f\u4f1a\u963b\u585e\u66f4\u65b0\u4e14\u5f3a\u5236flush\u5230\u78c1\u76d8</p> <ol> <li>hbase.hregion.memstore.flush.size\uff1a\u9ed8\u8ba4128M</li> </ol> <p>\u5355\u4e2aregion\u91ccmemstore\u7684\u7f13\u5b58\u5927\u5c0f\uff0c\u8d85\u8fc7\u90a3\u4e48\u6574\u4e2aHRegion\u5c31\u4f1aflush\uff0c \u6bcf<code>hbase.server.thread.wakefrequency</code>\uff08\u9ed8\u8ba410000ms\uff09\u68c0\u67e5\u4e00\u6b21</p> <ol> <li>hbase.regionserver.optionalcacheflushinterval\uff1a\u9ed8\u8ba41h</li> </ol> <p>\u5185\u5b58\u4e2d\u7684\u6587\u4ef6\u5728\u81ea\u52a8\u5237\u65b0\u4e4b\u524d\u80fd\u591f\u5b58\u6d3b\u7684\u6700\u957f\u65f6\u95f4 </p> <ol> <li>hbase.regionserver.global.memstore.size.lower.limit\uff1a\u9ed8\u8ba4\u5806\u5927\u5c0f * 0.4 * 0.95</li> </ol> <p>\u6709\u65f6\u5019\u96c6\u7fa4\u7684\u201c\u5199\u8d1f\u8f7d\u201d\u975e\u5e38\u9ad8\uff0c\u5199\u5165\u91cf\u4e00\u76f4\u8d85\u8fc7flush\u7684\u91cf\uff0c\u8fd9\u65f6\uff0c\u6211\u4eec\u5c31\u5e0c\u671bmemstore\u4e0d\u8981\u8d85\u8fc7\u4e00\u5b9a\u7684\u5b89\u5168\u8bbe\u7f6e\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5199\u64cd\u4f5c\u5c31\u8981\u88ab\u963b\u585e\u4e00\u76f4\u5230memstore\u6062\u590d\u5230\u4e00\u4e2a\u201c\u53ef\u7ba1\u7406\u201d\u7684\u5927\u5c0f, \u8fd9\u4e2a\u5927\u5c0f\u5c31\u662f\u9ed8\u8ba4\u503c\u662f\u5806\u5927\u5c0f * 0.4 * 0.95\uff0c\u4e5f\u5c31\u662f\u5f53regionserver\u7ea7\u522b\u7684flush\u64cd\u4f5c\u53d1\u9001\u540e,\u4f1a\u963b\u585e\u5ba2\u6237\u7aef\u5199,\u4e00\u76f4\u963b\u585e\u5230\u6574\u4e2aregionserver\u7ea7\u522b\u7684memstore\u7684\u5927\u5c0f\u4e3a \u5806\u5927\u5c0f * 0.4 *0.95\u4e3a\u6b62 </p> <ol> <li>hbase.hregion.preclose.flush.size\uff1a\u9ed8\u8ba45M</li> </ol> <p>\u5f53\u4e00\u4e2a region \u4e2d\u7684 memstore \u7684\u5927\u5c0f\u5927\u4e8e\u8fd9\u4e2a\u503c\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53c8\u89e6\u53d1 \u4e86 close.\u4f1a\u5148\u8fd0\u884c\u201cpre-flush\u201d\u64cd\u4f5c\uff0c\u6e05\u7406\u8fd9\u4e2a\u9700\u8981\u5173\u95ed\u7684memstore\uff0c\u7136\u540e \u5c06\u8fd9\u4e2a region \u4e0b\u7ebf\u3002\u5f53\u4e00\u4e2a region \u4e0b\u7ebf\u4e86\uff0c\u6211\u4eec\u65e0\u6cd5\u518d\u8fdb\u884c\u4efb\u4f55\u5199\u64cd\u4f5c\u3002 \u5982\u679c\u4e00\u4e2a memstore \u5f88\u5927\u7684\u65f6\u5019\uff0cflush \u64cd\u4f5c\u4f1a\u6d88\u8017\u5f88\u591a\u65f6\u95f4\u3002\"pre-flush\" \u64cd\u4f5c\u610f\u5473\u7740\u5728 region \u4e0b\u7ebf\u4e4b\u524d\uff0c\u4f1a\u5148\u628a memstore \u6e05\u7a7a\u3002\u8fd9\u6837\u5728\u6700\u7ec8\u6267\u884c close \u64cd\u4f5c\u7684\u65f6\u5019\uff0cflush \u64cd\u4f5c\u4f1a\u5f88\u5feb\u3002 </p> <ol> <li>hbase.hstore.compactionThreshold\uff1a\u9ed8\u8ba4\u8d85\u8fc73\u4e2a</li> </ol> <p>\u4e00\u4e2astore\u91cc\u9762\u5141\u8bb8\u5b58\u7684hfile\u7684\u4e2a\u6570\uff0c\u8d85\u8fc7\u8fd9\u4e2a\u4e2a\u6570\u4f1a\u88ab\u5199\u5230\u65b0\u7684\u4e00\u4e2ahfile\u91cc\u9762 \u4e5f\u5373\u662f\u6bcf\u4e2aregion\u7684\u6bcf\u4e2a\u5217\u65cf\u5bf9\u5e94\u7684memstore\u5728fulsh\u4e3ahfile\u7684\u65f6\u5019\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5f53\u8d85\u8fc73\u4e2ahfile\u7684\u65f6\u5019\u5c31\u4f1a \u5bf9\u8fd9\u4e9b\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\u91cd\u5199\u4e3a\u4e00\u4e2a\u65b0\u6587\u4ef6\uff0c\u8bbe\u7f6e\u4e2a\u6570\u8d8a\u5927\u53ef\u4ee5\u51cf\u5c11\u89e6\u53d1\u5408\u5e76\u7684\u65f6\u95f4\uff0c\u4f46\u662f\u6bcf\u6b21\u5408\u5e76\u7684\u65f6\u95f4\u5c31\u4f1a\u8d8a\u957f</p>"},{"location":"data_query/nosql/hbase/conf.html#hbase_1","title":"HBase \u5185\u5b58\u89c4\u5212","text":"<p>HBase\u5185\u5b58\u5206\u4e3a\u5806\u5185\u548c\u5806\u5916\u5185\u5b58</p> <p>HEAPSIZE = LRUBlockCache + MemStore + Others </p> <p>OFFHEAPSIZE  = BucketCache + Others</p> <p>LRUBlockCache + MemStore &lt; &lt; 80% * JVM_HEAP </p> <p>\u5047\u8bbe\u7cfb\u7edf\u5185\u5b58\u4e3a96G\uff0cHBase\u4f7f\u752880G</p> <p>HEAP\uff1a30G = 0.3 + 0.5</p> <p>OFFHEAP\uff1a50G</p> <p>BucketCache\uff1a 45G</p> <pre><code>export HBASE_HEAPSIZE=30720\nexport HBASE_OFFHEAPSIZE=51200\nexport HBASE_OPTS=\"-XX\uff1aMaxPermSize=256m -XX\uff1a+UseConcMarkSweepGC -XX\uff1a+UseParNewGC\"\n</code></pre> <pre><code>&lt;!--\u8282\u70b9\u4e0a\u6240\u6709region\u7684memstore\u4e4b\u548c\u8fbe\u5230upperLimit*heapsize\u00a0--&gt;\n\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hbase.regionserver.global.memstore.size&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;0.5&lt;/value&gt;\n\u00a0\u00a0&lt;/property&gt;\n\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hfile.block.cache.size&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;0.3&lt;/value&gt;\n\u00a0\u00a0&lt;/property&gt;\n\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hbase.bucketcache.ioengine&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;offheap&lt;/value&gt;\n\u00a0\u00a0&lt;/property&gt;\n\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hbase.bucketcache.size&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;39936&lt;/value&gt;\n\u00a0\u00a0&lt;/property&gt;\n</code></pre>"},{"location":"data_query/nosql/hbase/conf.html#mslab","title":"MSLAB","text":"<p>MSLAB\u76f8\u5173\u53c2\u6570</p> <ul> <li><code>hbase.hregion.memstore.mslab.enabled</code>\uff1a\u8bbe\u7f6e\u4e3atrue\uff0c\u5373\u6253\u5f00 MSLAB\uff0c\u9ed8\u8ba4\u4e3atrue</li> <li><code>hbase.hregion.memstore.mslab.chunksize</code>\uff1a\u6bcf\u4e2achunk\u7684\u5927 \u5c0f\uff0c\u9ed8\u8ba4\u4e3a2048*1024 \u53732MB</li> <li><code>hbase.hregion.memstore.mslab.max.allocation</code>\uff1a\u80fd\u653e\u5165chunk \u7684\u6700\u5927\u5355\u5143\u683c\u5927\u5c0f\uff0c\u9ed8\u8ba4\u4e3a256KB\uff0c\u5df2\u7ecf\u5f88\u5927\u4e86</li> <li><code>hbase.hregion.memstore.chunkpool.maxsize</code>\uff1a\u5728\u6574\u4e2amemstore \u53ef\u4ee5\u5360\u7528\u7684\u5806\u5185\u5b58\u4e2d\uff0cchunkPool\u5360\u7528\u7684\u6bd4\u4f8b\uff0c\u8be5\u503c\u4e3a\u4e00\u4e2a\u767e\u5206 \u6bd4\uff0c\u53d6\u503c\u8303\u56f4\u4e3a0.0~1.0\u3002\u9ed8\u8ba4\u503c\u4e3a0.0</li> <li><code>hbase.hregion.memstore.chunkpool.initialsize</code>\uff1a\u5728 RegionServer\u542f\u52a8\u7684\u65f6\u5019\u53ef\u4ee5\u9884\u5206\u914d\u4e00\u4e9b\u7a7a\u7684chunk\u51fa\u6765\u653e\u5230 chunkPool\u91cc\u9762\u5f85\u4f7f\u7528.\u8be5\u503c\u5c31\u4ee3\u8868\u4e86\u9884\u5206\u914d\u7684chunk\u5360\u603b\u7684 chunkPool\u7684\u6bd4\u4f8b\uff0c\u8be5\u503c\u4e3a\u4e00\u4e2a\u767e\u5206\u6bd4\uff0c\u53d6\u503c\u8303\u56f4\u4e3a0.0~1.0\uff0c\u9ed8 \u8ba4\u503c\u4e3a0.0</li> </ul>"},{"location":"data_query/nosql/hbase/conf.html#region-split","title":"Region Split","text":""},{"location":"data_query/nosql/hbase/conf.html#region","title":"region\u62c6\u5206\u7b56\u7565","text":"<p>\u53c2\u6570\uff1ahbase.regionserver.region.split.policy</p> <p>\u9ed8\u8ba4\uff1aorg.apache.hadoop.hbase.regionserver.SteppingSplitPolicy</p> <p>\u7b56\u7565\uff1aConstantSizeRegionSplitPolicy</p> <p>\u51c6\u5219\uff1aRegion\u7684HFile\u5927\u5c0f\u8d85\u8fc7\u8be5\u503c\uff0c\u5219\u4f1a\u62c6\u5206Region\u3002\u5bf9\u5c0f\u8868\u4e0d\u53cb\u597d\u3002</p> <pre><code>&lt;property&gt;\n  &lt;name&gt;hbase.hregion.max.filesize&lt;/name&gt;\n  &lt;value&gt;10737418240&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\u7b56\u7565\uff1aIncreasingToUpperBoundRegionSplitPolicy</p> <p>\u51c6\u5219\uff1a\u9650\u5236\u4e0d\u65ad\u589e\u957f\u7684\u6587\u4ef6\u5c3a\u5bf8\uff0c\u6587\u4ef6\u5c3a\u5bf8\u9650\u5236\u662f\u52a8\u6001\u7684\u3002\u5f25\u8865ConstantSizeRegionSplitPolicy\u7684\u77ed\u677f\uff0c\u81ea\u9002\u5e94\u5927\u8868\u548c\u5c0f\u8868\uff1b\u4f46\u5728\u5927\u96c6\u7fa4\u4e0b\u5bf9\u5c0f\u8868\u4f1a\u4ea7\u751f\u5927\u91cf\u5c0fregion\uff0c\u5206\u6563\u5728\u6574\u4e2a\u96c6\u7fa4\u4e2d\u3002</p> <pre><code>Math.min(tableRegionCount^3 * initialsize, regionMaxFileSize)\n</code></pre> <ul> <li>tableRegionCount\uff1a\u5728RegionServer\u4e0a\u8868\u6240\u62e5\u6709\u7684Region\u6570\u91cf\u603b\u548c\uff1b</li> <li>initialSize\uff1a<code>hbase.increasing.policy.initial.size</code>\u7684\u503c\uff0c\u672a\u8bbe\u7f6e\u5219\u9ed8\u8ba4\u662fmemstore\u7684\u5237\u5199\u5927\u5c0f2\u500d\uff1b</li> <li>regionMaxFileSize \u7684\u6700\u5927\u5927\u5c0f\uff0c\u5373<code>hbase.hregion.max.filesize</code></li> </ul> <p>\u7b56\u7565\uff1aSteppingSplitPolicy</p> <p>\u51c6\u5219\uff1a\u5982\u679cregion\u6b21\u6570\u7b49\u4e8e1\uff0c\u5207\u5206\u9608\u503c\u4e3aflush_size * 2\uff0c\u5426\u5219\u4e3aregionMaxFileSize\u3002\u5c0f\u8868\u4e0d\u4f1a\u5728\u4ea7\u751f\u5927\u91cf\u7684\u5c0fregion\u3002</p> <p>\u7b56\u7565\uff1aKeyPrefixRegionSplitPolicy</p> <p>\u51c6\u5219\uff1aIncreasingToUpperBoundRegionSplitPolicy\u5b50\u7c7b\uff0c\u62c6\u5206\u70b9(\u5373Region\u88ab\u62c6\u5206\u5904\u7684rowkey)\uff0c\u4fdd\u8bc1\u4e86\u6709\u76f8\u540c\u524d\u7f00\u7684rowkey\u62c6\u5206\u5230\u4e00\u4e2aregion\u4e2d</p> <pre><code>KeyPrefixRegionSplitPolicy.prefix_length rowkey:\u524d\u7f00\u957f\u5ea6\n</code></pre> <p>\u6839\u636e\u5b9a\u4e49\u7684\u957f\u5ea6\u6765\u622a\u53d6rowkey\u4f5c\u4e3a\u5206\u7ec4\u7684\u4f9d\u636e\uff0c\u540c\u4e00\u7ec4\u7684\u6570\u636e\u4e0d\u4f1a\u88ab\u5212\u5206\u5230\u4e0d\u540c\u7684region\u4e0a\uff1b \u8fd9\u79cd\u7b56\u7565\u5bf9\u4e8e\u53ea\u6709\u4e00\u4e24\u4e2a\u524d\u7f00\u7684\u6570\u636e\uff0c\u90a3\u4e48\u6839\u672c\u4e0d\u9700\u8981\u7528\u8fd9\u4e2a\uff0c\u8fd9\u4e2a\u9002\u7528\u573a\u666f\u5728\u4e8e\u6570\u636e\u6709\u591a\u79cd\u524d\u7f00\uff0c\u5e76\u4e14\u67e5\u8be2\u591a\u662f\u9488\u5bf9\u524d\u7f00\uff0c\u6bd4\u8f83\u5c11\u8de8\u8d8a\u591a\u4e2a\u524d\u7f00\u6765\u67e5\u8be2\u6570\u636e\u3002</p> <p>\u7b56\u7565\uff1aDelimitedKeyPrefixRegionSplitPolicy</p> <p>\u51c6\u5219\uff1aKeyPrefixRegionSplitPolicy\u5b50\u7c7b\uff0c\u6839\u636erowkey\u7684\u5206\u9694\u7b26\u8fdb\u884c\u5207\u5206</p> <pre><code>DelimitedKeyPrefixRegionSplitPolicy.delimiter : \u524d\u7f00\u5206\u9694\u7b26\n</code></pre> <p>\u7b56\u7565\uff1aBusyRegionSplitPolicy</p> <p>\u51c6\u5219\uff1a\u6839\u636e\u70ed\u70b9\u8fdb\u884c\u62c6\u5206</p> <ul> <li> <p><code>hbase.busy.policy.blockedRequests</code>\uff1a\u8bf7\u6c42\u88ab\u963b\u585e\u7684\u4e25\u91cd\u7a0b\u5ea6\uff0c\u53d6\u503c\u8303\u56f4\u662f0.0~1.0\uff0c\u9ed8\u8ba4\u662f0.2\uff0c\u537320%\u7684\u8bf7\u6c42\u88ab\u963b\u585e\u7684\u610f\u601d</p> </li> <li> <p><code>hbase.busy.policy.minAge</code>\uff1a\u62c6\u5206\u6700\u5c0f\u5e74\u9f84\uff0c\u5f53Region\u7684\u5e74\u9f84\u6bd4\u8fd9\u4e2a\u5c0f\u7684\u65f6\u5019\u4e0d\u62c6\u5206\uff0c\u8fd9\u662f\u4e3a\u4e86\u9632\u6b62\u5728\u5224\u65ad\u662f\u5426\u8981\u62c6\u5206\u7684\u65f6\u5019\u51fa\u73b0\u4e86\u77ed\u65f6\u95f4\u7684\u8bbf\u95ee\u9891\u7387\u6ce2\u5cf0\uff0c\u7ed3\u679c\u6ca1\u5fc5\u8981\u62c6\u5206\u7684Region\u88ab\u62c6\u5206\u4e86\uff0c\u56e0\u4e3a\u77ed\u65f6\u95f4\u7684\u6ce2\u5cf0\u4f1a\u5f88\u5feb\u5730\u964d\u56de\u5230\u6b63\u5e38\u6c34\u5e73\u3002\u5355\u4f4d\u6beb\u79d2\uff0c\u9ed8\u8ba4\u503c10\u5206\u949f</p> </li> <li><code>hbase.busy.policy.aggWindow</code>\uff1a\u8ba1\u7b97\u662f\u5426\u7e41\u5fd9\u7684\u65f6\u95f4\u7a97\u53e3\uff0c\u5355\u4f4d\u6beb\u79d2\uff0c\u9ed8\u8ba4\u503c5\u5206\u949f\uff0c\u7528\u4ee5\u63a7\u5236\u8ba1\u7b97\u7684\u9891\u7387</li> </ul> <pre><code>if \u5f53\u524d\u65f6\u95f4\u51cf\u53bb\u4e0a\u6b21\u68c0\u6d4b\u65f6\u95f4&gt;=hbase.busy.policy.aggWindow :\n    \u8bf7\u6c42\u7684\u88ab\u963b\u585e\u7387aggBlockedRate=\u8fd9\u6bb5\u65f6\u95f4\u7684\u963b\u585e\u7684\u8bf7\u6c42/\u8fd9\u6bb5\u65f6\u95f4\u7684\u603b\u8bf7\u6c42\n    if aggBlocedRate&gt;hbase.busy.policy.blockedRequests:\n        return BUSY\n</code></pre> <p>\u7b56\u7565\uff1aDisabledRegionSplitPolicy</p> <p>\u51c6\u5219\uff1a\u8868\u793aregion\u6c38\u8fdc\u4e0d\u62c6\u5206\uff0c\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7\u624b\u52a8\u62c6\u5206region\u3002</p>"},{"location":"data_query/nosql/hbase/conf.html#region_1","title":"region\u9884\u62c6\u5206","text":"<p>\u5728\u5efa\u8868\u7684\u65f6\u5019\u5b9a\u4e49\u597d\u62c6\u5206\u70b9\uff0c\u4f7f\u7528RegionSplitter\u7c7b\u6765\u5efa\u8868\uff0c\u5e76\u4f20\u5165\u62c6\u5206\u70b9\u7b97\u6cd5\u3002</p> <pre><code>hbase(main):005:0&gt; create 'mysplittable','cf',{NUMREGIONS=&gt;10,SPLITALGO=&gt;'HexStringSplit'}\n</code></pre> <p>TODO\uff1a\u62c6\u5206\u70b9\u7b97\u6cd5</p>"},{"location":"data_query/nosql/hbase/conf.html#region-compaction","title":"Region Compaction","text":""},{"location":"data_query/nosql/hbase/conf.html#minor-compaction","title":"Minor Compaction","text":""},{"location":"data_query/nosql/hbase/conf.html#major-compaction","title":"Major Compaction","text":"<p>\u7b56\u7565\uff1aDateTieredCompaction</p>"},{"location":"data_query/nosql/hbase/exceptions.html","title":"Exceptions","text":""},{"location":"data_query/nosql/hbase/exceptions.html#orgapachehadoophbaseipccalltimeoutexception","title":"org.apache.hadoop.hbase.ipc.CallTimeoutException","text":"<p>\u963b\u585e\u8d85\u65f6\uff0c\u53ef\u80fd\u662f\u6279\u91cf\u63d2\u5165\u6570\u636e\u8fc7\u5927\uff08HBase\u6b63\u597d\u53ca\u8fdb\u884cflush\u7b49\uff09\uff0c\u5bfc\u81f4RPC\u54cd\u5e94\u8fc7\u6162</p>"},{"location":"data_query/nosql/hbase/exceptions.html#orgapachehadoophbaseregiontoobusyexception-over-memstore-limit","title":"org.apache.hadoop.hbase.RegionTooBusyException: Over memstore limit","text":"<p>\u4e00\u822c\u6765\u8bf4memstore\u8d85\u8fc7hbase.hregion.memstore.flush.size\uff08\u9ed8\u8ba4128M\uff09,\u4f1aflush\u5f62\u6210HFile\u3002</p> <p>\u5f53\u5199\u5165\u6570\u636e\u8fc7\u5feb\u65f6\uff0c\u5bfc\u81f4\u4ea7\u751f\u5927\u91cfHFile\uff0c\u5f53HFile\u6570\u91cf\u8d85\u8fc7\u914d\u7f6ehbase.hstore.blockingStoreFiles(\u9ed8\u8ba410)\uff0chbase\u4f1a\u8fdb\u884ccompaction(\u5408\u5e76)\uff0ccompaction\u4f1a\u963b\u585ememstore flush\u64cd\u4f5c\uff0c\u963b\u585e\u6700\u957f\u65f6\u957fhbase.hstore.blockingWaitTime(\u9ed8\u8ba4\u503c90000\uff0c\u537390s)\uff0c\u5f53\u8d85\u8fc7\u8be5\u65f6\u95f4\u540e\uff0c\u5982\u679ccompaction\u8fd8\u672a\u5b8c\u6210\uff0cmemstore flush\u4e5f\u4f1a\u505c\u6b62\u963b\u585e\u3002</p> <p>\u4f46\u662f\u6b63\u662f\u5728flush\u963b\u585e\u8fd9\u6bb5\u65f6\u95f4\u5185\uff0cmemstore\u7684\u5927\u5c0f\u8d85\u8fc7\u4e86\u4e0a\u9650\uff1a </p> <p><code>base.hregion.memstore.flush.size * hbase.hregion.memstore.block.multiplier</code>\uff08\u9ed8\u8ba4\u4e3a4\uff09=512M\uff0c\u6b64\u65f6\uff0cregion\u5c06\u62d2\u7edd\u6240\u6709\u5199\u8bf7\u6c42\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u629b\u51faRegionTooBusyException\uff0c\u5e76\u5728\u4e00\u5b9a\u65f6\u95f4\u540e\u91cd\u8bd5\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <p>1.\u5728hbase\u5185\u5b58\u5141\u8bb8\u7684\u524d\u63d0\u4e0b\uff0c\u63d0\u9ad8hbase.hregion.memstore.block.multiplier\u53c2\u6570\uff0c\u5728flush\u963b\u585e\u7684\u8fd9\u6bb5\u65f6\u95f4\uff0c\u5141\u8bb8\u66f4\u591a\u7684\u6570\u636e\u5199\u5230memstore\u3002</p> <pre><code>\u98ce\u9669\uff1a\u589e\u52a0\u4e86regionserver oom\u6982\u7387\uff0c\u4fee\u6539\u8be5\u53c2\u6570\uff0c\u9700\u8981\u8fdb\u884c\u5927\u6570\u636e\u91cf\u5199\u5165\u6d4b\u8bd5\u3002\n</code></pre> <p>2.\u51cf\u5c11\u963b\u585e\u65f6\u95f4hbase.hstore.blockingwaittime\uff08\u6bd4\u5982\u523030s\uff09\uff0c\u52a0\u5febmemstore flush\u5230hdfs\u4e0a\u7684\u901f\u5ea6\uff0c\u4ece\u800c\u51cf\u5c11memstore\u6570\u636e\u5927\u5c0f\u89e6\u78b0\u5230\u4e0a\u9650\u7684\u65f6\u95f4\uff0c\u4e5f\u5c31\u80fd\u51cf\u5c11\u62d2\u7edd\u5199\u8bf7\u6c42\u7684\u65f6\u95f4\u3002</p> <pre><code>\u98ce\u9669\uff1a1\u3001\u589e\u52a0\u4e86compaction\u7684\u538b\u529b\uff0c\n     2\u3001\u5360\u7528\u78c1\u76d8IO\uff0c\u53ef\u80fd\u4f1a\u5f71\u54cd\u5230\u5176\u4ed6\u670d\u52a1\u3002\n</code></pre> <p>3.\u4e00\u822c\u51fa\u73b0RegionTooBusyException\uff0c\u8868\u793a\u5927\u91cf\u5199\u5165\u6570\u636e\u91cf\u6bd4\u8f83\u5927\uff0c\u8fd9\u79cd\u573a\u666f\u66f4\u597d\u7684\u9009\u62e9\u53ef\u80fd\u662f\u91c7\u7528bulkload\u5bfc\u5165\u65b9\u5f0f\u3002</p> <p>bulkload\u5bfc\u5165\u6570\u636e\u5230hbase\u7684\u65b9\u5f0f\u53ef\u4ee5\u53c2\u8003\uff1a https://hbase.apache.org/2.1/book.html#arch.bulk.load.arch </p>"},{"location":"data_query/nosql/hbase/hfile.html","title":"HFile","text":""},{"location":"data_query/nosql/hbase/hfile.html#_1","title":"\u7248\u672c","text":""},{"location":"data_query/nosql/hbase/hfile.html#v1","title":"V1","text":"<p>\u95ee\u9898\uff1aRegion Open\u7684\u65f6\u5019\uff0c\u9700\u8981\u52a0\u8f7d\u6240\u6709\u7684Data Block Index\u6570\u636e\u3002\u53e6\u5916\uff0c\u7b2c\u4e00\u6b21\u8bfb\u53d6\u65f6\u9700\u8981\u52a0\u8f7d\u6240\u6709\u7684Bloom Filter\u6570\u636e\u5230\u5185\u5b58\u4e2d\u3002\u4e00\u4e2aHFile\u4e2d\u7684Bloom Filter\u7684\u6570\u636e\u5927\u5c0f\u53ef\u8fbe\u767eMB\u7ea7\u522b\uff0c\u4e00\u4e2aRegionServer\u542f\u52a8\u65f6\u53ef\u80fd\u9700\u8981\u52a0\u8f7d\u6570GB\u7684Data Block Index\u6570\u636e\u3002\u8fd9\u5728\u4e00\u4e2a\u5927\u6570\u636e\u91cf\u7684\u96c6\u7fa4\u4e2d\uff0c\u51e0\u4e4e\u65e0\u6cd5\u5fcd\u53d7\u3002</p>"},{"location":"data_query/nosql/hbase/hfile.html#v2","title":"V2","text":"<p>\u89e3\u51b3\uff1a\u964d\u4f4eRegionServer\u542f\u52a8\u65f6\u52a0\u8f7dHFile\u7684\u65f6\u5ef6\uff0c\u66f4\u5e0c\u671b\u89e3\u51b3\u4e00\u6b21\u5168\u91cf\u52a0\u8f7d\u6570\u767eMB\u7ea7\u522b\u7684BloomFilter\u6570\u636e\u5e26\u6765\u7684\u65f6\u5ef6\u8fc7\u5927\u7684\u95ee\u9898\u3002</p> <p></p> <p>\u5206\u5c42\u7d22\u5f15\u7684\u8bbe\u8ba1\uff1a</p> <ul> <li>\u7d22\u5f15\u5206\u6210\u4e09\u90e8\u5206\u533a\u57df</li> <li>DataBlock\uff1a\u6700\u591a\u652f\u6301\u4e09\u5c42\u7d22\u5f15</li> <li>\u6700\u5e95\u5c42\u7684Data Block Index\u79f0\u4e4b\u4e3aLeaf Index Block\uff0c\u53ef\u76f4\u63a5\u7d22\u5f15\u5230Data Block\uff1b</li> <li>\u4e2d\u95f4\u5c42\u79f0\u4e4b\u4e3aIntermediate Index Block\uff1b</li> <li>\u6700\u4e0a\u5c42\u79f0\u4e4b\u4e3aRoot Data Index\uff0cRoot Data index\u5b58\u653e\u5728\u4e00\u4e2a\u79f0\u4e4b\u4e3a\u201dLoad-on-open Section\u201c\u533a\u57df\uff1b</li> <li>\u5728\u5b9e\u9645\u573a\u666f\u4e2d\uff0cIntermediate Block Index\u57fa\u672c\u4e0a\u4e0d\u4f1a\u5b58\u5728</li> <li>Bloom Filter\uff1a\u4e00\u5c42\u7d22\u5f15</li> <li>\u5728\u201dLoad-on-open Section\u201d\u533a\u57df\u4e2d\uff0c\u540c\u6837\u5b58\u653e\u4e86\u6240\u6709Bloom Block\u7684\u7d22\u5f15\u6570\u636e\uff1b</li> </ul>"},{"location":"data_query/nosql/hbase/hfile.html#v3","title":"V3","text":"<p>\u4e3b\u8981\u662f\u4e3a\u4e86\u652f\u6301Tag\u7279\u6027\uff0c\u5728HFile V2\u57fa\u7840\u4e0a\u53ea\u505a\u4e86\u5fae\u91cf\u6539\u52a8\uff1bV3\u4e3b\u8981\u7684\u63d0\u9ad8\u662f\u538b\u7f29\u6bd4\u548c\uff0c\u901a\u8fc7\u628akey\u653e\u5728\u4e00\u8d77\u3001Value\u653e\u5728\u4e00\u8d77\uff0c key\u5b58\u5728block \u7684\u5f00\u59cb\u4f4d\u7f6e\uff0cvalue\u5b58\u5728block\u7684\u7ed3\u675f\u4f4d\u7f6e\uff0c\u901a\u8fc7\u5bf9\u4e8ekey\u548cvalue\u5e94\u7528\u4e0d\u540c\u7684\u538b\u7f29\u7b97\u6cd5\u3002</p>"},{"location":"data_query/nosql/hbase/hfile.html#_2","title":"\u751f\u6210\u539f\u7406","text":"<p>Data Block Encoding\u662fHBase\u4e3a\u4e86\u964d\u4f4eKeyValue\u7ed3\u6784\u6027\u81a8\u80c0\u800c\u63d0\u4f9b\u7684\u5185\u90e8\u7f16\u7801\u673a\u5236</p> <ul> <li>\u8d77\u521d\uff0cHFile\u4e2d\u5e76\u6ca1\u6709\u4efb\u4f55Block\uff0c\u6570\u636e\u8fd8\u5b58\u5728\u4e8eMemStore\u4e2d\u3002</li> <li>Flush\u53d1\u751f\u65f6\uff0c\u521b\u5efaHFile Writer\uff0c\u7b2c\u4e00\u4e2a\u7a7a\u7684Data Block\u51fa\u73b0\uff0c\u521d\u59cb\u5316\u540e\u7684Data Block\u4e2d\u4e3aHeader\u90e8\u5206\u9884\u7559\u4e86\u7a7a\u95f4\uff0cHeader\u90e8\u5206\u7528\u6765\u5b58\u653e\u4e00\u4e2aData Block\u7684\u5143\u6570\u636e\u4fe1\u606f\u3002</li> <li>\u5f53Data Block\u589e\u957f\u5230\u9884\u8bbe\u5927\u5c0f(\u9ed8\u8ba464KB)\u540e\uff0c\u4e00\u4e2aData Block\u88ab\u505c\u6b62\u5199\u5165\uff0c\u6267\u884c\u4ee5\u4e0b\u6d41\u7a0b\uff1a</li> <li>\u82e5\u6709\u914d\u7f6e\u542f\u7528\u538b\u7f29\u6216\u52a0\u5bc6\u7279\u6027\uff0c\u5bf9Data Block\u7684\u6570\u636e\u6309\u76f8\u5e94\u7684\u7b97\u6cd5\u8fdb\u884c\u538b\u7f29\u548c\u52a0\u5bc6\u3002</li> <li>\u5728\u9884\u7559\u7684Header\u533a\uff0c\u5199\u5165\u8be5Data Block\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u5305\u542b{\u538b\u7f29\u524d\u7684\u5927\u5c0f\uff0c\u538b\u7f29\u540e\u7684\u5927\u5c0f\uff0c\u4e0a\u4e00\u4e2aBlock\u7684\u504f\u79fb\u4fe1\u606f\uff0cChecksum\u5143\u6570\u636e\u4fe1\u606f}\u7b49\u4fe1\u606f\uff0c\u4e0b\u56fe\u662f\u4e00\u4e2aHeader\u7684\u5b8c\u6574\u7ed3\u6784   </li> <li>\u751f\u6210Checksum\u4fe1\u606f\uff1b</li> <li>Data Block\u4ee5\u53caChecksum\u4fe1\u606f\u901a\u8fc7HFile Writer\u4e2d\u7684\u8f93\u51fa\u6d41\u5199\u5165\u5230HDFS\u4e2d\uff1b</li> <li> <p>\u4e3a\u8f93\u51fa\u7684Data Block\u751f\u6210\u4e00\u6761\u7d22\u5f15\u8bb0\u5f55\uff0c\u5305\u542b\u8fd9\u4e2aData Block\u7684{\u8d77\u59cbKey\uff0c\u504f\u79fb\uff0c\u5927\u5c0f}\u4fe1\u606f\uff0c\u8fd9\u6761\u7d22\u5f15\u8bb0\u5f55\u88ab\u6682\u65f6\u8bb0\u5f55\u5230\u5185\u5b58\u7684Block Index Chunk\u4e2d</p> </li> <li> <p>\u968f\u7740Data Blocks\u6570\u91cf\u7684\u4e0d\u65ad\u589e\u591a\uff0cBlock Index Chunk\u4e2d\u7684\u8bb0\u5f55\u6570\u91cf\u4e5f\u5728\u4e0d\u65ad\u53d8\u591a\u3002\u5f53Block Index Chunk\u8fbe\u5230\u4e00\u5b9a\u5927\u5c0f\u4ee5\u540e(\u9ed8\u8ba4\u4e3a128KB)\uff0cBlock Index Chunk\u4e5f\u7ecf\u4e0eData Block\u7684\u7c7b\u4f3c\u5904\u7406\u6d41\u7a0b\u540e\u8f93\u51fa\u5230HDFS\u4e2d\uff0c\u5f62\u6210\u7b2c\u4e00\u4e2aLeaf Index Block</p> </li> <li>\u5728\u5185\u5b58\u4e2d\u8fd8\u6709\u4e00\u4e2aRoot Block Index Chunk\u7528\u6765\u8bb0\u5f55\u6bcf\u4e00\u4e2aLeaf Index Block\u7684\u7d22\u5f15\u4fe1\u606f\uff1b</li> <li>\u6536\u5c3e\uff1a</li> <li>\u5199\u5165\u6700\u540e\u4e00\u4e2aDataBlock\uff0cLeaf Index Block\uff1b</li> <li>\u5982\u679cRoot Block Index Chunk\u8d85\u51fa\u4e86\u9884\u8bbe\u5927\u5c0f\uff0c\u5219\u8f93\u51fa\u4f4d\u4e8eNon-Scanned Block Section\u533a\u57df\u7684Intermediate Index Block\u6570\u636e\uff0c\u4ee5\u53ca\u751f\u6210\u5e76\u8f93\u51faRoot Index Block(\u8bb0\u5f55Intermediate Index Block\u7d22\u5f15)\u5230Load-On-Open Section\u90e8\u5206\u3002</li> <li>\u5982\u679c\u672a\u8d85\u51fa\u5927\u5c0f\uff0c\u5219\u76f4\u63a5\u8f93\u51fa\u4e3aLoad-On-Open Section\u90e8\u5206\u7684Root Index Block\u3002</li> <li>\u5199\u5165\u540e\u7eed\u7684FileInfo, Trailer\u7b49\uff1b</li> </ul>"},{"location":"data_query/nosql/hbase/import.html","title":"\u5bfc\u5165","text":""},{"location":"data_query/nosql/hbase/import.html#bulkload","title":"\u6279\u91cf\u5bfc\u5165\uff08BulkLoad\uff09","text":"<p>\u53c2\u8003\uff1a\u8d1d\u58f3\u57fa\u4e8eSpark\u7684HiveToHBase\u5b9e\u8df5</p> <p>Hive\u5230HBase\u7684\u6d41\u7a0b\u5927\u81f4\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"data_query/nosql/hbase/perf.html","title":"Performance","text":"<ul> <li>\u5224\u65ad\u5355region\u662f\u5426\u5b58\u5728\u8bfb\u5199\u70ed\u70b9\uff1f</li> <li></li> </ul>"},{"location":"data_query/nosql/hbase/perf.html#schema-design","title":"Schema Design","text":"<p>\u4e3a\u4ec0\u4e48RowKey\u4e0d\u8981\u4f7f\u7528\u9012\u589e</p> <ul> <li>ID\u81ea\u589e\u957f\uff0c\u4f1a\u5bfc\u81f4\u5199\u5165\u6570\u636e\u538b\u529b\u96c6\u4e2d\u5728\u67d0\u4e00\u4e2a\u6216\u67d0\u51e0\u4e2aRegion\u4e0a\uff1b</li> </ul>"},{"location":"data_query/nosql/hbase/perf.html#tallwidemiddle-schema-design","title":"Tall/Wide/Middle Schema Design","text":"<p>\u53c2\u8003\u6307\u5bfc\u800c\u4e0d\u662f\u89c4\u5b9a\uff0c\u9700\u8981\u6839\u636e\u5b9e\u9645\u9700\u8981\u8003\u8651</p> <ul> <li>\u65f6\u95f4\u6233\u4f5c\u4e3arowkey\uff0c\u4e0d\u8981\u4f5c\u4e3a\u7248\u672c\uff08version\uff09\uff1b</li> <li>\u504f\u5411\u4e8e\u7a84\u8868\uff1bopentsdb\u5c06timestamp\u53d8\u6210timerange\uff08Row as Columns)\uff0c\u5217\u4e3a\u65f6\u95f4\u504f\u79fb\uff0c</li> </ul>"},{"location":"data_query/nosql/hbase/perf.html#_1","title":"\u907f\u514d\u6570\u636e\u70ed\u70b9","text":"<p>Reversing</p> <p>Salting</p> <p>Hashing</p>"},{"location":"data_query/nosql/hbase/perf.html#rowkey","title":"\u4e8c\u7ea7\u7d22\u5f15RowKey","text":"<p>\u601d\u8def\uff1a\u6dfb\u52a0RowKey\u8bbe\u8ba1\uff0c\u6570\u636e\u4f1a\u91cd\u590d\u5b58\u50a8\u3001\u6027\u80fd\u4e0b\u964d\u3002</p>"},{"location":"data_query/nosql/hbase/perf.html#gc","title":"GC","text":"<p>RegionServer\u5185\u5b58\u5c0f\u4e8e4GB\uff0c\u4f7f\u7528\u5e76\u884c+\u5e76\u53d1\u56de\u6536\u5668</p> <ul> <li> <p>\u5e76\u884c\u56de\u6536\u5668ParallelGC,\u4e3b\u8981\u9488\u5bf9\u5e74\u8f7b\u4ee3\u8fdb\u884c\u4f18\u5316(jdk8\u9ed8\u8ba4\u7b56\u7565)</p> </li> <li> <p>\u5e76\u53d1\u56de\u6536\u5668ConcMarkSweepGC,CMS,\u4e3b\u8981\u9488\u5bf9\u5e74\u8001\u5e26\u8fdb\u884c\u4f18\u5316</p> </li> </ul> <pre><code>export HBASE_REGIONSERVER_OPTS=\"$HBASE_REGIONSERVER_OPTS -Xms8g -Xmx8g -XX:+UseParNewGCXX:+UseConcMarkSweepGC\"\n</code></pre> <p>\u5185\u5b58\u5927\u4e8e32GB\uff0c\u4f7f\u7528G1GC\u7b56\u7565</p> <p><code>shell export HBASE_REGIONSERVER_OPTS=\"$HBASE_REGIONSERVER_OPTS -Xms8g -Xmx8g -XX:+UseParNewGCXX:+UseConcMarkSweepGC\"</code></p> <p>\u6d4b\u8bd5\u7684\u65f6\u5019\uff0c\u52a0\u4e0a\u8c03\u8bd5\u53c2\u6570</p> <pre><code>-XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintAdaptiveSizePolicy\n</code></pre>"},{"location":"data_query/nosql/hbase/perf.html#memstorejvmmslab","title":"Memstore\u7684\u4e13\u5c5eJVM\u7b56\u7565MSLAB","text":"<p>CMS\u7b97\u6cd5\u4ea7\u751fFull GC\u539f\u56e0\uff1a</p> <ul> <li>\u540c\u6b65\u6a21\u5f0f\u5931\u8d25\uff1a</li> <li>\u5728CMS\u8fd8\u6ca1\u6709\u628a\u5783\u573e\u6536\u96c6\u5b8c\u7684\u65f6\u5019\u7a7a\u95f4\u8fd8\u6ca1\u6709\u5b8c\u5168\u91ca\u653e,\u5728\u8fd9\u4e2a\u65f6\u5019\u5982\u679c\u65b0\u751f\u4ee3\u7684\u5bf9\u8c61\u8fc7\u5feb\u7684\u8f6c\u6362\u4e3a\u8001\u5e74\u4ee3\u7684\u5bf9\u8c61\u65f6\u53d1\u73b0\u8001\u5e74\u4ee3\u7684\u53ef\u7528\u7a7a\u95f4\u4e0d\u591f\u7528\u4e86,\u6b64\u65f6\u6536\u96c6\u5668\u5c31\u4f1a\u505c\u6b62\u6536\u96c6\u8fc7\u7a0b,\u8f6c\u4e3a\u5355\u7ebf\u7a0b\u7684STW\u6682\u505c,\u5c06\u53c8\u89e6\u53d1Full GC\uff1b</li> <li><code>-XX:CMSInitiatingOccupancyFraction=N</code>\u6765\u7f13\u89e3,N\u4ee3\u8868\u4e86\u5f53JVM\u542f\u52a8\u5783\u573e\u56de\u6536\u65f6\u7684\u5806\u5185\u5b58\u5360\u7528\u767e\u5206\u6bd4,\u8bbe\u7f6e\u7684\u8d8a\u5c0f,JVM\u8d8a\u65e9\u542f\u52a8\u5783\u573e\u56de\u6536\u8fdb\u7a0b</li> <li>\u5185\u5b58\u788e\u7247\u5316\uff1a</li> <li>\u5f53\u524d\u8981\u4ece\u65b0\u751f\u4ee3\u63d0\u5347\u5230\u8001\u5e74\u4ee3\u7684\u5bf9\u8c61\u6bd4\u8001\u5e74\u4ee3\u7684\u6240\u6709\u53ef\u4ee5\u4f7f\u7528\u7684\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u90fd\u5927</li> </ul> <p>\u89e3\u51b3\u5185\u5b58\u788e\u7247\u5316\u95ee\u9898\uff1a</p> <ul> <li>JVM\u6709\u57fa\u4e8e\u7ebf\u7a0b\u7684\u89e3\u51b3\u65b9\u6848 TLAB\uff08thread-local allocation buffer\uff09\uff0c\u56fa\u5b9a\u5927\u5c0f\u7684\u5185\u5b58\u7a7a\u95f4\u7ed9\u7ebf\u7a0b\u4f7f\u7528\uff1b</li> <li>HBase\u4e2d\u591a\u4e2aregion\u7531\u4e00\u4e2a\u7ebf\u7a0b\u7ba1\u7406\uff0c\u591a\u4e2aMemstore\u5360\u7528\u7684\u7a7a\u95f4\u65e0\u6cd5\u5408\u7406\u5206\u5f00\uff0cHBase\u81ea\u5b9e\u73b0 MSLAB\uff08MemStore-local Allocatoin Buffer\uff09\uff1b</li> <li>MSLAB\u7684\u5b9e\u73b0\uff1a</li> <li>RegionServer\u4e2d\u7ef4\u62a4\u7740\u4e00\u4e2a\u5168\u5c40\u7684MemStoreChunkPool\u5b9e\u4f8b,\u662f\u4e00\u4e2achunk\u6c60</li> <li>\u6bcf\u4e2aMemStore\u5b9e\u4f8b\u91cc\u9762\u6709\u4e00\u4e2aMemStoreLAB\u5b9e\u4f8b</li> <li>TODO\uff1a\u5206\u6790\u5177\u4f53\u6d41\u7a0b</li> </ul>"},{"location":"data_query/nosql/kudu/kudu.html","title":"Apache Kudu","text":"<p>Kudu\u7684\u5b9a\u4f4d\u662f \u300cFast Analytics on Fast Data\u300d\uff0c\u662f\u4e00\u4e2a\u65e2\u652f\u6301\u968f\u673a\u8bfb\u5199\u3001\u53c8\u652f\u6301 OLAP \u5206\u6790\u7684\u5927\u6570\u636e\u5217\u5f0f\u5b58\u50a8\u5f15\u64ce\u3002</p>"},{"location":"data_query/nosql/kudu/kudu.html#_1","title":"\u67b6\u6784","text":"<p>Kudu\u662f\u4e2a\u5b58\u50a8\u5f15\u64ce\uff0c\u4e0d\u4ec5\u4ec5\u662f\u5b58\u50a8\u683c\u5f0f\uff0c\u662f\u4e2a\u5b9e\u65f6\u5b58\u50a8\u7cfb\u7edf\uff0c\u652f\u6301\u6beb\u79d2\u7ea7\u5355\u884c\u8bbf\u95ee\u3002</p> <ul> <li>NoSQL\u8bbf\u95ee\uff08\u7c7b\u4f3cHBase\uff09\uff0c\u652f\u6301C++\u3001Java\u3001Python API\uff1b</li> <li>OLAP\u5206\u6790</li> <li>Impala \u96c6\u6210\uff1b</li> <li>Hive MetaStore \u96c6\u6210\uff1b</li> </ul> <p>Kudu\u5206\u4e3aTablet Server\u548creleaseArtifacts\uff0c\u91c7\u7528raft\u901a\u4fe1\uff0c\u4e0d\u9700\u8981Zookeeper\u3002</p>"},{"location":"data_query/nosql/kudu/kudu.html#_2","title":"\u6570\u636e\u6a21\u578b","text":"<p>\u8868\uff1a</p> <ul> <li>\u4e3b\u952e\uff1a\u5141\u8bb8\u590d\u5408\u4e3b\u952e\uff1b</li> <li>\u5217\u5f0f\u5b58\u50a8\uff0c\u5217\u4e2a\u6811\u4e0d\u8981\u8d85\u8fc7300\uff1b</li> <li></li> </ul>"},{"location":"data_query/nosql/kudu/kudu.html#_3","title":"\u5b58\u50a8","text":"<p>\u6570\u636e\u81ea\u884c\u7ba1\u7406\uff0c\u6ca1\u6709\u91c7\u7528HDFS\u3002</p>"},{"location":"data_query/postgres/postgres.html","title":"Postgres","text":"<p>\u5bf9\u8c61\u5173\u7cfb\u578b\u5f00\u6e90\u6570\u636e\u5e93</p> <p>PostgreSQL\u662f\u76ee\u524d\u529f\u80fd\u5f3a\u5927\u3001\u6280\u672f\u5148\u8fdb\u3001\u7a33\u5b9a\u53ef\u9760\u3001\u751f\u6001\u826f\u597d\u3001\u5e94\u7528\u5e7f\u6cdb\u7684\u5f00\u6e90\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u4e3b\u8981\u7279\u6027\u5982\u4e0b</p> <ul> <li>\u5bf9\u8c61\u5173\u7cfb </li> <li>\u9ad8\u53ef\u6269\u5c55 </li> <li>SQL\u517c\u5bb9 </li> <li>\u5f15\u7528\u7ea6\u675f</li> <li>\u7075\u6d3bAPI </li> <li>\u8fc7\u7a0b\u8bed\u8a00</li> <li>MVCC\u673a\u5236</li> <li>\u652f\u6301WAL</li> </ul>"},{"location":"data_query/postgres/postgres.html#_1","title":"\u4f53\u7cfb\u7ed3\u6784","text":""},{"location":"data_query/postgres/postgres.html#_2","title":"\u5b58\u50a8\u8fc7\u7a0b","text":""},{"location":"data_query/postgres/postgres.html#_3","title":"\u67e5\u8be2\u5904\u7406","text":""},{"location":"data_query/postgres/postgres.html#_4","title":"\u4e8b\u52a1\u7ba1\u7406","text":""},{"location":"data_query/postgres/postgres.html#_5","title":"\u5b89\u5168\u673a\u5236","text":""},{"location":"data_query/postgres/postgres.html#_6","title":"\u57fa\u7840","text":""},{"location":"data_query/presto/data_types.html","title":"Presto SQL \u6570\u636e\u7c7b\u578b","text":"<ul> <li>Boolean</li> <li> <p>true or false</p> </li> <li> <p>Integer</p> </li> <li>TINYINT :  - 2 ^ 7 ~  2 ^ 7 - 1</li> <li>SMALLINT :  - 2 ^ 15 ~  2 ^ 15 - 1</li> <li>INTEGER :  - 2 ^ 31 ~  2 ^ 31 - 1</li> <li>BIGING :  - 2 ^ 63 ~  2 ^ 63 - 1</li> <li>Floating-Point</li> <li>REAL :  32\u4f4d</li> <li>DOUBLE : 64\u4f4d</li> <li>Fixed-Precision</li> <li>DECIMAL : \u56fa\u5b9a\u7cbe\u5ea6\u7684\u6570\u503c\uff0c\u652f\u6301\u603b\u517138\u4f4d\u6570\uff0c\u4f46\u662f\u6700\u597d\u572818\u4f4d\u4ee5\u5185\u3002<code>DECIMAL(10,3)</code></li> <li>String</li> <li>VARCHAR : \u53d8\u957f\u7684\u5b57\u7b26\u6570\u636e\uff0c\u53ef\u9009\u6700\u5927\u957f\u5ea6\uff0c\u5982 varchar(128)</li> <li>CHAR : \u56fa\u5b9a\u957f\u5ea6\u7684\u5b57\u7b26\u6570\u636e\uff0c\u9ed8\u8ba4\u957f\u5ea6\u4e3a1\u3002char(7)\u8868\u793a\u603b\u67097\u4e2a\u5b57\u7b26\uff0c\u63d2\u5165<code>dog</code>\u65f6\u4f1a\u5728\u672b\u5c3e\u52a0\u4e0a4\u4e2a\u9690\u5f0f\u7684\u7a7a\u683c\uff0c\u6bd4\u8f83\u65f6\u4f1a\u5e26\u4e0a\u3002</li> <li>VARNINARY : \u53d8\u957f\u7684\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u5982<code>X'65683F'</code>\u3002</li> <li>JSON : JSON\u5bf9\u8c61\u3002</li> <li>Data and Time</li> <li>DATE : Calendar date (year, month, day)\u3002\u5982<code>DATE '2001-08-22'</code>\u3002</li> <li>TIME :  Time of day (hour, minute, second, millisecond) without a time zone\u3002\u5982 <code>TIME '01:02:03.456'</code>\u3002</li> <li>TIME WITH ZONE :  (hour, minute, second, millisecond) \u3002<code>TIME '01:02:03.456 America/Los_Angeles'</code>\u3002</li> <li>TIMESTAMP : \u6ca1\u6709\u65f6\u533a\u7684\u5305\u542bdate\u548cday\u7684\u65f6\u95f4\u3002<code>TIMESTAMP '2001-08-22 03:04:05.321'</code></li> <li>TIMESTAMP WITH ZONE : \u6709\u65f6\u533a\u7684date\u548cday\u7684\u65f6\u95f4\u3002<code>TIMESTAMP '2001-08-22 03:04:05.321 America/Los_Angeles'</code></li> <li>INTERVAL YEAR TO MONTH :  <code>INTERVAL '3' MONTH</code></li> <li>INTERVAL DAT TO SECOND :  <code>INTERVAL '2' DAY'</code></li> <li>Structural</li> <li>ARRAY :  <code>ARRAY[1, 2, 3]</code></li> <li>MAP :  <code>MAP(ARRAY['foo', 'bar'], ARRAY[1, 2])</code></li> <li>ROW :  <code>CAST(ROW(1, 2e0) AS ROW(x BIGINT, y DOUBLE))</code>\uff0c\u53ef\u4ee5\u901a\u8fc7<code>.x</code>\u6216\u8005<code>[1]</code>\u83b7\u53d6\u3002</li> <li>Network Address</li> <li>IPADDRESS :  <code>IPADDRESS '10.0.0.1'</code>, <code>IPADDRESS '2001:db8::1'</code></li> <li>UUID</li> <li><code>UUID '12151fd2-7586-11e9-8f9e-2a86e4085a59'</code></li> <li>HyperLogLog</li> <li>HyperLogLog : \u9ad8\u6548\u8ba1\u7b97<code>approx_distinct()</code>\uff0c\u5f00\u59cb\u4ee5\u7a00\u758f\u8868\u793a\uff0c\u82e5\u66f4\u6709\u6548\u5219\u5207\u6362\u4f4d\u7a20\u5bc6\u8868\u793a\u3002</li> <li>P4HyperLogLog :  \u4e00\u76f4\u4ee5\u7a20\u5bc6\u8868\u793a</li> <li>Quantile Digest</li> <li>\u8868\u793a\u6570\u636e\u5206\u5e03\u7684\u7ed3\u6784\uff0c\u7cbe\u5ea6\u53ef\u914d\u7f6e\u3002</li> </ul>"},{"location":"data_query/presto/install.html","title":"Presto \u5b89\u88c5","text":"<p>PrestoDB\u7684\u4e0b\u8f7d\u5730\u5740\uff08PrestoSQL\u66f4\u540d\u4e3aTrino\uff09\uff1a</p> <ul> <li>\u4e0b\u8f7d presto-server.tar.gz\uff0c\u89e3\u538b\u540e\u91cd\u547d\u540d\u4e3a presto-server\uff1b</li> <li> <p>\u5728\u540c\u7ea7\u76ee\u5f55\u521b\u5efadata\u76ee\u5f55\uff0c\u4fdd\u5b58\u6570\u636e\uff0c\u65b9\u4fbfpresto-sever\u5347\u7ea7\uff1b</p> </li> <li> <p>\u914d\u7f6ePresto\uff0c\u5728presto-server\u76ee\u5f55\u4e0b\u521b\u5efaetc\u76ee\u5f55\uff0c\u914d\u7f6e\uff1a</p> </li> <li>Node Properties : \u6bcf\u4e2a\u8282\u70b9\u7684\u73af\u5883\u914d\u7f6e</li> <li>JVM Config : JVM\u914d\u7f6e</li> <li>Config Properties : Presto server \u914d\u7f6e</li> <li> <p>Catalog Properties : Connectors \u914d\u7f6e</p> </li> <li> <p>\u542f\u52a8Presto</p> </li> <li><code>bin/launcher start</code> : deamon\u8fd0\u884c</li> <li><code>bin/launcher run</code> : \u524d\u53f0\u8fd0\u884c</li> </ul>"},{"location":"data_query/presto/presto.html","title":"Presto","text":"<p>[toc]</p>"},{"location":"data_query/presto/presto.html#_1","title":"\u7b80\u4ecb","text":"<p>\u5f00\u6e90\u7684\u5206\u5e03\u5f0fSQL\u67e5\u8be2\u5f15\u64ce\uff0cOLAP\uff0c\u6570\u636e\u89c4\u6a21\u4eceGB\u5230PB\uff1b</p> <p>Presto\u6709\u4e24\u4e2a\u7248\u672c\uff0cPrestoDB\u548cPrestoSQL\u9879\u76ee\uff08PrestoSQL\u66f4\u540d\u4e3aTrino\uff09\uff1b </p> <p>\u573a\u666f</p> <p>\u6570\u636e\u5206\u6790\uff0c\u54cd\u5e94\u65f6\u95f4\u4ece\u6beb\u79d2\u5230\u5206\u949f\uff0c\u65e0\u91cd\u8bd5\uff08\u67e5\u8be2\u5931\u8d25\u91cd\u65b0\u67e5\u8be2\uff09\uff0c\u7528\u4f5cAdhoc\u67e5\u8be2\u3002</p>"},{"location":"data_query/presto/presto.html#_2","title":"\u67b6\u6784","text":""},{"location":"data_query/presto/presto.html#_3","title":"\u8282\u70b9\u7c7b\u578b","text":""},{"location":"data_query/presto/presto.html#coordinatormaster","title":"Coordinator\uff08Master\uff09","text":"<p>\u804c\u8d23\uff1a\u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\u3001\u89e3\u6790\u8bed\u53e5\u3001\u751f\u6210\u67e5\u8be2\u8ba1\u5212\uff0c\u7ba1\u7406Presto workers\u3002</p> <p>Coordinator\u548cclient\u3001worker\u901a\u4fe1\u91c7\u7528REST API\uff1b</p> <p>discovery server\uff0c \u901a\u5e38\u5185\u5d4c\u4e8ecoordinator\u8282\u70b9\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5355\u72ec\u90e8\u7f72\uff0c\u7528\u4e8e\u8282\u70b9\u5fc3\u8df3\u3002</p>"},{"location":"data_query/presto/presto.html#worker","title":"Worker","text":"<p>\u804c\u8d23\uff1a\u6267\u884cTasks\u548c\u5904\u7406\u6570\u636e\uff0c\u4ececonnectors\u4e2d\u83b7\u53d6\u6570\u636e\u5e76\u5f7c\u6b64\u95f4\u4ea4\u6362\u4e2d\u95f4\u6570\u636e\uff08shuffle\uff09\u3002</p> <p>Workers\u5f7c\u6b64\u95f4\u901a\u4fe1\u91c7\u7528REST API\uff1b</p>"},{"location":"data_query/presto/presto.html#datasouce","title":"\u6570\u636e\u6e90\uff08DataSouce\uff09","text":""},{"location":"data_query/presto/presto.html#connector","title":"Connector","text":"<p>\u7c7b\u4f3c\u4e8edatabase\u4e2d\u7684driver\uff0c\u662fPresto SPI\u7684\u5b9e\u73b0\uff0c\u5b9e\u73b0\u6570\u636e\u6e90\u7684\u53ef\u6269\u5c55\u6027\u3002</p> <p>\u5185\u7f6e\uff1aJMX\uff0cSystem\uff0cHive\uff0cTPCH\u7684connector\u3002</p> <p>\u6bcf\u4e2acatalog\u548c\u7279\u5b9a\u7684connector\u5173\u8054\u3002</p>"},{"location":"data_query/presto/presto.html#catalog","title":"Catalog","text":"<p>Catalog\u5305\u542bschemas\u548c\u6570\u636e\u6e90\u7684\u5f15\u7528\u3002</p> <p>\u8868\u7684\u5168\u540d<code>hive.test_data.test</code>\u8868\u793a<code>hive</code> catalog\u4e2d<code>test_data</code> schema\u4e2d\u7684<code>test</code>\u8868\u3002</p> <p>Catalogs\u5b9a\u4e49\u5728properties\u6587\u4ef6\u4e2d\uff0c\u5b58\u50a8\u5728Presto\u7684\u914d\u7f6e\u76ee\u5f55\u3002</p>"},{"location":"data_query/presto/presto.html#schema","title":"Schema","text":"<p>\u8868\u7684\u7ec4\u7ec7\u5f62\u5f0f\uff0c\u7c7b\u4f3c\u4e8e\u6570\u636e\u5e93\u4e2d\u7684\u5e93\u3002</p>"},{"location":"data_query/presto/presto.html#table","title":"Table","text":"<p>\u7c7b\u4f3c\u4e8e\u6570\u636e\u5e93\u4e2d\u7684\u8868\uff0cunordered rows organized into named columns with types</p> <p>connector\u4e2d\u5b9a\u4e49\u4e86\u5143\u6570\u636e\u5230\u8868\u7684\u6620\u5c04\u3002</p>"},{"location":"data_query/presto/presto.html#query-execution-model","title":"\u67e5\u8be2\u6267\u884c\u6a21\u578b\uff08Query Execution Model\uff09","text":"<p>Presto\u6267\u884cSQL\u8bed\u53e5\uff0c\u5e76\u5c06\u8bed\u53e5\u8f6c\u6210\u67e5\u8be2\u5728coordinator\u548cworkers\u7ec4\u6210\u7684\u5206\u5e03\u5f0f\u96c6\u7fa4\u4e2d\u6267\u884c\u3002</p>"},{"location":"data_query/presto/presto.html#statement","title":"Statement","text":"<p>ANSI-comatible\u7684SQL\u8bed\u53e5\uff0c\u6587\u672c\u5f62\u5f0f\u3002\u4f1a\u88ab\u89e3\u6790\u6210\u67e5\u8be2\u8ba1\u5212\uff0c\u5c06\u67e5\u8be2\u5206\u914d\u5230Workers\u4e0a\u6267\u884c\u3002</p>"},{"location":"data_query/presto/presto.html#query","title":"Query","text":"<p>Statement -&gt; \u5206\u5e03\u5f0f\u7684\u67e5\u8be2\u8ba1\u5212 -&gt; \u4e00\u7cfb\u5217\u76f8\u4e92\u8054\u7cfb\u7684stages\u3002</p> <p>\u67e5\u8be2\u5305\u542b\u9636\u6bb5\u3001\u4efb\u52a1\u3001\u5206\u5272\u3001\u8fde\u63a5\u5668\u4ee5\u53ca\u5176\u4ed6\u7ec4\u4ef6\u548c\u6570\u636e\u6e90\uff0c\u534f\u540c\u5de5\u4f5c\u4ee5\u4ea7\u751f\u7ed3\u679c\u3002</p>"},{"location":"data_query/presto/presto.html#stage","title":"Stage","text":"<p>\u5f53Presto\u6267\u884c\u67e5\u8be2\u65f6\uff0c\u5b83\u5c06\u6267\u884c\u5206\u89e3\u4e3a\u9636\u6bb5\u5c42\u6b21\u7ed3\u6784\u3002</p> <p>\u7ec4\u6210\u67e5\u8be2\u7684\u9636\u6bb5\u5c42\u6b21\u7ed3\u6784\u7c7b\u4f3c\u4e8e\u6811\u3002\u6bcf\u4e2a\u67e5\u8be2\u90fd\u6709\u4e00\u4e2a\u6839\u9636\u6bb5\uff0c\u5b83\u8d1f\u8d23\u805a\u5408\u6765\u81ea\u5176\u4ed6\u9636\u6bb5\u7684\u8f93\u51fa\u3002\u9636\u6bb5\u662f\u534f\u8c03\u5668\u7528\u6765\u5efa\u6a21\u5206\u5e03\u5f0f\u67e5\u8be2\u8ba1\u5212\u7684\uff0c\u4f46\u662f\u9636\u6bb5\u672c\u8eab\u5e76\u4e0d\u5728Presto worker\u4e0a\u8fd0\u884c\u3002</p>"},{"location":"data_query/presto/presto.html#task","title":"Task","text":"<p>\u9636\u6bb5\uff08Stage\uff09\u662f\u4f5c\u4e3a\u4e00\u7cfb\u5217\u5206\u5e03\u5728Presto Worker\u7684\u4efb\u52a1\uff08Task\uff09\u5b9e\u73b0\u7684\u3002</p> <p>\u5206\u5e03\u5f0f\u67e5\u8be2\u8ba1\u5212\u88ab\u5206\u89e3\u4e3a\u4e00\u7cfb\u5217\u9636\u6bb5\uff0c\u8fd9\u4e9b\u9636\u6bb5\u968f\u540e\u88ab\u8f6c\u6362\u4e3a\u4efb\u52a1\uff0c\u8fd9\u4e9b\u4efb\u52a1\u968f\u540e\u6839\u636e\u5206\u89e3\u6216\u5904\u7406\u62c6\u5206\u3002Presto\u4efb\u52a1\u6709\u8f93\u5165\u548c\u8f93\u51fa\uff0c\u4e00\u4e2a\u9636\u6bb5\u53ef\u4ee5\u7531\u4e00\u7cfb\u5217\u4efb\u52a1\u5e76\u884c\u6267\u884c\u4e00\u6837\uff0c\u4e00\u4e2a\u4efb\u52a1\u662f\u7531\u4e00\u7cfb\u5217\u9a71\u52a8\u7a0b\u5e8f\uff08Driver\uff09\u5e76\u884c\u6267\u884c\u3002</p>"},{"location":"data_query/presto/presto.html#split","title":"Split","text":"<p>\u4efb\u52a1\u7684\u8f93\u5165\u662f\u6570\u636e\u96c6\u4e0a\u7684\u5206\u7247\u6570\u636e\u3002\u4f4e\u7ea7\u522b\u7684Stage\u4ececonnector\u4e2d\u68c0\u7d22\u6570\u636e\u5206\u6279\u90a3\uff0c\u9ad8\u7ea7\u522b\u7684Stage\u4ece\u5176\u5b83Stage\u4e2d\u52a0\u9501\u5206\u7247\u6570\u636e\u3002</p> <p>Coordinator\u5728\u8c03\u5ea6\u67e5\u8be2\u65f6\uff0c\u4f1a\u67e5\u8be2connector\u83b7\u53d6\u8868\u7684splits\uff0c\u5e76\u8bb0\u5f55\u8fd0\u884ctasks\u7684\u673a\u5668\u4ee5\u53ca\u6bcf\u4e2atask\u5904\u7406\u7684split\u3002</p>"},{"location":"data_query/presto/presto.html#driver","title":"Driver","text":"<p>\u4efb\u52a1\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u5e76\u884c\u9a71\u52a8\u7a0b\u5e8f\u3002</p> <p>\u9a71\u52a8\u7a0b\u5e8f\u5bf9\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\uff0c\u5e76\u7ed3\u5408\u64cd\u4f5c\u7a0b\u5e8f\uff08Operator\uff09\u4ea7\u751f\u8f93\u51fa\uff0c\u7136\u540e\u7531\u4e00\u4e2a\u4efb\u52a1\u805a\u5408\uff0c\u7136\u540e\u5728\u53e6\u4e00\u4e2a\u9636\u6bb5\u4ea4\u4ed8\u7ed9\u53e6\u4e00\u4e2a\u4efb\u52a1\u3002\u9a71\u52a8\u7a0b\u5e8f\u662f\u64cd\u4f5c\u7b97\u5b50\u5b9e\u4f8b\u7684\u5e8f\u5217\u3002</p> <p>Driver\u662fPresto\u67b6\u6784\u4e2d\u6700\u4f4e\u7ea7\u522b\u7684\u5e76\u884c\u6027\u3002\u4e00\u4e2a\u9a71\u52a8\u5668\u6709\u4e00\u4e2a\u8f93\u5165\u548c\u4e00\u4e2a\u8f93\u51fa\u3002</p>"},{"location":"data_query/presto/presto.html#operator","title":"Operator","text":"<p>Operator \u6d88\u8d39\u3001\u8f6c\u6362\u5e76\u4ea7\u751f\u6570\u636e\uff0c\u7ed9\u5176\u5b83Operator\u6d88\u8d39\u3002\u6bd4\u5982Scan \u548c Filter\u64cd\u4f5c\u3002</p>"},{"location":"data_query/presto/presto.html#exchange","title":"Exchange","text":"<p>Exchanges\u5bf9\u4e00\u4e2a\u67e5\u8be2\u7684\u4e0d\u540cstage\uff0c\u5728Presto\u8282\u70b9\u95f4\u4f20\u8f93\u6570\u636e\u3002Tasks\u4ea7\u751f\u6570\u636e\u5230output buffer\uff0c\u5e76\u7528exchange client\u6d88\u8d39\u5176\u4ed6tasks\u7684\u6570\u636e\u3002</p>"},{"location":"data_query/presto/presto.html#_4","title":"\u914d\u7f6e","text":""},{"location":"data_query/presto/presto.html#_5","title":"\u5185\u5b58","text":"<p>System Pool </p> <ul> <li>\u7528\u6765\u4fdd\u7559\u7ed9\u7cfb\u7edf\u4f7f\u7528\u7684\uff0c\u5982\u673a\u5668\u4e4b\u95f4\u4f20\u9012\u6570\u636e\uff0c\u5728\u5185\u5b58\u4e2d\u4f1a\u7ef4\u62a4buffer\uff1b</li> <li>\u9ed8\u8ba4\u4e3a40%\u7684\u5185\u5b58\u7a7a\u95f4\u7559\u7ed9\u7cfb\u7edf\u4f7f\u7528\u3002</li> </ul> <p>General Pool \u548cReserved Pool\uff1a</p> <ul> <li> <p>\u7528\u6765\u5206\u914dquery\u8fd0\u884c\u65f6\u5185\u5b58\uff1b</p> </li> <li> <p>\u5176\u4e2d\u5927\u90e8\u5206\u7684query\u4f7f\u7528general Pool\u3002 \u800c\u6700\u5927\u7684\u4e00\u4e2aquery\uff0c\u4f7f\u7528Reserved Pool\uff0c \u6240\u4ee5Reserved Pool\u7684\u7a7a\u95f4\u7b49\u540c\u4e8e\u4e00\u4e2aquery\u5728\u4e00\u4e2a\u673a\u5668\u4e0a\u8fd0\u884c\u4f7f\u7528\u7684\u6700\u5927\u7a7a\u95f4\u5927\u5c0f\uff0c\u9ed8\u8ba4\u662f10%\u7684\u7a7a\u95f4\u3002</p> </li> <li>\u9632\u6b62\u5176\u5b83\u5c0f\u5185\u5b58query\u4e00\u76f4\u63d2\u5165\uff0c\u5bfc\u81f4\u5927\u5185\u5b58query\u65e0\u6cd5\u6267\u884c\uff0c\u4e00\u76f4\u518d\u7b49\u5f85\u53ef\u7528\u5185\u5b58\uff1b</li> <li>General \u5219\u4eab\u6709\u9664\u4e86System Pool \u548c Reserved Pool\u4e4b\u5916\u7684\u5176\u4ed6\u5185\u5b58\u7a7a\u95f4\u3002</li> </ul>"},{"location":"data_query/presto/presto.html#_6","title":"\u5b89\u5168","text":""},{"location":"data_query/presto/presto.html#_7","title":"\u7ba1\u7406","text":""},{"location":"data_query/presto/presto.html#_8","title":"\u8fde\u63a5\u5668","text":""},{"location":"data_query/presto/presto.html#_9","title":"\u51fd\u6570\u548c\u64cd\u4f5c\u7b26","text":""},{"location":"data_query/presto/presto_scale.html","title":"Presto \u6269\u5c55\u6027","text":""},{"location":"data_query/presto/presto_scale.html#raptorx-2021","title":"RaptorX (2021)","text":"<p>\u5728 Hive Connector \u4e2d\uff1a</p> <ul> <li>Metastore\u7248\u672c\u5316\u7684\u7f13\u5b58\u65b9\u6848\uff1a</li> <li>\u628a\u8868/\u5206\u533a\u4fe1\u606f\u7f13\u5b58\u5230coordinator\u4e2d\uff0c\u9274\u4e8e\u5143\u6570\u636e\u662f\u53ef\u53d8\u7684\uff0c\u5c31\u50cfIceberg\u6216Delta Lake\u90a3\u6837\uff0c\u56e0\u6b64\u4fe1\u606f\u662f\u88ab\u7248\u672c\u5316\u7684\uff0c\u6211\u4eec\u53ea\u4e0emetastore\u540c\u6b65\u7248\u672c\u4fe1\u606f\uff0c\u5e76\u4ec5\u5728\u5f53\u524d\u7248\u672c\u5931\u6548\u65f6\u53bb\u83b7\u53d6\u6700\u65b0\u7248\u672c\uff1b</li> <li>\u6587\u4ef6\u5217\u8868\u7f13\u5b58\uff1a</li> <li>\u5c06\u6765\u81ea\u8fdc\u7aef\u5b58\u50a8\u5206\u533a\u76ee\u5f55\u7684\u6587\u4ef6\u5217\u8868\u7f13\u5b58\u8d77\u6765\uff0c\u907f\u514d<code>list</code>\u7684\u5f00\u9500\uff1b</li> <li>\u7247\u6bb5\u7ed3\u679c\u7f13\u5b58\uff1a</li> <li>\u5728leaf worker\u7684\u672c\u5730SSD\u4e0a\u7f13\u5b58\u90e8\u5206\u8ba1\u7b97\u7ed3\u679c\u3002\u7531\u4e8e\u67e5\u8be2\u4f1a\u4e0d\u65ad\u53d8\u5316\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u8fd0\u7528\u88c1\u526a\u6280\u672f\u6765\u7b80\u5316\u67e5\u8be2\u8ba1\u5212\uff1b</li> <li>\u6587\u4ef6\u53e5\u67c4\uff08file handle\uff09\u548cfooter\u7684\u7f13\u5b58\uff1a</li> <li>\u5728leaf worker\u5185\u5b58\u4e2d\u7f13\u5b58\u6253\u5f00\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff08file descriptor\uff09\u548cstripe/\u6587\u4ef6footer\u4fe1\u606f\uff0c\u56e0\u4e3a\u5728\u8bfb\u53d6\u6587\u4ef6\u65f6\u8fd9\u4e9b\u6570\u636e\u5f80\u5f80\u4f1a\u88ab\u9891\u7e41\u8bbf\u95ee\uff1b</li> <li>Alluxio\u6570\u636e\u7f13\u5b58\uff1a</li> <li>\u5728leaf worker\u7684\u672c\u5730SSD\u4e0a\u7528\u5bf9\u9f50\u76841MB\u5927\u5c0f\u6570\u636e\u5757\u6765\u7f13\u5b58\u6587\u4ef6\u6bb5\u3002\u8be5\u5e93\uff08library\uff09\u662f\u901a\u8fc7Alluxio\u7684\u7f13\u5b58\u670d\u52a1\u642d\u5efa\u7684\uff1b</li> <li>\u4eb2\u548c\u8c03\u5ea6\u5668\uff1a</li> <li>\u662f\u6307\u6839\u636e\u6587\u4ef6\u8def\u5f84\u56fa\u5b9a\u5730\u5411\u5bf9\u5e94worker\u53d1\u9001\u8bf7\u6c42\uff0c\u4ece\u800c\u4f7f\u7f13\u5b58\u547d\u4e2d\u7387\u6700\u5927\u5316\u7684\u8c03\u5ea6\u5668\uff08scheduler\uff09\u3002</li> </ul>"},{"location":"data_query/presto/presto_scale.html#_1","title":"\u67b6\u6784","text":""},{"location":"data_query/presto/presto_scale.html#_2","title":"\u4f7f\u7528","text":"<p>\u8981\u5b8c\u5168\u542f\u7528\u8be5\u529f\u80fd\uff0c\u6211\u4eec\u9700\u8981\u4e3aworker\u914d\u5907\u672c\u5730\u7684SSD\uff0c\u4e3a\u4e86\u80fd\u591f\u542f\u7528\u672c\u6587\u6240\u8ff0\u7684\u5404\u4e2a\u7f13\u5b58\u5c42\uff0c\u8bf7\u8fdb\u884c\u4ee5\u4e0b\u914d\u7f6e:</p> <p><code>/catalog/hive.properties</code></p> <pre><code># \u8c03\u5ea6\nhive.node-selection-strategy=SOFT_AFFINITY\n# Metastore\u7248\u672c\u5316\u7684\u7f13\u5b58\nhive.partition-versioning-enabled=true\nhive.metastore-cache-scope=PARTITION\nhive.metastore-cache-ttl=2d\nhive.metastore-refresh-interval=3d\nhive.metastore-cache-maximum-size=10000000\n# \u6587\u4ef6\u5217\u8868\u7f13\u5b58\nhive.file-status-cache-expire-time=24h\nhive.file-status-cache-size=100000000\nhive.file-status-cache-tables=*\n# \u6570\u636e\u7f13\u5b58\ncache.enabled=true\ncache.base-directory=file:///mnt/flash/data\ncache.type=ALLUXIO\ncache.alluxio.max-cache-size=1600GB\n\n# \u6587\u4ef6\u548cstripe footer \u7f13\u5b58(/catalog/hive.properties):\n# **\u9488\u5bf9ORC \u6216DWRF\u683c\u5f0f\uff1a**\nhive.orc.file-tail-cache-enabled=true\nhive.orc.file-tail-cache-size=100MB\nhive.orc.file-tail-cache-ttl-since-last-access=6h\nhive.orc.stripe-metadata-cache-enabled=true\nhive.orc.stripe-footer-cache-size=100MB\nhive.orc.stripe-footer-cache-ttl-since-last-access=6h\nhive.orc.stripe-stream-cache-size=300MB\nhive.orc.stripe-stream-cache-ttl-since-last-access=6h\n\n# **\u9488\u5bf9Parquet\u683c\u5f0f\uff1a**\nhive.parquet.metadata-cache-enabled=true\nhive.parquet.metadata-cache-size=100MB\nhive.parquet.metadata-cache-ttl-since-last-access=6h\n</code></pre> <p>\u7247\u6bb5\u7ed3\u679c\u7f13\u5b58(<code>/config.properties</code>\uff0c <code>/catalog/hive.properties</code>):</p> <pre><code>fragment-result-cache.enabled=true\nfragment-result-cache.max-cached-entries=1000000\nfragment-result-cache.base-directory=file:///mnt/flash/fragment\nfragment-result-cache.cache-ttl=24h\nhive.partition-statistics-based-optimization-enabled=true\n</code></pre>"},{"location":"data_query/presto/presto_scale.html#_3","title":"\u6570\u636e\u6269\u5c55\u6027","text":"<p>\u8fdb\u4e00\u6b65\u652f\u6301ETL\u7c7b\u578b\u7684queries\uff0c\u66f4\u5927\u7684\u6570\u636e\u91cf\u5904\u7406\u3002</p>"},{"location":"data_query/presto/presto_scale.html#presto-unlimited2019","title":"~~Presto Unlimited\uff082019\uff0c\u5df2\u5e9f\u5f03\uff09~~","text":"<p>Presto Unlimited: MPP SQL Engine at Scale</p> <p>Presto Unlimited\u662fPresto team \u5185\u90e8\u5c1d\u8bd5\u505a\u7684\u4e00\u4e9b\u57fa\u672c\u7684scalability\u65b9\u9762\u7684\u5c1d\u8bd5\uff0c\u5305\u62ecmaterialized exchange\u5230hive tables\uff0cgrouped execution\uff0coperator spilling\u7b49\u7b49\u6280\u672f\u3002</p> <p>\u4f46\u662f\u6709\u4e24\u4e2adesign decisions\u6210\u4e3a\u4e86\u74f6\u9888\uff08\u5171\u4eabJVM container\u800c\u975e\u6bcf\u4e2aquery\u72ec\u7acb\u7684 JVM container\uff1b\u5168\u5c40\u5355\u4e00coordinator\uff09\u5bfc\u81f4Presto\u5728fault-tolerance\u548cresource management\u8fd9\u4e24\u70b9\u6709\u77ed\u677f\u3002</p> <p>\u6539\u8fdb\u8fd9\u4e24\u70b9\u57fa\u672c\u7b49\u540c\u4e8e\u5728Presto\u5185\u90e8\u5185\u7f6e\u4e00\u4e2aSpark core\u7c7b\u4f3c\u7684\u8bbe\u8ba1\u4e86\u3002</p> <p>While Presto Unlimited solved part of the problem by allowing shuffle to be partitioned over distributed disk, it didn\u2019t fully solve fault tolerance, and did nothing to improve isolation and resource management.</p>"},{"location":"data_query/presto/presto_scale.html#_4","title":"\u67b6\u6784","text":""},{"location":"data_query/presto/presto_scale.html#presto_on_spark2021","title":"Presto_On_Spark\uff082021\uff09","text":"<p>Scaling with Presto on Spark</p> <p>Spark\uff1arow-oriented + whole stage codegen </p> <p>Presto\uff1acolumnar processing + vectorization</p> <p>\u501f\u7528spark core\u4f5c\u4e3a\u8d44\u6e90\u8c03\u5ea6\u548c\u5206\u5e03\u5f0f\u8fd0\u884c\u5e73\u53f0\uff0c\u800c\u4e0e\u6b64\u540c\u65f6\u4fdd\u7559Presto\u7684\u8fd0\u7b97\u5185\u6838\u548c\u4e0a\u5c42\u7684query parsing &amp; planning \u90e8\u5206\uff0c\u7528\u6237\u5c42\u9762\u7edf\u4e00\u4f7f\u7528\u63a5\u53e3\u3002</p>"},{"location":"data_query/presto/presto_scale.html#_5","title":"\u67b6\u6784","text":""},{"location":"data_query/presto/presto_scale.html#_6","title":"\u539f\u7406","text":""},{"location":"data_query/presto/presto_scale.html#_7","title":"\u4f7f\u7528","text":"<p>\u53c2\u8003\u6307\u5bfc\uff1ahttps://prestodb.io/docs/current/installation/spark.html#</p> <p>\u63d0\u4ea4\u811a\u672c</p> <pre><code>/spark/bin/spark-submit \\\n--master spark://spark-master:7077 \\\n--executor-cores 4 \\\n--conf spark.task.cpus=4 \\\n--class com.facebook.presto.spark.launcher.PrestoSparkLauncher \\\n  presto-spark-launcher-0.272.1.jar \\\n--package presto-spark-package-0.272.1.tar.gz \\\n--config /presto/etc/config.properties \\\n--catalogs /presto/etc/catalogs \\\n--catalog hive \\\n--schema default \\\n--file query.sql\n</code></pre>"},{"location":"data_query/presto/syntax.html","title":"Presto SQL \u8bed\u6cd5","text":"<p>Presto\u662f\u517c\u5bb9ANSI SQL\u7684\u67e5\u8be2\u5f15\u64ce\u3002</p>"},{"location":"data_query/presto/syntax.html#select","title":"SELECT","text":"<pre><code>[ WITH with_query [, ...] ]\nSELECT [ ALL | DISTINCT ] select_expression [, ...]\n[ FROM from_item [, ...] ]\n[ WHERE condition ]\n[ GROUP BY [ ALL | DISTINCT ] grouping_element [, ...] ]\n[ HAVING condition]\n[ { UNION | INTERSECT | EXCEPT } [ ALL | DISTINCT ] select ]\n[ ORDER BY expression [ ASC | DESC ] [, ...] ]\n[ OFFSET count [ ROW | ROWS ] ]\n[ LIMIT { count | ALL } | FETCH { FIRST | NEXT } [ count ] { ROW | ROWS } { ONLY | WITH TIES } ]\n</code></pre>"},{"location":"data_query/search/lucene.html","title":"Apache Lucene","text":"<p>Apache Lucene is a high-performance, full-featured text search engine library written in Java.</p> <p>The project releases a core search library, named Lucene\u2122 core, as well as PyLucene, a python binding for Lucene.</p> <ul> <li>\u5176\u4ed6\u8bed\u8a00\u7684\u641c\u7d22\u5f15\u64ce\u89c1 Xapian</li> </ul> <p>\u4e13\u6ce8\u4e8e\u4fe1\u606f\u68c0\u7d22\u6280\u672f\u7684\u6587\u672c\u7d22\u5f15\u548c\u641c\u7d22\u529f\u80fd\u7b49\u901a\u7528\u6027\u90e8\u5206\uff0c\u800c\u628a\u4fe1\u606f\u91c7\u96c6\u5904\u7406\u3001\u7528\u6237\u4ea4\u4e92UI\u3001\u5546\u4e1a\u903b\u8f91\u7b49\u4e1a\u52a1\u76f8\u5173\u6027\u90e8\u5206\u4ea4\u7ed9\u5e94\u7528\u5c42\u3002</p>"},{"location":"data_query/search/lucene.html#lucene-core","title":"Lucene Core","text":"<p>A Java library providing powerful indexing and search features, as well as spellchecking, hit highlighting and advanced analysis/tokenization capabilities.</p>"},{"location":"data_query/search/solr.html","title":"Apache Solr","text":""},{"location":"data_query/time_db/index.html","title":"\u65f6\u5e8f\u6570\u636e\u5e93","text":""},{"location":"data_query/time_db/index.html#_2","title":"\u57fa\u672c\u6982\u5ff5","text":"<p>\u4e0d\u540c\u7684\u65f6\u5e8f\u6570\u636e\u5e93\u79f0\u547c\u7565\u6709\u4e0d\u540c - metric: \u5ea6\u91cf\uff0c\u76f8\u5f53\u4e8e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u7684table\u3002 - data point: \u6570\u636e\u70b9\uff0c\u76f8\u5f53\u4e8e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u7684row\u3002 - timestamp\uff1a\u65f6\u95f4\u6233\uff0c\u4ee3\u8868\u6570\u636e\u70b9\u4ea7\u751f\u7684\u65f6\u95f4\u3002 - field: \u5ea6\u91cf\u4e0b\u7684\u4e0d\u540c\u5b57\u6bb5\u3002\u6bd4\u5982\u4f4d\u7f6e\u8fd9\u4e2a\u5ea6\u91cf\u5177\u6709\u7ecf\u5ea6\u548c\u7eac\u5ea6\u4e24\u4e2afield\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\u5b58\u653e\u7684\u662f\u4f1a\u968f\u7740\u65f6\u95f4\u6233\u7684\u53d8\u5316\u800c\u53d8\u5316\u7684\u6570\u636e\u3002 - tag: \u6807\u7b7e\uff0c\u6216\u8005\u9644\u52a0\u4fe1\u606f\u3002\u4e00\u822c\u5b58\u653e\u7684\u662f\u5e76\u4e0d\u968f\u7740\u65f6\u95f4\u6233\u53d8\u5316\u7684\u5c5e\u6027\u4fe1\u606f\u3002timestamp\u52a0\u4e0a\u6240\u6709\u7684tags\u53ef\u4ee5\u8ba4\u4e3a\u662ftable\u7684primary key\u3002</p> <p>p3-\u65f6\u5e8f\u6570\u636e\u5e93\u57fa\u672c\u6982\u5ff5\u56fe</p> <p>\u5982\u4e0b\u56fe\uff0c\u5ea6\u91cf\u4e3aWind\uff0c\u6bcf\u4e00\u4e2a\u6570\u636e\u70b9\u90fd\u5177\u6709\u4e00\u4e2atimestamp\uff0c\u4e24\u4e2afield\uff1adirection\u548cspeed\uff0c\u4e24\u4e2atag\uff1asensor\u3001city\u3002\u5b83\u7684\u7b2c\u4e00\u884c\u548c\u7b2c\u4e09\u884c\uff0c\u5b58\u653e\u7684\u90fd\u662fsensor\u53f7\u7801\u4e3a95D8-7913\u7684\u8bbe\u5907\uff0c\u5c5e\u6027\u57ce\u5e02\u662f\u4e0a\u6d77\u3002\u968f\u7740\u65f6\u95f4\u7684\u53d8\u5316\uff0c\u98ce\u5411\u548c\u98ce\u901f\u90fd\u53d1\u751f\u4e86\u6539\u53d8\uff0c\u98ce\u5411\u4ece23.4\u53d8\u621023.2\uff1b\u800c\u98ce\u901f\u4ece3.4\u53d8\u6210\u4e863.3\u3002</p> <p></p> <p>\u65f6\u5e8f\u6570\u636e\u5e93\u9700\u8981\u89e3\u51b3\u4ee5\u4e0b\u51e0\u4e2a\u95ee\u9898</p> <ul> <li> <p>\u65f6\u5e8f\u6570\u636e\u7684\u5199\u5165\uff1a\u5982\u4f55\u652f\u6301\u6bcf\u79d2\u949f\u4e0a\u5343\u4e07\u4e0a\u4ebf\u6570\u636e\u70b9\u7684\u5199\u5165\u3002</p> </li> <li> <p>\u65f6\u5e8f\u6570\u636e\u7684\u8bfb\u53d6\uff1a\u53c8\u5982\u4f55\u652f\u6301\u5728\u79d2\u7ea7\u5bf9\u4e0a\u4ebf\u6570\u636e\u7684\u5206\u7ec4\u805a\u5408\u8fd0\u7b97\u3002</p> </li> <li> <p>\u6210\u672c\u654f\u611f\uff1a\u7531\u6d77\u91cf\u6570\u636e\u5b58\u50a8\u5e26\u6765\u7684\u662f\u6210\u672c\u95ee\u9898\u3002\u5982\u4f55\u66f4\u4f4e\u6210\u672c\u7684\u5b58\u50a8\u8fd9\u4e9b\u6570\u636e\uff0c\u5c06\u6210\u4e3a\u65f6\u5e8f\u6570\u636e\u5e93\u9700\u8981\u89e3\u51b3\u7684\u91cd\u4e2d\u4e4b\u91cd</p> </li> </ul> <p>LSM tree\u66ff\u6362B tree\uff0c\u5982Hbase, Cassandra\u7b49nosql\u4e2d\uff1b</p> <p>\u5206\u7247\u65b9\u6cd5\uff0c\u65f6\u5e8f\u6570\u636e\u5e93\u7684\u5206\u7247\u65b9\u6cd5\u548c\u5176\u4ed6\u5206\u5e03\u5f0f\u7cfb\u7edf\u662f\u76f8\u901a\u7684\u3002</p> <ul> <li>\u54c8\u5e0c\u5206\u7247\uff1a\u8fd9\u79cd\u65b9\u6cd5\u5b9e\u73b0\u7b80\u5355\uff0c\u5747\u8861\u6027\u8f83\u597d\uff0c\u4f46\u662f\u96c6\u7fa4\u4e0d\u6613\u6269\u5c55\u3002</li> <li>\u4e00\u81f4\u6027\u54c8\u5e0c\uff1a\u8fd9\u79cd\u65b9\u6848\u5747\u8861\u6027\u597d\uff0c\u96c6\u7fa4\u6269\u5c55\u5bb9\u6613\uff0c\u53ea\u662f\u5b9e\u73b0\u590d\u6742\u3002\u4ee3\u8868\u6709Amazon\u7684DynamoDB\u548c\u5f00\u6e90\u7684Cassandra\u3002</li> <li>\u8303\u56f4\u5212\u5206\uff1a\u901a\u5e38\u914d\u5408\u5168\u5c40\u6709\u5e8f\uff0c\u590d\u6742\u5ea6\u5728\u4e8e\u5408\u5e76\u548c\u5206\u88c2\u3002\u4ee3\u8868\u6709HBase\u3002</li> </ul> <p>LSM Tree\u7684\u67b6\u6784\u4ec5\u9002\u5408\u5b58\u50a8\u5355\u884c\u8bb0\u5f55\u8f83\u5c0f\u7684\u6570\u636e\uff08\u6700\u597d\u5c0f\u4e8eKB\u7ea7\u522b\uff09\uff0c\u5bf9\u4e8e\u504f\u5927\u7684\u6570\u636e\uff0cIO\u5197\u4f59\u592a\u5927 \uff1f</p>"},{"location":"data_query/time_db/index.html#time-db","title":"Time DB\u5bf9\u6bd4","text":"<ul> <li> <p>InfluxDB\uff1a\u5f00\u6e90\u7248\u4e0d\u652f\u6301\u96c6\u7fa4</p> </li> <li> <p>Kairosdb:</p> </li> <li>\u5e95\u5c42\u4f7f\u7528Cassandra\u4f5c\u4e3a\u5206\u5e03\u5f0f\u5b58\u50a8\u5f15\u64ce\uff0c\u91c7\u7528\u7684\u662fLSM tree\u3002</li> <li>Cassandra\u6709\u4e24\u7ea7\u7d22\u5f15\uff1apartition key\u548cclustering key\u3002\u5176\u4e2dpartition key\u662f\u5176\u5206\u7247ID\uff0c\u4f7f\u7528\u7684\u662f\u4e00\u81f4\u6027\u54c8\u5e0c\uff1b\u800cclustering key\u5728\u4e00\u4e2apartition key\u4e2d\u4fdd\u8bc1\u6709\u5e8f\u3002</li> <li>Kairosdb\u5229\u7528Cassandra\u7684\u7279\u6027\uff0c\u5c06 \\+\\+&lt;\u6570\u636e\u7c7b\u578b&gt;+\\\u4f5c\u4e3apartition key\uff0c\u6570\u636e\u70b9\u65f6\u95f4\u5728timestamp\u4e0a\u7684\u504f\u79fb\u4f5c\u4e3aclustering key\uff0c\u5176\u6709\u5e8f\u6027\u65b9\u4fbf\u505a\u57fa\u4e8e\u65f6\u95f4\u8303\u56f4\u7684\u67e5\u8be2\u3002 <li> <p>partition key\u4e2d\u7684timestamp\u662f3\u5468\u5bf9\u9f50\u7684\uff0c\u4e5f\u5c31\u662f\u8bf421\u5929\u7684\u65f6\u5e8f\u6570\u636e\u4f1a\u5728\u4e00\u4e2aclustering key\u4e0b\u30023\u5468\u7684\u6beb\u79d2\u6570\u662f18\u4ebf\u6b63\u597d\u5c0f\u4e8eCassandra\u6bcf\u884c\u5217\u657020\u4ebf\u7684\u9650\u5236\u3002</p> </li> <li> <p>Prometheus\uff1a</p> </li> <li> <p>a Cloud Native Computing Foundation project, is a systems and service monitoring system. It collects metrics from configured targets at given intervals, evaluates rule expressions, displays the results, and can trigger alerts if some condition is observed to be true.</p> </li> <li> <p>OpenTSDB\uff1a</p> </li> <li>\u5e95\u5c42\u4f7f\u7528HBase\u4f5c\u4e3a\u5176\u5206\u5e03\u5f0f\u5b58\u50a8\u5f15\u64ce\uff0c\u91c7\u7528\u7684\u662fLSM tree\u3002</li> <li>OpenTSDB\u7684row key\u7ec4\u7ec7\u65b9\u5f0f\u3002<ul> <li>[salt]\\\\\\\\[...\\\\tagvN&gt;] <li>\u7531\u4e8eHbase\u7684row key\u5168\u5c40\u6709\u5e8f\uff0c\u6240\u4ee5\u589e\u52a0\u4e86\u53ef\u9009\u7684salt\u4ee5\u8fbe\u5230\u66f4\u597d\u7684\u6570\u636e\u5206\u5e03\uff0c\u907f\u514d\u70ed\u70b9\u4ea7\u751f\uff0c\u518d\u7531\u4e0etimestamp\u95f4\u7684\u504f\u79fb\u548c\u6570\u636e\u7c7b\u578b\u7ec4\u6210column qualifier\u3002timestamp\u662f\u5c0f\u65f6\u5bf9\u9f50\u7684\uff0c\u4e00\u4e2arow key\u4e0b\u6700\u591a\u5b58\u50a8\u4e00\u4e2a\u5c0f\u65f6\u7684\u6570\u636e\u3002\u5e76\u4e14\u9700\u8981\u5c06\u6784\u6210row key\u7684metric\u548ctags\u90fd\u8f6c\u6210\u5bf9\u5e94\u7684uid\u6765\u51cf\u5c11\u5b58\u50a8\u7a7a\u95f4\uff0c\u907f\u514dHfile\u7d22\u5f15\u592a\u5927</li>"},{"location":"data_query/time_db/kairosdb.html","title":"KairosDB","text":"<p>KairosDB\u6700\u521d\u662f\u4eceOpenTSDB 1.x\u7248\u672cfork\u51fa\u6765\u7684\u4e00\u4e2a\u5206\u652f\uff0c\u4f7f\u7528Cassandra\u66ff\u6362\u4e86HBase\u3002</p> <ul> <li> <p>\u53ef\u63d2\u62d4\u5f0f\u7684\u5b58\u50a8\u5f15\u64ce</p> </li> <li> <p>OpenTSDB\u5f02\u6b65\u7684HBase Client\uff08\u73b0\u5728\u4f5c\u4e3a\u72ec\u7acb\u7684\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\u8f93\u51fa\uff1aAsyncHBase\uff09\uff1b</p> </li> <li> <p>KairosDB\u4e25\u683c\u5b9a\u4e49\u4e86\u5b58\u50a8\u5c42\u7684API Interface\uff0c\u6574\u4f53\u903b\u8f91\u4e0e\u5b58\u50a8\u5c42\u8026\u5408\u5ea6\u8f83\u4f4e\uff0c\u80fd\u6bd4\u8f83\u5bb9\u6613\u7684\u6269\u5c55\u591a\u79cd\u5b58\u50a8\u5f15\u64ce\u3002</p> </li> <li>\u652f\u6301\u591a\u79cd\u6570\u636e\u7c7b\u578b\u53ca\u81ea\u5b9a\u4e49\u7c7b\u578b\u7684\u503c</li> <li>OpenTSDB\u53ea\u652f\u6301numeric\u7684\u503c</li> <li> <p>KairosDB\u652f\u6301numeric\u3001string\u7c7b\u578b\u7684\u503c\uff0c\u4e5f\u652f\u6301\u81ea\u5b9a\u4e49\u6570\u503c\u7c7b\u578b</p> </li> <li> <p>\u4e0d\u540c\u7684\u5b58\u50a8\u6a21\u578b</p> </li> <li> <p>OpenTSDB\u5728\u5b58\u50a8\u6a21\u578b\u4e0a\u4f7f\u7528\u4e86UID\u7684\u538b\u7f29\u4f18\u5316\uff0c\u6765\u4f18\u5316\u67e5\u8be2\u548c\u5b58\u50a8</p> </li> <li> <p>KairosDB\u91c7\u53d6\u4e86\u4e00\u4e2a\u4e0d\u540c\u7684\u601d\u8def\uff0c\u5229\u7528\u4e86Cassandra\u5bbd\u8868\u7684\u7279\u6027</p> </li> </ul> <p>\u672c\u8d28\u4e0a\uff0cOpenTSDB\u5b58\u50a8\u6a21\u578b\u91c7\u7528\u7684UID\u7f16\u7801\u4f18\u5316\uff0c\u4e3b\u8981\u89e3\u51b3\u7684\u5c31\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u5b58\u50a8\u7a7a\u95f4\u4f18\u5316\uff1aUID\u7f16\u7801\u89e3\u51b3\u91cd\u590d\u7684row key\u5b58\u50a8\u9020\u6210\u7684\u5197\u4f59\u7684\u5b58\u50a8\u7a7a\u95f4\u95ee\u9898\u3002</li> <li>\u67e5\u8be2\u4f18\u5316\uff1a\u5229\u7528UID\u7f16\u7801\u540eTagKey\u548cTagValue\u56fa\u5b9a\u5b57\u8282\u957f\u5ea6\u7684\u7279\u6027\uff0c\u5229\u7528HBase\u7684FuzzyRowFilter\u505a\u7279\u5b9a\u573a\u666f\u7684\u67e5\u8be2\u4f18\u5316\u3002</li> </ul> <p>KairosDB\u5728\u89e3\u51b3\u8fd9\u4e24\u4e2a\u95ee\u9898\u4e0a\uff0c\u91c7\u53d6\u4e86\u53e6\u5916\u4e00\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\uff0c\u4f7f\u5176\u4e0d\u9700\u8981\u4f7f\u7528UID\u7f16\u7801\uff0c\u4e5f\u4e0d\u5b58\u5728\u4f7f\u7528UID\u7f16\u7801\u540e\u9057\u7559\u7684\u95ee\u9898\u3002\u5148\u770b\u4e0bKairosDB\u7684\u5b58\u50a8\u6a21\u578b\u662f\u600e\u6837\u7684\uff0c\u5b83\u4e3b\u8981\u7531\u4ee5\u4e0b\u4e09\u5f20\u8868\u6784\u6210\uff1a</p> <ol> <li>DataPoints: \u5b58\u50a8\u6240\u6709\u539f\u59cb\u6570\u636e\u70b9\uff0c\u6bcf\u4e2a\u6570\u636e\u70b9\u4e5f\u662f\u7531metric\u3001tags\u3001timestamp\u548cvalue\u6784\u6210\u3002\u8be5\u8868\u4e2d\u4e00\u884c\u6570\u636e\u7684\u65f6\u95f4\u8de8\u5ea6\u662f\u4e09\u5468\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e09\u5468\u5185\u7684\u6240\u6709\u6570\u636e\u70b9\u90fd\u5b58\u50a8\u5728\u540c\u4e00\u884c\uff0c\u800cOpenTSDB\u5185\u7684\u884c\u7684\u65f6\u95f4\u8de8\u5ea6\u53ea\u6709\u4e00\u4e2a\u5c0f\u65f6\u3002RowKey\u7684\u7ec4\u6210\u4e0eOpenTSDB\u7c7b\u4f3c\uff0c\u7ed3\u6784\u4e3a<code>tagv2&gt;...</code>\uff0c\u4e0d\u540c\u7684\u662fmetric, tag key\u548ctag value\u90fd\u5b58\u50a8\u539f\u59cb\u503c\uff0c\u800c\u4e0d\u662fUID\u3002</li> <li>RowKeyIndex: \u8be5\u8868\u5b58\u50a8\u6240\u6709metric\u5bf9\u5e94DataPoints\u8868\u5185\u6240\u6709row key\u7684\u6620\u5c04\uff0c\u4e5f\u5c31\u662f\u8bf4\u540c\u4e00\u4e2ametric\u4e0a\u5199\u5165\u7684\u6240\u6709\u7684row key\uff0c\u90fd\u4f1a\u5b58\u50a8\u5728\u540c\u4e00\u884c\u5185\uff0c\u5e76\u4e14\u6309\u65f6\u95f4\u6392\u5e8f\u3002\u8be5\u8868\u4e3b\u8981\u88ab\u7528\u4e8e\u67e5\u8be2\uff0c\u5728\u6839\u636etag key\u6216\u8005tag value\u505a\u8fc7\u6ee4\u65f6\uff0c\u4f1a\u5148\u4ece\u8fd9\u5f20\u8868\u8fc7\u6ee4\u51fa\u8981\u67e5\u8be2\u7684\u65f6\u95f4\u6bb5\u5185\u6240\u6709\u7b26\u5408\u6761\u4ef6\u7684row key\uff0c\u540e\u5728DataPoints\u8868\u5185\u67e5\u8be2\u6570\u636e\u3002</li> <li>StringIndex: \u8be5\u8868\u5c31\u4e09\u884c\u6570\u636e\uff0c\u6bcf\u4e00\u884c\u5206\u522b\u5b58\u50a8\u6240\u6709\u7684metric\u3001tag key\u548ctag value\u3002</li> </ol> <p>KairosDB\u5185\u67e5\u8be2\u7684\u6574\u4e2a\u6d41\u7a0b\uff1a</p> <ol> <li>\u6839\u636e\u67e5\u8be2\u6761\u4ef6\uff0c\u627e\u51fa\u6240\u6709DataPoints\u8868\u91cc\u7684row key</li> <li>\u5982\u679c\u6709\u81ea\u5b9a\u4e49\u7684plugin\uff0c\u5219\u4eceplugin\u4e2d\u83b7\u53d6\u8981\u67e5\u8be2\u7684\u6240\u6709row key\u3002\uff08\u901a\u8fc7Plugin\u53ef\u4ee5\u6269\u5c55\u4f7f\u7528\u5916\u90e8\u7d22\u5f15\u7cfb\u7edf\u6765\u5bf9row key\u8fdb\u884c\u7d22\u5f15\uff0c\u4f8b\u5982\u4f7f\u7528ElasticSearch\uff09</li> <li>\u5982\u679c\u6ca1\u6709\u81ea\u5b9a\u4e49\u7684plugin\uff0c\u5219\u5728RowKeyIndex\u8868\u91cc\u6839\u636emetric\u548c\u65f6\u95f4\u8303\u56f4\uff0c\u627e\u51fa\u6240\u6709\u7684row key\u3002\uff08\u6839\u636e\u5217\u540d\u7684\u8303\u56f4\u6765\u7f29\u5c0f\u67e5\u8be2\u8303\u56f4\uff0c\u5217\u540d\u7684\u8303\u56f4\u662f(metric+startTime, metric+endTime))</li> <li>\u6839\u636erow key\uff0c\u4eceDataPoints\u8868\u91cc\u627e\u51fa\u6240\u6709\u7684\u6570\u636e</li> </ol> <p>\u76f8\u6bd4OpenTSDB\u76f4\u63a5\u5728\u6570\u636e\u8868\u4e0a\u8fdb\u884c\u626b\u63cf\u6765\u8fc7\u6ee4row key\u7684\u65b9\u5f0f\uff0cKairosDB\u5229\u7528\u7d22\u5f15\u8868\u65e0\u7591\u4f1a\u5927\u5927\u51cf\u5c11\u626b\u63cf\u7684\u6570\u636e\u91cf\u3002\u5728metric\u4e0btagKey\u548ctagValue\u7ec4\u5408\u6709\u9650\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u5927\u5927\u7684\u63d0\u9ad8\u67e5\u8be2\u6548\u7387\u3002</p>"},{"location":"data_query/time_db/time_space_index.html","title":"\u5e38\u89c1\u7684\u65f6\u7a7a\u7d22\u5f15\u6280\u672f","text":"<p>\u65f6\u7a7a\u6570\u636e\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5305\u542b\u4e86\u4e24\u4e2a\u7ef4\u5ea6\u7684\u4fe1\u606f\uff1a\u7a7a\u95f4\u4fe1\u606f\u4e0e\u65f6\u95f4\u4fe1\u606f\u3002</p> <p>\u6700\u5178\u578b\u7684\u65f6\u7a7a\u6570\u636e\uff0c\u83ab\u8fc7\u4e8e\u79fb\u52a8\u5bf9\u8c61\u7684\u8f68\u8ff9\u70b9\u6570\u636e\uff0c\u5982\u6bcf\u96945\u79d2\u949f\u8bb0\u5f55\u7684\u8f66\u8f86\u5b9e\u65f6\u4f4d\u7f6e\u4fe1\u606f\u3002</p> <p>HBase\u4e2d\u7684\u6570\u636e\u6309\u7167RowKey\u5355\u7ef4\u5ea6\u6392\u5e8f\u7ec4\u7ec7\uff0c\u800c\u6211\u4eec\u73b0\u5728\u5374\u9762\u4e34\u7684\u662f\u4e00\u4e2a\u591a\u7ef4\u6570\u636e\u95ee\u9898\u3002\u56e0\u6b64\uff0cHBase\u5982\u679c\u60f3\u5f88\u597d\u7684\u652f\u6301\u65f6\u7a7a\u6570\u636e\u7684\u5b58\u50a8\uff0c\u9700\u8981\u5f15\u5165\u65f6\u7a7a\u7d22\u5f15\u6280\u672f\u3002</p> <p>\u5f00\u6e90\u7684\u65f6\u7a7a\u6570\u636e\u5e93\uff1aGeoMesa</p> <p></p>"},{"location":"data_query/time_db/time_space_index.html#r-trees","title":"R-Trees","text":"<p>\u8bba\u6587\u300aR-Trees: A Dynamic Index Structure For Spatial Searching\u300b</p> <p></p> <p>R-Trees\u57fa\u4e8e\u8fd9\u6837\u7684\u601d\u60f3\u8bbe\u8ba1\uff1a</p> <ul> <li>\u6bcf\u4e00\u4e2a\u7a7a\u95f4\u5bf9\u8c61\uff0c\u5982\u4e00\u4e2a\u591a\u8fb9\u5f62\u533a\u57df\uff0c\u90fd\u5b58\u5728\u4e00\u4e2a\u6700\u5c0f\u7684\u77e9\u5f62\uff0c\u80fd\u591f\u6070\u597d\u5305\u542b\u6b64\u65f6\u7a7a\u5bf9\u8c61\uff0c\u5982\u4e0a\u56fe\u4e2d\u7684\u77e9\u5f62R6\u6240\u5305\u542b\u7684\u5f2f\u6708\u5f62\u533a\u57df\u3002\u8fd9\u4e2a\u6700\u5c0f\u5305\u56f4\u77e9\u5f62\u88ab\u79f0\u4e4b\u4e3aMBR(Minimum Bounding Rectangle)\u3002</li> <li>\u591a\u4e2a\u76f8\u90bb\u7684\u77e9\u5f62\uff0c\u53ef\u4ee5\u88ab\u5305\u542b\u5728\u4e00\u4e2a\u66f4\u5927\u7684\u6700\u5c0f\u5305\u56f4\u77e9\u5f62\u4e2d\u3002\u5982R6\u3001R9\u4ee5\u53caR10\u4e09\u4e2a\u77e9\u5f62\uff0c\u53ef\u4ee5\u88ab\u5305\u542b\u5728R3\u4e2d\uff0c\u800cR11\u4e0eR12\u5219\u88ab\u5305\u542b\u5728R4\u4e2d\u3002</li> <li>\u7ee7\u7eed\u8fed\u4ee3\uff0c\u603b\u80fd\u627e\u5230\u82e5\u5e72\u4e2a\u6700\u5927\u7684\u533a\u57df\uff0c\u4ee5\u4e00\u79cd\u6811\u72b6\u7684\u5f62\u5f0f\uff0c\u5c06\u6240\u6709\u7684\u65f6\u7a7a\u5bf9\u8c61\u7ed9\u5bb9\u7eb3\u8fdb\u53bb\uff0c\u5982\u4e0a\u56fe\u4e2d\u7684R1, R2\u3002\u8fd9\u6837\uff0c\u6574\u4e2a\u6811\u72b6\u7ed3\u6784\uff0c\u5448\u73b0\u5982\u4e0b\uff1a</li> </ul> <p></p> <p>R-Trees\u7684\u5b9a\u4e49\uff1a</p> <ol> <li> <p>\u6bcf\u4e00\u4e2aLeaf Node\u5305\u542bm\u5230M\u4e2a\u7d22\u5f15\u8bb0\u5f55\uff08Root\u8282\u70b9\u9664\u5916\uff09\u3002</p> </li> <li> <p>\u6bcf\u4e00\u4e2a\u7d22\u5f15\u8bb0\u5f55\u662f\u4e00\u4e2a\u5173\u4e8e(I, tuple-identifier)\u7684\u4e8c\u5143\u7ec4\u4fe1\u606f\uff0cI\u662f\u7a7a\u95f4\u5bf9\u8c61\u7684\u6700\u5c0f\u5305\u56f4\u77e9\u5f62\uff0c\u800ctuple-identifier\u7528\u6765\u63cf\u8ff0\u7a7a\u95f4\u5bf9\u8c61\u672c\u8eab\u3002</p> </li> <li> <p>\u6bcf\u4e00\u4e2aNon-leaf\u8282\u70b9\uff0c\u5305\u542bm\u5230M\u4e2a\u5b50\u8282\u70b9\uff08Root\u8282\u70b9\u9664\u5916\uff09\u3002</p> </li> <li> <p>Non-leaf\u8282\u70b9\u4e0a\u7684\u6bcf\u4e00\u4e2a\u6570\u636e\u5143\u7d20\uff0c\u662f\u4e00\u4e2a(I, child-pointer)\u7684\u4e8c\u5143\u7ec4\u4fe1\u606f\uff0cchild-pointer\u6307\u5411\u5176\u4e2d\u4e00\u4e2a\u5b50\u8282\u70b9\uff0c\u800cI\u5219\u662f\u8fd9\u4e2a\u5b50\u8282\u70b9\u4e0a\u6240\u6709\u77e9\u5f62\u7684\u6700\u5c0f\u5305\u56f4\u77e9\u5f62\u3002</p> </li> </ol> <p>\u5982\u4e0a\u56fe\u4e2d\uff0cR3\u3001R4\u4ee5\u53caR5\uff0c\u5171\u540c\u6784\u6210\u4e00\u4e2anon-leaf\u8282\u70b9\uff0cR3\u6307\u5411\u5305\u542b\u5143\u7d20R8\uff0cR9\u4ee5\u53caR10\u7684\u5b50\u8282\u70b9\uff0c\u8fd9\u4e2a\u6307\u9488\u5c31\u662fchild-pointer\uff0c\u800c\u4e0eR8\uff0cR9\u4ee5\u53caR10\u76f8\u5173\u7684\u6700\u5c0f\u5305\u56f4\u77e9\u5f62\uff0c\u5c31\u662fI\u3002</p> <ol> <li> <p>Root\u8282\u70b9\u81f3\u5c11\u5305\u542b\u4e24\u4e2a\u5b50\u8282\u70b9\uff0c\u9664\u975e\u5b83\u672c\u8eab\u4e5f\u662f\u4e00\u4e2aLeaf Node\u3002</p> </li> <li> <p>\u6240\u6709\u7684Leaf Nodes\u90fd\u51fa\u73b0\u5728\u6811\u7684\u540c\u4e00\u5c42\u4e0a\u3002</p> </li> </ol> <p>\u4ece\u5b9a\u4e49\u4e0a\u6765\u770b\uff0cR-Trees\u4e0eB-Trees\u5b58\u5728\u8bf8\u591a\u7c7b\u4f3c\uff1aRoot\u8282\u70b9\u4e0eNon-Leaf\u8282\u70b9\uff0c\u5747\u5305\u542b\u9650\u5b9a\u6570\u91cf\u7684\u5b50\u8282\u70b9\uff1b\u6240\u6709\u7684Leaf Nodes\u90fd\u51fa\u73b0\u5728\u6811\u7684\u540c\u4e00\u5c42\u4e0a\u3002\u8fd9\u4e24\u79cd\u6811\u4e5f\u90fd\u662f\u81ea\u5e73\u8861\u7684\u3002</p> <p>R-Trees\u6709\u591a\u79cd\u53d8\u79cd\uff0c\u5982R+-Trees\uff0cR*-Trees\uff0cX-Trees, M-Trees\uff0cBR-Trees\u7b49\u7b49\u3002</p>"},{"location":"data_query/time_db/time_space_index.html#quad-trees","title":"Quad-Trees","text":"<p>\u8bba\u6587\u300aQuad Trees: A Data Structure for Retrieval on Composite Keys\u300b</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u7684A,B,C,E,F,G\u5747\u4e3aPoint\uff0c\u4ee5\u6bcf\u4e00\u4e2aPoint\u4f5c\u4e3a\u4e2d\u5fc3\u70b9\uff0c\u53ef\u4ee5\u5c06\u4e00\u4e2a\u533a\u95f4\u5206\u62104\u4e2a\u8c61\u9650\u3002</p> <p>\u4efb\u4f55\u65b0\u5199\u5165\u7684\u4e00\u4e2aPoint\uff0c\u603b\u80fd\u627e\u5230\u4e00\u4e2a\u67d0\u4e00\u4e2a\u5df2\u5b58\u5728\u7684Point\u7684\u5b50\u8c61\u9650\uff0c\u6765\u5b58\u653e\u8fd9\u4e2a\u65b0\u7684Point\u3002</p> <p>\u6574\u4e2a\u6811\u72b6\u7ed3\u6784\u5448\u73b0\u5982\u4e0b\uff1a</p> <p></p> <p>\u9c9c\u660e\u7684\u7279\u70b9\uff1a1. \u5bf9\u4e8e\u975e\u53f6\u5b50\u8282\u70b9\uff0c\u5747\u5305\u542b4\u4e2a\u5b50\u8282\u70b9\uff0c\u5bf9\u5e944\u4e2a\u9762\u79ef\u4e0d\u4e00\u7684\u8c61\u9650\u30022.\u4e0d\u5e73\u8861\uff0c\u6811\u7684\u7ed3\u6784\u4e0e\u6570\u636e\u7684\u5199\u5165\u987a\u5e8f\u76f4\u63a5\u76f8\u5173\u30023.\u6709\u7a7a\u7684Leaf Nodes\uff0c\u4e14\u6240\u6709\u7684Leaf Nodes\u5219\u662f\u201d\u53c2\u5dee\u4e0d\u9f50\u201d\u7684(\u5e76\u4e0d\u4e00\u5b9a\u90fd\u51fa\u73b0\u5728\u6811\u7684\u540c\u4e00\u5c42\u4e2d)\u30024.\u6570\u636e\u65e2\u53ef\u80fd\u51fa\u73b0\u5728\u5206\u679d\u8282\u70b9\u4e2d\uff0c\u4e5f\u53ef\u80fd\u51fa\u73b0\u5728\u53f6\u5b50\u8282\u70b9\u4e2d\u3002</p> <p>\u53e6\u4e00\u79cd\u5178\u578b\u7684Quad-Trees\uff0c\u88ab\u79f0\u4e4b\u4e3aPoint Region QuadTrees(\u7b80\u79f0\u4e3aPR QuadTrees)\uff0c\u6bcf\u4e00\u6b21\u8fed\u4ee3\u51fa\u6765\u76844\u4e2a\u8c61\u9650\uff0c\u9762\u79ef\u76f8\u540c\uff0c\u4e14\u4e0d\u4f9d\u8d56\u4e8e\u7528\u6237\u6570\u636ePoint\u4f5c\u4e3a\u5206\u5272\u70b9\uff0c\u6216\u8005\u8bf4\uff0c\u6570\u636e\u5206\u533a\u4e0e\u7528\u6237\u6570\u636e\u65e0\u5173\u3002\u6bcf\u4e00\u4e2a\u5212\u5206\u51fa\u6765\u7684\u5b50\u8c61\u9650\u4e2d\uff0c\u53ea\u5141\u8bb8\u5b58\u5728\u4e00\u4e2aPoint\u3002</p>"},{"location":"data_query/time_db/time_space_index.html#k-d-trees","title":"K-D Trees","text":"<p>K-D Trees\u662f\u4e00\u79cd\u9488\u5bf9\u9ad8\u7ef4\u70b9\u5411\u91cf\u6570\u636e\u7684\u7d22\u5f15\u7ed3\u6784\uff0c\u4e00\u68f5\u7b80\u5355\u7684K-D Tree\u5982\u4e0b\u56fe\u6240\u793a(\u539f\u56fe\u6e90\u81eaJames Fogarty\u7684\u201dK-D Trees and Quad Trees\u201d\uff0c\u4f46\u4e3a\u4e86\u66f4\u76f4\u89c2\uff0c\u5173\u4e8e\u5206\u533a\u5206\u5272\u7ebf\u7684\u7ebf\u6761\u505a\u4e86\u6539\u52a8)\uff1a</p> <p></p> <p>K-D Trees \u6bcf\u6b21\u5c06\u533a\u95f4\u5206\u6210\u5de6\u53f3\u6216\u4e0a\u4e0b\u4e24\u4e2a\u533a\u95f4\u3002\u5982\u679c\u5df2\u7ecf\u5b58\u5728\u4e00\u6279Points\uff0c\u5219\u8f83\u5bb9\u6613\u9488\u5bf9\u8fd9\u6279\u6570\u636e\u6784\u5efa\u51fa\u4e00\u68f5\u8d8b\u4e8e\u5e73\u8861\u7684K-D Tree\uff0c\u5982\u82e5\u63a5\u6536\u5b9e\u65f6\u5199\u5165\u7684\u6570\u636e\uff0c\u6216\u8005\u8bf4\u6570\u636e\u66f4\u65b0\u9891\u7e41\uff0cK-D Tree\u5219\u96be\u4ee5\u7ef4\u6301\u5e73\u8861\u6001\uff0c\u9664\u975e\u5bf9\u6574\u68f5\u6811\u8fdb\u884c\u91cd\u6784\u3002</p>"},{"location":"data_query/time_db/time_space_index.html#space-filling-curve","title":"Space Filling Curve","text":"<p>\u5982\u679c\u5c06\u4e00\u4e2a\u5b8c\u6574\u7684\u4e8c\u7ef4\u7a7a\u95f4\uff0c\u5206\u5272\u6210\u4e00\u4e2a\u4e2a\u5927\u5c0f\u76f8\u540c\u7684\u77e9\u5f62\uff0c\u53ef\u4ee5\u5c06Space Filling Curve\u7b80\u5355\u7406\u89e3\u4e3a\u5b83\u662f\u4e00\u79cd\u5c06\u6240\u6709\u7684\u77e9\u5f62\u533a\u57df\u7528\u4e00\u6761\u7ebf\u201d\u4e32\u201d\u8d77\u6765\u7684\u65b9\u6cd5\uff0c\u56e0\u201d\u4e32\u201d\u7684\u65b9\u5f0f\u4e0d\u540c\uff0c\u4e5f\u5c31\u5f15\u7533\u51fa\u4e86\u4e0d\u540c\u7684Space Filling Curve\u7b97\u6cd5\u3002</p> <p>\u5178\u578b\u7684\u5982 Z-Order Curve</p> <p></p> <p>Hilbert Curve\uff1a</p> <p></p> <p>Space Filling Curve\u4e8b\u5b9e\u4e0a\u662f\u4e3a\u7a7a\u95f4\u6570\u636e\u63d0\u4f9b\u4e86\u4e00\u79cd\u4e00\u7ef4\u6392\u5e8f\u7684\u65b9\u6cd5\uff0c\u5b83\u62c9\u8fd1\u4e86\u7a7a\u95f4\u6570\u636e\u4e0e\u4f20\u7edf\u6570\u636e\u5e93\u7684\u8ddd\u79bb\uff1a\u56e0\u4e3a\u8fd9\u610f\u5473\u7740\u53ef\u4ee5\u4f7f\u7528\u4f20\u7edf\u7684B-Tree\u6216B+-Tree\u7d22\u5f15\uff0c\u6765\u5b58\u50a8\u7a7a\u95f4\u6570\u636e\u3002</p>"},{"location":"data_query/time_db/time_space_index.html#geohash","title":"GeoHash","text":"<p>GeoHash\u53ef\u4ee5\u5c06Point\u7f16\u7801\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4e0d\u65ad\u6309\u7167 \u7ecf\u5ea6/\u7eac\u5ea6 \u4e8c\u5206\u7684\u65b9\u5f0f\u6784\u5efa\u6bd4\u7279\u503c\uff0c\u5728\u5bf9\u6bd4\u7279\u503c\u91c7\u7528Base-32\u7f16\u7801\u6210\u5b57\u7b26\u4e32\u3002</p> <p>\u7ecfGeohash\u7f16\u7801\u540e\uff0c\u5176\u987a\u5e8f\u4e0eZ-Order\u7f16\u7801\u4fdd\u6301\u4e00\u81f4\uff0c\u56e0\u6b64\uff0c\u4e5f\u53ef\u4ee5\u5c06Geohash\u7406\u89e3\u6210Z-Order\u7b97\u6cd5\u7684\u4e00\u79cd\u7f16\u7801\u673a\u5236\u3002</p> <ul> <li>\u4ee5\u5b57\u7b26\u4e32\u5b57\u5178\u987a\u5e8f\u8868\u8fbeZ-Order\u987a\u5e8f\uff0c\u5229\u7528\u5b57\u7b26\u4e32\u7684\u524d\u7f00\u5339\u914d\u89c4\u5219\uff0c\u4e5f\u53ef\u5feb\u901f\u5b9e\u73b0\u591a\u8fb9\u5f62\u533a\u57df\u7684\u91cd\u53e0\u8ba1\u7b97\uff0c\u4f46\u5728\u7f16\u7801\u6548\u7387\u4e0a\u5374\u5e76\u65e0\u4efb\u4f55\u4f18\u52bf</li> </ul>"},{"location":"data_query/time_db/time_space_index.html#hbase","title":"\u7ed3\u5408HBase","text":"<p>\u6309\u7167\u4f20\u7edf\u7684\u6811\u904d\u5386\u7684\u987a\u5e8f\u6765\u7406\u89e3R-Trees\u4e2d\u7684\u5bf9\u8c61\u6392\u5e8f\uff0c\u8fd9\u79cd\u6392\u5e8f\u662f\u4e0d\u786e\u5b9a\u7684\u3002\u8fd9\u610f\u5473\u7740\uff0c\u6211\u4eec\u65e0\u6cd5\u6784\u5efa\u51fa\u4e00\u79cd\u786e\u5b9a\u987a\u5e8f\u7684RowKey\u3002</p> <p>K-D Trees\u4e0eHBase\u7ed3\u5408\u7684\u6700\u5927\u969c\u788d\uff0c\u4f9d\u7136\u5728\u4e8e\u5982\u4f55\u5c06Trees\u4e2d\u7684\u6570\u636e\u6620\u5c04\u5230KeyValue\u6a21\u578b\u4e2d\u3002</p> <p>\u5b58\u5728\u4e00\u79cd\u65b9\u6cd5\uff0c\u5c06\u6bcf\u4e00\u4e2a\u5c0f\u65b9\u683c\u7684\u8bbf\u95ee\u8def\u5f84\uff0c\u6620\u5c04\u6210HBase\u7684RowKey\uff0c\u5c31\u5b8c\u7f8e\u89e3\u51b3\u4e86\u65f6\u7a7aPoints\u6570\u636e\u5b58\u653e\u5728HBase\u4e2d\u7684\u95ee\u9898\uff0c\u8fd9\u79cd\u601d\u8def\u6b63\u662fSpatial Filling Curve\u7684\u6838\u5fc3\u601d\u60f3\u3002</p> <p>Z-Order\u66f2\u7ebf\u5728\u8ddd\u79bb\u4fdd\u7559\u5ea6\u4e0a\uff0c\u7565\u5f31\u4e8eHilbert\u66f2\u7ebf\uff0c\u4f46\u5728\u7f16\u7801\u590d\u6742\u5ea6\u4e0a\uff0c\u5374\u6bd4Hilbert\u66f2\u7ebf\u66f4\u4f4e\uff0c\u8fd9\u662fGeoMesa\u9009\u62e9Z-Order\u66f2\u7ebf\u7684\u5173\u952e\u539f\u56e0\u3002</p>"},{"location":"data_query/time_db/apache_iotdb/arch.html","title":"Arch","text":"<p>[toc]</p>"},{"location":"data_query/time_db/apache_iotdb/arch.html#apache-iotdb","title":"Apache IoTDB","text":"<p>\u9488\u5bf9\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u6536\u96c6\u3001\u5b58\u50a8\u4e0e\u5206\u6790\u4e00\u4f53\u5316\u7684\u6570\u636e\u7ba1\u7406\u5f15\u64ce\u3002</p> <p></p>"},{"location":"data_query/time_db/apache_iotdb/arch.html#_1","title":"\u6570\u636e\u6a21\u578b","text":""},{"location":"data_query/time_db/opentsdb/api.html","title":"Api","text":"<p>OpenTSDB 2.3.1\u7248\u672c\u4e4b\u540e\u652f\u6301HBase 2.x </p>"},{"location":"data_query/time_db/opentsdb/api.html#_1","title":"\u4f7f\u7528","text":"<p>\u5199\u5165</p> <ul> <li> <p>Telent\uff0c\u7ec8\u7aef\uff1b</p> </li> <li> <p>HTTP API\uff1b</p> </li> <li>Batch from file\uff1b</li> </ul> <p>\u8bfb\u53d6</p> <ul> <li> <p>CLI tools</p> </li> <li> <p>HTTP API </p> </li> <li> <p>GnuPlot graph</p> </li> </ul>"},{"location":"data_query/time_db/opentsdb/api.html#_2","title":"\u67e5\u8be2\u7684\u8bed\u6cd5","text":""},{"location":"data_query/time_db/opentsdb/api.html#filters","title":"Filters","text":"<p>\u652f\u6301\u5bf9tagV\u503c\u7684\u8fc7\u6ee4\uff08\u5f53\u524d\u4e0d\u652f\u6301\u5bf9metrics\u548ctagk\u8fdb\u884c\u8fc7\u6ee4\uff09\uff1b</p>"},{"location":"data_query/time_db/opentsdb/api.html#aggregation","title":"Aggregation","text":"<p>\u805a\u5408\uff0c\u5c06\u591a\u4e2a\u65f6\u95f4\u5e8f\u5217\u53d8\u6210\u5355\u4e2a\u7684\u6570\u636e\u70b9\uff1b</p>"},{"location":"data_query/time_db/opentsdb/api.html#downsampling","title":"DownSampling","text":"<p>\u4e0b\u91c7\u6837\uff0c\u4ee5\u4e00\u5b9a\u95f4\u9694\u91c7\u7528\u67d0\u79cd\u805a\u5408\u51fd\u6570\uff0c\u8fd4\u56de\u6570\u636e\uff1b\u907f\u514d\u8fd4\u56de\u6570\u636e\u91cf\u8fc7\u5927\u3002</p>"},{"location":"data_query/time_db/opentsdb/api.html#rate","title":"Rate","text":"<p>\u4ee5\u659c\u7387\u7684\u5f62\u5f0f\u8fd4\u56de\uff0c\u4f8b\u5982\u8ba1\u6570\u5668\uff0c\u8fd4\u56de\u7684\u4e0d\u662f\u7edd\u5bf9\u503c\uff0c\u800c\u662f\u589e\u957f\u503c\uff1b</p> <p>\u67e5\u8be2\u5904\u7406\u7684\u987a\u5e8f\uff1a</p> <ol> <li>Filtering</li> <li>Grouping</li> <li>Downsampling</li> <li>Interpolation</li> <li>Aggregation</li> <li>Rate Conversion</li> <li>Functions</li> <li>Expressions</li> </ol>"},{"location":"data_query/time_db/opentsdb/api.html#http-api","title":"HTTP API","text":"<p>GET, POST, DELETE \u65b9\u6cd5</p> <ul> <li>/api/query/exp</li> <li>/api/query/gexp</li> <li>/api/query/last</li> </ul>"},{"location":"data_query/time_db/opentsdb/arch_design.html","title":"Arch design","text":"<p>[toc]</p>"},{"location":"data_query/time_db/opentsdb/arch_design.html#opentsdb","title":"OpenTSDB","text":"<p>OpenTSDB\u662f\u57fa\u4e8eHBase\u7684\u65f6\u5e8f\u6570\u636e\u5e93\uff0c3.0\u4f1a\u589e\u52a0\u66f4\u591a\u7684\u6570\u636e\u6e90\u652f\u6491\uff08\u5982Bigtable, cloud provider\u7b49\uff09\u3002</p> <p>\u4f7f\u7528\u573a\u666f</p> <p>\u6307\u5b9a\u6307\u6807\u540d\u79f0\u548c\u65f6\u95f4\u8303\u56f4\uff0c\u7ed9\u5b9a\u4e00\u4e2a\u6216\u591a\u4e2a\u6807\u7b7e\u540d\u79f0\u548c\u6807\u7b7e\u7684\u503c\u4f5c\u4e3a\u6761\u4ef6\uff0c\u67e5\u8be2\u51fa\u6240\u6709\u7684\u6570\u636e\uff0c\u5e94\u7528\u805a\u5408\u51fd\u6570\u3002</p>"},{"location":"data_query/time_db/opentsdb/arch_design.html#_1","title":"\u67b6\u6784","text":""},{"location":"data_query/time_db/opentsdb/arch_design.html#_2","title":"\u5143\u6570\u636e\u8bbe\u8ba1","text":""},{"location":"data_query/time_db/opentsdb/arch_design.html#uid","title":"UID\u8bbe\u8ba1","text":"<p>UID\u7684\u5168\u79f0\u4e3aUnique Identifier\u3002\u8fd9\u4e9bUID\u4fe1\u606f\u88ab\u4fdd\u5b58\u5728OpenTSDB\u7684\u5143\u6570\u636e\u8868\u4e2d\uff0c\u9ed8\u8ba4\u8868\u540d\u4e3a\u201dtsdb-uid\u201d\u3002</p> <p>OpenTSDB\u5206\u914dUID\u65f6\u9075\u5faa\u5982\u4e0b\u89c4\u5219\uff1a</p> <ul> <li> <p>metrics\u3001tagKey \u548c tagValue\u7684 UID \u5206\u522b\u72ec\u7acb\u5206\u914d\uff1b</p> </li> <li> <p>\u6bcf\u4e2ametrics\u3001tagKey\u3001tagValue\u7684UID\u503c\u90fd\u662f\u552f\u4e00\uff1b</p> </li> <li> <p>UID\u503c\u7684\u8303\u56f4\u662f0x000000\u52300xFFFFFF\uff0c\u5373metrics\uff08\u6216tagKey\u3001tagValue\uff09\u6700\u591a\u53ea\u80fd\u5b58\u57282^24\u4e2a\u4e0d\u540c\u7684\u503c\u3002</p> </li> </ul> <p>\u652f\u6301 UID \u5230 name \u7684\u53cc\u5411\u7d22\u5f15\uff08\u4f1a\u6709\u7f13\u5b58\uff09\uff0c\u5177\u4f53\u8868\u6a21\u578b\u5982\u4e0b\u8282\u6240\u793a\u3002</p>"},{"location":"data_query/time_db/opentsdb/arch_design.html#_3","title":"\u5143\u6570\u636e\u7684\u8868\u6a21\u578b","text":"<p>\u5173\u4e8emetrics\u540d\u4e3a\u201dcpu.hum\u201d\uff0ctagKey\u503c\u4e3a\u201dhost\u201d\uff0ctagValue\u503c\u5206\u522b\u4e3a\u201d189.120.205.26\u2033\u3001\u201d189.120.205.27\u2033\u7684UID\u4fe1\u606f\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <p></p> <ul> <li> <p>RowKey\u4e3a\u201d0\u2033\u7684\u884c\u4e2d\uff0c\u5206\u522b\u4fdd\u5b58\u4e86metrics\u3001tagKey\u548ctagValue\u7684\u5f53\u524dUID\u7684\u6700\u5927\u503c\u3002\u5f53\u4e3a\u65b0\u7684metrics\u3001tagKey\u548ctagValue\u5206\u914d\u4e86\u65b0\u7684UID\u540e\uff0c\u4f1a\u66f4\u65b0\u5bf9\u5e94\u7684\u6700\u5927\u503c\uff1b</p> </li> <li> <p>RowKey\u4e3a\u201d1\u2033\u7684\u884c\u4e2d\uff0cRowKey\u4e3aUID\uff0cQualifier\u4e3a\u201dname:metrics\u201d\u7684\u503c\u5bf9\u5e94metrics name\uff0cQualifier\u4e3a\u201dname:tagk\u201d\u7684\u503c\u4e2d\u5b58\u653e\u4e86tagKey\uff0cQualifier\u4e3a\u201dname:tagv\u201d\u7684\u503c\u4e2d\u5b58\u653e\u4e86tagValue\uff1b</p> </li> <li> <p>RowKey\u4e3a\u201d2\u2033\u7684\u884c\u4e2d\uff0cRowKey\u4e3aUID\uff0cQualifier\u4e3a\u201dname:tagv\u201d\u7684\u503c\u4e3atagValue\uff0c\u4e0d\u5b58\u5728metrics\u4e0etagKey\u4fe1\u606f\u3002</p> </li> <li> <p>RowKey\u4e3a\u201d189.120.205.26\u2033\u7684\u884c\u4e2d\uff0cQualifer\u4e3a\u201did:tagv\u201d\u7684\u503c\u4e3aUID\u4fe1\u606f\u3002\u8868\u793a\u5f53\u201d189.120.205.26\u2033\u4e3atagValue\u65f6\uff0c\u5176UID\u4e3a1\uff1b</p> </li> <li> <p>RowKey\u4e3a\u201d189.120.205.27\u2033\u7684\u884c\u4e2d\uff0cQualifer\u4e3a\u201did:tagv\u201d\u7684\u503c\u4e3aUID\u4fe1\u606f\u3002\u8868\u793a\u5f53\u201d189.120.205.26\u2033\u4e3atagValue\u65f6\uff0c\u5176UID\u4e3a2\uff1b</p> </li> <li> <p>RowKey\u4e3a\u201dcpu.hum\u201d\u7684\u884c\u4e2d\uff0cQualifer\u4e3a\u201did:metrics\u201d\u7684\u503c\u4e3aUID\u4fe1\u606f\u3002\u8868\u793a\u5f53cpu.hum\u4e3ametrics\u65f6\uff0c\u5176UID\u4e3a1\uff1b</p> </li> <li> <p>RowKey\u4e3a\u201dhost\u201d\u7684\u884c\u4e2d\uff0cQualifer\u4e3a\u201did:tagk\u201d\u7684\u503c\u4e3aUID\u4fe1\u606f\u3002\u8868\u793a\u5f53host\u4e3atagValue\u65f6\uff0c\u5176UID\u4e3a1\u3002</p> </li> </ul> <p>\u7531\u4e8eHBase\u7684\u5b58\u50a8\u6570\u636e\u7c7b\u578b\u662fBytes\uff0c\u6240\u4ee5UID\u5728\u5b58\u50a8\u65f6\u4f1a\u88ab\u8f6c\u6362\u4e3a3\u4e2a\u5b57\u8282\u957f\u5ea6\u7684Bytes\u6570\u7ec4\u8fdb\u884c\u5b58\u50a8\u3002\uff08\u5982\u4f55\u9632\u6b62 UID \u548c name\u91cd\u590d\u7684\u60c5\u666f\uff1f \u4e0d\u540c\u7684\u5217\u65cf\u5427\uff09</p>"},{"location":"data_query/time_db/opentsdb/arch_design.html#metrics","title":"Metrics\u8bbe\u8ba1","text":""},{"location":"data_query/time_db/opentsdb/arch_design.html#metircs-rowkey","title":"Metircs Rowkey\u8bbe\u8ba1","text":"<ul> <li>SALT\uff1a\u5efa\u8bae\u5f00\u542fSALT\u529f\u80fd\uff0c\u53ef\u4ee5\u6709\u6548\u63d0\u9ad8\u6027\u80fd\u3002SALT\u6570\u636e\u7684\u957f\u5ea6\u662f\u53d8\u957f\u7684\uff1a\u5982\u679cSALT\u7684\u503c\u503c\u5c11\u4e8e256\uff0c\u90a3\u4e48\u53ea\u7528\u4e00\u4e2a\u5b57\u8282\u8868\u793a\u5373\u53ef\uff1b\u5982\u679c\u9700\u8981\u8bbe\u7f6e\u66f4\u5927\u7684SALT\u503c\uff0c\u4e5f\u4f1a\u76f8\u5e94\u5730\u5360\u7528\u66f4\u591a\u7684\u7a7a\u95f4\u3002</li> <li>Metric ID\uff1ametrics\u540d\u7ecf\u8fc7\u7f16\u7801\u540e\uff0c\u6bcf\u4e2aMetric ID\u7684\u957f\u5ea6\u4e3a\u4e09\u4e2a\u5b57\u8282\u3002</li> <li>Timestamp\uff1a\u8fd9\u91cc\u662f\u6574\u70b9\u5c0f\u65f6\u65f6\u95f4\u6233\u3002</li> <li>tagKey UID &amp; tagValue UID\uff1atagKey\u548ctagValue\u7ecf\u8fc7\u7f16\u7801\u540e\uff0c\u6bcf\u4e2atagKey UID\u548ctagValue UID\u7684\u957f\u5ea6\u90fd\u4e3a\u4e09\u4e2a\u5b57\u8282\u3002tagKey UID\u548ctagValue UID\u5fc5\u987b\u6210\u5bf9\u51fa\u73b0\uff0c\u6700\u5c11\u5fc5\u987b\u5b58\u57281\u5bf9\uff0c\u6700\u591a\u5b58\u57288\u5bf9\u3002</li> </ul> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5728\u76d1\u63a7\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u5b9a\u4e49\u4e00\u4e2a\u76d1\u63a7\u6307\u6807\uff1a   \u6307\u6807\u540d\u79f0\uff1a       sys.cpu.user   \u6807\u7b7e\uff1a       host = 10.101.168.111       cpu = 0   \u6307\u6807\u503c\uff1a       0.5</p>"},{"location":"data_query/time_db/opentsdb/arch_design.html#metircs-qualifier","title":"Metircs Qualifier\u8bbe\u8ba1","text":"<p>Rowkey\u5305\u542b\u7684\u662f\u5c0f\u65f6\u7684\u6570\u636e\uff0cQualifier\u9700\u8981\u4fdd\u5b58\u4e00\u5c0f\u65f6\u4e2d\u5177\u4f53\u67d0\u79d2\u6216\u8005\u6beb\u79d2\u7684\u4fe1\u606f\u3002\u4e00\u79d2\uff083600\uff09\u6700\u591a\u9700\u89812\u4e2a\u5b57\u8282\u8868\u793a\uff0c\u4e00\u6beb\u79d2\uff0836000000\uff09\u6700\u591a\u9700\u89814\u4e2a\u5b57\u8282\u8868\u793a\u3002OpenTSDB\u9488\u5bf9\u7279\u5b9a\u7c7b\u578b\u4e0d\u540c\u7684\u7f16\u7801\u3002</p> <p>\u5224\u65ad\u79d2\u8fd8\u662f\u6beb\u79d2\uff1a\u8bf7\u6c42\u4e2d\u7684\u65f6\u95f4\u6233\u8d85\u8fc7\u65e0\u7b26\u53f7\u6574\u6570\u7684\u6700\u5927\u503c\uff08\u53734\u4e2a\u5b57\u8282\u7684\u957f\u5ea6\uff09\uff0c\u5219\u65f6\u95f4\u4e3a\u6beb\u79d2\uff0c\u5426\u5219\u4e3a\u79d2\u3002</p>"},{"location":"data_query/time_db/opentsdb/arch_design.html#_4","title":"\u79d2\u7c7b\u578b","text":"<ul> <li>Value\u957f\u5ea6\uff1aValue\u7684\u5b9e\u9645\u957f\u5ea6\u662fQualifier\u7684\u6700\u540e3\u4e2abit\u7684\u503c\u52a01\uff0c\u5373(qualifier &amp; 0x07) + 1\u3002\u8868\u793a\u8be5\u65f6\u95f4\u6233\u5bf9\u5e94\u7684\u503c\u7684\u5b57\u8282\u6570\u3002\u6240\u4ee5\uff0c\u503c\u7684\u5b57\u8282\u6570\u7684\u8303\u56f4\u662f1\u52308\u4e2a\u5b57\u8282\u3002</li> <li>Value\u7c7b\u578b\uff1aValue\u7684\u7c7b\u578b\u7531Qualifier\u7684\u5012\u6570\u7b2c4\u4e2abit\u8868\u793a\uff0c\u5373(qualifier &amp; 0x08)\u3002\u5982\u679c\u503c\u4e3a1\uff0c\u8868\u793aValue\u7684\u7c7b\u578b\u4e3afloat\uff1b\u5982\u679c\u503c\u4e3a0\uff0c\u8868\u793aValue\u7684\u7c7b\u578b\u4e3along\u3002</li> <li>\u65f6\u95f4\u6233\uff1a\u65f6\u95f4\u6233\u7684\u503c\u7531Qualifier\u7684\u7b2c1\u5230\u7b2c12\u4e2abit\u8868\u793a\uff0c\u5373(qualifier &amp; 0xFFF0) &gt;&gt;&gt;4\u3002\u7531\u4e8e\u79d2\u7ea7\u7684\u65f6\u95f4\u6233\u6700\u5927\u503c\u4e0d\u4f1a\u5927\u4e8e3600\uff0c\u6240\u4ee5qualifer\u7684\u524d4\u4e2abits\u80af\u5b9a\u4e0d\u662f1111\u3002</li> </ul>"},{"location":"data_query/time_db/opentsdb/arch_design.html#_5","title":"\u6beb\u79d2\u7c7b\u578b","text":"<ul> <li>Value\u957f\u5ea6\uff1a\u4e0e\u79d2\u7c7b\u578b\u76f8\u540c\u3002</li> <li>Value\u7c7b\u578b\uff1a\u4e0e\u79d2\u7c7b\u578b\u76f8\u540c\u3002</li> <li>\u65f6\u95f4\u6233\uff1a \u65f6\u95f4\u6233\u7684\u503c\u7531Qualifier\u7684\u7b2c5\u5230\u7b2c26\u4e2abit\u8868\u793a\uff0c\u5373(qualifier &amp; 0x0FFFFFC0) &gt;&gt;&gt;6\u3002</li> <li>\u6807\u5fd7\u4f4d\uff1a\u6807\u5fd7\u4f4d\u7531Qualifier\u7684\u524d4\u4e2abit\u8868\u793a\u3002\u5f53\u8be5Qualifier\u8868\u793a\u6beb\u79d2\u7ea7\u6570\u636e\u65f6\uff0c\u5fc5\u987b\u5168\u4e3a1\uff0c\u5373(qualifier[0] &amp; 0xF0) == 0xF0\u3002</li> <li>\u7b2c27\u523028\u4e2abit\u672a\u4f7f\u7528\u3002</li> </ul>"},{"location":"data_query/time_db/opentsdb/arch_design.html#_6","title":"\u6df7\u5408\u7c7b\u578b","text":"<p>\u5f53\u540c\u4e00\u5c0f\u65f6\u7684\u6570\u636e\u53d1\u751f\u5408\u5e76\u540e\uff0c\u5c31\u4f1a\u5f62\u6210\u6df7\u5408\u7c7b\u578b\u7684Qualifier\u3002</p> <p>\u5408\u5e76\u7684\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u6309\u7167\u65f6\u95f4\u6233\u987a\u5e8f\u8fdb\u884c\u6392\u5e8f\u540e\uff0c\u4ece\u5c0f\u5230\u5927\u4f9d\u6b21\u62fc\u63a5\u79d2\u7c7b\u578b\u548c\u6beb\u79d2\u7c7b\u578b\u7684Qualifier\u5373\u53ef\u3002</p> <p></p> <ul> <li>\u79d2\u7c7b\u578b\u548c\u6beb\u79d2\u7c7b\u578b\u7684\u6570\u91cf\u6ca1\u6709\u9650\u5236\uff0c\u5e76\u4e14\u53ef\u4ee5\u4efb\u610f\u7ec4\u5408\u3002</li> <li>\u4e0d\u5b58\u5728\u76f8\u540c\u65f6\u95f4\u6233\u7684\u6570\u636e\uff0c\u5305\u62ec\u79d2\u548c\u6beb\u79d2\u7684\u8868\u793a\u65b9\u5f0f\u3002</li> <li>\u904d\u5386\u6df7\u5408\u7c7b\u578b\u4e2d\u7684\u6240\u6709DataPoint\u7684\u65b9\u6cd5\u662f\uff1a</li> <li>\u4ece\u5de6\u5230\u53f3\uff0c\u5148\u5224\u65ad\u524d4\u4e2abit\u662f\u5426\u4e3a0xF</li> <li>\u5982\u679c\u662f\uff0c\u5219\u5f53\u524dDataPoint\u662f\u6beb\u79d2\u578b\u7684\uff0c\u8bfb\u53d64\u4e2a\u5b57\u8282\u5f62\u6210\u4e00\u4e2a\u6beb\u79d2\u578b\u7684DataPoint</li> <li>\u5982\u679c\u5426\uff0c\u5219\u5f53\u524dDataPoint\u662f\u79d2\u578b\u7684\uff0c\u8bfb\u53d62\u4e2a\u5b57\u8282\u5f62\u6210\u4e00\u4e2a\u79d2\u578b\u7684DataPoint</li> <li>\u4ee5\u6b64\u8fed\u4ee3\u5373\u53ef\u904d\u5386\u6240\u6709\u7684DataPoint</li> </ul>"},{"location":"data_query/time_db/opentsdb/arch_design.html#metrics-value","title":"Metrics Value\u8bbe\u8ba1","text":"<p>HBase Value\u90e8\u5206\u7528\u4e8e\u4fdd\u5b58\u4e00\u4e2a\u6216\u591a\u4e2aDataPoint\u7684\u5177\u4f53\u67d0\u4e2a\u65f6\u95f4\u6233\u5bf9\u5e94\u7684\u503c\u3002</p> <p>\u7531\u4e8e\u5728Qualifier\u4e2d\u5df2\u7ecf\u4fdd\u5b58\u4e86DataPoint Value\u7684\u7c7b\u578b\u548cDataPoint Value\u7684\u957f\u5ea6\uff0c\u6240\u4ee5\u65e0\u8bba\u662f\u79d2\u7ea7\u8fd8\u662f\u6beb\u79d2\u7ea7\u7684\u503c\uff0c\u90fd\u53ef\u4ee5\u7528\u76f8\u540c\u7684\u8868\u793a\u65b9\u6cd5\uff0c\u800c\u6df7\u5408\u7c7b\u578b\u5c31\u662f\u591a\u4e2aDataPoint Value\u7684\u62fc\u63a5\u3002</p>"},{"location":"data_query/time_db/opentsdb/arch_design.html#_7","title":"\u5355\u5b57\u8282","text":"<p>\u5f53DataPoint Value\u4e3along\u578b\uff0c\u4e14\u5927\u4e8e\u7b49\u4e8e-128\uff08Byte.MIN_VALUE\uff09\uff0c\u4e14\u5c11\u4e8e\u6216\u7b49\u4e8e127\uff08Byte.MAX_VALUE\uff09\u7684\u65f6\u5019\uff0c\u4f7f\u75281\u4e2a\u5b57\u8282\u5b58\u50a8\u3002</p>"},{"location":"data_query/time_db/opentsdb/arch_design.html#_8","title":"\u53cc\u5b57\u8282","text":"<p>\u5f53DataPoint Value\u4e3along\u578b\uff0c\u4e14\u5927\u4e8e\u7b49\u4e8e-32768\uff08Short.MIN_VALUE\uff09\uff0c\u4e14\u5c11\u4e8e\u6216\u7b49\u4e8e32767\uff08Short.MAX_VALUE\uff09\u7684\u65f6\u5019\uff0c\u4f7f\u75282\u4e2a\u5b57\u8282\u5b58\u50a8\u3002</p>"},{"location":"data_query/time_db/opentsdb/arch_design.html#_9","title":"\u56db\u5b57\u8282","text":"<p>\u5f53DataPoint Value\u4e3along\u578b\uff0c\u4e14\u5927\u4e8e\u7b49\u4e8e0x80000000\uff08Integer.MIN_VALUE\uff09\uff0c\u4e14\u5c11\u4e8e\u6216\u7b49\u4e8e0x7FFFFFFF\uff08Integer.MAX_VALUE\uff09\u7684\u65f6\u5019\uff0c\u4f7f\u75284\u4e2a\u5b57\u8282\u5b58\u50a8\u3002</p>"},{"location":"data_query/time_db/opentsdb/arch_design.html#_10","title":"\u516b\u5b57\u8282","text":"<p>\u5f53DataPoint Value\u4e3along\u578b\uff0c\u4e14\u4e0d\u662f\u4e0a\u9762\u4e09\u79cd\u7c7b\u578b\u7684\u65f6\u5019\uff0c\u4f7f\u75288\u4e2a\u5b57\u8282\u5b58\u50a8\u3002</p> <p>\u5f53DataPoint Value\u4e3afloat\u578b\u7684\u65f6\u5019\uff0c\u4f7f\u75288\u4e2a\u5b57\u8282\u8868\u793a\u3002</p>"},{"location":"data_query/time_db/opentsdb/arch_design.html#_11","title":"\u591a\u5b57\u8282","text":"<p>\u6309\u7167\u65f6\u95f4\u6233\u7684\u987a\u5e8f\uff0c\u628a\u591a\u4e2aValue\u62fc\u63a5\u8d77\u6765\u7684\u6570\u636e\u6a21\u578b\u5982\u4e0b\uff1a</p> <p></p> <ul> <li>\u6bcf\u4e2a\u683c\u5b50\u8868\u793a\u4e00\u4e2aDataPoint Value\u7684\u503c\uff0c\u8fd9\u4e2aDataPoint Value\u7684\u957f\u5ea6\u53ef\u80fd\u662f1\u62162\u62164\u62168\u4e2a\u5b57\u8282\u3002</li> <li>DataPoint Value\u7684\u987a\u5e8f\u4e0eQualifier\u4e2d\u65f6\u95f4\u6233\u7684\u987a\u5e8f\u4e00\u4e00\u5bf9\u5e94\u3002</li> <li>\u6df7\u5408\u6807\u5fd7\uff1a\u5982\u679c\u6700\u540e1\u4e2a\u5b57\u8282\u4e3a0x01\uff0c\u8868\u793a\u5b58\u5728\u79d2\u7ea7\u7c7b\u578b\u548c\u6beb\u79d2\u7ea7\u7c7b\u578b\u6df7\u5408\u7684\u60c5\u51b5\u3002\uff08\u5177\u4f53\u7528\u9014\uff1f\uff09</li> </ul>"},{"location":"data_query/time_db/opentsdb/arch_design.html#annotation","title":"Annotation\u8bbe\u8ba1","text":"<p>Annotation\u7528\u4e8e\u63cf\u8ff0\u67d0\u4e00\u4e2a\u65f6\u95f4\u70b9\u53d1\u751f\u7684\u4e8b\u4ef6\uff0cAnnotation\u7684\u6570\u636e\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u8fd9\u4e0e\u6570\u5b57\u7c7b\u578b\u7684metrics\u6570\u636e\u5e76\u4e0d\u540c\u3002</p> <ol> <li>Annotation\u6570\u636e\u53ea\u652f\u6301\u79d2\u7ea7\u65f6\u95f4\u6233\u7684\u6570\u636e\u3002</li> <li>Annotation\u6570\u636e\u4e0d\u4f1a\u5408\u5e76\u3002</li> </ol>"},{"location":"data_query/time_db/opentsdb/arch_design.html#annotation-rowkey","title":"Annotation RowKey\u8bbe\u8ba1","text":"<ul> <li> <p>SALT/ Timestamp/Metric UID/ tagKey UID /tagValue UID\u7684\u610f\u4e49\u4e0emetrics RowKey\u4e2d\u7684\u610f\u4e49\u76f8\u540c\u3002</p> </li> <li> <p>\u628a[Metric UID/ tagKey UID /tagValue UID]\u90e8\u5206\u7edf\u79f0\u4e3aTSUID\u3002\u5b9e\u9645\u4e0a\uff0c\u8bfb\u5199\u6ce8\u91ca\u6570\u636e\u7684\u65f6\u5019\uff0c\u9700\u8981\u6307\u5b9a\u7684\u662fTSUID\uff0c\u800c\u4e0d\u662f\u50cfmetrics\u6570\u636e\u4e2d\u90a3\u6837\u5206\u5f00\u6307\u5b9a\u7684\u3002</p> </li> </ul>"},{"location":"data_query/time_db/opentsdb/arch_design.html#annotation-qualifier","title":"Annotation Qualifier\u8bbe\u8ba1","text":"<p>\u7531\u4e8e\u6ce8\u91ca\u6570\u636e\u53ea\u652f\u6301\u79d2\u7ea7\u7c7b\u578b\u7684\u6570\u636e\uff0c\u540c\u65f6\u6ce8\u91ca\u7c7b\u578b\u7684\u6570\u636e\u4e0d\u652f\u6301\u5408\u5e76\uff0c\u6240\u4ee5Qualifier\u7684\u8bbe\u8ba1\u76f8\u5bf9metrics\u6570\u636e\u7b80\u5355\u4e00\u4e9b\u3002Qualifier\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <p></p> <ul> <li> <p>\u4e0emetrics\u6570\u636e\u7684Qualifier\u76f8\u6bd4\uff0c\u6ce8\u91ca\u6570\u636e\u7684HBase Qualifer\u7684\u957f\u5ea6\u662f3\u4e2a\u5b57\u8282\u3002</p> </li> <li> <p>\u6807\u5fd7\u4f4d\uff1a\u4f7f\u7528\u7b2c1\u4e2a\u5b57\u8282\u8868\u793a\uff0c\u800c\u4e14\u503c\u5fc5\u987b\u4e3a0x01\u3002\u5373(qualifier &amp; 0xFF0000)&gt;&gt;&gt;16 == 0x01\u3002</p> </li> <li> <p>\u65f6\u95f4\u6233\uff1a\u4f7f\u7528\u7b2c2\u5230\u7b2c3\u4e2a\u5b57\u8282\u8868\u793a\u3002\u5373\u65f6\u95f4\u6233\u7684\u503c\u4e3a(qualifier &amp; 0x00FFFF)\u3002</p> </li> </ul>"},{"location":"data_query/time_db/opentsdb/arch_design.html#annotation-value","title":"Annotation Value\u8bbe\u8ba1","text":"<p>\u6ce8\u91ca\u6570\u636e\u4e2d\u7684Value\u4fdd\u5b58\u7684\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u6570\u636e\uff0c\u6574\u4e2aHBase Value\u90e8\u5206\u5c31\u662f\u6ce8\u91ca\u6570\u636e\u7684\u503c\u3002</p>"},{"location":"data_query/time_db/opentsdb/arch_design.html#append","title":"Append\u6a21\u5f0f","text":"<p>\u5f53OpenTSDB\u542f\u52a8APPEND\u6a21\u5f0f\u540e\uff0c\u6bcf\u4e2a\u63d2\u5165\u7684\u65b0DataPoint\uff0c\u90fd\u4f1a\u4ee5HBase\u7684append\u7684\u65b9\u5f0f\u5199\u5165\u3002</p> <ol> <li>\u7531\u4e8e\u4f7f\u7528\u4e86HBase\u7684append\u7684\u63a5\u53e3\uff0c\u6bcf\u6b21\u63d2\u5165\u4e00\u4e2a\u65b0\u6570\u636e\uff0c\u90fd\u9700\u8981\u5bf9\u540c\u4e00\u5c0f\u65f6\u7684\u6570\u636e\u90fd\u6267\u884c\u4e00\u6b21\u8bfb\u53d6\u548c\u63d2\u5165\u7684\u64cd\u4f5c(HBase append\u63a5\u53e3\u5de5\u4f5c\u539f\u7406\u5b58\u7591\uff1f\uff1f\uff09\uff1b\u53e6\u5916\u591a\u7ebf\u7a0b\u5bf9\u540c\u4e00\u5c0f\u65f6\u7684\u6570\u636e\u8fdb\u884c\u66f4\u65b0\u7684\u65f6\u5019\uff0c\u662f\u4e0d\u80fd\u5e76\u53d1\u7684\u3002\u8fd9\u6837\u5c31\u5927\u5927\u9650\u5236\u4e86\u6570\u636e\u5199\u5165\u7684\u901f\u5ea6\u4e86\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u4e0d\u5efa\u8bae\u4f7f\u7528\u8fd9\u79cd\u6a21\u5f0f\u3002</li> <li>append\u7684\u6570\u636e\u5176\u5b9e\u5c31\u662f\u5408\u5e76\u8fc7\u7684\u6570\u636e\u4e86\uff0c\u6240\u4ee5\u4e0d\u4f1a\u53c2\u4e0eOpenTSDB\u7684Compaction\u6d41\u7a0b\u3002</li> </ol>"},{"location":"data_query/time_db/opentsdb/arch_design.html#appendrowkey","title":"Append\u6a21\u5f0fRowKey\u8bbe\u8ba1","text":"<p>Append\u6a21\u5f0f\u7684RowKey\u8bbe\u8ba1\u4e0e\u666e\u901a\u6a21\u5f0f\u4e0b\u5199\u5165\u7684metrics\u6570\u636e\u7684RowKey\u662f\u76f8\u540c\u7684\u3002</p>"},{"location":"data_query/time_db/opentsdb/arch_design.html#appendqualifier","title":"Append\u6a21\u5f0fQualifier\u8bbe\u8ba1","text":"<p>Append\u6a21\u5f0f\u4e0b\uff0c\u7531\u4e8e\u540c1\u5c0f\u65f6\u7684\u6570\u636e\u4e2d\u4e0d\u5b58\u5728\u591a\u4e2aQualifier\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u4f7f\u7528\u4e00\u4e2a\u56fa\u5b9a\u7684Qualifier\u5373\u53ef\u3002</p> <p></p> <ul> <li>Append\u6a21\u5f0f\u7684Qualifier\u4f7f\u75283\u4e2a\u5b57\u8282\u8868\u793a</li> <li>\u6807\u5fd7\u4f4d\uff1a \u7531\u7b2c1\u4e2a\u5b57\u8282\u8868\u793a\uff0c\u800c\u4e14\u503c\u5fc5\u987b\u4e3a0x05\u3002\u5373(qualifier &amp; 0xFF0000)&gt;&gt;&gt;16 == 0x05</li> <li>\u56fa\u5b9a\u90e8\u5206\uff1a\u7531\u7b2c2\u5230\u7b2c3\u4e2a\u5b57\u8282\u8868\u793a\uff0c\u8fd9\u90e8\u5206\u7684\u503c\u56fa\u5b9a\u4e3a0x0000\uff0c\u56e0\u6b64\uff0cAppend\u6a21\u5f0f\u7684Qualifier\u56fa\u5b9a\u4e3a0x050000</li> </ul>"},{"location":"data_query/time_db/opentsdb/arch_design.html#appendvalue","title":"Append\u6a21\u5f0fValue\u8bbe\u8ba1","text":"<p>Append\u6a21\u5f0f\u4e0b\uff0c Value\u90e8\u5206\u65e2\u8981\u4fdd\u5b58\u65f6\u95f4\u6233\uff0c\u6570\u503c\u7c7b\u578b\u548c\u6570\u503c\u957f\u5ea6\uff0c\u4e5f\u8981\u4fdd\u5b58\u5bf9\u5e94\u7684\u6570\u503c\u3002</p> <p></p> <p>\u4e0a\u56fe\u6bcf\u4e00\u4e2a\u65b9\u5757\u8868\u793a\u7684Qualifier\u4e0eValue\u7684\u5b9a\u4e49\uff0c\u4e0e\u666e\u901a\u5199\u5165\u6a21\u5f0f\u4e0b\u7684\u5b9a\u4e49\u76f8\u540c</p> <p>\u904d\u5386Value\u4e2d\u7684\u6240\u6709DataPoint\u7684\u65b9\u6cd5\u662f\uff1a</p> <ul> <li>\u4ece\u5de6\u5230\u53f3\uff0c\u5148\u5224\u65ad\u524d4\u4e2abit\u662f\u5426\u4e3a0xF\uff1b</li> <li>\u5982\u679c\u662f\uff0c\u5219\u5f53\u524dDataPoint\u662f\u6beb\u79d2\u578b\u7684\u8bfb\u53d64\u4e2a\u5b57\u8282\u5f62\u6210\u4e00\u4e2a\u6beb\u79d2\u578b\u7684Qualifier\uff0c\u4eceQualifier\u4e2d\u83b7\u5f97Value\u7684\u957f\u5ea6\uff0c\u7136\u540e\u518d\u8bfb\u53d6\u5bf9\u5e94\u957f\u5ea6\u7684\u5b57\u8282\u6570\uff1b</li> <li>\u5982\u679c\u5426\uff0c\u5219\u5f53\u524dDataPoint\u662f\u79d2\u578b\u7684\uff0c\u8bfb\u53d62\u4e2a\u5b57\u8282\u5f62\u6210\u4e00\u4e2a\u79d2\u578b\u7684Qualifier\uff0c\u4eceQualifier\u4e2d\u83b7\u5f97Value\u7684\u957f\u5ea6\uff0c\u7136\u540e\u518d\u8bfb\u53d6\u5bf9\u5e94\u957f\u5ea6\u7684\u5b57\u8282\u6570\uff1b</li> <li>\u4f9d\u6b64\u8fed\u4ee3\u5373\u53ef\u904d\u5386\u6240\u6709\u7684DataPoint\u3002</li> </ul>"},{"location":"data_query/time_db/opentsdb/arch_design.html#_12","title":"\u4f18\u5316\u7684\u601d\u60f3","text":"<p>OpenTSDB\u5e95\u5c42\u5b58\u50a8\u7684\u4f18\u5316\u601d\u60f3</p> <ul> <li>\u5bf9\u6570\u636e\u7684\u4f18\u5316\uff1a\u4e3aMetric\u3001TagKey\u548cTagValue\u5206\u914dUniqueID\uff0c\u5efa\u7acb\u539f\u59cb\u503c\u4e0eUniqueID\u7684\u7d22\u5f15\uff0c\u6570\u636e\u8868\u5b58\u50a8Metric\u3001TagKey\u548cTagValue\u5bf9\u5e94\u7684UniqueID\u800c\u4e0d\u662f\u539f\u59cb\u503c\u3002</li> <li>\u5bf9KeyValue\u6570\u7684\u4f18\u5316\uff1a\u5982\u679c\u5bf9HBase\u5e95\u5c42\u5b58\u50a8\u6a21\u578b\u5341\u5206\u4e86\u89e3\u7684\u8bdd\uff0c\u5c31\u77e5\u9053\u884c\u4e2d\u7684\u6bcf\u4e00\u5217\u5728\u5b58\u50a8\u65f6\u5bf9\u5e94\u4e00\u4e2aKeyValue\uff0c\u51cf\u5c11\u884c\u6570\u548c\u5217\u6570\uff0c\u80fd\u6781\u5927\u7684\u8282\u7701\u5b58\u50a8\u7a7a\u95f4\u4ee5\u53ca\u63d0\u5347\u67e5\u8be2\u6548\u7387\u3002</li> <li>\u5bf9\u67e5\u8be2\u7684\u4f18\u5316\uff1a\u5229\u7528HBase\u7684Server Side Filter\u6765\u4f18\u5316\u591a\u7ef4\u67e5\u8be2\uff0c\u5229\u7528Pre-aggregation\u548cRollup\u6765\u4f18\u5316GroupBy\u548c\u964d\u7cbe\u5ea6\u67e5\u8be2\u3002</li> </ul> <p>FuzzyRowFilter\uff1a\u4e0d\u662f\u51cf\u5c0f\u67e5\u8be2\u7684\u8303\u56f4\uff0c\u800c\u662f\u51cf\u5c11\u8be5\u8303\u56f4\u5185\u626b\u63cf\u7684\u6570\u636e\u91cf\uff0c\u52a8\u6001\u8df3\u8fc7\u4e00\u5b9a\u6570\u636e\u91cf\u3002</p> <p>HBase\u7684\u5e95\u5c42\u6587\u4ef6\u5b58\u50a8\u683c\u5f0f\u4e2d\uff0c\u6bcf\u4e00\u5217\u4f1a\u5bf9\u5e94\u4e00\u4e2aKeyValue\uff0cKey\u4e3a\u8be5\u884c\u7684RowKey\uff0c\u6240\u4ee5HBase\u4e2d\u4e00\u884c\u4e2d\u7684\u6bcf\u4e00\u5217\uff0c\u90fd\u4f1a\u91cd\u590d\u7684\u5b58\u50a8\u76f8\u540c\u7684RowKey\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4f55\u91c7\u7528\u4e86UID\u7f16\u7801\u540e\u80fd\u5927\u5927\u8282\u7701\u5b58\u50a8\u7a7a\u95f4\u7684\u4e3b\u8981\u539f\u56e0\uff0c\u4e5f\u662f\u4e3a\u4f55\u6709\u4e86UID\u7f16\u7801\u540e\u8fd8\u80fd\u91c7\u7528compaction\u7b56\u7565\uff08\u5c06\u4e00\u884c\u4e2d\u6240\u6709\u5217\u5408\u5e76\u4e3a\u4e00\u5217\uff09\u6765\u8fdb\u4e00\u6b65\u538b\u7f29\u5b58\u50a8\u7a7a\u95f4\u7684\u539f\u56e0\u3002</p>"},{"location":"data_query/time_db/opentsdb/async_hbase.html","title":"AsyncHBase","text":"<p>\u5f02\u6b65\u3001\u975e\u963b\u585e\u3001\u7ebf\u7a0b\u5b89\u5168\u7684\u9ad8\u6027\u80fdHBase API\u3002\u652f\u63010.92-0.94\uff0c 0.96-1.3\u7248\u672c\u3002</p> <pre><code>  &lt;dependency&gt;\n    &lt;groupId&gt;org.hbase&lt;/groupId&gt;\n    &lt;artifactId&gt;asynchbase&lt;/artifactId&gt;\n    &lt;version&gt;1.8.0&lt;/version&gt;\n  &lt;/dependency&gt;\n</code></pre>"},{"location":"data_query/time_db/opentsdb/conf.html","title":"\u914d\u7f6e","text":""},{"location":"data_query/time_db/opentsdb/conf.html#_2","title":"\u57fa\u7840\u914d\u7f6e","text":"<ul> <li>**tsd.mode ** \uff1a<code>rw</code>\uff0cTSD\u7684\u5de5\u4f5c\u6a21\u5f0f\uff0c\u662f\u5426\u5141\u8bb8\u6570\u636e\u70b9\u7684\u5199\u5165\uff08rw\u548cro\uff09\uff0c\u5143\u6570\u636e\u4e0d\u53d7\u5f71\u54cd\uff1b</li> <li> <p>tsd.uid.use_mode\uff1aFalse\uff0c\u786e\u5b9a\u662f\u5426\u5e94\u6839\u636etsd.mode\u8bbe\u7f6e\u586b\u5145\u540d\u79f0\u548c/\u6216ID\u7f13\u5b58\uff1b</p> </li> <li> <p>tsd.core.auto_create_metrics \uff1aFalse, \u65b0\u7684metrics\u662f\u5426\u81ea\u52a8\u5206\u914dUID\uff1b</p> </li> <li>tsd.core.uid.random_metrics \uff1aFalse\uff0c\u968f\u673a\u5206\u914d\u5230UIDs\u5230\u65b0\u7684metrics\uff1b</li> <li>tsd.core.auto_create_tagks \uff1aTrue\uff0c\u65b0\u7684tag name\u662f\u5426\u81ea\u52a8\u5206\u914dUID\uff1b</li> <li>tsd.core.auto_create_tagvs \uff1aTrue\uff0c\u65b0\u7684tag value\u662f\u5426\u81ea\u52a8\u5206\u914dUID\uff1b</li> <li>tsd.core.connections.limit \uff1a0\uff0c\u4e00\u4e2aTSD\u6700\u591a\u5904\u7406\u7684\u8fde\u63a5\u6570\uff1b</li> <li>**tsd.core.enable_api ** \uff1aTrue\uff0c\u65b0\u76842.x\u7684HTTP API\uff1b</li> <li>tsd.core.enable_ui \uff1aTrue\uff0c\u5185\u7f6e\u7684GUI\u754c\u9762\u548c\u65e7HTTP API\uff1b</li> <li> <p>tsd.core.histograms.config \uff1a2.4, TODO</p> </li> <li> <p>tsd.core.plugin_path : \u63d2\u4ef6\u7684\u4f4d\u7f6e</p> </li> <li> <p>tsd.core.stats_with_port \uff1a\u662f\u5426\u66b4\u9732stats\uff1b</p> </li> <li> <p>tsd.core.tag.allow_specialchars \uff1ametrics\u540d\u79f0\u548ctag\u7684KV\u4e2d\u5141\u8bb8\u7684\u7279\u6b8a\u5b57\u7b26\uff1b</p> </li> <li>tsd.core.timezone \uff1a\u7cfb\u7edf\u9ed8\u8ba4\uff0c\u65f6\u533a\uff1b</li> <li> <p>tsd.no_diediedie \uff1aFalse\uff0c\u662f\u5426\u5141\u8bb8<code>diediedie</code>\u7684HTML\u548cASCII\u547d\u4ee4\u5173\u95edTSD\uff1b</p> </li> <li> <p>tsd.core.preload_uid_cache : False, TSD\u542f\u52a8\u65f6\u52a0\u8f7duid\u7f13\u5b58\uff1b</p> </li> <li> <p>tsd.core.preload_uid_cache.max_entries \uff1a300000\uff0cuid\u9884\u5148\u7f13\u5b58\u65f6\u626b\u63cf\u7684\u884c\u6570\uff1b</p> </li> <li> <p>tsd.core.storage_exception_handler.enable \uff1aFalse\uff0c\u5141\u8bb8\u5b58\u50a8\u7684\u5f02\u5e38\u5904\u7406</p> </li> <li> <p>tsd.core.storage_exception_handler.plugin \uff1a\u5b58\u50a8\u7684\u5f02\u5e38\u5904\u7406\u7684\u7c7b\u540d</p> </li> <li> <p>tsd.core.authentication.enable \uff1aFalse\uff0c\u5141\u8bb8\u8ba4\u8bc1</p> </li> <li> <p>tsd.core.authentication.plugin \uff1a\u8ba4\u8bc1\u7684\u7c7b\u540d</p> </li> <li> <p>tsd.rtpublisher.enable\uff1aFalse\uff0c\u5141\u8bb8\u5b9e\u65f6\u7684\u53d1\u5e03\u63d2\u4ef6\uff1b</p> </li> <li>tsd.rtpublisher.plugin\uff1a\u5b9e\u65f6\u53d1\u5e03\u7684\u63d2\u4ef6\u7c7b\u540d\uff1b</li> <li>tsd.search.enable\uff1aFalse\uff0c\u5141\u8bb8\u641c\u7d22\u529f\u80fd\uff1b</li> <li> <p>tsd.search.plugin\uff1a\u641c\u7d22\u529f\u80fd\u63d2\u4ef6\uff1b</p> </li> <li> <p>tsd.uidfilter.enable\uff1aFalse\uff0c\u542f\u52a8UID\u8d4b\u503c\u8fc7\u6ee4\u63d2\u4ef6\uff1b</p> </li> <li> <p>tsd.uidfilter.plugin\uff1aUID\u8fc7\u6ee4\u63d2\u4ef6\u7c7b\u540d\uff1b</p> </li> <li> <p>tsd.startup.enable\uff1aFalse\uff0c\u542f\u52a8TSD\u524d\u662f\u5426\u52a0\u8f7dstartup\u63d2\u4ef6\uff1b</p> </li> <li>tsd.startup.plugin\uff1astartup\u63d2\u4ef6\u7c7b\u540d\uff1b</li> <li>tsd.timeseriesfilter.enable\uff1aFalse\uff0c\u5141\u8bb8\u6570\u636e\u70b9\u5199\u65f6\u8fc7\u6ee4\u63d2\u4ef6\uff1b</li> <li> <p>tsd.timeseriesfilter.plugin\uff1a\u5199\u65f6\u8fc7\u6ee4\u63d2\u4ef6\u7c7b\u540d\uff1b</p> </li> <li> <p>tsd.core.tree.enable_processing\uff1aTODO</p> </li> <li> <p>tsd.stats.canonical\uff1a TODO</p> </li> <li> <p>tsd.uid.lru.enable\uff1aFalse\uff0c\u5c06UID\u7684\u65e0\u9650\u5236\u5927\u5c0f\u7684map\u6539\u4e3alru \u7f13\u5b58\uff1b</p> </li> <li> <p>tsd.uid.lru.id.size\uff1a5000000\uff0cUID\u5230String\u7684\u6620\u5c04\u7684\u6700\u5927\u6761\u76ee\u6570\uff1b</p> </li> <li>tsd.uid.lru.name.size\uff1a5000000\uff0cString\u5230UID\u7684\u6620\u5c04\u7684\u6700\u5927\u6761\u76ee\u6570\uff1b</li> </ul>"},{"location":"data_query/time_db/opentsdb/conf.html#http","title":"HTTP\u914d\u7f6e","text":"<ul> <li>tsd.http.cachedir \uff1a\u4e34\u65f6\u6587\u4ef6\u5199\u7684\u8def\u5f84</li> <li> <p>tsd.http.query.allow_delete \uff1a\u67e5\u8be2\u671f\u95f4\u662f\u5426\u5141\u8bb8\u5220\u9664</p> </li> <li> <p>tsd.core.bulk.allow_out_of_order_timestamps</p> </li> <li> <p>tsd.http.header_tag \uff1aPut API \u65f6\u4eceHTTP Header\u89e3\u6790\u5e76\u5b58\u50a8\u5230tag\u7684KV\u4e2d\uff1b</p> </li> <li>tsd.http.request.cors_domains \uff1aCORS\uff1b</li> <li>tsd.http.request.cors_headers \uff1a\u6267\u884ccors\u8bf7\u6c42\uff0c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u5934\u57df\uff1b</li> <li>tsd.http.request.enable_chunked \uff1aHTTP RPC\u662f\u5426\u652f\u6301chunk\uff1b</li> <li>tsd.http.request.max_chunk \uff1a4096\uff0c\u652f\u6301chunk\u65f6\u6700\u5927\u7684\u8bf7\u6c42\u4f53\u5927\u5c0f\uff1b</li> <li>tsd.http.rpc.plugins \uff1aTSD\u542f\u52a8\u65f6\u52a0\u8f7d\u7684RPC\u7684\u63d2\u4ef6\u7684\u7c7b\u540d\uff1b</li> <li>tsd.http.show_stack_trace \uff1aFalse\uff0c\u8bf7\u6c42\u5f02\u5e38\u65f6\u662f\u5426\u8fd4\u56de\u5f02\u5e38\u5806\u6808\uff1b</li> <li>tsd.http.staticroot \uff1a\u9759\u6001\u6587\u4ef6\u5982js\uff0ccss\u7684\u8def\u5f84\uff1b</li> </ul>"},{"location":"data_query/time_db/opentsdb/conf.html#_3","title":"\u7f51\u7edc\u8bbe\u7f6e","text":"<ul> <li>tsd.network.async_io \uff1aTrue\uff0c\u4f7f\u7528NIO\u8fd8\u662fBIO\uff1b</li> <li>tsd.network.backlog \uff1a\u9ed8\u8ba4\u7531'somaxconn'\u6216Netty\u8bbe\u7f6e\uff0c\u5b8c\u6210\u6216\u672a\u5b8c\u6210\u7684\u8fde\u63a5\u8bf7\u6c42\u7684\u8fde\u63a5\u961f\u5217\u7684\u6df1\u5ea6\uff1b</li> <li>tsd.network.bind|port \uff1a0.0.0.0\uff0c\u7ed1\u5b9a\u7684IP\u5730\u5740 | \u7aef\u53e3\u53f7\uff1b</li> <li>tsd.network.keep_alive \uff1aTrue\uff0c\u5141\u8bb8keepalive\u8fde\u63a5\uff1b</li> <li>tsd.network.reuse_address \uff1aTrue\uff0c\u5141\u8bb8\u5728Netty\u5185\u91cd\u7528\u7ed1\u5b9a\u7684\u7aef\u53e3\uff1b</li> <li>tsd.network.tcp_no_delay \uff1aTrue\uff0c\u662f\u5426\u5728\u53d1\u9001\u6570\u636e\u524d\u7981\u7528TCP\u7f13\u51b2\uff1b</li> <li>tsd.network.worker_threads \uff1a#CPU Cores * 2\uff0cNetty\u7684\u5f02\u6b65\u7684IO\u5de5\u4f5c\u7ebf\u7a0b\u6570\uff1b</li> <li>tsd.rpc.plugins : RPC\u63d2\u4ef6\u7684\u7c7b\u540d\uff1b</li> <li>tsd.rpc.telnet.return_errors :</li> </ul>"},{"location":"data_query/time_db/opentsdb/conf.html#metadata","title":"MetaData","text":"<ul> <li> <p>tsd.core.meta.cache.enable \uff1a False\uff0c\u662f\u5426\u5141\u8bb8\u5143\u6570\u636e\u7f13\u5b58(meta data cache)\uff1b</p> </li> <li> <p>tsd.core.meta.cache.plugin : \u5143\u6570\u636e\u7f13\u5b58\u7684\u63d2\u4ef6\u7684\u7c7b\u540d\uff1b</p> </li> <li>tsd.core.meta.enable_realtime_ts \uff1a False\uff0c\u5141\u8bb8\u5b9e\u65f6\u7684TSMeta\u5bf9\u8c61\u7684\u521b\u5efa\uff1b</li> <li>tsd.core.meta.enable_realtime_uid \uff1aFalse\uff0c\u5141\u8bb8\u5b9e\u65f6\u7684UIDMeta\u5bf9\u8c61\u7684\u521b\u5efa\uff1b</li> <li> <p>tsd.core.meta.enable_tsuid_incrementing \uff1aTODO</p> </li> <li> <p>tsd.core.meta.enable_tsuid_tracking \uff1a TODO</p> </li> </ul>"},{"location":"data_query/time_db/opentsdb/conf.html#_4","title":"\u67e5\u8be2\u76f8\u5173\u7684\u914d\u7f6e","text":"<ul> <li>tsd.query.enable_fuzzy_filter \uff1aTrue\uff0c\u4f7f\u7528<code>explicitTags</code>\u65f6\u5141\u8bb8HBase\u7684FuzzyRowFilter\uff1b</li> <li>tsd.query.allow_simultaneous_duplicates \uff1aFalse\uff0c\u662f\u5426\u5141\u8bb8\u6765\u81ea\u540c\u4e00\u4e3b\u673a\u7684\u540c\u65f6\u91cd\u590d\u67e5\u8be2\uff1b</li> <li>tsd.query.filter.expansion_limit\uff1a</li> <li>tsd.query.limits.bytes.allow_override \uff1a</li> <li>tsd.query.limits.bytes.default \uff1a</li> <li>tsd.query.limits.data_points.allow_override \uff1aFalse\uff0c</li> <li>tsd.query.limits.data_points.default \uff1a0\uff0c\u4ecestorage\u83b7\u53d6\u7684\u6570\u636e\u70b9\u7684\u9650\u5236\uff0c\u8fbe\u5230\u9650\u5236\u65f6\u629b\u51fa\u5f02\u5e38\uff1b</li> <li>tsd.query.limits.overrides.interval</li> <li>tsd.query.limits.overrides.config</li> <li>tsd.query.multi_get.enable \uff1aFalse\uff0c\u662f\u5426\u548c\u641c\u7d22\u63d2\u4ef6\u4e00\u8d77\u542f\u7528multi_get\uff1b</li> <li>tsd.query.multi_get.batch_size \uff1a1024\uff0c\u5355\u4e2a\u8bf7\u6c42\u4e2d\uff0c\u53d1\u9001\u5230storage\u7684<code>get</code>\u8bf7\u6c42\u4e2a\u6570\uff1b</li> <li>tsd.query.multi_get.concurrent \uff1a20\uff0c</li> <li>tsd.query.multi_get.get_all_salts \uff1aTODO</li> <li>tsd.query.skip_unresolved_tagvs \uff1aFalse\uff0c\u67e5\u8be2\u5305\u542btag value\u6ca1\u6709\u5bf9\u5e94UID\u65f6\u662f\u5426\u7ee7\u7eed\u67e5\u8be2\uff1b</li> <li>tsd.query.timeout \uff1a0\uff0c\u67e5\u8be2\u7684\u8d85\u65f6\uff08ms\uff09</li> </ul>"},{"location":"data_query/time_db/opentsdb/conf.html#rollups","title":"RollUps","text":"<ul> <li>tsd.rollups.config\uff1arollup\u548caggregation\u7684\u914d\u7f6e\u6587\u4ef6\u5730\u5740\uff1b</li> <li>tsd.rollups.enable\uff1aFalse\uff0c\u542f\u7528\u6c47\u603b\u548c\u9884\u805a\u5408\u5b58\u50a8\u548c\u5199\u5165\uff1b</li> <li>tsd.rollups.tag_raw\uff1aFalse\uff0c\u662f\u5426\u4f7f\u7528\u5728tsd.rollups.agg_tag_key\u4e2d\u914d\u7f6e\u7684\u6807\u8bb0\u952e\u548c\u5728tsd.rollups.raw_agg_tag_value\u4e2d\u914d\u7f6e\u7684\u503c\u6807\u8bb0\u672a\u6c47\u603b\u548c\u672a\u9884\u6c47\u603b\u7684\u503c\uff1b</li> <li>tsd.rollups.agg_tag_key\uff1a_aggregate\uff0c\u5728\u5199\u5165\u5b58\u50a8\u65f6\u7528\u4ee5\u6807\u8bb0\u9884\u805a\u5408\u6570\u636e\u7684\u7279\u6b8a\u952e\uff1b</li> <li>tsd.rollups.raw_agg_tag_value\uff1aRAW\uff0c\u5199\u5165\u5b58\u50a8\u65f6\u5bf9\u975e\u6c47\u603b\u548c\u975e\u9884\u805a\u5408\u6570\u636e\u7684\u7279\u6b8a\u6807\u8bb0\u503c\uff1b</li> <li>tsd.rollups.block_derived\uff1aFalse\uff0c\u662f\u5426\u963b\u6b62\u5b58\u50a8\u6d3e\u751f\u805a\u5408\uff0c\u5982AVG\u548cDEV\uff1b</li> </ul>"},{"location":"data_query/time_db/opentsdb/conf.html#_5","title":"\u5b58\u50a8\u914d\u7f6e","text":"<ul> <li>tsd.storage.compaction.flush_interval \uff1a10\uff0c\u5728\u538b\u7f29\u961f\u5217flush\u8c03\u7528\u671f\u95f4\u7b49\u5f85\u7684\u65f6\u95f4(s)\uff1b</li> <li>tsd.storage.compaction.flush_speed \uff1a2\uff0c\u786e\u5b9a\u5c1d\u8bd5\u5237\u65b0\u538b\u7f29\u961f\u5217\u7684\u901f\u5ea6(1h/2=0.5h)\uff1b</li> <li>tsd.storage.compaction.max_concurrent_flushes\uff1a10000\uff0c\u5728\u4efb\u4f55\u7ed9\u5b9a\u65f6\u95f4\u5185\u5bf9HBase\u8fdb\u884c\u538b\u7f29\u8c03\u7528\u7684\u6700\u5927\u6570\u76ee\uff1b</li> <li>tsd.storage.compaction.min_flush_threshold\uff1a100\uff0c\u89e6\u53d1\u5237\u65b0\u524d\u5fc5\u987b\u8d85\u8fc7\u7684\u538b\u7f29\u961f\u5217\u5927\u5c0f\uff1b</li> <li>tsd.storage.enable_appends\uff1aFalse\uff0c\u5199\u6570\u636e\u70b9\u65f6\u91c7\u7528append\u5230\u5217\uff0c\u800c\u4e0d\u662f\u521b\u5efa\u65b0\u5217\u7684\u65b9\u5f0f\uff08\u907f\u514d\u6bcf\u5c0f\u65f6\u7684\u538b\u7f29\uff0c\u4f46\u4f7f\u7528\u66f4\u591a\u8d44\u6e90\uff09\uff1b</li> <li>tsd.storage.enable_compaction\uff1aTrue\uff0c\u662f\u5426\u5141\u8bb8\u538b\u7f29\uff1b</li> <li>tsd.storage.fix_duplicates\uff1aFalse\uff0c\u5206\u6790\u5177\u6709\u91cd\u590d\u65f6\u95f4\u6233\u7684\u6570\u636e\u70b9\u65f6\u662f\u5426\u63a5\u53d7\u4e0a\u6b21\u5199\u5165\u7684\u503c\u3002\u4e0e\u538b\u7f29\u4e00\u8d77\u542f\u7528\u65f6\uff0c\u5c06\u4f7f\u7528\u6700\u65b0\u7684\u6570\u636e\u70b9\u5199\u5165\u538b\u7f29\u5217\uff1b</li> <li>tsd.storage.flush_interval\uff1a1000\uff0c\u5237\u65b0\u6570\u636e\u70b9\u5b58\u50a8\u5199\u5165\u7f13\u51b2\u533a\u7684\u95f4\u9694\uff08ms\uff09\uff1b</li> <li>tsd.storage.hbase.data_table \uff1atsdb\uff0c\u6570\u636e\u70b9\u5b58\u50a8\u7684HBase\u7684\u8868\u540d\uff1b</li> <li>tsd.storage.hbase.meta_table \uff1atsdb-meta\uff0c\u5143\u6570\u636e\u5b58\u50a8\u7684HBase\u7684\u8868\u660e\uff1b</li> <li>tsd.storage.hbase.prefetch_meta \uff1aFalse\uff0c\u662f\u5426\u5728\u542f\u52a8\u7f51\u7edc\u63a5\u53e3\u4e4b\u524d\u9884\u53d6TSDB\u8868\u7684region\u4fe1\u606f\uff1b</li> <li>tsd.storage.hbase.scanner.maxNumRows\uff1a128\uff0c\u6bcf\u6b21\u8c03\u7528scanner\u7684nextRows\u65b9\u6cd5\u4eceHBase\u83b7\u53d6\u7684\u6700\u5927\u884c\u6570\uff1b</li> <li>tsd.storage.hbase.tree_table \uff1atsdb-tree\uff0ctree data\u5b58\u50a8\u7684\u8868\uff1b</li> <li>tsd.storage.hbase.uid_table \uff1atsdb-uid\uff0cuid\u4fe1\u606f\u5b58\u50a8\u7684\u8868\uff1b</li> <li>tsd.storage.hbase.zk_basedir \uff1a/hbase\uff0c</li> <li>tsd.storage.hbase.zk_quorum \uff1alocalhost\uff0czookeeper\u5730\u5740\uff1b</li> <li>tsd.storage.repair_appends \uff1aFalse\uff0c\u5f53\u5217\u5305\u542b\u91cd\u590d\u6216\u65e0\u5e8f\u6570\u636e\u65f6\uff0c\u662f\u5426\u5728\u67e5\u8be2\u65f6\u91cd\u65b0\u5199\u5165\u8ffd\u52a0\u7684\u6570\u636e\u70b9\u5217\uff1b</li> <li>tsd.storage.max_tags \uff1a8\uff0c\u6bcf\u4e2a\u6570\u636e\u70b9\u5141\u8bb8\u7684\u6700\u5927\u6807\u8bb0\u6570\u3002\u6b64\u503c\u53ef\u4ee5\u5728\u521b\u5efa\u7fa4\u96c6\u540e\u66f4\u6539\u3002\u8bf7\u6ce8\u610f\u8fc7\u5ea6\u4f7f\u7528\u6807\u8bb0\u5199\u5165\u7684\u6027\u80fd\u6743\u8861\uff1b</li> <li>tsd.storage.salt.buckets \u548c tsd.storage.salt.width</li> <li>salt \u914d\u7f6e\uff1a\u8fd9\u4e24\u4e2a\u914d\u7f6e\u5728OpenTSDB\u521d\u59cb\u5316\u5c31\u5fc5\u987b\u786e\u5b9a\uff0c\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4e0d\u80fd\u968f\u610f\u4fee\u6539\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u5386\u53f2\u6570\u636e\u8bfb\u53d6\u9519\u8bef\u3002</li> <li>tsd.storage.salt.width \uff1a0\uff0cSALT\u7684\u5b57\u8282\u957f\u5ea6\u3002\u5f53\u8bbe\u7f6e\u4e3a0\u65f6\uff0c\u8868\u793a\u4e0d\u4f7f\u7528SALT\u3002</li> <li> <p>tsd.storage.salt.buckets \uff1a20\uff0cSALT\u7684\u6570\u91cf\u3002\u5f53\u201ctsd.storage.salt.width\u201d\u4e3a\u975e0\u65f6\uff0c\u624d\u53d1\u6325\u4f5c\u7528\u3002\u8be5\u914d\u7f6e\u9879\u7684\u503c\uff0c\u4e0d\u80fd\u8d85\u8fc7SALT\u7684\u5b57\u8282\u957f\u5ea6\u6240\u80fd\u8868\u793a\u7684\u6700\u5927\u6570\u5b57\u3002\u4f8b\u5982SALT\u7684\u5b57\u8282\u957f\u5ea6\u4e3a1\u65f6\uff0c\u8be5\u914d\u7f6e\u9879\u7684\u4e0d\u80fd\u914d\u7f6e\u6210\u5927\u4e8e256\u3002</p> </li> <li> <p>tsd.storage.uid.width.metric\uff1a3\uff0cmetric UID\u7684\u5b57\u8282\u957f\u5ea6\uff1b</p> </li> <li>tsd.storage.uid.width.tagk\uff1a3\uff0ctagk UID\u7684\u5b57\u8282\u957f\u5ea6\uff1b</li> <li>tsd.storage.uid.width.tagv\uff1a3\uff0ctagv UID\u7684\u5b57\u8282\u957f\u5ea6\uff1b</li> <li>tsd.storage.use_max_value\uff1aFalse\uff0c\u5f53TSDB\u538b\u7f29\u65f6\u53d1\u73b0\u91cd\u590d\u7684\u6570\u636e\u70b9\u662f\u5426\u91c7\u7528\u66f4\u5927\u6570\u503c\u7684value\uff08\u5efa\u6863use_otsdb_timestamp\u8bbe\u7f6e\u4e3atrue\u65f6\uff09\uff1b</li> <li>tsd.storage.use_otsdb_timestamp\uff1aTrue\uff0c\u4f7f\u7528\u6570\u636e\u70b9\u7684\u65f6\u95f4\u6233\u800c\u4e0d\u662f\u7cfb\u7edf\u7684\u73b0\u5728\u65f6\u95f4\uff1b</li> <li>tsd.storage.get_date_tiered_compaction_start\uff1a0\uff0cUnix Epoch\u65f6\u95f4\u6233\uff08ms\uff09\uff0c\u7528\u4e8edata tierd\u538b\u7f29\uff1b</li> </ul>"},{"location":"data_query/time_db/opentsdb/limit_think.html","title":"OpenTSDB \u751f\u4ea7\u5e94\u7528\u4e0e\u601d\u8003","text":"<p>OpenTSDB \u5728\u6570\u636e\u91cf\u5c0f\u65f6\u662f\u53ef\u7528\u7684\uff0c\u5728\u5343\u4e07\u7ea7\u3001\u4ebf\u7ea7\u4e2d\u63d0\u53d6\u51e0\u4e07\u6761\u6570\u636e\uff0c\u6bd4\u5982\u67d0\u4e2a\u6307\u6807\u534a\u5e74\u5185\u76845\u5206\u949f\u7ea7\u522b\u7684\u6570\u636e\uff0c\u8fd8\u662f\u5f88\u5feb\u54cd\u5e94\u7684\u3002\u4f46\u5982\u679c\u518d\u63d0\u53d6\u591a\u70b9\u6570\u636e\uff0c\u51e0\u5341\u4e07\uff0c\u767e\u4e07\u8fd9\u6837\u7684\u91cf\u7ea7\uff0c\u53c8\u6216\u8005\u63d0\u53d6\u540e\u518d\u505a\u4e2a\u805a\u5408\u8fd0\u7b97\uff0cOpenTSDB \u5c31\u52c9\u4e3a\u5176\u96be\uff1a</p> <ul> <li>OpenTSDB \u76ee\u524d\u8fd8\u662f\u5355\u70b9\u505a\u805a\u5408\u8fd0\u7b97</li> <li>\u8fd9\u6837\u7684\u91cf\u7ea7\u6570\u636e\u4eceHBase \u4e2d\u63d0\u53d6\u5230\u5355\u8282\u70b9\u5185\u5b58\u4e2d\u8fdb\u884c\u805a\u5408\u8fd0\u7b97\uff0c\u5728\u8d44\u6e90\u6d88\u8017\u65b9\u9762\u4e0d\u53ef\u5ffd\u89c6</li> <li>\u4e00\u4e2a\u67e5\u8be2\u4e00\u65e6\u63d0\u53d6\u7684\u91cf\u7ea7\u5927\uff0cOpenTSDB \u5411HBase \u53d1\u8d77RPC \u8bf7\u6c42(OpenTSDB \u4e00\u6b21\u8bf7\u6c42\u9ed8\u8ba4128\u884c)\u6b21\u6570\u4e5f\u5fc5\u7136\u589e\u52a0\uff0c\u5341\u51e0\u79d2\u3001\u51e0\u5341\u79d2\u7684\u54cd\u5e94\u65f6\u95f4\uff0c\u8fd9\u5c31\u9650\u5236\u4e86\u5b83\u7684\u5e94\u7528\u573a\u666f</li> </ul>"},{"location":"data_query/time_db/opentsdb/limit_think.html#opentsdb_1","title":"\u67b6\u6784\u4e2d\u5e94\u7528OpenTSDB","text":"<p>\u9700\u8981\u4e8b\u5148\u8003\u8651</p> <ul> <li> <p>OpenTSDB \u53ea\u67094 \u5f20HBase \u8868\uff0c\u5176\u4e2d\u4e00\u5f20\u662f\u5b58\u653e\u6570\u636e\u3002\u6240\u6709\u7684\u6570\u636e\u90fd\u5b58\u653e\u5728\u4e00\u5f20\u8868\uff0c\u8fd9\u5c31\u610f\u5473\u5e94\u7528\u5728OpenTSDB \u8fd9\u4e2a\u5c42\u7ea7\u4e0a\u662f\u65e0\u6cd5\u66f4\u5c0f\u7684\u7c92\u5ea6\u6765\u533a\u522b\u5bf9\u5f85\u4e0d\u540c\u4e1a\u52a1\u3002</p> </li> <li> <p>OpenTSDB \u4e0d\u652f\u6301\u4e8c\u7ea7\u7d22\u5f15\uff0c\u53ea\u6709\u4e00\u4e2a\u57fa\u4e8eHBase\u7684RowKey\u3002\u7ed3\u5408\u4e1a\u52a1\u573a\u666f\u7684\u67e5\u8be2\u7ef4\u5ea6\uff0c\u8bbe\u8ba1\u597dRowKey \u662f\u5e94\u7528\u597dOpenTSDB \u7684\u5173\u952e\uff01\u63d0\u524d\u8bc4\u4f30\u597dmetric + tag \u80cc\u540e\u626b\u63cf\u7684\u6570\u636e\u91cf\u3002\u6bd4\u5982\u5c06high-cardinality tag \u8c03\u6574\u5230metric \u4e2d\uff0c\u51cf\u5c11\u626b\u63cf\u7684\u6570\u636e\u91cf\u3002</p> </li> <li> <p>OpenTSDB \u80fd\u5b9e\u65f6\u805a\u5408\u8ba1\u7b97\u529f\u80fd\uff0c\u4f46\u57fa\u4e8e\u5355\u70b9\u8fd0\u7b97\u80fd\u529b\u6709\u9650\uff0c\u5efa\u8bae\u8fd9\u79cd\u805a\u5408\u5728\u5165\u5e93\u9636\u6bb5\u5b8c\u6210\u7684\u3002\u6bd4\u5982\u5c061 \u5206\u949f\u7c92\u5ea6\u805a\u5408\u30015\u5206\u949f\u7c92\u5ea6\u805a\u5408\u63d0\u524d\u901a\u8fc7KafkaStream\uff0cSpark \u7b49\u8fd0\u7b97\uff0c\u5c06\u805a\u4f1a\u7ed3\u679c\u5b58\u5165OpenTSDB \u4f9b\u67e5\u8be2\u3002</p> </li> <li> <p>Tcollector\u91c7\u96c6\u6570\u636e\u4e0a\u62a5\u7ed9OpenTSDB\uff0c\u5efa\u8bae\u5728\u4e2d\u95f4\u52a0\u4e00\u5c42Kafka\u3002\u4e00\u6765\u89e3\u5076\u4e24\u8005\u4e4b\u95f4\u7684\u5f3a\u4f9d\u8d56\u6027\uff0c\u540c\u65f6\u4fdd\u5b58\u4e00\u6bb5\u65f6\u95f4\u91c7\u96c6\u6570\u636e\uff1b\u4e8c\u6765\u53ef\u4ee5\u5bf9\u91c7\u96c6\u7684\u539f\u59cb\u6570\u636e\u8fdb\u884c\u4e8c\u6b21\u52a0\u5de5\u518d\u5165OpenTSDB\uff0c\u5982\u7c92\u5ea6\u805a\u5408\u8fd0\u7b97\u3002</p> </li> <li> <p>\u8bbe\u8ba1\u65f6\u9700\u8981\u7ed3\u5408\u67e5\u8be2\u573a\u666f\uff0c\u5728\u67e5\u8be2\u6027\u80fd\u548c\u540e\u671f\u70ed\u70b9\u8fd0\u7ef4\u65b9\u9762\uff0c\u505a\u4e00\u4e2a\u6743\u8861\u8003\u8651\u3002\u5982\u679c\u5199\u5165\u541e\u5410\u91cf\u5927\u7684\u8bdd\uff0c\u5efa\u8bae\u5f00\u542fsalt\uff0c\u4f46\u6876\u7684\u4e2a\u6570\u4e0d\u6613\u592a\u591a\uff0c2-4\u4e2a\u5373\u53ef\uff0c\u9ed8\u8ba4\u662f20 \u4e2a\u6876\u3002</p> </li> </ul>"},{"location":"data_query/time_db/opentsdb/limit_think.html#_1","title":"\u90e8\u7f72\u8fd0\u7ef4","text":"<ul> <li>\u751f\u4ea7\u90e8\u7f72\u65f6\uff0c\u5f80\u5f80\u662f\u591a\u53f0\u673a\u5668\u90e8\u7f72\uff0c\u6bcf\u53f0\u673a\u5668\u90e8\u7f72\u591a\u4e2a\u5b9e\u4f8b\uff0c\u8bfb\u5199\u5206\u79bb\u3002</li> <li>\u8bbe\u7f6etsd.storage.hbase.prefetch_meta = true(\u9ed8\u8ba4\u662ffalse)\uff0c\u5426\u5219\u6781\u7aef\u60c5\u51b5\u4e0b\u4f1a\u6253\u7206hbase:meta \u8868\u8bf7\u6c42\u3002</li> <li>2.2 \u7248\u672c\u5f00\u59cb\uff0ctsd \u5199\u6570\u636e\u5230HBase\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u4e00\u79cd\u662f\u6bcf\u6765\u4e00\u6761\u6570\u636eappend \u5230hbase\u3002\u53e6\u4e00\u79cd\u662f\u5148\u7f13\u5b58\u5927\u91cf\u6570\u636e\u5230TSD \u7684\u5185\u5b58\u91cc\uff0c\u7136\u540e\u8fdb\u884ccompaction\uff1f\uff1f\uff1f\uff0c\u4e00\u6b21\u6027\u5199\u5165\u3002</li> <li>TSDB \u5728\u6bcf\u5c0f\u65f6\u6574\u70b9\u7684\u65f6\u5019\u5c06\u4e0a\u4e2a\u5c0f\u65f6\u7684\u6570\u636e\u8bfb\u51fa\u6765(get)\uff0c\u7136\u540ecompact \u6210\u4e00\u4e2arow\uff0c\u5199\u5165(put)\u5230HBase\uff0c\u7136\u540e\u5220\u9664(delete)\u539f\u59cb\u6570\u636e\uff0c\u76ee\u7684\u662f\u51cf\u5c11\u5b58\u50a8\u6d88\u8017\uff0c\u589e\u5927\u4e86HBase \u538b\u529b\uff0c\u6027\u80fd\u5e73\u7a33\u4e0a\u51fa\u73b0\u4e00\u5b9a\u7684\u6ce2\u52a8\u3002</li> </ul>"},{"location":"data_query/time_db/opentsdb/optimize.html","title":"Optimize","text":"<p>[toc]</p>"},{"location":"data_query/time_db/opentsdb/optimize.html#opentsdb","title":"OpenTSDB\u914d\u7f6e\u4f18\u5316","text":""},{"location":"data_query/time_db/opentsdb/optimize.html#tsdb","title":"TSDB \u5185\u5b58","text":""},{"location":"data_query/time_db/opentsdb/optimize.html#uid-caches","title":"UID caches","text":"<p>\u7ef4\u62a4UID\u5230String\uff08\u4f9b\u67e5\u627e\uff09\uff0c\u4ee5\u53caString\u5230UID\u7684\u6620\u5c04\uff08\u4f9b\u5199\u5165\uff09\uff1b</p>"},{"location":"data_query/time_db/opentsdb/optimize.html#tsdstorageenable_appends","title":"tsd.storage.enable_appends","text":"<p>\u8bbe\u7f6e\u4e3afalse\uff0cappend\u6a21\u5f0f\u4e0b\uff0ctsd\u5e76\u53d1\u9ad8\u65f6\uff0cappend\u7684value\u9700\u8981\u65f6\u95f4\u6233\u548c\u6570\u636e\u7684\u62fc\u63a5\uff0c\u4f1a\u51fa\u73b0\u9891\u7e41\u4e14\u957f\u65f6\u95f4\u7684GC\uff0copentsdb\u7ebf\u7a0b\u5361\u6b7b\u3002</p>"},{"location":"data_query/time_db/opentsdb/optimize.html#tsdstoragehbaseprefetch_meta","title":"tsd.storage.hbase.prefetch_meta","text":"<p>\u8bbe\u7f6e\u4e3atrue\uff0c\u9884\u53d6hbase\u5143\u6570\u636e</p>"},{"location":"data_query/time_db/opentsdb/optimize.html#tsdstoragehbasescannermaxnumrows","title":"tsd.storage.hbase.scanner.maxNumRows","text":"<p>\u589e\u5927\u5355\u6b21scan\u8bfb\u53d6\u7684</p>"},{"location":"data_query/time_db/opentsdb/optimize.html#tsdstoragesaltbucketstsdstoragesaltwidth","title":"tsd.storage.salt.buckets\uff0ctsd.storage.salt.width","text":"<p>\u589e\u5927\u8d1f\u8f7d\u5747\u8861</p>"},{"location":"data_query/time_db/opentsdb/optimize.html#tsdrollupsenable","title":"tsd.rollups.enable","text":"<p>\u8bfb\u65f6\u4f18\u5316</p>"},{"location":"data_query/time_db/opentsdb/optimize.html#hbase","title":"HBase\u5b58\u50a8\u4f18\u5316","text":""},{"location":"data_query/time_db/opentsdb/optimize.html#date-tierd-compaction","title":"Date Tierd Compaction","text":"<p>\u8bbe\u7f6e\u57fa\u4e8e\u65f6\u95f4\u7684\u538b\u7f29</p>"},{"location":"data_query/time_db/opentsdb/optimize.html#hbase-readwrite-queues","title":"HBase Read/Write Queues","text":"<p>HBase\u652f\u6301\u5c06\u5355\u72ec\u7684\u8bfb/\u5199\u7684RPC\u961f\u5217\u3002</p> <ul> <li>hbase.ipc.server.callqueue.read.ratio=0.60</li> <li>hbase.ipc.server.max.callqueue.length=100</li> <li>hbase.ipc.server.read.threadpool.size=2\uff0c\u589e\u52a0\u7ebf\u7a0b\u6570\u65f6\uff0c\u51cf\u5c11\u961f\u5217\u957f\u5ea6\uff1b</li> </ul>"},{"location":"data_query/time_db/opentsdb/optimize.html#hbase-cache","title":"HBase Cache","text":"<p>\u4f7f\u7528\u5806\u5916\u7f13\u5b58</p> <ul> <li>hbase.bucketcache.combinedcache.enabled=true\uff1b</li> <li>hbase.bucketcache.ioengine=offheap\uff1b</li> </ul> <p>\u5c1d\u8bd5\u4ee5\u4e0b\u914d\u7f6e</p> <pre><code>hbase.rs.cacheblocksonwrite=true\nhbase.rs.evictblocksonclose=false\nhfile.block.bloom.cacheonwrite=true\nhfile.block.index.cacheonwrite=true\nhbase.block.data.cachecompressed=true\nhbase.bucketcache.blockcache.single.percentage=.99\nhbase.bucketcache.blockcache.multi.percentage=0\nhbase.bucketcache.blockcache.memory.percentage=.01\nhfile.block.cache.size=.054 #ignored but needs a value.\n</code></pre>"},{"location":"data_query/time_db/opentsdb/optimize.html#hbase-compaction","title":"HBase Compaction","text":"<p>\u8c03\u6574\u8981\u538b\u7f29\u7684\u7ebf\u7a0b\u6570\u548c\u9608\u503c\uff0c\u4ee5\u907f\u514d\u5728\u5e94\u5c06\u91cd\u70b9\u653e\u5728\u5199\u5165\u4e0a\u65f6\u4f7f\u7528\u592a\u591a\u8d44\u6e90\u3002</p> <pre><code>hbase.hstore.compaction.ratio=1.2\nhbase.regionserver.thread.compaction.large=2\nhbase.regionserver.thread.compaction.small=6\nhbase.regionserver.thread.compaction.throttle=524288000\n</code></pre>"},{"location":"data_query/time_db/opentsdb/optimize.html#hbase-regions","title":"HBase Regions","text":"<p>hbase.hregion.max.filesize \u8bbe\u7f6e\u4e3a10G\uff0c10737418240</p>"},{"location":"data_query/time_db/opentsdb/optimize.html#hbase-memstore","title":"HBase Memstore","text":"<p>\u5bf9\u4e8e\u9ad8\u5ea6\u5199\u8d1f\u8f7d\uff0c\u5c1d\u8bd5\u66f4\u7ecf\u5e38\u5c06mem store\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\uff0c\u5e76\u51cf\u5c11memstore\u7684\u5927\u5c0f\uff08\u5b58\u7591\uff1f\uff1f\uff09\u3002</p> <ul> <li>hbase.hregion.memstore.flush.size=16777216</li> <li>hbase.regionserver.global.memstore.lowerLimit=.20\uff0chbase.regionserver.global.memstore.upperLimit=.30.</li> </ul>"},{"location":"data_query/time_db/opentsdb/optimize.html#hbase-gc","title":"HBase GC","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0bHBase\u5728\u65b0\u4ee3\u4e2d\u91c7\u7528\u7684GC\u65b9\u5f0f\u662fUseParNewGC\uff0c\u5728\u8001\u4ee3\u4e2d\u91c7\u7528\u7684GC\u65b9\u5f0f\u4e3aUseConcMarkSweepGC\uff0c\u8fd9\u4e24\u79cdGC\u65b9\u6cd5\u90fd\u652f\u6301\u591a\u7ebf\u7a0b\u7684\u65b9\u6cd5\uff0cCMS\u7684GC\u8017\u8d39\u7684\u65f6\u95f4\u6bd4\u65b0\u4ee3\u4e2d\u7684GC\u957f\uff0c\u540c\u65f6\u5982\u679c\u5185\u5b58\u5360\u6ee1\u8fd8\u4f1a\u89e6\u53d1Full GC\uff0c\u4f18\u5316\u65b9\u5411\u662f\u8ba9GC\u5c3d\u91cf\u5728\u65b0\u4ee3\u4e2d\u8fdb\u884c\uff0c\u901a\u8fc7GC\u65e5\u5fd7\u53d1\u73b0\u65b0\u4ee3\u7684\u5185\u5b58\u5927\u5c0f\u53ea\u6709600M\uff0c\u800c\u603b\u7684Java\u5806\u6808\u5927\u5c0f\u4e3a8G\uff0c\u5b98\u65b9\u7684\u63a8\u8350\u662f\u65b0\u4ee3\u5185\u5b58\u5360\u7528\u4e3a\u603b\u5806\u6808\u76843/8\uff0c\u4e8e\u662f\u5728\u8fd9\u91cc\u589e\u52a0\u53c2\u6570-Xmn3000m\uff0c\u6765\u6269\u5927\u65b0\u4ee3\u7684\u5927\u5c0f\u3002</p>"},{"location":"data_query/time_db/opentsdb/read_flow.html","title":"\u8bfb\u53d6\u6d41\u7a0b","text":"<p>\u4e00\u4e2a\u5b8c\u6574\u7684OpenTSDB HTTP Query\u8bf7\u6c42\uff0c\u5206\u522b\u7531OpenTSDB I/O Thread\u548cAsyncHBase I/O Thread\u5b8c\u6210\u3002OpenTSDB I/O Thread\u7ebf\u7a0b\u8d1f\u8d23\u5904\u7406HTTP Query\u8bf7\u6c42\uff0cAsyncHBase I/O Thread\u8d1f\u8d23\u5904\u7406HBase\u7684\u54cd\u5e94\u5e76\u53d1\u9001HTTP\u54cd\u5e94\u3002</p>"},{"location":"data_query/time_db/opentsdb/read_flow.html#_2","title":"\u8bf7\u6c42\u5904\u7406\u6d41\u7a0b","text":"<p>1.OpenTSDB I/O Thread\u6536\u5230HTTP Query\u8bf7\u6c42\u540e\uff0c\u4f1a\u6839\u636eOpenTSDB\u662f\u5426\u4f7f\u7528\u4e86SALT\u8fdb\u884c\u4e0d\u540c\u7684\u5904\u7406\u3002</p> <p>\u662f\u5426\u4f7f\u7528\u4e86SALT\uff0c\u53ea\u4f1a\u5bf9\u751f\u6210\u7684HBase Scanner\u6570\u91cf\u4ea7\u751f\u5f71\u54cd\uff0c\u6bcf\u4e2aHBase Scanner\u7684\u5904\u7406\u6d41\u7a0b\u90fd\u662f\u76f8\u540c\u7684\u3002</p> <p>\u5f53\u4f7f\u7528\u4e86SALT\uff0c\u5c31\u4f1a\u751f\u6210\u76f8\u5e94SALT\u6570\u91cf\u7684HBase Scanner\u3002</p> <p>Scanner\u7684StatKey\u548cStopKey\u4e2d\uff0c\u53ea\u5305\u542b\u4e86{SALT+Metric ID+Timestamp}\u3002\u5982\u679c\u9700\u8981\u67e5\u8be2\u7684Metric\u4e2d\u5305\u542b\u5927\u91cf\u4e0d\u540c\u7684TagName\u6216\u8005TagValue\u7684\u8bdd\uff0c\u8fd9\u4e2aScanner\u53ef\u80fd\u9700\u8981\u626b\u63cf\u5927\u91cf\u7684\u6570\u636e\uff0c\u5f71\u54cdOpenTSDB\u67e5\u8be2\u7684\u6027\u80fd\u3002</p> <p>2.\u4e3a\u6bcf\u4e2aScanner\u8bbe\u7f6eFilter\uff0c\u8bbe\u7f6eFilter\u53ef\u4ee5\u66f4\u7cbe\u786e\u7684\u8fc7\u6ee4HBase\u7684\u884c\uff0c\u51cf\u5c11\u65e0\u6548\u6570\u636e\u884c\u7684\u4f20\u8f93\u548c\u5904\u7406\uff0c\u4ee5\u63d0\u9ad8\u67e5\u8be2\u7684\u6027\u80fd\u3002</p> <p>\u5982\u679cHTTP Query\u4e2d\u8bbe\u7f6e\u4e86Tag\u7684\u67e5\u8be2\u6761\u4ef6\uff0cScanner\u4e2d\u5c31\u4f1a\u8bbe\u7f6eKeyRegexpFilter\uff1b\u5982\u679c\u540c\u65f6\u8bbe\u7f6e\u4e86explicitTags \u4e3atrue\uff0cScanner\u4e2d\u8fd8\u4f1a\u518d\u8bbe\u7f6eFuzzyRowFilter\u3002</p> <p>\u867d\u7136\u8bbe\u7f6e\u4e86Filter\uff0c\u4f46\u662f\u5728HBase\u670d\u52a1\u7aef\u9700\u8981\u626b\u63cf\u7684\u6570\u636e\u91cf\u5e76\u4e0d\u4f1a\u51cf\u5c11\uff0c\u53ea\u662f\u51cf\u5c11\u4e86\u8fd4\u56de\u7684\u6570\u636e\u91cf\u3002</p> <p>3.\u6700\u540e\u8c03\u7528Scanner\u7684scan\u65b9\u6cd5\uff0cscan\u65b9\u6cd5\u91c7\u7528\u4e86\u5f02\u6b65\u8c03\u7528\u3002</p>"},{"location":"data_query/time_db/opentsdb/read_flow.html#_3","title":"\u54cd\u5e94\u5904\u7406\u6d41\u7a0b","text":"<p>1.  \u4e00\u4e2aHTTP Query\u6240\u751f\u6210\u7684\u591a\u4e2aScanner\uff0c\u53ef\u80fd\u53d1\u9001\u5230\u4e86\u591a\u4e2aRegionServer\u4e0a\uff0c\u6240\u4ee5OpenTSDB\u53ef\u80fd\u6536\u5230\u591a\u4e2aRegionServer\u53d1\u9001\u8fc7\u6765\u7684scanner\u7ed3\u679c\u3002</p> <p>2. \u6bcf\u4e2aRegionServer\u7684scanner\u7ed3\u679c\uff0c\u90fd\u7531\u5176\u7ed1\u5b9a\u7684\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u884c\u5904\u7406\u3002\u8fd9\u4e2a\u7ebf\u7a0b\u65e2\u8d1f\u8d23\u4ecesocket\u4e2d\u63a5\u6536Scanner\u7ed3\u679c\uff0c\u4e5f\u8981\u8d1f\u8d23\u5904\u7406\u8fd9\u4e9bscanner\u7ed3\u679c\u3002\u56e0\u6b64\uff0c\u5b83\u53ea\u80fd\u9010\u4e2a\u5904\u7406\u8fd9\u4e9bScanner\u7ed3\u679c\u3002</p> <p>3. \u5f53\u5904\u7406\u5b8c\u4e00\u4e2ascanner\u7ed3\u679c\u540e\uff0c\u5982\u679c\u8fd9\u4e2ascanner\u7684\u6240\u6709\u7ed3\u679c\u8fd8\u6ca1\u6709\u4f20\u8f93\u5b8c\uff0c\u5c31\u7ee7\u7eed\u5f02\u6b65\u8c03\u7528scan\u65b9\u6cd5\uff0c\u4ee5\u83b7\u5f97\u540e\u7eed\u7684scanner\u7ed3\u679c\u3002\u8c03\u7528\u5b8c\u540e\uff0c\u5c31\u7ee7\u7eed\u5904\u7406\u4e0b\u4e00\u4e2ascanner\u7ed3\u679c\u3002</p> <p>4. \u5f53\u4e00\u4e2ascanner\u7684\u6240\u6709\u7ed3\u679c\u90fd\u5df2\u7ecf\u5904\u7406\u5b8c\u4e86\uff0c\u800c\u4e14\u8fd9\u4e2ascanner\u4e0d\u662f\u6240\u5173\u8054HTTP Query\u8bf7\u6c42\u7684\u6700\u540e\u4e00\u4e2a\u88ab\u5904\u7406\u7684Scanner\uff0c\u90a3\u4e48\u5c31\u628a\u5904\u7406\u540e\u7684\u6570\u636e\u6682\u65f6\u7f13\u5b58\u8d77\u6765\u3002\u7136\u540e\u7ee7\u7eed\u5904\u7406\u4e0b\u4e00\u4e2ascanner\u7ed3\u679c\uff1b\u5982\u679c\u662f\u6700\u540e\u4e00\u4e2ascanner\uff0c\u5c31\u628a\u8fd9\u4e2aHTTP Query\u8bf7\u6c42\u7684\u6240\u6709scanner\u7ed3\u679c\u8fdb\u884c\u5408\u5e76\uff0c\u751f\u6210\u4e00\u4e2aHTTP Query\u7684Response\uff0c\u5e76\u53d1\u9001\u56de\u5230OpenTSDB\u5e94\u7528\u3002</p> <p>\u81f3\u6b64\uff0c\u5728OpenTSDB\u7684\u5e94\u7528\u7aef\uff0c\u5c31\u5df2\u7ecf\u5b8c\u6210\u4e86\u4e00\u6b21\u5b8c\u6574\u7684HTTP Query\u67e5\u8be2\u3002</p>"},{"location":"data_query/time_db/opentsdb/rollups_agg.html","title":"RollUps &amp; Aggregations","text":""},{"location":"data_query/time_db/opentsdb/rollups_agg.html#rollups","title":"RollUps","text":"<p>\u201c\u6c47\u603b\u201d\u5b9a\u4e49\u4e3a\u968f\u65f6\u95f4\u6c47\u603b\u7684\u5355\u4e2a\u65f6\u95f4\u5e8f\u5217\uff0c\u4e5f\u53ef\u4ee5\u79f0\u4e3a\u201c\u57fa\u4e8e\u65f6\u95f4\u7684\u805a\u5408\u201d\uff0c\u6c47\u603b\u6709\u52a9\u4e8e\u89e3\u51b3\u67e5\u770b\u8f83\u957f\u65f6\u95f4\u8de8\u5ea6\u7684\u95ee\u9898\u3002\u7c7b\u4f3c\u4e0b\u91c7\u6837\u5668\uff0c\u8fd9\u4e9b\u91c7\u6837\u5668\u5c06\u6bcf\u4e2a\u65f6\u95f4\u5e8f\u5217\u6c47\u603b\u4e3a\u4e00\u4e2a\u8f83\u5c0f\u7684\u6216\u8f83\u4f4e\u7684\u5206\u8fa8\u7387\u503c\u3002</p> <ul> <li>\u65f6\u95f4\u95f4\u9694 -\u5c06\u591a\u5c11\u65f6\u95f4\u201c\u6c47\u603b\u201d\u4e3a\u65b0\u503c\u3002\u4f8b\u5982\uff0c<code>1h</code>\u4e00\u4e2a\u5c0f\u65f6\u7684\u6570\u636e\u6216<code>1d</code>\u4e00\u5929\u7684\u6570\u636e\u3002</li> <li>\u805a\u5408\u51fd\u6570 -\u5bf9\u57fa\u7840\u503c\u6267\u884c\u4ec0\u4e48\u7b97\u672f\u4ee5\u5f97\u51fa\u65b0\u503c\u3002\u4f8b\u5982<code>sum</code>\uff0c\u6dfb\u52a0\u6240\u6709\u503c\u6216<code>max</code>\u5b58\u50a8\u6700\u5927\u7684\u503c</li> </ul>"},{"location":"data_query/time_db/opentsdb/rollups_agg.html#pre-aggregation","title":"Pre-Aggregation","text":"<p>\u5982\u679cmetrics\u5177\u6709\u9ad8\u57fa\u6570\uff0c\u53ef\u4ee5\u9884\u805a\u5408\u3002</p> <ul> <li>\u805a\u5408\u51fd\u6570 -\u5bf9\u57fa\u7840\u503c\u6267\u884c\u4ec0\u4e48\u7b97\u672f\u4ee5\u5f97\u51fa\u65b0\u503c\u3002\u4f8b\u5982<code>sum</code>\uff0c\u6dfb\u52a0\u6240\u6709\u65f6\u95f4\u5e8f\u5217\u6216<code>max</code>\u5b58\u50a8\u6700\u5927\u7684\u65f6\u95f4\u5e8f\u5217\u3002</li> </ul>"},{"location":"data_query/time_db/opentsdb/thread_model.html","title":"\u7ebf\u7a0b\u6a21\u578b","text":"<p>\u5728OpenTSDB\u4e2d\uff0c\u5bf9HTTP\u8bf7\u6c42\u548cHBase\u54cd\u5e94\u662f\u5f02\u6b65\u5904\u7406\u7684\uff0c\u8fd9\u90e8\u5206\u4e3b\u8981\u662f\u501f\u52a9\u4e86Netty\u7684\u6846\u67b6\u3002\u5f02\u6b65\u5904\u7406\u4f7f\u5f97\u7ebf\u7a0b\u8d44\u6e90\u7684\u5229\u7528\u66f4\u52a0\u9ad8\u6548\uff0c\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u80fd\u591f\u63d0\u5347\u8bfb\u5199\u7684\u5e76\u53d1\u5ea6\uff0c\u5e26\u6765\u541e\u5410\u91cf\u7684\u63d0\u5347\u3002\u76ee\u524d\uff0cHBase\u4e5f\u5df2\u7ecf\u652f\u6301\u4e86\u5f02\u6b65RPC\u6846\u67b6\u3002</p>"},{"location":"data_query/time_db/opentsdb/thread_model.html#http","title":"HTTP\u8bf7\u6c42\u5904\u7406\u7ebf\u7a0b\u6c60","text":"<p>OpenTSDB\u542f\u52a8\u65f6\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2aNetty\u670d\u52a1\u7aef\uff08\u9ed8\u8ba4\u7aef\u53e3\u4e3a4242\uff09\uff0c\u4ee5\u63a5\u6536OpenTSDB\u5ba2\u6237\u7aef\u53d1\u9001\u8fc7\u6765\u7684HTTP\u8bf7\u6c42\u3002Netty\u7684\u670d\u52a1\u7aef\u5b9e\u73b0\u5305\u62ec\u4e86\u4e00\u4e2aBoss\u7ebf\u7a0b\u548c\u591a\u4e2a\u4e1a\u52a1\u5904\u7406\u7ebf\u7a0b\uff08\u9ed8\u8ba4\u7ebf\u7a0b\u6570\u4e3aCPU\u6838\u6570\u7684\u4e24\u500d\uff09\u3002</p> <p></p> <ul> <li>\u6bcf\u4e2asocket\u7ed1\u5b9aI/O\u7ebf\u7a0b\u6c60\u4e2d\u7684\u67d0\u4e2a\u7ebf\u7a0b\u3002</li> </ul>"},{"location":"data_query/time_db/opentsdb/thread_model.html#hbase","title":"HBase\u54cd\u5e94\u5904\u7406\u7ebf\u7a0b\u6c60","text":"<p>OpenTSDB\u53d1\u9001\u8bf7\u6c42\u5230HBase\u540e\uff0c\u9700\u8981\u5904\u7406HBase\u8fd4\u56de\u7684\u76f8\u5e94\u6d88\u606f\uff0c\u8fd9\u662f\u901a\u8fc7OpenTSDB\u4e2d\u7684\u4e00\u4e2aNetty\u5ba2\u6237\u7aef\u5b9e\u73b0\u7684\u3002</p> <p>Netty\u7684\u5ba2\u6237\u7aef\u5b9e\u73b0\u5305\u62ec\u4e86\u4e00\u4e2aBoss\u7ebf\u7a0b\u548c\u591a\u4e2a\u4e1a\u52a1\u5904\u7406\u7ebf\u7a0b\uff08\u9ed8\u8ba4\u7ebf\u7a0b\u6570\u4e3aCPU\u6838\u6570*2\uff09\u3002</p> <p></p> <ul> <li>\u6bcf\u4e2aHBase\u4e0eOpenTSDB\u4e4b\u95f4\u7684Socket\u8fde\u63a5\uff0c\u5728OpenTSDB\u5411HBase\u53d1\u8d77\u8bf7\u6c42\u7684\u65f6\u5019\u5c31\u5df2\u7ecf\u5efa\u7acb\u4e86\u3002 \u4e5f\u4f1a\u628a\u8be5Socket\u7ed1\u5b9a\u5230AsyncHBase I/O Threads\u7ebf\u7a0b\u6c60\u7684\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u3002</li> <li>AsyncHBase I/O Thread\u8bfb\u53d6Socket\u4e2d\u7684HBase\u54cd\u5e94\u6d88\u606f\u3002</li> </ul> <p>\u8bf4\u660e\uff1a\u4e0a\u8ff0\u6b65\u9aa4\u662f\u5728Netty\u7684\u6846\u67b6\u4e2d\u5b8c\u6210\u7684\u3002</p> <ul> <li>AsyncHBase I/O Thread \u5904\u7406HBase\u7684\u54cd\u5e94\u6d88\u606f\u3002\u800c\u540e\uff0c\u53d1\u9001HTTP\u54cd\u5e94\u6d88\u606f\u5230OpenTSDB\u5e94\u7528\u7aef\u3002</li> </ul>"},{"location":"data_query/time_db/tdengine/arch.html","title":"Arch","text":"<p>[toc]</p>"},{"location":"data_query/time_db/tdengine/arch.html#tdengine","title":"TDEngine","text":"<p>\u5f00\u6e90\u3001\u9ad8\u6548\u7684\u7269\u8054\u7f51\u5927\u6570\u636e\u5e73\u53f0</p>"},{"location":"data_query/time_db/tdengine/arch.html#_1","title":"\u6570\u636e\u7279\u5f81","text":"<p>\u9664\u65f6\u5e8f\u7279\u5f81\u5916\uff0c\u4ed4\u7ec6\u7814\u7a76\u53d1\u73b0\uff0c\u7269\u8054\u7f51\u3001\u8f66\u8054\u7f51\u3001\u8fd0\u7ef4\u76d1\u6d4b\u7c7b\u6570\u636e\u8fd8\u5177\u6709\u5f88\u591a\u5176\u4ed6\u660e\u663e\u7684\u7279\u5f81\uff1a</p> <ol> <li>\u6570\u636e\u9ad8\u5ea6\u7ed3\u6784\u5316\uff1b</li> <li>\u6570\u636e\u6781\u5c11\u6709\u66f4\u65b0\u6216\u5220\u9664\u64cd\u4f5c\uff1b</li> <li>\u65e0\u9700\u4f20\u7edf\u6570\u636e\u5e93\u7684\u4e8b\u52a1\u5904\u7406\uff1b</li> <li>\u76f8\u5bf9\u4e92\u8054\u7f51\u5e94\u7528\uff0c\u5199\u591a\u8bfb\u5c11\uff1b</li> <li>\u6d41\u91cf\u5e73\u7a33\uff0c\u6839\u636e\u8bbe\u5907\u6570\u91cf\u548c\u91c7\u96c6\u9891\u6b21\uff0c\u53ef\u4ee5\u9884\u6d4b\u51fa\u6765\uff1b</li> <li>\u7528\u6237\u5173\u6ce8\u7684\u662f\u4e00\u6bb5\u65f6\u95f4\u7684\u8d8b\u52bf\uff0c\u800c\u4e0d\u662f\u67d0\u4e00\u7279\u5b9a\u65f6\u95f4\u70b9\u7684\u503c\uff1b</li> <li>\u6570\u636e\u6709\u4fdd\u7559\u671f\u9650\uff1b</li> <li>\u6570\u636e\u7684\u67e5\u8be2\u5206\u6790\u4e00\u5b9a\u662f\u57fa\u4e8e\u65f6\u95f4\u6bb5\u548c\u7a7a\u95f4\u533a\u57df\uff1b</li> <li>\u9664\u5b58\u50a8\u3001\u67e5\u8be2\u64cd\u4f5c\u5916\uff0c\u8fd8\u9700\u8981\u5404\u79cd\u7edf\u8ba1\u548c\u5b9e\u65f6\u8ba1\u7b97\u64cd\u4f5c\uff1b</li> <li>\u6570\u636e\u91cf\u5de8\u5927\uff0c\u4e00\u5929\u53ef\u80fd\u91c7\u96c6\u7684\u6570\u636e\u5c31\u53ef\u4ee5\u8d85\u8fc7100\u4ebf\u6761\u3002</li> </ol> <p>TDengine\u91c7\u7528\u4f20\u7edf\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\u6a21\u578b\u7ba1\u7406\u6570\u636e\uff0c\u7528\u7684\u662f\u7ed3\u6784\u5316\u5b58\u50a8\uff0c\u800c\u4e0d\u662fNoSQL\u7684key-value\u5b58\u50a8\u3002</p>"},{"location":"data_query/time_db/tdengine/arch.html#_2","title":"\u8868\u7ec4\u7ec7","text":""},{"location":"data_query/time_db/tdengine/arch.html#_3","title":"\u4e00\u4e2a\u6570\u636e\u91c7\u96c6\u70b9\u4e00\u5f20\u8868","text":"<p>TDengine\u8981\u6c42\u5bf9\u6bcf\u4e2a\u6570\u636e\u91c7\u96c6\u70b9\u5355\u72ec\u5efa\u8868\uff0c\u5b58\u50a8\u8fd9\u4e2a\u91c7\u96c6\u70b9\u6240\u91c7\u96c6\u7684\u65f6\u5e8f\u6570\u636e\u3002</p> <ul> <li>\u4fdd\u8bc1\u4e00\u4e2a\u91c7\u96c6\u70b9\u7684\u6570\u636e\u5728\u5b58\u50a8\u4ecb\u8d28\u4e0a\u662f\u4ee5\u5757\u4e3a\u5355\u4f4d\u8fde\u7eed\u5b58\u50a8\u3002\u5982\u679c\u8bfb\u53d6\u4e00\u4e2a\u65f6\u95f4\u6bb5\u7684\u6570\u636e\uff0c\u5b83\u80fd\u5927\u5e45\u51cf\u5c11\u968f\u673a\u8bfb\u53d6\u64cd\u4f5c\uff0c\u6210\u6570\u91cf\u7ea7\u7684\u63d0\u5347\u8bfb\u53d6\u548c\u67e5\u8be2\u901f\u5ea6\u3002</li> <li>\u7531\u4e8e\u4e0d\u540c\u91c7\u96c6\u8bbe\u5907\u4ea7\u751f\u6570\u636e\u7684\u8fc7\u7a0b\u5b8c\u5168\u72ec\u7acb\uff0c\u6bcf\u4e2a\u8bbe\u5907\u7684\u6570\u636e\u6e90\u662f\u552f\u4e00\u7684\uff0c\u4e00\u5f20\u8868\u4e5f\u5c31\u53ea\u6709\u4e00\u4e2a\u5199\u5165\u8005\uff0c\u91c7\u7528\u65e0\u9501\u65b9\u5f0f\u6765\u5199\uff0c\u5199\u5165\u901f\u5ea6\u5c31\u80fd\u5927\u5e45\u63d0\u5347\u3002</li> <li>\u5bf9\u4e8e\u4e00\u4e2a\u6570\u636e\u91c7\u96c6\u70b9\u800c\u8a00\uff0c\u5176\u4ea7\u751f\u7684\u6570\u636e\u662f\u65f6\u5e8f\u7684\uff0c\u56e0\u6b64\u5199\u7684\u64cd\u4f5c\u53ef\u7528\u8ffd\u52a0\u7684\u65b9\u5f0f\u5b9e\u73b0\uff0c\u8fdb\u4e00\u6b65\u5927\u5e45\u63d0\u9ad8\u6570\u636e\u5199\u5165\u901f\u5ea6\u3002</li> </ul> <p>\u8868\u7684\u7b2c\u4e00\u5217\u5fc5\u987b\u662f\u65f6\u95f4\u6233\uff0c\u5373\u6570\u636e\u7c7b\u578b\u4e3a timestamp\u3002\u5bf9\u91c7\u96c6\u7684\u6570\u636e\uff0cTDengine\u5c06\u81ea\u52a8\u6309\u7167\u65f6\u95f4\u6233\u5efa\u7acb\u7d22\u5f15\uff0c\u4f46\u5bf9\u91c7\u96c6\u7684\u7269\u7406\u91cf\u4e0d\u5efa\u4efb\u4f55\u7d22\u5f15\u3002\u6570\u636e\u7528\u5217\u5f0f\u5b58\u50a8\u65b9\u5f0f\u4fdd\u5b58\u3002</p>"},{"location":"data_query/time_db/tdengine/arch.html#_4","title":"\u8d85\u7ea7\u8868\uff1a\u540c\u4e00\u7c7b\u578b\u6570\u636e\u91c7\u96c6\u70b9\u7684\u96c6\u5408","text":"<p>\u4e00\u5f20\u8d85\u7ea7\u8868\u5305\u542b\u6709\u591a\u5f20\u8868\uff0c\u8fd9\u4e9b\u8868\u5177\u6709\u76f8\u540c\u7684\u65f6\u5e8f\u6570\u636eschema\uff0c\u4f46\u5e26\u6709\u4e0d\u540c\u7684\u6807\u7b7e\u503c\u3002</p> <p>\u8d85\u7ea7\u8868\u662f\u6307\u67d0\u4e00\u7279\u5b9a\u7c7b\u578b\u7684\u6570\u636e\u91c7\u96c6\u70b9\u7684\u96c6\u5408\u3002\u540c\u4e00\u7c7b\u578b\u7684\u6570\u636e\u91c7\u96c6\u70b9\uff0c\u5176\u8868\u7684\u7ed3\u6784\u662f\u5b8c\u5168\u4e00\u6837\u7684\uff0c\u4f46\u6bcf\u4e2a\u8868\uff08\u6570\u636e\u91c7\u96c6\u70b9\uff09\u7684\u9759\u6001\u5c5e\u6027\uff08\u6807\u7b7e\uff09\u662f\u4e0d\u4e00\u6837\u7684\u3002</p> <p>\u5728TDengine\u7684\u8bbe\u8ba1\u91cc\uff0c\u8868\u7528\u6765\u4ee3\u8868\u4e00\u4e2a\u5177\u4f53\u7684\u6570\u636e\u91c7\u96c6\u70b9\uff0c\u8d85\u7ea7\u8868\u7528\u6765\u4ee3\u8868\u4e00\u7ec4\u76f8\u540c\u7c7b\u578b\u7684\u6570\u636e\u91c7\u96c6\u70b9\u96c6\u5408\u3002</p> <p>\u5f53\u4e3a\u67d0\u4e2a\u5177\u4f53\u6570\u636e\u91c7\u96c6\u70b9\u521b\u5efa\u8868\u65f6\uff0c\u7528\u6237\u4f7f\u7528\u8d85\u7ea7\u8868\u7684\u5b9a\u4e49\u505a\u6a21\u677f\uff0c\u540c\u65f6\u6307\u5b9a\u8be5\u5177\u4f53\u91c7\u96c6\u70b9\uff08\u8868\uff09\u7684\u6807\u7b7e\u503c\u3002\u4e0e\u4f20\u7edf\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\u76f8\u6bd4\uff0c\u8868\uff08\u4e00\u4e2a\u6570\u636e\u91c7\u96c6\u70b9\uff09\u662f\u5e26\u6709\u9759\u6001\u6807\u7b7e\u7684\uff0c\u800c\u4e14\u8fd9\u4e9b\u6807\u7b7e\u53ef\u4ee5\u4e8b\u540e\u589e\u52a0\u3001\u5220\u9664\u3001\u4fee\u6539\u3002</p>"},{"location":"data_query/time_db/tdengine/arch.html#vs","title":"\u591a\u5217\u6a21\u578b vs \u5355\u5217\u6a21\u578b","text":"<p>TDengine\u652f\u6301\u591a\u5217\u6a21\u578b\uff0c\u53ea\u8981\u7269\u7406\u91cf\u662f\u4e00\u4e2a\u6570\u636e\u91c7\u96c6\u70b9\u540c\u65f6\u91c7\u96c6\u7684\uff08\u65f6\u95f4\u6233\u4e00\u81f4\uff09\uff0c\u8fd9\u4e9b\u91cf\u5c31\u53ef\u4ee5\u4f5c\u4e3a\u4e0d\u540c\u5217\u653e\u5728\u4e00\u5f20\u8d85\u7ea7\u8868\u91cc\u3002\u4f46\u8fd8\u6709\u4e00\u79cd\u6781\u9650\u7684\u8bbe\u8ba1\uff0c\u5355\u5217\u6a21\u578b\uff0c\u6bcf\u4e2a\u91c7\u96c6\u7684\u7269\u7406\u91cf\u90fd\u5355\u72ec\u5efa\u8868\uff0c\u56e0\u6b64\u6bcf\u79cd\u7c7b\u578b\u7684\u7269\u7406\u91cf\u90fd\u5355\u72ec\u5efa\u7acb\u4e00\u8d85\u7ea7\u8868\u3002\u6bd4\u5982\u7535\u6d41\u3001\u7535\u538b\u3001\u76f8\u4f4d\uff0c\u5c31\u5efa\u4e09\u5f20\u8d85\u7ea7\u8868\u3002 TDengine\u5efa\u8bae\u5c3d\u53ef\u80fd\u91c7\u7528\u591a\u5217\u6a21\u578b\uff0c\u56e0\u4e3a\u63d2\u5165\u6548\u7387\u4ee5\u53ca\u5b58\u50a8\u6548\u7387\u66f4\u9ad8\u3002</p>"},{"location":"data_query/time_db/tdengine/arch.html#_5","title":"\u67b6\u6784\u548c\u7ec4\u6210","text":""},{"location":"data_query/time_db/tdengine/arch.html#_6","title":"\u4e3b\u8981\u903b\u8f91\u5355\u5143","text":"<p>\u903b\u8f91\u4e0a\uff0c\u5b83\u5305\u542b\u6570\u636e\u8282\u70b9(dnode)\u3001TDengine\u5ba2\u6237\u7aef(taosc)\u4ee5\u53ca\u5e94\u7528(app)\u3002\u7cfb\u7edf\u4e2d\u5b58\u5728\u4e00\u5230\u591a\u4e2a\u6570\u636e\u8282\u70b9\uff0c\u8fd9\u4e9b\u6570\u636e\u8282\u70b9\u7ec4\u6210\u4e00\u4e2a\u96c6\u7fa4(cluster)\u3002\u5e94\u7528\u901a\u8fc7taosc\u7684API\u4e0eTDengine\u96c6\u7fa4\u8fdb\u884c\u4e92\u52a8\u3002</p> <p>\u7269\u7406\u8282\u70b9(pnode): \u6709OS\u7684\u7269\u7406\u673a\u3001\u865a\u62df\u673a\u6216\u5bb9\u5668</p> <ul> <li>\u7269\u7406\u8282\u70b9\u7531\u5176\u914d\u7f6e\u7684 FQDN(Fully Qualified Domain Name)\u6765\u6807\u8bc6\u3002</li> </ul> <p>\u6570\u636e\u8282\u70b9(dnode): dnode \u662f TDengine \u670d\u52a1\u5668\u4fa7\u6267\u884c\u4ee3\u7801 taosd \u5728\u7269\u7406\u8282\u70b9\u4e0a\u7684\u4e00\u4e2a\u8fd0\u884c\u5b9e\u4f8b\u3002</p> <ul> <li>dnode\u5305\u542b\u96f6\u5230\u591a\u4e2a\u903b\u8f91\u7684\u865a\u62df\u8282\u70b9(VNODE)\uff0c\u96f6\u6216\u8005\u81f3\u591a\u4e00\u4e2a\u903b\u8f91\u7684\u7ba1\u7406\u8282\u70b9(mnode)\u3002</li> <li>dnode\u5728\u7cfb\u7edf\u4e2d\u7684\u552f\u4e00\u6807\u8bc6\u7531\u5b9e\u4f8b\u7684End Point (EP )\u51b3\u5b9a\u3002EP\u662fdnode\u6240\u5728\u7269\u7406\u8282\u70b9\u7684FQDN (Fully Qualified Domain Name)\u548c\u7cfb\u7edf\u6240\u914d\u7f6e\u7684\u7f51\u7edc\u7aef\u53e3\u53f7(Port)\u7684\u7ec4\u5408\u3002\u901a\u8fc7\u914d\u7f6e\u4e0d\u540c\u7684\u7aef\u53e3\uff0c\u4e00\u4e2apnode\u53ef\u4ee5\u8fd0\u884c\u591a\u4e2a\u6570\u636e\u8282\u70b9\u3002</li> </ul> <p>\u865a\u62df\u8282\u70b9(vnode): \u4e3a\u66f4\u597d\u7684\u652f\u6301\u6570\u636e\u5206\u7247\u3001\u8d1f\u8f7d\u5747\u8861\uff0c\u9632\u6b62\u6570\u636e\u8fc7\u70ed\u6216\u503e\u659c\uff0c\u6570\u636e\u8282\u70b9\u88ab\u865a\u62df\u5316\u6210\u591a\u4e2a\u865a\u62df\u8282\u70b9(vnode\uff0c\u56fe\u4e2dV2, V3, V4\u7b49)\u3002</p> <ul> <li>\u6bcf\u4e2a vnode \u90fd\u662f\u4e00\u4e2a\u76f8\u5bf9\u72ec\u7acb\u7684\u5de5\u4f5c\u5355\u5143\uff0c\u662f\u65f6\u5e8f\u6570\u636e\u5b58\u50a8\u7684\u57fa\u672c\u5355\u5143\uff0c\u5177\u6709\u72ec\u7acb\u7684\u8fd0\u884c\u7ebf\u7a0b\u3001\u5185\u5b58\u7a7a\u95f4\u4e0e\u6301\u4e45\u5316\u5b58\u50a8\u7684\u8def\u5f84\u3002</li> <li>\u4e00\u4e2a vnode \u5305\u542b\u4e00\u5b9a\u6570\u91cf\u7684\u8868\uff08\u6570\u636e\u91c7\u96c6\u70b9\uff09\u3002\u5f53\u521b\u5efa\u4e00\u5f20\u65b0\u8868\u65f6\uff0c\u7cfb\u7edf\u4f1a\u68c0\u67e5\u662f\u5426\u9700\u8981\u521b\u5efa\u65b0\u7684 vnode\u3002\u4e00\u4e2a\u6570\u636e\u8282\u70b9\u4e0a\u80fd\u521b\u5efa\u7684 vnode \u7684\u6570\u91cf\u53d6\u51b3\u4e8e\u8be5\u6570\u636e\u8282\u70b9\u6240\u5728\u7269\u7406\u8282\u70b9\u7684\u786c\u4ef6\u8d44\u6e90\u3002\u4e00\u4e2a vnode \u53ea\u5c5e\u4e8e\u4e00\u4e2aDB\uff0c\u4f46\u4e00\u4e2aDB\u53ef\u4ee5\u6709\u591a\u4e2a vnode\u3002</li> <li>\u4e00\u4e2a vnode \u9664\u5b58\u50a8\u7684\u65f6\u5e8f\u6570\u636e\u5916\uff0c\u4e5f\u4fdd\u5b58\u6709\u6240\u5305\u542b\u7684\u8868\u7684SCHEMA\u3001\u6807\u7b7e\u503c\u7b49\u3002\u4e00\u4e2a\u865a\u62df\u8282\u70b9\u7531\u6240\u5c5e\u7684\u6570\u636e\u8282\u70b9\u7684EP\uff0c\u4ee5\u53ca\u6240\u5c5e\u7684VGroup ID\u5728\u7cfb\u7edf\u5185\u552f\u4e00\u6807\u8bc6\uff0c\u7531\u7ba1\u7406\u8282\u70b9\u521b\u5efa\u5e76\u7ba1\u7406\u3002</li> </ul> <p>\u7ba1\u7406\u8282\u70b9(mnode): \u4e00\u4e2a\u865a\u62df\u7684\u903b\u8f91\u5355\u5143\uff0c\u8d1f\u8d23\u6240\u6709\u6570\u636e\u8282\u70b9\u8fd0\u884c\u72b6\u6001\u7684\u76d1\u63a7\u548c\u7ef4\u62a4\uff0c\u4ee5\u53ca\u8282\u70b9\u4e4b\u95f4\u7684\u8d1f\u8f7d\u5747\u8861(\u56fe\u4e2dM)</p> <ul> <li>\u7ba1\u7406\u8282\u70b9\u4e5f\u8d1f\u8d23\u5143\u6570\u636e(\u5305\u62ec\u7528\u6237\u3001\u6570\u636e\u5e93\u3001\u8868\u3001\u9759\u6001\u6807\u7b7e\u7b49)\u7684\u5b58\u50a8\u548c\u7ba1\u7406\uff0c\u56e0\u6b64\u4e5f\u79f0\u4e3a Meta Node\u3002</li> <li>TDengine \u96c6\u7fa4\u4e2d\u53ef\u914d\u7f6e\u591a\u4e2a(\u6700\u591a\u4e0d\u8d85\u8fc75\u4e2a) mnode\uff0c\u5b83\u4eec\u81ea\u52a8\u6784\u5efa\u6210\u4e3a\u4e00\u4e2a\u865a\u62df\u7ba1\u7406\u8282\u70b9\u7ec4(\u56fe\u4e2dM0, M1, M2)\u3002</li> <li>mnode \u95f4\u91c7\u7528 master/slave \u7684\u673a\u5236\u8fdb\u884c\u7ba1\u7406\uff0c\u800c\u4e14\u91c7\u53d6\u5f3a\u4e00\u81f4\u65b9\u5f0f\u8fdb\u884c\u6570\u636e\u540c\u6b65\uff0c\u4efb\u4f55\u6570\u636e\u66f4\u65b0\u64cd\u4f5c\u53ea\u80fd\u5728 Master \u4e0a\u8fdb\u884c\u3002</li> <li>mnode \u96c6\u7fa4\u7684\u521b\u5efa\u7531\u7cfb\u7edf\u81ea\u52a8\u5b8c\u6210\uff0c\u65e0\u9700\u4eba\u5de5\u5e72\u9884\u3002\u6bcf\u4e2adnode\u4e0a\u81f3\u591a\u6709\u4e00\u4e2amnode\uff0c\u7531\u6240\u5c5e\u7684\u6570\u636e\u8282\u70b9\u7684EP\u6765\u552f\u4e00\u6807\u8bc6\u3002\u6bcf\u4e2adnode\u901a\u8fc7\u5185\u90e8\u6d88\u606f\u4ea4\u4e92\u81ea\u52a8\u83b7\u53d6\u6574\u4e2a\u96c6\u7fa4\u4e2d\u6240\u6709 mnode \u6240\u5728\u7684 dnode \u7684EP\u3002</li> </ul> <p>\u865a\u62df\u8282\u70b9\u7ec4(VGroup): \u4e0d\u540c\u6570\u636e\u8282\u70b9\u4e0a\u7684 vnode \u53ef\u4ee5\u7ec4\u6210\u4e00\u4e2a\u865a\u62df\u8282\u70b9\u7ec4(vnode group)\u6765\u4fdd\u8bc1\u7cfb\u7edf\u7684\u9ad8\u53ef\u9760\u3002</p> <ul> <li>\u865a\u62df\u8282\u70b9\u7ec4\u5185\u91c7\u53d6master/slave\u7684\u65b9\u5f0f\u8fdb\u884c\u7ba1\u7406\u3002\u5199\u64cd\u4f5c\u53ea\u80fd\u5728 master vnode \u4e0a\u8fdb\u884c\uff0c\u7cfb\u7edf\u91c7\u7528\u5f02\u6b65\u590d\u5236\u7684\u65b9\u5f0f\u5c06\u6570\u636e\u540c\u6b65\u5230 slave vnode\uff0c\u786e\u4fdd\u4e00\u4efd\u6570\u636e\u5728\u591a\u4e2a\u7269\u7406\u8282\u70b9\u4e0a\u6709\u62f7\u8d1d\u3002</li> <li>\u4e00\u4e2a vgroup \u91cc\u865a\u62df\u8282\u70b9\u4e2a\u6570\u5c31\u662f\u6570\u636e\u7684\u526f\u672c\u6570\u3002\u5982\u679c\u4e00\u4e2aDB\u7684\u526f\u672c\u6570\u4e3aN\uff0c\u7cfb\u7edf\u5fc5\u987b\u6709\u81f3\u5c11N\u4e2a\u6570\u636e\u8282\u70b9\u3002\u526f\u672c\u6570\u5728\u521b\u5efaDB\u65f6\u901a\u8fc7\u53c2\u6570 replica \u53ef\u4ee5\u6307\u5b9a\uff0c\u7f3a\u7701\u4e3a1\u3002</li> <li>\u865a\u62df\u8282\u70b9\u7ec4\u7531\u7ba1\u7406\u8282\u70b9\u521b\u5efa\u3001\u7ba1\u7406\uff0c\u5e76\u4e14\u7531\u7ba1\u7406\u8282\u70b9\u5206\u914d\u4e00\u4e2a\u7cfb\u7edf\u552f\u4e00\u7684ID\uff0cVGroup ID\u3002\u5982\u679c\u4e24\u4e2a\u865a\u62df\u8282\u70b9\u7684vnode group ID\u76f8\u540c\uff0c\u8bf4\u660e\u4ed6\u4eec\u5c5e\u4e8e\u540c\u4e00\u4e2a\u7ec4\uff0c\u6570\u636e\u4e92\u4e3a\u5907\u4efd\u3002\u865a\u62df\u8282\u70b9\u7ec4\u91cc\u865a\u62df\u8282\u70b9\u7684\u4e2a\u6570\u662f\u53ef\u4ee5\u52a8\u6001\u6539\u53d8\u7684\uff0c\u5bb9\u8bb8\u53ea\u6709\u4e00\u4e2a\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709\u6570\u636e\u590d\u5236\u3002VGroup ID\u662f\u6c38\u8fdc\u4e0d\u53d8\u7684\uff0c\u5373\u4f7f\u4e00\u4e2a\u865a\u62df\u8282\u70b9\u7ec4\u88ab\u5220\u9664\uff0c\u5b83\u7684ID\u4e5f\u4e0d\u4f1a\u88ab\u6536\u56de\u91cd\u590d\u5229\u7528\u3002</li> </ul> <p>TAOSC: taosc\u662fTDengine\u7ed9\u5e94\u7528\u63d0\u4f9b\u7684\u9a71\u52a8\u7a0b\u5e8f(driver)\uff0c\u8d1f\u8d23\u5904\u7406\u5e94\u7528\u4e0e\u96c6\u7fa4\u7684\u63a5\u53e3\u4ea4\u4e92\uff0c\u5185\u5d4c\u4e8eJDBC\u3001ODBC driver\u4e2d\uff0c\u6216\u8005C\u3001Python\u3001Go\u8bed\u8a00\u8fde\u63a5\u5e93\u3002</p> <ul> <li>\u5e94\u7528\u90fd\u662f\u901a\u8fc7taosc\u800c\u4e0d\u662f\u76f4\u63a5\u8fde\u63a5\u96c6\u7fa4\u4e2d\u7684\u6570\u636e\u8282\u70b9\u4e0e\u6574\u4e2a\u96c6\u7fa4\u8fdb\u884c\u4ea4\u4e92\u7684\u3002</li> <li>\u8d1f\u8d23\u83b7\u53d6\u5e76\u7f13\u5b58\u5143\u6570\u636e\uff1a\u5c06\u63d2\u5165\u3001\u67e5\u8be2\u7b49\u8bf7\u6c42\u8f6c\u53d1\u5230\u6b63\u786e\u7684\u6570\u636e\u8282\u70b9\uff1b\u5728\u628a\u7ed3\u679c\u8fd4\u56de\u7ed9\u5e94\u7528\u65f6\uff0c\u8fd8\u9700\u8981\u8d1f\u8d23\u6700\u540e\u4e00\u7ea7\u7684\u805a\u5408\u3001\u6392\u5e8f\u3001\u8fc7\u6ee4\u7b49\u64cd\u4f5c\u3002\u5bf9\u4e8eJDBC, ODBC, C/C++\u63a5\u53e3\u800c\u8a00\uff0c\u8fd9\u4e2a\u6a21\u5757\u662f\u5728\u5e94\u7528\u6240\u5904\u7684\u7269\u7406\u8282\u70b9\u4e0a\u8fd0\u884c\uff0c\u4f46\u6d88\u8017\u7684\u8d44\u6e90\u5f88\u5c0f\u3002</li> <li>\u4e3a\u652f\u6301\u5168\u5206\u5e03\u5f0f\u7684RESTful\u63a5\u53e3\uff0ctaosc\u5728TDengine\u96c6\u7fa4\u7684\u6bcf\u4e2adnode\u4e0a\u90fd\u6709\u4e00\u8fd0\u884c\u5b9e\u4f8b\u3002</li> </ul>"},{"location":"data_query/time_db/tdengine/arch.html#_7","title":"\u8282\u70b9\u4e4b\u95f4\u7684\u901a\u8baf","text":"<p>\u901a\u8baf\u65b9\u5f0f\uff1a\u5404\u4e2a\u8282\u70b9\u4e4b\u95f4\u7684\u901a\u8baf\u662f\u901a\u8fc7TCP/UDP\u8fdb\u884c\u7684\uff0cTDengine\u5b9e\u73b0\u4e86\u81ea\u5df1\u7684\u8d85\u65f6\u3001\u91cd\u4f20\u3001\u786e\u8ba4\u7b49\u673a\u5236\uff0c\u4ee5\u786e\u4fddUDP\u7684\u53ef\u9760\u4f20\u8f93\u3002</p> <ul> <li> <p>\u5bf9\u4e8e\u6570\u636e\u91cf\u4e0d\u523015K\u7684\u6570\u636e\u5305\uff0c\u91c7\u53d6UDP\u7684\u65b9\u5f0f\u8fdb\u884c\u4f20\u8f93\uff0c\u8d85\u8fc715K\u7684\uff0c\u6216\u8005\u662f\u67e5\u8be2\u7c7b\u7684\u64cd\u4f5c\uff0c\u81ea\u52a8\u91c7\u53d6TCP\u7684\u65b9\u5f0f\u8fdb\u884c\u4f20\u8f93\u3002</p> </li> <li> <p>TDengine\u6839\u636e\u914d\u7f6e\u548c\u6570\u636e\u5305\uff0c\u4f1a\u81ea\u52a8\u5bf9\u6570\u636e\u8fdb\u884c\u538b\u7f29/\u89e3\u538b\u7f29\uff0c\u6570\u5b57\u7b7e\u540d/\u8ba4\u8bc1\u7b49\u5904\u7406\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u6570\u636e\u8282\u70b9\u4e4b\u95f4\u7684\u6570\u636e\u590d\u5236\uff0c\u53ea\u91c7\u7528TCP\u65b9\u5f0f\u8fdb\u884c\u6570\u636e\u4f20\u8f93</p> </li> </ul> <p>FQDN\u914d\u7f6e\uff1a\u914d\u7f6e\u4e3ahost\u6216\u8005ip\uff1b\u4e00\u4e2a\u6570\u636e\u8282\u70b9\u7684EP(End Point)\u7531FQDN + Port\u7ec4\u6210\u3002</p> <p>\u7aef\u53e3\u914d\u7f6e\uff1a\u4e00\u4e2a\u6570\u636e\u8282\u70b9\u5bf9\u5916\u7684\u7aef\u53e3\u7531TDengine\u7684\u7cfb\u7edf\u914d\u7f6e\u53c2\u6570serverPort\u51b3\u5b9a\uff0c\u5bf9\u96c6\u7fa4\u5185\u90e8\u901a\u8baf\u7684\u7aef\u53e3\u662fserverPort+5\u3002\u6570\u636e\u590d\u5236\u64cd\u4f5c\u8fd8\u5360\u6709\u4e00\u4e2aTCP\u7aef\u53e3\uff0c\u662fserverPort+10\u3002</p> <ul> <li>\u4e3a\u652f\u6301\u591a\u7ebf\u7a0b\u9ad8\u6548\u7684\u5904\u7406UDP\u6570\u636e\uff0c\u6bcf\u4e2a\u5bf9\u5185\u548c\u5bf9\u5916\u7684UDP\u94fe\u63a5\uff0c\u90fd\u9700\u8981\u5360\u75285\u4e2a\u8fde\u7eed\u7684\u7aef\u53e3\u3002\u56e0\u6b64\u4e00\u4e2a\u6570\u636e\u8282\u70b9\u603b\u7684\u7aef\u53e3\u8303\u56f4\u4e3aserverPort\u5230serverPort + 10\uff0c\u603b\u517111\u4e2aTCP/UDP\u7aef\u53e3\u3002</li> </ul> <p>\u96c6\u7fa4\u5bf9\u5916\u94fe\u63a5: \u5e94\u7528\u53ea\u9700\u8981\u5411\u96c6\u7fa4\u4e2d\u4efb\u4f55\u4e00\u4e2a\u6570\u636e\u8282\u70b9\u53d1\u8d77\u8fde\u63a5\u5373\u53ef\uff0c\u94fe\u63a5\u9700\u8981\u63d0\u4f9b\u7684\u7f51\u7edc\u53c2\u6570\u662f\u4e00\u6570\u636e\u8282\u70b9\u7684End Point(FQDN\u52a0\u914d\u7f6e\u7684\u7aef\u53e3\u53f7\uff09\u3002</p> <p>\u96c6\u7fa4\u5185\u90e8\u901a\u8baf: \u5404\u4e2a\u6570\u636e\u8282\u70b9\u4e4b\u95f4\u901a\u8fc7TCP/UDP\u8fdb\u884c\u94fe\u63a5\u3002\u4e00\u4e2a\u6570\u636e\u8282\u70b9\u542f\u52a8\u65f6\uff0c\u5c06\u83b7\u53d6mnode\u6240\u5728\u7684dnode\u7684EP\u4fe1\u606f\uff0c\u7136\u540e\u4e0e\u7cfb\u7edf\u4e2d\u7684mnode\u5efa\u7acb\u8d77\u94fe\u63a5\uff0c\u4ea4\u6362\u4fe1\u606f\u3002</p> <p>MNODE\u7684\u9009\u62e9\uff1a\u7cfb\u7edf\u81ea\u52a8\u51b3\u5b9amnode</p> <ul> <li>\u4e00\u4e2a\u6570\u636e\u8282\u70b9\u542f\u52a8\u65f6\uff0c\u4f1a\u68c0\u67e5\u81ea\u5df1\u7684End Point, \u5e76\u4e0e\u83b7\u53d6\u7684mnode EP List\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5982\u679c\u5728\u5176\u4e2d\uff0c\u8be5\u6570\u636e\u8282\u70b9\u8ba4\u4e3a\u81ea\u5df1\u5e94\u8be5\u542f\u52a8mnode\u6a21\u5757\uff0c\u6210\u4e3amnode\uff1b</li> <li>\u5728\u7cfb\u7edf\u7684\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u7531\u4e8e\u8d1f\u8f7d\u5747\u8861\u3001\u5b95\u673a\u7b49\u539f\u56e0\uff0cmnode\u6709\u53ef\u80fd\u81ea\u52a8\u8fc1\u79fb\u81f3\u65b0\u7684dnode\uff1b</li> </ul>"},{"location":"data_query/time_db/tdengine/arch.html#_8","title":"\u5178\u578b\u7684\u6d88\u606f\u6d41\u7a0b","text":""},{"location":"data_query/time_db/tdengine/arch.html#_9","title":"\u5b58\u50a8\u6a21\u578b","text":"<p>TDengine\u5b58\u50a8\u7684\u6570\u636e\u5305\u62ec\u91c7\u96c6\u7684\u65f6\u5e8f\u6570\u636e\u4ee5\u53ca\u5e93\u3001\u8868\u76f8\u5173\u7684\u5143\u6570\u636e\u3001\u6807\u7b7e\u6570\u636e\u7b49\uff0c\u8fd9\u4e9b\u6570\u636e\u5177\u4f53\u5206\u4e3a\u4e09\u90e8\u5206\uff1a</p> <ul> <li>\u65f6\u5e8f\u6570\u636e\uff1a\u5b58\u653e\u4e8evnode\u91cc\uff0c\u7531data\u3001head\u548clast\u4e09\u4e2a\u6587\u4ef6\u7ec4\u6210\uff0c\u6570\u636e\u91cf\u5927\uff0c\u67e5\u8be2\u91cf\u53d6\u51b3\u4e8e\u5e94\u7528\u573a\u666f\u3002\u5bb9\u8bb8\u4e71\u5e8f\u5199\u5165\uff0c\u4f46\u6682\u65f6\u4e0d\u652f\u6301\u5220\u9664\u548c\u66f4\u65b0\u64cd\u4f5c\u3002\u901a\u8fc7\u91c7\u7528\u4e00\u4e2a\u91c7\u96c6\u70b9\u4e00\u5f20\u8868\u7684\u6a21\u578b\uff0c\u4e00\u4e2a\u65f6\u95f4\u6bb5\u7684\u6570\u636e\u662f\u8fde\u7eed\u5b58\u50a8\uff0c\u5bf9\u5355\u5f20\u8868\u7684\u5199\u5165\u662f\u7b80\u5355\u7684\u8ffd\u52a0\u64cd\u4f5c\uff0c\u4e00\u6b21\u8bfb\uff0c\u53ef\u4ee5\u8bfb\u5230\u591a\u6761\u8bb0\u5f55\uff0c\u8fd9\u6837\u4fdd\u8bc1\u5bf9\u5355\u4e2a\u91c7\u96c6\u70b9\u7684\u63d2\u5165\u548c\u67e5\u8be2\u64cd\u4f5c\uff0c\u6027\u80fd\u8fbe\u5230\u6700\u4f18\u3002</li> <li>\u6807\u7b7e\u6570\u636e\uff1a\u5b58\u653e\u4e8evnode\u91cc\u7684meta\u6587\u4ef6\uff0c\u652f\u6301\u589e\u5220\u6539\u67e5\u56db\u4e2a\u6807\u51c6\u64cd\u4f5c\u3002\u6570\u636e\u91cf\u4e0d\u5927\uff0c\u6709N\u5f20\u8868\uff0c\u5c31\u6709N\u6761\u8bb0\u5f55\uff0c\u56e0\u6b64\u53ef\u4ee5\u5168\u5185\u5b58\u5b58\u50a8\u3002\u5982\u679c\u6807\u7b7e\u8fc7\u6ee4\u64cd\u4f5c\u5f88\u591a\uff0c\u67e5\u8be2\u5c06\u5341\u5206\u9891\u7e41\uff0c\u56e0\u6b64TDengine\u652f\u6301\u591a\u6838\u591a\u7ebf\u7a0b\u5e76\u53d1\u67e5\u8be2\u3002\u53ea\u8981\u8ba1\u7b97\u8d44\u6e90\u8db3\u591f\uff0c\u5373\u4f7f\u6709\u6570\u5343\u4e07\u5f20\u8868\uff0c\u8fc7\u6ee4\u7ed3\u679c\u80fd\u6beb\u79d2\u7ea7\u8fd4\u56de\u3002</li> <li>\u5176\u4ed6\u5143\u6570\u636e\uff1a\u5b58\u653e\u4e8emnode\u91cc\uff0c\u5305\u542b\u7cfb\u7edf\u8282\u70b9\u3001\u7528\u6237\u3001DB\u3001Table Schema\u7b49\u7b49\uff0c\u652f\u6301\u589e\u5220\u6539\u67e5\u56db\u4e2a\u6807\u51c6\u64cd\u4f5c\u3002\u8fd9\u90e8\u5206\u6570\u636e\u7684\u91cf\u4e0d\u5927\uff0c\u53ef\u4ee5\u5168\u5185\u5b58\u4fdd\u5b58\uff0c\u800c\u4e14\u7531\u4e8e\u5ba2\u6237\u7aef\u6709\u7f13\u5b58\uff0c\u67e5\u8be2\u91cf\u4e5f\u4e0d\u5927\u3002\u56e0\u6b64\u76ee\u524d\u7684\u8bbe\u8ba1\u867d\u662f\u96c6\u4e2d\u5f0f\u5b58\u50a8\u7ba1\u7406\uff0c\u4f46\u4e0d\u4f1a\u6784\u6210\u6027\u80fd\u74f6\u9888\u3002</li> </ul>"},{"location":"data_query/time_db/tdengine/arch.html#_10","title":"\u6570\u636e\u5206\u7247","text":"<p>\u901a\u8fc7vnode\u6765\u5b9e\u73b0\u6570\u636e\u5206\u7247\u7684\uff0c\u901a\u8fc7\u4e00\u4e2a\u65f6\u95f4\u6bb5\u4e00\u4e2a\u6570\u636e\u6587\u4ef6\u6765\u5b9e\u73b0\u65f6\u5e8f\u6570\u636e\u5206\u533a\u7684\u3002</p> <p>TDengine\u5c06\u4e00\u5f20\u8868\uff08\u4e00\u4e2a\u6570\u636e\u91c7\u96c6\u70b9\uff09\u7684\u6240\u6709\u6570\u636e\u90fd\u5b58\u653e\u5728\u4e00\u4e2avnode\u91cc\uff0c\u800c\u4e0d\u4f1a\u8ba9\u540c\u4e00\u4e2a\u91c7\u96c6\u70b9\u7684\u6570\u636e\u5206\u5e03\u5230\u4e24\u4e2a\u6216\u591a\u4e2adnode\u4e0a\uff1a</p> <ul> <li>\u5982\u679c\u6bcf\u79d2\u751f\u6210\u4e00\u676116\u5b57\u8282\u7684\u8bb0\u5f55\uff0c\u4e00\u5e74\u4ea7\u751f\u7684\u539f\u59cb\u6570\u636e\u4e0d\u52300.5G\uff1b</li> <li>\u4e00\u4e2avnode\u53ef\u5b58\u50a8\u591a\u4e2a\u6570\u636e\u91c7\u96c6\u70b9(\u8868\uff09\u7684\u6570\u636e\uff0c\u4e00\u4e2avnode\u53ef\u5bb9\u7eb3\u7684\u8868\u7684\u6570\u76ee\u7684\u4e0a\u9650\u4e3a\u4e00\u767e\u4e07\uff1b\u8bbe\u8ba1\u4e0a\uff0c\u4e00\u4e2avnode\u91cc\u6240\u6709\u7684\u8868\u90fd\u5c5e\u4e8e\u540c\u4e00\u4e2aDB\u3002</li> <li>\u4e00\u4e2a\u6570\u636e\u8282\u70b9\u4e0a\uff0c\u9664\u975e\u7279\u6b8a\u914d\u7f6e\uff0c\u4e00\u4e2aDB\u62e5\u6709\u7684vnode\u6570\u76ee\u4e0d\u4f1a\u8d85\u8fc7\u7cfb\u7edf\u6838\u7684\u6570\u76ee\u3002</li> </ul>"},{"location":"data_query/time_db/tdengine/arch.html#_11","title":"\u6570\u636e\u5206\u533a","text":"<p>TDengine\u9664vnode\u5206\u7247\u4e4b\u5916\uff0c\u8fd8\u5bf9\u65f6\u5e8f\u6570\u636e\u6309\u7167\u65f6\u95f4\u6bb5\u8fdb\u884c\u5206\u533a\u3002\u6bcf\u4e2a\u6570\u636e\u6587\u4ef6\u53ea\u5305\u542b\u4e00\u4e2a\u65f6\u95f4\u6bb5\u7684\u65f6\u5e8f\u6570\u636e\uff0c\u65f6\u95f4\u6bb5\u7684\u957f\u5ea6\u7531DB\u7684\u914d\u7f6e\u53c2\u6570days\u51b3\u5b9a\u3002</p>"},{"location":"data_query/time_db/tdengine/arch.html#_12","title":"\u8d1f\u8f7d\u5747\u8861","text":"<p>dnode\u90fd\u5b9a\u65f6\u5411 mnode(\u865a\u62df\u7ba1\u7406\u8282\u70b9)\u62a5\u544a\u5176\u72b6\u6001\uff08\u5305\u62ec\u786c\u76d8\u7a7a\u95f4\u3001\u5185\u5b58\u5927\u5c0f\u3001CPU\u3001\u7f51\u7edc\u3001\u865a\u62df\u8282\u70b9\u4e2a\u6570\u7b49\uff09\uff0c\u56e0\u6b64mnode\u4e86\u89e3\u6574\u4e2a\u96c6\u7fa4\u7684\u72b6\u6001\u3002\u57fa\u4e8e\u6574\u4f53\u72b6\u6001\uff0c\u5f53mnode\u53d1\u73b0\u67d0\u4e2adnode\u8d1f\u8f7d\u8fc7\u91cd\uff0c\u5b83\u4f1a\u5c06dnode\u4e0a\u7684\u4e00\u4e2a\u6216\u591a\u4e2avnode\u632a\u5230\u5176\u4ed6dnode\u3002\u5728\u632a\u52a8\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u5916\u670d\u52a1\u7ee7\u7eed\u8fdb\u884c\uff0c\u6570\u636e\u63d2\u5165\u3001\u67e5\u8be2\u548c\u8ba1\u7b97\u64cd\u4f5c\u90fd\u4e0d\u53d7\u5f71\u54cd\u3002</p>"},{"location":"data_query/time_db/tdengine/arch.html#_13","title":"\u6570\u636e\u5199\u5165\u4e0e\u590d\u5236\u6d41\u7a0b","text":""},{"location":"data_query/time_db/tdengine/arch.html#master-vnode","title":"Master vnode\u5199\u5165\u6d41\u7a0b","text":""},{"location":"data_query/time_db/tdengine/arch.html#slave-vnode","title":"Slave vnode\u5199\u5165\u6d41\u7a0b","text":""},{"location":"data_query/time_db/tdengine/design.html","title":"Design","text":"<p>[toc]</p>"},{"location":"data_query/time_db/tdengine/design.html#taosd","title":"taosd\u7684\u8bbe\u8ba1","text":""},{"location":"data_query/time_db/tdengine/design.html#_1","title":"\u7cfb\u7edf\u6a21\u5757\u56fe","text":""},{"location":"data_query/time_db/tdengine/design.html#rpc","title":"RPC\u6a21\u5757","text":""},{"location":"data_query/time_db/tdengine/design.html#dnode","title":"DNODE\u6a21\u5757","text":""},{"location":"data_query/time_db/tdengine/design.html#vnode","title":"VNODE\u6a21\u5757","text":""},{"location":"data_query/time_db/tdengine/design.html#mnode","title":"MNODE\u6a21\u5757","text":""},{"location":"data_query/time_db/tdengine/design.html#tsdb","title":"TSDB\u6a21\u5757","text":""},{"location":"data_query/time_db/tdengine/design.html#query","title":"Query\u6a21\u5757","text":""},{"location":"data_query/time_db/tdengine/design.html#sync","title":"SYNC\u6a21\u5757","text":""},{"location":"data_query/time_db/tdengine/design.html#wal","title":"WAL\u6a21\u5757","text":""},{"location":"data_query/time_db/tdengine/design.html#http","title":"HTTP\u6a21\u5757","text":""},{"location":"data_query/time_db/tdengine/design.html#monitor","title":"Monitor\u6a21\u5757","text":""},{"location":"data_query/time_db/tdengine/sql.html","title":"Sql","text":"<p>[toc]</p>"},{"location":"data_query/time_db/tdengine/sql.html#sql","title":"SQL","text":""},{"location":"data_query/time_db/tdengine/sql.html#_1","title":"\u521b\u5efa","text":""},{"location":"data_query/time_db/tdengine/sql.html#_2","title":"\u5e93/\u8868","text":"<p>\u5904\u4e8e\u4e24\u4e2a\u4e0d\u540c\u5e93\u7684\u8868\u662f\u4e0d\u80fd\u8fdb\u884cJOIN\u64cd\u4f5c\u7684\u3002</p> <pre><code>/* \u521b\u5efa\u4e00\u4e2a\u540d\u4e3apower\u7684\u5e93\uff0c\u8fd9\u4e2a\u5e93\u7684\u6570\u636e\u5c06\u4fdd\u7559365\u5929\uff08\u8d85\u8fc7365\u5929\u5c06\u88ab\u81ea\u52a8\u5220\u9664\uff09\uff0c\u6bcf10\u5929\u4e00\u4e2a\u6570\u636e\u6587\u4ef6\uff0c\u5185\u5b58\u5757\u6570\u4e3a4% */\nCREATE DATABASE power KEEP 365 DAYS 10 BLOCKS 4;\n\nUSE power;  \n\n/* \u521b\u5efa\u8d85\u7ea7\u8868 */\nCREATE TABLE meters (ts timestamp, current float, voltage int, phase float) TAGS (location binary(64), groupdId int);\n/* \u521b\u5efa\u8868 */\nCREATE TABLE d1001 USING meters TAGS (\"Beijing.Chaoyang\", 2);\n/* \u63d2\u5165\u6570\u636e */\nINSERT INTO d1001 USING METERS TAGS (\"Beijng.Chaoyang\", 2) VALUES (now, 10.2, 219, 0.32);\n</code></pre>"},{"location":"data_query/time_db/tdengine/sql.html#todo","title":"\u8fde\u7eed\u67e5\u8be2\uff08TODO\uff09","text":""},{"location":"data_query/time_db/tdengine/sql.html#todo_1","title":"\u6570\u636e\u8ba2\u9605\uff08TODO\uff09","text":""},{"location":"data_query/time_db/tdengine/sql.html#todo_2","title":"\u7f13\u5b58\uff08TODO\uff09","text":""},{"location":"data_query/time_db/tdengine/sql.html#todo_3","title":"\u62a5\u8b66\u76d1\u6d4b\uff08TODO\uff09","text":"<p>https://github.com/taosdata/tdengine/blob/master/alert/README_cn.md</p>"},{"location":"data_system/knox.html","title":"Apache Knox","text":"<p>REST API and Application Gateway for the Apache Hadoop Ecosystem.</p> <p>Apache Hadoop\u751f\u6001\u7684\u5e94\u7528\u7f51\u5173\u3002</p> <p>TODO\uff1a</p> <ul> <li>\u5b89\u88c5/\u90e8\u7f72\u7b49\u76f8\u5173\u6587\u6863\u96c6\u6210</li> </ul>"},{"location":"data_system/knox.html#_1","title":"\u529f\u80fd","text":"<p>Knox\u652f\u6301\u4e86API\uff0cUI\uff0cJdbc\uff0cMetastoreServer\u7edf\u4e00\u4ee3\u7406\u3002</p> <p>\u76ee\u524d\u5728Knox\u4e2d\uff081.6.1\uff09\uff0c\u63d0\u4f9b\u5f00\u7bb1\u5373\u7528\u7684\u89c4\u5219\u5305\u62ecHadoop\uff0cHive\uff0cHbase\uff0cSpark\uff0cFlink\uff0cDruid\uff0cPresto\u7b49\u5927\u6570\u636e\u751f\u6001\u5e38\u7528\u7ec4\u4ef6\u3002</p>"},{"location":"data_system/knox.html#_2","title":"\u539f\u7406","text":""},{"location":"data_system/knox.html#_3","title":"\u90e8\u7f72","text":"<p>LDAP</p>"},{"location":"data_system/knox.html#_4","title":"\u4f7f\u7528","text":"<p>\u4f7f\u7528\u6587\u6863</p>"},{"location":"data_system/knox.html#_5","title":"\u81ea\u5b9a\u4e49\u96c6\u6210","text":"<p>Apache Dophin Scheduler</p>"},{"location":"data_system/object_file_compare.html","title":"\u5bf9\u8c61\u5b58\u50a8\u548c\u6587\u4ef6\u5b58\u50a8\u533a\u522b","text":"<p>\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u76ee\u5f55\u7ed3\u6784\u4e2d\u5e94\u8be5\u662f\u53f3\u8fb9\u6811\u5f62\u7ed3\u6784\u7684\u6837\u5b50\uff0c\u800c\u5bf9\u8c61\u5b58\u50a8\u4e2d\u662f\u5de6\u8fb9\u6241\u5e73\u7684\u7ed3\u6784\uff0c\u6bcf\u4e2a\u5bf9\u8c61\u7684 key \u7528 \u201c/\u201d \u6a21\u62df\u4e86\u8def\u5f84\u7ed3\u6784\uff0c\u4f46\u5bf9\u8c61\u4e0e\u5bf9\u8c61\u4e4b\u95f4\u6ca1\u6709\u5173\u8054\u3002</p> <p></p> <p>\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u76ee\u5f55\u7ed3\u6784\u4e2d\u5e94\u8be5\u662f\u53f3\u8fb9\u6811\u5f62\u7ed3\u6784\u7684\u6837\u5b50\uff0c\u800c\u5bf9\u8c61\u5b58\u50a8\u4e2d\u662f\u5de6\u8fb9\u6241\u5e73\u7684\u7ed3\u6784\uff0c\u6bcf\u4e2a\u5bf9\u8c61\u7684 key \u7528 \u201c/\u201d \u6a21\u62df\u4e86\u8def\u5f84\u7ed3\u6784\uff0c\u4f46\u5bf9\u8c61\u4e0e\u5bf9\u8c61\u4e4b\u95f4\u6ca1\u6709\u5173\u8054\u3002\u5728\u8fd9\u4e24\u79cd\u6570\u636e\u7ed3\u6784\u4e0b\u54b1\u4eec\u770b\u770b \u201crename\u201d \u64cd\u4f5c\u7684\u4e0d\u540c\u5b9e\u73b0\u65b9\u5f0f\u3002</p> <p>\u5bf9\u8c61\u5b58\u50a8</p> <p>\u5728<code>mv /foo /bar</code> \u8fd9\u4e2a\u6539\u540d\u64cd\u4f5c\u4e2d\uff0c\u9700\u8981\u5728\u5143\u6570\u636e\u7d22\u5f15\u4e2d\u627e\u5230\u641c\u7d22\u51fa\u6240\u6709 key \u5305\u542b <code>/foo</code> \u5bf9\u8c61\uff0c\u7136\u540e\u62f7\u8d1d\u4e3a\u4e00\u4efd\u65b0\u7684\u5bf9\u8c61\uff0c\u5c06 key \u91cc\u7684<code>/foo</code>\u6539\u4e3a<code>/bar</code>\uff0c\u4f1a\u6709\u5927\u91cf\u7684\u5bf9\u8c61\u53d1\u751f I/O \u590d\u5236\uff0c\u62f7\u8d1d\u5b8c\u6210\u540e\u5220\u9664\u65e7\u7684\u5bf9\u8c61\uff0c\u5728\u62f7\u8d1d\u548c\u5220\u9664\u5b8c\u6210\u4e4b\u540e\u518d\u66f4\u65b0\u5bf9\u8c61\u5b58\u50a8\u7684\u5143\u6570\u636e\u7d22\u5f15\u3002\u6574\u4e2a\u64cd\u4f5c\u6ca1\u6709\u4e8b\u52a1\u4fdd\u8bc1\uff0c\u5b8c\u6210\u65f6\u95f4\u4f9d\u8d56\u4e8e\u6539\u540d\u64cd\u4f5c\u6d89\u53ca\u7684\u5bf9\u8c61\u6570\u91cf\uff0c\u7f3a\u5c11\u4e8b\u52a1\u4fdd\u8bc1\u4e5f\u662f\u9020\u6210\u6570\u636e\u4e0d\u662f\u5f3a\u4e00\u81f4\u6027\u7684\u539f\u56e0\u3002</p> <p>\u6587\u4ef6\u7cfb\u7edf</p> <p>\u53f3\u8fb9\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u6539\u540d\u64cd\u4f5c\uff0c\u53ea\u9700\u8981\u627e\u5230\u8def\u5f84\u540d\u5bf9\u5e94\u7684 inodes \u66f4\u65b0\u5373\u53ef\uff0c\u4fdd\u8bc1\u4e86\u64cd\u4f5c\u539f\u5b50\u6027\u3002</p>"},{"location":"data_system/1_data_organize/data_format/index.html","title":"\u6570\u636e\u5b58\u50a8\u683c\u5f0f","text":"<p>\u50cfApache Hive\uff0cImpala\uff0cSpark \u8fd9\u79cd\u6570\u636e\u5206\u6790\u5f15\u64ce\u80fd\u591f\u8bbf\u95ee\u8bfb\u53d6\u7684\u6587\u4ef6\u683c\u5f0f\u3002 - TextFile --- Hadoop TextInputFormat</p> <p>\u5b58\u50a8\u65b9\u5f0f\u4e3a\u884c\u5f0f\u5b58\u50a8\uff0c\u5728\u68c0\u7d22\u65f6\u78c1\u76d8\u5f00\u9500\u5927\uff0c\u6570\u636e\u89e3\u6790\u5f00\u9500\u5927\uff0c\u800c\u5bf9\u538b\u7f29\u7684text\u6587\u4ef6\uff0chive\u65e0\u6cd5\u8fdb\u884c\u5408\u5e76\u548c\u62c6\u5206\uff1b</p> <ul> <li>SequcenFile --- Hadoop SequenceFileInputFormat</li> </ul> <p>\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u4ee5\u7684\u5f62\u5f0f\u5e8f\u5217\u5316\u5230\u6587\u4ef6\u4e2d\uff0c\u5b58\u50a8\u65b9\u5f0f\u4e3a\u884c\u5f0f\u5b58\u50a8\uff0c\u53ef\u4ee5\u5bf9\u6587\u4ef6\u8fdb\u884c\u5206\u5272\u548c\u538b\u7f29\uff0c\u4e00\u822c\u4f7f\u7528block\u538b\u7f29\uff1b <ul> <li> <p>Apache ORC-- Optimized Row Columnar   \u6839\u636e\u884c\u7ec4\u5206\u5272\u6574\u4e2a\u8868\uff0c\u5728\u6bcf\u4e00\u4e2a\u884c\u7ec4\u5185\u8fdb\u884c\u6309\u5217\u5b58\u50a8\u3002ORC\u6587\u4ef6\u662f\u81ea\u63cf\u8ff0\u7684\uff0c\u5b83\u7684\u5143\u6570\u636e\u4f7f\u7528Protocol Buffers\u5e8f\u5217\u5316\u3002\u5bf9\u590d\u6742\u6570\u636e\u7c7b\u578b\u7279\u6b8a\u5904\u7406\u7684\u65b9\u5f0f\u5b9e\u73b0\u5d4c\u5957\u683c\u5f0f\u7684\u652f\u6301\uff0cORC\u53ef\u4ee5\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u652f\u6301ACID\u64cd\u4f5c</p> </li> <li> <p>Apache Parquet -- Hadoop ParquetInputFormat \u5217\u5f0f\u5b58\u50a8\uff0c\u6587\u4ef6\u4e2d\u5305\u62ec\u8be5\u6587\u4ef6\u7684\u6570\u636e\u548c\u5143\u6570\u636e\uff0cParquet\u652f\u6301\u5d4c\u5957\u7684\u6570\u636e\u6a21\u578b\u3002</p> </li> </ul>"},{"location":"data_system/1_data_organize/data_format/index.html#_2","title":"\u6570\u636e\u7f16\u7801\u65b9\u5f0f","text":"<p>\u89c1 \u7f16\u7801</p>"},{"location":"data_system/1_data_organize/data_format/index.html#_3","title":"\u6570\u636e\u538b\u7f29\u65b9\u5f0f","text":""},{"location":"data_system/1_data_organize/data_format/Decoding_SIMD-FastPFOR.html","title":"Decoding billions of integers per second through vectorization","text":"<p>TODO: </p>"},{"location":"data_system/1_data_organize/data_format/encoding.html","title":"\u5e38\u89c1\u7684\u7f16\u7801\u65b9\u5f0f","text":"<p>\u6709\u7b26\u53f7\u6574\u6570</p> <p>\u6b63\u6570 -&gt; \u8d1f\u6570 \uff1a\u53d6\u53cd\u540e\u52a01 \u6216 \u51cf1\u540e\u53d6\u53cd </p> <p>\u8d1f\u6570 -&gt; \u6b63\u6570 \uff1a\u51cf1\u540e\u53d6\u53cd \u6216 \u53d6\u53cd\u540e\u52a01</p> <pre><code># Byte \u4e3a\u4f8b\n+3 : 0000011\n-3 : 1111101\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/encoding.html#zigzag","title":"ZigZag","text":""},{"location":"data_system/1_data_organize/data_format/encoding.html#_2","title":"\u7f16\u7801","text":"<p>\u5728\u7f51\u7edc\u4f20\u8f93\u548c\u6570\u636e\u5b58\u50a8\u573a\u666f\u4e2d\uff0c\u9700\u8981\u5bf9\u6570\u636e\u8fdb\u884c\u538b\u7f29\u3002\u6570\u636e\u538b\u7f29\u7684\u7b97\u6cd5\u975e\u5e38\u591a\uff0c\u4f46\u5927\u90e8\u5206\u7684\u6570\u636e\u538b\u7f29\u7b97\u6cd5\u7684\u539f\u7406\u662f\u901a\u8fc7\u67d0\u79cd\u7f16\u7801\u65b9\u5f0f\u4e0d\u5b58\u50a8\u6570\u636e\u4e2d\u76840\u6bd4\u7279\u4f4d\uff0c\u56e0\u6b640\u6bd4\u7279\u4f4d\u8d8a\u591a\uff0c\u6570\u636e\u538b\u7f29\u7684\u6548\u679c\u8d8a\u597d\u3002ZigZag\u7f16\u7801\u5c31\u662f\u4e00\u79cd\u589e\u52a00\u6bd4\u4f8b\u4f4d\u7684\u7f16\u7801\u65b9\u5f0f\u3002</p> <pre><code># \u4ee5byte\uff088\u4f4d\uff09\u4e3a\u4f8b\nZigZag(n) = n&gt;&gt;7 ^ n&lt;&lt;1\n</code></pre> <p>ZigZag\u7684\u7f16\u7801\u540e\u7684\u6570\u636e\u4ee5\u65e0\u7b26\u53f7\u8868\u793a\uff0c\u5176\u6548\u679c\uff1a</p> <p>\u6b63\u6570\uff1a\u7b49\u4ef7\u4e8e\u4e58 2\uff08n&lt;&lt;1\uff09\uff0c\u65e0\u7b26\u53f7\u503c\u8868\u793a\u4e3a \\(|n| &lt;&lt; 2\\)</p> <p>\u8d1f\u6570\uff1a\u7b49\u4e8e ~(n &lt;&lt; 1)\uff0c\u65e0\u7b26\u53f7\u503c\u8868\u793a\u4e3a \\(|n| &lt;&lt; 2 + 1\\)</p> <p>-11\u7684\u5904\u7406\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li><code>11110101 &gt;&gt; 7 = 11111111</code></li> <li><code>11110101 &lt;&lt; 1 = 11101010</code></li> <li><code>11111111^11101010 = 00010101</code></li> </ol> <p>\u6b63\u6570\u7ecf\u8fc7\u5904\u7406\u540e\uff0c\u524d\u5bfc0\u548c\u540e\u7f6e0\u7684\u4e2a\u6570\u4e0d\u53d8\u3002\u4f46\u662f\u8d1f\u6570\u7ecf\u8fc7\u5904\u7406\u540e\uff0c\u589e\u52a0\u4e86\u4e09\u4e2a\u524d\u5bfc0\uff0c\u53ef\u4ee5\u7528\u4e8e\u538b\u7f29\u3002</p>"},{"location":"data_system/1_data_organize/data_format/encoding.html#_3","title":"\u89e3\u7801","text":"<pre><code>~ZigZag(n) = (n &gt;&gt;&gt; 1) ^ ~ (n &amp; 1)\n</code></pre> <p>-11\u7684ZigZag\u7f16\u7801<code>00010101</code>\u7684\u89e3\u7801\u8fc7\u7a0b\uff1a</p> <ol> <li>n&gt;&gt;&gt;1\uff1a<code>00001010</code></li> <li>~(n&amp;1): <code>11111110</code></li> <li><code>1111110 ^ 0000101=11110101</code></li> </ol>"},{"location":"data_system/1_data_organize/data_format/encoding.html#rle","title":"RLE(\u884c\u7a0b\u7f16\u7801)","text":"<p>\u9488\u5bf9\u8fde\u7eed\u91cd\u590d\u7684\u6570\u636e\uff0c\u8bb0\u5f55\u91cd\u590d\u6b21\u6570\u548c\u5bf9\u5e94\u7684\u503c\u3002</p> <p>\u793a\u4f8b</p> <pre><code>aaaaabbbcdeeeeeeef...\n=&gt; 5a3b1c1d7e1f...\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/encoding.html#uleb128","title":"ULEB128","text":"<p>Unsigned Little Endian Base 128</p> <p>\u6bcf\u4e2a\u5b57\u8282 = 1bit symbol+ 7bit data</p> <ul> <li>uleb128\u7f16\u7801\u7684\u6574\u5f62\u503c\uff0c\u662f\u4ee5\u5b57\u8282\u4e2d\u6700\u9ad8\u4f4d\u662f\u5426\u4e3a0\uff08symbol\u4f4d\uff09\u6765\u8868\u793a\u5b57\u8282\u6d41\u6709\u6ca1\u6709\u7ed3\u675f\u7684\u3002</li> <li>uleb128\u7f16\u7801\u7684\u6574\u5f62\u503c\uff0c\u5176\u5360\u7528\u7684\u5b57\u8282\u6570\u662f\u4e0d\u786e\u5b9a\u7684\uff0c\u957f\u5ea6\u6709\u53ef\u80fd\u57281\u52305\u4e2a\u5b57\u8282\u4e4b\u95f4\u53d8\u5316\uff1b</li> </ul> <p>\u7b2c\u4e00\u4e2a\u5b57\u8282\u4ee3\u8868\u7684\u662f\u6574\u5f62\u503c\u7684\u6700\u4f4e7\u6bd4\u7279\u4f4d\u7684\u503c\uff0c\u7b2c\u4e8c\u4e2a\u5b57\u8282\u4ee3\u8868\u6574\u578b\u503c\u7684\u6b21\u4f4e7\u6bd4\u7279\u4f4d\u7684\u503c\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u6700\u540e\u4e00\u4e2a\u5b57\u8282\uff08\u6700\u9ad8\u4f4d\u4e3a0\uff09\u4ee3\u8868\u6574\u5f62\u503c\u7684\u6700\u9ad87\u6bd4\u7279\u4f4d\u7684\u503c\u3002</p>"},{"location":"data_system/1_data_organize/data_format/encoding.html#differentialdelta-coding","title":"\u5dee\u5206/\u589e\u91cf\u7f16\u7801\uff08Differential/Delta Coding)","text":"<p>\u4fdd\u7559\u8fde\u7eed\u5143\u7d20\u4e4b\u95f4\u7684\u5dee\u5f02\u4ee5\u53ca\u521d\u59cb\u503c\uff0c\u5dee\u5f02\u6216\u589e\u91cf\u662f\u975e\u8d1f\u6574\u6570\uff0c\u901a\u5e38\u6bd4\u539f\u59cb\u6574\u6570\u5c0f\u5f97\u591a\uff0c \u56e0\u6b64\u5b83\u4eec\u53ef\u4ee5\u88ab\u66f4\u6709\u6548\u5730\u538b\u7f29\u3002</p> <ul> <li>\u7b2c\u4e00\u6b21\u8ba1\u7b97\u7684\u8d1f\u6570\u589e\u91cf\uff0c\u53ef\u4ee5\u901a\u8fc7\u6700\u5c0f\u8d1f\u6570\uff0c\u5c06\u5176\u8f6c\u6362\u4e3a\u6b63\u6570\uff0c\u89c1Parquet\u7684Delta Coding\uff1b</li> <li>\u968f\u673a\u8bbf\u95ee\u4f4d\u4e8e\u7ed9\u5b9a\u7d22\u5f15\u5904\u7684\u6574\u6570\u53ef\u80fd\u9700\u8981\u5bf9\u51e0\u4e2a\u589e\u91cf\u6c42\u548c\uff0c\u5c06\u5927\u578b\u6570\u7ec4\u5212\u5206\u4e3a\u8f83\u5c0f\u7684\u6570\u7ec4\u6765\u7f13\u89e3\u6b64\u95ee\u9898\u3002</li> </ul> <p>SIMD\uff0c\u5355\u6307\u4ee4\u591a\u6570\u636e\uff1b SSE2\uff0c\u5355\u6307\u4ee4\u591a\u6570\u636e\u6d41\u6280\u672f\u6269\u5c55 2\uff1b SSSE3\uff0c\u5355\u6307\u4ee4\u591a\u6570\u636e\u6d41\u6280\u672f\u6269\u5c55 3\u3002 </p> <p>\u4f7f\u7528\u57fa\u4e8e\u5355\u6307\u4ee4\u591a\u6570\u636e\uff08SIMD\uff09\u64cd\u4f5c\u7684\u4e13\u7528\u65b9\u6848\u538b\u7f29\u8fd9\u4e9b\u6574\u6570\u6570\u7ec4\u53ef\u80fd\u66f4\u53ef\u53d6\uff1b</p> <p>\u4f7f\u7528SIMD\u6307\u4ee4\u7684\u5411\u91cf\u5316\u524d\u7f00\u603b\u548c\u53ef\u4ee5\u5feb\u4e24\u500d\uff1b</p>"},{"location":"data_system/1_data_organize/data_format/hdf5.html","title":"HDF5","text":"<p>HDF \u662f Hierarchical Data Format\uff08\u5206\u5c42\u6570\u636e\u683c\u5f0f\uff09\u7684\u7f29\u5199\u3002</p> <p>\u4e00\u4e2aHDF5\u6587\u4ef6\u5c31\u662f\u4e00\u4e2a\u5bb9\u5668\uff0c\u7528\u4e8e\u50a8\u5b58\u4e24\u7c7b\u5bf9\u8c61\uff1a</p> <ul> <li> <p>datasets\uff0c\u7c7b\u4f3c\u4e8e\u6570\u7ec4\u7684\u6570\u636e\u96c6\u5408\uff1b</p> </li> <li> <p>groups\uff0c\u7c7b\u4f3c\u4e8e\u6587\u4ef6\u5939\u7684\u5bb9\u5668\uff0c\u53ef\u4ee5\u50a8\u5b58datasets\u548c\u5176\u5b83groups\u3002</p> </li> </ul> <p>Python\u91cc\u9762\u6709\u4e24\u4e2a\u5305\u90fd\u652f\u6301HDF5\u7684\u5f00\u53d1\uff0ch5py\u548cPyTables\uff1a</p> <p>groups\u7c7b\u4f3c\u4e8e\u5b57\u5178\uff08dictionaries\uff09\uff0cdataset\u7c7b\u4f3c\u4e8eNumpy\u4e2d\u7684\u6570\u7ec4\uff08arrays\uff09</p> <p>pandas\u5305\u4e2d\u6709DataFrame.to_hdf\u7684\u529f\u80fd\u3002</p>"},{"location":"data_system/1_data_organize/data_format/arrow/arrow.html","title":"Apache Arrow","text":"<p>\u6307\u5b9a\u4e86\u4e00\u79cd\u4e0e\u8bed\u8a00\u65e0\u5173\u7684\u6807\u51c6\u5316\u5217\u5f0f\u5b58\u50a8\u683c\u5f0f\uff0c\u652f\u6301\u5e73\u9762\uff08\u8868\u578b\uff09\u548c\u5c42\u6b21\u6570\u636e\u3002</p> <ul> <li>\u96f6\u62f7\u8d1d\u7684\u5171\u4eab\u5185\u5b58\u548c\u57fa\u4e8eRPC\u7684\u6570\u636e\u79fb\u52a8\uff1b</li> <li>\u652f\u6301\u8bfb/\u5199\u6587\u4ef6\u683c\u5f0f\uff08\u5982CSV\uff0cORC \u548c Parquet\uff09\uff1b</li> <li>\u57fa\u4e8e\u5185\u5b58\u7684\u5206\u6790\u548c\u67e5\u8be2\u5904\u7406\uff1b</li> </ul> <p></p>"},{"location":"data_system/1_data_organize/data_format/arrow/arrow.html#format","title":"Format","text":"<p>\u5185\u5b58\u4e2d\u6570\u636e\u7ed3\u6784\u89c4\u8303\uff0c\u5143\u6570\u636e\u5e8f\u5217\u5316\u4ee5\u53ca\u7528\u4e8e\u5e8f\u5217\u5316\u548c\u901a\u7528\u6570\u636e\u4f20\u8f93\u7684\u534f\u8bae\u3002</p> <p>\u5229\u7528Google\u7684Flatbuffers\u9879\u76ee\u8fdb\u884c\u5143\u6570\u636e\u5e8f\u5217\u5316</p> <p>\u5217\u5f0f\u683c\u5f0f\u5177\u6709\u4e00\u4e9b\u5173\u952e\u529f\u80fd\uff1a</p> <ul> <li>\u987a\u5e8f\u8bbf\u95ee\uff08\u626b\u63cf\uff09\u7684\u90bb\u63a5\u7684\u6570\u636e</li> <li>O(1)\uff08\u6052\u5b9a\u65f6\u95f4\uff09\u968f\u673a\u8bbf\u95ee</li> <li>SIMD\u548c\u77e2\u91cf\u5316\u53cb\u597d</li> <li>\u53ef\u91cd\u5b9a\u4f4d\u800c\u65e0\u9700\u201c\u6307\u9488\u6df7\u4e71\u201d\uff0c\u4ece\u800c\u5141\u8bb8\u5728\u5171\u4eab\u5185\u5b58\u4e2d\u8fdb\u884c\u771f\u6b63\u7684\u96f6\u62f7\u8d1d\u8bbf\u95ee</li> </ul>"},{"location":"data_system/1_data_organize/data_format/arrow/arrow.html#array","title":"Array","text":"<p>\u7531\u5143\u6570\u636e\u548c\u6570\u636e\u5b9a\u4e49\uff1a</p> <ul> <li>\u903b\u8f91\u6570\u636e\u7c7b\u578b\uff1b</li> <li>\u7f13\u51b2\u533a\u5e8f\u5217\uff1b</li> <li>\u957f\u5ea6\u4e3a64\u4f4d\u6709\u7b26\u53f7\u6574\u6570\u3002\u5141\u8bb8\u5c06\u5b9e\u73b0\u9650\u5236\u4e3a32\u4f4d\uff1b</li> <li>null\u7684\u6570\u76ee\u4f5c\u4e3a64\u4f4d\u6709\u7b26\u53f7\u6574\u6570\u3002</li> <li>\u53ef\u9009\u7684dictionary\uff0c\u7528\u4e8e\u5b57\u5178\u7f16\u7801\u7684\u6570\u7ec4\u3002</li> </ul>"},{"location":"data_system/1_data_organize/data_format/arrow/arrow.html#todo","title":"TODO\uff1a\u6bcf\u79cd\u7c7b\u578b\u7684\u5185\u5b58\u5e03\u5c40","text":""},{"location":"data_system/1_data_organize/data_format/arrow/arrow.html#ipc","title":"IPC","text":"<p>\u5217\u683c\u5f0f\u7684\u5e8f\u5217\u5316\u6570\u636e\u7684\u539f\u59cb\u5355\u4f4d\u662f\u201c\u6279\u8bb0\u5f55\u201d\uff08record batch)\u3002</p> <p>\u5b9a\u4e49\u534f\u8bae\uff0c\u7528\u4e8e\u5c06\u8bb0\u5f55\u6279\u5904\u7406\u5e8f\u5217\u5316\u4e3a\u4e8c\u8fdb\u5236\u6709\u6548\u8d1f\u8f7d\u6d41\uff0c\u5e76\u4ece\u8fd9\u4e9b\u6709\u6548\u8d1f\u8f7d\u4e2d\u91cd\u5efa\u8bb0\u5f55\u6279\u5904\u7406\u800c\u65e0\u9700\u8fdb\u884c\u5185\u5b58\u590d\u5236\u3002</p>"},{"location":"data_system/1_data_organize/data_format/arrow/pyarrow.html","title":"Pyarrow","text":""},{"location":"data_system/1_data_organize/data_format/arrow/pyarrow.html#hdfs","title":"HDFS","text":"<p>\u73af\u5883\u914d\u7f6e</p> <ul> <li> <p><code>HADOOP_HOME</code>: the root of your installed Hadoop distribution. Often has lib/native/libhdfs.so.</p> </li> <li> <p><code>JAVA_HOME</code>: the location of your Java SDK installation.</p> </li> <li> <p><code>ARROW_LIBHDFS_DIR</code> (optional): explicit location of <code>libhdfs.so</code> if it is installed somewhere other than <code>$HADOOP_HOME/lib/native</code>.</p> </li> <li> <p><code>CLASSPATH</code>: must contain the Hadoop jars. You can set these using:</p> </li> </ul> <pre><code>export CLASSPATH=`$HADOOP_HOME/bin/hdfs classpath --glob`\n</code></pre> <p>If <code>CLASSPATH</code> is not set, then it will be set automatically if the <code>hadoop</code> executable is in your system path, or if <code>HADOOP_HOME</code> is set.</p> <p>\u5982\u679c\u8bbe\u7f6e<code>HADOOP_HOME</code>\uff0c\u5219 linux\u4e0a\u4f1a\u6267\u884c <code>find -L $HADOOP_HOME -name *.jar</code>\uff0cfind\u7684\u7ed3\u679c\u7684\u987a\u5e8f\u662f\u4e0d\u786e\u5b9a\u7684\uff1b</p> <p>\u5982\u679c\u6ca1\u8bbe\u7f6e<code>HADOOP_HOME</code>\uff0c\u5219\u901a\u8fc7<code>hadoop classpath --glob</code>\u641c\u7d22\uff1b</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html","title":"Apache CarbonData","text":"<p>\u7d22\u5f15\u7684\u5217\u5f0f\u5b58\u50a8\u683c\u5f0f\uff0c\u7528\u4e8e\u5927\u6570\u636e\u7cfb\u7edfHadoop\u3001Spark\u5206\u6790\u3002</p> <ul> <li>\u6570\u636e\u5e26\u7d22\u5f15\uff1a\u5f53\u6709\u8fc7\u6ee4\u6761\u4ef6\u65f6\uff0c\u51cf\u5c11IO\u626b\u63cf\u548cCPU\u8d44\u6e90\uff1b</li> <li>\u6570\u636e\u7f16\u7801\u548c\u538b\u7f29\uff1a\u53ef\u4ee5\u76f4\u63a5\u67e5\u8be2\u538b\u7f29/\u7f16\u7801\u540e\u7684\u6570\u636e\uff1b</li> <li>\u652f\u6301\u66f4\u65b0\u548c\u5220\u9664\u64cd\u4f5c\uff1b</li> <li>\u652f\u6301\u591a\u6837\u7684\u5206\u6790\uff1aOLAP\u4ea4\u4e92\u5f0f\u3001\u5927\u8303\u56f4\u626b\u63cf\uff08\u987a\u5e8f\u8bfb\uff09\u548c\u5c0f\u8303\u56f4\u626b\u63cf\uff08\u968f\u673a\u8bfb\uff09</li> </ul> <p>\u76ee\u524d\u96c6\u6210\u7684\u7cfb\u7edf\u6709Hive\u3001Spark\u3001Presto \u548c Alluxio\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#_1","title":"\u8868\u7ba1\u7406","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#ddlcreate-alter-drop-ctas","title":"DDL(Create, Alter, Drop, CTAS)","text":"<p>CarbonData\u63d0\u4f9b\u5355\u72ec\u7684DDL\u6765\u521b\u5efa\u548c\u7ba1\u7406carbondata \u8868\u3002DDL\u9002\u914dHive\u3001SparkSQL\uff0c\u5e76\u652f\u6301\u5176\u4ed6\u5c5e\u6027\u548c\u683c\u5f0f\u6765\u5145\u5206\u5229\u7528carbondata\u529f\u80fd\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#dmlload-insert","title":"DML(Load, Insert)","text":"<p>\u6570\u636e\u7ba1\u7406</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#update-delete","title":"Update &amp; Delete","text":"<p>\u7c7b\u4f3cHive\u7684IUD\u7684\u8bed\u6cd5</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#segment-management","title":"Segment Management","text":"<p>\u7ba1\u7406\u8868\u7684\u589e\u91cf\u8d1f\u8f7d\uff0c\u53ef\u4ee5\u4e3a\u6b63\u5728\u6267\u884c\u7684\u64cd\u4f5c\u63d0\u4f9b\u4e8b\u52a1\u5904\u7406\u80fd\u529b\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#partition","title":"Partition","text":"<ul> <li>\u652f\u6301\u7c7b\u4f3cHive\u7684\u5206\u533a\uff1b</li> <li>\u652f\u6301hash\uff0clist\uff0crange \u5206\u533a\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#compaction","title":"Compaction","text":"<p>CarbonData\u5c06\u589e\u91cf\u8d1f\u8f7d\u4f5c\u4e3aSegment\u8fdb\u884c\u7ba1\u7406\u3002\u538b\u7f29\u6709\u52a9\u4e8e\u538b\u7f29\u4e0d\u65ad\u589e\u957f\u7684\u6bb5\u6570\uff0c\u4e5f\u4f1a\u63d0\u5347\u67e5\u8be2\u8fc7\u6ee4\u5668\u4fee\u526a\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#external-tables","title":"External Tables","text":"<p>CarbonData\u53ef\u4ee5\u8bfb\u53d6\u4efb\u4f55CarbonData\u6587\u4ef6\uff0c\u5e76\u81ea\u52a8\u4ece\u8be5\u6587\u4ef6\u63a8\u65ad\u6a21\u5f0f\uff0c\u5e76\u63d0\u4f9b\u4e00\u4e2a\u5173\u7cfb\u8868\u89c6\u56fe\uff0c\u4ee5\u4fbf\u4f7f\u7528Spark\u6216\u4efb\u4f55\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u6267\u884csql\u67e5\u8be2\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#datamaps","title":"DataMaps","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#pre-aggregate","title":"Pre-Aggregate","text":"<p>CarbonData\u5c06\u81ea\u52a8\u9884\u805a\u5408\u589e\u91cf\u6570\u636e\u5e76\u91cd\u65b0\u7f16\u5199\u67e5\u8be2\uff0c\u4ee5\u4fbf\u81ea\u52a8\u4ece\u6700\u5408\u9002\u7684\u9884\u805a\u5408\u8868\u4e2d\u63d0\u53d6\u6570\u636e\uff0c\u4ee5\u66f4\u5feb\u5730\u4e3a\u67e5\u8be2\u670d\u52a1\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#time-series","title":"Time Series","text":"<p>\u65f6\u95f4\u5e8f\u5217\u662f\u4e00\u4e2a\u9884\u805a\u5408\u8868\uff0c\u5b83\u53ef\u4ee5\u5728\u589e\u91cf\u52a0\u8f7d\u671f\u95f4\u81ea\u52a8\u5c06\u6570\u636e\u6c47\u603b\u5230\u6240\u9700\u7684\u7ea7\u522b\uff0c\u5e76\u4ece\u6700\u5408\u9002\u7684\u9884\u805a\u5408\u8868\u63d0\u4f9b\u67e5\u8be2\u670d\u52a1\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#bloom-filter","title":"Bloom filter","text":"<p>CarbonData\u652f\u6301bloom filter\u4f5c\u4e3a\u6570\u636e\u6620\u5c04\uff0c\u4ee5\u4fbf\u5feb\u901f\u6709\u6548\u5730\u4fee\u526a\u6570\u636e\u4ee5\u8fdb\u884c\u626b\u63cf\u5e76\u83b7\u5f97\u66f4\u5feb\u7684\u67e5\u8be2\u6027\u80fd\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#lucene","title":"Lucene","text":"<p>CarbonData\u63d0\u4f9bLucene\u6570\u636e\u6620\u5c04\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u4f7f\u7528Lucene\u7d22\u5f15\u6587\u672c\u5217\uff0c\u5e76\u4f7f\u7528\u7d22\u5f15\u7ed3\u679c\u5728\u67e5\u8be2\u671f\u95f4\u6709\u6548\u5730\u4fee\u526a\u8981\u68c0\u7d22\u7684\u6570\u636e\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#mvmaterialized-views","title":"MV(Materialized Views)","text":"<p>MVs\u662f\u4e00\u79cd\u652f\u6301\u9ad8\u6548\u67e5\u8be2\u91cd\u5199\u548c\u5904\u7406\u7684\u9884\u805a\u5408\u8868\uff0cCarbonData\u63d0\u4f9b\u4e86MV\uff0c\u5b83\u53ef\u4ee5\u91cd\u5199\u67e5\u8be2\u4ee5\u4ece\u4efb\u4f55\u8868\uff08\u5305\u62ec\u975eCarbonData\u8868\uff09\u4e2d\u83b7\u53d6\u6570\u636e\u3002\u5178\u578b\u7684\u7528\u4f8b\u662f\u5c06\u975ecarbondata\u4e8b\u5b9e\u8868\u7684\u805a\u5408\u6570\u636e\u5b58\u50a8\u5230carbondata\u4e2d\uff0c\u5e76\u4f7f\u7528mv\u91cd\u5199\u67e5\u8be2\u4ee5\u4ececarbondata\u83b7\u53d6\u6570\u636e\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#streaming","title":"Streaming","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#spark-streaming","title":"Spark Streaming","text":"<p>CarbonData\u652f\u6301\u8fd1\u4e4e\u5b9e\u65f6\u5730\u5c06\u6570\u636e\u6d41\u4f20\u8f93\u5230CarbonData\u4e2d\uff0c\u5e76\u4f7f\u5176\u7acb\u5373\u53ef\u4f9b\u67e5\u8be2\u3002CarbonData\u63d0\u4f9bDSL\uff0c\u53ef\u4ee5\u8f7b\u677e\u521b\u5efa\u6e90\u8868\u548c\u6c47\u8868\uff0c\u800c\u65e0\u9700\u7528\u6237\u7f16\u5199\u5e94\u7528\u7a0b\u5e8f\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#_2","title":"\u6570\u636e\u7c7b\u578b","text":"<p>CarbonData \u652f\u6301\u4ee5\u4e0b\u7684\u6570\u636e\u7c7b\u578b:</p> <ul> <li> <p>\u6570\u5b57\u7c7b\u578b</p> </li> <li> <p>SMALLINT</p> </li> <li>INT/INTEGER</li> <li>BIGINT</li> <li>DOUBLE</li> <li>DECIMAL</li> <li>FLOAT</li> <li>BYTE</li> </ul> <p>NOTE: Float and Bytes are only supported for SDK and FileFormat.</p> <ul> <li> <p>\u65f6\u95f4\u65e5\u671f\u7c7b\u578b</p> </li> <li> <p>TIMESTAMP</p> </li> <li> <p>DATE</p> </li> <li> <p>\u5b57\u7b26\u4e32\u7c7b\u578b</p> </li> <li> <p>STRING</p> </li> <li>CHAR</li> <li> <p>VARCHAR</p> </li> <li> <p>\u590d\u6742\u7c7b\u578b</p> </li> <li> <p>arrays: ARRAY<code>&lt;data_type&gt;</code></p> </li> <li>structs: STRUCT<code>&lt;col_name : data_type COMMENT col_comment, ...&gt;</code></li> <li>maps: MAP<code>&lt;primitive_type, data_type&gt;</code></li> </ul> <p>\u6ce8\u610f: \u76ee\u524d\u4ec5\u652f\u6301 2 \u7ea7\u590d\u6742\u7c7b\u578b\u6a21\u5f0f</p> <ul> <li> <p>\u5176\u4ed6\u7c7b\u578b</p> </li> <li> <p>BOOLEAN</p> </li> <li>BINARAY</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#_3","title":"\u6587\u4ef6\u683c\u5f0f","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#_4","title":"\u6587\u4ef6\u76ee\u5f55\u7ed3\u6784","text":"<p>carbondata\u7684\u6570\u636e\u5b58\u50a8\u8def\u5f84\uff0c${carbon.storelocation}</p> <p></p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#_5","title":"\u6570\u636e\u6587\u4ef6\u683c\u5f0f","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#file-header","title":"File Header","text":"<p>\u5305\u542b\u6587\u4ef6\u7248\u672c\u4fe1\u606f\uff0c\u5217\u7684schema\u4fe1\u606f\u548cschema\u66f4\u65b0\u7684\u65f6\u95f4\u6233\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#blocklet-format","title":"Blocklet format","text":"<p>\u6587\u4ef6\u5305\u542b\u591a\u4e2aBlocklet + 1\u4e2aFileFooter</p> <p>Blocklet\uff1a\u6570\u636e\u96c6\uff0c\u9ed8\u8ba464MB\u3002\u5bf9\u6bcf\u4e2a\u5217\u5305\u542b\u4e00\u4e2aColumnChunk\uff0c\u6bcf\u4e2aColumnChunk\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u5217\u9875\uff1b</p> <p></p> <p>\u6bcf\u4e2aColumnChunk\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2aColumn Page\uff0c\u5e76\u4e14ColumnPage\u5305\u542bBlockletMinMaxIndex\u3002</p> <p></p> <ul> <li>Data Page: \u5305\u542b\u5217\u7684\u7f16\u7801\u6570\u636e\u3002</li> <li>Row ID Page (\u53ef\u9009): \u5305\u542b\u884c ID \u7684\u6620\u5c04\u4fe1\u606f\uff0c\u5f53\u6570\u636e\u9875\u9762\u88ab\u5b58\u50a8\u4e3a\u5012\u6392\u7d22\u5f15\u65f6\u4f7f\u7528\u3002</li> <li>RLE Page (\u53ef\u9009): \u5305\u542b\u4e00\u4e9b\u989d\u5916\u7684\u5143\u6570\u636e\uff0c\u5f53\u6570\u636e\u9875\u9762\u4f7f\u7528 RLE \u7f16\u7801\u65f6\u4f7f\u7528\u3002</li> </ul> <p>Footer\u683c\u5f0f</p> <p></p> <ul> <li> <p>BlockletInfo3 \u8bb0\u5f55\u6240\u6709\u7684 ColumnChunk3 \u7684\u504f\u79fb\u91cf\u548c\u957f\u5ea6\uff1b</p> </li> <li> <p>SegmentInfo\u8bb0\u5f55\u5217\u7684\u6570\u76ee\u548c\u6bcf\u5217\u7684\u57fa\u6570\uff1b</p> </li> <li>BlockletIndex\u5305\u542bMinMaxIndex\u548cBTreeIndex\u3002</li> <li>MinMaxIndex\u8bb0\u5f55blocklet\u4e2d\u6bcf\u5217\u7684\u6700\u5c0f\u3001\u6700\u5927\u503c\uff1b</li> <li>BTreeIndex\u8bb0\u5f55\u6bcf\u4e2ablocklet\u7684\u8d77\u59cb/\u7ed3\u675f\u503c\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#_6","title":"\u7d22\u5f15\u6587\u4ef6\u683c\u5f0f","text":"<p>\u89e3\u6790FileFooter\u4e2d\u7684BlockletIndex\u90e8\u5206\uff0c\u751f\u6210index\u6587\u4ef6\u3002</p> <p></p> <p>BlockIndex\u5bf9\u8c61\u8bb0\u5f55\u4e0e\u5757\u5bf9\u5e94\u7684\u7d22\u5f15\u4fe1\u606f\uff0c\u5305\u62eccarbondata\u6587\u4ef6\u540d\u3001footer\u504f\u79fb\u91cf\u548cBlockletIndex\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#_7","title":"\u8bcd\u5178\u6587\u4ef6\u683c\u5f0f","text":"<ul> <li>\u8bcd\u5178\u6587\u4ef6\u8bb0\u5f55\u5217\u7684\u4e0d\u540c\u503c\u7684\u5217\u8868\uff1b</li> <li>\u8bcd\u5178\u5143\u6570\u636e\u6587\u4ef6\u8bb0\u5f55\u6bcf\u4e2a\u6570\u636e\u52a0\u8f7d\u7684\u65b0\u7684\u4e0d\u540c\u503c\u7684\u5143\u6570\u636e\u63cf\u8ff0\uff1b</li> <li>sortindex\u6587\u4ef6\u8bb0\u5f55\u6309\u503c\u6392\u5e8f\u7684\u5b57\u5178\u4ee3\u7801\u7684\u952e\u4ee3\u7801\u7684\u7ed3\u679c\u96c6\u3002</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/carbondata.html#tablestatus","title":"tablestatus\u6587\u4ef6\u683c\u5f0f","text":"<p>Tablestatus\u8bb0\u5f55\u6bcf\u6b21\u52a0\u8f7d\u548c\u5408\u5e76\u7684\u6bb5\u76f8\u5173\u4fe1\u606f\uff08gson\u683c\u5f0f\uff09\uff0c\u5305\u62ec\u52a0\u8f7d\u65f6\u95f4\u3001\u52a0\u8f7d\u72b6\u6001\u3001\u6bb5\u540d\u79f0\u3001\u662f\u5426\u5220\u9664\u4ee5\u53ca\u5408\u5e76\u7684\u6bb5\u540d\u79f0\u3002\u6bcf\u6b21\u52a0\u8f7d\u6216\u5408\u5e76\u540e\u91cd\u65b0\u751f\u6210\u8868\u72b6\u6001\u6587\u4ef6\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/conf.html","title":"Conf","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/conf.html#_1","title":"\u914d\u7f6e","text":"<p>\u8be6\u7ec6\u89c1\uff1ahttp://carbondata.apache.org/configuration-parameters.html\u3002</p> <p>\u8fd9\u91cc\u4ec5\u5217\u51fa\u6765\u5e38\u7528\u7684\u914d\u7f6e\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/conf.html#_2","title":"\u7cfb\u7edf\u914d\u7f6e","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/conf.html#_3","title":"\u6570\u636e\u52a0\u8f7d\u914d\u7f6e","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/conf.html#_4","title":"\u538b\u7f29\u914d\u7f6e","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/conf.html#_5","title":"\u67e5\u8be2\u914d\u7f6e","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/conf.html#_6","title":"\u6570\u636e\u6539\u52a8\u914d\u7f6e","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/conf.html#_7","title":"\u52a8\u6001\u914d\u7f6e","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/datamaps.html","title":"Datamaps","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/datamaps.html#datamaps","title":"DataMaps","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/datamaps.html#overview","title":"Overview","text":"<pre><code>CREATE DATAMAP [IF NOT EXISTS] datamap_name\n[ON TABLE main_table]\nUSING \"datamap_provider\"\n[WITH DEFERRED REBUILD]\nDMPROPERTIES ('key'='value', ...)\nAS\n  SELECT statement\n</code></pre> DataMap Provider Description DMPROPERTIES Management preaggregate \u5355\u8868\u9884\u805a\u5408\u8868 No DMPROPERTY is required Automatic timeseries \u65f6\u95f4\u7ef4\u5ea6\u6c47\u603b\u8868 event_time, xx_granularity, please refer to Timeseries DataMap Automatic mv \u591a\u8868\u9884\u805a\u5408\u8868 No DMPROPERTY is required Manual/Automatic lucene lucene \u6587\u672c\u5217\u7d22\u5f15 index_columns to specifying the index columns Automatic bloomfilter bloom filter \u5bf9\u9ad8\u57fa\u6570\u5217\u548c\u7a7a\u95f4\u4f4d\u7f6e\u5217 index_columns to specifying the index columns Automatic"},{"location":"data_system/1_data_organize/data_format/carbondata/datamaps.html#datamap-management","title":"DataMap Management","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/datamaps.html#_1","title":"\u81ea\u52a8\u5237\u65b0","text":"<p>\u4e0d\u4f7f\u7528<code>WITH DEFERRED REBUILD</code>\u8bed\u6cd5\u7684\u60c5\u51b5\u4e0b\u5728\u4e3b\u8868\u4e0a\u521b\u5efa\u6570\u636e\u6620\u5c04\u65f6\u3002\u6bcf\u6b21\u5411\u4e3b\u8868\u52a0\u8f7d\u6570\u636e\uff0c\u7cfb\u7edf\u90fd\u4f1a\u7acb\u5373\u81ea\u52a8\u89e6\u53d1\u5bf9\u6570\u636e\u6620\u5c04\u7684\u52a0\u8f7d\u3002\u8fd9\u4e24\u79cd\u6570\u636e\u52a0\u8f7d\uff08\u5230\u4e3b\u8868\u548c\u6570\u636e\u6620\u5c04\uff09\u4ee5\u4e8b\u52a1\u65b9\u5f0f\u6267\u884c\u3002</p> <p>\u6839\u636eSegment\u6982\u5ff5\uff0c\u5c06\u6570\u636e\u52a0\u8f7d\u5230\u6570\u636e\u6620\u5c04\u662f\u589e\u91cf\u7684\uff0c\u4ece\u800c\u907f\u514d\u4e86\u6602\u8d35\u7684\u603b\u91cd\u5efa\u8d39\u7528\u3002</p> <p>\u5982\u679c\u7528\u6237\u5728\u4e3b\u8868\u4e0a\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u7cfb\u7edf\u5c06\u8fd4\u56de\u5931\u8d25\u3002\uff08\u62d2\u7edd\u64cd\u4f5c\uff09</p> <ol> <li>\u6570\u636e\u7ba1\u7406\u547d\u4ee4\uff1a<code>UPDATE/DELETE/DELETE SEGMENT</code>\u3002</li> <li>Schema\u7ba1\u7406\u547d\u4ee4\uff1a<code>ALTER TABLE DROP COLUMN</code>\uff0c<code>ALTER TABLE CHANGE DATATYPE</code>\uff0c <code>ALTER TABLE RENAME</code>\u3002\u8bf7\u6ce8\u610f\uff0c\u652f\u6301\u6dfb\u52a0\u65b0\u5217\uff0c\u5bf9\u4e8e\u5220\u9664\u5217\u548c\u66f4\u6539\u6570\u636e\u7c7b\u578b\u547d\u4ee4\uff0cCarbonData\u5c06\u68c0\u67e5\u5b83\u662f\u5426\u4f1a\u5f71\u54cd\u9884\u805a\u5408\u8868\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5219\u5141\u8bb8\u8be5\u64cd\u4f5c\uff0c\u5426\u5219\u5c06\u629b\u51fa\u5f02\u5e38\u800c\u62d2\u7edd\u8be5\u64cd\u4f5c\u3002</li> <li>\u5206\u533a\u7ba1\u7406\u547d\u4ee4\uff1a<code>ALTER TABLE ADD/DROP PARTITION</code>\u3002</li> </ol> <p>\u5982\u679c\u7528\u6237\u786e\u5b9e\u8981\u5728\u4e3b\u8868\u4e0a\u6267\u884c\u4e0a\u8ff0\u64cd\u4f5c\uff0c\u5219\u53ef\u4ee5\u5148\u5220\u9664\u6570\u636e\u56fe\uff0c\u6267\u884c\u8be5\u64cd\u4f5c\uff0c\u7136\u540e\u518d\u6b21\u91cd\u65b0\u521b\u5efa\u6570\u636e\u56fe\u3002</p> <p>\u5982\u679c\u7528\u6237\u5220\u9664\u4e3b\u8868\uff0c\u5219\u6570\u636e\u6620\u5c04\u4e5f\u5c06\u7acb\u5373\u5220\u9664\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/datamaps.html#_2","title":"\u624b\u52a8\u5237\u65b0","text":"<p>\u7528\u6237\u53d1\u51fa<code>REBUILD DATAMAP</code>\u547d\u4ee4\u6765\u6784\u5efa\u8be5\u6570\u636e\u6620\u5c04\u4e4b\u524d\uff0c\u67e5\u8be2\u5c06\u4e0d\u4f1a\u4f7f\u7528\u8be5\u6570\u636e\u6620\u5c04\u3002\u5bf9\u4e8e\u6bcf\u4e2aREBUILD DATAMAP\u547d\u4ee4\uff0c\u7cfb\u7edf\u5c06\u89e6\u53d1\u5bf9\u6570\u636e\u6620\u5c04\u7684\u5b8c\u5168\u91cd\u5efa\u3002\u91cd\u5efa\u5b8c\u6210\u540e\uff0c\u7cfb\u7edf\u4f1a\u5c06datamap\u72b6\u6001\u66f4\u6539\u4e3aenabled\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u5728\u67e5\u8be2\u91cd\u5199\u4e2d\u4f7f\u7528\u5b83\u3002</p> <p>\u5bf9\u4e8e\u6bcf\u4e2a\u65b0\u7684\u6570\u636e\u52a0\u8f7d\u3001\u6570\u636e\u66f4\u65b0\u3001\u5220\u9664\uff0c\u5c06\u7981\u7528\u76f8\u5173\u7684\u6570\u636e\u6620\u5c04\uff0c\u8fd9\u610f\u5473\u7740\u5728\u518d\u6b21\u542f\u7528\u8be5\u6570\u636e\u6620\u5c04\u4e4b\u524d\uff0c\u4ee5\u4e0b\u67e5\u8be2\u5c06\u65e0\u6cd5\u4ece\u8be5\u6570\u636e\u6620\u5c04\u4e2d\u53d7\u76ca\u3002</p> <p>\u5982\u679c\u7528\u6237\u5220\u9664\u4e86\u4e3b\u8868\uff0c\u5219\u76f8\u5173\u7684\u6570\u636e\u6620\u5c04\u5c06\u7acb\u5373\u88ab\u5220\u9664\u3002</p> <p>\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ul> <li>\u5982\u679c\u8981\u5728\u5916\u90e8\u8868\u4e0a\u521b\u5efa\u6570\u636e\u6620\u5c04\uff0c\u5219\u9700\u8981\u5bf9\u6570\u636e\u6620\u5c04\u8fdb\u884c\u624b\u52a8\u7ba1\u7406\u3002</li> <li>\u5bf9\u4e8e\u8bf8\u5982BloomFilter\u6570\u636e\u6620\u5c04\u4e4b\u7c7b\u7684\u7d22\u5f15\u6570\u636e\u6620\u5c04\uff0c\u65e0\u9700\u8fdb\u884c\u624b\u52a8\u5237\u65b0\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5b83\u662f\u81ea\u52a8\u5237\u65b0\u7684\uff0c\u8fd9\u610f\u5473\u7740\u5728\u521b\u5efa\u6570\u636e\u6620\u5c04\u8868\u6216\u52a0\u8f7d\u4e3b\u8868\u540e\uff0c\u5176\u6570\u636e\u5c06\u7acb\u5373\u5237\u65b0\u3002\u624b\u52a8\u5237\u65b0\u6b64\u6570\u636e\u56fe\u4e0d\u4f1a\u4ea7\u751f\u4efb\u4f55\u5f71\u54cd</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/datamaps.html#datamap","title":"DataMap\u76ee\u5f55","text":"<p>\u5f53\u7528\u6237\u521b\u5efa\u6570\u636e\u6620\u5c04\u65f6\uff0c\u7cfb\u7edf\u4f1a\u5c06\u6570\u636e\u6620\u5c04\u5143\u6570\u636e\u5b58\u50a8\u5728HDFS\uff08\u53ef\u914d\u7f6e\uff09\u4e2d\u3002</p> <ul> <li> <p>DataMapSchema\u6587\u4ef6\u3002\u5b83\u662f\u4e00\u4e2ajson\u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e2a\u6570\u636e\u6620\u5c04\u7684schema\uff1b</p> </li> <li> <p>DataMapStatus\u6587\u4ef6\u3002\u53ea\u6709\u4e00\u4e2a\u6587\u4ef6\uff0cjson\u683c\u5f0f\uff0c\u5e76\u4e14\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e2a\u6761\u76ee\u4ee3\u8868\u4e00\u4e2a\u6570\u636e\u6620\u5c04\u3002</p> </li> </ul> <p>DataMapCatalog\u63a5\u53e3\u53ef\u4ee5\u83b7\u53d6\u6240\u6709datamap\u7684schema\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/datamaps.html#datamap_1","title":"DataMap\u76f8\u5173\u547d\u4ee4","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/datamaps.html#explain","title":"Explain","text":"<p>\u7528\u6237\u53ef\u4ee5\u8bbe\u7f6e<code>enable.query.statistics = true</code>\u5e76\u4f7f\u7528EXPLAIN\u547d\u4ee4\u77e5\u9053\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/datamaps.html#show-datamap","title":"Show DataMap","text":"<p>\u547d\u4ee4\uff1aSHOW DATAMAPS\uff0c\u663e\u793a\u4e00\u4e0b\u4fe1\u606f</p> <ul> <li>DataMapName</li> <li>DataMapProviderName\uff0c\u4f8b\u5982mv\uff0cpreaggreagte\uff0ctimeseries\u7b49</li> <li>\u5173\u8054\u8868</li> <li>DataMap\u5c5e\u6027</li> <li>DataMap\u72b6\u6001\uff08\u542f\u7528/\u7981\u7528\uff09</li> <li>\u540c\u6b65\u72b6\u6001-\u663e\u793a\u4e0e\u6570\u636e\u6620\u5c04\u8868\u540c\u6b65\u7684\u4e3b\u8868\u7684\u6700\u540e\u4e00\u4e2a\u6bb5ID\u53ca\u5176\u52a0\u8f7d\u7ed3\u675f\u65f6\u95f4\uff08\u4ec5\u9002\u7528\u4e8emv\u6570\u636e\u6620\u5c04\uff09</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/datamaps.html#datamap_2","title":"\u5728DataMap\u4e0a\u538b\u7f29","text":"<p>\u4ec5\u9002\u7528\u4e8e\u9884\u805a\u5408\u6570\u636e\u6620\u5c04\uff08preaggregate\uff09\u3002</p> <p><code>ALTER TABLE COMPACT</code>\u5728\u4e3b\u8868\u4e0a\u8fd0\u884c\u538b\u7f29\u547d\u4ee4\u4e0d\u4f1a\u81ea\u52a8\u538b\u7f29\u5728\u4e3b\u8868\u4e0a\u521b\u5efa\u7684\u9884\u805a\u5408\u8868\u3002\u7528\u6237\u9700\u8981\u5728\u6bcf\u4e2a\u9884\u805a\u5408\u8868\u4e0a\u5206\u522b\u8fd0\u884cCompaction\u547d\u4ee4\u4ee5\u5bf9\u5176\u8fdb\u884c\u538b\u7f29\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/datamaps.html#preaggregate","title":"PreAggregate","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/datamaps.html#time","title":"Time","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/datamaps.html#mv","title":"MV","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/datamaps.html#bloomfilter","title":"BloomFilter","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html","title":"Ddl","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#carbondata","title":"CarbonData\u6570\u636e\u5b9a\u4e49\u8bed\u8a00","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#create-table","title":"Create Table","text":"<pre><code>CREATE TABLE [IF NOT EXISTS] [db_name.]table_name[(col_name data_type , ...)]\nSTORED AS carbondata\n[TBLPROPERTIES (property_name=property_value, ...)]\n[LOCATION 'path']\n</code></pre> <p>TBLPROPERTIES \u7684\u914d\u7f6e\u5982\u4e0b</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_1","title":"\u5168\u5c40\u5b57\u5178\u914d\u7f6e","text":"<ul> <li> <p>DICTIONARY_INCLUDE\uff1a\u9ed8\u8ba4\u5217\u4e0d\u5f00\u542f\u8bcd\u5178\u7f16\u7801\uff1b</p> </li> <li> <p>\u4e0d\u652f\u6301 Binary \u7c7b\u578b\u548c\u590d\u6742\u7684\u5b50\u5217\uff1b</p> </li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_2","title":"\u672c\u5730\u5b57\u5178\u914d\u7f6e","text":"<ul> <li>LOCAL_DICTIONARY_ENABLE\uff1a\u9ed8\u8ba4true\uff0c\u8986\u76d6\"carbon.local.dictionary.enable\"\uff0c\u9ed8\u8ba4\u4f1a\u5bf9\u6240\u6709\u7684String/Varchar/Char\u7c7b\u578b\u5217\u6784\u5efa\u8bcd\u5178\uff08\u9664\u975e\u6267\u884cINCLUDE\u548cEXCLUDE\uff09\uff1b</li> <li>LOCAL_DICTIONARY_THRESHOLD\uff1a\u9ed8\u8ba410000\uff0c</li> <li>LOCAL_DICTIONARY_INCLUDE\uff1a\u9ed8\u8ba4\u6240\u6709\u7684String/Varchar/Char\u7c7b\u578b\u7684\u5217\uff1b</li> <li>LOCAL_DICTIONARY_EXCLUDE\uff1a\u9ed8\u8ba4none</li> <li>\u5bf9\u6bcf\u4e2aBlocklet\u4e2d\u7684\u5217\u8fdb\u884c\u8bcd\u5178\u7f16\u7801\uff1b</li> <li>\u53ea\u652f\u6301STRING, CHAR, VARCHAR\u7c7b\u578b\uff1b</li> </ul> <p>\u7cfb\u7edf\u5c5e\u6027\uff1a</p> <ul> <li> <p>carbon.local.dictionary.enable\uff1a\u9ed8\u8ba4true\uff1b</p> </li> <li> <p>carbon.local.dictionary.decoder.fallback\uff1a\u9ed8\u8ba4true\uff0c\u8d85\u8fc7\u9608\u503c\u4f1a\u5199\u539f\u5148\u7684\u503c\uff1b</p> </li> </ul> <p>\u6ce8\u610f\u4e8b\u9879</p> <ul> <li>\u5728\u5c40\u90e8\u5b57\u5178\u7684\u60c5\u51b5\u4e0b\uff0c\u7531\u4e8e\u538b\u7f29\u6bd4\u8f83\u9ad8\uff0c\u751f\u6210\u7684\u5757\u6570\u8f83\u5c11\uff0c\u4f1a\u5bfc\u81f4\u5e76\u53d1\u5ea6\u4e0d\u591f\uff0c\u9700\u8981\u51cf\u5c11\u5757\u7684\u5927\u5c0f\u3002</li> <li>\u5f53\u57fa\u6570\u8f83\u9ad8\u4f46\u5206\u5e03\u5728\u591a\u4e2a\u8d1f\u8f7d\u4e0a\u65f6\uff0c\u5efa\u8bae\u4f7f\u7528\u672c\u5730\u5b57\u5178\uff1b</li> <li>\u5728\u5927\u578b\u96c6\u7fa4\u4e0a\uff0c\u89e3\u7801\u6570\u636e\u53ef\u80fd\u6210\u4e3a\u5168\u5c40\u5b57\u5178\u7684\u74f6\u9888\uff0c\u56e0\u4e3a\u5c06\u6709\u8bb8\u591a\u8fdc\u7a0b\u8bfb\u53d6\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6700\u597d\u4f7f\u7528\u672c\u5730\u5b57\u5178\u3002</li> <li>\u5f53\u57fa\u6570\u8f83\u5c0f\uff0c\u4f46\u52a0\u8f7d\u91cd\u590d\u65f6\uff0c\u6700\u597d\u4f7f\u7528\u5168\u5c40\u5b57\u5178\uff0c\u56e0\u4e3a\u672c\u5730\u5b57\u5178\u5728blocklet\u7ea7\u522b\u751f\u6210\u591a\u4e2a\u5b57\u5178\u6587\u4ef6\u4ee5\u589e\u52a0\u5197\u4f59\u3002</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_3","title":"\u5012\u6392\u7d22\u5f15\u914d\u7f6e","text":"<ul> <li>INVERTED_INDEX\uff1a\u9ed8\u8ba4\u5217\u4e0d\u8fdb\u884c\u5012\u6392\u7d22\u5f15\uff0c\u5012\u6392\u7d22\u5f15\u7684\u5217\u5fc5\u987b\u6307\u5b9aSORT_COLUMNS\uff1b</li> <li>NO_INVERTED_INDEX\uff1a\u914d\u7f6e\u4e0d\u9700\u8981\u7684\u5217</li> <li>\u5bf9\u4e8e\u9ad8\u57fa\u6570\u5217\uff0c\u53ef\u4ee5\u7981\u7528\u53cd\u5411\u7d22\u5f15\u4ee5\u63d0\u9ad8\u6570\u636e\u52a0\u8f7d\u6027\u80fd\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_4","title":"\u6392\u5e8f\u5217\u914d\u7f6e","text":"<ul> <li>SORT_COLUMNS\uff1a\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u5bf9\u4efb\u4f55\u5217\u8fdb\u884c\u6392\u5e8f\uff1b</li> <li>SORT_SCOPE\uff1a\u6570\u636e\u52a0\u8f7d\u671f\u95f4\u7684\u6307\u5b9a\u6392\u5e8f\u8303\u56f4</li> <li>NO_SORT\uff1a\u9ed8\u8ba4\u8303\u56f4\u3002\u5b83\u5c06\u4ee5\u672a\u6392\u5e8f\u7684\u65b9\u5f0f\u52a0\u8f7d\u6570\u636e\uff0c\u5b83\u5c06\u663e\u7740\u63d0\u9ad8\u52a0\u8f7d\u6027\u80fd\u3002</li> <li>LOCAL_SORT\uff1a\u672c\u5730\u6392\u5e8f\uff08\u4efb\u52a1\u7ea7\u522b\u6392\u5e8f\uff09\uff1b</li> <li>BATCH_SORT\uff1a\u5982\u679c\u8bc6\u522b\u51fa\u7684\u5757\u6570&gt;\u5e76\u884c\u5ea6\uff0c\u5b83\u5c06\u63d0\u9ad8\u8d1f\u8f7d\u6027\u80fd\uff0c\u4f46\u4f1a\u964d\u4f4e\u67e5\u8be2\u6027\u80fd\u3002</li> <li>GLOBAL_SORT\uff1a\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\uff0c\u7279\u522b\u662f\u9ad8\u5e76\u53d1\u7684\u70b9\u67e5\u8be2\u3002\uff08\u4f7f\u7528spark GroupBy\u5bf9\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff09</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#table-block","title":"Table Block\u5927\u5c0f\u8bbe\u7f6e","text":"<ul> <li>TABLE_BLOCKSIZE\uff1a\u9ed8\u8ba41024 MB\uff0c\u5e76\u4e14\u652f\u63011 MB\u52302048 MB\u7684\u8303\u56f4\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#table-blocklet","title":"Table Blocklet\u5927\u5c0f\u8bbe\u7f6e","text":"<ul> <li>TABLE_BLOCKLET_SIZE\uff1a\u5728carbondata\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u5c0f\u5757\u5927\u5c0f\uff0c\u9ed8\u8ba4\u503c\u4e3a64 MB\u3002Blocklet\u662f\u6700\u5c0f\u7684IO\u8bfb\u53d6\u5355\u4f4d\uff0c\u70b9\u67e5\u8be2\u65f6\u51cf\u5c0fblocklet\u5927\u5c0f\u53ef\u80fd\u4f1a\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\u3002</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#table-page","title":"Table Page\u5927\u5c0f\u8bbe\u7f6e","text":"<ul> <li>TABLE_PAGE_SIZE_INMB\uff1acarbondata\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u9875\u9762\u5927\u5c0f\uff0c\u9ed8\u8ba41MB\uff0c\u652f\u63011 MB\u52301755 MB(Snappy\u538b\u7f29\u7684\u6700\u5927\u503c\uff09\u7684\u8303\u56f4\uff1b</li> <li>\u5982\u679c\u9875\u9762\u5927\u5c0f\u572832000\u884c\u4e4b\u524d\u8d85\u8fc7\u6b64\u503c\uff0c\u5219\u540e\u7eed\u7684\u884c\u5199\u5230\u4e0b\u4e00\u9875\uff1b</li> <li>\u914d\u7f6e\u6b64\u5c5e\u6027\u7684\u8f83\u5c0f\u503c\uff08\u4f8b\u59821 MB\uff09\u53ef\u4ee5\u66f4\u597d\u5730\u4f7f\u7528CPU\u7f13\u5b58\u9875\u9762\u3002</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#table","title":"Table \u538b\u7f29\u914d\u7f6e","text":"<ul> <li>\u8868\u7ea7\u522b\u7684\u538b\u7f29\u914d\u7f6e\uff0c\u5982\u679c\u672a\u6307\u5b9a\uff0c\u5c06\u4f7f\u7528carbon.properties\u4e2d\u7684\u7cfb\u7edf\u7ea7\u522b\u7684\u914d\u7f6e\uff1b</li> <li>MAJOR_COMPACTION_SIZE\uff1aSegments\u5408\u5e76\u6210\u4e00\u4e2a\u524d\u7684\u6700\u5927\u89c4\u6a21\uff1b</li> <li>AUTO_LOAD_MERGE\uff1a\u81ea\u52a8\u5408\u5e76Segments\uff1b</li> <li>COMPACTION_LEVEL_THRESHOLD\uff1a\u5408\u5e76\u6210\u4e00\u4e2aSegments\u7684Segment\u7684\u6570\u91cf\uff1b</li> <li>COMPACTION_PRESERVE_SEGMENTS\uff1a\u9700\u8981\u4ece\u538b\u7f29\u4e2d\u6392\u9664\u7684\u6700\u65b0Segment\u7684\u6570\u91cf\uff1b</li> <li>ALLOWED_COMPACTION_DAYS\uff1a\u5728\u914d\u7f6e\u7684\u65f6\u95f4\u9650\u5236\uff08\u4ee5\u5929\u4e3a\u5355\u4f4d\uff09\u5185\u751f\u6210\u7684\u6bb5\u88ab\u538b\u7f29\uff0c\u800c\u8df3\u8fc7\u5176\u4ed6\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_5","title":"\u6d41\u5f0f\u914d\u7f6e","text":"<ul> <li>streaming\uff1a\u9ed8\u8ba4false</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#minmax","title":"\u9700\u6c42\u5217\u7f13\u5b58Min/Max","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cCarbonData\u7f13\u5b58Schema\u4e2d\u6240\u6709\u5217\u7684\u6700\u5c0f\u503c\u548c\u6700\u5927\u503c\u3002\u53ef\u4ee5\u914d\u7f6e\u4ec5\u9700\u7684\u5217\u7684\u6700\u5927/\u6700\u5c0f\u503c\uff0c\u4e0d\u652f\u6301binary\u7c7b\u578b\u3002\u5728\u521b\u5efa\u8868\u65f6\u6216\u521b\u5efa\u8868\u540e\u6307\u5b9a\u8981\u7f13\u5b58\u7684\u5217</p> <p>COLUMN_META_CACHE\uff1a\u9ed8\u8ba4none</p> <ul> <li>\u2018\u2019\uff0c\u8868\u793a\u4e0d\u9700\u8981\u4fdd\u5b58\u5217\u7684\u6700\u5927/\u6700\u5c0f\u503c\uff1b</li> <li>\u2018col1,col2\u2019\uff0c\u53ea\u9700\u8981\u4fdd\u5b58col1\u548ccol2\u5217\u7684\u6700\u5927\u6700\u5c0f\u503c\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#blockblocklet","title":"Block\u548cBlocklet\u7ea7\u7f13\u5b58","text":"<p>\u7f13\u5b58\u4fdd\u6301\u5728\u5757\u7ea7\u522b\uff0c\u4ece\u800c\u4f18\u5316\u4e86\u5185\u5b58\u7684\u4f7f\u7528\uff0c\u5728\u521b\u5efa\u8868\u65f6\u6216\u521b\u5efa\u8868\u540e\u6307\u5b9a\u7f13\u5b58\u7ea7\u522b\u3002</p> <p>CACHE_LEVEL\uff1aBLOCK\uff08\u9ed8\u8ba4\uff09\u6216\u8005BLOCKLET</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#hiveparquetflat","title":"\u652f\u6301\u4e0eHive/Parquet\u76f8\u540c\u7684Flat\u6587\u4ef6\u5939","text":"<p>\u5141\u8bb8\u6240\u6709carbondata\u548cindex\u6587\u4ef6\u76f4\u63a5\u4fdd\u6301\u5728tablepath\u4e0b\u3002\u65b9\u4fbf\u4e0e\u5176\u4ed6\u5f15\u64ce\u5982Hive\u3001Presto\u96c6\u6210\u3002</p> <p>flat_folder\uff1a\u9ed8\u8ba4\u4e3afalse\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#32000","title":"\u5b57\u7b26\u4e32\u8d85\u8fc732000\u4e2a\u5b57\u7b26","text":"<p>\u9ed8\u8ba4\u4f7f\u7528Short\u5b58\u50a8\u5b57\u7b26\u4e32\u957f\u5ea6\uff0c\u8d85\u8fc7\u7684\u9700\u8981\u7528Integer\u5b58\u50a8\uff0c\u6307\u5b9a\u5217\u4e3aLONG_STRING_COLUMNS\uff08\u7b49\u4ef7\u4e8evarchar\uff09\u3002</p> <p>LONG_STRING_COLUMNS \u53ea\u80fd\u662fstring / char / varchar\u5217\uff0c\u4e14\u4e0d\u80fd\u662f\u5168\u5c40\u5b57\u5178\u5217/\u6392\u5e8f\u5217/\u590d\u6742\u5217\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_6","title":"\u8868\u538b\u7f29","text":"<p>carbon.column.compressor\u914d\u7f6e\u4e3asnappy\uff08\u9ed8\u8ba4\uff09\u6216\u8005 zstd\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_7","title":"\u4e0d\u826f\u8bb0\u5f55\u8def\u5f84","text":"<p>\u6307\u5b9a\u5c06\u4e0d\u826f\u8bb0\u5f55\u5199\u5165\u7684\u4f4d\u7f6e\u3002 <pre><code>TBLPROPERTIES('BAD_RECORD_PATH'='/opt/badrecords')  \n</code></pre></p>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_8","title":"\u52a0\u8f7d\u6700\u5c0f\u6570\u636e\u91cf","text":"<p>\u6307\u793a\u6bcf\u4e2a\u8282\u70b9\u7528\u4e8e\u6570\u636e\u52a0\u8f7d\u7684\u6700\u5c0f\u8f93\u5165\u6570\u636e\u5927\u5c0f\uff08\u9ed8\u8ba4\u8282\u70b9\u5747\u5206\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u672a\u542f\u7528\u3002</p> <pre><code>TBLPROPERTIES('LOAD_MIN_SIZE_INMB'='256')\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u542f\u7528\u6b64\u529f\u80fd\u540e\uff0c\u4e3a\u4e86\u5b9e\u73b0\u8d1f\u8f7d\u5e73\u8861\uff0c\u8282\u70b9\u8bfb\u53d6\u6570\u636e\u65f6\u4f1a\u5ffd\u7565\u6570\u636e\u672c\u5730\u6027\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_9","title":"\u8303\u56f4\u5217","text":"<p>\u7528\u4e8e\u6307\u5b9a\u4e00\u5217\uff0c\u4ee5\u6309\u8303\u56f4\u5bf9\u8f93\u5165\u6570\u636e\u8fdb\u884c\u5206\u533a\u3002\u53ea\u80fd\u914d\u7f6e\u4e00\u5217\u3002\u4e0d\u652f\u6301\u4e8c\u8fdb\u5236\u6570\u636e\u7c7b\u578b\u3002 <pre><code>TBLPROPERTIES('RANGE_COLUMN'='col1')\n</code></pre></p>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#create-table-as-select","title":"CREATE TABLE AS SELECT","text":"<p>\u4eceHive/Parquet/Carbon\u8868\u4e2d\u521b\u5efa\u65b0\u7684Carbon\u8868\u3002</p> <pre><code>CREATE TABLE [IF NOT EXISTS] [db_name.]table_name \nSTORED AS carbondata \n[TBLPROPERTIES (key1=val1, key2=val2, ...)] \nAS select_statement;\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#create-external-table","title":"CREATE EXTERNAL TABLE","text":"<p>\u521b\u5efa\u5916\u90e8\u8868\uff1a\u5220\u9664\u5916\u90e8\u8868\uff0c\u4e0d\u4f1a\u5220\u9664\u6587\u4ef6\uff1b</p> <pre><code>CREATE EXTERNAL TABLE [IF NOT EXISTS] [db_name.]table_name \nSTORED AS carbondata LOCATION '$FilesPath'\n</code></pre> <p>managed table</p> <p>ManagedTable\u5177\u6709FACT\u548cMetadata\u76ee\u5f55\u3002</p> <p>\u975e\u4e8b\u52a1\u8868</p> <p>\u975e\u4e8b\u52a1\u8868\u53ea\u6709carbondata\u548ccarbonindex\u6587\u4ef6\uff0c\u6ca1\u6709metadata\u6587\u4ef6\uff0cSDK\u5f53\u524d\u652f\u6301\u4ee5\u8fd9\u79cd\u683c\u5f0f\u5199\u6570\u636e\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#create-database","title":"CREATE DATABASE","text":"<p>\u53ef\u4ee5\u6307\u5b9a\u5b58\u50a8\u8def\u5f84\uff1a</p> <pre><code>CREATE DATABASE [IF NOT EXISTS] database_name [LOCATION path];\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#table-management","title":"TABLE MANAGEMENT","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_10","title":"\u67e5\u770b\u8868","text":"<pre><code>SHOW TABLES [IN db_Name]\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_11","title":"\u91cd\u547d\u540d\u8868","text":"<pre><code>ALTER TABLE [db_name.]table_name RENAME TO new_table_name\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_12","title":"\u589e\u52a0\u5217","text":"<pre><code>ALTER TABLE [db_name.]table_name ADD COLUMNS (col_name data_type,...)\nTBLPROPERTIES('DICTIONARY_INCLUDE'='col_name,...',\n'DEFAULT.VALUE.COLUMN_NAME'='default_value')\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_13","title":"\u5220\u9664\u5217","text":"<pre><code>ALTER TABLE [db_name.]table_name DROP COLUMNS (col_name, ...)\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_14","title":"\u6539\u53d8\u5217\u5c5e\u6027","text":"<pre><code>ALTER TABLE [db_name.]table_name CHANGE col_old_name col_new_name column_type\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#setunset","title":"SET\u548cUNSET","text":"<pre><code>ALTER TABLE tablename SET TBLPROPERTIES('LOCAL_DICTIONARY_ENABLE'='false','LOCAL_DICTIONARY_THRESHOLD'='1000','LOCAL_DICTIONARY_INCLUDE'='column1','LOCAL_DICTIONARY_EXCLUDE'='column2')\n</code></pre> <ul> <li>SORT_COLUMNS\u7684\u4fee\u6539\uff0c\u65b0\u7684\u52a0\u8f7d\u5c06\u4f7f\u7528\u65b0\u7684SORT_COLUMNS\u3002\u7528\u6237\u53ef\u4ee5\u6839\u636e\u67e5\u8be2\u8c03\u6574SORT_COLUMNS\uff0c\u4f46\u4e0d\u4f1a\u76f4\u63a5\u5f71\u54cd\u65e7\u6570\u636e\u3002\u56e0\u6b64\uff0c\u5b83\u4e0d\u4f1a\u5f71\u54cd\u672a\u6309\u65b0SORT_COLUMNS\u6392\u5e8f\u7684\u65e7\u6570\u636e\u6bb5\u7684\u67e5\u8be2\u6027\u80fd\u3002</li> <li>SORT_COLUMNS\u4fee\u6539\u4e0d\u652f\u6301\u6d41\u8868\u3002</li> <li>\u5982\u679c\u4ece\u65b0\u7684SORT_COLUMNS\u4e2d\u5220\u9664\u4e86\u53cd\u5411\u7d22\u5f15\u5217\uff0c\u5219\u8fd9\u4e9b\u5217\u5c06\u4e0d\u4f1a\u521b\u5efa\u53cd\u5411\u7d22\u5f15\u3002\u4f46\u662f\u5c06\u4fdd\u7559INVERTED_INDEX\u7684\u65e7\u914d\u7f6e\u3002</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#index","title":"Index\u5408\u5e76","text":"<p>\u5c06\u4e00\u4e2asegment\u4e0b\u7684\u591a\u4e2aindex\u6587\u4ef6\uff08.carbonindex\uff09\u5408\u5e76\u6210\u4e00\u4e2a\uff08.carbonindexmerge\uff09\u3002</p> <pre><code>ALTER TABLE [db_name.]table_name COMPACT 'SEGMENT_INDEX'\n</code></pre> <p>\u4e0d\u652f\u6301\u6d41\u5f0f\u8868\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_15","title":"\u5220\u9664\u8868","text":"<pre><code>DROP TABLE [IF EXISTS] [db_name.]table_name\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_16","title":"\u5237\u65b0\u8868","text":"<p>\u5c06Carbon\u8868\u6ce8\u518c\u5230Hive MetaStore\u3002</p> <pre><code>REFRESH TABLE $db_NAME.$table_NAME\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_17","title":"\u8868\u548c\u5217\u7684\u6ce8\u91ca","text":"<pre><code>CREATE TABLE [IF NOT EXISTS] [db_name.]table_name[(col_name data_type [COMMENT col_comment], ...)]\n  [COMMENT table_comment]\nSTORED AS carbondata\n[TBLPROPERTIES (property_name=property_value, ...)]\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#partition","title":"PARTITION","text":"<p>\u5206\u533a\u7c7b\u4f3cHive/Spark\u4e2d\u7684\u5206\u533a\uff0c\u4f7f\u7528\u4efb\u610f\u5217\u8fdb\u884c\u5206\u533a\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_18","title":"\u521b\u5efa\u5206\u533a\u8868","text":"<pre><code>CREATE TABLE [IF NOT EXISTS] [db_name.]table_name \n  [(col_name data_type , ...)]\n  [COMMENT table_comment]\n  [PARTITIONED BY (col_name data_type , ...)]\n  [STORED BY file_format]\n  [TBLPROPERTIES (property_name=property_value, ...)]\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_19","title":"\u5206\u533a\u67e5\u770b\u548c\u5220\u9664","text":"<pre><code>SHOW PARTITIONS [db_name.]table_name\n\nALTER TABLE table_name DROP [IF EXISTS] PARTITION (part_spec, ...) \n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_20","title":"\u63d2\u5165\u548c\u8986\u76d6\u5206\u533a","text":"<p>\u63d2\u5165\u6216\u8986\u76d6\u7279\u5b9a\u7684\u5206\u533a\u7684\u6570\u636e</p> <pre><code>INSERT OVERWRITE TABLE table_name\nPARTITION (column = 'partition_name')\nselect_statement\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#hash","title":"\u521b\u5efaHash\u5206\u533a\u8868","text":"<p>\u5f53\u524d\u7684Hash\uff0cRange\uff0cList\u5206\u533a\u4e0d\u652f\u6301\u66f4\u65b0\u548c\u5220\u9664\u6570\u636e\u3002</p> <pre><code>CREATE TABLE [IF NOT EXISTS] [db_name.]table_name\n                  [(col_name data_type , ...)]\nPARTITIONED BY (partition_col_name data_type)\nSTORED AS carbondata\n[TBLPROPERTIES ('PARTITION_TYPE'='HASH',\n                'NUM_PARTITIONS'='N' ...)]\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_21","title":"\u521b\u5efa\u8303\u56f4\u5206\u533a\u8868","text":"<pre><code>CREATE TABLE [IF NOT EXISTS] [db_name.]table_name\n                  [(col_name data_type , ...)]\nPARTITIONED BY (partition_col_name data_type)\nSTORED AS carbondata\n[TBLPROPERTIES ('PARTITION_TYPE'='RANGE',\n                'RANGE_INFO'='2014-01-01, 2015-01-01, 2016-01-01, ...')]\n</code></pre> <p>RANGE_INFO\u6570\u636e\u5fc5\u987b\u662f\u5347\u5e8f\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_22","title":"\u521b\u5efa\u5217\u8868\u5206\u533a\u8868","text":"<pre><code>CREATE TABLE [IF NOT EXISTS] [db_name.]table_name\n                  [(col_name data_type , ...)]\nPARTITIONED BY (partition_col_name data_type)\nSTORED AS carbondata\n[TBLPROPERTIES ('PARTITION_TYPE'='LIST',\n                'LIST_INFO'='A, B, (C, D), E, ...')]\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#_23","title":"\u5206\u533a\u64cd\u4f5c","text":"<pre><code>SHOW PARTITIONS [db_name.]table_name\n-- add\u5206\u533a\nALTER TABLE [db_name].table_name ADD PARTITION('new_partition')\n-- split\u5206\u533a\nALTER TABLE [db_name].table_name SPLIT PARTITION(partition_id) INTO('new_partition1', 'new_partition2'...)\n-- drop\u5206\u533a\nALTER TABLE [db_name].table_name DROP PARTITION(partition_id) [WITH DATA]\n</code></pre> <p>Hash\u5206\u533a\u4e0d\u652f\u6301add, split\u548cdrop\u5206\u533a\u3002</p> <p>\u5efa\u8bae\uff1a</p> <ul> <li>\u5206\u533a\u7684\u5217\u4e0d\u9700\u8981\u52a0\u5165\u6392\u5e8f\u5217\u4e2d\uff1b</li> <li>\u4f7f\u7528\u5206\u533a\u5217\u8fdb\u884c\u8fc7\u6ee4\u3002</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#bucketing","title":"BUCKETING","text":"<p>\u5206\u6876\u529f\u80fd\u53ef\u7528\u4e8e\u5c06\u8868/\u5206\u533a\u6570\u636e\u5206\u53d1/\u7ec4\u7ec7\u5230\u591a\u4e2a\u6587\u4ef6\u4e2d\uff0c\u4ee5\u4fbf\u5728\u540c\u4e00\u6587\u4ef6\u4e2d\u5b58\u5728\u76f8\u4f3c\u7684\u8bb0\u5f55\u3002</p> <p>\u9700\u8981\u6307\u5b9a\u5206\u6876\u7684\u5217\u4ee5\u53ca\u6876\u7684\u4e2a\u6570\u3002</p> <pre><code>CREATE TABLE [IF NOT EXISTS] [db_name.]table_name\n                  [(col_name data_type, ...)]\nSTORED AS carbondata\nTBLPROPERTIES('BUCKETNUMBER'='noOfBuckets',\n'BUCKETCOLUMNS'='columnname')\n</code></pre> <ul> <li>\u5206\u6876\u4e0d\u652f\u6301\u590d\u6742\u7c7b\u578b\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/ddl.html#cache","title":"CACHE","text":"<p>Carbondata\u4f7f\u7528LRUCache\u3002</p> <pre><code>SHOW METACACHE\n\nSHOW METACACHE ON TABLE tableName\n\nDROP METACACHE ON TABLE tableName\n</code></pre> <p>\u4ee5\u4e0a\u547d\u4ee4\u4e0d\u652f\u6301\u5b50\u8868\u3002</p> <ul> <li>\u4ec5\u5728\u6267\u884cselect\u67e5\u8be2\u540e\u624d\u66f4\u65b0\u7f13\u5b58\u4fe1\u606f\u3002</li> <li>\u5982\u679c\u662falter table\uff0c\u5219\u5728\u89e6\u53d1\u4efb\u4f55\u540e\u7eed\u7684select\u67e5\u8be2\u65f6\uff0c\u5df2\u52a0\u8f7d\u7684\u7f13\u5b58\u5c06\u5931\u6548\u3002</li> <li>\u4ec5\u5728\u67e5\u8be2\u5b57\u5178\u5217\u65f6\u624d\u5c06\u5b57\u5178\u52a0\u8f7d\u5230\u7f13\u5b58\u4e2d\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/distributed_index_server.html","title":"Distributed index server","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/distributed_index_server.html#_1","title":"\u5206\u5e03\u5f0f\u7d22\u5f15\u670d\u52a1","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/distributed_index_server.html#_2","title":"\u52a8\u673a","text":"<p>carbon\u5bf9\u4e8e\u4e00\u822c\u7684\u8868\u4f1a\u4fee\u526a\u5e76\u7f13\u5b58\u6240\u6709\u7684Block/Blocklet\u7684datamap\u5230driver\u7684\u5185\u5b58\u4e2d\uff0c\u5bf9\u4e8eBloom/Index\u7684datamaps\uff0cdriver\u4f1a\u542f\u52a8job\u5728executor\u7aef\u8fdb\u884c\u4fee\u526a\u548c\u7f13\u5b58\u3002</p> <p>driver\u4f1a\u53d8\u6210\u74f6\u9888\uff1a</p> <ul> <li>\u7f13\u5b58\u8fc7\u5927\uff0c\u5bfc\u81f4GC\u4e25\u91cd\uff0c\u5f71\u54cd\u67e5\u8be2\u6027\u80fd\uff0c\u4e14\u8017\u5185\u5b58\uff1b</li> <li>LRU\u7f13\u5b58\u66ff\u6362\uff0c\u4f1a\u51cf\u6162\u67e5\u8be2\u901f\u5ea6\uff1b</li> <li>\u5bf9\u4e8eBloom\uff0c\u4e0d\u80fd\u4fdd\u8bc1\u8bf7\u6c42\u5230\u540c\u4e00\u4e2aexecutor\u4e0a\uff0c\u5bfc\u81f4\u591a\u4e2aexecutor\u4e0a\u7684\u7f13\u5b58\u91cd\u590d\uff1b</li> <li>\u6bcf\u4e2aJDBC driver\u90fd\u9700\u8981\u5355\u72ec\u7684\u7f13\u5b58\u3002</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/distributed_index_server.html#distribution","title":"Distribution","text":"<p>\u5bf9carbon\u8868\u7684\u67e5\u8be2\u90fd\u5c06\u4ee5\u8bf7\u6c42\u7684\u5f62\u5f0f\u8def\u7531\u5230\u7d22\u5f15\u670d\u52a1\u5668\u670d\u52a1\u3002</p> <p>IndexServer\u4e3b\u8981\u8d1f\u8d23\u4e24\u4ef6\u4e8b\uff1a\u5728executors\u95f4\u5747\u5206segment\u4ee5\u53ca\u4fdd\u5b58cache segment\u7684\u4f4d\u7f6e\u3002</p> <ul> <li>segment\u5230executor\u7684\u6620\u5c04\uff1a\u6bcf\u5f20\u8868\u4e00\u4e2a\u6620\u5c04\uff0c\u8bb0\u5f55\u6bcf\u4e2asegment cache\u7684\u4f4d\u7f6e\uff1b</li> <li>\u6bcf\u4e2aexecutor\u7684cache\u5927\u5c0f\uff1a\u6839\u636e\u5df2\u7ecf\u7f13\u5b58\u7684cache\u5927\u5c0f\uff0c\u5728executors\u95f4\u5747\u5206segment\uff1b</li> </ul> <p>executor\u4e0d\u53ef\u7528\u65f6\uff0c\u57fa\u4e8e\u8d1f\u8f7d\u91cd\u65b0\u5212\u5206\u5176\u8d1f\u8d23\u7684segment\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/distributed_index_server.html#_3","title":"\u914d\u7f6e\u53c2\u6570","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/distributed_index_server.html#jdbcservercarbonproperties","title":"JDBCServer(carbon.properties)","text":"Name Default Value Description carbon.enable.index.server false \u5e94\u7528\u7ea7\u522b\u7684index server\u7684\u542f\u52a8\u4e0e\u5426 carbon.index.server.ip NA index server ip carbon.index.server.port NA index server port carbon.disable.index.server.fallback false index server\u7684fallback\u673a\u5236\u662f\u5426\u5141\u8bb8\u3002\u5e94\u8be5\u4ec5\u7528\u4e8e\u6d4b\u8bd5\u76ee\u7684\u3002 carbon.index.server.max.jobname.length NA \u5728\u7d22\u5f15\u670d\u52a1\u5668\u670d\u52a1UI\u4e2d\u663e\u793a\u7684\u4f5c\u4e1a\u7684\u6700\u5927\u957f\u5ea6\u3002\u5bf9\u4e8e\u8f83\u5927\u7684\u67e5\u8be2\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5f71\u54cd\u6027\u80fd\uff0c\u56e0\u4e3a\u6574\u4e2a\u5b57\u7b26\u4e32\u5c06\u4eceJDBCServer\u53d1\u9001\u5230IndexServer\u3002 carbon.indexserver.enable.prepriming false \u5141\u8bb8indexserver\u9884\u6267\u884c\u63d0\u5347\u7b2c\u4e00\u6b21\u67e5\u8be2\u7684\u6027\u80fd"},{"location":"data_system/1_data_organize/data_format/carbondata/distributed_index_server.html#indexservercarbonproperties","title":"IndexServer(carbon.properties)","text":"Name Default Value Description carbon.index.server.ip NA index server ip carbon.index.server.port NA index server port carbon.index.server.max.worker.threads 500 \u8981\u6253\u5f00\u4ee5\u63a5\u53d7\u6765\u81eaJDBC\u9a71\u52a8\u7a0b\u5e8f\u7684\u8bf7\u6c42\u7684RPC\u5904\u7406\u7a0b\u5e8f\u7684\u6570\u91cf\u3002 carbon.max.executor.lru.cache.size NA \u6267\u884c\u7a0b\u5e8f\u8fdb\u7a0b\u53ef\u4ee5\u7f13\u5b58\u6570\u636e\uff08DataMap\u548c\u53cd\u5411\u5b57\u5178\u503c\uff09\u7684\u6700\u5927\u5185\u5b58\uff08\u4ee5MB\u4e3a\u5355\u4f4d\uff09\u3002. carbon.index.server.max.jobname.length NA \u5728\u7d22\u5f15\u670d\u52a1\u5668\u5e94\u7528\u7a0b\u5e8fUI\u4e2d\u663e\u793a\u7684\u4f5c\u4e1a\u7684\u6700\u5927\u957f\u5ea6\u3002 carbon.max.executor.threads.for.block.pruning 4 \u7528\u4e8e\u5757\u4fee\u526a\u7684\u6700\u5927\u6267\u884c\u7a0b\u5e8f\u7ebf\u7a0b\u3002 carbon.index.server.inmemory.serialization.threshold.inKB 300 \u5185\u5b58\u5e8f\u5217\u5316\u5927\u5c0f\u8fbe\u5230\u9608\u503c\u6570\u636e\u540e\u6570\u636e\u5c06\u88ab\u5199\u5165\u6587\u4ef6\u3002 carbon.indexserver.temp.path tablePath \u8d85\u8fc7\u9608\u503c\u540e\u6587\u4ef6\u5199\u7684\u4e34\u65f6\u8def\u5f84"},{"location":"data_system/1_data_organize/data_format/carbondata/distributed_index_server.html#spark","title":"Spark\u914d\u7f6e","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/distributed_index_server.html#spark-defaultsconf","title":"spark-defaults.conf(\u5b89\u5168\u6a21\u5f0f)","text":"Name Default Value Description spark.dynamicAllocation.enabled true Set to false, so that spark does not kill the executor, If executors are killed, cache would be lost. Applicable only for Index Server. spark.yarn.principal NA Should be set to the same user used for JDBCServer. Required only for IndexServer. spark.yarn.keytab NA Should be set to the same as JDBCServer."},{"location":"data_system/1_data_organize/data_format/carbondata/distributed_index_server.html#spark-defaultsconf_1","title":"spark-defaults.conf(\u975e\u5b89\u5168\u6a21\u5f0f)","text":"Name Default Value Description spark.dynamicAllocation.enabled true Set to false, so that spark does not kill the executor, If executors are killed, cache would be lost. Applicable only for Index Server. <p>NOTE: \u6700\u597d\u4e3a\u7d22\u5f15\u670d\u52a1\u5668\u4e3b\u4f53\u521b\u5efa\u4e00\u4e2a\u65b0\u7528\u6237\uff0c\u8be5\u7528\u6237\u5c06\u5bf9\u7528\u6237\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u4ee5\u8bbf\u95ee\u7d22\u5f15\u670d\u52a1\u5668</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/distributed_index_server.html#core-sitexml","title":"core-site.xml","text":"Name Default Value Description ipc.client.rpc-timeout.ms NA Set the above property to some appropriate value based on your estimated query time. The best option is to set this to the same value as spark.network.timeout. hadoop.security.authorization false Property to enable the hadoop security which is required only on the server side. hadoop.proxyuser..users NA Property to set Proxy User list for which IndexServer permission were to be given ,check https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/Superusers.html hadoop.proxyuser..hosts NA Property to set hosts list for which IndexServer permission were to be given ,check https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/Superusers.html hadoop.proxyuser..groups NA Property to set groups list for which IndexServer permission to be given ,check https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/Superusers.html security.indexserver.protocol.acl * Property to set List of User to be Authorized for Other than proxy Spark Application"},{"location":"data_system/1_data_organize/data_format/carbondata/distributed_index_server.html#set","title":"\u52a8\u6001\u914d\u7f6e(set \u547d\u4ee4)","text":"Name Default Value Description carbon.enable.index.server false Enable the use of index server for pruning for the current session. carbon.enable.index.server.dbName.tableName false Enable the use of index server for the specified table in the current session."},{"location":"data_system/1_data_organize/data_format/carbondata/distributed_index_server.html#_4","title":"\u542f\u52a8\u670d\u52a1\u5668","text":"<pre><code>./bin/spark-submit --master [yarn/local] --[optional parameters] --class org.apache.carbondata.indexserver.IndexServer [path to carbondata-spark-&lt;version&gt;.jar]\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html","title":"Dml","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#data-manipulation-language","title":"Data Manipulation Language","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#_1","title":"\u6570\u636e\u52a0\u8f7d","text":"<p>CSV\u683c\u5f0f\u7684\u6570\u636e\u52a0\u8f7d\u5230Carbon \u8868\u4e2d\u3002</p> <pre><code>LOAD DATA INPATH 'folder_path'\nINTO TABLE [db_name.]table_name \nOPTIONS(property_name=property_value, ...)\n</code></pre> <p>OPTIONS \u53ef\u914d\uff1a</p> <ul> <li> <p>\u5728\u5904\u7406\u9519\u8bef\u4e4b\u524d\uff0c\u52a0\u8f7d\u6240\u6709\u6570\u636e\u3002</p> </li> <li> <p>\u5728\u52a0\u8f7d\u6570\u636e\u4e4b\u524d\u6e05\u7406\u6216\u5220\u9664\u4e0d\u826f\u8bb0\u5f55\uff0c\u6216\u8005\u5728\u53d1\u73b0\u4e0d\u826f\u8bb0\u5f55\u65f6\u505c\u6b62\u52a0\u8f7d\u3002</p> </li> <li> </li> <li> <p>SORT_SCOPE\u5b9a\u4e49\u4e3aGLOBAL_SORT\u65f6\u6307\u5b9a\u7684\u8fdb\u884c\u6392\u5e8f\u65f6\u8981\u4f7f\u7528\u7684\u5206\u533a\u6570\u3002</p> </li> <li> </li> <li> <p>\u5bf9\u4e8eRANGE_COLUMN\uff0cSCALE_FACTOR\u7528\u4e8e\u63a7\u5236\u8303\u56f4\u5206\u533a\u7684\u6570\u91cf\uff0c\u8ba1\u7b97\u516c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>splitSize = max(blocklet_size, (block_size - blocklet_size)) * scale_factor\nnumPartitions = total size of input data / splitSize\n</code></pre> </li> </ul> <p>\u6ce8\u610f\uff1a</p> <ul> <li>\u5982\u679c\u540c\u65f6\u4f7f\u7528GLOBAL_SORT_PARTITIONS\u548cSCALE_FACTOR\uff0c\u5219\u4ec5GLOBAL_SORT_PARTITIONS\u6709\u6548\u3002</li> <li> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5bf9RANGE_COLUMN\u7684\u538b\u7f29\u5c06\u4f7f\u7528LOCAL_SORT\u3002</p> </li> <li> </li> <li> <p>\u914d\u7f6e\u662f\u5426\u5c06\u57fa\u4e8e\u8303\u56f4\u7684\u538b\u7f29\u7528\u4e8eRANGE_COLUMN\u3002\u9ed8\u8ba4\u503c\u662ftrue\u3002</p> </li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#delimiter","title":"DELIMITER\uff1a\u5206\u9694\u7b26","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#quotechar","title":"QUOTECHAR\uff1a\u5f15\u7528\u7b26","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#commentchar","title":"COMMENTCHAR\uff1a\u6ce8\u91ca\u7b26","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#headertrue","title":"HEADER\uff1a\u9ed8\u8ba4true","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#fileheaderheaderfalse","title":"FILEHEADER\uff1aHEADER\u4e3afalse\u65f6\uff0c\u63d0\u4f9b\u5217\u540d\uff1b","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#sort_scopesort_scope","title":"SORT_SCOPE\uff1a\u5f53\u524d\u8868\u7684SORT_SCOPE\uff1b","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#multiline","title":"MULTILINE","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#escapechar","title":"ESCAPECHAR","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#skip_empty_line","title":"SKIP_EMPTY_LINE","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#complex_delimiter_level_1complex_delimiter_level_2complex_delimiter_level_3","title":"COMPLEX_DELIMITER_LEVEL_1\uff0cCOMPLEX_DELIMITER_LEVEL_2\uff0cCOMPLEX_DELIMITER_LEVEL_3","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#all_dictionary_path","title":"ALL_DICTIONARY_PATH\uff1a\u5b57\u5178\u6587\u4ef6\u8def\u5f84","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#columndict","title":"COLUMNDICT\uff1a\u6307\u5b9a\u5217\u7684\u5b57\u6bb5\u6587\u4ef6\u8def\u5f84","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#dateformattimestampformat","title":"DATEFORMAT/TIMESTAMPFORMAT","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#sort-column-boundslocal_sort","title":"SORT COLUMN BOUNDS\uff1a\u4ec5\u5f53LOCAL_SORT","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#single_passfalse","title":"SINGLE_PASS\uff1a\u9ed8\u8ba4false\uff0c\u5355\u6b21\u901a\u8fc7\u52a0\u8f7d\u4f7f\u5355\u4e2a\u4f5c\u4e1a\u53ef\u4ee5\u901a\u8fc7\u8bcd\u5178\u7684\u52a8\u6001\u751f\u6210\u6765\u5b8c\u6210\u6570\u636e\u52a0\u8f7d\u3002","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#bad-records-handling","title":"BAD RECORDS HANDLING","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#global_sort_partitions","title":"GLOBAL_SORT_PARTITIONS","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#scale_factor","title":"SCALE_FACTOR","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#carbon_enable_range_compaction","title":"CARBON_ENABLE_RANGE_COMPACTION","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#_2","title":"\u6570\u636e\u63d2\u5165","text":"<p>\u6e90\u8868\u53ef\u4ee5\u662fHive\u8868\uff0cParquet\u8868\u6216\u8005Carbon\u8868</p> <pre><code>INSERT INTO|OVERWRITE TABLE &lt;CARBONDATA TABLE&gt; SELECT * FROM sourceTableName \n[ WHERE { &lt;filter_condition&gt; } ]\n</code></pre> <ul> <li>\u6e90\u8868\u548ccarbon\u8868\u7684schema\u5fc5\u987b\u4e00\u81f4\uff1b</li> <li>\u6e90\u548c\u76ee\u6807\u8868\u7684\u5217\u7684\u6570\u636e\u7c7b\u578b\u9700\u8981\u4e00\u81f4\uff1b</li> <li>INSERT INTO\u5982\u679c\u53d1\u73b0bad record\uff0c\u5219\u4f1a\u5168\u90e8\u5931\u8d25\uff1b</li> <li>\u4ece\u6e90\u8868\u5230\u76ee\u6807\u8868\u7684\u63d2\u5165\u8fc7\u7a0b\u4e2d\uff0c\u65e0\u6cd5\u5728\u6e90\u8868\u4e2d\u52a0\u8f7d\u6216\u66f4\u65b0\u6570\u636e\u3002</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#_3","title":"\u52a0\u8f7d\u6570\u636e\u5230\u9759\u6001\u5206\u533a","text":"<p>\u5c06\u6570\u636e\u52a0\u8f7d\u5230\u6307\u5b9a\u7684\u5206\u533a\u4e2d</p> <pre><code>LOAD DATA INPATH 'folder_path'\nINTO TABLE [db_name.]table_name PARTITION (partition_spec) \nOPTIONS(property_name=property_value, ...)\n\nINSERT INTO TABLE [db_name.]table_name PARTITION (partition_spec) &lt;SELECT STATEMENT&gt;\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#_4","title":"\u52a0\u8f7d\u6570\u636e\u5230\u52a8\u6001\u5206\u533a","text":"<p>\u6b64\u547d\u4ee4\u5141\u8bb8\u60a8\u4f7f\u7528\u52a8\u6001\u5206\u533a\u52a0\u8f7d\u6570\u636e\u3002\u5982\u679c\u672a\u6307\u5b9a\u5206\u533a\u89c4\u8303\uff0c\u5219\u8be5\u5206\u533a\u88ab\u89c6\u4e3a\u52a8\u6001\u5206\u533a\u3002</p> <pre><code>LOAD DATA INPATH '${env:HOME}/staticinput.csv'\nINTO TABLE locationTable\n\nINSERT INTO TABLE locationTable\nSELECT &lt;columns list excluding partition columns&gt; FROM another_user\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#_5","title":"\u66f4\u65b0\u548c\u5220\u9664","text":"<p>\u57fa\u4e8e\u5217\u8868\u8fbe\u5f0f\u548c\u53ef\u9009\u8fc7\u6ee4\u6761\u4ef6\u6765\u66f4\u65b0CarbonData\u8868</p> <pre><code>UPDATE &lt;table_name&gt; \nSET (column_name1, column_name2, ... column_name n) = (column1_expression , column2_expression, ... column n_expression )\n[ WHERE { &lt;filter_condition&gt; } ]\n\nUPDATE &lt;table_name&gt;\nSET (column_name1, column_name2) =(select sourceColumn1, sourceColumn2 from sourceTable [ WHERE { &lt;filter_condition&gt; } ] )\n[ WHERE { &lt;filter_condition&gt; } ]\n\nDELETE FROM table_name [WHERE expression]\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#_6","title":"\u538b\u7f29","text":"<pre><code>ALTER TABLE [db_name.]table_name COMPACT 'MINOR/MAJOR/CUSTOM'\n</code></pre> <p>minor</p> <p>\u5728\u6b21\u8981\u538b\u7f29\u4e2d\uff0c\u7528\u6237\u53ef\u4ee5\u6307\u5b9a\u8981\u5408\u5e76\u7684\u8f7d\u8377\u6570\u3002\u5982\u679c\u53c2\u6570carbon.enable.auto.load.merge\u8bbe\u7f6e\u4e3atrue\uff0c\u5219\u6bcf\u6b21\u6570\u636e\u52a0\u8f7d\u90fd\u4f1a\u89e6\u53d1\u6b21\u8981\u538b\u7f29\u3002\u5982\u679c\u6709\u4efb\u4f55\u6bb5\u53ef\u4ee5\u5408\u5e76\uff0c\u5219\u538b\u7f29\u5c06\u4e0e\u6570\u636e\u52a0\u8f7d\u5e76\u884c\u8fdb\u884c\uff0c\u6b21\u8981\u538b\u7f29\u5206\u4e3a\u4e24\u4e2a\u7ea7\u522b\uff1a</p> <ul> <li>\u7ea7\u522b1\uff1a\u5408\u5e76\u5c1a\u672a\u538b\u7f29\u7684Segment\u3002</li> <li>\u7ea7\u522b2\uff1a\u518d\u6b21\u5408\u5e76\u538b\u7f29\u7684Segment\u4ee5\u5f62\u6210\u66f4\u5927\u7684Segment\u3002</li> </ul> <p>major</p> <p>\u5728\u91cd\u5927\u538b\u7f29\u4e2d\uff0c\u53ef\u4ee5\u5c06\u591a\u4e2a\u6bb5\u5408\u5e76\u4e3a\u4e00\u4e2a\u5927\u6bb5\u3002\u7528\u6237\u5c06\u6307\u5b9a\u538b\u7f29\u5927\u5c0f\uff0c\u76f4\u5230\u53ef\u4ee5\u5408\u5e76\u5404\u4e2a\u6bb5\u4e3a\u6b62\u3002\u901a\u5e38\u5728\u975e\u9ad8\u5cf0\u65f6\u95f4\u8fdb\u884c\u5927\u578b\u538b\u7f29\u3002\u4e3a\u5c5e\u6027carbon.major.compaction.size\u914d\u7f6e\u9002\u5f53\u7684MB\u503c\u3002</p> <p>custom</p> <p>\u5728\u201c\u81ea\u5b9a\u4e49\u538b\u7f29\u201d\u4e2d\uff0c\u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u6307\u5b9a\u8981\u5408\u5e76\u4e3a\u4e00\u4e2a\u5927\u6bb5\u7684\u6bb5ID\u3002\u6240\u6709\u6307\u5b9a\u7684\u6bb5ID\u5e94\u8be5\u5b58\u5728\u5e76\u4e14\u6709\u6548\uff0c\u5426\u5219\u538b\u7f29\u5c06\u5931\u8d25\u3002\u81ea\u5b9a\u4e49\u538b\u7f29\u901a\u5e38\u5728\u975e\u9ad8\u5cf0\u65f6\u95f4\u5b8c\u6210\u3002</p> <pre><code>ALTER TABLE table_name COMPACT 'CUSTOM' WHERE SEGMENT.ID IN (2,3,4)\n</code></pre> <p>\u538b\u7f29\u540e\u6e05\u9664</p> <p>\u6e05\u9664\u538b\u7f29\u7684\u6bb5</p> <pre><code>CLEAN FILES FOR TABLE carbon_table\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#segment","title":"Segment\u7ba1\u7406","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#segment_1","title":"\u67e5\u770bSegment","text":"<pre><code>SHOW [HISTORY] SEGMENTS FOR TABLE [db_name.]table_name LIMIT number_of_segments\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#idsegemnt","title":"\u6839\u636eID\u5220\u9664Segemnt","text":"<pre><code>DELETE FROM TABLE [db_name.]table_name WHERE SEGMENT.ID IN (segment_id1, ...)\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#datesegemnt","title":"\u6839\u636eDate\u5220\u9664Segemnt","text":"<pre><code>DELETE FROM TABLE [db_name.]table_name WHERE SEGMENT.STARTTIME BEFORE DATE_VALUE\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/dml.html#_7","title":"\u67e5\u8be2\u7279\u5b9a\u6bb5\u7684\u6570\u636e","text":"<pre><code>SET carbon.input.segments.&lt;database_name&gt;.&lt;table_name&gt; = &lt;list of segment IDs&gt;\n\n-- \u591a\u7ebf\u7a0b\nCarbonSession.threadSet (\"carbon.input.segments.&lt;database_name&gt;.&lt;table_name&gt;\",\"&lt;list of segment IDs&gt;\");\n\n-- reset\nSET carbon.input.segments.&lt;database_name&gt;.&lt;table_name&gt; = *;\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/streaming.html","title":"Streaming","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/streaming.html#_1","title":"\u6d41","text":"<p>Spark Structed Streaming \u652f\u6301\u3002</p> <pre><code>CREATE TABLE streaming_table (\n col1 INT,\n col2 STRING\n)\nSTORED AS carbondata\nTBLPROPERTIES('streaming'='true')\n</code></pre> <p>Carbon\u6709\u4e24\u79cdDataSource\uff08SPI\u673a\u5236\uff09\uff1a</p> <ul> <li>carbon\uff1a\u6587\u4ef6\u683c\u5f0f\uff0cSparkCarbonFileFormat</li> <li>carbondata\uff1a\u8868\u7684\u683c\u5f0f\uff0cCarbonSource</li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/usage.html","title":"Usage","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/usage.html#_1","title":"\u4f7f\u7528","text":""},{"location":"data_system/1_data_organize/data_format/carbondata/usage.html#java-sdk","title":"Java SDK","text":"<p>http://carbondata.apache.org/sdk-guide.html</p> <p>\u9700\u8981carbondata-store-sdk, carbondata-core, carbondata-format, carbondata-common, carbondata-hadoop\uff0c\u4f46maven\u53ea\u9700\u5f15\u5165</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.carbondata&lt;/groupId&gt;\n    &lt;artifactId&gt;carbondata-store-sdk&lt;/artifactId&gt;\n    &lt;version&gt;1.6.1&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.carbondata&lt;/groupId&gt;\n    &lt;artifactId&gt;carbondata-core&lt;/artifactId&gt;\n    &lt;version&gt;1.6.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>CarbondataTest\u7c7b Demo</p> <ul> <li> <p>\u652f\u6301CSV, AVRO, JSON\u4e09\u79cd\u683c\u5f0f\u7684\u5b58\u50a8\u3002</p> </li> <li> <p>\u8bfb\u53d6\uff0c\u652f\u6301ArrowCarbonReader\u548cCarbonReader\uff1b</p> </li> </ul> <p>\u8bfb\u53d6\u7684\u65f6\u5019\u53ef\u4ee5\u8fdb\u884c\u5217\u9009\u62e9\u548c\u503c\u8fc7\u6ee4\uff08\u8c13\u8bcd\u4e0b\u63a8\uff09</p> <pre><code>CarbonReader reader = CarbonReader\n                .builder(path, \"_temp\")\n                .projection(new String[]{\"name\", \"age\"})\n                .filter(new GreaterThanExpression(new ColumnExpression(\"age\", DataTypes.INT),\n                        new LiteralExpression(2, DataTypes.INT)))\n                .build();\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/carbondata/usage.html#spark","title":"Spark\u96c6\u6210","text":"<p>carbon\u53ef\u4ee5\u4f5c\u4e3aSpark\u7684\u4e00\u79cd\u6570\u636e\u6e90\u4f7f\u7528\uff08\u7c7b\u4f3cParquet\uff09\u3002carbondata\u683c\u5f0f\u662fcarbon\u81ea\u5df1\u4f7f\u7528\u7684\u683c\u5f0f\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/usage.html#standalone","title":"Standalone","text":"<ul> <li> <p>carbondata\u9879\u76ee\u6e90\u7801\u7f16\u8bd1\u751f\u6210 <code>./assembly/target/scala-2.1x/carbondata_xxx.jar</code>\uff1b</p> </li> <li> <p>\u5c06carbondata\u7684jar\u5305\u6dfb\u52a0\u5230spark\u7684\u6240\u6709\u8282\u70b9\u7684classpath\u4e2d\uff1b</p> </li> <li> <p>\u914d\u7f6e<code>carbon.properties</code>\uff0c</p> </li> <li> <p>carbon.storelocation\uff1a\u5b58\u50a8\u6570\u636e\u7684\u76ee\u5f55\uff0c\u9ed8\u8ba4spark.sql.warehouse.dir\uff1b</p> </li> <li> <p><code>carbon.properties</code>\u4f20\u5230\u5404\u4e2a\u8282\u70b9\uff0c\u5728executor\u548cdriver\u542f\u52a8\u65f6\u6307\u5b9a</p> </li> </ul> <p><code>-Dcarbon.properties.filepath = ${PATH_TO}/carbon.properties</code></p>"},{"location":"data_system/1_data_organize/data_format/carbondata/usage.html#yarn","title":"Yarn","text":"<ul> <li>carbondata\u7684\u7f16\u8bd1\u540e\u7684jar\u5305\uff0c\u5e76\u521b\u5efa\u76ee\u5f55carbonlib\uff0c\u79fb\u5165\u540e\u518d\u8fdb\u884c\u538b\u7f29\uff1b</li> </ul> <pre><code>cd $SPARK_HOME\nmv carbon_*.jar carbonlib/\ntar -zcvf carbondata.tar.gz carbonlib/\nmv carbondata.tar.gz carbonlib/\n</code></pre> <ul> <li> <p>\u914d\u7f6ecarbon.properties\uff0ccarbon.storelocation;</p> </li> <li> <p>\u914d\u7f6eYarn</p> </li> <li> <p>spark.yarn.dist.files\uff1a\u6307\u5411 carbon.properties \u7684\u8def\u5f84\uff1b</p> </li> <li> <p>spark.yarn.dist.archives\uff1a<code>$SPARK_HOME/carbonlib/carbondata.tar.gz</code></p> </li> <li> <p>spark.executor.extraClassPath\uff1a<code>carbondata.tar.gz/carbonlib/*</code></p> </li> <li> <p>spark.driver.extraClassPath\uff1a<code>$SPARK_HOME/carbonlib/*</code></p> </li> <li> <p>\u914d\u7f6eexecutor\u548cdriver\u7684JVM\u53c2\u6570</p> <p><code>-Dcarbon.properties.filepath = carbon.properties</code></p> </li> </ul>"},{"location":"data_system/1_data_organize/data_format/carbondata/usage.html#thrift","title":"Thrift\u67e5\u8be2","text":"<pre><code>./bin/spark-submit \\\n--class org.apache.carbondata.spark.thriftserver.CarbonThriftServer \\\n$SPARK_HOME/carbonlib/$CARBON_ASSEMBLY_JAR &lt;carbon_store_path&gt;\n</code></pre> <p>\u9ed8\u8ba4\u7684\u662f\u591asession\u6a21\u5f0f\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/usage.html#presto","title":"Presto","text":"<p>\u6ce8\u610f\uff1aPresto\u4e0d\u80fd\u521b\u5efa\u6216\u52a0\u8f7dCarbonData\u8868\uff1b\u53ea\u80fd\u901a\u8fc7Spark\u6216\u8005Java/C++ SDK\u521b\u5efa\u3002</p>"},{"location":"data_system/1_data_organize/data_format/carbondata/usage.html#idea","title":"IDEA\u4e0b\u5f00\u53d1","text":"<p>Carbondata\u662f\u4f5c\u4e3aspark\u7684\u4e00\u79cd\u6570\u636e\u6e90\u4f7f\u7528\uff0c\u56e0\u6b64\u548cspark\u7248\u672c\u7d27\u8026\u5408\u3002</p> <p>\u56e0\u6b64\u5176maven\u4f9d\u8d56\u5f88\u96be\u6307\u5b9a\uff08\u56e0\u4e3a\u5176\u7248\u672c\u4e0d\u6e05\u695a\u548c\u54ea\u4e2aspark\u7248\u672c\u517c\u5bb9\uff09\u3002</p> <p>\u5efa\u8bae\uff1a\u9879\u76ee\u7684\u5f00\u53d1\u4ece\u5b98\u7f51\u4e0b\u8f7d\u5bf9\u5e94spark\u7248\u672ccarbon\u7684fat jar\uff0c\u7136\u540e\u5bfc\u5165\u4f5c\u4e3aIDEA\u7684\u4f9d\u8d56\u3002</p> <p>1.6.1\u4e0b\u7684\u5751</p> <ul> <li>carbon 1.6.1\u867d\u7136\u9ed8\u8ba4\u7684profile\u662f2.2.1\uff0c\u4f46\u662f\u4ed3\u5e93\u4e2d\u4e0b\u8f7d\u7684\u786e\u5b9e\u548cspark2.3.2\u5339\u914d\u7684jar\u5305\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/orc/acid.html","title":"Acid","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/orc/acid.html#acid","title":"ACID","text":"<p>\u652f\u6301\u4e8b\u52a1\uff0c\u5355\u6b21\u4e8b\u52a1\u53ef\u4ee5\u66f4\u65b0\u767e\u4e07\u884c\uff0c\u4f46\u662f\u4e0d\u652f\u6301\u6bcf\u5c0f\u65f6\u767e\u4e07\u7684\u4e8b\u52a1\uff1b</p> <p>HDFS\u662f\u4e00\u6b21\u5199\u7684\u6587\u4ef6\u7cfb\u7edf\uff0cORC\u662f\u4e00\u6b21\u5199\u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u4ee5 Base File + Delta File \u5f62\u5f0f\u5b9e\u73b0</p> <p>\u4f7f\u7528ACID\u65f6\uff0c\u7cfb\u7edf\u4f1a\u589e\u52a0delta\u76ee\u5f55\uff1a</p> ILENAME CONTENTS 00000_0 Bucket 0 base 00001_0 Bucket 1 base delta_0000005_0000005/bucket_00000 Transaction 5 to 5, bucket 0 delta delta_0000005_0000005/bucket_00001 Transaction 5 to 5, bucket 1 delta <p>\u5f53\u592a\u591a\u7684deltas\u76ee\u5f55\u65f6\uff0cminor compaction\u4f1a\u81ea\u52a8\u8fd0\u884c\u5e76\u4e14\u5c06\u591a\u4e2atransaction\u5408\u6210\u5355\u4e2adelta\uff1b</p> FILENAME CONTENTS 00000_0 Bucket 0 base 00001_0 Bucket 1 base delta_0000005_0000010/bucket_00000 Transaction 5 to 10, bucket 0 delta delta_0000005_0000010/bucket_00001 Transaction 5 to 10, bucket 1 delta <p>\u5f53deltas\u8db3\u591f\u5927\u65f6\uff0cmajor compaction\u4f1a\u5c06deltas\u5408\u5e76\u5e76\u91cd\u5199base\uff1a</p> FILENAME CONTENTS base_0000010/bucket_00000 Transactions upto 10, bucket 0 base base_0000010/bucket_00001 Transactions upto 10, bucket 1 base <p>\u8bfb\u53d6\u548c\u538b\u7f29\u4e0d\u9700\u8981\u9501\uff0c\u56e0\u6b64\u538b\u7f29\u4e0d\u80fd\u7834\u574f\u6027\u5730\u4fee\u6539\u5b83\u4eec\u7684\u8f93\u5165\uff0c\u800c\u662f\u5199\u5165\u65b0\u7684\u76ee\u5f55\u3002</p> <p>\u4e3a\u6240\u6709\u884c\u63d0\u4f9b\u4e00\u4e2a\u81ea\u52a8\u5206\u914d\u7684\u884cid&lt;\u539f\u59cb\u4e8b\u52a1id, bucket,  \u884cid&gt;\uff0c\u4fdd\u8bc1\u60df\u4e00\u3002\u6240\u6709\u66f4\u65b0\u548c\u5220\u9664\u64cd\u4f5c\u90fd\u5f15\u7528\u8fd9\u4e2a\u4e09\u5143\u7ec4\u3002</p> <p>ACID\u8868\u4e2d\u7684ORC\u6587\u4ef6\u6269\u5c55\u4e3a\u82e5\u5e72\u5217\u3002\u5b83\u4eec\u662f\u64cd\u4f5c(\u63d2\u5165\u3001\u66f4\u65b0\u6216\u5220\u9664)\u3001\u60df\u4e00\u6807\u8bc6\u884c\u7684\u4e09\u5143\u7ec4(\u539f\u59cb\u4e8b\u52a1\u3001\u6876\u3001rowId)\u548c\u5f53\u524d\u4e8b\u52a1\u3002</p> <pre><code>struct&lt;\n  operation: int,\n  originalTransaction: bigInt,\n  bucket: int,\n  rowId: bigInt,\n  currentTransaction: bigInt,\n  row: struct&lt;...&gt;\n&gt;\n</code></pre> <p>Operation\u7684\u503c\u4e3a\uff1a</p> OPERATION SERIALIZATION INSERT 0 UPDATE 1 DELETE 2 <ul> <li> <p>\u5f53\u5e94\u7528\u7a0b\u5e8f\u6216\u67e5\u8be2\u8bfb\u53d6ACID\u8868\u65f6\uff0creader\u63d0\u4f9b\u8981\u5305\u542b\u7684\u5df2\u63d0\u4ea4\u4e8b\u52a1\u5217\u8868\u3002\u8fd9\u4e2a\u5217\u8868\u662f\u5728\u67e5\u8be2\u5f00\u59cb\u65f6\u7531Hive metastore\u751f\u6210\u7684\u3002</p> </li> <li> <p>\u8be5\u4efb\u52a1\u6267\u884c\u5408\u5e76\u6392\u5e8f\u3002\u6bcf\u4e2a\u6587\u4ef6\u6309(\u521d\u59cb\u4e8b\u52a1\u5347\u5e8f\u3001\u6876\u5347\u5e8f\u3001rowId\u5347\u5e8f\u548c\u5f53\u524d\u4e8b\u52a1\u964d\u5e8f)\u6392\u5e8f\u3002</p> </li> <li> <p>\u53ea\u8fd4\u56de\u8981\u8bfb\u53d6\u7684\u4e8b\u52a1\u5217\u8868\u4e2d\u5305\u542bcurrentTransaction\u7684\u7b2c\u4e00\u4e2a\u8bb0\u5f55\uff0c\u5b83\u5bf9\u5e94\u4e8e\u5bf9\u884c\u7684\u6700\u540e\u4e00\u4e2a\u53ef\u89c1\u66f4\u65b0\u3002</p> </li> </ul> <p>TODO: \u6d41\u5f0fingest\u7684\u6269\u5c55\uff1f</p> <p>\u5728ORC\u6587\u4ef6\u7684\u5143\u6570\u636e\u4e2d\u6dfb\u52a0\u4e86\u4e24\u4e2a\u5c5e\u6027\uff0c\u4ee5\u52a0\u901fACID\u8868\u7684\u5904\u7406\u3002\u7279\u522b\u662f\uff0c\u5f53\u4e00\u4e2a\u4efb\u52a1\u6b63\u5728\u8bfb\u53d6\u4e00\u4e2abucket\u7684\u57fa\u672c\u6587\u4ef6\u7684\u4e00\u90e8\u5206\u65f6\uff0c\u5b83\u5c06\u4f7f\u7528\u7b2c\u4e00\u4e2a\u548c\u6700\u540e\u4e00\u4e2arowIds\u6765\u67e5\u627edelta\u6587\u4ef6\u4e2d\u7684\u5bf9\u5e94\u4f4d\u7f6e\u3002</p> KEY MEANING hive.acid.stats Number of inserts, updates, and deletes comma separated hive.acid.key.index The last originalTransaction, bucket, rowId for each stripe"},{"location":"data_system/1_data_organize/data_format/orc/conf.html","title":"Conf","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/orc/conf.html#_1","title":"\u914d\u7f6e","text":""},{"location":"data_system/1_data_organize/data_format/orc/conf.html#table-properties","title":"Table properties","text":"KEY DEFAULT NOTES orc.compress ZLIB high level compression = {NONE, ZLIB, SNAPPY} orc.compress.size 262,144 compression chunk size orc.stripe.size 67,108,864 memory buffer in bytes for writing orc.row.index.stride 10,000 number of rows between index entries orc.create.index true create indexes? orc.bloom.filter.columns \u201d\u201d comma separated list of column names orc.bloom.filter.fpp 0.05 bloom filter false positive rate <p>\u914d\u7f6e\u793a\u4f8b</p> <pre><code>CREATE TABLE istari (\n  name STRING,\n  color STRING\n) STORED AS ORC TBLPROPERTIES (\"orc.compress\"=\"NONE\");\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/orc/conf.html#configuration-properties","title":"Configuration properties","text":"KEY DEFAULT NOTES hive.default.fileformat TextFile This is the default file format for new tables. If it is set to ORC, new tables will default to ORC. hive.stats.gather.num.threads 10 Number of threads used by partialscan/noscan analyze command for partitioned tables. This is applicable only for file formats that implement the StatsProvidingRecordReader interface (like ORC). hive.exec.orc.memory.pool 0.5 Maximum fraction of heap that can be used by ORC file writers. hive.exec.orc.write.format NULL Define the version of the file to write. Possible values are 0.11 and 0.12. If this parameter is not defined, ORC will use the latest version. hive.exec.orc.default.stripe.size 67,108,864 Define the default size of ORC writer buffers in bytes. hive.exec.orc.default.block.size 268,435,456 Define the default file system block size for ORC files. hive.exec.orc.dictionary.key.size.threshold 0.8 If the number of keys in a dictionary is greater than this fraction of the total number of non-null rows, turn off dictionary encoding. Use 1.0 to always use dictionary encoding. hive.exec.orc.default.row.index.stride 10,000 Define the default number of rows between row index entries. hive.exec.orc.default.buffer.size 262,144 Define the default ORC buffer size, in bytes. hive.exec.orc.default.block.padding true Should ORC file writers pad stripes to minimize stripes that cross HDFS block boundaries. hive.exec.orc.block.padding.tolerance 0.05 Define the tolerance for block padding as a decimal fraction of stripe size (for example, the default value 0.05 is 5% of the stripe size). For the defaults of 64Mb ORC stripe and 256Mb HDFS blocks, a maximum of 3.2Mb will be reserved for padding within the 256Mb block with the default hive.exec.orc.block.padding.tolerance. In that case, if the available size within the block is more than 3.2Mb, a new smaller stripe will be inserted to fit within that space. This will make sure that no stripe written will cross block boundaries and cause remote reads within a node local task. hive.exec.orc.default.compress ZLIB Define the default compression codec for ORC file. hive.exec.orc.encoding.strategy SPEED Define the encoding strategy to use while writing data. Changing this will only affect the light weight encoding for integers. This flag will not change the compression level of higher level compression codec (like ZLIB). Possible options are SPEED and COMPRESSION. hive.orc.splits.include.file.footer false If turned on, splits generated by ORC will include metadata about the stripes in the file. This data is read remotely (from the client or HiveServer2 machine) and sent to all the tasks. hive.orc.cache.stripe.details.size 10,000 Cache size for keeping meta information about ORC splits cached in the client. hive.orc.compute.splits.num.threads 10 How many threads ORC should use to create splits in parallel. hive.exec.orc.skip.corrupt.data false If ORC reader encounters corrupt data, this value will be used to determine whether to skip the corrupt data or throw an exception. The default behavior is to throw an exception. hive.exec.orc.zerocopy false Use zerocopy reads with ORC. (This requires Hadoop 2.3 or later.) hive.merge.orcfile.stripe.level true When hive.merge.mapfiles, hive.merge.mapredfiles or hive.merge.tezfiles is enabled while writing a table with ORC file format, enabling this configuration property will do stripe-level fast merge for small ORC files. Note that enabling this configuration property will not honor the padding tolerance configuration (hive.exec.orc.block.padding.tolerance). hive.orc.row.index.stride.dictionary.check true If enabled dictionary check will happen after first row index stride (default 10000 rows) else dictionary check will happen before writing first stripe. In both cases, the decision to use dictionary or not will be retained thereafter. hive.exec.orc.compression.strategy SPEED Define the compression strategy to use while writing data. This changes the compression level of higher level compression codec. Value can be SPEED or COMPRESSION. orc.write.variable.length.blocks false Should the ORC writer use HDFS variable length blocks, if they are available? If the new stripe would straddle a block, Hadoop is \u2265 2.7, and this is enabled, it will end the block before the new stripe."},{"location":"data_system/1_data_organize/data_format/orc/datatypes.html","title":"Datatypes","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/orc/datatypes.html#_1","title":"\u6570\u636e\u7c7b\u578b","text":"<ul> <li>Integer</li> <li>boolean (1 bit)</li> <li>tinyint (8 bit)</li> <li>smallint (16 bit)</li> <li>int (32 bit)</li> <li>bigint (64 bit)</li> <li>Floating point</li> <li>float</li> <li>double</li> <li>String types</li> <li>string</li> <li>char</li> <li>varchar</li> <li>Binary blobs</li> <li>binary</li> <li>Date/time</li> <li>timestamp</li> <li>timestamp with local time zone</li> <li>date</li> <li>Compound types</li> <li>struct</li> <li>list</li> <li>map</li> <li>union</li> </ul> <p>\u590d\u5408\u7c7b\u578b\u7684\u5b50\u5217\u5305\u542b\u5b50\u5143\u7d20\u7684\u503c\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e\u7ed3\u6784\u7684\u6bcf\u4e2a\u5b57\u6bb5\uff0c\u7ed3\u6784\u5217\u90fd\u6709\u4e00\u4e2a\u5b50\u5217\u3002\u5217\u8868(List)\u603b\u662f\u6709\u4e00\u4e2a\u5b50\u5217\u7528\u4e8e\u5143\u7d20\u503c\uff0c\u800c\u6620\u5c04(Map)\u603b\u662f\u6709\u4e24\u4e2a\u5b50\u5217\u3002\u8054\u5408(Union)\u5217\u5bf9\u4e8e\u6bcf\u4e2a\u53d8\u4f53\u90fd\u6709\u4e00\u4e2a\u5b50\u5217\u3002</p>"},{"location":"data_system/1_data_organize/data_format/orc/datatypes.html#_2","title":"\u793a\u4f8b","text":"<pre><code>create table Foobar (\n myInt int,\n myMap map&lt;string,\n struct&lt;myString : string,\n myDouble: double&gt;&gt;,\n myTime timestamp\n);\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/orc/orc.html","title":"Orc","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/orc/orc.html#orcoptimized-row-columnar","title":"ORC(Optimized Row Columnar)","text":"<p>\u5f53\u524d\u662fv1\u7248\u672c\u3002</p> <p>\u73b0\u5728v2\u7248\u672c\u6b63\u5728\u5f00\u53d1</p>"},{"location":"data_system/1_data_organize/data_format/orc/orc.html#_1","title":"\u6587\u4ef6\u683c\u5f0f","text":"<p>\u6587\u4ef6\u5206\u6210Header\uff0cBody\uff0cTail \u4e09\u90e8\u5206\u3002</p> <ul> <li>Header\uff1a\u56fa\u5b9a\u7684ORC\u5b57\u7b26\u4e32\uff08\u4e09\u5b57\u8282\uff09\uff1b</li> <li>Body\uff1a\u884c\u548c\u7d22\u5f15\uff1b</li> <li>Tail\uff1a\u6587\u4ef6\u7ea7\u522b\u7684\u4fe1\u606f</li> </ul>"},{"location":"data_system/1_data_organize/data_format/orc/orc.html#stripes","title":"Stripes","text":"<p>\u4e00\u7ec4\u884c\u5f62\u6210\u4e00\u4e2astripe\uff0c\u6bcf\u6b21\u8bfb\u53d6\u6587\u4ef6\u662f\u4ee5\u884c\u7ec4\u4e3a\u5355\u4f4d\u7684\uff0c\u4e00\u822c\u4e3aHDFS\u7684\u5757\u5927\u5c0f\uff0c\u4fdd\u5b58\u4e86\u6bcf\u4e00\u5217\u7684\u7d22\u5f15\u548c\u6570\u636e\u3002</p> <ul> <li> <p>Index \u6570\u636e\uff1astripe\u5185\u7684\u884c\u7684\u7d22\u5f15\uff0c\u5217\u5f0f\u5b58\u50a8\uff1b</p> </li> <li> <p>Row Data\uff1a\u6570\u636e\uff0c\u5217\u5f0f\u5b58\u50a8\uff1b</p> </li> <li> <p>Stripe Footer\uff1a</p> </li> <li> <p>\u6bcf\u5217\u7684\u7f16\u7801\u4fe1\u606f\uff1b</p> </li> <li>stream\u7684\u4f4d\u7f6e\uff1b</li> </ul> <p>row group\uff1a\u7d22\u5f15\u7684\u6700\u5c0f\u5355\u4f4d\uff0c\u9ed8\u8ba4\u4e3a10000\u4e2a\u503c\u7ec4\u6210\uff0c\u4e00\u4e2astripe\u4e2d\u5305\u542b\u591a\u4e2arow group\u3002</p> <p>stream\uff1a\u4e00\u4e2astream\u8868\u793a\u6587\u4ef6\u4e2d\u4e00\u6bb5\u6709\u6548\u7684\u6570\u636e\uff0c\u5206\u4e3a\u7d22\u5f15\u548c\u6570\u636e\u4e24\u7c7b\u3002</p> <ul> <li>PRESENT\uff0cDATA\uff0cLENGTH\uff0cROW_INDEX\uff0cBLOOM_FILETER\u7b49\u7c7b\u578b\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/orc/orc.html#file-tail","title":"File Tail\uff08\u6587\u4ef6\u5c3e\u7aef\uff09\u683c\u5f0f","text":"<ul> <li>encrypted stripe statistics: list of ColumnarStripeStatistics</li> <li>stripe statistics: Metadata</li> <li>footer: Footer</li> <li>postscript: PostScript</li> <li>psLen: byte</li> </ul>"},{"location":"data_system/1_data_organize/data_format/orc/orc.html#postscript","title":"PostScript","text":"<p>\u7528\u6765\u89e3\u6790\u6587\u4ef6\u540e\u9762\u7684\u90e8\u5206\uff08File Footer\uff0cMetadata\uff0c\u6587\u4ef6\u7248\u672c\uff09\uff0c\u5176\u4e0d\u538b\u7f29\uff0c\u5e76\u4e14\u4f4d\u4e8e\u6587\u4ef6\u7684\u6700\u540e\u4e00\u4e2a\u5b57\u8282\uff08PostScript\u5e8f\u5217\u5316\u7684\u957f\u5ea6\uff0c\u5fc5\u987b\u5c0f\u4e8e255\uff09\u524d\u3002</p> <ul> <li>\u6587\u4ef6\u7684\u8bfb\u53d6\u662f\u4ece\u6587\u4ef6\u672b\u5c3e\u8bfb\u53d6\uff0c\u4e00\u6b21\u6027\u8bfb\u53d616K\uff08\u671f\u671b\u4e00\u6b21\u8bfb\u53d6Footer\u548cPostScript\uff0c\u800c\u4e0d\u662f\u591a\u6b21\u8bfb\u53d6\uff09\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/orc/orc.html#footer","title":"Footer","text":"<p>\u8868\u793a\u6587\u4ef6\u5185\u5bb9\u7684\u5e03\u5c40\uff0c\u7c7b\u578bschema\u4fe1\u606f\uff0c\u884c\u7684\u6570\u91cf\u548c\u5217\u7684\u7edf\u8ba1\u4fe1\u606f\u3002</p>"},{"location":"data_system/1_data_organize/data_format/orc/orc.html#file-metadata","title":"File Metadata","text":"<p>\u5305\u542bstripe\u7ea7\u522b\u7684\u5217\u7edf\u8ba1\u4fe1\u606f\uff0c\u53ef\u4ee5\u5bf9\u6bcf\u4e2aStripe\u8fdb\u884c\u8c13\u8bcd\u4e0b\u63a8\uff1b</p>"},{"location":"data_system/1_data_organize/data_format/orc/orc.html#index","title":"Index","text":"<p>\u884c\u7ec4\u7d22\u5f15\u7531\u6bcf\u4e2a\u539f\u59cb\u5217\u7684ROW_INDEX\u6d41\u7ec4\u6210\uff0c\u9ed8\u8ba410000\u884c\u4f5c\u4e3a\u4e00\u4e2arow group\u3002</p>"},{"location":"data_system/1_data_organize/data_format/orc/orc.html#_2","title":"\u7d22\u5f15","text":"<p>Orc \u6587\u4ef6\u6709\u4e09\u79cd\u7d22\u5f15\uff1a</p> <ul> <li>file\u7ea7\u522b\uff1astatistics about the values in each column across the entire file\uff08File Footer\u533a\uff09</li> <li>stripe \u7ea7\u522b\uff1astatistics about the values in each column for each stripe\uff08File Footer\u533a\uff09</li> <li>row \u7ea7\u522b\uff1astatistics about the values in each column for each set of 10,000 rows within a stripe</li> </ul>"},{"location":"data_system/1_data_organize/data_format/orc/orc.html#row-group-index","title":"Row Group Index","text":"<p>\u5217\u7684\u7edf\u8ba1\u4fe1\u606f</p> <ul> <li>min-max\uff1a\u6700\u5927\u3001\u6700\u5c0f</li> <li>sum\uff1a\u4e2a\u522b\u7c7b\u578b\uff08\u6570\u503c\u3001String\u7b49\uff09</li> <li>\u662f\u5426\u6709\u7a7a\u503c</li> </ul>"},{"location":"data_system/1_data_organize/data_format/orc/orc.html#bloom-filter-index","title":"Bloom Filter Index","text":"<p>\u6bcf\u5217\uff08<code>orc.bloom.filter.columns</code>\u6307\u5b9a\u7684\uff09\u6709BLOOM_FILTER \u6d41\uff0cBLOOM_FILTER\u6d41\u4e3a\u4e00\u5217\u4e2d\u7684\u6bcf\u4e2a\u884c\u7ec4\uff08\u9ed8\u8ba4\u4e3a10,000\u884c\uff09\u8bb0\u5f55\u4e00\u4e2aBloom\u7b5b\u9009\u5668\u6761\u76ee\u3002</p> <p>\u5e03\u9686\u8fc7\u6ee4\u5668\u6d41\u4e0e\u884c\u7ec4\u7d22\u5f15\u4ea4\u7ec7\u3002\u8fd9\u79cd\u653e\u7f6e\u65b9\u5f0f\u4f7f\u5728\u5355\u6b21\u8bfb\u53d6\u64cd\u4f5c\u4e2d\u540c\u65f6\u8bfb\u53d6Bloom\u7b5b\u9009\u5668\u6d41\u548c\u884c\u7d22\u5f15\u6d41\u53d8\u5f97\u5f88\u65b9\u4fbf\u3002</p> <p></p>"},{"location":"data_system/1_data_organize/data_format/orc/orc.html#_3","title":"\u52a0\u5bc6","text":"<p>\u652f\u6301\u5bf9\u6570\u636e\u8fdb\u884c\u52a0\u5bc6\uff0c\u5177\u4f53\u6d41\u7a0bTODO\u3002</p>"},{"location":"data_system/1_data_organize/data_format/orc/orc.html#_4","title":"\u538b\u7f29","text":"<p>\u5982\u679cORC\u6587\u4ef6\u7f16\u5199\u5668\u9009\u62e9\u901a\u7528\u538b\u7f29\u7f16\u89e3\u7801\u5668\uff08zlib\u6216snappy\uff09\uff0c\u5219\u4f7f\u7528\u8be5\u7f16\u89e3\u7801\u5668\u538b\u7f29ORC\u6587\u4ef6\u4e2d\u9664Postscript\u4ee5\u5916\u7684\u6240\u6709\u90e8\u5206\u3002</p> <p>\u8bfb\u53d6\u5668\u80fd\u591f\u8df3\u8fc7\u538b\u7f29\u7684\u5b57\u8282\u800c\u4e0d\u89e3\u538b\u7f29\u6574\u4e2a\u6d41\u3002</p> <p>\u6bcf\u4e2a\u6807\u5934\u7684\u957f\u5ea6\u4e3a3\u4e2a\u5b57\u8282\uff0c\u5176\u4e2d\uff08compressedLength * 2 + isOriginal\uff09\u5b58\u50a8\u4e3a\u5c0f\u5b57\u8282\u5e8f\u503c\u3002</p> <p></p>"},{"location":"data_system/1_data_organize/data_format/orc/orc.html#_5","title":"\u7f16\u7801","text":"<p>\u6bcf\u79cd\u7c7b\u578b\u91c7\u7528\u4e0d\u540c\u7684\u7f16\u7801\u65b9\u5f0f\uff0c\u5176\u5b58\u50a8\u4f7f\u7528\u7684stream\u7c7b\u578b\u4e5f\u4e0d\u76f8\u540c\u3002</p> <p>\u4ee5SmallInt\uff0cInt\uff0cBigInt\u7c7b\u578b\u4e3a\u4f8b\uff0c\u9700\u8981PRESENT\u548cDATA\u4e24\u79cdstream\u3002\u5982\u679c\u6570\u636e\u6ca1\u6709\u7a7a\u503c\uff0c\u5219PRESENT\u53ef\u4ee5\u4e0d\u5b58\u3002</p> ENCODING STREAM KIND OPTIONAL CONTENTS DIRECT PRESENT Yes Boolean RLE DATA No Signed Integer RLE v1 DIRECT_V2 PRESENT Yes Boolean RLE DATA No Signed Integer RLE v2"},{"location":"data_system/1_data_organize/data_format/orc/tool.html","title":"Orc Tool","text":"<p>https://orc.apache.org/docs/java-tools.html</p> <pre><code>% java -jar orc-tools-X.Y.Z-uber.jar &lt;sub-command&gt; &lt;args&gt;\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/orc/tool.html#meta","title":"Meta","text":"<ul> <li>meta - print the metadata of an ORC file</li> </ul> <pre><code>-j : format the output in JSON\n-p : pretty print the output\n-t : print the timezone of the writer\n\u2013rowindex : print the row indexes for the comma separated list of column ids\n\u2013recover : skip over corrupted values in the ORC file\n\u2013skip-dump : skip dumping the metadata\n\u2013backup-path : when used with \u2013recover specifies the path where the recovered file is written\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/orc/tool.html#data","title":"Data","text":"<ul> <li>data - print the data of an ORC file</li> </ul>"},{"location":"data_system/1_data_organize/data_format/orc/tool.html#scan","title":"Scan","text":"<ul> <li>scan (since ORC 1.3) - scan the data for benchmarking</li> </ul>"},{"location":"data_system/1_data_organize/data_format/orc/tool.html#convert","title":"Convert","text":"<ul> <li>convert (since ORC 1.4) - convert JSON files to ORC</li> </ul> <pre><code>-o : Sets the output ORC filename, which defaults to output.orc\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/orc/tool.html#json-schema","title":"JSON Schema","text":"<ul> <li>json-schema (since ORC 1.4) - determine the schema of JSON documents</li> </ul>"},{"location":"data_system/1_data_organize/data_format/orc/usage.html","title":"Usage","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/orc/usage.html#_1","title":"\u4f7f\u7528","text":""},{"location":"data_system/1_data_organize/data_format/orc/usage.html#java","title":"Java","text":""},{"location":"data_system/1_data_organize/data_format/orc/usage.html#vectorized-row-batch","title":"Vectorized Row Batch","text":"<p>\u6570\u636e\u4f5c\u4e3aVectorizedRowBatch\u7684\u5b9e\u4f8b\u4f20\u9012\u7ed9ORC\uff0c\u8be5\u5b9e\u4f8b\u5305\u542b1024\u884c\u6570\u636e\u3002</p> array ListColumnVector binary BytesColumnVector bigint LongColumnVector boolean LongColumnVector char BytesColumnVector date LongColumnVector decimal DecimalColumnVector double DoubleColumnVector float DoubleColumnVector int LongColumnVector map MapColumnVector smallint LongColumnVector string BytesColumnVector struct StructColumnVector timestamp TimestampColumnVector tinyint LongColumnVector uniontype UnionColumnVector varchar BytesColumnVector <p>BytesColumnVector\u4e2d\u6bcf\u4e2a\u6570\u636e\u8868\u793a\u4e3a\u5b57\u8282\u6570\u7ec4\u3001\u504f\u79fb\u91cf\u548c\u957f\u5ea6\u3002\u503c\u4e4b\u95f4\u53ef\u4ee5\u5171\u4eab\u5b57\u8282\u6570\u7ec4\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u5171\u4eab\u3002</p> <pre><code>public class BytesColumnVector extends ColumnVector {\n  public byte[][] vector;\n  public int[] start;\n  public int[] length;\n  ...\n}\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/orc/usage.html#_2","title":"\u5199\u793a\u4f8b","text":"<pre><code>Path testFilePath = new Path(\"advanced-example.orc\");\nConfiguration conf = new Configuration();\n\nTypeDescription schema = TypeDescription.fromString(\"struct&lt;first:int,\" +\n                               \"second:int,third:map&lt;string,int&gt;&gt;\");\n\nWriter writer = OrcFile.createWriter(testFilePath,\n        OrcFile.writerOptions(conf).setSchema(schema));\n\nVectorizedRowBatch batch = schema.createRowBatch();\nLongColumnVector first = (LongColumnVector) batch.cols[0];\nLongColumnVector second = (LongColumnVector) batch.cols[1];\n\n//Define map. You need also to cast the key and value vectors\nMapColumnVector map = (MapColumnVector) batch.cols[2];\nBytesColumnVector mapKey = (BytesColumnVector) map.keys;\nLongColumnVector mapValue = (LongColumnVector) map.values;\n\n// Each map has 5 elements\nfinal int MAP_SIZE = 5;\nfinal int BATCH_SIZE = batch.getMaxSize();\n\n// Ensure the map is big enough\nmapKey.ensureSize(BATCH_SIZE * MAP_SIZE, false);\nmapValue.ensureSize(BATCH_SIZE * MAP_SIZE, false);\n\n// add 1500 rows to file\nfor(int r=0; r &lt; 1500; ++r) {\n  int row = batch.size++;\n\n  first.vector[row] = r;\n  second.vector[row] = r * 3;\n\n  map.offsets[row] = map.childCount;\n  map.lengths[row] = MAP_SIZE;\n  map.childCount += MAP_SIZE;\n\n  for (int mapElem = (int) map.offsets[row]; mapElem &lt; map.offsets[row] + MAP_SIZE; ++mapElem) {\n    String key = \"row \" + r + \".\" + (mapElem - map.offsets[row]);\n    mapKey.setVal(mapElem, key.getBytes(StandardCharsets.UTF_8));\n    mapValue.vector[mapElem] = mapElem;\n  }\n  if (row == BATCH_SIZE - 1) {\n    writer.addRowBatch(batch);\n    batch.reset();\n  }\n}\nif (batch.size != 0) {\n  writer.addRowBatch(batch);\n  batch.reset();\n}\nwriter.close();\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/orc/usage.html#_3","title":"\u8bfb\u793a\u4f8b","text":"<pre><code>Reader reader = OrcFile.createReader(new Path(\"my-file.orc\"),\n                  OrcFile.readerOptions(conf));\n\n// \u9ed8\u8ba4 RecordReader \u8bfb\u53d6\u6240\u6709\u7684\u884c\u548c\u5217\nRecordReader rows = reader.rows();\nVectorizedRowBatch batch = reader.getSchema().createRowBatch();\n\nwhile (rows.nextBatch(batch)) {\n  for(int r=0; r &lt; batch.size; ++r) {\n    ... process row r from batch\n  }\n}\nrows.close();\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/parquet/bloomfilter.html","title":"Bloomfilter","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/parquet/bloomfilter.html#_1","title":"\u5e03\u9686\u8fc7\u6ee4\u5668","text":"<p>https://github.com/apache/parquet-format/blob/master/BloomFilter.md</p>"},{"location":"data_system/1_data_organize/data_format/parquet/columnindex.html","title":"Columnindex","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/parquet/columnindex.html#columnindex","title":"ColumnIndex","text":"<p>Column Index pages \u5b58\u50a8\u5728 Parquet footer\u4e2d\u3002</p>"},{"location":"data_system/1_data_organize/data_format/parquet/columnindex.html#_1","title":"\u95ee\u9898\u63cf\u8ff0","text":"<p>\u5728\u4ee5\u524d\u7248\u672c\u4e2d\uff0ccolumn chunk\u7684\u7edf\u8ba1\u4fe1\u606f\u5b58\u50a8\u5728ColumnMetaData\u4e2d\uff0c\u6bcf\u9875\u7684\u7edf\u8ba1\u4fe1\u606f\u5b58\u50a8\u5728DataPageHeader\u7ed3\u6784\u4f53\u4e2d\u3002\u5f53\u8bfb\u53d6\u9875\u65f6\uff0creader\u5fc5\u987b\u5904\u7406page header\uff0c\u4ee5\u786e\u5b9a\u662f\u5426\u53ef\u4ee5\u6839\u636e\u7edf\u8ba1\u6570\u636e\u8df3\u8fc7\u8be5\u9875\u3002\u8fd9\u610f\u5473\u7740reader\u5fc5\u987b\u8bbf\u95ee\u5217\u4e2d\u7684\u6240\u6709\u9875\uff0c\u56e0\u6b64\u53ef\u80fd\u4ece\u78c1\u76d8\u8bfb\u53d6\u5927\u90e8\u5206\u5217\u6570\u636e\u3002</p>"},{"location":"data_system/1_data_organize/data_format/parquet/columnindex.html#_2","title":"\u76ee\u6807","text":"<ul> <li>Range scan\u6216\u8005\u5355\u70b9\u67e5\u8be2 IO \u66f4\u6709\u6548\uff0c\u53ef\u4ee5\u6839\u636e\u6700\u5c0f/\u6700\u5927\u503c\u76f4\u63a5\u8bbf\u95ee\u9875\uff1a</li> <li>\u5728\u57fa\u4e8e\u884c\u7ec4\u7684\u6392\u5e8f\u5217\u7684\u884c\u7ec4\u4e2d\u8fdb\u884c\u5355\u884c\u67e5\u627e\u65f6\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u68c0\u7d22\u5230\u7684\u5217\u53ea\u8bfb\u53d6\u4e00\u4e2a\u6570\u636e\u9875\uff1a</li> <li>\u5bf9\u6392\u5e8f\u5217\u7684\u8303\u56f4\u626b\u63cf\u53ea\u9700\u8981\u8bfb\u53d6\u5305\u542b\u76f8\u5173\u6570\u636e\u7684\u786e\u5207\u6570\u636e\u9875\uff1b</li> <li>\u63d0\u9ad8\u5176\u4ed6\u9009\u62e9\u6027\u626b\u63cfI/O\u6548\u7387:\u5982\u679c\u6211\u4eec\u5728\u4e00\u4e2a\u975e\u6392\u5e8f\u5217\u4e0a\u6709\u4e00\u4e2a\u9009\u62e9\u6027\u7684\u8c13\u8bcd\uff0c\u90a3\u4e48\u5bf9\u4e8e\u5176\u4ed6\u68c0\u7d22\u5230\u7684\u5217\uff0c\u6211\u4eec\u5e94\u8be5\u53ea\u9700\u8981\u8bbf\u95ee\u5305\u542b\u5339\u914d\u884c\u7684\u6570\u636e\u9875\u3002</li> <li> <p>\u6ca1\u6709\u9009\u62e9\u6027\u8c13\u8bcd\u7684\u626b\u63cf\u65e0\u9700\u989d\u5916\u7684\u89e3\u7801\u5de5\u4f5c\uff0c\u4f8b\u5982\u5168\u884c\u7ec4\u626b\u63cf\u3002\u5982\u679creader\u786e\u5b9a\u4e0d\u9700\u8981\u8bfb\u53d6\u7d22\u5f15\u6570\u636e\uff0c\u5219\u4e0d\u4f1a\u4ea7\u751f\u4efb\u4f55\u5f00\u9500\u3002</p> </li> <li> <p>\u901a\u8fc7\u53ea\u5b58\u50a8\u9875\u9762\u4e4b\u95f4\u7684\u8fb9\u754c\u5143\u7d20\uff0c\u4f7f\u5f97\u6392\u5e8f\u5217\u7684index pages\u4f7f\u7528\u4e86\u6700\u5c0f\u7684\u5b58\u50a8\u7a7a\u95f4\u3002</p> </li> </ul>"},{"location":"data_system/1_data_organize/data_format/parquet/columnindex.html#_3","title":"\u975e\u76ee\u6807","text":"<ul> <li>\u652f\u6301\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5373\u6839\u636e\u952e\u503c\u5bf9\u672a\u6392\u5e8f\u7684\u6570\u636e\u8fdb\u884c\u6392\u5e8f\u7684\u7d22\u5f15\u7ed3\u6784\u3002</li> </ul>"},{"location":"data_system/1_data_organize/data_format/parquet/columnindex.html#_4","title":"\u6280\u672f\u65b9\u6cd5","text":"<p>\u5bf9\u6bcf\u5217\u589e\u52a0\u4e24\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u5b58\u50a8\u5728row group metadata\u4e2d\uff1a</p> <ul> <li><code>ColumnIndex</code>\uff1a\u8fd9\u5141\u8bb8\u6839\u636e\u5217\u503c\u5bfc\u822a\u5230\u5217\u7684\u9875\uff0c\u5e76\u7528\u4e8e\u5b9a\u4f4d\u5305\u542b\u626b\u63cf\u8c13\u8bcd\u5339\u914d\u503c\u7684\u6570\u636e\u9875\uff1b</li> <li><code>OffsetIndex</code>\uff1a\u5141\u8bb8\u6309\u884c\u7d22\u5f15\u8fdb\u884c\u5bfc\u822a\uff0c\u7528\u4e8e\u901a\u8fc7ColumnIndex\u68c0\u7d22\u6807\u8bc6\u4e3a\u5339\u914d\u7684\u884c\u7684\u503c\u3002\u8df3\u8fc7\u4e00\u5217\u4e2d\u7684\u884c\u540e\uff0c\u5fc5\u987b\u8df3\u8fc7\u5176\u4ed6\u5217\u4e2d\u7684\u76f8\u5e94\u884c\u3002\u56e0\u6b64\uff0cRowGroup\u4e2d\u6bcf\u4e2a\u5217\u7684OffsetIndexes\u90fd\u5b58\u50a8\u5728\u4e00\u8d77\u3002</li> </ul> <p>\u65b0\u7684\u7d22\u5f15\u7ed3\u6784\u4e0eRowGroup\u5206\u5f00\u5b58\u50a8\uff0c\u4f4d\u4e8efooter\u9644\u8fd1\u3002</p> <p>\u8fd9\u6837\u505a\u662f\u4e3a\u4e86\u8ba9reader\u4e0d\u5fc5\u4e3a\u8bfb\u53d6\u5b83\u4eec\u800c\u652f\u4ed8I/O\u548c\u53cd\u5e8f\u5217\u5316\u6210\u672c\uff0c\u5982\u679c\u5b83\u6ca1\u6709\u8fdb\u884c\u9009\u62e9\u6027\u626b\u63cf\u7684\u8bdd\u3002</p> <p>\u7d22\u5f15\u7ed3\u6784\u7684\u4f4d\u7f6e\u548c\u957f\u5ea6\u5b58\u50a8\u5728ColumnChunk\u4e2d\u3002</p> <p></p> <ul> <li>\u4e0d\u9700\u8981\u8bb0\u5f55\u7b2c\u4e00\u4e2a\u9875\u7684\u4e0b\u754c\u548c\u6700\u540e\u4e00\u4e2a\u9875\u7684\u4e0a\u754c\uff0c\u56e0\u4e3a\u884c\u7ec4\u7edf\u8ba1\u4fe1\u606f\u53ef\u4ee5\u63d0\u4f9b\u8fd9\u4e00\u70b9\u3002\u4e3a\u4e86\u4fdd\u6301\u4e00\u81f4\u6027\uff0c\u6211\u4eec\u4ecd\u7136\u5305\u62ec\u8fd9\u4e9b\uff0c\u5f00\u9500\u5e94\u8be5\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\u3002</li> <li>\u4e3a\u6bcf\u4e2a\u9875\u9762\u7684\u503c\u5b58\u50a8\u4e0b\u754c\u548c\u4e0a\u754c\u3002\u8fd9\u4e9b\u503c\u53ef\u4ee5\u662f\u9875\u9762\u4e0a\u5b9e\u9645\u627e\u5230\u7684\u6700\u5c0f\u503c\u548c\u6700\u5927\u503c\uff0c\u4f46\u4e5f\u53ef\u4ee5\u662f\u9875\u9762\u4e0a\u4e0d\u5b58\u5728\u7684\u503c\u3002\u4f8b\u5982\uff0c\u5199\u5165\u5668\u53ef\u4ee5\u8bbe\u7f6emin_values[i]=\"B\"\uff0c max_values[i]=\"C\"\uff0c\u800c\u4e0d\u662f\u5b58\u50a8\"\"Blart Versenwald III\"\u3002\u8fd9\u5141\u8bb8\u5199\u5165\u5668\u622a\u65ad\u8f83\u5927\u7684\u503c\uff0c\u5199\u5165\u5668\u5e94\u8be5\u4f7f\u7528\u5b83\u5bf9\u7d22\u5f15\u7ed3\u6784\u7684\u5927\u5c0f\u5b9e\u65bd\u4e00\u4e9b\u5408\u7406\u7684\u9650\u5236\u3002</li> <li>\u652f\u6301columnIndex\u7684Readers\u4e0d\u8981\u4f7f\u7528page statistics.\u3002\u5728\u5199columnIndex\u65f6\u5199page=level\u7edf\u8ba1\u4fe1\u606f\uff0c\u4ec5\u4ec5\u662f\u4e3a\u4e86\u652f\u6301\u65e7\u7248\u672c\u7684reader\u3002</li> </ul> <p>\u5bf9\u4e8e\u6709\u5e8f\u7684\u5217\uff0c\u8fd9\u5141\u8bb8reader\u901a\u8fc7\u5728min_values\u548cmax_values\u4e2d\u6267\u884c\u4e8c\u5206\u641c\u7d22\u6765\u67e5\u627e\u5339\u914d\u7684\u9875\u3002</p> <p>\u5bf9\u4e8e\u65e0\u5e8f\u5217\uff0creader\u53ef\u4ee5\u901a\u8fc7\u987a\u5e8f\u8bfb\u53d6min_values\u548cmax_values\u6765\u627e\u5230\u5339\u914d\u7684\u9875\u3002</p> <p>\u5bf9\u4e8e\u8303\u56f4\u626b\u63cf\uff0c\u8fd9\u79cd\u65b9\u6cd5\u53ef\u4ee5\u6269\u5c55\u4e3a\u8fd4\u56de\u8981\u626b\u63cf\u7684\u6bcf\u5217\u4e2d\u7684\u884c\u3001\u9875\u7d22\u5f15\u548c\u9875\u504f\u79fb\u91cf\u7684\u8303\u56f4\u3002\u7136\u540e\uff0c\u8bfb\u53d6\u5668\u53ef\u4ee5\u4e3a\u6bcf\u5217\u521d\u59cb\u5316\u4e00\u4e2a\u626b\u63cf\u5668\uff0c\u5e76\u5c06\u5b83\u4eec\u5feb\u8fdb\u5230\u626b\u63cf\u7684\u8d77\u59cb\u884c\u3002</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html","title":"Conf","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#_1","title":"\u914d\u7f6e","text":""},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#overall","title":"Overall","text":""},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#row-group-size","title":"Row Group size","text":"<p>Row group\u8d8a\u5927\uff0ccolumn chunks\u8d8a\u5927\uff0c\u53ef\u4ee5\u652f\u6301\u66f4\u5927\u7684\u987a\u5e8fIO\u3002\u4f46\u662f\u5199\u7684\u65f6\u5019\u9700\u8981\u66f4\u591a\u7684buffer\u6216\u8005\u4e24\u6b21\u5199\u3002\u63a8\u8350\u5927\u5c0f\u4e3a512M~1G\u3002</p> <p>Row group\u5927\u5c0f\u548cHDFS block\u914d\u7f6e\u4e00\u6837\u6700\u597d\u3002</p> <p>An optimized read setup would be: 1GB row groups, 1GB HDFS block size, 1 HDFS block per HDFS file.</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#data-page-size","title":"Data Page size","text":"<p>Data page\u662f\u4e0d\u53ef\u5206\u5272\u7684\uff0c\u5c0f\u7684data page\u5141\u8bb8\u66f4\u7ec6\u7c92\u5ea6\u7684\u8bfb\uff08\u5982\u5355\u884c\u67e5\u627e\uff09\uff0c\u5927\u7684page size\u4f1a\u964d\u4f4e\u7a7a\u95f4\u548c\u89e3\u6790\u5f00\u9500\u3002\u63a8\u83508KB\u3002</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#hadoop","title":"Hadoop","text":"<p>\u8981\u4f7f\u7528InputFormat\u6216OutputFormat\uff0c\u9700\u8981\u5b9e\u73b0WriteSupport\u6216ReadSupport\u7c7b\uff0c\u5b83\u4eec\u5c06\u5b9e\u73b0\u5bf9\u8c61\u4e0eParquet\u7684\u8f6c\u6362\u3002</p> <p>Parquet\u9879\u76ee\u5df2\u7ecf\u5185\u7f6e\u4e86Thrift\u3001Avro\u548cProtobuf\u7684\u5b9e\u73b0\u3002</p> <p>https://github.com/apache/parquet-mr/tree/master/parquet-hadoop#class-parquetoutputformat</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetoutputformat","title":"ParquetOutputFormat","text":""},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetsummarymetadatalevel","title":"parquet.summary.metadata.level","text":"<p>Description \uff1a \u5728\u4e0eparquet\u6587\u4ef6\u76f8\u540c\u7684\u76ee\u5f55\u4e2d\u5199\u5165summary \u6587\u4ef6\u3002</p> <ul> <li>all</li> <li>common_only</li> <li>none</li> </ul> <p>Default value \uff1a <code>all</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetenablesummary-metadata","title":"parquet.enable.summary-metadata","text":"<p>Description: Deprecated, use <code>parquet.summary.metadata.level</code> instead.</p> <ul> <li> <p>true\uff1a\u7b49\u4ef7\u4e8e<code>parquet.summary.metadata.level</code> \u503c\u4e3a all\uff1b</p> </li> <li> <p>false\uff1a\u7b49\u4ef7\u4e8e<code>parquet.summary.metadata.level</code> \u503c\u4e3a none\uff1b</p> </li> </ul> <p>Default value \uff1a <code>true</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetblocksize","title":"parquet.block.size","text":"<p>Description: Block \u5927\u5c0f\uff08bytes\uff09</p> <ul> <li> <p>block_size = max(default_fs_block_size, parquet.block.size)</p> </li> <li> <p>row_group_size = <code>parquet.block.size</code></p> </li> </ul> <p>Default value \uff1a <code>134217728</code> (128 MB)</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetpagesize","title":"parquet.page.size","text":"<p>Description \uff1apage size in bytes is for compression. \u6bcf\u4e2aPage\u53ef\u4ee5\u72ec\u7acb\u89e3\u538b\u7f29\u3002</p> <ul> <li>\u9875\u662f\u5fc5\u987b\u5b8c\u5168\u8bfb\u53d6\u624d\u80fd\u8bbf\u95ee\u5355\u4e2a\u8bb0\u5f55\u7684\u6700\u5c0f\u5355\u5143\u3002\u503c\u4e0d\u5b9c\u8fc7\u5c0f\u3002</li> </ul> <p>Default value \uff1a <code>1048576</code> (1 MB)</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetcompression","title":"parquet.compression","text":"<p>Description\uff1a\u538b\u7f29page\u7684\u7b97\u6cd5\uff0c\u66ff\u4ee3<code>mapred.output.compresss*</code></p> <ul> <li>\u503c\u53ef\u4ee5\u662f<code>uncompressed</code>, <code>snappy</code>, <code>gzip</code> or <code>lzo</code>, <code>brotli</code>,<code>lz4</code> and <code>zstd</code>\uff1b</li> <li>\u5982\u679c\u503c\u672a\u8bbe\u7f6e\uff0c<code>FileOutputFormat</code>\u4f1a\u4f7f\u7528\u4ee5\u4e0b\u53c2\u6570</li> <li><code>mapreduce.output.fileoutputformat.compress</code></li> <li><code>mapreduce.output.fileoutputformat.compress.codec</code></li> </ul> <p>Default value \uff1a <code>uncompressed</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetwritesupportclass","title":"parquet.write.support.class","text":"<p>Description \uff1awrite suuport \u7c7b\uff0c\u5fc5\u987b\u662f<code>org.apache.parquet.hadoop.api.WriteSupport</code>\u5b50\u7c7b\u3002</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetenabledictionary","title":"parquet.enable.dictionary","text":"<p>Description\uff1a\u662f\u5426\u542f\u52a8\u8bcd\u5178\u7f16\u7801\uff0ctrue \u6216 false</p> <ul> <li>\u53ef\u4ee5\u4e3a\u5355\u72ec\u7684\u5217\u6307\u5b9a\u662f\u5426\u542f\u52a8\u8bcd\u5178\u7f16\u7801</li> </ul> <pre><code>// Enable dictionary encoding for all columns\nconf.set(\"parquet.enable.dictionary\", true);\n// Disable dictionary encoding for 'column.path'\nconf.set(\"parquet.enable.dictionary#column.path\", false);\n// The final configuration will be: Enable dictionary encoding for all columns except 'column.path'\n</code></pre> <p>Default value \uff1a <code>true</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetdictionarypagesize","title":"parquet.dictionary.page.size","text":"<p>Description\uff1a\u8bcd\u5178\u9875\u7684\u5927\u5c0f\u3002</p> <ul> <li>\u5f53\u542f\u52a8\u8bcd\u5178\u7f16\u7801\u65f6\uff0c\u6bcf\u4e2arow group\u4e2d\u6bcf\u5217\u90fd\u6709\u4e00\u4e2a\u8bcd\u5178\u9875\u3002</li> </ul> <p>Default value \uff1a <code>1048576</code> (1 MB)</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetvalidation","title":"parquet.validation","text":"<p>Description\uff1a\u662f\u5426\u4f7f\u7528schema\u9a8c\u8bc1</p> <p>Default value \uff1a <code>false</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetwriterversion","title":"parquet.writer.version","text":"<p>Description\uff1a<code>PARQUET_1_0</code> or <code>PARQUET_2_0</code></p> <ul> <li><code>PARQUET_1_0</code> \uff1aDataPageHeaderV1</li> <li><code>PARQUET_2_0</code> \uff1aDataPageHeaderV2</li> </ul> <p>Default value \uff1a <code>PARQUET_1_0</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetmemorypoolratio","title":"parquet.memory.pool.ratio","text":"<p>Description\uff1a\u5185\u5b58\u7ba1\u7406\u5668\u901a\u8fc7\u8be5\u53c2\u6570\u5747\u8861\u6bcf\u4e2aParquet writer\u7684\u5206\u914d\u5927\u5c0f\uff0c0\u52301\u3002</p> <ul> <li>\u5982\u679c\u6240\u6709writer\u7684\u5206\u914d\u5927\u5c0f\u8d85\u8fc7\u603b\u548c\uff08total memory pool\uff09\uff0c\u5219\u5bf9\u6bcf\u4e2awriter\u7684\u5206\u914d\u5927\u5c0f\u4e58\u4ee5\u8be5\u503c\u3002</li> </ul> <p>Default value \uff1a <code>0.95</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetmemoryminchunksize","title":"parquet.memory.min.chunk.size","text":"<p>Description\uff1a\u6bcf\u4e2aParquet writer\u7684\u6700\u5c0f\u5206\u914d\u503c\u3002</p> <ul> <li>\u5982\u679c\u5206\u914d\u503c\u5c0f\u4e8e\u8be5\u53c2\u6570\uff0c\u5219memory manager\u629b\u51fa\u5f02\u5e38\u3002 </li> </ul> <p>Default value \uff1a <code>1048576</code> (1 MB)</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetwritermax-padding","title":"parquet.writer.max-padding","text":"<p>Description\uff1a\u4e3a\u4e86\u5bf9\u9f50row group\u7684\u6700\u5927\u586b\u5145\u7684\u5b57\u8282\u5927\u5c0f\u3002</p> <p>Default value \uff1a <code>8388608</code> (8 MB)</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetpagesizerowcheckminmax","title":"parquet.page.size.row.check.min/max","text":"<p>Description\uff1a\u68c0\u67e5\u9875\u9762\u5927\u5c0f\u9650\u5236\u7684\u9891\u7387\uff0c\u4ecb\u4e8e<code>parquet.page.size.row.check.min</code> \u548c<code>parquet.page.size.row.check.max</code>\u4e4b\u95f4\u3002</p> <ul> <li>\u9891\u7387\u9ad8\uff0c\u5219page size\u66f4\u7cbe\u786e\uff1b</li> <li>\u9891\u7387\u4f4e\uff0c\u5219\u6027\u80fd\u66f4\u597d\u3002</li> </ul> <p>Default value \uff1a <code>10000</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetpagesizecheckestimate","title":"parquet.page.size.check.estimate","text":"<p>Description\uff1a\u5982\u679c\u4e3a<code>true</code>\uff0c\u5219colum writer\u4f30\u8ba1\u4e0b\u4e00\u9875\u7684\u5927\u5c0f\u3002</p> <p>Default value \uff1a <code>true</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetcolumnindextruncatelength","title":"parquet.columnindex.truncate.length","text":"<p>Description\uff1a\u5217\u7d22\u5f15\u5305\u542b\u5217\u5757\u4e2d\u9875\u7684\u6700\u5c0f/\u6700\u5927\u548c\u7a7a\u8ba1\u6570\u503c</p> <ul> <li>\u5982\u679c\u53ef\u80fd\u7684\u8bdd\uff0c\u6b64\u5c5e\u6027\u662f\u7528\u4e8e\u622a\u65ad\u4e8c\u8fdb\u5236\u5217\u7d22\u5f15\u4e2d\u7684\u4e8c\u8fdb\u5236\u503c\u7684\u957f\u5ea6\u3002</li> </ul> <p>Default value \uff1a <code>64</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetstatisticstruncatelength","title":"parquet.statistics.truncate.length","text":"<p>Description\uff1a\u884c\u7ec4\u4e2d\u7684\u6700\u5c0f/\u6700\u5927\u4e8c\u8fdb\u5236\u503c\u8bd5\u56fe\u622a\u65ad\u4e3a\u7684\u957f\u5ea6\u3002</p> <p>Default value \uff1a <code>2147483647</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetbloomfilterenabled","title":"parquet.bloom.filter.enabled","text":"<p>Description\uff1a\u662f\u5426\u91c7\u7528bloom\u8fc7\u6ee4\u5668</p> <ul> <li>\u53ef\u4ee5\u5355\u72ec\u6307\u5b9a\u67d0\u4e9b\u5217\u542f\u7528bloom\u8fc7\u6ee4\u5668\uff0c\u901a\u8fc7<code>#</code>\u3002</li> </ul> <pre><code>conf.set(\"parquet.bloom.filter.enabled#column.path\", false);\n</code></pre> <p>Default value \uff1a <code>false</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetbloomfilterexpectedndv","title":"parquet.bloom.filter.expected.ndv","text":"<p>Description\uff1a\u5217\u4e2d\u4e0d\u540c\u503c\u7684\u671f\u671b\u503c\uff0c\u7528\u4e8e\u8ba1\u7b97Bloom\u8fc7\u6ee4\u5668\u7684\u6700\u4f73\u957f\u5ea6\u3002</p> <pre><code>// The bloom filter will be enabled for 'column.path' with expected number of distinct values equals to 200\nconf.set(\"parquet.bloom.filter.expected.ndv#column.path\", 200)\n</code></pre> <p>Default value \uff1a <code>parquet.bloom.filter.max.bytes</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetbloomfiltermaxbytes","title":"parquet.bloom.filter.max.bytes","text":"<p>Description\uff1a\u5e03\u9686\u8fc7\u6ee4\u5668bitset\u7684\u6700\u5927\u5b57\u8282\u6570</p> <p>Default value \uff1a <code>1048576</code> (1MB)</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetpagerowcountlimit","title":"parquet.page.row.count.limit","text":"<p>Description\uff1a\u6bcf\u9875\u4e2d\u6700\u5927\u7684\u884c\u7684\u4e2a\u6570</p> <p>Default value \uff1a <code>20000</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetpagewrite-checksumenabled","title":"parquet.page.write-checksum.enabled","text":"<p>Description\uff1a\u662f\u5426\u5199\u9875\u7684\u6821\u9a8c\u548c</p> <p>Default value \uff1a <code>true</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetcryptofactoryclass","title":"parquet.crypto.factory.class","text":"<p>Description\uff1a Class implementing EncryptionPropertiesFactory</p> <p>Default value \uff1a  None</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parqauetinputformat","title":"ParqauetInputFormat","text":""},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetreadsupportclass","title":"parquet.read.support.class","text":"<p>Description\uff1aParquetInputFormat\u4f7f\u7528\u7684read support \u7c7b\u8fdb\u884c\u7269\u5316\u8bb0\u5f55\uff08materialize records\uff09\u3002</p> <ul> <li><code>org.apache.parquet.hadoop.api.ReadSupport</code> \u5b50\u7c7b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetreadfilter","title":"parquet.read.filter","text":"<p>Description\uff1a<code>org.apache.parquet.filter.UnboundRecordFilter</code>\u7684\u5b50\u7c7b\uff0c\u65e7\u7684filter API\u3002</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetprivatereadfilterpredicate","title":"parquet.private.read.filter.predicate","text":"<p>Description\uff1a\u65b0\u7684filter API\uff0c\u7ee7\u627f <code>org.apache.parquet.filter2.FilterPredicate</code></p> <ul> <li> <p>\u8be5\u5c5e\u6027\u503c\uff1a\u5148\u5bf9java\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\u8fdb\u884cgzip\u538b\u7f29\uff0c\u7136\u540ebase64\u7f16\u7801\u6210byte\u6570\u7ec4\uff0c\u518d\u6784\u9020\u4e3aUTF-8 String\uff1b</p> </li> <li> <p>\u65b0\u7684filter API\u53ef\u4ee5\u8fc7\u6ee4\u8bb0\u5f55\u6216\u8fc7\u6ee4\u8bb0\u5f55\u7684\u6574\u884c\u7ec4\uff0c\u800c\u4e0d\u9700\u8981\u8bfb\u53d6\u5b83\u4eec\u3002</p> </li> <li>\u65b0\u548c\u65e7\u7684filter API\u53ea\u80fd\u9009\u5176\u4e00\uff1b</li> <li>\u901a\u8fc7<code>ParquetInputFormat.setFilterPredicate</code>\u624b\u52a8\u8bbe\u7f6efilter\u7c7b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetstricttyping","title":"parquet.strict.typing","text":"<p>Description\uff1a\u662f\u5426\u4e3a\u6709\u51b2\u7a81\u7684schema\u542f\u7528\u7c7b\u578b\u68c0\u67e5\u3002</p> <p>Default value \uff1a <code>true</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetfilterrecord-levelenabled","title":"parquet.filter.record-level.enabled","text":"<p>Description\uff1a\u662f\u5426\u542f\u7528\u8bb0\u5f55\u7ea7\u7b5b\u9009\u3002</p> <p>Default value \uff1a <code>true</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetfilterstatsenabled","title":"parquet.filter.stats.enabled","text":"<p>Description \uff1a\u662f\u5426\u542f\u7528\u884c\u7ec4\u7edf\u8ba1\u4fe1\u606f\u7b5b\u9009\u3002</p> <p>Default value \uff1a <code>true</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetfilterdictionaryenabled","title":"parquet.filter.dictionary.enabled","text":"<p>Description \uff1a\u662f\u5426\u542f\u7528\u884c\u7ec4\u5b57\u5178\u7b5b\u9009\u3002</p> <p>Default value \uff1a <code>true</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetfiltercolumnindexenabled","title":"parquet.filter.columnindex.enabled","text":"<p>Description \uff1a\u662f\u5426\u542f\u7528\u9875\u7684\u5217\u7d22\u5f15\u7b5b\u9009\u3002</p> <p>Default value \uff1a <code>true</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetpageverify-checksumenabled","title":"parquet.page.verify-checksum.enabled","text":"<p>Description \uff1a\u662f\u5426\u542f\u7528\u9875\u7ea7\u6821\u9a8c\u548c\u9a8c\u8bc1\u3002</p> <p>Default value \uff1a <code>false</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetfilterbloomenabled","title":"parquet.filter.bloom.enabled","text":"<p>Description \uff1a\u662f\u5426\u542f\u7528\u884c\u7ec4Bloom\u8fc7\u6ee4\u3002</p> <p>Default value \uff1a <code>true</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquettasksidemetadata","title":"parquet.task.side.metadata","text":"<p>Description\uff1a \u662f\u5426\u6253\u5f00\u6216\u5173\u95ed\u4efb\u52a1\u7aef\u5143\u6570\u636e\u52a0\u8f7d:</p> <ul> <li><code>true</code> \uff1a\u5728\u4efb\u52a1\u7aef\u8bfb\u53d6\u5143\u6570\u636e\uff0c\u4e00\u4e9b\u4efb\u52a1\u53ef\u80fd\u4f1a\u7acb\u5373\u5b8c\u6210\u3002</li> <li><code>false</code> \uff1a\u5143\u6570\u636e\u5728\u5ba2\u6237\u7aef\u8bfb\u53d6\uff0c\u5982\u679c\u6709\u5927\u91cf\u5143\u6570\u636e\uff0c\u8bfb\u53d6\u901f\u5ea6\u4f1a\u6162\u4e00\u4e9b\u3002\u4f46\u53ea\u6709\u5728\u6709\u5de5\u4f5c\u8981\u505a\u65f6\uff0c\u4efb\u52a1\u624d\u4f1a\u884d\u751f\u51fa\u6765\u3002</li> </ul> <p>Default value \uff1a <code>true</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetsplitfiles","title":"parquet.split.files","text":"<p>Description\uff1a\u5982\u679c\u4e3afalse\uff0c\u5219\u6309\u987a\u5e8f\u8bfb\u53d6\u6587\u4ef6\u3002</p> <p>Default value \uff1a <code>true</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#readsupport","title":"ReadSupport","text":""},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetreadschema","title":"parquet.read.schema","text":"<p>Description \uff1a\u8bfb\u53d6\u6295\u5f71\u7684schema\u3002</p> <ul> <li>\u7528\u4e8e\u6620\u5c04\u4e0b\u63a8\uff0c\u53ea\u8bfb\u53d6\u9700\u8981\u7684\u5217\u3002</li> </ul>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#unmaterializablerecordcounter","title":"UnmaterializableRecordCounter","text":""},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetreadbadrecordthreshold","title":"parquet.read.bad.record.threshold","text":"<p>Description \uff1a\u53ef\u4ee5\u5bb9\u5fcd\u7684\u574f\u8bb0\u5f55\u7684\u767e\u5206\u6bd4</p> <p>Default value \uff1a <code>0</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#zstandardcodec","title":"ZstandardCodec","text":""},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetcompressioncodeczstdlevel","title":"parquet.compression.codec.zstd.level","text":"<p>Description  ZSTD\u538b\u7f29\u7ea7\u522b\uff0c1~22\uff0c\u503c\u8d8a\u9ad8\u538b\u7f29\u6bd4\u8d8a\u9ad8\uff0c\u4f46\u5199\u65f6\u95f4\u8d8a\u957f</p> <p>Default value \uff1a <code>3</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetcompressioncodeczstdworkers","title":"parquet.compression.codec.zstd.workers","text":"<p>Description \uff1a\u5e76\u884c\u538b\u7f29\u7684\u7ebf\u7a0b\u6570\u3002\u503c\u4e3a0\u8868\u793a\u5355\u7ebf\u7a0b</p> <p>Default value \uff1a <code>0</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#hadoopreadoptions","title":"HadoopReadOptions","text":""},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetcryptofactoryclass_1","title":"parquet.crypto.factory.class","text":"<p>Description \uff1a\u5b9e\u73b0<code>DecryptionPropertiesFactory</code>\u7684\u7c7b</p> <p>Default value \uff1a None</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#propertiesdrivencryptofactory","title":"PropertiesDrivenCryptoFactory","text":""},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetencryptioncolumnkeys","title":"parquet.encryption.column.keys","text":"<p>Description \uff1a\u52a0\u5bc6\u7684\u5217\u7684\u5217\u8868\uff0c\u89c1 HIVE-21848</p> <ul> <li>\u683c\u5f0f\uff1a <code>&lt;masterKeyID&gt;:&lt;colName&gt;,&lt;colName&gt;;&lt;masterKeyID&gt;:&lt;colName&gt;...</code></li> </ul> <p>Default value \uff1a None. </p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetencryptionfooterkey","title":"parquet.encryption.footer.key","text":"<p>Description \uff1aMaster key ID for footer encryption/signing.</p> <p>Default value \uff1a None. If neither <code>column.keys</code> nor <code>footer.key</code> are set, the file won't be encrypted by the PropertiesDrivenCryptoFactory. If one of the two properties is set, an exception will be thrown.</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetencryptionalgorithm","title":"parquet.encryption.algorithm","text":"<p>Description \uff1aAES_GCM_V1<code>or</code>AES_GCM_CTR_V1`.</p> <p>Default value \uff1a <code>AES_GCM_V1</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetencryptionplaintextfooter","title":"parquet.encryption.plaintext.footer","text":"<p>Description \uff1aWrite files in plaintext footer mode, that makes many footer fields visible (e.g. schema) but allows legacy readers to access unencrypted columns. The plaintext footer is signed with the footer key. If <code>false</code>, write files in encrypted footer mode, that fully encrypts the footer, and signs it with the footer key. Default value \uff1a <code>false</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetencryptionkmsclientclass","title":"parquet.encryption.kms.client.class","text":"<p>Description \uff1aClass implementing the KmsClient interface. \"KMS\" stands for \u201ckey management service\u201d. The Client will interact with a KMS Server to wrap/unrwap encryption keys.</p> <p>Default value \uff1a None</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetencryptionkmsinstanceid","title":"parquet.encryption.kms.instance.id","text":"<p>Description \uff1aID of the KMS instance that will be used for encryption (if multiple KMS instances are available).</p> <p>Default value \uff1a <code>DEFAULT</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetencryptionkmsinstanceurl","title":"parquet.encryption.kms.instance.url","text":"<p>Description \uff1aURL of the KMS instance.</p> <p>Default value \uff1a <code>DEFAULT</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetencryptionkeyaccesstoken","title":"parquet.encryption.key.access.token","text":"<p>Description \uff1aAuthorization token that will be passed to KMS.</p> <p>Default value \uff1a <code>DEFAULT</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetencryptiondoublewrapping","title":"parquet.encryption.double.wrapping","text":"<p>Description \uff1aUse double wrapping - where data encryption keys (DEKs) are encrypted with key encryption keys (KEKs), which in turn are encrypted with master keys. If <code>false</code>, DEKs are directly encrypted with master keys, KEKs are not used.</p> <p>Default value \uff1a <code>true</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetencryptioncachelifetimeseconds","title":"parquet.encryption.cache.lifetime.seconds","text":"<p>Description \uff1aLifetime of cached entities (key encryption keys, local wrapping keys, KMS client objects).</p> <p>Default value \uff1a <code>600</code> (10 minutes)</p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetencryptionwraplocally","title":"parquet.encryption.wrap.locally","text":"<p>Description \uff1aWrap keys locally - master keys are fetched from the KMS server and used to encrypt other keys (DEKs or KEKs). If <code>false</code> - key wrapping will be performed by a KMS server.</p> <p>Default value \uff1a <code>false</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetencryptionkeymaterialstoreinternally","title":"parquet.encryption.key.material.store.internally","text":"<p>Description \uff1aStore key material inside Parquet file footers; this mode doesn\u2019t produce additional files. If <code>false</code>, key material is stored in separate new files, created in the same folder - this mode enables key rotation for immutable Parquet files.</p> <p>Default value \uff1a <code>true</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/conf.html#parquetencryptiondatakeylengthbits","title":"parquet.encryption.data.key.length.bits","text":"<p>Description \uff1aLength of data encryption keys (DEKs), randomly generated by parquet key management tools. Can be 128, 192 or 256 bits.</p> <p>Default value \uff1a <code>128</code></p>"},{"location":"data_system/1_data_organize/data_format/parquet/datatypes.html","title":"Datatypes","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/parquet/datatypes.html#_1","title":"\u6570\u636e\u7c7b\u578b","text":""},{"location":"data_system/1_data_organize/data_format/parquet/datatypes.html#_2","title":"\u57fa\u672c\u7c7b\u578b","text":"<ul> <li>BOOLEAN: 1\u4f4d\u7684boolean\u503c</li> <li>INT32: 32\u4f4d\u6709\u7b26\u53f7\u6574\u6570</li> <li>INT64: 64\u4f4d\u6709\u7b26\u53f7\u6574\u6570</li> <li>INT96: 96\u4f4d\u6709\u7b26\u53f7\u6574\u6570\uff08Deprecated\uff09</li> <li>FLOAT: IEEE 32\u4f4d\u6d6e\u70b9\u6570</li> <li>DOUBLE: IEEE 64\u4f4d\u6d6e\u70b9\u6570</li> <li>BYTE_ARRAY: \u4efb\u610f\u957f\u5ea6\u7684\u5b57\u8282\u6570\u7ec4</li> <li>FIXED_LEN_BYTE_ARRAY: \u56fa\u5b9a\u957f\u5ea6\u7684\u5b57\u8282\u6570\u7ec4</li> </ul>"},{"location":"data_system/1_data_organize/data_format/parquet/datatypes.html#_3","title":"\u903b\u8f91\u7c7b\u578b","text":"<p>\u5c06\u5b9e\u9645\u8bed\u8a00\u4f7f\u7528\u7684\u7c7b\u578b\u8f6c\u6362\uff08\u903b\u8f91\u7c7b\u578b\uff09\u5230Parquet\u652f\u6301\u7684\u6570\u636e\u7c7b\u578b\u3002</p> <p>https://github.com/apache/parquet-format/blob/master/LogicalTypes.md</p> <ul> <li> <p>String \uff1a binary field(String)\uff1b</p> </li> <li> <p>ENUM \uff1abinary field(Enum)\uff1bMAP_KEY_VALUE\uff1a\u4e24\u4e2a\u5b57\u6bb5\u7684group\uff1b</p> </li> <li> <p>INTEGER \uff1aInt32 field(INTEGER(8,false))\uff0c\u8868\u793a\u5b58\u50a8\u7684\u662f\u65e0\u7b26\u53f7\u7684int_8\uff1b</p> </li> <li> <p>DECIMAL \uff1aInt64 decimal(precision, scale)\uff0c\u57fa\u672c\u7c7b\u578b\u53ef\u4ee5\u662fInt32, Int64, binary, fixed_len_byte_array\u3002Int32\u8868\u793a\u7684\u7cbe\u5ea6\u4e3a\u4ece1\u52309\uff1b</p> </li> <li> <p>TIME, TIMESTAMP, INTERVAL\uff1b</p> </li> <li> <p>JSON \uff1abinary field(JSON)\uff1b</p> </li> <li> <p>LIST \uff1a\u683c\u5f0f\u5b9a\u4e49\u5982\u4e0b</p> </li> </ul> <pre><code>&lt;list-repetition&gt; group &lt;name&gt; (LIST) {\n  repeated group list {\n    &lt;element-repetition&gt; &lt;element-type&gt; element;\n  }\n}\n</code></pre> <ul> <li>\\ \uff1a\u5fc5\u987b\u662foptional\u6216\u8005required\uff0c\u8868\u793a\u8be5List\u662f\u5426\u53ef\u4ee5\u4e3anull\uff1b <li> <p>\\ \uff1a\u5fc5\u987b\u662foptional\u6216\u8005required\uff0c\u8868\u793a\u5143\u7d20\u662f\u5426\u53ef\u4ee5\u4e3anull\uff1b <li> <p>MAP</p> </li> <pre><code>&lt;map-repetition&gt; group &lt;name&gt; (MAP) {\n  repeated group key_value {\n    required &lt;key-type&gt; key;\n    &lt;value-repetition&gt; &lt;value-type&gt; value;\n  }\n}\n</code></pre> <ul> <li>\\ \uff1a\u5fc5\u987b\u662foptional\u6216\u8005required\uff0c\u8868\u793a\u8be5map\u662f\u5426\u53ef\u4ee5\u4e3anull\uff1b <li>\\ \uff1a\u5fc5\u987b\u662foptional\u6216\u8005required\uff0c\u8868\u793a\u5143\u7d20\u503c\u662f\u5426\u53ef\u4ee5\u4e3anull\uff1b"},{"location":"data_system/1_data_organize/data_format/parquet/datatypes.html#nulls","title":"Nulls","text":"<p>null\u503c\u5728definition level\u5b9a\u4e49\uff08\u91c7\u7528run-length\u7f16\u7801\uff09\u3002\u6570\u636e\u4e2d\u6ca1\u6709\u7f16\u7801\u7a7a\u503c\u3002\u4f8b\u5982\uff0c\u5728\u975e\u5d4c\u5957\u6a21\u5f0f\u4e2d\uff0c\u5bf9\u4e8edefinitition level\uff0c\u5177\u67091000\u4e2a\u7a7a\u503c\u7684\u5217\u5c06\u4f7f\u7528\u8fd0\u884c\u957f\u5ea6\u7f16\u7801(0,1000\u6b21)\u8fdb\u884c\u7f16\u7801\uff0c\u800c\u6ca1\u6709\u5176\u4ed6\u5185\u5bb9\u3002</p>"},{"location":"data_system/1_data_organize/data_format/parquet/encoding.html","title":"\u7f16\u7801","text":""},{"location":"data_system/1_data_organize/data_format/parquet/encoding.html#_2","title":"\u57fa\u672c\u7c7b\u578b\u7f16\u7801","text":"<p>Parquet\u4ee5\u5217\u5b58\u50a8\uff0c\u56e0\u6b64\u7f16\u7801\u662f\u9488\u5bf9\u4e00\u5217\uff08\u76f8\u540c\u7c7b\u578b\u7684\u6570\u7ec4\uff09\u8fdb\u884c</p> <p>Parquet\u683c\u5f0f\u7684Thrift\u5b9a\u4e49\uff1ahttps://github.com/apache/parquet-format/blob/master/src/main/thrift/parquet.thrift </p>"},{"location":"data_system/1_data_organize/data_format/parquet/encoding.html#plainplain-0","title":"Plain(PLAIN = 0)","text":"<p>\u652f\u6301\u6240\u6709\u6570\u636e\u7c7b\u578b\uff0c\u5bf9\u6570\u636e\u6ca1\u6709\u538b\u7f29\u548c\u5176\u4ed6\u5904\u7406\u3002\u5f53\u6570\u636e\u7c7b\u578b\u4e0d\u80fd\u7528\u66f4\u6709\u6548\u7684\u7f16\u7801\u65f6\u91c7\u7528PLAIN\u3002</p> <ul> <li>Boolean\uff1aBit Packed, LSB first</li> <li>INT32: 4 bytes little endian</li> <li>INT64: 8 bytes little endian</li> <li>INT96: 12 bytes little endian (deprecated)</li> <li>FLOAT: 4 bytes IEEE little endian</li> <li>DOUBLE: 8 bytes IEEE little endian</li> <li>BYTE_ARRAY: length in 4 bytes little endian followed by the bytes contained in the array</li> <li>FIXED_LEN_BYTE_ARRAY: the bytes contained in the array</li> </ul>"},{"location":"data_system/1_data_organize/data_format/parquet/encoding.html#dictionary-encoding-plain_dictionary-2-and-rle_dictionary-8","title":"Dictionary Encoding (PLAIN_DICTIONARY = 2 and RLE_DICTIONARY = 8)","text":"<p>\u6784\u5efa\u4e00\u4e2a\u5305\u542b\u7ed9\u5b9a\u5217\u4e2d\u9047\u5230\u7684\u503c\u7684\u5b57\u5178\u3002\u5b57\u5178\u5c06\u5b58\u50a8\u5728\u6bcf\u4e2a\u5217\u5757\u7684\u5b57\u5178\u9875\u4e2d\u3002</p> <p>\u5c06\u503c\u5b58\u50a8\u4e3a\u6574\u6570\u5e76\u4f7f\u7528RLE/Bit-Packing\u6df7\u5408\u7f16\u7801\u3002\u5982\u679c\u5b57\u5178\u53d8\u5f97\u592a\u5927\uff0c\u65e0\u8bba\u662f\u5728\u5927\u5c0f\u4e0a\u8fd8\u662f\u5728\u4e0d\u540c\u503c\u7684\u6570\u91cf\u4e0a\uff0c\u90fd\u4f1a\u9000\u56de\u5230PLAIN\u7f16\u7801\u3002\u5728\u5217\u5757\u7684\u6570\u636e\u9875\u4e4b\u524d\uff0c\u9996\u5148\u5199\u5165\u5b57\u5178\u9875\u3002</p> <ul> <li>\u8bcd\u5178\u9875\u683c\u5f0f\uff1athe entries in the dictionary - in dictionary order\uff0c\u4f7f\u7528 plain \u7f16\u7801.</li> <li>\u6570\u636e\u9875\u683c\u5f0f\uff1a1byte\u8868\u793abitwidth(\u6700\u592732)\uff0c\u503c\u7528RLE/bit packed\u7f16\u7801\uff1b</li> </ul> <p>\u63a8\u8350\uff1aParquet 2.0+ \u6570\u636e\u9875\u4f7f\u7528 RLE_DICTIONARY\uff0c\u8bcd\u5178\u9875\u4f7f\u7528 PLAIN \u3002</p>"},{"location":"data_system/1_data_organize/data_format/parquet/encoding.html#run-length-encoding-bit-packing-hybrid-rle-3","title":"Run Length Encoding / Bit-Packing Hybrid (RLE = 3)","text":"<p>\u9488\u5bf9\u91cd\u590d\uff08repeated\uff09\u7684\u6570\u636e\uff0c\u4f7f\u7528big-packing\u548crun-lenght-encoding\u7ec4\u5408\u7f16\u7801\u3002</p> <p>RLE\u7f16\u7801\u652f\u6301\u7684\u6570\u636e\u7c7b\u578b\uff1a</p> <ul> <li><code>Repetition, definition level</code></li> <li><code>Dictionary index</code></li> <li><code>Boolean values in data pages, as an alternative to PLAIN encoding</code></li> </ul> <pre><code># \u7f16\u7801\u7684\u7ec4\u6210\nrle-bit-packed-hybrid: &lt;length&gt; &lt;encoded-data&gt;\nlength := length of the &lt;encoded-data&gt; in bytes stored as 4 bytes little endian (unsigned int32)\nencoded-data := &lt;run&gt;*\n\nrun := &lt;bit-packed-run&gt; | &lt;rle-run&gt;\nbit-packed-run := &lt;bit-packed-header&gt; &lt;bit-packed-values&gt;\nbit-packed-header := varint-encode(&lt;bit-pack-scaled-run-len&gt; &lt;&lt; 1 | 1)\n// we always bit-pack a multiple of 8 values at a time, so we only store the number of values / 8\nbit-pack-scaled-run-len := (bit-packed-run-len) / 8\nbit-packed-run-len := *see 3 below*\nbit-packed-values := *see 1 below*\n\nrle-run := &lt;rle-header&gt; &lt;repeated-value&gt;\nrle-header := varint-encode( (rle-run-len) &lt;&lt; 1)\nrle-run-len := *see 3 below*\nrepeated-value := value that is repeated, using a fixed-width of round-up-to-next-byte(bit-width)\n</code></pre> <ol> <li>\u8fd9\u91cc\u7684bit-packing \u8ddf deprecated bit-packing \u4f7f\u7528\u4e0d\u540c\u7684\u987a\u5e8f\u3002\u8fd9\u4e9b\u503c\u4ece\u6bcf\u4e2a\u5b57\u8282\u7684\u6700\u4f4e\u6709\u6548\u4f4d\u6253\u5305\u5230\u6700\u9ad8\u6709\u6548\u4f4d\uff0c\u4f46\u662f\u6bcf\u4e2a\u503c\u4e2d\u7684\u4f4d\u7684\u987a\u5e8f\u4ecd\u7136\u6309\u7167\u901a\u5e38\u7684\u6700\u9ad8\u6709\u6548\u4f4d\u5230\u6700\u4f4e\u6709\u6548\u4f4d\u7684\u987a\u5e8f\u3002</li> </ol> <p>\u793a\u4f8b\uff1a1-7\u7684\u6570\u5b57</p> <pre><code>dec value: 0   1   2   3   4   5   6   7\nbit value: 000 001 010 011 100 101 110 111\nbit label: ABC DEF GHI JKL MNO PQR STU VWX\n==&gt;\nbit value: 10001000 11000110 11111010\nbit label: HIDEFABC RMNOJKLG VWXSTUPQ\n</code></pre> <p>\u8fd9\u79cd\u6253\u5305\u987a\u5e8f\u7684\u539f\u56e0\u662f\u5728\u4e00\u6b21\u53cd\u5e8f\u5217\u5316\u591a\u4e2a\u5b57\u8282\u65f6\uff0c\u5728little-endian\u786c\u4ef6\u4e0a\u6709\u66f4\u5c11\u7684\u5b57\u8fb9\u754c\u3002\u8fd9\u662f\u56e0\u4e3a\u53ef\u4ee5\u5c064\u4e2a\u5b57\u8282\u8bfb\u516532\u4f4d\u5bc4\u5b58\u5668(\u6216\u5c068\u4e2a\u5b57\u8282\u8bfb\u516564\u4f4d\u5bc4\u5b58\u5668)\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7shift\u548cORing with mask\u6765\u89e3\u538b\u7f29\u503c\u3002</p> <ol> <li> <p>varint-encode() \u4f7f\u7528 ULEB-128 encoding\uff1b</p> </li> <li> <p><code>bit-packed-run-len</code>\u548c<code>rle-run-len</code>\u8981\u5728\\([1, 2^{31} - 1\\)] \u4e2d\u3002</p> </li> </ol>"},{"location":"data_system/1_data_organize/data_format/parquet/encoding.html#bit-packed-deprecated-bit_packed-4","title":"Bit-packed (Deprecated) (BIT_PACKED = 4)","text":"<p>\u4ec5bit-packed\u7f16\u7801\uff0c\u88ab RLE/bit-packing\u7f16\u7801\u66ff\u4ee3\u3002\u6bcf\u4e2a\u503c\u7528\u56fa\u5b9a\u7684bit\u4f4d\u8fdb\u884c\u7f16\u7801\uff0c\u503c\u4e4b\u95f4\u6ca1\u6709\u586b\u5145(\u6700\u540e\u4e00\u4e2a\u5b57\u8282\u9664\u5916\uff0c\u75280\u6765\u586b\u5145\uff09\u3002</p> <p>\u51fa\u4e8e\u517c\u5bb9\u6027\u7684\u539f\u56e0\uff0c\u5b9e\u73b0\u5c06\u503c\u4ece\u6700\u9ad8\u6709\u6548\u4f4d\u6253\u5305\u5230\u6700\u4f4e\u6709\u6548\u4f4d\u3002</p> <p>\u53ea\u88ab\u7528\u6765\u7f16\u7801definition &amp; repetition level\u3002</p> <p>\u793a\u4f8b\uff1a1-7\u6570\u5b57\u4f7f\u75283bit\u957f\u5ea6\u7684\u7f16\u7801</p> <pre><code>dec value: 0   1   2   3   4   5   6   7\nbit value: 000 001 010 011 100 101 110 111\nbit label: ABC DEF GHI JKL MNO PQR STU VWX\n==&gt; \nbit value: 00000101 00111001 01110111\nbit label: ABCDEFGH IJKLMNOP QRSTUVWX\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/parquet/encoding.html#delta-encoding-delta_binary_packed-5","title":"Delta Encoding (DELTA_BINARY_PACKED = 5)","text":"<p>\u652f\u6301\u7684\u6570\u636e\u7c7b\u578b\uff1aINT32, INT64</p> <p>ZigZag ULEB128 int \u8868\u793a\u5148\u5bf9 int \u8fdb\u884cZigZag\u7f16\u7801\uff0c\u518d\u8fdb\u884cULEB128\u7f16\u7801\u3002</p> <pre><code>delta encoding: &lt;header&gt;&lt;blocks of delta encoded values&gt;\n\nheader:= &lt;block size in values&gt; &lt;number of miniblocks in a block&gt; &lt;total value count&gt; &lt;first value&gt;\nblock size in values:= &lt;ULEB128 int&gt; \nnumber of miniblocks in a block:= &lt;ULEB128 int&gt;\ntotal value count:= &lt;ULEB128 int&gt;\nfirst value:= &lt;ZigZag ULEB128 int&gt;\n\nblocks of delta encoded values:= &lt;block&gt;*\nblock:= &lt;min delta&gt; &lt;list of bitwidths of miniblocks&gt; &lt;miniblocks&gt;\nmin delta:= &lt;ZigZag ULEB128 int&gt;\nlist of bitwidths of miniblocks:= &lt;byte&gt;*\nminiblocks:= &lt;bit width&gt;&lt;bit packed ints&gt;*\n</code></pre> <ul> <li>block size in values\uff1ablock\u7684\u5927\u5c0f\uff0c\u5fc5\u987b\u662f128\u7684\u500d\u6570\uff0c\u7528ULEB 128 int\u7f16\u7801\uff1b</li> <li>number of miniblocks in a block\uff1ablock\u4e2d\u7684miniblock\u7684\u4e2a\u6570\uff0c\u7528block size\u9664\u4ee5\u5b83\u53ef\u4ee5\u7b97\u51fa\u6bcf\u4e2aminiblock\u7684\u5143\u7d20\u4e2a\u6570\uff08\u5fc5\u987b\u662f32\u7684\u500d\u6570\uff09\uff0c\u7528ULEB 128 int\u7f16\u7801\uff1b</li> </ul> <p>block\u7684\u7f16\u7801</p> <ul> <li>\u8ba1\u7b97\u8fde\u7eed\u503c\u7684\u5dee\u503c\uff08delta\uff09\uff0c\u7b2c\u4e00\u4e2a\u5757\u4e2d\u7b2c\u4e00\u4e2a\u503c\u5728header\u4e2d\u5b58\u50a8\uff0c\u5176\u5b83\u5757\u7684\u7b2c\u4e00\u4e2a\u503c\u8ddf\u5176\u4e0a\u4e00\u5757\u7684\u6700\u540e\u4e00\u4e2a\u503c\uff0c\u8ba1\u7b97\u5dee\u503c\uff1b</li> <li>\u8ba1\u7b97 the frame of reference\uff08\u5757\u4e2ddelta\u7684\u6700\u5c0f\u503c)\u3002\u4ece\u6240\u6709\u7684deltas\u4e2d\u51cf\u53bbmin delta\u3002\u8fd9\u4fdd\u8bc1\u4e86\u6240\u6709\u7684\u503c\u90fd\u662f\u975e\u8d1f\uff1b</li> <li>\u5c06min delata\u91c7\u7528zigzag ULEB128 int\u7f16\u7801\uff0c\u6bcf\u4e2aminiblock\u4e2d\u7684bitwidth\u91c7\u7528byte\u7f16\u7801\uff0c\u6bcf\u4e2aminiblock\u4e2d\u7684delta values\uff08\u51cf\u53bbmin delta\uff09\u91c7\u7528bit packed\u7f16\u7801\uff1b</li> </ul> <p>\u5982\u679c\u6ca1\u6709\u8db3\u591f\u7684\u503c\u586b\u6ee1\u6700\u540e\u4e00\u4e2aminiblock\uff0c\u91c7\u75280\u586b\u5145\u8fd9\u4e2aminiblock\uff0c\u4f7f\u5176\u957f\u5ea6\u5c31\u7b49\u4e8e\u6574\u4e2aminiblock\u4e2d\u503c\u7684\u6570\u91cf\u4e58\u4ee5\u4f4d\u5bbd\uff08bitwidth\uff09\u3002</p> <p>\u5982\u679c\u6700\u540e\u4e00\u4e2ablock\u4e2dminiblock\u4e2a\u6570\u5c11\u4e8e<code>&lt;number of miniblocks in a block</code>\uff0c\u5b58\u50a8\u65e0\u9700\u7684miniblock\u7684bitwidth\u4ecd\u7136\u9700\u8981\uff08bitwodth\u4e3a0\uff09\uff0c\u4f46\u662f\u65e0\u9700\u7684miniblock\u7684\u6570\u636e\u4e0d\u9700\u8981\u586b\u5145\uff0c\u56e0\u4e3a\u8bfb\u53d6\u5668\u53ef\u4ee5\u6839\u636e\u5df2\u8bfb\u5b57\u8282\u6570\u8fdb\u884c\u505c\u6b62\u8bfb\u53d6\u3002</p> <p>\u793a\u4f8b</p> <pre><code># use 8 as the block size\n# original data\n7, 5, 3, 1, 2, 3, 4, 5\n# the deltas would be\n-2, -2, -2, 1, 1, 1, 1\n# The minimum is -2, so the relative deltas are:\n0, 0, 0, 3, 3, 3, 3\n# The encoded data is\nheader: 8 (block size), 1 (miniblock count), 8 (value count), 7 (first value)\n\nblocks(only 1 block): -2 (minimum delta), 2 (bitwidth), 00000011111111b (0,0,0,3,3,3,3 packed on 2 bits)\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/parquet/encoding.html#delta-length-byte-array-delta_length_byte_array-6","title":"Delta-length byte array: (DELTA_LENGTH_BYTE_ARRAY = 6)","text":"<p>BYTE_ARRAY \u6570\u636e\u7c7b\u578b\u3002</p> <p>\u5bf9\u4e8e\u5b57\u8282\u6570\u7ec4\u5217\uff0c\u8fd9\u79cd\u7f16\u7801\u603b\u662f\u4f18\u4e8ePLAIN\u7f16\u7801\u3002</p> <p>\u5148\u7f16\u7801\u6240\u6240\u6709byte array\u7684\u957f\u5ea6\uff08\u4f7f\u7528DELTA_BINARY_PACKED\uff09\uff0c\u518d\u62fc\u63a5\u4e0a\u6240\u6709\u7684byte array data\u3002\u901a\u8fc7\u957f\u5ea6\u7f16\u7801\u548c\u66f4\u597d\u7684\u6570\u636e\u538b\u7f29\uff08\u4e0d\u518d\u4e0e\u957f\u5ea6\u4ea4\u53c9\uff09\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>\"Hello\", \"World\", \"Foobar\", \"ABCDEF\"\n==&gt;\nDeltaEncoding(5, 5, 6, 6) \"HelloWorldFoobarABCDEF\"\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/parquet/encoding.html#delta-strings-delta_byte_array-7","title":"Delta Strings: (DELTA_BYTE_ARRAY = 7)","text":"<p>BYTE_ARRAY \u6570\u636e\u7c7b\u578b\u3002</p> <p>\u4e5f\u6210\u4e3a\u589e\u91cf\u7f16\u7801\u6216\u8005\u524d\u5411\u538b\u7f29\u3002\u5bf9\u4e8e\u5b57\u7b26\u4e32\u5e8f\u5217\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\uff0c\u5b58\u50a8\u524d\u4e00\u4e2a\u6761\u76ee\u7684\u524d\u7f00\u957f\u5ea6\u52a0\u4e0a\u540e\u7f00\u3002</p> <p>\u503c\u5b58\u50a8\u4e3a \u524d\u7f00\u5e8f\u5217 + \u540e\u7f00\u503c</p> <ul> <li>Prefix Length\u5e8f\u5217\uff1a\u91c7\u7528 DELTA_BINARY_PACKED \u7f16\u7801\uff1b</li> <li>Suffixes\uff1a\u91c7\u7528 DELTA_LENGTH_BYTE_ARRAY \u7f16\u7801\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/parquet/encoding.html#byte-stream-split-byte_stream_split-9","title":"Byte Stream Split: (BYTE_STREAM_SPLIT = 9)","text":"<p>FLOAT DOUBLE\u6570\u636e\u7c7b\u578b\u3002</p> <p>\u8fd9\u79cd\u7f16\u7801\u4e0d\u4f1a\u51cf\u5c11\u6570\u636e\u7684\u5927\u5c0f\uff0c\u4f46\u5728\u4f7f\u7528\u538b\u7f29\u7b97\u6cd5\u540e\uff0c\u53ef\u4ee5\u663e\u8457\u63d0\u9ad8\u538b\u7f29\u6bd4\u548c\u901f\u5ea6\u3002</p> <p>\u521b\u5efa\u4e86\u957f\u5ea6\u4e3aN\u7684K\u4e2a\u5b57\u8282\u6d41\uff0c\u5176\u4e2dK\u662f\u6570\u636e\u7c7b\u578b\u7684\u5b57\u8282\u5927\u5c0f\uff0cN\u662f\u6570\u636e\u5e8f\u5217\u4e2d\u5143\u7d20\u7684\u6570\u91cf\u3002\u6bcf\u4e2a\u503c\u7684\u5b57\u8282\u88ab\u5206\u6563\u5230\u76f8\u5e94\u7684\u6d41\u4e2d\u3002\u7b2c0\u4e2a\u5b57\u8282\u8fdb\u5165\u7b2c0\u4e2a\u6d41\uff0c\u7b2c1\u4e2a\u5b57\u8282\u8fdb\u5165\u7b2c1\u4e2a\u6d41\uff0c\u4f9d\u6b64\u7c7b\u63a8\u3002\u8fd9\u4e9b\u6d41\u6309\u4ee5\u4e0b\u987a\u5e8f\u8fde\u63a5\u8d77\u6765\uff1a\u7b2c0\u4e2a\u6d41\u3001\u7b2c1\u4e2a\u6d41\uff0c\u7b49\u7b49\u3002</p> <p>\u793a\u4f8b\uff1a\u539f\u59cb\u6570\u636e\u662f\u4e09\u4e2a32\u4f4d\u6d6e\u70b9\u6570\uff08K=4, N=3\uff09\u3002</p> <pre><code>       Element 0      Element 1      Element 2\nBytes  AA BB CC DD    00 11 22 33    A3 B4 C5 D6\n=&gt;\nBytes  AA 00 A3    BB 11 B4    CC 22 C5   DD 33 D6\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/parquet/encoding.html#_3","title":"\u5217\u5d4c\u5957\u7f16\u7801","text":"<p>\u6570\u636e\u7ed3\u6784\uff0c\u5176\u6839\u4e3aRecord\uff0c\u79f0\u4e3amessage\uff0c\u5176\u5185\u90e8\u6bcf\u4e2a\u5b57\u6bb5\u5305\u542b\u4e09\u90e8\u5206\uff1a\u5b57\u6bb5\u7c7b\u578b\u3001\u6570\u636e\u7c7b\u578b\u3001\u5b57\u6bb5\u540d\u79f0\u3002\u901a\u8fc7\u6570\u636e\u7c7b\u578bgroup\u6765\u8868\u8fbe\u5c42\u7ea7\u5173\u7cfb\u3002</p> <ul> <li>required\uff1aexactly one occurrence</li> <li>optional: 0 or 1 occurrence</li> <li>repeated: 0 or more occurrence</li> </ul> <p>required, optional, repeated\uff1a\u9488\u5bf9optional\u548crepeated\uff0c\u5217\u793a\u5b58\u50a8\u4e0b\uff0c\u65e0\u6cd5\u786e\u5b9a\u5c5e\u4e8e\u884c\u7684\u8fb9\u754c</p> <p>\u7f16\u7801\u5d4c\u5957\u5217\uff0c\u91c7\u7528 Dremel encoding with definition and repetition levels\u3002</p> <ul> <li>Definition level</li> <li>\u6307\u5b9a\u5728\u5217\u7684\u8def\u5f84\u4e2d\u5b9a\u4e49\u4e86\u591a\u5c11\u4e2a\u53ef\u9009\u5b57\u6bb5</li> <li>Repetition level</li> <li>\u6307\u5b9a\u8def\u5f84\u4e2d\u54ea\u4e9b\u91cd\u590d\u5b57\u6bb5\u7684\u503c\u662f\u91cd\u590d\u7684</li> </ul> <p>\u6700\u5927\u7684Definition\u548cRepetition\u5c42\u6b21\u662f\u53ef\u4ee5\u901a\u8fc7schema\u8ba1\u7b97\u51fa\u6765\u3002\u8fd9\u5b9a\u4e49\u4e86\u5b58\u50a8\u7ea7\u522b\u6240\u9700\u7684\u6700\u5927\u4f4d\u6570(\u7ea7\u522b\u662f\u4e3a\u5217\u4e2d\u7684\u6240\u6709\u503c\u5b9a\u4e49\u7684)\u3002</p>"},{"location":"data_system/1_data_organize/data_format/parquet/encoding.html#_4","title":"\u793a\u4f8b","text":"<pre><code>message Record {\n    required string sid, \n    repeated long appid,\n    optional group tcp {\n        optional long mss,\n        optional long flag\n    },\n    repeated group trans {\n        optional string uri,\n        optional int monitor_flag\n    }\n}\n</code></pre> <pre><code>Record 1: {\n    \"sid\":\"8509_1576752657\",\n    \"appid\":[81, 205, 67],\n    \"tcp\": {\n        \"mss\": 1750,\n        \"flag\": 344\n    },\n    \"trans\":[{\n            \"uri\":\"/icon.jpg\",\n            \"monitor_flag\":1\n        },{\n            \"uri\":\"/myyhp_2.2-4.js\"\n        }\n    ]\n}\n\nRecord 2: {\n    \"sid\":\"8510_1576752667\",\n    \"appid\":[58, 98]\n}\n\nRecord 3: {\n    \"sid\":\"8511_1576754667\",\n    \"appid\":[198],\n    \"tcp\": {\n        \"flag\": 256\n    }\n}\n</code></pre> <p>D\uff0c\u5373Definition Level\uff0c\u7528\u4e8e\u8868\u8fbe\u67d0\u4e2a\u5217\u662f\u5426\u4e3a\u7a7a\u3001\u5728\u54ea\u91cc\u4e3a\u7a7a\uff0c\u5176\u503c\u4e3a\u5f53\u524d\u5217\u5728\u7b2c\u51e0\u5c42\u4e0a\u6709\u503c\u3002\u5bf9\u4e8erequired\u7684\u5b57\u6bb5\uff0c\u6ca1\u6709D\u503c\u3002</p> <p>R\uff0c\u5373Repetition Level\uff0c\u7528\u4e8e\u8868\u8fbe\u4e00\u4e2a\u5217\u6709\u91cd\u590d\uff0c\u5373\u6709\u591a\u4e2a\u503c\u7684\u60c5\u51b5\uff0c\u5176\u503c\u4e3a\u91cd\u590d\u662f\u5728\u7b2c\u51e0\u5c42\u4e0a\u53d1\u751f\u3002</p>"},{"location":"data_system/1_data_organize/data_format/parquet/encoding.html#_5","title":"\u538b\u7f29","text":"<pre><code>enum CompressionCodec {\n  UNCOMPRESSED = 0;\n  SNAPPY = 1;\n  GZIP = 2;\n  LZO = 3;\n  BROTLI = 4; // Added in 2.4\n  LZ4 = 5;    // Added in 2.4\n  ZSTD = 6;   // Added in 2.4\n}\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/parquet/encryption.html","title":"Encryption","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/parquet/encryption.html#_1","title":"\u52a0\u5bc6","text":"<p>https://github.com/apache/parquet-format/blob/master/Encryption.md</p>"},{"location":"data_system/1_data_organize/data_format/parquet/parquet.html","title":"Parquet","text":"<p>Apache Parquet is an open source, column-oriented data file format designed for efficient data storage and retrieval.</p>"},{"location":"data_system/1_data_organize/data_format/parquet/parquet.html#_1","title":"\u5b9a\u4e49","text":"<p>Parquet \u662f\u652f\u6301\u5d4c\u5957\u6570\u636e\u7684\u5217\u5f0f\u5b58\u50a8\u683c\u5f0f\uff0c\u5176\u5143\u6570\u636e\u4f7f\u7528 Apache Thrift \u7f16\u7801\u3002</p> <p>Input and Output formats. Note that to use an Input or Output format, you need to implement a <code>WriteSupport</code> or <code>ReadSupport</code> class, which will implement the conversion of your object to and from a Parquet schema. </p> <ul> <li>Native Avro support</li> <li>Native Thrift support</li> <li>Native Protocol Buffers support</li> </ul> <p>Avro, Thrift, Protocol Buffers \u90fd\u6709\u5404\u81ea\u7684\u5b58\u50a8\u683c\u5f0f\uff0c\u4f46\u662f Parquet \u4f7f\u7528\u4e86\u81ea\u5df1\u5728parquet-format\u9879\u76ee\u91cc\u5b9a\u4e49\u7684\u5b58\u50a8\u683c\u5f0f\u3002</p>"},{"location":"data_system/1_data_organize/data_format/parquet/parquet.html#_2","title":"\u6a21\u5757","text":"<ul> <li>parquet-format\uff1a\u683c\u5f0f\u89c4\u8303\u548cThrift\u7684\u5143\u6570\u636e\u5b9a\u4e49\uff1b</li> <li>parquet-mr\uff1a\u5305\u542b\u591a\u4e2a\u5b50\u6a21\u5757\uff0c\u8bfb\u5199parquet\u4ee5\u53ca\u548c\u5176\u5b83\u683c\u5f0f\u7684\u8f6c\u6362\uff1b</li> <li>parquet-cpp\uff1aC++\u5e93\u8bfb\u5199parquet\uff08\u73b0\u5728\u9879\u76ee\u79fb\u5230apache arrow \u4e2d\uff09\uff1b</li> <li>parquet-rs\uff1aRust \u5e93\u8bfb\u5199parquet\uff1b</li> <li>parquet-compatibility\uff1a\u517c\u5bb9\u6027\u6d4b\u8bd5\uff0c\u9a8c\u8bc1\u4e0d\u540c\u8bed\u8a00\u7684\u5b9e\u73b0\u95f4\u7684\u4e92\u76f8\u8bfb\u5199\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/parquet/parquet.html#_3","title":"\u672f\u8bed","text":"<ul> <li>Block\uff08HDFS block\uff09\uff1a a block in HDFS and the meaning is unchanged for describing this file format\u3002\u6587\u4ef6\u683c\u5f0f\u57fa\u4e8eHDFS\u8bbe\u8ba1\u3002</li> <li>File\uff1a A HDFS file that must include the metadata for the file. </li> <li>Row group\uff1aA logical horizontal partitioning of the data into rows. </li> <li>Column chunk\uff1aA chunk of the data for a particular column.</li> <li>Page\uff1aColumn chunks are divided up into pages. There can be multiple page types which are interleaved in a column chunk.</li> </ul>"},{"location":"data_system/1_data_organize/data_format/parquet/parquet.html#_4","title":"\u683c\u5f0f","text":"<p>\u6587\u4ef6\u7ed3\u6784\u53ef\u4ee5\u770b\u51fa\uff0cParquet \u683c\u5f0f\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206\u7406\u89e3\uff1a</p> <ul> <li>\u6587\u4ef6\uff08File\uff09\uff1a\u4e00\u4e2a Parquet \u6587\u4ef6\uff0c\u5305\u62ec\u6570\u636e\u548c\u5143\u6570\u636e\u3002</li> <li>\u884c\u7ec4\uff08Row Group\uff09\uff1a\u6570\u636e\u5728\u6c34\u5e73\u65b9\u5411\u4e0a\u6309\u884c\u62c6\u5206\u4e3a\u591a\u4e2a\u5355\u5143\uff0c\u6bcf\u4e2a\u5355\u5143\u5c31\u662f\u6240\u8c13\u7684 Row Group\uff0c\u5373\u884c\u7ec4\u3002\u8fd9\u662f\u4e00\u822c\u5217\u5f0f\u5b58\u50a8\u90fd\u4f1a\u6709\u7684\u7ed3\u6784\u8bbe\u8ba1\u3002\u6bcf\u4e00\u4e2a\u884c\u7ec4\u5305\u542b\u4e00\u5b9a\u7684\u884c\u6570\uff0cParquet \u8bfb\u5199\u7684\u65f6\u5019\u4f1a\u5c06\u6574\u4e2a\u884c\u7ec4\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u56e0\u6b64\u66f4\u5927\u5c3a\u5bf8\u7684\u884c\u7ec4\u5c06\u4f1a\u5360\u7528\u66f4\u591a\u7684\u7f13\u5b58\uff0c\u5e76\u4e14\u8bb0\u5f55\u5360\u7528\u7a7a\u95f4\u6bd4\u8f83\u5c0f\u7684 Schema \u53ef\u4ee5\u5728\u6bcf\u4e00\u4e2a\u884c\u7ec4\u4e2d\u5b58\u50a8\u66f4\u591a\u7684\u884c\u3002</li> <li>\u5217\u5757\uff08Column Chunk\uff09\uff1a\u4e00\u4e2a\u884c\u7ec4\u4e2d\u7684\u6bcf\u4e00\u5217\u5bf9\u5e94\u7684\u4fdd\u5b58\u5728\u4e00\u4e2a\u5217\u5757\u4e2d\u3002\u884c\u7ec4\u4e2d\u7684\u6240\u6709\u5217\u8fde\u7eed\u7684\u5b58\u50a8\u5728\u8fd9\u4e2a\u884c\u7ec4\u6587\u4ef6\u4e2d\uff0c\u6bcf\u4e00\u4e2a\u5217\u5757\u4e2d\u7684\u503c\u90fd\u662f\u76f8\u540c\u7c7b\u578b\u7684\uff0c\u4e0d\u540c\u5217\u5757\u53ef\u80fd\u4f7f\u7528\u4e0d\u540c\u7684\u7b97\u6cd5\u8fdb\u884c\u538b\u7f29\u3002</li> <li>\u6570\u636e\u9875\uff08Data Page\uff09\uff1a\u6bcf\u4e00\u4e2a\u5217\u5757\u5212\u5206\u4e3a\u591a\u4e2a\u6570\u636e\u9875\u6216\u8005\u8bf4\u9875\uff0c\u4e00\u4e2a\u9875\u662f\u6700\u5c0f\u7684\u7f16\u7801\u7684\u5355\u4f4d\uff0c\u5728\u540c\u4e00\u4e2a\u5217\u5757\u7684\u4e0d\u540c\u9875\u53ef\u80fd\u4f7f\u7528\u4e0d\u540c\u7684\u7f16\u7801\u65b9\u5f0f\u3002</li> </ul> <p>\u6587\u4ef6\u7684\u7ec4\u7ec7\u5f62\u5f0f\uff1a</p> <pre><code>4-byte magic number \"PAR1\"\n&lt;Column 1 Chunk 1 + Column Metadata&gt;\n&lt;Column 2 Chunk 1 + Column Metadata&gt;\n...\n&lt;Column N Chunk 1 + Column Metadata&gt;\n&lt;Column 1 Chunk 2 + Column Metadata&gt;\n&lt;Column 2 Chunk 2 + Column Metadata&gt;\n...\n&lt;Column N Chunk 2 + Column Metadata&gt;\n...\n&lt;Column 1 Chunk M + Column Metadata&gt;\n&lt;Column 2 Chunk M + Column Metadata&gt;\n...\n&lt;Column N Chunk M + Column Metadata&gt;\nFile Metadata\n4-byte length in bytes of file metadata\n4-byte magic number \"PAR1\"\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/parquet/parquet.html#_5","title":"\u5143\u6570\u636e","text":"<p>Parquet \u6587\u4ef6\u6709\u4e09\u79cd\u7c7b\u578b\u7684\u5143\u6570\u636e\uff0c\u5206\u522b\u662ffile metadata\u3001column(chunk) metadata\u3001page header metadata\uff0c\u6bcf\u90e8\u5206\u5143\u6570\u636e\u5305\u542b\u7684\u4fe1\u606f\u4ece\u4e0b\u9762\u56fe\u89e3\u4e2d\u5927\u6982\u53ef\u4ee5\u5f97\u77e5\u3002</p> <p></p>"},{"location":"data_system/1_data_organize/data_format/parquet/parquet.html#_6","title":"\u7d22\u5f15","text":""},{"location":"data_system/1_data_organize/data_format/parquet/parquet.html#_7","title":"\u7edf\u8ba1\u4fe1\u606f","text":"<p>\u6bcf\u4e2a\u884c\u7ec4\u548c\u6bcf\u4e2a\u9875\u90fd\u6709\u7edf\u8ba1\u4fe1\u606f\uff1a</p> <ul> <li>min, max\uff1b</li> <li>null_count, distinct_count\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_format/parquet/parquet.html#bloomfilter","title":"bloomFilter","text":"<p>\u8be6\u7ec6\u8bbe\u8ba1\u89c1Bloom Filter</p>"},{"location":"data_system/1_data_organize/data_format/parquet/parquet.html#_8","title":"\u5e76\u884c\u5355\u5143","text":"<ul> <li>MapReduce - File/Row Group</li> <li>IO - Column chunk</li> <li>Encoding/Compression - Page</li> </ul>"},{"location":"data_system/1_data_organize/data_format/parquet/parquet.html#data-pages","title":"Data Pages","text":"<p>\u5728page header\u4e4b\u540e\uff0c\u4ee5\u4e0b\u4e09\u90e8\u5206\u4fe1\u606f\u4f1a\u4f9d\u6b21\u7f16\u7801\uff1a</p> <ul> <li>repetition levels data</li> <li>definition levels data</li> <li>encoded values</li> </ul> <p>page header\u4e2d\u7684<code>uncompressed_page_size</code>\u5305\u542b\u8fd9\u4e09\u90e8\u5206\u3002</p>"},{"location":"data_system/1_data_organize/data_format/parquet/parquet.html#column-chunks","title":"Column Chunks","text":"<p>\u5217\u5757\u7531\u591a\u4e2a\u9875\u7ec4\u6210\uff0c\u9875\u5171\u4eab\u5171\u540c\u7684header\uff0creader\u53ef\u4ee5\u8df3\u8fc7\u4e0d\u9700\u8981\u7684page\u3002header\u540e\u9762\u7684\u6570\u636e\u9875\u53ef\u4ee5\u88ab\u7f16\u7801\u548c\u538b\u7f29\uff0c\u538b\u7f29\u548c\u7f16\u7801\u4fe1\u606f\u5728page header\u4e2d\u3002</p> <p>\u6b64\u5916\uff0c\u6587\u4ef6\u53ef\u4ee5\u5305\u542b\u53ef\u9009\u7684\u5217\u7d22\u5f15\uff0creader\u53ef\u4ee5\u66f4\u6709\u6548\u8df3\u8fc7page\uff0c\u8bf7\u770b[PageIndex</p> <p></p>"},{"location":"data_system/1_data_organize/data_format/parquet/parquet.html#_9","title":"\u5143\u6570\u636e\u548c\u5217\u6570\u636e\u5206\u79bb","text":"<p>\u8be5\u683c\u5f0f\u88ab\u660e\u786e\u8bbe\u8ba1\u4e3a\u5c06\u5143\u6570\u636e\u4e0e\u6570\u636e\u5206\u79bb\u3002\u8fd9\u5141\u8bb8\u5c06\u5217\u62c6\u5206\u4e3a\u591a\u4e2a\u6587\u4ef6\uff0c\u4ee5\u53ca\u8ba9\u5355\u4e2a\u5143\u6570\u636e\u6587\u4ef6\u5f15\u7528\u591a\u4e2aparquet\u6587\u4ef6\u3002</p>"},{"location":"data_system/1_data_organize/data_format/parquet/parquet.html#_10","title":"\u6821\u9a8c\u548c","text":"<p>Data Pages\u53ef\u4ee5\u5355\u72ec\u6821\u9a8c\u548c\uff08CRC32\uff09\uff0c\u56e0\u6b64\u53ef\u4ee5\u53d6\u6d88HDFS\u6587\u4ef6\u7ea7\u522b\u7684\u6821\u9a8c\u548c\uff0c\u53ef\u4ee5\u66f4\u597d\u652f\u6301\u5355\u884c\u67e5\u627e\u3002</p>"},{"location":"data_system/1_data_organize/data_format/parquet/tools.html","title":"Tools","text":""},{"location":"data_system/1_data_organize/data_format/parquet/tools.html#parquet_tools","title":"parquet_tools","text":"<pre><code>&lt;!-- https://mvnrepository.com/artifact/org.apache.parquet/parquet-tools \n 2019-12 --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.parquet&lt;/groupId&gt;\n    &lt;artifactId&gt;parquet-tools&lt;/artifactId&gt;\n    &lt;version&gt;1.11.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <pre><code># Run from Java\njava -jar ./parquet-tools-&lt;VERSION&gt;.jar &lt;command&gt; my_parquet_file.lzo.parquet\n# Run from Hadoop\nhadoop jar ./parquet-tools-&lt;VERSION&gt;.jar &lt;command&gt; my_parquet_file.lzo.parquet\n</code></pre> <p>\u652f\u6301\u7684\u547d\u4ee4\uff1a</p> <ul> <li>merge\uff0c\u5c06\u591a\u4e2aparquet\u6587\u4ef6/\u76ee\u5f55\u5408\u5e76\u6210\u4e00\u4e2aparquet\u6587\u4ef6\uff1b</li> <li>cat</li> <li>head</li> <li>size</li> <li>row_count</li> <li>meta</li> <li>dump</li> <li>...</li> </ul>"},{"location":"data_system/1_data_organize/data_format/parquet/tools.html#language","title":"Language","text":""},{"location":"data_system/1_data_organize/data_format/parquet/tools.html#python","title":"Python","text":"<p>pyarrow \u548c fastparquet \u63d0\u4f9b\uff0cpandas\u4e2ddataframe\u9009\u62e9\u5176\u4e2d\u4e4b\u4e00\u5b9e\u73b0 to_parquet \u548c read_parquet\u3002</p>"},{"location":"data_system/1_data_organize/data_format/parquet/usage.html","title":"Usage","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_format/parquet/usage.html#api","title":"API","text":"<p>\u8bf4\u660e</p> <ul> <li><code>ParquetOutputFormat</code> \uff1a\u9700\u8981 WriteSupport \u5b9e\u73b0\u7c7b\uff0c to write your own objects to an event based RecordConsumer.</li> <li><code>ParquetInputFormat</code>\uff1a\u9700\u8981 ReadSupport \u5b9e\u73b0\u7c7b\uff0c to materialize your own objects by implementing a RecordMaterializer</li> </ul>"},{"location":"data_system/1_data_organize/data_format/parquet/usage.html#_1","title":"\u8bfb\u53d6","text":""},{"location":"data_system/1_data_organize/data_format/parquet/usage.html#_2","title":"\u793a\u4f8b","text":"<pre><code>// ParquetFileReader\u7684\u8bfb\u53d6\u65b9\u5f0f\nList&lt;SimpleGroup&gt; simpleGroups = new ArrayList&lt;&gt;();\nParquetFileReader reader = ParquetFileReader.open(HadoopInputFile.fromPath(new Path(filePath), new Configuration()));\nMessageType schema = reader.getFooter().getFileMetaData().getSchema();\nList&lt;Type&gt; fields = schema.getFields();\nPageReadStore pages;\nwhile ((pages = reader.readNextRowGroup()) != null) {\n    long rows = pages.getRowCount();\n    MessageColumnIO columnIO = new ColumnIOFactory().getColumnIO(schema);\n    RecordReader recordReader = columnIO.getRecordReader(pages, new GroupRecordConverter(schema));\n\n    for (int i = 0; i &lt; rows; i++) {\n        SimpleGroup simpleGroup = (SimpleGroup) recordReader.read();\n        simpleGroups.add(simpleGroup);\n    }\n}\nreader.close();\n\n// ParqauetReader \u4f7f\u7528 InternalParquetRecordReader\uff08\u5185\u90e8\u4f7f\u7528 ParquetFileReader\uff09\nGroupReadSupport readSupport = new GroupReadSupport();\nBuilder&lt;Group&gt; reader= ParquetReader.builder(readSupport, new Path(inPath));\nParquetReader&lt;Group&gt; build=reader.build();Group line=null;\nwhile((line=build.read())!=null){\n    Group time= line.getGroup(\"time\", 0);\n    //\u901a\u8fc7\u4e0b\u6807\u548c\u5b57\u6bb5\u540d\u79f0\u90fd\u53ef\u4ee5\u83b7\u53d6\n    /*System.out.println(line.getString(0, 0)+\"\\t\"+time.getInteger(0, 0);*/\n    System.out.println(line.getString(\"city\", 0) +\"\\t\"+ time.getInteger(\"ttl\", 0));\n}\nreader.close()\n</code></pre> <p>TODO\uff1a\u5982\u4f55\u8bfb\u6210 Java \u5bf9\u8c61</p>"},{"location":"data_system/1_data_organize/data_format/parquet/usage.html#_3","title":"\u6620\u5c04\u4e0b\u63a8","text":"<p>Parquet\u4e2d\u539f\u751f\u5c31\u652f\u6301\u6620\u5c04\u4e0b\u63a8\uff0c\u6267\u884c\u67e5\u8be2\u7684\u65f6\u5019\u53ef\u4ee5\u901a\u8fc7Conguration\u4f20\u9012\u9700\u8981\u8bfb\u53d6\u7684\u5217\u7684\u4fe1\u606f\uff08Schema\uff09\uff0c\u5728\u626b\u63cf\u4e00\u4e2a\u884c\u7ec4\u65f6\uff0c\u53ea\u626b\u63cf\u5bf9\u5e94\u7684\u5217\u3002</p> <pre><code>Types.MessageTypeBuilder builder = Types.buildMessage();\nbuilder.addField(new PrimitiveType(Type.Repetition.REQUIRED, PrimitiveType.PrimitiveTypeName.BINARY, \"city\"));\nMessageType querySchema = builder.named(\"Test\");\n\nconfiguration.set(ReadSupport.PARQUET_READ_SCHEMA, querySchema.toString());\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/parquet/usage.html#_4","title":"\u8c13\u8bcd\u4e0b\u63a8","text":"<p>\u901a\u8fc7\u5c06\u4e00\u4e9b\u8fc7\u6ee4\u6761\u4ef6\u5c3d\u53ef\u80fd\u7684\u5728\u6700\u5e95\u5c42\u6267\u884c\u53ef\u4ee5\u51cf\u5c11\u6bcf\u4e00\u5c42\u4ea4\u4e92\u7684\u6570\u636e\u91cf\uff0c\u4ece\u800c\u63d0\u5347\u6027\u80fd\uff1b</p> <p>Parquet\u5728\u6bcf\u4e2a\u884c\u7ec4\u4e2d\u7684\u5217\u90fd\u5728\u5b58\u50a8\u65f6\u8fdb\u884c\u4e86\u7edf\u8ba1\u4fe1\u606f\u7684\u8bb0\u5f55\uff0c\u5305\u62ec\u6700\u5c0f\u503c\uff0c\u6700\u5927\u503c\uff0c\u7a7a\u503c\u4e2a\u6570\u3002</p> <pre><code>FilterCompat.Filter filter = FilterCompat.get(eq(binaryColumn(\"city\"), Binary.fromString(\"nanjing\")));\n\nGroupReadSupport readSupport = new GroupReadSupport();\nBuilder&lt;Group&gt; reader = ParquetReader.builder(readSupport, new Path(inPath)).withFilter(filter).withConf(configuration);\nParquetReader&lt;Group&gt; build = reader.build();\n</code></pre>"},{"location":"data_system/1_data_organize/data_format/parquet/usage.html#_5","title":"\u5199\u5165","text":""},{"location":"data_system/1_data_organize/data_format/parquet/usage.html#_6","title":"\u793a\u4f8b","text":"<pre><code>MessageType schema = MessageTypeParser.parseMessageType(\"message Pair {\\n\" +\n        \" required binary city (UTF8);\\n\" +\n        \" required binary ip (UTF8);\\n\" +\n        \" repeated group time {\\n\"+\n        \u3000\u3000\" required int32 ttl;\\n\"+\n       \u3000\u3000 \" required binary ttl2;\\n\"+\n        \"}\\n\"+\n      \"}\");\nGroupFactory factory = new SimpleGroupFactory(schema);\nPath path = new Path(outPath);\nConfiguration configuration = new Configuration();\nGroupWriteSupport writeSupport = new GroupWriteSupport();\nwriteSupport.setSchema(schema,configuration);\nParquetWriter&lt;Group&gt; writer = new ParquetWriter&lt;Group&gt;(path,configuration,writeSupport);\n//\u628a\u672c\u5730\u6587\u4ef6\u8bfb\u53d6\u8fdb\u53bb\uff0c\u7528\u6765\u751f\u6210parquet\u683c\u5f0f\u6587\u4ef6\nBufferedReader br =new BufferedReader(new FileReader(new File(inPath)));\nString line=\"\";\nRandom r=new Random();\nwhile((line=br.readLine())!=null){\n   String[] strs=line.split(\"\\\\s+\");\n   if(strs.length==2) {\n       Group group = factory.newGroup()\n               .append(\"city\",strs[0])\n               .append(\"ip\",strs[1]);\n       Group tmpG =group.addGroup(\"time\");\n       tmpG.append(\"ttl\", r.nextInt(9)+1);\n       tmpG.append(\"ttl2\", r.nextInt(9)+\"_a\");\n       writer.write(group);\n   }\n}\nwriter.close();\n</code></pre> <p>TODO\uff1a\u5c06 Java PoJo \u5bf9\u8c61\u76f4\u63a5\u5199\u4e3aParquet\u5bf9\u8c61\u3002</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/index.html","title":"Protobuf","text":"<p>protocol buffers \u662f\u4e00\u79cd\u8bed\u8a00\u65e0\u5173\u3001\u5e73\u53f0\u65e0\u5173\u3001\u53ef\u6269\u5c55\u7684\u5e8f\u5217\u5316\u7ed3\u6784\u6570\u636e\u7684\u65b9\u6cd5\uff0c\u5b83\u53ef\u7528\u4e8e\uff08\u6570\u636e\uff09\u901a\u4fe1\u534f\u8bae\u3001\u6570\u636e\u5b58\u50a8\u7b49\u3002 \u53ef\u4ee5\u5bf9\u6570\u636e\u524d\u5411\u517c\u5bb9\uff08\u5ffd\u7565\u65e7\u5b57\u6bb5\uff09\uff0c\u548c\u540e\u5411\u517c\u5bb9\uff08\u5ffd\u7565\u65b0\u5b57\u6bb5\uff09\u3002</p> <ul> <li>\u8bed\u8a00\u6307\u5bfc</li> <li>TODO: \u4f7f\u7528\u6559\u7a0b</li> <li>TODO: \u7f16\u7801\u539f\u7406</li> </ul>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/encode.html","title":"Encode","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/encode.html#_1","title":"\u7f16\u7801","text":""},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/encode.html#_2","title":"\u793a\u4f8b","text":"<p>\u7b80\u5355\u7684\u6d88\u606f\u5b9a\u4e49\uff1a</p> <pre><code>message Test1 {\n  optional int32 a = 1;\n}\n</code></pre> <p>\u5728\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u4f60\u521b\u5efa\u4e00\u4e2a Test1 message\uff0c\u5e76\u5c06 a \u8bbe\u7f6e\u4e3a150\u3002\u7136\u540e\uff0c\u5c06 message \u5e8f\u5217\u5316\u4e3a\u8f93\u51fa\u6d41\u3002\u5982\u679c\u4f60\u80fd\u591f\u67e5\u770b\u76f8\u5e94\u7684\u7f16\u7801\u540e\u7684\u7ed3\u679c\uff0c\u4f60\u4f1a\u770b\u5230\u4ee5\u4e0b\u4e09\u4e2a\u5b57\u8282\uff0816\u8fdb\u5236\uff09\uff1a</p> <pre><code>08 96 01\n</code></pre>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/encode.html#base-128-varints","title":"Base 128 Varints","text":"<p>varints \u662f\u4e00\u79cd\u7528\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u8282\u5e8f\u5217\u5316\uff08\u7f16\u7801\uff09\u6574\u6570\u7684\u65b9\u6cd5\u3002\u8f83\u5c0f\u7684\u6570\u5b57\u5c06\u5360\u7528\u8f83\u5c11\u7684\u5b57\u8282\u6570\u3002</p> <p>varint \u4e2d\u7684\u6bcf\u4e2a\u5b57\u8282\u90fd\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u6807\u8bc6\u4f4d\uff08msb\uff09- msb \u8868\u793a\u540e\u9762\u8fd8\u6709\u5b57\u8282\u9700\u8981\u8bfb\u53d6\uff08\u5f53\u524d\u7f16\u7801\u8fd8\u672a\u7ed3\u675f\uff09\u3002\u6bcf\u4e2a\u5b57\u8282\u7684\u4f4e 7 \u4f4d\u7528\u4e8e\u4ee5 7 \u4f4d\u4e00\u7ec4\u7684\u65b9\u5f0f\u5b58\u50a8\u6570\u5b57\u7684\u4e8c\u8fdb\u5236\u8865\u7801\uff0c\u4e8c\u8fdb\u5236\u8865\u7801\u7ec4\u7684\u4f4e\u4f4d\u6392\u5728\u7f16\u7801\u5e8f\u5217\u7684\u524d\u9762\uff08least significant group first\uff09\u3002</p> <pre><code># 300 \u7684\u7f16\u7801\n1010 1100 0000 0010   # \u53bb\u9664\u6bcf\u4e2a\u5b57\u8282\u7684msb\n\u2192 010 1100  000 0010  # \u5c06\u4e24\u4e2a7\u4f4d\u7ec4\u53cd\u8f6c\uff0c\u524d\u9762\u7684\u7ec4\u8868\u793a\u4f4e\u4f4d\n\u2192 000 0010  010 1100  # \u53bb\u6389\u8ba1\u7b97\u65f6\u591a\u4f59\u7684 0     \n\u2192 100101100           # \u8ba1\u7b97\u5bf9\u5e94\u7684\u6574\u578b       \n\u2192 256 + 32 + 8 + 4 = 300    \n</code></pre> <p>varints \u4e4b\u6240\u4ee5\u5c06\u4f4e\u4f4d\u7684\u653e\u5728\u524d\u5934\uff0c\u662f\u4e3a\u4e86\u8fdb\u884c\u4f4d\u64cd\u4f5c\uff08\u8fd8\u539f\u6570\u503c\uff09\u7684\u65f6\u5019\u66f4\u52a0\u65b9\u4fbf\u3002</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/encode.html#message","title":"Message\u7ed3\u6784","text":"<p>\u4e00\u4e2a protocol buffer message \u5b9e\u9645\u4e0a\u662f\u4e00\u7cfb\u5217\u7684\u952e\u503c\u5bf9\u3002\u6d88\u606f\u7684\u4e8c\u8fdb\u5236\u7248\u672c\u53ea\u4f7f\u7528\u5b57\u6bb5\u7684\u6570\u5b57\u4f5c\u4e3a key - \u800c\u6bcf\u4e2a\u5b57\u6bb5\u7684\u540d\u79f0\u548c\u58f0\u660e\u7684\u7c7b\u578b\u53ea\u80fd\u901a\u8fc7\u5f15\u7528 message \u7c7b\u578b\u7684\u5b9a\u4e49\uff08\u5373 .proto \u6587\u4ef6\uff09\u5728\u89e3\u7801\u7aef\u786e\u5b9a\u3002</p> <p>\u8bc6\u522b message \u7f16\u7801\u4e2d\u6bcf\u4e2a\u5b57\u6bb5\u7684 key \u5b9e\u9645\u4e0a\u662f\u4e24\u4e2a\u503c - \u6765\u81ea .proto \u6587\u4ef6\u7684\u5b57\u6bb5\u7f16\u53f7\uff0c\u4ee5\u53ca\u4e00\u4e2a\u63d0\u4f9b\u8db3\u591f\u4fe1\u606f\u4ee5\u67e5\u627e \u201c\u503c\u7684\uff08\u5b57\u8282\uff09\u957f\u5ea6\u201d \u7684\u7c7b\u578b\u3002\u5728\u5927\u591a\u6570\u8bed\u8a00\u5b9e\u73b0\u4e2d\uff0c\u8be5 key \u88ab\u79f0\u4e3a\u4e00\u4e2a tag \uff08\u6807\u8bb0\uff09\u3002</p> <p>\u53ef\u7528\u7684\u7c7b\u578b\u5982\u4e0b:</p> Type Meaning Used For 0 Varint int32, int64, uint32, uint64, sint32, sint64, bool, enum 1 64-bit fixed64, sfixed64, double 2 Length-delimited string, bytes, embedded messages, packed repeated fields 3 Start group groups (deprecated,\u9057\u5f03) 4 End group groups (deprecated,\u9057\u5f03) 5 32-bit fixed32, sfixed32, float <p>\u6d88\u606f\u6d41\u4e2d\u7684\u6bcf\u4e2a Tag (field_number + wire_type) \u90fd\u4f7f\u7528 varint \u8fdb\u884c\u7f16\u7801\uff0c\u4e14\u6700\u540e\u4e09\u4f4d bit \u5b58\u50a8\u7c7b\u578b wire_type\uff08\u5176\u5b83\u4f4d\u5b58\u50a8\u5b57\u6bb5\u7f16\u53f7 field_number\uff09\u3002</p> <p>\u793a\u4f8b\u4e2d\uff0c\u7b2c\u4e00\u4e2a\u6570\u5b57\u603b\u662f\u4e00\u4e2a varint \u7f16\u7801\u7684 tag \uff0c\u8fd9\u91cc\u662f 08 (000 1000)\uff0c\u540e\u4e09\u4f4d bit \u4ece\u800c\u5f97\u5230\u7c7b\u578b\u4e3a 0 (varint\uff0c\u63a5\u4e0b\u6765\u8981\u8bfb\u53d6\u7684 value \u7684\u7c7b\u578b)\uff0c\u53f3\u79fb 3 \u4f4d\u5f97\u5230 varint \u7f16\u7801\u7684 1\uff08\u5b57\u6bb5\u7f16\u53f7\uff09</p> <pre><code>96 01 = 1001 0110  0000 0001\n       \u2192 000 0001  +  001 0110 (drop the msb and reverse the groups of 7 bits)\n       \u2192 10010110\n       \u2192 128 + 16 + 4 + 2 = 150\n</code></pre>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/encode.html#signed-integers","title":"Signed Integers","text":"<p>\u5728\u5bf9\u8d1f\u6570\u8fdb\u884c\u7f16\u7801\u65f6\uff0csigned int \u7c7b\u578b\uff08sint32 \u548c sint64\uff09\u4e0e\u6807\u51c6\u7684 int \u7c7b\u578b\uff08int32 \u548c int64\uff09\u4e4b\u95f4\u5b58\u5728\u7740\u91cd\u8981\u5dee\u5f02\u3002\u5982\u679c\u4f7f\u7528 int32 \u6216 int64 \u4f5c\u4e3a\u8d1f\u6570\u7684\u7c7b\u578b\uff0c\u5219\u751f\u6210\u7684 varint \u603b\u662f\u5341\u4e2a\u5b57\u8282\u957f\uff0d\u5b83\u5b9e\u9645\u4e0a\u88ab\u89c6\u4e3a\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u65e0\u7b26\u53f7\u6574\u6570\u3002\u5982\u679c\u4f7f\u7528 signed int \u7c7b\u578b\uff08sint32 \u548c sint64\uff09\uff0c\u5219\u751f\u6210\u7684 varint \u5c06\u4f7f\u7528 ZigZag \u7f16\u7801\uff0c\u8fd9\u6837\u6548\u7387\u66f4\u9ad8\u3002</p> <p>\u5982\u679c\u662f\u8d1f\u6570\uff0c\u90a3\u4e48\u5fc5\u987b\u6709\u6700\u9ad8\u4f4d\u8868\u793a\u7b26\u53f7\u4f4d\uff0c\u4e5f\u5c31\u662f\u8bf4\u5929\u7136\u7684\u4f1a\u7528\u5c3d\u6240\u6709\u5b57\u8282(\u6bcf\u4e2a\u5b57\u8282\u8fd8\u9700\u8981\u62ff\u51fa\u4e00\u4e2a bit \u4f4d\u505a msb\uff0c\u6700\u591a5\u4e2a\u5b57\u8282\uff09\u3002</p> <p>protobuf \u4e3a\u4e86\u517c\u5bb9\u6027\uff0c int32 \u548c int64 \u80fd\u591f\u517c\u5bb9\uff08\u6bd4\u5982\u5728 .proto \u6587\u4ef6\u4e2d\u5c06 int32 \u6539\u6210 int64\uff09\uff0c\u6240\u4ee5 int32 \u7684\u8d1f\u6570\u4f1a\u6269\u5c55\u5230 int64 \u7684\u957f\u5ea6\uff0810\u5b57\u8282\uff09\u3002</p> <p>\u6b63\u6570\u7684\u517c\u5bb9\uff1avarints \u7f16\u7801\uff0c\u8fd9\u79cd\u7f16\u7801\u5929\u7136\u4f7f\u5f97 int32 \u548c int64 \u7684\u6b63\u6570\u517c\u5bb9\u3002</p> <p>ZigZag\u7684\u8bf4\u660e\u89c1ZigZag\u7f16\u7801.md\uff0cZigZag \u7f16\u7801\u5c06\u6709\u7b26\u53f7\u6574\u6570\u6620\u5c04\u5230\u65e0\u7b26\u53f7\u6574\u6570\u3002</p> Signed Original Encoded As 0 0 -1 1 1 2 -2 3 2147483647 4294967294 -2147483648 4294967295 <p>sint32 \u7c7b\u578b\u7684 n \u7f16\u7801\u5904\u7406\u5982\u4e0b\uff1a</p> <pre><code>(n &lt;&lt; 1) ^ (n &gt;&gt; 31)\n</code></pre>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/encode.html#non-varint-numbers","title":"Non-varint Numbers","text":"<p>non-varint \u6570\u5b57\u7c7b\u578b\u5f88\u7b80\u5355\uff0cdouble \u548c fixed64 \u5bf9\u5e94\u7684\u7c7b\u578b\uff08wire type\uff09\u4e3a 1\uff08\u8bfb\u53d664\u4e3a\u4f4d\uff09\uff0cfloat \u548c fixed32 \u5bf9\u5e94\u7684\u7c7b\u578b\uff08wire type\uff09\u4e3a 5\uff08\u8bfb\u53d632\u4f4d\uff09\u3002</p> <p>\u503c\u90fd\u4ee5 little-endian \uff08\u4e8c\u8fdb\u5236\u8865\u7801\u4f4e\u4f4d\u5728\u524d\uff09\u5b57\u8282\u987a\u5e8f\u5b58\u50a8\u3002</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/encode.html#strings","title":"Strings","text":"<p>\u7c7b\u578b\uff08wire type\uff09\u4e3a 2\uff08\u957f\u5ea6\u5212\u5206\uff09\u8868\u793a\u63a5\u4e0b\u6765\u7684\u5b57\u8282\u5c06\u662f varint \u7f16\u7801\u7684\u957f\u5ea6\uff0c\u4e4b\u540e\u8ddf\u6307\u5b9a\u957f\u5ea6\u7684\u6570\u636e\u5b57\u8282\u3002</p> <pre><code>message Test2 {\n  optional string b = 2;\n}\n</code></pre> <p>\u5c06 b \u7684\u503c\u8bbe\u7f6e\u4e3a \"testing\" \u540e\u5f97\u5230\u5982\u4e0b\u7f16\u7801\uff1a</p> <pre><code>12 07 | 74 65 73 74 69 6e 67\n</code></pre> <p>\u540e\u4e03\u4e2a\u5b57\u8282\u4e3a \"testing\" \u7684 UTF8 \u7f16\u7801\u3002\u7b2c\u4e00\u4e2a\u5b57\u8282 0x12 \u4e3a key \u2192 \u5b57\u6bb5\u7f16\u7801 field_number = 2, \u7c7b\u578b wire type = 2\u3002 varint \u503c\u7684\u957f\u5ea6\u4e3a 7\uff0c\u5e76\u4e14\u770b\u5230\u5b83\u540e\u9762\u6709\u4e03\u4e2a\u5b57\u8282 -\u5373\u4e3a\u6211\u4eec\u9700\u8981\u8bfb\u53d6\u7684\u503c\uff08\u5b57\u7b26\u4e32\uff09\u3002</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/encode.html#embedded-messages","title":"Embedded Messages","text":"<p>\u4e0b\u9762\u7684 message\uff0c\u5185\u5d4c\u4e86\u6211\u4eec\u4e4b\u524d\u7684\u7b80\u5355\u4f8b\u5b50 Test1\uff1a</p> <pre><code>message Test3 {\n  optional Test1 c = 3;\n}\n</code></pre> <p>\u8bbe\u7f6e\u5176\u4e2d\u7684 Test1 \u7684 a = 150\uff0c\u6700\u7ec8\u7f16\u7801\u5982\u4e0b\uff1a</p> <pre><code>1a 03 08 96 01\n</code></pre> <p>\u540e\u4e09\u4e2a\u5b57\u8282\u548c\u6211\u4eec\u7684\u7b2c\u4e00\u4e2a\u4f8b\u5b50\u7ed3\u679c\u76f8\u540c\uff0808 96 01\uff09\uff0c\u5728\u8fd9\u4e09\u4e2a\u5b57\u8282\u4e4b\u524d\u4e3a 03 \u7f16\u7801\uff08\u4ee3\u8868\u7740\u5b57\u8282\u957f\u5ea6\uff09-\u5d4c\u5165\u6d88\u606f\u7684\u5904\u7406\u65b9\u5f0f\u4e0e\u5b57\u7b26\u4e32\u5b8c\u5168\u76f8\u540c\uff081a\u8868\u793a\u5e8f\u53f7\u4f4d3\u548cwire type\u4e3a2\uff09\u3002</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/encode.html#optional-repeated","title":"Optional \u548c Repeated \u5143\u7d20","text":"<p>proto2 message \u5b9a\u4e49\u6709 <code>repeated</code> \u5b57\u6bb5\uff08\u6ca1\u6709\u4f7f\u7528 <code>[packed=true]</code> \u9009\u9879\uff09\uff0c\u5219\u5bf9\u5e94\u7684 message \u7f16\u7801\u5c06\u5177\u6709\u96f6\u4e2a\u6216\u591a\u4e2a\u76f8\u540c\u5b57\u6bb5\u7f16\u53f7\u7684\u952e\u503c\u5bf9\u3002</p> <p>\u5bf9\u4e8e proto3 \u4e2d\u7684\u4efb\u4f55 non-repeated \u5b57\u6bb5\u6216 proto2 \u4e2d\u7684 optional \u5b57\u6bb5\uff0cmessage \u7f16\u7801\u53ef\u80fd\u5177\u6709\u6216\u4e0d\u5177\u6709\u8be5\u5b57\u6bb5\u7f16\u53f7\u5bf9\u5e94\u7684\u952e\u503c\u5bf9\u3002</p> <p>\u901a\u5e38\uff0c\u7f16\u7801\u6d88\u606f\u6c38\u8fdc\u4e0d\u4f1a\u6709\u591a\u4e2a non-repeated \u5b57\u6bb5\u7684\u5b9e\u4f8b\uff0c\u4f46\u89e3\u6790\u5668\u5e94\u8be5\u80fd\u591f\u5904\u7406\u8fd9\u4e2a\u60c5\u51b5\u3002\u5bf9\u4e8e\u6570\u5b57\u7c7b\u578b\u548c\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u591a\u6b21\u51fa\u73b0\u76f8\u540c\u7684\u5b57\u6bb5\uff0c\u5219\u89e3\u6790\u5668\u63a5\u53d7\u5b83 \u201c\u770b\u5230\u201d \u7684\u6700\u540e\u4e00\u4e2a\u503c\u3002</p> <p>\u5bf9\u4e8e\u5d4c\u5165\u5f0f\u6d88\u606f\u5b57\u6bb5\uff0c\u89e3\u6790\u5668\u5408\u5e76\u540c\u4e00\u5b57\u6bb5\u7684\u591a\u4e2a\u5b9e\u4f8b\uff0c\u5c31\u50cf\u4f7f\u7528 Message::MergeFrom \u65b9\u6cd5\u4e00\u6837 - \u4e5f\u5c31\u662f\u8bf4\uff0c\u540e\u9762\u5b9e\u4f8b\u4e2d\u7684\u6240\u6709\u5355\u4e2a\u6807\u91cf\u5b57\u6bb5\u90fd\u66ff\u6362\u524d\u8005\uff0c\u5355\u4e2a\u5d4c\u5165\u6d88\u606f\u88ab\u5408\u5e76\uff0c\u800c repeated \u5b57\u6bb5\u5c06\u88ab\u4e32\u8054\u8d77\u6765\u3002\u8fd9\u4e9b\u89c4\u5219\u7684\u4f5c\u7528\u662f\u4f7f\u5f97\u4e24\u4e2a\u6d88\u606f\uff08\u5b57\u7b26\u4e32\uff09\u4e32\u8054\u8d77\u6765\u89e3\u6790\u4ea7\u751f\u7684\u7ed3\u679c\u4e0e\u5206\u522b\u89e3\u6790\u4e24\u4e2a\u6d88\u606f\uff08\u5b57\u7b26\u4e32\uff09\u540e\u5408\u5e76\u7ed3\u679c\u5bf9\u8c61\u4ea7\u751f\u7684\u7ed3\u679c\u5b8c\u5168\u76f8\u540c\u3002\u4e5f\u5c31\u662f\uff1a</p> <pre><code>MyMessage message;\nmessage.ParseFromString(str1 + str2);\n</code></pre> <p>\u7b49\u4ef7\u4e8e\uff1a</p> <pre><code>MyMessage message, message2;\nmessage.ParseFromString(str1);\nmessage2.ParseFromString(str2);\nmessage.MergeFrom(message2);\n</code></pre> <p>\u6b64\u5c5e\u6027\u5076\u5c14\u4f1a\u6709\u7528\uff0c\u56e0\u4e3a\u5b83\u5141\u8bb8\u6211\u4eec\u5408\u5e76\u4e24\u6761\u6d88\u606f\uff0c\u5373\u4f7f\u6211\u4eec\u4e0d\u77e5\u9053\u5b83\u4eec\u7684\u7c7b\u578b\u3002</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/encode.html#packed-repeated-fields","title":"Packed Repeated Fields","text":"<p>\u5728 proto3 \u4e2d\uff0c<code>repeated</code> \u5b57\u6bb5\u9ed8\u8ba4\u4f7f\u7528 packed \u7f16\u7801\u3002</p> <p>\u6ca1\u6709\u5305\u542b\u4efb\u4f55\u5143\u7d20\u7684 packed repeated \u5b57\u6bb5\u4e0d\u4f1a\u51fa\u73b0\u5728\u7f16\u7801\u6d88\u606f\u4e2d\u3002\u5426\u5219\uff08\u5305\u542b\u6709\u5143\u7d20\uff09\uff0c\u8be5\u5b57\u6bb5\u7684\u6240\u6709\u5143\u7d20\u90fd\u88ab\u6253\u5305\u6210\u4e00\u4e2a\u952e\u503c\u5bf9\uff0c\u5176\u4e2d\u7c7b\u578b\uff08wire type\uff09\u4e3a 2\uff08length-delimited\uff09\u3002\u6bcf\u4e2a\u5143\u7d20\u7684\u7f16\u7801\u65b9\u5f0f\u4e0e\u6b63\u5e38\u60c5\u51b5\u76f8\u540c\uff0c\u53ea\u662f\u524d\u9762\u6ca1\u6709\u952e\u3002</p> <p>\u4f8b\u5982\uff0c\u5047\u8bbe\u6211\u4eec\u6709\u5982\u4e0b\u6d88\u606f\u7c7b\u578b\uff1a</p> <pre><code>message Test4 {\n  repeated int32 d = 4 [packed=true];\n}\n</code></pre> <p>\u73b0\u5728\u5047\u8bbe\u4f60\u6784\u9020\u4e00\u4e2a Test4\uff0c\u4e3a\u91cd\u590d\u7684\u5b57\u6bb5 d \u5206\u522b\u8d4b\u503c\u4e3a 3\u3001270 \u548c 86942\u3002\u90a3\u4e48\u5bf9\u5e94\u7684\u7f16\u7801\u5c06\u662f\uff1a</p> <pre><code>22        // key (\u6216\u79f0 tag\uff0c\u5b57\u6bb5\u7f16\u7801 4, wire type 2)\n06        // payload \u957f\u5ea6 (\u5373\u540e\u9762\u9700\u8981\u8bfb\u53d6\u7684\u6240\u6709\u503c\u7684\u957f\u5ea66 bytes)\n03        // first element (varint 3)\n8E 02     // second element (varint 270)\n9E A7 05  // third element (varint 86942)\n</code></pre> <p>\u53ea\u6709\u539f\u59cb\u6570\u5b57\u7c7b\u578b\uff08\u4f7f\u7528 Varint\uff0c32-bit \u6216 64-bit\u7684wire type\uff09\u7684 repeated \u5b57\u6bb5\u624d\u80fd\u58f0\u660e\u4e3a \u201cpacked\u201d\u3002</p> <p>repeated string \u7c7b\u578b\u4e0d\u4f1a\u88ab\u6253\u5305\uff1f</p> <p>\u5bf9\u5e94\u7684 packed \u7ed3\u679c\u5982\u679c\u662f tag-length-value-value-value...\uff0c\u5219\u65e0\u6cd5\u8bc6\u522b\u6570\u7ec4\u5143\u7d20\u7684\u8fb9\u754c\u3002</p> <p>\u5982\u679c packed \u7ed3\u679c\u4e3a tag-length-[length-value-length-value]\uff0c\u90a3\u4e48\u548c\u4e0d\u6253\u5305\u7684\u7f16\u7801\u7ed3\u679c tag-length-value-tag-length-value-tag-length-value.... \u76f8\u6bd4 \uff1f\uff1f</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html","title":"Grpc","text":""},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#_1","title":"\u901a\u4fe1\u6280\u672f\u7684\u6f14\u5316","text":"<p>\u4f20\u7edf\u7684RPC\uff1a\u5982 COBRA \u548c JMI \u7b49\uff1b</p> <ul> <li>\u6784\u5efa\u5728TCP\u4e4b\u4e0a\uff0c\u59a8\u788d\u4e92\u64cd\u4f5c\u6027\u4e14\u6709\u5927\u91cf\u7684\u89c4\u8303\u9650\u5236\uff1b</li> </ul> <p>SOAP\uff1a\u7b80\u5355\u5bf9\u8c61\u8bbf\u95ee\u534f\u8bae</p> <ul> <li>\u9762\u5411\u670d\u52a1\u7684\u67b6\u6784\u7684\u6807\u51c6\u901a\u4fe1\u6280\u672f\uff0c\u901a\u8fc7XML\u4ea4\u6362\u6570\u636e\uff0c\u652f\u6301\u4efb\u52a1\u5e95\u5c42\u901a\u4fe1\u534f\u8bae\uff0c\u6700\u5e38\u89c1\u4e3aHTTP\uff1b</li> </ul> <p>REST\uff1a\u63cf\u8ff0\u6027\u72b6\u6001\u8fc1\u79fb\uff0c\u9762\u5411\u8d44\u6e90\u7684\u67b6\u6784\uff0c\u8d44\u6e90\u7684\u521b\u5efa\u3001\u8bfb\u53d6\u3001\u66f4\u65b0\u548c\u5220\u9664\uff1b</p> <ul> <li>\u57fa\u4e8e\u6587\u672c\u7684\u4f4e\u6548\u6d88\u606f\u534f\u8bae\uff0c\u5982 JSON/XML\uff08HTTP1.x\uff09\uff1b</li> <li>REST\u67b6\u6784\u98ce\u683c\u96be\u4ee5\u5f3a\u5236\u5b9e\u65bd\uff0c\u53ea\u6709\u9075\u5faa\u5b9e\u8df5\uff0c\u4f46\u4e0d\u80fd\u591f\u5f3a\u5236\u8981\u6c42\uff1b</li> <li>\u5e94\u7528\u7a0b\u5e8f\u7f3a\u4e4f\u5f3a\u7c7b\u578b\u63a5\u53e3\uff0cOpenAPI/Swagger\u90fd\u662f\u4e8b\u540e\u8865\u6551\u63aa\u65bd\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#_2","title":"\u573a\u666f","text":"<p>\u4f18\u52bf\uff1a</p> <ul> <li>\u9ad8\u6548\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u57fa\u4e8eprotobuf\u4e8c\u8fdb\u5236\uff1b</li> <li>\u7b80\u5355\u4e14\u5b9a\u4e49\u826f\u597d\u7684\u670d\u52a1\u63a5\u53e3\u548c\u670d\u52a1\uff1b</li> <li>\u5f3a\u7c7b\u578b\uff0c\u591a\u8bed\u8a00\uff1b</li> <li>\u53cc\u5de5\u6d41\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u652f\u6301\u6d41\uff1b</li> <li>\u5185\u7f6e\u5546\u4e1a\u5316\u7279\u6027\uff0c\u5982\u8ba4\u8bc1\u3001\u52a0\u5bc6\u3001\u5f39\u6027\u3001\u538b\u7f29\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u670d\u52a1\u53d1\u73b0\u7b49\uff1b</li> <li>\u4e91\u539f\u751f\u7cfb\u7edf\u96c6\u6210\uff0c\u652f\u6301\u5f88\u597d\uff1b</li> </ul> <p>\u52a3\u52bf\uff1a</p> <ul> <li>grpc\u4e0d\u592a\u9002\u5408\u9762\u5411\u5916\u90e8\u7684\u670d\u52a1\uff0cgrpc\u7f51\u5173\u662f\u89e3\u51b3\u65b9\u6848\uff1b</li> <li>\u5de8\u5927\u7684\u670d\u52a1\u5b9a\u4e49\u53d8\u66f4\u662f\u590d\u6742\u7684\u5f00\u53d1\u6d41\u7a0b\uff0c\u4e0d\u8981\u5f15\u5165\u7834\u574f\u6027\u7684\u53d8\u66f4\uff08protobuf\u7684\u517c\u5bb9\u6027\uff09\uff1b</li> <li>\u6d4f\u89c8\u5668\u548c\u79fb\u52a8\u7a0b\u5e8f\u5bf9gRPC\u7684\u652f\u6301\u521d\u7ea7\u9636\u6bb5\u4e0d\u592a\u6210\u719f\uff082022\u5e74\uff09\uff1b</li> </ul>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#_3","title":"\u539f\u7406","text":"<p>\u57fa\u4e8eHTTP/2 + Protobuf\uff0c\u652f\u6301\u4e92\u8054\u7f51\u89c4\u6a21\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u6280\u672f\u3002</p> <p>\u4e00\u4e2aChannel\u5bf9\u5e94\u5e95\u5c42\u4e00\u4e2aTCP\u8fde\u63a5\uff0c\u53ea\u662f\u57fa\u4e8eHTTP/2\u5b9e\u73b0\u591a\u8def \u590d\u7528\u3002</p> <p>\u4e00\u4e2aTCP\u8fde\u63a5\u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\u591a\u4e2aRPC\uff0c\u4e00\u6b21RPC\u4e3aHTTP/2\u4e2d\u7684\u4e00\u4e2aStream\u3002</p> <ul> <li>\u5c06\u670d\u52a1\u6ce8\u518c\u5230gRPC\u5185\u90e8\u7684\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u4e0a\uff0c\u6839\u636e\u670d\u52a1\u540d\u548c\u65b9\u6cd5\u540d\u76f4\u63a5\u8c03\u7528\u6ce8\u518c\u7684\u670d\u52a1\u5b9e\u4f8b\uff0c\u4e0d\u9700\u8981\u53cd\u5c04\u7684\u65b9\u5f0f\u8fdb\u884c\u8c03\u7528\u3002</li> </ul>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#stream-vs-repeated","title":"Stream vs Repeated","text":"<p>\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u4e34\u65f6\u6570\u636e(\u5982\u901a\u77e5\u6216\u65e5\u5fd7\u6d88\u606f)\u4f7f\u7528\u6d41\u7279\u6027\u3002</p> <p>\u53d6\u51b3\u4e8e\u4ee5\u4e0b\u56e0\u7d20:</p> <ul> <li> <p>\u6570\u636e\u96c6\u7684\u603b\u4f53\u5927\u5c0f\u3002</p> </li> <li> <p>\u5728\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u5668\u7aef\u521b\u5efa\u6570\u636e\u96c6\u6240\u82b1\u8d39\u7684\u65f6\u95f4\u3002</p> </li> <li> <p>\u6570\u636e\u96c6\u7684\u4f7f\u7528\u8005\u662f\u5426\u53ef\u4ee5\u5728\u7b2c\u4e00\u9879\u53ef\u7528\u65f6\u7acb\u5373\u5bf9\u5176\u8fdb\u884c\u64cd\u4f5c\uff0c\u6216\u8005\u9700\u8981\u5b8c\u6574\u7684\u6570\u636e\u96c6\u6765\u505a\u4efb\u4f55\u6709\u7528\u7684\u4e8b\u60c5\u3002</p> </li> </ul> <p>\u4efb\u4f55\u5728\u5927\u5c0f\u4e0a\u53d7\u5230\u9650\u5236\u7684\u6570\u636e\u96c6\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u77ed\u65f6\u95f4\u5185(\u6bd4\u5982\u5728\u4e00\u79d2\u949f\u5185)\u5b8c\u6574\u751f\u6210\u7684\u6570\u636e\u96c6\uff0c\u60a8\u5e94\u8be5\u5728\u5e38\u89c4Protobuf\u6d88\u606f\u4e2d\u4f7f\u7528\u91cd\u590d\u5b57\u6bb5\u3002</p> <p>\u6570\u636e\u96c6\u4e2d\u7684\u6d88\u606f\u5bf9\u8c61\u53ef\u80fd\u975e\u5e38\u5927\u65f6\uff0c\u6700\u597d\u4f7f\u7528\u6d41\u8bf7\u6c42\u6216\u54cd\u5e94\u6765\u4f20\u8f93\u5b83\u4eec\u3002</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#todozero-copy","title":"TODO\uff08Zero copy\uff09","text":""},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#_4","title":"\u6a21\u5f0f","text":""},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#unary","title":"unary","text":""},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#client-streaming","title":"client streaming","text":""},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#server-streaming","title":"server streaming","text":""},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#bidirectional-streaming","title":"bidirectional streaming","text":""},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#_5","title":"\u62e6\u622a\u5668","text":""},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#java","title":"\u7ebf\u7a0b\u6a21\u578b\uff08Java\uff09","text":""},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#_6","title":"\u670d\u52a1\u7aef\u7ebf\u7a0b\u6a21\u578b","text":"<ul> <li>\u670d\u52a1\u7aef\u76d1\u542c\u548c\u5ba2\u6237\u7aef\u63a5\u5165\u7ebf\u7a0b\uff08HTTP/2 Acceptor\uff09</li> <li>\u7f51\u7edcI/O\u8bfb\u5199\u7ebf\u7a0b</li> <li>\u670d\u52a1\u63a5\u53e3\u8c03\u7528\u7ebf\u7a0b</li> </ul> <p>\u5176\u4e2d\uff1aHTTP/2\u670d\u52a1\u7aef\u521b\u5efa\u3001HTTP/2\u8bf7\u6c42\u6d88\u606f\u7684\u63a5\u5165\u548c\u54cd\u5e94\u53d1\u9001\u7531Netty\u8d1f\u8d23\uff1bgPRC\u6d88\u606f\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u63a5\u53e3\u8c03\u7528\u7531gRPC\u7684SerializingExecutor\u7684\u7ebf\u7a0b\u6c60\u8d1f\u8d23\u3002</p> <ul> <li>NettyServer\u5b9e\u4f8b\u521b\u5efa\uff1a\u7531NettyServerBuilder\u7684buildTransportServers\u65b9\u6cd5\u6784\u5efa\u3002</li> <li>\u5728 gRPC \u4e2d\uff0c\u9ed8\u8ba4\u91c7\u7528\u5171\u4eab\u6c60\u6a21\u5f0f\u521b\u5efa NioEventLoopGroup\uff0c\u6240\u6709\u7684 gRPC \u670d\u52a1\u7aef\u5b9e\u4f8b\uff0c\u90fd\u7edf\u4e00\u4ece SharedResourceHolder \u5206\u914d NioEventLoopGroup \u8d44\u6e90\uff0c\u5b9e\u73b0 NioEventLoopGroup \u7684\u5171\u4eab\u3002</li> </ul> <p>\u5de5\u4f5c\u6d41\u7a0b\u603b\u7ed3\u5982\u4e0b\uff1a</p> <ul> <li>\u4ece\u4e3b\u7ebf\u7a0b\u6c60\uff08bossGroup\uff09\u4e2d\u968f\u673a\u9009\u62e9\u4e00\u4e2a Reactor \u7ebf\u7a0b\u4f5c\u4e3a Acceptor \u7ebf\u7a0b\uff0c\u7528\u4e8e\u7ed1\u5b9a\u76d1\u542c\u7aef\u53e3\uff0c\u63a5\u6536\u5ba2\u6237\u7aef\u8fde\u63a5\uff1b</li> <li>Acceptor \u7ebf\u7a0b\u63a5\u6536\u5ba2\u6237\u7aef\u8fde\u63a5\u8bf7\u6c42\u4e4b\u540e\u521b\u5efa\u65b0\u7684 SocketChannel\uff0c\u5c06\u5176\u6ce8\u518c\u5230\u4e3b\u7ebf\u7a0b\u6c60\uff08bossGroup\uff09\u7684\u5176\u5b83 Reactor \u7ebf\u7a0b\u4e0a\uff0c\u7531\u5176\u8d1f\u8d23\u63a5\u5165\u8ba4\u8bc1\u3001\u63e1\u624b\u7b49\u64cd\u4f5c\uff1b</li> <li>\u6b65\u9aa4 2 \u5b8c\u6210\u4e4b\u540e\uff0c\u5e94\u7528\u5c42\u7684\u94fe\u8def\u6b63\u5f0f\u5efa\u7acb\uff0c\u5c06 SocketChannel \u4ece\u4e3b\u7ebf\u7a0b\u6c60\u7684 Reactor \u7ebf\u7a0b\u7684\u591a\u8def\u590d\u7528\u5668\u4e0a\u6458\u9664\uff0c\u91cd\u65b0\u6ce8\u518c\u5230 Sub \u7ebf\u7a0b\u6c60\uff08workerGroup\uff09\u7684\u7ebf\u7a0b\u4e0a\uff0c\u7528\u4e8e\u5904\u7406 I/O \u7684\u8bfb\u5199\u64cd\u4f5c\u3002</li> </ul> <p>Netty \u7684 NIO \u7ebf\u7a0b\u5b9e\u73b0\u662f NioEventLoop\uff0c\u5b83\u7684\u804c\u8d23\u5982\u4e0b\uff1a</p> <ul> <li>\u4f5c\u4e3a\u670d\u52a1\u7aef Acceptor \u7ebf\u7a0b\uff0c\u8d1f\u8d23\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u63a5\u5165\uff1b</li> <li>\u4f5c\u4e3a\u5ba2\u6237\u7aef Connector \u7ebf\u7a0b\uff1f\uff1f\uff0c\u8d1f\u8d23\u6ce8\u518c\u76d1\u542c\u8fde\u63a5\u64cd\u4f5c\u4f4d\uff0c\u7528\u4e8e\u5224\u65ad\u5f02\u6b65\u8fde\u63a5\u7ed3\u679c\uff1b</li> <li>\u4f5c\u4e3a I/O \u7ebf\u7a0b\uff0c\u76d1\u542c\u7f51\u7edc\u8bfb\u64cd\u4f5c\u4f4d\uff0c\u8d1f\u8d23\u4ece SocketChannel \u4e2d\u8bfb\u53d6\u62a5\u6587\uff1b</li> <li>\u4f5c\u4e3a I/O \u7ebf\u7a0b\uff0c\u8d1f\u8d23\u5411 SocketChannel \u5199\u5165\u62a5\u6587\u53d1\u9001\u7ed9\u5bf9\u65b9\uff0c\u5982\u679c\u53d1\u751f\u5199\u534a\u5305\uff0c\u4f1a\u81ea\u52a8\u6ce8\u518c\u76d1\u542c\u5199\u4e8b\u4ef6\uff0c\u7528\u4e8e\u540e\u7eed\u7ee7\u7eed\u53d1\u9001\u534a\u5305\u6570\u636e\uff0c\u76f4\u5230\u6570\u636e\u5168\u90e8\u53d1\u9001\u5b8c\u6210\uff1b</li> <li>\u4f5c\u4e3a\u5b9a\u65f6\u4efb\u52a1\u7ebf\u7a0b\uff0c\u53ef\u4ee5\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\uff0c\u4f8b\u5982\u94fe\u8def\u7a7a\u95f2\u68c0\u6d4b\u548c\u53d1\u9001\u5fc3\u8df3\u6d88\u606f\u7b49\uff1b</li> <li>\u4f5c\u4e3a\u7ebf\u7a0b\u6267\u884c\u5668\u53ef\u4ee5\u6267\u884c\u666e\u901a\u7684\u4efb\u52a1 Task\uff08Runnable\uff09\u3002</li> </ul> <p>NioEventLoop\u540c\u65f6\u652f\u6301I/O\u64cd\u4f5c\u548cRunnable\u6267\u884c\u7684\u539f\u56e0\u5982\u4e0b\uff1a\u907f\u514d\u9501\u7ade\u4e89\uff0c\u4f8b\u5982\u5fc3\u8df3\u68c0\u6d4b\uff0c\u5f80\u5f80\u9700\u8981\u5468\u671f\u6027\u7684\u6267\u884c\u3002</p> <p>gRPC \u670d\u52a1\u7aef\u8c03\u5ea6\u7ebf\u7a0b\u4e3a SerializingExecutor\uff0c\u5b83\u5b9e\u73b0\u4e86 Executor \u548c Runnable \u63a5\u53e3\uff0c\u901a\u8fc7\u5916\u90e8\u4f20\u5165\u7684 Executor \u5bf9\u8c61\uff0c\u8c03\u5ea6\u548c\u5904\u7406 Runnable\uff0c\u540c\u65f6\u5185\u90e8\u53c8\u7ef4\u62a4\u4e86\u4e00\u4e2a\u4efb\u52a1\u961f\u5217ConcurrentLinkedQueue\uff0c\u901a\u8fc7 run \u65b9\u6cd5\u5faa\u73af\u5904\u7406\u961f\u5217\u4e2d\u5b58\u653e\u7684 Runnable \u5bf9\u8c61\u3002</p> <p>\u5f53\u670d\u52a1\u7aef\u63a5\u6536\u5230\u5ba2\u6237\u7aefHTTP/2\u8bf7\u6c42\u6d88\u606f\u65f6\uff0c\u7531Netty\u7684NioEventLoop\u7ebf\u7a0b\u5207\u6362\u5230gRPC\u7684SerializingExecutor\uff08\u6bcf\u4e2aStream\u521b\u5efa\u90fd\u4f1a\u521b\u5efa\u8be5\u5b9e\u4f8b\uff09\uff0c\u8fdb\u884c\u6d88\u606f\u7684\u53cd\u5e8f\u5217\u5316\u3001\u4ee5\u53ca\u670d\u52a1\u63a5\u53e3\u7684\u8c03\u7528\uff0cSerializeingExecutor\u5728\u9ed8\u8ba4\u914d\u7f6e\u4e0b\u4f1a\u7528\u9ed8\u8ba4\u7684\u5171\u4eab\u7ebf\u7a0b\u6c60\u53bb\u6267\u884c\u3002</p> <p>gRPC \u7684\u7ebf\u7a0b\u6a21\u578b\u9075\u5faa Netty \u7684\u7ebf\u7a0b\u5206\u5de5\u539f\u5219\uff0c\u5373\uff1a</p> <ul> <li>\u534f\u8bae\u5c42\u6d88\u606f\u7684\u63a5\u6536\u548c\u7f16\u89e3\u7801\u7531 Netty \u7684 I/O(NioEventLoop) \u7ebf\u7a0b\u8d1f\u8d23\uff1b</li> <li>gRPC service\u7ebf\u7a0b\uff08\u5e94\u7528\u7ebf\u7a0b\uff09\uff0c\u9632\u6b62\u7531\u4e8e\u5e94\u7528\u5904\u7406\u8017\u65f6\u800c\u963b\u585e Netty \u7684 I/O \u7ebf\u7a0b\u3002</li> <li>\u5c06gRPC\u8bf7\u6c42\u6d88\u606f\u53cd\u5e8f\u5217\u5316\u4e3a\u63a5\u53e3\u7684\u8bf7\u6c42\u53c2\u6570\u5bf9\u8c61\uff1b</li> <li>\u5c06\u63a5\u53e3\u54cd\u5e94\u4e3a\u5bf9\u8c61\u5e8f\u5217\u4e3aPB\u7801\u6d41\uff1b</li> <li>gRPC\u670d\u52a1\u7aef\u63a5\u53e3\u5b9e\u73b0\u7c7b\u8c03\u7528\u3002</li> </ul>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#_7","title":"\u5ba2\u6237\u7aef\u7ebf\u7a0b\u6a21\u578b","text":"<ul> <li> <p>\u5ba2\u6237\u7aef\u8fde\u63a5\u7ebf\u7a0b\uff08HTTP/2 Connector\uff09</p> </li> <li> <p>\u7f51\u7edcI/O\u8bfb\u5199\u7ebf\u7a0b</p> </li> <li> <p>\u63a5\u53e3\u8c03\u7528\u7ebf\u7a0b</p> </li> <li> <p>\u54cd\u5e94\u56de\u8c03\u901a\u77e5\u7ebf\u7a0b</p> </li> </ul> <p>\u5ba2\u6237\u7aef\u7ebf\u7a0b\u6a21\u578b\u5de5\u4f5c\u539f\u7406\u5982\u4e0b\u56fe\u6240\u793a\uff08\u540c\u6b65\u963b\u585e\u8c03\u7528\u4e3a\u4f8b\uff09\uff1a</p> <p></p> <ul> <li>\u5e94\u7528\u7ebf\u7a0b\uff0c\u8d1f\u8d23\u8c03\u7528 gRPC \u670d\u52a1\u7aef\u5e76\u83b7\u53d6\u54cd\u5e94\uff0c\u5176\u4e2d\u8bf7\u6c42\u6d88\u606f\u7684\u5e8f\u5217\u5316\u7531\u8be5\u7ebf\u7a0b\u8d1f\u8d23\u3002</li> <li>\u5ba2\u6237\u7aef\u8d1f\u8f7d\u5747\u8861\u4ee5\u53ca Netty Client \u521b\u5efa\uff0c\u7531 grpc-default-executor \u7ebf\u7a0b\u6c60\u8d1f\u8d23\u3002</li> <li>HTTP/2 \u5ba2\u6237\u7aef\u94fe\u8def\u521b\u5efa\u3001\u7f51\u7edc I/O \u6570\u636e\u7684\u8bfb\u5199\uff0c\u7531 Netty NioEventLoop \u7ebf\u7a0b\u8d1f\u8d23\u3002</li> <li>\u54cd\u5e94\u6d88\u606f\u7684\u53cd\u5e8f\u5217\u5316\u7531 SerializingExecutor \u8d1f\u8d23\uff0c\u4e0e\u670d\u52a1\u7aef\u4e0d\u540c\u7684\u662f\uff0c\u5ba2\u6237\u7aef\u4f7f\u7528\u7684\u662f ThreadlessExecutor\uff0c\u5e76\u975e JDK \u7ebf\u7a0b\u6c60\u3002</li> <li>SerializingExecutor \u901a\u8fc7\u8c03\u7528 responseFuture \u7684 set(value)\uff0c\u5524\u9192\u963b\u585e\u7684\u5e94\u7528\u7ebf\u7a0b\uff0c\u5b8c\u6210\u4e00\u6b21 RPC \u8c03\u7528\u3002</li> </ul> <p>gRPC \u91c7\u7528\u7684\u662f\u7f51\u7edc I/O \u7ebf\u7a0b\u548c\u4e1a\u52a1\u8c03\u7528\u7ebf\u7a0b\u5206\u79bb\u7684\u7b56\u7565\uff0c\u7f3a\u70b9\u5c31\u662f\u5728\u4e00\u6b21 RPC \u8c03\u7528\u8fc7\u7a0b\u4e2d\uff0c\u505a\u4e86\u591a\u6b21 I/O \u7ebf\u7a0b\u5230\u5e94\u7528\u7ebf\u7a0b\u4e4b\u95f4\u7684\u5207\u6362\uff0c\u9891\u7e41\u5207\u6362\u4f1a\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\u3002</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#_8","title":"\u5b9e\u8df5","text":""},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/grpc.html#alluxio-grpc","title":"Alluxio Grpc","text":"<p>gRPC\u9ad8\u6548\u4f20\u8f93\u6570\u636e\u7684\u4e00\u4e9b\u6280\u5de7\uff1a</p> <ul> <li>\u4f7f\u7528\u591a\u4e2achannel\u5b9e\u73b0\u6700\u5927\u541e\u5410\u91cf\uff1a\u867d\u7136\u5927\u591a\u6570\u77edRPC\u8c03\u7528\u90fd\u53d7\u76ca\u4e8e\u591a\u8def\u590d\u7528\uff0c\u4f46\u6570\u636e\u4f20\u8f93\u9700\u8981\u5229\u7528\u6240\u6709\u7f51\u7edc\u5e26\u5bbd\uff0c\u800c\u8fd9\u662f\u5355\u4e2a\u8fde\u63a5\u6240\u4e0d\u5177\u5907\u7684\u3002\u6839\u636egRPC\u56e2\u961f\u7684\u5efa\u8bae\uff0c\u6211\u4eec\u8f6c\u800c\u4f7f\u7528\u591a\u4e2achannel\u6765\u6700\u5927\u5316\u6211\u4eec\u7684\u6570\u636e\u4f20\u8f93\u541e\u5410\u91cf\u3002</li> <li>\u4f7f\u7528\u66f4\u5927\u7684\u5757\u5927\u5c0f\uff1a\u53d1\u9001\u6bcf\u6761\u6d88\u606f\u90fd\u4f1a\u4ea7\u751f\u4e00\u4e9b\u5f00\u9500\uff0c\u4f8b\u5982\u6d88\u606f\u5934\u548c\u4e0a\u4e0b\u6587\u5207\u6362\u3002\u5bf9\u4e8e\u76f8\u540c\u6570\u91cf\u7684\u6570\u636e\uff0c\u6bcf\u4e2a\u5757\u8d8a\u5c0f\uff0c\u7ba1\u9053\u5fc5\u987b\u5904\u7406\u7684\u5757\u8d8a\u591a\uff0c\u8fd9\u53cd\u8fc7\u6765\u4f1a\u5f15\u5165\u66f4\u591a\u7684\u5f00\u9500\u3002\u6211\u4eec\u6700\u7ec8\u4f7f\u7528\u76f8\u5bf9\u8f83\u5927\u7684\u5757\u5927\u5c0f\u6765\u6700\u5c0f\u5316\u8fd9\u79cd\u5f71\u54cd\u3002</li> <li>\u4e0d\u8981\u4e22\u5f03Netty\uff1a\u5373\u4f7f\u6240\u6709\u6570\u636e\u90fd\u662f\u901a\u8fc7gRPC\u53d1\u9001\u7684\u3002\u9274\u4e8egRPC\u6ca1\u6709\u516c\u5f00\u80fd\u591f\u5904\u7406Netty ByteBuf\u7684\u516c\u5171\u63a5\u53e3\uff0c\u6211\u4eec\u5728gRPC\u670d\u52a1\u7aef\u70b9\u7684\u65e9\u671f\u5b9e\u73b0\u4e2d\u5207\u6362\u5230\u4f7f\u7528Java NIO ByteBuffer\u3002\u5373\u4f7f\u6211\u4eec\u4f7f\u7528\u4e86\u5806\u5916\u7f13\u51b2\u533a\uff0c\u4e5f\u8fd8\u662f\u5f15\u5165\u4e86\u4e00\u4e9b\u663e\u8457\u74f6\u9888\u3002\u8fd9\u91cc\u5b66\u5230\u7684\u6559\u8bad\u662f\u4e0d\u8981\u56e0\u4e3agRPC\u6ca1\u6709\u516c\u5f00Netty\u7f13\u51b2\u533a\u7684\u63a5\u53e3\u800c\u6446\u8131Netty\u3002Netty\u63d0\u4f9b\u4e86\u4e00\u4e9b\u975e\u5e38\u6709\u6548\u7684API\u6765\u7ba1\u7406\u7f13\u51b2\u533a\uff0c\u8fd9\u5c06\u4f7fgRPC\u7ba1\u9053\u4e4b\u5916\u7684\u4e1c\u897f\u4f9d\u7136\u4fdd\u6301\u8fc5\u901f\u3002</li> <li>\u5b9e\u73b0\u96f6\u590d\u5236\uff1a\u6211\u4eec\u89c2\u5bdf\u5230\u5207\u6362\u5230gRPC\u7684\u53e6\u4e00\u4e2a\u5f00\u9500\u662f\u8fc7\u591a\u7684\u7f13\u51b2\u533a\u590d\u5236\u3002\u8fd9\u662f\u56e0\u4e3a\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cgRPC\u4f7f\u7528protobuf\u8fdb\u884c\u6d88\u606f\u5e8f\u5217\u5316\uff0c\u8fd9\u4f1a\u5f15\u5165\u989d\u5916\u7684\u590d\u5236\u64cd\u4f5c\u3002\u76ee\u524d\u8fd8\u6ca1\u6709\u80fd\u5728\u65e0\u9700\u7ecf\u8fc7protobuf\u5e8f\u5217\u5316\u6216\u629b\u5f03\u751f\u6210\u597d\u7684RPC\u7ed1\u5b9a\u7684\u60c5\u51b5\u4e0b\u5b58\u53d6gRPC\u539f\u59cb\u7f13\u51b2\u533a\u7684\u5b98\u65b9\u7248\u7684API\u3002\u6211\u4eec\u6700\u7ec8\u4f7f\u7528\u4e86gRPC\u7528\u6237\u7ec4\u7684\u4e00\u4e9b\u60f3\u6cd5\uff0c\u5b9e\u73b0\u4e86\u4e00\u79cd\u96f6\u590d\u5236\u7684\u66ff\u4ee3\u65b9\u6848\u3002</li> <li>1.39.0+\uff1aapi, core: support zero copy into protobuf by voidzcy \u00b7 Pull Request #8102 \u00b7 grpc/grpc-java \u00b7 GitHub</li> <li>\u4f7f\u7528\u624b\u52a8\u80cc\u538b\u63a7\u5236(back pressure control)\uff1agRPC Java SDK\u4e2d\u7684\u80cc\u538b\u63a7\u5236\u662f\u901a\u8fc7\u6d41\u89c2\u5bdf\u5668(stream observer)\u7684isReady\u6807\u5fd7\u548conReady\u4e8b\u4ef6\u63d0\u4f9b\u7684\u3002\u4e00\u65e6\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u5c0f\u4e8e32KB\uff0c\u5c31\u4f1a\u89e6\u53d1onReady\u4e8b\u4ef6\u3002\u8fd9\u662f\u4e00\u4e2a\u76f8\u5bf9\u8f83\u5c0f\u7684\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u5e76\u4e14\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u4e89\u7528\uff0c\u56e0\u4e3a\u53d1\u9001\u65b9\u4e00\u76f4\u5728\u7b49\u5f85\u4ece\u7f13\u51b2\u533a\u4e2d\u5220\u9664\u6570\u636e\uff0c\u7279\u522b\u662f\u5f53\u6211\u4eec\u589e\u52a0\u4e86\u5757\u5927\u5c0f\u540e\uff0c\u8fd9\u79cd\u4e89\u7528\u66f4\u52a0\u660e\u663e\u3002\u4e0d\u5e78\u7684\u662f\uff0c\u622a\u81f3\u76ee\u524d\uff0c\u6211\u4eec\u65e0\u6cd5\u8c03\u6574\u7f13\u51b2\u533a\u5927\u5c0f\u3002\u6211\u4eec\u6700\u7ec8\u5b9e\u73b0\u4e86\u624b\u52a8\u80cc\u538b\u63a7\u5236\uff0c\u3002</li> <li></li> </ul> <p>Alluxio\u7684Grpc\u4f20\u8f93\u6587\u4ef6\u6bd4\u81ea\u5b9e\u73b0\u7684Grpc\u6027\u80fd\u8981\u597d\uff0c\u670d\u52a1\u7aef\u53d1\u9001\u5b8c\u6570\u636e\u540e\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u4e00\u5b9a\u65f6\u95f4\u8fdb\u884c\u8bfb\u53d6\uff0c\u76ee\u524d\u4e0d\u6e05\u695a\u8fd9\u90e8\u5206\u6027\u80fd\u6d88\u8017\u70b9\uff01</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/java.html","title":"Java ProtoBuf / GRPC","text":""},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/java.html#maven","title":"maven\u914d\u7f6e","text":"<p>\u53ef\u4ee5\u53c2\u8003github\u4e0a<code>grpc-java</code>\u9879\u76ee\u4e2dexample\u4e2d\u7684\u793a\u4f8bpom.xml</p> <p>https://github.com/grpc/grpc-java/blob/master/README.md</p> <pre><code> &lt;properties&gt;\n    &lt;grpc.version&gt;1.17.1&lt;/grpc.version&gt;\n    &lt;protobuf.version&gt;3.5.1&lt;/protobuf.version&gt;\n    &lt;protoc.version&gt;3.5.1&lt;/protoc.version&gt;\n  &lt;/properties&gt;\n\n  &lt;dependencies&gt;\n&lt;!--             &lt;dependency&gt;--&gt;\n&lt;!--            &lt;groupId&gt;io.grpc&lt;/groupId&gt;--&gt;\n&lt;!--            &lt;artifactId&gt;grpc-netty-shaded&lt;/artifactId&gt;--&gt;\n&lt;!--            &lt;scope&gt;runtime&lt;/scope&gt;--&gt;\n&lt;!--            &lt;version&gt;${grpc.version}&lt;/version&gt;--&gt;\n&lt;!--        &lt;/dependency&gt;--&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;io.grpc&lt;/groupId&gt;\n      &lt;artifactId&gt;grpc-protobuf&lt;/artifactId&gt;\n      &lt;version&gt;${grpc.version}&lt;/version&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;io.grpc&lt;/groupId&gt;\n      &lt;artifactId&gt;grpc-stub&lt;/artifactId&gt;\n      &lt;version&gt;${grpc.version}&lt;/version&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n      &lt;groupId&gt;com.google.protobuf&lt;/groupId&gt;\n      &lt;artifactId&gt;protobuf-java&lt;/artifactId&gt;\n      &lt;version&gt;${protobuf.version}&lt;/version&gt;\n    &lt;/dependency&gt;\n\n  &lt;/dependencies&gt;\n\n\n  &lt;build&gt;\n     &lt;!-- \u5fc5\u4e0d\u53ef\u5c11\uff0c\u7528\u4e8e\u53d1\u73b0os\u76f8\u5173\u7684\u914d\u7f6e --&gt;\n    &lt;extensions&gt;\n      &lt;extension&gt;\n        &lt;groupId&gt;kr.motd.maven&lt;/groupId&gt;\n        &lt;artifactId&gt;os-maven-plugin&lt;/artifactId&gt;\n        &lt;version&gt;1.6.2&lt;/version&gt;\n      &lt;/extension&gt;\n    &lt;/extensions&gt;\n    &lt;plugins&gt;\n      &lt;plugin&gt;\n        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n        &lt;version&gt;3.2&lt;/version&gt;\n        &lt;configuration&gt;\n          &lt;source&gt;1.8&lt;/source&gt;\n          &lt;target&gt;1.8&lt;/target&gt;\n          &lt;encoding&gt;UTF-8&lt;/encoding&gt;\n          &lt;maxmem&gt;1024m&lt;/maxmem&gt;\n          &lt;compilerArgs&gt;\n            &lt;arg&gt;-Xlint:none&lt;/arg&gt;\n          &lt;/compilerArgs&gt;\n        &lt;/configuration&gt;\n      &lt;/plugin&gt;\n      &lt;plugin&gt;\n        &lt;!--  refer to https://www.xolstice.org/protobuf-maven-plugin/ --&gt;\n        &lt;groupId&gt;org.xolstice.maven.plugins&lt;/groupId&gt;\n        &lt;artifactId&gt;protobuf-maven-plugin&lt;/artifactId&gt;\n        &lt;version&gt;0.6.1&lt;/version&gt;\n        &lt;configuration&gt;\n          &lt;!--\u9ed8\u8ba4\u503c--&gt;\n          &lt;protoSourceRoot&gt;${project.basedir}/src/main/proto&lt;/protoSourceRoot&gt;\n          &lt;outputDirectory&gt;${project.build.sourceDirectory}&lt;/outputDirectory&gt;\n          &lt;!--\u8bbe\u7f6e\u662f\u5426\u5728\u751f\u6210java\u6587\u4ef6\u4e4b\u524d\u6e05\u7a7aoutputDirectory\u7684\u6587\u4ef6\uff0c\u9ed8\u8ba4\u503c\u4e3atrue\uff0c\u8bbe\u7f6e\u4e3afalse\u65f6\u4e5f\u4f1a\u8986\u76d6\u540c\u540d\u6587\u4ef6--&gt;\n          &lt;clearOutputDirectory&gt;false&lt;/clearOutputDirectory&gt;\n          &lt;!--\u9ed8\u8ba4\u503c--&gt;\n          &lt;temporaryProtoFileDirectory&gt;${project.build.directory}/generated-sources/protobuf/java\n          &lt;/temporaryProtoFileDirectory&gt;\n          &lt;!--\u66f4\u591a\u914d\u7f6e\u4fe1\u606f\u53ef\u4ee5\u67e5\u770bhttps://www.xolstice.org/protobuf-maven-plugin/compile-mojo.html--&gt;\n          &lt;protocArtifact&gt;com.google.protobuf:protoc:${protoc.version}:exe:${os.detected.classifier}\n          &lt;/protocArtifact&gt;\n          &lt;pluginArtifact&gt;io.grpc:protoc-gen-grpc-java:${grpc.version}:exe:${os.detected.classifier}\n          &lt;/pluginArtifact&gt;\n          &lt;pluginId&gt;grpc-java&lt;/pluginId&gt;\n        &lt;/configuration&gt;\n        &lt;executions&gt;\n          &lt;execution&gt;\n            &lt;goals&gt;\n              &lt;goal&gt;compile&lt;/goal&gt;\n              &lt;goal&gt;compile-custom&lt;/goal&gt;\n            &lt;/goals&gt;\n          &lt;/execution&gt;\n        &lt;/executions&gt;\n      &lt;/plugin&gt;\n    &lt;/plugins&gt;\n  &lt;/build&gt;\n</code></pre>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html","title":"Lan guide","text":"<p>[toc]</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html#proto3","title":"\u8bed\u6cd5\u6307\u5f15(proto3)","text":"<p>protobuf \u4e0d\u652f\u6301\u7c7b\u7ee7\u627f\u3002</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html#_1","title":"\u6d88\u606f\u7c7b\u578b\u5b9a\u4e49","text":"<p>\u6d88\u606f\u5b9a\u4e49\u4e2d\u6bcf\u4e2a\u5b57\u6bb5\u90fd\u6709\u552f\u4e00\u7684\u7f16\u53f7\uff0c\u7528\u4e8e\u6807\u8bc6\u6d88\u606f\u4e8c\u8fdb\u5236\u7684\u5b57\u6bb5\uff0c\u5b57\u6bb5\u53f7\u4e0d\u5e94\u66f4\u6539\u3002</p> <ul> <li> <p>\u8303\u56f41-15 \u7f16\u53f7\u9700\u8981\u4e00\u4e2a\u5b57\u8282\u6765\u7f16\u7801\uff0c\u5305\u62ec\u5b57\u6bb5\u7f16\u53f7\u548c\u5b57\u6bb5\u7684\u7c7b\u578b\uff1b</p> </li> <li> <p>16\u52302047\u4e4b\u95f4\u7684\u5b57\u6bb5\u7f16\u53f7\u5360\u7528\u4e24\u4e2a\u5b57\u8282\uff1b</p> </li> <li> <p>\u4e3a\u7ecf\u5e38\u51fa\u73b0\u7684\u6d88\u606f\u5143\u7d20\u4fdd\u7559\u6570\u5b571\u523015\u3002\u5207\u8bb0\u4e3a\u5c06\u6765\u53ef\u80fd\u6dfb\u52a0\u7684\u9891\u7e41\u51fa\u73b0\u7684\u5143\u7d20\u7559\u51fa\u4e00\u4e9b\u7a7a\u95f4\u3002</p> </li> </ul> <pre><code>syntax = \"proto3\";\nmessage xxx {\n  // \u5b57\u6bb5\u89c4\u5219\uff1a\u9ed8\u8ba4\u65e0\u4fee\u9970\u7b26 -&gt; \u5b57\u6bb5\u53ef\u51fa\u73b0 0 \u6b21\u62161\u6b21\n  // \u5b57\u6bb5\u89c4\u5219\uff1arepeated -&gt; \u5b57\u6bb5\u53ef\u51fa\u73b0\u4efb\u610f\u591a\u6b21\uff08\u5305\u62ec 0\uff09\n  // \u7c7b\u578b\uff1aint32\u3001int64\u3001sint32\u3001sint64\u3001string\u3001bytes ....\n  // \u5b57\u6bb5\u7f16\u53f7\uff1a1 ~ 536870911\uff082^29 - 1, \u9664\u53bb 19000 \u5230 19999 \u4e4b\u95f4\u7684\u6570\u5b57\uff09\n  \u5b57\u6bb5\u89c4\u5219 \u7c7b\u578b \u540d\u79f0 = \u5b57\u6bb5\u7f16\u53f7;\n}\n</code></pre> <p>\u5728proto3\u4e2d\uff0c<code>repeated</code>\u4fee\u9970\u7684\u6570\u503c\u53d8\u91cf\u9ed8\u8ba4\u91c7\u7528<code>packed</code>\u7f16\u7801\u3002</p> <p>\u5355\u4e2a<code>.proto</code>\u6587\u4ef6\u4e2d\uff0c\u53ef\u4ee5\u5b9a\u4e49\u591a\u4e2amessage\uff0cmessage\u4e2d\u4e5f\u53ef\u4ee5\u5d4c\u5957\u5b9a\u4e49message\uff0c\u5d4c\u5957\u7c7b\u578b\u5728\u5176\u5b83message\u4e2d\u4f7f\u7528\u4e3a <code>Parent.Type</code>\u3002</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html#_2","title":"\u5b57\u6bb5\u4fee\u9970","text":"<ul> <li><code>singular</code>\uff1a\u9ed8\u8ba4\u4fee\u9970\uff0c0\u6216\u80051\u4e2a\uff1b</li> <li><code>repeated</code>\uff1a\u4efb\u610f\u591a\u4e2a\uff08\u5305\u542b0\uff09\uff1b</li> </ul> <p>\u4fdd\u7559\u5b57\u6bb5</p> <p>\u5982\u679c\u901a\u8fc7\u5220\u9664/\u6ce8\u91ca\u5b57\u6bb5\u6765\u66f4\u65b0\u6d88\u606f\uff0c\u5219\u5c06\u6765\u7528\u6237\u53ef\u80fd\u4f1a\u91cd\u7528\u8fd9\u4e9b\u8be5\u5b57\u6bb5\u7f16\u53f7\u3002\u82e5\u4ee5\u540e\u4ed6\u4eec\u52a0\u8f7d\u4e86\u65e7\u7248\u672c<code>.proto</code>\u6587\u4ef6\uff0c\u5219\u4f1a\u51fa\u73b0\u6570\u636e\u635f\u574f\u3001\u9690\u79c1\u9519\u8bef\u7b49\u4e25\u91cd\u95ee\u9898\u3002 \u89e3\u51b3\u65b9\u6cd5\u662f\uff0c\u5c06\u5df2\u5220\u9664\u5b57\u6bb5\u7684\u5b57\u6bb5\u7f16\u53f7\uff08\u548c/\u6216\u540d\u79f0\uff0c\u4e5f\u53ef\u80fd\u5bfc\u81f4JSON\u5e8f\u5217\u5316\u7684\u95ee\u9898\uff09\u6307\u5b9a\u4e3a<code>reserved</code> \uff0c\u5982\u679c\u540e\u7eed\u91cd\u65b0\u4f7f\u7528\u8be5\u5b57\u6bb5\uff0c\u5219\u7f16\u8bd1\u5668\u4f1a\u8b66\u544a\u3002</p> <pre><code>message Foo {\n  reserved 2, 15, 9 to 11;\n  reserved \"foo\", \"bar\";   // \u7f16\u53f7\u548c\u540d\u5b57\u8981\u5206\u5f00\u5199\n}\n</code></pre>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html#_3","title":"\u679a\u4e3e","text":"<p>\u679a\u4e3e\u503c\u4f7f\u7528variant encoding\u3002</p> <pre><code>message SearchRequest {\n  string query = 1;\n  int32 page_number = 2;\n  int32 result_per_page = 3;\n  enum Corpus { \n    option allow_alias = true; // \u5b9a\u4e49alias\uff0c\u679a\u4e3e\u503c\u53ef\u4ee5\u76f8\u540c\n    UNIVERSAL = 0;   // \u679a\u4e3e\u503c\u5fc5\u987b\u4ece0\u5f00\u59cb\n    WEB = 1;\n    IMAGES = 2;\n    LOCAL = 2;       // alias\uff0c\u522b\u540d\n  }\n  Corpus corpus = 4;\n}\n</code></pre>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html#_4","title":"\u4f7f\u7528\u5176\u5b83\u7684\u6d88\u606f\u7c7b\u578b","text":"<p>\u5982\u679c\u4f7f\u7528\u5230\u5176\u5b83.proto\u4e2d\u5b9a\u4e49\u7684message\u7c7b\u578b\uff0c\u4f7f\u7528 import \u8bed\u53e5\uff1a</p> <pre><code>import \"myproject/other_protos.proto\";\n</code></pre> <p>protocol\u7f16\u8bd1\u5668\u4f7f\u7528 <code>-I</code>/<code>--proto_path</code> \u641c\u7d22<code>.proto</code>\u6587\u4ef6\u8def\u5f84\u3002</p> <p>\u5982\u679c<code>.proto</code>\u9700\u8981\u88ab\u79fb\u52a8\u5230\u5176\u5b83\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u901a\u8fc7<code>import public</code>\uff0c\u800c\u4e0d\u9700\u8981\u5728\u6240\u6709\u4f7f\u7528\u5b83\u7684<code>.proto</code>\u6587\u4ef6\u4e2d\uff0c\u4fee\u6539<code>import</code>\u7684\u8def\u5f84\u3002</p> <pre><code>// new.proto\n// All definitions are moved here\n</code></pre> <pre><code>// old.proto\n// This is the proto that all clients are importing.\nimport public \"new.proto\";\nimport \"other.proto\";\n</code></pre> <pre><code>// client.proto\nimport \"old.proto\";\n// You use definitions from old.proto and new.proto, but not other.proto\n</code></pre>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html#_5","title":"\u66f4\u65b0\u6d88\u606f\u7c7b\u578b","text":"<p>\u66f4\u65b0\u7684\u89c4\u5219\uff1a</p> <ul> <li>\u4e0d\u8981\u66f4\u6539\u73b0\u6709\u5b57\u6bb5\u7684\u7f16\u53f7\uff1b</li> <li>\u6dfb\u52a0\u65b0\u5b57\u6bb5\u65f6\uff0c\u8bb0\u4f4f\u9ed8\u8ba4\u503c\uff0c\u4ee5\u4fbf\u65b0\u4ee3\u7801\u548c\u65e7\u4ee3\u7801\u751f\u6210\u7684\u7c7b\u578b\u53ef\u4ee5\u4ea4\u4e92\uff0c\u800c\u65e7\u4ee3\u7801\u4f1a\u5ffd\u7565\u65b0\u7684\u7c7b\u578b\uff1b</li> <li>\u786e\u5b9a\u7f16\u53f7\u4e0d\u518d\u4f7f\u7528\u7684\u7c7b\u578b\u53ef\u4ee5\u5220\u9664\uff0c\u6216\u8005\u4f7f\u7528<code>OBSOLETE_</code>\u4fee\u9970\uff0c\u6216\u8005\u4f7f\u7528<code>reserverd</code>\u3002</li> </ul>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html#anydevelopment","title":"Any\u7c7b\u578b(development)","text":"<p>\u8868\u793a\u4efb\u610f\u7c7b\u578b\uff0c\u4f7f\u7528bytes\u5b58\u50a8\uff0c\u5e76\u4e14\u6709URL\u4f5c\u4e3a\u5168\u5c40\u552f\u4e00\u6807\u8bc6\u3002\u7b49\u4ef7\u4e8eproto2\u4e2d\u7684extensions\u3002</p> <pre><code>import \"google/protobuf/any.proto\";\n\nmessage ErrorStatus {\n  string message = 1;\n  repeated google.protobuf.Any details = 2;\n}\n</code></pre> <p>Currently the runtime libraries for working with Any types are under development(2019/11/1). </p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html#oneof","title":"Oneof","text":"<p>\u7c7b\u4f3c\u4e8eC\u4e2dunion\u7c7b\u578b\u3002oneof \u91cc\u9762\u4e0d\u80fd\u4f7f\u7528<code>repeated</code>\u5b57\u6bb5\u3002</p> <pre><code>message SampleMessage {  \n    oneof test_oneof {\n        string name = 4;\n        SubMessage sub_message = 9;\n    }\n}\n</code></pre> <p>TODO\uff1a\u6839\u636e\u5b9e\u9645\u4f7f\u7528\uff0c\u5206\u6790\u517c\u5bb9\u6027\u95ee\u9898</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html#map","title":"Map","text":"<p>key_type\u7c7b\u578b\u662f\u6574\u578b\u6216string\u7c7b\u578b\uff08\u6d6e\u70b9\u6570\u3001bytes\u3001enum\u4e0d\u884c\uff09\uff0cvalue_type\u53ef\u4ee5\u662f\u9664map\u7684\u4efb\u610f\u7c7b\u578b\u3002</p> <pre><code>map&lt;key_type, value_type&gt; map_field = N;\n</code></pre> <ul> <li> <p>Map\u7684\u5b57\u6bb5\u4e0d\u80fd\u4e3a<code>repeated</code>\uff1b</p> </li> <li> <p>Map\u7684\u904d\u5386\u662f\u65e0\u5e8f\u7684\uff1b</p> </li> </ul>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html#package","title":"Package","text":"<pre><code>package foo.bar;\nmessage Open { ... }\n</code></pre> <pre><code>message Foo {\n  ...\n  foo.bar.Open open = 1;\n  ...\n}\n</code></pre>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html#defining-services","title":"Defining Services","text":"<p>\u5982\u679c\u4f60\u5728 .proto \u6587\u4ef6\u4e2d\u5b9a\u4e49 RPC \u670d\u52a1\uff0c\u4f60\u5e94\u8be5\u4f7f\u7528\u9a7c\u5cf0\u547d\u540d\u6cd5\uff08\u9996\u5b57\u6bcd\u5927\u5199\uff09\u547d\u540d RPC \u670d\u52a1\u4ee5\u53ca\u5176\u4e2d\u7684 RPC \u65b9\u6cd5\uff1a </p> <pre><code>service SearchService {\n  rpc Search (SearchRequest) returns (SearchResponse);\n}\n</code></pre> <p>\u914d\u5408grpc\u6216\u8005\u7b2c\u4e09\u65b9\u5b9e\u73b0\u3002</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html#options","title":"Options","text":"<ul> <li> <p><code>java_package</code>  (file option) \uff1a\u751f\u6210\u7684java\u7c7b\u7684\u5305\u540d\uff1b</p> </li> <li> <p><code>java_multiple_files</code> </p> </li> <li><code>java_outer_classname</code> </li> <li><code>optimize_for</code> </li> <li><code>cc_enable_arenas</code> </li> <li><code>objc_class_prefix</code> </li> <li><code>deprecated</code> </li> </ul> <p>\u81ea\u5b9a\u4e49option</p> <p>\u4f7f\u7528proto2\u7684extensions\u3002</p>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html#_6","title":"\u751f\u6210\u8bed\u8a00\u7684\u7c7b\u6587\u4ef6","text":"<p>\u4f7f\u7528protoc\u547d\u4ee4</p> <pre><code>protoc --proto_path=IMPORT_PATH --java_out=DST_DIR path/to/file.proto\n</code></pre>"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html#json-mappings","title":"JSON Mappings","text":"proto3 JSON JSON example Notes message object <code>{\"fooBar\": v,\"g\": null,\u2026}</code> Generates JSON objects. Message field names are mapped to lowerCamelCase and become JSON object keys. If the <code>json_name</code> field option is specified, the specified value will be used as the key instead. Parsers accept both the lowerCamelCase name (or the one specified by the <code>json_name</code> option) and the original proto field name. <code>null</code> is an accepted value for all field types and treated as the default value of the corresponding field type. enum string <code>\"FOO_BAR\"</code> The name of the enum value as specified in proto is used. Parsers accept both enum names and integer values. map object <code>{\"k\": v, \u2026}</code> All keys are converted to strings. repeated V array <code>[v, \u2026]</code> <code>null</code> is accepted as the empty list []. bool true, false <code>true, false</code> string string <code>\"Hello World!\"</code> bytes base64 string <code>\"YWJjMTIzIT8kKiYoKSctPUB+\"</code> JSON value will be the data encoded as a string using standard base64 encoding with paddings. Either standard or URL-safe base64 encoding with/without paddings are accepted. int32, fixed32, uint32 number <code>1, -10, 0</code> JSON value will be a decimal number. Either numbers or strings are accepted. int64, fixed64, uint64 string <code>\"1\", \"-10\"</code> JSON value will be a decimal string. Either numbers or strings are accepted. float, double number <code>1.1, -10.0, 0, \"NaN\", \"Infinity\"</code> JSON value will be a number or one of the special string values \"NaN\", \"Infinity\", and \"-Infinity\". Either numbers or strings are accepted. Exponent notation is also accepted. Any <code>object</code> <code>{\"@type\": \"url\", \"f\": v, \u2026 }</code> If the Any contains a value that has a special JSON mapping, it will be converted as follows: <code>{\"@type\": xxx, \"value\": yyy}</code>. Otherwise, the value will be converted into a JSON object, and the <code>\"@type\"</code> field will be inserted to indicate the actual data type. Timestamp string <code>\"1972-01-01T10:00:20.021Z\"</code> Uses RFC 3339, where generated output will always be Z-normalized and uses 0, 3, 6 or 9 fractional digits. Offsets other than \"Z\" are also accepted. Duration string <code>\"1.000340012s\", \"1s\"</code> Generated output always contains 0, 3, 6, or 9 fractional digits, depending on required precision, followed by the suffix \"s\". Accepted are any fractional digits (also none) as long as they fit into nano-seconds precision and the suffix \"s\" is required. Struct <code>object</code> <code>{ \u2026 }</code> Any JSON object. See <code>struct.proto</code>. Wrapper types various types <code>2, \"2\", \"foo\", true, \"true\", null, 0, \u2026</code> Wrappers use the same representation in JSON as the wrapped primitive type, except that <code>null</code> is allowed and preserved during data conversion and transfer. FieldMask string <code>\"f.fooBar,h\"</code> See <code>field_mask.proto</code>. ListValue array <code>[foo, bar, \u2026]</code> Value value Any JSON value NullValue null JSON null Empty object {} An empty JSON object"},{"location":"data_system/1_data_organize/data_ser_deser/protobuf/lan_guide.html#_7","title":"\u6807\u91cf\u7c7b\u578b\u6620\u5c04\u5230\u8bed\u8a00\u7c7b\u578b","text":"<p>\u4e0b\u9762\u53ea\u5217\u51fa\uff0c\u5e38\u7528\u7684\u8bed\u8a00\u7684\u5bf9\u5e94\u7c7b\u578b\uff0c\u66f4\u591a\u7c7b\u578b\u8bf7\u8bbf\u95ee\u5b98\u7f51</p> .proto Type Notes C++ Type Java Type Python Type Go Type double double double float float64 float float float float float32 int32 \u53d8\u957f\u7f16\u7801\uff0c\u7f16\u7801\u8d1f\u6570\u6548\u7387\u4e0d\u9ad8\u3002\u8d1f\u6570\u60c5\u51b5\u4f7f\u7528sint32\u3002 int32 int int int32 int64 \u53d8\u957f\u7f16\u7801\uff0c\u7f16\u7801\u8d1f\u6570\u6548\u7387\u4e0d\u9ad8\u3002\u8d1f\u6570\u60c5\u51b5\u4f7f\u7528sint32\u3002 int64 long int/long int64 uint32 \u53d8\u957f\u7f16\u7801 uint32 int int/long uint32 uint64 \u53d8\u957f\u7f16\u7801 uint64 long int/long uint64 sint32 \u53d8\u957f\u7f16\u7801\uff0c\u6709\u7b26\u53f7Int\u3002\u7f16\u7801\u8d1f\u6570\u6bd4int32\u6548\u7387\u9ad8\u3002 int32 int int int32 sint64 \u53d8\u957f\u7f16\u7801\uff0c\u6709\u7b26\u53f7Int\u3002\u7f16\u7801\u8d1f\u6570\u6bd4int64\u6548\u7387\u9ad8\u3002 int64 long int/long int64 fixed32 \u56fa\u5b9a\u56db\u5b57\u8282\u3002\u503c\u5927\u4e8e2<sup>28</sup>\uff0c\u6bd4unit32\u6548\u7387\u9ad8\u3002 uint32 int int/long uint32 fixed64 \u56fa\u5b9a\u516b\u5b57\u8282\u3002\u503c\u5927\u4e8e2<sup>56</sup>\uff0c\u6bd4unit64\u6548\u7387\u9ad8\u3002 uint64 long int/long uint64 sfixed32 \u56fa\u5b9a\u56db\u5b57\u8282 int32 int int int32 sfixed64 \u56fa\u5b9a\u516b\u5b57\u8282 int64 long int/long int64 bool bool boolean bool bool string UTF-8\u7f16\u7801\u62167-bit ASCII\u7684\u6587\u672c\u3002\u4e0d\u80fd\u5927\u4e8e2<sup>32</sup>\u3002 string String str/unicode string bytes \u4efb\u610f\u5b57\u8282\u7684byte\uff0c\u957f\u5ea6\u5c0f\u4e8e2<sup>32</sup>. string ByteString str []byte"},{"location":"data_system/block_system/Longhorn.html","title":"\u5206\u5e03\u5f0f\u5757\u5b58\u50a8\u65b9\u6848-Longhorn","text":"<p>CNCF Incubating Project\uff1aCloud native distributed block storage for Kubernetes. </p> <p>\u8f7b\u91cf\u7ea7\u4e91\u539f\u751f\u5d29\u6e83\u4e00\u81f4(<code>crash-consistent</code>)\u7684\u5206\u5e03\u5f0f\u5757\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li>\u652f\u6301PV\u3001PVC\uff0c\u652f\u6301PV\u4e0ePVC\u52a8\u6001\u7ed1\u5b9a\uff0c\u652f\u6301\u5757\u8bbe\u5907\u548c\u6587\u4ef6\u7cfb\u7edf\u4e24\u79cd\u7c7b\u578b\uff1b</li> <li>\u5c06\u5757\u5b58\u50a8\u5212\u5206\u4e3aLonghorn\u5377\uff0c\u4ee5\u4fbf\u5728\u6709\u6216\u6ca1\u6709\u4e91\u63d0\u4f9b\u5546\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528Kubernetes\u5377\uff1b</li> <li>\u652f\u6301\u4e0d\u4e2d\u65ad\u5377\u670d\u52a1\u7684\u60c5\u51b5\u4e0b\u8fdb\u884c\u5347\u7ea7\uff1b</li> <li>\u652f\u6301\u5907\u4efd\u3001\u5feb\u7167\u548c\u6062\u590d\uff1b</li> </ul>"},{"location":"data_system/block_system/Longhorn.html#_1","title":"\u67b6\u6784","text":"<p>Longhorn \u4e3a\u6bcf\u4e2avolume\u521b\u5efa\u4e00\u4e2a\u4e13\u7528\u7684\u5b58\u50a8\u63a7\u5236\u5668\uff08Longhorn Engine\uff09\uff0c\u5e76\u5c06volume\u7684\u6570\u636e\u590d\u5236\u5230\u591a\u4e2a\u526f\u672c\u4e0a</p> <ul> <li>Longhorn Manager\uff1a\u4ee5DaemonSet\u7684\u65b9\u5f0f\u5728Longhorn\u96c6\u7fa4\u7684\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fd0\u884c\uff0c\u8d1f\u8d23\u5728k8s\u4e2d\u521b\u5efa\u548c\u7ba1\u7406\u5377</li> <li>Longhorn Engine\uff1a Longhorn Manager\u521b\u5efavolume\u65f6\uff0c\u4f1a\u5728volume\u6240\u5728\u7684\u8282\u70b9\u521b\u5efaengine\uff0cengine\u8d1f\u8d23\u6570\u636e\u8bfb\u5199\u3001\u590d\u5236\u7b49\u64cd\u4f5c</li> </ul> <p></p>"},{"location":"data_system/block_system/Longhorn.html#_2","title":"\u539f\u7406","text":"<p><code>Longhorn CSI driver</code> \u83b7\u53d6\u5757\u8bbe\u5907(<code>block device</code>)\uff0c\u5bf9\u5176\u8fdb\u884c\u683c\u5f0f\u5316\uff0c\u7136\u540e\u5c06\u5176\u6302\u8f7d\u5230\u8282\u70b9\u4e0a\u3002\u7136\u540e kubelet \u5c06\u8bbe\u5907\u7ed1\u5b9a\u6302\u8f7d\u5230 <code>Kubernetes Pod</code> \u4e2d\u3002\u8fd9\u5141\u8bb8 <code>Pod</code> \u8bbf\u95ee <code>Longhorn volume</code>\u3002</p>"},{"location":"data_system/block_system/Longhorn.html#_3","title":"\u4f7f\u7528","text":""},{"location":"data_system/block_system/Longhorn.html#iscsid","title":"\u4f9d\u8d56iscsid","text":"<p>iSCSI\u662f\u4e00\u79cd\u5b58\u50a8\u8bbe\u5907\u8fdc\u7a0b\u6620\u5c04\u6280\u672f\uff0c\u5b83\u53ef\u4ee5\u5c06\u4e00\u4e2a\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u7684\u5b58\u50a8\u8bbe\u5907\u6620\u5c04\u5230\u672c\u5730\uff0c\u5e76\u5448\u73b0\u4e3a\u4e00\u4e2a\u5757\u8bbe\u5907\uff08\u5927\u767d\u8bdd\u5c31\u662f\u78c1\u76d8\uff09\u3002</p> <ul> <li>SCSI\u534f\u8bae\u662f\u8ba1\u7b97\u673a\u4e0e\u5916\u56f4\u8bbe\u5907\uff08\u4f8b\u5982\u786c\u76d8\u3001\u5149\u76d8\u7b49\uff09\u901a\u4fe1\u7684\u534f\u8bae\uff0c iSCSI \u662f\u901a\u8fc7\u4ee5\u592a\u7f51\uff08TCP\uff09\u4f20\u8f93SCSI\u534f\u8bae</li> </ul> <ul> <li>\u96c6\u7fa4\u6bcf\u4e2a\u8282\u70b9\u5df2\u7ecf\u5b89\u88c5\u4e0b\u5217\u8f6f\u4ef6\u5305\uff0c\u5e76\u6b63\u5e38\u542f\u52a8\uff1aopen-iscsi\uff08iscsid\u670d\u52a1\uff09</li> <li>\u5b89\u88c5\uff1a <code>yum install iscsi-initiator-utils</code></li> </ul>"},{"location":"data_system/block_system/Longhorn.html#helm","title":"Helm \u5b89\u88c5","text":"<pre><code>$ helm repo add longhorn https://charts.longhorn.io\n\n$ helm repo update\n\n# \u4e0b\u8f7d\u5305\n$ helm fetch longhorn/longhorn\n\n# \u89e3\u538b\u5305\n$ tar xf longhorn-*.tgz\n</code></pre> <p>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 <code>values.yaml</code></p> <pre><code># \u770b\u9700\u6c42\u8bbe\u7f6e\u662f\u5426\u4e3a\u9ed8\u8ba4 storageclass\uff08defaultClass\uff09\uff0c\u4fee\u6539pvc\u7b56\u7565\u4e3a Retain\npersistence:\n  defaultClass: false\n  defaultFsType: ext4           # \u9ed8\u8ba4\u7684\u6587\u4ef6\u7cfb\u7edf\u7c7b\u578b\n  defaultMkfsParams: \"\"\n  defaultClassReplicaCount: 3\n  defaultDataLocality: disabled # best-effort otherwise\n  reclaimPolicy: Retain\n  migratable: false\n  recurringJobSelector:\n    enable: false\n    jobList: []\n  backingImage:\n    enable: false\n    name: ~\n    dataSourceType: ~\n    dataSourceParameters: ~\n    expectedChecksum: ~\n  defaultNodeSelector:\n    enable: false # disable by default\n    selector: \"\"\n  removeSnapshotsDuringFilesystemTrim: ignored # \"enabled\" or \"disabled\" otherwise\n\n# \u8bbe\u7f6elonghorn\u6302\u8f7d\u7684\u672c\u5730\u5b58\u50a8\u8def\u5f84\uff0c/data/longhorn\ndefaultSettings:\n  backupTarget: ~\n  backupTargetCredentialSecret: ~\n  allowRecurringJobWhileVolumeDetached: ~\n  createDefaultDiskLabeledNodes: ~\n  defaultDataPath: /data/longhorn\n\n# \u4fee\u6539ui\u754c\u9762\u7684service\u7c7b\u578b\u4e3aNodePort\nservice:\n  ui:\n    type: NodePort\n    nodePort: null\n  manager:\n    type: ClusterIP\n    nodePort: \"\"\n    loadBalancerIP: \"\"\n    loadBalancerSourceRanges: \"\"\n</code></pre> <p>\u90e8\u7f72</p> <pre><code>$ helm install longhorn longhorn/longhorn --namespace longhorn-system --create-namespace -f ./values.yaml\n</code></pre>"},{"location":"data_system/block_system/Longhorn.html#_4","title":"\u6027\u80fd\u6d4b\u8bd5","text":"<p>\u57fa\u4e8e longhorn/kbench: Benchmark your Kubernetes storage. (github.com) \u9879\u76ee\u8fdb\u884c\u6027\u80fd\u6d4b\u8bd5\u3002</p>"},{"location":"data_system/cache_system/redis.html","title":"Redis","text":"<ul> <li>\u652f\u6301\u591a\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u5305\u62ec Json\uff08\u652f\u6301\u7d22\u5f15\uff09\u548cGraph\uff1b</li> </ul>"},{"location":"data_system/cache_system/redis.html#_1","title":"\u529f\u80fd","text":""},{"location":"data_system/cache_system/redis.html#redis-6","title":"\u5ba2\u6237\u7aef\u7f13\u5b58\uff08Redis 6\uff09","text":"<p>\u652f\u6301\u5ba2\u6237\u7aef\uff08APP\u7aef\uff09\u7f13\u5b58\uff0c\u65e0\u9700\u624b\u52a8\u7684Pub/Sub\uff0c\u4fdd\u6301\u5ba2\u6237\u7aef\u548cRedis\u7684\u6570\u636e\u4e00\u81f4\u6027\uff1b - \u9ed8\u8ba4\u6a21\u5f0f\uff1a\u670d\u52a1\u7aef\u4f1a\u8bb0\u5f55\u67d0\u4e2a\u5ba2\u6237\u7aef\u5177\u4f53\u8bbf\u95ee\u8fc7\u54ea\u4e00\u4e9b<code>key</code>\uff0c\u5f53\u8fd9\u4e9b<code>key</code>\u5bf9\u5e94\u7684\u503c\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u4f1a\u53d1\u9001\u5931\u6548\u6d88\u606f\u7ed9\u8fd9\u4e9b\u5ba2\u6237\u7aef\u3002\u670d\u52a1\u7aef\u5185\u5b58\u6d88\u8017\u5927\uff1b - \u5e7f\u64ad\u6a21\u5f0f\uff1a\u5ba2\u6237\u7aef\u9700\u8981\u8ba2\u9605<code>key</code>\u7684\u7279\u5b9a\u524d\u7f00\uff0c\u6bcf\u5f53\u7b26\u5408\u8fd9\u4e2a\u524d\u7f00\u7684<code>key</code>\u5bf9\u5e94\u7684\u503c\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u5ba2\u6237\u7aef\u90fd\u4f1a\u6536\u5230\u901a\u77e5\u6d88\u606f\u3002</p>"},{"location":"data_system/cache_system/redis.html#pubsub","title":"\u53d1\u5e03\u8ba2\u9605\uff08Pub/Sub\uff09","text":""},{"location":"data_system/cache_system/redis.html#_2","title":"\u6301\u4e45\u5316","text":"<ul> <li>RDB\uff1a\u6839\u636e\u6307\u5b9a\u7684\u89c4\u5219\u201c\u5b9a\u65f6\u201d\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5b58\u50a8\u5728\u786c\u76d8\u4e0a\uff0c\u9ed8\u8ba4\uff1b</li> <li>AOF\uff1a\u6bcf\u6b21\u6267\u884c\u547d\u4ee4\u540e\u5c06\u547d\u4ee4\u672c\u8eab\u8bb0\u5f55\u4e0b\u6765\u3002</li> </ul>"},{"location":"data_system/cache_system/redis.html#_3","title":"\u9ad8\u53ef\u7528\u65b9\u6848","text":""},{"location":"data_system/cache_system/redis.html#_4","title":"\u4e3b\u4ece","text":"<p>Redis\u63d0\u4f9b\u4e86\u590d\u5236(replication)\u529f\u80fd\uff0c\u5f53\u4e00\u53f0redis\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u8fd9\u4e2a\u53d8\u5316\u4f1a\u88ab\u81ea\u52a8\u7684\u540c\u6b65\u5230\u5176\u4ed6\u7684redis\u673a\u5668\u3002</p> <ul> <li>\u4e3b\u8282\u70b9\u6302\u6389\u540e\uff0c\u4ece\u8282\u70b9\u9700\u8981\u624b\u52a8\u64cd\u4f5c\u53d8\u6210\u4e3b\u8282\u70b9\uff0c\u540c\u65f6\u5176\u5b83\u4ece\u8282\u70b9\u9700\u8981\u53d8\u66f4\u914d\u7f6e\uff1b</li> </ul> <pre><code># \u4ece\u8282\u70b9\u542f\u52a8\n./redis-server --slaveof 192.168.1.10 6379\n\n# \u5728 ./redis-cli \u4e0a\u6267\u884c\u4e0b\u9762\u547d\u4ee4\uff0c\u53d8\u6210 master\nslaveof no one\n</code></pre>"},{"location":"data_system/cache_system/redis.html#_5","title":"\u54e8\u5175","text":"<p>master\u5b95\u673a\uff0c\u54e8\u5175\u4f1a\u81ea\u52a8\u9009\u4e3emaster\u5e76\u5c06\u5176\u4ed6\u7684slave\u6307\u5411\u65b0\u7684master</p> <ul> <li>\u54e8\u5175\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u8fdb\u7a0b\uff0c\u5947\u6570\u4e2a\u54e8\u5175\u8fdb\u884c\u51b3\u7b56\u9009\u4e3e\uff1b</li> <li>\u901a\u8fc7\u53d1\u9001\u547d\u4ee4\uff0c\u8ba9Redis\u670d\u52a1\u5668\u8fd4\u56de\u76d1\u63a7\u5176\u8fd0\u884c\u72b6\u6001\uff0c\u5305\u62ec\u4e3b\u670d\u52a1\u5668\u548c\u4ece\u670d\u52a1\u5668;</li> <li>\u5f53\u591a\u4e2a\u54e8\u5175\u76d1\u6d4b\u5230master\u5b95\u673a\uff0c\u9009\u4e3e\u67d0\u4e2aslave\u53d8\u6210master\uff0c\u7136\u540e\u901a\u8fc7\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\u901a\u8fc7\u5176\u4ed6\u7684\u4ece\u670d\u52a1\u5668\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u8ba9\u5b83\u4eec\u5207\u6362master;</li> </ul>"},{"location":"data_system/cache_system/redis.html#_6","title":"\u96c6\u7fa4","text":""},{"location":"data_system/cache_system/redis.html#redis_1","title":"Redis\u539f\u751f\u96c6\u7fa4","text":"<p>Redis 3.0\uff1a\u6ca1\u6709\u4f7f\u7528\u4e00\u81f4\u6027Hash\uff0c\u800c\u662f\u4f7f\u7528\u54c8\u5e0c\u69fd\uff08hash slot\uff09</p> <ul> <li>redis\u96c6\u7fa4\u4f7f\u7528gossip\u534f\u8bae\u6765\u5e7f\u64ad\u81ea\u5df1\u7684\u72b6\u6001\u4ee5\u53ca\u63a5\u53d7\u5176\u4ed6\u5b9e\u4f8b\u7684\u4fe1\u606f</li> </ul> <p>\u6bcf\u4e2a\u54c8\u5e0c\u69fd\u90fd\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u7f16\u53f7\uff0c\u8303\u56f4\u4ece0\u523016383\u3002</p> <ul> <li>\u5f53\u4e00\u4e2a\u952e\u503c\u5bf9\u9700\u8981\u5b58\u50a8\u65f6\uff0cRedis\u4f7f\u7528CRC16\u7b97\u6cd5\u8ba1\u7b97\u952e\u7684\u54c8\u5e0c\u503c\uff0c\u5e76\u5c06\u5176\u6620\u5c04\u5230\u4e00\u4e2a\u54c8\u5e0c\u69fd\u4e2d\uff1b</li> <li>Redis \u5c06\u8be5\u952e\u503c\u5bf9\u5b58\u50a8\u5728\u8d1f\u8d23\u8be5\u54c8\u5e0c\u69fd\u7684\u8282\u70b9\u4e0a</li> <li>\u5f53\u4e00\u4e2a\u8282\u70b9\u79bb\u7ebf\u6216\u5931\u8d25\u65f6\uff0c\u5b83\u8d1f\u8d23\u7684\u54c8\u5e0c\u69fd\u4f1a\u88ab\u91cd\u65b0\u5206\u914d\u7ed9\u5176\u4ed6\u8282\u70b9</li> </ul> <p>\u5f53\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a\u547d\u4ee4\u65f6\uff0cRedis\u8282\u70b9\u4f1a\u9996\u5148\u8ba1\u7b97\u8be5\u547d\u4ee4\u6240\u6d89\u53ca\u7684\u952e\u503c\u7684\u54c8\u5e0c\u69fd\uff0c\u5e76\u5c06\u8be5\u547d\u4ee4\u8def\u7531\u5230\u8d1f\u8d23\u8be5\u54c8\u5e0c\u69fd\u7684Redis\u8282\u70b9\u4e0a\u3002</p> <ul> <li>\u5982\u679c\u8be5\u8282\u70b9\u4e0d\u662f\u5ba2\u6237\u7aef\u6240\u8fde\u63a5\u7684\u8282\u70b9\uff0c\u5219Redis\u8282\u70b9\u4f1a\u8fd4\u56de\u4e00\u4e2a<code>MOVED</code>\u9519\u8bef\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u5e94\u8be5\u5c06\u8be5\u547d\u4ee4\u91cd\u5b9a\u5411\u5230\u8d1f\u8d23\u8be5\u54c8\u5e0c\u69fd\u7684\u8282\u70b9\u4e0a\u3002\u5ba2\u6237\u7aef\u4f1a\u6839\u636e<code>MOVED</code>\u9519\u8bef\u4e2d\u8fd4\u56de\u7684\u5730\u5740\u4fe1\u606f\u6765\u91cd\u65b0\u8fde\u63a5\u5230\u6b63\u786e\u7684\u8282\u70b9\uff0c\u5e76\u91cd\u65b0\u53d1\u9001\u8be5\u547d\u4ee4\u3002</li> <li>\u5ba2\u6237\u7aef\u5728\u5ba2\u6237\u7aef\u5728\u6b64\u671f\u95f4\u5411\u79bb\u7ebf\u6216\u6545\u969c\u7684\u8282\u70b9\u53d1\u9001\u547d\u4ee4\u65f6\u5411\u5176\u53d1\u9001\u547d\u4ee4\uff0c\u4f1a\u5bfc\u81f4\u547d\u4ee4\u5931\u8d25\u6216\u8005\u8d85\u65f6\uff0c\u56e0\u6b64\u9700\u8981\u5173\u6ce8\u6545\u969c\u8f6c\u79fb\u548c\u81ea\u52a8\u91cd\u8bd5\uff1b</li> </ul>"},{"location":"data_system/cache_system/redis.html#proxycodis","title":"Proxy\u96c6\u7fa4Codis","text":"<p>\u4e00\u81f4\u6027Hash</p> <p>Proxy\uff1a\u5c06\u5ba2\u6237\u7aef\u8bf7\u6c42\u8def\u7531\u5230\u6b63\u786e\u7684\u540e\u7aefRedis\u5b9e\u4f8b\uff0c\u5c06\u952e\u6620\u5c04\u5230\u540e\u7aefRedis\u5b9e\u4f8b</p> <ul> <li>\u5f53\u4e00\u4e2a\u5ba2\u6237\u7aef\u8bf7\u6c42\u5230\u8fbeCodis\u96c6\u7fa4\u65f6\uff0c\u5b83\u4f1a\u9996\u5148\u88ab\u8def\u7531\u5230\u4e00\u4e2aProxy\u5b9e\u4f8b\uff1b</li> <li>Proxy\u4f1a\u6839\u636e\u54c8\u5e0c\u69fd\u5206\u5e03\u56fe\u5c06\u8bf7\u6c42\u8def\u7531\u5230\u6b63\u786e\u7684\u540e\u7aefRedis\u5b9e\u4f8b\uff0c\u5e76\u5c06\u54cd\u5e94\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff1b</li> <li>\u5982\u679c\u4e00\u4e2a\u540e\u7aefRedis\u5b9e\u4f8b\u53d1\u751f\u6545\u969c\u6216\u79bb\u7ebf\uff0cProxy\u4f1a\u81ea\u52a8\u5c06\u8be5\u5b9e\u4f8b\u4ece\u54c8\u5e0c\u69fd\u5206\u5e03\u56fe\u4e2d\u5220\u9664\uff0c\u5e76\u5c06\u5176\u8d1f\u8d23\u7684\u54c8\u5e0c\u69fd\u5206\u914d\u7ed9\u5176\u4ed6Redis\u5b9e\u4f8b\u3002</li> </ul>"},{"location":"data_system/cache_system/redis.html#client","title":"Client","text":""},{"location":"data_system/cache_system/redis.html#jedis","title":"Jedis","text":"<ul> <li>\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u662f\u975e\u7ebf\u7a0b\u5b89\u5168\uff0c\u4f7f\u7528\u8fde\u63a5\u6c60\uff1b</li> <li>\u540c\u6b65\u963b\u585e IO\uff0c\u4e0d\u652f\u6301\u5f02\u6b65\uff1b</li> </ul>"},{"location":"data_system/cache_system/redis.html#lettuce","title":"Lettuce","text":"<ul> <li>\u57fa\u4e8e <code>Netty</code>\u6846\u67b6(NIO)\u7684\u4e8b\u4ef6\u9a71\u52a8\u7684\u901a\u4fe1\uff0c\u652f\u6301\u540c\u6b65\u548c\u5f02\u6b65\u8c03\u7528</li> <li>\u591a\u7ebf\u7a0b\u5b89\u5168\uff0c\u591a\u4e2a\u7ebf\u7a0b\u5bf9\u5e94\u5e95\u5c42\u4e00\u4e2a\u7269\u7406\u8fde\u63a5\uff1b</li> <li>\u53ef\u4ee5\u914d\u7f6e\u7ebf\u7a0b\u6c60\uff0c\u589e\u52a0\u8fde\u63a5\u5b9e\u4f8b\uff1b</li> <li>\u652f\u6301\u5f02\u6b65IO\uff1b</li> </ul>"},{"location":"data_system/cache_system/vineyard.html","title":"Vineyard","text":"<p>https://github.com/v6d-io/v6d</p> <p>an in-memory immutable (distributed) data manager.</p>"},{"location":"data_system/cache_system/vineyard.html#_1","title":"\u67b6\u6784","text":""},{"location":"data_system/cache_system/vineyard.html#_2","title":"\u4f7f\u7528","text":""},{"location":"data_system/cache_system/vineyard.html#vineyard-server","title":"vineyard server","text":"<pre><code># \u9ed8\u8ba4\u4f7f\u7528 /var/run/vineyard.sock \u76d1\u542c IPC \u8fde\u63a5\n# IPC: \u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u5728\u4e00\u4e2a\u8282\u70b9\u7684\u591a\u4e2a\u8fdb\u7a0b\npython3 -m vineyard\n</code></pre>"},{"location":"data_system/cache_system/vineyard.html#vineyard-client","title":"vineyard client","text":"<pre><code>import vineyard\nclient = vineyard.connect('/var/run/vineyard.sock')\n</code></pre>"},{"location":"data_system/cache_system/alluxio/index.html","title":"Alluxio","text":"<ul> <li>Only one UFS is supported by Dora. Nested mounts are not supported yet.</li> </ul>"},{"location":"data_system/cache_system/alluxio/index.html#_1","title":"\u67b6\u6784","text":"<p>Decentralized Object Repository Architecture\uff1a\u4e00\u81f4\u6027 Hash</p> <ul> <li>\u6269\u5c55\u6027\uff1a\u652f\u6301 10 \u4ebf\u89c4\u6a21\u7684\u6587\u4ef6\uff1b</li> <li>\u9ad8\u53ef\u7528\u6027\uff1a\u65e0\u5355\u70b9\u6545\u969c\uff0c99.99\u53ef\u7528\u6027\uff1b</li> <li>\u6027\u80fd\uff1a\u4f18\u5148\u8003\u8651 Presto/Trino \u652f\u6301\u7684SQL\u5206\u6790\u5de5\u4f5c\u8d1f\u8f7d \u548c AI \u5de5\u4f5c GPU\u8d1f\u8f7d\uff1b</li> </ul> <p></p>"},{"location":"data_system/cache_system/alluxio/index.html#worker","title":"Worker","text":"<ul> <li>\u6309\u8def\u5f84\u5206\u7247\uff0c\u5b58\u50a8\u5143\u6570\u636e\u548c\u6570\u636e\uff1b</li> </ul>"},{"location":"data_system/cache_system/alluxio/index.html#client","title":"Client","text":"<ul> <li>\u8fd0\u884c\u5728\u5e94\u7528\u4e2d</li> <li>\u4f7f\u7528\u76f8\u540c\u7684\u4e00\u81f4\u6027hash\u7b97\u6cd5\uff0c\u8ba1\u7b97\u6587\u4ef6\u5bf9\u5e94\u7684 Worker</li> </ul>"},{"location":"data_system/cache_system/alluxio/index.html#service-registry","title":"Service Registry","text":"<p>Alluxio Master Node\uff1aworker\u6ce8\u518c\uff0c\u96c6\u7fa4\u914d\u7f6e\u66f4\u65b0\uff0c\u5904\u7406 write IO \u64cd\u4f5c\u3002</p> <ul> <li>\u670d\u52a1\u53d1\u73b0\uff0c\u7ef4\u62a4 Workers \u7684\u4fe1\u606f</li> </ul>"},{"location":"data_system/cache_system/alluxio/index.html#scheduler","title":"Scheduler","text":"<ul> <li>\u5904\u7406\u6240\u6709\u7684\u5f02\u6b65 jobs\uff0c\u5982\u9884\u52a0\u8f7d\u6570\u636e\u5230 Workers</li> </ul>"},{"location":"data_system/cache_system/alluxio/index.html#catalog-service","title":"Catalog Service","text":""},{"location":"data_system/cache_system/alluxio/index.html#transform-service","title":"Transform Service","text":""},{"location":"data_system/cache_system/alluxio/action.html","title":"Alluxio\u5728\u673a\u5668\u5b66\u4e60\u573a\u666f\u4e0b\u7684\u6311\u6218\u4e0e\u4f18\u5316","text":"<ul> <li>\u8bad\u7ec3\u6570\u636e\u4e3a\u6d77\u91cf\u5c0f\u6587\u4ef6\uff08\u5982\u56fe\u7247\uff09\uff1b</li> <li>\u8bad\u7ec3\u6570\u636e\u89c4\u6a21\u8d85\u8fc7\u5355\u673a\u53ef\u7528\u5b58\u50a8\u5bb9\u91cf\uff1b</li> <li>\u9ad8\u5e76\u53d1\u5ea6\u7684\u5206\u5e03\u5f0f\u8bad\u7ec3\u4efb\u52a1\uff0c\u8981\u6c42I/O\u9ad8\u541e\u5410</li> </ul>"},{"location":"data_system/cache_system/alluxio/analysis.html","title":"Analysis","text":"<p>[toc]</p>"},{"location":"data_system/cache_system/alluxio/analysis.html#_1","title":"\u5206\u6790","text":""},{"location":"data_system/cache_system/alluxio/analysis.html#fileinstreamseek","title":"FileInStream\u4e2d\u7684seek\u65b9\u6cd5","text":"<ul> <li>\u5982\u679cseek\u7684\u4f4d\u7f6e\u5728\u540c\u4e00\u4e2aBlock\uff1a </li> <li>BlockInStream\u7684seek\u65b9\u6cd5\uff1b</li> <li>BlockInStream\u7684closeDataReader\u65b9\u6cd5\uff1b<ul> <li>mCurrentChunk.close() \uff0c\u8fd9\u662f\u4e2aNioBuffer\u7684close</li> <li>CLUSTER_CONF\uff1aUSER_LOCAL_READER_CHUNK_SIZE_BYTES\uff08\u672c\u5730Worker, 8M\uff09\uff0c\u51b3\u5b9aCHUNK\u7684\u5927\u5c0f\uff1b</li> <li>chunk \u662f\u5bf9\u6587\u4ef6\u5185\u5bb9\u7684memory map\uff0c\u4f5c\u4e3aByteBuffer\uff1b</li> <li>\u8c03\u7528BufferUtils.cleanDirectBuffer\uff0c\u662f\u4e2a\u540c\u6b65\u7684\u65b9\u6cd5\u3002</li> </ul> </li> </ul> <p>\u200b               b. mDataReader.close()</p>"},{"location":"data_system/cache_system/alluxio/analysis.html#alluxiono_cache","title":"\u5982\u679cAlluxio\u7684\u8bfb\u65b9\u5f0f\u662fNO_CACHE\uff0c\u5176\u989d\u5916\u5f00\u9500\uff1f","text":""},{"location":"data_system/cache_system/alluxio/conf.html","title":"\u914d\u7f6e","text":"<p>\u9ed8\u8ba4\u52a0\u8f7d\u8def\u5f84 PropertyKey.SITE_CONF_DIR\uff0c\u914d\u7f6e\u4e3a</p> <p><code>${alluxio.conf.dir}/,${user.home}/alluxio,/etc/alluxio</code></p> alluxio.user.block.master.client.threads 10 The number of threads used by a block master client pool to talk to the block master. alluxio.user.file.master.client.threads 10 The number of threads used by a file master client to talk to the file master."},{"location":"data_system/cache_system/alluxio/conf.html#_2","title":"\u7f51\u7edc","text":"<p><code>alluxio.user.netty.data.transmission.enabled</code> \u8bbe\u7f6e\u4e3a true \u65f6\uff0c\u4f1a\u76f4\u63a5\u4f7f\u7528 Netty \u5728 client \u548c worker \u4e2d\u4f20\u8f93\u6570\u636e\uff0c\u907f\u514d\u4e86 grpc \u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u3002</p>"},{"location":"data_system/cache_system/alluxio/conf.html#_3","title":"\u5143\u6570\u636e","text":"<p>\u9ed8\u8ba4\uff0cWorker \u4f1a\u7f13\u5b58\u5143\u6570\u636e\uff0c\u8bbe\u7f6e <code>alluxio.dora.client.metadata.cache.enabled</code>\u8bbe\u7f6e\u4e3a false \u65f6\uff0cClient \u4f1a\u76f4\u63a5\u5411\u5e95\u5c42\u7684\u5b58\u50a8\u83b7\u53d6\u5143\u6570\u636e\u3002</p>"},{"location":"data_system/cache_system/alluxio/conf.html#security","title":"Security \u914d\u7f6e","text":"alluxio.security.authentication.type SIMPLE The authentication mode. Currently three modes are supported: NOSASL, SIMPLE, CUSTOM. The default value SIMPLE indicates that a simple authentication is enabled. Server trusts whoever the client claims to be."},{"location":"data_system/cache_system/alluxio/conf.html#_4","title":"\u8c03\u4f18","text":""},{"location":"data_system/cache_system/alluxio/conf.html#_5","title":"\u914d\u7f6e","text":""},{"location":"data_system/cache_system/alluxio/data_store_location.html","title":"\u6570\u636e\u5206\u5e03\u7b56\u7565","text":"<p>TODO\uff1aAlluxio\u6570\u636e\u5206\u6790\u5206\u5e03\u7b56\u7565</p>"},{"location":"data_system/cache_system/alluxio/problems.html","title":"\u7591\u95ee","text":""},{"location":"data_system/cache_system/alluxio/problems.html#readtype","title":"ReadType","text":"<p>Reading data with the <code>ReadType.CACHE_PROMOTE</code> will ensure the data is first transferred to the top tier from lower tier before it is read from the worker.  </p> <ul> <li> <p>alluxio\u67b6\u6784\u56fe\u4e2d\uff0cclient\u8ddfworker\u95f4\uff0c\u6709\u6ca1\u6709<code>control path</code>\uff0c\u5728\u67b6\u6784\u7ae0\u8282\u548c\u8c03\u4f18\u7ae0\u8282\uff0c\u5176\u67b6\u6784\u56fe\u4e0d\u4e00\u81f4\uff1f</p> </li> <li> <p>Read Cache Miss\u7684\u60c5\u51b5</p> </li> </ul> <p>\u5f53\u53ea\u8bfb\u53d6block\u90e8\u5206\u6216\u8005\u975e\u987a\u5e8f\u8bbf\u95eeblock\uff0cclient\u4f1a\u6307\u793aworker\u5f02\u6b65cache\u6574\u4e2ablock</p> <p>1) \u5982\u679c\u8bfb\u53d6\u6574\u4e2ablock\uff0ccache\u7684\u60c5\u51b5\u662f\u600e\u4e48\u6837\uff1f</p> <p>2) \u8bfb\u53d6UFS\u4e2d\u6570\u636e\uff0c\u4e00\u5b9a\u662fclient\u6240\u5728\u7684local worker\u4e48\uff1f</p> <ul> <li><code>alluxio.user.file.metadata.load.type</code>: This property can be set to either <code>ALWAYS</code>,<code>ONCE</code>, or <code>NEVER</code>. It acts similar to <code>alluxio.user.file.metadata.sync.interval</code>, but with two caveats:</li> <li>It only discovers new files and does not reload modified or deleted files.</li> <li> <p>It only applies to the exists, list, and getStatus RPCs.</p> </li> <li> <p>\u5f80alluxio\u5199\u6570\u636e\uff0c\u4f1a\u88abGC\u4e48\uff1f</p> </li> <li> <p>\u8c03\u4f18\u7ae0\u8282\uff0cAlluxio 2.0\u7528grpc\u66ff\u6362\u4e86thirft\uff0c\u6240\u4ee5\u6d89\u53ca\u5230\u7684thrift\u7684\u5730\u65b9\u90fd\u9700\u8981\u6539\u52a8\uff1f</p> </li> </ul> <p>\u4e00\u4e2a\u8282\u70b9\u53ea\u80fd\u542f\u52a8\u4e00\u4e2aWorker\u4e48\uff1f</p> <p>alluxio\u8c03\u4f18\u4e2dMaster\u4e3a\u4ec0\u4e48\u6ca1\u6709\u7ebf\u7a0b\u6570\u7684\u8c03\u4f18\u4e86\uff1f</p> <ul> <li>alluxio.master.rpc.executor.max.pool.size\u7684\u8bbe\u7f6e\uff0c\u9ed8\u8ba4500</li> </ul> <p>\u5b9a\u4f4d\u7b56\u7565\uff1a</p> <ul> <li>\u968f\u673a\u9009\u62e9\u7684\u5bb9\u91cf\u8fd8\u4e0d\u591f\uff0c\u600e\u4e48\u529e</li> <li>\u5bb9\u91cf\u662f\u600e\u4e48\u5224\u65ad\uff0c\u5206\u5c42\u60c5\u51b5\u4e0b\uff0c\u662f\u603b\u5bb9\u91cf\uff0c\u8fd8\u662f\uff1f</li> </ul> <p>client\u6709worker\u548c\u6ca1worker\u7684\u60c5\u51b5\u4e0b\uff0creadtype\u7684cache_promote\u8868\u73b0\u662f\u4e00\u81f4\u7684\u4e48\uff1f</p> <ul> <li>\u6838\u5fc3\u662f\uff0cReadType\u7684\u914d\u7f6e\u548cworker\u672c\u5730\u5b58\u50a8\u7684\u5173\u7cfb\u662f\u72ec\u7acb\u7684\u8fd8\u662f\uff1f</li> </ul> <p>NO_CACHE\u5373\u4f7f\u5728\u5df2\u7ecf\u7f13\u5b58\u7684\u60c5\u51b5\u4e0b\uff0c\u4e5f\u4e0d\u4f1a\u4eceUFS\u8bfb\u53d6\u4e48\uff1f</p> <p>alluxio secondary master checkpoint\u7684\u65f6\u5019\uff0c\u9700\u8981\u505c\u670d\uff1f</p> <p>HA\u6a21\u5f0f\u4e0b\uff0c\u4e3bmaster\u7684journal\u4f1a\u65e0\u9650\u5236\u589e\u957f\uff0c\u56e0\u6b64\u5fc5\u987b\u8981\u505c\u670d\uff1f</p> <p>\u5355\u4e2amaster\u60c5\u51b5\u4e0b\uff0cJournal Size\u4f1a\u65e0\u9650\u5236\u5730\u589e\u957f\uff0c\u901a\u8fc7HA\u8ba9standby master\u6267\u884ccheckpoint master state and clean up the logs that were written prior to the checkpoints.</p> <p>primary master\u4e0d\u4f1a\u6267\u884ccheckpoint\uff0c\u56e0\u4e3acheckpoint\u7684\u65f6\u5019\u4f1a\u9020\u6210master metadata \u4e0d\u53ef\u6539\u53d8\uff0c\u56e0\u6b64\u4e0d\u80fd\u63d0\u4f9b\u670d\u52a1\u3002\u56e0\u6b64\u4f1a\u5bfc\u81f4primary master\u7684journal log\u65e0\u9650\u589e\u957f\u3002</p>"},{"location":"data_system/cache_system/alluxio/short_cut_read.html","title":"\u77ed\u8bfb","text":"<p>\u4ee3\u7801\u903b\u8f91</p> <p>FileInStream : updateStream</p> <p>AlluxioBlockStore : getInStream</p> <p>BlockInStream : create</p> <p>BlockInStream : createLocalBlockInStream</p> <pre><code>if (sourceIsLocal &amp;&amp; shortCircuit &amp;&amp; !sourceSupportsDomainSocket) \n</code></pre>"},{"location":"data_system/data_lake/compare.html","title":"\u6570\u636e\u6e56","text":"<p>\u6570\u636e\u6e56\u662f\u4e00\u79cd\u5728\u7cfb\u7edf\u6216\u5b58\u50a8\u5e93\u4e2d\u4ee5\u81ea\u7136\u683c\u5f0f\u5b58\u50a8\u6570\u636e\u7684\u65b9\u6cd5\uff0c\u5b83\u6709\u52a9\u4e8e\u4ee5\u5404\u79cd\u6a21\u5f0f\u548c\u7ed3\u6784\u5f62\u5f0f\u914d\u7f6e\u6570\u636e\uff0c\u901a\u5e38\u662f\u5bf9\u8c61\u5757\u6216\u6587\u4ef6\u3002</p> <p>\u6570\u636e\u6e56\u7684\u4e3b\u8981\u601d\u60f3\u662f\u5bf9\u4f01\u4e1a\u4e2d\u7684\u6240\u6709\u6570\u636e\u8fdb\u884c\u7edf\u4e00\u5b58\u50a8\uff0c\u4ece\u539f\u59cb\u6570\u636e\uff08\u6e90\u7cfb\u7edf\u6570\u636e\u7684\u7cbe\u786e\u526f\u672c\uff09\u8f6c\u6362\u4e3a\u7528\u4e8e\u62a5\u544a\u3001\u53ef\u89c6\u5316\u3001\u5206\u6790\u548c\u673a\u5668\u5b66\u4e60\u7b49\u5404\u79cd\u4efb\u52a1\u7684\u76ee\u6807\u6570\u636e\u3002</p> <p>\u6570\u636e\u6e56\u4e2d\u7684\u6570\u636e\u5305\u62ec\u7ed3\u6784\u5316\u6570\u636e\uff08\u5173\u7cfb\u6570\u636e\u5e93\u6570\u636e\uff09\uff0c\u534a\u7ed3\u6784\u5316\u6570\u636e\uff08CSV\u3001XML\u3001JSON\u7b49\uff09\uff0c\u975e\u7ed3\u6784\u5316\u6570\u636e\uff08\u7535\u5b50\u90ae\u4ef6\uff0c\u6587\u6863\uff0cPDF\uff09\u548c\u4e8c\u8fdb\u5236\u6570\u636e\uff08\u56fe\u50cf\u3001\u97f3\u9891\u3001\u89c6\u9891\uff09\uff0c\u4ece\u800c\u5f62\u6210\u4e00\u4e2a\u5bb9\u7eb3\u6240\u6709\u5f62\u5f0f\u6570\u636e\u7684\u96c6\u4e2d\u5f0f\u6570\u636e\u5b58\u50a8\u3002</p> <p>\u89e3\u51b3\u7684\u573a\u666f\u95ee\u9898\u662f\u4ec0\u4e48\uff1f</p> <ul> <li>\u5b58\u50a8\u539f\u59cb\u6570\u636e\uff0c\u7ed3\u6784\u5316\u548c\u975e\u7ed3\u6784\u5316\u7684\u6570\u636e\uff1f</li> </ul> <p> \u95ee\u9898\uff08TODO\uff09\uff1a\u975e\u7ed3\u6784\u5316\u6570\u636e\u5728Hudi\u4e2d\u7684\u5b58\u50a8\uff08Parquet \u4e8c\u8fdb\u5236\uff1f\uff09</p>"},{"location":"data_system/data_lake/compare.html#vs","title":"\u6570\u636e\u6e56VS\u6570\u636e\u4ed3\u5e93","text":"\u7279\u6027 \u6570\u636e\u4ed3\u5e93 \u6570\u636e\u6e56 \u6570\u636e \u6765\u81ea\u4e8b\u52a1\u7cfb\u7edf\u3001\u8fd0\u8425\u6570\u636e\u5e93\u548c\u4e1a\u52a1\u7ebf\u5e94\u7528\u7a0b\u5e8f\u7684\u5173\u7cfb\u6570\u636e \u6765\u81eaIoT\u8bbe\u5907\u3001\u7f51\u7ad9\u3001\u79fb\u52a8\u5e94\u7528\u7a0b\u5e8f\u3001\u793e\u4ea4\u6bcf\u9898\u548c\u4f01\u4e1a\u5e94\u7528\u7a0b\u5e8f\u7684\u975e\u5173\u7cfb\u548c\u5173\u7cfb\u6570\u636e Schema \u8bbe\u8ba1\u5728\u6570\u636e\u4ed3\u5e93\u5b9e\u65bd\u4e4b\u524d\uff08\u5199\u5165\u578bSchema\uff09 \u5199\u5165\u5728\u5206\u6790\u65f6\uff08\u8bfb\u53d6\u578bSchema\uff09 \u6027\u4ef7\u6bd4 \u66f4\u5feb\u67e5\u8be2\u7ed3\u679c\u4f1a\u5e26\u6765\u8f83\u9ad8\u5b58\u50a8\u6210\u672c \u66f4\u5feb\u67e5\u8be2\u7ed3\u679c\u503c\u5e8f\u8f83\u4f4e\u5b58\u50a8\u6210\u672c \u6570\u636e\u8d28\u91cf \u4f5c\u4e3a\u91cd\u8981\u4e8b\u5b9e\u4f9d\u636e\u7684\u9ad8\u5ea6\u76d1\u7ba1\u6570\u636e \u4efb\u4f55\u53ef\u4ee5\u6216\u65e0\u6cd5\u8fdb\u884c\u76d1\u7ba1\u7684\u6570\u636e\uff08\u4f8b\u5982\u539f\u59cb\u6570\u636e\uff09 \u7528\u6237 \u4e1a\u52a1\u5206\u6790\u5e08 \u6570\u636e\u79d1\u5b66\u5bb6\u3001\u6570\u636e\u5f00\u53d1\u4eba\u5458\u548c\u4e1a\u52a1\u5206\u6790\u5e08\uff08\u4f7f\u7528\u76d1\u7ba1\u6570\u636e\uff09 \u5206\u6790 \u6279\u5904\u7406\u62a5\u544a\u3001BI\u548c\u53ef\u89c6\u5316 \u673a\u5668\u5b66\u4e60\u3001\u9884\u6d4b\u5206\u6790\u3001\u6570\u636e\u53d1\u73b0\u548c\u5206\u6790"},{"location":"data_system/data_lake/compare.html#hudi-vs-iceberg-vs-deltalake","title":"Hudi vs Iceberg vs Deltalake","text":"<p>Hudi \u4e3a\u4e86 incremental \u7684 upserts\uff0cIceberg \u5b9a\u4f4d\u4e8e\u9ad8\u6027\u80fd\u7684\u5206\u6790\u4e0e\u53ef\u9760\u7684\u6570\u636e\u7ba1\u7406\uff0cDeltaLake \u5b9a\u4f4d\u4e8e\u6d41\u6279\u4e00\u4f53\u7684\u6570\u636e\u5904\u7406\u3002</p>"},{"location":"data_system/data_lake/compare.html#_2","title":"\u573a\u666f","text":"<p>Hudi</p> <p></p> <p>IceBerg</p> <p></p> <p>DeltaLake</p> <p></p>"},{"location":"data_system/data_lake/compare.html#acid","title":"ACID\u548c\u9694\u79bb\u7ea7\u522b\u652f\u6301","text":"<p>\u8fd9\u91cc\u4e3b\u8981\u89e3\u91ca\u4e0b\uff0c\u5bf9\u6570\u636e\u6e56\u6765\u8bf4\u4e09\u79cd\u9694\u79bb\u5206\u522b\u4ee3\u8868\u7684\u542b\u4e49\u3002</p> <ol> <li>Serialization\u662f\u8bf4\u6240\u6709\u7684reader\u548cwriter\u90fd\u5fc5\u987b\u4e32\u884c\u6267\u884c\uff1b</li> <li>Write Serialization: \u662f\u8bf4\u591a\u4e2awriter\u5fc5\u987b\u4e25\u683c\u4e32\u884c\uff0creader\u548cwriter\u4e4b\u95f4\u5219\u53ef\u4ee5\u540c\u65f6\u8dd1\uff1b</li> <li>Snapshot Isolation: \u662f\u8bf4\u5982\u679c\u591a\u4e2awriter\u5199\u7684\u6570\u636e\u65e0\u4ea4\u96c6\uff0c\u5219\u53ef\u4ee5\u5e76\u53d1\u6267\u884c\uff1b\u5426\u5219\u53ea\u80fd\u4e32\u884c\u3002Reader\u548cwriter\u53ef\u4ee5\u540c\u65f6\u8dd1\u3002</li> </ol> <p>\u7efc\u5408\u8d77\u6765\u770b\uff0cSnapshot Isolation\u9694\u79bb\u7ea7\u522b\u7684\u5e76\u53d1\u6027\u662f\u76f8\u5bf9\u6bd4\u8f83\u597d\u7684\u3002</p>"},{"location":"data_system/data_lake/compare.html#schema","title":"Schema\u53d8\u66f4\u652f\u6301\u548c\u8bbe\u8ba1","text":"<p>\u4e00\u4e2a\u662fschema\u53d8\u66f4\u7684\u652f\u6301\u60c5\u51b5:</p> <ul> <li>\u6211\u7684\u7406\u89e3\u662fhudi\u4ec5\u652f\u6301\u6dfb\u52a0\u53ef\u9009\u5217\u548c\u5220\u9664\u5217\u8fd9\u79cd\u5411\u540e\u517c\u5bb9\u7684DDL\u64cd\u4f5c\uff0c\u800c\u5176\u4ed6\u65b9\u6848\u5219\u6ca1\u6709\u8fd9\u4e2a\u9650\u5236</li> </ul> <p>\u53e6\u4e00\u4e2a\u662f\u6570\u636e\u6e56\u662f\u5426\u81ea\u5b9a\u4e49schema\u63a5\u53e3\uff0c\u4ee5\u671f\u8ddf\u8ba1\u7b97\u5f15\u64ce\u7684schema\u89e3\u8026\u3002</p> <ul> <li>iceberg\u662f\u505a\u7684\u6bd4\u8f83\u597d\u7684\uff0c\u62bd\u8c61\u4e86\u81ea\u5df1\u7684schema\uff0c\u4e0d\u7ed1\u5b9a\u4efb\u4f55\u8ba1\u7b97\u5f15\u64ce\u5c42\u9762\u7684schema\u3002</li> </ul>"},{"location":"data_system/data_lake/compare.html#_3","title":"\u6d41\u6279\u63a5\u53e3\u652f\u6301","text":"<p>\u76ee\u524dIceberg\u548cHive\u6682\u65f6\u4e0d\u652f\u6301\u6d41\u5f0f\u6d88\u8d39\uff0c\u4e0d\u8fc7Iceberg\u793e\u533a\u6b63\u5728issue 179\u4e0a\u5f00\u53d1\u652f\u6301\u3002</p>"},{"location":"data_system/data_lake/compare.html#_4","title":"\u63a5\u53e3\u62bd\u8c61\u7a0b\u5ea6\u548c\u63d2\u4ef6\u5316","text":"<p>\u4ece\u8ba1\u7b97\u5f15\u64ce\u7684\u5199\u5165\u548c\u8bfb\u53d6\u8def\u5f84\u3001\u5e95\u5c42\u5b58\u50a8\u53ef\u63d2\u62d4\u3001\u6587\u4ef6\u683c\u5f0f\u56db\u4e2a\u65b9\u9762\u6765\u505a\u5bf9\u6bd4\u3002</p> <ul> <li> <p>Iceberg\u662f\u62bd\u8c61\u7a0b\u5ea6\u505a\u5f97\u6700\u597d\u7684\u6570\u636e\u6e56\u65b9\u6848\uff0c\u56db\u4e2a\u65b9\u9762\u90fd\u505a\u4e86\u975e\u5e38\u5e72\u51c0\u7684\u89e3\u8026\u3002</p> </li> <li> <p>delta\u662fdatabricks\u80cc\u540e\u4e3b\u63a8\u7684\uff0c\u5fc5\u987b\u5929\u7136\u7ed1\u5b9aspark\uff1b</p> </li> <li>hudi\u7684\u4ee3\u7801\u8ddfdelta\u7c7b\u4f3c\uff0c\u4e5f\u662f\u5f3a\u7ed1\u5b9aspark\u3002</li> </ul> <p>\u5b58\u50a8\u53ef\u63d2\u62d4\u7684\u610f\u601d\u662f\u8bf4\uff0c\u662f\u5426\u65b9\u4fbf\u8fc1\u79fb\u5230\u5176\u4ed6\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u4e0a\uff08\u4f8b\u5982S3\uff09\uff0c\u8fd9\u9700\u8981\u6570\u636e\u6e56\u5bf9\u6587\u4ef6\u7cfb\u7edfAPI\u63a5\u53e3\u6709\u6700\u5c11\u7684\u8bed\u4e49\u4f9d\u8d56\uff0c\u4f8b\u5982\u82e5\u6570\u636e\u6e56\u7684ACID\u5f3a\u4f9d\u8d56\u6587\u4ef6\u7cfb\u7edfrename\u63a5\u53e3\u539f\u5b50\u6027\u7684\u8bdd\uff0c\u5c31\u96be\u4ee5\u8fc1\u79fb\u5230S3\u8fd9\u6837\u5ec9\u4ef7\u5b58\u50a8\u4e0a\uff0c\u76ee\u524d\u6765\u770b\u53ea\u6709Hive\u6ca1\u6709\u592a\u8003\u8651\u8fd9\u65b9\u9762\u7684\u8bbe\u8ba1\uff1b</p> <p>\u6587\u4ef6\u683c\u5f0f\u6307\u7684\u662f\u5728\u4e0d\u4f9d\u8d56\u6570\u636e\u6e56\u5de5\u5177\u7684\u60c5\u51b5\u4e0b\uff0c\u662f\u5426\u80fd\u8bfb\u53d6\u548c\u5206\u6790\u6587\u4ef6\u6570\u636e\uff0c\u8fd9\u5c31\u8981\u6c42\u6570\u636e\u6e56\u4e0d\u989d\u5916\u8bbe\u8ba1\u81ea\u5df1\u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u7edf\u4e00\u7528\u5f00\u6e90\u7684parquet\u548cavro\u7b49\u683c\u5f0f\u3002\u8fd9\u91cc\uff0c\u6709\u4e00\u4e2a\u597d\u5904\u5c31\u662f\uff0c\u8fc1\u79fb\u7684\u6210\u672c\u5f88\u4f4e\uff0c\u4e0d\u4f1a\u88ab\u67d0\u4e00\u4e2a\u6570\u636e\u6e56\u65b9\u6848\u7ed9\u7ed1\u6b7b\u3002</p>"},{"location":"data_system/data_lake/compare.html#_5","title":"\u67e5\u8be2\u6027\u80fd\u4f18\u5316","text":""},{"location":"data_system/data_lake/compare.html#_6","title":"\u5176\u4ed6\u529f\u80fd","text":"<p>\u8fd9\u91ccOne line demo\u6307\u7684\u662f\uff0c\u793a\u4f8bdemo\u662f\u5426\u8db3\u591f\u7b80\u5355\uff0c\u4f53\u73b0\u4e86\u65b9\u6848\u7684\u6613\u7528\u6027\uff0cIceberg\u7a0d\u5fae\u590d\u6742\u4e00\u70b9\uff08\u6211\u8ba4\u4e3a\u4e3b\u8981\u662fIceberg\u81ea\u5df1\u62bd\u8c61\u51fa\u4e86schema\uff0c\u6240\u4ee5\u64cd\u4f5c\u524d\u9700\u8981\u5b9a\u4e49\u597d\u8868\u7684schema\uff09\u3002\u505a\u5f97\u6700\u597d\u7684\u5176\u5b9e\u662fdelta\uff0c\u56e0\u4e3a\u5b83\u6df1\u5ea6\u8ddf\u968fspark\u6613\u7528\u6027\u7684\u811a\u6b65\u3002</p> <p>Python\u652f\u6301\u5176\u5b9e\u662f\u5f88\u591a\u57fa\u4e8e\u6570\u636e\u6e56\u4e4b\u4e0a\u505a\u673a\u5668\u5b66\u4e60\u7684\u5f00\u53d1\u8005\u4f1a\u8003\u8651\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u770b\u5230Iceberg\u548cDelta\u662f\u505a\u7684\u5f88\u597d\u7684\u4e24\u4e2a\u65b9\u6848\u3002</p> <p>\u51fa\u4e8e\u6570\u636e\u5b89\u5168\u7684\u8003\u8651\uff0cIceberg\u8fd8\u63d0\u4f9b\u4e86\u6587\u4ef6\u7ea7\u522b\u7684\u52a0\u5bc6\u89e3\u5bc6\u529f\u80fd\uff0c\u8fd9\u662f\u5176\u4ed6\u65b9\u6848\u672a\u66fe\u8003\u8651\u5230\u7684\u4e00\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u70b9\u3002</p>"},{"location":"data_system/data_lake/compare.html#_7","title":"\u603b\u7ed3\u5bf9\u6bd4","text":""},{"location":"data_system/data_lake/apache_hudi/index.html","title":"Hudi \u7d22\u5f15\u6280\u672f","text":"<p>Hudi \u901a\u8fc7<code>HoodieKey</code>\u6709 Min/Max \u7edf\u8ba1\u548cBloomFilter\uff0c\u7528\u4e8e\u5feb\u901f\u5b9a\u4f4d Record \u6240\u5728\u7684\u6587\u4ef6\u3002</p> <p>\u7d22\u5f15\u673a\u5236\u63d0\u4f9b\u9ad8\u6548\u7684<code>upsert</code>\u64cd\u4f5c\uff08\u533a\u5206\u6d88\u606f\u662fINSERT\u8fd8\u662fUPDATE\uff09\uff1a</p> <ul> <li>\u5c06 Hoodie key \uff08\u8bb0\u5f55\u952e+\u5206\u533a\u8def\u5f84\uff09\u5230 file id (FileGroup) \u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\uff1b</li> <li>\u6620\u5c04\u6570\u636e\u7b2c\u4e00\u6b21\u5199\u5165\u6587\u4ef6\u540e\u4fdd\u6301\u4e0d\u53d8\uff0c\u4e00\u4e2a FileGroup \u5305\u542b\u4e86\u4e00\u6279 record \u7684\u6240\u6709\u7248\u672c\u8bb0\u5f55</li> </ul> <p></p> <p>Hudi\u7d22\u5f15\u53ef\u4ee5\u6839\u636e\u5176\u67e5\u8be2\u5206\u533a\u8bb0\u5f55\u7684\u80fd\u529b\u8fdb\u884c\u5206\u7c7b\uff1a</p> <p>1\uff09 \u5168\u5c40\u7d22\u5f15\uff1a\u4e0d\u9700\u8981\u5206\u533a\u4fe1\u606f\u5373\u53ef\u67e5\u8be2\u8bb0\u5f55\u952e\u6620\u5c04\u7684\u6587\u4ef6ID\u3002\u6bd4\u5982\uff0c\u5199\u7a0b\u5e8f\u53ef\u4ee5\u4f20\u5165null\u6216\u8005\u4efb\u4f55\u5b57\u7b26\u4e32\u4f5c\u4e3a\u5206\u533a\u8def\u5f84\uff08partitionPath\uff09\uff0c\u4f46\u7d22\u5f15\u4ecd\u7136\u4f1a\u67e5\u627e\u5230\u8be5\u8bb0\u5f55\u7684\u4f4d\u7f6e\u3002\u5168\u5c40\u7d22\u5f15\u5728\u8bb0\u5f55\u952e\u5728\u6574\u5f20\u8868\u4e2d\u4fdd\u8bc1\u552f\u4e00\u7684\u60c5\u51b5\u4e0b\u975e\u5e38\u6709\u7528\uff0c\u4f46\u662f\u67e5\u8be2\u7684\u6d88\u8017\u968f\u7740\u8868\u7684\u5927\u5c0f\u5448\u51fd\u6570\u5f0f\u589e\u52a0\u3002</p> <p>2\uff09 \u975e\u5168\u5c40\u7d22\u5f15\uff1a\u975e\u5168\u5c40\u7d22\u5f15\u4f9d\u8d56\u5206\u533a\u8def\u5f84\uff08partitionPath\uff09\uff0c\u5bf9\u4e8e\u7ed9\u5b9a\u7684\u8bb0\u5f55\u952e\uff0c\u5b83\u53ea\u4f1a\u5728\u7ed9\u5b9a\u5206\u533a\u8def\u5f84\u4e0b\u67e5\u627e\u8be5\u8bb0\u5f55\u3002\u8fd9\u6bd4\u8f83\u9002\u5408\u603b\u662f\u540c\u65f6\u751f\u6210\u5206\u533a\u8def\u5f84\u548c\u8bb0\u5f55\u952e\u7684\u573a\u666f\uff0c\u540c\u65f6\u8fd8\u80fd\u4eab\u53d7\u5230\u66f4\u597d\u7684\u6269\u5c55\u6027\uff0c\u56e0\u4e3a\u67e5\u8be2\u7d22\u5f15\u7684\u6d88\u8017\u53ea\u4e0e\u5199\u5165\u5230\u8be5\u5206\u533a\u4e0b\u6570\u636e\u96c6\u5927\u5c0f\u6709\u5173\u7cfb\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/index.html#_1","title":"\u7d22\u5f15\u7c7b\u578b","text":"<ul> <li>HBaseIndex\uff1a\u672c\u8d28\u4e0a\u662f\u5168\u5c40\u7d22\u5f15\uff1b</li> <li>BloomIndex\uff1aBloom\u7d22\u5f15\uff0c\u901a\u8fc7base file\uff08parquet\uff09\u7684footer\u7684meta\u533a\u8bb0\u5f55record key\u7ec4\u6210\u7684BloomFilter\uff1b</li> <li>\u52a8\u6001\u5e03\u9686\u8fc7\u6ee4\u5668\uff08\u8bbe\u7f6e<code>hoodie.bloom.index.filter.type=DYNAMIC_V0</code>\uff09\uff0c\u6839\u636e\u6587\u4ef6\u91cc\u5b58\u653e\u7684\u8bb0\u5f55\u6570\u91cf\u6765\u8c03\u6574\u5927\u5c0f\u4ece\u800c\u8fbe\u5230\u8bbe\u5b9a\u7684\u4f2a\u6b63\u7387\u3002</li> <li>SimpleIndex\uff1aa lean join of the incoming update/delete records against keys extracted from the table on storage\uff1b</li> <li> <p>InMemoryHashIndex\uff1a\u5185\u5b58\u4e2dConcurrentMap\uff0cSpark \u5185\u5b58\u7d22\u5f15\u5f53\u524d\u662f\u7528\u6765\u6d4b\u8bd5\u7684\u7d22\u5f15\uff1b</p> </li> <li> <p>Flink State-based Index\uff1aHUDI \u5728 0.8.0 \u7248\u672c\u4e2d\u5b9e\u73b0\u7684 Flink witer\uff0c\u91c7\u7528\u4e86 Flink \u7684 state \u4f5c\u4e3a\u5e95\u5c42\u7684 index \u5b58\u50a8\uff0c\u6bcf\u4e2a records \u5728\u5199\u5165\u4e4b\u524d\u90fd\u4f1a\u5148\u8ba1\u7b97\u76ee\u6807 bucket ID\uff0c\u4e0d\u540c\u4e8e BloomFilter Index\uff0c\u907f\u514d\u4e86\u6bcf\u6b21\u91cd\u590d\u7684\u6587\u4ef6 index \u67e5\u627e\uff1b</p> </li> </ul>"},{"location":"data_system/data_lake/apache_hudi/index.html#_2","title":"\u573a\u666f\u548c\u9002\u7528","text":"<p>\u573a\u666f\u4e00\uff1a\u5bf9\u4e8b\u5b9e\u8868\u7684\u5ef6\u8fdf\u66f4\u65b0</p> <ul> <li> <p>\u7279\u70b9\uff1a\u5927\u90e8\u5206\u66f4\u65b0\u4f1a\u53d1\u751f\u5728\u6700\u65b0\u7684\u51e0\u4e2a\u5206\u533a\u4e0a\u800c\u5c0f\u90e8\u5206\u4f1a\u5728\u65e7\u7684\u5206\u533a</p> </li> <li> <p>\u9002\u7528\u7d22\u5f15\uff1a\u5e03\u9686\u7d22\u5f15</p> </li> <li> <p>\u539f\u7406\uff1a\u56e0\u4e3a\u67e5\u8be2\u7d22\u5f15\u53ef\u4ee5\u9760\u8bbe\u7f6e\u5f97\u5f53\u7684\u5e03\u9686\u8fc7\u6ee4\u5668\u6765\u526a\u679d\u5f88\u591a\u6570\u636e\u6587\u4ef6\u3002\u53e6\u5916\uff0c\u5982\u679c\u751f\u6210\u7684\u952e\u53ef\u4ee5\u4ee5\u67d0\u79cd\u987a\u5e8f\u6392\u5217\uff0c\u53c2\u4e0e\u6bd4\u8f83\u7684\u6587\u4ef6\u6570\u4f1a\u8fdb\u4e00\u6b65\u901a\u8fc7\u8303\u56f4\u526a\u679d\u800c\u51cf\u5c11\u3002Hudi\u7528\u6240\u6709\u6587\u4ef6\u7684\u952e\u57df\u6765\u6784\u9020\u533a\u95f4\u6811\uff0c\u8fd9\u6837\u80fd\u6765\u9ad8\u6548\u5730\u4f9d\u636e\u8f93\u5165\u7684\u66f4\u5220\u8bb0\u5f55\u7684\u952e\u57df\u6765\u6392\u9664\u4e0d\u5339\u914d\u7684\u6587\u4ef6\u3002</p> </li> </ul> <p></p> <p>\u573a\u666f\u4e8c\uff1a\u5bf9\u4e8b\u4ef6\u8868\u7684\u53bb\u91cd</p> <ul> <li> <p>\u7279\u70b9\uff1a\u5927\u90e8\u5206\u90fd\u662f\u4ec5\u8ffd\u52a0\u7684\u6570\u636e\uff0c\u63d2\u5165\u548c\u66f4\u65b0\u53ea\u5b58\u5728\u4e8e\u6700\u65b0\u7684\u51e0\u4e2a\u5206\u533a\u4e2d\u3002\u7531\u4e8e\u91cd\u590d\u4e8b\u4ef6\u53ef\u80fd\u53d1\u751f\u5728\u6574\u4e2a\u6570\u636e\u7ba1\u9053\u7684\u4efb\u4e00\u8282\u70b9\uff0c\u5728\u5b58\u653e\u5230\u6570\u636e\u6e56\u524d\u53bb\u91cd\u662f\u4e00\u4e2a\u5e38\u89c1\u7684\u9700\u6c42\u3002</p> </li> <li> <p>\u9002\u7528\u7d22\u5f15\uff1a\u5e03\u9686\u7d22\u5f15</p> </li> <li> <p>\u539f\u7406\uff1a\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u4f5c\u4e3a\u9996\u7c7b\u5904\u7406\u5bf9\u8c61\u7684\u65f6\u95f4\u6765\u6784\u9020\u7531\u4e8b\u4ef6\u65f6\u95f4\u6233\u548c\u4e8b\u4ef6id\uff08event_ts+event_id)\u7ec4\u6210\u7684\u952e\uff0c\u8fd9\u6837\u63d2\u5165\u7684\u8bb0\u5f55\u5c31\u6709\u4e86\u5355\u8c03\u589e\u957f\u7684\u952e\u3002\u8fd9\u4f1a\u5728\u6700\u65b0\u7684\u51e0\u4e2a\u5206\u533a\u91cc\u5927\u5e45\u63d0\u9ad8\u526a\u679d\u6587\u4ef6\u7684\u6548\u76ca\u3002</p> </li> </ul> <p></p> <p>\u573a\u666f\u4e09\uff1a\u5bf9\u7ef4\u5ea6\u8868\u7684\u968f\u673a\u66f4\u5220</p> <ul> <li>\u7279\u70b9\uff1a\u66f4\u65b0\u91cf\u901a\u5e38\u5f88\u5c0f\u4f46\u6240\u63a5\u89e6\u7684\u5206\u533a\u548c\u6570\u636e\u6587\u4ef6\u4f1a\u5f88\u591a\uff0c\u8303\u56f4\u6d89\u53ca\u4ece\u65e7\u5230\u65b0\u7684\u6574\u4e2a\u6570\u636e\u96c6\u3002\u6709\u65f6\u56e0\u4e3a\u6ca1\u6709\u5f88\u597d\u7684\u5206\u533a\u6761\u4ef6\uff0c\u8fd9\u4e9b\u8868\u4e5f\u4f1a\u4e0d\u5206\u533a\u3002</li> <li> <p>\u9002\u7528\u7d22\u5f15\uff1a\u7b80\u5355\u7d22\u5f15</p> </li> <li> <p>\u539f\u7406\uff1a\u66f4\u65b0\u64cd\u4f5c\u901a\u5e38\u4f1a\u89e6\u53ca\u8868\u91cc\u5927\u591a\u6570\u6587\u4ef6\u4ece\u800c\u5bfc\u81f4\u5e03\u9686\u8fc7\u6ee4\u5668\u4f9d\u636e\u8f93\u5165\u7684\u66f4\u65b0\u5bf9\u6240\u6709\u6587\u4ef6\u6807\u660e\u771f\u6b63(true positive)\u3002\u6700\u7ec8\u4f1a\u5bfc\u81f4\uff0c\u5373\u4f7f\u91c7\u7528\u4e86\u8303\u56f4\u6bd4\u8f83\uff0c\u4e5f\u8fd8\u662f\u68c0\u67e5\u4e86\u6240\u6709\u6587\u4ef6\u3002\u4f7f\u7528<code>\u7b80\u5355\u7d22\u5f15</code>\u5bf9\u6b64\u573a\u666f\u66f4\u5408\u9002\uff0c\u56e0\u4e3a\u5b83\u4e0d\u91c7\u7528\u63d0\u524d\u7684\u526a\u679d\u64cd\u4f5c\uff0c\u800c\u662f\u76f4\u63a5\u548c\u6240\u6709\u6587\u4ef6\u7684\u6240\u9700\u5b57\u6bb5\u8fde\u63a5\u3002\u5982\u679c\u989d\u5916\u7684\u8fd0\u7ef4\u6210\u672c\u53ef\u4ee5\u63a5\u53d7\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u91c7\u7528HBase\u7d22\u5f15\uff0c\u5176\u5bf9\u8fd9\u4e9b\u8868\u80fd\u63d0\u4f9b\u66f4\u52a0\u4f18\u8d8a\u7684\u67e5\u8be2\u6548\u7387\u3002</p> </li> </ul> <p></p>"},{"location":"data_system/data_lake/apache_hudi/index.html#_3","title":"\u591a\u7ea7\u7d22\u5f15","text":"<p>Hudi \u591a\u6a21\u7d22\u5f15\uff1ahttps://www.onehouse.ai/blog/introducing-multi-modal-index-for-the-lakehouse-in-apache-hudi</p>"},{"location":"data_system/data_lake/apache_hudi/index.html#_4","title":"\u80cc\u666f","text":"<p>\u4f7f\u7528\u7d22\u5f15\u63d0\u5347\u6570\u636e\u67e5\u8be2\u7684\u901f\u5ea6\uff0c\u5c31\u9700\u8981\u5b58\u50a8<code>metadata</code>\u3002\u5bf9\u4e8eTB\u3001EB\u7ea7\u522b\u8868\u4e2d\u7684<code>metadata</code>\uff0c\u5176\u91cf\u7ea7\u4f1a\u5f88\u5927\u3002</p> <ul> <li> <p>\u901a\u5e38\u7684\u505a\u6cd5\u662f\u628ametadata\u5b58\u50a8\u4e8e\u5355\u72ec\u7684\u6570\u636e\u5757block\u6216\u8005\u662f\u6570\u636e\u6587\u4ef6\u4e2d\u3002</p> </li> <li> <p>\u5728\u5b9e\u6d4b\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9047\u5230\u4e86\u8bfb\u5199\u74f6\u9888\u3002</p> </li> <li> <p>\u540c\u65f6\uff0c\u5728\u7ef4\u62a4metadata\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5b83\u9700\u8981\u5b9e\u65f6\u7684\u548c\u6570\u636e\u8868\u8fdb\u884c\u540c\u6b65\u3002</p> </li> </ul> <p>\u8fd9\u6837\u7684\u7ba1\u7406\u5341\u5206\u590d\u6742\uff0c\u56e0\u4e3a\u8981\u4fdd\u8bc1<code>transaction</code>\uff0c\u5982\u679c\u6211\u4eec\u8981\u5728Hudi\u4e2d\u5f15\u7528\u65b0\u7684\u7d22\u5f15\u5f00\u53d1\u5468\u671f\u4f1a\u5f88\u957f\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/index.html#_5","title":"\u8bbe\u8ba1","text":""},{"location":"data_system/data_lake/apache_hudi/index.html#scalable-metadata","title":"\u53ef\u62d3\u5c55\u7684\u5143\u6570\u636e\uff08scalable metadata\uff09","text":"<p>Serverless\uff0c\u4e0d\u9700\u8981\u4efb\u4f55\u7684\u8ba1\u7b97\u6216\u8005\u5185\u5b58\u9700\u8981\uff0c\u72ec\u7acb\u5b58\u5728\uff0c\u4e14\u72ec\u7acb\u4e8e\u8ba1\u7b97\u53ca\u67e5\u8be2\u5f15\u64ce\uff0c\u4e14\u80fd\u9ad8\u6027\u80fd\u5730\u652f\u6301\u4e0d\u540c\u7d22\u5f15\u7c7b\u578b\uff1b</p> <ul> <li> <p>\u5728\u5185\u90e8\u6784\u5efa\u4e00\u4e2a\u5143\u6570\u636e\u8868meta table\uff0c\u4f7f\u7528 Hudi\u7684mor\u8868\u6765\u5b58\u50a8\uff08\u5feb\u901f\u66f4\u65b0\u548c\u5220\u9664\uff09\uff1b</p> </li> <li> <p>Hudi\u8868\u4e5f\u662fServerless\u7684\uff0c\u5b83\u4e0d\u4f1a\u4f9d\u8d56\u4efb\u4f55\u8ba1\u7b97\u53ca\u5185\u5b58\u8d44\u6e90\uff1b</p> </li> <li> <p>\u652f\u6301\u4efb\u610f\u7684\u7d22\u5f15\u5927\u5c0f\uff1b</p> </li> <li> <p>\u9488\u5bf9\u4e0d\u540c\u7684\u7d22\u5f15\u662f\u5efa\u7acb\u72ec\u7acb\u7684\u5206\u533a\uff0c\u4e0d\u540c\u7684index\u53ef\u4ee5\u5b8c\u6210\u72ec\u7acb\u7684\u7ba1\u7406\u4ee5\u53ca\u81ea\u52a8\u5316\u7684\u7ba1\u7406\uff1b</p> </li> <li> <p>\u7d22\u5f15\u7684\u521d\u59cb\u5316</p> </li> <li> <p>\u540c\u6b65\uff1a\u5728\u5199\u5165\u8868\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5728\u6700\u540ecommit\u4e4b\u524d\u4f1a\u505a\u4e00\u4e2aindex\u7684\u6b65\u9aa4\uff1b</p> </li> <li>\u5f02\u6b65\uff1a\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u4fdd\u8bc1<code>concurrent write</code> \u4e0d\u53d7\u5f71\u54cd\uff1b</li> </ul> <p></p>"},{"location":"data_system/data_lake/apache_hudi/index.html#_6","title":"\u4e8b\u52a1\u6027\u4fdd\u8bc1","text":"<p>\u591a\u7ea7\u7d22\u5f15\u4e2d\u7684\u5143\u6570\u636e\u548c\u6570\u636e\u8868\u4fdd\u6301\u5b9e\u65f6\u540c\u6b65\uff0c\u4fdd\u8bc1\u6bcf\u6b21\u7684\u66f4\u65b0\u90fd\u662f\u4e8b\u52a1\u6027\u7684\uff1b</p> <ul> <li>multi table\u591a\u8868\u7684transaction\uff0c\u6709\u81ea\u6211\u7ba1\u7406\u7684\u8868\u670d\u52a1\uff0c\u5305\u62eccompaction, cleaning\uff1b</li> <li>\u4fdd\u8bc1\u5b9a\u65f6\u64cd\u4f5c\uff0c\u4ee5\u4fdd\u8bc1\u8fd9\u4e2ametadata table \u7684\u8bfb\u6027\u80fd\u4f1a\u5f88\u597d\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/index.html#_7","title":"\u67e5\u8be2\u901f\u5ea6\u4fdd\u8bc1","text":"<p>\u4fdd\u8bc1\u5bf9\u4e8e\u591a\u7ea7\u7d22\u5f15\u7684\u67e5\u8be2\u662f\u4f4e\u5ef6\u8fdf\u7684\uff0c\u4e3b\u8981\u7684\u67e5\u8be2\u7c7b\u578b\u5305\u62ec<code>point, range, and prefix lookups</code>\u7b49\u3002</p> <ul> <li>\u4f7f\u7528 <code>HFile</code> \u4f5c\u4e3aMDT\u7684\u6570\u636e\u683c\u5f0f\uff0c\u76f8\u6bd4\u4e8e Parquet/Avro \u66f4\u9002\u7528\u4e8e\u70b9\u67e5\u8be2\uff1b</li> <li>HFile\u683c\u5f0f\u4e2d\u7684index\u4f7f\u5f97 pointed lookup\u975e\u5e38\u9ad8\u6548\uff0c\u5728\u5343\u4e07\uff0810M\uff09+\u6761\u76ee\u4e2d\u67e5\u8be2 N (1-10) \u6761\u76ee\uff0cHFile \u76f8\u6bd4\u4e8e Parquet\u3001Avro \u6709 10-100\u500d\u7684\u63d0\u5347</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/index.html#_8","title":"\u6548\u679c","text":"<p>\u591a\u7ea7\u7d22\u5f15\u6240\u5e26\u6765\u7684\u4e3b\u8981\u7684\u8bfb\u5199\u6027\u80fd\u63d0\u5347</p> <ul> <li>File Listing\uff1a\u4e91\u5b58\u50a8\u4e2d\uff0c\u5927\u578b\u8868\u7684\u4e0a\u5343\u5206\u533a\u4ee5\u53ca\u767e\u4e07\u7ea7\u7684\u6570\u636e\u6587\u4ef6\u505alisting\uff0c\u4f1a\u9020\u6210\u8bfb\u5199\u74f6\u9888\uff1b</li> <li>\u5229\u7528metadata table\u4e2d\u7684files\u6765\u505a\u5206\u533a\uff0c\u5206\u533a\u91cc\u63d0\u4f9b\u4e86\u8fd9\u4e2a\u6570\u636e\u8868\u91cc\u6240\u6709\u7684file\u3002\u76f8\u6bd4\u4e8e\u4e91\u8f6f\u4ef6\u7cfb\u7edf\u67092-20\u500d\u7684\u63d0\u5347\uff1b</li> <li>Data Skipping\uff1a\u9488\u5bf9 query \u6784\u5efa\u5217\u7edf\u8ba1\u7d22\u5f15\uff0c\u9488\u5bf9 upsert \u6784\u5efa bloom filter\uff1b</li> <li>\u5177\u4f53\u5185\u5bb9\u548c\u6548\u679c\u89c1\u4e0b\u4e00\u8282\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/index.html#_9","title":"\u6570\u636e\u8df3\u8fc7\u7d22\u5f15","text":"<p>\u53c2\u8003\uff1aApache Hudi\u6570\u636e\u8df3\u8fc7\u6280\u672f\u52a0\u901f\u67e5\u8be2\u9ad8\u8fbe50\u500d</p> <p>[1] Z-order\u548c\u5e0c\u5c14\u4f2f\u7279\u7a7a\u95f4\u586b\u5145\u66f2\u7ebf: https://hudi.apache.org/blog/2021/12/29/hudi-zorder-and-hilbert-space-filling-curves [2] Extensible Data Skipping :  https://arxiv.org/abs/2009.08150</p>"},{"location":"data_system/data_lake/apache_hudi/index.html#_10","title":"\u80cc\u666f","text":"<p>\u6570\u636e\u8df3\u8fc7\u672c\u8d28\u4e0a\u662f\u5404\u79cd\u7c7b\u578b\u7d22\u5f15\\(^{[2]}\\)\u7684\u901a\u7528\u672f\u8bed\uff0c\u4f7f\u67e5\u8be2\u5f15\u64ce\u80fd\u591f\u6709\u6548\u5730\u8df3\u8fc7\u6570\u636e\uff0c\u8fd9\u4e0e\u5b83\u5f53\u524d\u6267\u884c\u7684\u67e5\u8be2\u65e0\u5173\uff0c\u4ee5\u51cf\u5c11\u626b\u63cf\u548c\u5904\u7406\u7684\u6570\u636e\u91cf\uff0c\u8282\u7701\u626b\u63cf\u7684\u6570\u636e\u91cf\u4ee5\u53ca\uff08 \u6f5c\u5728\u5730\uff09\u663e\u7740\u63d0\u9ad8\u6267\u884c\u65f6\u95f4\u3002</p> <ul> <li>\u4e86\u89e3\u54ea\u4e9b\u6587\u4ef6\u53ef\u80fd\u5305\u542b\u67e5\u8be2\u6b63\u5728\u5bfb\u627e\u7684\u6570\u636e\uff0c\u67e5\u8be2\u5f15\u64ce\u5fc5\u987b\u8bfb\u53d6\u8868\u4e2d\u6bcf\u4e2a Parquet \u6587\u4ef6\u7684 Parquet \u9875\u811a\uff0c\u4f1a\u5f71\u54cd\u6027\u80fd\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/index.html#_11","title":"\u53d1\u5c55\u5386\u53f2","text":""},{"location":"data_system/data_lake/apache_hudi/index.html#hudi-010","title":"Hudi 0.10","text":"<ul> <li>\u5f15\u5165\u5bf9\u9ad8\u7ea7\u6570\u636e\u5e03\u5c40\u4f18\u5316\u6280\u672f\u7684\u652f\u6301\uff0c\u4f8b\u5982 Z-order\u548c\u5e0c\u5c14\u4f2f\u7279\u7a7a\u95f4\u586b\u5145\u66f2\u7ebf\\(^{[1]}\\)\uff08\u4f5c\u4e3a\u65b0\u7684\u805a\u7c7b\u7b97\u6cd5\uff09\uff1b</li> <li>\u5f15\u5165\u7b80\u5355\u7684\u5217\u7edf\u8ba1\u7d22\u5f15\uff08\u5b58\u50a8\u4e3a\u7b80\u5355\u7684 Parquet \u8868\uff09\uff0c\u652f\u6301 Hudi \u4e2d\u6570\u636e\u8df3\u8fc7\u5b9e\u73b0\uff0c\u5c55\u793a Z-order \u548c Hilbert \u7684\u5f3a\u5927\u529f\u80fd\u7a7a\u95f4\u586b\u5145\u66f2\u7ebf\u4f5c\u4e3a\u9ad8\u7ea7\u5e03\u5c40\u4f18\u5316\u6280\u672f\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/index.html#hudi-011","title":"Hudi 0.11","text":"<p>Hudi 0.11 \u4e2d\uff0c\u5728\u5143\u6570\u636e\u8868\u4e2d\u5f15\u5165\u591a\u6a21\u7d22\u5f15\\(^{[3]}\\)\uff0c\u4f8b\u5982\u5e03\u9686\u8fc7\u6ee4\u5668\u7d22\u5f15\u548c\u5217\u7edf\u8ba1\u7d22\u5f15\uff0c\u4f5c\u4e3a\u5143\u6570\u636e\u8868\u4e2d\u7684\u4e13\u7528\u5206\u533a\uff08\u5206\u522b\u4e3a\u201ccolumn_stats\u201d\u548c\u201cbloom_filters\u201d\uff09\uff1a</p> <ul> <li>\u5217\u7edf\u8ba1\u7d22\u5f15 (CSI) \u4eab\u6709\u5143\u6570\u636e\u8868\u7684\u4e00\u81f4\u6027\u4fdd\u8bc1\uff1b</li> <li>\u5143\u6570\u636e\u8868\u4f7f\u7528 HBase\u7684HFile\u4f5c\u4e3a\u57fa\u7840\u6587\u4ef6\u548c\u65e5\u5fd7\u6587\u4ef6\u683c\u5f0f\uff0c\u4fc3\u8fdb\u57fa\u4e8e\u952e\u7684\u5feb\u901f\u67e5\u627e\uff08\u6392\u5e8f\u952e\u503c\u5b58\u50a8\uff09\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/index.html#_12","title":"\u4e0b\u4e00\u6b65","text":"<p>HUDI-1822\uff08TODO\uff1a\u8fdb\u4e00\u6b65\u5206\u6790\uff09</p> <ul> <li>\u652f\u6301 Merge-On-Read \u8868\u4e2d\u7684\u6570\u636e\u8df3\u8fc7</li> <li>\u4e3a\u5217\u7edf\u8ba1\u7d22\u5f15\u67e5\u8be2\u6dfb\u52a0\u7f13\u5b58</li> <li>\u8fdb\u4e00\u6b65\u5206\u6790\u548c\u4f18\u5316\u5217\u7edf\u8ba1\u7d22\u5f15\u6027\u80fd</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/index.html#_13","title":"\u8bbe\u8ba1","text":"<p>RFC-27</p> <p>\u901a\u8fc7\u5217\u7edf\u8ba1\u6570\u636e\u6765\u6392\u9664\u6389\u4e0d\u9700\u8981\u8bfb\u7684\u6587\u4ef6\uff1a</p> <ul> <li>\u5e38\u89c1\u7684\u5217\u7edf\u8ba1\u6570\u636e\u5305\u62ec\u53d6\u6700\u5927\u503c\u3001\u6700\u5c0f\u503c\u3001\u6570\u91cf\u3001\u5927\u5c0f\u7b49\uff1b</li> <li>\uff08\u9488\u5bf9query\uff09<code>multi model index</code>\u7684metadata \u4e2d\u6784\u5efa<code>column_stats</code>\u5206\u533a\uff1b</li> <li>\u5206\u533a\u91cc\u7684\u6bcf\u6761\u8bb0\u5f55\u5305\u542b\u8fd9\u4e2aHudi\u8868\u91cc\u6240\u5bf9\u5e94\u6587\u4ef6\u7684\u5217\u7edf\u8ba1\u6570\u636e\uff1b</li> <li>\u6bcf\u4e2aRecord key\u662f\u7531\u5217\u540d\u79f0\u3001\u5206\u533a\u540d\u79f0\u548c\u6587\u4ef6\u540d\u79f0\u7ec4\u6210\uff0c\u53ef\u4ee5\u5feb\u901f\u5b9a\u4f4d\u6240\u9700\u7edf\u8ba1\u4fe1\u606f\uff1b</li> <li>\u67e5\u8be2\u590d\u6742\u5ea6\u662f\u57fa\u4e8e\u67e5\u8be2\u5217\u6240\u9700\u8981\u7684\u5217\u7684\u6570\u91cf\uff0c\u901a\u5e38\u8fd9\u4e2a\u6570\u91cf\u662f5\u523010\u4e2a\uff1b</li> <li>\uff08\u9488\u5bf9upsert\uff09metadata table\u4e2d\u5f15\u5165\u4e00\u4e2abloom_filter \u5206\u533a\uff0c\u53d6\u4ee3parquet file \u4e2d footer \u4e2d\u7684 bloom filter</li> <li>\u6bcf\u6761\u8bb0\u5f55\u5305\u542b\u5355\u4e2a\u6570\u636e\u6587\u4ef6\uff08partition + file name\uff09\u7684 bloom filter\uff0c\u652f\u6301 prefix lookup\uff1b</li> <li>\u5b9e\u6d4b\uff0c\u5728\u6709 100k \u6587\u4ef6\u7684 Hudi \u8868\u4e2d\uff0c\u76f8\u6bd4\u4e8e\u8bfb\u53d6 footer\uff0c\u4ece MDT \u8bfb\u53d6 bloom filter\u7684\u901f\u5ea6\u67093\u500d\u7684\u63d0\u5347</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/index.html#_14","title":"\u914d\u7f6e","text":"<p>\u6444\u53d6\u671f\u95f4\u540c\u6b65\u6784\u5efa\u5217\u7edf\u8ba1\u7d22\u5f15\uff1a</p> <ul> <li><code>hoodie.metadata.index.column.state.enbale=true</code></li> </ul> <p>\u5f02\u6b65\u7d22\u5f15\u5668\u529f\u80fd\u56de\u586b\u73b0\u6709\u8868\u7684\u7d22\u5f15</p> <p>\u67e5\u770b\u6570\u636e\u8df3\u8fc7\u64cd\u4f5c\uff1a\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5143\u6570\u636e\u8868\u4ec5\u5728\u5199\u5165\u7aef\u542f\u7528\uff0c\u9700\u8981\u4ee5\u4e0b\u914d\u7f6e</p> <ul> <li><code>hoodie.metadata.enable=true</code>\uff1a\u786e\u4fdd\u5728\u8bfb\u53d6\u8def\u5f84\u4e0a\u542f\u7528\u4e86\u5143\u6570\u636e\u8868</li> <li><code>hoodie.enable.data.skipping=true</code>\uff1a\u6570\u636e\u8df3\u8fc7\u529f\u80fd\u5df2\u542f\u7528</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/index.html#futuredata-skip-index","title":"Future\uff08Data skip index\uff09","text":"<ul> <li>RFC-27 \uff1a\u5728\u5143\u6570\u636e\u8868\u4e0a\u6dfb\u52a0\u989d\u5916\u7684\u7d22\u5f15\u5f62\u5f0f\uff0c\u4f5c\u4e3a\u65b0\u5206\u533a\uff0c\u6dfb\u52a0\u7d22\u5f15\u5217\u8303\u56f4\uff0c\u5b83\u53ef\u4ee5\u6269\u5c55\u5230\u8bb8\u591a\u5c0f\u6587\u4ef6\uff0c\u5e76\u652f\u6301\u66f4\u5feb\u7684\u66f4\u6539\u3002</li> <li>RFC-8\uff1aRecord level indexing mechanisms for Hudi datasets</li> <li>point-lookup-ish queries </li> </ul>"},{"location":"data_system/data_lake/apache_hudi/bulk_insert.html","title":"\u6279\u91cf\u63d2\u5165","text":""},{"location":"data_system/data_lake/apache_hudi/bulk_insert.html#_2","title":"\u539f\u7406","text":"<p><code>bulk_insert</code>\u6309\u7167\u4ee5\u4e0b\u539f\u5219\u63d0\u4f9b\u4e863\u79cd\u6a21\u5f0f\u6765\u6ee1\u8db3\u4e0d\u540c\u7684\u9700\u6c42\uff1a</p> <ul> <li>\u5982\u679c\u6570\u636e\u5e03\u5c40\u826f\u597d\uff0c\u6392\u5e8f\u5c06\u4e3a\u6211\u4eec\u63d0\u4f9b\u826f\u597d\u7684\u538b\u7f29\u548c<code>upsert</code>\u6027\u80fd\u3002\u7279\u522b\u662f\u8bb0\u5f55\u952e\u5177\u6709\u67d0\u79cd\u6392\u5e8f\uff08\u65f6\u95f4\u6233\u7b49\uff09\u7279\u5f81\uff0c\u5219\u6392\u5e8f\u5c06\u6709\u52a9\u4e8e\u5728upsert\u671f\u95f4\u88c1\u526a\u5927\u91cf\u6587\u4ef6\uff0c\u5982\u679c\u6570\u636e\u662f\u6309\u9891\u7e41\u67e5\u8be2\u7684\u5217\u6392\u5e8f\u7684\uff0c\u90a3\u4e48\u67e5\u8be2\u5c06\u5229\u7528parquet\u8c13\u8bcd\u4e0b\u63a8\u6765\u88c1\u526a\u6570\u636e\uff0c\u4ee5\u786e\u4fdd\u66f4\u4f4e\u7684\u67e5\u8be2\u5ef6\u8fdf\u3002</li> <li>\u5199parquet\u6587\u4ef6\u662f\u5185\u5b58\u5bc6\u96c6\u578b\u64cd\u4f5c\u3002\u5f53\u5c06\u5927\u91cf\u6570\u636e\u5199\u5165\u4e00\u4e2a\u4e5f\u88ab\u5212\u5206\u4e3a1000\u4e2a\u5206\u533a\u7684\u8868\u4e2d\u65f6\uff0c\u5982\u679c\u4e0d\u8fdb\u884c\u4efb\u4f55\u6392\u5e8f\uff0c\u5199\u5165\u7a0b\u5e8f\u53ef\u80fd\u5fc5\u987b\u4fdd\u63011000\u4e2aparquet\u5199\u5165\u5668\u5904\u4e8e\u6253\u5f00\u72b6\u6001\uff0c\u540c\u65f6\u4f1a\u4ea7\u751f\u4e0d\u53ef\u6301\u7eed\u7684\u5185\u5b58\u538b\u529b\uff0c\u5e76\u6700\u7ec8\u5bfc\u81f4\u5d29\u6e83\u3002</li> <li>\u5728\u6279\u91cf\u5bfc\u5165\u6570\u636e\u65f6\uff0c\u6700\u597d\u63a7\u5236\u597d\u5c11\u7684\u6587\u4ef6\u4e2a\u6570\uff0c\u4ee5\u907f\u514d\u4ee5\u540e\u540e\u7eed\u5199\u5165\u548c\u67e5\u8be2\u65f6\u7684\u5143\u6570\u636e\u5f00\u9500\u3002</li> </ul> <p>3\u79cd\u5f00\u7bb1\u5373\u7528\u7684\u6a21\u5f0f\u4e3a\uff1a<code>PARTITION_SORT</code>\u3001<code>GLOBAL_SORT</code>\u3001<code>NONE</code></p>"},{"location":"data_system/data_lake/apache_hudi/bulk_insert.html#_3","title":"\u6a21\u5f0f","text":""},{"location":"data_system/data_lake/apache_hudi/bulk_insert.html#global_sort","title":"GLOBAL_SORT\uff08\u5168\u5c40\u6392\u5e8f\uff09","text":"<p>\u9ed8\u8ba4\u6a21\u5f0f\u3002</p> <p>Hudi\u5728\u8f93\u5165\u5206\u533a\u4e2d\u5bf9\u8bb0\u5f55\u8fdb\u884c\u5168\u5c40\u6392\u5e8f\uff0c\u4ece\u800c\u5728\u7d22\u5f15\u67e5\u627e\u8fc7\u7a0b\u4e2d\u6700\u5927\u5316\u4f7f\u7528\u952e\u8303\u56f4\u4fee\u526a\u7684\u6587\u4ef6\u6570\u91cf\uff0c\u4ee5\u4fbf\u63d0\u5347<code>upsert</code>\u6027\u80fd\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/bulk_insert.html#partition_sort","title":"PARTITION_SORT\uff08\u5206\u533a\u6392\u5e8f\uff09","text":"<p>\u5bf9\u7ed9\u5b9aspark\u5206\u533a\u5185\u7684\u8bb0\u5f55\u8fdb\u884c\u6392\u5e8f\uff1a</p> <ul> <li>\u4f46\u662f\u7ed9\u5b9a\u7684spark\u5206\u533a\u53ef\u80fd\u5305\u542b\u6765\u81ea\u4e0d\u540c\u8868\u5206\u533a\u7684\u8bb0\u5f55\uff0c\u56e0\u6b64\u5373\u4f7f\u6211\u4eec\u5728\u6bcf\u4e2aspark\u5206\u533a\u5185\u8fdb\u884c\u6392\u5e8f\uff0c\u4e5f\u53ef\u80fd\u4f1a\u5728\u4ea7\u751f\u5927\u91cf\u6587\u4ef6\uff0c\u56e0\u4e3a\u7ed9\u5b9a\u8868\u5206\u533a\u7684\u8bb0\u5f55\u53ef\u80fd\u4f1a\u5206\u5e03\u5728\u8bb8\u591aspark\u5206\u533a\u4e2d\uff1b</li> <li>\u5199\u5165\u65f6\u53ef\u80fd\u4e0d\u4f1a\u540c\u65f6\u6253\u5f00\u592a\u591a\u6587\u4ef6\uff0c\u56e0\u4e3a\u6211\u4eec\u5728\u79fb\u52a8\u5230\u4e0b\u4e00\u4e2a\u6587\u4ef6\u4e4b\u524d\u5173\u95ed\u4e86\u8be5\u6587\u4ef6\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/bulk_insert.html#none","title":"NONE","text":"<p>\u4e0d\u4f1a\u5bf9\u7528\u6237\u8bb0\u5f55\u8fdb\u884c\u4efb\u4f55\u8f6c\u6362\uff08\u5982\u6392\u5e8f\uff09\uff0c\u5c06\u6570\u636e\u539f\u6837\u59d4\u6258\u7ed9\u5199\u5165\u5668\u3002</p> <ul> <li>\u8f83\u5927\u7684\u5185\u5b58\u5f00\u9500\uff1a\u5c06\u5927\u91cf\u6570\u636e\u5199\u5165\u5206\u533a\u4e3a1000\u4e2a\u5206\u533a\u7684\u8868\u4e2d\u65f6\uff0c\u5199\u5165\u7a0b\u5e8f\u53ef\u80fd\u5fc5\u987b\u4fdd\u63011000\u4e2aparquet\u5199\u5165\u7a0b\u5e8f\u5904\u4e8e\u6253\u5f00\u72b6\u6001\uff1b</li> <li>\u7ed9\u5b9a\u6587\u4ef6\u7684\u6700\u5c0f-\u6700\u5927\u8303\u56f4\u53ef\u80fd\u975e\u5e38\u5bbd\uff08\u672a\u6392\u5e8f\u7684\u8bb0\u5f55\uff09\uff0c\u56e0\u6b64\u540e\u7eed\u7684<code>upsert</code>\u4f1a\u5728\u7d22\u5f15\u67e5\u627e\u671f\u95f4\u4ece\u5927\u91cf\u6587\u4ef6\u4e2d\u8bfb\u53d6bloom filter\uff08\u5e03\u9686\u8fc7\u6ee4\u5668\uff09\uff1b</li> <li>\u8bb0\u5f55\u6ca1\u6709\u6392\u5e8f\uff0c\u5e76\u4e14\u6bcf\u4e2a\u5199\u5165\u5668\u53ef\u4ee5\u8de8N\u4e2a\u8868\u5206\u533a\u83b7\u53d6\u8bb0\u5f55\uff0c\u56e0\u6b64\u8fd9\u79cd\u6a21\u5f0f\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5728<code>bulk_insert</code>\u7ed3\u675f\u65f6\u4ea7\u751f\u5927\u91cf\u6587\u4ef6\u3002\u7531\u4e8e\u6709\u5927\u91cf\u7684\u5c0f\u6587\u4ef6\uff0c\u8fd9\u4e5f\u53ef\u80fd\u4f1a\u5f71\u54cd<code>upsert</code>\u6216\u67e5\u8be2\u6027\u80fd\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/bulk_insert.html#_4","title":"\u914d\u7f6e","text":"<ul> <li> <p><code>hoodie.bulkinsert.sort.mode</code>\uff1a\u6392\u5e8f\u6a21\u5f0f\uff0c<code>NONE</code>, <code>GLOBAL_SORT</code>\uff08\u9ed8\u8ba4\uff09 , <code>PARTITION_SORT</code></p> </li> <li> <p><code>hoodie.bulkinsert.user.defined.partitioner.sort.columns</code>\uff1a\u6392\u5e8f\u7684\u5217\uff0c\u9017\u53f7\u5206\u9694\u591a\u5217\uff1b</p> </li> </ul>"},{"location":"data_system/data_lake/apache_hudi/bulk_insert.html#_5","title":"\u6027\u80fd\u6d4b\u8bd5","text":"<p>\u4e0d\u540c\u6a21\u5f0f\u4e0b\u7b80\u5355benchmark\u6027\u80fd\u5dee\u5f02\u5982\u4e0b</p> <p></p> <p>\u8bf4\u660e\uff1a\u8be5\u57fa\u51c6\u6d4b\u8bd5\u4f7f\u7528\u4e0d\u540c\u7684\u6392\u5e8f\u6a21\u5f0f\u5c061000\u4e07\u6761\u8bb0\u5f55\u6279\u91cf\u63d2\u5165hudi\uff0c\u7136\u540e<code>upsert</code>100W\u4e2a\u6761\u8bb0\u5f55\uff08\u539f\u59cb\u6570\u636e\u96c6\u5927\u5c0f\u768410%\uff09\u3002</p> <ul> <li><code>NONE</code>\u6a21\u5f0f\u5bf9\u6279\u91cf\u5bfc\u5165\u6027\u80fd\u6700\u4f73\uff0c\u56e0\u4e3a\u5b83\u4e0d\u6d89\u53ca\u4efb\u4f55\u6392\u5e8f\uff1b</li> <li>\u4e0e<code>NONE</code>\u6a21\u5f0f\u76f8\u6bd4\uff0c<code>GLOBAL_SORT</code>\u76f8\u6bd4<code>NONE</code>\u6a21\u5f0f\u5f00\u9500\u7ea6\u4e3a15%\uff1b</li> <li><code>PARTITION_SORT</code>\u76f8\u6bd4<code>NONE</code>\u6a21\u5f0f\u5f00\u9500\u7ea6\u4e3a4%\uff0c\u56e0\u4e3a\u4e5f\u6d89\u53ca\u5230\u5bf9\u8bb0\u5f55\u7684\u6392\u5e8f\u64cd\u4f5c\uff1b</li> <li>\u540e\u9762\u7684<code>upsert</code>\u6027\u80fd\uff1a<code>GLOBAL_SORT</code>\u76f8\u6bd4<code>NONE</code> upsert\u6027\u80fd\u9ad840%\u3002<code>PARTITION_SORT</code>\u76f8\u6bd4<code>NONE</code>\u6a21\u5f0f\u6709\u7ea65%\u7684\u6539\u8fdb\uff0c\u8fd9\u662f\u7531\u4e8e\u5927\u91cf\u5c0f\u6587\u4ef6\u5f00\u9500\u5bfc\u81f4\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/catalog.html","title":"Catalog","text":""},{"location":"data_system/data_lake/apache_hudi/catalog.html#spark-hudi-catalog","title":"Spark Hudi Catalog","text":"<p>Spark \u4f7f\u7528 Hudi \u65f6\uff0c\u9700\u8981\u914d\u7f6e</p> <ul> <li><code>spark.sql.catalog.spark_catalog=org.apache.spark.sql.hudi.catalog.HoodieCatalog</code></li> </ul>"},{"location":"data_system/data_lake/apache_hudi/catalog.html#flink-using-hudi-catalog","title":"Flink using Hudi Catalog","text":""},{"location":"data_system/data_lake/apache_hudi/catalog.html#create-catalog","title":"Create Catalog","text":"<p>\u7528\u4e8e\u7ba1\u7406 SQL \u8868\uff0c\u5728\u591a\u4e2a Session\u4e2d\u5171\u4eab\u3002</p> <ul> <li>For <code>hms</code> mode, the catalog also supplements the hive syncing options.</li> </ul> <p>Example</p> <pre><code>CREATE CATALOG hoodie_catalog\n  WITH (\n    'type'='hudi',\n    'catalog.path' = '${catalog default root path}',\n    'hive.conf.dir' = '${directory where hive-site.xml is located}',\n    'mode'='hms' -- supports 'dfs' mode that uses the DFS backend for table DDLs persistence\n  );\n\n--- \u521b\u5efa\u6570\u636e\u5e93\u4f9bhudi\u4f7f\u7528\ncreate database hudi.hudidb;\n\n--- order\u8868\nCREATE TABLE hudi.hudidb.orders_hudi(\n  uuid INT,\n  ts INT,\n  num INT,\n  PRIMARY KEY(uuid) NOT ENFORCED\n) WITH (\n  'connector' = 'hudi',\n  'table.type' = 'MERGE_ON_READ'\n);\n\nselect * from hudi.hudidb.orders_hudi;\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/catalog.html#sync-to-catalogs","title":"Sync to Catalogs","text":""},{"location":"data_system/data_lake/apache_hudi/catalog.html#hive-metastore","title":"Hive MetaStore","text":"<p>Hudi \u652f\u6301\u5c06\u8868\u4fe1\u606f\u540c\u6b65\u7ed9 Catalog\uff0c\u5982 Hive MetaStore\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/clean.html","title":"\u6e05\u7406","text":"<p>\u6e05\u7406\u4f1a\u5728\u6bcf\u6b21\u5199\u64cd\u4f5c\u4e4b\u540e\u81ea\u52a8\u6267\u884c\uff0c\u5e76\u5229\u7528\u65f6\u95f4\u8f74\u670d\u52a1\u5668\u4e0a\u7f13\u5b58\u7684\u65f6\u95f4\u8f74\u5143\u6570\u636e\u6765\u907f\u514d\u626b\u63cf\u6574\u4e2a\u8868\u6765\u8bc4\u4f30\u6e05\u7406\u65f6\u673a\u3002</p> <p>\u5728\u6570\u636e\u6e56\u67b6\u6784\u4e2d\uff0c\u8bfb\u53d6\u7aef\u548c\u5199\u5165\u7aef\u540c\u65f6\u8bbf\u95ee\u540c\u4e00\u5f20\u8868\u662f\u975e\u5e38\u5e38\u89c1\u7684\u573a\u666f\u3002\u7531\u4e8e Hudi \u6e05\u7406\u670d\u52a1\u4f1a\u5b9a\u671f\u56de\u6536\u8f83\u65e7\u7684\u6587\u4ef6\u7248\u672c\uff0c\u56e0\u6b64\u53ef\u80fd\u4f1a\u51fa\u73b0\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u67e5\u8be2\u8bbf\u95ee\u5230\u88ab\u6e05\u7406\u670d\u52a1\u56de\u6536\u7684\u6587\u4ef6\u7248\u672c\u7684\u60c5\u51b5\uff0c\u56e0\u6b64\u9700\u8981\u4f7f\u7528\u6b63\u786e\u7684\u914d\u7f6e\u6765\u786e\u4fdd\u67e5\u8be2\u4e0d\u4f1a\u5931\u8d25\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/clean.html#_2","title":"\u7b56\u7565","text":"<p>\u652f\u6301\u4e24\u79cd\u65b9\u5f0f\u7684\u6e05\u7406\uff1a</p> <p>1\uff09KEEP_LATEST_COMMITS\uff1a\u6309 <code>commits / deltacommits</code>\u6e05\u7406\uff1a\u8fd9\u662f\u589e\u91cf\u67e5\u8be2\u4e2d\u6700\u5e38\u89c1\u4e14\u5fc5\u987b\u4f7f\u7528\u7684\u6a21\u5f0f\uff1b</p> <ul> <li>\u4fdd\u7559\u6700\u8fd1N\u6b21commit/delta commit\u63d0\u4ea4\u4e2d\u5199\u5165\u7684\u6240\u6709\u6587\u4ef6\u5207\u7247\uff0c\u4ece\u800c\u6709\u6548\u63d0\u4f9b\u5728\u4efb\u4f55\u5373\u65f6\u8303\u56f4\u5185\u8fdb\u884c\u589e\u91cf\u67e5\u8be2\u7684\u80fd\u529b\uff1b</li> <li>\u6700\u597d\u786e\u4fdd\u6570\u636e\u4fdd\u7559\u7684\u65f6\u95f4\u8d85\u8fc7\u6700\u5927\u67e5\u8be2\u6267\u884c\u65f6\u95f4\uff1b</li> <li>\u5728\u67d0\u4e9b\u9ad8\u5199\u5165\u8d1f\u8f7d\u7684\u573a\u666f\u4e0b\u53ef\u80fd\u9700\u8981\u66f4\u5927\u7684\u5b58\u50a8\u7a7a\u95f4\uff1b</li> </ul> <p>\u4ee5\u4e0b\u662f\u914d\u7f6e\u4fdd\u7559\u6700\u8fd13\u4e2acommit\u7684\u6267\u884c\u793a\u610f\u56fe\uff1a</p> <p></p> <p>2\uff09KEEP_LATEST_FILE_VERSIONS\uff1a\u6309\u4fdd\u7559\u7684\u6587\u4ef6\u7247\u6e05\u7406\uff1a\u8fd9\u662f\u4e00\u79cd\u66f4\u4e3a\u7b80\u5355\u7684\u6e05\u7406\u65b9\u5f0f\uff0c\u8fd9\u91cc\u6211\u4eec\u4ec5\u4fdd\u5b58\u6bcf\u4e2a\u6587\u4ef6\u7ec4\u4e2d\u7684\u6700\u540eN\u4e2a\u6587\u4ef6\u7247\uff1b</p> <ul> <li>\u4fdd\u5b58\u6bcf\u4e2a\u6587\u4ef6\u7ec4\u4e2d\u7684\u6700\u540eN\u4e2a\u6587\u4ef6\u7247\uff1b</li> <li>\u5bf9\u4e8eHive\u9700\u8981\u51e0\u5c0f\u65f6\u624d\u80fd\u5b8c\u6210\u7684\u67e5\u8be2\u573a\u666f\uff0c\u5c06N\u8bbe\u7f6e\u4e3a\u8db3\u591f\u5927\u4ee5\u81f3\u4e8e\u4e0d\u4f1a\u5220\u9664\u67e5\u8be2\u4ecd\u7136\u53ef\u4ee5\u8bbf\u95ee\u7684\u6587\u4ef6\u7247\u662f\u5f88\u6709\u7528\u7684\u3002</li> </ul> <p>\u4ee5\u4e0b\u662f\u914d\u7f6e\u4fdd\u75591\u4e2a\u6587\u4ef6\u7248\u672c\u7684\u793a\u610f\u56fe\uff1a</p> <p></p>"},{"location":"data_system/data_lake/apache_hudi/clean.html#_3","title":"\u914d\u7f6e","text":"<ul> <li><code>hoodie.clean.automatic</code>\uff1a\u662f\u5426\u542f\u52a8\u6e05\u7406\u670d\u52a1\uff0c\u9ed8\u8ba4true\u3002</li> <li><code>hoodie.clean.async</code>\uff1a\u662f\u5426\u5f02\u6b65\u6267\u884c\u6e05\u7406\u670d\u52a1\uff0c\u9ed8\u8ba4false\uff0c\u5fc5\u987b\u5148\u914d\u7f6e\u542f\u52a8\u6e05\u7406\u670d\u52a1\u3002\u5f02\u6b65\u6e05\u7406\uff0c\u4f1a\u63d0\u5347\u5199\u5165\u7684\u6027\u80fd\u3002</li> <li><code>hoodie.cleaner.policy</code>\uff1a\u6e05\u7406\u7b56\u7565\uff0c\u9ed8\u8ba4<code>KEEP_LATEST_COMMITS</code>\uff0c\u53ef\u9009<code>KEEP_LATEST_FILE_VERSIONS</code>\uff1b</li> <li><code>hoodie.cleaner.commits.retained</code>\uff1a</li> <li><code>hoodie.cleaner.fileversions.retained</code>\uff1a\u9ed8\u8ba43\uff0c\u6e05\u7406\u65f6\uff0c\u6bcf\u4e2afile group\u4fdd\u7559\u7684\u6700\u5c0f\u7684\u6587\u4ef6\u4e2a\u6570\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/clean.html#_4","title":"\u8fd0\u884c","text":""},{"location":"data_system/data_lake/apache_hudi/clean.html#_5","title":"\u540c\u6b65(\u9ed8\u8ba4)","text":"<pre><code>hoodie.clean.automatic=true\nhoodie.clean.async=false\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/clean.html#_6","title":"\u5f02\u6b65","text":"<pre><code>hoodie.clean.automatic=true\nhoodie.clean.async=true\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/clean.html#spark","title":"Spark\u72ec\u7acb\u8fd0\u884c","text":"<pre><code>$ spark-submit --class org.apache.hudi.utilities.HoodieCleaner \\\n  --props s3:///temp/hudi-ingestion-config/config.properties \\\n  --target-base-path s3:///temp/hudi \\\n  --spark-master yarn-cluster\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/clustering.html","title":"Clustering\uff08\u6587\u4ef6\u5408\u5e76\uff09","text":""},{"location":"data_system/data_lake/apache_hudi/clustering.html#_1","title":"\u80cc\u666f","text":"<p>\u6570\u636e\u6444\u53d6\u901a\u5e38\u503e\u5411\u4e8e\u5c0f\u6587\u4ef6\uff0c\u4ee5\u63d0\u9ad8\u5e76\u884c\u6027\uff0c\u5e76\u4f7f\u6570\u636e\u80fd\u591f\u5c3d\u5feb\u7528\u4e8e\u67e5\u8be2\u3002\u4f46\u662f\uff0c\u5982\u679c\u6709\u5f88\u591a\u5c0f\u6587\u4ef6\uff0c\u67e5\u8be2\u6027\u80fd\u5c31\u4f1a\u4e0b\u964d\u3002</p> <p>\u5728\u6444\u5165\u671f\u95f4\uff0c\u6570\u636e\u901a\u5e38\u6839\u636e\u5230\u8fbe\u65f6\u95f4\u5728\u540c\u4e00\u4f4d\u7f6e\u3002\u4f46\u662f\uff0c\u5f53\u9891\u7e41\u67e5\u8be2\u7684\u6570\u636e\u653e\u5728\u4e00\u8d77\u65f6\uff0c\u67e5\u8be2\u5f15\u64ce\u7684\u6027\u80fd\u4f1a\u66f4\u597d\u3002</p> <p>\u4e3a\u4e86\u80fd\u591f\u5728\u6587\u4ef6\u5927\u5c0f\u548c\u6444\u53d6\u901f\u5ea6\u4e4b\u95f4\u8fdb\u884c\u6743\u8861\uff0cHudi \u63d0\u4f9b<code>hoodie.parquet.small.file.limit</code>\u6765\u914d\u7f6e\u5141\u8bb8\u7684\u6700\u5c0f\u6587\u4ef6\u5927\u5c0f\u3002\u7528\u6237\u53ef\u4ee5\u5c06\u5c0f\u6587\u4ef6\u8f6f\u9650\u5236\u914d\u7f6e\u4e3a<code>0</code>\u5f3a\u5236\u65b0\u6570\u636e\u8fdb\u5165\u4e00\u7ec4\u65b0\u6587\u4ef6\u7ec4\u6216\u5c06\u5176\u8bbe\u7f6e\u4e3a\u66f4\u9ad8\u7684\u503c\u4ee5\u786e\u4fdd\u65b0\u6570\u636e\u201c\u586b\u5145\u201d\u5230\u73b0\u6709\u6587\u4ef6\u4e2d\uff0c\u76f4\u5230\u6ee1\u8db3\u589e\u52a0\u6444\u53d6\u7684\u9650\u5236\u5ef6\u8fdf\u3002</p> <p>\u79f0\u4e3a\u96c6\u7fa4\u7684\u65b0\u578b\u8868\u670d\u52a1[RFC-19]\u91cd\u65b0\u7ec4\u7ec7\u6570\u636e\u4ee5\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\u800c\u4e0d\u5f71\u54cd\u6444\u53d6\u901f\u5ea6\u3002</p> <p>Clustering Service \u5efa\u7acb\u5728 Hudi \u57fa\u4e8e MVCC \u7684\u8bbe\u8ba1\u4e4b\u4e0a\uff0c\u5141\u8bb8 writers \u7ee7\u7eed\u63d2\u5165\u65b0\u6570\u636e\uff0c\u800c clustering action \u5728\u540e\u53f0\u8fd0\u884c\u4ee5\u91cd\u65b0\u683c\u5f0f\u5316\u6570\u636e\u5e03\u5c40\uff0c\u786e\u4fdd\u5e76\u53d1\u8bfb\u53d6\u5668\u548c\u5199\u5165\u5668\u4e4b\u95f4\u7684\u5feb\u7167\u9694\u79bb\u3002</p> <p>\u6ce8\u610f\uff1a\u53ea\u80fd\u4e3a\u672a\u63a5\u6536\u4efb\u4f55\u5e76\u53d1\u66f4\u65b0\u7684\u8868/\u5206\u533a\u6267\u884cClustering\u670d\u52a1\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#_2","title":"\u539f\u7406","text":"<p>\u201cClustering\u201d\u670d\u52a1\u6765\u91cd\u5199\u6570\u636e\u4ee5\u4f18\u5316 Hudi \u6570\u636e\u6e56\u6587\u4ef6\u5e03\u5c40\u3002</p> <p>\u805a\u7c7b\u8868\u670d\u52a1\u53ef\u4ee5\u5f02\u6b65\u6216\u540c\u6b65\u8fd0\u884c\uff0c\u6dfb\u52a0\u4e00\u4e2a\u540d\u4e3a\u201cREPLACE\u201d\u7684\u65b0\u52a8\u4f5c\u7c7b\u578b\uff0c\u5b83\u5c06\u5728 Hudi \u5143\u6570\u636e\u65f6\u95f4\u7ebf\u4e2d\u6807\u8bb0\u805a\u7c7b\u52a8\u4f5c\u3002</p> <p>Clustering\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff1a</p> <ul> <li> <p>\u8c03\u5ea6Clustering\uff1a\u4f7f\u7528\u53ef\u63d2\u62d4\u7684Clustering\u7b56\u7565\u521b\u5efaClustering\u8ba1\u5212\u3002</p> </li> <li> <p>\u6267\u884cClustering\uff1a\u4f7f\u7528\u6267\u884c\u7b56\u7565\u5904\u7406\u8ba1\u5212\u4ee5\u521b\u5efa\u65b0\u6587\u4ef6\u5e76\u66ff\u6362\u65e7\u6587\u4ef6\u3002</p> </li> </ul>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#scheduling-clustering","title":"Scheduling clustering","text":"<ol> <li>\u8bc6\u522b\u9002\u5408\u96c6\u7fa4\u7684\u6587\u4ef6\uff1a\u6839\u636e\u9009\u62e9\u7684\u96c6\u7fa4\u7b56\u7565\uff0c\u8c03\u5ea6\u903b\u8f91\u5c06\u8bc6\u522b\u9002\u5408\u96c6\u7fa4\u7684\u6587\u4ef6\u3002</li> <li>\u6839\u636e\u7279\u5b9a\u6761\u4ef6\u5bf9\u7b26\u5408\u805a\u7c7b\u6761\u4ef6\u7684\u6587\u4ef6\u8fdb\u884c\u5206\u7ec4\uff1a</li> <li>\u6bcf\u4e2a\u7ec4\u7684\u6570\u636e\u5927\u5c0f\u5e94\u4e3a<code>targetFileSize</code>\u7684\u500d\u6570\u3002\u5206\u7ec4\u662f\u4f5c\u4e3a\u8ba1\u5212\u4e2d\u5b9a\u4e49\u7684\u201c\u7b56\u7565\u201d\u7684\u4e00\u90e8\u5206\u5b8c\u6210\u7684\u3002\uff1b</li> <li>\u8fd8\u6709\u4e00\u4e2a\u9009\u9879\u53ef\u4ee5\u8bbe\u7f6e\u7ec4\u5927\u5c0f\u4e0a\u9650\uff0c\u4ee5\u63d0\u9ad8\u5e76\u884c\u6027\u5e76\u907f\u514d\u6df7\u6d17\u5927\u91cf\u6570\u636e\u3002</li> <li>\u6700\u540e\uff0c\u805a\u7c7b\u8ba1\u5212\u4ee5 avro\u5143\u6570\u636e\u683c\u5f0f\u4fdd\u5b58\u5230\u65f6\u95f4\u7ebf\u3002</li> </ol>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#running-clustering","title":"Running clustering","text":"<ol> <li>\u8bfb\u53d6clustering plan\u5e76\u83b7\u53d6\u9700\u8981clustering\u7684\u6587\u4ef6\u7ec4<code>clusteringGroups</code>\uff1b</li> <li>\u5bf9\u6bcf\u4e2a\u7ec4\uff0c\u5b9e\u4f8b\u5316\u5408\u9002\u7684\u7b56\u7565\u7c7b\uff0c\u5e76\u5e94\u7528\u5230\u6570\u636e\u4e0a\uff1b</li> <li>\u521b\u5efa<code>replace</code>commit\uff0c\u5e76\u66f4\u65b0hudi\u7684\u5143\u6570\u636e\u3002</li> </ol>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#clustering_1","title":"Clustering\u7b56\u7565","text":"<p>clustering\u8ba1\u5212\u548c\u6267\u884c\uff0c\u4f9d\u8d56\u4e8e\u914d\u7f6e\u7684\u7b56\u7565\uff0c\u7b56\u7565\u88ab\u5e7f\u4e49\u4e0a\u5212\u5206\u4e3a\u4e09\u7c7b\uff1a</p>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#plan","title":"Plan\u7b56\u7565","text":"<p>\u7528\u4e8e\u51b3\u7b56\u54ea\u4e9b\u6587\u4ef6\u7ec4\u5e94\u8be5\u88ab\u805a\u5408\uff08clustered\uff09\uff1a</p> <ul> <li><code>SparkSizeBasedClusteringPlanStrategy</code>\uff1a\u57fa\u4e8ebase file\uff08parquet\uff09\u7684\u5c0f\u6587\u4ef6\u9650\u5236\uff0c\u521b\u5efa\u805a\u5408\u7ec4\u5141\u8bb8\u6bcf\u4e2a\u7ec4\u8fbe\u5230\u6700\u5927\u7684\u6587\u4ef6\u5927\u5c0f\u3002\u8fd9\u79cd\u7b56\u7565\u5bf9\u4e8e\u5c06\u4e2d\u7b49\u5927\u5c0f\u7684\u6587\u4ef6\u62fc\u63a5\u5230\u66f4\u5927\u7684\u6587\u4ef6\u4e2d\uff0c\u4ee5\u51cf\u5c11\u5927\u91cf\u6587\u4ef6\u5728\u51b7\u5206\u533a\u4e0a\u7684\u4f20\u64ad\u975e\u5e38\u6709\u7528\u3002</li> <li><code>SparkRecentDaysClusteringPlanStrategy</code>\uff1a\u9ed8\u8ba4\u7b56\u7565\uff0c\u56de\u987e\u4ee5\u524d\u7684N\u5929\u5206\u533a\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a\u8ba1\u5212\uff0c\u5c06\u8fd9\u4e9b\u5206\u533a\u4e2d\u7684\u201c\u5c0f\u201d\u6587\u4ef6\u7247\u96c6\u7fa4\u8d77\u6765\u3002\u5f53\u5de5\u4f5c\u8d1f\u8f7d\u662f\u53ef\u9884\u6d4b\u7684\u5e76\u4e14\u6570\u636e\u662f\u6309\u65f6\u95f4\u5212\u5206\u7684\u65f6\u5019\uff0c\u5b83\u4f1a\u5f88\u6709\u7528\u3002</li> <li><code>SparkSelectedPartitionsClusteringPlanStrategy</code>\uff1a\u53ea\u60f3\u5728\u4e00\u4e2a\u8303\u56f4\u5185\u96c6\u7fa4\u7279\u5b9a\u7684\u5206\u533a\uff0c\u65e0\u8bba\u8fd9\u4e9b\u5206\u533a\u662f\u65e7\u7684\u8fd8\u662f\u65b0\u7684</li> </ul> <p>\u6ce8\u610f\uff1a\u6240\u6709\u7b56\u7565\u90fd\u662f\u5206\u533a\u611f\u77e5\u7684\uff0c\u540e\u4e24\u79cd\u7b56\u7565\u4ecd\u7136\u53d7\u5230\u7b2c\u4e00\u79cd\u7b56\u7565\u7684\u5927\u5c0f\u9650\u5236\u7684\u7ea6\u675f\u3002\u5373\u5c0f\u6587\u4ef6/\u6700\u5927\u6587\u4ef6\u7684\u9650\u5236\uff09.</p>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#_3","title":"\u6267\u884c\u7b56\u7565","text":"<p>\u5728\u89c4\u5212\u9636\u6bb5\u6784\u5efa\u805a\u5408\u7ec4\u4e4b\u540e\uff0cHudi\u5bf9\u6bcf\u4e2a\u7ec4\u5e94\u7528\u6267\u884c\u7b56\u7565\uff0c\u4e3b\u8981\u57fa\u4e8e\u6392\u5e8f\u5217\u548c\u5927\u5c0f\u3002</p> <ul> <li> <p><code>SparkSortAndSizeExecutionStrategy</code>\uff1a\u9ed8\u8ba4\u914d\u7f6e\uff0c\u6307\u5b9a\u6392\u5e8f\u7684\u5217\uff0c\u4e3a\u96c6\u7fa4\u751f\u6210\u7684parquet\u6587\u4ef6\u8bbe\u7f6e\u6700\u5927\u6587\u4ef6\u5927\u5c0f\uff08hoodie.parquet.max.file.size\uff09\uff0c\u4f7f\u7528bulk insert\u5199\u6570\u636e\u5230\u65b0\u6587\u4ef6\u4e2d\uff0c\u8be5\u7b56\u7565\u6539\u53d8\u4e86\u6570\u636e\u5e03\u5c40\uff0c\u4e0d\u4ec5\u63d0\u9ad8\u4e86\u67e5\u8be2\u6027\u80fd\uff0c\u8fd8\u81ea\u52a8\u5e73\u8861\u4e86\u91cd\u5199\u5f00\u9500\u3002</p> </li> <li> <p>\u6839\u636e\u89c4\u5212\u9636\u6bb5\u521b\u5efa\u7684\u96c6\u7fa4\u7ec4\u7684\u6570\u91cf\uff0c\u8be5\u7b56\u7565\u53ef\u4ee5\u4f5c\u4e3a\u5355\u4e2aspark\u4f5c\u4e1a\u6267\u884c\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u591a\u4e2a\u4f5c\u4e1a\u6267\u884c\u3002</p> </li> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cHudi\u5c06\u63d0\u4ea4\u591a\u4e2aspark\u4f5c\u4e1a\u5e76\u5408\u5e76\u7ed3\u679c\u3002</li> <li><code>SingleSparkJobExecutionStrategy</code>\uff1a\u5f3a\u5236Hudi\u4f7f\u7528\u5355Spark\u4f5c\u4e1a\u6267\u884c</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#_4","title":"\u66f4\u65b0\u7b56\u7565","text":"<p>\u5f53\u524d\uff0cclustering\u53ea\u80fd\u88ab\u8c03\u5ea6\u5230\u6ca1\u6709\u63a5\u6536\u5230\u4efb\u4f55\u5e76\u53d1\u66f4\u65b0\u7684\u8868/\u5206\u533a\uff1a</p> <ul> <li><code>SparkRejectUpdateStrategy</code>\uff1a\u9ed8\u8ba4\uff0c\u5982\u679c\u67d0\u4e2a\u6587\u4ef6\u7ec4\u5728\u96c6\u7fa4\u671f\u95f4\u6709\u66f4\u65b0\uff0c\u90a3\u4e48\u5b83\u5c06\u62d2\u7edd\u66f4\u65b0\u5e76\u629b\u51fa\u5f02\u5e38\u3002</li> <li><code>SparkAllowUpdateStrategy</code>\uff1a</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#_5","title":"\u53c2\u6570","text":"<ul> <li><code>hoodie.clustering.plan.strategy.class</code>\uff1a\u9ed8\u8ba4<code>SparkRecentDaysClusteringPlanStrategy</code></li> <li>\u914d\u7f6e\u4e3a<code>SparkSelectedPartitionsClusteringPlanStrategy</code>\u65f6\uff0c\u53ef\u4ee5\u6267\u884c\u8d77\u59cb\u5206\u533a<ul> <li><code>hoodie.clustering.plan.strategy.cluster.begin.partition</code></li> <li><code>hoodie.clustering.plan.strategy.cluster.end.partition</code></li> </ul> </li> <li><code>hoodie.clustering.execution.strategy.class</code>\uff1a\u6267\u884c\u7b56\u7565\uff0c\u9ed8\u8ba4<code>SparkSortAndSizeExecutionStrategy</code></li> <li><code>hoodie.clustering.updates.strategy</code>\uff1a\u66f4\u65b0\u7b56\u7565\uff0c\u9ed8\u8ba4<code>SparkRejectUpdateStrategy</code>\uff1b</li> <li></li> <li><code>hoodie.clustering.plan.strategy.small.file.limit</code>\uff1a\u9ed8\u8ba4629145600\uff0c\u5c0f\u6587\u4ef6\u7684\u9608\u503c\uff1b</li> <li><code>hoodie.clustering.plan.strategy.daybased.skipfromlatest.partitions</code>\uff1a\u9ed8\u8ba40\uff0c\u521b\u5efa\u805a\u7c7b\u8ba1\u5212\u65f6\uff0c\u4ece\u6700\u65b0\u5206\u533a\u8df3\u8fc7\u7684\u5206\u533a\u6570\uff1b</li> <li> <p><code>hoodie.clustering.preserve.commit.metadata</code>\uff1a\u9ed8\u8ba4false\uff0c\u91cd\u5199\u6570\u636e\u540e\uff0c\u662f\u5426\u4fdd\u7559\u5df2\u5b58\u5728\u7684<code>_hoodie_commit_time</code>\uff0c\u610f\u5473\u7740\u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u5728\u805a\u5408\u540e\u7684\u6570\u636e\u4e0a\u76f4\u63a5\u8fd0\u884c\u589e\u91cf\u67e5\u8be2\u3002</p> </li> <li> <p><code>hoodie.clustering.inline</code>\uff1a\u9ed8\u8ba4false\uff0c\u8bbe\u7f6e\u4e3atrue\u4f1a\u5728\u6bcf\u6b21\u5199\u5b8c\u6210\u7684\u65f6\u5019\u8fd0\u884cclustering\uff0c\u548c\u5199\u4efb\u52a1\u540c\u6b65\uff1b</p> </li> <li><code>hoodie.clustering.async.enabled</code>\uff1a\u9ed8\u8ba4false\uff0c\u5f02\u6b65clustering\uff0c\u5426\u5219\u540c\u6b65\u8fdb\u884cclustering\uff1b</li> <li><code>hoodie.parquet.small.file.limit</code>\uff1a\u5f02\u6b65\u8fd0\u884c\u65f6\uff0c\u8bbe\u7f6e\u4e3a0\uff0c\u907f\u514d\u89e6\u53d1\u5c0f\u6587\u4ef6\u5408\u5e76\u7b56\u7565\uff1b</li> <li> <p><code>hoodie.clustering.async.max.commits</code>\uff1a\u9ed8\u8ba44\uff0c\u591a\u5c11commits\u4e4b\u540e\uff0c\u53ef\u4ee5\u89e6\u53d1clustering\uff1b</p> </li> <li> <p><code>hoodie.clustering.inline</code>\uff1a\u9ed8\u8ba4false\uff0c\u7528\u4e8e\u5355\u72ec\u542f\u52a8clustering\u65f6\u914d\u7f6e\uff1b</p> </li> </ul>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#_6","title":"\u652f\u6301\u5f15\u64ce","text":""},{"location":"data_system/data_lake/apache_hudi/clustering.html#hoodieclusteringjobspark","title":"HoodieClusteringJob\uff08\u72ec\u7acb\u670d\u52a1\uff0cSpark\uff09","text":"<p>\u6307\u5b9a-mode\u6216-m\u9009\u9879\u3002\u6709\u5982\u4e0b\u4e09\u79cd\u6a21\u5f0f\uff1a</p> <ul> <li>schedule\uff08\u8c03\u5ea6\uff09\uff1a\u5236\u5b9a\u4e00\u4e2aClustering\u8ba1\u5212\u3002\u8fd9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53ef\u4ee5\u5728\u6267\u884c\u6a21\u5f0f\u4e0b\u4f20\u9012\u7684instant\u3002</li> <li> <p>execute\uff08\u6267\u884c\uff09\uff1a\u5728\u7ed9\u5b9a\u7684instant\u6267\u884cClustering\u8ba1\u5212\uff0c\u8fd9\u610f\u5473\u7740\u8fd9\u91cc\u9700\u8981instant\u3002</p> </li> <li> <p>scheduleAndExecute\uff08\u8c03\u5ea6\u5e76\u6267\u884c\uff09\uff1a\u9996\u5148\u5236\u5b9aClustering\u8ba1\u5212\u5e76\u7acb\u5373\u6267\u884c\u8be5\u8ba1\u5212\u3002</p> </li> </ul> <p>\u5f00\u542fmulti-writing\uff08\u5728\u539f\u59cb\u5199\u5165\u7a0b\u5e8f\u4ecd\u5728\u8fd0\u884c\u65f6\u8fd0\u884c\u4f5c\u4e1a\u8bf7\u542f\u7528\u591a\u5199\u5165\uff09\uff1a</p> <pre><code>hoodie.write.concurrency.mode=optimistic_concurrency_control\nhoodie.write.lock.provider=org.apache.hudi.client.transaction.lock.ZookeeperBasedLockProvider\n</code></pre> <p>Spark\u8fd0\u884c\uff1a</p> <pre><code>spark-submit \\--class org.apache.hudi.utilities.HoodieClusteringJob \\/path/to/hudi-utilities-bundle/target/hudi-utilities-bundle_2.12-0.9.0-SNAPSHOT.jar \\--props /path/to/config/clusteringjob.properties \\--mode scheduleAndExecute \\--base-path /path/to/hudi_table/basePath \\--table-name hudi_table_schedule_clustering \\--spark-memory 1g\n</code></pre> <p>\u793a\u4f8b clusteringjob.properties \u914d\u7f6e\uff1a</p> <pre><code>hoodie.clustering.async.enabled=true\nhoodie.clustering.async.max.commits=4\nhoodie.clustering.plan.strategy.target.file.max.bytes=1073741824\nhoodie.clustering.plan.strategy.small.file.limit=629145600\nhoodie.clustering.execution.strategy.class=org.apache.hudi.client.clustering.run.strategy.SparkSortAndSizeExecutionStrategy\nhoodie.clustering.plan.strategy.sort.columns=column1,column2\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#deltastreamer","title":"DeltaStreamer","text":"<pre><code>spark-submit \\\n--class org.apache.hudi.utilities.deltastreamer.HoodieDeltaStreamer \\\n/path/to/hudi-utilities-bundle/target/hudi-utilities-bundle_2.12-0.9.0-SNAPSHOT.jar \\\n--props /path/to/config/clustering_kafka.properties \\\n--schemaprovider-class org.apache.hudi.utilities.schema.SchemaRegistryProvider \\\n--source-class org.apache.hudi.utilities.sources.AvroKafkaSource \\\n--source-ordering-field impresssiontime \\\n--table-type COPY_ON_WRITE \\\n--target-base-path /path/to/hudi_table/basePath \\\n--target-table impressions_cow_cluster \\\n--op INSERT \\\n--hoodie-conf hoodie.clustering.async.enabled=true \\\n--continuous\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#spark-structured-streaming","title":"Spark Structured Streaming","text":"<p>\u539f\u59cb\u4efb\u52a1\u5199\u5165\u65f6\uff0c\u8fdb\u884c\u5f02\u6b65\u805a\u7c7b</p> <pre><code>val commonOpts = Map(\n   \"hoodie.insert.shuffle.parallelism\" -&gt; \"4\",\n   \"hoodie.upsert.shuffle.parallelism\" -&gt; \"4\",\n   DataSourceWriteOptions.RECORDKEY_FIELD.key -&gt; \"_row_key\",\n   DataSourceWriteOptions.PARTITIONPATH_FIELD.key -&gt; \"partition\",\n   DataSourceWriteOptions.PRECOMBINE_FIELD.key -&gt; \"timestamp\",\n   HoodieWriteConfig.TBL_NAME.key -&gt; \"hoodie_test\"\n)\n\ndef getAsyncClusteringOpts(isAsyncClustering: String, \n                           clusteringNumCommit: String, \n                           executionStrategy: String):Map[String, String] = {\n   commonOpts + (DataSourceWriteOptions.ASYNC_CLUSTERING_ENABLE.key -&gt; isAsyncClustering,\n           HoodieClusteringConfig.ASYNC_CLUSTERING_MAX_COMMITS.key -&gt; clusteringNumCommit,\n           HoodieClusteringConfig.EXECUTION_STRATEGY_CLASS_NAME.key -&gt; executionStrategy\n   )\n}\n\ndef initStreamingWriteFuture(hudiOptions: Map[String, String]): Future[Unit] = {\n   val streamingInput = // define the source of streaming\n   Future {\n      println(\"streaming starting\")\n      streamingInput\n              .writeStream\n              .format(\"org.apache.hudi\")\n              .options(hudiOptions)\n              .option(\"checkpointLocation\", basePath + \"/checkpoint\")\n              .mode(Append)\n              .start()\n              .awaitTermination(10000)\n      println(\"streaming ends\")\n   }\n}\n\ndef structuredStreamingWithClustering(): Unit = {\n   val df = //generate data frame\n   val hudiOptions = getAsyncClusteringOpts(\"true\", \"1\", \"org.apache.hudi.client.clustering.run.strategy.SparkSortAndSizeExecutionStrategy\")\n   val f1 = initStreamingWriteFuture(hudiOptions)\n   Await.result(f1, Duration.Inf)\n}\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#spark-datasourceinline","title":"Spark DataSource\uff08inline\uff09","text":"<pre><code>import org.apache.hudi.QuickstartUtils._\nimport scala.collection.JavaConversions._\nimport org.apache.spark.sql.SaveMode._\nimport org.apache.hudi.DataSourceReadOptions._\nimport org.apache.hudi.DataSourceWriteOptions._\nimport org.apache.hudi.config.HoodieWriteConfig._\n\n\nval df =  //generate data frame\ndf.write.format(\"org.apache.hudi\").\n        options(getQuickstartWriteConfigs).\n        option(PRECOMBINE_FIELD_OPT_KEY, \"ts\").\n        option(RECORDKEY_FIELD_OPT_KEY, \"uuid\").\n        option(PARTITIONPATH_FIELD_OPT_KEY, \"partitionpath\").\n        option(TABLE_NAME, \"tableName\").\n        option(\"hoodie.parquet.small.file.limit\", \"0\").\n        option(\"hoodie.clustering.inline\", \"true\").\n        option(\"hoodie.clustering.inline.max.commits\", \"4\").\n        option(\"hoodie.clustering.plan.strategy.target.file.max.bytes\", \"268435456\").\n        option(\"hoodie.clustering.plan.strategy.small.file.limit\", \"134217728\").\n        option(\"hoodie.clustering.plan.strategy.sort.columns\", \"column1,column2\"). //optional, if sorting is needed as part of rewriting data\n        mode(Append).\n        save(\"dfs://location\");\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#flink-clustering-jira","title":"Flink Clustering Jira","text":""},{"location":"data_system/data_lake/apache_hudi/clustering.html#_7","title":"\u6027\u80fd\u5bf9\u6bd4","text":""},{"location":"data_system/data_lake/apache_hudi/clustering.html#before-clustering","title":"Before Clustering","text":"<p>Query took 2.2 minutes to complete. Note that the number of output rows in the \u201cscan parquet\u201d part of the query plan includes all 20M rows in the table.</p> <p></p>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#after-clustering","title":"After Clustering","text":"<p>The query plan is similar to above. But, because of improved data locality and predicate push down, spark is able to prune a lot of rows. After clustering, the same query only outputs 110K rows (out of 20M rows) while scanning parquet files. This cuts query time to less than a minute from 2.2 minutes.</p> <p></p>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#_8","title":"\u603b\u7ed3","text":"<p>\u4f7f\u7528Clustering\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd</p> <ol> <li>\u5229\u7528\u7a7a\u95f4\u586b\u5145\u66f2\u7ebf\u7b49\u6982\u5ff5\u6765\u9002\u5e94\u6570\u636e\u6e56\u5e03\u5c40\u5e76\u51cf\u5c11\u67e5\u8be2\u671f\u95f4\u8bfb\u53d6\u7684\u6570\u636e\u91cf\u3002</li> <li>\u5c06\u5c0f\u6587\u4ef6\u62fc\u63a5\u6210\u5927\u6587\u4ef6\uff0c\u51cf\u5c11\u67e5\u8be2\u5f15\u64ce\u9700\u8981\u626b\u63cf\u7684\u6587\u4ef6\u603b\u6570\u3002</li> </ol> <p>Clustering\u6846\u67b6\u8fd8\u63d0\u4f9b\u4e86\u6839\u636e\u7279\u5b9a\u8981\u6c42\u5f02\u6b65\u91cd\u5199\u6570\u636e\u7684\u7075\u6d3b\u6027\u3002\u91c7\u7528\u96c6\u7fa4\u6846\u67b6\u548c\u81ea\u5b9a\u4e49\u53ef\u63d2\u62d4\u7b56\u7565\u6765\u6ee1\u8db3\u6309\u9700\u6570\u636e\u6e56\u7ba1\u7406\u6d3b\u52a8\uff0c\u5982\uff1a</p> <ol> <li>\u91cd\u5199\u6570\u636e\u5e76\u52a0\u5bc6\u9759\u6001\u6570\u636e\u3002</li> <li>\u4ece\u8868\u4e2d\u4fee\u526a\u672a\u4f7f\u7528\u7684\u5217\u5e76\u51cf\u5c11\u5b58\u50a8\u7a7a\u95f4\u3002</li> </ol>"},{"location":"data_system/data_lake/apache_hudi/clustering.html#todo","title":"TODO","text":""},{"location":"data_system/data_lake/apache_hudi/clustering.html#support-clustering-with-updates","title":"Support clustering with updates","text":""},{"location":"data_system/data_lake/apache_hudi/clustering.html#cli-tools-to-support-clustering","title":"CLI tools to support clustering","text":""},{"location":"data_system/data_lake/apache_hudi/clustering.html#_9","title":"\u805a\u7c07\uff08clustering\uff09","text":""},{"location":"data_system/data_lake/apache_hudi/compaction.html","title":"Compaction","text":"<p>\u538b\u7f29\u4ec5\u9002\u7528\u4e8e\u8bfb\u65f6\u5408\u5e76\uff08MOR\uff09\u8868\u7c7b\u578b\uff0c\u5e76\u4e14\u7531\u538b\u7f29\u7b56\u7565\uff08\u9ed8\u8ba4\u9009\u62e9\u5177\u6709\u6700\u5927\u672a\u538b\u7f29\u65e5\u5fd7\u7684\u6587\u4ef6\u7247\uff09\u51b3\u5b9a\u9009\u62e9\u8981\u8fdb\u884c\u538b\u7f29\u7684\u6587\u4ef6\u7247\u3002</p> <p>Merge-On-Read\u8868\u901a\u8fc7delta\u6587\u4ef6\uff0c\u8fdb\u884c\u540c\u6b65/\u5f02\u6b65\u7684\u5408\u5e76\uff0c\u5728\u5199\u5165\uff08ingest\uff09\u8bb0\u5f55\u65f6\u51cf\u5c11\u6570\u636e\u5ef6\u8fdf\u3002\u56e0\u6b64\uff0c\u5f02\u6b65\u8fd0\u884c\u538b\u7f29\u800c\u4e0d\u963b\u585e\u5199\u5165\u662f\u6709\u610f\u4e49\u7684\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/compaction.html#_1","title":"\u5b9e\u65f6\u538b\u7f29","text":"<p>\u9ed8\u8ba4\u5f02\u6b65\u538b\u7f29\u3002</p> <p>\u64cd\u4f5c\u6d41\u7a0b\uff1a</p> <ul> <li> <p>Compaction Scheduling \uff1aHudi\u626b\u63cf\u5206\u533a\u5e76\u9009\u62e9\u8981\u538b\u7f29\u7684file slices\uff0c\u4e00\u4efd\u538b\u7f29\u8ba1\u5212\u6700\u7ec8\u88ab\u5199\u8fdb\u4e86 Hudi Timeline\u3002</p> </li> <li> <p>Compaction Execution \uff1a\u4e00\u4e2a\u5355\u72ec\u7684\u8fdb\u7a0b\u8bfb\u53d6\u538b\u7f29\u8ba1\u5212\u5e76\u6267\u884cfile slices\u7684\u538b\u7f29\u3002</p> </li> </ul>"},{"location":"data_system/data_lake/apache_hudi/compaction.html#_2","title":"\u540c\u6b65","text":"<p>\u9002\u7528\u65b0\u63d0\u4ea4\u7684\u7acb\u5373\u8bfb\u53d6\u573a\u666f\uff0c\u5199\u7a0b\u5e8f\u8fdb\u7a0b\u672c\u8eab\u5728\u6bcf\u6b21\u5199\u5165\u4e4b\u540e\u540c\u6b65\u6267\u884c\u7684\uff0c\u5373\u76f4\u5230\u538b\u7f29\u5b8c\u6210\u540e\u624d\u80fd\u5f00\u59cb\u4e0b\u4e00\u4e2a\u5199\u64cd\u4f5c\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/compaction.html#_3","title":"\u5f02\u6b65","text":"<p>\u538b\u7f29\u8fc7\u7a0b\u53ef\u4ee5\u4e0e\u8868\u7684\u5199\u64cd\u4f5c\u540c\u65f6\u5f02\u6b65\u8fd0\u884c\uff0c\u538b\u7f29\u4e0d\u4f1a\u963b\u585e\u4e0b\u4e00\u6279\u6570\u636e\u5199\u5165\uff0c\u4ece\u800c\u4ea7\u751f\u8fd1\u5b9e\u65f6\u7684\u6570\u636e\u65b0\u9c9c\u5ea6\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/compaction.html#_4","title":"\u914d\u7f6e","text":"<ul> <li><code>hoodie.compaction.strategy</code>\uff1a\u51b3\u5b9a\u5728\u6bcf\u6b21\u538b\u7f29\u8fd0\u884c\u671f\u95f4\u9009\u62e9\u54ea\u4e9b\u6587\u4ef6\u7ec4\u8fdb\u884c\u538b\u7f29\u3002\u9ed8\u8ba4\uff08LogFileSizeBasedCompactionStrategy \uff09\uff0cHudi\u9009\u62e9\u5177\u6709\u6700\u591a\u672a\u5408\u5e76\u6570\u636e\u7684\u65e5\u5fd7\u6587\u4ef6\uff1b</li> <li><code>hoodie.compact.inline</code>\uff1a\u662f\u5426\u5728\u6bcf\u6b21commit\u4e4b\u540e\uff0c\u89e6\u53d1compaction\u670d\u52a1\uff0c\u589e\u52a0\u5199\u5ef6\u8fdf\uff0c\u9ed8\u8ba4false\uff0c\u5f02\u6b65\uff1b</li> <li>\u8bbe\u7f6e\u4e3atrue\u65f6\uff0c\u505a schedule \u548c execution \u4e24\u4ef6\u4e8b\uff1b</li> <li>\u5bf9\u5e94spark\u53c2\u6570\uff1a<code>hoodie.datasource.compaction.async.enable</code></li> <li> <p>\u5bf9\u5e94flink\u53c2\u6570\uff1a <code>compaction.async.enabled</code>(flink)</p> </li> <li> <p><code>hoodie.compact.schedule.inline\uff08\uff1f\uff1f\uff09</code>\uff1a\u9ed8\u8ba4false\uff0c\u662f\u5426\u5728\u5199\u5165\u65f6\u6267\u884ccompaction\u4e2d\u7684schedule\uff1b</p> </li> <li><code>hoodie.compact.inline.trigger.strategy</code>\uff1a\u9ed8\u8ba4<code>NUM_COMMITS</code>\uff0ccompaction\u8c03\u5ea6\u89e6\u53d1\u7684\u4f9d\u636e\uff1b</li> <li><code>hoodie.compact.inline.max.delta.seconds</code>\uff1a\u4e0a\u6b21compaction\u540e\u591a\u957f\u65f6\u95f4\uff0c\u53ef\u4ee5\u5f00\u542f\u65b0\u7684compaction\uff1b</li> <li><code>hoodie.compact.inline.max.delta.commits</code>\uff1a\u4e0a\u6b21compaction\u540e\u591a\u5c11\u4e2adelta\u7684commit\uff0c\u53ef\u4ee5\u5f00\u542f\u65b0\u7684comapaction\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/compaction.html#_5","title":"\u79bb\u7ebf\u538b\u7f29","text":"<p>\u89e6\u53d1\u7b56\u7565\u9ed8\u8ba4\u5728\u5b8c\u6210\u4e94\u6b21\u63d0\u4ea4\u540e\u6267\u884c\u538b\u7f29\u3002\u56e0\u4e3acompaction\u4f1a\u6d88\u8017\u5927\u91cf\u5185\u5b58\uff0c\u5e76\u4e14\u548c\u5199\u64cd\u4f5c\u653e\u5728\u540c\u4e00\u4e2a\u7ba1\u9053\u4e2d\uff0c\u6240\u4ee5\u5f53\u6570\u636e\u91cf\u5f88\u5927\uff08&gt;100000/s\uff09\u65f6\u5f88\u5bb9\u6613\u5e72\u6270\u5199\u64cd\u4f5c\u3002</p> <ul> <li>Compaction \u6709\u4e24\u90e8\uff1a\u751f\u6210\u8ba1\u5212\u548c\u6267\u884c\u8ba1\u5212\uff0c\u5efa\u8bae\u751f\u6210\u8ba1\u5212\u7531\u5199\u4efb\u52a1\u5468\u671f\u6027\u89e6\u53d1\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/compaction.html#hudi-compactorspark","title":"Hudi Compactor\uff08Spark\uff09","text":"<p>Hudi \u63d0\u4f9b\u5de5\u5177\u7c7b\uff0c\u5f02\u6b65\u6267\u884c\u7279\u5b9a\u7684 Hudi \u8868\u7684\u538b\u7f29</p> <pre><code>        # instant-time \u53ef\u9009\uff0c\u4e0d\u8bbe\u7f6e\u5219\u4f1a\u6267\u884ctimeline\u4e2d\u6700\u65e9\u7684\u7684\u538b\u7f29\u8ba1\u5212\nspark-submit --packages org.apache.hudi:hudi-utilities-bundle_2.12:0.11.0 \\\n--class org.apache.hudi.utilities.HoodieCompactor \\\n--base-path &lt;base_path&gt; \\\n--table-name &lt;table_name&gt; \\\n--schema-file &lt;schema_file&gt; \\\n--instant-time &lt;compaction_instant&gt;\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/compaction.html#hudi-cli","title":"Hudi CLI","text":"<pre><code>hudi:trips-&gt;compaction run --tableName &lt;table_name&gt; --parallelism &lt;parallelism&gt; --compactionInstant &lt;InstantTime&gt;\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/compaction.html#flink-offline-compaction","title":"Flink Offline Compaction","text":"<pre><code>./bin/flink run -c org.apache.hudi.sink.compact.HoodieFlinkCompactor lib/hudi-flink-bundle_2.12-0.11.0.jar --path hdfs://xxx:9000/table\n</code></pre> <p>\u5177\u4f53\u53c2\u6570\u89c1\uff1ahttps://hudi.apache.org/docs/compaction#flink-offline-compaction</p>"},{"location":"data_system/data_lake/apache_hudi/compaction.html#_6","title":"\u793a\u4f8b","text":""},{"location":"data_system/data_lake/apache_hudi/compaction.html#spark","title":"Spark\uff08\u540c\u6b65/\u5f02\u6b65\uff09","text":"<p>\u53c2\u6570\uff1a</p> <ul> <li><code>hoodie.datasource.compaction.async.enable</code>\uff1aSpark\u7684\u914d\u7f6e\uff0c\u9ed8\u8ba4\u4e3atrue\uff0c\u8868\u793a\u5f02\u6b65\uff0c\u4f1a\u8bbe\u7f6e<code>hoodie.compact.inline</code>\u4e3afalse\uff1b</li> <li>\u89c1 <code>DataSourceUtils::createHoodieConfig</code>\u7684<code>asyncCompact</code>\u548c<code>inlineCompact</code></li> </ul> <pre><code>import org.apache.hudi.DataSourceWriteOptions;\nimport org.apache.hudi.HoodieDataSourceHelpers;\nimport org.apache.hudi.config.HoodieCompactionConfig;\nimport org.apache.hudi.config.HoodieWriteConfig;\nimport org.apache.spark.sql.streaming.OutputMode;\nimport org.apache.spark.sql.streaming.ProcessingTime;\n\n\n DataStreamWriter&lt;Row&gt; writer = streamingInput.writeStream().format(\"org.apache.hudi\")\n        .option(DataSourceWriteOptions.OPERATION_OPT_KEY(), operationType)\n        .option(DataSourceWriteOptions.TABLE_TYPE_OPT_KEY(), tableType)\n        .option(DataSourceWriteOptions.RECORDKEY_FIELD_OPT_KEY(), \"_row_key\")\n        .option(DataSourceWriteOptions.PARTITIONPATH_FIELD_OPT_KEY(), \"partition\")\n        .option(DataSourceWriteOptions.PRECOMBINE_FIELD_OPT_KEY(), \"timestamp\")\n        // hoodie.compact.inline.max.delta.commits\n        .option(HoodieCompactionConfig.INLINE_COMPACT_NUM_DELTA_COMMITS_PROP, \"10\")\n        // hoodie.datasource.compaction.async.enable\n        .option(DataSourceWriteOptions.ASYNC_COMPACT_ENABLE_OPT_KEY(), \"true\")\n        .option(HoodieWriteConfig.TABLE_NAME, tableName).option(\"checkpointLocation\", checkpointLocation)\n        .outputMode(OutputMode.Append());\n writer.trigger(new ProcessingTime(30000)).start(tablePath);\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/compaction.html#flink","title":"Flink\uff08\u540c\u6b65/\u5f02\u6b65\uff09","text":""},{"location":"data_system/data_lake/apache_hudi/concurrency_write.html","title":"\u5e76\u53d1\u63a7\u5236","text":"<p>\u591a\u4e2a\u5199\u5165\u8005\u65f6\u6570\u636e\u7684\u6444\u53d6\uff08ingest\uff09\u65b9\u5f0f\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/concurrency_write.html#_2","title":"\u652f\u6301\u7684\u5e76\u53d1\u63a7\u5236","text":""},{"location":"data_system/data_lake/apache_hudi/concurrency_write.html#mvcc","title":"MVCC","text":"<ul> <li>Hudi \u8868\u670d\u52a1\uff0c\u5982\u538b\u7f29\u3001\u6e05\u7406\u3001\u96c6\u7fa4\u5229\u7528\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\u6765\u63d0\u4f9b\u591a\u4e2a\u8868\u670d\u52a1\u5199\u5165\u8005\u548c\u8bfb\u53d6\u8005\u4e4b\u95f4\u7684\u5feb\u7167\u9694\u79bb\u3002</li> <li>Hudi \u5728\u6444\u53d6\u5199\u5165\u5668\u548c\u591a\u4e2a\u5e76\u53d1\u8bfb\u53d6\u5668\u4e4b\u95f4\u63d0\u4f9b\u5feb\u7167\u9694\u79bb</li> <li>Hudi \u652f\u6301\u5e76\u53d1\u8fd0\u884c\u4efb\u610f\u6570\u91cf\u7684\u8868\u670d\u52a1\u4f5c\u4e1a\uff0c\u6ca1\u6709\u4efb\u4f55\u5e76\u53d1\u51b2\u7a81\u3002\u8fd9\u662f\u901a\u8fc7\u786e\u4fdd\u6b64\u7c7b\u8868\u670d\u52a1\u7684\u8c03\u5ea6\u8ba1\u5212\u59cb\u7ec8\u4ee5\u5355\u4e00\u5199\u5165\u6a21\u5f0f\u53d1\u751f\u4ee5\u786e\u4fdd\u6ca1\u6709\u51b2\u7a81\u5e76\u907f\u514d\u7ade\u4e89\u6761\u4ef6\u800c\u6210\u4e3a\u53ef\u80fd\u7684\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/concurrency_write.html#optimistic-concurrency","title":"OPTIMISTIC CONCURRENCY","text":"<p>\u5199\u5165\u64cd\u4f5c\uff0c\u5982\u4e0a\u8ff0\uff08UPSERT\u3001INSERT\uff09\u7b49\uff0c\u5229\u7528\u4e50\u89c2\u5e76\u53d1\u63a7\u5236\u4f7f\u591a\u4e2a\u6444\u53d6\u5199\u5165\u5668\u80fd\u591f\u5199\u5165\u540c\u4e00\u4e2a Hudi \u8868\u3002</p> <p>Hudi \u652f\u6301<code>file level OCC</code>\uff0c\u5373\u5bf9\u4e8e\u53d1\u751f\u5728\u540c\u4e00\u4e2a\u8868\u4e0a\u7684\u4efb\u4f55 2 \u4e2a\u63d0\u4ea4\uff08\u6216\u5199\u5165\u8005\uff09\uff0c\u5982\u679c\u5b83\u4eec\u6ca1\u6709\u5199\u5165\u6b63\u5728\u66f4\u6539\u7684\u91cd\u53e0\u6587\u4ef6\uff0c\u5219\u5141\u8bb8\u4e24\u4e2a\u5199\u5165\u8005\u6210\u529f\u3002</p> <p>\u6b64\u529f\u80fd\u76ee\u524d\u5904\u4e8e\u5b9e\u9a8c\u9636\u6bb5\uff0c\u9700\u8981 Zookeeper \u6216 HiveMetastore \u6765\u83b7\u53d6\u9501\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/concurrency_write.html#_3","title":"\u5355\u5199\u4fdd\u8bc1","text":"<ul> <li>UPSERT\uff1a\u76ee\u6807\u8868\u4e0d\u4f1a\u5c55\u793a\u91cd\u590d\u8bb0\u5f55\uff1b</li> <li>INSERT \uff1a\u76ee\u6807\u8868\u4e0d\u4f1a\u6709\u91cd\u590d\u8bb0\u5f55\uff0c\u5982\u679c<code>hoodie.datasource.write.insert.drop.duplicates</code>\u8bbe\u7f6e\u4e3a<code>true</code>\uff1b</li> <li>BULK_INSERT \uff1a\u76ee\u6807\u8868\u4e0d\u4f1a\u6709\u91cd\u590d\u8bb0\u5f55\uff0c\u5982\u679c<code>hoodie.datasource.write.insert.drop.duplicates</code>\u8bbe\u7f6e\u4e3a<code>true</code>\uff1b</li> <li>INCREMENTAL PULL\uff1a\u6570\u636e\u6d88\u8d39\u548c\u68c0\u67e5\u70b9\u6c38\u8fdc\u4e0d\u4f1a\u51fa\u73b0\u6545\u969c\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/concurrency_write.html#_4","title":"\u591a\u5199\u4fdd\u8bc1","text":"<ul> <li>UPSERT\uff1a\u76ee\u6807\u8868\u4e0d\u4f1a\u5c55\u793a\u91cd\u590d\uff1b</li> <li>INSERT \uff1a\u76ee\u6807\u8868\u53ef\u80fd\u6709\u91cd\u590d\u8bb0\u5f55\uff0c\u5982\u679c<code>hoodie.datasource.write.insert.drop.duplicates</code>\u8bbe\u7f6e\u4e3a<code>true</code>\uff1b</li> <li>BULK_INSERT \uff1a\u76ee\u6807\u8868\u53ef\u80fd\u6709\u91cd\u590d\u8bb0\u5f55\uff0c\u5982\u679c<code>hoodie.datasource.write.insert.drop.duplicates</code>\u8bbe\u7f6e\u4e3a<code>true</code>\uff1b</li> <li>INCREMENTAL PULL\uff1a\u6570\u636e\u6d88\u8d39\u548c\u68c0\u67e5\u70b9\u53ef\u80fd\u4f1a\u51fa\u73b0\u6545\u969c\uff0c\u7531\u4e8e\u591a\u4e2a\u5199\u4f5c\u4e1a\u5728\u4e0d\u540c\u65f6\u95f4\u5b8c\u6210\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/concurrency_write.html#_5","title":"\u5141\u8bb8\u591a\u5199","text":""},{"location":"data_system/data_lake/apache_hudi/concurrency_write.html#_6","title":"\u8bbe\u7f6e","text":"<pre><code>hoodie.write.concurrency.mode=optimistic_concurrency_control\nhoodie.cleaner.policy.failed.writes=LAZY\nhoodie.write.lock.provider=&lt;lock-provider-classname&gt;\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/concurrency_write.html#zookeeper","title":"Zookeeper\u9501","text":"<pre><code>hoodie.write.lock.provider=org.apache.hudi.client.transaction.lock.ZookeeperBasedLockProvider\nhoodie.write.lock.zookeeper.url\nhoodie.write.lock.zookeeper.port\nhoodie.write.lock.zookeeper.lock_key\nhoodie.write.lock.zookeeper.base_path\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/concurrency_write.html#hivemetastore","title":"HiveMetaStore\u9501","text":"<pre><code>hoodie.write.lock.provider=org.apache.hudi.hive.HiveMetastoreBasedLockProvider\nhoodie.write.lock.hivemetastore.database\nhoodie.write.lock.hivemetastore.table\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/concurrency_write.html#spark-datasource-write","title":"Spark DataSource Write","text":"<p><code>hudi-spark</code>\u63d0\u4f9bDataSource API\u5199\u5165\u548c\u8bfb\u53d6Hudi\u8868\u4e3aDataFrame\u3002</p> <p>\u4e50\u89c2\u5e76\u53d1\u63a7\u5236\u793a\u4f8b\uff1a</p> <pre><code>inputDF.write.format(\"hudi\")\n       .options(getQuickstartWriteConfigs)\n       .option(PRECOMBINE_FIELD_OPT_KEY, \"ts\")\n       .option(\"hoodie.cleaner.policy.failed.writes\", \"LAZY\")\n       .option(\"hoodie.write.concurrency.mode\", \"optimistic_concurrency_control\")\n       .option(\"hoodie.write.lock.zookeeper.url\", \"zookeeper\")\n       .option(\"hoodie.write.lock.zookeeper.port\", \"2181\")\n       .option(\"hoodie.write.lock.zookeeper.lock_key\", \"test_table\")\n       .option(\"hoodie.write.lock.zookeeper.base_path\", \"/test\")\n       .option(RECORDKEY_FIELD_OPT_KEY, \"uuid\")\n       .option(PARTITIONPATH_FIELD_OPT_KEY, \"partitionpath\")\n       .option(TABLE_NAME, tableName)\n       .mode(Overwrite)\n       .save(basePath)\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/concurrency_write.html#deltastreamer","title":"DeltaStreamer","text":"<p>\u4e50\u89c2\u5e76\u53d1\u63a7\u5236\u793a\u4f8b\uff1a\u5c06\u76f8\u5173\u914d\u7f6e\u52a0\u5230<code>kafka-source.properties</code>\u6587\u4ef6\u4e2d\uff0c\u5e76\u4f5c\u4e3aprops\u4f20\u5165</p> <pre><code>$ spark-submit --class org.apache.hudi.utilities.deltastreamer.HoodieDeltaStreamer `ls packaging/hudi-utilities-bundle/target/hudi-utilities-bundle-*.jar` \\\n  --props file://${PWD}/hudi-utilities/src/test/resources/delta-streamer-config/kafka-source.properties \\\n  --schemaprovider-class org.apache.hudi.utilities.schema.SchemaRegistryProvider \\\n  --source-class org.apache.hudi.utilities.sources.AvroKafkaSource \\\n  --source-ordering-field impresssiontime \\\n  --target-base-path file:\\/\\/\\/tmp/hudi-deltastreamer-op \\ \n  --target-table uber.impressions \\\n  --op BULK_INSERT\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/concurrency_write.html#_7","title":"\u7981\u6b62\u591a\u5199","text":"<p>\u9ed8\u8ba4\u914d\u7f6e\uff0c\u4ee5\u4e0b\u53c2\u6570</p> <pre><code>hoodie.write.concurrency.mode=single_writer\nhoodie.cleaner.policy.failed.writes=EAGER\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/concurrency_write.html#_8","title":"\u4e50\u89c2\u5e76\u53d1\u63a7\u5236\u6700\u4f73\u5b9e\u8df5","text":"<p>\u914d\u7f6e\u91cd\u8bd5\u4ee5\u5141\u8bb8\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u83b7\u53d6\u9501\uff1a</p> <ul> <li>\u7f51\u7edc\u8fde\u63a5\u6216\u670d\u52a1\u5668\u8d1f\u8f7d\u8fc7\u5927\u589e\u52a0\u4e86\u83b7\u53d6\u9501\u7684\u65f6\u95f4\uff0c\u4ece\u800c\u5bfc\u81f4\u8d85\u65f6</li> <li>\u8fd0\u884c\u5927\u91cf\u5e76\u53d1\u4f5c\u4e1a\u5199\u5165\u540c\u4e00\u4e2a hudi \u8868\u53ef\u80fd\u4f1a\u5bfc\u81f4\u9501\u83b7\u53d6\u671f\u95f4\u7684\u4e89\u7528\u53ef\u80fd\u5bfc\u81f4\u8d85\u65f6</li> <li>\u5728\u67d0\u4e9b\u51b2\u7a81\u89e3\u51b3\u65b9\u6848\u4e2d\uff0cHudi \u63d0\u4ea4\u64cd\u4f5c\u53ef\u80fd\u9700\u8981\u957f\u8fbe 10 \u79d2\u7684\u65f6\u95f4\uff0c\u540c\u65f6\u6301\u6709\u9501\u3002\u8fd9\u53ef\u80fd\u5bfc\u81f4\u7b49\u5f85\u83b7\u53d6\u9501\u7684\u5176\u4ed6\u4f5c\u4e1a\u8d85\u65f6\u3002</li> </ul> <p>lock provider client retries</p> <pre><code>hoodie.write.lock.wait_time_ms_between_retry\nhoodie.write.lock.num_retries\n</code></pre> <p>hudi client\u7aef\u91cd\u8bd5\u7684\u914d\u7f6e</p> <pre><code>hoodie.write.lock.client.wait_time_ms_between_retry\nhoodie.write.lock.client.num_retries\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/conf.html","title":"Conf","text":""},{"location":"data_system/data_lake/apache_hudi/conf.html#clean","title":"Clean","text":"<ul> <li>hoodie.clean.automatic \uff1a\u9ed8\u8ba4true</li> <li> <p>When enabled, the cleaner table service is invoked immediately after each commit, to delete older file slices. It's recommended to enable this, to ensure metadata and data storage growth is bounded.</p> </li> <li> <p>hoodie.clean.async \uff1a \u9ed8\u8ba4false</p> </li> </ul> <p>\u5199\u5165\u7b56\u7565\uff1a</p> <p><code>write.insert.drop.duplicates</code>\uff1a\u9ed8\u8ba4false\uff0cINSERT\u64cd\u4f5c\u662f\u5426\u4e22\u5f03\u91cd\u590d\u8bb0\u5f55\uff0c\u4e0d\u4e22\u5f03\u4f1a\u63d0\u5347\u6027\u80fd\uff1b</p> <p><code>write.insert.deduplicate</code>\uff1a\u9ed8\u8ba4true\uff0cINSERT\u64cd\u4f5c\u662f\u5426\u53bb\u91cd\uff0c\u4e3afalse\u65f6\u76f4\u63a5\u5199base file\uff1b</p>"},{"location":"data_system/data_lake/apache_hudi/flink.html","title":"Flink Hudi","text":""},{"location":"data_system/data_lake/apache_hudi/flink.html#_1","title":"\u4f7f\u7528","text":""},{"location":"data_system/data_lake/apache_hudi/flink.html#_2","title":"\u5efa\u8868","text":""},{"location":"data_system/data_lake/apache_hudi/flink.html#_3","title":"\u67e5\u8be2","text":""},{"location":"data_system/data_lake/apache_hudi/flink.html#_4","title":"\u95ee\u9898","text":""},{"location":"data_system/data_lake/apache_hudi/flink.html#_5","title":"\u793a\u4f8b","text":""},{"location":"data_system/data_lake/apache_hudi/hudi.html","title":"Apache Hudi","text":"<p>Apache Hudi brings database and data warehouse capabilities to the data lake.</p> <p>Hudi brings transactions, record-level updates/deletes and change streams to data lakes!</p> <p>\u5bf9\u4e8e\u97f3\u9891/\u89c6\u9891\u8fd9\u4e2a\u975e\u7ed3\u6784\u5316\u6570\u636e\uff0c\u8ddf Hudi \u6ca1\u6709\u5173\u7cfb\uff0c\u539f\u59cb\u6570\u636e\u662f\u76f4\u63a5\u5b58\u50a8\u5230 data lake \u4e2d\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_1","title":"\u6570\u636e\u5e93\u7684\u5b58\u50a8\u65b9\u5f0f","text":""},{"location":"data_system/data_lake/apache_hudi/hudi.html#rdbms-b-tree","title":"RDBMS B-Tree","text":"<p>RDBMS\u57fa\u4e8eB-Tree\u7ed3\u6784\uff1a</p> <ul> <li> <p>\u6570\u636e\u5b58\u50a8\u5728\u6570\u636e\u9875\u4e2d\uff0c\u6570\u636e\u9875\u53ef\u4ee5\u901a\u8fc7\u5728\u8868\u7684\u5217\u4e0a\u521b\u5efa\u7684\u7d22\u5f15\u6765\u627e\u5230\uff1b</p> </li> <li> <p>\u5f53\u53d1\u51fa\u66f4\u65b0\u547d\u4ee4\u65f6\uff0cRDBMS\u5f15\u64ce\u4f1a\u627e\u5230\u5305\u542b\u8be5\u8bb0\u5f55\u7684\u786e\u5207\u9875\u9762\uff0c\u5e76\u5728\u8be5\u6570\u636e\u9875\u9762\u4e2d\u9002\u5f53\u5730\u66f4\u65b0\u6570\u636e</p> </li> </ul> <p>\u8fd9\u662f\u4e00\u4e2a\u7b80\u5316\u7684\u63cf\u8ff0\uff0c\u5728\u5927\u591a\u6570\u73b0\u4ee3RDBMS\u5f15\u64ce\u4e2d\uff0c\u5728\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\u7b49\u65b9\u9762\u5b58\u5728\u989d\u5916\u7684\u590d\u6742\u6027\uff0c\u4f46\u57fa\u672c\u601d\u60f3\u4fdd\u6301\u4e0d\u53d8\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#no-sql-lsm-tree","title":"No-SQL LSM-Tree","text":"<p>NoSQL\u6570\u636e\u5e93\u91c7\u7528LSM\u6811\u7ed3\u6784\uff1a</p> <ul> <li> <p>\u57fa\u4e8e\u65e5\u5fd7\u7684\u5b58\u50a8\u6a21\u578b\uff0c\u65b0\u6570\u636e\uff08\u63d2\u5165/\u66f4\u65b0/\u5220\u9664\uff09\u88ab\u6dfb\u52a0\u5230append-only\u7684\u65e5\u5fd7\u4e2d\uff1b</p> </li> <li> <p>\u5b9a\u671f\u5c06\u65e5\u5fd7\u5408\u5e76\u56de\u6570\u636e\u6587\u4ef6\uff0c\u4f7f\u6570\u636e\u6587\u4ef6\u4e0e\u6240\u6709\u66f4\u6539\u7684\u6570\u636e\u4fdd\u6301\u6700\u65b0\uff0c\u8fd9\u79cd\u5408\u5e76\u8fc7\u7a0b\u79f0\u4e3a\u538b\u7f29\uff1b</p> </li> <li> <p>\u5f53\u66f4\u65b0\u4e00\u6761\u8bb0\u5f55\u65f6\uff0c\u53ea\u662f\u5c06\u5176\u5199\u5165\u5230append-only\u65e5\u5fd7\u4e2d\uff0c\u6839\u636e\u6570\u636e\u5e93\u5f15\u64ce\u7684\u4f18\u5316\u89c4\u5219\uff0c\u5c06\u7ec4\u5408append-only\u65e5\u5fd7\u548c\u6570\u636e\u6587\u4ef6\u6765\u4e3a\u8bfb\u53d6\u67e5\u8be2\u63d0\u4f9b\u670d\u52a1\uff1b</p> </li> </ul> <p>\u8fd9\u4e5f\u662f\u4e00\u4e2a\u7b80\u5316\u7684\u63cf\u8ff0\uff0c\u4f46\u57fa\u672c\u601d\u60f3\u76f8\u540c\u3002</p> <p>\u4e0b\u56fe\u8bf4\u660e\u4e86\u5982\u4f55\u5c06\u65b0\u7684\u548c\u66f4\u65b0\u7684\u6570\u636e\u6dfb\u52a0\u5230append-only\u65e5\u5fd7\uff08\u7ea7\u522b0\uff09\u4e2d\uff0c\u5e76\u6700\u7ec8\u5408\u5e76\u5230\u66f4\u5927\u7684\u6587\u4ef6\u4e2d\uff08\u7ea7\u522b1\u548c\u7ea7\u522b2\uff09\u3002</p> <p></p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_2","title":"\u7279\u6027","text":"<ul> <li>\u652f\u6301\u5feb\u901f\u3001\u53ef\u63d2\u62d4\u7d22\u5f15\u7684upsert\u548c\u5220\u9664\uff1b</li> <li>\u589e\u91cf\u67e5\u8be2\uff0c\u8bb0\u5f55\u7ea7\u522b\u66f4\u6539\u6d41\uff1b</li> <li>\u652f\u6301\u4e8b\u52a1\u3001\u56de\u6eda\u3001\u5e76\u53d1\u63a7\u5236\uff1b</li> <li>\u652f\u6301Spark/Presto/Hive/Flink\u7b49SQL\u8bfb\u5199\uff1b</li> <li>\u81ea\u52a8\u8c03\u6574\u6587\u4ef6\u5927\u5c0f\u3001\u6570\u636e\u96c6\u7fa4\u3001\u538b\u7f29\u3001\u6e05\u7406\uff1b</li> <li>\u6d41\u5f0f\u6444\u53d6\uff0c\u5185\u7f6eCDC\u6e90\u548c\u5de5\u5177\uff1b</li> <li>\u7528\u4e8e\u53ef\u6269\u5c55\u5b58\u50a8\u8bbf\u95ee\u7684\u5185\u7f6e\u5143\u6570\u636e\u8ddf\u8e2a\uff1b</li> <li>\u5411\u540e\u517c\u5bb9\u7684\u6a21\u5f0f\u6f14\u53d8\u548c\u5b9e\u65bd\uff08enforcement\uff09\uff1b</li> <li>\u6ee1\u8db3GDPR(\u901a\u7528\u6570\u636e\u4fdd\u62a4\u6761\u4f8b)\u3001\u6570\u636e\u5220\u9664\u529f\u80fd\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_3","title":"\u4f7f\u7528\u573a\u666f","text":"<p>\u5178\u578b\u7528\u6cd5\u662f\u5c06\u4e0a\u6e38\u6570\u636e\u901a\u8fc7 Kafka \u6216\u8005 Sqoop\uff0c\u7ecf\u7531 DeltaStreamer \u5199\u5165 Hudi\u3002</p> <p>DeltaStreamer \u662f\u4e00\u4e2a\u5e38\u9a7b\u670d\u52a1\uff0c\u4e0d\u65ad\u5730\u4ece\u4e0a\u6e38\u62c9\u53d6\u6570\u636e\uff0c\u5e76\u5199\u5165 hudi\u3002</p> <p>\u968f\u7740\u6570\u636e\u4e0d\u65ad\u5199\u5165\uff0c\u4f1a\u6709\u5c0f\u6587\u4ef6\u4ea7\u751f\u3002\u5bf9\u4e8e\u8fd9\u4e9b\u5c0f\u6587\u4ef6\uff0cDeltaStreamer \u53ef\u4ee5\u81ea\u52a8\u5730\u89e6\u53d1\u5c0f\u6587\u4ef6\u5408\u5e76\u7684\u4efb\u52a1\u3002</p> <p>\u67e5\u8be2\u5f15\u64ce\uff0cHudi \u652f\u6301 Hive\u3001Spark\u3001Presto\u3001Flink\u7b49\u3002</p> <p></p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_4","title":"\u8868\u7c7b\u578b","text":"<p>MoR is better suited for write- or change-heavy workloads with fewer reads. </p> <p>CoW is better suited for read-heavy workloads on data that changes less frequently.</p> <p>\u6570\u636e\u5199\u5165\u6548\u7387\uff0c\u5bf9\u4e8ecow\u53camor\u8868\uff0c\u4e0d\u5b58\u5728\u66f4\u65b0\u64cd\u4f5c\u65f6\uff0c\u5199\u5165\u901f\u7387\u63a5\u8fd1\u3002</p> <p>\u4e00\u5f20 Hudi \u6570\u636e\u6e56\u8868\u5177\u5907\u4e24\u79cd\u5f62\u6001\uff1a</p> <p>1\uff09\u8868\u5f62\u6001\uff1a\u67e5\u8be2\u6700\u65b0\u7684\u5feb\u7167\u7ed3\u679c\uff0c\u540c\u65f6\u63d0\u4f9b\u9ad8\u6548\u7684\u5217\u5b58\u683c\u5f0f\u3002</p> <p>2\uff09\u6d41\u5f62\u6001\uff1a\u6d41\u5f0f\u6d88\u8d39\u53d8\u66f4\uff0c\u53ef\u4ee5\u6307\u5b9a\u4efb\u610f\u70b9\u4f4d\u6d41\u8bfb\u4e4b\u540e\u7684 changelog\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#copy-on-write","title":"Copy On Write","text":"<p>\u7c7b\u4f3c\u4e8eRDBMS B-Tree\u66f4\u65b0\uff0c\u4ec5\u4f7f\u7528\u5217\u5f0f\u5b58\u50a8\uff08Parquet\uff09\u6570\u636e\uff0c\u66f4\u65b0\u5199\u5165\u65f6\u505a\u6570\u636e\u7684\u5408\u5e76\uff0c\u66f4\u65b0\u6570\u636e\u7248\u672c\u5e76\u91cd\u5199\u6570\u636e\u6587\u4ef6\uff0c\u5199\u5165\u6027\u80fd\u7565\u5dee\uff0c\u4f46\u662f\u8bfb\u6027\u80fd\u66f4\u9ad8\u4e00\u4e9b\u3002</p> <p>Copy On Write \u7c7b\u578b\u8868\u6bcf\u6b21\u5199\u5165\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u6301\u6709 base file\uff08\u5bf9\u5e94\u5199\u5165\u7684 instant time \uff09 \u7684 FileSlice\u3002</p> <p>\u7528\u6237\u5728 snapshot \u8bfb\u53d6\u7684\u65f6\u5019\u4f1a\u626b\u63cf\u6240\u6709\u6700\u65b0\u7684 FileSlice \u4e0b\u7684 base file\u3002</p> <p></p> <ul> <li>\u66f4\u65b0\uff1a\u5148\u627e\u5230\u5305\u542b\u66f4\u65b0\u6570\u636e\u7684\u6587\u4ef6\uff0c\u7136\u540e\u518d\u4f7f\u7528\u66f4\u65b0\u503c\uff08\u6700\u65b0\u7684\u6570\u636e\uff09\u91cd\u5199\u8be5\u6587\u4ef6\uff0c\u5305\u542b\u5176\u4ed6\u8bb0\u5f55\u7684\u6587\u4ef6\u4fdd\u6301\u4e0d\u53d8\u3002\u5f53\u7a81\u7136\u6709\u5927\u91cf\u5199\u64cd\u4f5c\u65f6\u4f1a\u5bfc\u81f4\u91cd\u5199\u5927\u91cf\u6587\u4ef6\uff0c\u4ece\u800c\u5bfc\u81f4\u6781\u5927\u7684I/O\u5f00\u9500\u3002\uff08TODO\uff1a\u4f1a\u4e0d\u4f1a\u51fa\u73b0\u540c\u65f6\u66f4\u65b0\u540c\u4e00\u4e2a\u6587\u4ef6\u7684\u573a\u666f\uff0c\u5982\u4f55\u4fdd\u8bc1\u4e00\u81f4\u6027\uff1f\uff09</li> <li>\u91cd\u5199\u6587\u4ef6\u65f6\u7684\u903b\u8f91\u662f\u4ec0\u4e48\u6837\uff1f\u5148\u83b7\u53d6\u6240\u6709\u7684\u65e7\u6570\u636e\uff0c\u518d\u66f4\u65b0\uff1f\u5e76\u53d1\u7684\u95ee\u9898\uff1f</li> <li> <p>\u8be5\u6587\u4ef6ID\u7684\u6700\u65b0\u7248\u672c\u90fd\u5c06\u88ab\u91cd\u5199\u4e00\u6b21\uff0c\u5e76\u5bf9\u6240\u6709\u5df2\u66f4\u6539\u7684\u8bb0\u5f55\u4f7f\u7528\u65b0\u503c\uff08\u5565\u610f\u601d\uff1f\uff09</p> </li> <li> <p>\u63d2\u5165\uff1a\u8bb0\u5f55\u9996\u5148\u6253\u5305\u5230\u6bcf\u4e2a\u5206\u533a\u8def\u5f84\u4e2d\u7684\u6700\u5c0f\u6587\u4ef6\u4e2d\uff0c\u76f4\u5230\u8fbe\u5230\u914d\u7f6e\u7684\u6700\u5927\u5927\u5c0f\uff08\u5c0f\u6587\u4ef6\u5408\u5e76\u7b56\u7565\uff09\uff0c\u6240\u6709\u5269\u4f59\u8bb0\u5f55\u5c06\u518d\u6b21\u6253\u5305\u5230\u65b0\u7684\u6587\u4ef6\u7ec4\uff0c\u65b0\u7684\u6587\u4ef6\u7ec4\u4e5f\u4f1a\u6ee1\u8db3\u6700\u5927\u6587\u4ef6\u5927\u5c0f\u8981\u6c42\u3002</p> </li> </ul> <p>3\uff09\u8bfb\u53d6\uff1a\u5728\u8bfb\u53d6\u6570\u636e\u96c6\u65f6\uff0c\u901a\u8fc7\u8bfb\u53d6\u6700\u65b0\u7684\u6570\u636e\u6587\u4ef6\u6765\u83b7\u53d6\u6700\u65b0\u7684\u66f4\u65b0\uff0c\u6b64\u5b58\u50a8\u7c7b\u578b\u9002\u7528\u4e8e\u5c11\u91cf\u66f4\u65b0\u5199\u5165\u548c\u5927\u91cf\u8bfb\u53d6\u7684\u573a\u666f</p> <p></p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#merge-on-read","title":"Merge On Read","text":"<p>MOR is a superset of COW.</p> <p>\u4f7f\u7528\u5217\u5f0f\uff08parquet\uff09\u4e0e\u884c\u5f0f\uff08avro\uff09\u6587\u4ef6\u6df7\u5408\u7684\u65b9\u5f0f\u5b58\u50a8\u6570\u636e\u3002\u5728\u66f4\u65b0\u8bb0\u5f55\u65f6\uff0c\u7c7b\u4f3cNoSQL\u4e2d\u7684LSM-Tree\u66f4\u65b0\u3002</p> <ul> <li> <p>\u5728\u66f4\u65b0\u8bb0\u5f55\u65f6\uff0c\u4ec5\u66f4\u65b0\u5230\u589e\u91cf\u6587\u4ef6\uff08Avro\uff09\u4e2d\uff0c\u7136\u540e\u8fdb\u884c\u5f02\u6b65\uff08\u6216\u540c\u6b65\uff09\u7684compaction\uff0c\u6700\u540e\u521b\u5efa\u5217\u5f0f\u6587\u4ef6\uff08parquet\uff09\u7684\u65b0\u7248\u672c\u3002</p> </li> <li> <p>\u5728\u8bfb\u53d6\u6570\u636e\u96c6\u65f6\uff0c\u9700\u8981\u5148\u5c06\u589e\u91cf\u6587\u4ef6\u4e0e\u65e7\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\uff0c\u7136\u540e\u751f\u6210\u5217\u5f0f\u6587\u4ef6\u6210\u529f\u540e\uff0c\u518d\u8fdb\u884c\u67e5\u8be2\u3002\uff08TODO\uff1a\u5408\u5e76\u65f6\u4e0ecompaction\u4f1a\u6709\u51b2\u7a81\u4e48\uff1f\uff09</p> </li> <li>\u6b64\u5b58\u50a8\u7c7b\u578b\u9002\u5408\u9891\u7e41\u5199\u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u56e0\u4e3a\u65b0\u8bb0\u5f55\u662f\u4ee5\u8ffd\u52a0\u7684\u6a21\u5f0f\u5199\u5165\u589e\u91cf\u6587\u4ef6\u4e2d\u3002</li> </ul> <p>\u5199\u5165\u884c\u4e3a\uff0c\u4f9d\u636e index \u7684\u4e0d\u540c\u4f1a\u6709\u7ec6\u5fae\u7684\u5dee\u522b\uff1a</p> <p>1\uff09\u63d2\u5165log\u6587\u4ef6\uff1a\u53ef\u4ee5\u5bf9 log file \u751f\u6210 index \u7684\u7d22\u5f15\u65b9\u6848\uff0c\u5982Flink state \u7d22\u5f15 \u548c HBase \u7d22\u5f15\uff0c\u6bcf\u6b21\u5199\u5165\u90fd\u662f log format\uff0c\u5e76\u4e14\u4f1a\u4e0d\u65ad\u8ffd\u52a0\u548c roll over\u3002</p> <p>2\uff09\u63d2\u5165parquet\u6587\u4ef6\uff1a\u5bf9\u4e8e BloomFilter \u8fd9\u79cd\u65e0\u6cd5\u5bf9 log file \u751f\u6210 index \u7684\u7d22\u5f15\u65b9\u6848\uff0c\u5bf9\u4e8e INSERT \u6d88\u606f\u4ecd\u7136\u4f1a\u5199 base file \uff08parquet \uff09\uff0c\u53ea\u6709 UPDATE \u6d88\u606f\u4f1a append log \u6587\u4ef6\uff08\u56e0\u4e3a base file \u5df2\u7ecf\u8bb0\u5f55\u4e86\u8be5 UPDATE \u6d88\u606f\u7684 FileGroup ID\uff09</p> <p></p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_5","title":"\u5bf9\u6bd4","text":"Trade-off CopyOnWrite MergeOnRead Data Latency Higher Lower Update cost (I/O) Higher (rewrite entire parquet) Lower (append to delta log) Parquet File Size Smaller (high update(I/O) cost) Larger (low update cost) Write Amplification Higher Lower (depending on compaction strategy)"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_6","title":"\u4e3b\u952e\u548c\u5206\u533a","text":"<p>\u57fa\u672c\u7684\u6982\u5ff5\uff1a</p> <ul> <li>\u8bb0\u5f55\u952e\uff08 record key \uff09\uff1a<code>hoodie.datasource.write.recordkey.field</code></li> <li>\u5206\u533a\u8def\u5f84\uff08partition path\uff09\uff1a<code>hoodie.datasource.write.partitionpath.field</code></li> <li>Hoodie Key\uff1arecord key + partition path\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#key","title":"Key\u751f\u6210\u7b56\u7565","text":"<p>\u7528\u6765\u751f\u6210 HoodieKey\uff08record key + partition path\uff09\uff0c\u76ee\u524d\u652f\u6301\u4ee5\u4e0b\u7b56\u7565\uff1a</p> <ul> <li>\u652f\u6301\u591a\u4e2a\u5b57\u6bb5\u7ec4\u5408 record keys</li> <li> <p>\u652f\u6301\u591a\u4e2a\u5b57\u6bb5\u7ec4\u5408\u7684 parition path \uff08\u53ef\u5b9a\u5236\u65f6\u95f4\u683c\u5f0f\uff0c\u652f\u6301Hive style path name\uff09</p> </li> <li> <p>\u975e\u5206\u533a\u8868</p> </li> </ul> <p>\u5177\u4f53\u7684\u751f\u6210\u7b56\u7565\u89c1\u4e3b\u952e\u548c\u5206\u533a\u914d\u7f6e</p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_7","title":"\u5220\u9664\u7b56\u7565","text":"<ul> <li>\u903b\u8f91\u5220\uff1a\u5c06 value \u5b57\u6bb5\u5168\u90e8\u6807\u8bb0\u4e3a null</li> <li>\u7269\u7406\u5220\uff1a</li> <li>\u901a\u8fc7 <code>OPERATION_OPT_KEY</code> \u5220\u9664\u6240\u6709\u7684\u8f93\u5165\u8bb0\u5f55</li> <li>\u914d\u7f6e <code>PAYLOAD_CLASS_OPT_KEY = org.apache.hudi.EmptyHoodieRecordPayload</code> \u5220\u9664\u6240\u6709\u7684\u8f93\u5165\u8bb0\u5f55</li> <li>\u5728\u8f93\u5165\u8bb0\u5f55\u6dfb\u52a0\u5b57\u6bb5\uff1a<code>_hoodie_is_deleted</code></li> </ul>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_8","title":"\u7ec4\u4ef6","text":"<p>\u8868\u683c\u5f0f\u7b80\u5355\u5730\u5305\u62ec\uff1a\u8868\u7684\u6587\u4ef6\u5e03\u5c40\u3001\u8868\u7684\u6a21\u5f0f\u548c\u8ddf\u8e2a\u8868\u66f4\u6539\u7684\u5143\u6570\u636e\u3002</p> <ul> <li>\u5c06\u8868/\u5206\u533a\u7684\u6587\u4ef6\uff0c\u5212\u5206\u6210\u7ec4\uff0c\u5e76\u4e14\u7ef4\u62a4record key\u5230\u5df2\u7ecf\u5b58\u5728\u7684\u6587\u4ef6\u7ec4\u7684\u6620\u5c04\uff0c\u6240\u6709\u7684\u66f4\u65b0\u8bb0\u5f55\u5230\u5bf9\u5e94\u7684\u6587\u4ef6\u7ec4\u7684delta log\u6587\u4ef6\u4e2d</li> <li>\u5206\u7ec4\u964d\u4f4e\u5408\u5e76\u5f00\u9500\uff0cdelta records\u53ea\u9700\u8981\u5408\u5e76\u5bf9\u5e94\u7684\u6587\u4ef6\u7ec4\u4e2d\u7684base file\uff1b</li> <li>\u4e0e\u72b6\u6001\u5b58\u50a8\u975e\u5e38\u76f8\u4f3c\uff0cHudi\u7684\u8bbe\u8ba1\u9884\u671f\u5feb\u901f\u7684\u57fa\u4e8e\u952e\u7684upserts/delete\uff0c\u5e76\u53ea\u9700\u8981\u5408\u5e76\u6bcf\u4e2a\u6587\u4ef6\u7ec4\u4e2d\u7684delta\u65e5\u5fd7\u3002</li> </ul> <p>\u4e09\u4e2a\u4e3b\u8981\u7ec4\u4ef6\uff1a</p> <p>1\uff09  \u6709\u5e8f\u7684\u65f6\u95f4\u8f74\u5143\u6570\u636e\uff1a\u7c7b\u4f3c\u4e8e\u6570\u636e\u5e93\u4e8b\u52a1\u65e5\u5fd7\u3002</p> <p>2\uff09  \u5206\u5c42\u5e03\u5c40\u7684\u6570\u636e\u6587\u4ef6\uff1a\u5b9e\u9645\u5199\u5165\u8868\u4e2d\u7684\u6570\u636e\u3002</p> <p>3\uff09  \u7d22\u5f15\uff08\u591a\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff09\uff1a\u6620\u5c04\u5305\u542b\u6307\u5b9a\u8bb0\u5f55\u7684\u6570\u636e\u96c6\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#timeline","title":"\u65f6\u95f4\u8f74\uff08Timeline\uff09","text":"<p>\u65f6\u95f4\u8f74\u662f\u6240\u6709 Hudi \u8868\u5143\u6570\u636e\u7684\u4e8b\u4ef6\u65e5\u5fd7\uff0c\u5b58\u50a8\u5728<code>.hoodie</code>\u6587\u4ef6\u5939\u4e0b\uff0c\u5b83\u63d0\u4f9b\u4e86\u5728\u8868\u4e0a\u6267\u884c\u7684\u6240\u6709\u64cd\u4f5c\u7684\u6709\u5e8f\u65e5\u5fd7\u3002</p> <ul> <li>\u4e8b\u4ef6\u5c06\u4fdd\u7559\u5728\u65f6\u95f4\u8f74\u4e0a\uff0c\u76f4\u5230\u914d\u7f6e\u7684\u65f6\u95f4/\u6d3b\u52a8\u95f4\u9694\uff1b</li> <li>\u6bcf\u4e2a\u6587\u4ef6\u7ec4\u4e5f\u8bbe\u8ba1\u6210\u5b83\u81ea\u5df1\u7684\u72ec\u7acb\u7684\u65e5\u5fd7\uff1b</li> <li>\u9650\u5236\u5143\u6570\u636e\u7684\u5927\u5c0f\uff0c\u4e0e\u8868\u88ab\u5199\u5165/\u64cd\u4f5c\u7684\u9891\u7387\u6210\u6b63\u6bd4\uff0c\u4e0e\u6574\u4e2a\u8868\u7684\u5927\u5c0f\u65e0\u5173\uff1b</li> <li>\u6700\u65b0\u7684instant\u88ab\u4fdd\u5b58\u4e3a\u5355\u4e2a\u6587\u4ef6\uff0c\u800c\u8f83\u65e7\u7684instant\u88ab\u5b58\u6863\u5230\u65f6\u95f4\u8f74\u5f52\u6863\u6587\u4ef6\u5939\u4e2d\uff0c\u4ee5\u9650\u5236writers\u548cqueries\u5217\u51fa\u7684\u6587\u4ef6\u6570\u91cf\u3002</li> <li>\u65f6\u95f4\u8f74\u4e0a\u7684\u65b0\u4e8b\u4ef6\u88ab\u6d88\u8017\u5e76\u53cd\u6620\u5230\u4e00\u4e2a\u5185\u90e8\u5143\u6570\u636e\u8868\u4e0a\uff08MOR\u5b9e\u73b0\uff09\uff1a</li> <li>\u4f7f\u7528 HFile \u683c\u5f0f\uff0c\u63d0\u4f9b\u952e\u7684\u7d22\u5f15\u67e5\u627e\uff0c\u4e0d\u9700\u8981\u8bfb\u53d6\u6574\u4e2a\u5143\u6570\u636e\u8868\uff1b</li> <li>\u5b58\u50a8\u8868\u7684\u6240\u6709\u7684\u7269\u7406\u8def\u5f84\uff0c\u907f\u514d\u5bf9\u8c61\u5b58\u50a8\u7684list\u5f00\u9500\uff1b</li> </ul> <p>Timeline \u662f Hudi \u7528\u6765\u7ba1\u7406\u63d0\u4ea4\uff08commit\uff09\u7684\u62bd\u8c61\uff0c\u6bcf\u4e2a commit \u90fd\u7ed1\u5b9a\u4e00\u4e2a\u56fa\u5b9a\u65f6\u95f4\u6233\uff0c\u5206\u6563\u5230\u65f6\u95f4\u7ebf\u4e0a\u3002\u5728 Timeline \u4e0a\uff0c\u6bcf\u4e2a commit \u88ab\u62bd\u8c61\u4e3a\u4e00\u4e2a HoodieInstant\uff0c\u4e00\u4e2a instant \u8bb0\u5f55\u4e86\u4e00\u6b21\u63d0\u4ea4 (commit) \u7684\u884c\u4e3a\u3001\u65f6\u95f4\u6233\u3001\u548c\u72b6\u6001\u3002</p> <p>Hudi \u7684\u8bfb\u5199 API \u901a\u8fc7 Timeline \u7684\u63a5\u53e3\u53ef\u4ee5\u65b9\u4fbf\u7684\u5728 commits \u4e0a\u8fdb\u884c\u6761\u4ef6\u7b5b\u9009\uff0c\u5bf9 history \u548c on-going \u7684 commits \u5e94\u7528\u5404\u79cd\u7b56\u7565\uff0c\u5feb\u901f\u7b5b\u9009\u51fa\u9700\u8981\u64cd\u4f5c\u7684\u76ee\u6807 commit\u3002</p> <p>Hudi \u65f6\u95f4\u8f74instant\u7531\u4e0b\u9762\u51e0\u4e2a\u7ec4\u4ef6\u6784\u6210\uff1a</p> <p>1\uff09  \u64cd\u4f5c\u7c7b\u578b\uff1a\u5bf9\u6570\u636e\u96c6\u6267\u884c\u7684\u64cd\u4f5c\u7c7b\u578b\uff1b</p> <p>2\uff09  \u5373\u65f6\u65f6\u95f4\uff1a\u5373\u65f6\u65f6\u95f4\u901a\u5e38\u662f\u4e00\u4e2a\u65f6\u95f4\u6233(\u4f8b\u5982\uff1a20190117010349)\uff0c\u8be5\u65f6\u95f4\u6233\u6309\u64cd\u4f5c\u5f00\u59cb\u65f6\u95f4\u7684\u987a\u5e8f\u5355\u8c03\u589e\u52a0\uff1b</p> <p>3\uff09  \u5373\u65f6\u72b6\u6001\uff1ainstant\u7684\u5f53\u524d\u72b6\u6001;</p> <p>\u6bcf\u4e2ainstant\u90fd\u6709avro\u6216\u8005json\u683c\u5f0f\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u8be6\u7ec6\u7684\u63cf\u8ff0\u4e86\u8be5\u64cd\u4f5c\u7684\u72b6\u6001\u4ee5\u53ca\u8fd9\u4e2a\u5373\u65f6\u65f6\u523binstant\u7684\u72b6\u6001\u3002</p> <p>\u5173\u952e\u7684Instant\u64cd\u4f5c\u7c7b\u578b\u6709\uff1a</p> <p>1\uff09  COMMIT\uff1a\u4e00\u6b21\u63d0\u4ea4\u8868\u793a\u5c06\u4e00\u7ec4\u8bb0\u5f55\u539f\u5b50\u5199\u5165\u5230\u6570\u636e\u96c6\u4e2d\uff1b</p> <p>2\uff09  CLEAN\uff1a\u5220\u9664\u6570\u636e\u96c6\u4e2d\u4e0d\u518d\u9700\u8981\u7684\u65e7\u6587\u4ef6\u7248\u672c\u7684\u540e\u53f0\u6d3b\u52a8\uff1b</p> <p>3\uff09  DELTA_COMMIT\uff1a\u5c06\u4e00\u6279\u8bb0\u5f55\u539f\u5b50\u5199\u5165\u5230MergeOnRead\u5b58\u50a8\u7c7b\u578b\u7684\u6570\u636e\u96c6\u4e2d\uff0c\u5176\u4e2d\u4e00\u4e9b/\u6240\u6709\u6570\u636e\u90fd\u53ef\u4ee5\u53ea\u5199\u5230\u589e\u91cf\u65e5\u5fd7\u4e2d\uff1b</p> <p>4\uff09  COMPACTION\uff1a\u534f\u8c03Hudi\u4e2d\u5dee\u5f02\u6570\u636e\u7ed3\u6784\u7684\u540e\u53f0\u6d3b\u52a8\uff0cMOR\u8868\u7684delta log\u4e0ebase file\u7684\u5408\u5e76\u3002\u5728\u5185\u90e8\uff0c\u538b\u7f29\u8868\u73b0\u4e3a\u65f6\u95f4\u8f74\u4e0a\u7684\u7279\u6b8a\u63d0\u4ea4\uff1b</p> <p>5\uff09  ROLLBACK\uff1a\u8868\u793a\u63d0\u4ea4/\u589e\u91cf\u63d0\u4ea4\u4e0d\u6210\u529f\u4e14\u5df2\u56de\u6eda\uff0c\u5220\u9664\u5728\u5199\u5165\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u6240\u6709\u90e8\u5206\u6587\u4ef6\uff1b</p> <p>6\uff09  SAVEPOINT\uff1a\u5c06\u67d0\u4e9b\u6587\u4ef6\u7ec4\u6807\u8bb0\u4e3a\"\u5df2\u4fdd\u5b58\"\uff0c\u4ee5\u4fbf\u6e05\u7406\u7a0b\u5e8f\u4e0d\u4f1a\u5c06\u5176\u5220\u9664\u3002\u5728\u53d1\u751f\u707e\u96be/\u6570\u636e\u6062\u590d\u7684\u60c5\u51b5\u4e0b\uff0c\u5b83\u6709\u52a9\u4e8e\u5c06\u6570\u636e\u96c6\u8fd8\u539f\u5230\u65f6\u95f4\u8f74\u4e0a\u7684\u67d0\u4e2a\u70b9\uff1b</p> <p>\u4efb\u4f55\u7ed9\u5b9a\u7684\u5373\u65f6\u90fd\u4f1a\u5904\u4e8e\u4ee5\u4e0b\u72b6\u6001\u4e4b\u4e00\uff1a</p> <p>1\uff09  REQUESTED\uff1a\u8868\u793a\u5df2\u8c03\u5ea6\u4f46\u5c1a\u672a\u521d\u59cb\u5316\uff1b</p> <p>2\uff09  INFLIGHT\uff1a\u8868\u793a\u5f53\u524d\u6b63\u5728\u6267\u884c\u8be5\u64cd\u4f5c\uff1b</p> <p>3\uff09  COMPLETED\uff1a\u8868\u793a\u5728\u65f6\u95f4\u8f74\u4e0a\u5b8c\u6210\u4e86\u8be5\u64cd\u4f5c\u3002</p> <p>\u5b58\u50a8\u6839\u636e\u65f6\u95f4\u53d1\u751f\u65f6\u95f4\uff08Event time\uff09,\u67e5\u8be2\u6839\u636e\uff08Arrival time\uff09</p> <ul> <li> <p>Arrival time: \u6570\u636e\u5230\u8fbe Hudi \u7684\u65f6\u95f4\uff0ccommit time</p> </li> <li> <p>Event time: record \u4e2d\u8bb0\u5f55\u7684\u65f6\u95f4</p> </li> </ul> <p></p> <p>\u4ece 10:00 \u5f00\u59cb\u9646\u7eed\u4ea7\u751f\u5404\u79cd commits\uff0c10:20 \u6765\u4e86\u4e00\u6761 9:00 \u7684\u6570\u636e\uff0c\u8be5\u6570\u636e\u4ecd\u7136\u53ef\u4ee5\u843d\u5230 9:00 \u5bf9\u5e94\u7684\u5206\u533a\uff0c\u901a\u8fc7 timeline \u76f4\u63a5\u6d88\u8d39 10:00 \u4e4b\u540e\u7684\u589e\u91cf\u66f4\u65b0\uff08\u53ea\u6d88\u8d39\u6709\u65b0 commits \u7684 group\uff09\uff0c\u90a3\u4e48\u8fd9\u6761\u5ef6\u8fdf\u7684\u6570\u636e\u4ecd\u7136\u53ef\u4ee5\u88ab\u6d88\u8d39\u5230\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_9","title":"\u6570\u636e\u6587\u4ef6","text":"<p>Hudi \u5c06\u8868\u7ec4\u7ec7\u6210 DFS\u4e0a \u57fa\u672c\u8def\u5f84\u4e0b\u7684\u6587\u4ef6\u5939\u7ed3\u6784\u4e2d\uff1a</p> <ul> <li>\u5982\u679c\u8868\u5206\u533a\uff0c\u5219\u5728\u57fa\u672c\u8def\u5f84\u4e0b\u8fd8\u4f1a\u6709\u5176\u4ed6\u7684\u5206\u533a\uff0c\u8fd9\u4e9b\u5206\u533a\u662f\u5305\u542b\u8be5\u5206\u533a\u6570\u636e\u7684\u6587\u4ef6\u5939\uff0c\u4e0eHive\u8868\u975e\u5e38\u7c7b\u4f3c\uff1b</li> <li>\u5206\u533a\u7531\u5206\u533a\u8def\u5f84\u552f\u4e00\u6807\u8bc6\uff0c\u5728\u6bcf\u4e2a\u5206\u533a\u5185\uff0c\u6587\u4ef6\u88ab\u7ec4\u7ec7\u6210\u6587\u4ef6\u7ec4\uff0c\u7531\u552f\u4e00ID\u6807\u8bc6\uff1b</li> <li>\u6bcf\u4e2a\u6587\u4ef6\u7ec4\u7531\u591a\u4e2a\u6587\u4ef6\u5207\u7247\uff08file slice\uff09\u6784\u6210\uff0c\u5207\u7247\u7531 \u57fa\u672c\u6587\u4ef6\uff08parquet\uff09\u548c\u589e\u91cf\u6587\u4ef6\uff08log\uff0cMOR\u8868\uff09\u6784\u6210\uff1b</li> <li>\u6bcf\u4e2a\u6587\u4ef6\u7684\u6587\u4ef6\u540d\u90fd\u5e26\u6709\u5176\u5f52\u5c5e\u7684 FileID\uff08\u5373 FileGroup Identifier\uff09\u548c base commit time\uff08\u5373 InstanceTime\uff09\u3002</li> <li>\u901a\u8fc7\u6587\u4ef6\u540d\u7684 FileID \u7ec4\u7ec7 FileGroup \u7684 logical \u5173\u7cfb\uff1b\u901a\u8fc7\u6587\u4ef6\u540d\u7684 base commit time \u7ec4\u7ec7 FileSlice \u7684\u903b\u8f91\u5173\u7cfb\u3002</li> </ul> <p></p> <p>\u4e00\u4e2a\u65b0\u7684 base commit time \u5bf9\u5e94\u4e00\u4e2a\u65b0\u7684 FileSlice\uff0c\u5b9e\u9645\u5c31\u662f\u4e00\u4e2a\u65b0\u7684\u6570\u636e\u7248\u672c\u3002</p> <p>HUDI \u901a\u8fc7 TableFileSystemView \u62bd\u8c61\u6765\u7ba1\u7406 table \u5bf9\u5e94\u7684\u6587\u4ef6\uff1a</p> <ul> <li>\u627e\u5230\u6240\u6709\u6700\u65b0\u7248\u672c FileSlice \u4e2d\u7684 base file \uff08Copy On Write Snapshot \u8bfb\uff09\u6216\u8005 base + log files\uff08Merge On Read \u8bfb)\uff1b</li> <li>\u901a\u8fc7 Timeline \u548c TableFileSystemView \u62bd\u8c61\uff0cHUDI \u5b9e\u73b0\u4e86\u975e\u5e38\u4fbf\u6377\u548c\u9ad8\u6548\u7684\u8868\u6587\u4ef6\u67e5\u627e\u3002</li> </ul> <p>Hudi\u91c7\u7528\u4e86MVCC\u8bbe\u8ba1\uff0c\u538b\u7f29\u64cd\u4f5c\u4f1a\u5c06\u65e5\u5fd7\u548c\u57fa\u672c\u6587\u4ef6\u5408\u5e76\u4ee5\u4ea7\u751f\u65b0\u7684\u6587\u4ef6\u7247\uff0c\u800c\u6e05\u7406\u64cd\u4f5c\u5219\u5c06\u672a\u4f7f\u7528\u7684/\u8f83\u65e7\u7684\u6587\u4ef6\u7247\u5220\u9664\u4ee5\u56de\u6536DFS\u4e0a\u7684\u7a7a\u95f4\u3002</p> <p></p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_10","title":"\u7d22\u5f15","text":"<p>\u8be6\u7ec6\u5185\u5bb9\u89c1 Hudi \u7d22\u5f15\u6280\u672f</p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_11","title":"\u5199\u5165\u6a21\u5f0f","text":"<ul> <li>UPSERT\uff1a\u9ed8\u8ba4\u884c\u4e3a\uff0c\u6570\u636e\u5148\u901a\u8fc7 index \u6253\u6807(INSERT/UPDATE)\uff0c\u6709\u4e00\u4e9b\u542f\u53d1\u5f0f\u7b97\u6cd5\u51b3\u5b9a\u6d88\u606f\u7684\u7ec4\u7ec7\u4ee5\u4f18\u5316\u6587\u4ef6\u7684\u5927\u5c0f =&gt; CDC \u5bfc\u5165\uff1b</li> <li>INSERT\uff1a\u8df3\u8fc7 index\uff0c\u5199\u5165\u6548\u7387\u66f4\u9ad8 =&gt; Log Deduplication\uff1b</li> <li>BULK_INSERT\uff1a\u5199\u6392\u5e8f\uff0c\u5bf9\u5927\u6570\u636e\u91cf\u7684 Hudi \u8868\u521d\u59cb\u5316\u53cb\u597d\uff0c\u5bf9\u6587\u4ef6\u5927\u5c0f\u7684\u9650\u5236 best effort\uff08\u5199 HFile\uff09\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#upsert","title":"UpSert","text":""},{"location":"data_system/data_lake/apache_hudi/hudi.html#cow","title":"COW","text":"<ul> <li>\u5148\u5bf9 records \u6309\u7167 record key \u53bb\u91cd\uff1b</li> <li>\u9996\u5148\u5bf9\u8fd9\u6279\u6570\u636e\u521b\u5efa\u7d22\u5f15 (HoodieKey =&gt; HoodieRecordLocation)\uff1b\u901a\u8fc7\u7d22\u5f15\u533a\u5206\u54ea\u4e9b records \u662f update\uff0c\u54ea\u4e9b records \u662f insert\uff08key \u7b2c\u4e00\u6b21\u5199\u5165\uff09\uff1b</li> <li>\u5bf9\u4e8e update \u6d88\u606f\uff0c\u4f1a\u76f4\u63a5\u627e\u5230\u5bf9\u5e94 key \u6240\u5728\u7684\u6700\u65b0 FileSlice \u7684 base \u6587\u4ef6\uff0c\u5e76\u505a merge \u540e\u5199\u65b0\u7684 base file (\u65b0\u7684 FileSlice)\uff1b</li> <li>\u5bf9\u4e8e insert \u6d88\u606f\uff0c\u4f1a\u626b\u63cf\u5f53\u524d partition \u7684\u6240\u6709 SmallFile\uff08\u5c0f\u4e8e\u4e00\u5b9a\u5927\u5c0f\u7684 base file\uff09\uff0c\u7136\u540e merge \u5199\u65b0\u7684 FileSlice\uff1b\u5982\u679c\u6ca1\u6709 SmallFile\uff0c\u76f4\u63a5\u5199\u65b0\u7684 FileGroup + FileSlice\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#mor","title":"MOR","text":"<ul> <li>\u5148\u5bf9 records \u6309\u7167 record key \u53bb\u91cd\uff08\u53ef\u9009\uff09</li> <li>\u9996\u5148\u5bf9\u8fd9\u6279\u6570\u636e\u521b\u5efa\u7d22\u5f15 (HoodieKey =&gt; HoodieRecordLocation)\uff1b\u901a\u8fc7\u7d22\u5f15\u533a\u5206\u54ea\u4e9b records \u662f update\uff0c\u54ea\u4e9b records \u662f insert\uff08key \u7b2c\u4e00\u6b21\u5199\u5165\uff09</li> <li>\u5982\u679c\u662f insert \u6d88\u606f\uff1a</li> <li>\u5982\u679c log file \u4e0d\u53ef\u5efa\u7d22\u5f15\uff08\u9ed8\u8ba4\uff09\uff0c\u4f1a\u5c1d\u8bd5 merge \u5206\u533a\u5185\u6700\u5c0f\u7684 base file \uff08\u4e0d\u5305\u542b log file \u7684 FileSlice\uff09\uff0c\u751f\u6210\u65b0\u7684 FileSlice\uff1b\u5982\u679c\u6ca1\u6709 base file \u5c31\u65b0\u5199\u4e00\u4e2a FileGroup + FileSlice + base file\uff1b</li> <li>\u5982\u679c log file \u53ef\u5efa\u7d22\u5f15\uff0c\u5c1d\u8bd5 append \u5c0f\u7684 log file\uff0c\u5982\u679c\u6ca1\u6709\u5c31\u65b0\u5199\u4e00\u4e2a FileGroup + FileSlice + base file\uff1b</li> <li>\u5982\u679c\u662f update \u6d88\u606f\uff0c\u5199\u5bf9\u5e94\u7684 file group + file slice\uff0c\u76f4\u63a5 append \u6700\u65b0\u7684 log file\uff08\u5982\u679c\u78b0\u5de7\u662f\u5f53\u524d\u6700\u5c0f\u7684\u5c0f\u6587\u4ef6\uff0c\u4f1a merge base file\uff0c\u751f\u6210\u65b0\u7684 file slice\uff09\uff0clog file \u5927\u5c0f\u8fbe\u5230\u9608\u503c\u4f1a roll over \u4e00\u4e2a\u65b0\u7684</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#insert","title":"Insert","text":""},{"location":"data_system/data_lake/apache_hudi/hudi.html#cow_1","title":"COW","text":"<ul> <li>\u5148\u5bf9 records \u6309\u7167 record key \u53bb\u91cd\uff08\u53ef\u9009\uff0c<code>write.insert.deduplicate</code>\uff09</li> <li> <p>\u4e0d\u4f1a\u521b\u5efa Index</p> </li> <li> <p>\u5982\u679c\u6709\u5c0f\u7684 base file \u6587\u4ef6\uff0cmerge base file\uff0c\u751f\u6210\u65b0\u7684 FileSlice + base file\uff0c\u5426\u5219\u76f4\u63a5\u5199\u65b0\u7684 FileSlice + base file </p> </li> </ul>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#mor_1","title":"MOR","text":"<ul> <li>\u5148\u5bf9 records \u6309\u7167 record key \u53bb\u91cd\uff08\u53ef\u9009\uff0c<code>write.insert.deduplicate</code>\uff09</li> <li> <p>\u4e0d\u4f1a\u521b\u5efa Index</p> </li> <li> <p>\u5982\u679c log file \u53ef\u7d22\u5f15\uff0c\u5e76\u4e14\u6709\u5c0f\u7684 FileSlice\uff0c\u5c1d\u8bd5\u8ffd\u52a0\u6216\u5199\u6700\u65b0\u7684 log file\uff1b\u5982\u679c log file \u4e0d\u53ef\u7d22\u5f15\uff0c\u5199\u4e00\u4e2a\u65b0\u7684 FileSlice + base file </p> </li> </ul>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#bulk-insert","title":"Bulk Insert","text":"<p>Hudi\u652f\u6301<code>bulk_insert</code>\u64cd\u4f5c\u6765\u5c06\u6570\u636e\u521d\u59cb\u5316\u81f3Hudi\u8868\u4e2d\uff0c\u8be5\u64cd\u4f5c\u76f8\u6bd4<code>insert</code>\u548c<code>upsert</code>\u64cd\u4f5c\u901f\u5ea6\u66f4\u5feb\uff0c\u6548\u7387\u66f4\u9ad8\u3002<code>bulk_insert</code>\u4e0d\u4f1a\u67e5\u770b\u5df2\u5b58\u5728\u6570\u636e\u7684\u5f00\u9500\u5e76\u4e14\u4e0d\u4f1a\u8fdb\u884c\u5c0f\u6587\u4ef6\u4f18\u5316\u3002</p> <p>\u8be6\u7ec6\u4ecb\u7ecd\u89c1Bulk Insert\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_12","title":"\u67e5\u8be2","text":"<p>\u67e5\u8be2\u6027\u80fd\uff0c\u4e00\u822c\u9700\u6c42\u662f\u6839\u636e\u67e5\u8be2\u8c13\u8bcd\u751f\u6210\u8fc7\u6ee4\u6761\u4ef6\u4e0b\u63a8\u81f3 datasource\u3002Hudi \u8fd9\u65b9\u9762\u6ca1\u600e\u4e48\u505a\u5de5\u4f5c\uff0c\u5176\u6027\u80fd\u5b8c\u5168\u57fa\u4e8e\u5f15\u64ce\u81ea\u5e26\u7684\u8c13\u8bcd\u4e0b\u63a8\u548c partition prune \u529f\u80fd\u3002</p> <p>\u652f\u6301\u7684\u67e5\u8be2\u7c7b\u578b</p> Table Type Supported Query types Copy On Write Snapshot Queries + Incremental Queries Merge On Read Snapshot Queries + Incremental Queries + Read Optimized Queries <p>MOR\u8868\u7684Snapshot\u548c\u8bfb\u4f18\u5316\u67e5\u8be2\u7684\u5bf9\u6bd4</p> Trade-off Snapshot Read Optimized Data Latency Lower Higher Query Latency Higher (merge base / columnar file + row based delta / log files) Lower (raw base / columnar file performance) <p></p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_13","title":"\u5feb\u7167\u67e5\u8be2","text":"<p>\u7ed9\u5b9adelta commit\u6216\u8005commit\u5373\u65f6\u64cd\u4f5c\u540e\u8868\u7684\u6700\u65b0\u5feb\u7167\uff0c\u8bfb\u53d6\u6240\u6709 partiiton \u4e0b\u6bcf\u4e2a FileGroup \u6700\u65b0\u7684 FileSlice \u4e2d\u7684\u6587\u4ef6\uff1a</p> <ul> <li>Copy On Write \u8868\u8bfb parquet \u6587\u4ef6\uff1b</li> <li>Merge On Read \u8868\u8bfb parquet + log \u6587\u4ef6\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_14","title":"\u589e\u91cf\u67e5\u8be2","text":"<p>\u81ea\u7ed9\u5b9acommit/delta commit\u5373\u65f6\u64cd\u4f5c\u4ee5\u6765\u65b0\u5199\u5165\u7684\u6570\u636e</p> <ul> <li>COW\uff1a\u5728\u7ed9\u5b9a\u7684\u5f00\u59cb\uff0c\u7ed3\u675f\u5373\u65f6\u65f6\u95f4\u8303\u56f4\u5185\uff0c\u5bf9\u6700\u65b0\u7684\u57fa\u672c\u6587\u4ef6\u6267\u884c\u67e5\u8be2\uff08\u79f0\u4e3a\u589e\u91cf\u67e5\u8be2\u7a97\u53e3\uff09</li> <li>MOR\uff1a\u5728\u589e\u91cf\u67e5\u8be2\u7a97\u53e3\u4e2d\u5bf9\u6700\u65b0\u7684\u6587\u4ef6\u7247\u6267\u884c\uff0c\u53d6\u51b3\u4e8e\u7a97\u53e3\u672c\u8eab\uff0c\u8bfb\u53d6\u57fa\u672c\u5757\u6216\u65e5\u5fd7\u5757\u4e2d\u8bfb\u53d6\u8bb0\u5f55\u7684\u7ec4\u5408\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#streaming","title":"Streaming \u8bfb","text":"<p>0.8.0 \u7248\u672c\u7684 HUDI Flink writer \u652f\u6301\u5b9e\u65f6\u7684\u589e\u91cf\u8ba2\u9605\uff0c\u53ef\u7528\u4e8e\u540c\u6b65 CDC \u6570\u636e\uff0c\u65e5\u5e38\u7684\u6570\u636e\u540c\u6b65 ETL pipeline\u3002Flink \u7684 streaming \u8bfb\u505a\u5230\u4e86\u771f\u6b63\u7684\u6d41\u5f0f\u8bfb\u53d6\uff0csource \u5b9a\u671f\u76d1\u63a7\u65b0\u589e\u7684\u6539\u52a8\u6587\u4ef6\uff0c\u5c06\u8bfb\u53d6\u4efb\u52a1\u4e0b\u6d3e\u7ed9\u8bfb task\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_15","title":"\u8bfb\u4f18\u5316\u67e5\u8be2","text":"<p>\u8bfb\u4f18\u5316\u67e5\u8be2\u4ec5\u9488\u5bf9MOR\uff08\u56e0\u4e3aCOW\u6ca1\u6709Compaction\uff09</p> <ul> <li>MOR \uff1a\u4ec5\u8bbf\u95ee\u57fa\u672c\u6587\u4ef6\uff0c\u63d0\u4f9b\u7ed9\u5b9a\u6587\u4ef6\u7247\u81ea\u4e0a\u6b21\u6267\u884c\u538b\u7f29\u64cd\u4f5c\u4ee5\u6765\u7684\u6570\u636e\u3002\u901a\u5e38\u67e5\u8be2\u6570\u636e\u7684\u6700\u65b0\u7a0b\u5ea6\u7684\u4fdd\u8bc1\u53d6\u51b3\u4e8e\u538b\u7f29\u7b56\u7565</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_16","title":"\u8868\u670d\u52a1","text":"<p>\u6570\u636e\u5e93\u901a\u5e38\u7531\u51e0\u4e2a\u5185\u90e8\u7ec4\u4ef6\u7ec4\u6210\uff0c\u5b83\u4eec\u534f\u540c\u5de5\u4f5c\uff0c\u4e3a\u7528\u6237\u63d0\u4f9b\u6548\u7387\u3001\u6027\u80fd\u548c\u6781\u5927\u7684\u53ef\u64cd\u4f5c\u6027\u3002\u51fa\u4e8e\u4f5c\u4e3a\u589e\u91cf\u6570\u636e\u7ba1\u9053\u7684\u72b6\u6001\u5b58\u50a8\u7684\u76ee\u7684\uff0c\u6211\u4eec\u8bbe\u8ba1\u4e86\u5e26\u6709\u5185\u7f6e\u8868\u670d\u52a1\u548c\u81ea\u7ba1\u7406\u8fd0\u884c\u65f6\u7684Hudi\uff0c\u786e\u4fdd\u6027\u80fd\u8868\u5b58\u50a8\u5e03\u5c40\u548c\u5143\u6570\u636e\u7ba1\u7406\uff0c\u8fd9\u4e9b\u670d\u52a1\u5728\u6bcf\u6b21\u5199\u64cd\u4f5c\u4e4b\u540e\u90fd\u4f1a\u81ea\u52a8\u540c\u6b65\u8c03\u7528\uff0c\u6216\u8005\u4f5c\u4e3a\u5355\u72ec\u7684\u540e\u53f0\u4f5c\u4e1a\u5f02\u6b65\u8c03\u7528\uff1a</p> <ul> <li>Compaction\uff1a\u5e26\u6709\u5185\u7f6e\u7684\u7b56\u7565(\u57fa\u4e8e\u65e5\u671f\u5206\u533a\uff0c\u6709I/O\u9650\u5236)\uff0c\u5b83\u5c06\u57fa\u672c\u6587\u4ef6\u4e0e\u4e00\u7ec4\u589e\u91cf\u65e5\u5fd7\u6587\u4ef6\u5408\u5e76\u4ee5\u751f\u6210\u65b0\u7684\u57fa\u672c\u6587\u4ef6\uff0c\u540c\u65f6\u5141\u8bb8\u5bf9\u6587\u4ef6\u7ec4\u5e76\u53d1\u5199\u5165\uff1b</li> <li>Clustering\uff1a\u5c06\u8f83\u5c0f\u7684\u57fa\u672c\u6587\u4ef6\u5408\u5e76\u4e3a\u8f83\u5927\u7684\u6587\u4ef6\u6765\u63a7\u5236\u6587\u4ef6\u5927\u5c0f\uff1b\u6570\u636e\u805a\u7c07\uff0c\u5c06\u6587\u4ef6\u6309\u7167\u67d0\u4e9b\u5217\u8fdb\u884c\u805a\u7c07\uff0c\u4ee5\u91cd\u65b0\u5e03\u5c40\uff0c\u8fbe\u5230\u4f18\u5316\u67e5\u8be2\u6027\u80fd\u7684\u6548\u679c\uff1b</li> <li>Cleaning\uff1a\u5220\u9664\u8d85\u8fc7\u589e\u91cf\u67e5\u8be2\u914d\u7f6e\u4fdd\u7559\u671f\u7684\u6587\u4ef6\u7247\uff1b</li> <li>Replication\uff1a\u590d\u5236\u670d\u52a1\uff0c\u5c06\u6570\u636e\u8de8\u5730\u57df\u8fdb\u884c\u590d\u5236\uff1b</li> <li>Archiving\uff1a\u5f52\u6863\u670d\u52a1\uff0c\u5f52\u6863commit\u5143\u6570\u636e\uff0c\u907f\u514d\u5143\u6570\u636e\u4e0d\u65ad\u81a8\u80c0\uff1b</li> </ul> <p></p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#compaction","title":"\u538b\u7f29\uff08Compaction\uff09","text":"<p>instant\u64cd\u4f5c\uff0c\u538b\u7f29\u4ec5\u9002\u7528\u4e8e\u8bfb\u65f6\u5408\u5e76\uff08MOR\uff09\u8868\u7c7b\u578b\uff0c\u8be6\u7ec6\u5185\u5bb9\u548c\u914d\u7f6e\u89c1Compaction</p> <p>\u5c06\u4e00\u7ec4\u6587\u4ef6\u7247\u4f5c\u4e3a\u8f93\u5165\uff0c\u5c06\u6bcf\u4e2a\u6587\u4ef6\u5207\u7247\u4e2d\u7684\u6240\u6709\u65e5\u5fd7\u6587\u4ef6\u4e0e\u5176basefile\u6587\u4ef6\uff08parquet\u6587\u4ef6\uff09\u5408\u5e76\uff0c\u4ee5\u751f\u6210\u65b0\u7684\u538b\u7f29\u6587\u4ef6\u7247\uff0c\u5e76\u5199\u4e3a\u65f6\u95f4\u8f74\u4e0a\u7684\u4e00\u4e2acommit\u3002</p> <ul> <li>\u7531\u538b\u7f29\u7b56\u7565\uff08\u9ed8\u8ba4\u9009\u62e9\u5177\u6709\u6700\u5927\u672a\u538b\u7f29\u65e5\u5fd7\u7684\u6587\u4ef6\u7247\uff09\u51b3\u5b9a\u9009\u62e9\u8981\u8fdb\u884c\u538b\u7f29\u7684\u6587\u4ef6\u7247\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#clean","title":"\u6e05\u7406\uff08Clean\uff09","text":"<p>instant\u64cd\u4f5c\uff0c\u5220\u9664\u65e7\u7684\u6587\u4ef6\u7247\uff0c\u5e76\u9650\u5236\u8868\u5360\u7528\u7684\u5b58\u50a8\u7a7a\u95f4\u3002</p> <p>\u6e05\u7406\u9ed8\u8ba4\u4f1a\u5728\u6bcf\u6b21\u5199\u64cd\u4f5c\u4e4b\u540e\u81ea\u52a8\u6267\u884c\uff0c\u5e76\u5229\u7528\u65f6\u95f4\u8f74\u670d\u52a1\u5668\u4e0a\u7f13\u5b58\u7684\u65f6\u95f4\u8f74\u5143\u6570\u636e\u6765\u907f\u514d\u626b\u63cf\u6574\u4e2a\u8868\u6765\u8bc4\u4f30\u6e05\u7406\u65f6\u673a\uff0c\u8be6\u89c1 Clean\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_17","title":"\u5c0f\u6587\u4ef6\u5408\u5e76","text":"<p>\u5199\u5165\u901f\u5ea6\u5feb\uff0c\u5c0f\u6587\u4ef6\u7684\u4e2a\u6570\u8d8a\u591a\uff0c\u4f46\u5c0f\u6587\u4ef6\u4e2a\u6570\u8d8a\u591a\uff0c\u67e5\u8be2\u6548\u7387\u8d8a\u6162\uff0c\u4e14\u5bf9HDFS\u4e0d\u53cb\u597d\u3002</p> <p>Hudi \u5728\u5199\u5165\u65f6\uff0c\u652f\u6301\u81ea\u52a8\u8fdb\u884c\u5c0f\u6587\u4ef6\u5408\u5e76\u673a\u5236\uff0c\u8be6\u7ec6\u89c1 \u7ef4\u6301\u6700\u4f18\u6587\u4ef6\u5927\u5c0f\u7684\u673a\u5236</p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#timeline-metaserver","title":"Timeline Metaserver","text":"<p>\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5143\u6570\u636e\u670d\u52a1\u5668\uff0c\u79f0\u4e3a\u201c\u65f6\u95f4\u8f74\u670d\u52a1\u5668\u201d\uff0c\u5b83\u4e3aHudi\u7684\u8868\u5143\u6570\u636e\u63d0\u4f9b\u4e86\u5907\u7528\u5b58\u50a8\u3002</p> <ul> <li>\u76ee\u524d\uff0c\u65f6\u95f4\u8f74\u670d\u52a1\u5668\u5d4c\u5165\u5728Hudi\u5199\u5165\u8fdb\u7a0b\u4e2d\u8fd0\u884c\uff0c\u5728\u5199\u5165\u8fc7\u7a0b\u4e2d\u4ece\u672c\u5730rocksDB store/Javalin REST API\u63d0\u4f9b\u6587\u4ef6\u5217\u8868\uff0c\u800c\u4e0d\u9700\u8981\u91cd\u590dlist the cloud storage\u3002</li> </ul> <p></p>"},{"location":"data_system/data_lake/apache_hudi/hudi.html#_18","title":"\u5176\u5b83","text":""},{"location":"data_system/data_lake/apache_hudi/hudi.html#dfs","title":"DFS\u8bbf\u95ee\u4f18\u5316","text":"<p>Hudi\u9ad8\u6548\u5199\uff0c\u7ba1\u7406\u6570\u636e\u5b58\u50a8\u7684\u65b9\u6cd5:</p> <ul> <li>\u5c0f\u6587\u4ef6\u5904\u7406\u7279\u6027\uff1a\u5256\u6790\u8f93\u5165\u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5e76\u5c06\u5185\u5bb9\u5206\u914d\u5230\u73b0\u6709\u7684\u6587\u4ef6\u7ec4\uff0c\u800c\u4e0d\u662f\u521b\u5efa\u65b0\u6587\u4ef6\u7ec4\uff08\u8fd9\u4f1a\u5bfc\u81f4\u751f\u6210\u5c0f\u6587\u4ef6\uff09;</li> <li>\u5728writer\u4e2d\u4f7f\u7528\u4e00\u4e2a\u65f6\u95f4\u8f74\u7f13\u5b58\uff0c\u8fd9\u6837\u53ea\u8981Spark\u96c6\u7fa4\u4e0d\u6bcf\u6b21\u90fd\u91cd\u542f\uff0c\u540e\u7eed\u7684\u5199\u64cd\u4f5c\u5c31\u4e0d\u9700\u8981\u5217\u51faDFS\u76ee\u5f55\u6765\u83b7\u53d6\u6307\u5b9a\u5206\u533a\u8def\u5f84\u4e0b\u7684\u6587\u4ef6\u7247\u5217\u8868\uff1b</li> <li>\u4ee5\u8c03\u6574\u57fa\u672c\u6587\u4ef6\u548c\u65e5\u5fd7\u6587\u4ef6\u5927\u5c0f\u4e4b\u95f4\u7684\u6bd4\u503c\u7cfb\u6570\u4ee5\u53ca\u671f\u671b\u7684\u538b\u7f29\u7387\uff0c\u4ee5\u4fbf\u5c06\u8db3\u591f\u6570\u91cf\u7684insert\u5206\u5230\u7edf\u4e00\u6587\u4ef6\u7ec4\uff0c\u4ece\u800c\u751f\u6210\u5927\u5c0f\u5408\u9002\u7684\u57fa\u672c\u6587\u4ef6\uff1b</li> <li>\u667a\u80fd\u8c03\u6574bulk insert\u5e76\u884c\u5ea6\uff0c\u53ef\u4ee5\u518d\u6b21\u8c03\u6574\u5927\u5c0f\u5408\u9002\u7684\u521d\u59cb\u6587\u4ef6\u7ec4\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/key_partition.html","title":"\u4e3b\u952e\u548c\u5206\u533a\u914d\u7f6e","text":"<p>HoodieKey\u7531<code>\u8bb0\u5f55\u952e</code>\u548c\u8bb0\u5f55\u6240\u5c5e\u7684<code>\u5206\u533a\u8def\u5f84</code>\u7ec4\u6210\u3002</p> <ul> <li>\u5c06\u66f4\u65b0\u548c\u5220\u9664\u5feb\u901f\u5e94\u7528\u4e8e\u6307\u5b9a\u8bb0\u5f55\uff1b</li> <li>Hudi\u4f7f\u7528<code>\u5206\u533a\u8def\u5f84</code>\u5b57\u6bb5\u5bf9\u6570\u636e\u96c6\u8fdb\u884c\u5206\u533a\uff0c\u5e76\u4e14\u5206\u533a\u5185\u7684\u8bb0\u5f55\u6709\u552f\u4e00\u7684\u8bb0\u5f55\u952e\uff1b</li> <li>\u4ec5\u5728\u5206\u533a\u5185\u4fdd\u8bc1\u552f\u4e00\u6027\uff0c\u4e0d\u540c\u5206\u533a\u4e4b\u95f4\u53ef\u80fd\u5b58\u5728\u5177\u6709\u76f8\u540c\u8bb0\u5f55\u952e\u7684\u8bb0\u5f55\u3002\u5e94\u8be5\u660e\u667a\u5730\u9009\u62e9\u5206\u533a\u5b57\u6bb5\uff0c\u56e0\u4e3a\u5b83\u53ef\u80fd\u5f71\u54cd\u6444\u53d6\u548c\u67e5\u8be2\u5ef6\u8fdf\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/key_partition.html#_2","title":"\u952e\u751f\u6210\u5668","text":""},{"location":"data_system/data_lake/apache_hudi/key_partition.html#_3","title":"\u7c7b\u578b","text":"<ul> <li>SimpleKeyGenerator</li> <li>\u6307\u5b9a\u4e00\u4e2a\u5b57\u6bb5\u4e3aRecord Key\uff0c\u5206\u533a\u5b57\u6bb5\u4e5f\u6307\u5b9a\u4e00\u4e2a\u5b57\u6bb5\uff0c\u5927\u90e8\u5206\u60c5\u51b5\u4f7f\u7528\u8be5\u914d\u7f6e\uff0c\u5176\u4f1a\u4ece\u6570\u636e\u4e2d\u89e3\u6790\u51fa\u503c\u5e76\u8f6c\u5316\u4e3astring\u7c7b\u578b\u3002</li> <li>ComplexKeyGenerator</li> <li>\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u6bb5\u4f5c\u4e3aRecord key\u6216\u8005\u5206\u533a\u5b57\u6bb5\uff0c\u591a\u4e2a\u5b57\u6bb5\u4f7f\u7528\u9017\u53f7\u5206\u5272\uff1b</li> <li>GlobalDeleteKeyGenerator</li> <li>\u57fa\u4e8e\u5168\u5c40\u7d22\u5f15\u7684\u5220\u9664\u4e0d\u9700\u8981\u5206\u533a\u503c\uff0c\u6240\u4ee5\u8be5\u751f\u6210\u5668\u4e0d\u9700\u8981\u4f7f\u7528\u5206\u533a\u503c\u6765\u751f\u6210HoodieKey\u3002</li> <li>TimestampBasedKeyGenerator</li> <li>\u8be5\u952e\u751f\u6210\u5668\u5c06\u5206\u533a\u5b57\u6bb5\u503c\u4f1a\u88ab\u8f6c\u5316\u4e3a<code>timestamp</code>\uff0c\u800c\u4e0d\u662fstring\u7c7b\u578b\u3002Record key\u8bbe\u7f6e\u548c\u524d\u9762\u4e00\u6837\uff0c\u4f7f\u7528\u8be5\u952e\u751f\u6210\u5668\u65f6\u9700\u8981\u4e00\u4e9b\u989d\u5916\u7684\u914d\u7f6e\u9879\u5982\u4e0b</li> <li>CustomKeyGenerator</li> <li>\u901a\u7528\u7684KeyGenerator\uff0c\u7efc\u5408\u4e86<code>SimpleKeyGenerator</code>\u3001<code>ComplexKeyGenerator</code>\u548c<code>TImestampBasedKeyGenerator</code>\u7684\u7279\u6027\uff0c\u53ef\u4ee5\u914d\u7f6e\u952e\u548c\u5206\u533a\u8def\u5f84\u4e3a\u5355\u5b57\u6bb5\u6216\u7ec4\u5408\u5b57\u6bb5</li> <li>\u5982\u679c\u8981\u5b9a\u4e49\u57fa\u4e8e\u5e38\u89c4\u5b57\u6bb5\u548c\u57fa\u4e8e\u65f6\u95f4\u6233\u7684\u5b57\u6bb5\u7684\u590d\u6742\u5206\u533a\u8def\u5f84\uff0c\u6b64keyGenerator\u975e\u5e38\u6709\u7528</li> <li>NonPartitionedKeyGenerator</li> <li>\u6570\u636e\u96c6\u672a\u5206\u533a\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528NonPartitionedKeyGenerator\uff0c\u4e3a\u6240\u6709\u8bb0\u5f55\u8fd4\u56de\u4e00\u4e2a\u7a7a\u5206\u533a\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u6240\u6709\u8bb0\u5f55\u90fd\u5199\u5165\u5230\u540c\u4e00\u4e2a\u5206\u533a\uff08\u4e3a\u7a7a\"\"\uff09</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/key_partition.html#_4","title":"\u914d\u7f6e","text":"\u914d\u7f6e \u89e3\u91ca <code>hoodie.datasource.write.recordkey.field</code> \u6307\u5b9arecord key\u5b57\u6bb5 <code>hoodie.datasource.write.partitionpath.field</code> \u9ed8\u8ba4N/A\uff0c\u6307\u5b9a\u5206\u533a\u5b57\u6bb5 <code>hoodie.datasource.write.keygenerator.class</code> \u6307\u5b9aKeyGenerator\u7c7b\u5168\u8def\u5f84\u540d <code>hoodie.datasource.write.partitionpath.urlencode</code> \u5f53\u8bbe\u7f6e\u4e3atrue\uff0cpartitionPath\u5c06\u4f1a\u4f7f\u7528url\u7f16\u7801\uff0c\u9ed8\u8ba4\u503c\u4e3afalse <code>hoodie.datasource.write.hive_style_partitioning</code> \u5f53\u8bbe\u7f6e\u4e3atrue\uff0c\u4f7f\u7528hive\u98ce\u683c\u7684\u5206\u533a\uff0c\u5206\u533a\u5c06\u4e3akey=value\u683c\u5f0f\uff0c\u9ed8\u8ba4\u503c\u4e3afalse <code>hoodie.datasource.write.keygenerator.type</code> \u9ed8\u8ba4SIMPLE\uff0c\u652f\u6301<code>SIMPLE, COMPLEX, TIMESTAMP, CUSTOM, NON_PARTITION, GLOBAL_DELETE</code> <p>bootstrap\uff1a\u63a7\u5236\u5982\u4f55\u5c06\u73b0\u6709\u7684\u8868\u7b2c\u4e00\u6b21\u5f15\u5bfc\u5230 hudi\u3002</p> <ul> <li><code>hoodie.bootstrap.keygen.type</code>\uff1a\u9ed8\u8ba4SIMPLE\uff0c\u652f\u6301<code>SIMPLE, COMPLEX, TIMESTAMP, CUSTOM, NON_PARTITION, GLOBAL_DELETE</code>\uff1b</li> <li><code>hoodie.bootstrap.keygen.class</code>\uff1a\u9ed8\u8ba4N/A\uff0c\u81ea\u5b9a\u4e49bootstrapped dataset\u7684hoodie key\u7684\u751f\u6210\u7b56\u7565\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/references.html","title":"\u53c2\u8003\u6587\u732e","text":"<ol> <li>\u5982\u4f55\u5c06\u6570\u636e\u66f4\u5feb\u5bfc\u5165Apache Hudi\uff1f</li> <li>Apache Hudi\u5185\u6838\u4e4b\u6587\u4ef6\u6807\u8bb0\u673a\u5236\u6df1\u5165\u89e3\u6790</li> <li>Presto\u5982\u4f55\u63d0\u5347Hudi\u8868\u67e5\u8be2\u6027\u80fd(Clustering)</li> <li>Clustering\u670d\u52a1</li> <li>\u4e00\u6587\u5f7b\u5e95\u638c\u63e1Apache Hudi\u5f02\u6b65Clustering\u90e8\u7f72</li> <li>Hudi\u7684\u7d22\u5f15\u89e3\u6790</li> <li>Apache Hudi\u4ecb\u7ecd</li> <li>Apache Hudi\u6838\u5fc3\u6982\u5ff5\u4e00\u7f51\u6253\u5c3d</li> <li>\u4e00\u6587\u5f7b\u5e95\u7406\u89e3Apache Hudi\u7684\u6e05\u7406\u670d\u52a1</li> <li>17\u5f20\u56fe\u5e26\u4f60\u5f7b\u5e95\u7406\u89e3Hudi Upsert\u539f\u7406</li> <li>\u4e00\u6587\u5f7b\u5e95\u638c\u63e1Apache Hudi\u7684\u4e3b\u952e\u548c\u5206\u533a\u914d\u7f6e</li> <li>\u4f7f\u7528 Flink Hudi \u6784\u5efa\u6d41\u5f0f\u6570\u636e\u6e56</li> <li>\u57fa\u4e8eHudi\u7684\u6d41\u5f0fCDC\u5b9e\u8df5\u4e00\uff1a\u542c\u8bf4\u4f60\u51c6\u5907\u4e86\u9762\u8bd5\u9898\uff1f</li> <li>Apache Hudi \u5728 B \u7ad9\u6784\u5efa\u5b9e\u65f6\u6570\u636e\u6e56\u7684\u5b9e\u8df5</li> <li>Apache Hudi \u8bbe\u8ba1\u4e0e\u67b6\u6784\u6700\u5f3a\u89e3\u8bfb</li> <li>\u5e72\u8d27\uff01Apache Hudi\u5982\u4f55\u667a\u80fd\u5904\u7406\u5c0f\u6587\u4ef6\u95ee\u9898</li> </ol>"},{"location":"data_system/data_lake/apache_hudi/small_files_merge.html","title":"\u7ef4\u6301\u6700\u4f18\u5927\u5c0f\u7684\u6587\u4ef6\u673a\u5236","text":""},{"location":"data_system/data_lake/apache_hudi/small_files_merge.html#_2","title":"\u914d\u7f6e","text":"<ul> <li><code>hoodie.parquet.max.file.size</code>\uff1a120MB\uff0c\u6570\u636e\u6587\u4ef6\u6700\u5927\u5927\u5c0f\uff0cHudi\u5c06\u8bd5\u7740\u7ef4\u62a4\u6587\u4ef6\u5927\u5c0f\u5230\u8be5\u6307\u5b9a\u503c\uff1b</li> <li><code>hoodie.parquet.block.size</code>\uff1a120MB\uff0cparquet RowGroup\u7684\u5927\u5c0f\uff0c\u4fdd\u6301\u8ddf\u6587\u4ef6\u5927\u5c0f\u4e00\u81f4\u3002</li> <li><code>hoodie.parquet.small.file.limit</code>\uff1a\u9ed8\u8ba4100MB\uff0c\u5c0f\u4e8e\u8be5\u5927\u5c0f\u7684\u6587\u4ef6\u5747\u88ab\u89c6\u4e3a\u5c0f\u6587\u4ef6\uff0c0\u8868\u793a\u5173\u95ed\u8be5\u7279\u6027\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/small_files_merge.html#copyonwrite","title":"CopyOnWrite\u8868","text":"<p>MOR\u4e5f\u5171\u7528\u8fd9\u4e2a\u53c2\u6570\uff1f</p> <ul> <li><code>hoodie.copyonwrite.insert.split.size</code>\uff1a500000\uff0c\u5355\u6587\u4ef6\u4e2d\u63d2\u5165\u8bb0\u5f55\u6761\u6570\uff0c\u6b64\u503c\u5e94\u4e0e\u5355\u4e2a\u6587\u4ef6\u4e2d\u7684\u8bb0\u5f55\u6570\u5339\u914d\uff08\u53ef\u4ee5\u6839\u636e\u6700\u5927\u6587\u4ef6\u5927\u5c0f\u548c\u6bcf\u4e2a\u8bb0\u5f55\u5927\u5c0f\u6765\u786e\u5b9a\uff09\u3002\u5c06\u8fd9\u4e2a\u503c\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u8f83\u4f4e\u7684\u503c\uff0c\u5c06\u4ea7\u751f\u5c0f\u6587\u4ef6(\u7279\u522b\u662f\u5f53<code>hoodie.parquet.small.file.limit</code>\u4e3a0\u65f6)\uff1b\u9ed8\u8ba4\u503c\u662f\u5199100MB\u7684\u6587\u4ef6\uff0c\u8bb0\u5f55\u9ed8\u8ba41kb\uff0c\u5219\u6bcf\u4e2a\u6587\u4ef6\u6709100K\u7684\u8bb0\u5f55\u6761\u6570\uff0c\u653e\u5927\u5927500K\u3002</li> <li><code>hoodie.copyonwrite.insert.auto.split</code>\uff1a\u81ea\u52a8\u8c03\u6574<code>hoodie.copyonwrite.insert.split.size</code>\u7684\u5927\u5c0f\uff0c\u6839\u636e\u6700\u540ecommit\u7684\u5143\u6570\u636e\u3002</li> <li><code>hoodie.copyonwrite.record.size.estimate</code>\uff1a\u9ed8\u8ba41024\uff081kb\uff09\uff0c\u5e73\u5747\u6bcf\u6761record\u7684\u5927\u5c0f\uff0c\u6ca1\u6709\u660e\u786e\u6307\u5b9a\u5219\u6839\u636e\u63d0\u4ea4\u5143\u6570\u636e\u52a8\u6001\u8ba1\u7b97\u8bb0\u5f55\u5927\u5c0f\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/small_files_merge.html#_3","title":"\u539f\u7406","text":"<p>How Apache Hudi maintains optimum sized files</p> <p>\u4e0b\u6587\u8ba8\u8bba\u4e86\u5728\u521d\u59cb\u5199\u5165\u65f6\uff0c\u5728Hudi\u4e2d\u7684\u6587\u4ef6\u5927\u5c0f\u4f18\u5316\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u4e0d\u9700\u8981\u53ea\u662f\u4e3a\u4e86\u6587\u4ef6\u5927\u5c0f\u518d\u6b21\u6709\u6548\u5730\u91cd\u5199\u6240\u6709\u6570\u636e\u3002\u5982\u679c\u4f60\u60f3\u540c\u65f6\u62e5\u6709(a)\u81ea\u7ba1\u7406\u6587\u4ef6\u5927\u5c0f\u548c(b)\u907f\u514d\u67e5\u8be2\u5c0f\u6587\u4ef6\uff0c\u81ea\u52a8\u6587\u4ef6\u5927\u5c0f\u529f\u80fd\u53ef\u4ee5\u8282\u7701\u65f6\u95f4\u3002</p> <p>\u5f53\u6267\u884cINSERT/UPSERT\u64cd\u4f5c\u65f6\uff0cHudi\u6709\u80fd\u529b\u7ef4\u62a4\u914d\u7f6e\u7684\u76ee\u6807\u6587\u4ef6\u5927\u5c0f\u3002(\u6ce8\u610f:bulk_insert\u64cd\u4f5c\u4e0d\u63d0\u4f9b\u8fd9\u4e2a\u529f\u80fd\uff0c\u5b83\u88ab\u8bbe\u8ba1\u4e3a\u666e\u901aspark.write.parquet\u7684\u4e00\u4e2a\u66f4\u7b80\u5355\u7684\u66ff\u4ee3\u54c1)\u3002</p> <p>\u4ee5<code>COPY_ON_WRITE</code>\u8868\u6765\u6f14\u793aHudi\u5982\u4f55\u81ea\u52a8\u5904\u7406\u6587\u4ef6\u5927\u5c0f\u7279\u6027\u3002</p> <ul> <li>UpsertPartitioner \u6e90\u7801\uff08Spark-Hudi\uff09\uff1b</li> </ul> <p>\u5047\u8bbe\u4e00\u4e2a\u6307\u5b9a\u5206\u533a\u4e0b\u6570\u636e\u6587\u4ef6\u5e03\u5c40\u5982\u4e0b</p> <p></p> <p>\u5047\u8bbe\u914d\u7f6e\u7684<code>hoodie.parquet.max.file.size</code>\u4e3a120MB\uff0c<code>hoodie.parquet.small.file.limit</code>\u4e3a100MB\u3002File_1\u5927\u5c0f\u4e3a40MB\uff0cFile_2\u5927\u5c0f\u4e3a80MB\uff0cFile_3\u662f90MB\uff0cFile_4\u662f130MB\uff0cFile_5\u662f105MB\uff0c\u5f53\u6709\u65b0\u5199\u5165\u65f6\u5176\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p>\u6b65\u9aa4\u4e00\uff1a\u5c06\u66f4\u65b0\u5206\u914d\u5230\u6307\u5b9a\u6587\u4ef6\uff0c\u8fd9\u4e00\u6b65\u5c06\u67e5\u627e\u7d22\u5f15\u6765\u627e\u5230\u76f8\u5e94\u7684\u6587\u4ef6\uff0c\u5047\u8bbe\u66f4\u65b0\u4f1a\u589e\u52a0\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u4f1a\u5bfc\u81f4\u6587\u4ef6\u53d8\u5927\u3002\u5f53\u66f4\u65b0\u51cf\u5c0f\u6587\u4ef6\u5927\u5c0f\u65f6\uff08\u4f8b\u5982\u4f7f\u8bb8\u591a\u5b57\u6bb5\u65e0\u6548\uff09\uff0c\u5219\u968f\u540e\u7684\u5199\u5165\u5c06\u6587\u4ef6\u5c06\u8d8a\u6765\u8d8a\u5c0f\u3002</p> <p>\u6b65\u9aa4\u4e8c\uff1a\u6839\u636e<code>hoodie.parquet.small.file.limit</code>\u51b3\u5b9a\u6bcf\u4e2a\u5206\u533a\u4e0b\u7684\u5c0f\u6587\u4ef6\uff0c\u6211\u4eec\u7684\u793a\u4f8b\u4e2d\u8be5\u914d\u7f6e\u4e3a100MB\uff0c\u6240\u4ee5\u5c0f\u6587\u4ef6\u4e3aFile_1\u3001File_2\u548cFile_3\uff1b</p> <p>\u6b65\u9aa4\u4e09\uff1a\u786e\u5b9a\u5c0f\u6587\u4ef6\u540e\uff0c\u65b0\u63d2\u5165\u7684\u8bb0\u5f55\u5c06\u5206\u914d\u7ed9\u5c0f\u6587\u4ef6\u4ee5\u4fbf\u4f7f\u5176\u8fbe\u5230120MB\uff0cFile_1\u5c06\u4f1a\u63d2\u516580MB\u5927\u5c0f\u7684\u8bb0\u5f55\u6570\uff0cFile_2\u5c06\u4f1a\u63d2\u516540MB\u5927\u5c0f\u7684\u8bb0\u5f55\u6570\uff0cFile_3\u5c06\u63d2\u516530MB\u5927\u5c0f\u7684\u8bb0\u5f55\u6570\u3002</p> <p></p> <p>\u6b65\u9aa4\u56db\uff1a\u5f53\u6240\u6709\u5c0f\u6587\u4ef6\u90fd\u5206\u914d\u5b8c\u4e86\u5bf9\u5e94\u63d2\u5165\u8bb0\u5f55\u6570\u540e\uff0c\u5982\u679c\u8fd8\u6709\u5269\u4f59\u672a\u5206\u914d\u7684\u63d2\u5165\u8bb0\u5f55\uff0c\u8fd9\u4e9b\u8bb0\u5f55\u5c06\u5206\u914d\u7ed9\u65b0\u521b\u5efa\u7684FileGroup/\u6570\u636e\u6587\u4ef6\u3002\u6570\u636e\u6587\u4ef6\u4e2d\u7684\u8bb0\u5f55\u6570\u7531<code>hoodie.copyonwrite.insert.split.size</code>\uff08\u6216\u8005\u7531\u4e4b\u524d\u7684\u5199\u5165\u81ea\u52a8\u63a8\u7b97\u6bcf\u6761\u8bb0\u5f55\u5927\u5c0f\uff0c\u7136\u540e\u6839\u636e\u914d\u7f6e\u7684\u6700\u5927\u6587\u4ef6\u5927\u5c0f\u8ba1\u7b97\u51fa\u6765\u53ef\u4ee5\u63d2\u5165\u7684\u8bb0\u5f55\u6570\uff09\u51b3\u5b9a\uff0c\u5047\u8bbe\u6700\u540e\u5f97\u5230\u7684\u8be5\u503c\u4e3a120K\uff08\u6bcf\u6761\u8bb0\u5f55\u5927\u5c0f1K\uff09\uff0c\u5982\u679c\u8fd8\u5269\u4f59300K\u7684\u8bb0\u5f55\u6570\uff0c\u5c06\u4f1a\u521b\u5efa3\u4e2a\u65b0\u6587\u4ef6\uff08File_6\uff0cFile_7\uff0cFile_8\uff09\uff0cFile_6\u548cFile_7\u90fd\u4f1a\u5206\u914d120K\u7684\u8bb0\u5f55\u6570\uff0cFile_8\u4f1a\u5206\u914d60K\u7684\u8bb0\u5f55\u6570\uff0c\u5171\u8ba160MB\uff0c\u540e\u9762\u518d\u5199\u5165\u65f6\uff0cFile_8\u4f1a\u88ab\u8ba4\u4e3a\u5c0f\u6587\u4ef6\uff0c\u53ef\u4ee5\u63d2\u5165\u66f4\u591a\u6570\u636e\u3002</p> <p></p> <p>Hudi\u5229\u7528\u8bf8\u5982\u81ea\u5b9a\u4e49\u5206\u533a\u4e4b\u7c7b\u7684\u673a\u5236\u6765\u4f18\u5316\u8bb0\u5f55\u5206\u914d\u5230\u4e0d\u540c\u6587\u4ef6\u7684\u80fd\u529b\uff0c\u4ece\u800c\u6267\u884c\u4e0a\u8ff0\u7b97\u6cd5\u3002\u5728\u8fd9\u8f6e\u5199\u5165\u5b8c\u6210\u4e4b\u540e\uff0c\u9664File_8\u4ee5\u5916\u7684\u6240\u6709\u6587\u4ef6\u5747\u5df2\u8c03\u6574\u4e3a\u6700\u4f73\u5927\u5c0f\uff0c\u6bcf\u6b21\u5199\u5165\u90fd\u4f1a\u9075\u5faa\u6b64\u8fc7\u7a0b\uff0c\u4ee5\u786e\u4fddHudi\u8868\u4e2d\u6ca1\u6709\u5c0f\u6587\u4ef6\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/spark.html","title":"Spark Hudi \u4f7f\u7528","text":"<p>\u53c2\u8003\u5b98\u65b9\u6587\u6863 </p>"},{"location":"data_system/data_lake/apache_hudi/spark.html#_1","title":"\u5feb\u901f\u4e0a\u624b","text":""},{"location":"data_system/data_lake/apache_hudi/spark.html#_2","title":"\u51c6\u5907","text":"spark-shellSpark SQL <pre><code># For Spark versions: 3.2 - 3.4\nexport SPARK_VERSION=3.4\nspark-shell --packages org.apache.hudi:hudi-spark$SPARK_VERSION-bundle_2.12:0.14.0 --conf 'spark.serializer=org.apache.spark.serializer.KryoSerializer' --conf 'spark.sql.catalog.spark_catalog=org.apache.spark.sql.hudi.catalog.HoodieCatalog' --conf 'spark.sql.extensions=org.apache.spark.sql.hudi.HoodieSparkSessionExtension' --conf 'spark.kryo.registrator=org.apache.spark.HoodieSparkKryoRegistrar'\n</code></pre> <pre><code>export SPARK_VERSION=3.4\nspark-sql --packages org.apache.hudi:hudi-spark$SPARK_VERSION-bundle_2.12:0.14.0 --conf 'spark.serializer=org.apache.spark.serializer.KryoSerializer' --conf 'spark.sql.extensions=org.apache.spark.sql.hudi.HoodieSparkSessionExtension' --conf 'spark.sql.catalog.spark_catalog=org.apache.spark.sql.hudi.catalog.HoodieCatalog' --conf 'spark.kryo.registrator=org.apache.spark.HoodieSparkKryoRegistrar'\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/spark.html#_3","title":"\u5efa\u8868","text":"spark-shellSpark SQL <pre><code>// do nothing\n</code></pre> <pre><code>-- \u521b\u5efa\u5206\u533a\u8868\uff0c\u8bbe\u7f6ehudi\u8868\u7684\u5c5e\u6027\ncreate table hudi_cow_pt_tbl (\n  id bigint,\n  name string,\n  ts bigint,\n  dt string,\n  hh string\n) using hudi\ntblproperties (\n  type = 'cow',\n  primaryKey = 'id',\n  preCombineField = 'ts'\n )\npartitioned by (dt, hh) location '/tmp/hudi/hudi_cow_pt_tbl';\n\n-- \u52a0\u8f7d\u5df2\u7ecf\u5b58\u5728\u7684\u5206\u533a\u8868\uff0cschema\u548c\u5c5e\u6027\uff0cHudi\u4f1a\u81ea\u52a8\u89e3\u6790\ncreate table hudi_existing_tbl1 using hudi\npartitioned by (dt, hh) location 'file:///tmp/hudi/dataframe_hudi_pt_table';\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/spark.html#_4","title":"\u63d2\u5165\u6570\u636e","text":"spark-shellSpark SQL <pre><code>// spark-shell\nval columns = Seq(\"ts\",\"uuid\",\"rider\",\"driver\",\"fare\",\"city\")\nval data = Seq((1695159649087L,\"334e26e9-8355-45cc-97c6-c31daf0df330\",\"rider-A\",\"driver-K\",19.10,\"san_francisco\"),\n        (1695091554788L,\"e96c4396-3fad-413a-a942-4cb36106d721\",\"rider-C\",\"driver-M\",27.70 ,\"san_francisco\"),\n        (1695046462179L,\"9909a8b1-2d15-4d3d-8ec9-efc48c536a00\",\"rider-D\",\"driver-L\",33.90 ,\"san_francisco\"),\n        (1695516137016L,\"e3cf430c-889d-4015-bc98-59bdce1e530c\",\"rider-F\",\"driver-P\",34.15,\"sao_paulo\"    ),\n        (1695115999911L,\"c8abbe79-8d89-47ea-b4ce-4d224bae5bfa\",\"rider-J\",\"driver-T\",17.85,\"chennai\"));\nvar inserts = spark.createDataFrame(data).toDF(columns:_*)\n\ninserts.write.format(\"hudi\").\n  option(PARTITIONPATH_FIELD_NAME.key(), \"city\").\n  // default operation type is upsert\n  option(TABLE_NAME, tableName).\n  mode(Overwrite).\n  save(basePath)\n</code></pre> <pre><code>-- insert into non-partitioned table\ninsert into hudi_cow_nonpcf_tbl select 1, 'a1', 20;\ninsert into hudi_mor_tbl select 1, 'a1', 20, 1000;\n\n-- insert dynamic partition\ninsert into hudi_cow_pt_tbl partition (dt, hh)\nselect 1 as id, 'a1' as name, 1000 as ts, '2021-12-09' as dt, '10' as hh;\n\n-- insert static partition\ninsert into hudi_cow_pt_tbl partition(dt = '2021-12-09', hh='11') select 2, 'a2', 1000;\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/spark.html#_5","title":"\u8986\u76d6\u5199","text":"<p><code>insert_overwrite_table</code>: This can be faster than deleting the older table and recreating in <code>Overwrite</code> mode.</p> spark-shellSpark SQL <pre><code>df.write.format(\"hudi\").\n  options(getQuickstartWriteConfigs).\n  // \u8986\u76d6\u5199\n  option(OPERATION.key(),\"insert_overwrite\").\n  option(PRECOMBINE_FIELD.key(), \"ts\").\n  option(RECORDKEY_FIELD.key(), \"uuid\").\n  option(PARTITIONPATH_FIELD.key(), \"partitionpath\").\n  option(TBL_NAME.key(), tableName).\n  mode(Append).\n  save(basePath)\n</code></pre> <pre><code>-- insert overwrite non-partitioned table\ninsert overwrite hudi_mor_tbl select 99, 'a99', 20.0, 900;\ninsert overwrite hudi_cow_nonpcf_tbl select 99, 'a99', 20.0;\n\n-- insert overwrite partitioned table with dynamic partition\ninsert overwrite table hudi_cow_pt_tbl select 10, 'a10', 1100, '2021-12-09', '10';\n\n-- insert overwrite partitioned table with static partition\ninsert overwrite hudi_cow_pt_tbl partition(dt = '2021-12-09', hh='12') select 13, 'a13', 1100;\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/spark.html#_6","title":"\u67e5\u8be2\u6570\u636e","text":"<pre><code>tripsSnapshotDF.createOrReplaceTempView(\"hudi_trips_snapshot\")\n\nspark.sql(\"select fare, begin_lon, begin_lat, ts from  hudi_trips_snapshot where fare &gt; 20.0\").show()\nspark.sql(\"select _hoodie_commit_time, _hoodie_record_key, _hoodie_partition_path, rider, driver, fare from  hudi_trips_snapshot\").show()\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/spark.html#commit","title":"\u589e\u91cf\u67e5\u8be2\uff08\u7279\u5b9acommit\u4e4b\u540e\uff09","text":"<p><code>_hudi_commit_time</code>\u662flong\u578b\u7684\u65f6\u95f4\u6233\uff0c\u5982<code>20220511151803960</code> </p> <pre><code>spark.read.\n  format(\"hudi\").\n  load(basePath).\n  createOrReplaceTempView(\"hudi_trips_snapshot\")\n\nval commits = spark.sql(\"select distinct(_hoodie_commit_time) as commitTime from  hudi_trips_snapshot order by commitTime\").map(k =&gt; k.getString(0)).take(50)\nval beginTime = commits(commits.length - 2) // commit time we are interested in\n\n// incrementally query data after begin commit\nval tripsIncrementalDF = spark.read.format(\"hudi\").\n  option(QUERY_TYPE_OPT_KEY, QUERY_TYPE_INCREMENTAL_OPT_VAL).\n  option(BEGIN_INSTANTTIME_OPT_KEY, beginTime).\n  load(basePath)\ntripsIncrementalDF.createOrReplaceTempView(\"hudi_trips_incremental\")\n\nspark.sql(\"select `_hoodie_commit_time`, fare, begin_lon, begin_lat, ts from  hudi_trips_incremental where fare &gt; 20.0\").show()\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/spark.html#commit_1","title":"\u70b9\u67e5\uff08\u7279\u5b9acommit\u4e4b\u95f4\uff09","text":"<pre><code>val beginTime = \"000\" // Represents earliest possible commit time\nval endTime = commits(commits.length - 2) // commit time we are interested in\n\n//incrementally query data\nval tripsPointInTimeDF = spark.read.format(\"hudi\").\n  option(QUERY_TYPE_OPT_KEY, QUERY_TYPE_INCREMENTAL_OPT_VAL).\n  option(BEGIN_INSTANTTIME_OPT_KEY, beginTime).\n  option(END_INSTANTTIME_OPT_KEY, endTime).\n  load(basePath)\ntripsPointInTimeDF.createOrReplaceTempView(\"hudi_trips_point_in_time\")\nspark.sql(\"select `_hoodie_commit_time`, fare, begin_lon, begin_lat, ts from hudi_trips_point_in_time where fare &gt; 20.0\").show()\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/spark.html#time-travelcommit","title":"\u65f6\u95f4\u65c5\u884c\uff08Time Travel\uff0c\u7279\u5b9acommit\u4e4b\u524d\uff09","text":""},{"location":"data_system/data_lake/apache_hudi/spark.html#dataframe","title":"DataFrame","text":"<pre><code>spark.read.\n  format(\"hudi\").\n  option(\"as.of.instant\", \"2021-07-28 14:11:08.200\").\n  load(basePath)\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/spark.html#sql","title":"SQL","text":"<pre><code>select * from hudi_cow_pt_tbl timestamp as of '2022-03-07 09:16:28.100' where id = 1;\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/spark.html#_7","title":"\u66f4\u65b0\u6570\u636e","text":""},{"location":"data_system/data_lake/apache_hudi/spark.html#dataframe_1","title":"DataFrame","text":"<p>Append \u6a21\u5f0f</p> <pre><code>df.write.format(\"hudi\").\n  options(getQuickstartWriteConfigs).\n  option(PRECOMBINE_FIELD_OPT_KEY, \"ts\").\n  option(RECORDKEY_FIELD_OPT_KEY, \"uuid\").\n  option(PARTITIONPATH_FIELD_OPT_KEY, \"partitionpath\").\n  option(TABLE_NAME, tableName).\n  mode(Append).\n  save(basePath)\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/spark.html#sql_1","title":"SQL","text":"<p>Update\uff0c\u9700\u8981\u6307\u5b9a<code>preCombineField</code>\u5b57\u6bb5</p> <pre><code>UPDATE tableIdentifier SET column = EXPRESSION(,column = EXPRESSION) [ WHERE boolExpression]\n\n-- \u793a\u4f8b\nupdate hudi_mor_tbl set price = price * 2, ts = 1111 where id = 1;\nupdate hudi_cow_pt_tbl set name = 'a1_1', ts = 1001 where id = 1;\n-- update using non-PK field\nupdate hudi_cow_pt_tbl set ts = 1001 where name = 'a1';\n</code></pre> <p>MergeInto</p> <pre><code>MERGE INTO tableIdentifier AS target_alias\nUSING (sub_query | tableIdentifier) AS source_alias\nON &lt;merge_condition&gt;\n[ WHEN MATCHED [ AND &lt;condition&gt; ] THEN &lt;matched_action&gt; ]\n[ WHEN MATCHED [ AND &lt;condition&gt; ] THEN &lt;matched_action&gt; ]\n[ WHEN NOT MATCHED [ AND &lt;condition&gt; ]  THEN &lt;not_matched_action&gt; ]\n\n&lt;merge_condition&gt; = A equal bool condition \n&lt;matched_action&gt;  =\n  DELETE  |\n  UPDATE SET *  |\n  UPDATE SET column1 = expression1 [, column2 = expression2 ...]\n&lt;not_matched_action&gt;  =\n  INSERT *  |\n  INSERT (column1 [, column2 ...]) VALUES (value1 [, value2 ...])\n\n-- \u793a\u4f8b\nmerge into hudi_mor_tbl as target\nusing merge_source as source\non target.id = source.id\nwhen matched and flag != 'delete' then\n update set id = source.id, name = source.name, ts = source.ts, dt = source.dt, hh = source.hh\nwhen matched and flag = 'delete' then delete\nwhen not matched then\n insert (id, name, ts, dt, hh) values(source.id, source.name, source.ts, source.dt, source.hh)\n;\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/spark.html#_8","title":"\u5220\u9664\u6570\u636e","text":""},{"location":"data_system/data_lake/apache_hudi/spark.html#dataframe_2","title":"DataFrame","text":"<pre><code>df.write.format(\"hudi\").\n  options(getQuickstartWriteConfigs).\n  // DELETE\n  option(OPERATION_OPT_KEY,\"delete\").\n  option(PRECOMBINE_FIELD_OPT_KEY, \"ts\").\n  option(RECORDKEY_FIELD_OPT_KEY, \"uuid\").\n  option(PARTITIONPATH_FIELD_OPT_KEY, \"partitionpath\").\n  option(TABLE_NAME, tableName).\n  mode(Append).\n  save(basePath)\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/spark.html#sql_2","title":"SQL","text":"<pre><code>DELETE FROM tableIdentifier [ WHERE BOOL_EXPRESSION]\n\n-- \u793a\u4f8b\ndelete from hudi_cow_nonpcf_tbl where uuid = 1;\ndelete from hudi_mor_tbl where id % 2 = 0;\n-- delete using non-PK field\ndelete from hudi_cow_pt_tbl where name = 'a1';\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/spark.html#_9","title":"\u793a\u4f8b","text":"<p>\u6570\u636e\u5199\u5165\u6548\u7387\uff0c\u5bf9\u4e8ecow\u53camor\u8868\uff0c\u4e0d\u5b58\u5728\u66f4\u65b0\u64cd\u4f5c\u65f6\uff0c\u5199\u5165\u901f\u7387\u63a5\u8fd1\u3002</p>"},{"location":"data_system/data_lake/apache_hudi/spark.html#_10","title":"\u95ee\u9898","text":"<p>Hudi \u5728 Spark \u4e2d\u53ea\u6709\u6279\u5904\u7406\u7684\u6a21\u5f0f\uff0c\u56e0\u6b64\u5bf9\u4e8e\u6d41\u5f0f\u5199\u6570\u636e\u65f6\uff0c\u5728\u540c\u4e00\u4e2a\u5206\u533a\u7684\u6570\u636e\uff0c\u7531\u4e8eCompaction\u5bfc\u81f4\u6587\u4ef6\u88ab\u9891\u7e41\u7684\u5168\u91cf\u8bfb\u53d6\u3001\u6dfb\u52a0\u3001\u5168\u91cf\u5199\u5165\uff0c\u6027\u80fd\u6bd4\u8f83\u6162\uff1a\uff08hudi 0.9\uff0c \u4e09\u53f0\u8282\u70b9\uff09</p> <ul> <li>COW\u8868\uff0c\u5728 300 records\u6bcf\u79d2\u7684\u5904\u7406\u91cf\uff1b</li> <li>COW\u8868\uff0c\u914d\u7f6eclustering\uff0c1300 records\u6bcf\u79d2\u7684\u5904\u7406\u91cf\uff1b</li> </ul> <p>\u5199\u5165\u6162\u539f\u56e0\uff1a</p> <ul> <li> <p>\u5fae\u6279\u6a21\u5f0f\uff08\u95f4\u9694\u65f6\u95f4\uff09\uff0c\u65e0\u6cd5\u786e\u5b9a\u5199\u5165\u7684\u6570\u636e\u91cf\u5927\u5c0f\uff0c\u4e14sink\u7aef\u6ca1\u6709\u7f13\u5b58\uff0c\u5199\u5165\u7684\u6587\u4ef6\u4f1a\u5f88\u5c0f\u3002</p> </li> <li> <p>\u8fdb\u884c\u5c0f\u6587\u4ef6\u5408\u5e76\uff0c\u964d\u4f4e\u5199\u7684\u6027\u80fd\uff1b</p> </li> </ul>"},{"location":"data_system/data_lake/apache_hudi/spark.html#_11","title":"\u4ee3\u7801","text":"<pre><code>import org.apache.log4j.Logger\nimport org.apache.spark.sql.catalyst.encoders.RowEncoder\nimport org.apache.spark.sql.{DataFrame, Row, SaveMode}\nimport org.apache.spark.sql.functions._\nimport org.apache.spark.sql.types.{LongType, StringType, StructField, StructType}\n\nobject SparkHudi {\n  val logger = Logger.getLogger(SparkHudi.getClass)\n\n  def main(args: Array[String]): Unit = {\n\n    val spark = SparkSession\n      .builder\n      .appName(\"SparkHudi\")\n      //.master(\"local[*]\")\n      .config(\"spark.serializer\", \"org.apache.spark.serializer.KryoSerializer\")\n      .config(\"spark.default.parallelism\", 9)\n      .config(\"spark.sql.shuffle.partitions\", 9)\n      .enableHiveSupport()\n      .getOrCreate()\n\n    // \u6dfb\u52a0\u76d1\u542c\u5668\uff0c\u6bcf\u4e00\u6279\u6b21\u5904\u7406\u5b8c\u6210\uff0c\u5c06\u8be5\u6279\u6b21\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u5982\u8d77\u59cboffset\uff0c\u6293\u53d6\u8bb0\u5f55\u6570\u91cf\uff0c\u5904\u7406\u65f6\u95f4\u6253\u5370\u5230\u63a7\u5236\u53f0\n    spark.streams.addListener(new StreamingQueryListener() {\n        override def onQueryStarted(queryStarted: QueryStartedEvent): Unit = {\n            println(\"Query started: \" + queryStarted.id)\n        }\n        override def onQueryTerminated(queryTerminated: QueryTerminatedEvent): Unit = {\n            println(\"Query terminated: \" + queryTerminated.id)\n        }\n        override def onQueryProgress(queryProgress: QueryProgressEvent): Unit = {\n            println(\"Query made progress: \" + queryProgress.progress)\n        }\n    })\n\n    // \u5b9a\u4e49kafka\u6d41\n    val dataStreamReader = spark\n      .readStream\n      .format(\"kafka\")\n      .option(\"kafka.bootstrap.servers\", \"localhost:9092\")\n      .option(\"subscribe\", \"testTopic\")\n      .option(\"startingOffsets\", \"latest\")\n      .option(\"maxOffsetsPerTrigger\", 100000)\n      .option(\"failOnDataLoss\", false)\n\n    // \u52a0\u8f7d\u6d41\u6570\u636e\uff0c\u8fd9\u91cc\u56e0\u4e3a\u53ea\u662f\u6d4b\u8bd5\u4f7f\u7528\uff0c\u76f4\u63a5\u8bfb\u53d6kafka\u6d88\u606f\u800c\u4e0d\u505a\u5176\u4ed6\u5904\u7406\uff0c\u662fspark\u7ed3\u6784\u5316\u6d41\u4f1a\u81ea\u52a8\u751f\u6210\u6bcf\u4e00\u5957\u6d88\u606f\u5bf9\u5e94\u7684kafka\u5143\u6570\u636e\uff0c\n    // \u5982\u6d88\u606f\u6240\u5728\u4e3b\u9898\uff0c\u5206\u533a\uff0c\u6d88\u606f\u5bf9\u5e94offset\u7b49\u3002\n    val df = dataStreamReader.load()\n      .selectExpr(\n        \"topic as kafka_topic\",\n        \"CAST(partition AS STRING) kafka_partition\",\n        \"cast(timestamp as String) kafka_timestamp\",\n        \"CAST(offset AS STRING) kafka_offset\",\n        \"CAST(key AS STRING) kafka_key\",\n        \"CAST(value AS STRING) kafka_value\",\n        \"current_timestamp() current_time\",\n       )\n       .selectExpr(\n        \"kafka_topic\",\n        \"concat(kafka_partition,'-',kafka_offset) kafka_partition_offset\",\n        \"kafka_offset\",\n        \"kafka_timestamp\",\n        \"kafka_key\",\n        \"kafka_value\",\n        \"substr(current_time,1,10) partition_date\")\n\n    // \u521b\u5efa\u5e76\u542f\u52a8query\n    val query = df\n      .writeStream\n      .queryName(\"demo\")\n      .foreachBatch { (batchDF: DataFrame, _: Long) =&gt; {\n        batchDF.persist()\n\n        println(LocalDateTime.now() + \"start writing cow table\")\n        batchDF.write.format(\"org.apache.hudi\")\n            .option(TABLE_TYPE_OPT_KEY, \"COPY_ON_WRITE\")\n            .option(PRECOMBINE_FIELD_OPT_KEY, \"kafka_timestamp\")\n            // \u4ee5kafka\u5206\u533a\u548c\u504f\u79fb\u91cf\u4f5c\u4e3a\u7ec4\u5408\u4e3b\u952e\n            .option(RECORDKEY_FIELD_OPT_KEY, \"kafka_partition_offset\")\n            // \u4ee5\u5f53\u524d\u65e5\u671f\u4f5c\u4e3a\u5206\u533a\n            .option(PARTITIONPATH_FIELD_OPT_KEY, \"partition_date\")\n            .option(TABLE_NAME, \"copy_on_write_table\")\n            .option(HIVE_STYLE_PARTITIONING_OPT_KEY, true)\n            .mode(SaveMode.Append)\n            .save(\"/tmp/sparkHudi/COPY_ON_WRITE\")\n\n        println(LocalDateTime.now() + \"start writing mor table\")\n        batchDF.write.format(\"org.apache.hudi\")\n            .option(TABLE_TYPE_OPT_KEY, \"MERGE_ON_READ\")\n            .option(PRECOMBINE_FIELD_OPT_KEY, \"kafka_timestamp\")\n            .option(RECORDKEY_FIELD_OPT_KEY, \"kafka_partition_offset\")\n            .option(PARTITIONPATH_FIELD_OPT_KEY, \"partition_date\")\n            .option(TABLE_NAME, \"merge_on_read_table\")\n            .option(HIVE_STYLE_PARTITIONING_OPT_KEY, true)\n            .mode(SaveMode.Append)\n            .save(\"/tmp/sparkHudi/MERGE_ON_READ\")\n\n        println(LocalDateTime.now() + \"finish\")\n        batchDF.unpersist()\n      }\n      .option(\"checkpointLocation\", \"/tmp/sparkHudi/checkpoint/\")\n      .start()\n\n    query.awaitTermination()\n  }\n}\n</code></pre>"},{"location":"data_system/data_lake/apache_hudi/usage.html","title":"\u4f7f\u7528","text":""},{"location":"data_system/data_lake/apache_hudi/usage.html#_2","title":"\u53c2\u6570","text":"<ul> <li> <p><code>hoodie.table.precombine.field</code>\uff1a\u5728\u6570\u636e\u5408\u5e76\u7684\u65f6\u5019\u4f7f\u7528\u5230\uff0c\u5f53 <code>hoodie.table.recordkey.fields</code>\u76f8\u540c\u65f6\uff0c\u9ed8\u8ba4\u53d6<code>hoodie.table.precombine.field</code>\u5c5e\u6027\u914d\u7f6e\u7684\u5b57\u6bb5\u6700\u5927\u503c\u6240\u5bf9\u5e94\u7684\u884c\uff1b</p> </li> <li> <p><code>hoodie.table.recordkey.fields</code>\uff1a\u6bcf\u6761\u8bb0\u5f55\u7684\u552f\u4e00id\uff0c\u652f\u6301\u591a\u4e2a\u5b57\u6bb5\uff1b</p> </li> <li> <p><code>hoodie.table.partition.fields</code>\uff1a\u7528\u4e8e\u5b58\u653e\u6570\u636e\u7684\u5206\u533a\u5b57\u6bb5\uff1b</p> </li> </ul> <p>\u6ce8\uff1a\uff08<code>_hoodie_commit_time</code>\u5fc5\u987b\u662f\u5f53\u524d\u65f6\u95f4\uff0c\u4e0d\u80fd\u662fevent time\uff09</p> <p>\u8bb0\u5f55\u6709\u6548\u8d1f\u8f7d\u5b9a\u4e49\u5982\u4f55\u6839\u636e\u4f20\u5165\u7684\u65b0\u8bb0\u5f55\u548c\u5b58\u50a8\u7684\u65e7\u8bb0\u5f55\u751f\u6210\u65b0\u503c\u3002</p> <ul> <li><code>hoodie.payload.event.time.field</code>\uff1a\u63a8\u65ad\u4e0e\u8bb0\u5f55\u5173\u8054\u7684\u65f6\u95f4\u6233\u7684\u5217/\u5b57\u6bb5\u540d\uff0c\u9ed8\u8ba4\u4e3a<code>ts</code>\uff0c\u7528\u4e8e\u83b7\u53d6event time\u4fe1\u606f\uff0c\u5199\u5165commit_time\u3002</li> </ul> <p><code>BEGIN_INSTANTTIME_OPT_KEY</code></p> <p>OPERATION_OPT_KEY</p>"},{"location":"data_system/data_lake/apache_hudi/usage.html#copy-on-write-tables","title":"Copy-On-Write tables","text":"Query Engine Snapshot Queries Incremental Queries Hive Y Y Spark SQL Y Y Spark Datasource Y Y Flink SQL Y N PrestoDB Y N Impala Y N"},{"location":"data_system/data_lake/apache_hudi/usage.html#merge-on-read-tables","title":"Merge-On-Read tables","text":"Query Engine Snapshot Queries Incremental Queries Read Optimized Queries Hive Y Y Y Spark SQL Y Y Y Spark Datasource Y Y Y Flink SQL Y Y Y PrestoDB Y N Y Impala N N Y"},{"location":"data_system/data_lake/apache_hudi/usage.html#flink","title":"Flink","text":"<p>TODO\uff1aInsert SQL \u8bed\u53e5\u662f\u6d41\u5f0f\u7684\u4e0d\u505c\u6b62\uff1f</p>"},{"location":"data_system/data_lake/apache_hudi/usage.html#spark","title":"Spark","text":""},{"location":"data_system/data_lake/apache_hudi/versions.html","title":"\u5386\u53f2","text":"<p>\u6570\u636e\u6e56\u573a\u666f\u4e0b\u7684\u5143\u6570\u636e\u7ba1\u7406\u7cfb\u7edf Hudi Metastore\uff1a</p> <ul> <li>Hive Metastore \u57fa\u4e8e\u76ee\u5f55\u7684\u5143\u6570\u636e\u7ba1\u7406\u65b9\u5f0f\u592a\u7c97\uff0c\u6ca1\u6709\u529e\u6cd5\u6ee1\u8db3\u6570\u636e\u6e56\u4ee5 commit \u7684\u5f62\u5f0f\u7ba1\u7406\u5143\u6570\u636e\u7684\u9700\u6c42</li> </ul> <p>\u5e76\u53d1\u5199\u5165\uff0c\u5e76\u4e14\u652f\u6301\u7075\u6d3b\u7684\u884c\u5217\u51b2\u7a81\u68c0\u67e5\u7b56\u7565</p>"},{"location":"data_system/data_lake/apache_hudi/versions.html#0120","title":"0.12.0","text":"<ul> <li>PrestoDB</li> <li>0.275 \u7248\u672c\u5f00\u59cb\uff0c\u7528\u6237\u73b0\u5728\u53ef\u4ee5\u5229\u7528\u539f\u751f Hudi \u8fde\u63a5\u5668\u6765\u67e5\u8be2 Hudi \u8868</li> <li>HUDI-4500\uff1aSupport restore to savepoint with holes in the timeline</li> <li>\u4e50\u89c2\u5e76\u53d1\u63a7\u5236\u7684\u591a\u4e2a\u5199\u5165\u5668\u652f\u6301\u57fa\u4e8e\u6587\u4ef6\u7cfb\u7edf\u7684\u9501\uff1b</li> <li>Flink INSERT \u64cd\u4f5c\u652f\u6301\u5f02\u6b65Clustering\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/versions.html#0110","title":"0.11.0","text":"<ul> <li>\u652f\u6301\u591a\u7ea7\u7d22\u5f15</li> <li>Bucket\u7d22\u5f15\uff1a</li> <li>Bucket Pruning\uff1a\u5229\u7528\u8868\u7684 Bucket \u5206\u5e03\u5bf9\u8bfb\u53d6\u6570\u636e\u8fdb\u884c\u526a\u679d\u3002</li> <li>Bucket Join\uff1a\u5229\u7528\u8868\u7684 Bucket \u5206\u5e03\u51cf\u5c11 Join/Aggregate \u5e26\u6765\u7684 shuffle \u64cd\u4f5c</li> <li> <p>COW\u8868\u7684\u52a0\u5bc6\uff1aSpark 3.2 + Parquet 1.2\u7684\u7279\u6027</p> </li> <li> <p>\u6dfb\u52a0CALL\u547d\u4ee4\u4ee5\u652f\u6301\u5728 Hudi \u8868\u4e0a\u8c03\u7528\u66f4\u591a\u64cd\u4f5c</p> </li> <li>\u9488\u5bf9Spark 3.1\u3001Spark 3.2\u7248\u672c\u589e\u52a0\u4e86schema\u529f\u80fd\u7684\u6f14\u8fdb</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/versions.html#0100","title":"0.10.0","text":""},{"location":"data_system/data_lake/apache_hudi/versions.html#090","title":"0.9.0","text":""},{"location":"data_system/data_lake/apache_hudi/versions.html#_2","title":"\u901a\u7528","text":"<ul> <li>\uff08\uff1f\uff09Support streaming read with compaction and cleaning</li> <li>\u589e\u5f3a Bulk_Insert\u6a21\u5f0f\uff08\u65b0\u589e\u884c\u5199\u5165\u5668\u6a21\u5f0f\uff09\uff0c\u5e76\u7f3a\u7701\u6253\u5f00\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u884c\u5199\u5165\u5668\u6a21\u5f0f\u4ee5\u83b7\u5f97\u66f4\u597d\u7684\u6027\u80fd\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/versions.html#flink","title":"Flink","text":"<ul> <li>\u5199\u5165\u652f\u6301 <code>CDC Format</code>\u7684 MOR \u8868\uff1b</li> <li>\u652f\u6301Bulk insert\u6765\u52a0\u8f7d\u73b0\u6709\u8868\uff1b</li> <li>\u6d41\u5f0f\u8bfb\u53d6 COW \u8868\uff1b</li> <li>\u5199\u5165\u73b0\u5728\u53ef\u4ee5\u66f4\u65b0\u5386\u53f2\u5206\u533a\uff08<code>index.global.enabled</code>\uff09\uff1b</li> <li>\u652f\u6301\u4e0d\u540c\u7684 Hive \u7248\u672c\uff081.x\u30012.x\u30013.x\uff09\uff0c\u6539\u5584\u4e86 Hive \u540c\u6b65\uff1b</li> <li>\u652f\u6301\u7eaf\u65e5\u5fd7\u8ffd\u52a0\u6a21\u5f0f\uff0c\u6ca1\u6709\u8bb0\u5f55\u53bb\u91cd\uff0c\u76f4\u63a5\u5199Parquet\uff08\u5173\u95ed <code>write.insert.deduplicate</code>\uff09\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_hudi/versions.html#spark","title":"Spark","text":"<ul> <li> <p>\u6dfb\u52a0\u4e86\u5bf9\u4f7f\u7528 Spark SQL \u7684 DDL/DML \u7684\u652f\u6301\uff1b</p> </li> <li> <p>SQL \u652f\u6301\u65f6\u95f4\u65c5\u884c\uff08Time travel\uff09\uff1b</p> </li> <li> <p>Hudi \u73b0\u5728\u53ef\u4ee5\u5728 Spark \u4e2d\u6ce8\u518c\u4e3a\u6570\u636e\u6e90\u8868\uff1b</p> </li> <li> <p>\u57fa\u4e8eMetadata Table\u7684 Spark \u8bfb\u53d6\u6539\u8fdb\uff1b</p> </li> <li> <p>Clusetering</p> </li> <li> <p>DeltaStreamer \u548c Spark Streaming \u90fd\u6dfb\u52a0\u4e86\u5f02\u6b65Clustering\u652f\u6301\uff1b</p> </li> <li> <p>\u589e\u91cf\u8bfb\u53d6\u4e5f\u9002\u7528\u4e8eClustering\u6570\u636e\uff1b</p> </li> <li> <p>\u6dfb\u52a0\u4e86 HoodieClusteringJob[6] \u4ee5\u4f5c\u4e3a\u72ec\u7acb\u4f5c\u4e1a\u6765\u6784\u5efa\u548c\u6267\u884cClustering\u8ba1\u5212\uff1b</p> </li> <li> <p>Spark \u5f15\u64ce\u4e2d\u6dfb\u52a0\u4e86\u9884\u63d0\u4ea4\u9a8c\u8bc1\u5668\u6846\u67b6\uff1b</p> </li> <li>DeltaStreamer</li> <li>\u5bf9<code>hudi-cli</code> \u7684\u4e00\u4e9b\u6539\u8fdb\uff0c\u4f8b\u5982<code>SCHEDULE COMPACTION</code>\u548c<code>RUN COMPACTION</code>\u8bed\u53e5\uff0c\u4ee5\u4fbf\u8f7b\u677e\u5728 Hudi \u8868\u4e0a\u8c03\u5ea6\u548c\u8fd0\u884cCompaction\u3001Clustering\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_iceberg/configuration.html","title":"Configuration","text":"<p>[toc]</p>"},{"location":"data_system/data_lake/apache_iceberg/configuration.html#_1","title":"\u914d\u7f6e","text":""},{"location":"data_system/data_lake/apache_iceberg/configuration.html#_2","title":"\u8868\u7684\u914d\u7f6e","text":""},{"location":"data_system/data_lake/apache_iceberg/configuration.html#_3","title":"\u8bfb\u914d\u7f6e","text":"Property Default Description read.split.target-size 134217728 (128 MB) Target size when combining data input splits read.split.metadata-target-size 33554432 (32 MB) Target size when combining metadata input splits read.split.planning-lookback 10 Number of bins to consider when combining input splits read.split.open-file-cost 4194304 (4 MB) The estimated cost to open a file, used as a minimum weight when combining splits."},{"location":"data_system/data_lake/apache_iceberg/configuration.html#_4","title":"\u5199\u914d\u7f6e","text":"Property Default Description write.format.default parquet Default file format for the table; parquet, avro, or orc write.parquet.row-group-size-bytes 134217728 (128 MB) Parquet row group size write.parquet.page-size-bytes 1048576 (1 MB) Parquet page size write.parquet.dict-size-bytes 2097152 (2 MB) Parquet dictionary page size write.parquet.compression-codec gzip Parquet compression codec write.parquet.compression-level null Parquet compression level write.avro.compression-codec gzip Avro compression codec write.location-provider.impl null Optional custom implemention for LocationProvider write.metadata.compression-codec none Metadata compression codec; none or gzip write.metadata.metrics.default truncate(16) Default metrics mode for all columns in the table; none, counts, truncate(length), or full write.metadata.metrics.column.col1 (not set) Metrics mode for column \u2018col1\u2019 to allow per-column tuning; none, counts, truncate(length), or full write.target-file-size-bytes Long.MAX_VALUE Controls the size of files generated to target about this many bytes write.distribution-mode none Defines distribution of write data: none: don\u2019t shuffle rows; hash: hash distribute by partition key ; range: range distribute by partition key or sort key if table has an SortOrder write.wap.enabled false Enables write-audit-publish writes write.summary.partition-limit 0 Includes partition-level summary stats in snapshot summaries if the changed partition count is less than this limit write.metadata.delete-after-commit.enabled false Controls whether to delete the oldest version metadata files after commit write.metadata.previous-versions-max 100 The max number of previous version metadata files to keep before deleting after commit write.spark.fanout.enabled false Enables Partitioned-Fanout-Writer writes in Spark"},{"location":"data_system/data_lake/apache_iceberg/configuration.html#_5","title":"\u8868\u7684\u8868\u73b0\u914d\u7f6e","text":"Property Default Description commit.retry.num-retries 4 Number of times to retry a commit before failing commit.retry.min-wait-ms 100 Minimum time in milliseconds to wait before retrying a commit commit.retry.max-wait-ms 60000 (1 min) Maximum time in milliseconds to wait before retrying a commit commit.retry.total-timeout-ms 1800000 (30 min) Maximum time in milliseconds to wait before retrying a commit commit.manifest.target-size-bytes 8388608 (8 MB) Target size when merging manifest files commit.manifest.min-count-to-merge 100 Minimum number of manifests to accumulate before merging commit.manifest-merge.enabled true Controls whether to automatically merge manifests on writes history.expire.max-snapshot-age-ms 432000000 (5 days) Default max age of snapshots to keep while expiring snapshots history.expire.min-snapshots-to-keep 1 Default min number of snapshots to keep while expiring snapshots"},{"location":"data_system/data_lake/apache_iceberg/configuration.html#_6","title":"\u517c\u5bb9\u6027\u914d\u7f6e","text":"Property Default Description compatibility.snapshot-id-inheritance.enabled false Enables committing snapshots without explicit snapshot IDs"},{"location":"data_system/data_lake/apache_iceberg/configuration.html#catalog","title":"Catalog\u914d\u7f6e","text":"<p><code>HadoopCatalog</code> and <code>HiveCatalog</code> can access the properties in their constructors. </p> Property Default Description catalog-impl null a custom <code>Catalog</code> implementation to use by an engine io-impl null a custom <code>FileIO</code> implementation to use in a catalog warehouse null the root path of the data warehouse uri null a URI string, such as Hive metastore URI clients 2 client pool size"},{"location":"data_system/data_lake/apache_iceberg/configuration.html#lock-catalog","title":"Lock catalog \u914d\u7f6e","text":"<p>\u4e00\u4e9bCatalog\u5b9e\u73b0\u4f7f\u7528\u8fd9\u4e9b\u53c2\u6570\u6765\u63a7\u5236\u63d0\u4ea4\u671f\u95f4\u7684\u9501\u884c\u4e3a\u3002</p> Property Default Description lock-impl null a custom implementation of the lock manager, the actual interface depends on the catalog used lock.table null an auxiliary table for locking, such as in AWS DynamoDB lock manager lock.acquire-interval-ms 5 seconds the interval to wait between each attempt to acquire a lock lock.acquire-timeout-ms 3 minutes the maximum time to try acquiring a lock lock.heartbeat-interval-ms 3 seconds the interval to wait between each heartbeat after acquiring a lock lock.heartbeat-timeout-ms 15 seconds the maximum time without a heartbeat to consider a lock expired"},{"location":"data_system/data_lake/apache_iceberg/configuration.html#hadoop","title":"Hadoop \u914d\u7f6e","text":"<p>\u4f7f\u7528Hive\u5143\u6570\u636e\u8fde\u63a5\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u914d\u7f6e\uff1a</p> Property Default Description iceberg.hive.client-pool-size 5 The size of the Hive client pool when tracking tables in HMS iceberg.hive.lock-timeout-ms 180000 (3 min) Maximum time in milliseconds to acquire a lock iceberg.hive.lock-check-min-wait-ms 50 Minimum time in milliseconds to check back on the status of lock acquisition iceberg.hive.lock-check-max-wait-ms 5000 Maximum time in milliseconds to check back on the status of lock acquisition <p>Note: <code>iceberg.hive.lock-check-max-wait-ms</code> should be less than the transaction timeout of the Hive Metastore (<code>hive.txn.timeout</code> or <code>metastore.txn.timeout</code> in the newer versions). Otherwise, the heartbeats on the lock (which happens during the lock checks) would end up expiring in the Hive Metastore before the lock is retried from Iceberg.</p>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html","title":"Iceberg","text":"<p>[toc]</p>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#apache-iceberg-v011","title":"Apache Iceberg v0.11","text":"<p>Apache Iceberg is an open table format for huge analytic datasets.</p> <p>\u652f\u6301Trino(\u524dPrestoSQL)\u548cSpark\uff0cHive\uff08Hive InputFormat\uff09\u548cFlink Sink/Source\u3002</p> <p>Iceberg\u53ef\u4ee5\u89e3\u51b3\u4e1a\u52a1\u7684\u51e0\u5927\u95ee\u9898\uff1a</p> <ul> <li>\u964d\u4f4eNameNode\u7684list\u8bf7\u6c42\u538b\u529b\u3002[\u65b0partition\u6a21\u5f0f]</li> <li>\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\u3002[\u65b0partition\u6a21\u5f0f&amp;&amp;\u65b0\u8868\u7edf\u8ba1\u4fe1\u606f]</li> <li>T+1\u79bb\u7ebf\u6570\u4ed3\u8fdb\u5316\u4e3a\u5206\u949f\u7ea7\u522b\u7684\u51c6\u5b9e\u65f6\u6570\u4ed3\u3002[\u65b0API\u63d0\u4f9b\u4e86\u51c6\u5b9e\u65f6\u589e\u91cf\u6d88\u8d39]</li> <li>\u6240\u6709\u6570\u636e\u57fa\u4e8eParquet\u7b49\u901a\u7528\u5f00\u6e90\u6587\u4ef6\u683c\u5f0f\uff0c\u6ca1\u6709lambad\u67b6\u6784\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u8fd0\u7ef4\u6210\u672c\u548c\u673a\u5668\u6210\u672c\u3002</li> <li>\u9ad8\u6548\u4f4e\u6210\u672c\u7684\u8868schema\u548cpartition\u5b57\u6bb5\u53d8\u66f4\u3002[\u57fa\u4e8esnapshot\u7684schema/partition\u53d8\u66f4]</li> </ul> <p>Iceberg Table Version 2 \u652f\u6301\u6279\u91cfrow-level deletes\uff0c\u8fd9\u4e2a\u529f\u80fd\u4e3b\u8981\u7528\u4e8e\u6570\u636e\u5408\u89c4\u4fee\u6b63\u5904\u7406\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#_1","title":"\u76ee\u6807","text":"<ul> <li>\u5f00\u6e90\u7684\u8868\u683c\u5f0f\uff0c\u9759\u6001\u6570\u636e\u4ea4\u6362</li> <li>\u8868\u683c\u5f0f\u7684\u6e05\u6670\u5b9a\u4e49</li> <li>\u8de8\u8bed\u8a00\u7684\u5b9e\u73b0</li> <li>\u63d0\u5347\u53ef\u6269\u5c55\u6027\u548c\u53ef\u9760\u6027\uff1a</li> <li>\u5355\u8282\u70b9\u53ef\u4ee5\u5de5\u4f5c\uff0c\u53ef\u6269\u5c55\u5230\u96c6\u7fa4\uff1b</li> <li>\u6240\u6709\u6539\u53d8\u662f\u539f\u5b50\u6027\uff0c\u5177\u5907serializable ioslation\uff1b</li> <li>\u4e91\u5bf9\u8c61\u5b58\u50a8\u7684\u539f\u751f\u652f\u6301\uff1b</li> <li>\u652f\u6301\u5e76\u53d1\u5199\u5165\uff1b</li> <li>\u6301\u7eed\u6027\u7684\u4f7f\u7528\u95ee\u9898</li> <li>in-place\u7684\u8868\u6a21\u5f0f\u548c\u5206\u533a\u7684\u6f14\u8fdb\uff1b</li> <li>\u9690\u85cf\u5206\u533a\uff1a\u67e5\u8be2\u548c\u7269\u7406\u683c\u5f0f\u9694\u79bb\uff1b</li> <li>\u652f\u6301time travel\uff0crollback\u548cmetadata inspection\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#_2","title":"\u672f\u8bed","text":""},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#snapshot","title":"Snapshot\uff08\u5feb\u7167\uff09","text":"<p>A snapshot is the state of a table at some time\uff1a\u7279\u5b9a\u65f6\u523b\u7684\u8868\u7684\u72b6\u6001\u3002</p> <p>\u6bcf\u4e2a\u5feb\u7167\u5217\u51fa\u4e86\u5728\u5feb\u7167\u65f6\u6784\u6210\u8868\u5185\u5bb9\u7684\u6240\u6709\u6570\u636e\u6587\u4ef6\u3002\u6570\u636e\u6587\u4ef6\u8de8\u591a\u4e2a\u6e05\u5355\u6587\u4ef6\u5b58\u50a8\uff0c\u5feb\u7167\u7684\u6e05\u5355\u5217\u5728\u4e00\u4e2a\u6e05\u5355\u5217\u8868\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#manifest-list","title":"Manifest list\uff08\u6e05\u5355\u5217\u8868\uff09","text":"<p>\u6e05\u5355\u5217\u8868\u662f\u4e00\u4e2a\u5143\u6570\u636e\u6587\u4ef6\uff0c\u5b83\u5217\u51fa\u4e86\u6784\u6210\u8868\u5feb\u7167\u7684\u6240\u6709\u7684\u6e05\u5355\u6587\u4ef6\u3002</p> <p>\u6e05\u5355\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u6e05\u5355\u6587\u4ef6\u90fd\u5b58\u50a8\u6709\u5173\u4e8e\u5176\u5185\u5bb9\u7684\u4fe1\u606f\uff0c\u5982\u5206\u533a\u503c\u8303\u56f4\uff0c\u7528\u4e8e\u52a0\u5feb\u5143\u6570\u636e\u64cd\u4f5c\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#manifest-file","title":"Manifest file\uff08\u6e05\u5355\u6587\u4ef6\uff09","text":"<p>\u6e05\u5355\u6587\u4ef6\u662f\u4e00\u4e2a\u5143\u6570\u636e\u6587\u4ef6\uff0c\u5b83\u5217\u51fa\u7ec4\u6210\u5feb\u7167\u7684\u6570\u636e\u6587\u4ef6\u7684\u5b50\u96c6\u3002</p> <p>\u6e05\u5355\u4e2d\u7684\u6bcf\u4e2a\u6570\u636e\u6587\u4ef6\u90fd\u5b58\u50a8\u6709\u4e00\u4e2a\u5206\u533a\u5143\u7ec4\u3001\u5217\u7ea7\u7edf\u8ba1\u548c\u6458\u8981\u4fe1\u606f\uff0c\u7528\u4e8e\u5728\u626b\u63cf\u89c4\u5212\u671f\u95f4\u4fee\u526a\u5206\u5272\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#partition-spec","title":"Partition spec\uff08\u5206\u533a\u89c4\u8303\uff09","text":"<p>\u5206\u533a\u89c4\u8303\u662f\u5bf9\u5982\u4f55\u5bf9\u8868\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u5206\u533a\u7684\u63cf\u8ff0\u3002</p> <p>\u89c4\u8303\u7531\u6e90\u5217\u548c\u8f6c\u6362\u7684\u5217\u8868\u7ec4\u6210\u3002\u8f6c\u6362\u4ece\u6e90\u503c\u751f\u6210\u5206\u533a\u503c\u3002\u4f8b\u5982\uff0cdate(ts)\u751f\u6210\u4e0e\u540d\u4e3ats\u7684\u65f6\u95f4\u6233\u5217\u76f8\u5173\u8054\u7684\u65e5\u671f\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#partition-tuple","title":"Partition tuple\uff08\u5206\u533a\u5143\u7ec4\uff09","text":"<p>\u5206\u533a\u5143\u7ec4\u662f\u5b58\u50a8\u5728\u6bcf\u4e2a\u6570\u636e\u6587\u4ef6\u4e2d\u7684\u5206\u533a\u6570\u636e\u7684\u5143\u7ec4\u6216\u7ed3\u6784\u3002</p> <p>\u5206\u533a\u5143\u7ec4\u4e2d\u7684\u6240\u6709\u503c\u5bf9\u4e8e\u5b58\u50a8\u5728\u6570\u636e\u6587\u4ef6\u4e2d\u7684\u6240\u6709\u884c\u90fd\u662f\u76f8\u540c\u7684\u3002\u5206\u533a\u5143\u7ec4\u662f\u901a\u8fc7\u4f7f\u7528\u5206\u533a\u89c4\u8303\u4ece\u884c\u6570\u636e\u8f6c\u6362\u503c\u4ea7\u751f\u7684\u3002</p> <p>Iceberg\u5b58\u50a8\u7684\u5206\u533a\u503c\u4e0d\u53ef\u6539\uff0c\u4e0d\u50cfHive\u8868\u90a3\u6837\u5728\u6587\u4ef6\u7cfb\u7edf\u8def\u5f84\u548c\u952e\u4e2d\u5c06\u503c\u4e0e\u5b57\u7b26\u4e32\u8fdb\u884c\u8f6c\u6362\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#snapshot-log","title":"Snapshot log\uff08\u5feb\u7167\u65e5\u5fd7\uff09","text":"<p>\u5feb\u7167\u65e5\u5fd7\u662f\u5173\u4e8e\u8868\u7684\u5f53\u524d\u5feb\u7167\u5982\u4f55\u968f\u65f6\u95f4\u53d8\u5316\u7684\u5143\u6570\u636e\u65e5\u5fd7\u3002</p> <p>\u8be5\u65e5\u5fd7\u662f\u65f6\u95f4\u6233\u548cID\u5bf9\u7684\u5217\u8868:\u5f53\u5f53\u524d\u5feb\u7167\u88ab\u66f4\u6539\u65f6\u4ee5\u53ca\u5f53\u524d\u5feb\u7167\u88ab\u66f4\u6539\u4e3a\u7684\u5feb\u7167ID\u3002</p> <p>\u5feb\u7167\u65e5\u5fd7\u4f5c\u4e3asnapshot-log\u5b58\u50a8\u5728\u8868\u5143\u6570\u636e\u4e2d\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#_3","title":"\u8bbe\u8ba1","text":""},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#_4","title":"\u9690\u85cf\u5206\u533a","text":"<p>parition\u5b57\u6bb5\u662f\u8868\u4e2d\u7684\u4e00\u4e2a\u5b57\u6bb5\u6216\u8005\u5bf9\u8868\u4e2d\u7684\u5b57\u6bb5\u505a\u7279\u5b9atransform\u8f6c\u6362\u800c\u6765\uff0c\u800cHive Metastore\u4e2d\u5206\u533a\u5b57\u6bb5\u7531\u7528\u6237\u81ea\u5df1\u5904\u7406\u3002</p> <ul> <li>Hive\u65e0\u6cd5\u9a8c\u8bc1\u5206\u533a\u503c\u7684\u6b63\u786e\u6027\uff0c\u7531\u7528\u6237\u4fdd\u8bc1\uff1bIceberg\u7531\u7279\u5b9a\u7684Transform\u4fdd\u8bc1\uff0c\u4e0d\u8bb8\u7528\u6237\u624b\u52a8\u5904\u7406\uff1b</li> <li> <p>Iceberg\u5141\u8bb8\u8868\u7684schema\u6f14\u8fdb\uff0c\u53ef\u4ee5\u968f\u7740\u6570\u636e\u91cf\u7684\u53d8\u5316\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\u53d1\u5c55\u5206\u533a\u65b9\u6848\uff1b</p> </li> <li> <p>Iceberg\u8868\u6839\u636epartition\u5b9a\u4f4d\u6587\u4ef6\u76f8\u6bd4 metastore \u5c11\u4e86\u6839\u636e\u76ee\u5f55\u4fe1\u606f\u53bbHDFS\u4e0a\u6267\u884clist\u547d\u4ee4\u83b7\u53d6\u5206\u533a\u4e0b\u7684\u6587\u4ef6\u7684\u64cd\u4f5c\u3002</p> </li> </ul>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#_5","title":"\u626b\u63cf\u8ba1\u5212","text":"<p>Iceberg\u662f\u4e3a\u5927\u578b\u8868\u8bbe\u8ba1\u7684\uff0c\u7528\u4e8e\u751f\u4ea7\u4e2d\uff0c\u4e00\u4e2a\u8868\u53ef\u4ee5\u5305\u542b\u51e0\u5341pb\u7684\u6570\u636e\u3002\u751a\u81f3\u53ef\u4ee5\u4ece\u5355\u4e2a\u8282\u70b9\u8bfb\u53d6\u591apb\u7ea7\u7684\u8868\uff0c\u800c\u4e0d\u9700\u8981\u5206\u5e03\u5f0fSQL\u5f15\u64ce\u6765\u7b5b\u9009\u8868\u5143\u6570\u636e\u3002</p> <p>\u626b\u63cf\u89c4\u5212\u662f\u5728\u8868\u4e2d\u67e5\u627e\u67e5\u8be2\u6240\u9700\u6587\u4ef6\u7684\u8fc7\u7a0b\u3002</p> <p>\u5728Iceberg\u8868\u4e2d\u8fdb\u884cPlanning\u9002\u5408\u4e8e\u5355\u4e2a\u8282\u70b9\uff0c\u56e0\u4e3aIceberg\u7684\u5143\u6570\u636e\u9664\u4e86\u8fc7\u6ee4\u4e0d\u5305\u542b\u5339\u914d\u6570\u636e\u7684\u6570\u636e\u6587\u4ef6\u5916\uff0c\u8fd8\u53ef\u4ee5\u7528\u4e8e\u5220\u9664\u4e0d\u9700\u8981\u7684\u5143\u6570\u636e\u6587\u4ef6\u3002</p> <p>\u4ece\u5355\u4e2a\u8282\u70b9\u5feb\u901f\u626b\u63cf\u89c4\u5212\uff0c\u4f18\u52bf\u662f:</p> <ul> <li> <p>\u4f4e\u5ef6\u8fdfSQL\u67e5\u8be2\u2014\u2014\u6d88\u9664\u5206\u5e03\u5f0f\u626b\u63cf\uff1b</p> </li> <li> <p>\u4ece\u4efb\u4f55\u5ba2\u6237\u7aef\u8bbf\u95ee\u2014\u72ec\u7acb\u8fdb\u7a0b\u53ef\u4ee5\u76f4\u63a5\u4eceIceberg\u8868\u8bfb\u53d6\u6570\u636e\uff1b</p> </li> </ul>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#_6","title":"\u5143\u6570\u636e\u8fc7\u6ee4","text":"<p>Manifest files\uff1a\u5b58\u50a8\u6570\u636e\u6587\u4ef6\u7684\u5217\u8868\uff0c\u4ee5\u53ca\u6bcf\u4e2a\u6570\u636e\u6587\u4ef6\u7684\u5206\u533a\u6570\u636e\u548c\u5217\u7ea7\u522b\u7684\u7edf\u8ba1\u4fe1\u606f\uff1b</p> <p>Manifest list\uff1a\u5b58\u50a8Manifest\u7684\u5feb\u7167\u7684\u5217\u8868\uff0c\u4ee5\u53ca\u6bcf\u4e2a\u5206\u533a\u5b57\u6bb5\u7684\u503c\u8303\u56f4\u3002</p> <p>\u4e3a\u4e86\u8fdb\u884c\u5feb\u901f\u626b\u63cf\u89c4\u5212\uff0cIceberg\u9996\u5148\u4f7f\u7528Manifest list\u7684\u5206\u533a\u503c\u8303\u56f4\u7b5b\u9009Manifest files\u3002\u7136\u540e\uff0c\u5b83\u8bfb\u53d6\u6bcf\u4e2aManifest file\u4ee5\u83b7\u5f97\u6570\u636e\u6587\u4ef6\u3002\u5728\u8fd9\u4e2a\u65b9\u6848\u4e2d\uff0cManifest list\u5145\u5f53Manifest file\u7684\u7d22\u5f15\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u4e0d\u8bfb\u53d6\u6240\u6709\u6e05\u5355\u7684\u60c5\u51b5\u4e0b\u8fdb\u884c\u8ba1\u5212\u3002</p> <p>\u9664\u4e86\u5206\u533a\u503c\u8303\u56f4\u5916\uff0cManifest list\u8fd8\u5b58\u50a8Manifest\u4e2d\u6dfb\u52a0\u6216\u5220\u9664\u7684\u6587\u4ef6\u6570\u91cf\uff0c\u4ee5\u52a0\u901f\u5feb\u7167\u8fc7\u671f\u7b49\u64cd\u4f5c\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#_7","title":"\u6570\u636e\u8fc7\u6ee4","text":"<p>\u6e05\u5355\u6587\u4ef6\u5305\u62ec\u6bcf\u4e2a\u6570\u636e\u6587\u4ef6\u7684\u5206\u533a\u6570\u636e\u548c\u5217\u7ea7\u7edf\u8ba1\u7684\u5143\u7ec4\u3002\u8868\u7edf\u8ba1\u4fe1\u606f\u5b9e\u73b0\u7c92\u5ea6\u8ddfHive Metastore\u4e0d\u540c\u3002</p> <p>\uff081\uff09Metastore\u4e2d\u4e00\u5f20\u8868\u7684\u7edf\u8ba1\u4fe1\u606f\u662f\u8868/\u5206\u533a\u7ea7\u522b\u7c92\u5ea6\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u6bd4\u5982\u8bb0\u5f55\u4e00\u5f20\u8868\u4e2d\u67d0\u4e00\u5217\u7684\u8bb0\u5f55\u6570\u91cf\u3001\u5e73\u5747\u957f\u5ea6\u3001\u4e3anull\u7684\u8bb0\u5f55\u6570\u91cf\u3001\u6700\u5927\u503c\\\u6700\u5c0f\u503c\u7b49\u3002</p> <ul> <li>\u57fa\u4e8eMetastore\uff0c\u67e5\u8be2\u8c13\u8bcd\u53ea\u80fd\u57fa\u4e8e\u5206\u533a\u8fdb\u884c\u8fc7\u6ee4\uff0c\u9009\u4e2d\u7684\u5206\u533a\u9700\u8981\u89e3\u538b\u751a\u81f3\u626b\u63cf\u5176\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u3002</li> </ul> <p>\uff082\uff09Iceberg\u4e2d\u7edf\u8ba1\u4fe1\u606f\u7cbe\u786e\u5230\u6587\u4ef6\u7c92\u5ea6\uff0c\u5373\u6bcf\u4e2a\u6570\u636e\u6587\u4ef6\u90fd\u4f1a\u8bb0\u5f55\u6240\u6709\u5217\u7684\u8bb0\u5f55\u6570\u91cf\u3001\u5e73\u5747\u957f\u5ea6\u3001\u6700\u5927\u503c\\\u6700\u5c0f\u503c\u7b49\u3002</p> <ul> <li>\u57fa\u4e8eIceberg\uff0c\u67e5\u8be2\u8c13\u8bcd\u4e0d\u4ec5\u53ef\u4ee5\u8fc7\u6ee4\u5230\u5206\u533a\u7ea7\u522b\uff0c\u4e5f\u53ef\u4ee5\u57fa\u4e8e\u6587\u4ef6\u7ea7\u522b\u7684\u7edf\u8ba1\u4fe1\u606f\uff08\u6bcf\u4e00\u5217\u7684\u6700\u5927\u503c\\\u6700\u5c0f\u503c\uff09\u5bf9\u8fd9\u4e2a\u5206\u533a\u4e0b\u7684\u6587\u4ef6\u8fdb\u884c\u8fc7\u6ee4\uff0c\u5bf9\u4e8e\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u6587\u4ef6\u53ef\u4ee5\u4e0d\u7528\u89e3\u538b\u626b\u63cf\uff08Parquet\uff09\u3002</li> </ul> <p>\u5728Planning\u671f\u95f4\uff0c\u67e5\u8be2\u8c13\u8bcd\u81ea\u52a8\u8f6c\u6362\u4e3a\u5206\u533a\u6570\u636e\u4e0a\u7684\u8c13\u8bcd\uff0c\u5e76\u9996\u5148\u5e94\u7528\u4e8e\u7b5b\u9009\u6570\u636e\u6587\u4ef6\u3002\u63a5\u4e0b\u6765\uff0c\u5217\u7ea7\u503c\u8ba1\u6570\u3001\u7a7a\u8ba1\u6570\u3001\u4e0b\u754c\u548c\u4e0a\u754c\u7528\u4e8e\u6d88\u9664\u4e0d\u80fd\u5339\u914d\u67e5\u8be2\u8c13\u8bcd\u7684\u6587\u4ef6\u3002</p> <p>Metastore\u8868\u683c\u5f0f\u4e0d\u652f\u6301\u589e\u91cf\u62c9\u53d6\uff0c\u800cIceberg\u8868\u683c\u5f0f\u652f\u6301\u589e\u91cf\u62c9\u53d6\uff08\u4e0a\u5c42\u4e1a\u52a1\u5199\u597d\u4e00\u6279\u6587\u4ef6\uff0c\u8c03\u7528Iceberg\u7684commit\u63a5\u53e3\uff08\u5355\u4e2a\u4e8b\u52a1\uff09\u63d0\u4ea4\u672c\u6b21\u5199\u5165\u5f62\u6210\u4e00\u4e2a\u65b0\u7684snapshot\u5feb\u7167\uff09\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#_8","title":"\u8868\u7684\u6f14\u5316","text":"<p>\u652f\u6301in-place\u8868\u7684\u6f14\u5316\uff0c\u5305\u62ec\u8868schema\u4fee\u6539\u548c\u5206\u533a\u7684\u4fee\u6539\u3002\u4f46\u4e0d\u9700\u8981\u91cd\u5199\u8868\u6570\u636e\u6216\u8005\u8fc1\u79fb\u65b0\u8868\u8fd9\u79cd\u6602\u8d35\u7684\u4ee3\u4ef7\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#schema","title":"Schema\u6f14\u5316","text":"<p>\u5143\u6570\u636e\u7684\u64cd\u4f5c\uff0c\u6ca1\u6709\u6570\u636e\u7684\u79fb\u52a8\u3002\u652f\u6301\u7684\u64cd\u4f5c\uff1a</p> <ul> <li>Add\uff1a\u6dfb\u52a0\u65b0\u5217\uff1b</li> <li>Drop\uff1a\u79fb\u9664\u5217\uff1b</li> <li>Rename\uff1a\u91cd\u547d\u540d\u5217\uff1b</li> <li>Update\uff1a\u5bbd\u5316\uff08widen\uff09\u5217\u7684\u7c7b\u578b\uff1b</li> <li>Reorder\uff1a\u6539\u53d8\u5217\u7684\u987a\u5e8f\uff1f</li> </ul> <p>Note that map keys do not support adding or dropping struct fields that would change equality.</p> <p>\u6b63\u786e\u6027\u7684\u4fdd\u8bc1</p> <p>\u6a21\u5f0f\u6f14\u53d8\u7684\u53d8\u5316\u662f\u72ec\u7acb\u7684\uff0c\u6ca1\u6709\u526f\u4f5c\u7528\uff0c\u800c\u4e14\u4e0d\u9700\u8981\u91cd\u5199\u6587\u4ef6:</p> <ul> <li>\u6dfb\u52a0\u7684\u5217\u4ece\u4e0d\u4ece\u5176\u4ed6\u5217\u8bfb\u53d6\u73b0\u6709\u503c\uff1b</li> <li>\u5220\u9664\u5217\u6216\u5b57\u6bb5\u4e0d\u4f1a\u6539\u53d8\u4efb\u4f55\u5176\u4ed6\u5217\u4e2d\u7684\u503c\uff1b</li> <li>\u66f4\u65b0\u5217\u6216\u5b57\u6bb5\u4e0d\u4f1a\u6539\u53d8\u4efb\u4f55\u5176\u4ed6\u5217\u4e2d\u7684\u503c\u3002</li> <li>\u6539\u53d8\u7ed3\u6784\u4e2d\u5217\u6216\u5b57\u6bb5\u7684\u987a\u5e8f\u4e0d\u4f1a\u6539\u53d8\u4e0e\u5217\u6216\u5b57\u6bb5\u540d\u79f0\u76f8\u5173\u8054\u7684\u503c\u3002</li> </ul> <p>Iceberg\u4f7f\u7528\u60df\u4e00id\u6765\u8ddf\u8e2a\u8868\u4e2d\u7684\u6bcf\u4e00\u5217\u3002\u5f53\u6dfb\u52a0\u5217\u65f6\uff0c\u4f1a\u7ed9\u5b83\u5206\u914d\u4e00\u4e2a\u65b0ID\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u9519\u8bef\u5730\u4f7f\u7528\u73b0\u6709\u6570\u636e\u3002</p> <ul> <li>\u6839\u636e\u540d\u79f0\u8ddf\u8e2a\u5217\u7684\u683c\u5f0f\u5728\u91cd\u590d\u4f7f\u7528\u540d\u79f0\u65f6\u53ef\u80fd\u4f1a\u65e0\u610f\u4e2d\u6062\u590d\u5217\u7684\u5220\u9664\uff0c\u8fd9\u8fdd\u53cd\u4e86\u7b2c1\u6761\u3002</li> <li>\u6309\u4f4d\u7f6e\u8ddf\u8e2a\u5217\u7684\u683c\u5f0f\u4e0d\u80fd\u5728\u4e0d\u66f4\u6539\u6bcf\u4e2a\u5217\u4f7f\u7528\u7684\u540d\u79f0\u7684\u60c5\u51b5\u4e0b\u5220\u9664\u5217\uff0c\u8fd9\u8fdd\u53cd\u4e86\u7b2c2\u6761\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#_9","title":"\u5206\u533a\u6f14\u5316","text":"<p>\u8868\u5206\u533a\u53ef\u4ee5\u5728\u73b0\u6709\u8868\u4e2d\u66f4\u65b0\uff0c\u56e0\u4e3a\u67e5\u8be2\u4e0d\u4f1a\u76f4\u63a5\u5f15\u7528\u5206\u533a\u503c\u3002\u6f14\u5316\u4e00\u4e2a\u65b0\u7684\u5206\u533a\u89c4\u8303\u65f6\uff0c\u7528\u65e9\u671f\u5206\u533a\u89c4\u8303\u5199\u5165\u7684\u65e7\u6570\u636e\u4fdd\u6301\u4e0d\u53d8\u3002\u65b0\u6570\u636e\u5728\u65b0\u5e03\u5c40\u4e2d\u4f7f\u7528\u65b0\u89c4\u8303\u5199\u5165\u3002\u6bcf\u4e2a\u5206\u533a\u7248\u672c\u7684\u5143\u6570\u636e\u662f\u5206\u5f00\u4fdd\u5b58\u7684\u3002</p> <p>\u5bf9\u4e8e\u67e5\u8be2\u4f1a\u5f97\u5230\u5206\u5272\u7684\u8ba1\u5212\u3002\u6bcf\u4e2a\u5206\u533a\u5e03\u5c40\u4f7f\u7528\u4ece\u5176\u7279\u5b9a\u5206\u533a\u5e03\u5c40\u4e2d\u6d3e\u751f\u7684\u7b5b\u9009\u5668\u5206\u522b\u89c4\u5212\u6587\u4ef6\u3002\u793a\u4f8b\uff1a</p> <p></p> <pre><code>Table sampleTable = ...;\nsampleTable.updateSpec()\n    .addField(bucket(\"id\", 8))\n    .removeField(\"category\")\n    .commit();\n</code></pre>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#_10","title":"\u6392\u5e8f\u6f14\u5316","text":"<p>\u4e0e\u5206\u533a\u89c4\u8303\u7c7b\u4f3c\uff0cIceberg\u6392\u5e8f\u987a\u5e8f\u4e5f\u53ef\u4ee5\u5728\u73b0\u6709\u8868\u4e2d\u66f4\u65b0\u3002\u5f53\u6f14\u5316\u6392\u5e8f\u987a\u5e8f\u65f6\uff0c\u4f7f\u7528\u5148\u524d\u987a\u5e8f\u5199\u5165\u7684\u65e7\u6570\u636e\u5c06\u4fdd\u6301\u4e0d\u53d8\u3002\u5f15\u64ce\u603b\u662f\u53ef\u4ee5\u9009\u62e9\u4ee5\u6700\u65b0\u7684\u6392\u5e8f\u987a\u5e8f\u6216\u672a\u6392\u5e8f\u7684\u987a\u5e8f\u5199\u5165\u6570\u636e\uff08\u5f53\u6392\u5e8f\u6210\u672c\u8fc7\u9ad8\u65f6\uff09\u3002</p> <pre><code>Table sampleTable = ...;\nsampleTable.replaceSortOrder()\n   .asc(\"id\", NullOrder.NULLS_LAST)\n   .dec(\"category\", NullOrder.NULL_FIRST)\n   .commit();\n</code></pre>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#_11","title":"\u53ef\u9760\u6027\uff08\u539f\u5b50\u6027\u8981\u6c42\uff09","text":"<p>Hive tables \u8ddf\u8e2a\u6570\u636e\u6587\u4ef6\uff0c\u4f7f\u7528\u96c6\u4e2d\u7684metastore\u7528\u4e8e\u5206\u533a\uff0c\u4ee5\u53ca\u4f7f\u7528\u6587\u4ef6\u7cfb\u7edf\u7528\u4e8e\u5355\u72ec\u7684\u6587\u4ef6\uff0c\u4f7f\u5f97\u539f\u5b50\u6027\u66f4\u6539\u5f88\u96be\u5b9e\u73b0\uff0c\u4ee5\u53ca\u5bf9\u6587\u4ef6\u7cfb\u7edf\u7684list/rename\u6709\u4e00\u81f4\u6027\u548c\u539f\u5b50\u6027\u7684\u8981\u6c42\u3002</p> <p>Iceberg\u4f7f\u7528\u6301\u4e45\u6811\u7ed3\u6784\u8ddf\u8e2a\u6bcf\u4e2a\u5feb\u7167\u4e2d\u6570\u636e\u6587\u4ef6\u7684\u5b8c\u6574\u5217\u8868\u3002\u6bcf\u6b21\u5199\u5165\u6216\u5220\u9664\u90fd\u4f1a\u4ea7\u751f\u4e00\u4e2a\u65b0\u5feb\u7167\uff0c\u8be5\u5feb\u7167\u5c06\u5c3d\u53ef\u80fd\u591a\u5730\u91cd\u7528\u5148\u524d\u5feb\u7167\u7684\u5143\u6570\u636e\u6811\uff0c\u4ee5\u907f\u514d\u5927\u91cf\u5199\u5165\u3002</p> <p>Iceberg\u8868\u4e2d\u7684\u6709\u6548\u5feb\u7167\u4ee5\u53ca\u5bf9\u5f53\u524d\u5feb\u7167\u7684\u5f15\u7528\u90fd\u5b58\u50a8\u5728\u8868\u5143\u6570\u636e\u6587\u4ef6\u4e2d\u3002\u63d0\u4ea4\u65f6\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\u66ff\u6362\u5f53\u524d\u8868\u5143\u6570\u636e\u6587\u4ef6\u7684\u8def\u5f84\u3002\u8fd9\u786e\u4fdd\u5bf9\u8868\u6570\u636e\u548c\u5143\u6570\u636e\u7684\u6240\u6709\u66f4\u65b0\u90fd\u662f\u539f\u5b50\u66f4\u65b0\uff0c\u5e76\u4e14\u662f\u53ef\u5e8f\u5217\u5316\u9694\u79bb\u7684\u57fa\u7840\u3002</p> <ul> <li>\u53ef\u5e8f\u5217\u5316\u7684\u9694\u79bb\uff1a\u6240\u6709\u8868\u66f4\u6539\u90fd\u53d1\u751f\u5728\u539f\u5b50\u8868\u66f4\u65b0\u7684\u7ebf\u6027\u5386\u53f2\u8bb0\u5f55\u4e2d\uff1b</li> <li>\u53ef\u9760\u7684\u8bfb\u53d6\uff1a\u8bfb\u53d6\u5668\u59cb\u7ec8\u4f7f\u7528\u8868\u7684\u4e00\u81f4\u5feb\u7167\u800c\u4e0d\u6301\u6709\u9501\uff1b</li> <li>\u7248\u672c\u5386\u53f2\u8bb0\u5f55\u548c\u56de\u6eda\uff1a\u5c06\u8868\u5feb\u7167\u4fdd\u7559\u4e3a\u5386\u53f2\u8bb0\u5f55\uff0c\u5982\u679c\u4f5c\u4e1a\u4ea7\u751f\u4e0d\u826f\u6570\u636e\uff0c\u5219\u8868\u53ef\u4ee5\u56de\u6eda\uff1b</li> <li>\u5b89\u5168\u7684\u6587\u4ef6\u7ea7\u64cd\u4f5c\uff1a\u901a\u8fc7\u652f\u6301\u539f\u5b50\u66f4\u6539\uff0cIceberg\u81f3\u6b64\u65b0\u7684\u573a\u666f\uff0c\u4f8b\u5982\u5b89\u5168\u5730\u538b\u7f29\u5c0f\u578b\u6587\u4ef6\u5e76\u5c06\u65b0\u6570\u636e\u5b89\u5168\u5730\u9644\u52a0\u5230\u8868\u4e2d\uff1b</li> <li>O\uff081\uff09\u4e2aRPC\uff1a\u4e0d\u7528list O(n)\u4e2a\u76ee\u5f55\u8ba1\u5212\u5355\u4e2ajob\uff0c\u8bfb\u53d6\u5feb\u7167\u53ea\u9700\u8981O(1) RPC \u8c03\u7528\uff1b</li> <li>\u5206\u5e03\u5f0f\u8ba1\u5212\uff1a\u5c06\u6587\u4ef6\u4fee\u526a\u548c\u8c13\u8bcd\u4e0b\u63a8\u5f0f\u5206\u914d\u7ed9\u4f5c\u4e1a\uff0c\u4ece\u800c\u6d88\u9664\u4e86\u5143\u5b58\u50a8\u7684\u74f6\u9888\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#_12","title":"\u5e76\u53d1\u5199\u64cd\u4f5c","text":"<p>\u4e50\u89c2\u9501\u652f\u6301\u591a\u4e2a\u5e76\u53d1\u5199\u5165\u3002</p> <p>\u6bcf\u4e2a\u5199\u8005\u90fd\u5047\u5b9a\u6ca1\u6709\u5176\u4ed6\u5199\u8005\u6b63\u5728\u64cd\u4f5c\uff0c\u5e76\u4e3a\u8be5\u64cd\u4f5c\u5199\u51fa\u65b0\u7684\u8868\u5143\u6570\u636e\u3002\u7136\u540e\uff0c\u5199\u8005\u5c1d\u8bd5\u901a\u8fc7\u539f\u5b50\u65b9\u5f0f\u5c06\u65b0\u8868\u5143\u6570\u636e\u6587\u4ef6\u4ea4\u6362\u4e3a\u73b0\u6709\u5143\u6570\u636e\u6587\u4ef6\u6765\u8fdb\u884c\u63d0\u4ea4\u3002</p> <p>\u5982\u679c\u539f\u5b50\u4ea4\u6362\u7531\u4e8e\u5176\u4ed6\u5199\u5165\u8005\u7684\u63d0\u4ea4\u800c\u5931\u8d25\uff0c\u5219\u5931\u8d25\u7684\u5199\u5165\u8005\u5c06\u6839\u636e\u65b0\u7684\u5f53\u524d\u8868\u72b6\u6001\u901a\u8fc7\u5199\u5165\u65b0\u7684\u5143\u6570\u636e\u6811\u6765\u91cd\u8bd5\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#_13","title":"\u91cd\u8bd5\u7684\u4ee3\u4ef7","text":"<p>\u5199\u5165\u8005\u901a\u8fc7\u7ed3\u6784\u5316\u66f4\u6539\u6765\u907f\u514d\u6602\u8d35\u7684\u91cd\u8bd5\u64cd\u4f5c\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u5728\u91cd\u8bd5\u4e4b\u95f4\u91cd\u7528\u5de5\u4f5c\u3002</p> <p>\u4f8b\u5982\uff0c\u9644\u52a0\u901a\u5e38\u4f1a\u4e3a\u9644\u52a0\u7684\u6570\u636e\u6587\u4ef6\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6e05\u5355\u6587\u4ef6\uff0c\u53ef\u4ee5\u5c06\u5176\u6dfb\u52a0\u5230\u8868\u4e2d\uff0c\u800c\u65e0\u9700\u6bcf\u6b21\u5c1d\u8bd5\u90fd\u91cd\u5199\u6e05\u5355\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#_14","title":"\u91cd\u8bd5\u6821\u9a8c","text":"<p>commit\u88ab\u7ed3\u6784\u5316\u5206\u4e3a\u5047\u8bbe\uff08assumptions\uff09\u548c\u52a8\u4f5c\uff08actions\uff09\u4e24\u90e8\u5206\u3002\u5728\u53d1\u751f\u51b2\u7a81\u540e\uff0c\u5199\u5165\u8005\u68c0\u67e5\u5f53\u524d\u8868\u7684\u72b6\u6001\u53ea\u8981\u6ee1\u8db3\u5047\u8bbe\uff0c\u5c31\u53ef\u4ee5\u5b89\u5168\u5730\u6267\u884c\u52a8\u4f5c\u548c\u63d0\u4ea4\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/iceberg.html#_15","title":"\u517c\u5bb9\u6027","text":"<p>\u901a\u8fc7\u907f\u514dlist\u548crename\u64cd\u4f5c\uff0cIceberg\u652f\u6301\u5bf9\u8c61\u5b58\u50a8\uff0c\u4e0d\u9700\u8981\u4e00\u81f4\u6027\u7684list\u64cd\u4f5c\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/spark.html","title":"Spark","text":"<p>[toc]</p>"},{"location":"data_system/data_lake/apache_iceberg/spark.html#sparkiceberg","title":"Spark\u4f7f\u7528Iceberg","text":"<p>http://iceberg.apache.org/spark/#configuring-catalogs. </p>"},{"location":"data_system/data_lake/apache_iceberg/support_file_format.html","title":"Support file format","text":"<p>[toc]</p>"},{"location":"data_system/data_lake/apache_iceberg/support_file_format.html#_1","title":"\u6587\u4ef6\u5b58\u50a8\u683c\u5f0f","text":"<p>http://iceberg.apache.org/spec/#appendix-a-format-specific-requirements.</p>"},{"location":"data_system/data_lake/apache_iceberg/support_file_format.html#avro","title":"Avro","text":""},{"location":"data_system/data_lake/apache_iceberg/support_file_format.html#parquet","title":"Parquet","text":""},{"location":"data_system/data_lake/apache_iceberg/support_file_format.html#orc","title":"ORC","text":""},{"location":"data_system/data_lake/apache_iceberg/support_file_format.html#json","title":"JSON \u5e8f\u5217\u5316","text":""},{"location":"data_system/data_lake/apache_iceberg/table_spec.html","title":"Table spec","text":"<p>[toc]</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#v014","title":"\u8868\u89c4\u8303\u5b9a\u4e49\uff08v0.14\uff09","text":"<p>https://iceberg.apache.org/spec/</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_1","title":"\u7248\u672c\u8bf4\u660e","text":""},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#version-1analytic-data-tables","title":"Version 1\uff1aAnalytic Data Tables","text":"<p>\u5f53\u524d\u7248\u672c\uff0c\u5b9a\u4e49\u5982\u4f55\u901a\u8fc7\u4e0d\u53ef\u53d8\u7684\u6587\u4ef6\u683c\u5f0f\uff08\u5982Avro\u3001Parquet\u3001ORC\uff09\u7ba1\u7406\u5927\u89c4\u6a21\u5206\u6790\u8868\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#version-2row-level-deletes","title":"Version 2\uff1aRow-level Deletes","text":"<p>\u7248\u672c2\u7684\u76ee\u6807\u662f\u63d0\u4f9b\u4e00\u79cd\u5bf9\u884c\u7ea7\u5220\u9664\u8fdb\u884c\u7f16\u7801\u7684\u65b9\u6cd5\u3002\u6b64\u66f4\u65b0\u53ef\u7528\u4e8e\u5220\u9664\u6216\u66ff\u6362\u4e0d\u53ef\u53d8\u6570\u636e\u6587\u4ef6\u4e2d\u7684\u4e2a\u522b\u884c\uff0c\u800c\u65e0\u9700\u91cd\u5199\u8be5\u6587\u4ef6\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_2","title":"\u76ee\u6807","text":""},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_3","title":"\u53ef\u5e8f\u5217\u5316\u7684\u9694\u79bb","text":"<p>\u8bfb\u53d6\u5c06\u4e0e\u5e76\u53d1\u5199\u9694\u79bb\uff0c\u5e76\u4e14\u59cb\u7ec8\u4f7f\u7528\u8868\u6570\u636e\u7684\u5df2\u63d0\u4ea4\u5feb\u7167\u3002\u5199\u5165\u5c06\u652f\u6301\u5728\u5355\u4e2a\u64cd\u4f5c\u4e2d\u5220\u9664\u548c\u6dfb\u52a0\u6587\u4ef6\uff0c\u5e76\u4e14\u6c38\u8fdc\u4e0d\u4f1a\u90e8\u5206\u53ef\u89c1\u3002\u8bfb\u53d6\u5c06\u4e0d\u4f1a\u83b7\u5f97\u9501\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_4","title":"\u901f\u5ea6","text":"<p>\u4f7f\u7528 O(1) \u8fdc\u7a0b\u8c03\u7528\u6765\u8ba1\u5212\u626b\u63cf\u7684\u6587\u4ef6\uff0c\u800c\u4e0d\u662fO(n)\uff0c\u5176\u4e2dn\u968f\u7740\u8868\u7684\u5927\u5c0f\u589e\u957f\uff0c\u5982\u5206\u533a\u6216\u6587\u4ef6\u7684\u6570\u91cf\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_5","title":"\u89c4\u6a21","text":"<p>\u4f5c\u4e1a\u8ba1\u5212\u5c06\u4e3b\u8981\u7531\u5ba2\u6237\u7aef\u5904\u7406\uff0c\u800c\u4e0d\u662f\u5728\u4e2d\u592e\u5143\u6570\u636e\u5b58\u50a8\u4e0a\u51fa\u73b0\u74f6\u9888\u3002\u5143\u6570\u636e\u5c06\u5305\u62ec\u57fa\u4e8e\u6210\u672c\u7684\u4f18\u5316\u6240\u9700\u7684\u4fe1\u606f\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_6","title":"\u6f14\u8fdb","text":"<p>\u8868\u5c06\u652f\u6301\u5b8c\u6574\u7684\u6a21\u5f0f\u548c\u5206\u533a\u89c4\u8303\u7684\u6f14\u8fdb\u3002\u6a21\u5f0f\u6f14\u5316\u652f\u6301\u5b89\u5168\u7684\u5217\u6dfb\u52a0\u3001\u5220\u9664\u3001\u91cd\u65b0\u6392\u5e8f\u548c\u91cd\u547d\u540d\uff0c\u5305\u62ec\u5728\u5d4c\u5957\u7ed3\u6784\u4e2d\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_7","title":"\u53ef\u9760\u7c7b\u578b","text":"<p>table\u5c06\u4e3a\u4e00\u7ec4\u6838\u5fc3\u7c7b\u578b\u63d0\u4f9b\u826f\u597d\u5b9a\u4e49\u548c\u53ef\u9760\u7684\u652f\u6301\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_8","title":"\u5b58\u50a8\u5206\u79bb","text":"<p>\u5206\u533a\u5c06\u662f\u8868\u914d\u7f6e\u3002\u8bfb\u53d6\u8ba1\u5212\u5c06\u4f7f\u7528\u6570\u636e\u503c\u4e0a\u7684\u8c13\u8bcd\uff0c\u800c\u4e0d\u662f\u5206\u533a\u503c\u3002\u8868\u5c06\u652f\u6301\u6f14\u8fdb\u7684\u5206\u533a\u65b9\u6848\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_9","title":"\u683c\u5f0f","text":"<p>\u5e95\u5c42\u6570\u636e\u6587\u4ef6\u683c\u5f0f\u5c06\u652f\u6301\u76f8\u540c\u7684\u6a21\u5f0f\u6f14\u5316\u89c4\u5219\u548c\u7c7b\u578b\u3002\u8bfb\u548c\u5199\u4f18\u5316\u7684\u683c\u5f0f\u90fd\u53ef\u7528\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_10","title":"\u6982\u89c8","text":"<p>\u8868\u683c\u5f0f\u8ddf\u8e2a\u8868\u4e2d\u7684\u5355\u4e2a\u6570\u636e\u6587\u4ef6\uff0c\u800c\u4e0d\u662f\u76ee\u5f55\u3002</p> <p>\u8868\u72b6\u6001\u4fdd\u5b58\u5728\u5143\u6570\u636e\u6587\u4ef6\u4e2d\u3002\u5bf9\u8868\u72b6\u6001\u7684\u6240\u6709\u66f4\u6539\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5143\u6570\u636e\u6587\u4ef6\uff0c\u5e76\u7528\u539f\u5b50\u4ea4\u6362\u66ff\u6362\u65e7\u7684\u5143\u6570\u636e\u3002\u8868\u5143\u6570\u636e\u6587\u4ef6\u8ddf\u8e2a\u8868\u7ed3\u6784\u3001\u5206\u533a\u914d\u7f6e\u3001\u81ea\u5b9a\u4e49\u5c5e\u6027\u548c\u8868\u5185\u5bb9\u7684\u5feb\u7167\u3002\u5feb\u7167\u8868\u793a\u67d0\u4e2a\u65f6\u95f4\u8868\u7684\u72b6\u6001\uff0c\u7528\u4e8e\u8bbf\u95ee\u8868\u4e2d\u7684\u5b8c\u6574\u6570\u636e\u6587\u4ef6\u96c6\u3002</p> <p>\u5feb\u7167\u4e2d\u7684\u6570\u636e\u6587\u4ef6\u7531\u4e00\u4e2a\u6216\u591a\u4e2a\u6e05\u5355\u6587\u4ef6\u8ddf\u8e2a\uff0c\u6e05\u5355\u6587\u4ef6\u4e2d\u6bcf\u884c\u8868\u793a\u8868\u4e2d\u7684\u4e00\u4e2a\u6570\u636e\u6587\u4ef6\u3001\u6587\u4ef6\u7684\u5206\u533a\u6570\u636e\u53ca\u5176\u6307\u6807\u3002\u5feb\u7167\u4e2d\u7684\u6570\u636e\u662f\u5176\u6e05\u5355\u4e2d\u6240\u6709\u6587\u4ef6\u7684\u5e76\u96c6\u3002\u6e05\u5355\u6587\u4ef6\u53ef\u5728\u5feb\u7167\u4e4b\u95f4\u91cd\u7528\uff0c\u4ee5\u907f\u514d\u91cd\u5199\u53d8\u5316\u7f13\u6162\u7684\u5143\u6570\u636e\u3002\u6e05\u5355\u53ef\u4ee5\u8ddf\u8e2a\u5177\u6709\u8868\u7684\u4efb\u4f55\u5b50\u96c6\u7684\u6570\u636e\u6587\u4ef6\uff0c\u5e76\u4e14\u4e0d\u4e0e\u5206\u533a\u5173\u8054\u3002</p> <p>\u6784\u6210\u5feb\u7167\u7684\u6e05\u5355\u6e05\u5355\u5b58\u50a8\u5728\u6e05\u5355\u5217\u8868\u6587\u4ef6\u4e2d\u3002\u6bcf\u4e2a\u6e05\u5355\u5217\u8868\u5b58\u50a8\u6709\u5173\u6e05\u5355\u7684\u5143\u6570\u636e\uff0c\u5305\u62ec\u5206\u533a\u7edf\u8ba1\u4fe1\u606f\u548c\u6570\u636e\u6587\u4ef6\u8ba1\u6570\u3002\u8fd9\u4e9b\u7edf\u8ba1\u4fe1\u606f\u7528\u4e8e\u907f\u514d\u8bfb\u53d6\u64cd\u4f5c\u4e0d\u9700\u8981\u7684\u6e05\u5355\u3002</p> <p></p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_11","title":"\u4e50\u89c2\u5e76\u884c","text":"<p>\u8868\u5143\u6570\u636e\u6587\u4ef6\u7684\u539f\u5b50\u4ea4\u6362\u63d0\u4f9b\u4e86\u53ef\u5e8f\u5217\u5316\u9694\u79bb\u7684\u57fa\u7840\u3002\u5f53\u8bfb\u53d6\u8868\u5143\u6570\u636e\u65f6\uff0c\u8bfb\u8005\u4f7f\u7528\u5f53\u524d\u7684\u5feb\u7167\uff0c\u5e76\u4e0d\u4f1a\u53d7\u5230\u66f4\u6539\u7684\u5f71\u54cd\uff0c\u76f4\u5230\u5b83\u4eec\u5237\u65b0\u5e76\u83b7\u53d6\u65b0\u7684\u5143\u6570\u636e\u4f4d\u7f6e\u3002</p> <p>\u5199\u5165\u8005\u4e50\u89c2\u5730\u521b\u5efa\u8868\u5143\u6570\u636e\u6587\u4ef6\uff0c\u5047\u8bbe\u5728\u63d0\u4ea4\u8005\u63d0\u4ea4\u4e4b\u524d\u4e0d\u4f1a\u66f4\u6539\u5f53\u524d\u7248\u672c\u3002\u5199\u5165\u8005\u521b\u5efa\u66f4\u65b0\u540e\uff0c\u5b83\u5c06\u901a\u8fc7\u5c06\u8868\u7684\u5143\u6570\u636e\u6587\u4ef6\u6307\u9488\u4ece\u57fa\u672c\u7248\u672c\u4ea4\u6362\u4e3a\u65b0\u7248\u672c\u6765\u8fdb\u884c\u63d0\u4ea4\u3002</p> <p>\u5982\u679c\u66f4\u65b0\u6240\u57fa\u4e8e\u7684\u5feb\u7167\u4e0d\u518d\u662f\u5f53\u524d\u5feb\u7167\uff0c\u5219\u5199\u5165\u8005\u5fc5\u987b\u6839\u636e\u65b0\u7684\u5f53\u524d\u7248\u672c\u91cd\u8bd5\u66f4\u65b0\u3002\u5728\u660e\u786e\u5b9a\u4e49\u7684\u6761\u4ef6\u4e0b\uff0c\u67d0\u4e9b\u64cd\u4f5c\u901a\u8fc7\u91cd\u65b0\u5e94\u7528\u5143\u6570\u636e\u66f4\u6539\u5e76\u63d0\u4ea4\u6765\u652f\u6301\u91cd\u8bd5\u3002\u4f8b\u5982\uff0c\u5982\u679c\u6240\u6709\u91cd\u5199\u7684\u6587\u4ef6\u4ecd\u5728\u8868\u4e2d\uff0c\u5219\u53ef\u4ee5\u5c06\u91cd\u5199\u6587\u4ef6\u7684\u66f4\u6539\u5e94\u7528\u4e8e\u65b0\u7684\u8868\u5feb\u7167\u3002</p> <p>\u5199\u64cd\u4f5c\u6210\u529f\u63d0\u4ea4\u6240\u9700\u7684\u6761\u4ef6\u51b3\u5b9a\u4e86\u9694\u79bb\u7ea7\u522b\u3002\u5199\u5165\u8005\u53ef\u4ee5\u9009\u62e9\u8981\u9a8c\u8bc1\u7684\u5185\u5bb9\uff0c\u5e76\u53ef\u4ee5\u505a\u51fa\u4e0d\u540c\u7684\u9694\u79bb\u4fdd\u8bc1\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_12","title":"\u5e8f\u5217\u53f7","text":"<p>\u6570\u636e\u548c\u5220\u9664\u6587\u4ef6\u7684\u76f8\u5bf9\u5e74\u9f84\u4f9d\u8d56\u4e8e\u5206\u914d\u7ed9\u6bcf\u4e00\u4e2a\u6210\u529f\u63d0\u4ea4\u7684\u5e8f\u5217\u53f7\u3002\u5f53\u4e3acommit\u521b\u5efa\u5feb\u7167\u65f6,\u5b83\u662f\u4f18\u5316\u5730\u5206\u914d\u4e0b\u4e00\u4e2a\u5e8f\u5217\u53f7\uff0c\u5e76\u5c06\u5176\u5199\u5165\u5feb\u7167\u7684\u5143\u6570\u636e\u3002\u5982\u679c\u63d0\u4ea4\u5931\u8d25\u5e76\u5fc5\u987b\u91cd\u65b0\u5c1d\u8bd5\uff0c\u5e8f\u5217\u53f7\u5c06\u91cd\u65b0\u5206\u914d\u5e76\u5199\u5165\u65b0\u7684\u5feb\u7167\u5143\u6570\u636e\u3002</p> <p>\u4e3a\u5feb\u7167\u521b\u5efa\u7684\u6587\u4ef6\uff08\u6240\u6709\u7684\u6e05\u5355\u3001\u6570\u636e\u6587\u4ef6\u548c\u5220\u9664\u6587\u4ef6\uff09\u90fd\u7ee7\u627f\u4e86\u5feb\u7167\u7684\u5e8f\u5217\u53f7\u3002\u6e05\u5355\u5217\u8868\u4e0a\u7684\u6e05\u5355\u6587\u4ef6\u7684\u5143\u6570\u636e\u5b58\u50a8\u4e00\u4e2a\u6e05\u5355\u7684\u5e8f\u5217\u53f7\u3002\u65b0\u6570\u636e\u548c\u5143\u6570\u636e\u6587\u4ef6\u6761\u76ee\u4ee5\u4e00\u4e2a\u5e8f\u5217\u53f7\u4e3anull\uff0c\u5728\u8bfb\u53d6\u65f6\u88ab\u66ff\u6362\u4e3amanifest\u7684\u5e8f\u5217\u53f7\u3002\u5f53\u6570\u636e\u6216\u5220\u9664\u6587\u4ef6\u5199\u5165\u4e00\u4e2a\u65b0\u7684\u6e05\u5355(\u4f5c\u4e3a\u201c\u73b0\u6709\u7684\u201d)\u65f6\uff0c\u7ee7\u627f\u7684\u5e8f\u5217\u53f7\u88ab\u5199\u5165\u4ee5\u786e\u4fdd\u5b83\u5728\u7b2c\u4e00\u6b21\u7ee7\u627f\u540e\u4e0d\u4f1a\u6539\u53d8\u3002</p> <p>\u7ee7\u627f\u6e05\u5355\u5143\u6570\u636e\u7684\u5e8f\u5217\u53f7\u5141\u8bb8\u7f16\u5199\u4e00\u4e2a\u65b0\u7684\u6e05\u5355\u4e00\u6b21\u5e76\u91cd\u65b0\u4f7f\u7528\u5b83\u3002\u4e3a\u4e86\u91cd\u65b0\u5c1d\u8bd5\uff0c\u8981\u66f4\u6539\u4e00\u4e2a\u5e8f\u5217\u53f7\uff0c\u53ea\u6709\u6e05\u5355\u5217\u8868\u5fc5\u987b\u91cd\u5199\uff08\u8be5\u6587\u4ef6\u603b\u662f\u4f1a\u88ab\u6839\u636e\u6700\u65b0\u7684\u6e05\u5355\u6587\u4ef6\u96c6\u5408\u91cd\u5199\uff09\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_13","title":"\u884c\u7ea7\u5220\u9664","text":"<p>\u884c\u7ea7\u5220\u9664\u5b58\u50a8\u5728\u5220\u9664\u6587\u4ef6\u4e2d\u3002\u6709\u4e24\u79cd\u7f16\u7801\u65b9\u5f0f\uff1a</p> <ul> <li>\u4f4d\u7f6e\u5220\u9664\uff08Position deletes\uff09\uff1a\u6307\u5b9a\u6570\u636e\u6587\u4ef6\u7684\u8def\u5f84\u4ee5\u53ca\u884c\u7684\u4f4d\u7f6e\uff0c\u6807\u8bb0\u4e00\u884c\u5220\u9664\uff1b</li> <li>\u76f8\u7b49\u5220\u9664\uff08Equality deletes\uff09\uff1a\u6267\u884c\u4e00\u4e2a\u6216\u591a\u4e2a\u5217\u7684\u503c\u6807\u8bb0\u4e00\u884c\u5220\u9664\uff0c\u6bd4\u5982id=5\u7684\u884c\u5220\u9664\u3002</li> </ul> <p>\u4e0e\u6570\u636e\u6587\u4ef6\u4e00\u6837\uff0c\u901a\u8fc7\u5206\u533a\u8ddf\u8e2a\u5220\u9664\u6587\u4ef6\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u5220\u9664\u6587\u4ef6\u5fc5\u987b\u5e94\u7528\u4e8e\u4e0e\u76f8\u540c\u5206\u533a\u7684\u65e7\u6570\u636e\u6587\u4ef6\uff08\u53c2\u89c1\u626b\u63cf\u8ba1\u5212\uff08Scan Planning\uff09\u8be6\u7ec6\u4fe1\u606f\uff09\u3002\u53ef\u4ee5\u4f7f\u7528\u5217\u7684\u6307\u6807\u5ea6\u91cf\u6570\u636e\u6765\u786e\u5b9a\u5220\u9664\u6587\u4ef6\u7684\u884c\u662f\u5426\u4f1a\u548c\u6570\u636e\u6587\u4ef6/\u626b\u63cf\u8303\u56f4\u7684\u5185\u5bb9\u76f8\u91cd\u53e0\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_14","title":"\u6587\u4ef6\u7cfb\u7edf\u64cd\u4f5c","text":"<p>Iceberg\u4f9d\u8d56\u6587\u4ef6\u7cfb\u7edf\u652f\u6301\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <ul> <li>In-place write\uff1a\u6587\u4ef6\u5728\u5199\u5165\u65f6\u4e0d\u4f1a\u88ab\u79fb\u52a8\u548c\u6539\u52a8\uff1b</li> <li>Seekable reads\uff1a\u6570\u636e\u6587\u4ef6\u7684\u683c\u5f0f\u652f\u6301\u968f\u673a\u8bfb\uff1b</li> <li>Deletes\uff1a\u8868\u7684\u5220\u9664\u6587\u4ef6\u4e0d\u4f1a\u518d\u88ab\u4f7f\u7528\u3002</li> </ul> <p>\u8fd9\u4e9b\u9700\u6c42\u4e0e\u5bf9\u8c61\u5b58\u50a8\u5668\u517c\u5bb9\uff0c\u6bd4\u5982S3\u3002</p> <p>\u8868\u4e0d\u9700\u8981\u968f\u673a\u8bbf\u95ee\u5199\u5165\u64cd\u4f5c\u3002\u4e00\u65e6\u5199\u5165\uff0c\u6570\u636e\u548c\u5143\u6570\u636e\u6587\u4ef6\u662f\u4e0d\u53ef\u53d8\u7684\uff0c\u76f4\u5230\u5220\u9664\u5b83\u4eec\u3002</p> <p>\u8868\u4e0d\u9700\u8981\u91cd\u547d\u540d\u64cd\u4f5c\uff0c\u9664\u4e86\u4f7f\u7528\u539f\u5b50\u91cd\u547d\u540d\u6765\u5b9e\u73b0\u65b0\u7684\u5143\u6570\u636e\u6587\u4ef6\u7684\u63d0\u4ea4\u64cd\u4f5c\u7684\u8868\u4e4b\u5916\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_15","title":"\u89c4\u8303","text":"<p>http://iceberg.apache.org/spec.</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_16","title":"\u6a21\u5f0f\u548c\u6570\u636e\u7c7b\u578b","text":"<p>\u5d4c\u5957\u7c7b\u578b\uff1a</p> <ul> <li>struct\uff1atuple of typed values\uff1b</li> <li>list\uff1a\u540c\u4e00\u4e2a\u7c7b\u578b\u7684\u6570\u7ec4\uff1b</li> <li>map\uff1ak-v\u5bf9\uff0ckey\u5b57\u6bb5\u548cvalue\u5b57\u6bb5\u90fd\u6709\u552f\u4e00\u7684id\u3002</li> </ul> <p>\u57fa\u672c\u7c7b\u578b(\uff1a</p> <ul> <li>boolean\uff0cint\uff0clong\uff0cfloat\uff0cdouble\uff0cdecimal(P,S)\uff1b</li> <li>date\uff0ctime\uff0ctimestamp\uff0ctimestamptz\uff1b</li> <li>string\uff0cuuid\uff0cfixed(L)\uff0cbinary\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_17","title":"\u6a21\u5f0f\u6f14\u5316","text":"<p>\u4efb\u4f55\u7ed3\u6784\uff0c\u5305\u62ec\u9876\u7ea7\u6a21\u5f0f\uff0c\u652f\u6301\u7684\u6a21\u5f0f\u6f14\u5316\uff1a</p> <ul> <li>\u57fa\u672c\u7c7b\u578b\u63d0\u5347\uff08int-&gt;long\uff0cfloat-&gt;double\uff0cdecimal(P,S)-&gt;decimal(P', S) if P' &gt; P\uff09</li> <li>\u6dfb\u52a0\u65b0\u7684\u5b57\u6bb5\uff1b</li> <li>\u91cd\u547d\u540d\u5df2\u6709\u7684\u5b57\u6bb5\uff0c\u4fee\u6539\u540d\u79f0\uff0c\u4f46\u662f\u4e0d\u4fee\u6539id\uff1b</li> <li>\u91cd\u6392\u5e8f\u5df2\u6709\u7684\u5b57\u6bb5\uff1b</li> <li>\u5220\u9664\u5b57\u6bb5\uff1b</li> </ul> <p>\u5176\u5b83\u7684\u6a21\u5f0f\u6539\u53d8\u4e0d\u652f\u6301\u6f14\u5316\uff0c\u5982\u5c06<code>map&lt;string, int&gt; \u2194 map&lt;string, struct&lt;int&gt;&gt;</code>\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_18","title":"\u5217\u6295\u5f71","text":"<p>\u6839\u636e\u5b57\u6bb5id\u9009\u53d6\u5217\uff0c\u56e0\u4e3a\u8868\u6a21\u5f0f\u4e2d\u7684\u5217\u540d\u548c\u987a\u5e8f\u53ef\u4ee5\u5728\u6570\u636e\u6587\u4ef6\u5199\u5165\u540e\u6539\u53d8\u3002\u5982\u679c\u6570\u636e\u6587\u4ef6\u4e2d\u6ca1\u6709\u8be5\u5b57\u6bb5id\uff0c\u5219\u6bcf\u884c\u8be5\u5b57\u6bb5\u5bf9\u5e94\u7684\u503c\u4e3anull\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#ids","title":"\u4fdd\u7559\u7684\u5b57\u6bb5IDs","text":"<p>\u5b57\u6bb5id\u4e0d\u80fd\u8d85\u8fc72147483447\uff08Integer.MAX-200\uff09\uff0c\u4fdd\u7559\u7684ID\u7528\u4e8e\u5143\u6570\u636e\u5217\uff0c\u4f7f\u7528\u5728user data schemas\uff0c\u6bd4\u5982<code>_file</code>\u5217\u4fdd\u5b58\u884c\u5b58\u50a8\u7684\u6587\u4ef6\u8def\u5f84\u3002</p> <p>metadata columns is:</p> Field id, name Type Description <code>2147483646 _file</code> <code>string</code> Path of the file in which a row is stored <code>2147483645 _pos</code> <code>long</code> Ordinal position of a row in the source data file <code>2147483546 file_path</code> <code>string</code> Path of a file, used in position-based delete files <code>2147483545 pos</code> <code>long</code> Ordinal position of a row, used in position-based delete files <code>2147483544 row</code> <code>struct&lt;...&gt;</code> Deleted row values, used in position-based delete files"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_19","title":"\u5206\u533a","text":"<p>\u5bf9\u4e8e\u5b58\u50a8\u5728\u5355\u4e2a\u6570\u636e\u6587\u4ef6\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\uff0c\u6570\u636e\u6587\u4ef6\u7684\u5206\u533a\u503c\u5fc5\u987b\u76f8\u540c\u3002</p> <p>\u5206\u533a\u89c4\u8303\uff08parition spec\uff09\u7684\u7ec4\u6210\uff1a</p> <ul> <li>\u6e90\u5217id\uff08source column id\uff09\uff1a\u6765\u6e90\u4e8e\u8868\u6a21\u5f0f\uff0c\u5fc5\u987b\u662f\u57fa\u672c\u7c7b\u578b\u6216\u8005\u5d4c\u5957\u4e8estruct\uff08\u4e0d\u80fd\u662fmap\u6216\u8005list\uff09\uff1b</li> <li>\u5206\u533a\u5b57\u6bb5id\uff08partition field id\uff09\uff1a\u6807\u8bc6\u4e00\u4e2a\u5206\u533a\u5b57\u6bb5\uff0c\u5e76\u4e14\u5728\u5355\u4e2a\u5206\u533a\u89c4\u8303\u4e2d\u662f\u552f\u4e00\u7684\u3002\u5728v2\u8868\u5143\u6570\u636e\u4e2d\uff0c\u5b83\u5728\u6240\u6709\u5206\u533a\u89c4\u8303\u4e2d\u90fd\u662f\u552f\u4e00\u7684\u3002</li> <li>\u8f6c\u6362\uff08transform\uff09\uff1a\u6839\u636e\u6e90\u5217\u4ea7\u751f\u5206\u533a\u503c\u7684\u51fd\u6570\uff1b</li> <li>\u5206\u533a\u540d\uff08partition name\uff09\uff1b</li> </ul>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_20","title":"\u8f6c\u6362\u7b97\u5b50","text":"<p>\u9488\u5bf9<code>null</code>\u8f93\u5165\u503c\uff0c\u5fc5\u987b\u8fd4\u56de<code>null</code>\u8f93\u51fa\u3002</p> Transform Description Source types Result type <code>identity</code> Source value, unmodified Any Source type <code>bucket[N]</code> Hash of value, mod <code>N</code> (32-bit Murmur3 hash) <code>int</code>, <code>long</code>, <code>decimal</code>, <code>date</code>, <code>time</code>, <code>timestamp</code>, <code>timestamptz</code>, <code>string</code>, <code>uuid</code>, <code>fixed</code>, <code>binary</code> <code>int</code> <code>truncate[W]</code> Value truncated to width <code>W</code> (see below) <code>int</code>, <code>long</code>, <code>decimal</code>, <code>string</code> Source type <code>year</code> Extract a date or timestamp year, as years from 1970 <code>date</code>, <code>timestamp(tz)</code> <code>int</code> <code>month</code> Extract a date or timestamp month, as months from 1970-01-01 <code>date</code>, <code>timestamp(tz)</code> <code>int</code> <code>day</code> Extract a date or timestamp day, as days from 1970-01-01 <code>date</code>, <code>timestamp(tz)</code> <code>date</code> <code>hour</code> Extract a timestamp hour, as hours from 1970-01-01 00:00:00 <code>timestamp(tz)</code> <code>int</code> <p>bucket\u652f\u6301\u5728\u6a21\u5f0f\u6f14\u5316\u4e2d\u5bf9<code>N</code>\u8fdb\u884c\u4fee\u6539\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_21","title":"\u6392\u5e8f","text":"<p><code>sort order</code>\u7531sort order id\u548c\u591a\u4e2asort\u5b57\u6bb5\u7ec4\u6210\uff0c\u6bcf\u4e2asort field\u7531\u4ee5\u4e0b\u7ec4\u6210\uff1a</p> <ul> <li>source column id\uff1b</li> <li>transfrom\uff1a\u7b97\u5b50\u540c\u5206\u533a\u7684\u8f6c\u6362\u7b97\u5b50\u3002</li> <li>sort direction\uff1a\u5347\u5e8f\uff08asc\uff09\u6216\u964d\u5e8f\uff08desc\uff09\uff1b</li> <li>null order\uff1anull \u4f18\u5148\uff08nulls-first\uff09\u6216null\u6700\u540e\uff08nulls-last\uff09\u3002</li> </ul> <p>order id <code>0</code>\u4fdd\u7559\u4f5c\u4e3a\u4e0d\u6392\u5e8f\u7684order\u3002</p> <p>Float\u6392\u5e8f\u89c4\u5219\uff1a<code>-NaN</code> &lt; <code>-Infinity</code> &lt; <code>-value</code> &lt; <code>-0</code> &lt; <code>0</code> &lt; <code>value</code> &lt; <code>Infinity</code> &lt; <code>NaN</code></p> <p>\u5728<code>manifest</code>\u6587\u4ef6\u4e2d\u5b9a\u4e49\u6570\u636e\u6216\u5220\u9664\u6587\u4ef6\u4e2d\u6570\u636e\u7684<code>sort order id</code>\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528\u9ed8\u8ba4\u6392\u5e8f\u987a\u5e8fid\u914d\u7f6e\u8868\uff0c\u6307\u793a\u65b0\u6570\u636e\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5e94\u8be5\u5982\u4f55\u6392\u5e8f\u3002\u5199\u5165\u5668\u5e94\u8be5\u4f7f\u7528\u8fd9\u4e2a\u9ed8\u8ba4\u6392\u5e8f\u987a\u5e8f\u6765\u5bf9\u5199\u5165\u7684\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u4f46\u5982\u679c\u9ed8\u8ba4\u6392\u5e8f\u7684\u4ee3\u4ef7\u592a\u9ad8\uff0c\u5c31\u4e0d\u9700\u8981\u8fd9\u6837\u505a\uff0c\u4f8b\u5982\u5bf9\u6d41\u5199\u6765\u8bf4\u6392\u5e8f\u7684\u4ee3\u4ef7\u592a\u9ad8\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#mainfest","title":"\u6e05\u5355\uff08Mainfest\uff09","text":"<p>\u6e05\u5355\u662f\u4e00\u4e2a\u4e0d\u53ef\u53d8\u7684Avro\u6587\u4ef6\uff0c\u5b83\u5217\u51fa\u6570\u636e\u6587\u4ef6\u6216\u5220\u9664\u6587\u4ef6\uff0c\u4ee5\u53ca\u6bcf\u4e2a\u6587\u4ef6\u7684\u5206\u533a\u6570\u636e\u5143\u7ec4\u3001\u6307\u6807\u548c\u8ddf\u8e2a\u4fe1\u606f\u3002</p> <p>\u6e05\u5355\u662f\u6709\u6548\u7684Iceberg\u6570\u636e\u6587\u4ef6:\u6587\u4ef6\u5fc5\u987b\u4f7f\u7528\u6709\u6548\u7684Iceberg\u683c\u5f0f\u3001\u6a21\u5f0f\u548c\u5217\u6295\u5f71\u3002</p> <p>\u6e05\u5355\u53ef\u4ee5\u5b58\u50a8\u6570\u636e\u6587\u4ef6\u6216\u5220\u9664\u6587\u4ef6\uff0c\u4f46\u4e0d\u80fd\u540c\u65f6\u5b58\u50a8\u6570\u636e\u6587\u4ef6\u6216\u5220\u9664\u6587\u4ef6\uff0c\u56e0\u4e3a\u5728\u4f5c\u4e1a\u8ba1\u5212\u671f\u95f4\u9996\u5148\u626b\u63cf\u5305\u542b\u5220\u9664\u6587\u4ef6\u7684\u6e05\u5355\u3002\u6e05\u5355\u662f\u6570\u636e\u6e05\u5355\u8fd8\u662f\u5220\u9664\u6e05\u5355\u90fd\u5b58\u50a8\u5728\u6e05\u5355\u5143\u6570\u636e\u4e2d\u3002</p> <p>\u6e05\u5355\u5b58\u50a8\u5355\u4e2a\u7684\u5206\u533a\u89c4\u683c\u7684\u6587\u4ef6\u3002\u5f53\u4e00\u4e2a\u8868\u7684\u5206\u533a\u89c4\u683c\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u65e7\u6587\u4ef6\u4fdd\u7559\u5728\u65e7\u7684\u6e05\u5355\u4e2d\uff0c\u65b0\u6587\u4ef6\u88ab\u5199\u5165\u65b0\u7684\u6e05\u5355\u3002</p> <p>\u6e05\u5355\u6587\u4ef6\u5fc5\u987b\u5c06\u5206\u533a\u89c4\u683c\u548c\u5176\u4ed6\u5143\u6570\u636e\u4f5c\u4e3a\u5c5e\u6027\u5b58\u50a8\u5728Avro\u6587\u4ef6\u7684\u952e\u503c\u5143\u6570\u636e\u4e2d\uff1a</p> v1 v2 Key Value required required <code>schema</code> JSON representation of the table schema at the time the manifest was written required required <code>partition-spec</code> JSON fields representation of the partition spec used to write the manifest optional required <code>partition-spec-id</code> Id of the partition spec used to write the manifest as a string optional required <code>format-version</code> Table format version number of the manifest as a string required <code>content</code> Type of content files tracked by the manifest: \u201cdata\u201d or \u201cdeletes\u201d <p>\u6e05\u5355\u6587\u4ef6\u7684\u6a21\u5f0f\u662f\u4e00\u4e2a\u540d\u4e3a<code>manifest_entry</code>\u7684\u7ed3\u6784\u4f53\uff0c\u5e26\u6709\u4ee5\u4e0b\u5b57\u6bb5:</p> v1 v2 Field id, name Type Description required required <code>0 status</code> <code>int</code> with meaning: <code>0: EXISTING</code> <code>1: ADDED</code> <code>2: DELETED</code> Used to track additions and deletions required optional <code>1 snapshot_id</code> <code>long</code> Snapshot id where the file was added, or deleted if status is 2. Inherited when null. optional <code>3 sequence_number</code> <code>long</code> Sequence number when the file was added. Inherited when null. required required <code>2 data_file</code> <code>data_file</code> <code>struct</code> (see below) File path, partition tuple, metrics, \u2026 <p><code>data_file</code> \u662f\u4e2a\u7ed3\u6784\u4f53\uff0c\u5177\u5907\u4ee5\u4e0b\u5b57\u6bb5:</p> v1 v2 Field id, name Type Description required <code>134 content</code> <code>int</code> with meaning: <code>0: DATA</code>, <code>1: POSITION DELETES</code>, <code>2: EQUALITY DELETES</code> Type of content stored by the data file: data, equality deletes, or position deletes (all v1 files are data files) required required <code>100 file_path</code> <code>string</code> Full URI for the file with FS scheme required required <code>101 file_format</code> <code>string</code> String file format name, avro, orc or parquet required required <code>102 partition</code> <code>struct&lt;...&gt;</code> Partition data tuple, schema based on the partition spec required required <code>103 record_count</code> <code>long</code> Number of records in this file required required <code>104 file_size_in_bytes</code> <code>long</code> Total file size in bytes required ~~<code>105 block_size_in_bytes</code>~~ <code>long</code> Deprecated. Always write a default in v1. Do not write in v2. optional ~~<code>106 file_ordinal</code>~~ <code>int</code> Deprecated. Do not write. optional ~~<code>107 sort_columns</code>~~ <code>list&lt;112: int&gt;</code> Deprecated. Do not write. optional optional <code>108 column_sizes</code> <code>map&lt;117: int, 118: long&gt;</code> Map from column id to the total size on disk of all regions that store the column. Does not include bytes necessary to read other columns, like footers. Leave null for row-oriented formats (Avro) optional optional <code>109 value_counts</code> <code>map&lt;119: int, 120: long&gt;</code> Map from column id to number of values in the column (including null and NaN values) optional optional <code>110 null_value_counts</code> <code>map&lt;121: int, 122: long&gt;</code> Map from column id to number of null values in the column optional optional <code>137 nan_value_counts</code> <code>map&lt;138: int, 139: long&gt;</code> Map from column id to number of NaN values in the column optional ~~<code>111 distinct_counts</code>~~ <code>map&lt;123: int, 124: long&gt;</code> Deprecated. Do not write. optional optional <code>125 lower_bounds</code> <code>map&lt;126: int, 127: binary&gt;</code> Map from column id to lower bound in the column serialized as binary [1]. Each value must be less than or equal to all non-null, non-NaN values in the column for the file [2] optional optional <code>128 upper_bounds</code> <code>map&lt;129: int, 130: binary&gt;</code> Map from column id to upper bound in the column serialized as binary [1]. Each value must be greater than or equal to all non-null, non-Nan values in the column for the file [2] optional optional <code>131 key_metadata</code> <code>binary</code> Implementation-specific key metadata for encryption optional optional <code>132 split_offsets</code> <code>list&lt;133: long&gt;</code> Split offsets for the data file. For example, all row group offsets in a Parquet file. Must be sorted ascending optional <code>135 equality_ids</code> <code>list&lt;136: int&gt;</code> Field ids used to determine row equality in equality delete files. Required when <code>content=2</code> and should be null otherwise. Fields with ids listed in this column must be present in the delete file optional optional <code>140 sort_order_id</code> <code>int</code> ID representing sort order for this file [3]. <p>\u6ce8\u610f\uff1a</p> <ul> <li>\u5982\u679c\u6392\u5e8f\u987a\u5e8fID\u7f3a\u5931\u6216\u672a\u77e5\uff0c\u5219\u5047\u5b9a\u8be5\u987a\u5e8f\u662f\u672a\u6392\u5e8f\u7684\u3002\u53ea\u6709\u6570\u636e\u6587\u4ef6\u548c\u76f8\u7b49\u5220\u9664\u6587\u4ef6\u5e94\u8be5\u4f7f\u7528\u975e\u7a7a\u7684\u987a\u5e8fid\u8fdb\u884c\u5199\u5165\u3002\u4f4d\u7f6e\u5220\u9664\u6587\u4ef6\u9700\u8981\u6309\u6587\u4ef6\u548c\u4f4d\u7f6e\u6392\u5e8f\uff0c\u800c\u4e0d\u662f\u8868\u987a\u5e8f\uff0c\u5e76\u4e14\u5e94\u8be5\u5c06\u6392\u5e8f\u987a\u5e8fid\u8bbe\u7f6e\u4e3anull\uff0c\u8bfb\u8005\u5fc5\u987b\u5ffd\u7565\u4f4d\u7f6e\u5220\u9664\u6587\u4ef6\u7684\u6392\u5e8f\u987a\u5e8fid\u3002</li> </ul> <p>\u5206\u533a\u7ed3\u6784\u5b58\u50a8\u6bcf\u4e2a\u6587\u4ef6\u5206\u533a\u503c\u7684\u5143\u7ec4\u3002\u5b83\u7684\u7c7b\u578b\u6d3e\u751f\u4e8e\u7528\u4e8e\u7f16\u5199\u6e05\u5355\u6587\u4ef6\u7684\u5206\u533a\u89c4\u8303\u7684\u5206\u533a\u5b57\u6bb5\u3002\u5728v2\u4e2d\uff0c\u5206\u533a\u7ed3\u6784\u7684\u5b57\u6bb5id\u5fc5\u987b\u4e0e\u5206\u533a\u89c4\u8303\u4e2d\u7684id\u5339\u914d\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#manifest-entry-fields","title":"Manifest Entry Fields","text":"<p>\u6e05\u5355\u8f93\u5165\u5b57\u6bb5\uff08Manifest Entry Fields\uff09\u7528\u4e8e\u8ddf\u8e2a\u5feb\u7167\u4e2d\u6587\u4ef6\u7684\u6dfb\u52a0\u6216\u903b\u8f91\u4e0a\u7684\u5220\u9664\u3002<code>data_file</code>\u7ed3\u6784\u88ab\u5d4c\u5957\u5728\u6e05\u5355\u6761\u76ee\u4e2d\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728\u4e0d\u4f7f\u7528\u6e05\u5355\u6761\u76ee\u5b57\u6bb5\u7684\u60c5\u51b5\u4e0b\u8f7b\u677e\u5730\u5c06\u5176\u4f20\u9012\u7ed9\u4f5c\u4e1a\u8ba1\u5212\u3002</p> <p>\u5f53\u4e00\u4e2a\u6587\u4ef6\u6dfb\u52a0\u5230\u6570\u636e\u96c6\u65f6\uff0c\u5b83\u7684\u6e05\u5355\u6761\u76ee\u5e94\u8be5\u5b58\u50a8\u6dfb\u52a0\u6587\u4ef6\u7684\u5feb\u7167ID\uff0c\u5e76\u5c06status\u8bbe\u7f6e\u4e3a1(\u5df2\u6dfb\u52a0)\u3002</p> <p>\u5f53\u4ece\u6570\u636e\u96c6\u4e2d\u66ff\u6362\u6216\u5220\u9664\u6587\u4ef6\u65f6\uff0c\u5b83\u7684\u6e05\u5355\u6761\u76ee\u5b57\u6bb5\u5b58\u50a8\u5220\u9664\u6587\u4ef6\u7684\u5feb\u7167ID\u548c\u72b6\u60012(\u5df2\u5220\u9664)\u3002\u5f53\u88ab\u5220\u9664\u7684\u5feb\u7167\u88ab\u5783\u573e\u56de\u6536\u65f6\uff0c\u6587\u4ef6\u53ef\u80fd\u4f1a\u4ece\u6587\u4ef6\u7cfb\u7edf\u4e2d\u88ab\u5220\u9664\uff0c\u5047\u8bbe\u65e7\u7684\u5feb\u7167\u4e5f\u88ab\u5783\u573e\u56de\u6536\u4e86[1]\u3002</p> <p>Iceberg v2\u5411\u6761\u76ee\u65b0\u589e\u5e8f\u5217\u53f7\uff0c\u5e76\u4f7f\u5feb\u7167id\u6210\u4e3a\u53ef\u9009\u7684\u3002sequence_number\u548csnapshot_id\u8fd9\u4e24\u4e2a\u5b57\u6bb5\u5728\u4e3a\u7a7a\u65f6\u90fd\u662f\u4ece\u6e05\u5355\u5143\u6570\u636e\u7ee7\u627f\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u67d0\u4e2a\u6761\u76ee\u7684\u5b57\u6bb5\u4e3a\u7a7a\uff0c\u90a3\u4e48\u8be5\u6761\u76ee\u5fc5\u987b\u4ece\u6e05\u5355\u6587\u4ef6\u7684\u5143\u6570\u636e\u4e2d\u7ee7\u627f\u5176\u503c\uff0c\u8be5\u5143\u6570\u636e\u5b58\u50a8\u5728\u6e05\u5355\u5217\u8868[2]\u4e2d\u3002</p> <p>\u6ce8\u610f\uff1a</p> <ol> <li>\u4ece\u6280\u672f\u4e0a\u8bb2\uff0c\u5f53\u5305\u542b\u6587\u4ef6\u4f5c\u4e3a\u201c\u6d3b\u52a8\u201d\u6570\u636e\u7684\u6700\u540e\u4e00\u4e2a\u5feb\u7167\u88ab\u5783\u573e\u6536\u96c6\u65f6\uff0c\u53ef\u4ee5\u5220\u9664\u6570\u636e\u6587\u4ef6\u3002\u4f46\u8fd9\u66f4\u96be\u68c0\u6d4b\uff0c\u56e0\u4e3a\u9700\u8981\u627e\u5230\u591a\u4e2a\u5feb\u7167\u7684\u5dee\u5f02\u3002\u8ddf\u8e2a\u5feb\u7167\u4e2d\u5220\u9664\u4e86\u54ea\u4e9b\u6587\u4ef6\uff0c\u5e76\u5728\u5feb\u7167\u8fc7\u671f\u65f6\u5220\u9664\u8fd9\u4e9b\u6587\u4ef6\uff0c\u8fd9\u66f4\u52a0\u5bb9\u6613\u3002</li> <li>v2\u4e2d\u9700\u8981\u6e05\u5355\u5217\u8868\u6587\u4ef6\uff0c\u56e0\u6b64\u8981\u7ee7\u627f\u7684sequence_number\u548csnapshot_id\u603b\u662f\u53ef\u7528\u7684\u3002</li> </ol>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_22","title":"\u5e8f\u5217\u53f7\u7ee7\u627f","text":"<p>\u5f53\u6570\u636e\u6216\u5220\u9664\u6587\u4ef6\u6dfb\u52a0\u5230\u8868\u4e2d\u65f6\uff0c\u6e05\u5355\u8ddf\u8e2a\u5e8f\u5217\u53f7\u3002</p> <p>\u5728\u6dfb\u52a0\u65b0\u6587\u4ef6\u65f6\uff0c\u5b83\u7684\u5e8f\u53f7\u88ab\u8bbe\u7f6e\u4e3anull\uff0c\u56e0\u4e3a\u5728\u6210\u529f\u63d0\u4ea4\u5feb\u7167\u4e4b\u524d\uff0c\u4e0d\u4f1a\u5206\u914d\u5feb\u7167\u7684\u5e8f\u53f7\u3002\u5728\u8bfb\u53d6\u65f6\uff0c\u901a\u8fc7\u7528\u6e05\u5355\u5217\u8868\u4e2d\u7684\u6e05\u5355\u5e8f\u53f7\u66ff\u6362null\u7ee7\u627f\u5e8f\u5217\u53f7\u3002</p> <p>\u5f53\u5c06\u73b0\u6709\u6587\u4ef6\u5199\u5165\u65b0\u7684\u6e05\u5355\u65f6\uff0c\u5e8f\u53f7\u5fc5\u987b\u4e3a\u975e\u7a7a\uff0c\u5e76\u8bbe\u7f6e\u4e3a\u7ee7\u627f\u7684\u5e8f\u53f7\u3002</p> <p>\u901a\u8fc7\u5143\u6570\u636e\u6811\u7ee7\u627f\u5e8f\u5217\u53f7\u5141\u8bb8\u5728\u6ca1\u6709\u5df2\u77e5\u5e8f\u5217\u53f7\u7684\u60c5\u51b5\u4e0b\u5199\u5165\u65b0\u7684\u6e05\u5355\uff0c\u56e0\u6b64\u6e05\u5355\u53ef\u4ee5\u5199\u5165\u4e00\u6b21\uff0c\u5e76\u5728\u63d0\u4ea4\u91cd\u8bd5\u65f6\u91cd\u7528\u3002\u8981\u66f4\u6539\u5e8f\u5217\u53f7\u8fdb\u884c\u91cd\u8bd5\uff0c\u53ea\u6709\u6e05\u5355\u5217\u8868\u5fc5\u987b\u88ab\u91cd\u5199\u3002</p> <p>\u5f53\u8bfb\u53d6v1\u65f6\u663e\u793a\u6ca1\u6709\u5e8f\u5217\u53f7\u5217\uff0c\u6240\u6709\u6587\u4ef6\u7684\u5e8f\u5217\u53f7\u5fc5\u987b\u9ed8\u8ba4\u4e3a0\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_23","title":"\u5feb\u7167","text":"<p>\u7531\u4ee5\u4e0b\u5b57\u6bb5\u7ec4\u6210\uff1a</p> v1 v2 Field Description required required <code>snapshot-id</code> A unique long ID optional optional <code>parent-snapshot-id</code> The snapshot ID of the snapshot\u2019s parent. Omitted for any snapshot with no parent required <code>sequence-number</code> A monotonically increasing long that tracks the order of changes to a table required required <code>timestamp-ms</code> A timestamp when the snapshot was created, used for garbage collection and table inspection optional required <code>manifest-list</code> The location of a manifest list for this snapshot that tracks manifest files with additional meadata optional <code>manifests</code> A list of manifest file locations. Must be omitted if <code>manifest-list</code> is present optional required <code>summary</code> A string map that summarizes the snapshot changes, including <code>operation</code> (see below) <p>summary\u4e2d\u7684operation\u4e2d\u53ef\u9009\u4e3a\uff1a</p> <ul> <li>append\uff1a\u6dfb\u52a0\u65b0\u7684data\u6587\u4ef6\uff0c\u6ca1\u6709\u6587\u4ef6\u5220\u9664\uff1b</li> <li>replace\uff1a\u6dfb\u52a0\u6216\u5220\u9664\u6570\u636e\u548c\u5220\u9664\u6587\u4ef6\uff0c\u4f46\u662f\u8868\u7684\u6570\u636e\u6ca1\u6709\u6539\u52a8\uff0c\u5982Compaction\u3002</li> <li>overwrite\uff1a\u6dfb\u52a0\u6216\u5220\u9664\u6570\u636e\u548c\u5220\u9664\u6587\u4ef6\uff0c\u903b\u8f91\u4e0a\u7684\u8986\u76d6\uff1b</li> <li>delete\uff1a\u79fb\u9664\u6570\u636e\u6587\u4ef6\uff0c\u6dfb\u52a0\u5220\u9664\u6587\u4ef6\u3002</li> </ul> <p>\u5feb\u7167\u7684\u6570\u636e\u548c\u5220\u9664\u6587\u4ef6\u53ef\u4ee5\u5b58\u50a8\u5728\u591a\u4e2a\u6e05\u5355\u4e2d\u3002\u8fd9\u4f7f\u5f97:</p> <ul> <li>\u5feb\u901f\u8ffd\u52a0\uff08Fast Appending\uff09\uff1a\u8ffd\u52a0\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u6e05\u5355\u6765\u6700\u5c0f\u5316\u5199\u5165\u7684\u6570\u636e\u91cf\uff0c\u800c\u4e0d\u662f\u901a\u8fc7\u91cd\u5199\u548c\u8ffd\u52a0\u5230\u73b0\u6709\u6e05\u5355\u6765\u6dfb\u52a0\u65b0\u8bb0\u5f55\u3002</li> <li>\u8868\u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\u5206\u533a\u89c4\u8303\u3002\u5982\u679c\u8868\u7684\u6570\u636e\u5377\u53d1\u751f\u53d8\u5316\uff0c\u90a3\u4e48\u5b83\u7684\u5206\u533a\u914d\u7f6e\u53ef\u80fd\u4f1a\u53d1\u751f\u53d8\u5316\u3002\u6bcf\u4e2a\u6e05\u5355\u4f7f\u7528\u5355\u4e2a\u5206\u533a\u89c4\u8303\uff0c\u67e5\u8be2\u4e0d\u9700\u8981\u66f4\u6539\uff0c\u56e0\u4e3a\u5206\u533a\u7b5b\u9009\u5668\u662f\u4ece\u6570\u636e\u8c13\u8bcd\u6d3e\u751f\u7684\u3002</li> <li>\u5927\u578b\u8868\u53ef\u4ee5\u8de8\u591a\u4e2a\u6e05\u5355\u5206\u5272\uff0c\u4ee5\u4fbf\u5b9e\u73b0\u53ef\u4ee5\u5e76\u884c\u5316\u4f5c\u4e1a\u8ba1\u5212\u6216\u51cf\u5c11\u91cd\u5199\u6e05\u5355\u7684\u6210\u672c\u3002</li> </ul> <p>\u5feb\u7167\u7684\u6e05\u5355\u7531\u6e05\u5355\u5217\u8868\u8ddf\u8e2a\u3002\u6709\u6548\u7684\u5feb\u7167\u4ee5\u5217\u8868\u5f62\u5f0f\u5b58\u50a8\u5728\u8868\u5143\u6570\u636e\u4e2d\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_24","title":"\u6e05\u5355\u5217\u8868","text":"<p>\u5feb\u7167\u5d4c\u5165\u5728\u8868\u5143\u6570\u636e\u4e2d\uff0c\u4f46\u662f\u5feb\u7167\u7684\u6e05\u5355\u5217\u8868\u5b58\u50a8\u5728\u5355\u72ec\u7684\u6e05\u5355\u5217\u8868\u6587\u4ef6\u4e2d\u3002</p> <p>\u6bcf\u6b21\u5c1d\u8bd5\u63d0\u4ea4\u5feb\u7167\u90fd\u4f1a\u5199\u5165\u65b0\u7684\u6e05\u5355\u5217\u8868\uff0c\u56e0\u4e3a\u6e05\u5355\u5217\u8868\u603b\u662f\u4f1a\u66f4\u6539\u4ee5\u751f\u6210\u65b0\u7684\u5feb\u7167\u3002\u5f53\u5199\u5165\u6e05\u5355\u5217\u8868\u65f6\uff0c\u5c06\u4e3a\u8be5\u5217\u8868\u8ddf\u8e2a\u7684\u6240\u6709\u65b0\u6e05\u5355\u6587\u4ef6\u5199\u5165\u5feb\u7167\u7684(\u4e50\u89c2\u7684)\u5e8f\u5217\u53f7\u3002</p> <p>\u6e05\u5355\u5217\u8868\u5305\u542b\u6458\u8981\u5143\u6570\u636e\uff0c\u53ef\u7528\u4e8e\u5728\u89c4\u5212\u8868\u626b\u63cf\u65f6\u907f\u514d\u626b\u63cf\u5feb\u7167\u4e2d\u7684\u6240\u6709\u6e05\u5355\u3002\u8fd9\u5305\u62ec\u6dfb\u52a0\u7684\u3001\u73b0\u6709\u7684\u548c\u5220\u9664\u7684\u6587\u4ef6\u7684\u6570\u91cf\uff0c\u4ee5\u53ca\u7528\u4e8e\u5199\u5165\u6e05\u5355\u7684\u5206\u533a\u89c4\u8303\u7684\u6bcf\u4e2a\u5b57\u6bb5\u7684\u503c\u7684\u6458\u8981\u3002</p> <p>\u6e05\u5355\u5217\u8868\u662f\u4e00\u4e2a\u6709\u6548\u7684Iceberg\u6570\u636e\u6587\u4ef6\uff1a\u6587\u4ef6\u5fc5\u987b\u4f7f\u7528\u6709\u6548\u7684Iceberg\u683c\u5f0f\u3001\u6a21\u5f0f\u548c\u5217\u6295\u5f71\u3002</p> <p>\u6e05\u5355\u5217\u8868\u6587\u4ef6\u4e2d\u5b58\u50a8<code>manifest_file</code>\u7ed3\u6784\uff1a</p> v1 v2 Field id, name Type Description required required <code>500 manifest_path</code> <code>string</code> Location of the manifest file required required <code>501 manifest_length</code> <code>long</code> Length of the manifest file required required <code>502 partition_spec_id</code> <code>int</code> ID of a partition spec used to write the manifest; must be listed in table metadata <code>partition-specs</code> required <code>517 content</code> <code>int</code> with meaning: <code>0: data</code>, <code>1: deletes</code> The type of files tracked by the manifest, either data or delete files; 0 for all v1 manifests required <code>515 sequence_number</code> <code>long</code> The sequence number when the manifest was added to the table; use 0 when reading v1 manifest lists required <code>516 min_sequence_number</code> <code>long</code> The minimum sequence number of all data or delete files in the manifest; use 0 when reading v1 manifest lists required required <code>503 added_snapshot_id</code> <code>long</code> ID of the snapshot where the manifest file was added optional required <code>504 added_files_count</code> <code>int</code> Number of entries in the manifest that have status <code>ADDED</code> (1), when <code>null</code> this is assumed to be non-zero optional required <code>505 existing_files_count</code> <code>int</code> Number of entries in the manifest that have status <code>EXISTING</code> (0), when <code>null</code> this is assumed to be non-zero optional required <code>506 deleted_files_count</code> <code>int</code> Number of entries in the manifest that have status <code>DELETED</code> (2), when <code>null</code> this is assumed to be non-zero optional required <code>512 added_rows_count</code> <code>long</code> Number of rows in all of files in the manifest that have status <code>ADDED</code>, when <code>null</code> this is assumed to be non-zero optional required <code>513 existing_rows_count</code> <code>long</code> Number of rows in all of files in the manifest that have status <code>EXISTING</code>, when <code>null</code> this is assumed to be non-zero optional required <code>514 deleted_rows_count</code> <code>long</code> Number of rows in all of files in the manifest that have status <code>DELETED</code>, when <code>null</code> this is assumed to be non-zero optional optional <code>507 partitions</code> <code>list&lt;508: field_summary&gt;</code> (see below) A list of field summaries for each partition field in the spec. Each field in the list corresponds to a field in the manifest file\u2019s partition spec. <p><code>field_summary</code>\u7ed3\u6784\uff1a</p> v1 v2 Field id, name Type Description required required <code>509 contains_null</code> <code>boolean</code> Whether the manifest contains at least one partition with a null value for the field optional <code>518 containers_nan</code> <code>boolean</code> Whether the manifest contains at least one partition with a nan value for the field optional optional <code>510 lower_bound</code> <code>bytes</code> [1] Lower bound for the non-null, non-NaN values in the partition field, or null if all values are null or NaN [2] optional optional <code>511 upper_bound</code> <code>bytes</code> [1] Upper bound for the non-null, non-NaN values in the partition field, or null if all values are null or NaN [2]"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#scan-planning","title":"\u626b\u63cf\u8ba1\u5212\uff08Scan Planning\uff09","text":"<p>\u626b\u63cf\u662f\u901a\u8fc7\u8bfb\u53d6\u5f53\u524d\u5feb\u7167\u7684\u6e05\u5355\u6587\u4ef6\u8fdb\u884c\u8ba1\u5212\u3002\u5728\u626b\u63cf\u4e2d\u4e0d\u4f1a\u4f7f\u7528\u6570\u636e\u548c\u5220\u9664\u6e05\u5355\u4e2d\u7684\u5df2\u5220\u9664\u6761\u76ee\u3002</p> <p>\u5bf9\u4e8e\u6bcf\u4e2a\u6e05\u5355\uff0c\u7528\u4e8e\u7b5b\u9009\u6570\u636e\u884c\u7684\u626b\u63cf\u8c13\u8bcd\u88ab\u8f6c\u6362\u4e3a\u7528\u4e8e\u7b5b\u9009\u6570\u636e\u548c\u5220\u9664\u6587\u4ef6\u7684\u5206\u533a\u8c13\u8bcd\u3002\u8fd9\u4e9b\u5206\u533a\u8c13\u8bcd\u7528\u4e8e\u9009\u62e9\u6e05\u5355\u4e2d\u7684\u6570\u636e\u548c\u5220\u9664\u6587\u4ef6\u3002</p> <p>\u5339\u914d\u67e5\u8be2\u7b5b\u9009\u5668\u7684\u5220\u9664\u6587\u4ef6\u5fc5\u987b\u5728\u8bfb\u53d6\u65f6\u5e94\u7528\u4e8e\u6570\u636e\u6587\u4ef6\uff0c\u4f7f\u7528\u4ee5\u4e0b\u89c4\u5219\u9650\u5236\uff1a</p> <ul> <li> <p>\u4f4d\u7f6e\u5220\u9664\u6587\u4ef6\u5fc5\u987b\u5e94\u7528\u4e8e\u6570\u636e\u6587\u4ef6\uff0c\u5f53\u4ee5\u4e0b\u6240\u6709\u9009\u9879\u90fd\u4e3a\u771f\u65f6\uff1a</p> </li> <li> <p>\u6570\u636e\u6587\u4ef6\u7684\u5e8f\u53f7\u5c0f\u4e8e\u6216\u7b49\u4e8e\u5220\u9664\u6587\u4ef6\u7684\u5e8f\u53f7\uff1b</p> </li> <li> <p>\u6570\u636e\u6587\u4ef6\u7684\u5206\u533a(\u5206\u533a\u89c4\u683c\u548c\u5206\u533a\u503c)\u7b49\u4e8e\u5220\u9664\u6587\u4ef6\u7684\u5206\u533a\uff1b</p> </li> <li>\u76f8\u7b49\u5220\u9664\u6587\u4ef6\u5e94\u7528\u4e8e\u6570\u636e\u6587\u4ef6\uff0c\u5f53\u4ee5\u4e0b\u6240\u6709\u9879\u90fd\u4e3a\u771f\u65f6\uff1a</li> <li>\u6570\u636e\u6587\u4ef6\u7684\u5e8f\u53f7\u4e25\u683c\u5c0f\u4e8e\u5220\u9664\u6587\u4ef6\u7684\u5e8f\u53f7</li> <li>\u6570\u636e\u6587\u4ef6\u7684\u5206\u533a(\u89c4\u683c\u548c\u5206\u533a\u503c)\u7b49\u4e8e\u5220\u9664\u6587\u4ef6\u7684\u5206\u533a\u6216\u5220\u9664\u6587\u4ef6\u7684\u5206\u533a\u89c4\u683c\u4e3a\u672a\u5206\u533a</li> </ul> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u5220\u9664\u53ea\u9002\u7528\u4e8e\u65e7\u7684\u6570\u636e\u6587\u4ef6\uff0c\u5e76\u4e14\u5728\u540c\u4e00\u4e2a\u5206\u533a\u4e2d\uff0c\u9664\u4e86\u4e24\u79cd\u7279\u6b8a\u60c5\u51b5:</p> <ul> <li>\u6ca1\u6709\u5206\u533a\u89c4\u8303\u5b58\u50a8\u7684\u76f8\u7b49\u5220\u9664\u6587\u4ef6\u4f5c\u4e3a\u5168\u5c40\u5220\u9664\u5e94\u7528\u3002\u5426\u5219\uff0c\u201c\u5220\u9664\u6587\u4ef6\u201d\u4e0d\u9002\u7528\u4e8e\u5176\u4ed6\u5206\u533a\u4e2d\u7684\u6587\u4ef6\u3002</li> <li>\u4f4d\u7f6e\u5220\u9664\u6587\u4ef6\u5fc5\u987b\u5e94\u7528\u4e8e\u6765\u81ea\u540c\u4e00\u63d0\u4ea4\u7684\u6570\u636e\u6587\u4ef6\uff0c\u5f53\u6570\u636e\u548c\u5220\u9664\u6587\u4ef6\u5e8f\u5217\u53f7\u76f8\u7b49\u65f6\u3002\u8fd9\u5141\u8bb8\u5220\u9664\u5728\u540c\u4e00\u63d0\u4ea4\u4e2d\u6dfb\u52a0\u7684\u884c\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_25","title":"\u8868\u5143\u6570\u636e","text":"<p>\u8868\u7684\u5143\u6570\u636e\u4ee5 JSON \u5b58\u50a8\u3002\u6bcf\u4e2a\u8868\u7684\u5143\u6570\u636e\u6539\u53d8\u65f6\uff0c\u4f1a\u521b\u5efa\u65b0\u7684\u8868\u5143\u7d20\u636e\u6587\u4ef6\uff08\u901a\u8fc7\u539f\u5b50\u6027\u64cd\u4f5c\u63d0\u4ea4\uff09\u3002\u539f\u5b50\u6027\u64cd\u4f5c\u786e\u4fdd\u8868\u5143\u6570\u636e\u7684\u65b0\u7248\u672c\u66ff\u6362\u5b83\u6240\u57fa\u4e8e\u7684\u7248\u672c\u3002\u8fd9\u5c06\u751f\u6210\u8868\u7248\u672c\u7684\u7ebf\u6027\u5386\u53f2\u8bb0\u5f55\uff0c\u5e76\u786e\u4fdd\u5e76\u53d1\u5199\u64cd\u4f5c\u4e0d\u4f1a\u4e22\u5931\u3002</p> <p>\u7528\u4e8e\u63d0\u4ea4\u5143\u6570\u636e\u7684\u539f\u5b50\u64cd\u4f5c\u53d6\u51b3\u4e8e\u5982\u4f55\u8ddf\u8e2a\u8868\uff0c\u8be5\u89c4\u8303\u6ca1\u6709\u5bf9\u5176\u8fdb\u884c\u6807\u51c6\u5316\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_26","title":"\u8868\u5143\u6570\u636e\u5b57\u6bb5","text":"v1 v2 Field Description required required <code>format-version</code> An integer version number for the format. Currently, this is always 1. Implementations must throw an exception if a table\u2019s version is higher than the supported version. optional required <code>table-uuid</code> A UUID that identifies the table, generated when the table is created. Implementations must throw an exception if a table\u2019s UUID does not match the expected UUID after refreshing metadata. required required <code>location</code> The table\u2019s base location. This is used by writers to determine where to store data files, manifest files, and table metadata files. required <code>last-sequence-number</code> The table\u2019s highest assigned sequence number, a monotonically increasing long that tracks the order of snapshots in a table. required required <code>last-updated-ms</code> Timestamp in milliseconds from the unix epoch when the table was last updated. Each table metadata file should update this field just before writing. required required <code>last-column-id</code> An integer; the highest assigned column ID for the table. This is used to ensure columns are always assigned an unused ID when evolving schemas. required required <code>schema</code> The table\u2019s current schema. required <code>partition-spec</code> The table\u2019s current partition spec, stored as only fields. Note that this is used by writers to partition data, but is not used when reading because reads use the specs stored in manifest files. (Deprecated: use <code>partition-specs</code> and <code>default-spec-id</code>instead ) optional required <code>partition-specs</code> A list of partition specs, stored as full partition spec objects. optional required <code>default-spec-id</code> ID of the \u201ccurrent\u201d spec that writers should use by default. optional optional <code>properties</code> A string to string map of table properties. This is used to control settings that affect reading and writing and is not intended to be used for arbitrary metadata. For example, <code>commit.retry.num-retries</code> is used to control the number of commit retries. optional optional <code>current-snapshot-id</code> <code>long</code> ID of the current table snapshot. optional optional <code>snapshots</code> A list of valid snapshots. Valid snapshots are snapshots for which all data files exist in the file system. A data file must not be deleted from the file system until the last snapshot in which it was listed is garbage collected. optional optional <code>snapshot-log</code> A list (optional) of timestamp and snapshot ID pairs that encodes changes to the current snapshot for the table. Each time the current-snapshot-id is changed, a new entry should be added with the last-updated-ms and the new current-snapshot-id. When snapshots are expired from the list of valid snapshots, all entries before a snapshot that has expired should be removed. optional required <code>sort-orders</code> A list of sort orders, stored as full sort order objects. optional required <code>default-sort-order-id</code> Default sort order id of the table. Note that this could be used by writers, but is not used when reading because reads use the specs stored in manifest files."},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_27","title":"\u63d0\u4ea4\u51b2\u7a81\u89e3\u51b3\u548c\u91cd\u8bd5","text":"<p>\u5f53\u4e24\u4e2a\u63d0\u4ea4\u540c\u65f6\u53d1\u751f\u5e76\u4e14\u57fa\u4e8e\u76f8\u540c\u7684\u7248\u672c\u65f6\uff0c\u53ea\u6709\u4e00\u4e2a\u63d0\u4ea4\u4f1a\u6210\u529f\u3002\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u5931\u8d25\u7684\u63d0\u4ea4\u53ef\u4ee5\u5e94\u7528\u5230\u8868\u5143\u6570\u636e\u7684\u65b0\u5f53\u524d\u7248\u672c\u5e76\u91cd\u8bd5\u3002\u66f4\u65b0\u5c06\u9a8c\u8bc1\u5e94\u7528\u4e8e\u65b0\u7248\u672c\u7684\u6761\u4ef6\uff0c\u5982\u679c\u6ee1\u8db3\u8fd9\u4e9b\u6761\u4ef6\uff0c\u5219\u91cd\u8bd5\u3002</p> <ul> <li>Add\u64cd\u4f5c\u6ca1\u6709\u8981\u6c42\uff0c\u53ef\u4ee5\u59cb\u7ec8\u5e94\u7528\uff1b</li> <li>Replace\u64cd\u4f5c\u5fc5\u987b\u9a8c\u8bc1\u5c06\u8981\u5220\u9664\u7684\u6587\u4ef6\u4ecd\u5728\u8868\u4e2d\u3002\u66ff\u6362\u64cd\u4f5c\u7684\u793a\u4f8b\u5305\u62ec\u683c\u5f0f\u66f4\u6539(\u5c06Avro\u6587\u4ef6\u66ff\u6362\u4e3aParquet\u6587\u4ef6)\u548c\u538b\u7f29(\u5c06\u591a\u4e2a\u6587\u4ef6\u66ff\u6362\u4e3a\u5305\u542b\u76f8\u540c\u884c\u7684\u5355\u4e2a\u6587\u4ef6)\uff1b</li> <li>Delete\u64cd\u4f5c\u5fc5\u987b\u9a8c\u8bc1\u8981\u5220\u9664\u7684\u7279\u5b9a\u6587\u4ef6\u4ecd\u7136\u5728\u8868\u4e2d\u3002\u53ef\u4ee5\u59cb\u7ec8\u5e94\u7528\u57fa\u4e8e\u8868\u8fbe\u5f0f\u7684\u5220\u9664\u64cd\u4f5c(\u4f8b\u5982\uff0ctimestamp&lt; X)\uff1b</li> <li>\u8868\u6a21\u5f0f\u66f4\u65b0\u548c\u5206\u533a\u89c4\u8303\u66f4\u6539\u5fc5\u987b\u9a8c\u8bc1\u57fa\u672c\u7248\u672c\u548c\u5f53\u524d\u7248\u672c\u4e4b\u95f4\u7684\u6a21\u5f0f\u6ca1\u6709\u66f4\u6539\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#file-system-tables","title":"\u6587\u4ef6\u7cfb\u7edf\u8868\uff08File System Tables\uff09","text":"<p>\u539f\u5b50\u6027\u7684\u4ea4\u6362\u64cd\u4f5c\u53ef\u4ee5\u901a\u8fc7\u6587\u4ef6\u7cfb\u7edf\u7684\u539f\u5b50\u6027rename\u64cd\u4f5c\u5b9e\u73b0\uff0c\u6bd4\u5982HDFS\u6216\u8005\u5927\u591a\u6570\u7684\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u3002\u6587\u4ef6\u7cfb\u7edf\u8868\u7684schema\u901a\u8fc7<code>HadoopTableOperations</code>\u5b9e\u73b0\u3002</p> <p>\u8868\u5143\u6570\u636e\u7684\u6bcf\u4e2a\u7248\u672c\u5b58\u50a8\u5728\u5143\u6570\u636e\u7684\u6587\u4ef6\u5939\u4e0b\uff08\u5728\u8868\u7684\u57fa\u672c\u8def\u5f84\u4e0b\uff09\uff0c\u901a\u8fc7\u7248\u672c\u53f7V\u9650\u5b9a\u540d\u79f0\u4e3a<code>v&lt;V&gt;.metadata.json</code>\u3002\u63d0\u4ea4\u65b0\u7684\u5143\u6570\u636e\u7248\u672c\u65f6\uff0c<code>V+1</code>\uff0c\u5199\u5165\u8005\u9700\u8981\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\uff1a</p> <ol> <li>\u8bfb\u53d6\u5f53\u524d\u8868\u7684\u5143\u6570\u636e\u7248\u672c<code>V</code>\uff1b</li> <li>\u57fa\u4e8e\u7248\u672c<code>V</code>\u521b\u5efa\u65b0\u7684\u8868\u7684\u5143\u6570\u636e\uff1b</li> <li>\u6839\u636e\u8868\u7684\u65b0\u7684\u5143\u6570\u636e\u751f\u6210\u552f\u4e00\u7684\u6587\u4ef6\uff1a<code>&lt;random-uuid&gt;.metadata.json</code>\uff1b</li> <li>\u91cd\u547d\u540d\u6587\u4ef6\u4e3a<code>v&lt;V+1&gt;.metadata.json</code>\uff0c\u5982\u679c\u91cd\u547d\u540d\u6210\u529f\uff0c\u5219\u63d0\u4ea4\u6210\u529f\uff1b\u5931\u8d25\u5219\u8df3\u5230\u7b2c\u4e00\u6b65\u3002</li> </ol>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#metastore-tables","title":"\u5143\u6570\u636e\u8868\uff08Metastore Tables\uff09","text":"<p>\u63d0\u4ea4\u65b0\u7248\u672c\u7684\u8868\u5143\u6570\u636e\u6240\u9700\u7684\u539f\u5b50\u4ea4\u6362\u53ef\u4ee5\u901a\u8fc7\u5728\u5143\u5b58\u50a8\u6216\u6570\u636e\u5e93\u4e2d\u5b58\u50a8\u4e00\u4e2a\u6307\u9488\u6765\u5b9e\u73b0\uff0c\u8be5\u6570\u636e\u5e93\u4f7f\u7528check-and-put\u64cd\u4f5c\u8fdb\u884c\u66f4\u65b0\u3002</p> <p>\u8868\u5143\u6570\u636e\u7684\u6bcf\u4e2a\u7248\u672c\u5b58\u50a8\u5728\u5143\u6570\u636e\u7684\u6587\u4ef6\u5939\u4e0b\uff08\u5728\u8868\u7684\u57fa\u672c\u8def\u5f84\u4e0b\uff09\uff0c\u6587\u4ef6\u540d\u683c\u5f0f\u4e3a<code>&lt;V&gt;-&lt;uuid&gt;.metadata.json</code>\uff0c\u5305\u542b\u7248\u672c\u53f7\u548cUUID\u3002\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>\u8bfb\u53d6\u5f53\u524d\u8868\u7684\u5143\u6570\u636e\u7248\u672c<code>V</code>\uff1b</li> <li>\u57fa\u4e8e\u7248\u672c<code>V</code>\u521b\u5efa\u65b0\u7684\u8868\u7684\u5143\u6570\u636e\uff1b</li> <li>\u6839\u636e\u8868\u7684\u65b0\u7684\u5143\u6570\u636e\u751f\u6210\u552f\u4e00\u7684\u6587\u4ef6\uff1a<code>&lt;V+1&gt;-&lt;uuid&gt;.metadata.json</code>\uff1b</li> <li>\u8bf7\u6c42\u5143\u5b58\u50a8\u5c06\u8868\u7684\u5143\u6570\u636e\u6307\u9488\u4eceV\u7684\u4f4d\u7f6e\u4ea4\u6362\u5230V+1\u7684\u4f4d\u7f6e\uff0c\u5982\u679c\u4ea4\u6362\u6210\u529f\uff0c\u5219\u63d0\u4ea4\u6210\u529f\uff1b\u5931\u8d25\u5219\u8df3\u5230\u7b2c\u4e00\u6b65\u3002</li> </ol>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_28","title":"\u5220\u9664\u7684\u683c\u5f0f","text":"<p>\u4ee5\u4e0b\u63cf\u8ff0\u5220\u9664\u6587\u4ef6\u4e2d\u5bf9\u884c\u7ea7\u5220\u9664\u8fdb\u884c\u7f16\u7801\u3002v1\u4e2d\u4e0d\u652f\u6301\u884c\u7ea7\u5220\u9664\u3002</p> <p>\u884c\u7ea7\u5220\u9664\u6587\u4ef6\u662f\u6709\u6548\u7684Iceberg\u6570\u636e\u6587\u4ef6\uff1a\u6587\u4ef6\u5fc5\u987b\u4f7f\u7528\u6709\u6548\u7684Iceberg\u683c\u5f0f\u3001\u6a21\u5f0f\u548c\u5217\u6295\u5f71\u3002\u5efa\u8bae\u4f7f\u7528\u8868\u7684\u9ed8\u8ba4\u6587\u4ef6\u683c\u5f0f\u5199\u5165\u5220\u9664\u6587\u4ef6\u3002</p> <p>\u884c\u7ea7\u5220\u9664\u6587\u4ef6\u7531\u6e05\u5355(\u5982\u540c\u6570\u636e\u6587\u4ef6\u4e00\u6837)\u8ddf\u8e2a\u3002\u5220\u9664\u6587\u4ef6\u4f7f\u7528\u4e00\u7ec4\u5355\u72ec\u7684\u6e05\u5355\uff0c\u4f46\u6e05\u5355\u6a21\u5f0f\u662f\u76f8\u540c\u7684\u3002</p> <p>\u4f4d\u7f6e\u5220\u9664\u548c\u76f8\u7b49\u5220\u9664\u90fd\u5141\u8bb8\u7528delete\u5bf9\u5df2\u5220\u9664\u7684\u884c\u503c\u8fdb\u884c\u7f16\u7801\u3002\u8fd9\u53ef\u7528\u4e8e\u91cd\u5efa\u8868\u7684\u66f4\u6539\u6d41\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_29","title":"\u4f4d\u7f6e\u5220\u9664\u6587\u4ef6","text":"<p>\u57fa\u4e8e\u4f4d\u7f6e\u7684\u5220\u9664\u6587\u4ef6\u901a\u8fc7\u4e00\u4e2a\u6216\u591a\u4e2a\u6570\u636e\u6587\u4ef6\u4e2d\u7684\u6587\u4ef6\u548c\u4f4d\u7f6e\u6807\u8bc6\u5df2\u5220\u9664\u7684\u884c\uff0c\u5e76\u4e14\u53ef\u4ee5\u9009\u62e9\u5305\u542b\u5df2\u5220\u9664\u7684\u884c\u3002</p> <p>\u5982\u679c\u5728\u4f4d\u7f6e\u5220\u9664\u6587\u4ef6\u4e2d\u6709\u4e00\u6761\u8bb0\u5f55\u662f\u6570\u636e\u6587\u4ef6\u4e2d\u884c\u7684\u6587\u4ef6\u548c\u4f4d\u7f6e\uff08\u4ece0\u5f00\u59cb\uff09\uff0c\u5219\u5220\u9664\u6570\u636e\u884c\u3002</p> <p>\u5220\u9664\u6587\u4ef6\u5b58\u50a8\u7ed3\u6784\u4f53<code>file_position_delete</code>\uff1a</p> Field id name Type Description <code>2147483546</code> <code>file_path</code> <code>string</code> Full URI of a data file with FS scheme. This must match the <code>file_path</code> of the target data file in a manifest entry <code>2147483545</code> <code>pos</code> <code>long</code> Ordinal position of a deleted row in the target data file identified by <code>file_path</code>, starting at <code>0</code> <code>2147483544</code> <code>row</code> <code>required struct&lt;...&gt;</code> Deleted row values. Omit the column when not storing deleted rows. <p>\u5f53\u5220\u9664\u7684\u884c\u5217\u51fa\u73b0\u65f6\uff0c\u5b83\u7684\u6a21\u5f0f\u53ef\u4ee5\u662f\u8868\u6a21\u5f0f\u7684\u4efb\u4f55\u5b50\u96c6\uff0c\u5e76\u4e14\u5fc5\u987b\u4f7f\u7528\u4e0e\u8868\u5339\u914d\u7684\u5b57\u6bb5id\u3002</p> <p>\u4e3a\u4e86\u786e\u4fdd\u7edf\u8ba1\u6570\u636e\u7684\u51c6\u786e\u6027\uff0c\u6240\u6709\u7684\u5220\u9664\u6761\u76ee\u5fc5\u987b\u5305\u62ec\u884c\u503c\uff0c\u6216\u8005\u5fc5\u987b\u7701\u7565\u5217(\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u5217\u7c7b\u578b\u5fc5\u987b\u662f<code>required</code>)\u3002</p> <p>\u5220\u9664\u6587\u4ef6\u4e2d\u7684\u884c\u5fc5\u987b\u6309file_path\u548cposition\u6392\u5e8f\uff0c\u4ee5\u4fbf\u5728\u626b\u63cf\u65f6\u4f18\u5316\u8fc7\u6ee4\u884c\u3002</p> <ul> <li> <p>\u6309file_path\u6392\u5e8f\u5141\u8bb8\u5728\u5217\u793a\u5b58\u50a8\u683c\u5f0f\u7684\u6587\u4ef6\u4e0b\u63a8\u8fc7\u6ee4\u5668\u3002</p> </li> <li> <p>\u6309\u4f4d\u7f6e\u6392\u5e8f\u5141\u8bb8\u5728\u626b\u63cf\u65f6\u8fc7\u6ee4\u884c\uff0c\u4ee5\u907f\u514d\u5728\u5185\u5b58\u4e2d\u4fdd\u7559\u5220\u9664\u3002</p> </li> </ul>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_30","title":"\u76f8\u7b49\u5220\u9664\u6587\u4ef6\uff08\uff1f\uff09","text":"<p>\u76f8\u7b49\u6027\u5220\u9664\u6587\u4ef6\u901a\u8fc7\u4e00\u4e2a\u6216\u591a\u4e2a\u5217\u503c\u6807\u8bc6\u6570\u636e\u6587\u4ef6\u96c6\u5408\u4e2d\u5df2\u5220\u9664\u7684\u884c\uff0c\u5e76\u4e14\u53ef\u4ee5\u9009\u62e9\u5305\u542b\u5df2\u5220\u9664\u884c\u7684\u9644\u52a0\u5217\u3002</p> <p>\u76f8\u7b49\u5220\u9664\u6587\u4ef6\u5b58\u50a8\u8868\u5217\u7684\u4efb\u4f55\u5b50\u96c6\uff0c\u5e76\u4f7f\u7528\u8868\u7684\u5b57\u6bb5id\u3002\u5220\u9664\u5217\u662f\u7528\u4e8e\u5339\u914d\u6570\u636e\u884c\u7684\u5220\u9664\u6587\u4ef6\u4e2d\u7684\u5217\u3002\u5220\u9664\u5217\u7531\u5220\u9664\u6587\u4ef6\u5143\u6570\u636e\u5217<code>equality_ids</code>\u4e2d\u7684id\u6807\u8bc6\u3002</p> <p>\u5982\u679c\u6570\u636e\u884c\u7684\u503c\u7b49\u4e8e\u5e94\u7528\u4e8e\u8be5\u884c\u6570\u636e\u6587\u4ef6\u7684\u76f8\u7b49\u5220\u9664\u6587\u4ef6\u4e2d\u4efb\u4f55\u4e00\u884c\u7684\u6240\u6709\u5220\u9664\u5217\uff0c\u5219\u5220\u9664\u8be5\u6570\u636e\u884c\u3002</p> <p>delete\u6587\u4ef6\u7684\u6bcf\u4e00\u884c\u4ea7\u751f\u4e00\u4e2a\u76f8\u7b49\u8c13\u8bcd\uff0c\u8be5\u8c13\u8bcd\u5339\u914d\u4efb\u4f55delete\u5217\u76f8\u7b49\u7684\u884c\u3002\u53ef\u4ee5\u5c06\u591a\u4e2a\u5217\u89c6\u4e3a\u76f8\u7b49\u8c13\u8bcd\u7684\u4e0e\u3002\u5982\u679c\u4e00\u884c\u7684\u503c\u4e3a\u7a7a\uff0c\u5219delete\u5217\u4e2d\u7684\u7a7a\u503c\u4e0e\u8be5\u884c\u5339\u914d\uff0c\u76f8\u5f53\u4e8e<code>col is null</code>\u3002</p> <p>\u5982\u679c\u76f8\u7b49\u5220\u9664\u6587\u4ef6\u4e2d\u7684\u5220\u9664\u5217\u7a0d\u540e\u4ece\u8868\u4e2d\u5220\u9664\uff0c\u5219\u5728\u5e94\u7528\u76f8\u7b49\u5220\u9664\u65f6\u4ecd\u5fc5\u987b\u4f7f\u7528\u8be5\u5217\u3002\u5982\u679c\u4e00\u4e2a\u5217\u88ab\u6dfb\u52a0\u5230\u4e00\u4e2a\u8868\u4e2d\uff0c\u7136\u540e\u7528\u4f5c\u76f8\u7b49\u5220\u9664\u6587\u4ef6\u4e2d\u7684\u5220\u9664\u5217\uff0c\u5219\u4f7f\u7528\u666e\u901a\u6295\u5f71\u89c4\u5219\u8bfb\u53d6\u65e7\u6570\u636e\u6587\u4ef6\u7684\u5217\u503c\uff08\u9ed8\u8ba4\u4e3anull\uff09\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/table_spec.html#_31","title":"\u5220\u9664\u6587\u4ef6\u7edf\u8ba1","text":"<p>\u6e05\u5355\u5bf9\u5220\u9664\u6587\u4ef6\u548c\u6570\u636e\u6587\u4ef6\u6301\u6709\u76f8\u540c\u7684\u7edf\u8ba1\u4fe1\u606f\u3002\u5bf9\u4e8e\u5220\u9664\u6587\u4ef6\uff0c\u6307\u6807\u63cf\u8ff0\u4e86\u88ab\u5220\u9664\u7684\u503c\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/time_travel.html","title":"Time travel","text":"<p>[toc]</p>"},{"location":"data_system/data_lake/apache_iceberg/time_travel.html#_1","title":"\u65f6\u95f4\u65c5\u884c","text":""},{"location":"data_system/data_lake/apache_iceberg/time_travel.html#_2","title":"\u793a\u4f8b","text":"<p>\u5047\u8bbe\u6211\u4eec\u7684\u8868\u662f\u5b58\u50a8\u5728 Hive \u7684 MetaStore \u91cc\u9762\u7684\uff0c\u8868\u540d\u4e3a iteblog\uff0c\u5e76\u4e14\u6570\u636e\u7684\u7ec4\u7ec7\u7ed3\u6784\u5982\u4e0a\u5982\u6240\u793a\u3002</p>"},{"location":"data_system/data_lake/apache_iceberg/time_travel.html#_3","title":"\u67e5\u8be2\u6700\u65b0\u5feb\u7167\u7684\u6570\u636e","text":"<ul> <li>\u901a\u8fc7\u6570\u636e\u5e93\u540d\u548c\u8868\u540d\uff0c\u4ece Hive \u7684 MetaStore \u91cc\u9762\u62ff\u5230\u8868\u7684\u4fe1\u606f\u3002</li> <li>\u4ece\u8868\u7684\u5c5e\u6027\u91cc\u9762\u5176\u5b9e\u53ef\u4ee5\u62ff\u5230 <code>metadata_location</code> \u5c5e\u6027\uff0c\u901a\u8fc7\u8fd9\u4e2a\u5c5e\u6027\u53ef\u4ee5\u62ff\u5230 iteblog \u8868\u7684 Iceberg \u7684 metadata \u76f8\u5173\u8def\u5f84\uff0c\u8fd9\u4e2a\u4e5f\u5c31\u662f\u4e0a\u56fe\u6b65\u9aa4\u2460\u7684 /user/iteblog/metadata/2.metadata.json\u3002</li> <li>\u89e3\u6790 /user/iteblog/metadata/2.metadata.json \u6587\u4ef6\uff0c\u91cc\u9762\u53ef\u4ee5\u62ff\u5230\u5f53\u524d\u8868\u7684\u5feb\u7167 id\uff08current-snapshot-id\uff09\uff0c\u4ee5\u53ca\u8fd9\u5f20\u8868\u7684\u6240\u6709\u5feb\u7167\u4fe1\u606f\uff0c\u4e5f\u5c31\u662f JSON \u4fe1\u606f\u91cc\u9762\u7684 snapshots \u6570\u7ec4\u5bf9\u5e94\u7684\u503c\u3002</li> <li>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u5f53\u524d\u8868\u6709\u4e24\u4e2a\u5feb\u7167\uff0cid \u5206\u522b\u4e3a 1 \u548c 2\u3002\u5feb\u7167 1 \u5bf9\u5e94\u7684\u6e05\u5355\u5217\u8868\u6587\u4ef6\u4e3a /user/iteblog/metastore/snap-1.avro\uff1b\u5feb\u7167 2 \u5bf9\u5e94\u7684\u6e05\u5355\u5217\u8868\u6587\u4ef6\u4e3a /user/iteblog/metastore/snap-2.avro\u3002</li> <li>\u5982\u679c\u6211\u4eec\u60f3\u8bfb\u53d6\u8868\u7684\u6700\u65b0\u5feb\u7167\u6570\u636e\uff0c\u4ece current-snapshot-id \u53ef\u77e5\uff0c\u5f53\u524d\u6700\u65b0\u5feb\u7167\u7684 ID \u7b49\u4e8e 2\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u89e3\u6790 /user/iteblog/metastore/snap-2.avro \u6e05\u5355\u5217\u8868\u6587\u4ef6\u5373\u53ef\u3002</li> <li>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0csnap-2.avro \u8fd9\u4e2a\u6e05\u5355\u5217\u8868\u6587\u4ef6\u91cc\u9762\u6709\u4e24\u4e2a\u6e05\u5355\u6587\u4ef6\uff0c\u5206\u522b\u4e3a /user/iteblog/metadata/3.avro \u548c /user/iteblog/metadata/2.avro\u3002\u6ce8\u610f\uff0c\u9664\u4e86\u6e05\u5355\u6587\u4ef6\u7684\u8def\u5f84\u4fe1\u606f\uff0c\u8fd8\u6709 added_data_files_count\u3001existing_data_files_count \u4ee5\u53ca deleted_data_files_count \u4e09\u4e2a\u5c5e\u6027\u3002</li> <li>Iceberg \u5176\u5b9e\u662f\u6839\u636e deleted_data_files_count \u5927\u4e8e 0 \u6765\u5224\u65ad\u5bf9\u5e94\u7684\u6e05\u5355\u6587\u4ef6\u91cc\u9762\u662f\u4e0d\u662f\u88ab\u5220\u9664\u7684\u6570\u636e\u3002\u7531\u4e8e\u4e0a\u56fe /user/iteblog/metadata/2.avro \u6e05\u5355\u6587\u4ef6\u7684 deleted_data_files_count \u5927\u4e8e 0 \uff0c\u6240\u4ee5\u8bfb\u6570\u636e\u7684\u65f6\u5019\u5c31\u65e0\u9700\u8bfb\u8fd9\u4e2a\u6e05\u5355\u6587\u4ef6\u91cc\u9762\u5bf9\u5e94\u7684\u6570\u636e\u6587\u4ef6\u3002\u5728\u8fd9\u4e2a\u573a\u666f\u4e0b\uff0c\u8bfb\u53d6\u6700\u65b0\u5feb\u7167\u6570\u636e\u53ea\u9700\u8981\u770b\u4e0b /user/iteblog/metadata/3.avro \u6e05\u5355\u6587\u4ef6\u91cc\u9762\u5bf9\u5e94\u7684\u6570\u636e\u6587\u4ef6\u5373\u53ef\u3002</li> <li>\u8fd9\u65f6\u5019 Iceberg \u4f1a\u89e3\u6790 /user/iteblog/metadata/3.avro \u6e05\u5355\u6587\u4ef6\uff0c\u91cc\u9762\u5176\u5b9e\u5c31\u53ea\u6709\u4e00\u884c\u6570\u636e\uff0c\u4e5f\u5c31\u662f /user/iteblog/data/4.parquet\uff0c\u6240\u4ee5\u8bfb iteblog \u6700\u65b0\u7684\u6570\u636e\u5176\u5b9e\u53ea\u9700\u8981\u8bfb /user/iteblog/data/4.parquet \u6570\u636e\u6587\u4ef6\u5c31\u53ef\u4ee5\u4e86\u3002</li> </ul>"},{"location":"data_system/data_lake/apache_iceberg/time_travel.html#_4","title":"\u67e5\u8be2\u67d0\u4e2a\u5feb\u7167\u7684\u6570\u636e","text":"<p>\u5728\u67e5\u8be2\u7684\u65f6\u5019\u53ea\u9700\u8981\u6307\u5b9a <code>snapshot-id</code> \u5c5e\u6027\u5373\u53ef\uff0c\u6bd4\u5982\u6211\u4eec\u60f3\u67e5\u8be2\u4e0a\u9762 snapshot-id \u4e3a 1 \u7684\u6570\u636e\uff0c\u53ef\u4ee5\u5728 Spark \u4e2d\u8fd9\u4e48\u5199\uff08\u67e5\u8be2\u6b65\u9aa4\u8ddf\u4e0a\u9762\u4e00\u81f4\uff09\uff1a</p> <pre><code>spark.read\n    .option(\"snapshot-id\", 1L)\n    .format(\"iceberg\")\n    .load(\"path/to/table\")\n</code></pre>"},{"location":"data_system/data_lake/apache_iceberg/time_travel.html#_5","title":"\u6839\u636e\u65f6\u95f4\u6233\u67e5\u770b\u67d0\u4e2a\u5feb\u7167\u7684\u6570\u636e","text":"<p>\u901a\u8fc7 as-of-timestamp \u53c2\u6570\u6307\u5b9a\u65f6\u95f4\u6233\u6765\u8bfb\u53d6\u67d0\u4e2a\u5feb\u7167\u7684\u6570\u636e\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>spark.read\n\u00a0\u00a0\u00a0\u00a0.option(\"as-of-timestamp\", \"12346\")\n\u00a0\u00a0\u00a0\u00a0.format(\"iceberg\")\n\u00a0\u00a0\u00a0\u00a0.load(\"path/to/table\")\n</code></pre> <p>\u7b2c\u4e8c\u6b65\u91cc\u9762\u7684 JSON \u6570\u636e\u91cc\u9762\u6709\u4e2a snapshot-log \u6570\u7ec4\uff0c\u5982\u4e0b\uff1a</p> <pre><code>\"snapshot-log\" : [ {\n  \"timestamp-ms\" : 12345,\n  \"snapshot-id\" : 1\n}, {\n  \"timestamp-ms\" : 23456,\n  \"snapshot-id\" : 2\n}]\n</code></pre> <p>\u6bcf\u4e2a\u5217\u8868\u91cc\u9762\u90fd\u6709\u4e2a timestamp-ms \u5c5e\u6027\u548c snapshot-id \u5c5e\u6027\uff0c\u5e76\u4e14\u662f\u6309\u7167 timestamp-ms \u5347\u5e8f\u7684\u3002\u5728 Iceberg \u5185\u90e8\u5b9e\u73b0\u4e2d\uff0c\u5b83\u4f1a\u5c06 as-of-timestamp \u6307\u5b9a\u7684\u65f6\u95f4\u548c snapshot-log \u6570\u7ec4\u91cc\u9762\u6bcf\u4e2a\u5143\u7d20\u7684 timestamp-ms \u8fdb\u884c\u6bd4\u8f83\uff0c\u627e\u51fa\u6700\u540e\u4e00\u4e2a\u6ee1\u8db3 timestamp-ms &lt;= as-of-timestamp \u5bf9\u5e94\u7684 snapshot-id\u3002</p> <p>\u7531\u4e8e as-of-timestamp=12346 \u6bd4 12345 \u65f6\u95f4\u6233\u5927\uff0c\u4f46\u662f\u6bd4 23456 \u5c0f\uff0c\u6240\u4ee5\u4f1a\u53d6 snapshot-id = 1\uff0c\u4e5f\u5c31\u662f\u62ff\u5230 snapshot-id = 1 \u7684\u5feb\u7167\u6570\u636e\u3002\u5269\u4e0b\u7684\u6570\u636e\u67e5\u8be2\u6b65\u9aa4\u548c\u5728\u67e5\u8be2\u4e2d\u6307\u5b9a snapshot-id \u662f\u4e00\u81f4</p>"},{"location":"data_system/data_lake/deltalake/delta_sharing.html","title":"An open standard for secure data sharing","text":"<p>\u6570\u636e\u6e56(Delta Lake)\u4e2d\u6570\u636e\u7684\u5b89\u5168\u5171\u4eab</p> <p>Delta Sharing is the industry\u2019s first open protocol for secure data sharing, making it simple to share data with other organizations regardless of which computing platforms they use.</p> <p></p>"},{"location":"data_system/data_lake/deltalake/deltalake.html","title":"Delta Lake","text":"<p>Parquet\u6587\u4ef6 + Meta \u6587\u4ef6 + \u4e00\u7ec4\u64cd\u4f5c\u7684API = Delta Lake.</p>"},{"location":"data_system/data_lake/deltalake/deltalake.html#_1","title":"\u7279\u6027","text":"<ol> <li>\u5143\u6570\u636e\u4e5f\u662f\u5927\u6570\u636e\uff0c\u8bbe\u8ba1\u4e86\u57fa\u4e8e\u5206\u5e03\u5f0f\u5b58\u50a8\uff08\u5982HDFS\uff09\u7684\u5143\u6570\u636e\u7cfb\u7edf\uff0c\u89e3\u51b3metastore\u4e0d\u582a\u91cd\u8d1f\u7684\u95ee\u9898\uff1b</li> <li>\u652f\u6301\u66f4\u591a\u79cd\u7c7b\u7684\u66f4\u65b0\u6a21\u5f0f\uff0c\u6bd4\u5982Merge/Update/Delete\u7b49\u64cd\u4f5c\uff0c\u914d\u5408\u6d41\u5f0f\u5199\u5165\u6216\u8005\u8bfb\u53d6\u7684\u652f\u6301\uff0c\u8ba9\u5b9e\u65f6\u6570\u636e\u6e56\u53d8\u5f97\u6c34\u5230\u6e20\u6210\uff1b</li> <li>\u6d41\u6279\u64cd\u4f5c\u53ef\u4ee5\u5171\u4eab\u540c\u4e00\u5f20\u8868\uff1b</li> <li>\u7248\u672c\u6982\u5ff5\uff0c\u53ef\u4ee5\u968f\u65f6\u56de\u6eaf\uff0c\u907f\u514d\u4e00\u6b21\u8bef\u64cd\u4f5c\u6216\u8005\u4ee3\u7801\u903b\u8f91\u800c\u65e0\u6cd5\u6062\u590d\u7684\u707e\u96be\u6027\u540e\u679c\u3002</li> </ol>"},{"location":"data_system/data_lake/deltalake/deltalake.html#_2","title":"\u573a\u666f","text":"<p>Delta Lake is an open-source storage layer that brings ACID transactions to Apache Spark\u2122 and big data workloads\u3002\uff08 Linux \u57fa\u91d1\u4f1a\uff09</p> <p></p> <p>Spark \u4f7f\u7528</p> <pre><code>dataframe.write.format(\"delta\").save(\"/data\")\n</code></pre>"},{"location":"data_system/data_lake/deltalake/paper_delta_lake.html","title":"Delta Lake: HighPerformance ACID Table Storage over Cloud Object Stores","text":"<p>\u5bf9\u4e8e\u5bf9\u8c61\u5b58\u50a8\u7cfb\u7edf\uff0c\u4ee5key-value\u5f62\u5f0f\u63d0\u4f9b\uff0c\u5176\u5143\u6570\u636e\u64cd\u4f5c\u5982list\u4ee3\u4ef7\u6bd4\u8f83\u5927\uff0c\u56e0\u6b64\u5f88\u96be\u5b9e\u73b0ACID\u4e8b\u52a1\u548c\u9ad8\u6027\u80fd\uff1b</p> <p>\u4f7f\u7528 Transaction log \uff08Parquet\u683c\u5f0f\uff09\u63d0\u4f9bACID\u652f\u6301\u3001\u65f6\u95f4\u65c5\u884c\uff08Time Travel\uff09\u548c\u5feb\u901f\u7684\u5143\u6570\u636e\u64cd\u4f5c\u3002</p> <p>\u5b58\u50a8\u5173\u7cfb\u578b\u6570\u636e\u96c6\u7684\u5e38\u7528\u65b9\u5f0f\u662f\u7528\u5217\u5f0f\u6587\u4ef6\u683c\u5f0f\uff08\u5982Parquet\u548cORC\uff09\uff0c\u5c06\u6bcf\u4e2a\u8868\u6309\u7167\u67d0\u4e9b\u5b57\u6bb5\u8fdb\u884c\u5206\u533a\uff0c\u4e00\u5f20\u8868\u7528\u591a\u4e2a\u5bf9\u8c61\u8fdb\u884c\u5b58\u50a8\uff1b</p> <ul> <li>\u63d0\u4f9b\u5f88\u597d\u7684Scan\u6027\u80fd\uff1b</li> <li>\u591a\u4e2a\u5bf9\u8c61\uff08\u5206\u533a\uff09\u7684\u66f4\u65b0\u4e0d\u662f\u539f\u5b50\u6027\uff1b</li> <li>\u5199\u7684\u56de\u6eda\u5f88\u96be\u5b9e\u73b0\uff1b</li> <li>\u767e\u4e07\u5206\u533a\u7684\u8868\u7684\u5143\u64cd\u4f5c\u5982list\u8017\u65f6\uff1b</li> </ul> <p>we maintain information about which objects are part of a Delta table in an ACID manner, using a write-ahead log that is itself stored in the cloud object store.</p> <ul> <li>Time travel\uff1a</li> <li>UPSERT\u3001DELETE\u548cMerge\u64cd\u4f5c\uff1a</li> <li>\u6709\u6548\u7684Streaming I/O\uff1a</li> <li>Caching\uff1a</li> <li>\u6570\u636e\u5e03\u5c40\u4f18\u5316\uff1a</li> <li> <p>\u6a21\u5f0f\u6f14\u5316\uff1a</p> </li> <li> <p>\u5ba1\u8ba1\u65e5\u5fd7\uff1a</p> </li> </ul> <p>standard DBMS management functions usable directly against low-cost object stores.</p> <ul> <li>\u5c06\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\u6309\u987a\u5e8f\u4fdd\u6301\u5728\u8f83\u8fd1\u7684\u4f4d\u7f6e\uff0c\u8fd9\u901a\u5e38\u4f1a\u5bfc\u81f4\u9009\u62e9\u67f1\u72b6\u683c\u5f0f\uff1b</li> <li>\u5bf9\u8c61\u89c4\u6a21\u5927\uff0c\u4f46\u4e0d\u80fd\u592a\u5927\u3002\u5927\u5bf9\u8c61\u589e\u52a0\u66f4\u65b0\u6570\u636e\u7684\u4ee3\u4ef7\uff0c\u56e0\u4e3a\u5bf9\u8c61\u662f\u8986\u76d6\u5168\u5199\uff1b</li> <li>\u907f\u514dList\u64cd\u4f5c\uff0c\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\u4f7f\u64cd\u4f5c\u8bf7\u6c42\u6309\u5b57\u5178\u987a\u5e8f\u6392\u5217\u952e\uff1b</li> </ul> <p>_last_checkpoint\u6587\u4ef6\u4e3b\u8981\u662f\u63d0\u4f9b\u4e00\u4e2a\u6700\u65b0\u7684\u5feb\u7167ID\uff0c\u5e2e\u52a9\u51cf\u5c11LIST\u64cd\u4f5c\u7684\u5f00\u9500\u3002</p>"},{"location":"data_system/data_lake/deltalake/usage.html","title":"Usage","text":""},{"location":"data_system/data_lake/deltalake/usage.html#connector","title":"Connector","text":""},{"location":"data_system/data_lake/deltalake/usage.html#java-library","title":"Java Library","text":""},{"location":"data_system/data_lake/deltalake/usage.html#presto","title":"Presto","text":""},{"location":"data_system/data_lake/deltalake/usage.html#hive-connector","title":"Hive Connector","text":""},{"location":"data_system/data_lake/deltalake/usage.html#sql-delta-import","title":"SQL Delta Import","text":""},{"location":"data_system/data_manage/Apache%20Griffin.html","title":"Apache Griffin","text":"<p>\u5f00\u6e90\u6570\u636e\u8d28\u91cf\u89e3\u51b3\u65b9\u6848\uff08Big Data Quality Solution For Batch and Streaming\uff09</p> <p></p> <p>https://github.com/apache/griffin  (TODO)</p> <p>Currently supports Hive table, avro files on hdfs as data source in batch mode, Kafka as data source in streaming mode.</p>"},{"location":"data_system/data_manage/apache_ranger.html","title":"Ranger","text":"<p>Apache Ranger\u2122 is a framework to enable, monitor and manage comprehensive data security across the Hadoop platform.</p>"},{"location":"data_system/data_manage/apache_ranger.html#_1","title":"\u573a\u666f","text":"<p>Apache Ranger\u662f\u4e00\u4e2aHadoop\u96c6\u7fa4\u6570\u636e\u5b89\u5168\u7ba1\u7406\u7684\u6846\u67b6\uff0c\u63d0\u4f9b\u96c6\u4e2d\u5f0f\u7684\u6388\u6743\u7ba1\u7406\u53ca\u65e5\u5fd7\u5ba1\u8ba1\u3002</p> <ul> <li>\u63d0\u4f9b\u4e86\u7ec6\u7c92\u5ea6\u7ea7\uff08hive\u5217\u7ea7\u522b\uff09</li> <li>\u57fa\u4e8e\u8bbf\u95ee\u7b56\u7565\u7684\u6743\u9650\u6a21\u578b</li> <li>\u6743\u9650\u63a7\u5236\u63d2\u4ef6\u5f0f\uff0c\u7edf\u4e00\u65b9\u4fbf\u7684\u7b56\u7565\u7ba1\u7406</li> <li>\u652f\u6301\u5ba1\u8ba1\u65e5\u5fd7\uff0c\u53ef\u4ee5\u8bb0\u5f55\u5404\u79cd\u64cd\u4f5c\u7684\u5ba1\u8ba1\u65e5\u5fd7\uff0c\u63d0\u4f9b\u7edf\u4e00\u7684\u67e5\u8be2\u63a5\u53e3\u548c\u754c\u9762</li> <li>\u4e30\u5bcc\u7684\u7ec4\u4ef6\u652f\u6301(HDFS,HBASE,HIVE,YARN,KAFKA,STORM)</li> <li>\u652f\u6301\u548ckerberos\u7684\u96c6\u6210</li> <li>\u63d0\u4f9b\u4e86Rest\u63a5\u53e3\u4f9b\u4e8c\u6b21\u5f00\u53d1</li> </ul>"},{"location":"data_system/data_manage/apache_ranger.html#_2","title":"\u67b6\u6784","text":""},{"location":"data_system/data_manage/apache_ranger.html#ranger-admin","title":"Ranger Admin","text":"<p>\u6838\u5fc3\u7ec4\u4ef6\uff0c\u72ec\u7acb\u7684\u8fdb\u7a0b\uff0cRESTFUL\u5f62\u5f0f\u63d0\u4f9b\u7528\u6237\u53ca\u7528\u6237\u7ec4\u3001\u670d\u52a1\u3001\u7b56\u7565\u7684\u589e\u5220\u6539\u67e5\u63a5\u53e3\uff0c\u540c\u65f6\u5185\u7f6e\u4e00\u4e2aWeb\u7ba1\u7406\u9875\u9762\u3002\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u6a21\u5757\uff1a</p> <ul> <li> <p>\u670d\u52a1\u7ba1\u7406\uff08service manager\uff09\uff1a\u76ee\u524d\u652f\u6301\u7684\u670d\u52a1\u6709HDFS\u3001Yarn\u3001Hive\u3001HBase\u3001Kafka\u3001Storm\u3001Knox\u3001Solr\u3001Nifi\u7b49\u670d\u52a1\uff1b</p> </li> <li> <p>\u670d\u52a1\uff08service\uff09\uff1a\u901a\u8fc7\u67d0\u4e00\u4e2a\u670d\u52a1\u7ba1\u7406\u5982HDFS\uff0c\u521b\u5efa\u4e00\u4e2a\u670d\u52a1service\uff0c\u5982hadoopdev\uff0c\u901a\u8fc7\u8fd9\u4e2a\u670d\u52a1\uff0cranger\u63a7\u5236\u53f0\u548c\u5177\u4f53\u73af\u5883\u7684hdfs\u76f8\u5173\u8054\uff1b</p> </li> <li> <p>\u7b56\u7565\uff08policy\uff09\uff1a\u6709\u4e86\u67d0\u4e2a\u670d\u52a1\u540e\uff0c\u5982hadoop\uff0c\u53ef\u4ee5\u7528\u8fd9\u4e2a\u670d\u52a1\u521b\u5efa\u76f8\u5173\u7684\u7b56\u7565\u6765\u7ba1\u7406\u6743\u9650\uff1b</p> </li> <li> <p>\u5ba1\u8ba1\u7ba1\u7406\uff08audit\uff09\uff1a\u5bf9\u6240\u505a\u7684\u64cd\u4f5c\u53ca\u6743\u9650\u8fdb\u884c\u5ba1\u8ba1\uff0c\u901a\u8fc7\u754c\u9762\u53ef\u4ee5\u770b\u5230\u64cd\u4f5c\u65e5\u5fd7\u4fe1\u606f\uff1b</p> </li> <li> <p>\u7528\u6237\u548c\u7528\u6237\u7ec4\u7ba1\u7406\uff08users and groups\uff09\uff1a\u53ef\u4ee5\u589e\u52a0\u5220\u9664\u4fee\u6539\u7528\u6237\u6216\u7528\u6237\u7ec4\u4fe1\u606f\u4ee5\u4fbf\u5bf9\u8fd9\u4e9b\u7528\u6237\u6216\u7528\u6237\u7ec4\u8bbe\u7f6e\u6743\u9650\u3002</p> </li> </ul> <p></p>"},{"location":"data_system/data_manage/apache_ranger.html#ranger-xxx-plugin","title":"Ranger XXX Plugin","text":"<p>\u5d4c\u5165\u5230\u5404\u7cfb\u7edf\u6267\u884c\u6d41\u7a0b\u4e2d\uff0c\u5b9a\u671f\u4eceRangerAdmin\u62c9\u53d6\u7b56\u7565\uff0c\u6839\u636e\u7b56\u7565\u6267\u884c\u8bbf\u95ee\u51b3\u7b56\u6811\uff0c\u5e76\u4e14\u8bb0\u5f55\u8bbf\u95ee\u5ba1\u8ba1</p> \u63d2\u4ef6\u540d\u79f0 \u5b89\u88c5\u8282\u70b9 Hdfs-Plugin NameNode Hbase-Plugin HMaster+HRegionServer Hive-Plugin HiveServer2 Yarn-Plugin ResourceManager <p>\u7b56\u7565\u4f18\u5148\u7ea7\uff1a</p> <ul> <li>\u9ed1\u540d\u5355\u6392\u9664 &gt; \u9ed1\u540d\u5355 &gt;\u767d\u540d\u5355</li> <li>\u767d\u540d\u5355\u6392\u9664\u4f18\u5148\u7ea7\u9ad8\u4e8e\u767d\u540d\u5355</li> </ul>"},{"location":"data_system/data_manage/apache_ranger.html#ranger-usersync","title":"Ranger UserSync","text":"<p>\u7528\u6237\u53ca\u7528\u6237\u7ec4\u540c\u6b65\u7ec4\u4ef6\uff0c\u72ec\u7acb\u7684\u8fdb\u7a0b\uff0c\u652f\u6301Linux\uff08Unix\uff09\u672c\u5730\u7528\u6237\u3001LDAP \u53caAD\uff08windows\u7684\u7528\u6237\u57df\uff09\u7684\u7528\u6237\u53ca\u7528\u6237\u7ec4\u4fe1\u606f\u540c\u6b65\u5230Ranger\u6570\u636e\u5e93\u3002</p>"},{"location":"data_system/data_manage/apache_ranger.html#ranger-sdk","title":"Ranger SDK","text":"<p>\u5bf9\u63a5\u5f00\u653e\u5e73\u53f0\uff0c\u5b9e\u73b0\u5bf9\u7528\u6237\u3001\u7ec4\u3001\u7b56\u7565\u7684\u7ba1\u7406</p>"},{"location":"data_system/data_manage/apache_ranger.html#_3","title":"\u6743\u9650\u6a21\u578b","text":""},{"location":"data_system/data_manage/apache_ranger.html#-","title":"\u7528\u6237-\u8d44\u6e90-\u6743\u9650","text":"<ul> <li>\u7528\u6237\uff1aUser\u6216\u8005Group\uff1b</li> <li>\u8d44\u6e90\uff1a\u4e0d\u540c\u7ec4\u4ef6\u5bf9\u5e94\u7684\u4e1a\u52a1\u8d44\u6e90\u4e0d\u4e00\u6837\uff1b</li> <li>\u6743\u9650\uff1a\u7531AllowACL\u548cDenyACL\u6765\u8868\u8fbe\uff0c\u7c7b\u4f3c\u9ed1\u767d\u540d\u5355\u7684\u673a\u5236\uff1b</li> </ul> \u63d2\u4ef6\u540d\u79f0 \u6743\u9650\u9879 Hdfs Read Write Execute Hbase Read Write Create Admin Hive Select Create Update Drop Alter Index Lock Read Write All Yarn submit-app admin-queue"},{"location":"data_system/data_manage/apache_ranger.html#_4","title":"\u5b9e\u73b0","text":"<p>\u6570\u636e\u5e93\u8bbe\u8ba1</p>"},{"location":"data_system/data_manage/apache_ranger.html#_5","title":"\u4f7f\u7528","text":""},{"location":"data_system/data_manage/apache_ranger.html#_6","title":"\u63d2\u4ef6\u5b89\u88c5","text":"<p>\u672c\u8d28\u4e0a\u662f\u901a\u8fc7\u8bfb\u53d6\u5b89\u88c5ranger\u63d2\u4ef6\u65f6\u751f\u6210\u7684\u914d\u7f6e\u6587\u4ef6\u4ee5\u53ca\u63d2\u4ef6\u81ea\u5e26\u7684jar\u5305\uff0c\u901a\u8fc7\u5b9e\u73b0\u53ef\u6269\u5c55\u63a5\u53e3\u6216\u4ee3\u7801\u6ce8\u5165\u65b9\u5f0f\u6765\u5b9e\u73b0\u903b\u8f91\u5d4c\u5165\u5230\u5404\u4e2a\u670d\u52a1\u7ec4\u4ef6\uff0c\u8fbe\u5230\u6743\u9650\u7ba1\u7406\u3002</p> <p>\u5b89\u88c5\u670d\u52a1\u7ec4\u4ef6\u63d2\u4ef6\u8fc7\u7a0b\u4e2d\uff0c\u5f53\u6267\u884c<code>./enable-xxx-plugin.sh</code>\u65f6\uff0c\u4e3b\u8981\u6267\u884c\u4e86\u4ee5\u4e0b\u4e09\u4e2a\u6b65\u9aa4\uff1a</p> <p>\uff081\uff09\u5c06\u63d2\u4ef6\u81ea\u5e26\u7684<code>conf</code>\u66f4\u65b0\u5230\u5b89\u88c5\u7684\u670d\u52a1\u7ec4\u4ef6<code>conf</code>\u76ee\u5f55\u4e0b\uff0c\u5e76\u4fee\u6539\u76f8\u5e94\u7684\u670d\u52a1<code>conf</code>\u5c5e\u6027\uff1b</p> <p>\uff082\uff09\u5c06\u63d2\u4ef6\u81ea\u5e26\u7684lib\u66f4\u65b0\u5230\u5b89\u88c5\u7684\u670d\u52a1\u7ec4\u4ef6<code>lib</code>\u76ee\u5f55\u4e0b\uff1b</p> <p>\uff083\uff09\u5c06<code>install.properties</code>\u751f\u6210<code>.xml</code>\u6587\u4ef6\uff0c\u66f4\u65b0\u5230\u5b89\u88c5\u7684\u670d\u52a1\u7ec4\u4ef6<code>conf</code>\u76ee\u5f55\u4e0b\u3002</p>"},{"location":"data_system/data_manage/apache_ranger.html#hdfs","title":"HDFS","text":""},{"location":"data_system/data_manage/apache_ranger.html#hdfs_1","title":"HDFS\u914d\u7f6e","text":"<pre><code>&lt;property&gt;\n    &lt;name&gt;dfs.permissions.enabled&lt;/name&gt;\n    &lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n    &lt;name&gt;dfs.permissions&lt;/name&gt;\n    &lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n    &lt;name&gt;dfs.namenode.inode.attributes.provider.class&lt;/name&gt;\n    &lt;value&gt;org.apache.ranger.authorization.hadoop.RangerHdfsAuthorizer&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"data_system/data_manage/apache_ranger.html#ranger_1","title":"Ranger\u754c\u9762\u914d\u7f6e","text":""},{"location":"data_system/data_manage/apache_ranger.html#hbase","title":"HBase","text":"<pre><code>&lt;property&gt;\n    &lt;name&gt;hbase.security.authorization&lt;/name&gt;\n    &lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n    &lt;name&gt;hbase.coprocessor.master.classes&lt;/name&gt;\n   &lt;value&gt;org.apache.ranger.authorization.hbase.RangerAuthorizationCoprocessor&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n    &lt;name&gt;hbase.coprocessor.region.classes&lt;/name&gt;\n    &lt;value&gt;org.apache.ranger.authorization.hbase.RangerAuthorizationCoprocessor&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"data_system/data_manage/apache_ranger.html#hive","title":"Hive","text":"<pre><code>&lt;property&gt;\n    &lt;name&gt;hive.security.authorization.enabled&lt;/name&gt;\n    &lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n    &lt;name&gt;hive.security.authorization.manager&lt;/name&gt;\n    &lt;value&gt;org.apache.ranger.authorization.hive.authorizer.RangerHiveAuthorizerFactory&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"data_system/data_manage/apache_ranger.html#yarn","title":"Yarn","text":"<pre><code>&lt;property&gt;\n    &lt;name&gt;yarn.acl.enable&lt;/name&gt;\n    &lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n    &lt;name&gt;yarn.authorization-provider&lt;/name&gt;\n    &lt;value&gt;org.apache.ranger.authorization.yarn.authorizer.RangerYarnAuthorizer&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"data_system/data_manage/metadata_manage.html","title":"\u5143\u6570\u636e\u7ba1\u7406","text":"<p>\uff082024\uff09Datahub\u90fd\u662f\u76ee\u524d\u6700\u7099\u624b\u53ef\u70ed\u7684\u5143\u6570\u636e\u7ba1\u7406\u5e73\u53f0\u3002Openmetadata\u66f4\u6709\u6570\u636e\u6cbb\u7406\u3001\u6570\u636e\u8d44\u4ea7\u7ba1\u7406\u5e73\u53f0\u7684\u6837\u5b50\u3002</p> Apache Atlas Datahub\uff08LinkedIn\uff09 OpenMetadata \u6280\u672f\u6808 Java Java + Python3.7 Java \u6570\u636e\u53d1\u73b0 \u57fa\u4e8eHook\u673a\u5236 \u57fa\u4e8e\u5b9e\u65f6\u63a8\u9001\u7684\u81ea\u52a8\u53d1\u73b0 \u652f\u6301\u6570\u636e\u79cd\u7c7b \u652f\u6301\u4e3b\u6d41\u5927\u6570\u636e\u7ec4\u4ef6 \u652f\u6301\u79cd\u7c7b\u8f83\u591a \u652f\u6301\u79cd\u7c7b\u8f83\u591a \u652f\u6301RDB \u2705 \u652f\u6301Hive \u2705\uff08\u6709\u4fb5\u5165\u6027\uff09 \u2705 \u2705 \u652f\u6301\u6570\u636e\u6e56 Iceberg \u2705 \u6570\u636e\u5206\u7c7b \u2705\uff08\u81ea\u5b9a\u4e49\u6807\u7b7e\uff09 \u2705 \u5143\u6570\u636e\u68c0\u7d22\uff08UI/API\uff09 \u2705 \u2705 \u2705 \u6570\u636e\u8840\u7f18\u548c\u5173\u7cfb\u8ffd\u8e2a \u2705 \u2705 \u2705 \u5b89\u5168\u6027\u63a7\u5236\u4e0e\u9694\u79bb \u2705\uff08\u57fa\u4e8e\u5b9e\u4f53\u5b9e\u4f8b\uff09 \u2705\uff08\u57fa\u4e8e\u7528\u6237\u548c\u7528\u6237\u7ec4\u7b49\u591a\u79cd\u9694\u79bb\u673a\u5236\uff09 \u2705 \u5143\u6570\u636e\u8d28\u91cf\u5206\u6790 \u2705 \u2705 \u5f00\u6e90\u534f\u8bae Apache-2.0 license Apache-2.0 license Apache-2.0 license"},{"location":"data_system/data_manage/metadata_manage.html#apache-atlas","title":"Apache Atlas","text":"<p>\u5f00\u6e90\u7684\u5927\u6570\u636e\u5143\u6570\u636e\u7ba1\u7406\u548c\u6570\u636e\u6cbb\u7406\u5e73\u53f0\uff0c\u65e8\u5728\u5e2e\u52a9\u7ec4\u7ec7\u6536\u96c6\u3001\u6574\u7406\u548c\u7ba1\u7406\u6570\u636e\u7684\u5143\u6570\u636e\u4fe1\u606f\u3002</p> <p>\u5b83\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u5143\u6570\u636e\u6a21\u578b\u548c\u641c\u7d22\u529f\u80fd\uff0c\u53ef\u4ee5\u4e0e\u5404\u79cd\u6570\u636e\u5b58\u50a8\u548c\u5904\u7406\u5e73\u53f0\u96c6\u6210\u3002</p> <ul> <li>\u652f\u6301 Hadoop \u548c\u975e Hadoop \u5143\u6570\u636e\u7c7b\u578b\uff1b</li> <li>\u5bf9\u6570\u636e\u8840\u7f18\u7684\u8ffd\u6eaf\u8fbe\u5230\u4e86\u5b57\u6bb5\u7ea7\u522b\uff1b</li> </ul> <p>\u6280\u672f\u67b6\u6784\uff1a</p> <ul> <li>HBase \u5b58\u50a8\u5143\u6570\u636e\uff0cSolr\u5b9e\u73b0\u7d22\u5f15\uff1b</li> </ul> <p>\u95ee\u9898\uff1a</p> <ul> <li>\u793e\u7fa4\u6d3b\u8dc3\u5ea6\u4e00\u822c\uff0cAtlas\u540e\u671f\u66f4\u65b0\u4e4f\u529b\uff1b</li> </ul>"},{"location":"data_system/data_manage/metadata_manage.html#datahub","title":"Datahub","text":"<p>Star 8.9K\uff1aThe Metadata Platform for the Modern Data Stack.</p> <p>LinkedIn\u5f00\u6e90\u7684\u5143\u6570\u636e\u641c\u7d22\u548c\u53d1\u73b0\u5e73\u53f0\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u96c6\u4e2d\u5f0f\u7684\u5143\u6570\u636e\u5b58\u50a8\u5e93\uff0c\u7528\u4e8e\u7ba1\u7406\u548c\u6d4f\u89c8\u5404\u79cd\u7c7b\u578b\u7684\u6570\u636e\u96c6\u548c\u6570\u636e\u8d44\u4ea7\u7684\u5143\u6570\u636e\u4fe1\u606f\u3002</p> <ul> <li>\u53ef\u4ee5\u96c6\u6210\u6570\u636e\u8d28\u91cf\u6846\u67b6</li> <li>\u641c\u7d22\uff0c\u6570\u636e\u8840\u7f18\uff0c\u6570\u636e\u5206\u6790\uff0c\u6807\u7b7e\uff0c\u672f\u8bed\u8868\u7b49\u529f\u80fd</li> <li>\u9875\u9762\u7ecf\u8fc7\u6700\u65b0\u7684\u6539\u7248\uff0c\u89c4\u5212\u4e5f\u8f83\u4e3a\u5408\u7406\uff0c\u7f8e\u89c2</li> </ul>"},{"location":"data_system/data_manage/metadata_manage.html#openmetadata","title":"OpenMetadata","text":"<p>Star 3.6K\uff1aOpen Standard for Metadata. A Single place to Discover, Collaborate and Get your data right.</p> <ul> <li>UI \u7aef\u652f\u6301\u591a\u8bed\u8a00\uff0cUI\u975e\u5e38\u7f8e\u89c2\uff0c\u5176\u64cd\u4f5c\u548c\u4f7f\u7528\u903b\u8f91\uff0c\u4e5f\u7b26\u5408\u4e1a\u52a1\u4eba\u5458\u7684\u4e60\u60ef\uff1b</li> <li>\u641c\u7d22\uff0c\u6570\u636e\u8840\u7f18\uff0c\u6570\u636e\u8d28\u91cf\uff0c\u6570\u636e\u5206\u6790\uff0c\u6807\u7b7e\uff0c\u672f\u8bed\u8868\u529f\u80fd\uff0c\u5e76\u4e14\u6709\u56e2\u961f\u534f\u4f5c\u7684\u529f\u80fd\u3002</li> </ul>"},{"location":"data_system/data_manage/data_integration/index.html","title":"\u6570\u636e\u540c\u6b65","text":""},{"location":"data_system/data_manage/data_integration/index.html#_2","title":"\u5bf9\u6bd4","text":"\u7279\u5f81 Apache SeaTunnel Datax Chunjun Byzer \u5f15\u64ce\u7248\u672c 2.3.1\u7248\u672c\uff1a Spark&gt;=2.4.0\uff0cFlink&gt;=1.12.0\uff1b 2.3.1\u4e4b\u524d\u7248\u672c\uff1a Spark&gt;=2 and &lt;3\uff0c Flink &gt;=1.12 and&lt;1.14 \u65e0\u4f9d\u8d56 Flink1.8X-Flink1.12.X,\u9ad8\u7248\u672c\u652f\u6301\u5dee Spark &lt;= 3.3.0 \u5f00\u6e90\u534f\u8bae Apache License Apache License Apache License Apache License \u8bed\u8a00 java java java scala/java \u5f15\u64ce\u4f9d\u8d56 \u5f15\u64ce\u89e3\u8026\uff0c\u53ef\u9009Spark\u3001 Flink\u3001SeaTunnel Engine \u65e0\u4f9d\u8d56 Flink Spark \u652f\u6301\u6267\u884c\u6a21\u5f0f \u6d41/\u6279 \u6279 \u6d41/\u6279 \u6d41/\u6279 \u90e8\u7f72\u96be\u5ea6 \u8f83\u6613 \u8f83\u6613 \u8f83\u6613 \u8f83\u6613 \u7cbe\u51c6\u4e00\u6b21\u6027\u8bed\u4e49 \u90e8\u5206\u8fde\u63a5\u5668\u652f\u6301 \u4e0d\u652f\u6301 \u90e8\u5206\u8fde\u63a5\u5668\u652f\u6301 \u7c7b\u578b \u6570\u636e\u6e90 Apache SeaTunnel Datax Chunjun Byzer \u7c7b\u578b \u6570\u636e\u6e90 Apache SeaTunnel Datax Chunjun Byzer batch \u5173\u7cfb\u578b\u6570\u636e\u5e93 JDBC \u8bfb/\u5199 \u8bfb/\u5199 \u90e8\u5206\u6570\u636e\u5e93\u652f\u6301 \u8bfb/\u5199 NoSQL\u6570\u636e\u5e93 MongoDB \u8bfb/\u5199 \u8bfb/\u5199 \u8bfb/\u5199 \u8bfb Elasticsearch \u8bfb/\u5199 \u5199 \u8bfb/\u5199 \u8bfb Hbase \u5199 \u8bfb/\u5199 \u8bfb/\u5199 \u8bfb Neo4j \u8bfb/\u5199 \u00d7 \u00d7 \u00d7 ... \u6570\u4ed3\u6570\u636e\u5b58\u50a8 Hive \u8bfb/\u5199 \u8bfb/\u5199 \u5199 \u8bfb/\u5199 ClickHouse \u8bfb/\u5199 \u5199 \u8bfb/\u5199 \u00d7 ApacheDoris \u5199 \u5199 \u5199 \u00d7 ... \u6587\u4ef6\u6570\u636e\u6e90 Text \u8bfb/\u5199 \u8bfb/\u5199 \u00d7 \u8bfb/\u5199 Csv \u8bfb/\u5199 \u8bfb/\u5199 \u00d7 \u8bfb/\u5199 Json \u8bfb/\u5199 \u00d7 \u00d7 \u8bfb/\u5199 Parquet \u8bfb/\u5199 \u00d7 \u00d7 \u8bfb/\u5199 orc \u8bfb/\u5199 \u00d7 \u00d7 \u00d7 ... \u65f6\u5e8f\u6570\u636e\u5e93 TDengine \u8bfb/\u5199 \u8bfb/\u5199 \u00d7 \u00d7 InfluxDB \u8bfb/\u5199 \u00d7 \u00d7 \u00d7 stream http \u8bfb/\u5199 \u00d7 \u00d7 \u00d7 Mysql CDC \u8bfb \u00d7 mysql5.x \u8bfb Rabbitmq \u8bfb/\u5199 \u00d7 \u00d7 \u00d7 Sql Server \u8bfb \u00d7 \u8bfb \u00d7 Kafka \u8bfb/\u5199 \u00d7 \u8bfb/\u5199 \u8bfb/\u5199 ... \u4f18\u70b9 \u7f3a\u70b9 Byzer \u90e8\u7f72\u7b80\u5355\uff0c\u652f\u6301\u6d41\u6279\uff1b\u4e07\u7269\u7686\u8868\uff1b\u652f\u6301\u7684\u6570\u636e\u6e90\u8f83\u591a \u5f3a\u4f9d\u8d56Spark Chunjun \u90e8\u7f72\u7b80\u5355\uff0c\u652f\u6301\u6d41\u6279 \u5f3a\u4f9d\u8d56Flink\uff0c\u4e0d\u652f\u6301\u9ad8\u7248\u672c\u7684Flink Datax \u65e0\u4f9d\u8d56\uff0c\u90e8\u7f72\u7b80\u5355\uff0c\u76f8\u5bf9\u6bd4\u8f83\u7a33\u5b9a\uff1b\u652f\u6301\u7684\u6570\u636e\u6e90\u8f83\u591a \u4e0d\u652f\u6301\u6d41 Seatunnel \u5e95\u5c42\u6267\u884c\u5f15\u64ce\u53ef\u89e3\u8026\uff0c\u90e8\u7f72\u7b80\u5355\uff0c\u652f\u6301\u6d41\u548c\u6279\uff1b\u652f\u6301\u6570\u636e\u6e90\u79cd\u7c7b\u591a\uff1b\u7531\u4e8e\u5176\u9ad8\u5ea6\u5c01\u88c5\u7684\u8ba1\u7b97\u5f15\u64ce\u67b6\u6784\uff0c\u53ef\u4ee5\u5f88\u597d\u7684\u4e0e\u4e2d\u53f0\u8fdb\u884c\u878d\u5408\uff0c\u5bf9\u5916\u63d0\u4f9b\u5206\u5e03\u5f0f\u8ba1\u7b97\u80fd\u529b \u6700\u9ad8\u7248\u672c\u652f\u6301spark\u3001flink\u9ad8\u7248\u672c\uff0c\u53ef\u80fd\u5b58\u5728\u5f53\u524d\u7248\u672c\u4e0d\u7a33\u5b9a"},{"location":"data_system/data_manage/data_integration/index.html#_3","title":"\u7c7b\u578b","text":""},{"location":"data_system/data_manage/data_integration/index.html#_4","title":"\u5168\u91cf\u540c\u6b65","text":"<p>\u901a\u8fc7SparkSQL\u6216\u8005Flink SQL\u76f4\u8fdeMySQL\u53bbSelect\u8868\u4e2d\u7684\u6570\u636e\uff0c\u5c06\u6570\u636e\u63d2\u5165\uff08\u8986\u76d6\uff09\u5230Hive\u8868\u4e2d\u3002\u7f3a\u70b9\u5982\u4e0b\uff1a</p> <ul> <li>\u6027\u80fd\u74f6\u9888\uff1a\u968f\u7740\u4e1a\u52a1\u89c4\u6a21\u7684\u589e\u957f\uff0cSelect From MySQL -&gt; Spark -&gt; Load to Hive\u8fd9\u79cd\u6570\u636e\u6d41\u82b1\u8d39\u7684\u65f6\u95f4\u8d8a\u6765\u8d8a\u957f\uff0c\u65e0\u6cd5\u6ee1\u8db3\u4e0b\u6e38\u6570\u4ed3\u751f\u4ea7\u7684\u65f6\u95f4\u8981\u6c42\uff1b</li> <li>\u76f4\u63a5\u4eceMySQL\u4e2dSelect\u5927\u91cf\u6570\u636e\uff0c\u5bf9MySQL\u7684\u5f71\u54cd\u975e\u5e38\u5927\uff0c\u5bb9\u6613\u9020\u6210\u6162\u67e5\u8be2\uff0c\u5f71\u54cd\u4e1a\u52a1\u7ebf\u4e0a\u7684\u6b63\u5e38\u670d\u52a1\uff1b</li> <li>\u7531\u4e8e\u9700\u8981\u6e05\u695a\u76ee\u6807\u8868\u6240\u6709\u6570\u636e\uff0c\u76ee\u6807\u5e93\u4e00\u6bb5\u65f6\u95f4\u5185\u67e5\u4e0d\u5230\u6570\u636e\u3002</li> </ul>"},{"location":"data_system/data_manage/data_integration/index.html#_5","title":"\u589e\u91cf\u540c\u6b65","text":"<p>\u5982\u679c\u8868\u4e2d\u6709\u65f6\u95f4\u6233\uff0c\u53ef\u4ee5\u901a\u8fc7\u65f6\u95f4\u6233\u8fc7\u6ee4\u6570\u636e\uff0c\u5e76\u63d2\u5165\u5230Hive\u8868\u4e2d\uff0c\u7f3a\u70b9\u5982\u4e0b\uff1a</p> <ul> <li>MySQL\u4e2d\u53d1\u751f Update/Delete \u7684\u6570\u636e\u65e0\u6cd5\u5f88\u597d\u5730\u8fdb\u884c\u652f\u6301\uff1b</li> <li>\u8868\u7684Schema\u53d8\u66f4\uff0c\u65e0\u6cd5\u5f88\u597d\u652f\u6301\uff1b</li> </ul>"},{"location":"data_system/data_manage/data_integration/index.html#_6","title":"\u5b9e\u65f6\u540c\u6b65","text":"<p>CDC\uff08Change Data Capture\uff09+ Merge\u7684\u6280\u672f\u65b9\u6848\u3002</p>"},{"location":"data_system/data_manage/data_integration/index.html#_7","title":"\u6570\u636e\u6e56","text":"<p>\u9488\u5bf9\u8868\u7684schema\u53d8\u66f4\u3001\u9700\u8981\u4fdd\u7559\u8868\u7684\u5386\u53f2\u7248\u672c\uff0c\u53ef\u4ee5\u901a\u8fc7\u6570\u636e\u6e56\u8fdb\u884c\u5b58\u50a8\u5b9e\u73b0\uff0c\u6bd4\u5982Apache Hudi\u3001Apache Iceberge\u7b49\u3002</p>"},{"location":"data_system/data_manage/data_integration/index.html#_8","title":"\u6821\u9a8c","text":"<p>\u4fdd\u969c\u6574\u4e2aBinlog\u94fe\u8def\u4e2d\u6570\u636e\u5b8c\u6574\u6027\uff0c\u8bb0\u5f55\u7740\u6574\u4e2a\u6570\u636e\u901a\u9053\u6bcf\u4e00\u4e2a\u6d41\u7a0b\u7684\u6570\u636e\u4fe1\u606f\uff0c\u5982\u67d0\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u6570\u636e\u603b\u548c\u7b49\uff0c\u5305\u542b\u4ee5\u4e0b\u529f\u80fd\uff1a</p> <ul> <li>\u4e3a\u6570\u636e\u56de\u6eaf\u63d0\u4f9b\u5143\u6570\u636e\u652f\u6301</li> <li>\u6821\u9a8c\u6570\u636e\u4e22\u5931\u4e0e\u5ef6\u8fdf\u60c5\u51b5</li> <li>\u6821\u9a8c\u6570\u636e\u5b8c\u6574\u6027</li> </ul>"},{"location":"data_system/data_manage/data_integration/index.html#_9","title":"\u7ec6\u8282","text":""},{"location":"data_system/data_manage/data_integration/index.html#_10","title":"\u6570\u636e\u98d8\u79fb\u7684\u652f\u6301","text":"<p>\u5b58\u5728\u5f88\u591a\u7c7b\u4f3c\u7684\u4e24\u79cdcase\uff0c\u5176\u91c7\u96c6\u5468\u671f\u5b58\u5728\u4e00\u5b9a\u7684\u4e0d\u786e\u5b9a\u6027\uff1a</p> <p>case 1\uff1a\u8ba2\u5355\u7684Binlog\u65e5\u5fd7\u4e2d\uff0c\u5f53\u8ba2\u5355\u4e8b\u4ef6\u7684\u66f4\u65b0\u65f6\u95f4\u572859\u520659\u79d2\u5de6\u53f3\u65f6\uff0c\u6570\u636e\u6709\u53ef\u80fd\u4f1a\u843d\u5728\u4e0b\u4e00\u4e2a\u5c0f\u65f6\u7684\u5206\u533a\uff0c\u4ee5\u81f3\u4e8e\u5f53\u524d\u5c0f\u65f6\u6570\u636e\u6ca1\u6709\u7edf\u8ba1\u5230\u8be5\u6761\u8ba2\u5355\uff0c\u540c\u65f6\u4e0b\u4e00\u4e2a\u5c0f\u65f6\u5206\u533a\u7684\u6570\u636e\u4e5f\u6ca1\u6709\u6253\u4e0a\u76f8\u5e94\u7684\u4e8b\u4ef6\u6807\u7b7e\u3002</p> <p></p> <p>case 2\uff1a\u652f\u4ed8\u7ed3\u7b97\u7cfb\u7edf\uff0c\u5f53\u5929\u6240\u6709\u4ea4\u6613\u8bb0\u5f55\u4f1a\u5728\u6b21\u65e5\u51cc\u6668\u540e\u7ed3\u7b97\u5b8c\u6210\uff0c\u6309\u7167\u9ed8\u8ba4\u91c7\u96c6\u903b\u8f91\uff0c\u5f53\u5929\u7684\u8bb0\u5f55\u843d\u5728\u6b21\u65e5\u7684\u53d8\u66f4\u5185\uff0c\u65e0\u6cd5\u6709\u6548\u652f\u6301\u5f53\u5929\u6838\u7b97\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li> <p>\u80fd\u6839\u636e\u53d1\u5355\u65f6\u95f4\u6233\u8fdb\u884c\u5206\u533a\u4e48\uff1f</p> </li> <li> <p>\u6309\u9700\u914d\u7f6e\u504f\u79fb\u91cf\u3002\u6bd4\u5982\u5c0f\u65f6\u7c92\u5ea6\u9ed8\u8ba4\u4e3a00:00 - 59:59\u4e4b\u95f4\u7684\u6570\u636e\uff0c\u914d\u7f6e5min\u7684\u504f\u79fb\uff0c\u90a3\u4e48\u6570\u636e\u533a\u95f4\u4e3a00:00 - 04:59\uff08\u6b21\u5c0f\u65f6\uff09\uff0c\u591a\u51fa\u6765\u7684\u90e8\u5206\u53ef\u4ee5\u6709\u6548\u89e3\u51b3\u6570\u636e\u6f02\u79fb\u529f\u80fd\uff0c\u540c\u65f6\u4e3a\u53ca\u65f6\u6027\u63d0\u4f9b\u4e86\u6709\u6548\u652f\u6491\u3002</p> </li> </ul>"},{"location":"data_system/data_manage/data_integration/index.html#_11","title":"\u5206\u5e93\u5206\u8868\u7684\u652f\u6301","text":"<p>\u5206\u5e93\u5206\u8868\u7684\u8bc9\u6c42\uff0c\u5176\u89c4\u5219\u4e5f\u53ef\u80fd\u591a\u79cd\u591a\u6837\uff0c\u5982table_{\u57ce\u5e02\u533a\u53f7}\uff0ctable_{\u8fde\u7eed\u6570\u5b57}\uff0ctable_{\u65e5\u671f}\uff0c\u5982\u679c\u9010\u4e2a\u62bd\u53d6\u5e76\u805a\u5408\uff0c\u4e0a\u4e0b\u6e38\u7684\u6210\u672c\u5de8\u5927\u3002\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5728\u6570\u636e\u89c4\u8303\u5c42\u9762\uff0c\u6570\u636e\u94fe\u8def\u4e0a\u4fdd\u969c\u80fd\u81ea\u52a8\u5316\u6536\u96c6\u8fd9\u7c7b\u6570\u636e\u3002</p> <ul> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e00\u4e2a\u5e93\u7684\u6570\u636e\u4f1a\u6536\u96c6\u5230\u4e00\u4e2atopic\u5185\uff0c\u5982\u679c\u6709\u5206\u5e93\u5b58\u5728\u4e5f\u53ef\u4ee5\u4e00\u5e76\u6536\u96c6\u5230\u4e00\u4e2atopic\u5185\uff0c\u4fdd\u8bc1\u903b\u8f91\u4e0a\u5206\u5e93\u5206\u8868\u7684\u6570\u636e\u7269\u7406\u4e0a\u6536\u96c6\u5230\u4e00\u8d77\u3002</li> <li>\u6309\u7167/{db}/{table}/{year}/{month}/{day}/{hour}\u7684\u8def\u5f84\u7ed3\u6784\uff08\u5176\u4e2d\u65e5\u671f\u7531Binlog\u65f6\u95f4\u683c\u5f0f\u5316\u751f\u6210\uff09\u843d\u5730\u5230HDFS\u4e0a\uff0c\u4e00\u4e2a\u903b\u8f91\u8868\u7684\u6570\u636e\u5b58\u50a8\u5728\u4e00\u8d77\u3002</li> <li>ETL\u5904\u7406\u9636\u6bb5\uff0c\u53d6\u51fa\u4e0a\u8ff0\u8def\u5f84\u4e0b\u7684Binlog\u65e5\u5fd7\uff0c\u8fd8\u539f\u5230Hive\u4e2d\u3002</li> </ul>"},{"location":"data_system/data_manage/data_integration/CDC.html","title":"CDC(Change Data Capture)","text":"<p>\u76d1\u6d4b\u5e76\u6355\u83b7\u6570\u636e\u5e93\u7684\u53d8\u52a8\uff08\u5305\u62ec\u6570\u636e\u6216\u6570\u636e\u8868\u7684\u63d2\u5165\uff0c\u66f4\u65b0\uff0c\u5220\u9664\u7b49\uff09\uff0c\u5c06\u8fd9\u4e9b\u53d8\u66f4\u6309\u53d1\u751f\u7684\u987a\u5e8f\u5b8c\u6574\u8bb0\u5f55\u4e0b\u6765\uff0c\u5199\u5165\u5230\u6d88\u606f\u4e2d\u95f4\u4ef6\u4e2d\u4ee5\u4f9b\u5176\u4ed6\u670d\u52a1\u8fdb\u884c\u8ba2\u9605\u53ca\u6d88\u8d39\u3002</p>"},{"location":"data_system/data_manage/data_integration/CDC.html#_1","title":"\u6d41\u7a0b\u56fe","text":""},{"location":"data_system/data_manage/data_integration/CDC.html#_2","title":"\u6574\u4f53\u67b6\u6784","text":""},{"location":"data_system/data_manage/data_integration/CDC.html#_3","title":"\u6570\u636e\u6e90","text":"<p>\u6570\u636e\u5e93\uff08\u5373\u6570\u636e\u6e90\uff09\u9700\u8981\u80fd\u5b8c\u6574\u5730\u8bb0\u5f55\u6216\u8f93\u51fa\u6570\u636e\u5e93\u7684\u4e8b\u4ef6\uff08\u6570\u636e\u6216\u6570\u636e\u8868\u7684\u53d8\u52a8\uff09\u3002</p> \u6570\u636e\u5e93\u540d\u79f0 \u8bb0\u5f55\u6570\u636e\u5e93\u65f6\u95f4\u7684\u7684\u673a\u5236 MySQL binlog PostgreSQL Streaming Replication Protocol MongoDB oplog Oracle ogg"},{"location":"data_system/data_manage/data_integration/CDC.html#_4","title":"\u53d1\u5e03\u670d\u52a1\uff08\u751f\u4ea7\u8005\uff09","text":"<p>\u89e3\u6790\u6570\u636e\u6e90\u8f93\u51fa\u7684\u6d41\u5f0f\u6570\u636e\uff0c\u5e8f\u5217\u5316\u6210\u7edf\u4e00\u7684\u5c01\u88c5\u683c\u5f0f\uff0c\u5e76\u8f93\u51fa\u5230\u6570\u636e\u603b\u7ebf\u4e2d\u3002</p> \u540d\u79f0 \u652f\u6301\u7684\u6570\u636e\u5e93 \u8f93\u51fa\u6e90 \u6570\u636e\u683c\u5f0f zendesk/maxwell MySQL Kafka, RabbitMQ, Redis JSON debezium/debezium MySQL\uff0cMongoDB\uff0cPostgreSQL\uff0cOracle\uff0cSQL Server Kafka Avro alibaba/canal MySQL Kafka, RocketMQ JSON <p>Apache Pulsar\u662f\u5b58\u7b97\u5206\u79bb\u7684\u4e0b\u4e00\u4ee3\u6d88\u606f\u961f\u5217/\u6d41\u5f0f\u6d88\u606f\u7cfb\u7edf\uff0c\u652f\u6301CDC connector\u6709\uff1a</p> <ul> <li>canal</li> <li>Debezium MySQL\uff0cMongoDB\uff0cPostgreSQL</li> </ul>"},{"location":"data_system/data_manage/data_integration/CDC.html#_5","title":"\u6570\u636e\u603b\u7ebf\uff08\u6d88\u606f\u4e2d\u95f4\u4ef6\uff09","text":"<p>\u6570\u636e\u603b\u7ebf\u8fd9\u90e8\u5206\u662f\u4e00\u4e2a\u6d88\u606f\u4e2d\u95f4\u4ef6\uff0c\u5927\u90e8\u5206\u505a CDC \u90fd\u4f1a\u9009\u7528 Kafka\uff08\u672a\u6765\u53ef\u80fd\u662fApache Pulsar\uff09\u3002</p>"},{"location":"data_system/data_manage/data_integration/CDC.html#_6","title":"\u6d88\u8d39\u8005","text":"<p>\u6d88\u8d39\u8005\u90e8\u5206\u6839\u636e\u573a\u666f\u800c\u4e0d\u540c\uff0c\u901a\u5e38\u53ea\u8981\u4f7f\u7528\u76f8\u5e94\u6d88\u606f\u961f\u5217\u7684\u5ba2\u6237\u7aef\u5e93\u5b9e\u73b0\u6d88\u8d39\u8005\uff0c\u6839\u636e\u751f\u4ea7\u8005\u751f\u6210\u7684\u6d88\u606f\u683c\u5f0f\u8fdb\u884c\u89e3\u6790\u5904\u7406\u3002</p>"},{"location":"data_system/data_manage/data_integration/action.html","title":"\u6848\u4f8b","text":"<p>MySQL \u6570\u636e\u5b9e\u65f6\u540c\u6b65\u5230 Hive \u7684\u67b6\u6784\u4e0e\u5b9e\u8df5\uff0c\u6765\u6e90\u4e8e\u7f8e\u56e2\u548c\u6ef4\u6ef4\u3002</p>"},{"location":"data_system/data_manage/data_integration/action.html#_2","title":"\u6574\u4f53\u6570\u636e\u6d41\u7a0b","text":"<p>\u901a\u8fc7\u4e0b\u9762\u7684\u6b65\u9aa4\u5728Hive\u4e0a\u8fd8\u539f\u4e00\u5f20MySQL\u8868\uff1a</p> <ol> <li>\u91c7\u7528Linkedin\u7684\u5f00\u6e90\u9879\u76eeCamus\uff0c\u8d1f\u8d23\u6bcf\u5c0f\u65f6\u628aKafka\u4e0a\u7684Binlog\u6570\u636e\u62c9\u53d6\u5230Hive\u4e0a\u3002</li> <li>\u5bf9\u6bcf\u5f20ODS\u8868\uff0c\u9996\u5148\u9700\u8981\u4e00\u6b21\u6027\u5236\u4f5c\u5feb\u7167\uff08Snapshot\uff09\uff0c\u628aMySQL\u91cc\u7684\u5b58\u91cf\u6570\u636e\u8bfb\u53d6\u5230Hive\u4e0a\uff0c\u53ef\u4ee5\u91c7\u7528\u76f4\u8fdeMySQL\u53bbSelect\u6570\u636e\u7684\u65b9\u5f0f\u3002</li> <li>\u5bf9\u6bcf\u5f20ODS\u8868\uff0c\u6bcf\u5929\u57fa\u4e8e\u5b58\u91cf\u6570\u636e\u548c\u5f53\u5929\u589e\u91cf\u4ea7\u751f\u7684Binlog\u505aMerge\uff0c\u4ece\u800c\u8fd8\u539f\u51fa\u4e1a\u52a1\u6570\u636e\u3002</li> </ol>"},{"location":"data_system/data_manage/data_integration/action.html#binlog","title":"Binlog","text":"<p>Binlog \u4f7f\u7528 Row\u6a21\u5f0f\uff0c\u8bb0\u5f55\u4e86\u6bcf\u6b21\u5bf9\u6570\u636e\u8fdb\u884c\u589e\u5220\u6539\u67e5\u65f6\uff0c\u4e00\u884c\u6570\u636e\u5728\u53d8\u66f4\u524d\u540e\u7684\u503c\uff0c\u540c\u65f6\u65e0\u8bba\u5355\u5217\u662f\u5426\u88ab\u6539\u52a8\uff0c\u90fd\u4f1a\u8bb0\u5f55\u4e00\u884c\u6570\u636e\u7684\u5b8c\u6574\u4fe1\u606f\u3002</p> <p>\u5bf9Binlog\u7684\u8ba2\u9605\u4ee5MySQL\u7684DB\u4e3a\u7c92\u5ea6\uff0c\u4e00\u4e2aDB\u7684Binlog\u5bf9\u5e94\u4e86\u4e00\u4e2aKafka Topic\u3002</p> <p>\u4e00\u4e2aMySQL\u5b9e\u4f8b\u4e0b\u6240\u6709\u8ba2\u9605\u7684DB\uff0c\u90fd\u7531\u540c\u4e00\u4e2aCanal Instance\u8fdb\u884c\u5904\u7406\u3002</p> <p>CanalServer\u4f1a\u629b\u5f03\u6389\u672a\u8ba2\u9605\u7684Binlog\u6570\u636e\uff0c\u7136\u540eCanalClient\u5c06\u63a5\u6536\u5230\u7684Binlog\u6309DB\u7c92\u5ea6\u5206\u53d1\u5230Kafka\u4e0a\u3002</p>"},{"location":"data_system/data_manage/data_integration/action.html#_3","title":"\u4e00\u6b21\u6027\u62c9\u53d6&amp;\u521d\u59cb\u5316","text":"<p>Binlog\u4ece\u53d1\u8d77\u91c7\u96c6\u7684\u4e00\u523b\u8d77\u624d\u4f1a\u5728\u6574\u4e2a\u94fe\u8def\u4e0a\u5b58\u5728\uff0c\u5373\u4ee5\u589e\u91cf\u7684\u65b9\u5f0f\u4f20\u9012\uff0c\u90a3\u4e48\u5bf9\u4e8e\u5386\u53f2\u6570\u636e\u5982\u4f55\u83b7\u53d6\uff1f</p> <p>\u5b9e\u9645\u573a\u666f\u4e2d\u5305\u62ec\u5168\u91cf\u63a5\u5165\u6216\u589e\u91cf\u5386\u53f2\u6570\u636e\u56de\u6eaf\u3002</p> <p>\u76ee\u524d\u5b9e\u73b0\u65b9\u5f0f\u4e3a\u901a\u8fc7 DataX \u5de5\u5177\u76f4\u8fde MySQL \u79bb\u7ebf\u5e93\uff0c\u62c9\u53d6\u4e00\u4efd\u622a\u81f3\u5230\u5f53\u524d\u65f6\u95f4\u7684\u5168\u91cf\u6570\u636e\uff0c\u7136\u540e\u6309\u5217\u8fd8\u539f\u5230Hive\u8868\u7684\u9996\u4e2a\u5206\u533a\u4e2d\u3002</p> <p>\u5168\u91cf\u91c7\u96c6\u573a\u666f\u4e0b\uff0c\u4e0b\u4e2a\u5206\u533a\u7684\u6570\u636e\u57fa\u4e8e\u4e0a\u4e2a\u5206\u533a\u7684\u6570\u636e\u548c\u5f53\u524d\u5468\u671f\u5185\u7684\u589e\u91cfBinlog\u65e5\u5fd7merge\uff0c\u5373\u53ef\u4ea7\u751f\u8be5\u5206\u533a\u5185\u7684\u6570\u636e\u3002</p>"},{"location":"data_system/data_manage/data_integration/action.html#merge","title":"Merge\u6d41\u7a0b","text":"<p>Binlog\u6210\u529f\u5165\u4ed3\u540e\uff0c\u4e0b\u4e00\u6b65\u8981\u505a\u7684\u5c31\u662f\u57fa\u4e8eBinlog\u5bf9MySQL\u6570\u636e\u8fdb\u884c\u8fd8\u539f\u3002Merge\u6d41\u7a0b\u505a\u4e86\u4e24\u4ef6\u4e8b\uff0c\u9996\u5148\u628a\u5f53\u5929\u751f\u6210\u7684Binlog\u6570\u636e\u5b58\u653e\u5230Delta\u8868\u4e2d\uff0c\u7136\u540e\u548c\u5df2\u6709\u7684\u5b58\u91cf\u6570\u636e\u505a\u4e00\u4e2a\u57fa\u4e8e\u4e3b\u952e\u7684Merge\u3002</p> <p>Delta\u8868\u4e2d\u7684\u6570\u636e\u662f\u5f53\u5929\u7684\u6700\u65b0\u6570\u636e\uff0c\u5f53\u4e00\u6761\u6570\u636e\u5728\u4e00\u5929\u5185\u53d1\u751f\u591a\u6b21\u53d8\u66f4\u65f6\uff0cDelta\u8868\u4e2d\u53ea\u5b58\u50a8\u6700\u540e\u4e00\u6b21\u53d8\u66f4\u540e\u7684\u6570\u636e\u3002</p>"},{"location":"data_system/data_manage/data_integration/action.html#_4","title":"\u573a\u666f\u4e00\uff1a\u6570\u636e\u98d8\u79fb\u7684\u652f\u6301","text":"<p>\u5b9e\u9645\u4e1a\u52a1\u4e2d\uff0c\u5b58\u5728\u5f88\u591a\u7c7b\u4f3c\u7684\u4e24\u79cdcase\uff0c\u5176\u91c7\u96c6\u5468\u671f\u5b58\u5728\u4e00\u5b9a\u7684\u4e0d\u786e\u5b9a\u6027\u3002 </p> <p>case 1\uff1a\u8ba2\u5355\u7684Binlog\u65e5\u5fd7\u4e2d\uff0c\u5f53\u8ba2\u5355\u4e8b\u4ef6\u7684\u66f4\u65b0\u65f6\u95f4\u572859\u520659\u79d2\u5de6\u53f3\u65f6\uff0c\u6570\u636e\u6709\u53ef\u80fd\u4f1a\u843d\u5728\u4e0b\u4e00\u4e2a\u5c0f\u65f6\u7684\u5206\u533a\uff0c\u4ee5\u81f3\u4e8e\u5f53\u524d\u5c0f\u65f6\u6570\u636e\u6ca1\u6709\u7edf\u8ba1\u5230\u8be5\u6761\u8ba2\u5355\uff0c\u540c\u65f6\u4e0b\u4e00\u4e2a\u5c0f\u65f6\u5206\u533a\u7684\u6570\u636e\u4e5f\u6ca1\u6709\u6253\u4e0a\u76f8\u5e94\u7684\u4e8b\u4ef6\u6807\u7b7e\u3002</p> <p></p> <p>case 2\uff1a\u652f\u4ed8\u7ed3\u7b97\u7cfb\u7edf\uff0c\u5f53\u5929\u6240\u6709\u4ea4\u6613\u8bb0\u5f55\u4f1a\u5728\u6b21\u65e5\u51cc\u6668\u540e\u7ed3\u7b97\u5b8c\u6210\uff0c\u6309\u7167\u9ed8\u8ba4\u91c7\u96c6\u903b\u8f91\uff0c\u5f53\u5929\u7684\u8bb0\u5f55\u843d\u5728\u6b21\u65e5\u7684\u53d8\u66f4\u5185\uff0c\u65e0\u6cd5\u6709\u6548\u652f\u6301\u5f53\u5929\u6838\u7b97\u3002</p> <p>\u5e38\u89c4\u89e3\u51b3\u65b9\u6848\u53ef\u80fd\u662f\u628a\u4e0b\u4e2a\u5c0f\u65f6\u7684\u6570\u636e\u4e5f\u56ca\u62ec\u5230\u672c\u91c7\u96c6\u5468\u671f\u5185\uff0c\u4f46\u4f1a\u5bfc\u81f4\u6570\u636e\u5c31\u4f4d\u65f6\u95f4\u5ef6\u8fdf\u4e00\u4e2a\u5c0f\u65f6\uff0c\u6269\u6563\u5230\u6570\u636e\u4e0b\u6e38\uff0c\u65f6\u95f4\u4f1a\u66f4\u957f\uff0c\u53ef\u80fd\u4e0d\u6ee1\u8db3\u5b9e\u9645\u9700\u6c42\u3002\u91c7\u96c6\u5e73\u53f0\u63d0\u4f9b\u6570\u636e\u6f02\u79fb\u7684\u529f\u80fd\uff0c\u5373\u6309\u9700\u914d\u7f6e\u504f\u79fb\u91cf\u3002\u6bd4\u5982\u5c0f\u65f6\u7c92\u5ea6\u9ed8\u8ba4\u4e3a00:00 - 59:59\u4e4b\u95f4\u7684\u6570\u636e\uff0c\u914d\u7f6e5min\u7684\u504f\u79fb\uff0c\u90a3\u4e48\u6570\u636e\u533a\u95f4\u4e3a00:00 - 04:59\uff08\u6b21\u5c0f\u65f6\uff09\uff0c\u591a\u51fa\u6765\u7684\u90e8\u5206\u53ef\u4ee5\u6709\u6548\u89e3\u51b3\u6570\u636e\u6f02\u79fb\u529f\u80fd\uff0c\u540c\u65f6\u4e3a\u53ca\u65f6\u6027\u63d0\u4f9b\u4e86\u6709\u6548\u652f\u6491\u3002</p>"},{"location":"data_system/data_manage/data_integration/action.html#_5","title":"\u573a\u666f\u4e8c\uff1a\u5206\u5e93\u5206\u8868\u7684\u652f\u6301","text":"<p>\u5206\u5e93\u5206\u8868\u7684\u8bc9\u6c42\uff0c\u5176\u89c4\u5219\u4e5f\u53ef\u80fd\u591a\u79cd\u591a\u6837\uff0c\u5982table_{\u57ce\u5e02\u533a\u53f7}\uff0ctable_{\u8fde\u7eed\u6570\u5b57}\uff0ctable_{\u65e5\u671f}\uff0c\u5982\u679c\u9010\u4e2a\u62bd\u53d6\u5e76\u805a\u5408\uff0c\u4e0a\u4e0b\u6e38\u7684\u6210\u672c\u5de8\u5927\u3002\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5728\u6570\u636e\u89c4\u8303\u5c42\u9762\uff0c\u6570\u636e\u94fe\u8def\u4e0a\u4fdd\u969c\u80fd\u81ea\u52a8\u5316\u6536\u96c6\u8fd9\u7c7b\u6570\u636e\u3002</p> <p></p> <ul> <li>1. \u7edf\u4e00MySQL\u4f7f\u7528\u89c4\u8303\uff0c\u660e\u786e\u5206\u5e93\u5206\u8868\u7684\u547d\u540d\u89c4\u5219\uff0c\u505a\u5230\u89c4\u5219\u5185\u81ea\u52a8\u5316\u8bc6\u522b\uff0c\u540c\u65f6\u5b8c\u6210\u5168\u91cf\u5143\u6570\u636e\u4fe1\u606f\u7684\u6536\u96c6\uff0c\u975e\u89c4\u8303\u5316\u7684\u547d\u540d\u89c4\u5219\u65e0\u6cd5\u81ea\u52a8\u5316\u652f\u6301\u3002</li> <li>2. \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e00\u4e2a\u5e93\u7684\u6570\u636e\u4f1a\u6536\u96c6\u5230\u4e00\u4e2atopic\u5185\uff0c\u5982\u679c\u6709\u5206\u5e93\u5b58\u5728\u4e5f\u53ef\u4ee5\u4e00\u5e76\u6536\u96c6\u5230\u4e00\u4e2atopic\u5185\uff0c\u4fdd\u8bc1\u903b\u8f91\u4e0a\u5206\u5e93\u5206\u8868\u7684\u6570\u636e\u7269\u7406\u4e0a\u6536\u96c6\u5230\u4e00\u8d77\u3002</li> <li>3. \u6309\u7167/{db}/{table}/{year}/{month}/{day}/{hour}\u7684\u8def\u5f84\u7ed3\u6784\uff08\u5176\u4e2d\u65e5\u671f\u7531Binlog\u65f6\u95f4\u683c\u5f0f\u5316\u751f\u6210\uff09\u843d\u5730\u5230HDFS\u4e0a\uff0c\u4e00\u4e2a\u903b\u8f91\u8868\u7684\u6570\u636e\u5b58\u50a8\u5728\u4e00\u8d77\u3002</li> <li>4. ETL\u5904\u7406\u9636\u6bb5\uff0c\u53d6\u51fa\u4e0a\u8ff0\u8def\u5f84\u4e0b\u7684Binlog\u65e5\u5fd7\uff0c\u8fd8\u539f\u5230Hive\u4e2d\u3002</li> </ul>"},{"location":"data_system/data_manage/data_integration/action.html#_6","title":"\u5220\u9664\u4e8b\u4ef6\u7684\u652f\u6301","text":"<p>\u5904\u7406Delete\u4e8b\u4ef6\u7684Merge\u6d41\u7a0b\uff0c\u91c7\u7528\u5982\u4e0b\u4e24\u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>\u9996\u5148\uff0c\u63d0\u53d6\u51fa\u53d1\u751fDelete\u4e8b\u4ef6\u7684\u6570\u636e\uff0c\u7531\u4e8eBinlog\u672c\u8eab\u8bb0\u5f55\u4e86\u4e8b\u4ef6\u7c7b\u578b\uff0c\u8fd9\u4e00\u6b65\u5f88\u5bb9\u6613\u505a\u5230\u3002</li> <li>\u5c06\u5b58\u91cf\u6570\u636e\uff08\u8868A\uff09\u4e0e\u88ab\u5220\u6389\u7684\u6570\u636e\uff08\u8868B\uff09\u5728\u4e3b\u952e\u4e0a\u505a\u5de6\u5916\u8fde\u63a5\uff08Left outer join\uff09\uff0c\u5982\u679c\u80fd\u591f\u5168\u90e8join\u5230\u53cc\u65b9\u7684\u6570\u636e\uff0c\u8bf4\u660e\u8be5\u6761\u6570\u636e\u88ab\u5220\u6389\u4e86\u3002\u56e0\u6b64\uff0c\u9009\u62e9\u7ed3\u679c\u4e2d\u8868B\u5bf9\u5e94\u7684\u8bb0\u5f55\u4e3aNULL\u7684\u6570\u636e\uff0c\u5373\u662f\u5e94\u5f53\u88ab\u4fdd\u7559\u7684\u6570\u636e\u3002</li> <li>\u7136\u540e\uff0c\u5bf9\u4e0a\u9762\u5f97\u5230\u7684\u88ab\u4fdd\u7559\u4e0b\u6765\u7684\u6570\u636e\uff0c\u6309\u7167\u524d\u9762\u63cf\u8ff0\u7684\u6d41\u7a0b\u505a\u5e38\u89c4\u7684Merge\u3002</li> </ul> <p></p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html","title":"Apache InLong","text":"<p>Apache InLong\uff08\u5e94\u9f99\uff09\u662f\u4e00\u4e2a\u4e00\u7ad9\u5f0f\u6d77\u91cf\u6570\u636e\u96c6\u6210\u6846\u67b6\uff0c\u5c06\u6570\u636e\u91c7\u96c6\u3001\u805a\u5408\u3001\u5b58\u50a8\u3001\u6392\u5e8f\u6570\u636e\u5904\u7406\u7684\u5168\u6d41\u7a0b\u6574\u5408\u5728\u4e00\u8d77\uff0c\u63d0\u4f9b\u81ea\u52a8\u3001\u5b89\u5168\u3001\u53ef\u9760\u548c\u9ad8\u6027\u80fd\u7684\u6570\u636e\u4f20\u8f93\u80fd\u529b\uff0c\u540c\u65f6\u652f\u6301\u6279\u548c\u6d41\uff0c\u65b9\u4fbf\u4e1a\u52a1\u6784\u5efa\u57fa\u4e8e\u6d41\u5f0f\u7684\u6570\u636e\u5206\u6790\u3001\u5efa\u6a21\u548c\u5e94\u7528\u3002</p> <p>Apache InLong - a one-stop, full-scenario integration framework for massive data.</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_1","title":"\u67b6\u6784","text":"<ul> <li>\u901a\u8fc7 Flink Source/Sink \u652f\u6301\u6570\u636e\u91c7\u96c6\u548c\u5b58\u50a8\uff1b</li> </ul>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_2","title":"\u6a21\u5757","text":""},{"location":"data_system/data_manage/data_integration/apache_inlong.html#inlong-agent","title":"inlong-agent","text":"<p>\u6570\u636e\u91c7\u96c6Agent\u3002\u4ece\u6307\u5b9a\u76ee\u5f55\u6216\u6587\u4ef6\u8bfb\u53d6\u5e38\u89c4\u65e5\u5fd7\u3001\u9010\u6761\u4e0a\u62a5</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#inlong-dataproxy","title":"inlong-dataproxy","text":"<p>\u652f\u6301\u6570\u636e\u53d1\u9001\u963b\u585e\u548c\u843d\u76d8\u91cd\u53d1\uff0c\u53ef\u4ee5\u5c06\u63a5\u6536\u5230\u7684\u6570\u636e\u8f6c\u53d1\u5230\u4e0d\u540c\u7684MQ\uff08\u6d88\u606f\u961f\u5217\uff09</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#inlong-tubemq","title":"inlong-tubemq","text":"<p>\u817e\u8baf\u81ea\u7814\u7684\u6d88\u606f\u961f\u5217\u670d\u52a1\uff0c\u7528\u6237\u5927\u6570\u636e\u573a\u666f\u4e0b\u6d77\u91cf\u6570\u636e\u7684\u9ad8\u6027\u80fd\u5b58\u50a8\u548c\u4f20\u8f93</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#inlong-sort","title":"inlong-sort","text":"<p>\u5bf9\u4ece\u4e0d\u540cMQ\u6d88\u8d39\u5230\u7684\u6570\u636e\u8fdb\u884cETL\u5904\u7406\uff0c\u7136\u540e\u6c47\u805a\u5e76\u5199\u5165Hive\u3001ClickHouse\u3001HBase\u3001Iceberg\u7b49\u5b58\u50a8\u7cfb\u7edf\u3002</p> <p>\u6216\u8005\uff0c\u5bf9\u4ece\u4e0d\u540c\u6570\u636e\u6e90\u8bfb\u53d6\u7684\u6570\u636e\u8fdb\u884cETL\u5904\u7406\uff0c\u7136\u540e\u5199\u5165\u5230\u6307\u5b9a\u7684MQ\uff08\u4eceExtractNode\u5199\u5165LoadNode\uff09</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#inlong-manager","title":"inlong-manager","text":"<p>\u63d0\u4f9b\u5143\u6570\u636e\u3001\u4efb\u52a1\u6d41\u3001\u6743\u9650\u3001OpenAPI\u7b49\u7684\u6570\u636e\u670d\u52a1\u7ba1\u63a7\u80fd\u529b</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#inlong-dashboard","title":"inlong-dashboard","text":"<p>\u7ba1\u7406\u6570\u636e\u63a5\u5165\u7684\u524d\u7aef\u9875\u9762</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#inlong-audit","title":"inlong-audit","text":"<p>\u5bf9InLong\u7cfb\u7edf\u7684Agent\u3001DataProxy\u3001Sort\u6a21\u5757\u7684\u5165\u6d41\u91cf\u3001\u51fa\u6d41\u91cf\u8fdb\u884c\u5b9e\u65f6\u5ba1\u8ba1\u5bf9\u8d26</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_3","title":"\u7ec4\u4ef6\u4ecb\u7ecd","text":""},{"location":"data_system/data_manage/data_integration/apache_inlong.html#agent","title":"Agent","text":""},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_4","title":"\u652f\u6301\u6570\u636e\u6e90","text":"<p>File\u3001Sql\u3001Binlog\u3001Metrics\u7b49\u591a\u79cd\u5f02\u6784\u6570\u636e\u6e90</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_5","title":"\u67b6\u6784\u4ecb\u7ecd","text":"<p>InLong Agent\u672c\u8eab\u4f5c\u4e3a\u6570\u636e\u91c7\u96c6\u6846\u67b6\uff0c\u91c7\u7528channel + plugin\u67b6\u6784\u6784\u5efa\u3002\u5c06\u6570\u636e\u6e90\u8bfb\u53d6\u548c\u5199\u5165\u62bd\u8c61\u6210\u4e3aReader/Writer\u63d2\u4ef6\uff0c\u7eb3\u5165\u5230\u6574\u4e2a\u6846\u67b6\u4e2d\u3002</p> <ul> <li>Reader\uff1aReader\u4e3a\u6570\u636e\u91c7\u96c6\u6a21\u5757\uff0c\u8d1f\u8d23\u91c7\u96c6\u6570\u636e\u6e90\u7684\u6570\u636e\uff0c\u5c06\u6570\u636e\u53d1\u9001\u7ed9channel\u3002</li> <li>Writer\uff1a Writer\u4e3a\u6570\u636e\u5199\u5165\u6a21\u5757\uff0c\u8d1f\u8d23\u4e0d\u65ad\u5411channel\u53d6\u6570\u636e\uff0c\u5e76\u5c06\u6570\u636e\u5199\u5165\u5230\u76ee\u7684\u7aef\u3002</li> <li>Channel\uff1aChannel\u7528\u4e8e\u8fde\u63a5reader\u548cwriter\uff0c\u4f5c\u4e3a\u4e24\u8005\u7684\u6570\u636e\u4f20\u8f93\u901a\u9053\uff0c\u5e76\u8d77\u5230\u4e86\u6570\u636e\u7684\u5199\u5165\u8bfb\u53d6\u76d1\u63a7\u4f5c\u7528</li> </ul>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_6","title":"\u91c7\u96c6\u5206\u7c7b","text":""},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_7","title":"\u6587\u4ef6","text":"<p>\u6587\u4ef6\u91c7\u96c6\u5305\u542b\u5982\u4e0b\u529f\u80fd\uff1a \u7528\u6237\u914d\u7f6e\u7684\u8def\u5f84\u76d1\u542c\uff0c\u80fd\u591f\u76d1\u542c\u51fa\u521b\u5efa\u7684\u6587\u4ef6\u4fe1\u606f \u76ee\u5f55\u6b63\u5219\u8fc7\u6ee4\uff0c\u652f\u6301YYYYMMDD+\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u8def\u5f84\u914d\u7f6e \u65ad\u70b9\u91cd\u4f20\uff0cInLong-Agent\u91cd\u542f\u65f6\uff0c\u80fd\u591f\u652f\u6301\u81ea\u52a8\u4ece\u4e0a\u6b21\u8bfb\u53d6\u4f4d\u7f6e\u91cd\u65b0\u8bfb\u53d6\uff0c==\u4fdd\u8bc1\u4e0d\u91cd\u8bfb\u4e0d\u6f0f\u8bfb==\u3002</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#sql","title":"Sql","text":"<p>\u8fd9\u7c7b\u6570\u636e\u662f\u6307\u901a\u8fc7SQL\u6267\u884c\u7684\u65b9\u5f0f SQL\u6b63\u5219\u5206\u89e3\uff0c\u8f6c\u5316\u6210\u591a\u6761SQL\u8bed\u53e5 \u5206\u522b\u6267\u884cSQL\uff0c\u62c9\u53d6\u6570\u636e\u96c6\uff0c\u62c9\u53d6\u8fc7\u7a0b\u9700\u8981\u6ce8\u610f\u5bf9mysql\u672c\u8eab\u7684\u5f71\u54cd \u6267\u884c\u5468\u671f\uff0c\u8fd9\u79cd\u4e00\u822c\u662f\u5b9a\u65f6\u6267\u884c\u3002</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#binlog","title":"Binlog","text":"<p>\u8fd9\u7c7b\u91c7\u96c6\u901a\u8fc7\u914d\u7f6emysql slave\u7684\u65b9\u5f0f\uff0c\u8bfb\u53d6binlog\uff0c\u5e76\u8fd8\u539f\u6570\u636e \u9700\u8981\u6ce8\u610fbinlog\u8bfb\u53d6\u7684\u65f6\u5019\u591a\u7ebf\u7a0b\u89e3\u6790\uff0c\u591a\u7ebf\u7a0b\u89e3\u6790\u7684\u6570\u636e\u9700\u8981\u6253\u4e0a\u987a\u5e8f\u6807\u7b7e \u4ee3\u7801\u57fa\u4e8e\u8001\u7248\u672c\u7684dbsync\uff0c\u4e3b\u8981\u7684\u4fee\u6539\u662f\u5c06tdbus-sender\u7684\u53d1\u9001\u6539\u4e3a\u63a8\u9001\u5230agent-channel\u7684\u65b9\u5f0f\u505a\u878d\u5408\u3002</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_8","title":"\u5b89\u88c5\u914d\u7f6e","text":"<p>\u5b89\u88c5\u90e8\u7f72 | Apache Inlong</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_9","title":"\u76d1\u63a7\u6307\u6807","text":"<p>\u76d1\u63a7\u6307\u6807 | Apache Inlong</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#dataproxy","title":"DataProxy","text":"<p>\u5145\u5f53\u91c7\u96c6\u7aef\u5230\u6d88\u606f\u961f\u5217\u7684\u6865\u6881\uff0c\u5f53DataProxy\u6536\u5230\u6d88\u606f\u65f6\uff0c\u9996\u5148\u53d1\u9001\u5230Memory Channel\u4e2d\u8fdb\u884c\u538b\u7f29\uff0c\u5e76\u4f7f\u7528\u672c\u5730\u7684Producer\u5f80\u540e\u7aef\u6d88\u606f\u961f\u5217\u53d1\u9001\u6570\u636e\u3002</p> <p>\u5f53\u6d88\u606f\u961f\u5217\u5f02\u5e38\uff0c\u51fa\u73b0\u53d1\u9001\u53d1\u9001\u5931\u8d25\u65f6\uff0cDataProxy\u4f1a\u5c06\u6d88\u606f\u7f13\u5b58\u5230Disk Channel\uff0c\u5373\u672c\u5730\u78c1\u76d8\u4e2d\u3002</p> <p>DataProxy\u6574\u4f53\u67b6\u6784\u57fa\u4e8eApache Flume\uff0c\u6269\u5c55\u4e86Source\u5c42\u548cSink\u5c42\uff0c\u5e76\u5bf9\u5bb9\u707e\u505a\u4e86\u4f18\u5316\u5904\u7406\u3002</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_10","title":"\u67b6\u6784\u4ecb\u7ecd","text":"<ul> <li>Source\u5c42\u5f00\u542f\u7aef\u53e3\u76d1\u542c\uff0c\u901a\u8fc7netty server\u5b9e\u73b0\u3002\u89e3\u7801\u4e4b\u540e\u7684\u6570\u636e\u53d1\u5230channel\u5c42</li> <li>channel\u5c42\u6709\u4e00\u4e2aselector\uff0c\u7528\u4e8e\u9009\u62e9\u8d70\u54ea\u79cd\u7c7b\u578b\u7684channel\uff0c\u5982\u679cmemory\u6700\u7ec8\u6ee1\u4e86\uff0c\u4f1a\u5bf9\u6570\u636e\u505a\u843d\u5730\u5904\u7406</li> <li>channel\u5c42\u7684\u6570\u636e\u4f1a\u901a\u8fc7sink\u5c42\u505a\u8f6c\u53d1\uff0c\u8fd9\u91cc\u4e3b\u8981\u662f\u5c06\u6570\u636e\u8f6c\u4e3aTDMsg1\u7684\u683c\u5f0f\uff0c\u5e76\u63a8\u9001\u5230cache\u5c42\uff08\u8fd9\u91cc\u7528\u7684\u6bd4\u8f83\u591a\u7684\u662ftube\uff09</li> </ul>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_11","title":"\u5b89\u88c5\u914d\u7f6e","text":"<p>\u5b89\u88c5\u914d\u7f6e | Apache Inlong</p> <p>DataProxy \u652f\u6301\u914d\u7f6e\u5316\u7684 source-channel-sink\uff0c\u914d\u7f6e\u65b9\u5f0f\u4e0e flume \u7684\u914d\u7f6e\u6587\u4ef6\u7ed3\u6784\u7c7b\u4f3c\u3002\u914d\u7f6e\u6587\u4ef6\u653e\u5728 dataproxy-*.conf \u6587\u4ef6\u4e2d\uff0c\u76ee\u524d\u652f\u6301 dataproxy-pulsar.conf \u548c dataproxy-tube.conf \u4e24\u79cd\uff0c\u7528\u4e8e\u533a\u5206\u4e0d\u540c\u7684\u4e2d\u95f4\u4ef6\u7c7b\u578b\uff0c\u5177\u4f53\u7c7b\u578b\u53ef\u4ee5\u5728\u542f\u52a8\u65f6\u6307\u5b9a\uff0c\u9ed8\u8ba4\uff08\u672a\u6307\u5b9a\u65f6\uff09\u4f7f\u7528 dataproxy-pulsar.conf \u4f5c\u4e3a\u914d\u7f6e\u6587\u4ef6</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_12","title":"\u76d1\u63a7\u6307\u6807","text":"<p>\u76d1\u63a7\u6307\u6807 | Apache Inlong</p> <p>DataProxy\u63d0\u4f9b\u4e86JMX\u65b9\u5f0f\u7684\u76d1\u63a7\u6307\u6807Listener\u80fd\u529b\uff0c\u7528\u6237\u53ef\u4ee5\u5b9e\u73b0MetricListener\u63a5\u53e3\uff0c\u6ce8\u518c\u540e\u53ef\u4ee5\u5b9a\u671f\u63a5\u6536\u76d1\u63a7\u6307\u6807\uff0c\u7528\u6237\u9009\u62e9\u5c06\u6307\u6807\u4e0a\u62a5\u81ea\u5b9a\u4e49\u7684\u76d1\u63a7\u7cfb\u7edf</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#tubemq","title":"TubeMQ","text":""},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_13","title":"\u67b6\u6784","text":"<p>Portal\uff1a\u8d1f\u8d23\u5bf9\u5916\u4ea4\u4e92\u548c\u8fd0\u7ef4\u64cd\u4f5c\u7684Portal\u90e8\u5206\uff1b</p> <p>Master\uff1a\u8d1f\u8d23\u96c6\u7fa4\u63a7\u5236\u7684Control\u90e8\u5206\uff0c\u8be5\u90e8\u5206\u7531\u4e00\u4e2a\u6216\u591a\u4e2aMaster\u8282\u70b9\u7ec4\u6210\u3002Master\u652f\u6301HA\u90e8\u7f72\uff0c\u5b9e\u73b0\u8282\u70b9\u95f4\u5fc3\u8df3\u4fdd\u6d3b\u3001\u5b9e\u65f6\u70ed\u5907\u5207\u6362\uff1b</p> <p>Broker\uff1a\u6bcf\u4e2aBroker\u8282\u70b9\u5bf9\u672c\u8282\u70b9\u5185\u7684Topic\u96c6\u5408\u8fdb\u884c\u7ba1\u7406\uff1b</p> <p>Client\uff1a\u8d1f\u8d23\u6570\u636e\u751f\u4ea7\u548c\u6d88\u8d39\u7684Client\u90e8\u5206\uff0c\u8be5\u90e8\u5206\u4ee5Lib\u5f62\u5f0f\u5bf9\u5916\u63d0\u4f9b\u3002\u6d88\u8d39\u7aef\u652f\u6301Push\u3001Pull\u4e24\u79cd\u6570\u636e\u62c9\u53bb\u6a21\u5f0f\u3002\u6570\u636e\u6d88\u8d39\u884c\u4e3a\u652f\u6301\u987a\u5e8f\u548c\u8fc7\u6ee4\u6d88\u8d39\u4e24\u79cd\u3002</p> <p>Zookeeper\uff1a\u8d1f\u8d23offset\u5b58\u50a8\u7684zookeeper\u90e8\u5206</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#sort","title":"Sort","text":"<p>\u57fa\u4e8eApache Flink\u7684ETL\u7cfb\u7edf\uff0c\u652f\u6301\u591a\u79cd\u6570\u636e\u6e90\uff0c\u652f\u6301\u7b80\u5355\u7684\u5b57\u6bb5\u62bd\u53d6\uff0c\u652f\u6301\u591a\u79cd\u5b58\u50a8\u7cfb\u7edf\u3002</p> <p>\u65e2\u652f\u6301\u548cManager\u4e00\u8d77\u914d\u5408\u4f7f\u7528\uff0c\u901a\u8fc7Manager\u8fdb\u884c\u7cfb\u7edf\u5143\u6570\u636e\u7684\u7ba1\u7406\uff0c\u4e5f\u53ef\u4ee5\u5728Flink\u73af\u5883\u4e0b\u72ec\u7acb\u8fd0\u884c\u3002</p> Type Service Extract Node Pulsar MySQL Kafka MongoDB PostgreSQL Transform String Split String Regular Replace String Regular Replace First Matched Value Data Filter Data Distinct Regular Join Load Node Hive Kafka HBase ClickHouse Iceberg PostgreSQL HDFS TDSQL Postgres"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_14","title":"\u5b89\u88c5\u90e8\u7f72","text":"<p>\u5b89\u88c5\u90e8\u7f72 | Apache Inlong</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#manager","title":"Manager","text":"<p>\u7edf\u4e00\u7ba1\u7406\u5e73\u53f0\uff0c\u63d0\u4f9b\u5404\u57fa\u7840\u914d\u7f6e\uff08\u5982\u6570\u636e\u6d41\u914d\u7f6e\u3001\u6d88\u8d39\u914d\u7f6e\u3001\u96c6\u7fa4\u7ba1\u7406\u7b49\uff09\u7684\u7ef4\u62a4\u5165\u53e3\u3002</p> <p>\u7528\u6237\u53ef\u4ee5\u54e6\u901a\u8fc7\u7ba1\u7406\u5e73\u53f0\u521b\u5efa\u6570\u636e\u91c7\u96c6\u4efb\u52a1\u3001\u67e5\u770b\u6307\u6807\u6570\u636e\u7b49\u3002</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_15","title":"\u67b6\u6784","text":""},{"location":"data_system/data_manage/data_integration/apache_inlong.html#dashboard","title":"Dashboard","text":"<p>InLong\u7684\u7ba1\u63a7\u7aef</p> <p>\u9700\u8981\u5148\u5b89\u88c5nodejs &gt; = 12.0</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#audit","title":"Audit","text":"<p>InLong\u5ba1\u8ba1\u662f\u72ec\u7acb\u4e8eInLong\u7684\u4e00\u4e2a\u5b50\u7cfb\u7edf\uff0c\u5bf9InLong\u7cfb\u7edf\u7684Agent\u3001DataProxy\u3001Sort\u6a21\u5757\u7684\u5165\u6d41\u91cf\u3001\u51fa\u6d41\u91cf\u8fdb\u884c\u5b9e\u65f6\u5ba1\u8ba1\u5bf9\u8d26\u3002\u5bf9\u8d26\u7684\u7c92\u5ea6\u6709\u5206\u949f\u3001\u5c0f\u65f6\u3001\u5929\u4e09\u79cd\u7c92\u5ea6\u3002</p> <p>\u901a\u8fc7\u5ba1\u8ba1\u5bf9\u8d26\uff0c\u53ef\u4ee5\u6e05\u6670\u7684\u4e86\u89e3InLong \u5404\u4e2a\u6a21\u5757\u7684\u4f20\u8f93\u60c5\u51b5\uff0c\u4ee5\u53ca\u6570\u636e\u6d41\u662f\u5426\u6709\u4e22\u5931\u6216\u8005\u91cd\u590d\u3002</p> <p></p> <ol> <li>\u5ba1\u8ba1SDK\u5d4c\u5957\u5728\u9700\u8981\u5ba1\u8ba1\u7684\u670d\u52a1\uff0c\u5bf9\u670d\u52a1\u8fdb\u884c\u5ba1\u8ba1\uff0c\u5c06\u5ba1\u8ba1\u7ed3\u679c\u53d1\u9001\u5230\u5ba1\u8ba1\u63a5\u5165\u5c42\u3002</li> <li>\u5ba1\u8ba1\u63a5\u5165\u5c42\u5c06\u5ba1\u8ba1\u6570\u636e\u5199\u5230MQ(Pulsar\u6216\u8005TubeMQ)\u3002</li> <li>\u5206\u53d1\u670d\u52a1\u6d88\u8d39MQ\u7684\u5ba1\u8ba1\u6570\u636e\uff0c\u5c06\u5ba1\u8ba1\u6570\u636e\u5199\u5230MySQL\u3001Elasticsearch\u3002</li> <li>\u63a5\u53e3\u5c42\u5c06MySQL\u3001Elasticsearch\u7684\u6570\u636e\u8fdb\u884c\u5c01\u88c5\u3002</li> <li>\u5e94\u7528\u573a\u666f\u4e3b\u8981\u5305\u62ec\u62a5\u8868\u5c55\u793a\u3001\u5ba1\u8ba1\u5bf9\u8d26\u7b49\u7b49\u3002</li> </ol>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_16","title":"\u5ba1\u8ba1\u7ef4\u5ea6","text":"\u673a\u5668ip \u5bb9\u5668ID \u7ebf\u7a0bID \u65e5\u5fd7\u65f6\u95f4(\u5206\u949f) \u5ba1\u8ba1ID inlong_group_id inlong_stream_id \u6761\u6570 \u5927\u5c0f \u4f20\u8f93\u65f6\u5ef6(ms)"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#for","title":"\u529f\u80fd\u63d2\u4ef6\uff08for\u63d2\u4ef6\u5f00\u53d1\u4eba\u5458\uff09","text":""},{"location":"data_system/data_manage/data_integration/apache_inlong.html#agent_1","title":"Agent\u63d2\u4ef6","text":"<p>InLong Agent\u652f\u6301\u4ee5\u63d2\u4ef6\u7684\u65b9\u5f0f\u6269\u5c55\u65b0\u7684\u91c7\u96c6\u7c7b\u578b</p> <p>\u6982\u5ff5\u548c\u6a21\u578b</p> <p>InLong Agent\u662f\u4e00\u4e2a\u6570\u636e\u91c7\u96c6\u6846\u67b6\uff0c\u91c7\u7528Job+Task\u67b6\u6784\u6a21\u578b\uff0c\u5c06\u6570\u636e\u6e90\u8bfb\u53d6\u548c\u5199\u5165\u62bd\u8c61\u6210\u4e3aReader/Sink\u63d2\u4ef6</p> <ul> <li>Job\uff1aJob\u662fAgent\u7528\u4ee5\u63cf\u8ff0\u4ece\u4e00\u4e2a\u6e90\u5934\u5230\u4e00\u4e2a\u76ee\u7684\u7aef\u7684\u540c\u6b65\u4f5c\u4e1a\uff0c\u662fAgent\u6570\u636e\u540c\u6b65\u7684==\u6700\u5c0f\u4e1a\u52a1\u5355\u5143==\u3002</li> <li>Task\uff1aTask\u662f\u628aJob\u62c6\u5206\u5f97\u5230\u7684==\u6700\u5c0f\u6267\u884c\u5355\u5143==\u3002</li> </ul> <p>Task\u5305\u542b\u7ec4\u4ef6(\u548cflume\u7ec4\u5c06\u7c7b\u4f3c)\uff1a</p> <ul> <li>Reader: \u6570\u636e\u91c7\u96c6\u6a21\u5757\uff0c\u8d1f\u8d23\u91c7\u96c6\u6570\u636e\u6e90\u7684\u6570\u636e\uff0c\u5e76\u53d1\u9001\u7ed9Channel\u3002</li> <li>Sink\uff1a\u6570\u636e\u5199\u5165\u6a21\u5757\uff0c\u8d1f\u8d23\u4e0d\u65ad\u5411Channel\u53d6\u6570\u636e\uff0c\u5e76\u5c06\u6570\u636e\u5199\u5165\u76ee\u7684\u7aef\u3002</li> <li>Channel\uff1a\u8fde\u63a5Reader\u548cSink\uff0c\u6570\u636e\u4f20\u5165\u901a\u9053\uff0c\u5e76\u53ef\u4ee5\u76d1\u63a7\u6570\u636e\u7684\u5199\u5165\u548c\u8bfb\u53d6\u3002</li> </ul> <p>Job/Task/Reader/Sink/Channel \u6982\u5ff5\u53ef\u4ee5\u7528\u4e0b\u56fe\u8868\u793a\uff1a</p> <p></p> <p>\u5de5\u4f5c\u6d41\u7a0b\uff1a</p> <ul> <li>\u7528\u6237\u63d0\u4ea4 Job\uff08\u901a\u8fc7 manager\uff09\uff0cJob \u4e2d\u5b9a\u4e49\u4e86\u9700\u8981\u4f7f\u7528\u7684 Source, Channel, Sink\uff08\u901a\u8fc7\u7c7b\u7684\u5168\u9650\u5b9a\u540d\u5b9a\u4e49\uff09</li> <li>\u6846\u67b6\u542f\u52a8 Job\uff0c\u901a\u8fc7\u53cd\u5c04\u673a\u5236\u521b\u5efa\u51fa Source</li> <li>\u6846\u67b6\u542f\u52a8 Source\uff0c\u5e76\u8c03\u7528 Source \u7684 Split \u63a5\u53e3\uff0c\u751f\u6210\u4e00\u4e2a\u6216\u8005\u591a\u4e2a Task</li> <li>\u751f\u6210\u4e00\u4e2a Task \u65f6\uff0c\u540c\u65f6\u751f\u6210 Reader\uff08\u4e00\u79cd\u7c7b\u578b\u7684 Source \u4f1a\u751f\u6210\u5bf9\u5e94\u7684 reader)\uff0c\u7528\u6237\u914d\u7f6e\u7684 Channel \u4ee5\u53ca\u7528\u6237\u914d\u7f6e\u7684 Sink</li> <li>Task \u5f00\u59cb\u6267\u884c\uff0cReader \u5f00\u59cb\u8bfb\u53d6\u6570\u636e\u5230 Channel\uff0cSink \u4ece Channel \u4e2d\u53d6\u6570\u8fdb\u884c\u53d1\u9001</li> <li>Job \u548c Task \u6267\u884c\u65f6\u6240\u9700\u8981\u7684\u6240\u6709\u4fe1\u606f\u90fd\u5c01\u88c5\u5728 JobProfile \u4e2d</li> </ul> <p>\u5f00\u53d1\u6d41\u7a0b\uff1a</p> <ul> <li>\u9996\u5148\u5f00\u53d1 Source , \u5b9e\u73b0 Split \u903b\u8f91\uff0c\u8fd4\u56de Reader \u5217\u8868</li> <li>\u5f00\u53d1\u5bf9\u5e94\u7684 Reader \uff0c\u5b9e\u73b0\u8bfb\u53d6\u6570\u636e\u5e76\u5199\u5165\u5230 Channel \u7684\u903b\u8f91</li> <li>\u5f00\u53d1\u5bf9\u5e94\u7684 Sink , \u5b9e\u73b0\u4ece Channel \u4e2d\u53d6\u6570\u5e76\u5199\u5165\u5230\u6307\u5b9a Sink \u4e2d\u7684\u903b\u8f91</li> </ul> <p>\u529f\u80fd\u5b9e\u73b0demo\uff1a</p> <p>Agent \u63d2\u4ef6 | Apache Inlong</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#sort_1","title":"Sort\u63d2\u4ef6","text":"<p>\u57fa\u4e8eApache Flink SQL\u7684ETL\u670d\u52a1\u3002</p> <p>\u7ec4\u4ef6\u6982\u5ff5\uff1a</p> <p>ExtractNode\uff1a\u6570\u636e\u540c\u6b65\u7684\u6765\u6e90\u7aef\u62bd\u8c61</p> <p>LoadNode\uff1a\u6570\u636e\u540c\u6b65\u7684\u53bb\u5411\u7aef\u62bd\u8c61</p> <p>\u529f\u80fd\u5b9e\u73b0demo\uff1a</p> <p>Sort \u63d2\u4ef6 | Apache Inlong</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#dashboard_1","title":"Dashboard\u63d2\u4ef6","text":"<p>\u529f\u80fd\u5b9e\u73b0demo\uff1a</p> <p>Dashboard \u63d2\u4ef6 | Apache Inlong</p>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#manager_1","title":"Manager\u63d2\u4ef6","text":""},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_17","title":"\u6269\u5c55\u8bfb\u53d6\u8282\u70b9","text":"<ul> <li>\u9996\u5148\u9700\u8981\u5728 Sort \u7ec4\u4ef6\u5185\u652f\u6301\u8be5\u6570\u636e\u6e90\uff0c\u8be6\u60c5\u53c2\u8003 Sort \u63d2\u4ef6</li> <li>\u5728\u679a\u4e3e\u7c7b<code>org.apache.inlong.common.enums.TaskTypeEnum</code>\u4e2d\u589e\u52a0\u5bf9\u5e94\u7684\u679a\u4e3e</li> <li>\u5728\u679a\u4e3e\u7c7b<code>org.apache.inlong.manager.common.enums.SourceType</code>\u4e2d\u540c\u6837\u589e\u52a0\u5bf9\u5e94\u679a\u4e3e</li> <li>\u5728<code>org.apache.inlong.manager.common.pojo.source</code>\u8def\u5f84\u4e0b\u521b\u5efa\u6587\u4ef6\u5939\uff0c\u521b\u5efa\u5bf9\u5e94\u5b9e\u4f53\u7c7b</li> <li>\u5728<code>org.apache.inlong.manager.service.source</code>\u8def\u5f84\u4e0b\uff0c\u521b\u5efa\u5bf9\u5e94\u5de5\u5177\u7c7b</li> <li>\u652f\u6301\u6570\u636e\u6e90\u5230ExtractNode\u7684\u8f6c\u6362\u51fd\u6570\uff0c\u53c2\u8003 <code>org.apache.inlong.manager.service.sort.util.ExtractNodeUtils</code></li> </ul>"},{"location":"data_system/data_manage/data_integration/apache_inlong.html#_18","title":"\u6269\u5c55\u5199\u5165\u8282\u70b9","text":"<ul> <li>\u9996\u5148\u9700\u8981\u5728 Sort \u7ec4\u4ef6\u5185\u652f\u6301\u8be5\u6570\u636e\u6e90\uff0c\u8be6\u60c5\u53c2\u8003 Sort \u63d2\u4ef6</li> <li>\u5728\u679a\u4e3e\u7c7b<code>org.apache.inlong.manager.common.enums.SinkType</code>\u4e2d\u589e\u52a0\u5bf9\u5e94\u679a\u4e3e</li> <li>\u5728<code>org.apache.inlong.manager.common.pojo.sink</code>\u8def\u5f84\u4e0b\u521b\u5efa\u6587\u4ef6\u5939, \u521b\u5efa\u5bf9\u5e94\u5b9e\u4f53\u7c7b</li> <li>\u5728<code>org.apache.inlong.manager.service.sink</code>\u8def\u5f84\u4e0b\u521b\u5efa\u5bf9\u5e94\u5de5\u5177\u7c7b</li> <li>\u652f\u6301\u6570\u636e\u6e90\u5230LoadNode\u7684\u8f6c\u6362\u51fd\u6570\uff0c\u53c2\u8003\u4ee3\u7801 <code>org.apache.inlong.manager.service.sort.util.LoadNodeUtils</code></li> </ul>"},{"location":"data_system/data_manage/data_integration/apache_seatunnel.html","title":"Apache Seatunnel","text":"<p>\u6765\u81ea\u4e2d\u56fd\u7684\u6570\u636e\u96c6\u6210\u5e73\u53f0\u6210\u529f\u8fdb\u5165 Apache \u5b75\u5316\u5668\u7684\u9879\u76ee\u3002</p> <p>a distributed, high-performance data integration platform for the synchronization and transformation of massive data (offline &amp; real-time).</p>"},{"location":"data_system/data_manage/data_integration/apache_seatunnel.html#_1","title":"\u67b6\u6784","text":""},{"location":"data_system/data_manage/data_integration/bitsail.html","title":"BitSail","text":"<p>\u4e00\u6b3e\u57fa\u4e8e\u5206\u5e03\u5f0f\u67b6\u6784\u7684\u9ad8\u6027\u80fd\u6570\u636e\u96c6\u6210\u5f15\u64ce\uff0c\u652f\u6301\u591a\u79cd\u5f02\u6784\u6570\u636e\u6e90\u95f4\u7684\u6570\u636e\u540c\u6b65\u3002</p> <p>\u76ee\u524d BitSail \u4ec5\u652f\u6301\u672c\u5730\u548cYarn\u4e0a\u90e8\u7f72\uff082022/12/7\uff09\uff0c\u539f\u751fkubernetes\u5c06\u5728\u4e0d\u4e45\u540e\u652f\u6301\u3002</p> <p>\u4ec5\u652f\u6301flink\u7684 <code>yarn-per-job</code> \u6a21\u5f0f\u63d0\u4ea4</p>"},{"location":"data_system/data_manage/data_integration/bitsail.html#_1","title":"\u529f\u80fd","text":"<p>\u6784\u6570\u636e\u6e90\u540c\u6b65\uff1a\u652f\u6301\u591a\u79cd\u5f02\u6784\u6570\u636e\u6e90\u95f4\u9ad8\u6027\u80fd\u3001\u9ad8\u53ef\u9760\u7684\u6d77\u91cf\u6570\u636e\u540c\u6b65\uff0c\u5e76\u652f\u6301\u4e0d\u540c\u6570\u636e\u6e90\u7c7b\u578b\u4e4b\u95f4\u7684\u8f6c\u6362</p> <p>\u6e56\u4ed3\u4e00\u4f53\uff1a\u652f\u6301\u6d41\u6279\u4e00\u4f53\u3001\u6e56\u4ed3\u4e00\u4f53\u67b6\u6784\uff0c\u7528\u4e00\u5957\u6846\u67b6\u8986\u76d6\u51e0\u4e4e\u6240\u6709\u6570\u636e\u540c\u6b65\u573a\u666f</p> <p>\u5206\u5e03\u5f0f\u67b6\u6784\uff1a\u57fa\u4e8eHadoop\u751f\u6001\uff0c\u652f\u6301\u5206\u5e03\u5f0f\u6c34\u5e73\u6269\u5c55\uff0c\u901a\u8fc7\u4e00\u5957\u67b6\u6784\u89e3\u51b3\u6279\u5f0f\u3001\u6d41\u5f0f\u3001\u589e\u91cf\u3001\u5168\u91cf\u573a\u666f\u4e0b\u7684\u6570\u636e\u540c\u6b65</p> <p>DDL\u81ea\u52a8\u540c\u6b65\uff1a\u652f\u6301\u4e0a\u4e0b\u6e38\u6570\u636e\u6e90\u4e4b\u95f4\u7075\u6d3b\u7684\u8868\u7ed3\u6784\u540c\u6b65\uff0c\u5305\u62ec\u8868\u521b\u5efa\u548c\u5217\u7ea7\u522b\u7684\u589e\u3001\u5220\u3001\u6539</p> <p>\u810f\u6570\u636e\u6536\u96c6\uff1a\u652f\u6301\u810f\u6570\u636e\u6536\u96c6\u5c55\u793a\uff0c\u5e76\u652f\u6301\u6269\u5c55\u810f\u6570\u636e\u5b58\u50a8\u65b9\u5f0f</p> <p>\u9ad8\u6548\u5f00\u53d1\uff1a\u72ec\u7acb\u4e8e\u5f15\u64ce\u7684\u8bfb\u5199\u63a5\u53e3\uff0c\u5f00\u53d1\u6210\u672c\u4f4e</p>"},{"location":"data_system/data_manage/data_integration/bitsail.html#_2","title":"\u67b6\u6784","text":"<p>Source[Input Sources] -&gt; Framework[Data Transmission] -&gt; Sink[Output Sinks]</p> <ul> <li>\u6846\u67b6\u5c42\u63d0\u4f9b\u4e30\u5bcc\u7684\u57fa\u7840\u529f\u80fd\uff0c\u5e76\u5bf9\u6240\u6709\u540c\u6b65\u573a\u666f\u751f\u6548\uff0c\u6bd4\u5982\u810f\u6570\u636e\u6536\u96c6\u3001\u81ea\u52a8\u5e76\u53d1\u5ea6\u8ba1\u7b97\u3001\u6d41\u63a7\u3001\u4efb\u52a1\u76d1\u63a7\u7b49</li> </ul> <p></p>"},{"location":"data_system/data_manage/data_integration/bitsail.html#_3","title":"\u652f\u6301\u7684\u6570\u636e\u6e90","text":"DataSource Reader Writer Doris \u2705 Druid \u2705 ElasticSearch \u2705 Fake \u2705 FTP/SFTP \u2705 Hive \u2705 \u2705 Hadoop \u2705 \u2705 HBase \u2705 \u2705 Hudi \u2705 \u2705 JDBC(MySQL/Oracle/PG/SQLServer\uff09 \u2705 \u2705 Kafka \u2705 \u2705 Kudu \u2705 \u2705 MongoDB \u2705 \u2705 Print \u2705 Redis \u2705 RocketMQ \u2705"},{"location":"data_system/data_manage/data_integration/bitsail.html#_4","title":"\u5b89\u88c5","text":""},{"location":"data_system/data_manage/data_integration/bitsail.html#_5","title":"\u4efb\u52a1\u914d\u7f6e","text":""},{"location":"data_system/data_manage/data_integration/chunjun.html","title":"chunjun","text":"<p>A data integration framework.</p> <p>\u539f\u540dFlinkX\uff0c\u662f\u4e00\u6b3e\u7a33\u5b9a\u3001\u6613\u7528\u3001\u9ad8\u6548\u3001\u6279\u6d41\u4e00\u4f53\u7684\u6570\u636e\u96c6\u6210\u6846\u67b6\uff0c\u76ee\u524d\u57fa\u4e8e\u5b9e\u65f6\u8ba1\u7b97\u5f15\u64ceFlink\u5b9e\u73b0\u591a\u79cd\u5f02\u6784\u6570\u636e\u6e90\u4e4b\u95f4\u7684\u6570\u636e\u540c\u6b65\u4e0e\u8ba1\u7b97</p> <p>\u6682\u4e0d\u652f\u6301Hudi\uff082022/12/8\uff09</p>"},{"location":"data_system/data_manage/data_integration/chunjun.html#_1","title":"\u7279\u6027","text":"<p>\u5c06\u4e0d\u540c\u7684\u6570\u636e\u5e93\u62bd\u8c61\u6210reader/source \u63d2\u4ef6\uff0cwriter/sink \u63d2\u4ef6\u548clookup \u7ef4\u8868\u63d2\u4ef6</p> <ul> <li>\u57fa\u4e8e\u5b9e\u65f6\u8ba1\u7b97\u5f15\u64ceFlink\uff0c\u652f\u6301JSON\u6a21\u7248\u914d\u7f6e\u4efb\u52a1\uff0c\u517c\u5bb9Flink SQL\u8bed\u6cd5\uff1b</li> <li>\u652f\u6301\u5206\u5e03\u5f0f\u8fd0\u884c\uff0c\u652f\u6301flink-standalone\u3001yarn-session\u3001yarn-per job\u7b49\u591a\u79cd\u63d0\u4ea4\u65b9\u5f0f\uff1b</li> <li>\u652f\u6301Docker\u4e00\u952e\u90e8\u7f72\uff0c\u652f\u6301K8S \u90e8\u7f72\u8fd0\u884c\uff1b</li> <li>\u652f\u6301\u591a\u79cd\u5f02\u6784\u6570\u636e\u6e90\uff0c\u53ef\u652f\u6301MySQL\u3001Oracle\u3001SQLServer\u3001Hive\u3001Kudu\u7b4920\u591a\u79cd\u6570\u636e\u6e90\u7684\u540c\u6b65\u4e0e\u8ba1\u7b97\uff1b</li> <li>\u6613\u62d3\u5c55\uff0c\u9ad8\u7075\u6d3b\u6027\uff0c\u65b0\u62d3\u5c55\u7684\u6570\u636e\u6e90\u63d2\u4ef6\u53ef\u4ee5\u4e0e\u73b0\u6709\u6570\u636e\u6e90\u63d2\u4ef6\u5373\u65f6\u4e92\u901a\uff0c\u63d2\u4ef6\u5f00\u53d1\u8005\u4e0d\u9700\u8981\u5173\u5fc3\u5176\u4ed6\u63d2\u4ef6\u7684\u4ee3\u7801\u903b\u8f91\uff1b</li> <li>\u4e0d\u4ec5\u4ec5\u652f\u6301\u5168\u91cf\u540c\u6b65\uff0c\u8fd8\u652f\u6301\u589e\u91cf\u540c\u6b65\u3001\u95f4\u9694\u8f6e\u8bad\uff1b</li> <li>\u6279\u6d41\u4e00\u4f53\uff0c\u4e0d\u4ec5\u4ec5\u652f\u6301\u79bb\u7ebf\u540c\u6b65\u53ca\u8ba1\u7b97\uff0c\u8fd8\u517c\u5bb9\u5b9e\u65f6\u573a\u666f\uff1b</li> <li>\u652f\u6301\u810f\u6570\u636e\u5b58\u50a8\uff0c\u5e76\u63d0\u4f9b\u6307\u6807\u76d1\u63a7\u7b49\uff1b</li> <li>\u914d\u5408checkpoint\u5b9e\u73b0\u65ad\u70b9\u7eed\u4f20\uff1b</li> <li>\u4e0d\u4ec5\u4ec5\u652f\u6301\u540c\u6b65DML\u6570\u636e\uff0c\u8fd8\u652f\u6301Schema\u53d8\u66f4\u540c\u6b65\uff1b</li> </ul>"},{"location":"data_system/data_manage/data_integration/chunjun.html#_2","title":"\u8bfb\u5199","text":""},{"location":"data_system/data_manage/data_integration/tis.html","title":"tis","text":"<p>Support agile DataOps Based on DataX and Flink-CDC, Chunjun with Web-UI.</p> <p>\u6700\u65b0\u7248\u672c\u7684TIS\u6570\u636e\u62bd\u53d6\u7ec4\u4ef6\u662f\u57fa\u4e8e\uff1a</p> <ul> <li>Alibaba DataX\uff0c\u5e76\u4e14\u5728\u539f\u751fDataX\u4e4b\u4e0a\u6dfb\u52a0\u4e86\u529f\u80fd\u7279\u6027\u5927\u5927\u63d0\u9ad8\u4e86DataX\u7684\u53ef\u7528\u6027</li> <li>\u5b9e\u65f6\u6570\u636e\u540c\u6b65\u6846\u67b6 Flink-CDC \u548c Chunjun</li> </ul>"},{"location":"data_system/data_manage/data_integration/tis.html#_1","title":"\u67b6\u6784","text":""},{"location":"data_system/data_manage/data_integration/tis.html#_2","title":"\u8bfb\u5199","text":"<p>\u652f\u6301\u7684\u6570\u636e\u5e93\u8bfb\u5199\u4ee5\u53ca\u5bf9\u5e94\u7684\u5e95\u5c42\u5b9e\u73b0\uff1a</p> \u7c7b\u578b \u6279\u91cf(DataX) \u5b9e\u65f6 \u8bfb \u5199 Source Sink Doris DataX ChunJun ElasticSearch DataX TIS TiDBDataX DataX RocketMQ TIS Kafka TIS Postgres DataX DataX ChunJun ChunJun Oracle DataX DataX ChunJun ChunJun FTP DataX DataX Clickhouse DataX ChunJun SqlServer DataX DataX HDFS DataX DataX MySQL DataX DataX ChunJun/FlinkCDC ChunJunChunJun AliyunOSS DataX DataX Hudi TIS TIS StarRocks DataX TIS MongoDB DataX DataX FlinkCDC Cassandra DataX DataX"},{"location":"data_system/file_system/benchmark.html","title":"\u6587\u4ef6\u7cfb\u7edf\u7684\u6027\u80fd\u6d4b\u8bd5","text":""},{"location":"data_system/file_system/benchmark.html#fiotodo","title":"fio\uff08TODO\uff09","text":"<p>\u6e90\u7801\u5730\u5740\uff1ahttps://github.com/axboe/fio</p>"},{"location":"data_system/file_system/benchmark.html#_2","title":"\u4f7f\u7528","text":""},{"location":"data_system/file_system/benchmark.html#nnbench","title":"NNBench","text":"<p>Hadoop \u4e2d\u6709\u4e00\u4e2a\u4e13\u95e8\u538b\u6d4b\u6587\u4ef6\u7cfb\u7edf\u5143\u6570\u636e\u6027\u80fd\u7684\u7ec4\u4ef6\u53eb NNBench\u3002</p> <p>\u5c40\u9650\u6027\uff1a</p> <ul> <li>\u5355\u4e2a\u6d4b\u8bd5\u4efb\u52a1\u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u8d44\u6e90\u5229\u7528\u7387\u4f4e\uff1b</li> <li>\u4f7f\u7528 hostname \u4f5c\u4e3a\u8def\u5f84\u540d\u7684\u4e00\u90e8\u5206\uff0c\u6ca1\u6709\u8003\u8651\u540c\u4e00\u4e2a\u4e3b\u673a\u91cc\u591a\u4e2a\u5e76\u53d1\u4efb\u52a1\u7684\u51b2\u7a81\u95ee\u9898\uff0c\u4f1a\u5bfc\u81f4\u591a\u4e2a\u6d4b\u8bd5\u4efb\u52a1\u91cd\u590d\u521b\u5efa\u548c\u5220\u9664\u6587\u4ef6\uff0c\u4e0d\u592a\u7b26\u5408\u5927\u6570\u636e\u5de5\u4f5c\u8d1f\u8f7d\u7684\u5b9e\u9645\u60c5\u51b5\uff1b</li> </ul>"},{"location":"data_system/file_system/benchmark.html#_3","title":"\u4f7f\u7528","text":"<pre><code>bin/hadoop jar share/hadoop/mapreduce2/hadoop-mapreduce-client-jobclient-2.3.0-cdh5.0.0-tests.jar nnbench -operation create_write -maps 4 -reduces 2 -bytesToWrite 1 -numberOfFiles 2 -replicationFactorPerFile 3 -readFileAfterOpen true -baseDir /benchmarks/NNBench\n</code></pre>"},{"location":"data_system/file_system/benchmark.html#dfs-perf","title":"dfs-perf","text":"<p>\u6e90\u7801\u5730\u5740\uff1a</p>"},{"location":"data_system/file_system/benchmark.html#k8s-storage","title":"K8s storage","text":""},{"location":"data_system/file_system/benchmark.html#longhornkbench","title":"longhorn/kbench","text":"<p>\u57fa\u51c6\u6d4b\u8bd5</p> <ul> <li>SIZE\u73af\u5883\u53d8\u91cf\uff1a\u5927\u5c0f\u5e94\u81f3\u5c11\u4e3a\u8bfb/\u5199\u5e26\u5bbd\u7684 25 \u500d\uff0c\u4ee5\u907f\u514d\u7f13\u5b58\u5f71\u54cd\u7ed3\u679c</li> <li>\u59cb\u7ec8\u9996\u5148\u9488\u5bf9\u672c\u5730\u5b58\u50a8\u8fdb\u884c\u6d4b\u8bd5\uff0c\u4ee5\u4e86\u89e3\u57fa\u7ebf\u662f\u4ec0\u4e48</li> <li>CPU_IDLE_PROF\u73af\u5883\u53d8\u91cf\uff1aCPU \u7a7a\u95f2\u5ea6\u5206\u6790\u6d4b\u91cf CPU \u7a7a\u95f2\uff0c\u4f46\u5b83\u4f1a\u5e26\u6765\u989d\u5916\u7684\u5f00\u9500\u5e76\u964d\u4f4e\u5b58\u50a8\u6027\u80fd\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8be5\u6807\u5fd7\u5904\u4e8e\u7981\u7528\u72b6\u6001\u3002</li> </ul>"},{"location":"data_system/file_system/benchmark.html#_4","title":"\u6307\u6807\u8bf4\u660e","text":"<ul> <li> <p>IOPS\uff1a\u6bcf\u79d2 IO \u64cd\u4f5c\u6570\u3002\u8d8a\u9ad8\u8d8a\u597d</p> </li> <li> <p>\u8861\u91cf\u8bbe\u5907\u5728\u4e00\u79d2\u949f\u5185\u53ef\u4ee5\u5904\u7406\u591a\u5c11 IO \u64cd\u4f5c\u7684\u5ea6\u91cf\uff0c\u4e3b\u8981\u6d89\u53ca\u8f83\u5c0f\u7684 IO \u5757\uff0c\u4f8b\u5982 4k\u3002</p> </li> <li> <p>\u5e26\u5bbd\uff1a\u4e5f\u79f0\u4e3a\u541e\u5410\u91cf\u3002\u8d8a\u9ad8\u8d8a\u597d\u3002</p> </li> <li> <p>\u8bbe\u5907\u5728\u4e00\u79d2\u949f\u5185\u53ef\u4ee5\u8bfb\u53d6/\u5199\u5165\u591a\u5c11\u6570\u636e\u7684\u5ea6\u91cf\u3002\u5b83\u4e3b\u8981\u662f\u5904\u7406\u8f83\u5927\u7684IO\u5757\uff0c\u4f8b\u5982128k\u3002</p> </li> <li> <p>\u5ef6\u8fdf\uff1a\u6bcf\u4e2a\u8bf7\u6c42\u5728 IO \u8def\u5f84\u4e2d\u82b1\u8d39\u7684\u603b\u65f6\u95f4\u3002\u8d8a\u4f4e\u8d8a\u597d</p> </li> <li> <p>\u5b58\u50a8\u7cfb\u7edf\u5904\u7406\u6bcf\u4e2a\u8bf7\u6c42\u7684\u6548\u7387\u7684\u5ea6\u91cf</p> </li> <li> <p>CPU \u7a7a\u95f2\uff1a\u8fd0\u884c\u6d4b\u8bd5\u7684\u8282\u70b9\u4e0a\u7684 CPU \u7a7a\u95f2\u7a0b\u5ea6\u3002\u8d8a\u9ad8\u8d8a\u597d\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u6bd4\u8f83\u57fa\u51c6\uff0c<code>Change</code>\u5217\u6307\u793a\u5c06\u7b2c\u4e8c\u4e2a\u5377\u4e0e\u7b2c\u4e00\u4e2a\u5377\u8fdb\u884c\u6bd4\u8f83\u65f6\u7684\u767e\u5206\u6bd4\u5dee\u5f02\u3002</p> </li> <li> <p>\u5bf9\u4e8e IOPS\u3001\u5e26\u5bbd\u3001CPU \u7a7a\u95f2\uff0c\u6b63\u767e\u5206\u6bd4\u66f4\u597d\u3002</p> <p>\u5bf9\u4e8e\u5ef6\u8fdf\uff0c\u8d1f\u767e\u5206\u6bd4\u66f4\u597d\u3002 \u5bf9\u4e8e CPU \u7a7a\u95f2\uff0c\u663e\u793a\u7684\u4e0d\u662f\u53d8\u5316\u7684\u767e\u5206\u6bd4\uff0c\u800c\u662f\u5dee\u5f02</p> </li> </ul>"},{"location":"data_system/file_system/benchmark.html#_5","title":"\u6ce8\u610f\u4e8b\u9879","text":"<p>\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\u51fa\u73b0\u95ee\u9898\uff1a\u9700\u8981\u5148\u6d4b\u8bd5\u672c\u5730\u5b58\u50a8\u4f5c\u4e3a\u57fa\u51c6\u3002</p> <ul> <li>\u8bfb\u53d6\u5ef6\u8fdf\u4f4e\u4e8e\u672c\u5730\u5b58\u50a8\uff1aIOPS/\u5e26\u5bbd\u53ef\u80fd\u4f1a\u66f4\u9ad8\uff0c\u4f46\u662f\u5ef6\u8fdf\u65e0\u6cd5\u6bd4\u672c\u5730\u5b58\u50a8\u66f4\u4f4e\uff1b</li> <li> <p>\u5982\u679c\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\uff0c\u5f88\u53ef\u80fd\u662f\u7531\u4e8e\u5b58\u5728\u7f13\u5b58\uff0c\u589e\u52a0<code>SIZE</code>\u4ee5\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u3002</p> </li> <li> <p>\u5199\u5165 IOPS/\u5e26\u5bbd/\u5ef6\u8fdf\u6bd4\u672c\u5730\u5b58\u50a8\u66f4\u597d</p> </li> <li>\u51e0\u4e4e\u4e0d\u53ef\u80fd\u83b7\u5f97\u6bd4\u672c\u673a\u5b58\u50a8\u66f4\u597d\u7684\u5199\u5165\u6027\u80fd\uff0c\u9664\u975e\u5728\u672c\u5730\u5b58\u50a8\u524d\u9762\u6709\u4e00\u4e2a\u6301\u4e45\u6027\u7f13\u5b58\u8bbe\u5907\uff1b</li> <li> <p>\u5982\u679c\u5f97\u5230\u66f4\u597d\u7684\u7ed3\u679c\uff0c\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\u53ef\u80fd\u4e0d\u662f\u5d29\u6e83\u4e00\u81f4\u7684\uff0c\u56e0\u6b64\u5b83\u4e0d\u4f1a\u5728\u54cd\u5e94\u4e4b\u524d\u5c06\u6570\u636e\u63d0\u4ea4\u5230\u78c1\u76d8\u4e2d\uff0c\u8fd9\u610f\u5473\u7740\u5728\u53d1\u751f\u4e8b\u6545\u65f6\uff0c\u53ef\u80fd\u4f1a\u4e22\u5931\u6570\u636e\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u5ef6\u8fdf\u57fa\u51c6\uff0cCPU\u7684\u7a7a\u95f2\u7387\u5c0f\u4e8e 40%\uff1b</p> </li> <li>\u5bf9\u4e8e\u5ef6\u8fdf\uff0cCPU \u7a7a\u95f2\u5e94\u81f3\u5c11\u4e3a 40%\uff0c\u4ee5\u786e\u4fdd\u6d4b\u8bd5\u4e0d\u4f1a\u53d7\u5230 CPU \u4e0d\u8db3\u7684\u5f71\u54cd\u3002</li> </ul>"},{"location":"data_system/file_system/fs.html","title":"FS","text":""},{"location":"data_system/file_system/fs.html#seaweedfs","title":"seaweedfs","text":"<p>compare to HDFS</p> <ul> <li>ideal for serving relatively smaller files quickly and concurrently\uff1b</li> <li>\"weed upload/download\" tool to store extra large files by splitting them into manageable data chunks</li> </ul> <p>Compared to GlusterFS, Ceph</p> System File Metadata File Content Read POSIX REST API Optimized for large number of small files SeaweedFS lookup volume id, cacheable O(1) disk seek Yes Yes SeaweedFS Filer Linearly Scalable, Customizable O(1) disk seek FUSE Yes Yes GlusterFS hashing FUSE, NFS Ceph hashing + rules FUSE Yes MooseFS in memory FUSE No MinIO separate meta file for each file Yes No <p>compared to MoofseFS</p> <ul> <li>designed for keeping large amounts (like several thousands) of very big files</li> <li>MooseFS Master Server keeps all meta data in memory. Same issue as HDFS namenode.</li> </ul> <p>Compared to MinIO</p> <ul> <li>MinIO each file write will incur extra writes to corresponding meta file</li> <li>MinIO does not have optimization for lots of small files.</li> <li>MinIO has multiple disk IO to read one file. SeaweedFS has O(1) disk reads, even for erasure coded files.</li> <li>MinIO has full-time erasure coding. SeaweedFS uses replication on hot data for faster speed and optionally applies erasure coding on warm data.</li> </ul>"},{"location":"data_system/file_system/fuse.html","title":"Fuse","text":"<p>[toc]</p>"},{"location":"data_system/file_system/fuse.html#fuse","title":"FUSE","text":"<p>\u7528\u6237\u7a7a\u95f4\u6587\u4ef6\u7cfb\u7edf\uff08Filesystem in Userspace\uff09\uff0c\u7528\u6237\u53ef\u901a\u8fc7fuse\u5728\u7528\u6237\u7a7a\u95f4\u6765\u5b9a\u5236\u5b9e\u73b0\u81ea\u5df1\u7684\u6587\u4ef6\u7cfb\u7edf\u3002</p>"},{"location":"data_system/file_system/fuse.html#_1","title":"\u4ecb\u7ecd","text":"<p>\u73b0\u5b58\u6587\u4ef6\u7cfb\u7edf\u96be\u4ee5\u6ee1\u8db3\u7528\u6237\u7684\u7279\u522b\u9700\u6c42\uff0c\u5185\u6838\u4e0b\u5b9a\u5236\u5f00\u53d1\u6587\u4ef6\u7cfb\u7edf\u96be\u5ea6\u8f83\u9ad8\uff0c\u5728\u7528\u6237\u7a7a\u95f4\u53ef\u5b9a\u5236\u5b9e\u73b0\u6587\u4ef6\u7cfb\u7edf\u662f\u6709\u9700\u6c42\u7684\u3002\u5e76\u4e14\uff0c\u7528\u6237\u7a7a\u95f4\u4e0b\u8c03\u8bd5\u5de5\u5177\u4e30\u5bcc\uff0c\u51fa\u95ee\u9898\u4e0d\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\uff0c\u5f00\u53d1\u96be\u5ea6\u76f8\u5bf9\u8f83\u4f4e\uff0c\u5f00\u53d1\u5468\u671f\u8f83\u77ed\u3002</p> <p>fuse\u672c\u8eab\u662f\u5185\u6838\u63d0\u4f9b\u7684\u4e00\u4e2a\u529f\u80fd\uff0c\u5185\u6838\u5f00\u542ffuse\u652f\u6301\u540e\uff0c\u4f1a\u5728<code>/dev/fuse</code>\u8bbe\u5907\u8282\u70b9\uff08<code>char service</code>\uff09\uff0c\u5e94\u7528\u5c42\u53ef\u4ee5\u901a\u8fc7\u8be5\u8bbe\u5907\u8282\u70b9\u5b8c\u6210\u7528\u6237\u6001\u6587\u4ef6\u7cfb\u7edf\u3002</p>"},{"location":"data_system/file_system/fuse.html#_2","title":"\u539f\u7406\u56fe","text":"<p>\u5b8c\u6574\u7684fuse\u529f\u80fd\u5305\u62ec</p> <p>a\uff09\u7528\u6237\u6001customize\u6587\u4ef6\u7cfb\u7edf</p> <p>b\uff09\u7528\u6237\u6001fuse\u5e93\uff08libfuse\uff09</p> <p>c\uff09\u5185\u6838\u652f\u6301\uff08fs/fuse/*\uff09</p> <p>\u51713\u5c42\u7ed3\u6784\u534f\u4f5c\u5b8c\u6210\u3002</p> <p></p>"},{"location":"data_system/file_system/fuse.html#_3","title":"\u8c03\u7528\u8fc7\u7a0b","text":"<p>/mnt/fuse\u76ee\u5f55\u5df2\u7ecf\u6302\u8f7d\u4e86ZFUSE\uff0c\u51c6\u5907\u5728/mnt/fuse\u76ee\u5f55\u4e0b\u521b\u5efa\u7b2c\u4e00\u4e2a\u6587\u4ef6my.log\u3002</p> <p></p> <p>1\uff09ZFUSE\u6302\u8f7d\u5230/mnt/fuse\uff0clibfuse\u4f1afork\u51fa\u540e\u53f0\u8fdb\u7a0b\uff0c\u7528\u4e8e\u8bfb\u53d6\u7ba1\u9053\u6587\u4ef6\u6d88\u606f\u3002</p> <p>2\uff09\u7528\u6237\u4f7f\u7528ZFUSE\u6587\u4ef6\u7cfb\u7edf\uff0c\u521b\u5efa\u6587\u4ef6my.log</p> <p>3\uff09\u8c03\u7528\u7cfb\u7edf\u8c03\u7528</p> <p>4\uff09\u7ecfVFS\u4ea4\u7531fuse\u5904\u7406</p> <p>5\uff09fuse\u4e0b\u7684create\u5904\u7406\uff0c\u5411\u7ba1\u9053\u53d1\u9001\u5e26\u521b\u5efa\u64cd\u4f5c\uff08FUSE_CREATE\uff09\u7684\u6d88\u606f\uff0c\u5f53\u524d\u8fdb\u7a0bA\u52a0\u5165\u7b49\u5f85\u961f\u5217</p> <p>6\uff09libfuse\u4e0b\u521b\u5efa\u7684\u540e\u53f0\u8fdb\u7a0b\u8bfb\u53d6\u5230\u6d88\u606f\uff0c\u89e3\u6790\u64cd\u4f5c\u6570\u4e3aFUSE_CREATE\uff0c\u5bf9\u5e94\u5230fuse_lib_create\uff0c\u5373low level\u5c42\u63a5\u53e3\u3002</p> <p>7\uff09fuse_lib_create\u4e2d\u8c03\u7528ZFUSE\u7684\u4e0a\u5c42\u63a5\u53e3zfuse.create\uff0c\u7531ZFUSE\u6765\u5b9e\u73b0\u521b\u5efa\u64cd\u4f5c</p> <p>8\uff09\u5b8c\u6210\u521b\u5efa\u540e\uff0c\u901a\u8fc7libfuse\u4e2d\u7684fuse_reply_create\u5411\u7ba1\u9053\u53d1\u9001\u5b8c\u6210\u6d88\u606f\u4ece\u800c\u5524\u9192\u4e4b\u524d\u52a0\u5165\u7b49\u5f85\u961f\u5217\u7684\u8fdb\u7a0bA</p> <p>9\uff09\u8fdb\u7a0bA\u5f97\u5230\u521b\u5efa\u6210\u529f\u7684\u6d88\u606f\uff0c\u7cfb\u7edf\u8c03\u7528\u7ed3\u675f\uff0c/mnt/fuse/my.log\u6587\u4ef6\u521b\u5efa\u6210\u529f</p>"},{"location":"data_system/file_system/fuse.html#libfuse","title":"libfuse","text":"<p>The reference implementation of the Linux FUSE (Filesystem in Userspace) interface</p>"},{"location":"data_system/file_system/fuse.html#java-fuse","title":"Java \u7684 Fuse","text":""},{"location":"data_system/file_system/fuse.html#jnr-fusenot-recommend","title":"jnr-fuse(Not Recommend)","text":"<p>FUSE implementation in Java using Java Native Runtime (JNR).</p> <ul> <li>\u4e2a\u4eba\u9879\u76ee\uff0c\u6d3b\u8dc3\u6027\u8f83\u5dee\uff0c\u6700\u65b0\u7248\u672c 2021 \u5e74 0.5.7.</li> </ul> <p>\u57fa\u4e8e Jnr-Fuse \u548c libfuse \u5b9e\u73b0\u7684 Java Fuse\u3002</p> <ul> <li>\u5b9a\u4e49\u81ea\u5df1\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u53ea\u9700\u8981\u7ee7\u627f<code>FuseStubFS</code>\u7c7b\uff0c\u5e76\u5b9e\u73b0\u76f8\u5173\u63a5\u53e3\u5373\u53ef\uff1b</li> </ul>"},{"location":"data_system/file_system/fuse.html#alluxiojni-fuse","title":"alluxio(jni-fuse)","text":"<p>alluxio \u7684 jnr-fuse \u548c jni-fuse \u7684\u6027\u80fd\u5bf9\u6bd4\u89c1\uff1a Alluxio FUSE \u5b9e\u73b0\u539f\u7406</p>"},{"location":"data_system/file_system/fuse.html#hcfs-fuse","title":"hcfs-fuse","text":"<p>a fuse program which can access any hcfs(hadoop compatiable file system) implemented file system. Such as local filesystem, hdfs, ozone, alluxio, oss, cos, s3, and so on.</p> <p>\u5b9e\u73b0\u539f\u7406\uff1a\u57fa\u4e8e Hadoop FileSystem \u5b9e\u73b0\u4e86 Fuse \u7684\u63a5\u53e3\uff0cFuse \u652f\u6301</p> <ul> <li>jnr-fuse\uff1a\u4f7f\u7528 jnr-fuse\uff0c\u5b9e\u73b0\u4e86<code>FuseStubFS</code>\uff1b</li> <li>jni-fuse\uff1a\u4f7f\u7528 Alluxio \u63d0\u4f9b\u7684 jni-fuse\uff0c\u5b9e\u73b0\u4e86<code>AbstractFuseFileSystem</code>\uff1b</li> </ul>"},{"location":"data_system/file_system/hdfs/HA.html","title":"HA","text":"<p>[toc]</p>"},{"location":"data_system/file_system/hdfs/HA.html#ha","title":"HA","text":"<p>NameNode\uff1a\u5206\u4e3aActive\u548cStandBy\u4e24\u79cd\u72b6\u6001</p> <p>NameNodes\u95f4\u5143\u6570\u636e\u4e00\u81f4</p> <ul> <li>NFS\uff1a\u5b9e\u73b0\u591a\u4e2aNameNodes\u7684EditLog\u5171\u4eab</li> <li>QJM\uff1a\u5927\u591a\u6570\u51b3\u7b56\uff0c\u63a5\u6536\u5143\u6570\u636e\u4fee\u6539\u65e5\u5fd7\uff0cStandBy\u8bfb\u53d6\u4fee\u6539\u65e5\u5fd7</li> </ul> <p>\u5feb\u901f\u7684\u6545\u969c\u5207\u6362</p> <ul> <li>DataNode\u5411\u6240\u6709NameNodes\u53d1\u9001\u5757\u4f4d\u7f6e\u4fe1\u606f\u548c\u5fc3\u8df3</li> </ul> <p>\u9694\u79bb\uff0c\u9632\u6b62\u8111\u88c2\uff0c\u4fdd\u8bc1\u5728\u4efb\u4f55\u65f6\u5019\u53ea\u6709\u4e00\u4e2a\u4e3bNN</p> <ul> <li>\u901a\u77e5ssh\u6216\u811a\u672c\u547d\u4ee4\uff0c\u5f3a\u884c\u7ec8\u6b62\u524d\u4efbNameNode</li> </ul> <p>\u81ea\u52a8\u6545\u969c\u5207\u6362</p> <ul> <li>\u9700\u8981\u914d\u7f6eZookeeper\u96c6\u7fa4</li> <li>ZKFailoverController\u8fdb\u7a0b\u76d1\u63a7NameNode\u72b6\u6001</li> </ul>"},{"location":"data_system/file_system/hdfs/audit.html","title":"Audit","text":"<p>HDFS \u5ba1\u8ba1\u65e5\u5fd7\uff0c\u5728<code>DefaultAuditLogger</code>\u4e2d\u7684<code>logAuditEvent</code>\u65b9\u6cd5\u4e2d\uff1a</p> <pre><code>2015-09-09 05:29:54,727 INFO FSNamesystem.audit: allowed=true   ugi=data (auth:SIMPLE)  ip=/192.128.10.15   cmd=open    \nsrc=/user/data/.staging/job_1441718170682_2949/job.jar  dst=null    perm=null   proto=rpc\n</code></pre> <p>\u4e0a\u9762\u5ba1\u8ba1\u65e5\u5fd7\u7684\u683c\u5f0f\u91cd\u70b9\u5173\u6ce8\uff08\u65f6\u95f4, ugi\u7528\u6237\u4fe1\u606f, ip\u5730\u5740\u4fe1\u606f, cmd\u64cd\u4f5c\uff09</p> <pre><code>#\n# hdfs audit logging\n#\nhdfs.audit.logger=INFO,RFAAUDIT\nhdfs.audit.log.maxfilesize=256MB\nhdfs.audit.log.maxbackupindex=100\nlog4j.logger.org.apache.hadoop.hdfs.server.namenode.FSNamesystem.audit=${hdfs.audit.logger}\nlog4j.additivity.org.apache.hadoop.hdfs.server.namenode.FSNamesystem.audit=false\nlog4j.appender.RFAAUDIT=org.apache.log4j.RollingFileAppender\nlog4j.appender.RFAAUDIT.File=${hadoop.log.dir}/hdfs-audit.log\nlog4j.appender.RFAAUDIT.layout=org.apache.log4j.PatternLayout\nlog4j.appender.RFAAUDIT.layout.ConversionPattern=%d{ISO8601} %p %c{2}: %m%n\nlog4j.appender.RFAAUDIT.MaxFileSize=${hdfs.audit.log.maxfilesize}\nlog4j.appender.RFAAUDIT.MaxBackupIndex=${hdfs.audit.log.maxbackupindex}\n</code></pre> <p>\u5199\u4e2a\u7a0b\u5e8f\u505a\u6587\u672c\u89e3\u6790\uff0c\u8fdb\u884ccount\u8ba1\u6570\uff0c\u4ee5\u53ca\u5206\u949f\u7ea7\u522bqps\u8bf7\u6c42\u91cf\u7684\u8d8b\u52bf\u7edf\u8ba1\uff0c\u5206\u7528\u6237\u7ea7\u522b\u7684\u8bf7\u6c42\u91cf\u5206\u6790\u3002</p>"},{"location":"data_system/file_system/hdfs/centralized_cache.html","title":"Centralized cache","text":"<p>[toc]</p>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#hdfs","title":"HDFS\u4e2d\u7684\u96c6\u4e2d\u5f0f\u7f13\u5b58\u7ba1\u7406","text":"<p>\u663e\u5f0f\u7f13\u5b58\u673a\u5236\uff0c\u5141\u8bb8\u7528\u6237\u6307\u5b9aHDFS\u8981\u7f13\u5b58\u7684\u8def\u5f84\u3002NameNode\u5c06\u4e0e\u78c1\u76d8\u4e0a\u5177\u6709\u6240\u9700\u5757\u7684\u6570\u636e\u8282\u70b9\u901a\u4fe1\uff0c\u5e76\u6307\u793a\u5b83\u4eec\u5c06\u5757\u7f13\u5b58\u5728\u5806\u5916\u7f13\u5b58\u4e2d\u3002</p>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#_1","title":"\u67b6\u6784","text":"<p>NameNode\u8d1f\u8d23\u534f\u8c03\u96c6\u7fa4\u4e2d\u6240\u6709DataNode\u7684\u5806\u5916\u7f13\u5b58\u3002NameNode\u5b9a\u671f\u4ece\u6bcf\u4e2aDataNode\u63a5\u6536\u4e00\u4e2a\u7f13\u5b58\u62a5\u544a\uff0c\u8be5\u62a5\u544a\u63cf\u8ff0\u7ed9\u5b9aDN\u4e0a\u7f13\u5b58\u7684\u6240\u6709\u5757\u3002NameNode\u901a\u8fc7\u5728DataNode heartbeat\u4e0a\u642d\u8f7dcache\u548cuncache\u547d\u4ee4\u6765\u7ba1\u7406DataNode\u7f13\u5b58\u3002</p> <p>NameNode\u67e5\u8be2\u5176\u7f13\u5b58\u6307\u4ee4\u4ee5\u786e\u5b9a\u5e94\u7f13\u5b58\u54ea\u4e9b\u8def\u5f84\u3002\u7f13\u5b58\u6307\u4ee4\u6301\u4e45\u5b58\u50a8\u5728fsimage\u548cedit log\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7Java\u548c\u547d\u4ee4\u884capi\u6dfb\u52a0\u3001\u5220\u9664\u548c\u4fee\u6539\u3002</p> <p>NameNode\u8fd8\u5b58\u50a8\u4e00\u7ec4\u7f13\u5b58\u6c60\uff0c\u7528\u4e8e\u5c06\u7f13\u5b58\u6307\u4ee4\u7ec4\u5408\u5728\u4e00\u8d77\u4ee5\u8fdb\u884c\u8d44\u6e90\u7ba1\u7406\u548c\u5f3a\u5236\u6267\u884c\u6743\u9650\u7684\u7ba1\u7406\u5b9e\u4f53\u3002</p> <p>NameNode\u5b9a\u671f\u91cd\u65b0\u626b\u63cf\u547d\u540d\u7a7a\u95f4\u548c\u6d3b\u52a8\u7f13\u5b58\u6307\u4ee4\uff0c\u4ee5\u786e\u5b9a\u54ea\u4e9b\u5757\u9700\u8981\u7f13\u5b58\u6216\u53d6\u6d88\u7f13\u5b58\uff0c\u5e76\u5c06\u7f13\u5b58\u5de5\u4f5c\u5206\u914d\u7ed9DataNodes\u3002\u91cd\u65b0\u626b\u63cf\u4e5f\u53ef\u4ee5\u7531\u7528\u6237\u64cd\u4f5c\u89e6\u53d1\uff0c\u5982\u6dfb\u52a0\u6216\u5220\u9664\u7f13\u5b58\u6307\u4ee4\u6216\u5220\u9664\u7f13\u5b58\u6c60\u3002</p> <p>\u5982\u679ccache\u6307\u4ee4\u8986\u76d6symlink\uff0c\u5219\u4e0d\u7f13\u5b58symlink\u76ee\u6807\u3002</p> <p>\u7f13\u5b58\u5f53\u524d\u5728\u6587\u4ef6\u6216\u76ee\u5f55\u7ea7\u522b\u5b8c\u6210\uff0c\u5f53\u524d\u7248\u672c\u4e0d\u652f\u6301\u5355\u72ec\u7f13\u5b58\u5757\u548c\u5b50\u5757\u3002</p>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#_2","title":"\u6982\u5ff5","text":""},{"location":"data_system/file_system/hdfs/centralized_cache.html#_3","title":"\u7f13\u5b58\u6307\u4ee4","text":"<p>cache directive \uff1a\u5b9a\u4e49\u88ab\u7f13\u5b58\u7684\u8def\u5f84\uff08\u6587\u4ef6/\u76ee\u5f55\uff09\u3002\u76ee\u5f55\u53ea\u4f1a\u7f13\u5b58\u4ee5\u53ca\u5b50\u6587\u4ef6\uff0c\u4e0d\u4f1a\u9012\u5f52\u7f13\u5b58\uff1b</p> <ul> <li>\u53ef\u4ee5\u6307\u5b9a\u7f13\u5b58\u526f\u672c\u56e0\u5b50\u6570\u548c\u8fc7\u671f\u65f6\u95f4\uff1b</li> </ul>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#_4","title":"\u7f13\u5b58\u6c60","text":"<p>\u7f13\u5b58\u6c60\u662f\u7528\u4e8e\u7ba1\u7406\u7f13\u5b58\u6307\u4ee4\u7ec4\u7684\u7ba1\u7406\u5b9e\u4f53\u3002\u7f13\u5b58\u6c60\u5177\u6709\u7c7b\u4f3cUNIX\u7684\u6743\u9650\uff0c\u5199\u5165\u6743\u9650\u5141\u8bb8\u7528\u6237\u5411\u6c60\u4e2d\u6dfb\u52a0\u548c\u5220\u9664\u7f13\u5b58\u6307\u4ee4\uff1b\u8bfb\u53d6\u6743\u9650\u5141\u8bb8\u7528\u6237\u5217\u51fa\u6c60\u4e2d\u7684\u7f13\u5b58\u6307\u4ee4\u4ee5\u53ca\u5176\u4ed6\u5143\u6570\u636e\uff1b\u6267\u884c\u6743\u9650\u672a\u4f7f\u7528\u3002</p> <p>\u7f13\u5b58\u6c60\u4e5f\u7528\u4e8e\u8d44\u6e90\u7ba1\u7406\uff0c\u9650\u5236\u53ef\u4ee5\u901a\u8fc7\u6c60\u4e2d\u7684\u6240\u6709\u6307\u4ee4\u53ef\u4ee5\u7f13\u5b58\u7684\u5b57\u8282\u6570\u3002</p> <p>\u7f13\u5b58\u6c60\u53ef\u4ee5\u6307\u5b9a\u6700\u957f\u751f\u5b58\u65f6\u95f4\uff0c\u9650\u5236\u6dfb\u52a0\u5230\u6c60\u4e2d\u7684\u6307\u4ee4\u7684\u6700\u957f\u8fc7\u671f\u65f6\u95f4\u3002</p>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#cli","title":"CLI","text":""},{"location":"data_system/file_system/hdfs/centralized_cache.html#cache-directive-commands","title":"Cache directive commands","text":""},{"location":"data_system/file_system/hdfs/centralized_cache.html#adddirective","title":"addDirective","text":"<p>\u6dfb\u52a0\u7f13\u5b58\u6307\u4ee4</p> <p><code>hdfs cacheadmin -addDirective -path &lt;path&gt; -pool &lt;pool-name&gt; [-force] [-replication &lt;replication&gt;] [-ttl &lt;time-to-live&gt;]</code></p> <ul> <li><code>-force</code>\uff1a\u8df3\u8fc7\u7f13\u5b58\u6c60\u7684\u8d44\u6e90\u9650\u5236\u7684\u68c0\u67e5\uff1b</li> </ul>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#removedirective","title":"removeDirective","text":"<p>\u79fb\u9664\u5355\u4e2a\u7f13\u5b58\u6307\u4ee4</p> <p>Usage: <code>hdfs cacheadmin -removeDirective  &lt;id&gt;</code></p>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#removedirectives","title":"removeDirectives","text":"<p>\u79fb\u9664\u7279\u5b9a\u8def\u5f84\u5173\u8054\u7684\u6bcf\u4e2a\u7f13\u5b58\u6307\u4ee4</p> <p>Usage: <code>hdfs cacheadmin -removeDirectives &lt;path&gt;</code></p>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#listdirectives","title":"listDirectives","text":"<p>Usage: <code>hdfs cacheadmin -listDirectives [-stats] [-path &lt;path&gt;] [-pool &lt;pool&gt;]</code></p>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#cache-pool-commands","title":"Cache pool commands","text":""},{"location":"data_system/file_system/hdfs/centralized_cache.html#addpool","title":"addPool","text":"<p><code>hdfs cacheadmin -addPool &lt;name&gt; [-owner &lt;owner&gt;] [-group &lt;group&gt;] [-mode &lt;mode&gt;] [-limit &lt;limit&gt;] [-maxTtl &lt;maxTtl&gt;]</code></p> <ul> <li><code>limit</code>\uff1a\u6700\u5927\u7f13\u5b58\u5b57\u8282`</li> </ul>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#modifypool","title":"modifyPool","text":"<p><code>hdfs cacheadmin -modifyPool &lt;name&gt; [-owner &lt;owner&gt;] [-group &lt;group&gt;] [-mode &lt;mode&gt;] [-limit &lt;limit&gt;] [-maxTtl &lt;maxTtl&gt;]</code></p>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#removepool","title":"removePool","text":"<p><code>hdfs cacheadmin -removePool &lt;name&gt;</code></p> <ul> <li>\u4f1a\u53d6\u6d88\u4e0e\u6c60\u5173\u8054\u7684\u8def\u5f84\u7684\u7f13\u5b58</li> </ul>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#listpools","title":"listPools","text":"<p><code>hdfs cacheadmin -listPools [-stats] [&lt;name&gt;]</code></p>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#_5","title":"\u914d\u7f6e","text":""},{"location":"data_system/file_system/hdfs/centralized_cache.html#dfsdatanodemaxlockedmemory","title":"dfs.datanode.max.locked.memory","text":"<p>DataNode\u53ef\u4ee5\u7f13\u5b58\u7684\u6700\u5927\u5185\u5b58\uff0c\u5bf9\u4e8eUnix-like\u7cfb\u7edf\uff0c\u9700\u8981\u8bbe\u7f6eDataNode\u7528\u6237\u7684\u201clocked-in-memory size\u201d ulimit (<code>ulimit -l</code>)\uff0c\u63d0\u9ad8\u5230\u5339\u914d\u8be5\u503c\u3002</p>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#dfsdatanodepmemcachedirs","title":"dfs.datanode.pmem.cache.dirs","text":"<p>\u7f13\u5b58\u7684\u8def\u5f84\uff0c\u5982 /mnt/pmem0, /mnt/pmem1\uff0c\u5982\u679c\u914d\u7f6e\u8fd9\u4e2a\u5219\u4e0d\u9700\u8981\u914d\u7f6e<code>dfs.datanode.max.locked.memory</code></p>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#_6","title":"\u53ef\u9009","text":"<ul> <li>dfs.namenode.path.based.cache.refresh.interval.ms</li> <li> <p>\u9ed8\u8ba430000\uff0c\u8def\u5f84\u7f13\u5b58\u91cd\u65b0\u626b\u63cf\uff08\u6307\u8ba1\u7b97\u5e94\u7f13\u5b58\u54ea\u4e9b\u5757\u4ee5\u53ca\u5728\u54ea\u4e9b\u6570\u636e\u8282\u70b9\u4e0a\u8fdb\u884c\u7f13\u5b58\uff09\u7684\u95f4\u9694\u3002</p> </li> <li> <p>dfs.datanode.fsdatasetcache.max.threads.per.volume</p> </li> <li> <p>\u9ed8\u8ba44\uff0cDataNode\u5c06\u4f7f\u7528\u6b64\u503c\u4f5c\u4e3a\u6bcf\u4e2a\u5377\u7528\u4e8e\u7f13\u5b58\u65b0\u6570\u636e\u7684\u6700\u5927\u7ebf\u7a0b\u6570\u3002</p> </li> <li> <p>dfs.cachereport.intervalMsec</p> </li> <li> <p>\u9ed8\u8ba410000\uff0cDataNode\u5c06\u4f7f\u7528\u6b64\u503c\u4f5c\u4e3a\u5411NameNode\u53d1\u9001\u5176\u7f13\u5b58\u72b6\u6001\u7684\u5b8c\u6574\u62a5\u544a\u4e4b\u95f4\u7684\u6beb\u79d2\u6570\u3002</p> </li> <li> <p>dfs.namenode.path.based.cache.block.map.allocation.percent</p> </li> <li> <p>\u9ed8\u8ba40.25, \u5206\u914d\u7ed9\u7f13\u5b58\u5757\u6620\u5c04\uff08cached block map\uff09\u7684Java\u5806\u7684\u767e\u5206\u6bd4\u3002\u7f13\u5b58\u5757\u6620\u5c04\u662f\u4f7f\u7528\u94fe\u5f0f\u54c8\u5e0c\u7684\u54c8\u5e0c\u6620\u5c04\u3002</p> </li> <li> <p>dfs.namenode.caching.enabled</p> </li> <li>\u8be5\u53c2\u6570\u53ef\u7528\u4e8e\u5f00\u542f/\u5173\u95edNameNode\u7684\u96c6\u4e2d\u7f13\u5b58\u3002\u5f53\u7981\u7528\u96c6\u4e2d\u7f13\u5b58\u65f6\uff0cNameNode\u5c06\u4e0d\u4f1a\u5904\u7406\u7f13\u5b58\u62a5\u544a\u6216\u5728\u96c6\u7fa4\u4e2d\u5b58\u50a8\u5757\u7f13\u5b58\u4f4d\u7f6e\u4fe1\u606f\u3002\u8bf7\u6ce8\u610f\uff0cNameNode\u5c06\u7ee7\u7eed\u5728\u6587\u4ef6\u7cfb\u7edf\u5143\u6570\u636e\u4e2d\u5b58\u50a8\u57fa\u4e8e\u8def\u5f84\u7684\u7f13\u5b58\u4f4d\u7f6e\uff0c\u5373\u4f7f\u5728\u542f\u7528\u7f13\u5b58\u4e4b\u524d\u5b83\u4e0d\u4f1a\u5bf9\u8fd9\u4e9b\u4fe1\u606f\u91c7\u53d6\u884c\u52a8\u3002\u8be5\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\u4e3atrue(\u5373\u542f\u7528\u96c6\u4e2d\u5f0f\u7f13\u5b58)\u3002</li> <li>dfs.datanode.pmem.cache.recovery</li> <li>\u5224\u65ad\u662f\u5426\u5728\u542f\u52a8DataNode\u65f6\u6062\u590d\u6301\u4e45\u5316\u5185\u5b58\u4e0a\u7684\u524d\u4e00\u4e2acache\u7684\u72b6\u6001\u3002\u5982\u679c\u542f\u7528\uff0cDataNode\u5c06\u6062\u590d\u6301\u4e45\u5316\u5185\u5b58\u4e2d\u5148\u524d\u7f13\u5b58\u7684\u6570\u636e\u7684\u72b6\u6001\u3002\u56e0\u6b64\uff0c\u5c06\u907f\u514d\u91cd\u65b0\u7f13\u5b58\u6570\u636e\u3002\u5982\u679c\u672a\u542f\u7528\u6b64\u5c5e\u6027\uff0c\u5219DataNode\u5c06\u6e05\u7406\u6301\u4e45\u5185\u5b58\u4e0a\u7684\u524d\u4e00\u4e2a\u7f13\u5b58(\u5982\u679c\u6709\u7684\u8bdd)\u3002</li> </ul>"},{"location":"data_system/file_system/hdfs/centralized_cache.html#os","title":"OS\u9650\u5236","text":"<p>\u9519\u8bef \u201cCannot start datanode because the configured max locked memory size\u2026 is more than the datanode\u2019s available RLIMIT_MEMLOCK ulimit,\u201d</p> <p>\u901a\u8fc7\u4fee\u6539 ulimit -l \u7684\u503c\uff0c\u5141\u8bb8\u9501\u5b9a\u7684\u6700\u5927\u5185\u5b58\u914d\u7f6e\u3002</p>"},{"location":"data_system/file_system/hdfs/edit_image_viewer.html","title":"Edit image viewer","text":"<p>[toc]</p>"},{"location":"data_system/file_system/hdfs/edit_image_viewer.html#offline-edit-viewer","title":"Offline Edit Viewer","text":"<p>\u89e3\u6790Edit log\u6587\u4ef6\uff0c\u79bb\u7ebf\u5de5\u5177\uff0c\u4e0d\u9700\u8981Hadoop\u96c6\u7fa4\u8fd0\u884c\u3002binary\u548cxml\u53ef\u4ee5\u4e92\u76f8\u8f6c\u6362\u3002</p> <p>\u8f93\u5165\u683c\u5f0f\u652f\u6301\uff1a1\uff09binary\uff1b2\uff09xml</p> <p>\u8f93\u51fa\u683c\u5f0f\u652f\u6301\uff1a1\uff09binary\uff1b2\uff09xml\uff1b3\uff09stats\uff08\u7edf\u8ba1\u4fe1\u606f\uff0c\u4e0d\u53ef\u4ee5\u8f6c\u56deEdits\u6587\u4ef6\uff09</p>"},{"location":"data_system/file_system/hdfs/edit_image_viewer.html#xml-processor","title":"XML Processor","text":"<p>\u9ed8\u8ba4\u7684\u5904\u7406\u5668</p> <pre><code>bash$ bin/hdfs oev -p xml -i edits -o edits.xml\n</code></pre> <p>\u7ed3\u679c\u7684\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n   &lt;EDITS&gt;\n     &lt;EDITS_VERSION&gt;-64&lt;/EDITS_VERSION&gt;\n     &lt;RECORD&gt;\n       &lt;OPCODE&gt;OP_START_LOG_SEGMENT&lt;/OPCODE&gt;\n       &lt;DATA&gt;\n         &lt;TXID&gt;1&lt;/TXID&gt;\n       &lt;/DATA&gt;\n     &lt;/RECORD&gt;\n     &lt;RECORD&gt;\n       &lt;OPCODE&gt;OP_UPDATE_MASTER_KEY&lt;/OPCODE&gt;\n       &lt;DATA&gt;\n         &lt;TXID&gt;2&lt;/TXID&gt;\n         &lt;DELEGATION_KEY&gt;\n           &lt;KEY_ID&gt;1&lt;/KEY_ID&gt;\n           &lt;EXPIRY_DATE&gt;1487921580728&lt;/EXPIRY_DATE&gt;\n           &lt;KEY&gt;2e127ca41c7de215&lt;/KEY&gt;\n         &lt;/DELEGATION_KEY&gt;\n       &lt;/DATA&gt;\n     &lt;/RECORD&gt;\n     &lt;RECORD&gt;\n   ...remaining output omitted...\n</code></pre>"},{"location":"data_system/file_system/hdfs/edit_image_viewer.html#binary-processor","title":"Binary Processor","text":"<pre><code>bash$ bin/hdfs oev -p binary -i edits.xml -o edits\n</code></pre>"},{"location":"data_system/file_system/hdfs/edit_image_viewer.html#stats-processor","title":"Stats Processor","text":"<pre><code>bash$ bin/hdfs oev -p stats -i edits -o edits.stats\n</code></pre> <p>\u7ed3\u679c\u683c\u5f0f\u5982\u4e0b\uff1aVERSION\u5c31\u662fHDFS NameNode\u7684VERSION</p> <pre><code>   VERSION                             : -64\n   OP_ADD                         (  0): 8\n   OP_RENAME_OLD                  (  1): 1\n   OP_DELETE                      (  2): 1\n   OP_MKDIR                       (  3): 1\n   OP_SET_REPLICATION             (  4): 1\n   OP_DATANODE_ADD                (  5): 0\n   OP_DATANODE_REMOVE             (  6): 0\n   OP_SET_PERMISSIONS             (  7): 1\n   OP_SET_OWNER                   (  8): 1\n   OP_CLOSE                       (  9): 9\n   OP_SET_GENSTAMP_V1             ( 10): 0\n   ...some output omitted...\n   OP_APPEND                      ( 47): 1\n   OP_SET_QUOTA_BY_STORAGETYPE    ( 48): 1\n   OP_INVALID                     ( -1): 0\n</code></pre>"},{"location":"data_system/file_system/hdfs/edit_image_viewer.html#_1","title":"\u547d\u4ee4\u53c2\u6570","text":"Flag Description [<code>-i</code> ; <code>--inputFile</code>] input file \u5fc5\u987b\uff0c\u8f93\u5165\u6587\u4ef6 [<code>-o</code> ; <code>--outputFile</code>] output file \u5fc5\u987b\uff0c\u8f93\u51fa\u6587\u4ef6\uff0c\u8986\u76d6\u6a21\u5f0f [<code>-p</code> ; <code>--processor</code>] processor \u5904\u7406\u5668\u7c7b\u578b\uff0cbinary/xml/stats [<code>-v</code> ; <code>--verbose</code>] \u7ed3\u679c\u8f93\u51fa\u4e00\u4efd\u5230\u63a7\u5236\u53f0 [<code>-f</code> ; <code>--fix-txids</code>] \u91cd\u65b0\u5bf9\u8f93\u5165\u4e2d\u7684\u4e8b\u52a1ID\u7f16\u53f7\uff0c\u4ee5\u4fbf\u6ca1\u6709\u95f4\u9699\u6216\u65e0\u6548\u7684\u4e8b\u52a1ID\u3002 [<code>-r</code> ; <code>--recover</code>] \u4f7f\u7528\u6062\u590d\u6a21\u5f0f\u8bfb\u53d6\u4e8c\u8fdb\u5236\u7f16\u8f91\u65e5\u5fd7\uff0c\u53ef\u4ee5\u8df3\u8fc7\u7f16\u8f91\u65e5\u5fd7\u4e2d\u635f\u574f\u7684\u90e8\u5206 [<code>-h</code> ; <code>--help</code>] help\u4fe1\u606f"},{"location":"data_system/file_system/hdfs/edit_image_viewer.html#_2","title":"\u6848\u4f8b\u5b66\u4e60","text":"<p>\u5982\u679chadoop\u7fa4\u96c6\u6709\u95ee\u9898\uff0c\u5e76\u4e14\u7f16\u8f91\u6587\u4ef6\u5df2\u635f\u574f\uff0c\u5219\u53ef\u4ee5\u81f3\u5c11\u4fdd\u5b58\u90e8\u5206\u6b63\u786e\u7684\u7f16\u8f91\u6587\u4ef6\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u5c06\u4e8c\u8fdb\u5236\u7f16\u8f91\u8f6c\u6362\u4e3aXML\uff0c\u624b\u52a8\u7f16\u8f91\uff0c\u7136\u540e\u5c06\u5176\u8f6c\u6362\u56de\u4e8c\u8fdb\u5236\u6765\u5b8c\u6210\u3002</p> <p>\u6700\u5e38\u89c1\u7684\u95ee\u9898\u662f\u7f16\u8f91\u6587\u4ef6\u7f3a\u5c11\u7ed3\u675f\u8bb0\u5f55\uff08\u64cd\u4f5c\u7801\u4e3a-1\u7684\u8bb0\u5f55\uff09\u3002\u8fd9\u5e94\u8be5\u7531\u5de5\u5177\u8bc6\u522b\uff0c\u5e76\u4e14XML\u683c\u5f0f\u5e94\u8be5\u6b63\u786e\u5173\u95ed\u3002</p> <p>\u5982\u679cXML\u6587\u4ef6\u4e2d\u6ca1\u6709\u7ed3\u675f\u8bb0\u5f55\uff0c\u5219\u53ef\u4ee5\u5728\u6700\u540e\u4e00\u4e2a\u6b63\u786e\u8bb0\u5f55\u4e4b\u540e\u6dfb\u52a0\u4e00\u4e2a\u7ed3\u675f\u8bb0\u5f55\u3002\u64cd\u4f5c\u7801\u4e3a-1\u7684\u8bb0\u5f55\u4e4b\u540e\u7684\u4efb\u4f55\u5185\u5bb9\u90fd\u5c06\u88ab\u5ffd\u7565\u3002</p> <pre><code>  &lt;RECORD&gt;\n    &lt;OPCODE&gt;-1&lt;/OPCODE&gt;\n    &lt;DATA&gt;\n    &lt;/DATA&gt;\n  &lt;/RECORD&gt;\n</code></pre>"},{"location":"data_system/file_system/hdfs/edit_image_viewer.html#offline-image-viewer","title":"Offline Image Viewer","text":"<p>\u5c06hdfs fsimage\u6587\u4ef6\u7684\u5185\u5bb9\u8f6c\u50a8\u4e3a\u4eba\u7c7b\u53ef\u8bfb\u683c\u5f0f\uff0c\u5e76\u63d0\u4f9b\u53ea\u8bfbWebHDFS API\uff0c\u4ee5\u4fbf\u5141\u8bb8\u8131\u673a\u5206\u6790\u548c\u68c0\u67e5Hadoop\u96c6\u7fa4\u7684\u547d\u540d\u7a7a\u95f4\u3002</p> <ul> <li>Web\u662f\u9ed8\u8ba4\u7684\u8f93\u51fa\u5904\u7406\u5668\u3002\u5b83\u542f\u52a8\u4e00\u4e2aHTTP\u670d\u52a1\u5668\uff0c\u516c\u5f00\u53ea\u8bfbWebHDFS API\u3002\u7528\u6237\u53ef\u4ee5\u4f7f\u7528HTTP REST API\u4ea4\u4e92\u5730\u8c03\u67e5\u547d\u540d\u7a7a\u95f4\u3002</li> <li>XML\u521b\u5efafsimage\u7684XML\u6587\u6863\uff0c\u5e76\u5305\u542bfsimage\u4e2d\u7684\u6240\u6709\u4fe1\u606f\u3002\u8fd9\u4e2a\u5904\u7406\u5668\u7684\u8f93\u51fa\u53ef\u4ee5\u901a\u8fc7XML\u5de5\u5177\u8fdb\u884c\u81ea\u52a8\u5904\u7406\u548c\u5206\u6790\u3002\u7531\u4e8eXML\u8bed\u6cd5\u7684\u5197\u957f\u6027\uff0c\u8fd9\u4e2a\u5904\u7406\u5668\u4e5f\u5c06\u751f\u6210\u6700\u5927\u6570\u91cf\u7684\u8f93\u51fa\u3002</li> <li>FileDistribution\u662f\u5206\u6790\u547d\u540d\u7a7a\u95f4\u6620\u50cf\u4e2d\u6587\u4ef6\u5927\u5c0f\u7684\u5de5\u5177</li> <li>Delimited (experimental)\uff1a\u751f\u6210\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u6b63\u5728\u6784\u9020\u7684\u7d22\u5f15\u8282\u70b9\u548c\u7d22\u5f15\u8282\u70b9\u5171\u6709\u7684\u6240\u6709\u5143\u7d20\uff0c\u7528\u5206\u9694\u7b26\u5206\u9694\u3002</li> <li>ReverseXML (experimental)\uff1a\u4eceXML\u6587\u4ef6\u91cd\u5efafsimage\u3002\u6b64\u5904\u7406\u5668\u4f7f\u521b\u5efa\u7528\u4e8e\u6d4b\u8bd5\u7684fsimages\u548c\u5728\u51fa\u73b0\u635f\u574f\u65f6\u624b\u52a8\u7f16\u8f91fsimages\u53d8\u5f97\u5bb9\u6613\u3002</li> </ul>"},{"location":"data_system/file_system/hdfs/edit_image_viewer.html#web-processor","title":"Web Processor","text":"<p>Web\u5904\u7406\u5668\u542f\u52a8\u4e00\u4e2aHTTP\u670d\u52a1\u5668\uff0c\u8be5\u670d\u52a1\u5668\u516c\u5f00\u53ea\u8bfbWebHDFSAPI\u3002\u7528\u6237\u53ef\u4ee5\u6307\u5b9aaddr\u9009\u9879\u76d1\u542c\u7684\u5730\u5740\uff08\u9ed8\u8ba4\u4e3a\u672c\u5730\u4e3b\u673a\uff1a5978)</p> <pre><code>bash$ bin/hdfs oiv -i fsimage\n</code></pre> <p>\u901a\u8fc7hdfs\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u6570\u636e</p> <pre><code>bash$ bin/hdfs dfs -ls webhdfs://127.0.0.1:5978/\nFound 2 items\ndrwxrwx--* - root supergroup          0 2014-03-26 20:16 webhdfs://127.0.0.1:5978/tmp\ndrwxr-xr-x   - root supergroup          0 2014-03-31 14:08 webhdfs://127.0.0.1:5978/user\n</code></pre> <p>\u53ef\u4ee5\u901a\u8fc7 HTTP REST API \u83b7\u53d6 JSON\u683c\u5f0f\u7684 FileStatus</p> <pre><code>bash$ curl -i http://127.0.0.1:5978/webhdfs/v1/?op=liststatus\n</code></pre> <p>\u5f53\u524d\u652f\u6301\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <ul> <li>LISTSTATUS</li> <li>GETFILESTATUS</li> <li>GETACLSTATUS</li> <li>GETXATTRS</li> <li>LISTXATTRS</li> <li>CONTENTSUMMARY</li> </ul>"},{"location":"data_system/file_system/hdfs/edit_image_viewer.html#xml-processor_1","title":"XML Processor","text":"<pre><code>bash$ bin/hdfs oiv -p XML -i fsimage -o fsimage.xml\n</code></pre> <p>\u7ed3\u679c\u8f93\u51fa\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n   &lt;fsimage&gt;\n   &lt;NameSection&gt;\n     &lt;genstampV1&gt;1000&lt;/genstampV1&gt;\n     &lt;genstampV2&gt;1002&lt;/genstampV2&gt;\n     &lt;genstampV1Limit&gt;0&lt;/genstampV1Limit&gt;\n     &lt;lastAllocatedBlockId&gt;1073741826&lt;/lastAllocatedBlockId&gt;\n     &lt;txid&gt;37&lt;/txid&gt;\n   &lt;/NameSection&gt;\n   &lt;INodeSection&gt;\n     &lt;lastInodeId&gt;16400&lt;/lastInodeId&gt;\n     &lt;inode&gt;\n       &lt;id&gt;16385&lt;/id&gt;\n       &lt;type&gt;DIRECTORY&lt;/type&gt;\n       &lt;name&gt;&lt;/name&gt;\n       &lt;mtime&gt;1392772497282&lt;/mtime&gt;\n       &lt;permission&gt;theuser:supergroup:rwxr-xr-x&lt;/permission&gt;\n       &lt;nsquota&gt;9223372036854775807&lt;/nsquota&gt;\n       &lt;dsquota&gt;-1&lt;/dsquota&gt;\n     &lt;/inode&gt;\n   ...remaining output omitted...\n</code></pre>"},{"location":"data_system/file_system/hdfs/edit_image_viewer.html#filedistribution","title":"FileDistribution","text":"<pre><code>bash$ bin/hdfs oiv -p FileDistribution -maxSize maxSize -step size -i fsimage -o output\n</code></pre> <p>\u8f93\u51fa\u5f62\u5f0f\u5982\u4e0b\uff08\u53ef\u4ee5\u6307\u5b9a -format \u66f4\u53ef\u8bfb\uff09\uff1a</p> <pre><code>Size    NumFiles\n4   1\n12  1\n16  1\n20  1\ntotalFiles = 4\ntotalDirectories = 2\ntotalBlocks = 4\ntotalSpace = 48\nmaxFileSize = 21\n</code></pre>"},{"location":"data_system/file_system/hdfs/edit_image_viewer.html#reversexml-processor","title":"ReverseXML Processor","text":"<pre><code>bash$ bin/hdfs oiv -p ReverseXML -i fsimage.xml -o fsimage\n</code></pre>"},{"location":"data_system/file_system/hdfs/edit_image_viewer.html#delimited-processor","title":"Delimited Processor","text":"<pre><code>bash$ bin/hdfs oiv -p Delimited -delimiter delimiterString -i fsimage -o output\n</code></pre> <p>\u7ed3\u679c\u8f93\u51fa\u683c\u5f0f\uff1a</p> <pre><code> Path   Replication ModificationTime    AccessTime  PreferredBlockSize  BlocksCount FileSize    NSQUOTA DSQUOTA Permission  UserName    GroupName\n   /    0   2017-02-13 10:39    1970-01-01 08:00    0   0   0   9223372036854775807 -1  drwxr-xr-x  root    supergroup\n   /dir0    0   2017-02-13 10:39    1970-01-01 08:00    0   0   0   -1  -1  drwxr-xr-x  root    supergroup\n   /dir0/file0  1   2017-02-13 10:39    2017-02-13 10:39    134217728   1   1   0   0   -rw-r--r--  root    supergroup\n   /dir0/file1  1   2017-02-13 10:39    2017-02-13 10:39    134217728   1   1   0   0   -rw-r--r--  root    supergroup\n   /dir0/file2  1   2017-02-13 10:39    2017-02-13 10:39    134217728   1   1   0   0   -rw-r--r--  root    supergroup\n</code></pre>"},{"location":"data_system/file_system/hdfs/edit_image_viewer.html#_3","title":"\u547d\u4ee4\u53c2\u6570","text":"Flag Description <code>-i</code> <code>--inputFile</code> input file <code>-o</code> <code>--outputFile</code> output file <code>-p</code> <code>--processor</code> processor <code>-addr</code> address Web\u5904\u7406\u5668\u65f6\u6307\u5b9a\u76d1\u542c\u5730\u5740(host:port) \uff0c\u9ed8\u8ba4 localhost:5978 <code>-maxSize</code> size FileDistribution\u5904\u7406\u5668\uff0c\u6307\u5b9a\u6587\u4ef6\u5927\u5c0f\u7684\u8303\u56f4 [0, maxSize]\uff0c\u9ed8\u8ba4128GB <code>-step</code> size FileDistribution\u5904\u7406\u5668\uff0c\uff0c\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u6307\u5b9a\u5206\u5e03\u7684\u7c92\u5ea6 \uff0c\u9ed8\u8ba4 2MB <code>-format</code> FileDistribution\u5904\u7406\u5668\uff0c\u8f93\u51fa\u7ed3\u679c\u683c\u5f0f\u5316\u4e3a\u53ef\u8bfb\u5f62\u5f0f\uff0c\u9ed8\u8ba4false <code>-delimiter</code> arg Delimited\u5904\u7406\u5668\u7684\u5206\u9694\u7b26\uff0c\u9ed8\u8ba4\\t <code>-t</code> <code>--temp</code> temporary dir <code>-h</code> <code>--help</code>"},{"location":"data_system/file_system/hdfs/hdfs.html","title":"Hdfs","text":"<p>[toc]</p>"},{"location":"data_system/file_system/hdfs/hdfs.html#hadoop-distributed-file-system","title":"Hadoop Distributed File System","text":"<p>\u4ee5 2.10.0\u7248\u672c/3.2.1\u7248\u672c \u8fdb\u884c\u4ecb\u7ecd</p> <p>TODO: \u7b80\u4ecb</p> <p>HDFS HA</p> <p>ShortCutRead</p> <p>NativeLibraries</p> <p>\u6743\u9650\u63a7\u5236</p> <p>\u6587\u4ef6/\u76ee\u5f55\u7f13\u5b58</p> <p>\u76ee\u5f55\u914d\u989d</p> <p>\u5b58\u50a8\u7b56\u7565</p> <p>\u4e2d\u5fc3\u5316\u7f13\u5b58\u7ba1\u7406</p> <p>\u5185\u5b58\u5b58\u50a8</p> <p>FSImage\u5e95\u5c42\u91c7\u7528Protobuf\u8fdb\u884c\u5e8f\u5217\u5316</p> <p>TODO\uff1a</p> <p>FSDataInputStream\u4e2d\u8bfb\u53d6\u7279\u5b9a\u4f4d\u7f6e\u7684\u5b57\u8282\u6570\u65b9\u6cd5\uff0c\u4e24\u8005\u533a\u522b\u5728\u54ea\uff1f</p> <ol> <li>seek(positionRead) + readFully(bytes, offset, len)</li> <li>readFully(positionRead, bytes, offset, len)</li> </ol> <p>Block\u7684\u6821\u9a8c\u548c\u662f\u7531Client\u505a\uff0c\u8fd8\u662f\u6709DataNode\u505a\uff1f</p>"},{"location":"data_system/file_system/hdfs/hdfs.html#_1","title":"\u5fc3\u8df3\u673a\u5236","text":""},{"location":"data_system/file_system/hdfs/memory_storage.html","title":"Memory storage","text":"<p>[toc]</p>"},{"location":"data_system/file_system/hdfs/memory_storage.html#hdfs","title":"HDFS\u7684\u5185\u5b58\u5b58\u50a8","text":"<p>HDFS\u652f\u6301\u5411\u6570\u636e\u8282\u70b9\u7ba1\u7406\u7684\u5806\u5916\u5185\u5b58\u5199\u5165\u3002\u6570\u636e\u8282\u70b9\u4f1a\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5f02\u6b65\u5237\u65b0\u5230\u78c1\u76d8\uff0c\u5bf9\u6027\u80fd\u654f\u611f\u7684IO\u8def\u5f84\u4e2d\u79fb\u9664\u6602\u8d35\u7684\u78c1\u76d8IO\u548c\u6821\u9a8c\u548c\u8ba1\u7b97\u3002</p> <p>DFS\u4e3a\u60f0\u6027\u6301\u4e45\u5316\u5199\u63d0\u4f9b\u4e86\u6700\u597d\u7684\u6301\u4e45\u6027\u4fdd\u8bc1\u3002\u5728\u526f\u672c\u6301\u4e45\u5316\u5230\u78c1\u76d8\u4e4b\u524d\u91cd\u65b0\u542f\u52a8\u8282\u70b9\uff0c\u53ef\u80fd\u4f1a\u53d1\u751f\u7f55\u89c1\u7684\u6570\u636e\u4e22\u5931\u3002</p> <p>\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u9009\u62e9\u4f7f\u7528\u60f0\u6027\u6301\u4e45\u5316\u5199\uff0c\u4ee5\u964d\u4f4e\u4e00\u4e9b\u6301\u4e45\u6027\u4fdd\u8bc1\u6765\u83b7\u53d6\u51cf\u5c11\u5ef6\u8fdf\u3002</p> <p>Memory storage is for applications that run within the cluster and collocated with HDFS Data Nodes. </p> <p>We have observed that the latency overhead from network replication negates the benefits of writing to memory.</p> <p></p>"},{"location":"data_system/file_system/hdfs/memory_storage.html#_1","title":"\u914d\u7f6e","text":"<p>hdfs-site.xml</p> <pre><code>    &lt;property&gt;\n        &lt;name&gt;dfs.datanode.max.locked.memory&lt;/name&gt;\n        &lt;value&gt;34359738368&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;\n        &lt;value&gt;/grid/0,/grid/1,/grid/2,[RAM_DISK]/mnt/dn-tmpfs&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;proerty&gt;\n        &lt;name&gt;dfs.storage.policy.enabled&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/proerty&gt;\n</code></pre> <p>Mount Ram Disk</p> <pre><code>$ sudo mount -t tmpfs -o size=32g tmpfs /mnt/dn-tmpfs/\n</code></pre> <p>\u5efa\u8bae\u5728/etc/fstab\u4e2d\u521b\u5efa\u4e00\u4e2a\u6761\u76ee\uff0c\u4ee5\u4fbf\u5728\u8282\u70b9\u91cd\u542f\u65f6\u81ea\u52a8\u91cd\u65b0\u521b\u5efaRAM\u78c1\u76d8\u3002</p>"},{"location":"data_system/file_system/hdfs/memory_storage.html#_2","title":"\u4f7f\u7528","text":"<pre><code>$ hdfs storagepolicies -setStoragePolicy -path &lt;path&gt; -policy LAZY_PERSIST\n</code></pre> <p>\u6216</p> <pre><code>// FileSystem API\nfs.setStoragePolicy(path, \"LAZY_PERSIST\");\n</code></pre> <p>\u6216</p> <pre><code>// FileSystem#create API\nFSDataOutputStream fos = fs.create(\n                            path,\n                            FsPermission.getFileDefault(),\n                            EnumSet.of(CreateFlag.CREATE, CreateFlag.LAZY_PERSIST),\n                            bufferLength,\n                            replicationFactor,\n                            blockSize,\n                            null);\n</code></pre>"},{"location":"data_system/file_system/hdfs/metadata.html","title":"Metadata","text":"<p>[toc]</p>"},{"location":"data_system/file_system/hdfs/metadata.html#_1","title":"\u5143\u6570\u636e\u6062\u590d\u539f\u7406\u89e3\u6790","text":"<p>DataNodes\u5b58\u50a8\u7684\u5757\u548c\u4f4d\u7f6e\u4fe1\u606f\uff0c\u4e0d\u5b58\u50a8\u5728NameNode\u5143\u6570\u636e\uff0c\u800c\u662fNameNode\u542f\u52a8\u65f6\uff0cDataNode\u6c47\u62a5\u5176\u5b58\u50a8\u5728\u5757\u548c\u4f4d\u7f6e\u4fe1\u606f\u3002</p>"},{"location":"data_system/file_system/hdfs/metadata.html#fsimage","title":"FSImage","text":""},{"location":"data_system/file_system/hdfs/metadata.html#editlog","title":"EditLog","text":"<p>FSEditLogOp \u57fa\u7c7b\uff0c\u4e0d\u540c\u7684\u64cd\u4f5c\u5b9a\u4e49\u4e0d\u540c\u7c7b\uff0c\u5b9e\u73b0\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u65b9\u6cd5\u3002</p> <p>Writer\u7c7b\u5199Op\u5b9e\u4f8b\uff1a</p> <ul> <li>Op\u540d\uff1b</li> <li>op\u5e8f\u5217\u5316\u540e\u7684\u957f\u5ea6\uff1b\uff08\u53ef\u9009\uff09</li> <li> <p>op\u5e8f\u5217\u5316\uff1b</p> </li> <li> <p>\u6821\u9a8c\u548c\uff1b</p> </li> </ul> <p>\u4f18\u5316\uff1a</p> <ul> <li> <p>\u65e5\u5fd7\u540c\u6b65\u5199\uff1aThreadLocal\u7684Cache\uff0c\u4fdd\u5b58Op\u5b9e\u4f8b\uff0c\u907f\u514d\u91cd\u590d\u521b\u5efa\u548cGC\u5f00\u9500\u3002</p> </li> <li></li> </ul>"},{"location":"data_system/file_system/hdfs/mount.html","title":"HDFS\u6302\u8f7d\u672c\u5730","text":""},{"location":"data_system/file_system/hdfs/mount.html#nfs-gateway","title":"NFS Gateway\u7ec4\u4ef6\uff08\u5b98\u65b9\uff09","text":"<p>https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/HdfsNfsGateway.html</p> <p>HDFS\u7684NFS\u7f51\u5173\u5141\u8bb8\u5ba2\u6237\u7aef\u6302\u8f7dHDFS\u5e76\u901a\u8fc7NFS\u4e0e\u5176\u8fdb\u884c\u4ea4\u4e92\uff0c\u5c31\u50cf\u5b83\u662f\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u7684\u4e00\u90e8\u5206\u4e00\u6837\u3002\u7f51\u5173\u652f\u6301NFSv3\u3002</p> <p>\u5b89\u88c5HDFS\u540e\uff0c\u7528\u6237\u53ef\u4ee5\uff1a</p> <ul> <li>\u5728NFSv3\u5ba2\u6237\u7aef\u517c\u5bb9\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u901a\u8fc7\u5176\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6d4f\u89c8HDFS\u6587\u4ef6\u7cfb\u7edf\u3002</li> <li>\u5728HDFS\u6587\u4ef6\u7cfb\u7edf\u548c\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4e4b\u95f4\u4e0a\u8f7d\u548c\u4e0b\u8f7d\u6587\u4ef6\u3002</li> <li>\u901a\u8fc7\u6302\u8f7d\u70b9\u5c06\u6570\u636e\u76f4\u63a5\u4f20\u8f93\u5230HDFS\u3002 \uff08\u652f\u6301\u6587\u4ef6\u8ffd\u52a0\uff0c\u4f46\u4e0d\u652f\u6301\u968f\u673a\u5199\u5165\u3002\uff09</li> </ul>"},{"location":"data_system/file_system/hdfs/mount.html#0-hadoop-322","title":"0. \u5148\u51b3\u6761\u4ef6(\u7248\u672c: hadoop 3.2.2)","text":"<p>NFS\u7f51\u5173\u673a\u5668\u9700\u8981\u5177\u5907\u8fd0\u884cHDFS client\u7684\u6240\u6709\u914d\u7f6e\uff0c\u5982Hadoop\u6838\u5fc3JAR\u6587\u4ef6\u548cHADOOP_CONF\u76ee\u5f55\u3002</p>"},{"location":"data_system/file_system/hdfs/mount.html#1","title":"1. \u542f\u52a8","text":"<p>\u542f\u52a8NFS\u670d\u52a1\u9700\u8981\u4e09\u4e2a\u7ec4\u4ef6\uff1arpcbind\uff08\u6216 portmap\uff09\uff0cmountd \u548c nfsd\u3002</p> <ul> <li>\u505c\u6b62\u673a\u5668\u81ea\u5e26\u7684nfs\uff0c <code>service nfs stop</code>\u548c<code>service rpcbind stop</code>\uff1b</li> <li>\u542f\u52a8hadoop portmap\uff08\u9700\u8981linux root\u6743\u9650\uff09\uff1a<code>$HADOOP_HOME/bin/hdfs --daemon start portmap</code>\uff1b</li> <li>\u542f\u52a8mountd \u548c nfsd\uff0c<code>$HADOOP_HOME/bin/hdfs --daemon start nfs3</code>\uff1b</li> </ul>"},{"location":"data_system/file_system/hdfs/mount.html#2-hadoop","title":"2. Hadoop\u914d\u7f6e","text":"<ul> <li>\u6240\u6709hadoop\u8282\u70b9\u7684<code>core-site.yaml</code>\u65b0\u589e\u5982\u4e0b\u8bbe\u7f6e</li> <li> <p>\u914d\u7f6e\u5b8c\u4ee5\u540e\u5728hadoop\u4e3b\u8282\u70b9\u4f9d\u6b21\u6267\u884c:\uff08hdfs \u542f\u52a8\u7528\u6237experiment\uff09</p> </li> <li> <ul> <li><code>stop-dfs.sh</code></li> </ul> </li> <li><code>start-dfs.sh</code></li> </ul> <pre><code>&lt;!-- \u65b0\u589ehdfs nfs gateway \u914d\u7f6e  --&gt;\n&lt;property&gt;\n  &lt;name&gt;hadoop.proxyuser.experiment.groups&lt;/name&gt;\n  &lt;value&gt;*&lt;/value&gt;\n  &lt;description&gt;\n         The 'nfsserver' user is allowed to proxy all members of the 'users-group1' and\n         'users-group2' groups. Note that in most cases you will need to include the\n         group \"root\" because the user \"root\" (which usually belonges to \"root\" group) will\n         generally be the user that initially executes the mount on the NFS client system.\n         Set this to '*' to allow nfsserver user to proxy any group.\n  &lt;/description&gt;\n&lt;/property&gt;\n\n&lt;property&gt;\n  &lt;name&gt;hadoop.proxyuser.experiment.hosts&lt;/name&gt;\n  &lt;value&gt;*&lt;/value&gt;\n  &lt;description&gt;\n         This is the host where the nfs gateway is running. Set this to '*' to allow\n         requests from any hosts to be proxied.\n  &lt;/description&gt;\n&lt;/property&gt;\n\n&lt;property&gt;\n  &lt;name&gt;nfs.superuser&lt;/name&gt;\n  &lt;value&gt;experiment&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"data_system/file_system/hdfs/mount.html#3-nfs-gateway","title":"3. \u542f\u52a8NFS Gateway\u670d\u52a1","text":""},{"location":"data_system/file_system/hdfs/mount.html#31-rootportmap","title":"3.1 root\u7528\u6237\u542f\u52a8portmap\u670d\u52a1","text":"<ul> <li>\u6240\u6709hadoop\u8282\u70b9</li> </ul> <pre><code>hdfs --daemon start portmap\n</code></pre>"},{"location":"data_system/file_system/hdfs/mount.html#32-hadoopnfs3","title":"3.2 Hadoop\u542f\u52a8\u7528\u6237\u542f\u52a8nfs3\u670d\u52a1","text":"<ul> <li>\u6240\u6709hadoop\u8282\u70b9</li> </ul> <pre><code>hdfs --daemon start nfs3\n</code></pre>"},{"location":"data_system/file_system/hdfs/mount.html#33","title":"3.3 \u67e5\u770b\u53ef\u6302\u8f7d\u8def\u5f84","text":"<pre><code>showmount -e 172.16.2.135\n</code></pre>"},{"location":"data_system/file_system/hdfs/mount.html#34-rbc","title":"3.4 \u67e5\u770brbc\u7aef\u53e3\u662f\u5426\u542f\u52a8\u6b63\u5e38","text":"<pre><code>lsof -i:111\n</code></pre>"},{"location":"data_system/file_system/hdfs/mount.html#4","title":"4. \u6302\u8f7d\u53ca\u53d6\u6d88\u6302\u8f7d","text":""},{"location":"data_system/file_system/hdfs/mount.html#41","title":"4.1 \u6302\u8f7d","text":"<ul> <li>\u6302\u8f7d\u76ee\u5f55\u9700\u4fdd\u8bc1\u6240\u6709\u7528\u6237\u5747\u6709\u6743\u9650\u4e14\u4e3a\u7a7a\u76ee\u5f55</li> </ul> <pre><code># ro \u8868\u660e\u4e3a\u53ea\u8bfb\nmount -t nfs -o vers=3,proto=tcp,nolock,noacl,sync,ro node135:/  /home/common/mnthdfs/\n</code></pre>"},{"location":"data_system/file_system/hdfs/mount.html#42","title":"4.2 \u53d6\u6d88\u6302\u8f7d","text":"<pre><code>umount -l /home/common/mnthdfs/\n</code></pre>"},{"location":"data_system/file_system/hdfs/mount.html#5-nfs-gateway","title":"5. \u505c\u6b62NFS Gateway\u670d\u52a1","text":""},{"location":"data_system/file_system/hdfs/mount.html#51-hadoopnfs3","title":"5.1 Hadoop\u542f\u52a8\u7528\u6237\u505c\u6b62nfs3\u670d\u52a1","text":"<ul> <li>\u6240\u6709hadoop\u8282\u70b9</li> </ul> <pre><code>hdfs --daemon stop nfs3\n</code></pre>"},{"location":"data_system/file_system/hdfs/mount.html#52-rootportmap","title":"5.2 root\u7528\u6237\u505c\u6b62portmap\u670d\u52a1","text":"<ul> <li>\u6240\u6709hadoop\u8282\u70b9</li> </ul> <pre><code>hdfs --daemon stop portmap\n</code></pre>"},{"location":"data_system/file_system/hdfs/mount.html#fuse","title":"FUSE","text":""},{"location":"data_system/file_system/hdfs/multi_eth_conf.html","title":"Multihomed Networks","text":"<p>https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/HdfsMultihoming.html</p>"},{"location":"data_system/file_system/hdfs/native_libraries.html","title":"Native Hadoop Library","text":"<p>libhadoop.so  \u8981\u6c42\uff1a&gt;zlib-1.2, &gt;gzip-1.2</p> <ul> <li>Compression Codecs (bzip2, lz4, snappy, zlib)</li> <li>Native IO utilities for HDFS Short-Circuit Local Reads and Centralized Cache Management in HDFS</li> <li>CRC32 checksum implementation</li> </ul>"},{"location":"data_system/file_system/hdfs/native_libraries.html#_1","title":"\u4e0b\u8f7d","text":"<p>\u53d1\u884c\u7248\u7684\u9884\u7f16\u8bd1\u7684\u662f32\u4f4d\u7684i386 linux\u672c\u5730hadoop\u5e93\u3002</p>"},{"location":"data_system/file_system/hdfs/native_libraries.html#_2","title":"\u7f16\u8bd1","text":"<p>ANSI C \u6e90\u4ee3\u7801\uff0c\u4f7f\u7528GNU autotools\u5de5\u5177\u94fe\u3002</p> <p>\u5b89\u88c5\u4f9d\u8d56\uff1a</p> <ul> <li>C compiler (e.g. GNU C Compiler)</li> <li>GNU Autools Chain: autoconf, automake, libtool</li> <li>zlib-development package (stable version &gt;= 1.2.0)</li> <li>openssl-development package(e.g. libssl-dev)</li> </ul> <p>\u7f16\u8bd1</p> <pre><code># \u5728\u6839pom\u6267\u884c\nmvn package -Pdist,native -DskipTests -Dtar\n# \u7f16\u8bd1\u51fa\u6765\u540e\u5728hadoop-dist/target/hadoop-3.2.1/lib/native\n</code></pre>"},{"location":"data_system/file_system/hdfs/native_libraries.html#_3","title":"\u8fd0\u884c\u65f6","text":"<p><code>bin/hadoop</code>\u811a\u672c\u4fdd\u8bc1native hadoop\u5e93\u5728\u5e93\u641c\u7d22\u8def\u5f84\u4e0a\uff0c\u901a\u8fc7-Djava.library.path= \u6307\u5b9a\u52a8\u6001\u5e93\u4f4d\u7f6e <p>\u8fd0\u884c\u5f02\u5e38\u65f6\u65e5\u5fd7\uff1a</p> <p>INFO util.NativeCodeLoader - Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</p>"},{"location":"data_system/file_system/hdfs/native_libraries.html#_4","title":"\u68c0\u67e5","text":"<p>NativeLibraryChecker\u662f\u4e00\u4e2a\u68c0\u67e5\u672c\u5730\u5e93\u662f\u5426\u6b63\u786e\u52a0\u8f7d\u7684\u5de5\u5177</p> <pre><code> $ hadoop checknative -a\n   14/12/06 01:30:45 WARN bzip2.Bzip2Factory: Failed to load/initialize native-bzip2 library system-native, will use pure-Java version\n   14/12/06 01:30:45 INFO zlib.ZlibFactory: Successfully loaded &amp; initialized native-zlib library\n   Native library checking:\n   hadoop: true /home/ozawa/hadoop/lib/native/libhadoop.so.1.0.0\n   zlib:   true /lib/x86_64-linux-gnu/libz.so.1\n   snappy: true /usr/lib/libsnappy.so.1\n   zstd: true /usr/lib/libzstd.so.1\n   lz4:    true revision:99\n   bzip2:  false\n</code></pre>"},{"location":"data_system/file_system/hdfs/native_libraries.html#_5","title":"\u672c\u5730\u5171\u4eab\u5e93","text":"<p>\u4f7f\u7528 DistributedCache \u5206\u53d1\u548c\u94fe\u63a5\u5e93\u6587\u4ef6\uff1a</p> <ol> <li> <p>\u5c06\u5e93\u62f7\u8d1d\u5230HDFS\uff1b <code>bin/hadoop fs -copyFromLocal mylib.so.1 /libraries/mylib.so.1</code></p> </li> <li> <p>job\u542f\u52a8\u7a0b\u5e8f\u5e94\u8be5\u5305\u542b\uff1a</p> </li> </ol> <pre><code>DistributedCache.createSymlink(conf); \nDistributedCache.addCacheFile(\"hdfs://host:port/libraries/mylib.so. 1#mylib.so\", conf);\n</code></pre> <ol> <li>MapReduce\u4efb\u52a1\u53ef\u4ee5\u4f7f\u7528\uff1a<code>System.loadLibrary(\"mylib.so\");</code></li> </ol>"},{"location":"data_system/file_system/hdfs/native_libraries.html#libhdfs-bug","title":"libHDFS BUG","text":"<p>\u5f53\u5728Java\u4e2d\u901a\u8fc7JNI\u8c03\u7528libhdfs\u8bbf\u95eehdfs\u65f6\uff0c\u51fa\u73b0 Java -&gt; C++ -&gt; Java \u7684\u8c03\u7528\u6808\uff0clibhdfs\u5728C++ pthread\u7ebf\u7a0b\u9500\u6bc1\u65f6\u6ce8\u518c\u4e86JNIEnv\u7684DetachCurrentThread\uff0c\u4f46\u662f\u4f1a\u5728\u6574\u4e2aJava\u8fdb\u7a0b\u8fd0\u884c\u7ed3\u675f\u540eJVM\u5f02\u5e38\u9000\u51fa\uff08hs_err\u6587\u4ef6\uff09\uff0c\u5177\u4f53\u53ef\u89c1 JNI\u7684\"Java\u8c03\u7528C++\u518d\u8c03\u7528Java\"\u3002</p> <ul> <li>\u4f46\u662f\u5f53\u8c03\u7528 libhdfs\u7684Java\u662fnew Thread\u65f6\uff0c\u4e0d\u4f1a\u9020\u6210JVM\u5f02\u5e38\u9000\u51fa\uff1b</li> <li>scala \u8981\u91c7\u7528 <code>new Thread ()</code>\u7684\u5f62\u5f0f\uff0c\u800c\u4e0d\u80fd\u662f<code>new Thread {}</code>\u7684\u5f62\u5f0f\uff08JVM\u4ecd\u4f1aCrash\uff09\uff1b</li> </ul>"},{"location":"data_system/file_system/hdfs/native_libraries.html#_6","title":"\u4f7f\u7528","text":"<p>\u7f16\u8bd1cpp\u6587\u4ef6\u547d\u4ee4</p> <pre><code>$ g++ -shared -fPIC -I${HADOOP_HOME}/include -L${HADOOP_HOME}/lib/native -lhdfs -L${JDK_HOME}/jre/lib/amd64/server -ljvm  -I ${JDK_HOME}/include/ -I ${JDK_HOME}/include/linux/ jni.cpp -o libjni.so\n</code></pre> <p>\u8fd0\u884c\u65f6\u9700\u8981\u5982\u4e0b\u7684\u76f8\u5173\u53d8\u91cf\u548c\u53c2\u6570\uff1a</p> <pre><code>export HADOOP_PREFIX=/home/experiment/workspace/hadoop/\nexport HADOOP_HOME=$HADOOP_PREFIX\nexport CLASSPATH=$($HADOOP_PREFIX/bin/hadoop classpath --glob)\nexport LD_LIBRARY_PATH=/home/experiment/workspace/hadoop/lib/native:/home/common/jdk/jre/lib/amd64/server\nexport LD_LIBRARY_PATH=/home/experiment/workspace/hadoop/lib/native:/home/common/jdk/jre/lib/amd64/server:.\n</code></pre>"},{"location":"data_system/file_system/hdfs/permissions.html","title":"Permissions","text":"<p>[toc]</p>"},{"location":"data_system/file_system/hdfs/permissions.html#hdfs","title":"HDFS \u6743\u9650","text":"<p>HDFS\u7684\u6743\u9650\u6a21\u578b\u7c7b\u4f3cPOSIX\u6a21\u578b\uff0c\u6587\u4ef6/\u76ee\u5f55\u548c\u7528\u6237\u53ca\u7528\u6237\u7ec4\u5173\u8054\uff0c\u5bf9\u6240\u5c5e\u7528\u6237\uff0c\u7528\u6237\u7ec4\u7684\u4e0d\u540c\u7528\u6237\uff0c\u5176\u5b83\u7528\u6237\u662f\u5206\u5f00\u7684\u6743\u9650\u3002</p> <ul> <li>\u6587\u4ef6\uff0c<code>r</code>\uff0c<code>w</code></li> <li>\u76ee\u5f55\uff0c<code>r</code>\uff08\u5217\u51fa\u76ee\u5f55\u4e0b\u7684\u5185\u5bb9\uff09\uff0c <code>w</code>\uff08\u521b\u5efa\u548c\u5220\u9664\u6587\u4ef6/\u76ee\u5f55\uff09\uff0c<code>x</code>\uff08\u8bbf\u95ee\u76ee\u5f55\u7684\u5b50\u7ea7\uff09</li> </ul> <p>\u6ca1\u6709setuid\u548csetgid\uff0c\u56e0\u4e3a\u6ca1\u6709\u53ef\u6267\u884c\u6587\u4ef6\u7684\u6982\u5ff5\u3002\u5bf9\u4e8e\u76ee\u5f55\uff0c\u6ca1\u6709setuid\u6216setgid bits\u76ee\u5f55\u4f5c\u4e3a\u7b80\u5316</p> <p>\u53ef\u4ee5\u5728\u76ee\u5f55\u4e0a\u8bbe\u7f6e\u7c98\u6ede\u4f4d\uff0c\u9632\u6b62\u9664\u8d85\u7ea7\u7528\u6237\u3001\u76ee\u5f55\u6240\u6709\u8005\u6216\u6587\u4ef6\u6240\u6709\u8005\u4e4b\u5916\u7684\u4efb\u4f55\u4eba\u5220\u9664\u6216\u79fb\u52a8\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u3002\u4e3a\u6587\u4ef6\u8bbe\u7f6e\u7c98\u6ede\u4f4d\u65e0\u6548\u3002</p> <p>\u521b\u5efa\u6587\u4ef6\u6216\u76ee\u5f55\u65f6\uff0c\u5176\u6240\u6709\u8005\u662f\u5ba2\u6237\u7aef\u8fdb\u7a0b\u7684\u7528\u6237\u6807\u8bc6\uff0c\u5176\u7ec4\u662f\u7236\u76ee\u5f55\u7684\u7ec4\uff08BSD\u89c4\u5219\uff09</p> <p>HDFS\u8fd8\u63d0\u4f9b\u4e86\u5bf9POSIX acl\uff08\u8bbf\u95ee\u63a7\u5236\u5217\u8868\uff09\u7684\u53ef\u9009\u652f\u6301\uff0c\u4ee5\u4f7f\u7528\u9488\u5bf9\u7279\u5b9a\u547d\u540d\u7528\u6237\u6216\u547d\u540d\u7ec4\u7684\u66f4\u7ec6\u7c92\u5ea6\u89c4\u5219\u6269\u5c55\u6587\u4ef6\u6743\u9650\u3002</p> <p>\u8bbf\u95eeHDFS\u7684\u6bcf\u4e2a\u5ba2\u6237\u7aef\u8fdb\u7a0b\u90fd\u6709\u4e00\u4e2a\u7531\u7528\u6237\u540d\u548c\u7ec4\u5217\u8868\u7ec4\u6210\u7684\u4e24\u90e8\u5206\u6807\u8bc6\uff0c\u8bbf\u95ee\u76ee\u5f55/\u6587\u4ef6\u65f6\u4f1a\u8fdb\u884c\u6743\u9650\u68c0\u67e5\u3002</p>"},{"location":"data_system/file_system/hdfs/permissions.html#_1","title":"\u7528\u6237\u6807\u8bc6","text":"<p><code>hadoop.security.authentication</code></p> <ul> <li>simple\uff1a\u9ed8\u8ba4\uff0c\u5ba2\u6237\u7aef\u8fdb\u7a0b\u7684\u6807\u8bc6\u7531\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u786e\u5b9a\u3002\u5728\u7c7bUnix\u7cfb\u7edf\u4e2d\uff0c\u7528\u6237\u540d\u76f8\u5f53\u4e8e\u201cwhoami\u201d\u3002</li> <li>kerboers\uff1a\u5ba2\u6237\u7aef\u8fdb\u7a0b\u7684\u6807\u8bc6\u7531\u5176Kerberos\u51ed\u636e\u786e\u5b9a\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528kinit\u5b9e\u7528\u7a0b\u5e8f\u83b7\u53d6Kerberos\u7968\u8bc1\u6388\u4e88\u7968\u8bc1\uff08TGT\uff09\uff0c\u5e76\u4f7f\u7528klist\u786e\u5b9a\u5176\u5f53\u524d\u4e3b\u4f53\u3002</li> </ul>"},{"location":"data_system/file_system/hdfs/permissions.html#_2","title":"\u7528\u6237\u7ec4\u6620\u5c04","text":"<p>\u4e00\u65e6\u6309\u4e0a\u8ff0\u65b9\u5f0f\u786e\u5b9a\u7528\u6237\u540d\uff0c\u7ec4\u5217\u8868\u5c06\u7531\u7ec4\u6620\u5c04\u670d\u52a1\uff08<code>hadoop.security.group.mapping</code>\uff09\u786e\u5b9a</p> <p>\u9ed8\u8ba4\uff1a<code>org.apache.hadoop.security.JniBasedUnixGroupsMappingWithFallback</code></p> <ul> <li>\u7528\u4e8eACL\u7684\u7528\u6237\u5230\u7ec4\u6620\u5c04\uff08\u83b7\u53d6\u7ed9\u5b9a\u7528\u6237\u7684\u7ec4\uff09\u7684\u7c7b\uff1b</li> <li>JNI\u53ef\u7528\uff0c\u5219\u5b9e\u73b0\u5c06\u4f7f\u7528hadoop\u4e2d\u7684API\u6765\u89e3\u6790\u7528\u6237\u7684\u7ec4\u5217\u8868\u3002\u5982\u679cJNI\u4e0d\u53ef\u7528\uff0c\u5219\u4f7f\u7528shell\u5b9e\u73b0\uff08<code>bash -c groups $user</code>\uff1b</li> </ul>"},{"location":"data_system/file_system/hdfs/permissions.html#_3","title":"\u6743\u9650\u68c0\u67e5","text":"<p>Path\u7ec4\u6210</p> <ul> <li>Ownership\uff1a\u662f\u5426\u68c0\u67e5\u8c03\u7528\u8005\u662f\u8def\u5f84\u7684\u6240\u6709\u8005\uff0c\u5f53\u6539\u53d8ownership\u548cpermission\u5143\u6570\u636e\u9700\u8981\uff1b</li> <li>Parent\uff1a\u8bf7\u6c42\u8def\u5f84\u7684\u7236\u7ea7\u76ee\u5f55\uff0c\u8def\u5f84<code>/foo/bar/baz</code>\u7684\u7236\u8def\u5f84\u662f<code>/foo/bar</code></li> <li>Ancestor\uff1a\u8bf7\u6c42\u8def\u5f84\u6700\u540e\u5b58\u5728\u7684\u90e8\u5206\uff0c\u5bf9<code>/foo/bar/baz</code>\uff0cancestor\u662f<code>/foo/bar</code>\u5982\u679c\u5b58\u5728\uff0c\u662f<code>/foo</code>\u5982\u679c<code>/foo/bar</code>\u4e0d\u5b58\u5728\u4f46<code>/foo</code>\u5b58\u5728\uff1b</li> <li>Final\uff1a\u8bf7\u6c42\u8def\u5f84\u7684\u6700\u540e\u90e8\u5206\uff0c\u8def\u5f84<code>/foo/bar/baz</code>\u7684final\u8def\u5f84\u90e8\u5206\u662f<code>/foo/bar/baz</code>\uff1b</li> <li>Sub-tree\uff1a\u5982\u679cPath\u662f\u76ee\u5f55\uff0c\u5219sub-tree\u90e8\u5206\u662f\u8be5\u76ee\u5f55\u672c\u8eab\u548c\u5b83\u9012\u5f52\u7684\u6240\u6709\u5b50\u76ee\u5f55\uff1b</li> </ul> <p>\u6743\u9650\u68c0\u67e5\u8868\u5982\u4e0b\uff1a</p> Operation Ownership Parent Ancestor Final Sub-tree append NO N/A N/A WRITE N/A concat NO [2] WRITE (sources) N/A READ (sources), WRITE (destination) N/A create NO N/A WRITE WRITE [1] N/A createSnapshot YES N/A N/A N/A N/A delete NO [2] WRITE N/A N/A READ, WRITE, EXECUTE deleteSnapshot YES N/A N/A N/A N/A getAclStatus NO N/A N/A N/A N/A getBlockLocations NO N/A N/A READ N/A getContentSummary NO N/A N/A N/A READ, EXECUTE getFileInfo NO N/A N/A N/A N/A getFileLinkInfo NO N/A N/A N/A N/A getLinkTarget NO N/A N/A N/A N/A getListing NO N/A N/A READ, EXECUTE N/A getSnapshotDiffReport NO N/A N/A READ READ getStoragePolicy NO N/A N/A READ N/A getXAttrs NO N/A N/A READ N/A listXAttrs NO EXECUTE N/A N/A N/A mkdirs NO N/A WRITE N/A N/A modifyAclEntries YES N/A N/A N/A N/A removeAcl YES N/A N/A N/A N/A removeAclEntries YES N/A N/A N/A N/A removeDefaultAcl YES N/A N/A N/A N/A removeXAttr NO [2] N/A N/A WRITE N/A rename NO [2] WRITE (source) WRITE (destination) N/A N/A renameSnapshot YES N/A N/A N/A N/A setAcl YES N/A N/A N/A N/A setOwner YES [3] N/A N/A N/A N/A setPermission YES N/A N/A N/A N/A setReplication NO N/A N/A WRITE N/A setStoragePolicy NO N/A N/A WRITE N/A setTimes NO N/A N/A WRITE N/A setXAttr NO [2] N/A N/A WRITE N/A truncate NO N/A N/A WRITE N/A <p>[1] \u4ec5\u5f53\u8c03\u7528\u4f7f\u7528overwrite\u9009\u9879\u4e14\u8def\u5f84\u5904\u5b58\u5728\u73b0\u6709\u6587\u4ef6\u65f6\uff0c\u624d\u9700\u8981\u5728\u521b\u5efa\u671f\u95f4\u5bf9final path\u7ec4\u4ef6\u8fdb\u884c\u5199\u8bbf\u95ee\uff1b</p> <p>[2] \u5982\u679c\u8bbe\u7f6e\u4e86\u7c98\u6ede\u4f4d\uff0c\u5219\u68c0\u67e5\u7236\u76ee\u5f55\u4e0a\u5199\u6743\u9650\u7684\u4efb\u4f55\u64cd\u4f5c\u4e5f\u4f1a\u68c0\u67e5\u6240\u6709\u6743\u3002</p> <p>[3] \u8c03\u7528setOwner\u66f4\u6539\u62e5\u6709\u6587\u4ef6\u7684\u7528\u6237\u9700\u8981HDFS\u8d85\u7ea7\u7528\u6237\u8bbf\u95ee\u6743\u9650\u3002\u66f4\u6539\u7ec4\u4e0d\u9700\u8981HDFS\u8d85\u7ea7\u7528\u6237\u8bbf\u95ee\u6743\u9650\uff0c\u4f46\u8c03\u7528\u65b9\u5fc5\u987b\u662f\u6587\u4ef6\u7684\u6240\u6709\u8005\u548c\u6307\u5b9a\u7ec4\u7684\u6210\u5458\u3002</p> <p>\u5b9e\u73b0\u6ce8\u610f\u4e8b\u9879</p> <ul> <li> <p>\u6bcf\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55\u64cd\u4f5c\u90fd\u5c06\u5b8c\u6574\u8def\u5f84\u540d\u4f20\u9012\u7ed9NameNode\uff0c\u5e76\u4e14\u6743\u9650\u68c0\u67e5\u5c06\u6cbf\u7740\u6bcf\u4e2a\u64cd\u4f5c\u7684\u8def\u5f84\u5e94\u7528\uff1b</p> </li> <li> <p>\u5ba2\u6237\u7aef\u6846\u67b6\u5c06\u9690\u5f0f\u5730\u5c06\u7528\u6237\u6807\u8bc6\u4e0e\u5230NameNode\u7684\u8fde\u63a5\u5173\u8054\u8d77\u6765\uff0c\u4ece\u800c\u51cf\u5c11\u5bf9\u73b0\u6709\u5ba2\u6237\u7aefAPI\u7684\u66f4\u6539\uff1b</p> </li> <li>\u5220\u9664\u6587\u4ef6\u4e0d\u4f1a\u64a4\u6d88\u5df2\u7ecf\u77e5\u9053\u6587\u4ef6\u5757\u7684\u5ba2\u6237\u7aef\u7684\u8bbf\u95ee\uff1b</li> <li>\u968f\u7740\u6743\u9650\u7684\u589e\u52a0\uff0c\u5ba2\u6237\u7aef\u5bf9\u6587\u4ef6\u7684\u8bbf\u95ee\u53ef\u80fd\u5728\u8bf7\u6c42\u4e4b\u95f4\u88ab\u64a4\u6d88\uff1b</li> <li>\u66f4\u6539\u6743\u9650\u4e0d\u4f1a\u64a4\u6d88\u5df2\u7ecf\u77e5\u9053\u6587\u4ef6\u5757\u7684\u5ba2\u6237\u7aef\u7684\u8bbf\u95ee\u3002</li> </ul>"},{"location":"data_system/file_system/hdfs/permissions.html#_4","title":"\u8d85\u7ea7\u7528\u6237","text":"<p>\u8d85\u7ea7\u7528\u6237\u662f\u4e0eNameNode\u8fdb\u7a0b\u672c\u8eab\u5177\u6709\u76f8\u540c\u6807\u8bc6\u7684\u7528\u6237\u3002</p> <p>\u7ba1\u7406\u5458\u53ef\u4ee5\u4f7f\u7528\u914d\u7f6e\u53c2\u6570\u6807\u8bc6\u53ef\u5206\u8fa8\u7ec4\u3002\u5982\u679c\u5df2\u8bbe\u7f6e\uff0c\u5219\u6b64\u7ec4\u7684\u6210\u5458\u4e5f\u662f\u8d85\u7ea7\u7528\u6237\uff1b</p>"},{"location":"data_system/file_system/hdfs/permissions.html#acls-access-control-lists","title":"ACLs (Access Control Lists)","text":"<p>ACL\u7684\u89e3\u91ca\u8bf4\u660e\u89c1 linux/acls.md  </p> <p>\u6700\u4f73\u5b9e\u8df5\u662f\u4f9d\u8d56\u4f20\u7edf\u7684\u6743\u9650\u4f4d\u6765\u5b9e\u73b0\u5927\u591a\u6570\u6743\u9650\u9700\u6c42\uff0c\u5e76\u5b9a\u4e49\u5c11\u91cf\u7684acl\u4ee5\u4f7f\u7528\u4e00\u4e9b\u7279\u6b8a\u89c4\u5219\u6765\u6269\u5145\u6743\u9650\u4f4d\uff0c\u51cf\u5c11NameNode\u589e\u52a0\u7684\u5185\u5b58\u5f00\u9500\u3002</p>"},{"location":"data_system/file_system/hdfs/permissions.html#_5","title":"\u914d\u7f6e\u53c2\u6570","text":"<ul> <li><code>dfs.permissions.enabled</code>\uff1a\u9ed8\u8ba4 true</li> </ul> <p>false\u5219\u5173\u95ed\u6743\u9650\u68c0\u67e5\uff0c\u4f46\u6240\u6709\u5176\u4ed6\u884c\u4e3a\u90fd\u4fdd\u6301\u4e0d\u53d8\uff0c\u4e0d\u4f1a\u66f4\u6539\u6587\u4ef6\u6216\u76ee\u5f55\u7684\u6a21\u5f0f\u3001\u6240\u6709\u8005\u6216\u7ec4\u3002</p> <p>\u65e0\u8bba\u6743\u9650\u662f\u6253\u5f00\u8fd8\u662f\u5173\u95ed\uff0cchmod\u3001chgrp\u3001chown\u548csetfacl\u603b\u662f\u68c0\u67e5\u6743\u9650\u3002</p> <ul> <li><code>hadoop.http.staticuser.user(dfs.web.ugi)</code>\uff1a\u9ed8\u8ba4 None\uff0c\u53ef\u8bbe\u7f6e\u5982 webuser,webgroup</li> </ul> <p>web\u670d\u52a1\u5668\u8981\u4f7f\u7528\u7684\u7528\u6237\u540d\u3002\u5c06\u6b64\u8bbe\u7f6e\u4e3a\u8d85\u7ea7\u7528\u6237\u7684\u540d\u79f0\u5c06\u5141\u8bb8\u4efb\u4f55web\u5ba2\u6237\u7aef\u67e5\u770b\u6240\u6709\u5185\u5bb9\u3002</p> <p>\u5c06\u6b64\u66f4\u6539\u4e3a\u5176\u4ed6\u672a\u4f7f\u7528\u7684\u7528\u6237\u6807\u8bc6\u5141\u8bb8web\u5ba2\u6237\u7aef\u4ec5\u4f7f\u7528\u201cother\u201d\u6743\u9650\u67e5\u770b\u53ef\u89c1\u7684\u5185\u5bb9\u3002\u53ef\u4ee5\u5c06\u5176\u4ed6\u7ec4\u6dfb\u52a0\u5230\u9017\u53f7\u5206\u9694\u7684\u5217\u8868\u4e2d\u3002</p> <ul> <li><code>dfs.permissions.superusergroup</code>\uff1a\u9ed8\u8ba4 supergroup</li> </ul> <p>super-users\u7684\u7ec4\u540d\u3002</p> <ul> <li><code>fs.permissions.umask-mode</code>\uff1a\u9ed8\u8ba4 022</li> </ul> <p>\u521b\u5efa\u6587\u4ef6\u548c\u76ee\u5f55\u65f6\u4f7f\u7528\u7684umask\uff0c\u5bf9\u4e8e\u76ee\u5f55\u662f755\uff0c\u5bf9\u4e8e\u6587\u4ef6\u662f644\u3002</p> <ul> <li><code>dfs.cluster.administrators</code>\uff1a\u9ed8\u8ba4None\uff0c\u8bbe\u7f6e\u7528\u6237\u6216\u7ec4\uff0c\u5982 user1,user2 group1,group2</li> </ul> <p>\u6307\u5b9a\u4e3aACL\u7684\u7fa4\u96c6\u7684\u7ba1\u7406\u5458\uff0c\u7a7a\u683c\u7528\u6765\u5206\u5272\u7528\u6237\u5217\u8868\u548c\u7ec4\u5217\u8868\uff0c\u652f\u6301\u901a\u914d\u7b26*</p> <ul> <li><code>dfs.namenode.acls.enabled</code>\uff1a\u9ed8\u8ba4false</li> </ul> <p>\u5f53ACLs\u7981\u7528\u65f6\uff0cNameNode\u4f1a\u62d2\u7edd\u8bbe\u7f6eACL\u3002</p>"},{"location":"data_system/file_system/hdfs/provided_storage.html","title":"Provided storage","text":"<p>[toc]</p>"},{"location":"data_system/file_system/hdfs/provided_storage.html#hdfsexperimental","title":"HDFS\u63d0\u4f9b\u5f0f\u5b58\u50a8\uff08experimental \uff09","text":"<p>\u901a\u8fc7HDFS\u80fd\u591f\u5b9a\u4f4d\u5230\u6570\u636e\u7684\u5916\u90e8\u5b58\u50a8\u3002</p> <p>\u5728\u73b0\u6709\u9636\u6bb5\uff0c\u8fd9\u4e2a\u5916\u90e8\u5b58\u50a8\u53ea\u652f\u6301\u8bfb\u53d6\u64cd\u4f5c\uff0c\u6682\u4e0d\u652f\u6301\u5916\u90e8\u5b58\u50a8\u7684\u5199\u3002</p> <p>\u5728\u63d0\u4f9b\u5f0f\u5b58\u50a8\u7684\u5b9e\u73b0\u4e2d\uff0c\u4e3a\u4e86\u4fdd\u6301\u672c\u8eabHDFS\u5185\u90e8\u6587\u4ef6\u8bfb\u53d6\u64cd\u4f5c\u7684\u903b\u8f91\u4e0e\u517c\u5bb9\u6027\u8981\u6c42\uff0c\u9700\u8981\u505a\u5230\u4ee5\u4e0b\u4e24\u70b9\uff1a</p> <ul> <li>\u8fdc\u7a0b\u6587\u4ef6\u7cfb\u7edf\uff08\u5916\u90e8\u5b58\u50a8\uff09\u9700\u8981\u5b9e\u73b0Hadoop\u5185\u90e8FileSystem\u63a5\u53e3\u3002</li> <li>\u63d0\u4f9b\u5f0f\u5b58\u50a8\u4ee5\u65b0\u7684Storage Type\uff1aPROVIDED\u7c7b\u578b\u88abDN\uff0cNN\u6240\u533a\u522b\u3002\u5c31\u662f\u8bf4\uff0c\u5f53\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684\u6570\u636e\u5728PROVIDED\u7c7b\u578b\u7684\u76ee\u5f55\u4e0b\u65f6\uff0c\u8868\u660e\u5176\u4e0b\u7684\u6570\u636e\u6765\u81ea\u4e8e\u5916\u90e8\u5b58\u50a8\u3002</li> <li>\u5143\u6570\u636e\u7684\u6620\u5c04\uff1aHDFS Block\u6570\u636e\u5bf9\u4e8e\u8fdc\u7a0b\u6587\u4ef6\u7cfb\u7edf\u6587\u4ef6\u5143\u6570\u636e\u7684\u6620\u5c04\u3002</li> </ul>"},{"location":"data_system/file_system/hdfs/provided_storage.html#_1","title":"\u914d\u7f6e","text":"<pre><code>&lt;configuration&gt;\n\n  &lt;property&gt;\n    &lt;name&gt;dfs.namenode.provided.enabled&lt;/name&gt;\n    &lt;value&gt;true&lt;/value&gt;\n    &lt;description&gt;Enabled provided storage on the Namenode&lt;/description&gt;\n  &lt;/property&gt;\n\n  &lt;property&gt;\n     &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;\n     &lt;value&gt;[DISK]/local/path/to/blocks/, [PROVIDED]remoteFS://remoteFS-authority/path/to/data/&lt;/value&gt;\n  &lt;/property&gt;\n\n  &lt;property&gt;\n      &lt;name&gt;dfs.provided.storage.id&lt;/name&gt;\n      &lt;value&gt;DS-PROVIDED&lt;/value&gt;\n      &lt;description&gt;The storage ID used for provided storages in the cluster.&lt;/description&gt;\n  &lt;/property&gt;\n\n  &lt;property&gt;\n    &lt;name&gt;dfs.provided.aliasmap.class&lt;/name&gt;\n    &lt;value&gt;org.apache.hadoop.hdfs.server.common.blockaliasmap.impl.TextFileRegionAliasMap&lt;/value&gt;\n  &lt;/property&gt;\n\n&lt;/configuration&gt;\n</code></pre> <p>aliasmap \u76ee\u524d\u53ea\u652f\u6301:</p> <ul> <li>InMemoryAliasMap</li> <li>TextFileRegionAliasMap</li> </ul>"},{"location":"data_system/file_system/hdfs/quotas.html","title":"Quotas","text":"<p>[toc]</p>"},{"location":"data_system/file_system/hdfs/quotas.html#_1","title":"\u914d\u989d","text":"<p>HDFS\u5141\u8bb8\u7ba1\u7406\u5458\u8bbe\u7f6e\u7528\u4e8e\u5355\u4e2a\u76ee\u5f55\u7684\u540d\u79f0\u6570\u91cf\u548c\u7a7a\u95f4\u91cf\u7684\u914d\u989d\u3002\u540d\u79f0\u914d\u989d\u548c\u7a7a\u95f4\u914d\u989d\u72ec\u7acb\u3002</p> <p>\u914d\u989d\u4f1a\u6301\u4e45\u5316\u5728FSImage\u4e2d\uff0c\u5e76\u4e14\u8bbe\u7f6e\u4f1a\u5220\u9664\u914d\u989d\u4f1a\u521b\u5efajournal entry\u3002</p>"},{"location":"data_system/file_system/hdfs/quotas.html#_2","title":"\u540d\u79f0\u914d\u989d","text":"<p>\u540d\u79f0\u914d\u989d\u662f\u5bf9\u6839\u76ee\u5f55\u6811\u4e2d\u6587\u4ef6\u540d\u548c\u76ee\u5f55\u540d\u6570\u91cf\u7684\u786c\u9650\u5236(hard limit)\u3002</p> <p>\u76ee\u5f55\u91cd\u547d\u540d\uff0c\u5176\u914d\u989d\u4e0d\u53d8\u3002</p> <p>\u5373\u4f7f\u76ee\u5f55\u8fdd\u53cd\u65b0\u914d\u989d\uff0c\u8bbe\u7f6e\u914d\u989d\u7684\u5c1d\u8bd5\u4ecd\u5c06\u6210\u529f\u3002</p> <p>\u65b0\u521b\u5efa\u7684\u76ee\u5f55\u6ca1\u6709\u5173\u8054\u7684\u914d\u989d\u3002\u6700\u5927\u7684\u914d\u989d\u662fLong.Max\u503c\uff0c\u914d\u989d\u4e3a1\u5c06\u5f3a\u5236\u76ee\u5f55\u4fdd\u6301\u4e3a\u7a7a\u3002</p>"},{"location":"data_system/file_system/hdfs/quotas.html#_3","title":"\u7a7a\u95f4\u914d\u989d","text":"<p>\u7a7a\u95f4\u914d\u989d\u662f\u5bf9\u6839\u76ee\u5f55\u6811\u4e2d\u6587\u4ef6\u4f7f\u7528\u7684\u5b57\u8282\u6570\u7684\u786c\u9650\u5236\u3002</p> <p>\u5757\u7684\u6bcf\u4e2a\u526f\u672c\u90fd\u8ba1\u7b97\u5728\u914d\u989d\u5185\u3002</p> <p>\u76ee\u5f55\u91cd\u547d\u540d\uff0c\u5176\u914d\u989d\u4e0d\u53d8\u3002\u76ee\u5f55\u4e0d\u4f7f\u7528\u4e3b\u673a\u6587\u4ef6\u7cfb\u7edf\u7a7a\u95f4\uff0c\u4e5f\u4e0d\u8ba1\u5165\u7a7a\u95f4\u914d\u989d\u3002</p> <p>\u65b0\u521b\u5efa\u7684\u76ee\u5f55\u6ca1\u6709\u5173\u8054\u7684\u914d\u989d\u3002\u6700\u5927\u7684\u914d\u989d\u662fLong.Max\u503c\u3002\u914d\u989d\u4e3a\u96f6\u4ecd\u5141\u8bb8\u521b\u5efa\u6587\u4ef6\uff0c\u4f46\u4e0d\u80fd\u5411\u6587\u4ef6\u4e2d\u6dfb\u52a0\u5757\u3002</p> <p>\u7528\u4e8e\u4fdd\u5b58\u6587\u4ef6\u5143\u6570\u636e\u7684\u4e3b\u673a\u6587\u4ef6\u7cfb\u7edf\u7a7a\u95f4\u4e0d\u8ba1\u5165\u914d\u989d\u3002</p>"},{"location":"data_system/file_system/hdfs/quotas.html#_4","title":"\u7a7a\u95f4\u7c7b\u578b\u914d\u989d","text":"<p><code>dfs.quota.by.storage.type.enabled</code>\u9ed8\u8ba4true\u3002</p> <p>\u8981\u5728\u76ee\u5f55\u4e0a\u8bbe\u7f6e\u5b58\u50a8\u7c7b\u578b\u914d\u989d\uff0c\u5fc5\u987b\u5728\u76ee\u5f55\u4e0a\u914d\u7f6e\u5b58\u50a8\u7b56\u7565\uff0c\u4ee5\u4fbf\u6839\u636e\u5b58\u50a8\u7b56\u7565\u5c06\u6587\u4ef6\u5b58\u50a8\u5728\u4e0d\u540c\u7684\u5b58\u50a8\u7c7b\u578b\u4e2d\u3002</p> <p>\u53ef\u7528\u7684\u7c7b\u578b\u4e3a\uff1a RAM_DISK, DISK, SSD, ARCHIVE\u3002</p> <p>\u5b58\u50a8\u7c7b\u578b\u914d\u989d\u53ef\u4ee5\u4e0e\u7a7a\u95f4\u914d\u989d\u548c\u540d\u79f0\u914d\u989d\u76f8\u7ed3\u5408\uff0c\u4ee5\u6709\u6548\u5730\u7ba1\u7406\u7fa4\u96c6\u5b58\u50a8\u4f7f\u7528\u60c5\u51b5\u3002</p>"},{"location":"data_system/file_system/hdfs/quotas.html#_5","title":"\u547d\u4ee4","text":"<p>\u8bbe\u7f6e\u914d\u989d\u548c\u6e05\u9664\u914d\u989d</p> <p><code>hdfs dfsadmin -setQuota &lt;N&gt; &lt;directory&gt;...&lt;directory&gt;</code></p> <p><code>hdfs dfsadmin -clrQuota &lt;directory&gt;...&lt;directory&gt;</code></p> <p><code>hdfs dfsadmin -setSpaceQuota &lt;N&gt; &lt;directory&gt;...&lt;directory&gt;</code></p> <p><code>hdfs dfsadmin -clrSpaceQuota &lt;directory&gt;...&lt;directory&gt;</code></p> <p><code>hdfs dfsadmin -setSpaceQuota &lt;N&gt; -storageType &lt;storagetype&gt; &lt;directory&gt;...&lt;directory&gt;</code></p> <p><code>hdfs dfsadmin -clrSpaceQuota -storageType &lt;storagetype&gt; &lt;directory&gt;...&lt;directory&gt;</code></p> <p>\u914d\u989d\u62a5\u544a</p> <p><code>hadoop fs -count -q [-h] [-v] [-t [comma-separated list of storagetypes]] &lt;directory&gt;...&lt;directory&gt;</code></p> <ul> <li> <p>-q\uff1a\u663e\u793a\u6bcf\u4e2a\u76ee\u5f55\u7684\u8bbe\u7f6e\u7684\u540d\u79f0\u914d\u989d\uff0c\u5269\u4f59\u7684\u53ef\u7528\u540d\u79f0\u914d\u989d\uff0c\u8bbe\u7f6e\u7684\u7a7a\u95f4\u7684\u914d\u989d\u503c\u548c\u53ef\u7528\u7684\u7a7a\u95f4\u914d\u989d\u503c</p> </li> <li> <p>-h\uff1a\u53ef\u8bfb\u5f62\u5f0f</p> </li> <li>-v\uff1a\u663e\u793a\u6807\u9898\u884c</li> <li>-t\uff1a\u663e\u793a\u6bcf\u4e2a\u5b58\u50a8\u7c7b\u578b\u7684\u914d\u989d\u96c6\u548c\u6bcf\u4e2a\u76ee\u5f55\u7684\u5269\u4f59\u53ef\u7528\u914d\u989d\uff0c\u53ef\u4ee5\u6307\u5b9a\u663e\u793a\u7684\u7279\u5b9a\u5b58\u50a8\u7c7b\u578b\uff1b</li> </ul>"},{"location":"data_system/file_system/hdfs/rpc.html","title":"HDFS\u4e2dRPC","text":""},{"location":"data_system/file_system/hdfs/rpc.html#datanode","title":"DataNode","text":""},{"location":"data_system/file_system/hdfs/rpc.html#_1","title":"\u5fc3\u8df3","text":""},{"location":"data_system/file_system/hdfs/rpc.html#blockreport","title":"BlockReport","text":"<p>\u9ed8\u8ba4\u662f\u6bcf6\u5c0f\u65f6blockreport\u4e00\u6b21\uff0c\u5b58\u5728\u7684\u610f\u4e49\u5462\uff1f\u96c6\u7fa4\u542f\u52a8\u7684\u65f6\u5019\u4f1areport\u4e00\u6b21\uff0c\u540e\u7eed\u5bf9\u6587\u4ef6\u7684\u65b0\u589e\u3001\u5220\u9664\u76f8\u5173\u64cd\u4f5c\u9996\u5148\u662f\u5728namenode\u64cd\u4f5c\u7684\u3002\u6240\u4ee5namenode\u662f\u6709\u6700\u65b0block\u4fe1\u606f\u7684\u3002</p> <p>TODO\uff1a\u5206\u6790\u4e0b\uff0c\u8fd9\u4e48\u957f\u7684BlockReport\u3002\u3002</p>"},{"location":"data_system/file_system/hdfs/short_cut_read.html","title":"\u77ed\u8def\u8bfb","text":"<p>Short-Cut Read\uff1aclient\u548cBlock\u5728\u540c\u4e00\u8282\u70b9\u65f6\uff0c\u8df3\u8fc7DataNode\uff0c\u76f4\u63a5\u8bfb\u53d6\u672c\u5730\u6587\u4ef6\uff1b</p>"},{"location":"data_system/file_system/hdfs/short_cut_read.html#_2","title":"\u914d\u7f6e","text":"<p>short-cut \u8bfb\u53d6\u4f7f\u7528UNIX domain socket\uff0cclient\u548cDataNode\u901a\u8fc7/dev/shm\u7684\u5171\u4eab\u5185\u5b58\u6bb5\u4ea4\u6362\u4fe1\u606f\u3002</p> <p>\u524d\u63d0\uff1a\u5f00\u542f libhadoop.so\uff0c\u89c1\u672c\u5730\u5e93\uff1b</p> <pre><code>&lt;!--\u793a\u4f8b\u914d\u7f6e--&gt;\n&lt;configuration&gt;\n  &lt;property&gt;\n    &lt;name&gt;dfs.client.read.shortcircuit&lt;/name&gt;\n    &lt;value&gt;true&lt;/value&gt;\n  &lt;/property&gt;\n  &lt;property&gt;\n    &lt;name&gt;dfs.domain.socket.path&lt;/name&gt;\n    &lt;value&gt;/var/lib/hadoop-hdfs/dn_socket&lt;/value&gt;\n  &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre>"},{"location":"data_system/file_system/hdfs/short_cut_read.html#_3","title":"\u5b9e\u73b0","text":"<p>\u5171\u4eab\u5185\u5b58\u53ef\u4ee5\u901a\u8fc7POSIX\u63d0\u4f9b\u7684mmap\u63a5\u53e3\u5b9e\u73b0\u5c06\u6587\u4ef6\u6620\u5c04\u5230\u5185\u5b58\uff0c\u5e76\u4e14\u6620\u5c04\u6570\u636e\u662f\u5b9e\u65f6\u540c\u6b65\u3002</p> <p>TODO\uff1a\u5177\u4f53\u7684\u6d41\u7a0b\u5206\u6790</p> <p>https://blog.csdn.net/b6ecl1k7bs8o/article/details/90981844</p>"},{"location":"data_system/file_system/hdfs/storage_policy.html","title":"Storage policy","text":"<p>[toc]</p>"},{"location":"data_system/file_system/hdfs/storage_policy.html#_1","title":"\u5b58\u50a8\u7c7b\u578b","text":""},{"location":"data_system/file_system/hdfs/storage_policy.html#archivediskssdram_disk","title":"ARCHIVE\u3001DISK\u3001SSD\u3001RAM_DISK","text":"<p>\u5f02\u6784\u5b58\u50a8\uff0c\u652f\u6301\u7684\u5b58\u50a8\u7c7b\u578b archive, disk, ssd \u548c ram_disk\u3002</p> <p>archive\uff1a\u8868\u793a\u66f4\u5927\u7684\u5b58\u50a8\u4f46\u4f4e\u7684\u8ba1\u7b97\u80fd\u529b\uff1b</p> <p>ram_disk\uff1a\u652f\u6301\u5728\u5185\u5b58\u4e2d\u5199\u5355\u4e2a\u526f\u672c\u6587\u4ef6\u3002</p>"},{"location":"data_system/file_system/hdfs/storage_policy.html#_2","title":"\u5b58\u50a8\u7b56\u7565","text":""},{"location":"data_system/file_system/hdfs/storage_policy.html#hotwarmcoldall_ssdlazy_persistprovided","title":"Hot\u3001Warm\u3001Cold\u3001ALL_SSD\u3001Lazy_Persist\u3001Provided","text":"<p>\u5c06\u6587\u4ef6\u6839\u636e\u5b58\u50a8\u7b56\u7565\u5b58\u50a8\u4e3a\u4e0d\u540c\u7684\u5b58\u50a8\u7c7b\u578b\u3002</p> <ul> <li>Hot - for both storage and compute. The data that is popular and still being used for processing will stay in this policy. </li> <li>\u5f53\u5757\u7c7b\u578b\u4e3aHot\u65f6\uff0c\u6240\u6709\u7684\u526f\u672c\u5b58\u50a8\u4e3aDISK\uff1b</li> <li>Cold - only for storage with limited compute. The data that is no longer being used, or data that needs to be archived is moved from hot storage to cold storage. </li> <li>\u5f53\u5757\u7c7b\u578b\u4e3aHot\u65f6\uff0c\u6240\u6709\u7684\u526f\u672c\u5b58\u50a8\u4e3aArchive\uff1b</li> <li>Warm - partially hot and partially cold. </li> <li>\u5f53\u5757\u7c7b\u578b\u4e3aHot\u65f6\uff0c\u90e8\u5206\u7684\u526f\u672c\u5b58\u50a8\u4e3aDISK\uff0c\u5176\u4f59\u526f\u672c\u5b58\u50a8\u4e3aARCHIVE\uff1b</li> <li>All_SSD - \u6240\u6709\u526f\u672c\u5b58\u50a8\u4e3aSSD.</li> <li>One_SSD - \u4e00\u4e2a\u526f\u672cSSD\uff0c\u5176\u4f59\u526f\u672c\u5b58\u50a8\u4e3aSSD..</li> <li>Lazy_Persist - \u53ea\u9002\u7528\u5355\u4e2a\u526f\u672c\u7684\u60c5\u51b5\u3002\u7b2c\u4e00\u4e2a\u526f\u672c\u5b58\u50a8\u4e3aRAM_DISK\uff0c\u5176\u4f59\u526f\u672c\u61d2\u60f0\u5f0f\u6301\u4e45\u5316\u5230DISK</li> <li>Provided - \u5728HDFS\u5916\u5b58\u50a8\u6570\u636e\u3002</li> </ul> <p>\u5f53\u5b58\u50a8\u7c7b\u578b\u5bf9\u5e94\u7684\u5b58\u50a8\u7c7b\u578b\u7684\u5b58\u50a8\u6ca1\u6709\u7a7a\u95f4\u540e\uff0c\u6709fallback\u7684\u5b58\u50a8\u7c7b\u578b\u3002</p> Policy ID Policy Name Block Placement (n replicas) Fallback storages for creation Fallback storages for replication 15 Lazy_Persist RAM_DISK: 1, DISK: n-1 DISK DISK 12 All_SSD SSD: n DISK DISK 10 One_SSD SSD: 1, DISK: n-1 SSD, DISK SSD, DISK 7 Hot (default) DISK: n ARCHIVE 5 Warm DISK: 1, ARCHIVE: n-1 ARCHIVE, DISK ARCHIVE, DISK 2 Cold ARCHIVE: n 1 Provided PROVIDED: 1, DISK: n-1 PROVIDED, DISK PROVIDED, DISK"},{"location":"data_system/file_system/hdfs/storage_policy.html#_3","title":"\u914d\u7f6e","text":"<ul> <li>dfs.storage.policy.enabled </li> <li>\u662f\u5426\u5141\u8bb8\u5b58\u50a8\u7b56\u7565\uff0c\u9ed8\u8ba4\u4e3atrue\u3002</li> <li>dfs.datanode.data.dir</li> <li>\u5982   [DISK]file:///grid/dn/disk0,[SSD]file:///grid/dn/ssd0,[ARCHIVE]file:///grid/dn/archive0,[RAM_DISK]file:///grid/dn/ram0</li> </ul> <p>\u9ed8\u8ba4\u7684datanode\u5b58\u50a8\u4f4d\u7f6e\u7684\u5b58\u50a8\u7c7b\u578b\u4e3a<code>DISK</code>\u3002</p>"},{"location":"data_system/file_system/hdfs/storage_policy.html#_4","title":"\u57fa\u4e8e\u6570\u636e\u79fb\u52a8\u7684\u5b58\u50a8\u7b56\u7565","text":"<p>\u5728\u5df2\u7ecf\u5b58\u5728\u7684file/dir\u4e0a\u8bbe\u7f6e\u65b0\u7684\u5b58\u50a8\u7b56\u7565\u5c06\u6539\u53d8Namespace\u4e2d\u7684\u7b56\u7565\uff0c\u4f46\u4e0d\u4f1a\u5728\u5b58\u50a8\u4ecb\u8d28\u4e0a\u79fb\u52a8\u5757\u3002</p> <p>\u4ee5\u4e0b\u4e24\u4e2a\u9009\u9879\u5c06\u5141\u8bb8\u7528\u6237\u57fa\u4e8e\u65b0\u7684\u7b56\u7565\u96c6\u79fb\u52a8\u5757\u3002\u56e0\u6b64\uff0c\u4e00\u65e6\u7528\u6237\u66f4\u6539/\u8bbe\u7f6e\u6587\u4ef6/\u76ee\u5f55\u7684\u65b0\u7b56\u7565\uff0c\u7528\u6237\u8fd8\u5e94\u8be5\u6267\u884c\u4ee5\u4e0b\u9009\u9879\u4e4b\u4e00\uff0c\u4ee5\u5b9e\u73b0\u6240\u9700\u7684\u6570\u636e\u79fb\u52a8\u3002</p> <p>\u6ce8\u610f\uff0c\u8fd9\u4e24\u4e2a\u9009\u9879\u4e0d\u80fd\u540c\u65f6\u8fd0\u884c\u3002</p>"},{"location":"data_system/file_system/hdfs/storage_policy.html#spsstorage-policy-satisfier","title":"SPS\uff08Storage Policy Satisfier\uff09","text":"<p>\u5982\u679cSPS\u8bc6\u522b\u51fa\u67d0\u4e2a\u6587\u4ef6\u9700\u8981\u79fb\u52a8\u7684\u5757\uff0c\u5219\u4f1a\u5c06\u5757\u79fb\u52a8\u4efb\u52a1\u8c03\u5ea6\u5230datanode\u3002\u5982\u679c\u5728\u79fb\u52a8\u4e2d\u6709\u4efb\u4f55\u5931\u8d25\uff0cSPS\u5c06\u901a\u8fc7\u53d1\u9001\u65b0\u7684\u5757\u79fb\u52a8\u4efb\u52a1\u91cd\u65b0\u5c1d\u8bd5\u3002</p> <p>\u4f5c\u4e3aNameNode\u5916\u7684\u670d\u52a1\uff0c\u53ef\u4ee5\u5355\u72ec\u542f\u52a8\u548c\u505c\u6b62\u3002 Storage Policy Satisfier(SPS) (HDFS-10285)</p> <pre><code>// HdfsAdmin API : \u6240\u6709\u7684\u5b50\u76ee\u5f55\npublic void satisfyStoragePolicy(final Path path)\n</code></pre> <ul> <li>dfs.storage.policy.satisfier.mode </li> <li><code>external</code>\u6216\u8005<code>none</code>\uff0c\u9ed8\u8ba4<code>none</code>\uff0c\u4e0d\u5f00\u542fSPS\uff1b</li> <li>dfs.storage.policy.satisfier.recheck.timeout.millis</li> <li>\u91cd\u65b0\u68c0\u67e5\u5904\u7406\u540e\u7684\u5757\u5b58\u50a8\u79fb\u52a8\u547d\u4ee4\u7ed3\u679c\u7684\u8d85\u65f6\u65f6\u95f4\u3002</li> <li>dfs.storage.policy.satisfier.self.retry.timeout.millis </li> <li>\u5982\u679c\u5728\u6b64\u914d\u7f6e\u8d85\u65f6\u5185\u6ca1\u6709\u4eceDatanode\u62a5\u544a\u5757\u79fb\u52a8\u7ed3\u679c\uff0c\u5219\u8fdb\u884c\u91cd\u8bd5\u3002</li> </ul>"},{"location":"data_system/file_system/hdfs/storage_policy.html#mover","title":"Mover\uff08\u6570\u636e\u8fc1\u79fb\u5de5\u5177\uff09","text":"<pre><code>hdfs mover [-p &lt;files/dirs&gt; | -f &lt;local file name&gt;]\n</code></pre> <p>\u5bf9\u4e8e\u8fdd\u53cd\u5b58\u50a8\u7b56\u7565\u7684\u5757\uff0c\u5b83\u5c06\u526f\u672c\u79fb\u52a8\u5230\u4e0d\u540c\u7684\u5b58\u50a8\u7c7b\u578b\uff0c\u4ee5\u6ee1\u8db3\u5b58\u50a8\u7b56\u7565\u7684\u8981\u6c42\u3002</p> <p>\u53ea\u8981\u53ef\u80fd\uff0c\u5b83\u603b\u662f\u5c1d\u8bd5\u5728\u540c\u4e00\u8282\u70b9\u5185\u79fb\u52a8\u5757\u526f\u672c\u3002\u5982\u679c\u8fd9\u662f\u4e0d\u53ef\u80fd\u7684(\u4f8b\u5982\uff0c\u5f53\u4e00\u4e2a\u8282\u70b9\u6ca1\u6709\u76ee\u6807\u5b58\u50a8\u7c7b\u578b\u65f6)\uff0c\u5b83\u5c06\u590d\u5236\u5757\u526f\u672c\u5230\u7f51\u7edc\u4e0a\u7684\u53e6\u4e00\u4e2a\u8282\u70b9\u3002</p>"},{"location":"data_system/file_system/hdfs/storage_policy.html#_5","title":"\u547d\u4ee4","text":"<pre><code>hdfs storagepolicies -listPolicies\nhdfs storagepolicies -setStoragePolicy -path &lt;path&gt; -policy &lt;policy&gt;\nhdfs storagepolicies -unsetStoragePolicy -path &lt;path&gt;\nhdfs storagepolicies -getStoragePolicy -path &lt;path&gt;\n# Schedule blocks to move based on file\u2019s/directory\u2019s current storage policy.\nhdfs storagepolicies -satisfyStoragePolicy -path &lt;path&gt;\n\n# \u5141\u8bb8SPS\u670d\u52a1\nhdfs dfsadmin -reconfig namenode host:ipc_port start\n# \u542f\u52a8SPS\u670d\u52a1\nhdfs \u2013daemon start sps\n</code></pre>"},{"location":"data_system/file_system/juicefs/cache.html","title":"\u7f13\u5b58","text":"<p>\u63d0\u9ad8\u6027\u80fd\uff0cJuiceFS \u5b9e\u73b0\u4e86\u591a\u79cd\u7f13\u5b58\u673a\u5236\u6765\u964d\u4f4e\u8bbf\u95ee\u7684\u65f6\u5ef6\u548c\u63d0\u9ad8\u541e\u5410\u91cf\uff0c\u5305\u62ec\u5143\u6570\u636e\u7f13\u5b58\u3001\u6570\u636e\u7f13\u5b58\uff0c\u4ee5\u53ca\u591a\u4e2a\u5ba2\u6237\u7aef\u4e4b\u95f4\u7684\u7f13\u5b58\u5171\u4eab\u3002</p>"},{"location":"data_system/file_system/juicefs/cache.html#_2","title":"\u5143\u6570\u636e\u7f13\u5b58","text":"<p>\u5728\u5185\u6838\u548c\u5ba2\u6237\u7aef\u5185\u5b58\u4e2d\u7f13\u5b58\u5143\u6570\u636e\u4ee5\u63d0\u5347\u5143\u6570\u636e\u7684\u8bbf\u95ee\u6027\u80fd\u3002</p>"},{"location":"data_system/file_system/juicefs/cache.html#_3","title":"\u5185\u6838\u5143\u6570\u636e\u7f13\u5b58","text":"<p>\u5185\u6838\u4e2d\u53ef\u4ee5\u7f13\u5b58\u4e09\u79cd\u5143\u6570\u636e\uff1a\u5c5e\u6027\uff08attribute)\u3001\u6587\u4ef6\u9879\uff08entry\uff09\u548c\u76ee\u5f55\u9879\uff08direntry\uff09</p> <pre><code># \u5c5e\u6027\u7f13\u5b58\u65f6\u95f4\uff0c\u9ed8\u8ba4 1 \u79d2\n--attrcacheto=ATTRCACHETO\n# \u6587\u4ef6\u9879\u7f13\u5b58\u65f6\u95f4\uff0c\u9ed8\u8ba4 1\u79d2\n--entrycacheto=ENTRYCACHETO\n# \u76ee\u5f55\u9879\u7f13\u5b58\u65f6\u95f4\uff0c\u9ed8\u8ba4 1 \u79d2              \n--direntrycacheto=DIRENTRYCACHETO              \n</code></pre> <p>\u9ed8\u8ba4\u4f1a\u7f13\u5b58\u5c5e\u6027\u3001\u6587\u4ef6\u9879\u548c\u76ee\u5f55\u9879\uff0c\u4fdd\u7559 1 \u79d2\uff0c\u4ee5\u63d0\u9ad8 lookup \u548c getattr \u7684\u6027\u80fd\u3002</p>"},{"location":"data_system/file_system/juicefs/cache.html#_4","title":"\u5ba2\u6237\u7aef\u5185\u5b58\u5143\u6570\u636e\u7f13\u5b58","text":"<p>\u51cf\u5c11\u5ba2\u6237\u7aef\u548c\u5143\u6570\u636e\u670d\u52a1\u4e4b\u95f4\u9891\u7e41\u7684\u5217\u8868\u548c\u67e5\u8be2\u64cd\u4f5c\uff0c\u53ef\u4ee5\u628a\u7ecf\u5e38\u8bbf\u95ee\u7684\u76ee\u5f55\u5b8c\u6574\u5730\u7f13\u5b58\u5728\u5ba2\u6237\u7aef\u5185\u5b58</p> <pre><code># \u5728\u5ba2\u6237\u7aef\u4e2d\u7f13\u5b58\u5143\u6570\u636e\n--metacache\n</code></pre> <p>\u88ab\u5217\u8868\u6216\u8005\u9891\u7e41\u67e5\u8be2\u7684\u76ee\u5f55\u4f1a\u88ab\u5728\u5ba2\u6237\u7aef\u5185\u5b58\u4e2d\u7f13\u5b58 5 \u5206\u949f\uff0c\u5bf9\u7f13\u5b58\u76ee\u5f55\u7684\u6240\u6709\u4fee\u6539\u90fd\u4f1a\u4f7f\u7f13\u5b58\u5931\u6548\u4ee5\u4fdd\u969c\u4e00\u81f4\u6027\u3002 lookup\u3001getattr\u3001access\u3001open \u90fd\u80fd\u6709\u6548\u5730\u4f7f\u7528\u8fd9\u4e9b\u7f13\u5b58\u6765\u63d0\u5347\u6027\u80fd\u3002</p>"},{"location":"data_system/file_system/juicefs/cache.html#_5","title":"\u4e00\u81f4\u6027\u4fdd\u8bc1","text":"<p>\u5f53\u53ea\u6709\u4e00\u4e2a\u5ba2\u6237\u7aef\u8bbf\u95ee\u65f6\uff0c\u8fd9\u4e9b\u7f13\u5b58\u7684\u5143\u6570\u636e\u80fd\u591f\u6839\u636e\u5f53\u524d\u5ba2\u6237\u7aef\u7684\u8bbf\u95ee\u64cd\u4f5c\u81ea\u52a8\u5931\u6548\uff0c\u4e0d\u4f1a\u5f71\u54cd\u6570\u636e\u4e00\u81f4\u6027\u3002</p> <p>\u5f53\u591a\u4e2a\u5ba2\u6237\u7aef\u540c\u65f6\u4f7f\u7528\u65f6\uff0c\u5185\u6838\u4e2d\u7f13\u5b58\u7684\u5143\u6570\u636e\u53ea\u80fd\u901a\u8fc7\u65f6\u95f4\u5931\u6548\uff0c\u5ba2\u6237\u7aef\u4e2d\u7f13\u5b58\u7684\u5143\u6570\u636e\u4f1a\u6839\u636e\u6240\u6709\u5ba2\u6237\u7aef\u7684\u4fee\u6539\u81ea\u52a8\u5931\u6548\uff0c\u4f46\u662f\u662f\u5f02\u6b65\u7684\uff0c \u6781\u7aef\u60c5\u51b5\u4e0b\u53ef\u80fd\u51fa\u73b0\u5728 A \u673a\u5668\u505a\u4e86\u4fee\u6539\u64cd\u4f5c\uff0c\u518d\u53bb B \u673a\u5668\u8bbf\u95ee\u65f6\uff0cB \u673a\u5668\u8fd8\u672a\u80fd\u770b\u5230\u66f4\u65b0\u7684\u60c5\u51b5\u3002</p>"},{"location":"data_system/file_system/juicefs/cache.html#_6","title":"\u6570\u636e\u7f13\u5b58","text":"<p>JuiceFS \u5bf9\u6570\u636e\u4e5f\u63d0\u4f9b\u591a\u79cd\u7f13\u5b58\u673a\u5236\u6765\u63d0\u9ad8\u6027\u80fd\uff0c\u5305\u62ec\u5185\u6838\u4e2d\u7684\u9875\u7f13\u5b58\u548c\u5ba2\u6237\u7aef\u6240\u5728\u673a\u5668\u7684\u672c\u5730\u7f13\u5b58\u3002</p>"},{"location":"data_system/file_system/juicefs/cache.html#_7","title":"\u5185\u6838\u4e2d\u6570\u636e\u7f13\u5b58","text":"<p>\u5df2\u7ecf\u8bfb\u8fc7\u7684\u6587\u4ef6\uff0c\u5185\u6838\u4f1a\u628a\u5b83\u7684\u5185\u5bb9\u81ea\u52a8\u7f13\u5b58\u4e0b\u6765\uff0c\u4e0b\u6b21\u518d\u6253\u5f00\u7684\u65f6\u5019\uff0c\u5982\u679c\u6587\u4ef6\u6ca1\u6709\u88ab\u66f4\u65b0\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ece\u5185\u6838\u4e2d\u7684\u7f13\u5b58\u8bfb\u83b7\u5f97\u6700\u597d\u7684\u6027\u80fd\u3002</p> <p>JuiceFS \u7684\u5143\u6570\u636e\u670d\u52a1\u5668\u4e2d\uff0c\u4f1a\u8ddf\u8e2a\u6240\u6709\u6700\u8fd1\u88ab\u6253\u5f00\u7684\u6587\u4ef6\uff0c\u540c\u4e00\u4e2a\u5ba2\u6237\u7aef\u8981\u518d\u6b21\u6253\u5f00\u76f8\u540c\u6587\u4ef6\u65f6\uff0c \u5b83\u4f1a\u6839\u636e\u8be5\u6587\u4ef6\u662f\u5426\u88ab\u4fee\u6539\u4e86\u544a\u8bc9\u8be5\u5ba2\u6237\u7aef\u662f\u5426\u53ef\u4ee5\u4f7f\u7528\u5185\u6838\u4e2d\u7f13\u5b58\u7684\u6570\u636e\uff0c\u4ee5\u4fdd\u8bc1\u5ba2\u6237\u7aef\u80fd\u591f\u8bfb\u5230\u6700\u65b0\u7684\u6570\u636e\u3002</p> <p>\u5f53\u524d\u7684 JuiceFS \u5ba2\u6237\u7aef\u8fd8\u672a\u542f\u7528\u5185\u6838\u7684\u5199\u5165\u7f13\u5b58\u529f\u80fd\uff0c\u6240\u6709\u6765\u81ea\u5e94\u7528\u7684\u5199\u64cd\u4f5c\uff08write\uff09\u4f1a\u76f4\u63a5\u901a\u8fc7 FUSE \u4f20\u9012\u5230\u5ba2\u6237\u7aef\u3002 \u5efa\u8bae\u5e94\u7528\u5c42\u505a\u9002\u5f53\u7684\u5199\u5165\u7f13\u5b58\u4ee5\u907f\u514d\u8fc7\u4e8e\u9891\u7e41\u7684\u5199\u64cd\u4f5c\u5f71\u54cd\u6027\u80fd\u3002</p>"},{"location":"data_system/file_system/juicefs/cache.html#_8","title":"\u5ba2\u6237\u7aef\u8bfb\u7f13\u5b58","text":"<p>\u5ba2\u6237\u7aef\u4f1a\u6839\u636e\u5e94\u7528\u8bfb\u6570\u636e\u7684\u6a21\u5f0f\uff0c\u81ea\u52a8\u505a\u9884\u8bfb\u548c\u7f13\u5b58\u64cd\u4f5c\u4ee5\u63d0\u9ad8\u987a\u5e8f\u8bfb\u7684\u6027\u80fd\u3002</p> <p>\u5ba2\u6237\u7aef\u4f1a\u628a\u6700\u8fd1\u7684\u5c11\u91cf\u6570\u636e\u7f13\u5b58\u5230\u5ba2\u6237\u7aef\u5185\u5b58\u4e2d\uff0832MB\uff09\uff0c\u540c\u65f6\u628a\u66f4\u591a\u7684\u6570\u636e\u7f13\u5b58\u5230\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u53ef\u4ee5\u662f\u57fa\u4e8e\u786c\u76d8\u3001SSD \u6216\u8005\u5185\u5b58\u7684\u4efb\u610f\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u3002 </p> <pre><code># \u7f13\u5b58\u76ee\u5f55\uff0c\u9ed8\u8ba4\u4e3a /var/jfsCache\n--cache-dir=CACHEDIR\n# \u7f13\u5b58\u7a7a\u95f4\u5927\u5c0f\uff0c\u9ed8\u8ba4\u4e3a 1GB\n--cache-size=CACHESIZE\n</code></pre> <p>JuiceFS \u5ba2\u6237\u7aef\u4f1a\u5c3d\u53ef\u80fd\u5feb\u5730\u628a\u4ece\u5bf9\u8c61\u5b58\u50a8\u4e0b\u8f7d\u7684\u6570\u636e\uff08\u5305\u62ec\u65b0\u4e0a\u4f20\u7684\u6570\u636e\uff09\u5199\u5165\u5230\u7f13\u5b58\u76ee\u5f55\u4e2d\uff0c\u4e0d\u505a\u538b\u7f29\u548c\u52a0\u5bc6\u3002</p> <p>JuiceFS \u4f1a\u4e3a\u6240\u6709\u5199\u5165\u5bf9\u8c61\u5b58\u50a8\u7684\u6570\u636e\u751f\u6210\u552f\u4e00\u7684\u540d\u5b57\uff0c\u800c\u4e14\u6240\u6709\u5bf9\u8c61\u4e0d\u4f1a\u88ab\u4fee\u6539\uff0c\u56e0\u6b64\u4e0d\u7528\u62c5\u5fc3\u7f13\u5b58\u7684\u6570\u636e\u7684\u5931\u6548\u95ee\u9898\u3002</p> <p>\u7f13\u5b58\u6e05\u7406\uff1a</p> <ul> <li>\u5728\u4f7f\u7528\u7a7a\u95f4\u5230\u8fbe\u4e0a\u9650\u65f6\uff08\u6216\u8005\u78c1\u76d8\u7a7a\u95f4\u5feb\u6ee1\u65f6\uff09\u4f1a\u81ea\u52a8\u8fdb\u884c\u6e05\u7406\uff0c\u76ee\u524d\u7684\u89c4\u5219\u662f\u6839\u636e\u5199\u5165\u65f6\u95f4\u548c\u5927\u5c0f\uff0c\u4f18\u5148\u6e05\u7406\u66f4\u5927\u548c\u66f4\u8001\u7684\u6587\u4ef6\uff1b</li> </ul>"},{"location":"data_system/file_system/juicefs/cache.html#_9","title":"\u5ba2\u6237\u7aef\u5199\u7f13\u5b58","text":"<p>\u5ba2\u6237\u7aef\u4f1a\u628a\u5e94\u7528\u5199\u7684\u6570\u636e\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u5f53\u4e00\u4e2a\u5757\u88ab\u5199\u6ee1\uff0c\u6216\u8005\u5e94\u7528\u5f3a\u5236\u5199\u5165\uff08close \u6216\u8005 fsync\uff09\uff0c\u6216\u8005\u4e00\u5b9a\u65f6\u95f4\u4e4b\u540e\u518d\u5199\u5165\u5230\u5bf9\u8c61\u5b58\u50a8\u4e2d\u3002</p> <p>\u5f53\u5e94\u7528\u8c03\u7528 fsync() \u6216\u8005 close()\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u7b49\u6570\u636e\u5199\u5165\u5230\u5bf9\u8c61\u5b58\u50a8\u5e76\u4e14\u901a\u77e5\u5143\u6570\u636e\u670d\u52a1\u540e\u624d\u8fd4\u56de\uff0c\u4ee5\u786e\u4fdd\u6570\u636e\u5b89\u5168\u3002</p> <p>\u5982\u679c\u672c\u5730\u5b58\u50a8\u662f\u53ef\u9760\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u542f\u7528\u5f02\u6b65\u4e0a\u4f20\u5230\u5bf9\u8c61\u7684\u65b9\u5f0f\u6765\u63d0\u9ad8\u6027\u80fd\uff0c\u6b64\u65f6 close() \u4e0d\u4f1a\u7b49\u5f85\u6570\u636e\u5199\u5165\u5230\u5bf9\u8c61\u5b58\u50a8\uff0c \u800c\u662f\u5199\u5165\u5230\u672c\u5730\u7f13\u5b58\u76ee\u5f55\u5c31\u8fd4\u56de\u3002</p> <pre><code># \u5c06\u5199\u6587\u4ef6\u5148\u5199\u5165\u7f13\u5b58\u518d\u5f02\u6b65\u4e0a\u4f20\uff0c\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u5b83\u4f1a\u628a\u5c0f\u6587\u4ef6\u5f02\u6b65\u4e0a\u4f20\uff0c\u800c\u5927\u6587\u4ef6\u4ecd\u7136\u662f\u540c\u6b65\u5e76\u884c\u4e0a\u4f20\n--writeback\n</code></pre>"},{"location":"data_system/file_system/juicefs/cache.html#_10","title":"\u5ba2\u6237\u7aef\u7f13\u5b58\u6570\u636e\u5171\u4eab","text":"<p>\u5f53\u540c\u4e00\u4e2a\u96c6\u7fa4\u7684\u5ba2\u6237\u7aef\u9700\u8981\u53cd\u590d\u8bbf\u95ee\u540c\u4e00\u4e2a\u6570\u636e\u96c6\u65f6\uff08\u6bd4\u5982\u673a\u5668\u5b66\u4e60\u65f6\u9700\u8981\u7528\u540c\u4e00\u4e2a\u6570\u636e\u96c6\u53cd\u590d\u8bad\u7ec3\uff09\uff0c JuiceFS \u63d0\u4f9b\u4e86\u7f13\u5b58\u5171\u4eab\u529f\u80fd\u53ef\u4ee5\u6709\u6548\u5730\u63d0\u5347\u8fd9\u4e2a\u573a\u666f\u4e0b\u7684\u6027\u80fd\u3002</p> <pre><code># \u76f8\u540c\u7ec4\u7684\u5ba2\u6237\u7aef\u4e4b\u95f4\u53ef\u4ee5\u76f8\u4e92\u5171\u4eab\u7f13\u5b58\u7684\u6570\u636e\n--cache-group=CACHEGROUP\n</code></pre> <p>\u5bf9\u4e8e\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\u5185\u6302\u8f7d\u4e86\u540c\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u5ba2\u6237\u7aef\uff0c\u5982\u679c\u4f7f\u7528\u4e86\u76f8\u540c\u7684\u7f13\u5b58\u7ec4\u540d\uff0c \u5b83\u4eec\u4f1a\u628a\u76d1\u542c\u5728\u5185\u7f51 IP \u7684\u968f\u673a\u7aef\u53e3\u6c47\u62a5\u7ed9\u5143\u6570\u636e\u670d\u52a1\u5668\uff0c\u8fdb\u800c\u53d1\u73b0\u5176\u4ed6\u7684\u5ba2\u6237\u7aef\uff0c\u5e76\u901a\u8fc7\u5185\u7f51\u901a\u4fe1\u3002</p> <p>\u5f53\u4e00\u4e2a\u5ba2\u6237\u7aef\u9700\u8981\u8bbf\u95ee\u67d0\u4e2a\u6570\u636e\u5757\u65f6\uff0c\u5b83\u4f1a\u8be2\u95ee\u67d0\u4e2a\u8d1f\u8d23\u8fd9\u4e2a\u6570\u636e\u5757\u7684\u8282\u70b9\uff0c\u4ece\u5bf9\u65b9\u7684\u7f13\u5b58\u8bfb\uff08\u6216\u8005\u4ece\u5bf9\u8c61\u5b58\u50a8\u8bfb\u5e76\u5199\u5165\u7f13\u5b58\uff09\u3002 \u8fd9\u4e9b\u76f8\u540c\u7f13\u5b58\u7ec4\u7684\u5ba2\u6237\u7aef\u7ec4\u6210\u4e86\u4e00\u4e2a\u4e00\u81f4\u6027\u54c8\u5e0c\uff08Consistent Hash\uff09\u7684\u73af\uff0c\u7c7b\u4f3c\u4e8e memcached \u7684\u7528\u6cd5\u3002 \u5728\u8fd9\u4e2a\u7ec4\u5185\u65b0\u52a0\u6216\u8005\u51cf\u5c11\u5ba2\u6237\u7aef\u65f6\uff0c\u53ea\u5f71\u54cd\u5230\u5c11\u91cf\u6570\u636e\u5757\u7684\u7f13\u5b58\u547d\u4e2d\u7387\u3002</p> <p>\u7f13\u5b58\u5171\u4eab\u529f\u80fd\u975e\u5e38\u9002\u5408\u4f7f\u7528 GPU \u96c6\u7fa4\u8fdb\u884c\u6df1\u5ea6\u5b66\u4e60\u8bad\u7ec3\u7684\u573a\u666f\uff0c\u901a\u8fc7\u628a\u8bad\u7ec3\u6570\u636e\u96c6\u7f13\u5b58\u5230\u96c6\u7fa4\u6240\u6709\u8282\u70b9\u7684\u5185\u5b58\u4e2d\uff0c \u53ef\u4ee5\u7ed9\u63d0\u4f9b\u975e\u5e38\u9ad8\u6027\u80fd\u7684\u8bbf\u95ee\uff0c\u8ba9 GPU \u4e0d\u4f1a\u56e0\u4e3a\u6570\u636e\u8bfb\u53d6\u592a\u6162\u800c\u95f2\u7f6e\u3002</p>"},{"location":"data_system/file_system/juicefs/juicefs.html","title":"JuiceFS","text":"<p>\u6e90\u7801\u5730\u5740\uff1ahttps://github.com/juicedata/juicefs\uff0cGo\u8bed\u8a00\u5f00\u53d1\u3002</p>"},{"location":"data_system/file_system/juicefs/juicefs.html#_1","title":"\u573a\u666f","text":"<p>\u6d77\u91cf\u6570\u636e\u8bbe\u8ba1\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u4f7f\u7528\u5bf9\u8c61\u5b58\u50a8\u6765\u505a\u6570\u636e\u6301\u4e45\u5316\u3002\u4e91\u7aef\u5171\u4eab\u6587\u4ef6\u7cfb\u7edf\uff0cPOSIX\u3001HDFS\u3001NFS \u517c\u5bb9\u3002</p> <p>\u4e91\u7aef\uff0c\u4e3b\u6d41\u7684\u5b58\u50a8\u662f\u5bf9\u8c61\u5b58\u50a8\uff0c\u5728\u8ba1\u7b97/\u5b58\u50a8\u5206\u79bb\u7684\u60c5\u51b5\u4e0b\uff0c\u5927\u6570\u636e\u8ba1\u7b97\u6846\u67b6\uff08MR\u3001Spark\u7b49\uff09\u9700\u8981\u8fdb\u884c\u5bf9\u8c61\u5b58\u50a8\u7684\u9002\u914d\u3002</p> <p>\u6587\u4ef6\u7cfb\u7edf\uff1a</p> <p></p> <p>JuiceFS \u5219\u662f\u628a\u8fd9\u4e9b\u6539\u8fdb\u8fdb\u4e00\u6b65\u62bd\u8c61\u548c\u4ea7\u54c1\u5316\uff0c\u8ba9\u5b83\u4eec\u80fd\u591f\u66f4\u597d\u5730\u670d\u52a1\u4e8e\u5305\u62ec\u5927\u6570\u636e\u5728\u5185\u7684\u66f4\u591a\u573a\u666f\uff0c\u5e2e\u52a9\u66f4\u591a\u7684\u516c\u53f8\u6539\u5584\u4e91\u4e0a\u5927\u6570\u636e\u4f53\u9a8c\uff0c\u800c\u4e0d\u7528\u91cd\u590d\u5730\u53bb\u89e3\u51b3 S3 \u7b49\u5bf9\u8c61\u5b58\u50a8\u5e26\u6765\u7684\u95ee\u9898\u3002</p> <ul> <li>\u5927\u6570\u636e\u5206\u6790\uff1aHDFS \u517c\u5bb9\uff0c\u6ca1\u6709\u4efb\u4f55\u7279\u6b8a API \u4fb5\u5165\u4e1a\u52a1\uff1b\u4e0e\u4e3b\u6d41\u8ba1\u7b97\u6846\u67b6\uff08Spark, Hadoop, Hive\u7b49\uff09\u65e0\u7f1d\u8854\u63a5\uff1b\u65e0\u9650\u6269\u5c55\u7684\u5b58\u50a8\u7a7a\u95f4\uff1b\u8fd0\u7ef4\u6210\u672c\u51e0\u4e4e\u4e3a 0\uff1b\u5b8c\u5584\u7684\u7f13\u5b58\u673a\u5236\uff0c\u9ad8\u4e8e\u5bf9\u8c61\u5b58\u50a8\u6027\u80fd\u6570\u500d\u3002</li> <li>\u673a\u5668\u5b66\u4e60\uff1aPOSIX \u517c\u5bb9\uff0c\u53ef\u4ee5\u652f\u6301\u6240\u6709\u673a\u5668\u5b66\u4e60\u3001\u6df1\u5ea6\u5b66\u4e60\u6846\u67b6\uff1b\u5171\u4eab\u80fd\u529b\u63d0\u5347\u56e2\u961f\u7ba1\u7406\u3001\u4f7f\u7528\u6570\u636e\u6548\u7387\u3002</li> <li>\u5bb9\u5668\u96c6\u7fa4\u4e2d\u7684\u6301\u4e45\u5377\uff1aKubernetes CSI \u652f\u6301\uff1b\u6301\u4e45\u5b58\u50a8\u5e76\u4e0e\u5bb9\u5668\u751f\u5b58\u671f\u72ec\u7acb\uff1b\u5f3a\u4e00\u81f4\u6027\u4fdd\u8bc1\u6570\u636e\u6b63\u786e\uff1b\u63a5\u7ba1\u6570\u636e\u5b58\u50a8\u9700\u6c42\uff0c\u4fdd\u8bc1\u670d\u52a1\u7684\u65e0\u72b6\u6001\u5316\u3002</li> <li>\u5171\u4eab\u5de5\u4f5c\u533a\uff1a\u6ca1\u6709 VPC \u9650\u5236\uff0c\u53ef\u4ee5\u5728\u4efb\u610f\u4e3b\u673a\u6302\u8f7d\uff1b\u6ca1\u6709\u5ba2\u6237\u7aef\u5e76\u53d1\u8bfb\u5199\u9650\u5236\uff1bPOSIX \u517c\u5bb9\u5df2\u6709\u7684\u6570\u636e\u6d41\u548c\u811a\u672c\u64cd\u4f5c\u3002</li> <li>\u6570\u636e\u5907\u4efd\uff1aPOSIX \u662f\u8fd0\u7ef4\u5de5\u7a0b\u5e08\u6700\u53cb\u597d\u7684\u63a5\u53e3\uff1b\u65e0\u9650\u5e73\u6ed1\u6269\u5c55\u7684\u5b58\u50a8\u7a7a\u95f4\uff1b\u8de8\u4e91\u8de8\u533a\u81ea\u52a8\u590d\u5236\uff1b\u6302\u8f7d\u4e0d\u53d7 VPC \u9650\u5236\uff0c\u65b9\u4fbf\u6240\u6709\u4e3b\u673a\u8bbf\u95ee\uff1b\u5feb\u7167\uff08snapshot\uff09\u53ef\u7528\u4e8e\u5feb\u901f\u6062\u590d\u548c\u6570\u636e\u9a8c\u8bc1\u3002</li> </ul>"},{"location":"data_system/file_system/juicefs/juicefs.html#_2","title":"\u7279\u6027","text":"<ol> <li>POSIX \u517c\u5bb9\uff1a\u50cf\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4e00\u6837\u4f7f\u7528\uff0c\u65e0\u7f1d\u5bf9\u63a5\u5df2\u6709\u5e94\u7528\uff0c\u65e0\u4e1a\u52a1\u4fb5\u5165\u6027\uff1b</li> <li>HDFS \u517c\u5bb9\uff1a\u5b8c\u6574\u517c\u5bb9 HDFS API\uff0c\u63d0\u4f9b\u66f4\u5f3a\u7684\u5143\u6570\u636e\u6027\u80fd\uff1b</li> <li>S3 \u517c\u5bb9\uff1a\u63d0\u4f9b S3 \u7f51\u5173 \u5b9e\u73b0 S3 \u534f\u8bae\u517c\u5bb9\u7684\u8bbf\u95ee\u63a5\u53e3\uff1b</li> <li>\u4e91\u539f\u751f\uff1a\u901a\u8fc7 CSI Driver \u8f7b\u677e\u5730\u5728 Kubernetes \u4e2d\u4f7f\u7528 JuiceFS\uff1b</li> <li>\u5206\u5e03\u5f0f\u8bbe\u8ba1\uff1a\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u53ef\u5728\u4e0a\u5343\u53f0\u670d\u52a1\u5668\u540c\u65f6\u6302\u8f7d\uff0c\u9ad8\u6027\u80fd\u5e76\u53d1\u8bfb\u5199\uff0c\u5171\u4eab\u6570\u636e\uff1b</li> <li>\u5f3a\u4e00\u81f4\u6027\uff1a\u786e\u8ba4\u7684\u6587\u4ef6\u4fee\u6539\u4f1a\u5728\u6240\u6709\u670d\u52a1\u5668\u4e0a\u7acb\u5373\u53ef\u89c1\uff0c\u4fdd\u8bc1\u5f3a\u4e00\u81f4\u6027\uff1b</li> <li>\u5f3a\u608d\u6027\u80fd\uff1a\u6beb\u79d2\u7ea7\u5ef6\u8fdf\uff0c\u8fd1\u4e4e\u65e0\u9650\u7684\u541e\u5410\u91cf\uff08\u53d6\u51b3\u4e8e\u5bf9\u8c61\u5b58\u50a8\u89c4\u6a21\uff09\uff0c\u67e5\u770b\u6027\u80fd\u6d4b\u8bd5\u7ed3\u679c\uff1b</li> <li>\u6570\u636e\u5b89\u5168\uff1a\u652f\u6301\u4f20\u8f93\u4e2d\u52a0\u5bc6\uff08encryption in transit\uff09\u548c\u9759\u6001\u52a0\u5bc6\uff08encryption at rest\uff09\uff0c\u67e5\u770b\u8be6\u60c5\uff1b</li> <li>\u6587\u4ef6\u9501\uff1a\u652f\u6301 BSD \u9501\uff08flock\uff09\u548c POSIX \u9501\uff08fcntl\uff09\uff1b</li> <li>\u6570\u636e\u538b\u7f29\uff1a\u652f\u6301 LZ4 \u548c Zstandard \u538b\u7f29\u7b97\u6cd5\uff0c\u8282\u7701\u5b58\u50a8\u7a7a\u95f4\u3002</li> </ol>"},{"location":"data_system/file_system/juicefs/juicefs.html#_3","title":"\u53ef\u89c2\u6d4b\u6027","text":"<p>JuiceFS \u53ef\u4ee5\u901a\u8fc7\u81ea\u8eab\u7684\u65e5\u5fd7\u548c\u5206\u6790\u5de5\u5177\u5f88\u6e05\u6670\u7684\u5c55\u793a\u51fa\u4e0a\u5c42\u5e94\u7528\u5bf9\u5b58\u50a8\u7684\u6240\u6709\u8bbf\u95ee\u7ec6\u8282\uff0c\u6bcf\u4e2a\u63a5\u53e3\u8bbf\u95ee\u7684\u5173\u7cfb\uff0c\u6d88\u8017\u7684\u65f6\u95f4\uff0c\u901a\u8fc7\u4e0b\u9762\u56fe\u5f62\u5316\u7684\u65b9\u5f0f\uff0c\u4e00\u770b\u5c31\u5f88\u5bb9\u6613\u53d1\u73b0\u5230\u5e95\u662f\u5b58\u50a8\u7cfb\u7edf\u6162\uff0c\u8fd8\u662f\u4e0a\u5c42\u5e94\u7528\u7684\u8c03\u7528\u5b58\u50a8 API \u7684\u65b9\u5f0f\u9519\u4e86\uff0c\u9020\u6210\u4e86\u963b\u585e\u3002</p> <p></p>"},{"location":"data_system/file_system/juicefs/juicefs.html#_4","title":"\u67b6\u6784","text":"<p>Google File System\u7684\u5b9e\u73b0\uff1a</p> <p></p> <p>JuiceFS\u7684\u5b9e\u73b0\u4e09\u8981\u7d20\uff1a</p> <p></p> <p>\u5c06\u5143\u6570\u636e\u670d\u52a1\u6539\u9020\u4e3a\u652f\u6301\u591a\u5f15\u64ce\u7684\u63d2\u4ef6\u5f0f\u67b6\u6784\uff0c\u53ef\u4ee5\u5229\u7528\u5df2\u6709\u7684\u5f00\u6e90\u6570\u636e\u5e93\u5b9e\u73b0\u5143\u6570\u636e\u5b58\u50a8\u3002</p> <p>Redis \u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u5f00\u6e90\u5b58\u50a8\u5f15\u64ce\uff1a</p> <ol> <li>\u662f\u5168\u5185\u5b58\u7684\uff0c\u53ef\u4ee5\u6ee1\u8db3\u5143\u6570\u636e\u7684\u4f4e\u5ef6\u65f6\u548c\u9ad8 IOPS \u8981\u6c42\uff1b</li> <li>\u652f\u6301\u4e50\u89c2\u4e8b\u52a1\uff0c\u80fd\u591f\u6ee1\u8db3\u6587\u4ef6\u7cfb\u7edf\u5143\u6570\u636e\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u8981\u6c42\uff1b</li> <li>\u6709\u4e30\u5bcc\u7684\u6570\u636e\u7ed3\u6784\uff0c\u6613\u4e8e\u5b9e\u73b0\u6587\u4ef6\u7cfb\u7edf\u7684\u8bf8\u591a API\uff1b</li> <li>\u6709\u7740\u975e\u5e38\u5e7f\u6cdb\u7684\u793e\u533a\u548c\u6210\u719f\u7684\u751f\u6001\uff0c\u8fd0\u7ef4 Redis \u4e0d\u4f1a\u662f\u4e00\u4e2a\u95ee\u9898\uff1b</li> </ol>"},{"location":"data_system/file_system/juicefs/juicefs.html#_5","title":"\u5143\u6570\u636e\u670d\u52a1","text":"<p>\u5143\u6570\u636e\u670d\u52a1\u662f\u4e2a\u96c6\u7fa4\uff0c\u901a\u8fc7 Raft \u7b97\u6cd5\u5b9e\u73b0\u9ad8\u53ef\u7528\u5e76\u540c\u65f6\u4fdd\u8bc1\u6570\u636e\u7684\u5f3a\u4e00\u81f4\u6027\u3002 \u5143\u6570\u636e\u670d\u52a1\u662f\u4e13\u4e3a\u6587\u4ef6\u7cfb\u7edf\u4f18\u5316\u7684\u670d\u52a1\uff0c\u975e\u5e38\u9ad8\u6548\u548c\u7a33\u5b9a\u3002</p> <p>\u5143\u6570\u636e\uff08metadata\uff09\u5305\u542b\u6587\u4ef6\u540d\u3001\u6587\u4ef6\u5927\u5c0f\u3001\u6743\u9650\u7ec4\u3001\u521b\u5efa\u4fee\u6539\u65f6\u95f4\u548c\u76ee\u5f55\u7ed3\u6784\u3002</p> <p></p>"},{"location":"data_system/file_system/juicefs/juicefs.html#_6","title":"\u6302\u8f7d\u5ba2\u6237\u7aef","text":"<p><code>jfsmount</code>, \u5b83\u8d1f\u8d23\u8ddf\u5143\u6570\u636e\u670d\u52a1\u548c\u5bf9\u8c61\u5b58\u50a8\u901a\u4fe1\uff0c\u5e76\u901a\u8fc7 FUSE \u5b9e\u73b0 POSIX API\u3002</p> <p></p> <p>\u4f7f\u7528\u5185\u7f6e\u7684 API\uff08open, read, write \u7b49\uff09\u8bbf\u95ee\u6570\u636e\u65f6\uff0c\u4f1a\u5728\u5e95\u5c42\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u7ecf\u8fc7\u5185\u6838\u4e2d\u7684 VFS \u4ee5\u53ca FUSE \u6a21\u5757\u8f6c\u53d1\u5230 <code>jfsmount</code>, \u518d\u8bf7\u6c42\u5143\u6570\u636e\u670d\u52a1\u6216\u8005\u5bf9\u8c61\u5b58\u50a8\u5b8c\u6210\u64cd\u4f5c\u3002</p>"},{"location":"data_system/file_system/juicefs/juicefs.html#_7","title":"\u539f\u7406","text":""},{"location":"data_system/file_system/juicefs/juicefs.html#_8","title":"\u5b58\u50a8\u65b9\u5f0f","text":"<p>JuiceFS \u4f1a\u5c06\u6570\u636e\u683c\u5f0f\u5316\u4ee5\u540e\u5b58\u50a8\u5728\u5bf9\u8c61\u5b58\u50a8\uff08\u4e91\u5b58\u50a8\uff09\uff0c\u540c\u65f6\u4f1a\u5c06\u6570\u636e\u5bf9\u5e94\u7684\u5143\u6570\u636e\u5b58\u50a8\u5728 Redis \u7b49\u6570\u636e\u5e93\u4e2d\u3002</p> <p>\u4efb\u4f55\u5b58\u5165 JuiceFS \u7684\u6587\u4ef6\u90fd\u4f1a\u88ab\u62c6\u5206\u6210\u56fa\u5b9a\u5927\u5c0f\u7684 \"Chunk\"\uff0c\u9ed8\u8ba4\u7684\u5bb9\u91cf\u4e0a\u9650\u662f 64 MiB\u3002</p> <p>\u6bcf\u4e2a Chunk \u7531\u4e00\u4e2a\u6216\u591a\u4e2a \"Slice\" \u7ec4\u6210\uff0cSlice \u7684\u957f\u5ea6\u4e0d\u56fa\u5b9a\uff0c\u53d6\u51b3\u4e8e\u6587\u4ef6\u5199\u5165\u7684\u65b9\u5f0f\u3002</p> <p>\u6bcf\u4e2a Slice \u53c8\u4f1a\u88ab\u8fdb\u4e00\u6b65\u62c6\u5206\u6210\u56fa\u5b9a\u5927\u5c0f\u7684 \"Block\"\uff0c\u9ed8\u8ba4\u4e3a 4 MiB\u3002\u6700\u540e\uff0c\u8fd9\u4e9b Block \u4f1a\u88ab\u5b58\u50a8\u5230\u5bf9\u8c61\u5b58\u50a8\u3002</p> <p>\u4e0e\u6b64\u540c\u65f6\uff0cJuiceFS \u4f1a\u5c06\u6bcf\u4e2a\u6587\u4ef6\u4ee5\u53ca\u5b83\u7684 Chunks\u3001Slices\u3001Blocks \u7b49\u5143\u6570\u636e\u4fe1\u606f\u5b58\u50a8\u5728\u5143\u6570\u636e\u5f15\u64ce\u4e2d\u3002</p> <p></p> <p>\u4f7f\u7528 JuiceFS\uff0c\u6587\u4ef6\u6700\u7ec8\u4f1a\u88ab\u62c6\u5206\u6210 Chunks\u3001Slices \u548c Blocks \u5b58\u50a8\u5728\u5bf9\u8c61\u5b58\u50a8\u3002</p> <p></p>"},{"location":"data_system/file_system/juicefs/juicefs.html#_9","title":"\u5199\u5165\u6d41\u7a0b","text":"<p>\u5728\u5904\u7406\u5199\u8bf7\u6c42\u65f6\uff0cJuiceFS \u5148\u5c06\u6570\u636e\u5199\u5165 Client \u7684\u5185\u5b58\u7f13\u51b2\u533a\uff0c\u5e76\u5728\u5176\u4e2d\u6309 Chunk/Slice \u7684\u5f62\u5f0f\u8fdb\u884c\u7ba1\u7406\u3002</p> <p>Chunk \u662f\u6839\u636e\u6587\u4ef6\u5185 offset \u6309 64 MiB \u5927\u5c0f\u62c6\u5206\u7684\u8fde\u7eed\u903b\u8f91\u5355\u5143\uff0c\u4e0d\u540c Chunk \u4e4b\u95f4\u5b8c\u5168\u9694\u79bb\u3002</p> <p>\u6bcf\u4e2a Chunk \u5185\u4f1a\u6839\u636e\u5e94\u7528\u5199\u8bf7\u6c42\u7684\u5b9e\u9645\u60c5\u51b5\u8fdb\u4e00\u6b65\u62c6\u5206\u6210 Slices\uff1b\u5f53\u65b0\u7684\u5199\u8bf7\u6c42\u4e0e\u5df2\u6709\u7684 Slice \u8fde\u7eed\u6216\u6709\u91cd\u53e0\u65f6\uff0c\u4f1a\u76f4\u63a5\u5728\u8be5 Slice \u4e0a\u8fdb\u884c\u66f4\u65b0\uff0c\u5426\u5219\u5c31\u521b\u5efa\u65b0\u7684 Slice\u3002</p> <p>Slice \u662f\u542f\u52a8\u6570\u636e\u6301\u4e45\u5316\u7684\u903b\u8f91\u5355\u5143\uff0c\u5176\u5728 flush \u65f6\u4f1a\u5148\u5c06\u6570\u636e\u6309\u7167\u9ed8\u8ba4 4 MiB \u5927\u5c0f\u62c6\u5206\u6210\u4e00\u4e2a\u6216\u591a\u4e2a\u8fde\u7eed\u7684 Blocks\uff0c\u5e76\u4e0a\u4f20\u5230\u5bf9\u8c61\u5b58\u50a8\uff0c\u6bcf\u4e2a Block \u5bf9\u5e94\u4e00\u4e2a Object\uff1b\u7136\u540e\u518d\u66f4\u65b0\u4e00\u6b21\u5143\u6570\u636e\uff0c\u5199\u5165\u65b0\u7684 Slice \u4fe1\u606f\u3002</p> <p>\u4f7f\u7528 1 MiB IO \u987a\u5e8f\u5199 1 GiB \u6587\u4ef6\uff0c\u6570\u636e\u5728\u5404\u4e2a\u7ec4\u4ef6\u4e2d\u7684\u5f62\u5f0f\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p>\u56fe\u4e2d\u7684\u538b\u7f29\u548c\u52a0\u5bc6\u9ed8\u8ba4\u672a\u5f00\u542f\u3002\u6b32\u542f\u7528\u76f8\u5173\u529f\u80fd\u9700\u8981\u5728 format \u6587\u4ef6\u7cfb\u7edf\u7684\u65f6\u5019\u6dfb\u52a0 <code>--compress value</code> \u6216 <code>--encrypt-rsa-key value</code> \u9009\u9879\u3002</p> <p></p> <p>\u5927\u6587\u4ef6\u5185\u968f\u673a\u5199\u7684\u60c5\u51b5\u8981\u590d\u6742\u8bb8\u591a\uff1b\u6bcf\u4e2a Chunk \u5185\u53ef\u80fd\u5b58\u5728\u591a\u4e2a\u4e0d\u8fde\u7eed\u7684 Slice\uff0c\u4f7f\u5f97\u4e00\u65b9\u9762\u6570\u636e\u5bf9\u8c61\u96be\u4ee5\u8fbe\u5230 4 MiB \u5927\u5c0f\uff0c\u53e6\u4e00\u65b9\u9762\u5143\u6570\u636e\u9700\u8981\u591a\u6b21\u66f4\u65b0\u3002\u540c\u65f6\uff0c\u5f53\u4e00\u4e2a Chunk \u5185\u5df2\u5199\u5165\u7684 Slices \u8fc7\u591a\u65f6\uff0c\u4f1a\u89e6\u53d1 Compaction \u6765\u5c1d\u8bd5\u5408\u5e76\u4e0e\u6e05\u7406\u8fd9\u4e9b Slices\uff0c\u8fd9\u53c8\u4f1a\u8fdb\u4e00\u6b65\u589e\u5927\u7cfb\u7edf\u7684\u8d1f\u62c5\u3002\u56e0\u6b64\uff0cJuiceFS \u5728\u6b64\u7c7b\u573a\u666f\u4e0b\u4f1a\u6bd4\u987a\u5e8f\u5199\u6709\u8f83\u660e\u663e\u7684\u6027\u80fd\u4e0b\u964d\u3002</p> <p>\u5c0f\u6587\u4ef6\u7684\u5199\u5165\u901a\u5e38\u662f\u5728\u6587\u4ef6\u5173\u95ed\u65f6\u88ab\u4e0a\u4f20\u5230\u5bf9\u8c61\u5b58\u50a8\uff0c\u5bf9\u5e94 IO \u5927\u5c0f\u4e00\u822c\u5c31\u662f\u6587\u4ef6\u5927\u5c0f\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u79cd\u4e0d\u8db3\u4e00\u4e2a Block \u7684\u5bf9\u8c61\uff0cJuiceFS \u5728\u4e0a\u4f20\u7684\u540c\u65f6\u8fd8\u4f1a\u5c1d\u8bd5\u5199\u5165\u5230\u672c\u5730 Cache\uff08\u7531 <code>--cache-dir</code> \u6307\u5b9a\uff0c\u53ef\u4ee5\u662f\u5185\u5b58\u6216\u786c\u76d8\uff09\uff0c\u4ee5\u671f\u80fd\u63d0\u5347\u540e\u7eed\u53ef\u80fd\u7684\u8bfb\u8bf7\u6c42\u901f\u5ea6\u3002</p> <p>\u7531\u4e8e\u5199\u8bf7\u6c42\u5199\u5165 Client \u5185\u5b58\u7f13\u51b2\u533a\u5373\u53ef\u8fd4\u56de\uff0c\u56e0\u6b64\u901a\u5e38\u6765\u8bf4 JuiceFS \u7684 Write \u65f6\u5ef6\u975e\u5e38\u4f4e\uff08\u51e0\u5341\u5fae\u79d2\u7ea7\u522b\uff09\uff0c\u771f\u6b63\u4e0a\u4f20\u5230\u5bf9\u8c61\u5b58\u50a8\u7684\u52a8\u4f5c\u7531\u5185\u90e8\u81ea\u52a8\u89e6\u53d1\uff08\u5355\u4e2a Slice \u8fc7\u5927\uff0cSlice \u6570\u91cf\u8fc7\u591a\uff0c\u7f13\u51b2\u65f6\u95f4\u8fc7\u957f\u7b49\uff09\u6216\u5e94\u7528\u4e3b\u52a8\u89e6\u53d1\uff08\u5173\u95ed\u6587\u4ef6\u3001\u8c03\u7528 <code>fsync</code> \u7b49\uff09\u3002\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u53ea\u6709\u5728\u88ab\u6301\u4e45\u5316\u540e\u624d\u80fd\u91ca\u653e\uff0c\u56e0\u6b64\u5f53\u5199\u5165\u5e76\u53d1\u6bd4\u8f83\u5927\u6216\u8005\u5bf9\u8c61\u5b58\u50a8\u6027\u80fd\u4e0d\u8db3\u65f6\uff0c\u6709\u53ef\u80fd\u5360\u6ee1\u7f13\u51b2\u533a\u800c\u5bfc\u81f4\u5199\u963b\u585e\u3002\u5177\u4f53\u800c\u8a00\uff0c\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u7531\u6302\u8f7d\u53c2\u6570 <code>--buffer-size</code> \u6307\u5b9a\uff0c\u9ed8\u8ba4\u4e3a 300 MiB\uff1b\u5176\u5b9e\u65f6\u503c\u53ef\u4ee5\u5728\u6307\u6807\u56fe\u7684 usage.buf \u4e00\u5217\u4e2d\u770b\u5230\u3002</p>"},{"location":"data_system/file_system/juicefs/juicefs.html#writeback","title":"\u56de\u5199\uff08Writeback\uff09\u6a21\u5f0f","text":"<p>\u5f53\u5bf9\u6570\u636e\u7684\u4e00\u81f4\u6027\u548c\u53ef\u9760\u6027\u8981\u6c42\u5e76\u4e0d\u9ad8\u65f6\uff0c\u8fd8\u53ef\u4ee5\u5728\u6302\u8f7d\u65f6\u6dfb\u52a0 <code>--writeback</code> \u4ee5\u8fdb\u4e00\u6b65\u63d0\u5347\u7cfb\u7edf\u6027\u80fd\u3002\u56de\u5199\u6a21\u5f0f\u5f00\u542f\u540e\uff0cSlice flush \u4ec5\u9700\u5199\u5230\u672c\u5730 Staging \u76ee\u5f55\uff08\u4e0e Cache \u5171\u4eab\uff09\u5373\u53ef\u8fd4\u56de\uff0c\u6570\u636e\u7531\u540e\u53f0\u7ebf\u7a0b\u5f02\u6b65\u4e0a\u4f20\u5230\u5bf9\u8c61\u5b58\u50a8\u3002\u8bf7\u6ce8\u610f\uff0cJuiceFS \u7684\u56de\u5199\u6a21\u5f0f\u4e0e\u901a\u5e38\u7406\u89e3\u7684\u5148\u5199\u5185\u5b58\u4e0d\u540c\uff0c\u662f\u9700\u8981\u5c06\u6570\u636e\u5199\u5165\u672c\u5730 Cache \u76ee\u5f55\u7684\uff08\u5177\u4f53\u7684\u884c\u4e3a\u6839\u636e Cache \u76ee\u5f55\u6240\u5728\u786c\u4ef6\u548c\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u800c\u5b9a\uff09\u3002\u6362\u4e2a\u89d2\u5ea6\u7406\u89e3\uff0c\u6b64\u65f6\u672c\u5730\u76ee\u5f55\u5c31\u662f\u5bf9\u8c61\u5b58\u50a8\u7684\u7f13\u5b58\u5c42\u3002</p> <p>\u56de\u5199\u6a21\u5f0f\u5f00\u542f\u540e\uff0c\u8fd8\u4f1a\u9ed8\u8ba4\u8df3\u8fc7\u5bf9\u4e0a\u4f20\u5bf9\u8c61\u7684\u5927\u5c0f\u68c0\u67e5\uff0c\u6fc0\u8fdb\u5730\u5c3d\u91cf\u5c06\u6240\u6709\u6570\u636e\u90fd\u4fdd\u7559\u5728 Cache \u76ee\u5f55\u3002\u8fd9\u5728\u4e00\u4e9b\u4f1a\u4ea7\u751f\u5927\u91cf\u4e2d\u95f4\u6587\u4ef6\u7684\u573a\u666f\uff08\u5982\u8f6f\u4ef6\u7f16\u8bd1\u7b49\uff09\u7279\u522b\u6709\u7528\u3002\u6b64\u5916\uff0cJuiceFS v0.17 \u7248\u672c\u8fd8\u65b0\u589e\u4e86 <code>--upload-delay</code> \u53c2\u6570\uff0c\u7528\u6765\u5ef6\u7f13\u6570\u636e\u4e0a\u4f20\u5230\u5bf9\u8c61\u5b58\u50a8\u7684\u65f6\u95f4\uff0c\u4ee5\u66f4\u6fc0\u8fdb\u5730\u65b9\u5f0f\u5c06\u5176\u7f13\u5b58\u5728\u672c\u5730\u3002\u5982\u679c\u5728\u7b49\u5f85\u7684\u65f6\u95f4\u5185\u6570\u636e\u88ab\u5e94\u7528\u5220\u9664\uff0c\u5219\u65e0\u9700\u518d\u4e0a\u4f20\u5230\u5bf9\u8c61\u5b58\u50a8\uff0c\u65e2\u63d0\u5347\u4e86\u6027\u80fd\u4e5f\u8282\u7701\u4e86\u6210\u672c\u3002\u540c\u65f6\u76f8\u8f83\u4e8e\u672c\u5730\u786c\u76d8\u800c\u8a00\uff0cJuiceFS \u63d0\u4f9b\u4e86\u540e\u7aef\u4fdd\u969c\uff0c\u5728 Cache \u76ee\u5f55\u5bb9\u91cf\u4e0d\u8db3\u65f6\u4f9d\u7136\u4f1a\u81ea\u52a8\u5c06\u6570\u636e\u4e0a\u4f20\uff0c\u786e\u4fdd\u5728\u5e94\u7528\u4fa7\u4e0d\u4f1a\u56e0\u6b64\u800c\u611f\u77e5\u5230\u9519\u8bef\u3002\u8fd9\u4e2a\u529f\u80fd\u5728\u5e94\u5bf9 Spark shuffle \u7b49\u6709\u4e34\u65f6\u5b58\u50a8\u9700\u6c42\u7684\u573a\u666f\u65f6\u975e\u5e38\u6709\u6548</p>"},{"location":"data_system/file_system/juicefs/juicefs.html#_10","title":"\u8bfb\u53d6\u6d41\u7a0b","text":"<p>JuiceFS \u5728\u5904\u7406\u8bfb\u8bf7\u6c42\u65f6\uff0c\u4e00\u822c\u4f1a\u6309\u7167 4 MiB Block \u5bf9\u9f50\u7684\u65b9\u5f0f\u53bb\u5bf9\u8c61\u5b58\u50a8\u8bfb\u53d6\uff0c\u5b9e\u73b0\u4e00\u5b9a\u7684\u9884\u8bfb\u529f\u80fd\u3002\u540c\u65f6\uff0c\u8bfb\u53d6\u5230\u7684\u6570\u636e\u4f1a\u5199\u5165\u672c\u5730 Cache \u76ee\u5f55\uff0c\u4ee5\u5907\u540e\u7528\uff08\u5982\u6307\u6807\u56fe\u4e2d\u7684\u7b2c 2 \u9636\u6bb5\uff0cblockcache \u6709\u5f88\u9ad8\u7684\u5199\u5165\u5e26\u5bbd\uff09\u3002\u663e\u7136\uff0c\u5728\u987a\u5e8f\u8bfb\u65f6\uff0c\u8fd9\u4e9b\u63d0\u524d\u83b7\u53d6\u7684\u6570\u636e\u90fd\u4f1a\u88ab\u540e\u7eed\u7684\u8bf7\u6c42\u8bbf\u95ee\u5230\uff0cCache \u547d\u4e2d\u7387\u975e\u5e38\u9ad8\uff0c\u56e0\u6b64\u4e5f\u80fd\u5145\u5206\u53d1\u6325\u51fa\u5bf9\u8c61\u5b58\u50a8\u7684\u8bfb\u53d6\u6027\u80fd\u3002\u6b64\u65f6\u6570\u636e\u5728\u5404\u4e2a\u7ec4\u4ef6\u4e2d\u7684\u6d41\u52a8\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u505a\u5927\u6587\u4ef6\u5185\u968f\u673a\u5c0f IO \u8bfb\u53d6\u65f6\uff0cJuiceFS \u7684\u8fd9\u79cd\u7b56\u7565\u5219\u6548\u7387\u4e0d\u9ad8\uff0c\u53cd\u800c\u4f1a\u56e0\u4e3a\u8bfb\u653e\u5927\u548c\u672c\u5730 Cache \u7684\u9891\u7e41\u5199\u5165\u4e0e\u9a71\u9010\u4f7f\u5f97\u7cfb\u7edf\u8d44\u6e90\u7684\u5b9e\u9645\u5229\u7528\u7387\u964d\u4f4e\u3002\u4e0d\u5e78\u7684\u662f\uff0c\u6b64\u7c7b\u573a\u666f\u4e0b\u4e00\u822c\u7684\u7f13\u5b58\u7b56\u7565\u5f88\u96be\u6709\u8db3\u591f\u9ad8\u7684\u6536\u76ca\u3002\u6b64\u65f6\u53ef\u8003\u8651\u7684\u4e00\u4e2a\u65b9\u5411\u662f\u5c3d\u53ef\u80fd\u63d0\u5347\u7f13\u5b58\u7684\u6574\u4f53\u5bb9\u91cf\uff0c\u4ee5\u671f\u8fbe\u5230\u80fd\u51e0\u4e4e\u5b8c\u5168\u7f13\u5b58\u6240\u9700\u6570\u636e\u7684\u6548\u679c\uff1b\u53e6\u4e00\u4e2a\u65b9\u5411\u5219\u53ef\u4ee5\u76f4\u63a5\u5c06\u7f13\u5b58\u5173\u95ed\uff08\u8bbe\u7f6e <code>--cache-size 0</code>\uff09\uff0c\u5e76\u5c3d\u53ef\u80fd\u63d0\u9ad8\u5bf9\u8c61\u5b58\u50a8\u7684\u8bfb\u53d6\u6027\u80fd\u3002</p> <p>\u5c0f\u6587\u4ef6\u7684\u8bfb\u53d6\u5219\u6bd4\u8f83\u7b80\u5355\uff0c\u901a\u5e38\u5c31\u662f\u5728\u4e00\u6b21\u8bf7\u6c42\u91cc\u8bfb\u53d6\u5b8c\u6574\u4e2a\u6587\u4ef6\u3002\u7531\u4e8e\u5c0f\u6587\u4ef6\u5199\u5165\u65f6\u4f1a\u76f4\u63a5\u88ab\u7f13\u5b58\u8d77\u6765\uff0c\u56e0\u6b64\u7c7b\u4f3c JuiceFS bench \u8fd9\u79cd\u5199\u5165\u540e\u4e0d\u4e45\u5c31\u8bfb\u53d6\u7684\u8bbf\u95ee\u6a21\u5f0f\u57fa\u672c\u90fd\u4f1a\u5728\u672c\u5730 Cache \u76ee\u5f55\u547d\u4e2d\uff0c\u6027\u80fd\u975e\u5e38\u53ef\u89c2\u3002</p>"},{"location":"data_system/file_system/juicefs/juicefs.html#_11","title":"\u6027\u80fd","text":""},{"location":"data_system/file_system/juicefs/juicefs.html#hbase","title":"HBase\u4f7f\u7528\u6027\u80fd\u5bf9\u6bd4","text":"<p>YCSB \u6d4b\u8bd5\u96c6\uff0c\u5e0c\u671b\u6a21\u62df\u7ebf\u4e0a\u751f\u4ea7\u73af\u5883\u4e2d HBase \u96c6\u7fa4\u6062\u590d\u7684\u573a\u666f\uff0c\u6240\u4ee5\u6d4b\u8bd5\u662f\u5728\u5df2\u7ecf\u8dd1\u8fc7\u4e00\u904d\u7136\u540e\u91cd\u542f HBase \u7684\u60c5\u51b5\u4e0b\u8fdb\u884c\u3002</p>"},{"location":"data_system/file_system/juicefs/juicefs.html#_12","title":"\u6d4b\u8bd5\u73af\u5883","text":"<ul> <li>\u4f7f\u7528 AWS EMR</li> <li>Core \u8282\u70b9 2 \u4e2a\uff0c4 \u6838 16G\uff0c500G EBS SSD</li> <li>Region server \u5185\u5b58 6G</li> </ul>"},{"location":"data_system/file_system/juicefs/juicefs.html#_13","title":"\u5199\u5165\u5bf9\u6bd4","text":"<p>S3 \u548c HDFS \u5199\u5165\u6027\u80fd\u57fa\u672c\u4e00\u81f4\u3002\u800c JuiceFS \u5219\u6709\u5927\u7ea6 70% \u7684\u63d0\u5347\u3002 \u7531\u4e8e HBase \u4f7f\u7528\u7684\u662f LSM \u6811\uff0c\u5b83\u4f1a\u4f7f\u7528\u65e5\u5fd7\u6587\u4ef6\u548c\u4e00\u4e2a\u5185\u5b58\u5b58\u50a8\u7ed3\u6784\u628a\u968f\u673a\u5199\u64cd\u4f5c\u8f6c\u6362\u4e3a\u987a\u5e8f\u5199\uff0c\u56e0\u6b64\u4e3b\u8981\u8003\u9a8c\u7684\u5c31\u662f\u6587\u4ef6\u7cfb\u7edf\u7684\u987a\u5e8f\u5199\u80fd\u529b\uff0cJuiceFS \u91c7\u7528\u5e76\u53d1\u591a\u7ebf\u7a0b\u5199\u5165\uff0c\u52a0\u4e0a\u9ad8\u6027\u80fd\u7684\u5143\u6570\u636e\u80fd\u529b\uff0c\u6240\u4ee5\u6bd4\u76f4\u63a5\u4f7f\u7528 S3 \u5feb\u5f88\u591a\u3002</p>"},{"location":"data_system/file_system/juicefs/juicefs.html#get","title":"\u5355\u6761 GET \u5bf9\u6bd4","text":"<p>\u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528 S3 \u65f6\u542f\u52a8\u975e\u5e38\u7f13\u6162\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u6ca1\u6709\u672c\u5730\u78c1\u76d8\u7f13\u5b58\uff0c\u9700\u8981\u4f9d\u9760 HBase Bucket Cache\uff08\u91c7\u7528file\u6a21\u5f0f\uff09 \u6765\u5728\u78c1\u76d8\u4e0a\u7f13\u5b58\u6570\u636e\uff0c\u7528\u6765\u63d0\u9ad8\u7f13\u5b58\u547d\u4e2d\u7387\uff0c\u800c\u8fd9\u90e8\u5206\u6570\u636e\u5728 RegionSever \u91cd\u542f\u540e\u4f1a\u4e22\u5931\uff0c\u6240\u6709\u7684\u6570\u636e\u90fd\u5fc5\u987b\u53bb S3 \u8bfb\u53d6\uff0c\u9700\u8981\u5927\u91cf\u65f6\u95f4\u91cd\u65b0\u9884\u70ed\u3002</p> <p>JuiceFS \u652f\u6301\u6570\u636e\u7f13\u5b58\uff0c\u53ef\u4ee5\u628a\u70ed\u6570\u636e\u5b8c\u5168\u7f13\u5b58\u5728\u672c\u5730\u78c1\u76d8\u4e0a\u9762\u3002\u56e0\u6b64\u5728 HBase \u91cd\u542f\u65f6\uff0c\u70ed\u6570\u636e\u4f9d\u7136\u53ef\u4ee5\u901a\u8fc7\u672c\u5730\u78c1\u76d8\u4e2d\u7684\u7f13\u5b58\u5feb\u901f\u542f\u52a8\u3002</p> <p>\u5982\u679c\u4f7f\u7528 SSD \u505a\u672c\u5730\u7f13\u5b58\u76d8\uff0c\u53ef\u4ee5\u5929\u7136\u5b9e\u73b0\u51b7\u70ed\u6570\u636e\u5206\u79bb\u7684\u6548\u679c\uff0c\u51b7\u6570\u636e\u5728\u4f7f\u7528\u5f88\u5c11\u7684\u60c5\u51b5\u4e0b\u4f1a\u81ea\u52a8\u4ece\u7f13\u5b58\u4e2d\u88ab\u6dd8\u6c70\uff0c\u70ed\u6570\u636e\u4f1a\u4e00\u76f4\u7559\u5728\u672c\u5730\u7f13\u5b58\u76d8\u4e0a\u3002</p> <p>JuiceFS \u5728\u5b58\u50a8\u8ba1\u7b97\u5206\u79bb\u7684\u60c5\u51b5\u4e0b\u8fbe\u5230\u4e86 HDFS data locality \u7684\u6027\u80fd\u6c34\u5e73\u3002</p>"},{"location":"data_system/file_system/juicefs/juicefs.html#_14","title":"\u66f4\u7a33","text":"<p>\u4f7f\u7528 S3 \u505a\u5b58\u50a8\u65f6\uff0c\u7531\u4e8e\u6027\u80fd\u95ee\u9898\uff0cWAL \u5e76\u4e0d\u80fd\u76f4\u63a5\u5199\u5728 S3 \u4e0a\uff0c\u56e0\u6b64\u7528\u6237\u4ecd\u7136\u9700\u8981\u989d\u5916\u7ef4\u62a4\u4e00\u4e2a HDFS \u96c6\u7fa4\u6765\u5b58\u653e WAL \u6570\u636e\u3002\u6240\u4ee5\u5e76\u6ca1\u6709\u5f7b\u5e95\u7701\u53bb HDFS \u7684\u642d\u5efa\u3001\u76d1\u63a7\u3001\u8fd0\u7ef4\u7b49\u5de5\u4f5c\u91cf\u3002</p> <p>S3 API \u6709\u4e00\u90e8\u5206\u662f\u6700\u7ec8\u4e00\u81f4\u6027\u4fdd\u8bc1\uff0c\u4e14\u6ca1\u6709\u539f\u5b50\u7684 rename \u64cd\u4f5c\u3002</p>"},{"location":"data_system/file_system/juicefs/usage.html","title":"\u4f7f\u7528","text":""},{"location":"data_system/file_system/juicefs/usage.html#_2","title":"\u914d\u7f6e","text":""},{"location":"data_system/file_system/juicefs/usage.html#_3","title":"\u5143\u6570\u636e\u5b58\u50a8","text":""},{"location":"data_system/file_system/juicefs/usage.html#postgresql","title":"PostgreSQL","text":"<ul> <li>\u9ed8\u8ba4\u4f7f\u7528\u7684 public schema </li> <li>\u5bc6\u7801\u4e2d\u7684\u7279\u6b8a\u5b57\u7b26\u9700\u8981\u8fdb\u884c url \u7f16\u7801\uff0c\u4f8b\u5982 <code>|</code> \u9700\u8981\u7f16\u7801\u4e3a<code>%7C</code></li> </ul> <pre><code># \u9700\u8981\u63d0\u524d\u624b\u52a8\u521b\u5efa\u6570\u636e\u5e93\uff0c\u4f7f\u7528\u5982\u4e0b\u7684\u683c\u5f0f\u6765\u6307\u5b9a\u53c2\u6570\nexport META_PASSWORD=\"mypassword\"\njuicefs format \\\n    --storage s3 \\\n    ... \\\n    \"postgres://user@192.168.1.6:5432/juicefs\" \\\n    pics\n# \u6302\u8f7d\u6587\u4ef6\u7cfb\u7edf\nexport META_PASSWORD=\"mypassword\"\njuicefs mount -d \"postgres://user:mypassword@192.168.1.6:5432/juicefs\" /mnt/jfs\n</code></pre>"},{"location":"data_system/file_system/juicefs/usage.html#redis","title":"Redis","text":"<p>\u652f\u6301\u4f7f\u7528 Redis Cluster \u4f5c\u4e3a\u5143\u6570\u636e\u5f15\u64ce\uff0c\u4f46\u4e3a\u4e86\u907f\u514d\u5728 Redis \u96c6\u7fa4\u4e2d\u6267\u884c\u8de8\u8282\u70b9\u4e8b\u52a1\uff0c\u540c\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u5143\u6570\u636e\u603b\u4f1a\u5750\u843d\u4e8e\u5355\u4e2a Redis \u5b9e\u4f8b\u4e2d\u3002</p> <p>\u4fdd\u8bc1\u5143\u6570\u636e\u5b89\u5168\uff0c\u53c2\u8003 Redis \u6700\u4f73\u5b9e\u8df5</p> <ul> <li> <p>\u5185\u5b58\u6ee1\u65f6\u4e0d\u9a71\u9664\uff1a\u8bbe\u7f6e <code>maxmemory-policy noeviction</code>\uff0cjuicefs \u542f\u52a8\u65f6\u4f1a\u81ea\u52a8\u8bbe\u7f6e\uff0c\u8bbe\u7f6e\u5931\u8d25\u4f1a\u6253\u5370\u8b66\u544a\uff1b</p> </li> <li> <p>Redis\u9700\u8981\u5f00\u542f\u6301\u4e45\u5316\uff08RDB \u548cAOF\uff09\uff0c\u9632\u6b62\u5143\u6570\u636e\u4e22\u5931\uff1b</p> </li> </ul>"},{"location":"data_system/file_system/juicefs/usage.html#_4","title":"\u5bf9\u8c61\u5b58\u50a8","text":""},{"location":"data_system/file_system/juicefs/usage.html#hadoop","title":"Hadoop \u4f7f\u7528","text":"<p>\u5728 Hadoop \u751f\u6001\u4f7f\u7528 JuiceFS | JuiceFS Document Center</p>"},{"location":"data_system/file_system/juicefs/usage.html#_5","title":"\u547d\u4ee4","text":""},{"location":"data_system/file_system/juicefs/usage.html#juicefs-auth","title":"juicefs auth","text":"<p>\u6587\u4ef6\u7cfb\u7edf\u7684\u8ba4\u8bc1\u6388\u6743\u3002\u53ef\u4ee5\u5728\u6302\u8f7d\u65f6\u4ee5\u547d\u4ee4\u884c\u4ea4\u4e92\u65b9\u5f0f\u6216\u8005\u53c2\u6570\u65b9\u5f0f\u8f93\u5165\u8ba4\u8bc1\u4fe1\u606f\uff0c\u4e5f\u53ef\u4ee5\u7528 <code>auth</code> \u547d\u4ee4\u5c06\u8ba4\u8bc1\u4fe1\u606f\u4fdd\u5b58\u5728\u672c\u5730\uff08\u4f4d\u7f6e\u662f <code>$HOME/.juicefs/[NAME].conf</code>\uff09\uff0c\u4ee5\u540e\u6302\u8f7d\u65f6\u65e0\u9700\u518d\u6b21\u8f93\u5165\uff0c\u8fd9\u6837\u66f4\u65b9\u4fbf\u505a\u81ea\u52a8\u5316\u7684\u8fd0\u7ef4\u914d\u7f6e\u3002</p>"},{"location":"data_system/file_system/juicefs/usage.html#juicefs-mount","title":"juicefs mount","text":"<p>\u6302\u8f7d\u5b8c\u6210\u4e4b\u540e\uff0c\u9ed8\u8ba4\u4f1a\u5207\u5230\u540e\u7aef\u8fd0\u884c\u3002</p>"},{"location":"data_system/file_system/juicefs/usage.html#fuse","title":"FUSE \u6302\u8f7d\u9009\u9879","text":"<p>FUSE \u6302\u8f7d\u9009\u9879 | JuiceFS Document Center</p> <pre><code># -o \u9009\u9879\u8bbe\u7f6e\njuicefs mount -d -o allow_other,writeback_cache sqlite3://myjfs.db ~/jfs\n</code></pre>"},{"location":"data_system/file_system/juicefs/usage.html#_6","title":"\u7f13\u5b58\u76f8\u5173\u53c2\u6570","text":"<pre><code>--cache-dir=&lt;cache_dir&gt;\n</code></pre> <p>\u672c\u5730\u7f13\u5b58\u7684\u5b58\u50a8\u8def\u5f84\uff0c\u9ed8\u8ba4\u662f <code>/var/jfsCache</code>\u3002</p> <p>\u591a\u76d8\u7f13\u5b58\u7528 <code>:</code> \u5206\u5272\u4e0d\u540c\u76ee\u5f55\uff0c\u76ee\u5f55\u53ef\u5305\u542b\u901a\u914d\u7b26 <code>*</code> \uff08\u9700\u8981\u6dfb\u52a0\u5f15\u53f7\uff09\u3002</p> <p>\u4f8b\u5982 <code>--cache-dir '/data*/jfsCache:/mydata*/jfsCache'</code>\u3002</p> <pre><code>--cache-size=&lt;cache_size&gt;\n</code></pre> <p>\u672c\u5730\u7f13\u5b58\u5bb9\u91cf\uff0c\u9ed8\u8ba4\u662f 1024 MiB\u3002</p> <p>\u5728\u591a\u76d8\u7f13\u5b58\u4e0b\u662f\u6307\u591a\u4e2a\u76ee\u5f55\u4e00\u8d77\u7684\u603b\u5bb9\u91cf\uff0c\u4f1a\u5e73\u5747\u5206\u914d\u5230\u5404\u4e2a\u76ee\u5f55\u3002</p> <pre><code>--free-space-ratio=&lt;free_space_ratio&gt;\n</code></pre> <p>\u7f13\u5b58\u76d8\u7684\u6700\u5c11\u5269\u4f59\u7a7a\u95f4\uff0c\u9ed8\u8ba4\u662f 0.2\u3002</p> <pre><code>--cache-mode=&lt;cache_mode&gt;\n</code></pre> <p>\u78c1\u76d8\u4e0a\u7f13\u5b58\u6587\u4ef6\u7684\u6743\u9650\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u662f 0600\u3002</p> <pre><code>--buffer-size=&lt;buffer_size&gt;\n</code></pre> <p>\u7528\u6765\u7f13\u5b58\u8bfb\u5199\u6570\u636e\u7684\u603b\u5185\u5b58\u5927\u5c0f\uff0c\u9ed8\u8ba4 300 MiB\u3002</p> <pre><code>--writeback\n</code></pre> <p>\u5199\u6570\u636e\u65f6\u4f18\u5148\u5199\u5230\u672c\u5730\u78c1\u76d8\uff0c\u7136\u540e\u5728\u540e\u53f0\u5f02\u6b65\u4e0a\u4f20\u5230\u5bf9\u8c61\u5b58\uff0c\u9ed8\u8ba4\u4e0d\u542f\u7528\u3002</p> <pre><code>--metacache\n</code></pre> <p>\u5c06\u5143\u6570\u636e\u7f13\u5b58\u5728\u8fd0\u884c\u5ba2\u6237\u7aef\u7684\u4e3b\u673a\u7684\u5185\u5b58\u91cc\uff0c\u9ed8\u8ba4\u542f\u7528\uff0c\u8bf7\u7528 \u2013metacacheto=0 \u6765\u5173\u95ed\u3002</p> <pre><code>--metacacheto=&lt;metacacheto&gt;\n</code></pre> <p>\u5143\u6570\u636e\u7684\u7f13\u5b58\u8fc7\u671f\u65f6\u95f4(\u5355\u4f4d\u662f\u79d2\uff09\uff0c\u9ed8\u8ba4\u4e3a 300\uff085 \u5206\u949f\uff09\u3002</p> <pre><code>--entrycacheto=&lt;entrycacheto&gt;\n</code></pre> <p>\u6587\u4ef6\u9879\u5728\u5185\u6838\u4e2d\u7684\u7f13\u5b58\u65f6\u95f4\uff0c\u9ed8\u8ba4 1 \u79d2\u3002</p> <pre><code>--direntrycacheto=&lt;direntrycacheto&gt;\n</code></pre> <p>\u76ee\u5f55\u9879\u5728\u5185\u6838\u4e2d\u7684\u7f13\u5b58\u65f6\u95f4\uff0c\u9ed8\u8ba4 1 \u79d2\u3002</p> <pre><code>--attrcacheto=&lt;attrcacheto&gt;\n</code></pre> <p>\u6587\u4ef6/\u76ee\u5f55\u7684\u5c5e\u6027\u5728\u5185\u6838\u4e2d\u7684\u7f13\u5b58\u65f6\u95f4\uff0c\u9ed8\u8ba4 1 \u79d2\u3002</p> <pre><code>--opencache\n</code></pre> <p>\u662f\u5426\u4f7f\u7528\u7f13\u5b58\u7684\u5143\u6570\u636e\u6765\u6253\u5f00\u6587\u4ef6\uff0c\u9ed8\u8ba4\u4e0d\u4f7f\u7528\u3002</p>"},{"location":"data_system/file_system/juicefs/usage.html#juicefs-umount","title":"juicefs umount","text":"<p>\u5378\u8f7d JuiceFS \u6587\u4ef6\u7cfb\u7edf\u3002</p>"},{"location":"data_system/file_system/juicefs/usage.html#juicefs-info","title":"juicefs info","text":"<p>\u663e\u793a JuiceFS \u6587\u4ef6\u7cfb\u7edf\u4e2d\u6587\u4ef6\u6216\u76ee\u5f55\u7684\u4fe1\u606f\u3002</p>"},{"location":"data_system/file_system/juicefs/usage.html#juicefs-import","title":"juicefs import","text":"<p>\u4ece\u5df2\u6709\u7684\u5bf9\u8c61\u5b58\u50a8\u4e2d\u5bfc\u5165\u6587\u4ef6\u3002</p>"},{"location":"data_system/file_system/juicefs/usage.html#juicefs-rmr","title":"juicefs rmr","text":"<p>\u5feb\u901f\u5220\u9664\u76ee\u5f55\u91cc\u7684\u6240\u6709\u6587\u4ef6\u548c\u5b50\u76ee\u5f55\u3002</p>"},{"location":"data_system/file_system/juicefs/usage.html#juicefs-snapshot","title":"juicefs snapshot","text":"<p>\u521b\u5efa\u6216\u5220\u9664\u5feb\u7167\u3002</p>"},{"location":"data_system/file_system/juicefs/usage.html#juicefs-grep","title":"juicefs grep","text":""},{"location":"data_system/file_system/juicefs/usage.html#juicefs-lsof","title":"juicefs lsof","text":"<p>\u5217\u51fa JuiceFS \u6700\u8fd1\uff0810 \u5206\u949f\u5185\uff09\u88ab\u6253\u5f00\u8fc7\u7684\u6587\u4ef6\u3002</p>"},{"location":"data_system/file_system/juicefs/usage.html#juicefs-profile","title":"juicefs profile","text":"<p>\u6536\u96c6\u548c\u5206\u6790\u6587\u4ef6\u7cfb\u7edf\u7684 oplog (operation log)\u3002</p>"},{"location":"data_system/messagequeue/STOMP.html","title":"STOMP","text":"<p>Streaming Text Orientated Message Protocol\uff0c\u662f\u6d41\u6587\u672c\u5b9a\u5411\u6d88\u606f\u534f\u8bae\uff0c\u662f\u4e00\u79cd\u4e3aMOM(Message Oriented Middleware\uff0c\u9762\u5411\u6d88\u606f\u7684\u4e2d\u95f4\u4ef6)\u8bbe\u8ba1\u7684\u7b80\u5355\u6587\u672c\u534f\u8bae\u3002</p> <p>STOMP is a subprotocol operating on top of the lower-level WebSocket.</p> <p>\u63d0\u4f9b\u6d88\u606f\u4f53\u7684\u683c\u5f0f\uff0c\u5141\u8bb8<code>STOMP\u5ba2\u6237\u7aef(Endpoints)</code>\u4e0e\u4efb\u610f<code>STOMP\u6d88\u606f\u4ee3\u7406\uff08message broker\uff09</code>\u8fdb\u884c\u4ea4\u4e92\uff0c\u5b9e\u73b0\u5ba2\u6237\u7aef\u4e4b\u95f4\u8fdb\u884c\u5f02\u6b65\u6d88\u606f\u4f20\u9001\u3002</p>"},{"location":"data_system/messagequeue/STOMP.html#_1","title":"\u683c\u5f0f","text":"<p>STOMP\u7684\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\u662f\u901a\u8fc7\u201c\u5e27\u201d\uff08Frame\uff09\u5b9e\u73b0\u7684\uff0c\u6bcf\u4e2a\u5e27\u7531\u591a\u201c\u884c\u201d\uff08Line\uff09\u7ec4\u6210\u3002</p> <ul> <li>\u7b2c\u4e00\u884c\u5305\u542b\u4e86\u547d\u4ee4\uff0c\u7136\u540e\u7d27\u8ddf\u952e\u503c\u5bf9\u5f62\u5f0f\u7684Header\u5185\u5bb9\uff1b</li> <li>\u7b2c\u4e8c\u884c\u5fc5\u987b\u662f\u7a7a\u884c\uff1b</li> <li>\u7b2c\u4e09\u884c\u5f00\u59cb\u5c31\u662fBody\u5185\u5bb9\uff0c\u672b\u5c3e\u90fd\u4ee5\u7a7a\u5b57\u7b26\u7ed3\u5c3e\u3002</li> <li>\u53ea\u6709SEND\u3001MESSAGE\u548cERROR\u5e27\u53ef\u4ee5\u6709\u6b63\u6587</li> </ul>"},{"location":"data_system/messagequeue/STOMP.html#stomp-broker","title":"STOMP broker","text":""},{"location":"data_system/messagequeue/STOMP.html#_2","title":"\u793a\u4f8b","text":"<p>Spring\u5b98\u65b9\u793a\u4f8b-\u524d\u540e\u7aef\u4e00\u4f53</p>"},{"location":"data_system/messagequeue/message_platform.html","title":"\u6d88\u606f\u7cfb\u7edf","text":"<p>\uff08\u89e3\u8026\u5408\uff092003 \u5e74\u5230 2010 \u5e74\u4e4b\u524d\uff1a\u4ee5 activemq \u548c rabbitmq \u4e3a\u4e3b\u7684\u6d88\u606f\u961f\u5217\u81f4\u529b\u4e8e\u89e3\u51b3\u7cfb\u7edf\u95f4\u89e3\u8026\u5408\u548c\u4e00\u4e9b\u5f02\u6b65\u5316\u7684\u64cd\u4f5c\u7684\u95ee\u9898\uff1b</p> <p>\uff08\u541e\u5410\u91cf\u4e0e\u4e00\u81f4\u6027\uff092010 \u5e74\u5230 2012 \u5e74\u671f\u95f4\uff1a</p> <ul> <li> <p>\u5927\u6570\u636e\u65f6\u4ee3\uff0c\u6d88\u606f\u961f\u5217\u8bbe\u8ba1\u7684\u5173\u952e\u56e0\u7d20\u9010\u6e10\u8f6c\u5411\u4e3a\u541e\u5410\u91cf\u548c\u5e76\u53d1\u7a0b\u5ea6\uff0c\u5728\u65e5\u5fd7\u6536\u96c6\u548c\u6570\u636e\u901a\u9053\u9886\u57df\u5360\u636e\u4e86\u91cd\u8981\u5730\u4f4d\u3002</p> </li> <li> <p>\u963f\u91cc\u7535\u5546\u4e1a\u52a1\u7684\u5174\u8d77\uff0cKafka \u5728\u53ef\u9760\u6027\u3001\u4e00\u81f4\u6027\u3001\u987a\u5e8f\u6d88\u606f\u3001\u4e8b\u52a1\u6d88\u606f\u652f\u6301\u7b49\u65b9\u9762\u5df2\u7ecf\u65e0\u6cd5\u6ee1\u8db3\u963f\u91cc\u7535\u5546\u573a\u666f\u7684\u9700\u6c42\uff0c\u963f\u91cc\u7684\u81ea\u7814\u6d88\u606f\u961f\u5217 RocketMQ\uff1b</p> </li> </ul> <p>\uff08\u5e73\u53f0\u5316\uff092012 \u4ee5\u540e\uff1a\u4e91\u8ba1\u7b97\u3001k8s\u3001\u5bb9\u5668\u5316\u7b49\u65b0\u5174\u7684\u6280\u672f\u5174\u8d77\uff0c\u57fa\u672c\u5e95\u5c42\u6280\u672f\u80fd\u529b\u5e73\u53f0\u5316\uff0c\u79df\u6237\u9694\u79bb\u673a\u5236\u3001\u6570\u636e\u8fc1\u79fb\u3001\u6062\u590d\u3001\u6545\u969c\u8f6c\u79fb\u3002</p>"},{"location":"data_system/messagequeue/message_platform.html#_2","title":"\u6982\u5ff5","text":"<p>\u4e3b\u9898\uff08topic\uff09</p> <p>\u751f\u4ea7\u8005\uff08producer\uff09</p> <p>\u6d88\u8d39\u8005\uff08consumer\uff09</p> <p>\u5206\u533a\uff08partition\uff09</p> <ul> <li>\u5c06\u5927\u6570\u636e\u8fdb\u884c\u5212\u5206\u5b58\u50a8\uff1b</li> </ul>"},{"location":"data_system/messagequeue/message_platform.html#_3","title":"\u961f\u5217","text":""},{"location":"data_system/messagequeue/message_platform.html#activemq2003","title":"ActiveMQ\uff082003\uff09","text":""},{"location":"data_system/messagequeue/message_platform.html#rabbitmq2006","title":"RabbitMQ\uff082006\uff09","text":""},{"location":"data_system/messagequeue/message_platform.html#rocketmq2011","title":"RocketMQ\uff082011\uff09","text":"<p>\u5143\u6570\u636e\u7ba1\u7406\uff1a\u8f7b\u91cf\u7ea7\u7684\u72ec\u7acb\u670d\u52a1\u96c6\u7fa4</p> <p>\u5b8c\u5168\u987a\u5e8f\u5199\uff1a\u6781\u81f4\u7684\u6d88\u606f\u5199</p> <ul> <li>\u5c06\u6240\u6709\u7684 topic \u6d88\u606f\u5b58\u50a8\u5728\u540c\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u786e\u4fdd\u6240\u6709\u6d88\u606f\u53d1\u9001\u65f6\u6309\u987a\u5e8f\u5199\u6587\u4ef6\uff0c\u5c3d\u6700\u5927\u80fd\u529b\u786e\u4fdd\u6d88\u606f\u53d1\u9001\u7684\u9ad8\u53ef\u7528\u6027\u4e0e\u9ad8\u541e\u5410\u91cf</li> <li>\u4e0d\u652f\u6301\u5220\u9664\u6307\u5b9a topic \u529f\u80fd\uff1a\u5bf9\u4e8e\u67d0\u4e2a topic \u7684\u4fe1\u606f\uff0c\u5728\u78c1\u76d8\u4e0a\u7684\u8868\u73b0\u662f\u4e00\u6bb5\u975e\u8fde\u7eed\u7684\u533a\u57df</li> </ul> <p></p> <p>\u83b7\u53d6\u6307\u5b9a topic \u7684\u4fe1\u606f\uff1a\u78c1\u76d8\u4e0a\u7684\u975e\u8fde\u7eed\u7684\u82e5\u5e72\u7247\u6bb5\u7684\u9ad8\u6548\u7387\u8bfb\u53d6</p> <ul> <li>Commitlog\uff1a\u6240\u6709\u7684\u6d88\u606f\u90fd\u5b58\u50a8\u5728 CommitLog \u91cc\u9762\uff0c\u5355\u4e2a CommitLog \u6587\u4ef6\u5927\u5c0f\u9ed8\u8ba4 1G</li> <li>ConsumeQueue \uff08\u7d22\u5f15\u6587\u4ef6 1\uff09\uff1a\u57fa\u4e8e topic \u7684 commitlog \u7d22\u5f15\u6587\u4ef6</li> <li> <p>ConsumeQueue \u91cc\u53ea\u5b58\u504f\u79fb\u91cf\u4fe1\u606f\uff0c\u5927\u90e8\u5206\u7684 ConsumeQueue \u80fd\u591f\u88ab\u5168\u90e8\u8bfb\u5165\u5185\u5b58\uff0c\u901f\u5ea6\u6781\u5feb</p> </li> <li> <p>IndexFile\uff08\u7d22\u5f15\u6587\u4ef6 2\uff0c\u53ef\u9009\uff09\uff1a\u901a\u8fc7 key \u6216\u65f6\u95f4\u533a\u95f4\u6765\u67e5\u8be2\u6d88\u606f\uff0c\u5e95\u5c42\u5b9e\u73b0\u4e3a hash \u7d22\u5f15</p> </li> </ul> <p></p> <p>\u504f\u79fb\u91cf\u4e3a\u4ec0\u4e48\u662f\u4e8c\u5206\u67e5\u627e\uff1f\uff1f</p>"},{"location":"data_system/messagequeue/message_platform.html#_4","title":"\u6d41\u5f0f","text":""},{"location":"data_system/messagequeue/message_platform.html#kafka2010","title":"Kafka\uff082010\uff09","text":"<p>\u751f\u4ea7\u8005\u6570\u91cf\u4e3a 1 \uff0c\u6d88\u8d39\u8005\u6570\u91cf\u4e3a 1 \uff0c\u5206\u533a\u6570\u4e3a 2\uff0c \u526f\u672c\u6570\u4e3a 3 \uff0c\u670d\u52a1\u8282\u70b9\u6570\u4e3a 3 \u7684\u67b6\u6784\u56fe</p> <ul> <li>zookeeper\uff1a\u5143\u6570\u636e\u5b58\u50a8\uff0c\u5b58\u50a8\u670d\u52a1\u8282\u70b9\u7684\u4fe1\u606f\u4ee5\u53ca\u8def\u7531\u4fe1\u606f\uff1b</li> <li>\u5206\u533a\u7684\u526f\u672c\u533a\u5206\u4e3b\u4ece\uff0c\u5199\u6570\u636e\u5148\u5199\u4e3b\u5206\u533a\uff0c\u4ece\u5206\u533a\uff08\u540c\u6b65/\u5f02\u6b65\u590d\u5236\uff09\uff1b</li> </ul> <p></p>"},{"location":"data_system/messagequeue/message_platform.html#_5","title":"\u5c40\u90e8\u987a\u5e8f\u5199","text":"<ul> <li>\u4e00\u4e2a\u5206\u533a\u4e00\u4e2a\u76ee\u5f55\uff0c\u6570\u636e\u8ffd\u52a0\u5199\uff0c\u5176\u8bbe\u8ba1\u7406\u5ff5\u4fdd\u8bc1\u4e86 kafka \u4f18\u79c0\u7684\u6c34\u5e73\u6269\u5bb9\u80fd\u529b\uff1b</li> </ul> <p>\u78c1\u76d8\u987a\u5e8f\u5199\u76d8\uff1a</p> <ul> <li>\u8ffd\u52a0\u5199\u5165\u7684\u65b9\u5f0f\uff0c\u987a\u5e8f\u5199\u76d8</li> </ul> <p>topic/partition \u6570\u91cf\u4e0d\u80fd\u8fc7\u5927</p> <ul> <li>\u5355\u8282\u70b9\u591a\u4e2aPartition\u76ee\u5f55\uff0c\u987a\u5e8f\u5199\u9000\u5316\u4e3a\u968f\u673a\u5199</li> </ul>"},{"location":"data_system/messagequeue/message_platform.html#pulsar2012","title":"Pulsar\uff082012\uff09","text":"<p>kafka \u4e0e rocketmq\uff0c\u4e00\u4e2a\u670d\u52a1\u8282\u70b9\u5373\u662f\u8ba1\u7b97\u8282\u70b9\u4e5f\u662f\u670d\u52a1\u8282\u70b9\uff0c\u8282\u70b9\u6709\u72b6\u6001\u4f7f\u5f97\u5e73\u53f0\u5316\u3001\u5bb9\u5668\u5316\u56f0\u96be\u3001\u6570\u636e\u8fc1\u79fb\u3001\u6570\u636e\u6269\u7f29\u5bb9\u7b49\u8fd0\u7ef4\u5de5\u4f5c\u90fd\u53d8\u7684\u590d\u6742\u4e14\u56f0\u96be\u3002</p> <p>kafka \u5bf9\u6bd4 pulsar \uff1a</p> <ul> <li>Kafka\u6269\u5bb9\uff1a\u524d\u4e24\u4e2a\u8282\u70b9\u5df2\u7ecf\u6ee1\u4e86\uff0c\u65b0\u52a0\u8282\u70b9\u9700\u8981\u6570\u636e\u642c\u79fb\u548c\u5e73\u8861\uff0c\u4e0d\u80fd\u7acb\u5373\u7528\u3002</li> </ul> <p>Pulsar\uff1a\u4e0d\u540c\u4e8e Kafka \u7269\u7406\u548c\u903b\u8f91\u7684\u7ed1\u5b9a\u6027\uff0c\u5b58\u50a8\u662f\u5e73\u5747\u5206\u914d\u7684\uff0c\u6bcf\u4e2a topic \u5206\u6210\u5c0f\u5757\uff0c\u5206\u5e03\u66f4\u5747\u5300\u3002\u52a0\u5165\u65b0\u7684\u8282\u70b9\u540e\uff0c\u53ef\u4ee5\u7acb\u5373\u4f7f\u7528</p> <p></p> <p>\u67b6\u6784</p> <p></p> <p>\u5206\u5c42\uff1aPulsar \u5206\u79bb\u51fa\u4e86 Broker\uff08\u670d\u52a1\u5c42\uff09\u548c Bookie\uff08\u5b58\u50a8\u5c42\uff09\u67b6\u6784\uff0cBroker \u4e3a\u65e0\u72b6\u6001\u670d\u52a1\uff0c\u7528\u4e8e\u53d1\u5e03\u548c\u6d88\u8d39\u6d88\u606f\uff0c\u800c BookKeeper \u4e13\u6ce8\u4e8e\u5b58\u50a8\u3002</p> <p>\u5206\u7247 : \u8fd9\u79cd\u5c06\u5b58\u50a8\u4ece\u6d88\u606f\u670d\u52a1\u4e2d\u62bd\u79bb\u51fa\u6765\uff0c\u4f7f\u7528\u66f4\u7ec6\u7c92\u5ea6\u7684\u5206\u7247\uff08Segment\uff09\u66ff\u4ee3\u7c97\u7c92\u5ea6\u7684\u5206\u533a\uff08Partition\uff09\uff0c\u4e3a Pulsar \u63d0\u4f9b\u4e86\u66f4\u9ad8\u7684\u53ef\u7528\u6027\uff0c\u66f4\u7075\u6d3b\u7684\u6269\u5c55\u80fd\u529b\u3002</p>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html","title":"Apache Bookkeeper","text":"<p>A scalable, fault-tolerant, and low-latency storage service optimized for real-time ( append-only )workloads.</p> <p>\u63d0\u4f9b\u65e5\u5fd7\u6761\u76ee\u6d41\u5b58\u50a8\u6301\u4e45\u5316\u7684\u670d\u52a1\u6846\u67b6\u3002</p> <p>\u4ee3\u7801\uff1ahttps://github.com/apache/bookkeeper</p>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#_1","title":"\u573a\u666f","text":"<p>\u6d41\u5b58\u50a8\u9700\u6c42</p> <p>\u4e00\u4e2a\u5b9e\u65f6\u5b58\u50a8\u5e73\u53f0\u9700\u8981\u6ee1\u8db3\u4e00\u4e0b\u6240\u6709\u7684\u9700\u6c42\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u5fc5\u987b\u53ef\u4ee5\u4ee5\u4f4e\u5ef6\u65f6\uff08\u5c0f\u4e8e5ms\uff09\u8bfb\u5199\u6d41\u6570\u636e\uff0c\u5373\u4f7f\u540c\u65f6\u8fd8\u8981\u786e\u4fdd\u6570\u636e\u7684\u6301\u4e45\u6027\u5b58\u50a8</li> <li>\u6570\u636e\u5b58\u50a8\u5fc5\u987b\u662f\u6301\u4e45\u7684\u3001\u4e00\u81f4\u7684\uff0c\u4ee5\u53ca\u53ef\u4ee5\u5bb9\u5fcd\u6545\u969c\u7684</li> <li>\u7cfb\u7edf\u9700\u8981\u80fd\u591f\u786e\u4fdd\u6570\u636e\u8bfb\u5199\u987a\u5e8f\u4e00\u81f4</li> <li>\u7cfb\u7edf\u9700\u8981\u80fd\u591f\u540c\u65f6\u63d0\u4f9b\u5bf9\u5386\u53f2\u6570\u636e\u4ee5\u53ca\u5b9e\u65f6\u6570\u636e\u7684\u8bbf\u95ee</li> </ul>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#_2","title":"\u6982\u5ff5","text":""},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#entryrecord","title":"entry(record)","text":"<p>\u4e00\u6761log\uff0c\u5305\u542b\u5143\u6570\u636e\uff0c\u6709\u5982\u4e0b\u5b57\u6bb5\uff1a</p> Field \u7c7b\u578b \u63cf\u8ff0 Ledger number long \u5c5e\u4e8e\u7684Ledger\u7684ID\u6807\u8bc6 Entry number long \u6807\u8bc6\u81ea\u8eab\u7684\u5168\u5c40\u552f\u4e00ID Last confirmed (LC) long \u4e0a\u4e00\u4e2aentry\u7684\u5168\u5c40\u552f\u4e00ID Data byte[] \u65e5\u5fd7\u6570\u636e Authentication code byte[] \u6821\u9a8c\u7801"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#ledgers","title":"ledgers","text":"<p>log\u6d41\uff0cBookKeeper\u4e2d\u7684\u57fa\u672c\u5b58\u50a8\u5355\u5143\u3002</p> <p>\u4e00\u7ec4Entries\uff0c\u6bcf\u4e2aEntry\u6709\u5e8f\u7684\u5e76\u4e14\u81f3\u591a\u4e00\u6b21\u5199\u5165\u5230Ledgers\u4e2d\uff0cAppend-Only\u3002</p> <p>\u4e00\u65e6\u5199\u5165Ledgers\uff0c\u5c06\u4e0d\u80fd\u518d\u4fee\u6539\u3002\u6240\u4ee5\uff0c\u5199\u5165\u4fdd\u6301\u6709\u5e8f\u5199\u5165\u662f\u5ba2\u6237\u7aef\u5e94\u7528\u5e94\u8be5\u8003\u8651\u7684\u4e8b\u60c5\u3002</p>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#bookie","title":"bookie","text":"<p>\u6bcf\u4e2a\u72ec\u7acb\u7684\u4fdd\u5b58ledges\u7684\u670d\u52a1\u5668\uff0c\u53ef\u4ee5\u5206\u4e3a\u4e09\u5c42\uff1a\u9876\u5c42\u662f\u7f51\u7edc\u901a\u4fe1\u5c42\uff08\u4f7f\u7528Netty\uff09\uff0c\u5e95\u5c42\u662f\u78c1\u76d8IO\u5c42\uff0c\u4e2d\u95f4\u5c42\u5305\u542b\u5927\u91cf\u7684\u7f13\u5b58\u3002</p> <p></p>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#ensemble","title":"ensemble","text":"<p>\u4e00\u4e2aEnsemble\u662f\u4e00\u4e2aBookies\u96c6\u5408\uff0c\u5b83\u4eec\u5171\u540c\u4fdd\u5b58\u7740\u4e00\u4e2aLedger\u7684\u6240\u6709entries\u3002\u901a\u5e38\u4e00\u4e2aEnsemble\u662f\u6574\u4e2aBookies\u96c6\u7fa4\u7684\u5b50\u96c6\u3002</p>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#_3","title":"\u90e8\u7f72\u56fe","text":""},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#_4","title":"\u5b9e\u73b0","text":""},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#_5","title":"\u590d\u5236","text":"<p>\u5bf9\u6240\u6709\u6570\u636e\u90fd\u4f1a\u590d\u5236\u548c\u5b58\u50a8\u76f8\u540c\u7684\u591a\u4efd\u62f7\u8d1d\u2014\u2014\u4e00\u822c\u662f\u4e09\u4efd\u6216\u662f\u4e94\u4efd\u2014\u2014\u5230\u4e0d\u540c\u7684\u673a\u5668\u4e0a\uff0c\u53ef\u4ee5\u662f\u540c\u4e00\u6570\u636e\u4e2d\u5fc3\uff0c\u4e5f\u53ef\u4ee5\u662f\u8de8\u6570\u636e\u4e2d\u5fc3\u3002</p> <p>\u4e0d\u50cf\u5176\u4ed6\u4f7f\u7528\u4e3b/\u4ece\u6216\u662f\u7ba1\u9053\u590d\u5236\u7b97\u6cd5\u5728\u526f\u672c\u4e4b\u95f4\u590d\u5236\u6570\u636e\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\uff08\u4f8b\u5982Apache HDFS\u3001Ceph\u3001Kafka\uff09\uff0cApache BookKeeper\u4f7f\u7528\u4e00\u79cd\u591a\u6570\u6295\u7968\u5e76\u884c\u590d\u5236\u7b97\u6cd5\u5728\u786e\u4fdd\u53ef\u9884\u6d4b\u7684\u4f4e\u5ef6\u65f6\u7684\u57fa\u7840\u4e0a\u590d\u5236\u6570\u636e\u3002</p> <p></p>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#bookie_1","title":"Bookie\u4e2d\u6570\u636e\u7ba1\u7406","text":"<p>\u7ba1\u7406\u6570\u636e\u4ee5log-structured\u7684\u5f62\u5f0f\uff0c\u4f7f\u7528\u4e09\u79cd\u6587\u4ef6\uff1ajournals, entry logs, index files\u3002</p>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#journals","title":"Journals","text":"<p>\u5b58\u50a8BookKeeper\u7684\u4e8b\u52a1\u65e5\u5fd7\uff0c\u5728ledger\u53d1\u751f\u66f4\u65b0\u524d\uff0cbookie\u786e\u5b9a\u4e00\u6761\u63cf\u8ff0\u66f4\u65b0\u7684\u4e8b\u52a1\u88ab\u5199\u9053\u975e\u6613\u5931\u6027\u7684\u5b58\u50a8\u4e2d\u3002</p> <p>\u65b0\u7684journal\u6587\u4ef6\u53ea\u5728bookie\u542f\u52a8\u65f6\u6216\u8005\u65e7\u7684journal\u6587\u4ef6\u5230\u8fbe\u9608\u503c\u65f6\u624d\u521b\u5efa\u3002</p>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#entry-logs","title":"Entry logs","text":"<p>\u7ba1\u7406\u4eceBookKeeper\u5ba2\u6237\u7aef\u5199\u5165\u7684entries\uff0c\u6765\u81ea\u4e0d\u540cledger\u7684entries\u4f1a\u88ab\u805a\u5408\u5e76\u987a\u5e8f\u5199\u5165\uff0c\u6bcf\u4e2aentry log\u7684\u504f\u79fb\u4ee5\u6307\u9488\u7684\u5f62\u5f0f\u5b58\u50a8\u5728<code>ledger cache</code>\u4e2d\uff0c\u4ee5\u4fbf\u5feb\u901f\u67e5\u8be2\u3002</p> <p>\u65b0\u7684entry log\u6587\u4ef6\u53ea\u5728bookie\u542f\u52a8\u65f6\u6216\u8005\u65e7\u7684entry log\u6587\u4ef6\u5230\u8fbe\u9608\u503c\u65f6\u624d\u521b\u5efa\u3002</p> <p>\u65e7\u7684entry log\u6587\u4ef6\u5f53\u4e0d\u8ddf\u4efb\u4f55active ledger\u5173\u8054\u65f6\uff0c\u4f1a\u88abGC Thread\u5220\u9664\u3002</p>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#index-files","title":"Index files","text":"<p>\u5bf9\u6bcf\u4e2aledger\u4f1a\u521b\u5efa\u4e00\u4e2a\u7d22\u5f15\u6587\u4ef6\uff0c\u7531\u4e00\u4e2aheader\u548c\u591a\u4e2aindex pages\u7ec4\u6210\u3002\u7d22\u5f15\u9875\u8bb0\u5f55\u5b58\u50a8\u5728entry log\u6587\u4ef6\u4e2d\u6570\u636e\u7684\u504f\u79fb\u91cf\u3002</p> <p>\u56e0\u4e3a\u66f4\u65b0\u7d22\u5f15\u6587\u4ef6\u4f1a\u5e26\u6765\u968f\u673a\u7684\u78c1\u76d8I/O\uff0c\u7d22\u5f15\u6587\u4ef6\u901a\u8fc7sync\u540e\u53f0\u7ebf\u7a0b\u61d2\u60f0\u5f0f\u66f4\u65b0\uff08\u4fdd\u8bc1\u66f4\u65b0\u7684\u901f\u5ea6\uff09\u3002\u5728index pages\u6301\u4e45\u5316\u5230\u78c1\u76d8\u524d\uff0c\u9700\u8981\u88ab\u805a\u96c6\u5230<code>ledger cache</code>\u4e2d\u4ee5\u4fbf\u5feb\u901f\u67e5\u8be2\u3002</p>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#ledger-cache","title":"Ledger cache","text":"<p>Ledger indexes pages \u7f13\u5b58\u5728\u5185\u5b58\u6c60\u4e2d\uff0c\u4ee5\u4fbf\u6709\u6548\u5730\u7ba1\u7406\u78c1\u76d8\u5934\u8c03\u5ea6\uff08allows for more efficient management of disk head scheduling)\u3002</p>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#entries","title":"Entries\u6dfb\u52a0","text":""},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#_6","title":"\u5143\u6570\u636e","text":"<p>\u7b2c\u4e09\u65b9\u5b58\u50a8\u7528\u4e8e\u4fdd\u5b58\u5173\u4e8eledgers\u7684\u4fe1\u606f\u8fd8\u6709\u53ef\u7528\u7684Bookies\uff08\u76f8\u5f53\u4e8e\u5206\u5e03\u5f0f\u534f\u8c03\uff09\u3002 \u76ee\u524dBookKeeper\u5229\u7528ZooKeeper\u5b9e\u73b0\u5143\u6570\u636e\u5b58\u50a8\u3002</p>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#ledger","title":"Ledger\u7ba1\u7406\u8005","text":"<p>ledger manager\u5904\u7406ledger\u7684\u5143\u6570\u636e\uff08\u5b58\u50a8\u5728ZK\u4e2d\uff09\uff0c\u63a8\u8350\u4f7f\u7528Hierarchical Ledger Manager\u3002</p> <p>ZK\u5b58\u50a8\u8def\u5f84\uff1a</p> <pre><code># \u5982/{ledgers_root_path}/00/0000/L0001\n{ledgers_root_path}/{level1}/{level2}/L{level3}\n</code></pre>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#api","title":"API","text":""},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#ledger-api","title":"Ledger API","text":"<p>Ledger API\u63d0\u4f9b\u4e86\u76f4\u63a5\u4e0eLedger\u4ea4\u4e92\u7684\u63a5\u53e3</p>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#distributedlog-api","title":"DistributedLog API","text":"<p>DistributedLog API\u4e0d\u76f4\u63a5\u4e0eledger\u4ea4\u4e92\u800c\u662f\u4e0eBookeeper\u96c6\u7fa4\u4ea4\u4e92</p>"},{"location":"data_system/messagequeue/bookkeeper/apache_bookkeeper.html#_7","title":"Apache Bookkeeper","text":""},{"location":"data_system/messagequeue/bookkeeper/conf.html","title":"Conf","text":"<p>[toc]</p>"},{"location":"data_system/messagequeue/bookkeeper/conf.html#_1","title":"\u914d\u7f6e","text":"<p>Bookie\u7684\u5185\u5b58\u5206\u914d\u5efa\u8bae\uff1a</p> <ul> <li>\u64cd\u4f5c\u7cfb\u7edf\u4fdd\u7559\uff1a2GB\uff1b</li> <li>JVM\uff1a\u5360 1 / 2\uff1b</li> <li>Heap Memory \uff1a1 / 3</li> <li>Direct Memory \uff1a2 / 3</li> <li>FileSystem Page Cache \uff1a\u5360 1 / 2</li> </ul>"},{"location":"data_system/messagequeue/kafka/index.html","title":"Kafka","text":"<p>\u5206\u5e03\u5f0f\u6d41\u5904\u7406\u5e73\u53f0</p> <p>\u6d41\u5904\u7406\u5e73\u53f0\u5177\u6709\u4e09\u4e2a\u5173\u952e\u80fd\u529b\uff1a</p> <ol> <li>\u53d1\u5e03\u548c\u8ba2\u9605\u6d88\u606f(\u6d41)\uff0c\u5728\u8fd9\u65b9\u9762\uff0c\u5b83\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u6d88\u606f\u961f\u5217\u6216\u4f01\u4e1a\u6d88\u606f\u7cfb\u7edf\u3002</li> <li>\u4ee5\u5bb9\u9519(\u6545\u969c\u8f6c\u79fb)\u7684\u65b9\u5f0f\u5b58\u50a8\u6d88\u606f(\u6d41)\u3002</li> <li>\u5728\u6d88\u606f\u6d41\u53d1\u751f\u65f6\u5904\u7406\u5b83\u4eec\u3002</li> </ol>"},{"location":"data_system/messagequeue/kafka/index.html#_1","title":"\u573a\u666f","text":"<ol> <li>\u6784\u5efa\u5b9e\u65f6\u7684\u6d41\u6570\u636e\u7ba1\u9053\uff0c\u53ef\u9760\u5730\u83b7\u53d6\u7cfb\u7edf\u548c\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u7684\u6570\u636e\u3002</li> <li>\u6784\u5efa\u5b9e\u65f6\u6d41\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5bf9\u6570\u636e\u6d41\u8fdb\u884c\u8f6c\u6362\u6216\u53cd\u5e94\u3002</li> </ol>"},{"location":"data_system/messagequeue/kafka/index.html#_2","title":"\u672f\u8bed","text":""},{"location":"data_system/messagequeue/kafka/index.html#topic","title":"Topic","text":"<p>Kafka\u5c06\u6d88\u606f\u5206\u95e8\u522b\u7c7b\uff0c\u6bcf\u4e00\u7c7b\u7684\u6d88\u606f\u79f0\u4e4b\u4e3a\u4e00\u4e2a\u4e3b\u9898\uff08Topic\uff09\u3002</p> <ul> <li>Topic/Partition \u6570\u91cf\u8fc7\u591a\uff0c\u5bfc\u81f4\u987a\u5e8f\u5199\u9000\u5316\u6210\u968f\u673a\u5199\uff1b</li> <li>\u6bcf\u4e2a Partition \u90fd\u662f\u4e00\u4e2a\u76ee\u5f55\uff1b</li> </ul>"},{"location":"data_system/messagequeue/kafka/index.html#producer","title":"Producer","text":"<p>\u53d1\u5e03\u6d88\u606f\u7684\u5bf9\u8c61\u79f0\u4e4b\u4e3a\u4e3b\u9898\u751f\u4ea7\u8005\uff08Kafka topic producer\uff09\u3002</p>"},{"location":"data_system/messagequeue/kafka/index.html#consumer","title":"Consumer","text":"<p>\u8ba2\u9605\u6d88\u606f\u5e76\u5904\u7406\u53d1\u5e03\u7684\u6d88\u606f\u7684\u5bf9\u8c61\u79f0\u4e4b\u4e3a\u4e3b\u9898\u6d88\u8d39\u8005\uff08consumers\uff09\u3002</p> <p>Consumer Group\uff08\u6d88\u8d39\u7ec4\uff09\u7684\u6982\u5ff5\uff0c\u591a\u4e2a Consumer \u7ec4\u56e2\u53bb\u6d88\u8d39\u4e00\u4e2a Topic\uff1a</p> <ul> <li>\u540c\u7ec4\u7684 Consumer \u6709\u76f8\u540c\u7684 Group ID\uff1b</li> <li>Consumer Group \u673a\u5236\u4f1a\u4fdd\u969c\u4e00\u6761\u6d88\u606f\u53ea\u88ab\u7ec4\u5185\u552f\u4e00\u4e00\u4e2a Consumer \u6d88\u8d39\uff0c\u4e0d\u4f1a\u91cd\u590d\u6d88\u8d39\u3002</li> </ul>"},{"location":"data_system/messagequeue/kafka/index.html#broker","title":"Broker","text":"<p>\u5df2\u53d1\u5e03\u7684\u6d88\u606f\u4fdd\u5b58\u5728\u4e00\u7ec4\u670d\u52a1\u5668\u4e2d\uff0c\u79f0\u4e4b\u4e3aKafka\u96c6\u7fa4\u3002\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u670d\u52a1\u5668\u90fd\u662f\u4e00\u4e2a\u4ee3\u7406\uff08Broker\uff09\u3002 \u6d88\u8d39\u8005\u53ef\u4ee5\u8ba2\u9605\u4e00\u4e2a\u6216\u591a\u4e2a\u4e3b\u9898\uff08topic\uff09\uff0c\u5e76\u4eceBroker\u62c9\u6570\u636e\uff0c\u4ece\u800c\u6d88\u8d39\u8fd9\u4e9b\u5df2\u53d1\u5e03\u7684\u6d88\u606f\u3002</p>"},{"location":"data_system/messagequeue/kafka/index.html#partition","title":"Partition","text":"<p>produce\u53d1\u9001\u7684\u6d88\u606f\u5206\u53d1\u5230\u4e0d\u540c\u7684partition\u4e2d\uff0cconsumer\u63a5\u53d7\u6570\u636e\u7684\u65f6\u5019\u662f\u6309\u7167group\u6765\u63a5\u53d7\uff1a</p> <ul> <li>\u5728\u53d1\u9001\u4e00\u6761\u6d88\u606f\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u8fd9\u6761\u6d88\u606f\u7684key\uff0cProducer\u6839\u636e\u8fd9\u4e2akey\u548cPartition\u673a\u5236\u6765\u5224\u65ad\u5e94\u8be5\u5c06\u8fd9\u6761\u6d88\u606f\u53d1\u9001\u5230\u54ea\u4e2aParition\u3002</li> <li>kafka\u786e\u4fdd\u6bcf\u4e2apartition\u53ea\u80fd\u540c\u4e00\u4e2agroup\u4e2d\u7684\u540c\u4e00\u4e2aconsumer\u6d88\u8d39\uff0c\u5982\u679c\u60f3\u8981\u91cd\u590d\u6d88\u8d39\uff0c\u90a3\u4e48\u9700\u8981\u5176\u4ed6\u7684\u7ec4\u6765\u6d88\u8d39\u3002</li> </ul> <p>Topic\u7684Partitions\u5206\u5e03\u5728\u4e0d\u540c\u7684Broker\u4e0a</p> <ul> <li>\u5355\u4e2a Broker \u7684 IO\u80fd\u529b\u53d7\u9650\uff0cPartition\u5206\u6563\u53ef\u6269\u5c55\u6027\u5f3a\uff1b</li> <li>Consumer \u7684\u591a\u4e2a\u5b9e\u4f8b\u8fde\u63a5\u4e0d\u540c broker\uff0c\u6d88\u8d39\u4e0d\u540c\u5206\u533a\u6570\u636e\uff1b</li> </ul>"},{"location":"data_system/messagequeue/kafka/index.html#_3","title":"\u67b6\u6784","text":""},{"location":"data_system/messagequeue/kafka/index.html#_4","title":"\u8bbe\u8ba1","text":""},{"location":"data_system/messagequeue/kafka/index.html#log","title":"\u65e5\u5fd7Log","text":"<p>\u5bf9\u4e8e\u6bcf\u4e2atopic\uff0cKafka\u96c6\u7fa4\u90fd\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u5206\u533alog\uff0c\u5c31\u50cf\u4e0b\u56fe\u4e2d\u6240\u793a\uff1a</p> <p></p> <p>\u6bcf\u4e00\u4e2a\u5206\u533a\u90fd\u662f\u4e00\u4e2a\u987a\u5e8f\u7684\u3001\u4e0d\u53ef\u53d8\u7684\u6d88\u606f\u961f\u5217\uff0c \u5e76\u4e14\u53ef\u4ee5\u6301\u7eed\u7684\u6dfb\u52a0\u3002\u5206\u533a\u4e2d\u7684\u6d88\u606f\u90fd\u88ab\u5206\u4e86\u4e00\u4e2a\u5e8f\u5217\u53f7\uff0c\u79f0\u4e4b\u4e3a\u504f\u79fb\u91cf(offset)\uff0c\u5728\u6bcf\u4e2a\u5206\u533a\u4e2d\u6b64\u504f\u79fb\u91cf\u90fd\u662f\u552f\u4e00\u7684\u3002</p>"},{"location":"data_system/messagequeue/kafka/index.html#_5","title":"\u5b58\u50a8","text":"<p>kafka \u5199\u6570\u636e\uff1a</p> <ul> <li>\u57fa\u4e8e OS \u5c42\u9762\u7684 Page Cache \u6765\u5199\u6570\u636e\uff1b</li> <li>\u91c7\u7528\u78c1\u76d8\u987a\u5e8f\u5199\u7684\u65b9\u5f0f\uff1b</li> </ul> <p>\u901a\u8fc7\u96f6\u62f7\u8d1d\u6280\u672f\uff0c\u5c31\u4e0d\u9700\u8981\u628a OS Cache \u91cc\u7684\u6570\u636e\u62f7\u8d1d\u5230\u5e94\u7528\u7f13\u5b58\uff0c\u518d\u4ece\u5e94\u7528\u7f13\u5b58\u62f7\u8d1d\u5230 Socket \u7f13\u5b58\u4e86\uff0c\u4e24\u6b21\u62f7\u8d1d\u90fd\u7701\u7565\u4e86\uff0c\u6240\u4ee5\u53eb\u505a\u96f6\u62f7\u8d1d\u3002</p>"},{"location":"data_system/messagequeue/kafka/index.html#_6","title":"\u5206\u533a","text":""},{"location":"data_system/messagequeue/kafka/index.html#_7","title":"\u5199","text":"<p>\u5206\u533a\u9009\u62e9\u7684\u4e09\u79cd\u65b9\u5f0f\uff1a</p> <p>1\uff09\u5199\u5165\u65f6\uff0c\u76f4\u63a5\u6307\u5b9a\u5206\u533a\uff1b</p> <p>2\uff09\u6839\u636e Partition Key \u5199\u5165\u7279\u5b9a Partition\uff0c\u4fdd\u8bc1\u6b64\u7c7b\u6d88\u606f\u7684\u6709\u5e8f\u6027</p> <ul> <li>\u7531\u7279\u5b9a Hash \u51fd\u6570\uff0c\u51b3\u5b9a\u5199\u5165\u54ea\u4e2a Partition\uff0c\u6709\u76f8\u540c Partition Key \u7684\u6d88\u606f\uff0c\u4f1a\u88ab\u653e\u5230\u76f8\u540c\u7684 Partition\uff1b</li> <li>\u70ed\u70b9\u95ee\u9898\uff0c\u67d0\u4e2a Partition \u7279\u522b\u7e41\u5fd9\uff1b</li> </ul> <p>3\uff09\u4e0d\u6307\u5b9a Key\uff0cKafka \u91c7\u7528\u8f6e\u8be2\u7684\u65b9\u5f0f\u5199\u5165\uff0c\u5206\u6563\u5747\u5300\u4f46\u4e0d\u4fdd\u8bc1\u6709\u5e8f\u6027\uff1b</p> <p>4\uff09\u81ea\u5b9a\u4e49\u89c4\u5219\uff0cProducer \u53ef\u4ee5\u4f7f\u7528\u81ea\u5df1\u7684\u5206\u533a\u6307\u5b9a\u89c4\u5219\uff1b</p>"},{"location":"data_system/messagequeue/kafka/index.html#_8","title":"\u8bfb","text":"<p>\u5206\u533a\u8bfb\u53d6\u7684\u65b9\u5f0f\uff1a</p> <ul> <li>Consumer \u5fc5\u987b\u81ea\u5df1\u4ece Topic \u7684 Partition \u6839\u636e Offset \u62c9\u53d6\u6d88\u606f\uff1b</li> <li>\u53ef\u4ee5\u6307\u5b9a\u6d88\u8d39\u7279\u5b9a\u7684\u5206\u533a\uff1b</li> <li>Offset \u7684\u63a8\u8fdb\u548c\u8bb0\u5f55\u90fd\u662f Consumer \u7684\u8d23\u4efb\uff0c\u5b9a\u671f\u4f1a\u63d0\u4ea4offset \u7ed9kafka\u5185\u90e8topic\uff1a<code>__consumer_offsets</code>\uff1b</li> <li>\u6839\u636e comsumer group \u8fdb\u884c\u533a\u5206\u4e0d\u540c\u5ba2\u6237\u7aef\uff1b</li> </ul>"},{"location":"data_system/messagequeue/kafka/usage.html","title":"Usage","text":""},{"location":"data_system/messagequeue/kafka/usage.html#kafka","title":"kafka\u547d\u4ee4","text":"<p>\u542f\u52a8</p> <pre><code>cd /home/experiment/workspace/kafka_2.11-2.2.1/bin\nnohup ./kafka-server-start.sh ../config/server.properties 2&gt;&amp;1 &amp;\n</code></pre> <p>\u5173\u95ed</p> <pre><code>cd /home/experiment/workspace/kafka_2.11-2.2.1/bin\n./kafka-server-stop.sh\n</code></pre> <p>\u521b\u5efatopic</p> <pre><code>./kafka-topics.sh \\\n--create \\\n--zookeeper 172.16.2.243:2181,172.16.2.244:2181,172.16.2.245:2181 \\\n--replication-factor 2 \\\n--partitions 6 \\\n--topic test_hudi\n</code></pre> <p>\u67e5\u770btopic\u547d\u4ee4</p> <pre><code>cd /home/experiment/workspace/kafka_2.11-2.2.1/bin\n./kafka-topics.sh \\\n--list \\\n--zookeeper 172.16.2.243:2181,172.16.2.244:2181,172.16.2.245:2181\n</code></pre> <p>\u751f\u4ea7\u8005\u751f\u4ea7\u6570\u636e</p> <pre><code>./kafka-console-producer.sh \\\n--bootstrap-server 172.16.2.243:9092,172.16.2.244:9092,172.16.2.245:9092 \\\n--topic test_hudi\n</code></pre> <p>\u6d88\u8d39\u8005\u6d88\u8d39\u6570\u636e</p> <pre><code>./kafka-console-consumer.sh \\\n--bootstrap-server 172.16.2.244:9092 \\\n--from-beginning \\\n--topic test_hudi\n</code></pre> <p>\u67e5\u770btopic\u63cf\u8ff0\u4fe1\u606f</p> <pre><code>cd /home/experiment/workspace/kafka_2.11-2.2.1/bin\n./kafka-topics.sh \\\n--describe \\\n--zookeeper master01:2181,slave02:2181,slave04:2181,slave05:2181,slave06:2181,slave07:2181 \\\n--topic train_realtime_status\n</code></pre> <p>\u589e\u52a0topic\u5206\u533a\u6570</p> <pre><code>cd /home/experiment/workspace/kafka_2.11-2.2.1/bin\n./kafka-topics.sh \\\n--zookeeper master01:2181,slave02:2181,slave04:2181,slave05:2181,slave06:2181,slave07:2181 \\\n--alter \\\n--topic train_realtime_status \\\n--partitions 8\n</code></pre> <p>\u589e\u52a0\u914d\u7f6e</p> <pre><code>cd /home/experiment/workspace/kafka_2.11-2.2.1/bin\n./kafka-topics.sh \\\n--zookeeper master01:2181,slave02:2181,slave04:2181,slave05:2181,slave06:2181,slave07:2181 \\\n--alter \\\n--topic train_realtime_status \\\n--config flush.messages=10pwd\n</code></pre> <p>\u5220\u9664\u914d\u7f6e</p> <pre><code>cd /home/experiment/workspace/kafka_2.11-2.2.1/bin\n./kafka-topics.sh \\\n--zookeeper master01:2181,slave02:2181,slave04:2181,slave05:2181,slave06:2181,slave07:2181 \\\n--alter \\\n--topic train_realtime_status \\\n--delete-config flush.messages\n</code></pre> <p>\u5220\u9664topic</p> <pre><code>./kafka-topics.sh \\\n--zookeeper 172.16.2.243:2181,172.16.2.244:2181,172.16.2.245:2181 \\\n--delete \\\n--topic test_hudi\n</code></pre>"},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html","title":"Apache Pulsar","text":"<p>\u53d1\u97f3\uff1a [\u02c8p\u028cls\u0251\u02d0(r)]</p> <p>Cloud-native distributed messaging streaming platform. \u4e91\u539f\u751f\u5206\u5e03\u5f0f\u6d88\u606f\u6d41\u5e73\u53f0</p> <p>\u91c7\u7528\u8ba1\u7b97\u4e0e\u5b58\u50a8\u5206\u79bb\u7684\u5206\u5c42\u67b6\u6784\uff08\u4e91\u539f\u751f\uff09\u8bbe\u8ba1\uff0c\u652f\u6301\u591a\u79df\u6237\u3001\u6301\u4e45\u5316\u5b58\u50a8\u3001\u591a\u673a\u623f\u8de8\u533a\u57df\u6570\u636e\u590d\u5236\uff0c\u5177\u6709\u5f3a\u4e00\u81f4\u6027\u3001\u9ad8\u541e\u5410\u4ee5\u53ca\u4f4e\u5ef6\u65f6\u7684\u9ad8\u53ef\u6269\u5c55\u6d41\u6570\u636e\u5b58\u50a8\u7279\u6027\u3002</p> <p>\u89e3\u51b3\u7684\u573a\u666f\uff1a</p> <ul> <li>\u767e\u4e07\u7ea7\u7684Topics\u652f\u6301\uff0c\u4f4e\u5ef6\u8fdf\u3001\u6301\u4e45\u5316\u3001\u8de8\u5730\u57df\u590d\u5236\uff1b</li> <li>\u89e3\u9664\u5b58\u50a8\u8ba1\u7b97\u8026\u5408\uff0c\u66ff\u6362\u673a\u5668\u3001\u670d\u52a1\u6269\u5bb9\u3001\u6570\u636ere-balance\uff1b</li> <li>\u51cf\u5c11\u6587\u4ef6\u7cfb\u7edf\u7684\u4f9d\u8d56\uff0c\u6301\u4e45\u5316\uff08fsync\uff09\u4fdd\u6301\u6570\u636e\u4e0d\u4e22\u5931\uff0c\u6027\u80fd\u4e0b\u964d\u592a\u5389\u5bb3\uff1b</li> <li>IO\u4e0d\u9694\u79bb\uff1a\u6d88\u8d39\u8005\u5728\u6e05\u695aBacklog\u7684\u65f6\u5019\u4f1a\u5f71\u54cd\u5230\u5176\u4ed6\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\uff1b</li> <li>\u8fd0\u7ef4\u592a\u75db\u82e6\uff1a\u66ff\u6362\u673a\u5668\uff0c\u670d\u52a1\u6269\u5bb9\u9700\u8981\u6f2b\u957f\u7684\u91cd\u65b0\u5747\u8861\u6570\u636e\u7684\u8fc7\u7a0b\u3002</li> </ul> <p>\u63d0\u4f9b\u7edf\u4e00\u7684 Queue\uff08\u6d88\u606f\u961f\u5217) \u548c Stream \u7684\u63a5\u53e3\u3002</p> <p>kafka\uff08stream\uff09\u548crocketmq\uff08queue\uff09\u7684\u533a\u522b\uff1a</p> <p>\uff1f\u6d88\u606f\u7684\u987a\u5e8f\u6027\uff0cProducer\u5185\u548cProducer\u95f4\u7684\u6d88\u606f\u7684\u987a\u5e8f\u6027\uff1f</p>"},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#_1","title":"\u67b6\u6784","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#broker","title":"Broker","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#producer","title":"Producer","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#consumer","title":"Consumer","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#proxies","title":"Proxies","text":"<p>\u5bf9Producer\u548cConsumer\u5c4f\u853dBroker\uff0c\u6d41\u91cf\u5168\u8d70Proxyies\u3002</p> <p>NameSpace Bundles\uff08\u5bf9Topic\u8fdb\u884cHash\uff0c\u5728Broker\u7684\u8d1f\u8f7d\u5747\u8861\uff09\uff0c\u6bcf\u4e2aBroker\u7684Bundle\u5206\u914d\u4fe1\u606f\u5b58\u50a8\u5728ZK\u4e0a\u3002</p>"},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#_2","title":"\u5b58\u50a8\u8bbe\u8ba1","text":"<p>\u5e95\u5c42\u5b58\u50a8\u57fa\u4e8eApache BookKeeper\u3002</p>"},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#_3","title":"\u5206\u533a","text":"<p>\u5355\u4e2aTopic\u5206\u6210\u591a\u4e2aPartition\u3002</p> <p>\u6bcf\u4e2aPartition\u90fd\u662f\u4e00\u4e2aEvent Stream\u3002</p>"},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#_4","title":"\u5206\u7247","text":"<p>Event Stream &lt;- Segments &lt;- Entrys &lt;- Messages\u3002</p> <p>Segment\u548cEntry\u662fApache BookKeeper\u7684\u6982\u5ff5\u3002</p>"},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#api","title":"API","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#_5","title":"\u8ba2\u9605\u6a21\u5f0f","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#exclusive","title":"Exclusive\uff08\u9ed8\u8ba4\uff09","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#failoveronly-one","title":"FailOver\uff08only one\uff09","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#sharedround-robin","title":"Shared\uff08round-robin)","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#key_sharedsame-key-same-consume","title":"Key_Shared\uff08same key, same consume\uff09","text":"<p>IOT\u7684Pulsar\uff1f</p>"},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#_6","title":"\u5bb9\u9519","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#client","title":"Client","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#broker_1","title":"Broker","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#bookie","title":"Bookie","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#_7","title":"\u8de8\u57df\u590d\u5236","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#_8","title":"\u90e8\u7f72","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#api_1","title":"API","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#cli","title":"CLI","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#_9","title":"Apache Pulsar","text":""},{"location":"data_system/messagequeue/pulsar/apache_pulsar.html#java","title":"Java","text":""},{"location":"data_system/object_system/minio.html","title":"MinIO","text":"<p>High Performance, Kubernetes Native Object Storage</p> <p>\u57fa\u4e8eGo\u8bed\u8a00\u7684\u9ad8\u6027\u80fd\u5bf9\u8c61\u5b58\u50a8\u670d\u52a1\uff0c\u5728Github\u4e0a\u5df2\u670919K+Star\u3002\u5b83\u91c7\u7528\u4e86Apache License v2.0\u5f00\u6e90\u534f\u8bae\uff0c\u975e\u5e38\u9002\u5408\u4e8e\u5b58\u50a8\u5927\u5bb9\u91cf\u975e\u7ed3\u6784\u5316\u7684\u6570\u636e\uff0c\u4f8b\u5982\u56fe\u7247\u3001\u89c6\u9891\u3001\u65e5\u5fd7\u6587\u4ef6\u3001\u5907\u4efd\u6570\u636e\u548c\u5bb9\u5668/\u865a\u62df\u673a\u955c\u50cf\u7b49\u3002</p>"},{"location":"data_system/object_system/minio.html#_1","title":"\u90e8\u7f72","text":""},{"location":"data_system/object_system/minio.html#linux","title":"Linux","text":"<pre><code>wget http://dl.minio.org.cn/server/minio/release/linux-amd64/minio\nchmod +x minio\n./minio server /data\n</code></pre>"},{"location":"data_system/object_system/minio.html#api","title":"API","text":""},{"location":"data_system/object_system/minio.html#java","title":"Java","text":"<p>https://docs.min.io/docs/java-client-api-reference</p>"},{"location":"data_system/object_system/ozone.html","title":"Ozone","text":"<p>[toc]</p>"},{"location":"data_system/object_system/ozone.html#apache-ozone","title":"Apache Ozone","text":"<p>Ozone is a scalable, redundant, and distributed object store for Hadoop.\uff08\u517c\u5bb9Hadoop, S3\u534f\u8bae\u7684\u5bf9\u8c61\u5b58\u50a8\uff09</p>"},{"location":"devops/index.html","title":"\u76f8\u5173\u6982\u5ff5\u548c\u4ea7\u54c1","text":""},{"location":"devops/index.html#_2","title":"\u4ee3\u7801\u4ed3\u5e93","text":"<p>Gitlab \u7b80\u4ecb\u548c\u5b89\u88c5</p>"},{"location":"devops/index.html#cicd","title":"CI/CD","text":"<p>Github + Github actions\uff1b</p> <p>Github + travis \u6301\u7eed\u96c6\u6210\u5de5\u5177\uff1b Softagram \uff08pull request reviews and code analysis)</p> <p>\u9700\u6c42\u63cf\u8ff0\uff1aCI / CD + GitOps + ChatOps</p> <ul> <li>\u901a\u8fc7PR\u7684\u5f62\u5f0f\u89e6\u53d1Preview\uff0c\u6267\u884c\u4e00\u7cfb\u5217\u7684\u68c0\u67e5\uff0c\u5e76\u663e\u793a\u7ed3\u679c\uff1b</li> <li>\u652f\u6301\u591a\u5957\u73af\u5883\uff08\u5f00\u53d1/\u6d4b\u8bd5/\u751f\u4ea7/\u6f14\u793a\u7b49\uff09\u7684\u90e8\u7f72\uff1b</li> </ul>"},{"location":"devops/index.html#jenkinsxcicd","title":"JenkinsX(CI/CD)","text":"<ul> <li> <p>K8s CI/CD\uff1b</p> </li> <li> <p>\u539f\u751f\u652f\u6301\u9884\u89c8\u73af\u5883\u548c gitops\uff1b</p> </li> </ul>"},{"location":"devops/index.html#tokencicd","title":"Token(CI/CD)","text":"<p>Tekton is a powerful and flexible open-source framework for creating CI/CD systems, allowing developers to build, test, and deploy across cloud providers and on-premise systems.</p>"},{"location":"devops/index.html#droneci","title":"Drone(CI)","text":"<p>Drone is a self-service Continuous Integration platform for busy development teams.</p> <ul> <li>\u652f\u6301GitHub, GitHubEnterprise, Bitbucket, and GitLab\uff1b</li> <li>\u4f7f\u7528Yaml\u4f5c\u4e3a\u914d\u7f6e\uff1b</li> </ul>"},{"location":"devops/index.html#argocdcd","title":"ArgoCD(CD)","text":"<p>Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes.</p>"},{"location":"devops/index.html#_3","title":"\u5236\u54c1\u5e93","text":""},{"location":"devops/index.html#nexus","title":"Nexus","text":"<ul> <li>NPM\uff1b</li> <li>MVN\uff1b</li> <li>PYPI\uff1b</li> <li>GO\uff1b</li> <li>DOCKER\uff1b</li> <li>HELM\uff1b</li> <li>RAW\uff1a\u53ef\u7528\u4e8e\u524d\u7aef\u6253\u5305\u51fa\u6765\u7684\u9759\u6001\u6587\u4ef6\uff1b</li> </ul>"},{"location":"devops/index.html#_4","title":"\u4ee3\u7801\u5ba1\u67e5","text":""},{"location":"devops/index.html#sonarlint","title":"SonarLint","text":""},{"location":"devops/index.html#sonarqube","title":"SonarQube","text":"<p>\u5b89\u88c5\uff1ahttps://docs.sonarqube.org/latest/setup/get-started-2-minutes/</p> <ul> <li>\u9700\u8981JDK11\uff0c\u4e14\u4ee5\u975eroot\u7528\u6237\u542f\u52a8</li> </ul> <p>\u4e0e Jenkins \u96c6\u6210</p> <p>https://www.cnblogs.com/cjsblog/p/10740840.html</p> <p>\u4e0e Jacoco \u96c6\u6210</p> <pre><code>sonar.java.coveragePlugin=jacoco\n# \u786e\u5b9axml\u6587\u4ef6\u7684\u540d\u79f0\nsonar.coverage.jacoco.xmlReportPaths=target/site/jacoco/jacoco.xml\nsonar.junit.reportsPath=target/surefire-reports\n</code></pre>"},{"location":"devops/index.html#checkstyle","title":"CheckStyle","text":""},{"location":"devops/index.html#findbugs","title":"FindBugs","text":""},{"location":"devops/index.html#codecov","title":"codecov","text":"<ul> <li>\u652f\u6301\u591a\u79cdCI\u5de5\u5177\u5982 travis\u3001gitlab-ci\u3001Jenkins\uff0c\u652f\u6301\u591a\u79cd\u8bed\u8a00\uff0c\u8fdb\u884c\u4ee3\u7801\u8986\u76d6\u7387\uff1b</li> </ul>"},{"location":"devops/index.html#gitops","title":"Gitops","text":"<p>\u89c1 gitops</p>"},{"location":"devops/index.html#chatops","title":"Chatops","text":"<p>\u89c1 chatops</p>"},{"location":"devops/index.html#github","title":"github\u5fbd\u7ae0","text":"<p>https://lpd-ios.github.io/2017/05/03/GitHub-Badge-Introduction/</p>"},{"location":"devops/action.html","title":"\u57fa\u4e8eGitlab\u7684Devops\u5b9e\u6218","text":""},{"location":"devops/action.html#_1","title":"\u6e90\u7801","text":"<p>Gitlab\u4ed3\u5e93\u90e8\u7f72\uff1a\u91c7\u7528 Gitlab \u8fdb\u884c\u6e90\u7801\u7ba1\u7406</p> <ul> <li>master \uff1a\u7248\u672c\u53d1\u5e03</li> <li>dev \uff1a\u529f\u80fd\u5f00\u53d1\u5408\u5e76\uff0c\u5408\u5e76\u5230 master</li> <li>feature\uff1a\u76f8\u5173\u529f\u80fd\u5f00\u53d1\u5206\u652f\uff0c\u5408\u5e76\u5230 dev</li> </ul> <p>\u6301\u7eed\u96c6\u6210CI\uff1a\u91c7\u7528 Gitlab CI Pipeline \u505a\u6301\u7eed\u96c6\u6210</p> <ul> <li>\u6ce8\u610f\uff1a\u65b0\u5efa\u5206\u652f\u4f1a\u89e6\u53d1 Push Webhook\uff0c\u4e0d\u5e94\u8be5\u89e6\u53d1 CI\uff1b</li> <li>\u4e0d\u8db3\uff1a\u6d4b\u8bd5MergeRequest\u662f\u5426\u53ef\u4ee5\u5408\u5e76\uff1aMerge Request Result Pipeline \u4f01\u4e1a\u7248\u53ea\u6709\uff1b</li> </ul> <p>\u7248\u672c\u81ea\u52a8\u53d1\u5e03 \uff1a\u91c7\u7528\u89c4\u8303\u7684 commit \u4fe1\u606f</p> <ul> <li>master \u5206\u652f\u51fa release \u7248\u672c\u5f62\u6210 tag\uff0c\u4ece dev \u63d0\u4ea4 PR \u5408\u5e76\uff1b</li> <li>dev \u5206\u652f\u505a\u5f00\u53d1\uff0c\u4ece feature \u5206\u652f\u63d0\u4ea4 PR \u5408\u5e76\uff0c\u51fa snapshot \u7248\u672c\uff0c\u4e0d\u53d1\u5e03\u7248\u672c\uff1b</li> <li>dev \u6d4b\u8bd5\u5b8c\u6210\u540e\uff0c\u5408\u5165 master\uff0c\u540e\u7eed\u7248\u672c\u5f00\u53d1\u5728\u53d1\u5e03\u7248\u672c\u524d\u4e0d\u5408\u5165 dev\uff1b</li> <li>master \u51fa\u7248\u672c\u540e\uff0c\u4f1a\u751f\u6210\u7248\u672ccommit\u8bb0\u5f55\uff0c\u5408\u5e76\u56de dev\uff1b</li> </ul>"},{"location":"devops/action.html#ci","title":"CI","text":"<p>\u6301\u7eed\u96c6\u6210CI\uff1a\u91c7\u7528 Gitlab CI \u505a\u6301\u7eed\u96c6\u6210</p> <ul> <li>\u96c6\u6210\u73af\u5883\u72ec\u7acb\u4e8e\u5f00\u53d1/\u6d4b\u8bd5/\u751f\u4ea7\u73af\u5883\uff1b</li> <li>\u53ef\u4ee5\u901a\u8fc7 docker runner / k8s runner\uff1b</li> </ul> <p>\u81ea\u52a8\u6784\u5efa\uff1a</p> <ul> <li> <p>feature \u5206\u652f\uff1a\u81ea\u52a8\u89e6\u53d1\u6784\u5efa\uff0c\u53d1\u5e03 SNAPSHOT \u7248\u672c \uff1f</p> </li> <li> <p>dev \u5206\u652f \uff1a\u81ea\u52a8\u89e6\u53d1\u6784\u5efa\uff0c\u53d1\u5e03 SNAPSHOT \u7248\u672c\uff1b</p> </li> <li> <p>\u6d4b\u8bd5\u4eba\u5458\u66f4\u5e0c\u671b\u624b\u52a8\u89e6\u53d1\u7248\u672c\uff1f</p> </li> <li> <p>master\uff1a\u81ea\u52a8\u89e6\u53d1\u6784\u5efa\uff0c\u53d1\u5e03 RELEASE \u7248\u672c\uff1b</p> </li> <li> <p>\u540c DEV \u5206\u652f\u8fdb\u884c\u6784\u5efa\uff0c\u4f46\u7248\u672c\u4e3a RELEASE \u7684\u7248\u672c\uff1b </p> </li> <li> <p>\u4ec5\u5bf9 master \u5206\u652f\uff0c\u6267\u884c<code>semantic-release</code>\u751f\u6210\u7248\u672cCHANGELOG\u4fe1\u606f\uff1b</p> </li> </ul> <p>\u624b\u52a8\u6784\u5efa\uff1a</p> <ul> <li>\u9009\u62e9 feature \u89e6\u53d1\u6784\u5efa\uff0c\u53d1\u5e03 SNAPSHOT \u7248\u672c\uff0c\u5728 \u5f00\u53d1 \u73af\u5883\u9a8c\u8bc1\uff1b</li> <li>\u9009\u62e9 dev \u89e6\u53d1\u6784\u5efa\uff0c\u53d1\u5e03 SNAPSHOT \u7248\u672c\uff0c\u5728 \u6d4b\u8bd5 \u73af\u5883\u9a8c\u8bc1\uff1b</li> <li>\u9009\u62e9 master \u89e6\u53d1\u6784\u5efa\uff0c\u53d1\u5e03 RELEASE \u7248\u672c\uff0c\u90e8\u7f72 \u751f\u4ea7 \u73af\u5883\uff1b</li> </ul>"},{"location":"devops/action.html#cd","title":"CD","text":"<p>\u81ea\u52a8\u90e8\u7f72\uff1aargocd \u91c7\u7528\u76d1\u542c git \u4ed3\u5e93\u7279\u5b9a\u5206\u652f\u7684\u7279\u5b9a\u76ee\u5f55\u4e0b\u7684Yaml\u7684\u5f62\u5f0f\uff0c\u81ea\u52a8\u8fdb\u884c\u90e8\u7f72\u3002</p> <p>\u91c7\u7528 master/dev/feature \u5206\u652f\u6a21\u578b \u8fdb\u884c\u5f00\u53d1\uff1a</p> <ul> <li>\u5f00\u53d1\u73af\u5883\uff1a\u76d1\u542c\u7279\u6027\u5206\u652f\u7684\u53d8\u52a8\uff1b</li> <li>argocd \u76d1\u542c\u7684\u5206\u652f\u540d\u4e0d\u652f\u6301\u6b63\u5219\uff0c\u5982\u4f55\u5904\u7406\uff1f\uff1b</li> <li>\u5f00\u53d1\u73af\u5883\u4e3b\u52a8\u63a8\u9001\uff1f</li> <li>\u6d4b\u8bd5\u73af\u5883\uff1a\u76d1\u542c dev \u5206\u652f\u7684 yaml \u53d8\u52a8\uff1b </li> <li> <p> dev \u5206\u652f\u5e76\u4e0d\u652f\u6301 Git \u53d8\u66f4\u56de\u63a8 </p> </li> <li> <p>\u751f\u4ea7\u73af\u5883\uff1a\u76d1\u542c master \u5206\u652f\u7684 yaml \u53d8\u52a8\uff1b</p> </li> </ul> <p>\u624b\u52a8\u90e8\u7f72\uff1a</p> <ul> <li>\u9009\u62e9\u624b\u5de5\u6784\u5efa\u5b8c\u6210\u540e\u7684\u76f8\u5e94\u7248\u672c\uff0c\u90e8\u7f72\u5230\u73af\u5883\uff1b</li> </ul>"},{"location":"devops/action.html#issue-tracker","title":"Issue Tracker","text":"<p>\u95ee\u9898\u8ddf\u8e2a\uff1a\u91c7\u7528Gitlab \u96c6\u6210 Jira \u8fdb\u884c\u95ee\u9898\u8ddf\u8e2a\uff08\u521b\u5efa\uff0c\u4fee\u6539\uff0c\u5173\u95ed\u7b49\uff09</p> <ul> <li>\u4f7f\u7528 dev \u4f5c\u4e3a\u9ed8\u8ba4\u5206\u652f</li> </ul>"},{"location":"devops/action.html#artifacts","title":"Artifacts","text":"<p>\u5236\u54c1\u5e93\uff1a\u91c7\u7528 nexus \u4f5c\u5236\u54c1\u5e93\uff08maven/npm/image \u7b49\uff09</p> <ul> <li>\u53ef\u9009\uff1a\u91c7\u7528 habor \u4f5c\u4e3a docker image \u5e93</li> </ul>"},{"location":"devops/action.html#notifier","title":"Notifier","text":"<p>\u4e8b\u4ef6\u901a\u77e5\uff1a\u9489\u9489\u96c6\u6210</p> <ul> <li>CI \u901a\u77e5\uff0cGitlab Webhook \u914d\u7f6e Pipeline \u7ed3\u679c\uff1b\uff08\u9489\u9489\u7684\u6781\u5f27Gitlab\u4e0d\u652f\u6301\uff09</li> <li>CD \u901a\u77e5\uff0cArgo Workflow \uff1f</li> </ul>"},{"location":"devops/action.html#checkgate","title":"CheckGate","text":""},{"location":"devops/action.html#_2","title":"\u672c\u5730","text":"<p>IDEA \u4e2d\u7684\u4ee3\u7801\u68c0\u67e5\uff1aSonarLint</p>"},{"location":"devops/action.html#_3","title":"\u670d\u52a1\u5668","text":"<p>\u4ee3\u7801\u8d28\u91cf\u7ba1\u7406\u7684\u5f00\u6e90\u5e73\u53f0\uff1aSonarQube</p> <p>Git -&gt; CI/CD(Jenkins, GitlabCI) -&gt; SonarQube + Webhook -&gt; Message Notifier </p>"},{"location":"devops/action.html#chatopstodo","title":"Chatops\uff1aTODO","text":"<ul> <li>Tekton Pipeline\uff1ahttps://github.com/jenkins-x/lighthouse/blob/main/docs/install_lighthouse_with_tekton.md</li> <li>Jenkins Job\uff1ahttps://github.com/jenkins-x/lighthouse/blob/main/docs/install_lighthouse_with_jenkins.md</li> </ul>"},{"location":"devops/ansible.html","title":"Ansible","text":"<p>Ansible\u662f\u57fa\u4e8e\u6a21\u5757\u5de5\u4f5c\u7684\uff0c\u672c\u8eab\u6ca1\u6709\u6279\u91cf\u90e8\u7f72\u7684\u80fd\u529b\u3002\u771f\u6b63\u5177\u6709\u6279\u91cf\u90e8\u7f72\u7684\u662fansible\u6240\u8fd0\u884c\u7684\u6a21\u5757\uff0cansible\u53ea\u662f\u63d0\u4f9b\u4e00\u79cd\u6846\u67b6\u3002\u4e3b\u8981\u5305\u62ec\uff1a</p> <p>(1) \u8fde\u63a5\u63d2\u4ef6connection plugins\uff1a\u8d1f\u8d23\u548c\u88ab\u76d1\u63a7\u7aef\u5b9e\u73b0\u901a\u4fe1\uff1b</p> <p>(2) host inventory\uff1a\u6307\u5b9a\u64cd\u4f5c\u7684\u4e3b\u673a\uff0c\u662f\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u5b9a\u4e49\u76d1\u63a7\u7684\u4e3b\u673a\uff1b</p> <p>(3) \u5404\u79cd\u6a21\u5757\u6838\u5fc3\u6a21\u5757\u3001command\u6a21\u5757\u3001\u81ea\u5b9a\u4e49\u6a21\u5757\uff1b</p> <p>(4) \u501f\u52a9\u4e8e\u63d2\u4ef6\u5b8c\u6210\u8bb0\u5f55\u65e5\u5fd7\u90ae\u4ef6\u7b49\u529f\u80fd\uff1b</p> <p>(5) playbook\uff1a\u5267\u672c\u6267\u884c\u591a\u4e2a\u4efb\u52a1\u65f6\uff0c\u975e\u5fc5\u9700\u53ef\u4ee5\u8ba9\u8282\u70b9\u4e00\u6b21\u6027\u8fd0\u884c\u591a\u4e2a\u4efb\u52a1\u3002</p>"},{"location":"devops/ansible.html#_1","title":"\u7279\u6027","text":"<p>\u7b80\u5355\u7684\u8fd0\u7ef4\u81ea\u52a8\u5316\u5de5\u5177\uff0c\u53ea\u9700\u8981\u4f7f\u7528<code>ssh</code>\u534f\u8bae\u8fde\u63a5\u5c31\u53ef\u4ee5\u6765\u8fdb\u884c\u7cfb\u7edf\u7ba1\u7406\uff0c\u81ea\u52a8\u5316\u6267\u884c\u547d\u4ee4\uff0c\u90e8\u7f72\u7b49\u4efb\u52a1\u3002</p> <ul> <li> <p>no agents\uff1a\u4e0d\u9700\u8981\u5728\u88ab\u7ba1\u63a7\u4e3b\u673a\u4e0a\u5b89\u88c5\u4efb\u4f55\u5ba2\u6237\u7aef\uff1b</p> </li> <li> <p>no server\uff1a\u65e0\u670d\u52a1\u5668\u7aef\uff0c\u4f7f\u7528\u65f6\u76f4\u63a5\u8fd0\u884c\u547d\u4ee4\u5373\u53ef\uff1b</p> </li> <li>modules in any languages\uff1a\u57fa\u4e8e\u6a21\u5757\u5de5\u4f5c\uff0c\u53ef\u4f7f\u7528\u4efb\u610f\u8bed\u8a00\u5f00\u53d1\u6a21\u5757\uff1b</li> <li>yaml \uff1a\u4f7f\u7528yaml\u8bed\u8a00\u5b9a\u5236\u5267\u672cplaybook\uff1b</li> <li>ssh by default\uff1a\u57fa\u4e8eSSH\u5de5\u4f5c\uff1b</li> <li>strong multi-tier solution\uff1a\u53ef\u5b9e\u73b0\u591a\u7ea7\u6307\u6325\u3002</li> </ul>"},{"location":"devops/ansible.html#_2","title":"\u7ec4\u4ef6","text":"<p>Ansible</p> <ul> <li>\u662f<code>Ansible</code>\u7684\u547d\u4ee4\u5de5\u5177\uff0c\u6838\u5fc3\u6267\u884c\u5de5\u5177\uff1b\u4e00\u6b21\u6027\u6216\u4e34\u65f6\u6267\u884c\u7684\u64cd\u4f5c\u90fd\u662f\u901a\u8fc7\u8be5\u547d\u4ee4\u6267\u884c\u3002</li> </ul> <p>Ansible Playbook</p> <ul> <li>\u4efb\u52a1\u5267\u672c\uff08\u53c8\u79f0\u4efb\u52a1\u96c6\uff09\uff0c\u7f16\u6392\u5b9a\u4e49<code>Ansible</code>\u4efb\u52a1\u96c6\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u7531<code>Ansible</code>\u987a\u5e8f\u4f9d\u6b21\u6267\u884c\uff0c<code>yaml</code>\u683c\u5f0f\u3002</li> </ul> <p>Inventory</p> <ul> <li><code>Ansible</code>\u7ba1\u7406\u4e3b\u673a\u7684\u6e05\u5355\uff0c\u673a\u5668\u7684\u4fe1\u606f\u90fd\u5b58\u653e\u5728inventory\u7ec4\u4ef6\uff0c\u9ed8\u8ba4\u662f<code>/etc/ansible/hosts</code>\u6587\u4ef6\u3002</li> </ul> <p>Modules</p> <ul> <li><code>Ansible</code>\u6267\u884c\u547d\u4ee4\u7684\u529f\u80fd\u6a21\u5757\uff0c<code>Ansible2.3</code>\u7248\u672c\u4e3a\u6b62\uff0c\u5171\u6709<code>1039</code>\u4e2a\u6a21\u5757\u3002\u8fd8\u53ef\u4ee5\u81ea\u5b9a\u4e49\u6a21\u5757\u3002</li> </ul> <p>Plugins</p> <ul> <li>\u63d2\u4ef6\uff0c\u6a21\u5757\u529f\u80fd\u7684\u8865\u5145\uff0c\u5e38\u6709\u8fde\u63a5\u7c7b\u578b\u63d2\u4ef6\uff0c\u5faa\u73af\u63d2\u4ef6\uff0c\u53d8\u91cf\u63d2\u4ef6\uff0c\u8fc7\u6ee4\u63d2\u4ef6\uff0c\u63d2\u4ef6\u529f\u80fd\u7528\u7684\u8f83\u5c11\u3002</li> </ul> <p>API</p> <ul> <li>\u63d0\u4f9b\u7ed9\u7b2c\u4e09\u65b9\u7a0b\u5e8f\u8c03\u7528\u7684\u5e94\u7528\u7a0b\u5e8f\u7f16\u7a0b\u63a5\u53e3\u3002</li> </ul>"},{"location":"devops/ansible.html#_3","title":"\u4f7f\u7528","text":""},{"location":"devops/ansible.html#ansible_1","title":"Ansible\u547d\u4ee4\u683c\u5f0f","text":""},{"location":"devops/ansible.html#ansible-playbook","title":"Ansible playbook \u547d\u4ee4","text":""},{"location":"devops/ansible.html#dry-run","title":"dry-run\u6a21\u5f0f","text":"<p>\u8be5\u6a21\u5f0f\u4e0b\uff0cAnsible \u4e0d\u4f1a\u771f\u6b63\u5730\u5728\u5b9e\u9645\u73af\u5883\u4e2d\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c\uff0c\u800c\u662f\u663e\u793a\u5728\u5b9e\u9645\u6267\u884c\u65f6\u54ea\u4e9b\u5730\u65b9\u4f1a\u88ab\u4fee\u6539\uff1a</p> <pre><code>$ ansible-playbook -i development site.yml --check --diff\n</code></pre>"},{"location":"devops/ansible.html#_4","title":"\u5e38\u7528\u6a21\u5757","text":""},{"location":"devops/ansible.html#ping","title":"Ping\u6a21\u5757","text":"<p>\u6d4b\u8bd5IP\u662f\u5426\u53ef\u4ee5\u8bbf\u95ee</p>"},{"location":"devops/ansible.html#copy","title":"Copy\u6a21\u5757","text":"<p>\u8fdc\u7a0b\u62f7\u8d1d</p>"},{"location":"devops/ansible.html#fetch","title":"Fetch\u6a21\u5757","text":"<p>\u8fdc\u7a0b\u4e3b\u673a\u4e2d\u7684\u6587\u4ef6\u62f7\u8d1d\u5230\u672c\u673a\u4e2d\uff0c\u5728\u4fdd\u5b58\u7684\u65f6\u5019\u4f7f\u7528hostname\u6765\u8fdb\u884c\u4fdd\u5b58\u3002</p>"},{"location":"devops/ansible.html#shell","title":"Shell\u6a21\u5757","text":"<p><code>/bin/sh</code>\u6267\u884c</p>"},{"location":"devops/ansible.html#command","title":"Command\u6a21\u5757","text":"<p>\u8fd0\u884c\u7cfb\u7edf\u547d\u4ee4\u3002\u4e0d\u652f\u6301\u7ba1\u9053\u7b26\u548c\u53d8\u91cf\u7b49\uff08\"&lt;\", \"&gt;\", \"|\", and \"&amp;\"\u7b49\uff09</p>"},{"location":"devops/ansible.html#raw","title":"Raw\u6a21\u5757","text":"<p>raw\u6a21\u5757\u7684\u529f\u80fd\u4e0eshell\u548ccommand\u7c7b\u4f3c\u3002\u4f46raw\u6a21\u5757\u8fd0\u884c\u65f6\u4e0d\u9700\u8981\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u914d\u7f6epython\u73af\u5883\u3002</p> <p>command \u548c shell \u6a21\u5757\u90fd\u662f\u901a\u8fc7\u76ee\u6807\u4e3b\u673a\u4e0a\u7684 python \u4ee3\u7801\u542f\u52a8  <code>/bin/bash</code> \u6765\u6267\u884c\u547d\u4ee4\u7684\uff0c\u4f46\u76ee\u6807\u4e3b\u673a\u4e0a\u53ef\u80fd\u6ca1\u6709\u5b89\u88c5 python\uff0c\u8fd9\u65f6\u53ea\u80fd\u4f7f\u7528 raw \u6a21\u5757\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u76f4\u63a5\u542f\u52a8</p>"},{"location":"devops/ansible.html#script","title":"Script \u6a21\u5757","text":"<p>\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u6267\u884c\u811a\u672c\u6587\u4ef6 \uff0c\u548c raw \u6a21\u5757\u4e00\u6837\uff0c\u4e0d\u8981\u6c42\u76ee\u6807\u4e3b\u673a\u4e0a\u5df2\u7ecf\u88c5\u597d python\u3002</p>"},{"location":"devops/ansible.html#file","title":"File\u6a21\u5757","text":"<p>\u8bbe\u7f6e\u6587\u4ef6\u3001\u94fe\u63a5\u3001\u76ee\u5f55\u7684\u5c5e\u6027\uff0c\u6216\u8005\u79fb\u9664\u6587\u4ef6\u3001\u94fe\u63a5\u3001\u76ee\u5f55\u3002</p>"},{"location":"devops/ansible.html#yum","title":"Yum\u6a21\u5757","text":"<p>\u5b89\u88c5\u5305\u7ba1\u7406\u6a21\u5757\u3002</p>"},{"location":"devops/ansible.html#cron","title":"Cron\u6a21\u5757","text":"<p>\u7ba1\u7406\u8ba1\u5212\u4efb\u52a1\u3002</p> <pre><code># \u65b0\u589e\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\nansible all -m cron -a \"name=check minute=5 job='pwd'\"\n# \u5220\u9664\u5b9a\u65f6\u4efb\u52a1\nansible all -m cron -a \"name=check state=absent\"\n</code></pre>"},{"location":"devops/ansible.html#user","title":"User\u6a21\u5757","text":"<p>useradd, userdel, usermod\u4e09\u4e2a\u6307\u4ee4\u3002\u6307\u5b9apassword\u53c2\u6570\u65f6\uff0c\u4e0d\u80fd\u4f7f\u7528\u660e\u6587\u5bc6\u7801\u3002</p>"},{"location":"devops/ansible.html#group","title":"Group\u6a21\u5757","text":"<p>groupadd, groupdel, groupmod \u4e09\u4e2a\u6307\u4ee4\u3002</p>"},{"location":"devops/ansible.html#synchronize","title":"Synchronize\u6a21\u5757","text":"<p>\u4f7f\u7528rsync\u540c\u6b65\u6587\u4ef6\u3002</p>"},{"location":"devops/ansible.html#service","title":"Service\u6a21\u5757","text":"<p>\u901a\u8fc7<code>systemctl start/stop/status nginx.service</code>\u7ba1\u7406\u670d\u52a1\uff0c\u793a\u4f8b\uff1a</p> <pre><code># \u786e\u4fddnginx\u5904\u4e8estarted \u72b6\u6001\n$ ansible localhost -b -c local -m service -a \"name=nginx state=started\"\n</code></pre>"},{"location":"devops/ansible.html#awx","title":"AWX\uff08\u53ef\u89c6\u5316\u7ba1\u7406\uff09","text":""},{"location":"devops/chatops.html","title":"Chatops","text":""},{"location":"devops/chatops.html#prow-github","title":"Prow (Github)","text":"<p>prow with gitlab (Open) : https://github.com/kubernetes/test-infra/issues/10146</p>"},{"location":"devops/chatops.html#gitlab-chatops","title":"Gitlab Chatops","text":"<p>\u57fa\u4e8e slack slash command</p>"},{"location":"devops/chatops.html#jenkinsx-lighthouse","title":"JenkinsX Lighthouse","text":""},{"location":"devops/devops.html","title":"DevOps","text":"<p>Dev + Ops\uff1a\u5f00\u53d1\u53ca\u8fd0\u7ef4</p> <p>\u80cc\u666f\uff1a\u654f\u6377\u5f00\u53d1\u4e3a\u4ee3\u8868\u7684\u6301\u7eed\u5f00\u53d1\u6a21\u5f0f</p> <ul> <li>\u8fed\u4ee3\u5f0f\u7684 \u5f00\u53d1 -&gt; \u6d4b\u8bd5 -&gt; \u4ea4\u4ed8 -&gt; \u8fd0\u7ef4\uff1b</li> </ul> <p>\u57fa\u7840\u8bbe\u65bd\u53ca\u4ee3\u7801\uff1a\u4ee3\u7801\u53ef\u4ee5\u5c06\u57fa\u7840\u8bbe\u7f6e\u7684\u914d\u7f6e\u4ee3\u7801\u5316</p> <p>\u8fd0\u7ef4\u90e8\u95e8\u7684\u4efb\u52a1\u4e0d\u662f\u786e\u4fdd\u7cfb\u7edf\u7a33\u5b9a\u3001\u5feb\u901f\u5730\u8fd0\u884c\uff0c\u800c\u662f\u786e\u4fdd\u5546\u4e1a\u7684\u6709\u6548\u6027\uff08\u5f00\u53d1\u90e8\u95e8\u4e5f\u4e00\u6837\uff09\uff1b</p> <ul> <li>\u5c0a\u91cd\uff08Respect\uff09</li> <li>\u4fe1\u4efb\uff08Trust\uff09</li> <li>\u6b63\u786e\u8ba4\u8bc6\u5931\u8d25\uff08Healthy attitude about Failure\uff09</li> <li>\u907f\u514d\u6307\u8d23\uff08Avoiding Blame\uff09</li> </ul> <p>DevOps\u4f18\u52bf\uff1a</p> <ul> <li>\u6d88\u9664\u5bf9\u4e2a\u4eba\u7684\u4f9d\u8d56\uff1b</li> <li>\u964d\u4f4e\u56e2\u961f\u95f4\u7684\u635f\u8017\uff1b</li> <li>\u63d0\u9ad8\u8d28\u91cf\uff1a\u5f00\u53d1\u548c\u8fd0\u7ef4\u56e2\u961f\uff0c\u5171\u4eab\u53d1\u5e03\u7684\u65f6\u673a\u548c\u5185\u5bb9\uff0c\u638c\u63e1\u53d1\u5e03\u5f71\u54cd\u7684\u8303\u56f4\uff0c\u4e00\u8d77\u5bf9\u670d\u52a1\u8fdb\u884c\u76d1\u63a7\uff1b</li> </ul>"},{"location":"devops/devops.html#_1","title":"\u5b9e\u8df5","text":""},{"location":"devops/devops.html#_2","title":"\u56e2\u961f\u73af\u5883\u7684\u51c6\u5907","text":""},{"location":"devops/devops.html#_3","title":"\u865a\u62df\u73af\u5883\u6784\u5efa\u5de5\u5177","text":"<p>Vagrant\uff1a\u57fa\u4e8eVirtualbox\u7684\u865a\u62df\u673a\uff0c\u7528\u4e8e\u7ba1\u7406\u865a\u62df\u673a\u751f\u547d\u5468\u671f\u7684\u547d\u4ee4\u884c\u5b9e\u7528\u7a0b\u5e8f</p> <p>Vagrant\u662f\u4e00\u4e2a\u57fa\u4e8eRuby\u7684\u5de5\u5177\uff0c\u7528\u4e8e\u521b\u5efa\u548c\u90e8\u7f72\u865a\u62df\u5316\u5f00\u53d1\u73af\u5883\u3002\u5b83 \u4f7f\u7528Oracle\u7684\u5f00\u6e90VirtualBox\u865a\u62df\u5316\u7cfb\u7edf\uff0c\u4f7f\u7528 Chef\u521b\u5efa\u81ea\u52a8\u5316\u865a\u62df\u73af\u5883\u3002</p> <ul> <li>\u5efa\u7acb\u548c\u5220\u9664\u865a\u62df\u673a</li> <li>\u914d\u7f6e\u865a\u62df\u673a\u8fd0\u884c\u53c2\u6570</li> <li>\u7ba1\u7406\u865a\u62df\u673a\u8fd0\u884c\u72b6\u6001</li> <li>\u81ea\u52a8\u914d\u7f6e\u548c\u5b89\u88c5\u5f00\u53d1\u73af\u5883</li> <li>\u6253\u5305\u548c\u5206\u53d1\u865a\u62df\u673a\u8fd0\u884c\u73af\u5883</li> </ul> <p>docker\uff1a\u8f7b\u91cf\u7ea7\u5bb9\u5668\u6280\u672f</p> <p>\u95ee\u9898\uff1a</p> <ul> <li>\u4e0d\u5bb9\u6613\u7406\u89e3\u6784\u5efa\u6b65\u9aa4\uff1ashell\u811a\u672c\u5f62\u5f0f\u63cf\u8ff0\uff0c\u4e0d\u540c\u4eba\u7f16\u5199\u65b9\u5f0f\u5dee\u522b\u5927\uff0c\u4ee3\u7801\u5316\u4e0d\u7edf\u4e00\uff1b</li> <li>\u4e0d\u80fd\u6dfb\u52a0\u65b0\u7684\u914d\u7f6e\uff1a\u96be\u4ee5\u5bf9\u5df2\u521b\u5efa\u7684\u865a\u62df\u673a\u6dfb\u52a0\u65b0\u7684\u914d\u7f6e\u9879\uff0c\u5f3a\u4f9d\u8d56shell\u811a\u672c\u548c\u6761\u4ef6\u8bed\u53e5\uff1b</li> <li>\u6784\u5efa\u6b65\u9aa4\u96be\u4ee5\u590d\u7528\uff1a\u4e0d\u540c\u73af\u5883\u53ef\u80fd\u5982IP\uff0cJVM\u5806\u7684\u53c2\u6570\u4e0d\u540c\uff0c\u5bfc\u81f4\u914d\u7f6e\u6587\u4ef6\u96be\u4ee5\u8fc1\u79fb\u548c\u590d\u7528\uff1b</li> </ul>"},{"location":"devops/devops.html#_4","title":"\u6784\u5efa\u5de5\u4f5c\u901a\u7528\u5316\uff08\u57fa\u7840\u8bbe\u7f6e\u914d\u7f6e\u7ba1\u7406\u5de5\u5177\uff09","text":"<p>Ansible \u6216\u8005<code>Chef</code>\uff1a\u58f0\u660e\u5f0f\u3001\u62bd\u8c61\u5316\u3001\u6536\u655b\u6027\u3001\u5e42\u7b49\u6027\u3001\u53ef\u79fb\u690d\u6027</p> <ul> <li>\u6d88\u9664\u73af\u5883\u6784\u5efa\u6b65\u9aa4\uff08\u4ee3\u7801\uff09\u5bf9\u4e2a\u4eba\u7684\u4f9d\u8d56\uff1b</li> <li>\u7edf\u4e00\u683c\u5f0f\u63cf\u8ff0</li> <li>\u5728\u4e0d\u540c\u7684\u73af\u5883\u4e2d\u4f7f\u7528\u76f8\u540c\u7684\u6b65\u9aa4\uff1b</li> <li>\u73af\u5883\u53d8\u91cf\u5b9a\u4e49\uff0c\u4e0d\u540c\u73af\u5883\u4e0d\u540c\u914d\u7f6e\u6587\u4ef6</li> </ul>"},{"location":"devops/devops.html#_5","title":"\u57fa\u7840\u8bbe\u65bd\u6d4b\u8bd5\u4ee3\u7801\u5316","text":"<p>Serverspec\uff08\u57fa\u4e8eruby\uff09\uff1a\u80fd\u591f\u9a8c\u8bc1\u914d\u7f6e\u7ba1\u7406\u5de5\u5177\u7684\u914d\u7f6e\u7ed3\u679c\uff08Ansible\u3001Puppet\u3001Chef\u7b49\uff09\uff0c\u53ef\u4ee5\u5b9e\u73b0\u57fa\u7840\u8bbe\u65bd\u6d4b\u8bd5\u4ee3\u7801\u5316\u81ea\u52a8\u5316\u3002</p> <ul> <li>\u56fa\u5b9a\u683c\u5f0f\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\u5217\u8868</li> <li>\u8f93\u51fa\u6d4b\u8bd5\u7ed3\u679c\u62a5\u544a\uff08\u53ef\u4ee5\u901a\u8fc7<code>coderay</code>\u7684gem\u8f6f\u4ef6\u5305\u5b9e\u73b0 html \u53ef\u89c6\u5316\u7ed3\u679c\uff09</li> </ul> <p>\u652f\u6301\u7684\u670d\u52a1\u7c7b\u578b\u548c\u65ad\u8a00\u8bed\u53e5</p> <p>Kirby, \u6700\u65b02015\uff1a\u5bf9Serverspec\u8ba1\u7b97Ansible\u4ee3\u7801\u8986\u76d6\u7387</p>"},{"location":"devops/devops.html#_6","title":"\u9879\u76ee\u4ee3\u7801\u5f00\u53d1","text":"<p>\u95ee\u9898\u70b9\uff1a</p> <ul> <li>\u5404\u4e2a\u6210\u5458\u4ee3\u7801\u89c4\u8303\u4e0d\u4e00\u81f4\uff0c\u51b2\u7a81\u4e14\u4e0d\u6613\u61c2\uff1b</li> <li>\u4ee3\u7801\u63d0\u4ea4\u51b2\u7a81\uff0c\u4ee3\u7801\u4efb\u610f\u63d0\u4ea4\uff1b</li> </ul> <p>\u89e3\u51b3\uff1a</p> <ul> <li>\u9879\u76ee\u7ba1\u7406POM\uff0c\u4f9d\u8d56\u51b2\u7a81\u3001\u7f16\u8bd1\u3001\u6253\u5305\u7b49\u65b9\u6848\uff1b</li> <li>\u63d2\u4ef6\u7edf\u4e00\u4ee3\u7801\u3001\u4ee3\u7801\u89c4\u8303\u3001\u6587\u6863\u89c4\u8303\u98ce\u683c\uff1b</li> <li>code review + merge request\u6d41\u7a0b\u5316 \uff1b</li> <li>\u81ea\u52a8\u5316\u6d4b\u8bd5\u548c\u90e8\u7f72\uff0c\u5355\u5143\u81ea\u52a8\u6d4b\u8bd5\u548c\u6d4b\u8bd5\u73af\u5883\uff1b</li> </ul> <p>\u4e0d\u540c\u7ec4\u4ef6\u4e4b\u95f4\u7684\u4ea4\u4e92\u5b9a\u4e49</p> <ul> <li> <p>\u524d\u540e\u7aef\uff1a\u9700\u8981\u5b9a\u4e49\u63a5\u53e3\u6587\u6863\uff08swagger\uff09</p> </li> <li> <p>\u670d\u52a1\u95f4\uff1a</p> </li> <li> <p>RPC\uff08thrift\uff0c grpc\uff09\uff0c\u5e8f\u5217\u5316\u91c7\u7528protobuf</p> </li> <li> <p>\u5fae\u670d\u52a1\u95f4\uff1a\u4e0a\u5c42\u4f7f\u7528\u7684json\u7684http</p> </li> </ul> <p>Scala</p> <ul> <li>scalastyle_config.xml\u914d\u7f6e\uff1b\uff08\u5e38\u7528\u7684scalastyle\u914d\u7f6e\uff09</li> <li>scalafix\uff1ascala\u4ee3\u7801\u7684\u89c4\u5219\u95ee\u9898\u68c0\u67e5\u548c\u4fee\u590d</li> <li>scalafmt\uff1a\u4ee3\u7801\u683c\u5f0f\u5316\u5de5\u5177\uff0c\u9700\u8981\u6ce8\u610f\u4e0d\u8981\u548cscalastyle\u51b2\u7a81</li> <li>scalatest\u5355\u5143\u6d4b\u8bd5\uff1b</li> </ul>"},{"location":"devops/gitops.html","title":"GitOps","text":"<p>\u4e00\u822c\u7528\u4e8e CD \u573a\u666f\uff0c\u4fdd\u8bc1\u96c6\u7fa4\u4e2d\u6700\u65b0\u7248\u672c\u7684\u90e8\u7f72\u3002</p> <p>\u4ee5\u58f0\u660e\u65b9\u5f0f\u7ba1\u7406\u5176Kubernetes\u90e8\u7f72\uff0c\u5b9a\u671f\u8f6e\u8be2\u5b58\u50a8\u5e93\u6765\u5c06\u5b58\u50a8\u5728\u6e90\u4ee3\u7801\u5b58\u50a8\u5e93\u4e2d\u7684Kubernetes manifests\u6587\u4ef6\u4e0eKubernetes\u96c6\u7fa4\u540c\u6b65\u3002</p>"},{"location":"devops/gitops.html#jenkins-k8s","title":"\u4f20\u7edf\u7684Jenkins + K8s","text":""},{"location":"devops/gitops.html#_1","title":"\u6d41\u7a0b","text":"<ul> <li>\u5f00\u53d1\u4eba\u5458\u521b\u5efa\u4ee3\u7801\u5e76\u7f16\u5199Dockerfile\u3002\u4ed6\u4eec\u8fd8\u4e3a\u5e94\u7528\u7a0b\u5e8f\u521b\u5efaKubernetes manifests\u548cHelm Charts\u3002</li> <li>\u4ed6\u4eec\u5c06\u4ee3\u7801\u63a8\u9001\u5230\u6e90\u4ee3\u7801\u5b58\u50a8\u5e93\u3002</li> <li>\u6e90\u4ee3\u7801\u5b58\u50a8\u5e93\u4f7f\u7528\u63d0\u4ea4\u540e\u7684\u94a9\u5b50\u89e6\u53d1Jenkins\u6784\u5efa\u3002</li> <li>Jenkins CI\u6d41\u7a0b\u5c06\u6784\u5efaDocker\u6620\u50cf\u548cHelm\u8f6f\u4ef6\u5305\uff0c\u5e76\u5c06\u5176\u63a8\u9001\u5230\u4f9d\u8d56\u4ed3\u5e93\u3002</li> <li>\u7136\u540e\uff0cJenkins CD\u7a0b\u5e8f\u90e8\u7f72helm charts\u5230k8s cluster\u3002</li> </ul>"},{"location":"devops/gitops.html#_2","title":"\u95ee\u9898","text":"<ul> <li>Kubernetes \u51ed\u636e\u5b58\u50a8\u5728Jenkins\u670d\u52a1\u5668\u4e2d\uff1b</li> <li>\u53ef\u4ee5\u4f7f\u7528 Jenkins \u521b\u5efa\u548c\u66f4\u6539\u914d\u7f6e\uff0c\u4f46\u65e0\u6cd5\u4f7f\u7528\u5b83\u5220\u9664\u73b0\u6709\u8d44\u6e90\uff1b</li> </ul>"},{"location":"devops/gitops.html#gitops-cd","title":"Gitops CD","text":""},{"location":"devops/gitops.html#flux-cd","title":"Flux CD","text":"<ul> <li>\u56e2\u961f\u7f16\u5199Kubernetes manifests\u5e76\u5c06\u5176\u63a8\u9001\u5230\u6e90\u4ee3\u7801\u5b58\u50a8\u5e93\u3002</li> <li>memcached pod\u5b58\u50a8\u5f53\u524d\u914d\u7f6e\u3002</li> <li>Flux\u5b9a\u671f\uff08\u9ed8\u8ba4\u4e3a\u4e94\u5206\u949f\uff09\u4f7f\u7528Kubernetes operator\u8f6e\u8be2\u5b58\u50a8\u5e93\u4ee5\u8fdb\u884c\u66f4\u6539\u3002Flux\u5bb9\u5668\u5c06\u5176\u4e0ememcached\u4e2d\u7684\u73b0\u6709\u914d\u7f6e\u8fdb\u884c\u6bd4\u8f83\u3002\u5982\u679c\u68c0\u6d4b\u5230\u66f4\u6539\uff0c\u5b83\u5c06\u901a\u8fc7\u8fd0\u884c\u4e00\u7cfb\u5217kubectl apply/delete\u547d\u4ee4\u5c06\u914d\u7f6e\u4e0e\u96c6\u7fa4\u540c\u6b65\u3002\u7136\u540e\uff0c\u5b83\u5c06\u6700\u65b0\u7684\u5143\u6570\u636e\u518d\u6b21\u5b58\u50a8\u5728memcached\u5b58\u50a8\u4e2d\u3002</li> </ul>"},{"location":"devops/gitops.html#argo-cd","title":"Argo CD","text":"<p>\u89c1 Argo CD</p>"},{"location":"devops/grafana.html","title":"Grafana","text":"<p>\u9ed8\u8ba4\u7684\u4f7f\u7528\u7684\u662f\u5d4c\u5165\u5f0fSQLite\uff0c\u76f4\u63a5\u5728\u672c\u5730\u5b58\u50a8\uff0c\u53ef\u4ee5\u4fee\u6539\u5982\u4e0b\u914d\u7f6e\uff1a</p> <pre><code># Either \"mysql\", \"postgres\" or \"sqlite3\", it's your choice\ntype = sqlite3\nhost = 127.0.0.1:3306\nname = grafana\nuser = root\n# If the password contains # or ; you have to wrap it with triple quotes. Ex \"\"\"#password;\"\"\"\npassword =\n# Use either URL or the previous fields to configure the database\n# Example: mysql://user:secret@host:port/database\nurl =\n</code></pre>"},{"location":"devops/grafana.html#_1","title":"\u6570\u636e\u6e90","text":""},{"location":"devops/grafana.html#prometheus","title":"Prometheus","text":""},{"location":"devops/grafana.html#graphite","title":"Graphite","text":"<p>\u5bf9\u63a5 graphite-web</p>"},{"location":"devops/grafana.html#opentsdb","title":"OpenTSDB","text":"<p>\u5bf9\u63a5 opentsdb http</p>"},{"location":"devops/grafana.html#elasticsearch","title":"ElasticSearch","text":""},{"location":"devops/log_collector.html","title":"\u65e5\u5fd7\u6536\u96c6","text":"<p>\u7528\u4e8e\u5c06\u670d\u52a1\uff08\u8fdb\u7a0b\uff09\u7684\u65e5\u5fd7\uff0c\u7edf\u4e00\u6536\u96c6\uff0c\u5e76\u53d1\u9001\u5230\u4e0b\u6e38\u3002</p>"},{"location":"devops/log_collector.html#logstash","title":"logstash","text":""},{"location":"devops/log_collector.html#input","title":"Input","text":"<p>input\u6570\u636e\u8f93\u5165\u7aef\uff0c\u53ef\u4ee5\u63a5\u6536\u6765\u81ea\u4efb\u4f55\u5730\u65b9\u7684\u6e90\u6570\u636e</p> <p>1\uff1afile\uff1a\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6</p> <p>2\uff1asyslog\uff1a\u76d1\u542c\u5728514\u7aef\u53e3\u7684\u7cfb\u7edf\u65e5\u5fd7\u4fe1\u606f\uff0c\u5e76\u89e3\u6790\u6210RFC3164\u683c\u5f0f</p> <p>3\uff1aredis\uff1a\u4eceredis-server list \u4e2d\u83b7\u53d6</p> <p>4\uff1abeat\uff1a\u63a5\u6536\u6765\u81eaFilebeat\u7684\u4e8b\u4ef6</p>"},{"location":"devops/log_collector.html#filter","title":"Filter","text":"<p>filter\u6570\u636e\u4e2d\u8f6c\u5c42\uff0c\u4e3b\u8981\u8fdb\u884c\u683c\u5f0f\u5904\u7406\uff0c\u6570\u636e\u7c7b\u578b\u8f6c\u6362\u3001\u6570\u636e\u8fc7\u6ee4\u3001\u5b57\u6bb5\u6dfb\u52a0\uff0c\u4fee\u6539\u7b49\uff0c\u4e3b\u8981\u7528\u505a\u8fc7\u6ee4</p> <p>1\uff1agrok: \u901a\u8fc7\u6b63\u5219\u89e3\u6790\u548c\u7ed3\u6784\u5316\u4efb\u4f55\u6587\u672c\u3002Grok \u76ee\u524d\u662flogstash\u6700\u597d\u7684\u65b9\u5f0f\u5bf9\u975e\u7ed3\u6784\u5316\u65e5\u5fd7\u6570\u636e\u89e3\u6790\u6210\u7ed3\u6784\u5316\u548c\u53ef\u67e5\u8be2\u5316\u3002logstash\u5185\u7f6e\u4e86120\u4e2a\u5339\u914d\u6a21\u5f0f\uff0c\u6ee1\u8db3\u5927\u90e8\u5206\u9700\u6c42\u3002</p> <p>2\uff1amutate: \u5728\u4e8b\u4ef6\u5b57\u6bb5\u6267\u884c\u4e00\u822c\u7684\u8f6c\u6362\u3002\u53ef\u4ee5\u91cd\u547d\u540d\u3001\u5220\u9664\u3001\u66ff\u6362\u548c\u4fee\u6539\u4e8b\u4ef6\u5b57\u6bb5\u3002</p> <p>3\uff1adrop: \u5b8c\u5168\u4e22\u5f03\u4e8b\u4ef6\uff0c\u5982debug\u4e8b\u4ef6\u3002</p> <p>4\uff1aclone: \u590d\u5236\u4e8b\u4ef6\uff0c\u53ef\u80fd\u6dfb\u52a0\u6216\u8005\u5220\u9664\u5b57\u6bb5\u3002</p> <p>5\uff1ageoip: \u6dfb\u52a0\u6709\u5173IP\u5730\u5740\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u3002</p>"},{"location":"devops/log_collector.html#output","title":"Output","text":"<p>output\u662flogstash\u5de5\u4f5c\u7684\u6700\u540e\u4e00\u4e2a\u9636\u6bb5\uff0c\u8d1f\u8d23\u5c06\u6570\u636e\u8f93\u51fa\u5230\u6307\u5b9a\u4f4d\u7f6e\uff0c\u517c\u5bb9\u5927\u591a\u6570\u5e94\u7528</p> <p>1\uff1aelasticsearch: \u53d1\u9001\u4e8b\u4ef6\u6570\u636e\u5230 Elasticsearch\uff0c\u4fbf\u4e8e\u67e5\u8be2\uff0c\u5206\u6790\uff0c\u7ed8\u56fe\u3002</p> <p>2\uff1afile: \u5c06\u4e8b\u4ef6\u6570\u636e\u5199\u5165\u5230\u78c1\u76d8\u6587\u4ef6\u4e0a\u3002</p> <p>3\uff1amongodb:\u5c06\u4e8b\u4ef6\u6570\u636e\u53d1\u9001\u81f3\u9ad8\u6027\u80fdNoSQL mongodb\uff0c\u4fbf\u4e8e\u6c38\u4e45\u5b58\u50a8\uff0c\u67e5\u8be2\uff0c\u5206\u6790\uff0c\u5927\u6570\u636e\u5206\u7247\u3002</p> <p>4\uff1aredis:\u5c06\u6570\u636e\u53d1\u9001\u81f3redis-server\uff0c\u5e38\u7528\u4e8e\u4e2d\u95f4\u5c42\u6682\u65f6\u7f13\u5b58\u3002</p> <p>5\uff1agraphite: \u53d1\u9001\u4e8b\u4ef6\u6570\u636e\u5230graphite</p> <p>6\uff1astatsd: \u53d1\u9001\u4e8b\u4ef6\u6570\u636e\u5230 statsd\u3002</p>"},{"location":"devops/monitor.html","title":"\u8282\u70b9\u76d1\u63a7","text":"<p>\u76d1\u63a7\u4e0d\u80fd\u53ea\u662f\u5404\u79cd\u6570\u636e\u7684\u91c7\u96c6\u548c\u7f57\u5217\uff0c\u4e0d\u4ec5\u4ec5\u662f\u5f04\u82e5\u5e72\u4e2a\u62a5\u8868\u5e76\u8fdb\u4e00\u6b65\u914d\u7f6e\u6210\u4eea\u8868\u76d8\uff0c\u800c\u662f\u6709\u4e00\u5b9a\u667a\u80fd\uff0c\u4eff\u7167\u6211\u4eec\u65e5\u5e38\u7684\u6392\u67e5\u95ee\u9898\u601d\u8def\uff0c\u5efa\u7acb\u4e00\u5b9a\u89c4\u5219\uff0c\u81ea\u52a8\u68c0\u67e5\uff0c\u6df1\u5ea6\u68c0\u67e5\uff0c\u53cb\u60c5\u63d0\u793a\u3002</p>"},{"location":"devops/monitor.html#statd","title":"Statd","text":"<p>StatsD \u662f\u4e00\u4e2a NodeJs \u7684 daemon \u7a0b\u5e8f\uff0c\u901a\u8fc7 UDP \u6216\u8005 TCP \u65b9\u5f0f\u4fa6\u542c\u5404\u79cd\u7edf\u8ba1\u4fe1\u606f\uff0c\u5305\u62ec\u8ba1\u6570\u5668\u548c\u5b9a\u65f6\u5668\uff0c\u5e76\u53d1\u9001\u805a\u5408\u4fe1\u606f\u5230\u540e\u7aef\u670d\u52a1\u3002</p>"},{"location":"devops/monitor.html#node-exporter","title":"Node exporter","text":"<p>Prometheus \u751f\u6001\uff0c\u7528\u4e8e\u83b7\u53d6\u8282\u70b9\u7684\u57fa\u672c\u8fd0\u884c\u4fe1\u606f\u3002</p>"},{"location":"devops/monitor.html#monit","title":"Monit\uff08\u7cfb\u7edf\u76d1\u63a7\u548c\u7ba1\u7406\u5de5\u5177\uff09","text":"<p>Monit \u662f\u4e00\u4e2aLinux/UNIX\u7cfb\u7edf\u4e0a\u5f00\u6e90\u7684\u8fdb\u7a0b\u3001\u6587\u4ef6\u3001\u76ee\u5f55\u548c\u6587\u4ef6\u7cfb\u7edf\u76d1\u63a7\u548c\u7ba1\u7406\u5de5\u5177\uff0c\u53ef\u81ea\u52a8\u7ef4\u62a4\u548c\u4fee\u590d\u4e00\u4e9b\u9519\u8bef\u7684\u60c5\u51b5\u3002</p> <p>Monit\u4f7f\u7528C\u8bed\u8a00\u7f16\u5199\u800c\u6210\uff0c\u5904\u7406\u6548\u7387\u975e\u5e38\u7684\u9ad8\uff0c\u5360\u7528\u8d44\u6e90\u975e\u5e38\u5c11\uff08\u51e0\u4e4e\u4e0d\u5360\u7528\u8d44\u6e90\uff09\uff0c\u914d\u7f6e\u53c2\u6570\u5341\u5206\u7684\u7b80\u5355\uff0c\u53ea\u4f7f\u7528\u51e0\u4e2aif \u2026 then\u2026\u8bed\u53e5\u5c31\u53ef\u4ee5\u5b8c\u6210\u76d1\u63a7\u4efb\u52a1\u3002\u5c24\u5176\u9002\u7528\u4e8e\u5bf9\u67d0\u4e9b\u8fdb\u7a0b\u8fdb\u884c\u5b88\u62a4\u3002\u4f8b\u5982\uff1a\u5728\u68c0\u6d4b\u5230http\u670d\u52a1\u4e0d\u6b63\u5e38\u65f6\uff0c\u81ea\u52a8\u91cd\u542fapache\u6216nginx \u3002</p> <p>Monit\u662f\u5355\u673a\u7684\u5f00\u6e90\u5de5\u5177\uff0cM/Monit\u662f\u5206\u5e03\u5f0f\u7684\u6536\u8d39\u4f01\u4e1a\u7248\u3002</p>"},{"location":"devops/monitor.html#_2","title":"\u4f7f\u7528\u6587\u6863","text":"<p>https://mmonit.com/monit/documentation/monit.html</p>"},{"location":"devops/monitor.html#zabbix","title":"Zabbix\uff08\u5206\u5e03\u5f0f\u7cfb\u7edf\u76d1\u89c6\u4ee5\u53ca\u7f51\u7edc\u76d1\u89c6\uff09","text":"<p>\u57fa\u4e8eWEB\u754c\u9762\u7684\u63d0\u4f9b\u5206\u5e03\u5f0f\u7cfb\u7edf\u76d1\u89c6\u4ee5\u53ca\u7f51\u7edc\u76d1\u89c6\u529f\u80fd\u7684\u4f01\u4e1a\u7ea7\u7684\u5f00\u6e90\u89e3\u51b3\u65b9\u6848\uff0c\u91c7\u7528C/S\u67b6\u6784\u3002</p> <p>Zabbix \u901a\u8fc7 JMX \u652f\u6301 Java \u5e94\u7528\u7a0b\u5e8f\u76d1\u63a7\uff1b\u901a\u8fc7 IPMI \u652f\u6301\u786c\u4ef6\u8bbe\u5907\u76d1\u63a7\uff1b\u901a\u8fc7 SNMP \u652f\u6301\u7f51\u7edc\u8bbe\u5907\u3002</p>"},{"location":"devops/monitor.html#_3","title":"\u7ec4\u4ef6","text":"<p>Zabbix Agent \u8fd0\u884c\u5728\u88ab\u76d1\u63a7\u8bbe\u5907\u4e0a\uff0c\u8d1f\u8d23\u548c Zabbix Server \u901a\u4fe1\u83b7\u53d6\u548c\u63a7\u5236\u88ab\u76d1\u63a7\u8bbe\u5907\uff0c\u5b83\u6709\u4e3b\u52a8\u548c\u88ab\u52a8\u4e24\u79cd\u5de5\u4f5c\u6a21\u5f0f\u3002</p> <p>Zabbix Server \u4f5c\u4e3a\u76d1\u63a7\u6838\u5fc3\uff0c\u53ef\u4ee5\u76f4\u63a5\u4e0e Zabbix Agent \u8fde\u63a5\u4e5f\u53ef\u4ee5\u901a\u8fc7 Zabbix Proxy \u8fdb\u884c\u8fde\u63a5\uff0c\u518d\u7531 Zabbix Proxy \u8fde\u63a5 Zabbix Agent\u3002\u540e\u9762\u8fd9\u79cd\u65b9\u5f0f\u7528\u5728\u5206\u5e03\u5f0f\u76d1\u63a7\u7684\u573a\u666f\u3002</p> <p>Zabbix Server \u83b7\u53d6\u7684\u6570\u636e\u5b58\u653e\u5230 Zabbix Server \u7684\u6570\u636e\u5e93\u4e2d\uff0cZabbix UI\uff08Web\uff09\u53ef\u4ee5\u8bfb\u53d6\u670d\u52a1\u5668\u4e2d\u7684\u6570\u636e\uff0c\u901a\u8fc7\u56fe\u8868\u7684\u65b9\u5f0f\u5c55\u793a\u51fa\u6765\u3002</p>"},{"location":"devops/monitor.html#_4","title":"\u4f7f\u7528\u6587\u6863","text":"<p>https://www.zabbix.com/documentation/current/manual</p>"},{"location":"devops/monitor.html#netdata","title":"netdata\uff08\u5b9e\u65f6\u7684\u8d44\u6e90\u76d1\u63a7\u5de5\u5177\uff09","text":"<p>\u5b9e\u65f6\u7684\u8d44\u6e90\u76d1\u63a7\u5de5\u5177\uff0c\u5b83\u62e5\u6709\u57fa\u4e8e web \u7684\u53cb\u597d\u754c\u9762\uff0c\u901a\u8fc7\u56fe\u8868\u6765\u4e86\u89e3 CPU\uff0cRAM\uff0c\u786c\u76d8\uff0c\u7f51\u7edc\uff0cApache\uff0c Postfix \u7b49\u8f6f\u786c\u4ef6\u7684\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u3002</p> <p>\u4ec5\u4ec5\u652f\u6301\u901a\u8fc7 Web \u754c\u9762\u8fdb\u884c\u5b9e\u65f6\u76d1\u63a7\uff0c\u975e\u5e76\u884c\u7684\u53ef\u89c6\u5316\uff08\u5373\u5355\u8282\u70b9\u6027\u80fd\u72ec\u7acb\u5c55\u793a\uff09\u3002</p> <p>\u53ef\u4ee5\u88ab\u96c6\u6210\u5230\u5df2\u7ecf\u5b58\u5728\u7684\u76d1\u63a7\u5de5\u5177\u4e2d\uff08Prometheus, Graphite, OpenTSDB, Kafka, Grafana, etc\uff09\u3002</p>"},{"location":"devops/monitor.html#_5","title":"\u96c6\u7fa4\u76d1\u63a7","text":"<p>netdata\u672c\u8eab\u4e0d\u5b58\u5728\u4e3b\u4ece\u670d\u52a1\uff0c\u5728\u6bcf\u4e00\u4e2a\u8282\u70b9\u4e0a\u90fd\u9700\u8981\u5b8c\u6574\u90e8\u7f72netdata\u3002</p>"},{"location":"devops/monitor.html#netdatacloud","title":"netdata.cloud","text":"<p>\u4f7f\u7528\u540c\u4e00\u8d26\u53f7\u767b\u9646\u5230netdata.cloud\uff08\u9700\u8981\u79d1\u5b66\u4e0a\u7f51\uff09\uff0c\u5404\u4e2a\u8282\u70b9\u4e4b\u95f4\u5c31\u53ef\u4ee5\u8f7b\u677e\u901a\u8fc7\u4e00\u4e2a\u8d26\u53f7\u63a7\u5236\u3002</p> <ul> <li>netdata.cloud\u53ea\u662f\u5e2e\u4f60\u8bb0\u5f55\u6bcf\u4e2a\u8282\u70b9\u7684\u4fe1\u606f\uff0c\u800c\u63a7\u5236\u9762\u677f\u5728\u83b7\u53d6\u6bcf\u4e2a\u8282\u70b9\u7684\u6570\u636e\u7684\u65f6\u5019\uff0c\u662f\u7531\u524d\u7aef\u76f4\u63a5\u4ece\u5404\u4e2a\u8282\u70b9\u768419999\u7aef\u53e3\u83b7\u53d6\u6570\u636e\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u5fc5\u987b\u8981\u6253\u5f00\u7aef\u53e3\uff0c\u5f00\u542fdashboard\uff0c\u5141\u8bb8\u7ba1\u7406\u5458\u67e5\u770b\u6570\u636e\u3002</li> </ul>"},{"location":"devops/monitor.html#_6","title":"\u8282\u70b9\u76d1\u63a7","text":""},{"location":"devops/nexus.html","title":"Nexus","text":"<p>Nexus \uff1aManage binaries and build artifacts across your software supply chain.</p> <p>\u4ee5\u4e0b\u4ee5 Nexus 3 \u4e3a\u4f8b\uff1a</p>"},{"location":"devops/nexus.html#_1","title":"\u529f\u80fd","text":"<ul> <li>\u652f\u6301 apt, conda, docker, go, helm, maven, npm, pypi, r, raw, rubygem, yum\u7684\u6e90\u7ba1\u7406</li> </ul>"},{"location":"devops/nexus.html#raw-repositories","title":"Raw repositories","text":"<p>\u5728Nexus 3\u4e2d\u652f\u6301\u4e00\u79cd\u65b0\u7684\u65b9\u5f0f\uff1araw repositories\uff1a</p> <ul> <li>\u5229\u7528\u8fd9\u79cd\u65b9\u5f0f\uff0c\u4efb\u4f55\u6587\u4ef6\u90fd\u53ef\u4ee5\u50cfMaven\u7ba1\u7406\u5bf9\u8c61\u6587\u4ef6\u90a3\u6837\u88ab\u7ba1\u7406\u8d77\u6765\uff0c\u5bf9\u6240\u6709\u7684artifacts\u8fdb\u884c\u7edf\u4e00\u96c6\u6210\u7ba1\u7406\u3002</li> </ul> <p>\u53ef\u4ee5\u901a\u8fc7 shell\uff0c\u8fdb\u884c\u4e0a\u4f20\u5904\u7406\uff1a</p> <p><code>curl -v --user 'admin:admin123' --upload-file ./nacos-server-2.0.3.zip http://172.16.1.217:8081/repository/website/a/weba-0.1.zip</code></p> <p>\u94fe\u63a5\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u5e76\u4e0b\u8f7d\u3002</p>"},{"location":"devops/nexus.html#_2","title":"\u5b89\u88c5","text":"<p>https://help.sonatype.com/repomanager3/product-information/download</p>"},{"location":"devops/nexus.html#_3","title":"\u914d\u7f6e","text":""},{"location":"devops/nexus.html#_4","title":"\u914d\u989d\u9650\u5236\uff08\uff1f\uff09","text":""},{"location":"devops/prometheus.html","title":"Prometheus","text":"<p>\u670d\u52a1\u76d1\u63a7\u7cfb\u7edf\u548c\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u5e93\u3002</p> <p>\u4e00\u4e2a\u76d1\u63a7\u7cfb\u7edf\uff0c\u5b83\u4e0d\u4ec5\u4ec5\u5305\u542b\u4e86\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u5e93\uff0c\u8fd8\u6709\u5168\u5957\u7684\u6293\u53d6\u3001\u68c0\u7d22\u3001\u7ed8\u56fe\uff08\u96c6\u6210Grafana\uff09\u3001\u62a5\u8b66\u7684\u529f\u80fd\u3002</p> <p>\u65f6\u95f4\u6233\u662f Prometheus \u7684\u91c7\u96c6\uff08Pull\uff09\u65f6\u95f4\u3002</p>"},{"location":"devops/prometheus.html#_1","title":"\u67b6\u6784","text":""},{"location":"devops/prometheus.html#_2","title":"\u57fa\u672c\u539f\u7406","text":"<p>Prometheus\u7684\u57fa\u672c\u539f\u7406\u662f\u901a\u8fc7HTTP\u534f\u8bae\u5468\u671f\u6027\u6293\u53d6\u88ab\u76d1\u63a7\u7ec4\u4ef6\u7684\u72b6\u6001\u3002</p>"},{"location":"devops/prometheus.html#_3","title":"\u670d\u52a1\u8fc7\u7a0b","text":"<ul> <li>Prometheus Daemon\u8d1f\u8d23\u5b9a\u65f6\u53bb\u76ee\u6807\u4e0a\u6293\u53d6metrics(\u6307\u6807)\u6570\u636e\uff0c\u6bcf\u4e2a\u6293\u53d6\u76ee\u6807\u9700\u8981\u66b4\u9732\u4e00\u4e2ahttp\u670d\u52a1\u7684\u63a5\u53e3\u7ed9\u5b83\u5b9a\u65f6\u6293\u53d6\u3002Prometheus\u652f\u6301\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u3001\u6587\u672c\u6587\u4ef6\u3001Zookeeper\u3001Consul\u3001DNS SRV Lookup\u7b49\u65b9\u5f0f\u6307\u5b9a\u6293\u53d6\u76ee\u6807\u3002Prometheus\u91c7\u7528PULL\u7684\u65b9\u5f0f\u8fdb\u884c\u76d1\u63a7\uff0c\u5373\u670d\u52a1\u5668\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u76ee\u6807PULL\u6570\u636e\u6216\u8005\u95f4\u63a5\u5730\u901a\u8fc7\u4e2d\u95f4\u7f51\u5173\u6765Push\u6570\u636e\u3002</li> <li>Prometheus\u5728\u672c\u5730\u5b58\u50a8\u6293\u53d6\u7684\u6240\u6709\u6570\u636e\uff0c\u5e76\u901a\u8fc7\u4e00\u5b9a\u89c4\u5219\u8fdb\u884c\u6e05\u7406\u548c\u6574\u7406\u6570\u636e\uff0c\u5e76\u628a\u5f97\u5230\u7684\u7ed3\u679c\u5b58\u50a8\u5230\u65b0\u7684\u65f6\u95f4\u5e8f\u5217\u4e2d\u3002</li> <li>Prometheus\u652f\u6301\u5f88\u591a\u65b9\u5f0f\u7684\u56fe\u8868\u53ef\u89c6\u5316\uff0c\u4f8b\u5982Grafana\u3001\u81ea\u5e26\u7684Promdash\u4ee5\u53ca\u81ea\u8eab\u63d0\u4f9b\u7684\u6a21\u7248\u5f15\u64ce\u7b49\u7b49\u3002Prometheus\u8fd8\u63d0\u4f9bHTTP API\u7684\u67e5\u8be2\u65b9\u5f0f\uff0c\u81ea\u5b9a\u4e49\u6240\u9700\u8981\u7684\u8f93\u51fa\u3002</li> <li>PushGateway\u652f\u6301Client\u4e3b\u52a8\u63a8\u9001metrics\u5230PushGateway\uff0c\u800cPrometheus\u53ea\u662f\u5b9a\u65f6\u53bbGateway\u4e0a\u6293\u53d6\u6570\u636e\u3002</li> <li>Alertmanager\u662f\u72ec\u7acb\u4e8ePrometheus\u7684\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u652f\u6301Prometheus\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u63d0\u4f9b\u5341\u5206\u7075\u6d3b\u7684\u62a5\u8b66\u65b9\u5f0f\u3002</li> </ul>"},{"location":"devops/prometheus.html#_4","title":"\u4e09\u5927\u5957\u4ef6","text":"<ul> <li>Server \u4e3b\u8981\u8d1f\u8d23\u6570\u636e\u91c7\u96c6\u548c\u5b58\u50a8\uff0c\u63d0\u4f9bPromQL\u67e5\u8be2\u8bed\u8a00\u7684\u652f\u6301\u3002</li> <li>Alertmanager \u8b66\u544a\u7ba1\u7406\u5668\uff0c\u7528\u6765\u8fdb\u884c\u62a5\u8b66\u3002</li> <li>Push Gateway \u652f\u6301\u4e34\u65f6\u6027Job\u4e3b\u52a8\u63a8\u9001\u6307\u6807\u7684\u4e2d\u95f4\u7f51\u5173\u3002</li> </ul>"},{"location":"devops/prometheus.html#_5","title":"\u670d\u52a1\u53d1\u73b0","text":"<p><code>prometheus</code>\u662f\u901a\u8fc7server\u7aef\u914d\u7f6e\u91cc\u7684<code>targets</code>\u6765\u83b7\u53d6\u76d1\u63a7\u5bf9\u8c61\u7684\uff0ctargets \u4f9d\u8d56discovery\u6a21\u5757\u8fdb\u884c\u83b7\u53d6\u6e90\u3002</p>"},{"location":"devops/prometheus.html#_6","title":"\u9759\u6001\u914d\u7f6e","text":"<p>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6<code>prometheus.yml</code>\uff0c\u7136\u540e\u91cd\u542f Prometheus</p> <pre><code>  - job_name: 'nodes'\n    static_configs:    #\u9759\u6001\u914d\u7f6e\n    - targets:\n       - 172.16.78.12:9100  #node_exporter\u542f\u52a8\u7aef\u53e3\n       - 172.16.78.18:9100\n       - 172.16.78.13:9100\n</code></pre>"},{"location":"devops/prometheus.html#_7","title":"\u52a8\u6001\u53d1\u73b0","text":"<p>\u57fa\u4e8e\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u81ea\u52a8\u53d1\u73b0\u3001\u68c0\u6d4b\u3001\u5206\u7c7b\u53ef\u88ab\u76d1\u63a7\u7684\u5404target\uff0c\u76ee\u524d\u652f\u6301:</p> <ul> <li>\u6587\u4ef6\uff08\u5b9e\u65f6\uff09\u3001HTTP\uff08\u8f6e\u8be2\uff09\uff1b</li> <li>consul\uff0ceureka\uff0czookeeper\uff1b</li> <li>DNS\uff0cK8s\uff1b</li> </ul>"},{"location":"devops/prometheus.html#k8stodo","title":"K8s(TODO)","text":""},{"location":"devops/prometheus.html#_8","title":"\u96c6\u7fa4\u76d1\u63a7","text":"<p>\u8054\u90a6\u673a\u5236</p> <ul> <li>\u4e3b\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u914d\u7f6e\u4ece\u8282\u70b9\u7684\u5730\u5740\u6c60\uff0c\u4e3b\u8282\u70b9\u53ea\u8981\u5b9a\u65f6\u5411\u4ece\u8282\u70b9\u62c9\u53d6\u6570\u636e\u5373\u53ef\uff0c\u4e3b\u8282\u70b9\u7684\u4f5c\u7528\u5c31\u662f\u5b58\u8d2e\u5b9e\u65f6\u6570\u636e\uff0c\u5e76\u63d0\u4f9b\u7ed9grafana \u4f7f\u7528\u3002\u800c\u4ece\u8282\u70b9\u4f5c\u7528\u5c31\u662f\u5206\u522b\u4ece\u4e0d\u540c\u7684\u5404\u4e2a\u91c7\u96c6\u7aef\u4e2d\u62bd\u53d6\u6570\u636e\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5206\u673a\u5668\u6216\u8005\u5206\u89d2\u8272\u3002</li> </ul> <p>Prometheus\u793e\u533a\u63d0\u4f9b\u4e86\u8fdc\u7a0b\u8bfb\u5199\u4e24\u4e2a\u63a5\u53e3\uff0c\u4f7f\u7528\u4e00\u4e9b\u793e\u533a\u7684\u65f6\u5e8f\u6570\u636e\u5e93\u65b9\u6848\uff0c\u6765\u6269\u5c55prometheus\u3002</p> <p>\u5b9e\u73b0\u5bf9\u6bd4</p>"},{"location":"devops/prometheus.html#thanos","title":"Thanos","text":""},{"location":"devops/prometheus.html#cortex","title":"Cortex","text":"<p>A horizontally scalable, highly available, multi-tenant, long term Prometheus</p>"},{"location":"devops/prometheus.html#_9","title":"\u90e8\u7f72","text":"<p>yaml \u914d\u7f6e</p> <pre><code>global:\n  scrape_interval:     15s # By default, scrape targets every 15 seconds.\n\n  # Attach these labels to any time series or alerts when communicating with\n  # external systems (federation, remote storage, Alertmanager).\n  external_labels:\n    monitor: 'codelab-monitor'\n\n# A scrape configuration containing exactly one endpoint to scrape:\n# Here it's Prometheus itself.\nscrape_configs:\n  # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.\n  - job_name: 'prometheus'\n    # Override the global default and scrape targets from this job every 5 seconds.\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['localhost:9090']\n    metrics_path: '/metrics/executors/prometheus'\n</code></pre> <pre><code>docker pull prom/node-exporter\ndocker run -d -p 9100:9100 \\\n  -v \"/proc:/host/proc:ro\" \\\n  -v \"/sys:/host/sys:ro\" \\\n  -v \"/:/rootfs:ro\" \\\n  prom/node-exporter\n\ndocker pull prom/prometheus\ndocker run  -d \\\n  -p 9090:9090 \\\n  -v /home/workspace/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml  \\\n  prom/prometheus\n</code></pre>"},{"location":"devops/prometheus.html#_10","title":"\u914d\u7f6e","text":"<p>\u542f\u52a8\u65f6\uff1a<code>--storage.tsdb.retention=90d</code>\uff0c\u6570\u636e\u7684\u4fdd\u7559\u65f6\u95f4\u3002</p> <pre><code>global:\n  scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.\n  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.\n  # scrape_timeout is set to the global default (10s).\n\n# Alertmanager configuration\nalerting:\n  alertmanagers:\n  - static_configs:\n    - targets:\n      # - alertmanager:9093\n\n# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.\nrule_files:\n  # - \"first_rules.yml\"\n  # - \"second_rules.yml\"\n\n# A scrape configuration containing exactly one endpoint to scrape:\n# Here it's Prometheus itself.\nscrape_configs:\n  # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.\n  - job_name: 'prometheus'\n    # metrics_path defaults to '/metrics'\n    # scheme defaults to 'http'.\n    static_configs:\n    - targets: ['localhost:9090']\n</code></pre>"},{"location":"devops/prometheus.html#gateway","title":"Gateway","text":"<p>\u5141\u8bb8\u4e34\u65f6\u548c\u6279\u5904\u7406\u4f5c\u4e1a\u5411 Prometheus \u66b4\u9732\u5176\u6307\u6807</p> <ul> <li>Pushgateway  \u6301\u4e45\u5316\u63a8\u9001\u7ed9\u5b83\u7684\u76d1\u63a7\u6570\u636e\uff0c\u5373\u4f7f\u76d1\u63a7\u5df2\u4e0b\u7ebf\uff0cPrometheus \u8fd8\u4f1a\u62c9\u53d6\u5230\u65e7\u6570\u636e\uff0c\u9700\u624b\u52a8\u6e05\u7406 Pushgateway \u4e0d\u8981\u7684\u6570\u636e\u3002</li> </ul> <p>\u5ba2\u6237\u7aef\u4f7f\u7528push\u7684\u65b9\u5f0f\u4e0a\u62a5\u76d1\u63a7\u6570\u636e\u5230<code>pushgateway</code>\uff0c<code>prometheus</code>\u4f1a\u5b9a\u671f\u4ece<code>pushgateway</code>\u62c9\u53d6\u6570\u636e\u3002</p> <p>\u573a\u666f\uff1a</p> <ul> <li>Prometheus \u91c7\u7528 pull \u6a21\u5f0f\uff0c\u53ef\u80fd\u7531\u4e8e\u4e0d\u5728\u4e00\u4e2a\u5b50\u7f51\u6216\u8005\u9632\u706b\u5899\u539f\u56e0\uff0cPrometheus \u65e0\u6cd5\u62c9\u53d6\u6570\u636e\uff1b</li> <li>\u6ca1\u6709\u7aef\u53e3\u53ef\u4ee5\u66b4\u9732metrics\uff0c\u6216\u8005Job\u542f\u52a8\u5468\u671f\u592a\u77ed\uff1b</li> </ul> <p>\u52a3\u52bf\uff1a</p> <ul> <li>gateway\u4f1a\u6210\u4e3a\u74f6\u9888\uff0c\u5355\u70b9\u6545\u969c\uff1b</li> <li>\u4e22\u5931\u81ea\u52a8\u7684\u5b9e\u4f8b\u76d1\u63a7\uff0c\u53ea\u80fd\u76d1\u63a7\u5230 gateway \u72b6\u6001\uff1b</li> <li>\u5fc5\u987b\u624b\u52a8\u5220\u9664\u4efb\u4f55\u8fc7\u65f6\u7684\u6307\u6807\uff0c\u5426\u5219 Prometheus \u4f1a\u4e00\u76f4\u62c9\u53d6\u5230\u65e7\u6570\u636e\u3002</li> </ul>"},{"location":"devops/prometheus.html#gateway_1","title":"Gateway \u914d\u7f6e","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b Pushgateway \u4e0d\u4fdd\u7559\u6307\u6807\uff1a</p> <ul> <li><code>--persistence.file</code> \u6807\u5fd7\u5141\u8bb8\u6307\u5b9a\u4e00\u4e2a\u6587\u4ef6\uff0c\u5c06\u63a8\u9001\u7684\u6307\u6807\u4fdd\u5b58\u5728\u5176\u4e2d\uff0c\u8fd9\u6837\u5f53 Pushgateway \u91cd\u65b0\u542f\u52a8\u540e\u6307\u6807\u4ecd\u7136\u5b58\u5728\u3002</li> </ul>"},{"location":"devops/prometheus.html#prometheus_1","title":"Prometheus\u914d\u7f6e","text":"<p><code>/etc/prometheus/prometheus.yml</code></p> <pre><code>  - job_name: \"pushgateway\" \n    honor_labels: true          #\u68c0\u6d4b\u662f\u5426\u6709\u91cd\u590d\u7684\u6807\u7b7e\n    static_configs:\n    - targets: [\"127.0.0.1:19090\"]\n</code></pre> <p>\u5f53prometheus\u62c9\u53d6\u76ee\u6807\u65f6\uff0c\u5b83\u4f1a\u81ea\u52a8\u6dfb\u52a0\u4e00\u4e9b\u6807\u7b7e\u5230\u65f6\u95f4\u5e8f\u5217\u4e2d\uff0c\u7528\u4e8e\u6807\u8bc6\u88ab\u62c9\u53d6\u7684\u76ee\u6807\uff1a</p> <ul> <li>job\uff1a\u76ee\u6807\u6240\u5c5e\u7684\u4efb\u52a1\u540d\u79f0</li> <li>instance\uff1atargets\u7684 ip:port</li> </ul> <p>\u4ece pushgateway \u6293\u53d6\u7684\u6307\u6807\u7684<code>instance</code> label \u4e3a pushgateway \u7684\u4e3b\u673a\u548c\u7aef\u53e3\u914d\u7f6e\u3002\u8fd9\u53ef\u80fd\u4f1a\u548c\u4f60\u9644\u52a0\u63a8\u9001\u5230 Pushgateway \u6307\u6807\u4e0a\u7684 <code>job</code> \u548c <code>instance</code> \u6807\u7b7e\u51b2\u7a81\uff0c\u8fd9\u4e2a\u65f6\u5019 Prometheus \u4f1a\u5c06\u8fd9\u4e9b\u6807\u7b7e\u91cd\u547d\u540d\u4e3a <code>exported_job</code> \u548c <code>exported_instance</code>\u3002</p> <p>\u5e0c\u671b\u4fdd\u7559\u63a8\u9001\u5230 Pushgateway \u7684\u6307\u6807\u7684 <code>job</code> \u548c <code>instance</code> \u6807\u7b7e\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ea\u9700\u8981\u5728 Pushgateway \u7684\u6293\u53d6\u914d\u7f6e\u4e2d\u8bbe\u7f6e <code>honor_labels: true</code>\u3002</p>"},{"location":"devops/prometheus.html#_11","title":"\u4f7f\u7528","text":"<p>Prometheus Client SDK \u63a8\u9001\u548c API \u63a8\u9001\u3002</p>"},{"location":"devops/prometheus.html#_12","title":"\u81ea\u5b9e\u73b0","text":"<p>https://github.com/prometheus/client_java#exporting</p>"},{"location":"devops/prometheus.html#_13","title":"\u6570\u636e\u683c\u5f0f","text":"<p>metrics\u6570\u636e\u90fd\u5305\u542b\uff1a\u6307\u6807\u540d\u79f0\u3001\u6807\u7b7e\u548c\u91c7\u6837\u6570\u636e\u3002</p> <ul> <li>\u6307\u6807\u540d\u79f0\uff1a\u652f\u6301ASCII\u5b57\u7b26\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf\u548c\u5192\u53f7\uff0c\u5982<code>node_cpu_seconds_total</code>\uff1b</li> <li>\u6807\u7b7e\uff1aK/V\u683c\u5f0f\uff0c\u533a\u5206\u4e0d\u540c\u7684\u5b9e\u4f8b\uff0c\u5982<code>node_network_receive_bytes_total{device=\"eth0\"} #\u8868\u793aeth0\u7f51\u5361\u7684\u6570\u636e</code>\uff1b</li> <li>\u91c7\u6837\u6570\u636e\uff1a\u5305\u62ec\u4e00\u4e2afloat64\u503c\uff0c\u548c\u6beb\u79d2\u7ea7\u7684unix\u65f6\u95f4\u6233\uff1b</li> </ul>"},{"location":"devops/prometheus.html#metric","title":"Metric\u7c7b\u578b","text":"<p>Counter\uff08\u8ba1\u6570\u5668\uff09\uff0cGauge\uff08\u4eea\u8868\u76d8\uff09\uff0cHistogram\uff08\u76f4\u65b9\u56fe\uff09\uff0cSummary\uff08\u6458\u8981\uff09</p>"},{"location":"devops/sealer.html","title":"Sealer\uff08\u96c6\u7fa4\u4ea4\u4ed8\uff09","text":"<p>\u628a\u6574\u4e2a\u96c6\u7fa4\u770b\u6210\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u628akubernetes\u770b\u6210\u4e91\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5438\u53d6docker\u8bbe\u8ba1\u7cbe\u9ad3\u5b9e\u73b0\u5206\u5e03\u5f0f\u8f6f\u4ef6\u955c\u50cf\u5316\u6784\u5efa\u3001\u4ea4\u4ed8\u3001\u8fd0\u884c\u3002</p>"},{"location":"devops/sealer.html#_1","title":"\u7b80\u4ecb","text":"<p>\u5b98\u65b9\u5730\u5740\uff1ahttps://github.com/sealerio/sealer/blob/main/docs/README_zh.md</p> <p>Docker \u955c\u50cf\u5f88\u597d\u5730\u89e3\u51b3\u4e86\u5355\u5e94\u7528\u7684\u6253\u5305\u95ee\u9898\uff0c\u4f46\u662f\u6ca1\u6709\u89e3\u51b3\u5206\u5e03\u5f0f\u5e94\u7528\u7684\u955c\u50cf\u95ee\u9898\u3002</p> <p>Helm \u8fd9\u7c7b\u7f16\u6392\u5de5\u5177\u89e3\u51b3\u4e86\u7f16\u6392\u95ee\u9898\uff0c\u6ca1\u6709\u89e3\u51b3\u6253\u5305\u95ee\u9898\u3002</p> <p>sealer[\u02c8si\u02d0l\u0259r] \u662f\u4e00\u6b3e\u5206\u5e03\u5f0f\u5e94\u7528\u6253\u5305\u4ea4\u4ed8\u8fd0\u884c\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u901a\u8fc7\u628a\u5206\u5e03\u5f0f\u5e94\u7528\u53ca\u5176\u6570\u636e\u5e93\u4e2d\u95f4\u4ef6\u7b49\u4f9d\u8d56\u4e00\u8d77\u6253\u5305\u4ee5\u89e3\u51b3\u5e94\u7528\u6574\u4e2a\u96c6\u7fa4\u6574\u4f53\u4ea4\u4ed8\u95ee\u9898\u3002</p> <p>sealer\u6784\u5efa\u51fa\u6765\u7684\u4ea7\u7269\u6211\u4eec\u79f0\u4e4b\u4e3a\"\u96c6\u7fa4\u955c\u50cf\"\uff0c\u96c6\u7fa4\u955c\u50cf\u91cc\u5185\u5d4c\u4e86\u4e00\u4e2akubernetes\uff0c\u89e3\u51b3\u4e86\u5206\u5e03\u5f0f\u5e94\u7528\u7684\u4ea4\u4ed8\u4e00\u81f4\u6027\u95ee\u9898\u3002 \u96c6\u7fa4\u955c\u50cf\u53ef\u4ee5push\u5230registry\u4e2d\u5171\u4eab\u7ed9\u5176\u4ed6\u7528\u6237\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u5728\u5b98\u65b9\u4ed3\u5e93\u4e2d\u627e\u5230\u975e\u5e38\u901a\u7528\u7684\u5206\u5e03\u5f0f\u8f6f\u4ef6\u76f4\u63a5\u4f7f\u7528\u3002</p> <p>Docker\u53ef\u4ee5\u628a\u4e00\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7684 rootfs+\u5e94\u7528 build\u6210\u4e00\u4e2a\u5bb9\u5668\u955c\u50cf\uff0csealer\u628akubernetes\u770b\u6210\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5728\u8fd9\u4e2a\u66f4\u9ad8\u7684\u62bd\u8c61\u7eac\u5ea6\u4e0a\u505a\u51fa\u6765\u7684\u955c\u50cf\u5c31\u662f\u96c6\u7fa4\u955c\u50cf\u3002 </p> <p></p>"},{"location":"devops/sealer.html#_2","title":"\u6982\u5ff5","text":"<ul> <li>CloudImage : \u7c7b\u4f3cDocker\u955c\u50cf\uff0c\u4f46\u662frootfs\u662fk8s\uff0c\u5305\u542b\u5e94\u7528\u7684\u6240\u6709\u4f9d\u8d56\uff08\u5982docker \u955c\u50cf\uff0cyaml \u6587\u4ef6 \u6216\u8005 helm chart\u7b49)\uff1b</li> <li>Kubefile : \u63cf\u8ff0\u5982\u4f55\u6784\u5efaCloudImage\u7684\u6587\u4ef6\uff1b</li> <li>Clusterfile : \u914d\u7f6e\u6587\u4ef6\uff0c\u4f7f\u7528CloudImage\u8fd0\u884c\u4e00\u4e2a\u96c6\u7fa4\u7684\u914d\u7f6e\uff1b</li> <li>applicationImage\uff1a\u5e94\u7528\u955c\u50cf\uff0c \u4e0d\u542b\u5e95\u5c42\u7684k8s\uff0c\u4f46\u662f\u53ea\u80fd\u90e8\u7f72\u5728sealer\u5b89\u88c5\u7684k8s\u96c6\u7fa4\u4e2d\uff1b</li> </ul>"},{"location":"devops/sealer.html#1-sealer-v085","title":"1. sealer \u4f7f\u7528(v0.8.5)","text":""},{"location":"devops/sealer.html#11-k8sdemo","title":"1.1 \u5b89\u88c5k8s\u96c6\u7fa4demo","text":"<p>sealer\u53ef\u4ee5\u901a\u8fc7\u4e00\u6761\u547d\u4ee4\u5b89\u88c5\u4e00\u4e2akubernetes\u96c6\u7fa4\uff0c\u4ec5\u9700\u8981\u63d0\u4f9bIP\u5217\u8868\u548cssh\u8bbf\u95ee\u5bc6\u7801</p> <ul> <li>\u9700\u8981\u4e00\u4e2a\u5e72\u51c0linux\u96c6\u7fa4</li> <li>masters\uff1amaster\u5730\u5740\u5217\u8868\uff0c\u652f\u6301\u5355\u673a\u548cmaster\u96c6\u7fa4</li> <li>nodes\uff1anode\u5730\u5740\u5217\u8868\uff0c\u53ef\u4ee5\u4e3a\u7a7a</li> <li>passwd\uff1assh\u8bbf\u95ee\u5bc6\u7801\uff0c\u66f4\u591a\u914d\u7f6e\u5982\u7aef\u53e3\u53f7\u4e0d\u4e00\u81f4\u6216\u8005\u6bcf\u53f0\u4e3b\u673a\u4e0d\u4e00\u81f4\u53ef\u4ee5\u4f7f\u7528<code>Clusterfile</code>\uff0c\u8fdb\u884c\u989d\u5916\u914d\u7f6e</li> </ul> <pre><code># \u5b89\u88c5sealer\nwget https://github.com/sealerio/sealer/releases/download/v0.8.5/sealer-v0.8.5-linux-amd64.tar.gz &amp;&amp; \\\ntar zxvf sealer-v0.8.5-linux-amd64.tar.gz &amp;&amp; mv sealer /usr/bin\n# \u5b89\u88c5kubernetes\u96c6\u7fa4\nsealer run kubernetes:v1.19.8 --masters 192.168.0.2,192.168.0.3,192.168.0.4 --nodes 192.168.0.5,192.168.0.6,192.168.0.7 --passwd xxx\n</code></pre> <p></p>"},{"location":"devops/sealer.html#12","title":"1.2 \u589e\u52a0\u8282\u70b9","text":"<pre><code># \u589e\u52a0master\u8282\u70b9\nsealer join --masters 192.168.0.2\n# \u589e\u52a0node\u8282\u70b9\nsealer join --nodes 192.168.0.3\n# \u5220\u9664master\u8282\u70b9\nsealer delete --masters 192.168.0.2\n# \u5220\u9664node\u8282\u70b9\nsealer delete --nodes 192.168.0.3\n</code></pre>"},{"location":"devops/sealer.html#13","title":"1.3 \u91ca\u653e\u96c6\u7fa4","text":"<p>\u57fa\u7840\u8bbe\u7f6e\u7684\u4e00\u4e9b\u6e90\u4fe1\u606f\u4f1a\u88ab\u5199\u5165\u5230Clusterfile\u4e2d\uff0c\u5b58\u50a8\u5728<code>/root/.sealer/[cluster-name]/Clusterfile</code>\u4e2d, \u6240\u4ee5\u53ef\u4ee5\u8fd9\u6837\u91ca\u653e\u96c6\u7fa4\uff1a</p> <pre><code>sealer delete -f /root/.sealer/my-cluster/Clusterfile\n# \u6216\nsealer delete --all\n</code></pre> <ul> <li>Clusterfile\u5185\u5bb9\u683c\u5f0f</li> </ul> <p></p>"},{"location":"devops/sealer.html#2","title":"2. \u5b9a\u5236\u5316\u4ea4\u4ed8","text":""},{"location":"devops/sealer.html#21-dashboard","title":"2.1 \u6784\u5efa\u4e00\u4e2a\u5305\u542bdashboard\u7684\u81ea\u5b9a\u4e49\u96c6\u7fa4\u955c\u50cf","text":"<p>\u7ecf\u5e38\u4f1a\u6709\u8fd9\u6837\u7684\u9700\u6c42\uff0c\u5c31\u662f\u6709\u4e9b\u7528\u6237\u9700\u8981\u96c6\u7fa4\u5e26\u4e0adashboard, \u6709\u4e9b\u4eba\u9700\u8981calico\u6709\u4e9b\u6709\u9700\u8981flannel\uff0c\u90a3\u5982\u4f55\u8ba9\u7528\u6237\u81ea\u5b9a\u4e49\u81ea\u5df1\u60f3\u8981\u7684\u96c6\u7fa4\uff1f </p> <p>Sealer\u6700\u51fa\u8272\u7684\u5730\u65b9\u662f\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u7684\u8ba9\u7528\u6237\u81ea\u5b9a\u4e49\u4e00\u4e2a\u96c6\u7fa4\u7684\u955c\u50cf\uff0c\u901a\u8fc7\u50cfDockerfile\u4e00\u6837\u7684\u6587\u4ef6\u6765\u63cf\u8ff0\u548cbuild\u3002</p> <p>\u8fd9\u91cc\u4ee5\u6784\u5efa\u4e00\u4e2a\u5305\u542bdashboard\u7684\u96c6\u7fa4\u955c\u50cf\u4e3a\u4f8b\uff0crecommended.yaml\u5c31\u662f\u5305\u542bdashboard\u7684deployment service\u7b49yaml\u6587\u4ef6\u3002</p> <ul> <li>\u8fd9\u91cc\u9700\u8981\u63d0\u524d\u5728\u670d\u52a1\u5668\u767b\u9646\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93\u8d26\u53f7</li> </ul> <p>Kubefile\u6587\u4ef6\u5185\u5bb9\uff1a</p> <pre><code>FROM registry.cn-qingdao.aliyuncs.com/sealer-io/kubernetes:v1.19.8\nCOPY recommended.yaml manifests/recommended.yaml\nCMD kubectl apply -f manifests/recommended.yaml\n</code></pre> <ul> <li>\u901a\u8fc7sealer\u547d\u4ee4\u6784\u5efa\u955c\u50cf</li> </ul> <pre><code>sealer build -t hc-k8s-dashboard:v1.19.8 .\n</code></pre> <ul> <li>\u901a\u8fc7sealer\u547d\u4ee4\u67e5\u770b\u955c\u50cf</li> </ul> <pre><code>sealer images\n</code></pre> <p></p> <ul> <li>\u955c\u50cf\u5236\u4f5c\u5b8c\u6210\u540e\u53ef\u4ee5\u63a8\u9001\u5230Harbor\u955c\u50cf\u4ed3\u5e93\u4e2d\uff0c\u63a8\u9001\u524d\u9700\u5148\u767b\u9646harbor\u4ed3\u5e93</li> </ul> <pre><code>sealer push 172.16.2.132:30002/starfish/hc-k8s-dashboard:v1.19.8\n</code></pre> <p></p> <p></p>"},{"location":"devops/sealer.html#22","title":"2.2 \u8fd0\u884c\u7b2c\u4e00\u6b65\u6784\u5efa\u597d\u7684\u5b9a\u5236\u955c\u50cf","text":"<ul> <li>\u4e00\u884c\u547d\u4ee4\u8fd0\u884c</li> </ul> <pre><code>sealer run 172.16.2.132:30002/starfish/hc-k8s-dashboard:v1.19.8 --masters 192.168.0.2,192.168.0.3,192.168.0.4 --nodes 192.168.0.5,192.168.0.6,192.168.0.7 --passwd xxx\n</code></pre>"},{"location":"devops/cicd/argo-cd.html","title":"Argo","text":"<p>Open source tools for Kubernetes to run workflows, manage clusters, and do GitOps right.</p>"},{"location":"devops/cicd/argo-cd.html#_1","title":"\u7ec4\u4ef6","text":"<ul> <li>Argo Workflows - Container-native Workflow Engine\uff08\u5728<code>\u5de5\u4f5c\u6d41</code>\u5f15\u64ce\u4e2d\u8fdb\u884c\u4ecb\u7ecd\uff09</li> <li>Argo CD - Declarative GitOps Continuous Delivery</li> <li>Argo Events - Event-based Dependency Manager</li> <li>Argo Rollouts - Progressive Delivery with support for Canary and Blue Green deployment strategies</li> </ul>"},{"location":"devops/cicd/argo-cd.html#argo-cd","title":"Argo CD","text":"<p>Application definitions, configurations, and environments should be declarative and version controlled. </p> <p>Application deployment and lifecycle management should be automated, auditable, and easy to understand.</p>"},{"location":"devops/cicd/argo-cd.html#_2","title":"\u529f\u80fd","text":"<ul> <li>\u652f\u6301\u591a\u79cd\u591a\u4e2a Git \u6e90\u4ed3\u5e93\uff1b</li> <li>\u80fd\u591f\u7ba1\u7406\u548c\u90e8\u7f72\u5230\u591a\u4e2a\u96c6\u7fa4\uff1b</li> <li>\u7528\u4e8e\u6388\u6743\u7684\u591a\u79df\u6237\u548c RBAC \u7b56\u7565\uff1b</li> <li>\u5e94\u7528\u8d44\u6e90\u5065\u5eb7\u72b6\u6001\u5206\u6790\uff1b</li> <li>\u81ea\u52a8\u914d\u7f6e\u504f\u5dee\u68c0\u6d4b\u548c\u53ef\u89c6\u5316\uff1b</li> <li>\u81ea\u52a8\u6216\u624b\u52a8\u5c06\u5e94\u7528\u7a0b\u5e8f\u540c\u6b65\u5230\u6240\u9700\u72b6\u6001\uff1b</li> <li>\u63d0\u4f9b\u5e94\u7528\u7a0b\u5e8f\u6d3b\u52a8\u7684\u5b9e\u65f6\u89c6\u56fe\u7684 Web UI\uff1b</li> <li>\u7528\u4e8e\u81ea\u52a8\u5316\u548c CI \u96c6\u6210\u7684 CLI\uff1b</li> <li>Webhook \u96c6\u6210\uff08GitHub\u3001BitBucket\u3001GitLab\uff09\uff1b</li> <li> <p>\u5e94\u7528\u7a0b\u5e8f\u4e8b\u4ef6\u548c API \u8c03\u7528\u7684\u5ba1\u8ba1\u8ddf\u8e2a\uff1b</p> </li> <li> <p>\uff1f\u5982\u4f55\u83b7\u53d6\u955c\u50cf\uff0c\u8fdb\u884c\u6784\u5efa\uff1b</p> </li> </ul> <p>\u652f\u6301\u7684k8s manifests\u65b9\u5f0f\uff1a</p> <ul> <li>kustomize \u5e94\u7528\uff1b</li> <li>helm charts\uff1b</li> <li>Git \u4ed3\u5e93\u4e2d\u7279\u5b9a\u76ee\u5f55\u4e0b\u7684YAML/json manifests\uff0c\u5305\u62ec jsonnnet \u6587\u4ef6\uff1b</li> <li>\u914d\u7f6e\u4e3a\u914d\u7f6e\u7ba1\u7406\u63d2\u4ef6\u7684\u4efb\u4f55\u81ea\u5b9a\u4e49\u914d\u7f6e\u7ba1\u7406\u5de5\u5177</li> </ul>"},{"location":"devops/cicd/argo-cd.html#_3","title":"\u67b6\u6784","text":"<ul> <li>\u4f5c\u4e3a<code>kubernetes controller</code>\uff1b</li> </ul> <p>API Server\uff1a a gRPC/REST server\uff1b</p> <ul> <li>invoking of application operations</li> <li>application management and status reporting</li> <li>listener/forwarder for Git webhook events</li> </ul> <p>Repository Server\uff1aan internal service which maintains a local cache of the Git repository holding the application manifests\uff1b</p> <p>Application Controller\uff1aKubernetes controller which continuously monitors running applications and compares the current, live state against the desired target state</p>"},{"location":"devops/cicd/argo-cd.html#_4","title":"\u5b89\u88c5","text":"<p>\u4f9d\u8d56\uff1a</p> <ul> <li><code>kubectl</code> \uff1b</li> <li>kubeconfig \u6587\u4ef6\uff08\u9ed8\u8ba4<code>~/.kube/config</code>\uff09\uff1b</li> <li>CoreDNS\uff1b</li> </ul>"},{"location":"devops/cicd/argo-cd.html#yaml","title":"yaml\u5b89\u88c5","text":"<pre><code># \u521b\u5efaargocd\u540d\u7a7a\u95f4\nkubectl create namespace argocd \n# \u6267\u884capply\u5b89\u88c5\nkubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml\n\n# \u67e5\u770b\u5b89\u88c5\u955c\u50cf\u4e0b\u8f7d\u72b6\u6001\nkubectl describe pod -n argocd |grep Image: |sort |uniq -c\n\n# \u5f00\u542fUI\u7684Nodeport\nkubectl -n argocd expose deployments/argocd-server --type=\"NodePort\" --port=8080 --name=argocd-server-nodeport\n\n# \u83b7\u53d6\u5bc6\u7801\uff0c\u7528\u6237\u540d\u4e3a\uff1aadmin\nkubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\"{.data.password}\" | base64 -d|xargs -n1 echo\n</code></pre> <p>\u9ed8\u8ba4\u4f1a\u5b89\u88c5\u4e00\u4e2a\u81ea\u7b7e\u540d\u7684\u8bc1\u4e66\u3002</p>"},{"location":"devops/cicd/argo-cd.html#helm","title":"helm\u5b89\u88c5","text":"<p>https://github.com/argoproj/argo-helm/tree/main/charts/argo-cd</p>"},{"location":"devops/cicd/argo-cd.html#ha-todo","title":"HA \u5b89\u88c5\uff08TODO\uff09","text":""},{"location":"devops/cicd/argo-cd.html#cli","title":"CLI \u64cd\u4f5c","text":"<p>Argo CD \u63d0\u4f9bUI\u754c\u9762\uff0c\u4ee5\u53ca\u547d\u4ee4\u884c\u64cd\u4f5c\u3002</p>"},{"location":"devops/cicd/argo-cd.html#cli_1","title":"CLI\u5b89\u88c5","text":"<pre><code>curl -sSL -o argocd-linux-amd64 https://github.com/argoproj/argo-cd/releases/latest/download/argocd-linux-amd64\nsudo install -m 555 argocd-linux-amd64 /usr/local/bin/argocd\nrm argocd-linux-amd64\n</code></pre>"},{"location":"devops/cicd/argo-cd.html#cli_2","title":"CLI \u767b\u5f55","text":"<pre><code># \u767b\u5f55\nargocd login &lt;ARGOCD_SERVER&gt;  --username admin --password admin123456 --insecure\n\n# \u4fee\u6539\u5bc6\u7801\uff0c\u5b8c\u6210\u4e4b\u540e\uff0c\u9700\u8981\u5220\u9664`argocd-initial-admin-secret`(\u4ec5\u7528\u4e8e\u4fdd\u5b58\u521d\u59cb\u5bc6\u7801\uff0c\u4f1a\u6839\u636e\u65b0\u7684\u5bc6\u7801\u81ea\u52a8\u521b\u5efa\u65b0\u7684)\nargocd account update-password\n</code></pre>"},{"location":"devops/cicd/argo-cd.html#_5","title":"\u521b\u5efa\u9879\u76ee","text":"<pre><code># set the current namespace to argocd \nkubectl config set-context --current --namespace=argocd\n\n# Create the example guestbook application with the following command\nargocd app create guestbook --repo https://github.com/argoproj/argocd-example-apps.git --path guestbook --dest-server https://kubernetes.default.svc --dest-namespace default\n</code></pre>"},{"location":"devops/cicd/argo-cd.html#_6","title":"\u540c\u6b65\u9879\u76ee","text":"<p><code>argocd app sync guestbook</code></p>"},{"location":"devops/cicd/argo-cd.html#_7","title":"\u591a\u96c6\u7fa4\u652f\u6301","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53ea\u80fd\u6dfb\u52a0argocd\u6240\u5728\u7684K8S\u96c6\u7fa4\uff0c\u6dfb\u52a0k8s\u96c6\u7fa4\u65e0\u6cd5\u5728web\u63a7\u5236\u53f0\u64cd\u4f5c\uff0c\u53ea\u80fd\u901a\u8fc7\u547d\u4ee4\u884c\u64cd\u4f5c\u3002</p> <ol> <li>\u76ee\u6807 K8s \u96c6\u7fa4\u83b7\u53d6 context \u4fe1\u606f</li> </ol> <pre><code># \u5728\u76ee\u6807k8s\u96c6\u7fa4\u6267\u884c \n$ kubectl config get-contexts\nCURRENT   NAME                          CLUSTER      AUTHINFO           NAMESPACE\n*         kubernetes-admin@kubernetes   kubernetes   kubernetes-admin\n\n# \u5c06 kube config \u6587\u4ef6\u53d1\u9001\u5230 argocd \u673a\u5668\uff0c\u6ce8\u610f\u5c06\u91cc\u9762\u7684\u57df\u540d\u4fe1\u606f\u6539\u4e3a ip \u5730\u5740\n$ scp /root/.kube/config 172.16.2.134:/argocd/prod_k8s_config\n</code></pre> <ol> <li>\u5728 argocd \u7684\u673a\u5668\u4e0a\u901a\u8fc7\u547d\u4ee4\u884c\u65b0\u589e\u96c6\u7fa4</li> </ol> <pre><code>$ argocd cluster add kubernetes-admin@kubernetes  --kubeconfig /argocd/prod_k8s_onfig  --name prod\n</code></pre>"},{"location":"devops/cicd/argo-cd.html#_8","title":"\u914d\u7f6e","text":""},{"location":"devops/cicd/argo-cd.html#git-webhook","title":"Git Webhook","text":"<p>Argo CD \u9ed8\u8ba4\u6bcf3\u5206\u949f\u68c0\u6d4bGit\u4ed3\u5e93\u4e2dmanifests\u7684\u53d8\u5316\uff0c\u53ef\u4ee5\u901a\u8fc7webhook event \u76d1\u542c\u53d8\u66f4\uff0c\u5b9e\u65f6\u76d1\u6d4b\uff1a</p> <ul> <li>\u914d\u7f6e\u5730\u5740\u4e3a\uff1a<code>https://argocd.server.url/api/webhook</code></li> </ul>"},{"location":"devops/cicd/argo-cd.html#helm-todo","title":"Helm (TODO)","text":""},{"location":"devops/cicd/argo-cd.html#argo-events","title":"Argo Events","text":"<p>The Event-Based Dependency Manager for Kubernetes</p>"},{"location":"devops/cicd/argo-cd.html#triggers","title":"Triggers","text":"<ol> <li>Argo Workflows</li> <li>Standard K8s Objects</li> <li>HTTP Requests / Serverless Workloads (OpenFaaS, Kubeless, KNative etc.)</li> <li>AWS Lambda</li> <li>NATS Messages</li> <li>Kafka Messages</li> <li>Slack Notifications</li> <li>Azure Event Hubs Messages</li> <li>Argo Rollouts</li> <li>Custom Trigger / Build Your Own Trigger</li> <li>Apache OpenWhisk</li> <li>Log Trigger</li> </ol>"},{"location":"devops/cicd/drone-ci.html","title":"Drone","text":"<p>Drone by Harness\u2122 is a modern Continuous Integration platform that empowers busy teams to automate their build, test and release workflows using a powerful, cloud native pipeline engine.</p>"},{"location":"devops/cicd/drone-ci.html#_1","title":"\u95ee\u9898","text":""},{"location":"devops/cicd/drone-ci.html#subgroup","title":"\u4e0d\u652f\u6301subgroup","text":"<p>https://github.com/harness/drone/issues/2009</p>"},{"location":"devops/cicd/drone-ci.html#_2","title":"\u4f7f\u7528","text":""},{"location":"devops/cicd/drone-ci.html#yaml","title":"\u793a\u4f8bYaml","text":"<pre><code>name: default\n\nkind: pipeline\ntype: docker\n\nsteps:\n- name: backend\n  image: golang\n  commands:\n    - go get\n    - go build\n    - go test\n\n- name: frontend\n  image: node:6\n  commands:\n    - npm install\n    - npm test\n\n- name: publish\n  image: plugins/docker\n  settings:\n    repo: octocat/hello-world\n    tags: [ 1, 1.1, latest ]\n    registry: index.docker.io\n\n- name: notify\n  image: plugins/slack\n  settings:\n    channel: developers\n    username: drone\n</code></pre>"},{"location":"devops/cicd/drone-ci.html#_3","title":"\u63d2\u4ef6","text":""},{"location":"devops/cicd/drone-ci.html#drone-cache","title":"Drone-Cache","text":"<p>A Drone plugin for caching current workspace files between builds to reduce your build times.</p>"},{"location":"devops/cicd/git_branch_model.html","title":"Git \u5206\u652f\u6a21\u578b","text":""},{"location":"devops/cicd/git_branch_model.html#trunkbased","title":"TrunkBased \u5206\u652f\u6a21\u578b","text":"<p>\u4e0d\u7a33\u5b9a\u4e3b\u5e72</p> <ul> <li>\u4f7f\u7528\u4e3b\u5e72\u4f5c\u4e3a\u65b0\u529f\u80fd\u5f00\u53d1\u4e3b\u7ebf\uff0c\u5206\u652f\u7528\u4f5c\u53d1\u5e03\uff1b</li> <li>\u88ab\u5e7f\u6cdb\u7684\u5e94\u7528\u4e8e\u5f00\u6e90\u9879\u76ee\uff1b</li> <li>\u6bd4\u8f83\u9002\u5408\u8bf8\u5982\u4f20\u7edf\u8f6f\u4ef6\u4ea7\u54c1\u7684\u5f00\u53d1\u6a21\u5f0f\uff0c\u6bd4\u5982\u5fae\u8f6f\u7684office\u7b49\uff1b</li> <li>bug\u4fee\u6539\u9700\u8981\u5728\u5404\u4e2a\u5206\u652f\u4e2d\u5408\u5e76\uff1b</li> <li>\u65b0\u4ee3\u7801\u5728\u4e3b\u5e72\u4e0a\u5f00\u53d1\uff0c\u56e0\u6b64\u5982\u679c\u4e3b\u5e72\u4e0d\u80fd\u8fbe\u5230\u7a33\u5b9a\u7684\u6807\u51c6\uff0c\u5c31\u4e0d\u53ef\u4ee5\u8fdb\u884c\u53d1\u5e03\uff1b</li> <li>\u8fd9\u79cd\u7b56\u7565\u7684\u597d\u5904\u662f\u6ca1\u6709\u5206\u652f\u5408\u5e76\u7684\u5de5\u4f5c\u91cf\uff0c\u56e0\u6b64\u6bd4\u8f83\u7b80\u5355\uff1b</li> </ul>"},{"location":"devops/cicd/git_branch_model.html#git-flow","title":"Git-flow \u5206\u652f\u6a21\u578b","text":"<p>\u7a33\u5b9a\u4e3b\u5e72</p> <ul> <li>master: \u4e3b\u5206\u652f\uff0c\u4e3b\u8981\u7528\u6765\u7248\u672c\u53d1\u5e03\u3002</li> <li>hotfix\uff1a\u7ebf\u4e0a bug \u7d27\u6025\u4fee\u590d\u7528\u5230\u7684\u4e34\u65f6\u5206\u652f\u3002\u8fd9\u4e2a\u5206\u652f\u7528\u6765\u4fee\u590d\u4e3b\u7ebfmaster\u7684BUG</li> <li>release\uff08\u9884\u53d1\u5e03\u5206\u652f\uff09\uff1arelease \u5206\u652f\u53ef\u4ee5\u8ba4\u4e3a\u662f master \u5206\u652f\u7684\u672a\u6d4b\u8bd5\u7248\u3002\u6bd4\u5982\u8bf4\u67d0\u4e00\u671f\u7684\u529f\u80fd\u5168\u90e8\u5f00\u53d1\u5b8c\u6210\uff0c\u90a3\u4e48\u5c31\u5c06 develop \u5206\u652f\u5408\u5e76\u5230 release \u5206\u652f\uff0c\u6d4b\u8bd5\u6ca1\u6709\u95ee\u9898\u5e76\u4e14\u5230\u4e86\u53d1\u5e03\u65e5\u671f\u5c31\u5408\u5e76\u5230 master \u5206\u652f\uff0c\u8fdb\u884c\u53d1\u5e03\u3002</li> <li>develop\uff08\u76f8\u5f53\u4e8erelease\u7684\u9884\u5206\u652f\uff09\uff1a\u65e5\u5e38\u5f00\u53d1\u5206\u652f\uff0c\u8be5\u5206\u652f\u6b63\u5e38\u4fdd\u5b58\u4e86\u5f00\u53d1\u7684\u6700\u65b0\u4ee3\u7801\u3002</li> <li>feature\uff1a\u5177\u4f53\u7684\u529f\u80fd\u5f00\u53d1\u5206\u652f\uff0c\u53ea\u4e0e develop \u5206\u652f\u4ea4\u4e92\u3002</li> </ul> <p></p>"},{"location":"devops/cicd/git_branch_model.html#_1","title":"\u4e3b\u5206\u652f","text":"<p>master \uff1aorigin/master \u4e3a\u4e3b\u5206\u652f\uff0c\u8fd9\u4e2a\u5206\u652f\u6e90\u7801\u7684 HEAD \u4e00\u76f4\u6307\u5411 \u53ef\u7528\u4e8e\u751f\u4ea7\u73af\u5883 \u7684\u72b6\u6001\uff1b</p> <p>dev\uff1a origin/develop \u4e3a\u4e3b\u5206\u652f\uff0c\u8fd9\u4e2a\u5206\u652f\u6e90\u7801\u7684 HEAD \u603b\u662f\u53cd\u6620\u4e0b\u4e00\u4e2a\u7248\u672c\u7684\u6700\u65b0\u5f00\u53d1\u72b6\u51b5</p> <p></p>"},{"location":"devops/cicd/git_branch_model.html#_2","title":"\u8f85\u52a9\u5206\u652f","text":"<p>\u591a\u6837\u5316\u7684\u8f85\u52a9\u5206\u652f\uff0c\u652f\u6301\u6210\u5458\u95f4\u5e76\u884c\u5f00\u53d1\uff0c \u8f7b\u677e\u8ddf\u8e2a\u529f\u80fd\u5f00\u53d1\u3001\u751f\u4ea7\u7248\u672c\u53d1\u5e03\u3001\u8fd8\u80fd\u5feb\u901f\u4fee\u590d\u751f\u4ea7\u73af\u5883\u4e2d\u4ea7\u751f\u7684 Bug \u3002</p> <p>\u53ef\u80fd\u7528\u5230\u7684\u8f85\u52a9\u5206\u652f\u5206\u7c7b\u6709\uff1a</p> <ul> <li>\u529f\u80fd\u5206\u652f</li> <li>\u53d1\u5e03\u5206\u652f</li> <li>\u4fee\u590d Bug \u5206\u652f</li> </ul> <p>\u6bcf\u4e2a\u5206\u652f\u90fd\u6709\u7279\u6b8a\u7684\u7528\u9014\u3002\u8fd9\u4e9b\u5206\u652f\u7684\u6765\u6e90\u5206\u652f\u548c\u4ed6\u4eec\u8981\u5408\u5e76\u56de\u7684\u5206\u652f\u90fd\u6709\u4e25\u683c\u7684\u5b9a\u4e49\u3002</p>"},{"location":"devops/cicd/git_branch_model.html#_3","title":"\u529f\u80fd\u5206\u652f","text":"\u5206\u652f\u7c7b\u578b \u547d\u540d\u89c4\u8303 \u521b\u5efa\u81ea \u5408\u5e76\u5230 \u8bf4\u660e feature feature/* develop develop \u65b0\u529f\u80fd <p>\u529f\u80fd\u5206\u652f\uff08\u6216\u79f0\u4e3a\u7279\u6027\u5206\u652f\uff09\u662f\u88ab\u7528\u6765\u5f00\u53d1\u65b0\u529f\u80fd\u7684\uff0c\u8fd9\u4e9b\u65b0\u529f\u80fd\u662f\u8981\u5373\u5c06\u4e0a\u7ebf\u6216\u66f4\u957f\u65f6\u95f4\u540e\u53d1\u5e03\u7684\u3002</p> <p>\u529f\u80fd\u5206\u652f\u5408\u5e76\u5230 dev \u65f6\uff0c\u4fdd\u8bc1\u6700\u7ec8\u51fa\u73b0\u5728 dev \u65f6\u662f\u4e2a\u5355\u4e2a commit\uff1b</p> <p></p>"},{"location":"devops/cicd/git_branch_model.html#_4","title":"\u53d1\u5e03\u5206\u652f","text":"\u5206\u652f\u7c7b\u578b \u547d\u540d\u89c4\u8303 \u521b\u5efa\u81ea \u5408\u5e76\u5230 \u8bf4\u660e release release/* develop develop \u548c master \u4e00\u6b21\u65b0\u7248\u672c\u7684\u53d1\u5e03\u4e0e\u751f\u4ea7\u73af\u5883\u4e2d\u53d1\u73b0\u7684\u7d27\u6025 bug \u7684\u4fee\u590d <p>\u53d1\u5e03\u5206\u652f\uff08Release branches\uff09 \u652f\u6301\u65b0\u4ea7\u54c1\u53d1\u5e03\u7684\u51c6\u5907\uff0c\u5141\u8bb8\u5c0f\u9519\u8bef\u4fee\u590d\u4ee5\u53ca\u4e3a\u53d1\u5e03\u51c6\u5907\u5143\u6570\u636e\uff08\u7248\u672c\u53f7\uff0c\u6784\u5efa\u65e5\u671f\u7b49\uff09\u3002</p> <p>\u76f4\u5230\u786e\u5b9a\u4f1a\u63a8\u51fa\u53d1\u5e03\u7248\u7684\u8fd9\u6bb5\u65f6\u95f4\u91cc\uff0c\u65b0\u53d1\u5e03\u5206\u652f\u90fd\u4f1a\u4e00\u76f4\u5b58\u5728\u3002</p> <ul> <li>\u5728\u6b64\u671f\u95f4\uff0cbug \u4fee\u590d\u53ef\u80fd\u4f1a\u5e94\u7528\u5230\u8fd9\u4e2a\u5206\u652f\u4e0a\uff08\u800c\u4e0d\u662f develop \u5206\u652f\uff09\u3002</li> <li>\u4e25\u7981\u5728\u6b64\u5206\u652f\u6dfb\u52a0\u5927\u7684\u65b0\u529f\u80fd\u7279\u6027\u3002 \u8fd9\u4e9b\u5206\u652f\u5fc5\u987b\u5408\u5e76\u56de develop \u5206\u652f\uff0c\u7136\u540e\uff0c\u7b49\u5f85\u4e0b\u4e00\u4e2a\u5927\u7248\u672c\u7684\u5230\u6765\u3002</li> </ul> <p>\u8981\u53d1\u5e03\u5206\u652f\u7684\u65f6\u5019\uff1a</p> <ul> <li>\u5408\u5e76\u56de master \u5206\u652f\uff0c\u51fa tag \u65b0\u7248\u672c\uff1b</li> <li>\u5408\u5e76\u56de dev \u5206\u652f\uff0c\u4fdd\u8bc1 dev \u7248\u672c\u6700\u65b0\uff1b</li> <li>\u5220\u9664\u8be5\u53d1\u5e03\u5206\u652f\uff1b</li> </ul>"},{"location":"devops/cicd/git_branch_model.html#bug","title":"\u4fee\u590dBUG\u5206\u652f","text":"\u5206\u652f\u7c7b\u578b \u547d\u540d\u89c4\u8303 \u521b\u5efa\u81ea \u5408\u5e76\u5230 \u8bf4\u660e hotfix hotfix/* master develop \u548c master \u4e00\u6b21\u65b0\u7248\u672c\u7684\u53d1\u5e03\u4e0e\u751f\u4ea7\u73af\u5883\u4e2d\u53d1\u73b0\u7684\u7d27\u6025 bug \u7684\u4fee\u590d <p>\u672c\u8d28\u662f\u5f53\u6709\u4eba\u51c6\u5907\u5bf9\u751f\u4ea7\u7248\u672c\u8fdb\u884c\u5feb\u901f\u4fee\u590d\u65f6\uff0c\u56e2\u961f\u6210\u5458\uff08\u5728 develop \u5206\u652f\uff09\u53ef\u4ee5\u7ee7\u7eed\u5de5\u4f5c\u3002</p> <p>\u4fee\u590d bug \u5206\u652f\u521b\u5efa\u4e8e master \u5206\u652f\u3002 \u4f8b\u5982\uff0c1.2 \u7248\u672c\u662f\u5f53\u524d\u751f\u4ea7\u73af\u5883\u7684\u7248\u672c\u5e76\u4e14\u6709 bug \u3002\u4f46\u662f develop \u5206\u652f\u4e0a\u7684\u4fee\u6539\u8fd8\u4e0d\u591f\u7a33\u5b9a\u3002\u8fd9\u65f6\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u4fee\u590d bug \u5206\u652f\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u5f53\u5b8c\u6210\u4e00\u4e2a\u4fee\u590d bug \u5206\u652f\u4e4b\u540e\uff0cbug \u5206\u652f\u9700\u8981\u5408\u5e76\u5230 master \u548c develop \u5206\u652f\u4e0a\uff0c\u4ee5\u4fdd\u8bc1\u5728\u4e0b\u4e00\u7248\u672c\u4e2d\u4e5f\u5305\u542b\u8be5 bug \u4fee\u590d\u3002</p>"},{"location":"devops/cicd/git_branch_model.html#_5","title":"\u4f18\u7f3a\u70b9","text":"<p>\u4f18\u70b9\uff1a</p> <ul> <li>\u7ecf\u8fc7\u591a\u6b21\u5b9e\u8df5\uff0c\u5e76\u884c\u7279\u6027\u5f00\u53d1\u826f\u597d\uff1b</li> <li>\u9002\u5408\u5927\u578b\u9879\u76ee\u5f00\u53d1\uff0c\u5bf9\u5c0f\u4e2d\u578b\u9879\u76ee\u800c\u8a00\uff0c\u8fc7\u4e8e\u7e41\u6742\uff0c\u964d\u4f4e\u654f\u6377\u6027\uff1b</li> <li>\u516c\u53f8\u534f\u540c\u6027\u6bd4\u8f83\u9ad8\u7684\u8bdd\u9002\u5408\u4f7f\u7528\uff0c\u6216\u8005\u516c\u53f8\u6709\u4e13\u95e8\u7684git\u7ba1\u7406\u90e8\u95e8\u7edf\u4e00\u7ba1\u7406\u5206\u652f</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u4ece\u9879\u76ee\u5f00\u59cb\u5230\u4e0a\u7ebf\u8fc7\u7a0b\u4e2d\u9700\u8981\u5f00\u7684\u65b0\u5206\u652f\u8fc7\u591a\u4e0d\u6613\u7ef4\u62a4\uff0c\u800c\u4e14\u591a\u5206\u652f\u5bb9\u6613\u51fa\u9519\uff1b</li> <li>\u5206\u652f\u8d8a\u591a\uff0c\u751f\u547d\u5468\u671f\u8d8a\u77ed\uff0c\u8fd9\u79cd\u51fa\u9519\u7684\u6982\u7387\u5c31\u8d8a\u5927\uff1b</li> <li>git-flow\u5927\u91cf\u7684\u5408\u5e76\u51b2\u7a81\u548c\u5bf9\u96c6\u6210\u6d4b\u8bd5\u4e0d\u53cb\u597d\u3002</li> </ul>"},{"location":"devops/cicd/git_branch_model.html#aone-flow","title":"\u963f\u91ccAone-flow\u5206\u652f\u7ba1\u7406\uff08\u5b9a\u5236\uff09","text":"<p>\u517c\u987e\u4e86 TrunkBased \u7684\u201c\u6613\u4e8e\u6301\u7eed\u96c6\u6210\u201d\u548c GitFlow \u7684\u201c\u6613\u4e8e\u7ba1\u7406\u9700\u6c42\u201d\u7279\u70b9</p> <ul> <li>\u9002\u7528\u4e8e\u5355\u4f53\u91cf\u5927\u7684\u5355\u4e2a\u4ed3\u5e93\uff0c\u591a\u4eba\u534f\u540c\u5f00\u53d1\uff1b</li> </ul> <p>\u53ea\u4f7f\u7528\u4e09\u79cd\u5206\u652f\u7c7b\u578b\uff1amaster\u5206\u652f\u3001feature\u5206\u652f\u3001release\u5206\u652f\uff0c\u4ee5\u53ca\u4e09\u6761\u57fa\u672c\u89c4\u5219</p> <p>\u89c4\u5219\u4e00\uff1a\u5f00\u59cb\u5de5\u4f5c\u524d\uff0c\u4ece\u4e3b\u5e72\u521b\u5efa\u7279\u6027\u5206\u652f</p> <ul> <li>\u6bcf\u4e2a\u5de5\u4f5c\u9879\uff08\u53ef\u4ee5\u662f\u4e00\u4e2a\u4eba\u5b8c\u6210\uff0c\u6216\u662f\u591a\u4e2a\u4eba\u534f\u4f5c\u5b8c\u6210\uff09\u5bf9\u5e94\u4e00\u4e2a\u7279\u6027\u5206\u652f\uff0c\u6240\u6709\u7684\u4fee\u6539\u90fd\u4e0d\u5141\u8bb8\u76f4\u63a5\u63d0\u4ea4\u5230\u4e3b\u5e72</li> </ul> <p>\u89c4\u5219\u4e8c\uff1a\u901a\u8fc7\u5408\u5e76\u7279\u6027\u5206\u652f\uff0c\u5f62\u6210\u53d1\u5e03\u5206\u652f</p> <ul> <li>\u4ece\u4e3b\u5e72\u4e0a\u62c9\u51fa\u4e00\u6761\u65b0\u5206\u652f\uff0c\u5c06\u6240\u6709\u672c\u6b21\u8981\u96c6\u6210\u6216\u53d1\u5e03\u7684\u7279\u6027\u5206\u652f\u4f9d\u6b21\u5408\u5e76\u8fc7\u53bb\uff0c\u4ece\u800c\u5f97\u5230\u53d1\u5e03\u5206\u652f\u3002</li> </ul> <p>\u89c4\u5219\u4e09\uff1a\u53d1\u5e03\u5230\u7ebf\u4e0a\u6b63\u5f0f\u73af\u5883\u540e\uff0c\u5408\u5e76\u76f8\u5e94\u7684\u53d1\u5e03\u5206\u652f\u5230\u4e3b\u5e72\uff0c\u5728\u4e3b\u5e72\u6dfb\u52a0\u6807\u7b7e\uff0c\u540c\u65f6\u5220\u9664\u8be5\u53d1\u5e03\u5206\u652f\u5173\u8054\u7684\u7279\u6027\u5206\u652f\u3002</p> <p></p> <p>\u963f\u91cc\u6709\u5de5\u5177\uff0c\u5206\u652f\u7ba1\u7406\u5668\u4f1a\u5bf9feature_bugfix\u3001feature_function1\u3001feature_function2 \u7b49\u4e09\u4e2a\u5206\u652f\u8fdb\u884c\u96c6\u6210\uff0c\u5e76\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u3010origin/release\u3011\u5206\u652f\uff08\u5982\u4e0b\u56fe\uff09\uff0c\u800c\u8fd9\u4e2arelease\u5206\u652f\u5c31\u662f\u4e13\u95e8\u670d\u52a1\u4e8e\u65e5\u5e38\u73af\u5883\u7684\u53d1\u5e03\u5206\u652f\u4e86\u3002</p> <ul> <li>\u6bcf\u5f53\u5206\u652f\u4e0a\u6709\u540c\u5b66\u63d0\u4ea4\u4e86\u4ee3\u7801\u5e76\u89e6\u53d1\u4e86\u6d41\u6c34\u7ebf\u7684\u91cd\u65b0\u8fd0\u884c\uff0c\u5206\u652f\u7ba1\u7406\u5668\u53d8\u4f1a\u5bf9\u5206\u652f\u8fdb\u884c\u96c6\u6210\u5904\u7406\uff0c\u5f62\u6210\u5305\u542b\u6700\u65b0\u5206\u652f\u4ee3\u7801\u7684commit</li> </ul> <p></p>"},{"location":"devops/cicd/git_branch_model.html#_6","title":"\u5b9e\u8df5","text":"<p>\u5bf9\u4e8e\u516c\u53f8\u5185\u90e8\u7684\u9879\u76ee\uff1a</p> <ul> <li>\u5355\u4f53\u670d\u52a1\u9879\u76ee\uff0c\u6bcf\u4e2a\u4eba\u90fd\u9700\u8981\u5177\u5907\u81ea\u5df1\u7684\u5f00\u53d1\u73af\u5883\u8fdb\u884c\u81ea\u6d4b\u3002</li> <li>\u5bf9\u4e8e\u5927\u578b\u4ea7\u54c1\uff0c\u6bcf\u4e2a\u5f00\u53d1\u4e0d\u53ef\u80fd\u5177\u5907\u72ec\u7acb\u7684\u5f00\u53d1\u73af\u5883\u6d4b\u8bd5\uff1b<ul> <li>\u5982\u679c\u5171\u7528\u5f00\u53d1\u73af\u5883\uff0c\u5219\u591a\u4eba\u540c\u65f6\u5f00\u53d1\u4e0d\u540c\u7279\u6027\uff0c\u5176\u90e8\u7f72/\u5408\u5e76\u5728\u6d4b\u8bd5\u65f6\u4f1a\u51fa\u73b0\u88ab\u8986\u76d6\u7b49\u95ee\u9898\uff1b</li> </ul> </li> <li>\u5bf9\u4e8e\u5fae\u670d\u52a1\u7c7b\u4f3c\u7684\u9879\u76ee\uff0c\u5355\u4e2a\u5fae\u670d\u52a1\u5e94\u8be5\u540c\u65f6\u5e94\u8be5\u53ea\u6709\u4e00\u4e2a\u4eba\u8fdb\u884c\u5f00\u53d1\u3002</li> </ul>"},{"location":"devops/cicd/git_branch_model.html#todo","title":"\u5355\u4f53\u670d\u52a1\u6a21\u5f0f\uff08TODO\uff09","text":""},{"location":"devops/cicd/git_branch_model.html#_7","title":"\u5fae\u670d\u52a1\u6a21\u5f0f","text":"<p>\u6bcf\u4e2a\u4ed3\u5e93\u540c\u4e00\u65f6\u95f4\u53ea\u4f1a\u6709\u4e00\u4e2a\u4eba\u8fdb\u884c\u529f\u80fd\u7279\u6027\u5f00\u53d1</p> <p>\u5728\u5176\u8fed\u4ee3\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u7684\u5206\u652f\u6a21\u578b\u3002</p> <ul> <li> <p>feature \u5206\u652f</p> </li> <li> <p>\u5f00\u53d1\u4eba\u5458\u8fdb\u884c\u529f\u80fd\u5f00\u53d1\uff0c\u63a8\u9001\u5230\u5f00\u53d1\u73af\u5883\u5e76\u8fdb\u884c\u6d4b\u8bd5\uff0c\u81ea\u6d4b\u901a\u8fc7\u540e\uff0c\u63d0\u4ea4PR\u5230 dev \u5206\u652f\uff1b</p> </li> <li> <p>dev \u5206\u652f</p> </li> <li> <p>feature\u5206\u652f\u7684\u4ee3\u7801 review\u5408\u5e76\u5230dev\u540e\uff0c\u51fa\u7248\u672c\uff0c\u90e8\u7f72\u5230\u6d4b\u8bd5\u73af\u5883\uff1b</p> </li> <li>\u6d4b\u8bd5\u4eba\u5458\u8fdb\u884c\u6d4b\u8bd5\uff0c\u51fa\u73b0\u95ee\u9898\uff0c\u5219\u5f00\u53d1\u5728 feature \u5206\u652f\u8fdb\u884c\u4fee\u590d\uff0c\u81ea\u6d4b\u540e\u518d\u63d0\u4ea4 PR\u5230 dev\uff1b</li> </ul> <p>\u5982\u679c\u5305\u542b release \u5206\u652f\uff1a\uff08\u5373\u4fdd\u6301 master \u751f\u4ea7\u53ef\u7528\uff09</p> <ul> <li> <p>release\u5206\u652f\uff1a</p> </li> <li> <p>\u7248\u672c\u7684\u6240\u6709feature\u90fd\u5f00\u53d1\u5b8c\u6210\uff0c\u57fa\u4e8e dev \u62c9\u51fa release-* \u7684\u5206\u652f\uff0c\u6b64\u540e\uff0cdev \u5206\u652f\u53ef\u4ee5\u63a5\u6536\u4e0b\u4e00\u7248\u672c\u7684feature\u5408\u5e76\uff1b</p> </li> <li> <p>\u6d4b\u8bd5\u57fa\u4e8e release - * \u8fdb\u884c\u56de\u5f52\u6d4b\u8bd5\uff0c\u6d4b\u8bd5\u51fa\u73b0bug\uff0c\u5219\u63d0\u4ea4\u4fee\u590d\u5230\u8be5 release\u5206\u652f\uff1b</p> </li> <li> <p>master \u5206\u652f\uff1b</p> </li> <li> <p>release \u5206\u652f\u6d4b\u8bd5\u901a\u8fc7\u540e\uff0c\u63d0\u4ea4\u4ee3\u7801\u5230 master \u51fa\u7248\u672c\uff0c\u5e76\u66f4\u65b0 dev \u8ddf master \u4e00\u81f4\uff1b</p> </li> </ul> <p>\u5982\u679c\u4e0d\u5305\u542b release \u5206\u652f\uff1a</p> <ul> <li>master \u5206\u652f\uff1a\uff08dev\u4e0d\u80fd\u63a5\u53d7\u4e0b\u4e00\u7248\u672c\u7684\u4ee3\u7801PR\uff09</li> <li>\u7248\u672c\u7684\u6240\u6709feature\u90fd\u5f00\u53d1\u5b8c\u6210\uff0c\u5c06 dev \u63d0\u4ea4 PR \u5230 master\uff1b</li> <li>\u6d4b\u8bd5\u57fa\u4e8emaster\uff0c\u8fdb\u884c\u56de\u5f52\u6d4b\u8bd5\uff0c\u6d4b\u8bd5\u51fa\u73b0bug\uff0c\u5219\u63d0\u4ea4\u4fee\u590dPR\u5230master\uff1b</li> <li>\u6d4b\u8bd5\u901a\u8fc7\u540e\uff0cmaster \u6253 tag \u51fa\u7248\u672c\uff0c\u66f4\u65b0 dev \u4fdd\u6301\u4e00\u81f4\uff1b</li> </ul>"},{"location":"devops/cicd/git_branch_model.html#_8","title":"\u53cc\u5468\u8fed\u4ee3\u5236","text":"<ul> <li>\u5f00\u53d1\uff1a\u8fdb\u884cN\u8fed\u4ee3 (\u5f53\u524d\u8fed\u4ee3) \u7684\u5f00\u53d1\u4e0eN-1\u7248\u672c (\u4e0a\u4e2a\u7248\u672c) \u7684hotfix\u5de5\u4f5c\uff0c\u5e76\u5728\u6bcf\u5468\u4e94\u8fdb\u884c\u7edf\u4e00\u63d0\u6d4b\uff1b</li> <li>\u6d4b\u8bd5\uff1a\u8fdb\u884cN\u8fed\u4ee3 (\u5f53\u524d\u8fed\u4ee3) \u7684develop\u73af\u5883\u6d4b\u8bd5\u4e0eN-1\u8fed\u4ee3 (\u4e0a\u4e2a\u8fed\u4ee3) \u7684 release \u73af\u5883\u6d4b\u8bd5\uff0c\u5728\u6bcf\u5468\u4e94\u524d\u5b8c\u6210N-1\u7248\u672c\u7684\u6d4b\u8bd5\u5de5\u4f5c\uff1b</li> <li>\u9879\u76ee\uff1a\u8fdb\u884cN+1 (\u4e0b\u4e2a\u8fed\u4ee3) \u7684\u8fed\u4ee3\u89c4\u5212\u5de5\u4f5c\u4e0e\u4e0a\u4e24\u4e2a\u8fed\u4ee3(N-2)\u7684\u8fed\u4ee3\u53d1\u5e03\u5de5\u4f5c\uff1b</li> </ul>"},{"location":"devops/cicd/gitlab-cd.html","title":"Gitlab CD","text":"<p>https://docs.gitlab.com/ee/topics/release_your_application.html</p>"},{"location":"devops/cicd/gitlab-cd.html#k8s-cluster","title":"K8s Cluster","text":""},{"location":"devops/cicd/gitlab-cd.html#gitopspull-based","title":"Gitops(Pull-Based)","text":"<p>https://docs.gitlab.com/ee/user/clusters/agent/gitops.html</p> <ul> <li>Moved from GitLab Premium to GitLab Free in 15.3</li> </ul> <p>\u901a\u8fc7\u5728 K8s \u96c6\u7fa4\u90e8\u7f72 Agent\uff0c\u76d1\u542c</p> <p></p>"},{"location":"devops/cicd/gitlab-cd.html#ci-push-based","title":"CI Push-Based","text":"<p>https://docs.gitlab.com/ee/user/clusters/agent/ci_cd_workflow.html</p> <ul> <li>Moved to GitLab Free in 14.5.</li> </ul> <p>\u76f4\u63a5\u5728<code>.gitlab-ci.yml</code>\u4e2d\u9009\u62e9Agent\u7684K8s context \u5e76\u8fd0\u884c kubectl\u547d\u4ee4\uff0c\u90e8\u7f72\u5230 K8s \u73af\u5883</p> <ul> <li>\u591a\u73af\u5883\u652f\u6301\u4e0d\u597d\uff1b</li> </ul>"},{"location":"devops/cicd/gitlab-ci.html","title":"Gitlab CI","text":""},{"location":"devops/cicd/gitlab-ci.html#runner","title":"Runner","text":"<p>https://docs.gitlab.com/runner/install/</p>"},{"location":"devops/cicd/gitlab-ci.html#docker-runner","title":"Docker-Runner","text":"<p>Gitlab-runner \u5b89\u88c5\uff1a\u66f4\u597d\u7684\u7ba1\u7406\u65b9\u5f0f\u662fk8s</p> <ul> <li>\u62c9\u53d6\u955c\u50cf</li> </ul> <pre><code>docker pull gitlab/gitlab-runner\n</code></pre> <ul> <li>\u542f\u52a8gitlab-runner</li> </ul> <pre><code>docker run -d --name gitlab-runner --restart always \\\n    -v /mnt/gitlab-runner/config:/etc/gitlab-runner \\\n    -v /var/run/docker.sock:/var/run/docker.sock \\\n    gitlab/gitlab-runner\n</code></pre> <ul> <li>\u6ce8\u518c\u5230gitlab    \u6839\u636egitlab admin\u4e2d\u7684runner\u7684\u4fe1\u606f\uff0c\u586b\u5199\u4ee5\u4e0b\u4fe1\u606f</li> </ul> <pre><code>docker run --rm -t -i -v /mnt/gitlab-runner/config:/etc/gitlab-runner gitlab/gitlab-runner register \\\n  --non-interactive \\\n  --url \"http://172.16.1.181:8090/\" \\\n  --registration-token \"DA1wNdAchnBFH_frXa9N\" \\\n  --executor \"docker\" \\\n  --docker-image alpine:latest \\\n  --description \"docker-runner\" \\\n  --tag-list \"docker,test\"\n</code></pre> <p>\u5982\u679c\u51fa\u73b0\u4e86no route to host\u5f02\u5e38\uff0c\u9700\u8981\u5728\u5bbf\u4e3b\u673a\u4e0a\u6dfb\u52a0\u7aef\u53e3\u9632\u706b\u5899(\u539f\u56e0\u89c1docker\u7ae0\u8282No Route to Host \u95ee\u9898)</p> <pre><code>firewall-cmd --zone=public --add-port=8090/tcp --permanent\nfirewall-cmd --reload\n</code></pre>"},{"location":"devops/cicd/gitlab-ci.html#k8s-runner","title":"K8s-Runner","text":""},{"location":"devops/cicd/gitlab-ci.html#yaml","title":"Yaml \u5b89\u88c5","text":"<p>Yaml\u914d\u7f6e\u539f\u4ef6\uff1agitlab-runner.yaml\uff0c\u6ce8\u610f\u4fee\u6539 gitlab \u5730\u5740\u548c runner token\uff0c\u63d0\u524d\u521b\u5efa gitlab \u540d\u7a7a\u95f4\u3002</p> <p>\u6ce8\u610f:</p> <ul> <li> <p>replicas: Runner\u5b9e\u4f8b\u6570</p> </li> <li> <p>CI_SERVER_URL: gitlab\u670d\u52a1\u5668\u5730\u5740</p> </li> <li>GITLAB_CI_TOKEN: gitlab\u9879\u76eetoken</li> <li>token\u9700\u8981base\u8f6c\u6362: <code>echo oqdKGRBZ-FzcVp9iyvwP | base64 -w0</code></li> </ul> <p></p> <p>\u521b\u5efa runner\uff1a<code>kubectl create -f gitlab-runner.yaml</code></p>"},{"location":"devops/cicd/gitlab-ci.html#helm","title":"Helm \u5b89\u88c5","text":"<p>https://docs.gitlab.com/runner/install/kubernetes.html</p>"},{"location":"devops/cicd/gitlab-ci.html#gitlab-ciyml","title":".gitlab-ci.yml \u914d\u7f6e","text":"<p>\u9700\u8981\u5728\u9879\u76ee\u4e2d\u521b\u5efa <code>.gitlab-ci.yml</code> \u6587\u4ef6\uff0c\u4e0b\u9762\u662f\u4e2a\u793a\u4f8b\uff0c\u5176\u4e2dtags\u662f\u521b\u5efagitlab-runner\u65f6\u6307\u5b9a\u7684tags\uff0c\u5339\u914d\u4e0a\u624d\u4f1a\u6709runner\u6267\u884cCI\uff1a</p> <pre><code>image: maven:latest\nstages:\n\u00a0\u00a0- build\n\u00a0\u00a0- test\n\u00a0\u00a0- run\nvariables:\n\u00a0\u00a0MAVEN_OPTS: \"-Dmaven.repo.local=.m2/repository\"\ncache:\n\u00a0\u00a0paths:\n\u00a0\u00a0\u00a0\u00a0- .m2/repository/\n\u00a0\u00a0\u00a0\u00a0- target/\nbuild:\n\u00a0\u00a0stage: build\n\u00a0\u00a0script:\n\u00a0\u00a0\u00a0\u00a0- mvn $MAVEN_CLI_OPTS compile\n\u00a0\u00a0only:\n\u00a0\u00a0\u00a0\u00a0- master\n\u00a0\u00a0tags:\n\u00a0\u00a0\u00a0\u00a0- test\ntest:\n\u00a0\u00a0stage: test\n\u00a0\u00a0script:\n\u00a0\u00a0\u00a0\u00a0- mvn $MAVEN_CLI_OPTS test\n\u00a0\u00a0only:\n\u00a0\u00a0\u00a0\u00a0- master\n\u00a0\u00a0tags:\n\u00a0\u00a0\u00a0\u00a0- test\ndeploy:\n\u00a0\u00a0stage: deploy\n\u00a0\u00a0script:\n\u00a0\u00a0\u00a0\u00a0- echo \"deploy over...\"\n\u00a0\u00a0only:\n\u00a0\u00a0\u00a0\u00a0- master\n\u00a0\u00a0tags:\n\u00a0\u00a0\u00a0\u00a0- test\n</code></pre> <ul> <li>Pipeline\uff1a\u76f8\u5f53\u4e8e\u4e00\u6b21\u6784\u5efa\u4efb\u52a1\uff0c\u91cc\u9762\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u6d41\u7a0b\uff0c\u5982\u5b89\u88c5\u4f9d\u8d56\u3001\u8fd0\u884c\u6d4b\u8bd5\u3001\u7f16\u8bd1\u3001\u90e8\u7f72\u6d4b\u8bd5\u670d\u52a1\u5668\u3001\u90e8\u7f72\u751f\u4ea7\u670d\u52a1\u5668\u7b49\u3002</li> <li>\u4efb\u4f55\u63d0\u4ea4\u6216\u8005 Merge Request \u7684\u5408\u5e76\u90fd\u53ef\u4ee5\u89e6\u53d1 Pipeline \u6784\u5efa\uff1b</li> <li>Stages\uff1a\u8868\u793a\u4e00\u4e2a\u6784\u5efa\u9636\u6bb5\u3002\u4e00\u6b21 Pipeline \u4e2d\u53ef\u5b9a\u4e49\u591a\u4e2a Stages</li> <li>\u6240\u6709 Stages \u4f1a\u987a\u5e8f\u8fd0\u884c\uff0c\u5373\u5f53\u4e00\u4e2a Stage \u5b8c\u6210\u540e\uff0c\u4e0b\u4e00\u4e2a Stage \u624d\u4f1a\u5f00\u59cb</li> <li>\u53ea\u6709\u5f53\u6240\u6709 Stages \u5b8c\u6210\u540e\uff0c\u8be5\u6784\u5efa\u4efb\u52a1\u624d\u4f1a\u6210\u529f</li> <li>\u5982\u679c\u4efb\u4f55\u4e00\u4e2a Stage \u5931\u8d25\uff0c\u90a3\u4e48\u540e\u9762\u7684 Stages \u4e0d\u4f1a\u6267\u884c\uff0c\u8be5\u6784\u5efa\u4efb\u52a1\u5931\u8d25</li> </ul>"},{"location":"devops/cicd/gitlab-ci.html#pipeline","title":"Pipeline","text":"<p>Branch pipelines that run for Git push events to a branch, like new commits or tags.</p> <p>Tag pipelines that run only when a new Git tag is pushed to a branch.</p> <p>Merge request pipelines that run for changes to a merge request, like new commits or selecting the Run pipeline button in a merge request\u2019s pipelines tab.</p> <p>Scheduled pipelines.</p> Variables Branch Tag Merge request Scheduled <code>CI_COMMIT_BRANCH</code> Yes Yes <code>CI_COMMIT_TAG</code> Yes Yes, if the scheduled pipeline is configured to run on a tag. <code>CI_PIPELINE_SOURCE = push</code> Yes Yes <code>CI_PIPELINE_SOURCE = scheduled</code> Yes <code>CI_PIPELINE_SOURCE = merge_request_event</code> Yes <code>CI_MERGE_REQUEST_IID</code> Yes"},{"location":"devops/cicd/gitlab-ci.html#jobs","title":"Jobs","text":"<p>\u8868\u793a\u6784\u5efa\u5de5\u4f5c\uff0c\u5373\u67d0\u4e2a Stage \u91cc\u9762\u6267\u884c\u7684\u5de5\u4f5c\u3002\u4e00\u4e2a Stage \u4e2d\u53ef\u5b9a\u4e49\u591a\u4e2a Jobs</p> <ul> <li> <p>\u9ed8\u8ba4\uff0c\u76f8\u540c Stage \u4e2d\u7684 Jobs \u4f1a\u5e76\u884c\u6267\u884c</p> </li> <li> <p>\u76f8\u540c Stage \u4e2d\u7684 Jobs \u90fd\u6267\u884c\u6210\u529f\u65f6\uff0c\u8be5 Stage \u624d\u4f1a\u6210\u529f</p> </li> <li> <p>\u5982\u679c\u4efb\u4f55\u4e00\u4e2a Job \u5931\u8d25\uff0c\u90a3\u4e48\u8be5 Stage \u5931\u8d25\uff0c\u5373\u8be5\u6784\u5efa\u4efb\u52a1\u5931\u8d25</p> </li> </ul> <p>\u53ef\u4ee5\u901a\u8fc7<code>needs</code>\u5b57\u6bb5\u6539\u53d8\u6267\u884c\u987a\u5e8f\u3002</p> <ul> <li>\u540c\u4e00\u4e2astage\u7684\uff1ajob1 \u548c job2 \u662f\u53ef\u4ee5\u5e76\u884c\u7684\u3002</li> <li>job1\u4e4b\u540e\u5c06\u4f1a\u542f\u52a8 job3 (\u7acb\u5373\u6267\u884c, \u4e0d\u4f1a\u7b49\u5f85job2\u5b8c\u6210\u4f5c\u4e1a)</li> <li>job2\u4e4b\u540e\u5c06\u4f1a\u542f\u52a8 job4 (\u7acb\u5373\u6267\u884c, \u4e0d\u4f1a\u7b49\u5f85job1\u5b8c\u6210\u4f5c\u4e1a)</li> </ul> <pre><code>stages:\n    - stage-1\n    - stage-2\n\njob-1:\n    stage: stage-1\n    needs: []\n    script: \n      - echo \"job-1 started\"\n      - sleep 5\n      - echo \"job-1 done\"\n\njob-2:\n    stage: stage-1\n    needs: []\n    script: \n      - echo \"job-2 started\"\n      - sleep 60\n      - echo \"job-2 done\"\n\njob-3:\n    stage: stage-2\n    needs: [job-1]\n    script: \n      - echo \"job-3 started\"\n      - sleep 5\n      - echo \"job-3 done\"\n\njob-4:\n    stage: stage-2\n    needs: [job-2]\n    script: \n      - echo \"job-4 started\"\n      - sleep 5\n      - echo \"job-4 done\"\n</code></pre>"},{"location":"devops/cicd/gitlab-ci.html#variables","title":"variables","text":"<p>GitLab CI/CD \u9884\u5148\u5b9a\u4e49\u7684\u53d8\u91cf\uff1ahttps://docs.gitlab.com/ee/ci/variables/predefined_variables.html</p> <p><code>.gitlab-ci.yaml</code>\u4e2d\u5b9a\u4e49\u53d8\u91cf\uff1a</p> <ul> <li>jobs \u4e2d\u5b9a\u4e49 <code>variables</code>\u4e3a<code>{}</code>\u8868\u660e\u4e0d\u9700\u8981\u5168\u5c40\u53d8\u91cf\uff1b</li> </ul> <pre><code>variables:\n  GLOBAL_VAR: \"A global variable\"\n\njob1:\n  variables:\n    JOB_VAR: \"A job variable\"\n  script:\n    - echo \"Variables are '$GLOBAL_VAR' and '$JOB_VAR'\"\n\njob1:\n  variables: {}\n  script:\n    - echo This job does not need any variables\n</code></pre>"},{"location":"devops/cicd/gitlab-ci.html#job","title":"\u5c06\u53d8\u91cf\u4f20\u9012\u5230\u5176\u5b83job","text":"<p>create a new environment variables in a job, and pass it to another job in a later stage. </p> <pre><code>build-job:\n  stage: build\n  script:\n    - echo \"BUILD_VARIABLE=value_from_build_job\" &gt;&gt; build.env\n  artifacts:\n    reports:\n      dotenv: build.env\n\ntest-job:\n  stage: test\n  script:\n    - echo \"$BUILD_VARIABLE\"  # Output is: 'value_from_build_job'\n</code></pre>"},{"location":"devops/cicd/gitlab-ci.html#cache","title":"cache","text":"<p>https://docs.gitlab.com/ee/ci/caching/</p> <p>cache\u662f\u7528\u6765\u6307\u5b9a jobs \u4e4b\u95f4\u53ef\u4ee5\u7f13\u5b58\u7684\u6587\u4ef6\u548c\u76ee\u5f55</p> <ul> <li> <p>Locally defined cache overrides globally defined options\uff1b</p> </li> <li> <p>\u4e0d\u540c\u7684 <code>key</code> \u4e0b\u7684\u7f13\u5b58\u4e5f\u4e0d\u4f1a\u76f8\u4e92\u5f71\u54cd\uff1b</p> </li> <li> <p>cache \u5728\u540c\u4e00\u4e2a\u9879\u76ee\u7684\u4e0d\u540c\u7684 pipeline \u4e4b\u95f4\u4e5f\u5b9e\u73b0\u5171\u4eab\uff1b</p> </li> <li> <p>\u4e0d\u540c\u7684\u9879\u76ee\u4e0d\u80fd\u5171\u4eab cache\uff1b</p> </li> <li> <p>\u5982\u679c\u6574\u4e2a pipeline \u914d\u7f6e\u5168\u5c40\u7684 cache\uff0c\u610f\u5473\u7740\u6bcf\u4e2a job \u5728\u6ca1\u6709\u7279\u6b8a\u914d\u7f6e\u7684\u60c5\u51b5\u4e0b\u4f1a\u4f7f\u7528\u5168\u5c40\u7684\u914d\u7f6e</p> </li> <li> <p>\u5bf9\u6574\u4e2a job \u7684 cache \u7981\u7528</p> <pre><code>job:\n  cache: {}\n</code></pre> </li> </ul> <p>\u9ed8\u8ba4\u7684\u914d\u7f6e\u662f <code>cache:policy</code> \u4e2d\u7684 <code>pull-push</code> \u7b56\u7565\uff1a</p> <ul> <li>pull\uff1a\u6bcf\u4e2a job \u4f1a\u5728\u5f00\u59cb\u6267\u884c\u524d\u5c06\u5bf9\u5e94\u8def\u5f84\u7684\u6587\u4ef6\u4e0b\u8f7d\u4e0b\u6765\uff1b</li> <li>push\uff1a\u4efb\u52a1\u7ed3\u675f\u524d\u91cd\u65b0\u4e0a\u4f20\uff0c\u4e0d\u7ba1\u6587\u4ef6\u662f\u5426\u6709\u53d8\u5316\uff1b</li> <li>\u53ef\u4ee5\u5355\u72ec\u6307\u5b9a pull \u6216\u8005 push\uff1b</li> </ul> <pre><code>rspec:\n  stage: test\n  cache:\n    paths:\n      - vendor/bundle\n    policy: pull\n  script:\n    - bundle exec rspec ...\n</code></pre> <p>\u793a\u4f8b\uff1amaven\u9879\u76ee\u914d\u7f6e\u7f13\u5b58</p> <pre><code>image: nnntln/3.6.1-jdk-8:latest\n\nvariables:\n   MAVEN_OPTS: -Dmaven.repo.local=/cache/maven.repository\ncache:\n   key: PortalReportBackend\n   paths:\n     - /root/.m2/repository\n\nstages:\n  - build\n  - execute\n\nbuild:\n  stage: build\n  script: /usr/lib/jvm/java-8-openjdk-amd64/bin/javac Hello.java\n  artifacts:\n    paths:\n     - Hello.*\n\nexecute:\n  stage: execute\n  script: /usr/lib/jvm/java-8-openjdk-amd64/bin/java Hello\n</code></pre>"},{"location":"devops/cicd/gitlab-ci.html#cache_1","title":"\u5206\u5e03\u5f0f cache","text":""},{"location":"devops/cicd/gitlab-ci.html#artifacts","title":"artifacts","text":"<p>Use artifacts to pass intermediate build results between stages. </p> <ul> <li>Subsequent jobs in later stages of the same pipeline can use artifacts.</li> <li>Different projects cannot share artifacts.</li> <li>Artifacts expire after 30 days by default. You can define a custom expiration time.</li> <li>The latest artifacts do not expire if keep latest artifacts is enabled.</li> <li>Use dependencies to control which jobs fetch the artifacts</li> </ul> <p><code>artifacts</code> is used to specify a list of files and directories which should be attached to the job when it succeeds, fails, or always.</p> <p>The artifacts will be sent to GitLab after the job finishes and will be available for download in the GitLab UI.</p> <ul> <li>\u9ed8\u8ba430\u5929\u6709\u6548\u671f\uff0c\u53ef\u4ee5\u6307\u5b9a<code>expire_in</code>\u5b57\u6bb5\uff1b</li> </ul>"},{"location":"devops/cicd/gitlab-ci.html#job-artifacts","title":"job artifacts","text":"<p>https://docs.gitlab.com/ee/ci/pipelines/job_artifacts.html</p> <p>job \u7684\u5236\u54c1\uff0c\u53ef\u4ee5\u5728 Pipeline\u754c\u9762\u8fdb\u884c\u4e0b\u8f7d</p> <pre><code>pdf:\n  script: xelatex mycv.tex\n  artifacts:\n    paths:\n      - mycv.pdf\n    expire_in: 1 week\n</code></pre> <p>Keep artifacts from most recent successful jobs</p> <p>By default artifacts are always kept for successful pipelines for the most recent commit on each ref. </p> <ul> <li>\u6700\u65b0\u7684artifacts \u4e0d\u4f1a\u53d7<code>expire_in</code>\u5b57\u6bb5\u5f71\u54cd\uff1b</li> </ul> <p>Keep the latest artifacts for all jobs in the latest successful pipelines</p> <p>By default the artifacts of the most recent pipeline for each Git ref  are locked against deletion and kept regardless of the expiry time.</p> <ul> <li>\u9ed8\u8ba4\u6d41\u6c34\u7ebf\u7684 artifacts \u4e0d\u53d7\u8fc7\u671f\u65f6\u95f4\u5f71\u54cd\uff1b</li> <li>\u6b64\u8bbe\u7f6e\u4f18\u5148\u4e8e\u9879\u76ee\u7ea7\u522b\u8bbe\u7f6e\uff08Keep artifacts from most recent successful jobs\uff09</li> </ul>"},{"location":"devops/cicd/gitlab-ci.html#pipeline-artifacts","title":"Pipeline artifacts","text":"<p>Pipeline artifacts are different to job artifacts because they are not explicitly managed by .gitlab-ci.yml definitions.</p> <p>Pipeline artifacts are used by the test coverage visualization feature to collect coverage information.</p>"},{"location":"devops/cicd/gitlab-ci.html#gitlab-webhook","title":"Gitlab Webhook","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b</p> <ul> <li>\u65b0\u5efa\u5206\u652f\uff0c\u4f1a\u89e6\u53d1 pipeline\uff08\u9700\u8981\u5206\u6790\u662f\u5426\u7b26\u5408\u9884\u671f\uff09</li> <li>push \u65f6 total_commits_count \u4e3a0\u65f6\uff0c\u8868\u793a\u65b0\u5efa\u5206\u652f\u4f1a\u89e6\u53d1 pipeline hook</li> <li>1\u6b21 push webhook\uff1b</li> <li> <p>3\u6b21 pipeline webhook(pending -&gt; running -&gt; succeed)</p> </li> <li> <p>open a MergeRequest \u89e6\u53d1\u4e00\u6b21 webhook\uff0caction \u4e3a opened\uff0c \"merge_status\": \"preparing\",</p> </li> <li> <p>\u6ca1\u6709 pipeline id\uff0c\u6b64\u65f6\u53ea\u80fd\u751f\u6210\u94fe\u63a5\uff0c\u70b9\u51fb\u67e5\u770b</p> </li> <li> <p>approve a MergeRequest \u89e6\u53d1\u4e00\u6b21 webhook, action \u4e3a approved</p> </li> <li> <p>merge Request \u7684\u65f6\u5019\uff0cstate \u53d8\u6210 merged \uff0caction \u4e3a merge</p> </li> <li> <p>close merge request \u65f6\uff0cstate \u53d8\u6210 closed \uff0caction \u4e3a close</p> </li> </ul>"},{"location":"devops/cicd/gitlab-ci.html#quick-action","title":"Quick action","text":"<p>Gitlab \u5bf9\u4e8e Merge Request \u652f\u6301 quick action\uff0c\u5982 <code>/approve, /merge</code> \u3002</p>"},{"location":"devops/cicd/gitlab-ci.html#when-to-run","title":"When to Run","text":"<p>https://docs.gitlab.com/ee/ci/jobs/job_control.html</p> <p>\u624b\u52a8\u89e6\u53d1 job\uff1a</p> <ul> <li>\u9700\u8981\u5728 Pipeline \u754c\u9762\u8fdb\u884c\u70b9\u51fb\u5bf9\u5e94\u7684Job\u7684\u9636\u6bb5\u7684\u6309\u94ae\uff0c\u624d\u4f1a\u6267\u884c\uff1b</li> <li>Pipeline \u754c\u9762\u7684 \u201cRun Pipeline\" \u4e5f\u4e0d\u4f1a\u89e6\u53d1<code>when: manual</code> \u4fee\u9970\u7684Job\uff1b</li> </ul> <pre><code>when: manual\n</code></pre> <p>rules\uff1a include or exclude jobs in pipelines</p> <pre><code>job:on-schedule:\n  rules:\n    - if: $CI_PIPELINE_SOURCE == \"schedule\"\n  script:\n    - make world\n\njob:\n  rules:\n    - if: $CI_PIPELINE_SOURCE == \"push\"\n    - if: $VAR == \"string value\"\n      # Include the job and set to when:manual if any of the follow paths match a modified file.\n      changes:  \n        - Dockerfile\n        - docker/scripts/*\n      when: manual\n      allow_failure: true\n  script:\n    - make build\n</code></pre> <p>only\uff1aincludes the job if all of the keys have at least one condition that matches.</p> <p>except\uff1aexcludes the job if any of the keys have at least one condition that matches.</p> <pre><code>job:\n  only:\n    # use special keywords, \u7b49\u4ef7\u4e8e only:refs\n    - tags\n    - triggers\n    - schedules\n    # \u5206\u652f\n    - master\n    # \u901a\u8fc7\u53d8\u91cf\u63a7\u5236\u662f\u5426\u6267\u884c\uff0c\u652f\u6301 &amp;&amp; ||\n    variables:\n      - $CI_COMMIT_MESSAGE =~ /skip-end-to-end-tests/\n    # \u901a\u8fc7\u6587\u4ef6\u7684\u6539\u52a8\u63a7\u5236\u662f\u5426\u6267\u884c\n    changes:\n      - \"*.md\"\n    # \n</code></pre>"},{"location":"devops/cicd/gitlab-ci.html#environments-and-deployments","title":"Environments and deployments","text":"<p>\u5c06\u73af\u5883\u4fe1\u606f\u548c\u90e8\u7f72\u4fe1\u606f\u8fdb\u884c\u5173\u8054\uff0c\u65b9\u4fbf\u8fdb\u884c\u67e5\u770b\u548c\u7ba1\u7406\u3002</p> <p>\u73af\u5883\u5c31\u50cfCI\u4f5c\u4e1a\u7684\u6807\u8bb0\uff0c\u63cf\u8ff0\u4ee3\u7801\u7684\u90e8\u7f72\u4f4d\u7f6e\u3002\u5f53\u4f5c\u4e1a\u5c06\u4ee3\u7801\u7248\u672c\u90e8\u7f72\u5230\u73af\u5883\u65f6\uff0c\u4f1a\u521b\u5efa\u90e8\u7f72\uff0c\u56e0\u6b64\u6bcf\u4e2a\u73af\u5883\u90fd\u53ef\u4ee5\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u90e8\u7f72\u3002</p> <ul> <li>Provides a full history of deployments to each environment.</li> <li>Tracks your deployments, so you always know what is deployed on your servers.</li> </ul>"},{"location":"devops/cicd/gitlab-ci.html#review-apps","title":"Review Apps","text":"<p>https://docs.gitlab.cn/jh/ci/review_apps/index.html</p> <ul> <li>Gitlab \u9700\u8981\u96c6\u6210 K8s </li> </ul> <p>Review Apps \u662f\u4e00\u79cd\u534f\u4f5c\u5de5\u5177\uff0c\u53ef\u5e2e\u52a9\u63d0\u4f9b\u5c55\u793a\u4ea7\u54c1\u66f4\u6539\u7684\u73af\u5883\u3002</p> <ul> <li>\u4e3a\u60a8\u7684\u5408\u5e76\u8bf7\u6c42\u542f\u52a8\u52a8\u6001\u73af\u5883\uff0c\u63d0\u4f9b\u5bf9\u529f\u80fd\u5206\u652f\u4e2d\u6240\u505a\u66f4\u6539\u7684\u81ea\u52a8\u5b9e\u65f6\u9884\u89c8\u3002</li> <li>\u5141\u8bb8\u8bbe\u8ba1\u5e08\u548c\u4ea7\u54c1\u7ecf\u7406\u67e5\u770b\u60a8\u7684\u66f4\u6539\uff0c\u800c\u65e0\u9700\u68c0\u67e5\u60a8\u7684\u5206\u652f\u5e76\u5728\u6c99\u76d2\u73af\u5883\u4e2d\u8fd0\u884c\u60a8\u7684\u66f4\u6539\u3002</li> </ul> <p></p> <p>\u5728\u524d\u9762\u7684\u4f8b\u5b50\u4e2d\uff1a</p> <ul> <li>\u6bcf\u6b21\u5c06\u63d0\u4ea4\u63a8\u9001\u5230 <code>topic branch</code> \u65f6\u90fd\u4f1a\u6784\u5efa\u4e00\u4e2a Review App\u3002</li> <li>\u5ba1\u6838\u4eba\u5728\u901a\u8fc7\u7b2c\u4e09\u6b21\u5ba1\u6838\u4e4b\u524d\u672a\u901a\u8fc7\u4e24\u6b21\u5ba1\u6838\u3002</li> <li>\u5ba1\u6838\u901a\u8fc7\u540e\uff0c<code>topic branch</code> \u88ab\u5408\u5e76\u5230\u9ed8\u8ba4\u5206\u652f\uff0c\u5728\u90a3\u91cc\u5b83\u88ab\u90e8\u7f72\u5230 staging\u3002</li> <li>\u5728 staging \u88ab\u6279\u51c6\u540e\uff0c\u5408\u5e76\u5230\u9ed8\u8ba4\u5206\u652f\u7684\u66f4\u6539\u5c06\u90e8\u7f72\u5230\u751f\u4ea7\u4e2d\u3002</li> </ul>"},{"location":"devops/cicd/gitlab-jira.html","title":"Issue Track","text":""},{"location":"devops/cicd/gitlab-jira.html#gitlab-jira","title":"Gitlab \u96c6\u6210 Jira","text":"<p>\u60f3\u8981\u89e3\u51b3\u7684\u95ee\u9898\uff1a</p> <ul> <li>\u4ee3\u7801\u63a8\u9001\u5230gitlab\u65f6\uff0c\u81ea\u52a8\u5728jira\u4e0a\u6dfb\u52a0\u8bc4\u8bba\u4fe1\u606f\uff1b</li> <li>\u4ee3\u7801\u5408\u5e76\u65f6\uff0c\u81ea\u52a8\u5c06 Jira \u7684 issue \u5173\u95ed\uff1b</li> </ul>"},{"location":"devops/cicd/gitlab-jira.html#_1","title":"\u914d\u7f6e","text":"<p>\u53c2\u8003 https://docs.gitlab.com/ee/integration/jira/index.html</p>"},{"location":"devops/cicd/gitlab-jira.html#gitlab","title":"Gitlab\u7684\u914d\u7f6e","text":"<p>\u65b0\u589eGitlab Application\uff0c\u5982\u4e0b</p> <p></p> <p>\u914d\u7f6e jira Integration</p> <ul> <li> <p>\u914d\u7f6e\u4ec5 Merge Request \u624d\u4f1a\u89e6\u53d1\uff1b</p> </li> <li> <p>\u5141\u8bb8Jira\u7684\u72b6\u6001\u8f6c\u6362\uff0c\u81ea\u52a8\u8f6c\u6362\u4e3aDone\uff1b</p> </li> </ul> <p></p> <p></p>"},{"location":"devops/cicd/gitlab-jira.html#jira","title":"Jira\u914d\u7f6e","text":"<p>Jira DVCS connector</p> <ul> <li>Team or User Account \u586b\u5199 Gitlab User \u80fd\u591f\u8bbf\u95ee\u7684\u6700\u9876\u5c42\u7684 Group\uff1b</li> <li> <p>Host URL \u586b\u5199 Gitlab \u7684\u5730\u5740\uff1b</p> </li> <li> <p>Client ID \u5bf9\u5e94 Gitlab Application  \u7684 Application ID\uff1b</p> </li> <li>Client Secret \u5bf9\u5e94 Gitlab Application \u7684 Secret \uff1b</li> </ul> <p></p>"},{"location":"devops/cicd/gitlab-jira.html#_2","title":"\u4f7f\u7528\u8bf4\u660e","text":"<ol> <li>\u53ea\u6709\u9ed8\u8ba4\u5206\u652f\uff08\u53ef\u4ee5\u5728 GitLab -&gt; Settings \u4e2d\u914d\u7f6e\u9ed8\u8ba4\u5206\u652f\uff09\u7684 commit and merge \u4f1a\u89e6\u53d1\u5173\u95ed JIRA issue</li> <li>\u5df2\u6709\u89e3\u51b3\u65b9\u6848\u7684 JIRA issue \u5219\u4e0d\u4f1a\u53d1\u751f\u72b6\u6001\u6d41\u8f6c\uff08\u5c31\u662f\u6211\u4e4b\u524d\u8bf4\u7684\uff1a\u53ea\u4f1a\u5bf9 JIRA.issue.status.resolution = unresolved \u7684 issues \u751f\u6548\uff09</li> </ol> <p>Gitlab \u81ea\u52a8\u89e6\u53d1\u72b6\u6001\u6d41\u8f6c\u7684\u5173\u952e\u5b57\u6709\u4ee5\u4e0b 3 \u4e2a\uff1a</p> <ul> <li>Resolvers Issue-1</li> <li>Closes Issue-1</li> <li>Fixed Issue-1</li> </ul>"},{"location":"devops/cicd/gitlab-jira.html#feature","title":"Feature \u5206\u652f","text":"<p>Feature \u5206\u652f\u901a\u8fc7\u672c\u5730 commit -m 'Closes issue id' \u7136\u540e\u5408\u5e76\u5230\u9ed8\u8ba4\u5206\u652f\u5b9e\u73b0\uff08master\uff09</p> <p>\u8fd9\u79cd\u64cd\u4f5c\u5b9e\u73b0\u8d77\u6765\u5bf9\u5f00\u53d1\u4eba\u5458\u8981\u6c42\u4f1a\u9ad8\u4e00\u4e9b\uff0c\u8981\u6c42\u5f00\u53d1\u4eba\u5458\u9075\u5faa\u89c4\u8303\uff0c\u5728\u5b8c\u6210 Feature \u5206\u652f\u529f\u80fd\u5f00\u53d1\u540e\uff0c\u6309\u7167\u89c4\u8303\u63d0\u4ea4 commit \u5173\u952e\u5b57\u6765\u89e6\u53d1\u5de5\u4f5c\u6d41\uff0c\u5177\u4f53\u5982\u4e0b\uff1a</p> <pre><code>git checkout phoenix/feature/TEST-223 \ngit commit -m 'feat: add cache support, Closes TEST-223' \n</code></pre> <p>\u8fd9\u79cd\u65b9\u5f0f\u7684\u597d\u5904\u662f\u9879\u76ee\u8d1f\u8d23\u4eba\u4e0d\u9700\u8981\u63d0\u524d\u6536\u96c6\u548c\u6574\u7406 issue\uff0c\u4e5f\u4e0d\u9700\u8981\u5728 Release \u8fdb\u884c Merge Request \u7684\u65f6\u5019\u5728\u5408\u5e76\u63cf\u8ff0 Description \u6dfb\u52a0\u89e6\u53d1\u5173\u952e\u5b57\uff0c\u76f4\u63a5\u63d0\u4ea4 Release \u5206\u652f\u5408\u5e76\u5373\u53ef\uff0c</p>"},{"location":"devops/cicd/gitlab-jira.html#_3","title":"\u6548\u679c","text":""},{"location":"devops/cicd/gocd.html","title":"Gocd","text":""},{"location":"devops/cicd/jenkinsx.html","title":"Jenkinsx","text":"<p>All In One CI/CD including everything you need to start exploring Kubernetes.</p> <p>Jenkins X \u662f\u57fa\u4e8e Kubernetes \u7684CI&amp;CD\u5e73\u53f0\uff0c\u4f7f\u7528GO\u8bed\u8a00\u5f00\u53d1\uff0c\u4f5c\u4e3aJenkins\u7684\u4e00\u4e2a\u5b50\u9879\u76ee\u3002</p> <ul> <li>\u4f7f\u7528Tekton\u4f5c\u4e3a\u9ed8\u8ba4\u6267\u884c\u5f15\u64ce\uff1b</li> <li>\u91c7\u7528CLI\u548cAPI\u4f18\u5148\u7684\u65b9\u6cd5\uff1b</li> <li>\u9884\u89c8\u73af\u5883\u80fd\u591f\u8ba9\u5f00\u53d1\u4eba\u5458\u534f\u540c\u9a8c\u8bc1\u5404\u79cd\u53d8\u66f4\u3002</li> </ul>"},{"location":"devops/cicd/jenkinsx.html#_1","title":"\u5f00\u6e90\u96c6\u6210","text":"<p>Tekton Cloud Native pipeline orchestration</p> <p>Kuberhealthy Periodic health checks of the systems</p> <p>Nexus [optional] artifact repository</p>"},{"location":"devops/cicd/jenkinsx.html#_2","title":"\u57fa\u7840\u8bbe\u65bd","text":"<p>GitOps</p> <p>Secret Management</p> <p>Pipelines</p> <p>ChatOps</p>"},{"location":"devops/cicd/jenkinsx.html#_3","title":"\u67b6\u6784","text":"<p>Cluster Repo</p> <p>Project APP</p>"},{"location":"devops/cicd/jenkinsx.html#git-operator","title":"Git Operator","text":"<p><code>jx-git-operator</code> is an operator which polls a git repository for changes and triggers a Kubernetes <code>Job</code> to process the changes in git.</p>"},{"location":"devops/cicd/jenkinsx.html#boot-job","title":"Boot Job","text":"<ul> <li>\u9ed8\u8ba4\u7684Job\u6587\u4ef6\u8def\u5f84\u5728<code>versionStream/git-operator/job.yaml</code>\uff1b</li> <li> <p>\u5728\u542f\u52a8\u65f6\u8fd0\u884c\uff0c\u5e76\u5728\u4efb\u4f55git \u63d0\u4ea4\u5230\u7528\u4e8eGitOps\u5b58\u50a8\u5e93\uff08\u5b89\u88c5Git Operator\u65f6\u6307\u5b9a\uff09\u65f6\u8fd0\u884c\u3002</p> </li> <li> <p>Boot Job \u4f1a\u8fd0\u884c Generate Step \u548c Apply Step\uff1b</p> </li> </ul> <p>Generate Step</p> <p>\u8fd0\u884c\u7684\u573a\u666f\uff1a</p> <ul> <li>\u542f\u52a8\u65f6\uff1b</li> <li>Pull Request\u7684\u6bcf\u6b21commit\uff1b</li> <li>\u63d0\u4ea4\u5230\u4e3b\u5206\u652f\u4e14\u4e0d\u662fPull Request\u7684\u5408\u5e76\u7684commit\uff1b</li> </ul> <p>\u8fd0\u884c\u65f6\u505a\u7684\u4e8b\u60c5\uff1a</p> <ul> <li><code>jx-values.yaml</code></li> <li><code>helmfile.yaml</code></li> <li><code>helm template</code>\u547d\u4ee4\u5bf9charts\u751f\u6210k8s\u8d44\u6e90\uff1b</li> <li>\u62f7\u8d1d\u751f\u6210\u7684\u8d44\u6e90\u5230config-root/namespaces/${myns}/${chart_name}/*.yaml</li> <li>Secret \u8d44\u6e90\u8f6c\u6362\u6210 ExternalSecret\uff0c\u53ef\u4ee5\u88abgit check\uff1b</li> </ul> <p>Apply step</p> <ul> <li>\u5728Generate Step\u540e\u9762\u6267\u884c\uff0c\u672c\u8d28\u4e0a\u662f\u5bf9 <code>config-root</code>\u4e2d\u7684\u8d44\u6e90\u6267\u884c<code>kubectl apply</code>\uff1b</li> </ul> <p>\uff1f\uff1fCluster Repo \u548c Create Project \u662f\u5565\u533a\u522b \uff1f\uff1f</p> <p>\u6bcf\u4e2akubernetes\u96c6\u7fa4\u90fd\u6709\u4e00\u4e2agit\u5b58\u50a8\u5e93\uff0c\u8fd9\u6837\u6240\u6709\u540d\u79f0\u7a7a\u95f4\u4e2d\u7684\u6240\u6709kubernete\u8d44\u6e90\u90fd\u53ef\u4ee5\u7531GitOps\u7ba1\u7406\u3002</p>"},{"location":"devops/cicd/jenkinsx.html#jenkins-x-lighthouse","title":"Jenkins-x Lighthouse","text":"<p>Lighthouse \u662f\u4e00\u4e2a\u57fa\u4e8e webhooks \u7684\u8f7b\u91cf\u7ea7 ChatOps \u5de5\u5177 , \u901a\u8fc7 Git \u4ed3\u5e93\u7684 webhooks \u53ef\u4ee5\u89e6\u53d1 Jenkins X \u6d41\u6c34\u7ebf \u3001Tekton \u6d41\u6c34\u7ebf \u3001Jenkins \u4efb\u52a1, \u652f\u6301 GitHub\u3001GitHub Enterprise\u3001BitBucket Server \u548c GitLab\u3002</p>"},{"location":"devops/cicd/jenkinsx.html#_4","title":"\u5b89\u88c5","text":"<p>\u4f7f\u7528 Git Operator \u8fdb\u884c JenkinsX \u7684\u5b89\u88c5\u548c\u90e8\u7f72</p>"},{"location":"devops/cicd/jenkinsx.html#k8s","title":"K8s\u73af\u5883","text":"<p>https://jenkins-x.io/v3/admin/platforms/on-premises/</p> <ol> <li> <p>\u4e0b\u8f7djx 3.x\u547d\u4ee4 Download and install the jx 3.x binary</p> </li> <li> <p>Ingress</p> </li> <li> <p>Storage\uff1a\u9700\u8981\u6709\u9ed8\u8ba4\u7684<code>storage class</code>\uff1b</p> </li> <li> <p>\u57fa\u4e8e jx3-gitops-repositories/jx3-kubernetes template \u521b\u5efa\u96c6\u7fa4\u7684Git\u5b58\u50a8\u5e93\uff0c\u5e76git clone\u4e0b\u6765\uff1b</p> </li> <li> <p>\u5b89\u88c5Operator\uff1a\u5728\u672c\u5730git\u4ed3\u5e93\u4e2d\uff0c\u6267\u884c<code>jx admin operator --username mygituser --token mygittoken</code>\uff1b\u5982\u679c\u4e0d\u5728git\u4ed3\u5e93\u4e2d\uff0c\u5219\u9700\u8981\u6307\u5b9a<code>--url=https://github.com/myorg/env-mycluster-dev.git</code></p> </li> </ol> <p>This command will use helm to install the git operator which will trigger a Job to install Jenkins X (and re-trigger a Job whenever you commit to your git repository)</p> <ol> <li><code>jx project quickstart</code> \u4e24\u4e2arepo\u7684\u5173\u8054\u662f\u5565\uff1f</li> </ol> <pre><code>$ ./jx project quickstart\nInstalling plugin jx-project version 0.2.54 for command jx project from https://github.com/jenkins-x-plugins/jx-project/releases/download/v0.2.54/jx-project-linux-amd64.tar.gz into /root/.jx3/plugins/bin\n</code></pre> <pre><code>$ ./jx admin log\nInstalling plugin jx-admin version 0.2.1 for command jx admin from https://github.com/jenkins-x-plugins/jx-admin/releases/download/v0.2.1/jx-admin-linux-amd64.tar.gz into /root/.jx3/plugins/bin\n</code></pre> <pre><code>$ jx admin operator\nInstalling plugin helm version 3.6.2 for command jx helm from https://get.helm.sh/helm-v3.6.2-linux-amd64.tar.gz into /root/.jx3/plugins/bin\n</code></pre>"},{"location":"devops/cicd/jenkinsx.html#_5","title":"\u73af\u5883","text":"<p>\u9ed8\u8ba4\u7684<code>Staging</code>\u548c<code>Production</code>\u73af\u5883\u6620\u5c04\u5230\u540d\u7a7a\u95f4 <code>jx-staging</code>\u548c<code>jx-production</code>\uff1b</p>"},{"location":"devops/cicd/jenkinsx.html#_6","title":"\u914d\u7f6e","text":"<p>Gitop\u4ed3\u5e93\u4e2d\u7684<code>jx-requirements.yml</code>\u5b9a\u4e49\u9ed8\u8ba4\u7684\u73af\u5883\u4fe1\u606f\u3002</p>"},{"location":"devops/cicd/jenkinsx.html#_7","title":"\u591a\u96c6\u7fa4","text":""},{"location":"devops/cicd/jenkinsx.html#_8","title":"\u4ed3\u5e93\u81ea\u5b9a\u4e49\u73af\u5883","text":"<p>use different sets of environments for different microservices </p>"},{"location":"devops/cicd/jenkinsx.html#_9","title":"\u591a\u96c6\u7fa4\u652f\u6301","text":""},{"location":"devops/cicd/jenkinsx.html#_10","title":"\u4f7f\u7528","text":""},{"location":"devops/cicd/jenkinsx.html#cli","title":"CLI","text":""},{"location":"devops/cicd/jenkinsx.html#jx-admin","title":"jx admin","text":"<p>commands for creating and upgrading Jenkins X environments using GitOps</p>"},{"location":"devops/cicd/jenkinsx.html#jx-application","title":"jx application","text":"<p>Command for viewing deployed Applications across Environments</p>"},{"location":"devops/cicd/jenkinsx.html#ui","title":"UI","text":""},{"location":"devops/cicd/prow.html","title":"Prow","text":"<p>Prow \u662f\u4e00\u4e2a Kubernetes \u539f\u751f CI/CD \u7cfb\u7edf\uff0cKubernetes\u3001Istio \u7b49\u9879\u76ee\u90fd\u4f7f\u7528 Prow \u5b9e\u73b0\u5f00\u6e90\u534f\u540c\u3002 </p> <p>\u76ee\u524d\u4ec5\u652f\u6301GitHub\u3002Gitlab\u96c6\u6210\u7684Prorosal\uff1b</p>"},{"location":"devops/cicd/prow.html#_1","title":"\u4f7f\u7528","text":"<p>\u9700\u8981\u521b\u5efa\u4e00\u4e2agithub\u673a\u5668\u4eba\u8d26\u53f7\uff0c\u9700\u8981k8s\u96c6\u7fa4\u4ee5\u53ca\u786c\u4ef6\u8d44\u6e90\uff0c\u7f51\u7edc\u8d44\u6e90\uff0c\u521b\u5efa\u94a9\u5b50\uff0c\u90e8\u7f72\uff0c\u4e8c\u6b21\u5f00\u53d1\u3002</p> <p>\u5b98\u65b9\u53c2\u8003</p> <p>\u793a\u4f8bQuickStart</p>"},{"location":"devops/cicd/release_changelog.html","title":"\u7248\u672c\u81ea\u52a8\u53d1\u5e03","text":""},{"location":"devops/cicd/release_changelog.html#git-commit","title":"\u89c4\u8303\u5316 git commit \u4fe1\u606f","text":"<p>\u53c2\u8003\uff1a\u89c4\u8303\u5316git commit\u4fe1\u606f</p> <p>\u7528\u4e8e\u8bc6\u522b Feat, Fix, Test \u7b49\u7279\u6027\u3002</p>"},{"location":"devops/cicd/release_changelog.html#1-commit","title":"1. commit\u57fa\u672c\u8981\u6c42","text":"<p>Git-Commit-Best-Practices\u8fd9\u4e2a\u9879\u76ee\u603b\u7ed3\u4e86\u4e00\u4e2a\u6700\u57fa\u672c\u7684 git commit \u5b9e\u8df5:</p> <ul> <li>Commit Related Changes\uff08 \u63d0\u4ea4\u76f8\u5173\u7684\u6539\u53d8\uff09</li> <li>Commit Often \uff08\u7ecf\u5e38\u63d0\u4ea4\uff09</li> <li>Don\u2019t Commit Half-Done Work \uff08\u53ea\u63d0\u4ea4\u5b8c\u6210\u7684\u5de5\u4f5c\uff09</li> <li>Test Your Code Before You Commit \uff08\u63d0\u4ea4\u524d\u9700\u8981\u6d4b\u8bd5\u4ee3\u7801\uff09</li> <li>Write Good Commit Messages\uff08\u5199\u826f\u597d\u7684\u63d0\u4ea4\u8bb0\u5f55\uff09</li> <li>Use Branches \uff08\u4f7f\u7528\u5206\u652f\uff09</li> <li>Agree on A Workflow \uff08\u8ba4\u540c\u5de5\u4f5c\u6d41\uff09</li> </ul>"},{"location":"devops/cicd/release_changelog.html#2-commit","title":"2. \u5f00\u6e90\u9879\u76ee\u7684Commit\u793a\u4f8b","text":"<p>Angular\u9879\u76ee\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u751f\u6210Release Notes</p> <p></p>"},{"location":"devops/cicd/release_changelog.html#3-commit","title":"3. Commit \u89c4\u8303","text":"<p>commit \u57fa\u672c\u683c\u5f0f\u5982\u4e0b:</p> <pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;\n&lt;BLANK LINE&gt;\n&lt;body&gt;\n&lt;BLANK LINE&gt;\n&lt;footer&gt;\n</code></pre> <p><code>type</code>\u7528\u4e8e\u8bf4\u660e commit \u7684\u7c7b\u522b\uff0c\u53ea\u5141\u8bb8\u4f7f\u7528\u4e0b\u9762 7 \u4e2a\u6807\u8bc6:</p> <ul> <li><code>feat</code>\uff1a\u65b0\u529f\u80fd\uff08feature\uff09</li> <li><code>fix</code>\uff1a\u4fee\u8865 bug</li> <li><code>docs</code>\uff1a\u6587\u6863\uff08documentation\uff09</li> <li><code>style</code>\uff1a \u683c\u5f0f\uff08\u4e0d\u5f71\u54cd\u4ee3\u7801\u8fd0\u884c\u7684\u53d8\u52a8\uff09</li> <li><code>refactor</code>\uff1a\u91cd\u6784\uff08\u5373\u4e0d\u662f\u65b0\u589e\u529f\u80fd\uff0c\u4e5f\u4e0d\u662f\u4fee\u6539 bug \u7684\u4ee3\u7801\u53d8\u52a8\uff09</li> <li><code>test</code>\uff1a\u589e\u52a0\u6d4b\u8bd5</li> <li><code>chore</code>\uff1a\u6784\u5efa\u8fc7\u7a0b\u6216\u8f85\u52a9\u5de5\u5177\u7684\u53d8\u52a8</li> <li><code>ci</code> \uff1aCI \u76f8\u5173\u7684\u6539\u52a8</li> <li><code>perf</code> \uff1a\u6027\u80fd\u63d0\u5347\u7684\u4ee3\u7801\u6539\u52a8\uff08\u4e0d\u65b0\u589e\u529f\u80fd\uff09</li> </ul> <p>\u901a\u5e38<code>feat</code>\u548c<code>fix</code>\u4f1a\u88ab\u653e\u5165 changelog \u4e2d\uff0c\u5176\u4ed6(<code>docs</code>\u3001<code>chore</code>\u3001<code>style</code>\u3001<code>refactor</code>\u3001<code>test</code>)\u901a\u5e38\u4e0d\u4f1a\u653e\u5165 changelog \u4e2d\u3002</p> <p><code>scope</code>\u7528\u4e8e\u8bf4\u660e commit \u5f71\u54cd\u7684\u8303\u56f4\uff0c\u53ef\u9009\u503c\u3002\u901a\u5e38\u662f\u6587\u4ef6\u3001\u8def\u5f84\u3001\u529f\u80fd\u7b49\u3002</p> <p><code>subject</code>\u662f commit \u76ee\u7684\u7684\u7b80\u77ed\u63cf\u8ff0\uff0c\u4e0d\u8d85\u8fc7 50 \u4e2a\u5b57\u7b26\u3002</p> <p><code>Body</code>\u90e8\u5206\u662f\u5bf9\u672c\u6b21 commit \u7684\u8be6\u7ec6\u63cf\u8ff0\uff0c\u53ef\u4ee5\u5206\u6210\u591a\u884c\u3002</p> <p><code>Footer</code> \u90e8\u5206\u53ea\u7528\u4e8e\u4e24\u79cd\u60c5\u51b5:</p> <ul> <li><code>Break Changes</code>\uff1a\u4e0d\u517c\u5bb9\u53d8\u52a8</li> <li><code>Closes</code>\uff1a\u5173\u95edIssue</li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>feat(python): add greedy_snake.py\n\nCloses #73\n</code></pre>"},{"location":"devops/cicd/release_changelog.html#4-git-commit","title":"4. \u672c\u5730\u914d\u7f6egit commit\u89c4\u8303\u68c0\u67e5","text":""},{"location":"devops/cicd/release_changelog.html#41-commit","title":"4.1 commit\u4e4b\u540e\u901a\u8fc7\u547d\u4ee4\u8fdb\u884c\u68c0\u67e5","text":"<p>\u5728git commit\u7684hook\u4e2d\u52a0\u5165commitlint\u68c0\u6d4b\uff0c\u4e0d\u7b26\u5408 commit \u89c4\u8303\u7684\u63d0\u4ea4\u5728\u672c\u5730\u5c31\u65e0\u6cd5\u63d0\u4ea4\u8fdb\u53bb\u3002</p> <pre><code># 1. \u5b89\u88c5commitlint\u547d\u4ee4\u884c\u548c\u9a8c\u8bc1\u4f7f\u7528\u7684\u89c4\u5219config-conventional\nnpm install -g @commitlint/config-conventional @commitlint/cli\n\n# linux shell \u6216\u8005 windows git-bash\u73af\u5883\u6267\u884cecho\u547d\u4ee4\n# 2.1 \u5355\u4e2a\u9879\u76ee\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6bcf\u4e2a\u9879\u76ee\u53ef\u4ee5\u914d\u7f6e\u4e0d\u540c\u7684commit lint\u89c4\u8303\necho \"module.exports = {extends: ['@commitlint/config-conventional']}\" &gt; commitlint.config.js\n\n# 2.1 \u5168\u5c40commitlint.config.js\u914d\u7f6ewindows\u4e0b\u6682\u65f6\u4e0d\u77e5\u5982\u4f55\u914d\u7f6e\n\n# 3. \u9a8c\u8bc1\u6700\u65b0\u4e00\u6761\u63d0\u4ea4\u8bb0\u5f55(\u5fc5\u987b\u6dfb\u52a0\u4e0a\u8ff0\u914d\u7f6e\uff0c\u5426\u5219\u9700\u8981\u52a0\u4e0a -x \"@commitlint/config-conventional\")\ncommitlint -e\n\n# 3.2 \u68c0\u67e5\u4fe1\u606f\u662f\u5426\u7b26\u5408\u914d\u7f6e\uff08linux shell \u6216\u8005 windows git-bash\uff09\necho \"your commit message\" | commitlint\n</code></pre>"},{"location":"devops/cicd/release_changelog.html#42-gitcommit","title":"4.2 \u96c6\u6210git\u547d\u4ee4\u5728commit\u65f6\u68c0\u67e5","text":"<p>git-cz \u662f\u4e00\u4e2a\u7b80\u5316\u7248\u7684<code>commitizen+cz-conventional-changelog</code>\u7ec4\u5408\uff0c\u63d0\u4f9b\u4e86\u5f00\u7bb1\u5373\u7528\u7684\u529f\u80fd\uff0c\u9ed8\u8ba4\u4f7f\u7528Angular\u89c4\u8303\uff0c\u9ed8\u8ba4\u6a21\u677f\u4e0d\u586b\u5199scope\u90e8\u5206\u5185\u5bb9\u3002</p> <pre><code># \u5b89\u88c5git-cz\u5305\nnpm install -g git-cz\n\n# \u4ee5\u540e\u6240\u6709\u4f7f\u7528git commit\u7684\u5730\u65b9\u90fd\u7528git-cz\u6216git cz\u547d\u4ee4\u63d0\u4ea4\u4ee3\u7801\n# \u4ea4\u4e92\u5f0f\u4f7f\u7528\uff0c\u517c\u5bb9git commit \u7684\u53c2\u6570\uff0c\u6bd4\u5982-a, --amend\ngit cz \n</code></pre>"},{"location":"devops/cicd/release_changelog.html#43-git-hookcommit","title":"4.3 \u6dfb\u52a0git hook\u5728commit\u65f6\u68c0\u67e5\uff08\u63a8\u8350\uff09","text":""},{"location":"devops/cicd/release_changelog.html#nodejs","title":"NodeJS\u9879\u76ee","text":"<p>NodeJS \u9879\u76ee\u76f4\u63a5\u4f7f\u7528 husky\uff1a</p> <pre><code>npm install -D husky\n</code></pre> <p>\u5b89\u88c5<code>@commitlint/cli</code>\u548c<code>@commitlint/config-conventional</code>\u8fd9\u4e24\u4e2a\u5305\uff08\u5efa\u8bae\u5b89\u88c5\u5230\u5168\u5c40\uff0c\u8fd9\u6837\u6240\u6709\u9879\u76ee\u90fd\u53ef\u4ee5\u7528\uff09:</p> <pre><code>npm install -g @commitlint/cli @commitlint/config-conventional\n</code></pre> <p>\u7136\u540e\u5728 package.json \u6dfb\u52a0 husky \u914d\u7f6e:</p> <pre><code>{\n  \"husky\": {\n    \"hooks\": {\n      \"commit-msg\": \"commitlint -x @commitlint/config-conventional -E HUSKY_GIT_PARAMS\"\n    }\n  }\n}\n</code></pre> <p>\u7136\u540e\u4f7f\u7528<code>git commit</code>\u4f1a\u89e6\u53d1<code>husky</code>\u7684hook\uff0c\u68c0\u6d4bcommit\u8bb0\u5f55\u662f\u5426\u7b26\u5408\u89c4\u8303\u3002</p>"},{"location":"devops/cicd/release_changelog.html#_2","title":"\u5176\u4ed6\u7c7b\u578b\u9879\u76ee","text":"<p>\u5176\u5b83\u9879\u76ee\uff0c\u624b\u52a8\u6dfb\u52a0 git hook\uff0c\u4ecd\u7136\u4f7f\u7528<code>husky</code></p> <pre><code># \u5168\u5c40\u5b89\u88c5husky\nnpm install -g husky\n\n# 1. \u5b89\u88c5commitlint\u547d\u4ee4\u884c\u548c\u9a8c\u8bc1\u4f7f\u7528\u7684\u89c4\u5219config-conventional\nnpm install -g @commitlint/config-conventional @commitlint/cli\n</code></pre> <p>\u9879\u76ee\u4e2d\u521d\u59cb\u5316husky\u914d\u7f6e</p> <pre><code># husky \u5bf9\u9879\u76ee\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u521b\u5efa\u76ee\u5f55.husky\u76ee\u5f55\u548c\u811a\u672chusky.sh\nhusky install\n\n# \u6dfb\u52a0commit-msg hook\uff0c\u6267\u884c`npx commitlint --edit $1` \u547d\u4ee4\uff0c\u5bf9commit message\u8fdb\u884c\u68c0\u9a8c\nhusky add .husky/commit-msg \"commitlint -x @commitlint/config-conventional --edit $1\"\n\n# \u53ef\u9009\uff0c\u5982\u679c\u4e0d\u7528-x @commitlint/config-conventional\uff0c\u5219\u9700\u8981\u9879\u76ee\u4e2d\u914d\u7f6ecommitlint.config.js\u6587\u4ef6\n# echo \"module.exports = {extends: ['@commitlint/config-conventional']}\" &gt; commitlint.config.js\u6587\u4ef6\n</code></pre> <p>\u6267\u884cgit commit\u65f6\uff08\u6ce8\u610f\u7a7a\u683c\uff09\uff0c\u4f1a\u8fdb\u884c\u547d\u4ee4\u8f93\u51fa</p> <p></p> <p></p> <p>\u5220\u9664 husky \u548c git hook</p> <pre><code>npm uninstall husky &amp;&amp; git config --unset core.hooksPath\n</code></pre>"},{"location":"devops/cicd/release_changelog.html#5-gitlab-ci-git-commit","title":"5. gitlab CI \u914d\u7f6e git commit \u89c4\u8303\u68c0\u67e5","text":"<p>\u7b2c4\u90e8\u5206\u5185\u5bb9\u662f\u5728\u5f00\u53d1\u672c\u5730\u505a\u7684\uff0c\u56e0\u6b64\u9700\u8981\u7981\u6b62\u5f00\u53d1\u4eba\u5458\u5220\u9664hook\u3002</p> <p>\u5728 gitlab ci \u4e2d\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u68c0\u6d4b\u5f53\u524d\u63d0\u4ea4\u662f\u5426\u7b26\u5408 conventional-changelog \u89c4\u8303:</p> <pre><code>image: node:latest\n\nstages:\n  - test\n\ncompile_job:\n  stage: test\n  script:\n    - npm install \"@commitlint/cli\" \"@commitlint/config-conventional\" \"commitlint-format-junit\" \n    - npx commitlint -x @commitlint/config-conventional -o commitlint-format-junit -f ${CI_COMMIT_BEFORE_SHA} &gt; commitlint_result.xml\n  artifacts:\n    name: \"$CI_JOB_NAME-$CI_COMMIT_REF_NAME\"\n    reports:\n      junit: commitlint_result.xml\n</code></pre> <ul> <li><code>$CI_COMMIT_BEFORE_SHA</code> \u662f gitlab ci \u7684\u5185\u7f6e\u53d8\u91cf\uff1b</li> </ul> <p>\u5c06 lint result \u8f93\u51fa\u4e3a Junit \u683c\u5f0f\uff0c\u65b9\u4fbf Gitlab \u5728 merge request \u7684\u65f6\u5019\u5c55\u793a lint \u5931\u8d25\u7684\u7ed3\u679c\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p>"},{"location":"devops/cicd/release_changelog.html#semantic-release","title":"semantic-release \u81ea\u52a8\u53d1\u5e03","text":"<p>\u66f4\u9002\u5408\u5728 CI \u73af\u5883\u4e2d\u8fd0\u884c\uff0c\u81ea\u5e26\u652f\u6301\u5404\u79cd git server \u7684\u8ba4\u8bc1\u652f\u6301\uff0c\u5982 Github\uff0cGitlab\uff0cBitbucket \u7b49\u7b49\uff0c\u6b64\u5916\uff0c\u8fd8\u652f\u6301\u63d2\u4ef6\uff0c\u4ee5\u4fbf\u5b8c\u6210\u5176\u4ed6\u540e\u7eed\u7684\u6d41\u7a0b\u6b65\u9aa4\uff0c\u6bd4\u5982\u81ea\u52a8\u751f\u6210 git tag \u548c release note \u4e4b\u540e\u518d push \u56de\u4e2d\u592e\u4ed3\u5e93\uff0c\u81ea\u52a8\u53d1\u5e03 npm \u5305\u7b49\u7b49\u3002</p> <p>\u5927\u81f4\u7684\u5de5\u4f5c\u6d41\u5982\u4e0b:</p> <ul> <li>\u63d0\u4ea4\u5230\u7279\u5b9a\u7684\u5206\u652f\u89e6\u53d1 release \u6d41\u7a0b</li> <li>\u9a8c\u8bc1 commit \u4fe1\u606f\uff0c\u751f\u6210 <code>release note</code>\uff0c\u6253 <code>git tag</code></li> <li>\u5176\u4ed6\u540e\u7eed\u6d41\u7a0b\uff0c\u5982\u751f\u6210<code>CHANGELOG.md</code>\uff0c<code>npm publish</code>\u7b49\u7b49\uff08\u901a\u8fc7\u63d2\u4ef6\u5b8c\u6210\uff09</li> </ul> <p><code>npm install -g @semantic-release</code></p> <ul> <li>\u9ed8\u8ba4\u5b89\u88c5 \"@semantic-release/commit-analyzer\"\uff0c\"@semantic-release/github\"\uff0c\"@semantic-release/npm\"\uff0c \"@semantic-release/release-notes-generator\"</li> </ul>"},{"location":"devops/cicd/release_changelog.html#_3","title":"\u7248\u672c\u53f7\u66f4\u65b0\u903b\u8f91","text":"<p>\u7248\u672c\u53f7\u66f4\u65b0\u7684\u903b\u8f91\uff1a\u53ea\u6709 feat \u548c fix \u63d0\u4ea4\u624d\u4f1a\u89e6\u53d1\u7248\u672c\u5347\u7ea7</p> <ul> <li>\u5982\u679c\u5305\u542b feat \u8bb0\u5f55\uff0c\u7248\u672c\u75311.0.0\u5347\u7ea7\u5230\u4e861.1.0</li> <li>\u53ea\u6709 fix \u8bb0\u5f55\uff0c\u7248\u672c\u75311.1.0\u5347\u7ea7\u5230\u4e861.1.1</li> <li>feat \u4e14 commit footer\u5185\u6709<code>BREAKING CHANGE:</code> \u63d0\u4ea4\u5c06\u4f1a\u5347\u7ea7\u4e3b\u7248\u672c\u53f7,\u7248\u672c\u75311.2.0\u5347\u7ea7\u5230\u4e862.0.0</li> </ul>"},{"location":"devops/cicd/release_changelog.html#git","title":"Git \u4ed3\u5e93\u8ba4\u8bc1","text":"<p>https://github.com/semantic-release/semantic-release/blob/master/docs/usage/ci-configuration.md#authentication</p> <p>Gitlab \u4ed3\u5e93\u9700\u8981\u914d\u7f6e <code>GL_TOKEN</code> or <code>GITLAB_TOKEN</code></p>"},{"location":"devops/cicd/release_changelog.html#_4","title":"\u751f\u547d\u5468\u671f","text":"Step Description Verify Conditions Verify all the conditions to proceed with the release. Get last release Obtain the commit corresponding to the last release by analyzing Git tags. Analyze commits Determine the type of release based on the commits added since the last release. Verify release Verify the release conformity. Generate notes Generate release notes for the commits added since the last release. Create Git tag Create a Git tag corresponding to the new release version. Prepare Prepare the release. Publish Publish the release. Notify Notify of new releases or errors."},{"location":"devops/cicd/release_changelog.html#_5","title":"\u63d2\u4ef6","text":""},{"location":"devops/cicd/release_changelog.html#semantic-releasecommit-analyzer","title":"@semantic-release/commit-analyzer(\u81ea\u5e26)","text":"<p>analyze commits with conventional-changelog</p> <ul> <li>\u9ed8\u8ba4<code>preset</code>\u4f7f\u7528 angular \u5f62\u5f0f\u7684commit\u89c4\u8303\uff1b</li> </ul>"},{"location":"devops/cicd/release_changelog.html#sematic-releaserelease-notes-generator","title":"@sematic-release/release-notes-generator(\u81ea\u5e26)","text":"<p>generate changelog content with conventional-changelog</p> <p>\u901a\u8fc7<code>conventional-changelog</code>\u63d2\u4ef6\uff0c\u751f\u6210\u4ece\u4e0a\u4e2arelease\u5230\u73b0\u5728\u7684\u53d8\u66f4\u4fe1\u606f\u3002</p> <ul> <li>\u9ed8\u8ba4<code>preset</code>\u4f7f\u7528 angular \u5f62\u5f0f\u7684commit\u89c4\u8303\uff1b</li> </ul>"},{"location":"devops/cicd/release_changelog.html#semantic-releasechangelog","title":"@semantic-release/changelog","text":"<p>Create or update a changelog file in the local project directory with the changelog content created in the generate notes step.</p> <p>\u521b\u5efa\u6216\u66f4\u65b0changelog\u6587\u4ef6\uff08\u9ed8\u8ba4\u8def\u5f84\u4e3a <code>CHANGELOG.md</code>\uff09</p> <pre><code>$ npm install @semantic-release/changelog -D\n</code></pre> <ul> <li>\u5982\u679c\u548c<code>@semantic-release/git</code>\u548c<code>@semantic-release/npm</code>\u5171\u7528\uff0c\u5219\u5176\u4f4d\u7f6e\u5fc5\u987b\u5728\u6700\u524d\u9762\u3002</li> </ul>"},{"location":"devops/cicd/release_changelog.html#semantic-releasegit","title":"@semantic-release/git","text":"<ul> <li>\u652f\u6301\u5c06\u67d0\u4e9b\u6587\u4ef6\u53cd\u5411 push \u56de\u4e2d\u592e\u4ed3\u5e93\uff08\u5e76\u6dfb\u52a0<code>skip ci</code> commit \u4fe1\u606f\u8df3\u8fc7 CI \uff09</li> <li>\u9ed8\u8ba4\u7684\u6587\u4ef6\u4e3a<code>['CHANGELOG.md', 'package.json', 'package-lock.json', 'npm-shrinkwrap.json']</code></li> </ul> <p>\u914d\u7f6e\uff0c<code>.releaserc</code></p> <pre><code>{\n  \"plugins\": [\n    [\"@semantic-release/git\", {\n          // \u914d\u7f6e\u54ea\u4e9b\u6587\u4ef6\u4f1a\u88ab add \u63a8\u9001\u56de\u4ed3\u5e93\n          \"assets\": [\"Dockerfile\", \"./build/userservice.yaml\",\"./build/version.md\", \"CHANGELOG.md\"],\n          // \u81ea\u5b9a\u4e49 commit \u4fe1\u606f\u7684\u683c\u5f0f\n          \"message\": \"chore(release): ${nextRelease.version} [skip ci]\\n\\n${nextRelease.notes}\"\n     }\n    ],\n  ]\n}\n</code></pre>"},{"location":"devops/cicd/release_changelog.html#semantic-releasegitlab","title":"@semantic-release/gitlab","text":"<p>publish a GitLab release</p> <p>\u9ed8\u8ba4\u4f1a\u901a\u8fc7 <code>CI_API_V4_URL</code>\u5185\u7f6e\u7684\u73af\u5883\u53d8\u91cf\u8bc6\u522b Gitlab \u7684\u5730\u5740</p> <ul> <li>\u5982\u679c Gitlab SSL \u6ca1\u914d\u7f6e\u597d\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0 404 \u7684\u95ee\u9898\uff0c\u6b64\u65f6\u901a\u8fc7CI/CD\u91cd\u65b0\u5b9a\u4e49\u8be5\u53d8\u91cf\uff0c\u89e3\u51b3\u95ee\u9898\u3002</li> </ul> <pre><code>{\n    \"plugins\": [\n        \"@semantic-release/commit-analyzer\",\n        \"@semantic-release/release-notes-generator\",\n        \"@semantic-release/changelog\",\n        \"@semantic-release/git\",\n        [\"@semantic-release/gitlab\", {\n            \"assets\": [\n                {\"path\": \"README.md\", \"label\": \"CSS distribution\"}\n            ]\n        }]\n    ]\n}\n</code></pre> <p>assets \u5b57\u6bb5</p> Property Description Default <code>path</code> Required, unless <code>url</code> is set. A glob to identify the files to upload. - <code>url</code> Alternative to setting <code>path</code> this provides the ability to add links to releases, e.g. URLs to container images. Supports Lodash templating. - <code>label</code> Short description of the file displayed on the GitLab release. Ignored if <code>path</code> matches more than one file. Supports Lodash templating. File name extracted from the <code>path</code>. <code>type</code> Asset type displayed on the GitLab release. Can be <code>runbook</code>, <code>package</code>, <code>image</code> and <code>other</code> (see official documents on release assets). Supports Lodash templating. <code>other</code> <code>filepath</code> A filepath for creating a permalink pointing to the asset (requires GitLab 12.9+, see official documents on permanent links). Ignored if <code>path</code> matches more than one file. Supports Lodash templating. -"},{"location":"devops/cicd/release_changelog.html#semantic-releaseexec","title":"@semantic-release/exec","text":"<p>execute custom shell commands.</p> <pre><code>$ npm install @semantic-release/exec -g\n</code></pre> <p>\u914d\u7f6e\uff08<code>.releaserc</code>\uff09</p> <pre><code>{\n  \"plugins\": [\n    \"@semantic-release/commit-analyzer\",\n    \"@semantic-release/release-notes-generator\",\n    [\"@semantic-release/exec\", {\n      \"verifyConditionsCmd\": \"./verify.sh\",\n      \"publishCmd\": \"./publish.sh ${nextRelease.version} ${branch.name} ${commits.length} ${Date.now()}\"\n    }],\n  ]\n}\n</code></pre> <p>\u751f\u547d\u5468\u671f</p> Step Description <code>verifyConditions</code> Execute a shell command to verify if the release should happen. <code>analyzeCommits</code> Execute a shell command to determine the type of release. <code>verifyRelease</code> Execute a shell command to verifying a release that was determined before and is about to be published. <code>generateNotes</code> Execute a shell command to generate the release note. <code>prepare</code> Execute a shell command to prepare the release. <code>publish</code> Execute a shell command to publish the release. <code>success</code> Execute a shell command to notify of a new release. <code>fail</code> Execute a shell command to notify of a failed release."},{"location":"devops/cicd/release_changelog.html#googlesemantic-release-replace-plugin","title":"google/semantic-release-replace-plugin","text":"<p>update version strings throughout a project. </p> <p>\u4fee\u6539\u7279\u5b9a\u6587\u4ef6\u4e2d\u7684\u7248\u672c\u53f7\u4fe1\u606f\u3002</p> <pre><code>$ npm install @google/semantic-release-replace-plugin -D\n</code></pre> <p>\u914d\u7f6e</p> <pre><code>{\n  \"plugins\": [\n    \"@semantic-release/commit-analyzer\",\n    [\n      \"@google/semantic-release-replace-plugin\",\n      {\n        \"replacements\": [\n          {\n            \"files\": [\"foo/__init__.py\"],\n            \"from\": \"__VERSION__ = \\\".*\\\"\",\n            \"to\": \"__VERSION__ = \\\"${nextRelease.version}\\\"\",\n            \"results\": [\n              {\n                \"file\": \"foo/__init__.py\",\n                \"hasChanged\": true,\n                \"numMatches\": 1,\n                \"numReplacements\": 1\n              }\n            ],\n            \"countMatches\": true\n          }\n        ]\n      }\n    ],\n    [\n      \"@semantic-release/git\",\n      {\n        \"assets\": [\"foo/*.py\"]\n      }\n    ]\n  ]\n}\n</code></pre>"},{"location":"devops/cicd/release_changelog.html#_6","title":"\u7248\u672c\u53f7\u9700\u6c42\u7684\u4e0d\u540c\u9636\u6bb5","text":"<p>\u8bf4\u660e\uff1a</p> <ul> <li><code>semantic-release</code> \u662f\u6700\u540e\u8fdb\u884c\u6267\u884c\uff0c\u56e0\u4e3a\u4f1a\u9700\u8981\u5c06CHANGELOG\u7b49\u53d8\u66f4\u6587\u4ef6\u63a8\u56de git \u4ed3\u5e93\uff1b</li> <li>\u9879\u76ee\u6784\u5efa\u65f6\uff0c\u9700\u8981\u6839\u636e\u7248\u672c\u53f7\u51fa\u5236\u54c1\uff08\u5982zip\u5305\uff0cdocker image tag\u7b49\uff09\uff1b</li> <li><code>semantic-relase</code> \u6267\u884c\u955c\u50cf\u8ddf\u9879\u76ee\u7684\u6784\u5efa\u955c\u50cf\u4e0d\u4f1a\u662f\u4e00\u4e2a\u955c\u50cf\uff1b</li> <li>\u7248\u672c\u5236\u54c1\u4f1a\u533a\u5206\u5feb\u7167\uff08SNAPSHOT\uff09\u548c\u53d1\u5e03\uff08RELEASE\uff09\uff1b</li> </ul> <p>\u56e0\u6b64\uff1a</p> <ol> <li>\u901a\u8fc7<code>semantic-release</code> \u7684<code>dry</code>\u6a21\u5f0f\uff0c\u533a\u5206release/snapshot\uff0c\u5148\u751f\u6210\u7248\u672c\u53f7\uff1b</li> <li>\u6839\u636e\u7248\u672c\u53f7\u8fdb\u884c\u9879\u76ee\u6784\u5efa\uff0c\u51fa\u76f8\u5e94\u7248\u672c\u7684\u5236\u54c1\uff1b</li> <li><code>semantic-release</code> \u53d8\u66f4\u6587\u4ef6\u63a8\u56degit\u4ed3\u5e93\uff0c\u5e76\u521b\u5efa Git Tag\uff1b</li> </ol>"},{"location":"devops/cicd/release_changelog.html#gitlab-ci","title":"Gitlab CI \u4f7f\u7528","text":"<ul> <li>\u9879\u76ee\u5de5\u7a0b\u4e2d\u6dfb\u52a0<code>.releaserc</code>\u914d\u7f6e</li> <li>\u9ed8\u8ba4\u7684\u63d2\u4ef6\u987a\u5e8f\u662f<code>commit-analyzer, release-notes-generator, npm, github,</code></li> </ul> <pre><code>{\n  \"plugins\": [\n    \"@semantic-release/commit-analyzer\",\n    \"@semantic-release/release-notes-generator\",\n    \"@semantic-release/changelog\",\n    \"@semantic-release/git\"\n  ]\n}\n</code></pre> <ul> <li><code>.gitlab-ci.yml</code> \u914d\u7f6e\uff08gitlab-runner\u8fd0\u884c\u73af\u5883\u4e3apowershell)</li> </ul> <pre><code># lint \u8fc7\u7a0b\u7528\u4e8e\u68c0\u6d4b commitlint \u7ed3\u679c\n# release \u8fc7\u7a0b\u7528\u4e8e\u81ea\u52a8\u5316\u4ea7\u751f git tag \u548c CHANGELOG.md\n\n\nstages:\n  - lint\n  - build\n  - deploy\n  - release\n\ncommitlint:\n  stage: lint\n  # node:lts \u955c\u50cf\u5e76\u5305\u542b npm install -g @commitlint/cli @commitlint/config-conventional commitlint-format-junit\n  # @semantic-release @semantic-release/gitlab @semantic-release/git @semantic-release/changelog @semantic-release/exec\n  image: ${GIT_NODE_IMAGE}\n  script: |\n    if [ \"${CI_COMMIT_BEFORE_SHA}\" = \"0000000000000000000000000000000000000000\" ]; then\n      npx commitlint -x @commitlint/config-conventional -f HEAD^\n    else\n      npx commitlint -x @commitlint/config-conventional -f \"${CI_COMMIT_BEFORE_SHA}\"\n    fi\n\n    echo \"===${CI_COMMIT_REF_NAME}===${CI_COMMIT_BRANCH}\"\n\n    # --dry-run \u6a21\u5f0f\uff0c\u9884\u5148\u751f\u6210\u7248\u672c\u53f7\uff0c\u533a\u5206 release / snapshot\n    if [ \"${CI_COMMIT_REF_NAME}\" == \"master\" ]; then\n      npx semantic-release --dry-run --no-ci\n      echo \"VERSION_VAR=`cat VERSION`\" &gt; build.env\n      cat build.env\n    else\n      echo \"VERSION_VAR=SNAPSHOT-`cat VERSION`-`date \"+%Y%m%d-%H%M%S\"`\" &gt; build.env\n      cat build.env\n    fi\n  # \u901a\u8fc7\u73af\u5883\u53d8\u91cf\u4f20\u9012\u7248\u672c\u53f7\n  artifacts:\n    reports:\n      dotenv: build.env\n\nbuild:\n  stage: build\n  image: ${MKDOCS_IMAGE}\n  # \u6784\u5efa\u7248\u672c\u5236\u54c1\uff0c\u5e76\u4e0a\u4f20\u5236\u54c1\u5e93\n  script:\n    - mkdocs build\n    - ls -all ./\n    - tar -zcvf helpdoc-${VERSION_VAR}.tar.gz site \n    - curl -v --user 'admin:admin123' --upload-file helpdoc-${VERSION_VAR}.tar.gz http://172.16.1.217:8081/repository/static/helpdoc/helpdoc-${VERSION_VAR}.tar.gz\n  artifacts:\n    paths:\n      - helpdoc-*.tar.gz\n    expire_in: 1 hour\n\ndeploy:\n  stage: deploy\n  # \u901a\u8fc7 SSH \u90e8\u7f72\u5230\u673a\u5668\n  image: ${SSHPASS_IMAGE}\n  script:\n    - sshpass -p ${NODE_125_PASSWD} scp -o StrictHostKeyChecking=no helpdoc-${VERSION_VAR}.tar.gz root@${NODE_125_IP}:/tmp\n    - sshpass -p ${NODE_125_PASSWD} ssh -o StrictHostKeyChecking=no root@${NODE_125_IP} \"cd /tmp &amp;&amp; rm -rf site &amp;&amp; tar -zxvf helpdoc-${VERSION_VAR}.tar.gz &amp;&amp; rm -rf /home/experiment/web_ai_education/nginx/html/help/ &amp;&amp; mv site /home/experiment/web_ai_education/nginx/html/help/ &amp;&amp; cd /home/experiment/web_ai_education/nginx/ &amp;&amp; ./sbin/nginx -s reload\"\n\n\nrelease:\n  stage: release\n  image: ${GIT_NODE_IMAGE}\n  script:\n    # \u751f\u6210\u7248\u672c\u53f7\uff0c\u66f4\u65b0CHANGELOG\uff0c\u5e76\u63a8\u56de\u4ed3\u5e93\n    - npx semantic-release\n  only:\n    - master\n  dependencies: []\n</code></pre> <ul> <li>gitlab\u9879\u76ee\u73af\u5883\u53d8\u91cf\u914d\u7f6e\uff08GITLAB_TOKEN\u6216\u8005GL_TOKEN\uff09</li> </ul> <p>\u6548\u679c\u56fe\u793a\u4f8b\uff08master\u5206\u652f\u6784\u5efa\u6d41\u6c34\u7ebf\uff09\uff1a</p> <p></p>"},{"location":"devops/cicd/tekton.html","title":"Tekton","text":"<p>Tekton is a powerful and flexible open-source framework for creating CI/CD systems, allowing developers to build, test, and deploy across cloud providers and on-premise systems</p>"},{"location":"devops/codehub/gitlab.html","title":"Gitlab","text":""},{"location":"devops/codehub/gitlab.html#_1","title":"\u5b89\u88c5","text":""},{"location":"devops/codehub/gitlab.html#docker","title":"\u5b98\u65b9docker \u5b89\u88c5","text":"<p>\u5c06 gitlab, nginx, postgres, redis \u90fd\u8fd0\u884c\u5728\u4e00\u4e2a\u955c\u50cf\u4e2d</p> <ul> <li>\u62c9\u53d6gitlab-ce\u955c\u50cf <pre><code>docker pull gitlab/gitlab-ce\n</code></pre></li> <li>\u5c06 GitLab \u7684\u914d\u7f6e (etc) \u3001 \u65e5\u5fd7 (log) \u3001\u6570\u636e (data) \u653e\u5230\u5bb9\u5668\u4e4b\u5916\uff0c \u4fbf\u4e8e\u65e5\u540e\u5347\u7ea7\uff0c \u56e0\u6b64\u8bf7\u5148\u51c6\u5907\u8fd9\u4e09\u4e2a\u76ee\u5f55\u3002 <pre><code>mkdir -p /mnt/gitlab/etc\nmkdir -p /mnt/gitlab/log\nmkdir -p /mnt/gitlab/data\n</code></pre></li> <li>\u542f\u52a8\u955c\u50cf\uff0c\u9700\u8981\u5efa\u7acb\u7aef\u53e3\u6620\u5c04\uff0c8090\u548c22\u662f\u5bb9\u5668\u5185gitlab\u7684http\u548cssh\u7684\u7aef\u53e3 <pre><code>docker run \\\n    --detach \\\n    --publish 8090:8090 \\\n    --publish 222:22 \\\n    --name gitlab \\\n    --restart unless-stopped \\\n    -v /mnt/gitlab/etc:/etc/gitlab \\\n    -v /mnt/gitlab/log:/var/log/gitlab \\\n    -v /mnt/gitlab/data:/var/opt/gitlab \\\n    gitlab/gitlab-ce\n</code></pre></li> <li>\u914d\u7f6egitlab gitlab\u4e0a\u521b\u5efa\u9879\u76ee\u7684\u65f6\u5019\uff0c\u751f\u6210\u9879\u76ee\u7684URL\u8bbf\u95ee\u5730\u5740\u662f\u6309\u5bb9\u5668\u7684hostname\u6765\u751f\u6210\u7684\uff0c\u4e5f\u5c31\u662f\u5bb9\u5668\u7684id\u3002\u4f5c\u4e3agitlab\u670d\u52a1\u5668\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u56fa\u5b9a\u7684URL\u8bbf\u95ee\u5730\u5740\uff0c\u4e8e\u662f\u9700\u8981\u914d\u7f6egitlab.rb\uff08\u5bbf\u4e3b\u673a\u8def\u5f84\uff1a/mnt/gitlab/etc/gitlab.rb\uff09 <pre><code># gitlab.rb\u6587\u4ef6\u5185\u5bb9\u9ed8\u8ba4\u5168\u662f\u6ce8\u91ca\nvim /mnt/gitlab/etc/gitlab.rb\n</code></pre> <pre><code># \u914d\u7f6ehttp\u534f\u8bae\u6240\u4f7f\u7528\u7684\u8bbf\u95ee\u5730\u5740,\u4e0d\u52a0\u7aef\u53e3\u53f7\u9ed8\u8ba4\u4e3a80\nexternal_url 'https://192.168.199.231:8090'\n# \u914d\u7f6essh\u534f\u8bae\u6240\u4f7f\u7528\u7684\u8bbf\u95ee\u5730\u5740\u548c\u7aef\u53e3\ngitlab_rails['gitlab_ssh_host'] = '192.168.199.231'\ngitlab_rails['gitlab_shell_ssh_port'] = 222 # \u6b64\u7aef\u53e3\u662frun\u65f622\u7aef\u53e3\u6620\u5c04\u7684222\u7aef\u53e3\n\n#\u4fdd\u5b58\u914d\u7f6e\u6587\u4ef6\u5e76\u9000\u51fa\n:wq\n</code></pre></li> <li>\u91cd\u542fgitlab\u5bb9\u5668</li> </ul> <p><code>docker restart gitlab</code></p>"},{"location":"devops/codehub/gitlab.html#faq","title":"FAQ","text":""},{"location":"devops/codehub/gitlab.html#gitlab-502","title":"GitLab \u8bbf\u95ee\u8fd4\u56de 502","text":"<p>gitlab-ctl status \u67e5\u770b\u5bf9\u5e94\u7684\u670d\u52a1\uff0c\u662f\u5426\u6709\u4e0d\u505c\u91cd\u542f\u7684\u670d\u52a1\uff0c\u8fdb\u800c\u67e5\u770b\u670d\u52a1\u65e5\u5fd7\u3002</p> <p>unicorn\u4e00\u76f4\u91cd\u8bd5\uff0c</p> <ul> <li>\u7aef\u53e3\u95ee\u9898\uff0c\u6539unicorn\u7aef\u53e3\uff0c\u518d\u5bf9gitlab\u91cd\u542f\uff1b</li> <li>\u6ca1\u6709\u660e\u663e\u539f\u56e0\uff0c\u5219\u6392\u67e5\u8d44\u6e90\u95ee\u9898\uff08CPU\u548c\u5185\u5b58\uff09\uff1b</li> <li>\u5c1d\u8bd5 docker exec -it gitlab rm /opt/gitlab/var/unicorn/unicorn.pid &amp;&amp; docker restart gitlab</li> </ul> <p>https://forum.gitlab.com/t/error-502-failed-to-start-a-new-unicorn-master/29790</p>"},{"location":"devops/codehub/gitlab.html#docker_1","title":"\u4e09\u65b9docker\u5b89\u88c5","text":"<p>https://github.com/sameersbn/docker-gitlab</p> <p>\u62c6\u5206\u4e3a gitlab, postgres, redis \u4e09\u4e2a\u955c\u50cf\uff0c\u901a\u8fc7 docker compose \u542f\u52a8\uff1b</p>"},{"location":"devops/codehub/gitlab.html#_2","title":"\u64cd\u4f5c\u547d\u4ee4","text":"<p>docker\u5bb9\u5668\u5b89\u88c5gitlab\u65f6\uff0c\u9700\u8981\u5148\u8fdb\u5165\u5230\u5bb9\u5668\u4e2d</p> <p><code>docker exec -ti gitlab /bin/bash</code></p> <ul> <li>\u91cd\u65b0\u5e94\u7528gitlab\u7684\u914d\u7f6e    </li> </ul> <p><code>gitlab-ctl reconfigure</code></p> <ul> <li>\u91cd\u542fgitlab\u670d\u52a1    </li> </ul> <p><code>gitlab-ctl restart</code></p> <ul> <li>\u67e5\u770bgitlab\u8fd0\u884c\u72b6\u6001    </li> </ul> <p><code>gitlab-ctl status</code></p> <ul> <li>\u505c\u6b62gitlab\u670d\u52a1    </li> </ul> <p><code>gitlab-ctl stop</code></p> <ul> <li>\u67e5\u770bgitlab\u8fd0\u884c\u65e5\u5fd7    </li> </ul> <p><code>gitlab-ctl tail</code></p> <ul> <li>\u505c\u6b62\u76f8\u5173\u6570\u636e\u8fde\u63a5\u670d\u52a1   </li> </ul> <p><code>gitlab-ctl stop unicorn</code> </p> <p><code>gitlab-ctl stop sideki</code></p>"},{"location":"devops/log/adapter.html","title":"Adapter","text":"<p>[toc]</p>"},{"location":"devops/log/adapter.html#logging-adapter","title":"Logging Adapter","text":"<p>\u65e5\u5fd7\u9002\u914d\u5668\uff0c\u63d0\u4f9b\u62bd\u8c61\u7684\u63a5\u53e3\uff0c\u5e95\u5c42\u53ef\u4ee5\u5bf9\u63a5\u4e0d\u540c\u7684\u65e5\u5fd7\u5b9e\u73b0\uff0c\u505a\u5230\u63a5\u53e3\u548c\u5b9e\u73b0\u7684\u89e3\u8026\u3002</p>"},{"location":"devops/log/adapter.html#apache-common-logging","title":"Apache Common Logging","text":"<p>\u7f51\u5740\uff1ahttp://commons.apache.org/proper/commons-logging/\uff0c\u4e5f\u79f0\u4e3a JCL\uff08Jakarta Commons Logging\uff09\uff1b2014\u5e74\u6700\u65b0\uff08\u53ef\u4ee5\u5e9f\u5f03\uff09</p>"},{"location":"devops/log/adapter.html#_1","title":"\u4f7f\u7528","text":"<pre><code>&lt;dependency&gt;\n  &lt;groupId&gt;commons-logging&lt;/groupId&gt;\n  &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;\n  &lt;version&gt;1.2&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"devops/log/adapter.html#_2","title":"\u914d\u7f6e","text":"<p><code>commons-logging.properties</code></p> <pre><code>org.apache.commons.logging.Log=\n</code></pre> <ol> <li>\u5148\u627e\u914d\u7f6e\u6587\u4ef6\uff0c\u518d\u627e\u7cfb\u7edf\u5c5e\u6027\uff1b</li> <li>\u518d\u627elog4j\uff0c\u518d\u627eJDK log\uff1b</li> <li>\u90fd\u6ca1\u6709\uff0c\u4f7f\u7528SimpleLog\uff1b</li> </ol>"},{"location":"devops/log/adapter.html#_3","title":"\u652f\u6301\u7684\u5e95\u5c42\u65e5\u5fd7","text":"<ul> <li>\u5c01\u88c5 log4j \u548c JDK Logger\uff0c\u65e0\u9700\u5173\u6ce8\u4f7f\u7528\u54ea\u4e2a\u65e5\u5fd7\uff0c\u4e0d\u914d\u7f6e\u5219\u4f18\u5148\u5bfb\u627e log4j \uff1b</li> <li>common-logging\u901a\u8fc7\u52a8\u6001\u67e5\u627e\u7684\u673a\u5236\uff0c\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u81ea\u52a8\u627e\u51fa\u771f\u6b63\u4f7f\u7528\u7684\u65e5\u5fd7\u5e93\u3002</li> <li>\u4f7f\u7528\u4e86ClassLoader\u5bfb\u627e\u548c\u8f7d\u5165\u5e95\u5c42\u7684\u65e5\u5fd7\u5e93\uff0c \u5bfc\u81f4\u4e86\u50cfOSGI\u8fd9\u6837\u7684\u6846\u67b6\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c\uff0c\u56e0\u4e3aOSGI\u7684\u4e0d\u540c\u7684\u63d2\u4ef6\u4f7f\u7528\u81ea\u5df1\u7684ClassLoader\u3002 OSGI\u7684\u8fd9\u79cd\u673a\u5236\u4fdd\u8bc1\u4e86\u63d2\u4ef6\u4e92\u76f8\u72ec\u7acb\uff0c\u7136\u800c\u5374\u4f7fApache Common-Logging\u65e0\u6cd5\u5de5\u4f5c\u3002</li> </ul>"},{"location":"devops/log/adapter.html#slf4j","title":"Slf4j","text":""},{"location":"devops/log/adapter.html#_4","title":"\u67b6\u6784","text":""},{"location":"devops/log/adapter.html#_5","title":"\u652f\u6301\u7684\u5e95\u5c42\u65e5\u5fd7","text":"<p>slf4j\uff08Simple Logging Facade for Java\uff09\u662f\u65e5\u5fd7\u6846\u67b6\u7684\u62bd\u8c61\uff0cjava.util.logging\uff0clog4j \u548c logback \u662f\u5177\u4f53\u5b9e\u73b0\u3002</p> <ul> <li>logback\u662f\u76f4\u63a5\u5b9e\u73b0<code>org.sl4j.Logger</code>\u63a5\u53e3\uff0c\u6ca1\u6709\u5185\u5b58\u548c\u8ba1\u7b97\u7684\u989d\u5916\u5f00\u9500\uff1b</li> <li>slf4j \u5728\u7f16\u8bd1\u65f6\u9759\u6001\u7ed1\u5b9a\u771f\u6b63\u7684Log\u5e93\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728OSGI\u4e2d\u4f7f\u7528\u3002</li> <li>slf4j \u652f\u6301\u53c2\u6570\u5316\u7684log\u5b57\u7b26\u4e32</li> </ul> <p></p>"},{"location":"devops/log/adapter.html#_6","title":"\u4f7f\u7528","text":"<p>slf4j api \u8c03\u7528 log4j \u65f6\u9700\u8981\u9002\u914d\u5c42\uff1a</p> <ul> <li>log4j 1.x\uff1aslf4j-log4j12</li> <li>log4j 2.x :  log4j-slf4j-imp</li> <li>log4j-slf4j-impl should be used with SLF4J 1.7.x releases or older.</li> <li>log4j-slf4j18-impl should be used with SLF4J 1.8.x releases or newer.</li> </ul>"},{"location":"devops/log/apache_logging.html","title":"Apache Logging","text":""},{"location":"devops/log/apache_logging.html#log4j2","title":"Log4j2","text":""},{"location":"devops/log/apache_logging.html#_1","title":"\u7279\u6027","text":"<ul> <li>log4j2 \u91cd\u5199 1.x \u7248\u672c\uff0c\u5305\u542blog4j-core\u548clog4j-api\uff1b</li> <li>\u91c7\u7528 LMAX \u7684\u65e0\u9501\u961f\u5217 Disruptor\uff08\u5e76\u53d1\u7ebf\u7a0b\u4e2d\u4ea4\u6362\u6570\u636e\uff0c\u6709\u754c\u961f\u5217\uff09\uff1b</li> <li>\u9ed8\u8ba4\u5728classpath\u4e0b\u52a0\u8f7dlog4j2.properties, log4j2.xml, log4j2.json\u7b49\u6587\u4ef6\uff1b</li> <li>Garbage-free</li> <li>garbage-free in stand-alone applications, and low garbage in web applications\uff1b</li> </ul>"},{"location":"devops/log/apache_logging.html#_2","title":"\u4f7f\u7528","text":"<pre><code>&lt;dependencies&gt;\n  &lt;dependency&gt;\n    &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;\n    &lt;artifactId&gt;log4j-api&lt;/artifactId&gt;\n    &lt;version&gt;2.13.0&lt;/version&gt;\n  &lt;/dependency&gt;\n  &lt;dependency&gt;\n    &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;\n    &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;\n    &lt;version&gt;2.13.0&lt;/version&gt;\n  &lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> <p>Log4j2 API \u652f\u6301 Log4j 1.2, SLF4J, Commons Logging \u548c java.util.logging (JUL) APIs\u3002</p> <p>Spring</p> <ul> <li>\u548cSpring\u8fdb\u884c\u5355\u5143\u6d4b\u8bd5\u7684\u65f6\u5019\uff0cJunit\u52a0\u8f7dspring\u7684runner\uff08SpringJUnit4ClassRunner\uff09\u8981\u4f18\u5148\u4e8espring\u52a0\u8f7dlog4j\uff0c\u9700\u8981\u628alog4j.properties\u653e\u5728resource\u76ee\u5f55\u4e0b\uff0c\u624d\u4f1a\u9ed8\u8ba4\u52a0\u8f7d\uff1b</li> <li>\u8fd0\u884c\u65f6\uff0cweb.xml\u914d\u7f6elog4j\u914d\u7f6e\u6587\u4ef6\u76ee\u5f55log4jConfigLocation\u548clog4j\u76d1\u542c\u5668</li> </ul> <pre><code>&lt;listener-class&gt;org.springframework.web.util.Log4jConfigListener&lt;/listener-class&gt;\n</code></pre>"},{"location":"devops/log/apache_logging.html#_3","title":"\u914d\u7f6e","text":"<p><code>log4j.properties</code></p>"},{"location":"devops/log/apache_logging.html#rootlogger","title":"RootLogger","text":"<pre><code># \u6839Logger\uff0c\u8d1f\u8d23\u5904\u7406\u65e5\u5fd7\u8bb0\u5f55\u7684\u5927\u90e8\u5206\u65e5\u5fd7\n# level\u662f\u65e5\u5fd7\u7ea7\u522b\uff0cappenderName\u662f\u65e5\u5fd7\u8f93\u51fa\u76ee\u7684\u5730\nlog4j.rootLogger = [level], [appendName1], [appendName2]\n# \u5b50\u5305org.exam\u7684\u8f93\u51fa\u4fe1\u606f\uff0c\u548crootLogger\u6ca1\u6709\u5173\u7cfb\nlog4j.logger.org.exam=DEBUG\n# \u8bbe\u7f6e\u5b50logger\u53ea\u5728\u81ea\u5df1\u7684appender\u91cc\u8f93\u51fa\uff0c\u9ed8\u8ba4\u4e3afalse\nlog4j.additivity.org.exam=false\n</code></pre>"},{"location":"devops/log/apache_logging.html#appender","title":"Appender","text":"<pre><code># \u65e5\u5fd7\u4fe1\u606f\u8f93\u51fa\u76ee\u7684\u5730Appender\nlog4j.appender.[appenderName] = [fully.qualified.name.of.appender.class]\n</code></pre>"},{"location":"devops/log/apache_logging.html#orgapachelog4jconsoleappender","title":"org.apache.log4j.ConsoleAppender","text":"<pre><code># \u53ef\u4ee5\u4fee\u6539\u8f93\u51fa\u65e5\u5fd7\u7684\u7ea7\u522b\nlog4j.appender.Console.Threshold = WARN   \n# \u9ed8\u8ba4\u503c\u662ftrue,\u610f\u8c13\u7740\u6240\u6709\u7684\u6d88\u606f\u90fd\u4f1a\u88ab\u7acb\u5373\u8f93\u51fa\u3002 \nlog4j.appender.Console.ImmediateFlush=true \n# \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\uff1aSystem.out,\u6307\u5b9a\u8f93\u51fa\u63a7\u5236\u53f0 \nlog4j.appender.Console.Target=System.err\n</code></pre>"},{"location":"devops/log/apache_logging.html#orgapachelog4jrollingfileappender","title":"org.apache.log4j.RollingFileAppender","text":"<pre><code># MaxFileSize\u53c2\u6570\u6307\u5b9a\u6587\u4ef6\u9608\u503c\uff0cMaxBackupIndex\u8868\u793a\u6700\u591a\u5b58\u50a8\u7684\u65e5\u5fd7\u6587\u4ef6\u6570\nlog4j.appender.RollingFile.File = /tmp/log\nlog4j.appender.RollingFile.MaxFileSize=100MB\nlog4j.appender.RollingFile.MaxBackupIndex=10\n</code></pre>"},{"location":"devops/log/apache_logging.html#layout","title":"Layout","text":""},{"location":"devops/log/apache_logging.html#orgapachelog4j-patternlayout","title":"org.apache.log4j. PatternLayout","text":""},{"location":"devops/log/apache_logging.html#_4","title":"\u7075\u6d3b\u6307\u5b9a\u5e03\u5c40","text":"<pre><code>log4j.appender.[appenderName].layout = [fully.qualified.name.of.layout.class ]\nlog4j.appender.[appenderName].layout.ConversionPattern = %d{yyyy-MM-dd HH:mm:ss}  [ %C.%M:%l ] - [ %p ]  %m%n\n# \u53c2\u6570\u8be6\u7ec6\u89e3\u91ca\u5982\u4e0b\n%p: \u8f93\u51fa\u65e5\u5fd7\u4fe1\u606f\u4f18\u5148\u7ea7\uff0c\u5373DEBUG\uff0cINFO\uff0cWARN\uff0cERROR\uff0cFATAL, \n\n%d: \u8f93\u51fa\u65e5\u5fd7\u65f6\u95f4\u70b9\u7684\u65e5\u671f\u6216\u65f6\u95f4\uff0c\u9ed8\u8ba4\u683c\u5f0f\u4e3aISO8601\uff0c\u6216\u6307\u5b9a\u683c\u5f0f\u5982 %d{yyy MMM dd HH:mm:ss,SSS}\uff0c\u8f93\u51fa\u7c7b\u4f3c\uff1a2002\u5e7410\u670818\u65e5 22:10:28,921 \n\n%r: \u8f93\u51fa\u81ea\u5e94\u7528\u542f\u52a8\u5230\u8f93\u51fa\u8be5log\u4fe1\u606f\u8017\u8d39\u7684\u6beb\u79d2\u6570 \n\n%c: \u8f93\u51fa\u65e5\u5fd7\u4fe1\u606f\u6240\u5c5e\u7684\u7c7b\u76ee\uff0c\u901a\u5e38\u5c31\u662f\u6240\u5728\u7c7b\u7684\u5168\u540d \uff08\u901a\u8fc7ClassName.class\u4f20\u7ed9Logger\u8bc6\u522b\uff09\n\n%C: \u5217\u51fa\u8c03\u7528logger\u7684\u7c7b\u7684\u5168\u540d\uff08\u5305\u542b\u5305\u8def\u5f84\uff09\n\n%x: \u6309NDC\uff08Nested Diagnostic Context\uff0c\u7ebf\u7a0b\u5806\u6808\uff09\u987a\u5e8f\u8f93\u51fa\u65e5\u5fd7\n\n%X: \u6309MDC\uff08Mapped Diagnostic Context\uff0c\u7ebf\u7a0b\u6620\u5c04\u8868\uff09\u8f93\u51fa\u65e5\u5fd7\u3002\u901a\u5e38\u7528\u4e8e\u591a\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u540c\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u65b9\u4fbf\u670d\u52a1\u5668\u533a\u5206\u662f\u90a3\u4e2a\u5ba2\u6237\u7aef\u8bbf\u95ee\u7559\u4e0b\u6765\u7684\u65e5\u5fd7\u3002\n\n%t: \u8f93\u51fa\u4ea7\u751f\u8be5\u65e5\u5fd7\u4e8b\u4ef6\u7684\u7ebf\u7a0b\u540d \n\n%l: \u8f93\u51fa\u65e5\u5fd7\u4e8b\u4ef6\u7684\u53d1\u751f\u4f4d\u7f6e\uff0c\u76f8\u5f53\u4e8e%C.%M(%F:%L)\u7684\u7ec4\u5408,\u5305\u62ec\u7c7b\u540d\u3001\u65b9\u6cd5\u540d\u4ee5\u53ca\u5728\u4ee3\u7801\u4e2d\u7684\u884c\u6570\u3002\u4e3e\u4f8b\uff1aTestlog4.main(TestLog4.java:10) \n\n%%: \u8f93\u51fa\u4e00\u4e2a\"%\"\u5b57\u7b26 \n\n%F: \u8f93\u51fa\u65e5\u5fd7\u6d88\u606f\u4ea7\u751f\u65f6\u6240\u5728\u7684\u6587\u4ef6\u540d\u79f0 \n\n%L: \u8f93\u51fa\u4ee3\u7801\u4e2d\u7684\u884c\u53f7 \n\n%M: \u8f93\u51fa\u65e5\u5fd7\u6240\u5728\u7684\u51fd\u6570\u540d\n\n%m: \u8f93\u51fa\u4ee3\u7801\u4e2d\u6307\u5b9a\u7684\u6d88\u606f,\u4ea7\u751f\u7684\u65e5\u5fd7\u5177\u4f53\u4fe1\u606f \n\n%n: \u8f93\u51fa\u4e00\u4e2a\u56de\u8f66\u6362\u884c\u7b26\uff0cWindows\u5e73\u53f0\u4e3a\"\\r\\n\"\uff0cUnix\u5e73\u53f0\u4e3a\"\\n\"\u8f93\u51fa\u65e5\u5fd7\u4fe1\u606f\u6362\u884c \n</code></pre>"},{"location":"devops/log/apache_logging.html#log4cxx","title":"log4cxx","text":""},{"location":"devops/log/apache_logging.html#log4j-audit","title":"Log4j Audit","text":""},{"location":"devops/log/apache_logging.html#log4j-scala","title":"Log4j Scala","text":""},{"location":"devops/log/logback.html","title":"LogBack","text":"<p>logback-core, logback-classic</p> <p>logback-access\uff1a\u548c tomcat \u6216 jetty \u96c6\u6210\uff0c\u63d0\u4f9b HTTP access \u65e5\u5fd7\u3002</p>"},{"location":"distributed_computing/google_dataflow.html","title":"Google DataFlow","text":"<p>The dataflow model: a practical approach to balancing correctness, latency, and cost in massive-scale, unbounded, out-of-order data processing.  2015 VLDB.</p> <p>Flink \u548c Spark Structired Streaming \u90fd\u662f\u53c2\u8003 Google Dataflow \u5b9e\u73b0\u3002</p>"},{"location":"distributed_computing/google_dataflow.html#1-overview","title":"1. Overview","text":"<p>Google Dataflow \u6a21\u578b\u65e8\u5728\u63d0\u4f9b\u4e00\u79cd\u7edf\u4e00\u6279\u5904\u7406\u548c\u6d41\u5904\u7406\u7684\u7cfb\u7edf\u3002</p> <p>Dataflow \u6a21\u578b\u7684\u6838\u5fc3\u70b9\u5728\u4e8e\uff1a</p> <ul> <li>\u5bf9\u4e8e\u65e0\u5e8f\u7684\u6d41\u5f0f\u6570\u636e\u63d0\u4f9b\u57fa\u4e8e event-time \u7684\u987a\u5e8f\u5904\u7406\u3001\u57fa\u4e8e\u6570\u636e\u672c\u8eab\u7684\u7279\u5f81\u8fdb\u884c\u7a97\u53e3\u805a\u5408\u5904\u7406\u7684\u80fd\u529b\uff0c\u4ee5\u53ca\u5e73\u8861\u6b63\u786e\u6027\u3001\u5ef6\u8fdf\u3001\u6210\u672c\u4e4b\u95f4\u7684\u76f8\u4e92\u5173\u7cfb\u3002</li> </ul> <p>\u89e3\u6784\u6570\u636e\u5904\u7406\u7684\u56db\u4e2a\u7ef4\u5ea6\uff0c\u65b9\u4fbf\u6211\u4eec\u66f4\u597d\u7684\u5206\u6790\u95ee\u9898\uff1a</p> <ul> <li> <ul> <li>What results are being computed.</li> </ul> </li> <li>Where in event time they are been computed.</li> <li>When in processing time they are materialized.</li> <li>How earlier results relate to later refinements.</li> </ul> <p>\u5c06\u6570\u636e\u5904\u7406\u4e2d\u7684\u903b\u8f91\u6982\u5ff5\u548c\u5e95\u5c42\u7269\u7406\u5b9e\u73b0\u89e3\u8026</p> <ul> <li>Windowing Model\uff0c\u652f\u6301\u975e\u5bf9\u9f50\u7684 event time \u7684\u7a97\u53e3\u805a\u5408</li> <li>Triggering Model\uff0c\u63d0\u4f9b\u5f3a\u5927\u548c\u7075\u6d3b\u7684\u58f0\u660e\u5f0f API \u6765\u63cf\u8ff0 Trigger \u8bed\u4e49\uff0c\u53ef\u4ee5\u6839\u636e\u4e8b\u4ef6\u5904\u7406\u7684\u8fd0\u884c\u65f6\u7279\u5f81\u6765\u51b3\u5b9a\u8f93\u51fa\u6b21\u6570\u3002</li> <li>Incremental Processing Model\uff0c\u5c06\u6570\u636e\u7684\u66f4\u65b0\u6574\u5408\u5230\u4e0a\u9762\u7684 Window \u6a21\u578b\u548c Trigger \u6a21\u578b\u4e2d\u3002</li> <li>Scalable implementation\uff0c\u57fa\u4e8e MillWheel \u6d41\u5f0f\u5f15\u64ce\u548c Flume \u6279\u5904\u7406\u5f15\u64ce\u5b9e\u73b0\u7684 Google Dataflow SDK\uff0c\u7528\u6237\u65e0\u9700\u611f\u77e5\u5e95\u5c42\u7cfb\u7edf\u3002</li> <li>Core Principle\uff0c\u6a21\u578b\u8bbe\u8ba1\u7684\u6838\u5fc3\u539f\u5219\u3002</li> </ul>"},{"location":"distributed_computing/google_dataflow.html#2","title":"2. \u6838\u5fc3\u6982\u5ff5","text":"<p>Dataflow \u6a21\u578b\u4e00\u822c\u5c06\u6709\u9650/\u65e0\u9650\u6570\u636e\u96c6\u5408\u79f0\u4e3a Bounded/Unbounded Dataset\uff0c\u800c Streaming/Batch \u7528\u6765\u7279\u6307\u6267\u884c\u5f15\u64ce\u3002</p>"},{"location":"distributed_computing/google_dataflow.html#21-window","title":"2.1 Window","text":"<p>\u5728\u5904\u7406\u65e0\u9650\u6570\u636e\u96c6\u7684\u65f6\u5019\u6709\u9650\u64cd\u4f5c\u9700\u8981\u7a97\u53e3\uff0c\u6bd4\u5982 aggregation\uff0couter join\uff0ctime-bounded \u64cd\u4f5c\u3002</p> <ul> <li>\u7a97\u53e3\u5927\u90e8\u5206\u90fd\u662f\u57fa\u4e8e\u65f6\u95f4\u6765\u5212\u5206\uff0c\u4f46\u662f\u4e5f\u6709\u57fa\u4e8e\u5176\u4ed6\u5b58\u5728\u903b\u8f91\u4e0a\u6709\u5e8f\u5173\u7cfb\u7684\u6570\u636e\u6765\u5212\u5206\u3002</li> </ul> <p>\u7a97\u53e3\u6a21\u578b\u4e3b\u8981\u6709\u4e09\u79cd\uff1aFixed Window\uff0cSliding Window\uff0cSession Window\u3002</p> <p></p>"},{"location":"distributed_computing/google_dataflow.html#211-fixed-window","title":"2.1.1 Fixed Window","text":"<p>Fixed Window\uff08Tumbling Window\uff09\uff1a\u7279\u5b9a\u7684\u65f6\u95f4\u957f\u5ea6\u5728\u65e0\u9650\u6570\u636e\u96c6\u5408\u4e0a\u7ffb\u6eda\u5f62\u6210\uff1b</p> <ul> <li>\u6bcf\u4e2a Window \u6ca1\u6709\u91cd\u53e0\uff0c\u4f8b\u5982\u5c0f\u65f6\u7a97\u53e3\u5c31\u662f 12:00:00 ~ 13:00:00 \u4e00\u4e2a\u7a97\u53e3\uff0c13:00:00 ~ 14:00:00 \u4e00\u4e2a\u7a97\u53e3\uff1b</li> </ul>"},{"location":"distributed_computing/google_dataflow.html#212-sliding-window","title":"2.1.2 Sliding Window","text":"<p>\u6ed1\u52a8\u7a97\u53e3\uff1a\u7531\u4e24\u4e2a\u53c2\u6570\u786e\u5b9a\uff0c\u7a97\u53e3\u5927\u5c0f\u548c\u6ed1\u52a8\u95f4\u9694\u3002</p> <ul> <li>\u793a\u4f8b\uff1a\u6bcf\u5206\u949f\u5f00\u59cb\u4e00\u4e2a\u5c0f\u65f6\u7a97\u53e3\u5bf9\u5e94\u7684\u5c31\u662f\u7a97\u53e3\u5927\u5c0f\u4e3a\u4e00\u5c0f\u65f6\uff0c\u6ed1\u52a8\u95f4\u9694\u4e3a\u4e00\u5206\u949f\uff1b</li> <li>\u6ed1\u52a8\u95f4\u9694\u4e00\u822c\u5c0f\u4e8e\u7a97\u53e3\u5927\u5c0f\uff0c\u4e5f\u5c31\u662f\u8bf4\u7a97\u53e3\u4e4b\u95f4\u4f1a\u6709\u91cd\u53e0\uff1b</li> </ul>"},{"location":"distributed_computing/google_dataflow.html#213-session-window","title":"2.1.3 Session Window","text":"<p>\u4f1a\u8bdd\u7a97\u53e3\uff0c \u4e00\u822c\u7528\u6765\u6355\u6349\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u884c\u4e3a\uff1b</p> <ul> <li>\u6bd4\u5982 Web \u4e2d\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u767b\u5f55\u884c\u4e3a\u4e3a\u4e00\u4e2a Session\uff0c\u5f53\u957f\u65f6\u95f4\u6ca1\u6709\u767b\u5f55\uff0c\u5219 Session \u5931\u6548\uff0c\u518d\u6b21\u767b\u5f55\u91cd\u542f\u4e00\u4e2a Session\uff1b</li> <li>\u7528\u8d85\u65f6\u65f6\u95f4\u6765\u8861\u91cf\uff0c\u53ea\u8981\u5728\u8d85\u65f6\u65f6\u95f4\u5185\u53d1\u751f\u7684\u4e8b\u4ef6\u90fd\u8ba4\u4e3a\u662f\u4e00\u4e2a Session Window\uff1b</li> </ul>"},{"location":"distributed_computing/google_dataflow.html#22-time-domain","title":"2.2 Time Domain","text":"<ul> <li>Event Time\uff0c\u4e8b\u4ef6\u53d1\u751f\u7684\u65f6\u95f4\u3002</li> <li>Processing TIme\uff0c\u4e8b\u4ef6\u5728\u7cfb\u7edf\u4e2d\u7684\u5904\u7406\u65f6\u95f4</li> </ul> <p>\u5728\u73b0\u5b9e\u4e2d\uff0c\u7531\u4e8e\u901a\u4fe1\u5ef6\u8fdf\u3001\u8c03\u5ea6\u5ef6\u8fdf\u7b49\uff0c\u5f80\u5f80\u5bfc\u81f4 Event Time \u548c Processing Time \u4e4b\u95f4\u5b58\u5728\u5dee\u503c\uff08skew\uff09\uff0c\u4e14\u52a8\u6001\u53d8\u5316\u3002skew \u4e00\u822c\u4f7f\u7528 watermark \u6765\u8fdb\u884c\u53ef\u89c6\u5316\uff0c\u5982\u4e0b\u56fe\u3002</p> <p></p>"},{"location":"distributed_computing/google_dataflow.html#3-dataflow-model","title":"3. Dataflow Model","text":""},{"location":"distributed_computing/google_dataflow.html#31-core-primitives","title":"3.1 Core Primitives","text":"<p>Dataflow \u9488\u5bf9 (key, value) \u6570\u636e\u5bf9\u63d0\u4f9b\u4e86\u4e24\u79cd\u57fa\u672c\u7684\u64cd\u4f5c\u539f\u8bed\uff1aParDo \u548c GroupByKey\u3002</p> <ul> <li>ParDo\uff0c(key, value) \u4e0a\u7684 transformation \u64cd\u4f5c\uff0c\u7c7b\u4f3c Spark RDD \u4e2d\u7684 map \uff08\u4e00\u4e2a kv \u4ea7\u751f\u4e00\u4e2a kv\uff09\u548c flatMap \u7b97\u5b50\uff08\u4e00\u4e2a kv \u4ea7\u751f\u4e0d\u5b9a\u4e2a\u6570\u7684 kv\uff09\u3002\u5f62\u5f0f\u5316\u5b9a\u4e49\u5982\u4e0b</li> </ul> <p></p> <ul> <li>GroupByKey \u7c7b\u4f3c Spark \u4e2d\u7684\u805a\u5408\u7b97\u5b50\uff0c\u5f62\u5f0f\u5316\u5b9a\u4e49\u5982\u4e0b\u3002\u4e0e ParDo \u4e0d\u540c\uff08ParDo \u53ef\u4ee5\u5929\u7136\u7684\u5e94\u7528\u5230\u65e0\u9650\u6570\u636e\u6d41\uff09\uff0c GroupByKey \u8fd9\u79cd\u805a\u5408\u64cd\u4f5c\u9700\u8981\u7ed3\u5408\u7a97\u53e3\u4e00\u8d77\u4f7f\u7528\u3002</li> </ul> <p></p>"},{"location":"distributed_computing/google_dataflow.html#32-window","title":"3.2 Window","text":"<p>\u652f\u6301 GroupByKey \u805a\u5408\u7684\u7cfb\u7edf\u4e00\u822c\u662f\u5728\u5e95\u5c42\u5c06\u5176\u5b9e\u73b0\u4e3a GroupByKeyAndWindow\u3002</p> <p>Dataflow \u5728\u8fd9\u4e0a\u9762\u7684\u6539\u8fdb\u4e3b\u8981\u5728\u4e8e\u652f\u6301\u975e\u5bf9\u9f50\u7684\u7a97\u53e3\uff1a</p> <ul> <li>\u5c06\u6240\u6709\u7684\u7a97\u53e3\u5f53\u6210\u975e\u5bf9\u9f50\u7a97\u53e3\u6765\u5904\u7406\uff1b</li> <li>\u6240\u6709\u7684\u7a97\u53e3\u64cd\u4f5c\u53ef\u4ee5\u5206\u89e3\u6210\u4e0b\u9762\u4e24\u6b65\uff1a\u5206\u914d\u548c\u5408\u5e76</li> <li>Set AssignWindows(T datum) \u5c06\u6570\u636e\u5206\u914d\u5230 0 \u4e2a\u6216\u591a\u4e2a\u7a97\u53e3\u4e2d\u3002</li> <li>Set MergeWindows(Set windows) \u7a97\u53e3\u5408\u5e76\u64cd\u4f5c\uff0c\u8fd9\u4e2a\u662f\u6d41\u6570\u636e\u5904\u7406\u4e2d\u975e\u5e38\u6709\u7528\u3002</li> </ul> <p>\u4e3a\u4e86\u652f\u6301\u57fa\u4e8e event time \u7684\u7a97\u53e3\u805a\u5408\u64cd\u4f5c\uff0c\u6570\u636e\u7684\u8868\u793a\u4e0d\u518d\u4f7f\u7528 (key, value) \u6570\u636e\u5bf9\uff0c\u800c\u662f\u7528 (key, value, event_time, window) \u56db\u5143\u7ec4\u6765\u8868\u793a\u3002\u5728\u6570\u636e\u8fdb\u5165\u7cfb\u7edf\u4e2d\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u4f1a\u9ed8\u8ba4\u7ed9\u6570\u636e\u5206\u914d\u4e00\u4e2a\u5168\u5c40\u7684 window\u3002</p>"},{"location":"distributed_computing/google_dataflow.html#321-window-assignment","title":"3.2.1 Window Assignment","text":"<p>\u4ece\u6a21\u578b\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u7a97\u53e3\u5206\u914d\u662f\u5c06\u6570\u636e\u62f7\u8d1d\u5230\u5bf9\u5e94\u7684\u7a97\u53e3\u3002\u4e0b\u56fe\u662f\u4e00\u4e2a\u7a97\u53e3\u5927\u5c0f\u4e3a 2 \u5206\u949f\uff0c\u6ed1\u52a8\u95f4\u9694\u4e3a 1 \u5206\u949f\u7684\u6ed1\u52a8\u7a97\u53e3\u793a\u4f8b\u3002</p> <ul> <li>\u5c06\u6bcf\u4e2a data \u5206\u914d\u5230\u5bf9\u5e94\u7684\u7a97\u53e3\u4e2d\uff1b</li> </ul> <p></p>"},{"location":"distributed_computing/google_dataflow.html#323-window-merge","title":"3.2.3 Window Merge","text":"<p>\u7a97\u53e3\u5408\u5e76\u7528\u5728 GroupByKeyAndWindow \u64cd\u4f5c\u4e2d\uff0c\u4e0b\u9762\u7528\u4e00\u4e2a\u8d85\u65f6\u65f6\u95f4\u4e3a 30 \u5206\u949f\u7684\u4f1a\u8bdd\u7a97\u53e3\u7684\u4f8b\u5b50\u6765\u8bf4\u660e\uff0c\u5982\u4e0b\u56fe\u3002</p> <ul> <li>\u6240\u6709\u6570\u636e\u7684\u7a97\u53e3\u90fd\u88ab\u521d\u59cb\u5316\u4e3a 0 \u5230\u65e0\u7a77\u5927\u3002\u7136\u540e\u6240\u6709\u6570\u636e\u90fd\u88ab\u5206\u914d\u5230\u4e00\u4e2a\u7531\u81ea\u5df1\u7684\u65f6\u95f4\u6233 <code>timestamp</code> \u548c <code>timestamp + 30min</code> \u7684\u7a97\u53e3\u4e2d\u3002</li> </ul> <p></p>"},{"location":"distributed_computing/google_dataflow.html#33-triggers-incremental-processing","title":"3.3 Triggers &amp; Incremental Processing","text":"<p>DataFlow \u662f\u6784\u5efa\u57fa\u4e8e event time \u7684\u975e\u5bf9\u9f50\u7a97\u53e3\uff0c\u6709\u4e24\u4e2a\u95ee\u9898\u9700\u8981\u89e3\u51b3\uff1a</p> <ul> <li>\u548c\u5176\u4ed6\u6d41\u5f0f\u7cfb\u7edf\u7684\u8bed\u4e49\u4fdd\u6301\u517c\u5bb9\uff0c\u9700\u8981\u63d0\u4f9b\u57fa\u4e8e processing time \u548c\u57fa\u4e8e tuple \u7684\u7a97\u53e3</li> <li>\u5c06 processing time \u5f53\u6210 event time \u5904\u7406</li> <li>\u7a97\u53e3\u6570\u636e\u7684\u5b8c\u6574\u6027\uff1a\u7531\u4e8e event time \u662f\u65e0\u5e8f\uff0c\u6570\u636e\u53ef\u80fd\u665a\u5230\uff0c\u8981\u7b49\u5f85\u591a\u4e45\u5462\uff1f</li> <li>\u4f7f\u7528\u4e00\u79cd\u5168\u5c40\u7684 event time \u8fdb\u5ea6\u6307\u6807\uff0c\u6bd4\u5982 watermark \u6765\u5904\u7406\uff1b</li> <li>\u5982\u4f55\u8bbe\u7f6e watermark \u662f\u4e2a\u5f88\u96be\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u7531\u4e8e\u591a\u79cd\u539f\u56e0\uff0c\u6570\u636e\u5230\u8fbe\u53ef\u5feb\u53ef\u6162\u3002</li> </ul> <p>\u4f20\u7edf\u7684\u6570\u636e\u5904\u7406\u6a21\u5f0f\uff0c\u4f7f\u7528 Lambda \u67b6\u6784\u6765\u89e3\u51b3\uff1a</p> <ul> <li>\u5148\u7528\u6d41\u5f0f\u7cfb\u7edf\u4fdd\u8bc1\u65f6\u6548\u6027\u548c\u8fd1\u4f3c\u7684\u51c6\u786e\u6027\uff0c\u7136\u540e\u518d\u4f7f\u7528\u6279\u5904\u7406\u7cfb\u7edf\u5f02\u6b65\u6267\u884c\u6765\u4fdd\u8bc1\u6570\u636e\u7684\u5b8c\u6574\u6027\u3002</li> </ul> <p>Dataflow \u5bf9\u4e8e\u8fd9\u4e2a\u95ee\u9898\u7684\u5904\u7406\u4f7f\u7528\u4e00\u79cd\u53eb\u505a \"Trigger\" \u7684\u673a\u5236</p> <ul> <li>\u901a\u8fc7 Trigger \u63a7\u5236\u7a97\u53e3\u6570\u636e\u8f93\u51fa\u7ed3\u6784\uff0c\u800c\u5bf9\u4e8e\u5c1a\u672a\u5230\u8fbe\u7684\u4e8b\u4ef6\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u5904\u7406\u7b56\u7565</li> <li>Discarding\uff1a\u7a97\u53e3\u6570\u636e Trigger \u4e4b\u540e\u76f4\u63a5\u4e22\u5f03</li> <li>Accumulating\uff1aTrigger \u4e4b\u540e\uff0c\u7a97\u53e3\u7684\u7ed3\u679c\u6570\u636e\u88ab\u4fdd\u5b58\u4e0b\u6765\u4ee5\u652f\u6301\u540e\u9762\u7684\u6570\u636e\u8fdb\u884c\u66f4\u65b0</li> <li>Accumulating &amp; Retracting\uff1a\u5728\u7b2c\u4e8c\u79cd\u7684\u57fa\u7840\u4e0a\u63d0\u4f9b\u4e86\u56de\u9000\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u5728\u4e4b\u540e\u518d Trigger \u7684\u65f6\u5019\uff0c\u5148\u89e6\u53d1\u4e00\u6b21\u64a4\u56de\u64cd\u4f5c\uff0c\u518d\u4e0b\u53d1\u65b0\u7684\u7ed3\u679c</li> </ul>"},{"location":"distributed_computing/google_dataflow.html#4","title":"4. \u603b\u7ed3","text":"<p>\u524d\u9762\u63d0\u5230\u6570\u636e\u5904\u7406\u89e3\u6784\u51fa\u6765\u7684\u56db\u4e2a\u7ef4\u5ea6\uff0c\u6211\u4eec\u73b0\u5728\u6765\u770b\u4e00\u4e0b\u5982\u4f55\u89e3\u51b3\u3002</p> <ul> <li>What results are being computed. =&gt; Transformation</li> <li>Where in event time they are been computed. =&gt; Window</li> <li>When in processing time they are materialized. =&gt; Watermark and Trigger</li> <li>How earlier results relate to later refinements. =&gt; Discarding, Accumulating, Accumulating &amp; Retracting.</li> </ul>"},{"location":"distributed_computing/google_dataflow.html#5","title":"5. \u53c2\u8003\u6587\u732e","text":"<ol> <li>Google DataFlow Paper Reading, https://github.com/legendtkl/paper_reading/blob/main/realtime-compute/Google_DataFlow.md</li> </ol>"},{"location":"distributed_computing/hibench.html","title":"HiBench","text":"<p>https://github.com/Intel-bigdata/HiBench</p>"},{"location":"distributed_computing/hibench.html#_1","title":"\u6570\u636e\u96c6\u751f\u6210","text":"<ol> <li>\u57fa\u7840\u914d\u7f6e</li> </ol> <pre><code>${HiBench}/conf/hadoop.conf  #\u6307\u5b9aHadoop\u5b89\u88c5\u4f4d\u7f6e\u7b49\u4fe1\u606f\n${HiBench}/conf/spark.conf #\u6307\u5b9aSpark\u5b89\u88c5\u4f4d\u7f6e\u7b49\u4fe1\u606f\n</code></pre> <ol> <li>\u751f\u6210\u6570\u636e\u96c6\u4f5c\u4e1a\u914d\u7f6e</li> </ol> <p>\u751f\u6210\u8f93\u5165\u6570\u636e\u96c6\u5927\u5c0f\u7b49\u76f8\u5173\u914d\u7f6e</p> <p><code>${HiBench}/conf/workloads/micro/wordcount.conf</code></p> <pre><code># \u8def\u5f84\u6839\u636e\u6570\u636e\u89c4\u6a21\u8f93\u51fa\u6587\u4ef6\nhibench.workload.input  ${hibench.hdfs.data.dir}/wordcount/${hibench.scale.profile}\n</code></pre> <p>\u6570\u636e\u751f\u6210\u811a\u672c\u76f8\u5173\u914d\u7f6e</p> <p>${HiBench}/conf/hibench.conf`</p> <pre><code># \u4e3b\u8981\u4fee\u6539\u6587\u4ef6\u5f00\u5934\u8fd9\u4e09\u9879\nhibench.scale.profile               bigdata\n# Mapper number in hadoop, partition number in Spark\nhibench.default.map.parallelism        8\n# Reducer nubmer in hadoop, shuffle partition number in Spark\uff08\u5b9e\u9a8c\u73af\u5883\u662f8\u4e2a\uff09\nhibench.default.shuffle.parallelism     8\n\n# \u8f93\u51fa\u7684\u6570\u636e\u6839\u76ee\u5f55\uff0c\u4e0d\u7528\u4fee\u6539\uff0c\u9ed8\u8ba4\u5373\u53ef\nhibench.hdfs.data.dir           ${hibench.hdfs.master}/HiBench\n</code></pre> <ol> <li>\u6570\u636e\u751f\u6210\u811a\u672c</li> </ol> <pre><code># \u914d\u7f6e\u5b8c\u6210\u540e\u8fd0\u884c\u811a\u672c\u5373\u53ef\u751f\u6210\u4f5c\u4e1a\uff0c\u6ce8\u610fyarn-site.xml\u914d\u7f6e\u4e2d'yarn.resource.'\u7684\u914d\u7f6e\u4e2d\u4e0d\u8981\u6dfb\u52a0\u6ce8\u91ca\n${HiBench}/bin/workloads/micro/wordcount/prepare/prepare.sh\n# \u4fee\u6539hibench.conf\u4e2dhibench.scale.profile\u7684\u503c(tiny, small, large, huge, gigantic),\u6bcf\u6b21\u4fee\u6539\u540e,\u91cd\u65b0\u6267\u884cprepare.sh\n</code></pre> <ol> <li>\u67e5\u770b\u6570\u636e\u96c6\u7ed3\u679c</li> </ol> <pre><code>hadoop fs -ls /HiBench/wordcount/\n# \u8be5\u76ee\u5f55\u4e0b\u5e94\u8be5\u6709tiny, small, large, huge, gigantic\n</code></pre>"},{"location":"distributed_computing/lambda.html","title":"Lambda\u67b6\u6784","text":""},{"location":"distributed_computing/lambda.html#_1","title":"\u539f\u578b","text":"<p>Batch Layer\u3001Speed Layer\u3001Serving Layer</p> <p>\u7f3a\u70b9</p> <ul> <li>\u5b9e\u65f6\u4e0e\u6279\u91cf\u8ba1\u7b97\u7ed3\u679c\u4e0d\u4e00\u81f4\u5f15\u8d77\u7684\u6570\u636e\u53e3\u5f84\u95ee\u9898\uff1b</li> <li> <p>\u7ef4\u62a4\u4e24\u4e2a\u590d\u6742\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u5e76\u4e14\u4fdd\u8bc1\u4ed6\u4eec\u903b\u8f91\u4e0a\u4ea7\u751f\u76f8\u540c\u7684\u7ed3\u679c\u8f93\u51fa\u5230\u670d\u52a1\u5c42\u4e2d\uff1b</p> </li> <li> <p>\u6279\u91cf\u8ba1\u7b97\u5728\u8ba1\u7b97\u7a97\u53e3\u5185\u65e0\u6cd5\u5b8c\u6210\uff1b</p> </li> <li>\u670d\u52a1\u5668\u5b58\u50a8\u5927\uff1a\u6570\u636e\u4ed3\u5e93\u7684\u5178\u578b\u8bbe\u8ba1\uff0c\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u4e2d\u95f4\u7ed3\u679c\u8868\uff0c\u9020\u6210\u6570\u636e\u6025\u901f\u81a8\u80c0\uff0c\u52a0\u5927\u670d\u52a1\u5668\u5b58\u50a8\u538b\u529b\u3002</li> </ul>"},{"location":"distributed_computing/lambda.html#_2","title":"\u4e1a\u52a1\u6848\u4f8b","text":""},{"location":"distributed_computing/lambda.html#kappa","title":"Kappa\u67b6\u6784","text":"<p>Kappa\u67b6\u6784\u5728Lambda\u67b6\u6784\u7684\u57fa\u7840\u4e0a\u5220\u9664\u4e86Batch\u5c42\uff0c\u6240\u6709\u7684\u6570\u636e\u90fd\u662f\u6d41\u5904\u7406\u5b9e\u65f6\u8ba1\u7b97 </p> <ul> <li>\u901a\u8fc7\u6539\u8fdb\u6d41\u8ba1\u7b97\u7cfb\u7edf\u6765\u89e3\u51b3\u6570\u636e\u5168\u91cf\u5904\u7406\u7684\u95ee\u9898\uff0c\u4f7f\u5f97\u5b9e\u65f6\u8ba1\u7b97\u548c\u6279\u5904\u7406\u8fc7\u7a0b\u4f7f\u7528\u540c\u4e00\u5957\u4ee3\u7801\uff1b</li> <li>\u7528Kafka\u6216\u8005\u7c7b\u4f3cMQ\u961f\u5217\u7cfb\u7edf\u6536\u96c6\u5404\u79cd\u5404\u6837\u7684\u6570\u636e\uff0c\u9700\u8981\u51e0\u5929\u7684\u6570\u636e\u91cf\u5c31\u4fdd\u5b58\u51e0\u5929\uff1b</li> <li>\u5f53\u9700\u8981\u5168\u91cf\u91cd\u65b0\u8ba1\u7b97\u65f6\uff0c\u91cd\u65b0\u8d77\u4e00\u4e2a\u6d41\u8ba1\u7b97\u5b9e\u4f8b\uff0c\u4ece\u5934\u5f00\u59cb\u8bfb\u53d6\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u5e76\u8f93\u51fa\u5230\u4e00\u4e2a\u65b0\u7684\u7ed3\u679c\u5b58\u50a8\u4e2d\uff1b</li> <li>\u5f53\u65b0\u7684\u5b9e\u4f8b\u505a\u5b8c\u540e\uff0c\u505c\u6b62\u8001\u7684\u6d41\u8ba1\u7b97\u5b9e\u4f8b\uff0c\u5e76\u628a\u8001\u7684\u4e00\u4e9b\u7ed3\u679c\u5220\u9664</li> </ul>"},{"location":"distributed_computing/linkis.html","title":"Linkis","text":"<p>https://gitee.com/WeBank/Linkis</p> <p>\u5728\u4e0a\u5c42\u5e94\u7528\u7a0b\u5e8f\u548c\u5e95\u5c42\u5f15\u64ce\u4e4b\u95f4\u6784\u5efa\u4e86\u4e00\u5c42\u8ba1\u7b97\u4e2d\u95f4\u4ef6\u3002\u901a\u8fc7\u4f7f\u7528Linkis \u63d0\u4f9b\u7684REST/WebSocket/JDBC \u7b49\u6807\u51c6\u63a5\u53e3\uff0c\u4e0a\u5c42\u5e94\u7528\u53ef\u4ee5\u65b9\u4fbf\u5730\u8fde\u63a5\u8bbf\u95eeMySQL/Spark/Hive/Presto/Flink \u7b49\u5e95\u5c42\u5f15\u64ce\uff0c\u540c\u65f6\u5b9e\u73b0\u53d8\u91cf\u3001\u811a\u672c\u3001\u51fd\u6570\u548c\u8d44\u6e90\u6587\u4ef6\u7b49\u7528\u6237\u8d44\u6e90\u7684\u8de8\u4e0a\u5c42\u5e94\u7528\u4e92\u901a\u3002</p> <p></p>"},{"location":"distributed_computing/linkis.html#_1","title":"\u6838\u5fc3\u7279\u70b9","text":"<ul> <li>\u4e30\u5bcc\u7684\u5e95\u5c42\u8ba1\u7b97\u5b58\u50a8\u5f15\u64ce\u652f\u6301\u3002</li> <li>\u76ee\u524d\u652f\u6301\u7684\u8ba1\u7b97\u5b58\u50a8\u5f15\u64ce\uff1aSpark\u3001Hive\u3001Python\u3001Presto\u3001ElasticSearch\u3001MLSQL\u3001TiSpark\u3001JDBC\u548cShell\u7b49\u3002</li> <li>\u6b63\u5728\u652f\u6301\u4e2d\u7684\u8ba1\u7b97\u5b58\u50a8\u5f15\u64ce\uff1aFlink\u3001Impala\u7b49\u3002</li> <li>\u652f\u6301\u7684\u811a\u672c\u8bed\u8a00\uff1aSparkSQL, HiveQL, Python, Shell, Pyspark, R, Scala \u548cJDBC \u7b49\u3002</li> <li>\u5f3a\u5927\u7684\u8ba1\u7b97\u6cbb\u7406\u80fd\u529b\u3002\u57fa\u4e8eOrchestrator\u3001Label Manager\u548c\u5b9a\u5236\u7684Spring Cloud Gateway\u7b49\u670d\u52a1\uff0cLinkis\u80fd\u591f\u63d0\u4f9b\u57fa\u4e8e\u591a\u7ea7\u6807\u7b7e\u7684\u8de8\u96c6\u7fa4/\u8de8IDC \u7ec6\u7c92\u5ea6\u8def\u7531\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u591a\u79df\u6237\u3001\u6d41\u91cf\u63a7\u5236\u3001\u8d44\u6e90\u63a7\u5236\u548c\u7f16\u6392\u7b56\u7565(\u5982\u53cc\u6d3b\u3001\u4e3b\u5907\u7b49)\u652f\u6301\u80fd\u529b\u3002</li> <li>\u5168\u6808\u8ba1\u7b97\u5b58\u50a8\u5f15\u64ce\u67b6\u6784\u652f\u6301\u3002\u80fd\u591f\u63a5\u6536\u3001\u6267\u884c\u548c\u7ba1\u7406\u9488\u5bf9\u5404\u79cd\u8ba1\u7b97\u5b58\u50a8\u5f15\u64ce\u7684\u4efb\u52a1\u548c\u8bf7\u6c42\uff0c\u5305\u62ec\u79bb\u7ebf\u6279\u91cf\u4efb\u52a1\u3001\u4ea4\u4e92\u5f0f\u67e5\u8be2\u4efb\u52a1\u3001\u5b9e\u65f6\u6d41\u5f0f\u4efb\u52a1\u548c\u5b58\u50a8\u578b\u4efb\u52a1\uff1b</li> <li>\u8d44\u6e90\u7ba1\u7406\u80fd\u529b\u3002 ResourceManager \u4e0d\u4ec5\u5177\u5907 Linkis0.X \u5bf9 Yarn \u548c Linkis EngineManager \u7684\u8d44\u6e90\u7ba1\u7406\u80fd\u529b\uff0c\u8fd8\u5c06\u63d0\u4f9b\u57fa\u4e8e\u6807\u7b7e\u7684\u591a\u7ea7\u8d44\u6e90\u5206\u914d\u548c\u56de\u6536\u80fd\u529b\uff0c\u8ba9 ResourceManager \u5177\u5907\u8de8\u96c6\u7fa4\u3001\u8de8\u8ba1\u7b97\u8d44\u6e90\u7c7b\u578b\u7684\u5f3a\u5927\u8d44\u6e90\u7ba1\u7406\u80fd\u529b\u3002</li> <li>\u7edf\u4e00\u4e0a\u4e0b\u6587\u670d\u52a1\u3002\u4e3a\u6bcf\u4e2a\u8ba1\u7b97\u4efb\u52a1\u751f\u6210context id\uff0c\u8de8\u7528\u6237\u3001\u7cfb\u7edf\u3001\u8ba1\u7b97\u5f15\u64ce\u7684\u5173\u8054\u7ba1\u7406\u7528\u6237\u548c\u7cfb\u7edf\u8d44\u6e90\u6587\u4ef6\uff08JAR\u3001ZIP\u3001Properties\u7b49\uff09\uff0c\u7ed3\u679c\u96c6\uff0c\u53c2\u6570\u53d8\u91cf\uff0c\u51fd\u6570\u7b49\uff0c\u4e00\u5904\u8bbe\u7f6e\uff0c\u5904\u5904\u81ea\u52a8\u5f15\u7528\uff1b</li> <li>\u7edf\u4e00\u7269\u6599\u3002\u7cfb\u7edf\u548c\u7528\u6237\u7ea7\u7269\u6599\u7ba1\u7406\uff0c\u53ef\u5206\u4eab\u548c\u6d41\u8f6c\uff0c\u8de8\u7528\u6237\u3001\u7cfb\u7edf\u5171\u4eab\u7269\u6599\u3002</li> </ul>"},{"location":"distributed_computing/remote_shuffle.html","title":"Remote Shuffle","text":""},{"location":"distributed_computing/remote_shuffle.html#cloud-shuffle-servicecss","title":"Cloud Shuffle Service(CSS)","text":"<p>A general purpose remote shuffle solution for compute engines, including Spark/Flink/MapReduce.</p> <p>\u8ba1\u7b97\u548c\u4e2d\u95f4Shuffle\u6570\u636e\u5206\u79bb</p>"},{"location":"distributed_computing/remote_shuffle.html#_1","title":"\u67b6\u6784","text":"<p>\u8ba1\u7b97\u6846\u67b6\u5c06shuffle\u6570\u636e\u63a8\u9001\u5230CSS\u96c6\u7fa4\u5e76\u5b58\u653e\u5728\u78c1\u76d8\u6216\u8005HDFS\u4e2d\uff0c \u4e4b\u540e\u5f53\u9700\u8981\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u518d\u901a\u8fc7CSS\u96c6\u7fa4\u7684\u63a5\u53e3\u62c9\u53d6\u76f8\u5173\u7684shuffle\u6570\u636e\u3002</p> <ul> <li>CSS Worker</li> </ul> <p>\u8d1f\u8d23\u628a\u6765\u81eaMap Task\u53d1\u9001\u7684\u6570\u636e\u5b58\u50a8\u5230\u5185\u5b58\u4e2d\u5e76\u6700\u7ec8\u5f02\u6b65\u7684\u628a\u6570\u636e\u5237\u5199\u5230\u6587\u4ef6\u7cfb\u7edf\u4e2d\u3002\u5f53Reduce Task\u5f00\u59cb\u65f6\u53ef\u4ee5\u4eceWorker\u62c9\u53d6\u4e4b\u524d\u5b58\u50a8\u7684\u6570\u636e\u3002</p> <ul> <li>CSS Master</li> </ul> <p>\u8d1f\u8d23\u534f\u8c03application\u7684\u6574\u4e2ashuffle\u8fc7\u7a0b\uff0c\u9700\u8981\u88ab\u6574\u5408\u8fdbapplication\u7684\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u4f8b\u5982\u8dd1\u5728Spark\u7684driver\u4e2d\u3002 CSS Master\u4f1a\u4eceZooKeeper\u4e2d\u83b7\u53d6worker\u7684\u5217\u8868\u5e76\u4e14\u5206\u914d\u5408\u9002\u7684worker\u7ed9application\u63d0\u4f9bshuffle\u670d\u52a1\uff0c\u5e76\u4e14\u8ddf\u8fdb\u6240\u6709Map Task\u5b8c\u6210\u7684\u8fdb\u5ea6\uff0c \u5f53Map Task\u8fd0\u884c\u5b8c\u6210\u7684\u65f6\u5019\u4f1a\u901a\u77e5\u6240\u6709worker\u628a\u6240\u6709\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\u5e76\u5173\u95ed\u6587\u4ef6\u3002</p> <ul> <li>CSS Client</li> </ul> <p>\u5f53\u8fd0\u884cMap\u6216\u8005reduce task\u65f6\uff0c\u8d1f\u8d23\u4ece\u6240\u6709worker\u63a8\u9001\u6216\u8005\u62c9\u53d6shuffle\u6570\u636e</p> <p></p>"},{"location":"distributed_computing/remote_shuffle.html#todohttpsmpweixinqqcoms_dwefuwbjenhfxsmry0cga","title":"TODO(https://mp.weixin.qq.com/s/_dWEfuwbJEnHFxsmRY0cGA)","text":""},{"location":"distributed_computing/remote_shuffle.html#apache-uniffleincubating","title":"Apache Uniffle\uff08incubating\uff09","text":"<p>Apache Uniffle is a unified remote shuffle service for compute engines.</p>"},{"location":"distributed_computing/remote_shuffle.html#todohttpsuniffleapacheorgzh-cn","title":"TODO(https://uniffle.apache.org/zh-CN/)","text":""},{"location":"distributed_computing/remote_shuffle.html#apache-celebornincubating","title":"Apache Celeborn\uff08incubating\uff09","text":"<p>Apache Celeborn is an elastic and high-performance service for shuffle and spilled data.</p>"},{"location":"distributed_computing/remote_shuffle.html#apache-celebornincubating_1","title":"Apache Celeborn\uff08incubating\uff09","text":"<p>an intermediate data service for Big Data compute engines (i.e. ETL, OLAP and Streaming engines) to boost performance, stability, and flexibility. Intermediate data typically include shuffle and spilled data.</p>"},{"location":"distributed_computing/remote_shuffle.html#todo","title":"TODO","text":""},{"location":"distributed_computing/beam/beam.html","title":"Apache Beam","text":"<p>Beam\u662f\u4e00\u4e2a\u7edf\u4e00\u7684\u7f16\u7a0b\u6846\u67b6\uff0c\u652f\u6301\u6279\u5904\u7406\u548c\u6d41\u5904\u7406\uff0c\u5e76\u53ef\u4ee5\u5c06\u7528Beam\u7f16\u7a0b\u6a21\u578b\u6784\u9020\u51fa\u6765\u7684\u7a0b\u5e8f\uff0c\u5728\u591a\u4e2a\u8ba1\u7b97\u5f15\u64ce\uff08Apache Apex(retired), Apache Flink, Apache Spark, Google Cloud Dataflow\u7b49\uff09\u4e0a\u8fd0\u884c\u3002</p>"},{"location":"distributed_computing/beam/beam.html#_1","title":"\u67b6\u6784","text":"<p>Beam\u7684\u7f16\u7a0b\u6a21\u578b\u662fGoogle\u7684\u5de5\u7a0b\u5e08\u4eceMapReduce, FlumeJava, \u548cMillwheel\u7b49\u591a\u4e2a\u5927\u6570\u636e\u5904\u7406\u9879\u76ee\u4e2d\u62bd\u8c61\u51fa\u6765\u7684\uff0c\u5982\u679c\u60f3\u8be6\u7ec6\u4e86\u89e3\u53ef\u4ee5\u53c2\u8003\u76f8\u5173\u7684\u62a5\u8003\u548c\u8bba\u6587\uff0cStreaming 101\uff0cStreaming 102 \u548c VLDB 2015 paper\u3002\u8fd9\u4e2a\u7f16\u7a0b\u6a21\u578b\u4e3b\u8981\u5305\u62ec\u5982\u4e0b\u51e0\u4e2a\u6838\u5fc3\u6982\u5ff5\uff1a</p> <ul> <li>PCollection\uff1a\u6570\u636e\u96c6\uff0c\u4ee3\u8868\u4e86\u5c06\u8981\u88ab\u5904\u7406\u7684\u6570\u636e\u96c6\u5408\uff0c\u53ef\u4ee5\u662f\u6709\u9650\u7684\u6570\u636e\u96c6\uff0c\u4e5f\u53ef\u4ee5\u662f\u65e0\u9650\u7684\u6570\u636e\u6d41\u3002</li> <li>PTransform\uff1a\u8ba1\u7b97\u8fc7\u7a0b\uff0c\u4ee3\u8868\u4e86\u5c06\u8f93\u5165\u6570\u636e\u96c6\u5904\u7406\u6210\u8f93\u51fa\u6570\u636e\u96c6\u4e2d\u95f4\u7684\u8ba1\u7b97\u8fc7\u7a0b\uff0c</li> <li>Pipeline\uff1a\u7ba1\u9053\uff0c\u4ee3\u8868\u4e86\u5904\u7406\u6570\u636e\u7684\u6267\u884c\u4efb\u52a1\uff0c\u53ef\u89c6\u4f5c\u4e00\u4e2a\u6709\u5411\u65e0\u73af\u56fe\uff08DAG\uff09\uff0cPCollections\u662f\u8282\u70b9\uff0cTransforms\u662f\u8fb9\u3002</li> <li>PipelineRunner\uff1a\u6267\u884c\u5668\uff0c\u6307\u5b9a\u4e86Pipeline\u5c06\u8981\u5728\u54ea\u91cc\uff0c\u600e\u6837\u7684\u8fd0\u884c\u3002</li> </ul>"},{"location":"distributed_computing/flink/ai-extend.html","title":"Flink AI Extend","text":""},{"location":"distributed_computing/flink/ai-extend.html#flink-ai-flow","title":"Flink AI Flow","text":"<p>AI Flow is an open source framework that bridges big data and artificial intelligence.</p> <p>\u5bf9\u5de5\u4f5c\u6d41\u6a21\u578b\u8fdb\u884c\u4e86\u7edf\u4e00\u62bd\u8c61\uff0c\u901a\u8fc7Event\u673a\u5236\u8fdb\u884c\u6d41\u6279\u6df7\u5408\u7684\u8c03\u5ea6\u3002</p> <ul> <li>\u628a\u673a\u5668\u5b66\u4e60\u7684\u5de5\u4f5c\u6d41\u62bd\u8c61\u6210\u4e00\u4e2aAIGraph\uff0c\u5f15\u5165\u4e86\u6570\u636e\u4f9d\u8d56\u548c\u63a7\u5236\u4f9d\u8d56\uff0c\u80fd\u591f\u4ece\u591a\u4e2a\u7ef4\u5ea6\u8fdb\u884cEvent\u8c03\u5ea6\uff1b</li> <li>\u4f7f\u7528Python\u811a\u672c\u5b9a\u4e49\u5de5\u4f5c\u6d41\uff0c\u7c7b\u4f3c\u4e8eApache Airflow\uff1b</li> <li>\u76f4\u63a5\u517c\u5bb9Apache Airflow\u7684\u539f\u751fDAG\u4efb\u52a1\uff0c\u81ea\u5b9a\u4e49\u4e0d\u540c\u7684\u4efb\u52a1\u63d2\u4ef6\uff0c\u81ea\u5b9a\u4e49\u5e95\u5c42\u7684\u8c03\u5ea6\u5668\uff1b</li> </ul> <p>\u80cc\u666f\uff1a</p> <ul> <li>Airflow\u548cKubeflow\u90fd\u662f\u57fa\u4e8e\u4e0a\u6e38\u4efb\u52a1\u6267\u884c\u7684\u72b6\u6001\u8c03\u5ea6\uff0c\u9002\u7528\u4e8e\u6279\u5904\u7406\u4efb\u52a1\uff08\u5373\u4efb\u52a1\u4f1a\u7ed3\u675f\uff09\uff0c\u5bf9\u4e8e\u53ef\u80fd\u4f1a\u4e00\u76f4\u8fd0\u884c\u7684\u6d41\u5f0f\u4efb\u52a1\u5e76\u4e0d\u9002\u5408\uff1b</li> </ul> <p>\u7279\u6027\uff1a</p> <ul> <li>Event-driven: \u57fa\u4e8e\u4e8b\u4ef6\u8c03\u5ea6\u5de5\u4f5c\u6d41\u548c\u4f5c\u4e1a\uff0c\u6bd4\u72b6\u6001\u9a71\u52a8\u8c03\u5ea6\u66f4\u6709\u6548\uff0c\u53ef\u4ee5\u8c03\u5ea6\u5305\u542b\u6d41\u5f0f\u4f5c\u4e1a\u7684\u5de5\u4f5c\u6d41\uff1b</li> <li>Extensible: \u7528\u6237\u53ef\u4ee5\u81ea\u5b9a\u4e49opreators\u548cexecutors \u63d0\u4ea4\u591a\u79cd\u7c7b\u578b\u7684\u4f5c\u4e1a\u5230\u4e0d\u540c\u7684\u5e73\u53f0\uff1b</li> <li>Exactly-once: \u63d0\u4f9bexactly-once\u7684\u4e8b\u4ef6\u5904\u7406\u673a\u5236\uff0c\u5728\u9519\u8bef\u53d1\u751f\u65f6\u4efb\u52a1\u4e0d\u4f1a\u4e22\u5931\u548c\u91cd\u590d\uff1b</li> </ul>"},{"location":"distributed_computing/flink/ai-extend.html#_1","title":"\u67b6\u6784","text":""},{"location":"distributed_computing/flink/ai-extend.html#sdk","title":"SDK","text":"<p>AIFlow SDK provides the API of workflow operation and the client of the Meta Service and Scheduling Service. The SDK mainly consists of four parts: AIFlow API, AI Graph, Translator and Workflow.</p>"},{"location":"distributed_computing/flink/ai-extend.html#aiflow-api","title":"AIFlow API","text":"<p>AIFlow API provides the functions like defining a machine learning workflow, workflow operation(submit, start, stop, etc.), sending/listening events, managing the metadata.</p>"},{"location":"distributed_computing/flink/ai-extend.html#ai-graph","title":"AI Graph","text":"<p>AI Graph is a logical graph generated by the user-defined AIFlow application.</p>"},{"location":"distributed_computing/flink/ai-extend.html#workflow","title":"Workflow","text":"<p>Workflow defines a set of execution rules for Jobs.</p>"},{"location":"distributed_computing/flink/ai-extend.html#translator","title":"Translator","text":"<p>Translator converts an AI Graph to a Workflow.</p>"},{"location":"distributed_computing/flink/ai-extend.html#aiflow-server","title":"AIFlow Server","text":"<p>AIFlow Server provides metadata management and scheduling services.</p>"},{"location":"distributed_computing/flink/ai-extend.html#notification-server","title":"Notification Server","text":"<p>Notification Server provides capabilities the event publishing and subscription.</p>"},{"location":"distributed_computing/flink/ai-extend.html#scheduler","title":"Scheduler","text":"<p>Scheduler provides the function of executing workflow.</p>"},{"location":"distributed_computing/flink/ai-extend.html#_2","title":"\u539f\u7406","text":"<p>\u5de5\u4f5c\u6d41\u7a0b\uff1a</p> <p></p> <ol> <li>Generates an AI Graph by the AIFlow API.</li> <li>Translates an AI Graph to a Workflow.</li> <li>Submits the Workflow to Scheduling Service and register metadata to Meta Service.</li> <li>Scheduling Service calls scheduler to execute workflow.</li> <li>When the Scheduler runs the workflow, it will publish and subscribe events to Notification Server.</li> <li>AIFlow server sends events to Notification Server, such as model version generation events, etc</li> </ol>"},{"location":"distributed_computing/flink/ai-extend.html#_3","title":"\u5b89\u88c5","text":"<ul> <li>\u9700\u8981DB\u8fdb\u884c\u5b58\u50a8\uff0c\u5f00\u53d1\u73af\u5883\u53ef\u4f7f\u7528SQLite\uff0c\u751f\u4ea7\u73af\u5883\u5efa\u8baeMySQL\uff1b</li> </ul> <pre><code># sqlite\u4f5c\u4e3a\u540e\u7aef\n$ pip install ai-flow-nightly\n# mysql\u4f5c\u4e3a\u540e\u7aef\n$ pip install ai-flow-nightly[mysql]\n</code></pre>"},{"location":"distributed_computing/flink/ai-extend.html#_4","title":"\u793a\u4f8b","text":"<p>TODO\uff1ahttps://ai-flow.readthedocs.io/en/latest/content/tutorial_and_examples/tutorial.html</p>"},{"location":"distributed_computing/flink/ai-extend.html#_5","title":"\u5b9e\u6218\u601d\u8003","text":"<p>B\u7ad9\u57fa\u4e8eAIFlow+Flink\u5728\u6279\u6d41\u878d\u5408\u8c03\u5ea6\u4e0a\u7684\u5b9e\u8df5</p>"},{"location":"distributed_computing/flink/ai-extend.html#_6","title":"\u7279\u5f81\u56de\u6eaf","text":"<p>\u5b9e\u65f6\u7279\u5f81\u8ba1\u7b97\u5927\u7684\u8bc9\u6c42\u5c31\u662f\u7279\u5f81\u56de\u6eaf\uff0c\u5bf9\u4e8e\u957f\u65f6\u95f4\u7a97\u53e3\u7684\u7279\u5f81\uff0c\u4e1a\u52a1\u662f\u5f88\u96be\u7b49\u5230\u5728\u7d2f\u79ef\u5230\u8db3\u591f\u65f6\u95f4\u7684\u6570\u636e\u4e4b\u540e\u624d\u5f00\u59cb\u4f7f\u7528\uff0c\u56e0\u6b64\u5e0c\u671b\u4f7f\u7528\u79bb\u7ebf\u7684\u5386\u53f2\u6570\u636e\u8fdb\u884c\u7279\u5f81\u586b\u5145\uff0c\u4f46\u662f\u79bb\u7ebf\u7684\u6570\u636e\u5728hdfs\u4e0a\uff0c\u57fa\u4e8ehdfs\u6709\u4e24\u79cd\u8ba1\u7b97\u65b9\u6848\uff1a</p> <ul> <li>\u7b2c\u4e00\u79cd\u6309\u7167\u5b9e\u65f6\u7684\u903b\u8f91\u5f00\u53d1\u4e00\u5957\u79bb\u7ebf\u7279\u5f81\u7684\u8ba1\u7b97\uff0c\u4e13\u95e8\u7528\u6765\u505a\u6570\u636e\u56de\u8865\uff1b</li> <li>\u7b2c\u4e8c\u79cd\u662f\u76f4\u63a5\u628a\u79bb\u7ebf\u7684hdfs\u6570\u636e\uff0c\u704c\u5230\u5b9e\u65f6\u8ba1\u7b97\u7684\u6d41\u7a0b\u91cc\u9762\u3002</li> </ul> <p>\u91c7\u7528\u7b2c\u4e8c\u79cd\u65b9\u6848\uff1a\u6d41\u6279\u4e00\u4f53</p> <p>\u4fdd\u8bc1\u6570\u636e\u7684\u987a\u5e8f\u6027\uff1a\u79bb\u7ebf\u7684 HDFS\u6709\u5206\u533a\uff0c\u5206\u533a\u5185\u7684\u6570\u636e\u5b8c\u5168\u4e71\u5e8f\uff0c\u5b9e\u9645\u4e1a\u52a1\u91cc\u9762\u5927\u91cf\u8ba1\u7b97\u8fc7\u7a0b\u662f\u4f9d\u8d56\u65f6\u5e8f\uff1b</p> <ul> <li>\u6a21\u62dfKafka\u5f62\u6210\u903b\u8f91\u4e0a\u7684\u5206\u533a\uff0c\u5e76\u4e14\u903b\u8f91\u5206\u533a\u5185\u6709\u5e8f\uff1b</li> </ul> <p>\u4fdd\u8bc1\u7279\u5f81\u548c\u6837\u672c\u7248\u672c\u7684\u4e00\u81f4\u6027\uff1a\u6bd4\u5982\u6709\u4e24\u6761\u94fe\u8def\uff0c\u4e00\u6761\u662f\u7279\u5f81\u7684\u751f\u4ea7\uff0c\u4e00\u6761\u662f\u6837\u672c\u751f\u4ea7\uff0c\u6837\u672c\u751f\u4ea7\u4f9d\u8d56\u7279\u5f81\u751f\u4ea7\uff0c\u5982\u4f55\u4fdd\u8bc1\u5b83\u4eec\u4e4b\u95f4\u7248\u672c\u7684\u4e00\u81f4\u6027\uff0c\u6ca1\u6709\u7a7f\u8d8a\uff1f</p> <ul> <li>\u7b2c\u4e00\u4e2a\u5b9e\u65f6\u7279\u5f81\u90e8\u5206\u7684\u89e3\u51b3\u4f9d\u8d56\u4e8e Hbase \u5b58\u50a8\uff0cHbase \u652f\u6301\u6839\u636e\u7248\u672c\u67e5\u8be2\u3002\u7279\u5f81\u8ba1\u7b97\u5b8c\u540e\u76f4\u63a5\u6309\u7167\u7248\u672c\u5199\u5165 Hbase\uff0c\u6837\u672c\u751f\u6210\u7684\u65f6\u5019\u53bb\u67e5 Hbase \u5e26\u4e0a\u5bf9\u5e94\u7684\u7248\u672c\u53f7\u5373\u53ef\uff0c\u8fd9\u91cc\u9762\u7684\u7248\u672c\u901a\u5e38\u662f\u6570\u636e\u65f6\u95f4\uff1b</li> <li>\u79bb\u7ebf\u7279\u5f81\u90e8\u5206\uff0c\u56e0\u4e3a\u4e0d\u9700\u8981\u91cd\u65b0\u8ba1\u7b97\u4e86\uff0c\u79bb\u7ebf\u5b58\u50a8 hdfs \u90fd\u6709\uff0c\u4f46\u662f\u4e0d\u652f\u6301\u70b9\u67e5\uff0c\u8fd9\u5757\u8fdb\u884c kv \u5316\u5904\u7406\u5c31\u597d\uff0c\u4e3a\u4e86\u6027\u80fd\u505a\u5f02\u6b65\u9884\u52a0\u8f7d\uff1b</li> </ul>"},{"location":"distributed_computing/flink/ai-extend.html#deep-learning-on-flink","title":"Deep Learning on Flink","text":"<p>Deep Learning on Flink aims to integrate Flink and deep learning frameworks (e.g. TensorFlow, PyTorch, etc).</p>"},{"location":"distributed_computing/flink/ai-extend.html#_7","title":"\u67b6\u6784","text":"<ol> <li>AM registers its address to zookeeper.</li> <li>Worker and Ps get AM address from zookeeper.</li> <li>Worker and Ps register their address to AM.</li> <li>AM collect all Worker and Ps address.</li> <li>Worker and Ps get cluster information.</li> <li>Worker and Ps start algorithm python process.</li> </ol>"},{"location":"distributed_computing/flink/ai-extend.html#_8","title":"\u539f\u7406","text":"<p>https://github.com/flink-extended/dl-on-flink/blob/master/doc/design.md TODO</p>"},{"location":"distributed_computing/flink/api.html","title":"Flink API","text":"<p>DataSet \u548c DataStream\u7684\u6d41\u7a0b\uff1a</p> <ol> <li>\u83b7\u53d6<code>execution environment</code>\uff1b</li> <li>\u52a0\u8f7d/\u521b\u5efa\u6570\u636e\uff1b</li> <li>\u6570\u636e\u8f6c\u6362\uff1b</li> <li>\u7ed3\u679c\u5b58\u50a8\uff1b</li> <li>\u89e6\u53d1\u7a0b\u5e8f\u6267\u884c\uff1b</li> </ol> <p>data source -&gt; data operations -&gt; data sink</p> <p>Flink\u7684\u6267\u884c\u901a\u8fc7 Environment \u7684 execute \u65b9\u6cd5\uff0c\u662f\u6839\u636esink\uff08\u8f93\u51fa\uff09\u51b3\u5b9a\u8f93\u5165\u4ee5\u53ca\u6267\u884c\u7684\u64cd\u4f5c\u3002</p> <ul> <li>\u4e24\u6b21execute\u4e4b\u95f4\uff0c\u65b0\u7684sink\u4f1a\u88ab\u8f93\u51fa\uff1b</li> </ul>"},{"location":"distributed_computing/flink/api.html#not-done","title":"\u4ea4\u4e92\u5f0f\u7f16\u7a0b(Not Done)","text":"<p>https://cwiki.apache.org/confluence/display/FLINK/FLIP-36%3A+Support+Interactive+Programming+in+Flink</p> <p>DataSet \u7684 API\uff0c\u53ef\u4ee5\u4ea4\u4e92\u5f0f</p>"},{"location":"distributed_computing/flink/api.html#datasetscala","title":"DataSet(scala)","text":"<p>\u6709\u754c\u6570\u636e\uff0cDataSet \u7c7b\u4f3c RDD\uff0c\u63d0\u4f9b filter\u7b49\u8f6c\u6362\uff0c\u4ee5\u53cacollect, print\u7b49sink\uff1b</p> <p>ExecutionEnvironment</p> <p>\u83b7\u53d6\u6267\u884c\u73af\u5883\uff1a</p> <pre><code>getExecutionEnvironment()\n\ncreateLocalEnvironment()\n\ncreateRemoteEnvironment(String host, int port, String... jarFiles)\n</code></pre>"},{"location":"distributed_computing/flink/api.html#datastreamscalapython","title":"DataStream(scala/python)","text":"<p>\u65e0\u754c\u6570\u636e</p> <p>StreamExecutionEnvironment</p> <p>Flink\u7684\u6267\u884c\uff0c\u901a\u8fc7Environment\u8fdb\u884c\u6267\u884c\u3002\u3002</p>"},{"location":"distributed_computing/flink/api.html#tablescalapython","title":"Table(scala/python)","text":""},{"location":"distributed_computing/flink/checkpointing.html","title":"\u68c0\u67e5\u70b9","text":"<p>Flink\u4e2d\u7684\u51fd\u6570\u548c\u72b6\u6001\u53ef\u4ee5\u662f\u6709\u72b6\u6001\u7684\uff0c\u6709\u72b6\u6001\u51fd\u6570\u5728\u5904\u7406\u5355\u4e2a\u5143\u7d20/\u4e8b\u4ef6\u65f6\u5b58\u50a8\u6570\u636e\uff0c\u4f7f\u72b6\u6001\u6210\u4e3a\u4efb\u4f55\u7c7b\u578b\u66f4\u7cbe\u7ec6\u64cd\u4f5c\u7684\u5173\u952e\u6784\u5efa\u5757\u3002</p> <p>\u4e3a\u4e86\u4f7f\u72b6\u6001\u5bb9\u9519\uff0cFlink\u9700\u8981\u5bf9\u72b6\u6001\u8bbe\u7f6e\u68c0\u67e5\u70b9\u3002\u68c0\u67e5\u70b9\u5141\u8bb8Flink\u6062\u590d\u6d41\u4e2d\u7684\u72b6\u6001\u548c\u4f4d\u7f6e\uff0c\u4e3a\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u4e0e\u65e0\u6545\u969c\u6267\u884c\u76f8\u540c\u7684\u8bed\u4e49\u3002</p> <p>Flink\u4ececheckpoint\u6062\u590d\uff0c\u9700\u8981\u624b\u52a8\u6307\u5b9a\u68c0\u67e5\u70b9\u7684\u4f4d\u7f6e\uff08\u5230chk-\u7684\u76ee\u5f55\uff09</p>"},{"location":"distributed_computing/flink/checkpointing.html#_2","title":"\u524d\u7f6e\u8981\u6c42","text":"<p>Flink\u7684\u68c0\u67e5\u70b9\u673a\u5236\uff0c\u5bf9\u6d41\u548c\u72b6\u6001\u9700\u8981\u53ef\u9760\u7684\u5b58\u50a8\uff0c\u5982\uff1a</p> <ul> <li>\u4e00\u79cd\u6301\u4e45\u6216\u6c38\u4e45\u7684\u6570\u636e\u6e90\uff0c\u53ef\u4ee5\u5728\u4e00\u5b9a\u65f6\u95f4\u5185\u91cd\u64ad\u8bb0\u5f55\uff0c\u5982Kafka\u3001RocketMQ\u3001HDFS\u3001Ceph\u7b49\uff1b</li> <li>\u4e00\u79cd\u6301\u4e45\u5316\u7684\u5b58\u50a8\uff0c\u7528\u4e8e\u5b58\u50a8\u72b6\u6001\u4fe1\u606f\uff0c\u5982\u5206\u5e03\u5f0f\u7cfb\u7edf\uff08HDFS\u3001Ceph\u7b49\uff09\uff1b</li> </ul>"},{"location":"distributed_computing/flink/checkpointing.html#_3","title":"\u914d\u7f6e","text":"<p>\u9ed8\u8ba4\uff0c\u68c0\u67e5\u70b9\u662f\u5173\u95ed\u3002<code>StreamExecutionEnvironment</code>\u7684<code>enableCheckpointing(n)</code>\u51fd\u6570\uff0c<code>n</code>\u8868\u793a\u68c0\u67e5\u70b9\u7684\u95f4\u9694\uff08ms\uff09\u3002</p> <ul> <li>checkpoint storage\uff1a\u9ed8\u8ba4\u4f7f\u7528 JobManager\u7684\u5185\u5b58\uff0c\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u914d\u7f6e\u6301\u4e45\u5316\u5b58\u50a8\uff1b</li> <li>exactly-once vs. at-least-once\uff1a\u6301\u4e45\u5316\u65f6\u53ef\u4ee5\u9009\u62e9\u4e0d\u540c\u7684\u8bed\u4e49\uff1b</li> <li>checkpoint timeout\uff1a\u6301\u4e45\u5316\u8d85\u65f6\u65f6\u95f4\uff0c\u5373\u7ed9\u5b9a\u7684\u65f6\u95f4\u5185\u672a\u5b8c\u6210\u6301\u4e45\u5316\u64cd\u4f5c\uff1b</li> <li>minimum time between checkpoints\uff1a\u4e24\u6b21\u6301\u4e45\u5316\u7684\u6700\u5c0f\u65f6\u95f4\uff08\u5e94\u8be5\u6bd4\u95f4\u9694\u8981\u5927\uff09\uff0c\u7528\u4e8e\u9632\u6b62\u5b58\u50a8\u7cfb\u7edf\u53d8\u6162\u7684\u60c5\u51b5\uff1b</li> <li>number of concurrent checkpoints\uff1a\u5e76\u53d1\u7684\u68c0\u67e5\u70b9\u5199\u5165\u6570\uff0c\u9ed8\u8ba4\u4e3a1\uff0c\u5f53pipeline\u4e2d\u6709\u4e00\u5b9a\u7684\u5904\u7406\u5ef6\u8fdf\uff1b</li> <li>externalized checkpoints\uff1a\u5916\u90e8\u5316\u68c0\u67e5\u70b9\u5c06\u5b83\u4eec\u7684\u5143\u6570\u636e\u5199\u5165\u6301\u4e45\u5b58\u50a8\uff0c\u5f53\u4f5c\u4e1a\u5931\u8d25\u65f6\u4e0d\u4f1a\u81ea\u52a8\u6e05\u9664\u3002\u5982\u679c\u5de5\u4f5c\u5931\u8d25\uff0c\u6709\u4e86\u4e00\u4e2a\u91cd\u65b0\u5f00\u59cb\u7684\u68c0\u67e5\u70b9\uff1b</li> <li>fail/continue task on checkpoint errors\uff1acheckpoint\u5931\u8d25\u662f\u5426\u4f1a\u5bfc\u81f4task\u5931\u8d25\uff1b</li> <li>prefer checkpoint for recovery\uff1a\u8fd9\u5c06\u51b3\u5b9a\u4f5c\u4e1a\u662f\u5426\u4f1a\u56de\u9000\u5230\u6700\u65b0\u7684\u68c0\u67e5\u70b9\uff0c\u5373\u4f7f\u6709\u66f4\u8fd1\u671f\u7684\u4fdd\u5b58\u70b9\u53ef\u7528\u6765\u6f5c\u5728\u5730\u51cf\u5c11\u6062\u590d\u65f6\u95f4\u3002</li> <li>unaligned checkpoints\uff1a\u542f\u7528\u672a\u5bf9\u9f50\u7684\u68c0\u67e5\u70b9\uff0c\u4ee5\u5927\u5927\u51cf\u5c11\u53cd\u538b\u529b\u4e0b\u7684\u68c0\u67e5\u70b9\u65f6\u95f4\u3002\u53ea\u9002\u7528\u4e8e<code>exactly once</code>\u7684\u68c0\u67e5\u70b9\uff0c\u5e76\u4e14\u5e76\u53d1\u68c0\u67e5\u70b9\u7684\u6570\u91cf\u4e3a1\u3002</li> </ul> Key Default Type Description state.backend.incremental false Boolean \u589e\u91cf\u7684\u68c0\u67e5\u70b9\uff0c\u800c\u4e0d\u662f\u6bcf\u6b21\u90fd\u662f\u5168\u91cf\u7684\u68c0\u67e5\u70b9 state.backend.local-recovery false Boolean \u7f3a\u7701\u60c5\u51b5\u4e0b\uff0c\u672c\u5730\u6062\u590d\u5904\u4e8e\u53bb\u6fc0\u6d3b\u72b6\u6001\u3002\u672c\u5730\u6062\u590d\u76ee\u524d\u53ea\u8986\u76d6\u5173\u952e\u72b6\u6001\u540e\u7aef\u3002\u76ee\u524d\uff0cMemoryStateBackend\u548cHashMapStateBackend\u4e0d\u652f\u6301\u672c\u5730\u6062\u590d\uff0c\u5ffd\u7565\u6b64\u9009\u9879 state.checkpoint-storage (none) String \u68c0\u67e5\u70b9\u5b58\u50a8\u7684\u5b9e\u73b0\uff0c\u5185\u7f6e 'jobmanager' and 'filesystem' state.checkpoints.dir (none) String \u9ed8\u8ba4\u7684\u76ee\u5f55\uff0c\u9700\u8981\u6240\u6709flink\u53c2\u4e0e\u7684\u8fdb\u7a0b\u53ef\u4ee5\u8bbf\u95ee state.checkpoints.num-retained 1 Integer \u4fdd\u7559\u7684\u5b8c\u6210\u7684checkpoint\u7684\u6570\u91cf state.savepoints.dir (none) String savepoint\u7684\u9ed8\u8ba4\u76ee\u5f55\uff0c\u7528\u4e8e\u72b6\u6001\u540e\u7aef\u5199savepoint\u5230\u6587\u4ef6\u7cfb\u7edf\u4e2d(HashMapStateBackend, EmbeddedRocksDBStateBackend). state.storage.fs.memory-threshold 20 kb MemorySize \u72b6\u6001\u6570\u636e\u6587\u4ef6\u7684\u6700\u5c0f\u5927\u5c0f\u3002\u6240\u6709\u6bd4\u5b83\u5c0f\u7684\u72b6\u6001\u5757\u90fd\u5185\u8054\u5b58\u50a8\u5728\u6839\u68c0\u67e5\u70b9\u5143\u6570\u636e\u6587\u4ef6\u4e2d\u3002\u6b64\u914d\u7f6e\u7684\u6700\u5927\u5185\u5b58\u9608\u503c\u662f1MB\u3002 state.storage.fs.write-buffer-size 4096 Integer \u5199\u5165\u6587\u4ef6\u7cfb\u7edf\u7684\u68c0\u67e5\u70b9\u6d41\u7684\u5199\u5165\u7f13\u51b2\u533a\u7684\u9ed8\u8ba4\u5927\u5c0f\u3002\u5b9e\u9645\u7684\u5199\u7f13\u51b2\u533a\u5927\u5c0f\u662f\u8fd9\u4e2a\u9009\u9879\u548c\u9009\u9879'state.storage.fs.memory-threshold'\u7684\u6700\u5927\u503c\u3002 taskmanager.state.local.root-dirs (none) String \u5b9a\u4e49\u6839\u76ee\u5f55\u7684\u914d\u7f6e\u53c2\u6570\uff0c\u7528\u4e8e\u5b58\u50a8\u672c\u5730\u6062\u590d\u7684\u57fa\u4e8e\u6587\u4ef6\u7684\u72b6\u6001\u3002\u672c\u5730\u6062\u590d\u76ee\u524d\u53ea\u8986\u76d6\u5173\u952e\u72b6\u6001\u540e\u7aef\u3002\u76ee\u524d\uff0cMemoryStateBackend\u4e0d\u652f\u6301\u672c\u5730\u6062\u590d\uff0c\u5ffd\u7565\u6b64\u9009\u9879"},{"location":"distributed_computing/flink/checkpointing.html#_4","title":"\u68c0\u67e5\u70b9\u5b58\u50a8\u4ecb\u8d28\u9009\u62e9","text":"<p>Flink\u7684\u68c0\u67e5\u70b9\u673a\u5236\u5728\u8ba1\u65f6\u5668\u548c\u6709\u72b6\u6001\u64cd\u4f5c\u7b26(\u5305\u62ec\u8fde\u63a5\u5668\u3001\u7a97\u53e3\u548c\u4efb\u4f55\u7528\u6237\u5b9a\u4e49\u7684\u72b6\u6001)\u4e2d\u5b58\u50a8\u6240\u6709\u72b6\u6001\u7684\u4e00\u81f4\u5feb\u7167\u3002\u5b58\u50a8\u68c0\u67e5\u70b9\u7684\u4f4d\u7f6e(\u4f8b\u5982\uff0cJobManager\u5185\u5b58\u3001\u6587\u4ef6\u7cfb\u7edf\u3001\u6570\u636e\u5e93)\u53d6\u51b3\u4e8e\u914d\u7f6e\u7684\u68c0\u67e5\u70b9\u5b58\u50a8\u3002</p> <p>\u9ed8\u8ba4\u4f7f\u7528 JobManager\u7684\u5185\u5b58\uff0c\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u914d\u7f6e\u9ad8\u53ef\u7528\u7684\u6301\u4e45\u5316\u5b58\u50a8\uff1b</p>"},{"location":"distributed_computing/flink/checkpointing.html#jobmanagercheckpointstorage","title":"JobManagerCheckpointStorage","text":"<p>\u5982\u679c\u68c0\u67e5\u70b9\u8d85\u8fc7\u4e00\u5b9a\u7684\u5927\u5c0f\uff0c\u53ef\u4ee5\u5c06\u5176\u914d\u7f6e\u4e3a\u4f7f\u68c0\u67e5\u70b9\u5931\u8d25\uff0c\u4ee5\u907f\u514dJobManager\u4e0a\u51fa\u73b0OutOfMemoryError\u9519\u8bef\u3002</p> <pre><code>new JobManagerCheckpointStorage(MAX_MEM_STATE_SIZE);\n</code></pre> <ul> <li>\u6bcf\u4e2a\u72b6\u6001\u7684\u5927\u5c0f\u9ed8\u8ba4\u9650\u5236\u4e3a5mb\uff0c\u53ef\u4ee5\u5728<code>JobManagerCheckpointStorage</code>\u7684\u6784\u9020\u51fd\u6570\u4e2d\u589e\u52a0\uff1b</li> <li>\u4e0d\u8003\u8651\u914d\u7f6e\u7684\u6700\u5927\u72b6\u6001\u5927\u5c0f\uff0c\u72b6\u6001\u4e0d\u80fd\u5927\u4e8eAkka\u5e27\u5927\u5c0f(\u9ed8\u8ba410MB)\uff1b</li> <li>\u805a\u5408\u72b6\u6001\u5fc5\u987b\u9002\u5408JobManager\u5185\u5b58\u3002</li> </ul> <p>\u4ec5\u9002\u7528\u4e8e\uff1a</p> <ul> <li>\u672c\u5730\u5f00\u53d1\u548c\u8c03\u8bd5</li> <li>\u4f7f\u7528\u5f88\u5c11\u72b6\u6001\u7684\u4f5c\u4e1a\uff0c\u4f8b\u5982\u53ea\u5305\u542b\u4e00\u6b21\u8bb0\u5f55\u51fd\u6570(Map, FlatMap, Filter\uff0c\u2026)\u7684\u4f5c\u4e1a\u3002Kafka\u6d88\u8d39\u8005\u9700\u8981\u5f88\u5c11\u7684\u72b6\u6001\u3002</li> </ul>"},{"location":"distributed_computing/flink/checkpointing.html#filesystemcheckpointstorage","title":"FileSystemCheckpointStorage","text":"<p>\u5728\u68c0\u67e5\u70b9\u65f6\uff0c\u5b83\u5c06\u72b6\u6001\u5feb\u7167\u5199\u5165\u914d\u7f6e\u7684\u6587\u4ef6\u7cfb\u7edf\u548c\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u3002\u6700\u5c0f\u7684\u5143\u6570\u636e\u5b58\u50a8\u5728JobManager\u7684\u5185\u5b58\u4e2d(\u6216\u8005\u5728\u9ad8\u53ef\u7528\u6027\u6a21\u5f0f\u4e0b\u5b58\u50a8\u5728\u5143\u6570\u636e\u68c0\u67e5\u70b9\u4e2d)\u3002</p> <p>\u63a8\u8350\u7528\u4e8e\uff1a</p> <ul> <li>\u6240\u6709\u9ad8\u53ef\u7528\u6027\u8bbe\u7f6e\u3002</li> </ul>"},{"location":"distributed_computing/flink/checkpointing.html#state-backend","title":"State Backend","text":"<p>\u7528\u6570\u636e\u6d41API\u7f16\u5199\u7684\u7a0b\u5e8f\u901a\u5e38\u4ee5\u5404\u79cd\u5f62\u5f0f\u4fdd\u6301\u72b6\u6001:</p> <ul> <li>Windows\u6536\u96c6\u5143\u7d20\u6216\u805a\u5408\uff0c\u76f4\u5230\u5b83\u4eec\u88ab\u89e6\u53d1\uff1b</li> <li>\u8f6c\u6362\u51fd\u6570\u53ef\u4ee5\u4f7f\u7528\u952e/\u503c\u72b6\u6001\u63a5\u53e3\u6765\u5b58\u50a8\u503c\uff1b</li> <li>\u8f6c\u6362\u51fd\u6570\u53ef\u4ee5\u5b9e\u73b0CheckpointedFunction\u63a5\u53e3\uff0c\u4f7f\u5b83\u4eec\u7684\u5c40\u90e8\u53d8\u91cf\u5bb9\u9519\u3002</li> </ul> <p>\u5f53\u68c0\u67e5\u70b9\u88ab\u6fc0\u6d3b\u65f6\uff0c\u8fd9\u79cd\u72b6\u6001\u5c06\u5728\u68c0\u67e5\u70b9\u4e0a\u6301\u4e45\u5316\uff0c\u4ee5\u9632\u6b62\u6570\u636e\u4e22\u5931\u5e76\u4e00\u81f4\u5730\u6062\u590d\u3002\u72b6\u6001\u5728\u5185\u90e8\u662f\u5982\u4f55\u8868\u793a\u7684\uff0c\u4ee5\u53ca\u5b83\u5728\u68c0\u67e5\u70b9\u4e0a\u662f\u5982\u4f55\u4ee5\u53ca\u5728\u54ea\u91cc\u6301\u4e45\u5316\u7684\uff0c\u90fd\u53d6\u51b3\u4e8e\u6240\u9009\u62e9\u7684State Backend\u3002</p> <p>Flink\u5185\u7f6e\uff1a\u9ed8\u8ba4\u4e0d\u914d\u7f6e\u662f<code>HashMapStateBackend</code></p> <ul> <li>HashMapStateBackend</li> <li>EmbeddedRocksDBStateBackend</li> </ul>"},{"location":"distributed_computing/flink/checkpointing.html#hashmapbackend","title":"HashMapBackend","text":"<p>HashMapStateBackend\u5c06\u6570\u636e\u4f5c\u4e3aJava\u5806\u4e0a\u7684\u5bf9\u8c61\u5728\u5185\u90e8\u4fdd\u5b58\u3002\u952e/\u503c\u72b6\u6001\u548c\u7a97\u53e3\u64cd\u4f5c\u7b26\u4fdd\u5b58\u5b58\u50a8\u503c\u3001\u89e6\u53d1\u5668\u7b49\u7684\u54c8\u5e0c\u8868\u3002</p>"},{"location":"distributed_computing/flink/checkpointing.html#embeddedrocksdbstatebackend","title":"EmbeddedRocksDBStateBackend","text":""},{"location":"distributed_computing/flink/checkpointing.html#legacy","title":"Legacy","text":"<p>Flink 1.13\u5f00\u59cb\uff0c\u4ece\u6982\u5ff5\u4e0a\u672c\u5730<code>state storage</code>\u548c<code>checkpoint storage</code>\u5206\u5f00\uff0c\u4f46\u5b9e\u73b0\u4e0a\u6ca1\u6709\u533a\u522b\u3002</p> <p>MemoryStateBackend \u7b49\u4ef7\u4e8e HashMapBackend \u548c  JobManagerCheckpointStorage\uff1b</p> <p>FsStateBackend \u7b49\u4ef7\u4e8e HashMapBackend \u548c   FileSystemCheckpointStorage.\uff1b</p> <p>MemoryStateBackend \u7b49\u4ef7\u4e8e EmbeddedRocksDBStateBackend \u548c  JobManagerCheckpointStorage\uff1b</p>"},{"location":"distributed_computing/flink/checkpointing.html#jobtodo","title":"\u8fed\u4ee3Job\u7684\u72b6\u6001\u68c0\u67e5\u70b9\uff08TODO\uff09","text":""},{"location":"distributed_computing/flink/conf.html","title":"\u914d\u7f6e","text":""},{"location":"distributed_computing/flink/conf.html#jar","title":"\u4f9d\u8d56Jar\u5305\u63d0\u4ea4","text":"<p>run \u63d0\u4f9b -C \u8fd9\u4e2a\u9009\u9879\uff0c\u6765\u652f\u6301\u63d0\u4ea4classpath\uff1a</p> <ul> <li>\u6b64\u5904\u7684classpath\u7684url\u5fc5\u987b\u662f\u4e00\u4e2a\u80fd\u591f\u5728client\uff0cJM\u548cTM\u90fd\u88ab\u8bbf\u95ee\u5230\u7684\u4f4d\u7f6e\uff1b</li> <li>\u6b64\u4f4d\u7f6e\u4ececlient\u7aef\u7684\u63d0\u4ea4\u5230JM\u7684\u5206\u53d1\u5230TM\u7684\u8bbf\u95ee\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4f1a\u53d1\u751f\u6587\u4ef6\u79fb\u52a8\u7684\u52a8\u4f5c\uff1b</li> <li>url\u652f\u6301\u7684\u534f\u8bae\u5305\u62ecfile,ftp,gopher,http,https,jar,mailto,netdoc\uff0c\u4ea6\u5373java\u4e2dURL\u7c7b\u652f\u6301\u7684\u534f\u8bae\u7c7b\u578b\u3002\u6ce8\u610f\uff1a\u4e0d\u80fd\u653e\u5728hdfs\u4e0a\u3002</li> </ul> <p>\u6240\u4ee5\uff0c\u5982\u679c\u8981\u60f3\u4f7f\u7528-C\u8fd9\u4e2a\u9009\u9879\uff0c\u4e00\u822c\u6709\u4e24\u4e2a\u505a\u6cd5\uff1a</p> <ul> <li>\u624b\u52a8\u5c06classpath\u4e2d\u7684\u4f4d\u7f6e\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8fdb\u884c\u90e8\u7f72\u3002</li> <li>\u4f7f\u7528\u5171\u4eab\u5b58\u50a8\uff0c\u6b64\u5171\u4eab\u5b58\u50a8\u53ef\u4ee5\u88ab\u6240\u6709\u8282\u70b9\u7684\u89d2\u8272\u8bbf\u95ee\u3002</li> </ul> <p>fat jar\u7684\u65b9\u5f0f\uff0c\u901a\u8fc7 run \u7684 -j \u53c2\u6570</p>"},{"location":"distributed_computing/flink/conf.html#_2","title":"\u5185\u5b58","text":"<p>jobmanager.memory.process.size\uff1aJobManager (JobMaster / ResourceManager / Dispatcher) \u8fdb\u7a0b\u7684\u5185\u5b58\u5927\u5c0f\uff1b</p> <ul> <li>jobmanager.memory.heap.size</li> <li>jobmanager.memory.off-heap.size\uff1a\u9ed8\u8ba4128 mb</li> <li>jobmanager.memory.jvm-metaspace.size\uff1a\u9ed8\u8ba4256 mb</li> <li>jobmanager.memory.jvm-overhead.min\uff0cjobmanager.memory.jvm-overhead.max\uff0cjobmanager.memory.jvm-overhead.fraction\uff1a\u9ed8\u8ba4\uff0c\u6700\u5c0f192mb\uff0c\u6700\u59271gb\uff0c\u6bd4\u4f8b\u4e3a0.1\uff1b</li> </ul> <p></p> <p>taskmanager.memory.process.size\uff1aTaskManager\u8fdb\u7a0b\u7684\u5185\u5b58\u5927\u5c0f</p> <ul> <li>taskmanager.memory.framework.heap.size\uff1a\u9ed8\u8ba4128 mb\uff0c\u4e00\u822c\u4e0d\u7528\u52a8\uff1b</li> <li>taskmanager.memory.task.heap.size\uff1a run operators and user code</li> <li>taskmanager.memory.managed.size\uff1ataskmanager.memory.managed.fraction\uff1a\u9ed8\u8ba4Flink Memory\u76840.4</li> <li>\u6d41\u5f0f\u4f5c\u4e1a\u7684RocksDB state backend\uff1b</li> <li>\u4f5c\u4e1a\u7684sort\uff0chash tables \u548c \u4e2d\u95f4\u7ed3\u679c\u7684\u7f13\u5b58\uff1b</li> <li>Python\u8fdb\u7a0b\u4e2d\u6267\u884cUDF\uff1b</li> <li>taskmanager.memory.framework.off-heap.size\uff1aFlink framework\uff0c\u4e00\u822c\u4e0d\u7528\u52a8\uff1b</li> <li>taskmanager.memory.task.off-heap.size\uff1aFlink application to run operators\uff0c\u7528\u6237\u4ee3\u7801\u5206\u914d\u7684off-heap\u5185\u5b58\uff1b</li> <li>taskmanager.memory.network.min(64m), taskmanager.memory.network.max(1gb),taskmanager.memory.network.fraction(0.1)\uff1aTask\u5efa\u6570\u636e\u6fc0\u52b1\u4ea4\u6362\u7684\u4fdd\u7559\u7684direct memory\uff08\u5982\u7528\u4e8e\u7f51\u7edc\u4f20\u8f93\u7684buffer\uff09</li> </ul> <p></p>"},{"location":"distributed_computing/flink/conf.html#_3","title":"\u5e76\u884c\u5ea6","text":"<p>taskmanager.numberOfTaskSlots\uff1aTaskManager\u7684slot\u4e2a\u6570\uff08\u9ed8\u8ba4\u4e3a1\uff09\uff0cTaskManager\u4e2d\u6709\u591a\u4e2a\u69fd\u53ef\u4ee5\u5e2e\u52a9\u5206\u644a\u5e76\u884c\u4efb\u52a1\u6216\u7ba1\u9053\u4e2d\u67d0\u4e9b\u5e38\u91cf\u5f00\u9500\uff08JVM\u3001\u5e94\u7528\u7a0b\u5e8f\u5e93\u6216\u7f51\u7edc\u8fde\u63a5\uff09\uff0c\u7c7b\u4f3cSpark\u7684Executor\u7684\u6838\u6570\u3002</p> <p>parallelism.default</p>"},{"location":"distributed_computing/flink/conf.html#_4","title":"\u64cd\u4f5c\u94fe\u7684\u914d\u7f6e","text":"<p>https://ci.apache.org/projects/flink/flink-docs-release-1.13/docs/dev/datastream/operators/overview/#task-chaining-and-resource-groups</p>"},{"location":"distributed_computing/flink/connectors.html","title":"Table API Connector","text":""},{"location":"distributed_computing/flink/connectors.html#flink-113-connector","title":"Flink 1.13 \u652f\u6301\u7684Connector","text":"Name Version Source Sink Filesystem Bounded and Unbounded Scan, Lookup Streaming Sink, Batch Sink Elasticsearch 6.x &amp; 7.x Not supported Streaming Sink, Batch Sink Apache Kafka 0.10+ Unbounded Scan Streaming Sink, Batch Sink Amazon Kinesis Data Streams Unbounded Scan Streaming Sink JDBC Bounded Scan, Lookup Streaming Sink, Batch Sink Apache HBase 1.4.x &amp; 2.2.x Bounded Scan, Lookup Streaming Sink, Batch Sink Apache Hive Supported Versions Unbounded Scan, Bounded Scan, Lookup Streaming Sink, Batch Sink"},{"location":"distributed_computing/flink/connectors.html#kafka","title":"Kafka","text":""},{"location":"distributed_computing/flink/connectors.html#jdbc","title":"JDBC","text":""},{"location":"distributed_computing/flink/connectors.html#maven","title":"maven","text":"<pre><code>&lt;dependency&gt;\n  &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n  &lt;artifactId&gt;flink-connector-jdbc_2.11&lt;/artifactId&gt;\n  &lt;version&gt;1.13.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> Driver Group Id Artifact Id JAR MySQL <code>mysql</code> <code>mysql-connector-java</code> Download PostgreSQL <code>org.postgresql</code> <code>postgresql</code> Download Derby <code>org.apache.derby</code> <code>derby</code> Download"},{"location":"distributed_computing/flink/connectors.html#_1","title":"\u521b\u5efa\u8868","text":"<pre><code>- register a MySQL table 'users' in Flink SQL\nCREATE TABLE MyUserTable (\n  id BIGINT,\n  name STRING,\n  age INT,\n  status BOOLEAN,\n  PRIMARY KEY (id) NOT ENFORCED\n) WITH (\n   'connector' = 'jdbc',\n   'url' = 'jdbc:mysql://localhost:3306/mydatabase',\n   'table-name' = 'users',\n   'driver' = 'com.mysql.cj.jdbc.Driver',\n   'username' = 'root',\n   'password' = 'root'\n);\n\n-- write data into the JDBC table from the other table \"T\"\nINSERT INTO MyUserTable\nSELECT id, name, age, status FROM T;\n\n-- scan data from the JDBC table\nSELECT id, name, age, status FROM MyUserTable;\n\n-- temporal join the JDBC table as a dimension table\nSELECT * FROM myTopic\nLEFT JOIN MyUserTable FOR SYSTEM_TIME AS OF myTopic.proctime\nON myTopic.key = MyUserTable.id;\n</code></pre>"},{"location":"distributed_computing/flink/connectors.html#sink","title":"Sink","text":"Option Required Default Type Description sink.buffer-flush.max-rows optional 100 Integer flush\u524d\u7684\u6700\u5927\u7f13\u51b2\u6570\u636e\u91cf\uff0c0\u8868\u793a\u7981\u7528\u3002 sink.buffer-flush.interval optional 1s Duration flush\u95f4\u9694\uff0c\u5f02\u6b65\u7ebf\u7a0b\u5237\u5199\u6570\u636e\uff0c0\u8868\u793a\u7981\u7528\u3002 <code>'sink.buffer-flush.max-rows'</code>\u8bbe\u7f6e\u4e3a0\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b64\u5237\u5199\u65f6\u95f4\u505a\u5f02\u6b65\u6570\u636e\u5237\u5199\u3002 sink.max-retries optional 3 Integer \u5199\u6570\u636e\u5e93\u5931\u8d25\u7684\u6700\u5927\u5c1d\u8bd5\u6b21\u6570\u3002 sink.parallelism optional (none) Integer Defines the parallelism of the JDBC sink operator. By default, the parallelism is determined by the framework using the same parallelism of the upstream chained operator. <p>\u4f7f\u7528upsert\u8bed\u4e49\u8fdb\u884c\u63d2\u5165\uff0c\u901a\u8fc7\u4e3b\u952e\u63d0\u4f9b\u5e42\u7b49\u6027\u3002</p> <p>\u5982\u679c\u51fa\u73b0\u5931\u8d25\uff0cFlink\u4f5c\u4e1a\u5c06\u4ece\u6700\u540e\u4e00\u4e2a\u6210\u529f\u7684\u68c0\u67e5\u70b9\u6062\u590d\u5e76\u91cd\u65b0\u5904\u7406\uff0c\u8fd9\u53ef\u80fd\u5bfc\u81f4\u5728\u6062\u590d\u671f\u95f4\u91cd\u65b0\u5904\u7406\u6d88\u606f\u3002\u5f3a\u70c8\u63a8\u8350\u4f7f\u7528upsert\u6a21\u5f0f\uff0c\u56e0\u4e3a\u5982\u679c\u9700\u8981\u91cd\u65b0\u5904\u7406\u8bb0\u5f55\uff0c\u5b83\u6709\u52a9\u4e8e\u907f\u514d\u8fdd\u53cd\u7ea6\u675f\u6216\u91cd\u590d\u6570\u636e\u3002</p>"},{"location":"distributed_computing/flink/connectors.html#lookup-cache","title":"Lookup Cache","text":"<p>JDBC \u8fde\u63a5\u53ef\u4ee5\u4f5c\u4e3a\u4e34\u65f6\u7684join\u8868\u6570\u636e\u6e90\uff08\u4f8b\u5982\u7ef4\u5ea6\u8868\uff09\uff0c\u5f53\u524d\u53ea\u652f\u6301\u540c\u6b65\u67e5\u627e\u6a21\u5f0f\u3002</p> Option Required Default Type Description lookup.cache.max-rows optional (none) Integer \u67e5\u627ecache\u7684\u6700\u5927\u884c\u6570\uff0c\u8d85\u8fc7\u540e\uff0c\u6700\u65e7\u7684\u4e00\u884c\u4f1a\u8fc7\u671f\u3002\u9ed8\u8ba4\u7981\u7528 lookup.cache.ttl optional (none) Duration cache\u4e2d\u6bcf\u884c\u7684ttl\u5b58\u6d3b\u65f6\u95f4\uff0c\u8d85\u65f6\u540e\uff0c\u6700\u65e7\u7684\u6570\u636e\u8fc7\u671f\u3002\u9ed8\u8ba4\u7981\u7528\u3002 lookup.max-retries optional 3 Integer \u6570\u636e\u5e93\u67e5\u627e\u5931\u8d25\u7684\u91cd\u8bd5\u6b21\u6570"},{"location":"distributed_computing/flink/connectors.html#postgres-database-as-a-catalogtodo","title":"Postgres Database as a Catalog\uff08TODO\uff09","text":""},{"location":"distributed_computing/flink/connectors.html#_2","title":"\u6570\u636e\u7c7b\u578b\u6620\u5c04","text":"MySQL type PostgreSQL type Flink SQL type <code>TINYINT</code> <code>TINYINT</code> <code>SMALLINT</code> <code>TINYINT UNSIGNED</code> <code>SMALLINT</code> <code>INT2</code> <code>SMALLSERIAL</code> <code>SERIAL2</code> <code>SMALLINT</code> <code>INT</code> <code>MEDIUMINT</code> <code>SMALLINT UNSIGNED</code> <code>INTEGER</code> <code>SERIAL</code> <code>INT</code> <code>BIGINT</code> <code>INT UNSIGNED</code> <code>BIGINT</code> <code>BIGSERIAL</code> <code>BIGINT</code> <code>BIGINT UNSIGNED</code> <code>DECIMAL(20, 0)</code> <code>BIGINT</code> <code>BIGINT</code> <code>BIGINT</code> <code>FLOAT</code> <code>REAL</code> <code>FLOAT4</code> <code>FLOAT</code> <code>DOUBLE</code> <code>DOUBLE PRECISION</code> <code>FLOAT8</code> <code>DOUBLE PRECISION</code> <code>DOUBLE</code> <code>NUMERIC(p, s)</code> <code>DECIMAL(p, s)</code> <code>NUMERIC(p, s)</code> <code>DECIMAL(p, s)</code> <code>DECIMAL(p, s)</code> <code>BOOLEAN</code> <code>TINYINT(1)</code> <code>BOOLEAN</code> <code>BOOLEAN</code> <code>DATE</code> <code>DATE</code> <code>DATE</code> <code>TIME [(p)]</code> <code>TIME [(p)] [WITHOUT TIMEZONE]</code> <code>TIME [(p)] [WITHOUT TIMEZONE]</code> <code>DATETIME [(p)]</code> <code>TIMESTAMP [(p)] [WITHOUT TIMEZONE]</code> <code>TIMESTAMP [(p)] [WITHOUT TIMEZONE]</code> <code>CHAR(n)</code> <code>VARCHAR(n)</code> <code>TEXT</code> <code>CHAR(n)</code> <code>CHARACTER(n)</code> <code>VARCHAR(n)</code> <code>CHARACTER VARYING(n)</code> <code>TEXT</code> <code>STRING</code> <code>BINARY</code> <code>VARBINARY</code> <code>BLOB</code> <code>BYTEA</code> <code>BYTES</code> <code>ARRAY</code> <code>ARRAY</code>"},{"location":"distributed_computing/flink/connectors.html#datagen","title":"DataGen\uff08\u6570\u636e\u751f\u6210\uff09","text":""},{"location":"distributed_computing/flink/connectors.html#print","title":"Print\uff08\u63a7\u5236\u53f0\u6253\u5370\uff09","text":""},{"location":"distributed_computing/flink/deployment.html","title":"Deploy","text":""},{"location":"distributed_computing/flink/deployment.html#_1","title":"\u90e8\u7f72\u6a21\u5f0f","text":"<p>\u4e09\u79cd\u90e8\u7f72\u6a21\u5f0f\uff1a</p> <ul> <li>Application Mode\uff1a\u8d44\u6e90\u9694\u79bb\uff0c\u591a\u4e2ajob\u7ec4\u6210\u4e00\u4e2aapplication\u8fd0\u884c\u5728\u540c\u4e00\u4e2a\u96c6\u7fa4\u4e0a\uff0c\u6bd4\u5982\u5982\u679cmain()\u65b9\u6cd5\u6709\u591a\u4e2aexecute()\uff0c\u8fd9\u4e9b\u4f5c\u4e1a\u5c06\u89c6\u4e3a\u540c\u4e00\u4e2a\u5e94\u7528\uff0c\u8fd0\u884c\u5728\u540c\u4e00\u96c6\u7fa4\u4e2d\u3002</li> <li> <p>main()\u65b9\u6cd5\u5728\u96c6\u7fa4\u4e0a\uff08JobManager\uff09\u6267\u884c\u800c\u4e0d\u662f\u5ba2\u6237\u7aef</p> </li> <li> <p>A Per-Job Mode\uff08deprecated\uff09\uff1a\u4e3a\u6bcf\u4e2a\u63d0\u4ea4\u7684\u4f5c\u4e1a\u542f\u52a8\u4e00\u4e2a\u96c6\u7fa4\uff0c\u8be5\u96c6\u7fa4\u4ec5\u53ef\u7528\u4e8e\u8be5\u4f5c\u4e1a\uff0c\u4e00\u65e6\u4f5c\u4e1a\u5b8c\u6210\u96c6\u7fa4\u5c06\u4f1a\u91ca\u653e\u3002\u4f5c\u4e1a\u4e4b\u95f4\u4e92\u4e0d\u5f71\u54cd\u3002</p> </li> <li>main()\u65b9\u6cd5\u5728client\u4fa7\u6267\u884c</li> <li> <p><code>bin/flink run -t yarn-per-job -c main\u65b9\u6cd5\u7684\u7c7b\u8def\u5f84 jar\u5305\u5730\u5740</code></p> </li> <li> <p>Session Mode\uff1a\u542f\u52a8\u4e00\u4e2a\u957f\u671f\u8fd0\u884c\u7684\u96c6\u7fa4\uff0c\u8be5\u96c6\u7fa4\u53ef\u4ee5\u63a5\u6536\u591a\u4e2a\u4f5c\u4e1a\u7684\u63d0\u4ea4\uff0c\u5373\u4f7f\u6240\u6709\u4f5c\u4e1a\u5b8c\u6210\u540e\uff0c\u96c6\u7fa4\u4ecd\u7136\u7ee7\u7eed\u8fd0\u884c\u76f4\u5230\u624b\u52a8\u505c\u6b62\u3002</p> </li> <li>main()\u65b9\u6cd5\u5728client\u6267\u884c\uff1b</li> <li>\u540c\u4e00\u4e2a TaskManager \u4e0a\u53ef\u80fd\u8fd0\u884c\u5f88\u591a\u4f5c\u4e1a\uff0c\u5982\u679c\u5176\u4e2d\u4e00\u4e2a\u53d1\u751f\u6545\u969c\u5bfc\u81f4 TaskManager \u5b95\u673a\uff0c\u5728\u8fd9\u4e2a\u4e0a\u7684\u6240\u6709\u4f5c\u4e1a\u90fd\u4f1a\u53d7\u5230\u5f71\u54cd\uff1b</li> <li>\u9002\u5408\u4e8e\u5355\u4e2a\u89c4\u6a21\u5c0f\u3001\u6267\u884c\u65f6\u95f4\u77ed\u7684\u5927\u91cf\u4f5c\u4e1a\u3002</li> </ul> <p></p> <p>\u5bf9\u6bd4Spark\uff1a</p> <ul> <li>Applicatoin Mode \u7c7b\u4f3c Spark\u7684 cluster \u6a21\u5f0f\uff1b</li> <li>Per-Job Mode \u662f\u6bcf\u4e2a job \u4e00\u4e2a\u96c6\u7fa4\u8fd0\u884c\uff08\u4e00\u4e2aAPP\u4e2d\u5305\u542b\u591a\u4e2a job\uff0c\u5373\u591a\u4e2a execute \u51fd\u6570\uff09\uff1b</li> <li>Session Mode \u5728 Yarn\u4e0a\u4f7f\u7528Spark \u7684Standalone\u6a21\u5f0f\uff0c\u4f46\u662f\u5728Yarn\u4e0aSpark\u6ca1\u6709Session\u6a21\u5f0f\uff1b</li> </ul>"},{"location":"distributed_computing/flink/deployment.html#yarn","title":"Yarn","text":"<p>For production use, we recommend deploying Flink Applications in the Per-job or Application Mode.</p>"},{"location":"distributed_computing/flink/deployment.html#application-mode","title":"Application Mode","text":"<pre><code>./bin/flink run-application -t yarn-application ./examples/streaming/TopSpeedWindowing.jar\n</code></pre>"},{"location":"distributed_computing/flink/deployment.html#flink-session","title":"Flink Session","text":"<p>\u542f\u52a8 Flink \u96c6\u7fa4\uff1a</p> <pre><code>bin/yarn-session.sh -jm 1024 -tm 1024 -s 1 -nm flink-session -d\n</code></pre> <ul> <li><code>-nm</code>\u914d\u7f6eappmaster\u8fdb\u7a0b\u7684\u540d\u5b57\uff1b</li> </ul> <p>\u63d0\u4ea4\u4f5c\u4e1a\u5230 Flink \u96c6\u7fa4\u8fd0\u884c\uff1a</p> <pre><code>./bin/flink run -d -m yarn-cluster ./examples/batch/WordCount.jar\n</code></pre> <p>Session \u6a21\u5f0f\u5177\u4f53\u7684\u5de5\u4f5c\u6d41\u7a0b\uff1a</p> <ul> <li>\u7528\u6237\u4f7f\u7528Flink run\u547d\u4ee4\u6267\u884c\u7a0b\u5e8f\u65f6\uff0c\u7a0b\u5e8f\u4f1a\u88ab\u7f16\u8bd1\u6210jobgraph\uff0c\u63d0\u4ea4\u5230AppMaster</li> <li> <p>Slot\u8d44\u6e90\u901a\u8fc7 AppMaster \u5185\u90e8\u7684 ResourceManager \u8ddfYarn\u8fdb\u884c\u901a\u4fe1\uff0c\u7533\u8bf7 TM</p> </li> <li> <p>TM\u4e0eJobManager\u5185\u90e8\u7684SlotPool\u901a\u4fe1\uff0c\u534f\u8c03task\u7684\u5206\u53d1\u6267\u884c</p> </li> </ul> <p></p> <p>\u8981\u4f7f\u5f97flink\u8fd0\u884c\u4e8eyarn\u4e0a\uff0cflink\u8981\u80fd\u627e\u5230hadoop\u914d\u7f6e\uff0c\u56e0\u4e3a\u8981\u8fde\u63a5\u5230yarn\u7684resourcemanager\u548chdfs\u3002\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u7b56\u7565\u6765\u6307\u5b9ahadoop\u914d\u7f6e\uff1a</p> <ul> <li>\u67e5\u770b<code>YARN_CONF_DIR</code>\uff0c<code>HADOOP_CONF_DIR</code>\u6216\u8005<code>HADOOP_CONF_PATH</code>\u662f\u5426\u8bbe\u7f6e\uff0c\u6309\u7167\u987a\u5e8f\u68c0\u67e5\u7684\u3002\u7136\u540e\uff0c\u5047\u5982\u914d\u7f6e\u4e86\u5c31\u4f1a\u4ece\u8be5\u6587\u4ef6\u5939\u4e0b\u8bfb\u53d6\u914d\u7f6e\u3002</li> <li>\u5982\u679c\u4e0a\u9762\u73af\u5883\u53d8\u91cf\u90fd\u6ca1\u914d\u7f6e\uff0c\u4f7f\u7528<code>HADOOP_HOME</code>\u73af\u5883\u53d8\u91cf\uff0c\u914d\u7f6e\u8def\u5f84\u662f<code>$HADOOP_HOME/etc/hadoop;</code></li> </ul>"},{"location":"distributed_computing/flink/deployment.html#faq","title":"FAQ","text":"<p>\u5f02\u5e381\uff1aThe number of requested virtual cores per node 20 exceeds the maximum number of virtual cores 8 available in the Yarn Cluster. Please note that the number of virtual cores is set to the number of task slots by default unless configured in the Flink config with 'yarn.containers.vcores.'</p> <p>\u5f02\u5e382\uff1aCould not build the program from JAR file.</p> <p>\u539f\u56e0\u5206\u6790\uff1a</p> <p>flink1.8\u6ca1\u6709\u5305\u62echadoop\u76f8\u5173\u7684\u5305\u3002</p> <p>\u89e3\u51b3\u529e\u6cd5\uff1a</p> <p>\u5b98\u7f51\u4e0b\u8f7dflink-shaded-hadoop-2-uber-2.8.3-9.0.jar\uff0c\u653e\u5230flink_home/lib\u76ee\u5f55\u4e0b</p>"},{"location":"distributed_computing/flink/dynamic_table.html","title":"\u52a8\u6001\u8868","text":"<p>\u5c06SQL\u548cTable\u7684API\u8f6c\u4e3a\u6d41\u5904\u7406\uff0c\u5141\u8bb8Flink\u5728\u65e0\u754c\u6d41\u4e0a\u5b9e\u73b0\u76f8\u540c\u7684\u8bed\u4e49\u3002</p>"},{"location":"distributed_computing/flink/dynamic_table.html#_2","title":"\u6570\u636e\u6d41\u4e0a\u7684\u5173\u7cfb\u67e5\u8be2","text":"\u5173\u7cfb\u4ee3\u6570 / SQL \u6d41\u5904\u7406 \u5173\u7cfb\uff08\u6216\u8868\uff09\u662f\u6709\u754c\uff08\u591a\uff09\u5143\u7ec4\u96c6\u3002 \u6d41\u662f\u65e0\u9650\u7684\u5143\u7ec4\u5e8f\u5217\u3002 \u5bf9\u6279\u5904\u7406\u6570\u636e\uff08\u4f8b\u5982\uff0c\u5173\u7cfb\u6570\u636e\u5e93\u4e2d\u7684\u8868\uff09\u6267\u884c\u7684\u67e5\u8be2\u53ef\u4ee5\u8bbf\u95ee\u5b8c\u6574\u7684\u8f93\u5165\u6570\u636e\u3002 \u6d41\u5f0f\u67e5\u8be2\u5728\u542f\u52a8\u65f6\u65e0\u6cd5\u8bbf\u95ee\u6240\u6709\u6570\u636e\uff0c\u5e76\u4e14\u5fc5\u987b\u201c\u7b49\u5f85\u201d\u6570\u636e\u6d41\u5165\u3002 \u6279\u5904\u7406\u67e5\u8be2\u5728\u751f\u6210\u56fa\u5b9a\u5927\u5c0f\u7684\u7ed3\u679c\u540e\u7ec8\u6b62\u3002 \u6d41\u67e5\u8be2\u6839\u636e\u63a5\u6536\u5230\u7684\u8bb0\u5f55\u4e0d\u65ad\u66f4\u65b0\u5176\u7ed3\u679c\uff0c\u5e76\u4e14\u6c38\u8fdc\u4e0d\u4f1a\u5b8c\u6210\u3002 <p>A materialized view is defined as a SQL query caching the query result.</p> <p>Eager View Maintenance is a technique to update a materialized view as soon as its base tables are updated.</p> <p>eager view maintenance and SQL queries on streams\uff1a</p> <ul> <li>\u6d41\u4e0a<code>INSERT</code>\uff0c<code>UPDATE</code>\u548c<code>DELETE</code>DML\u8bed\u53e5\u6784\u6210\u7684\u6570\u636e\u5e93\u8868\u7ed3\u679c\uff0c\u88ab\u79f0\u4e3a<code>changelog stream</code>\uff1b</li> <li>\u7269\u5316\u89c6\u56fe\u5b9a\u4e49\u4e3a SQL \u67e5\u8be2\u3002\u8981\u66f4\u65b0\u89c6\u56fe\uff0c\u67e5\u8be2\u5fc5\u987b\u6301\u7eed\u5904\u7406\u89c6\u56fe\u57fa\u672c\u5173\u7cfb\u7684\u53d8\u66f4\u65e5\u5fd7\u6d41\uff1b</li> <li>\u7269\u5316\u89c6\u56fe\u662f\u6d41\u5f0f SQL \u67e5\u8be2\u7684\u7ed3\u679c\u3002</li> </ul>"},{"location":"distributed_computing/flink/dynamic_table.html#_3","title":"\u52a8\u6001\u8868\u548c\u6301\u7eed\u67e5\u8be2","text":"<p>\u52a8\u6001\u8868\u662f Flink \u7684 Table API \u548c SQL \u652f\u6301\u6d41\u5f0f\u6570\u636e\u7684\u6838\u5fc3\u6982\u5ff5\uff0c\u968f\u65f6\u95f4\u800c\u53d8\u5316\u3002</p> <ul> <li>\u67e5\u8be2\u65f6\uff0c\u52a8\u6001\u8868\u4f1a\u4ea7\u751f\u4e00\u4e2a\u8fde\u7eed\u67e5\u8be2\uff0c\u67e5\u8be2\u4e0d\u4f1a\u7ec8\u6b62\uff0c\u4ea7\u751f\u52a8\u6001\u7ed3\u679c\uff08\u53e6\u4e00\u5f20\u52a8\u6001\u8868\uff09\uff1b</li> <li>\u67e5\u8be2\u4e0d\u65ad\u66f4\u65b0\u5176\uff08\u52a8\u6001\uff09\u7ed3\u679c\u8868\u4ee5\u53cd\u6620\u5176\uff08\u52a8\u6001\uff09\u8f93\u5165\u8868\u7684\u53d8\u5316\uff1b</li> <li>\u8fde\u7eed\u67e5\u8be2\u8f93\u51fa\u5728\u8bed\u4e49\u4e0a\u59cb\u7ec8\u7b49\u540c\u4e8e\u5728\u8f93\u5165\u8868\u7684\u5feb\u7167\u4e0a\u4ee5\u6279\u5904\u7406\u6a21\u5f0f\u6267\u884c\u7684\u540c\u4e00\u67e5\u8be2\u7684\u7ed3\u679c\u3002</li> </ul> <p>\u4e0b\u56fe\u5f62\u8c61\u5316\u4e86\u6d41\u3001\u52a8\u6001\u8868\u3001\u8fde\u7eed\u67e5\u8be2\u7684\u5173\u7cfb\uff1a</p> <p></p> <ol> <li>\u6d41\u88ab\u8f6c\u6362\u4e3a\u52a8\u6001\u8868\u3002</li> <li>\u5728\u52a8\u6001\u8868\u4e0a\u8bc4\u4f30\u8fde\u7eed\u67e5\u8be2\uff0c\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u52a8\u6001\u8868\u3002</li> <li>\u751f\u6210\u7684\u52a8\u6001\u8868\u88ab\u8f6c\u6362\u56de\u6d41\u3002</li> </ol>"},{"location":"distributed_computing/flink/dynamic_table.html#_4","title":"\u6d41\u4e0a\u7684\u8868\u5b9a\u4e49","text":""},{"location":"distributed_computing/flink/dynamic_table.html#update-and-append-queries","title":"Update and Append Queries","text":"<p>\u67e5\u8be2\u662f\u751f\u6210\u4ec5\u9644\u52a0\u8868\u8fd8\u662f\u66f4\u65b0\u8868\u6709\u4e00\u4e9b\u542b\u4e49\uff1a</p> <ul> <li>\u8fdb\u884c\u66f4\u65b0\u66f4\u6539\u7684\u67e5\u8be2\u901a\u5e38\u5fc5\u987b\u7ef4\u62a4\u66f4\u591a\u72b6\u6001\uff1b</li> <li>\u8ffd\u52a0\u8868\u5230\u6d41\u7684\u8f6c\u6362\u4e0e\u66f4\u65b0\u8868\u7684\u8f6c\u6362\u4e0d\u540c\u3002</li> </ul>"},{"location":"distributed_computing/flink/dynamic_table.html#query-restrictions","title":"Query Restrictions","text":"<p>\u8bb8\u591a\uff08\u4f46\u4e0d\u662f\u5168\u90e8\uff09\u8bed\u4e49\u4e0a\u6709\u6548\u7684\u67e5\u8be2\u53ef\u4ee5\u8bc4\u4f30\u4e3a\u5bf9\u6d41\u7684\u8fde\u7eed\u67e5\u8be2\u3002\u4e00\u4e9b\u67e5\u8be2\u7684\u8ba1\u7b97\u6210\u672c\u592a\u9ad8\uff0c1\uff09\u56e0\u4e3a\u5b83\u4eec\u9700\u8981\u7ef4\u62a4\u7684\u72b6\u6001\u5927\u5c0f\uff0c2\uff09\u56e0\u4e3a\u8ba1\u7b97\u66f4\u65b0\u592a\u6602\u8d35\u3002</p> <ul> <li>\u72b6\u6001\u5927\u5c0f\uff1a\u8fde\u7eed\u67e5\u8be2\u5904\u7406\u7684\u6570\u636e\u603b\u91cf\u53ef\u80fd\u975e\u5e38\u5927\uff0c\u9700\u8981\u66f4\u65b0\u5148\u524d\u53d1\u51fa\u7684\u7ed3\u679c\u7684\u67e5\u8be2\u9700\u8981\u7ef4\u62a4\u6240\u6709\u53d1\u51fa\u7684\u884c\u4ee5\u66f4\u65b0\u5b83\u4eec\uff1b</li> </ul> <pre><code># \u968f\u7740\u7528\u6237\u91cf\u7684\u589e\u957f\uff0c\u603b\u884c\u6570\u4f1a\u8d8a\u6765\u8d8a\u591a\nSELECT user, COUNT(url)\nFROM clicks\nGROUP BY user;\n</code></pre> <ul> <li>\u8ba1\u7b97\u66f4\u65b0\uff1a\u4e00\u4e9b\u67e5\u8be2\u9700\u8981\u91cd\u65b0\u8ba1\u7b97\u548c\u66f4\u65b0\u5927\u90e8\u5206\u53d1\u51fa\u7684\u7ed3\u679c\u884c</li> </ul> <pre><code># \u57fa\u4e8e\u6700\u540e\u7684\u70b9\u51fb\u65f6\u95f4\uff0c\u8fdb\u884c\u6392\u540d\nSELECT user, RANK() OVER (ORDER BY lastAction)\nFROM (\n  SELECT user, MAX(cTime) AS lastAction FROM clicks GROUP BY user\n);\n</code></pre>"},{"location":"distributed_computing/flink/dynamic_table.html#_5","title":"\u8868\u5230\u6d41\u8f6c\u6362","text":"<p>\u52a8\u6001\u8868\u53ef\u4ee5\u50cf\u666e\u901a\u6570\u636e\u5e93\u8868\u4e00\u6837\uff0c\u901a\u8fc7INSERT\u3001UPDATE\u548cDELETE\u66f4\u6539\u4e0d\u65ad\u4fee\u6539\u3002\u5b83\u53ef\u80fd\u662f\u4e00\u4e2a\u53ea\u6709\u4e00\u884c\u4e14\u4e0d\u65ad\u66f4\u65b0\u7684\u8868\uff0c\u4e5f\u53ef\u80fd\u662f\u4e00\u4e2a\u6ca1\u6709UPDATE\u548cDELETE\u4fee\u6539\u7684\u4ec5\u63d2\u5165\u8868\uff0c\u6216\u8005\u4ecb\u4e8e\u4e24\u8005\u4e4b\u95f4\u7684\u4efb\u4f55\u8868\u3002</p> <p>\u5f53\u5c06\u52a8\u6001\u8868\u8f6c\u6362\u4e3a\u6d41\u6216\u5c06\u5176\u5199\u5165\u5916\u90e8\u7cfb\u7edf\u65f6\uff0c\u9700\u8981\u5bf9\u8fd9\u4e9b\u66f4\u6539\u8fdb\u884c\u7f16\u7801\u3002Flink\u7684Table API\u548cSQL\u652f\u6301\u4e09\u79cd\u65b9\u5f0f\u6765\u7f16\u7801\u52a8\u6001\u8868\u7684\u53d8\u5316\uff1a</p> <ul> <li>Append-only stream\uff08\u8ffd\u52a0\u6d41\uff09\uff1a\u4ec5\u7531INSERT\u66f4\u6539\u4fee\u6539\u7684\u52a8\u6001\u8868\u53ef\u4ee5\u901a\u8fc7\u53d1\u51fa\u63d2\u5165\u7684\u884c\u8f6c\u6362\u4e3a\u6d41\u3002</li> <li>Retract stream\uff08\u64a4\u56de\u6d41\uff09\uff1a\u5177\u6709\u4e24\u79cd\u7c7b\u578b\u6d88\u606f\u7684\u6d41\uff0c\u5373\u6dfb\u52a0\u6d88\u606f\u548c\u64a4\u56de\u6d88\u606f\u3002\u901a\u8fc7\u5c06INSERT\u66f4\u6539\u7f16\u7801\u4e3a\u6dfb\u52a0\u6d88\u606f\u3001DELETE\u66f4\u6539\u7f16\u7801\u4e3a\u64a4\u9500\u6d88\u606f\u3001UPDATE\u66f4\u6539\u7f16\u7801\u4e3a\u5df2\u66f4\u65b0(\u524d\u4e00\u4e2a)\u884c\u7684\u64a4\u9500\u6d88\u606f\u4ee5\u53ca\u66f4\u65b0(\u65b0)\u884c\u7684\u9644\u52a0\u6d88\u606f\uff0c\u52a8\u6001\u8868\u88ab\u8f6c\u6362\u4e3a\u64a4\u9500\u6d41\u3002\u4e0b\u56fe\u663e\u793a\u4e86\u5c06\u52a8\u6001\u8868\u8f6c\u6362\u4e3a\u7f29\u56de\u6d41\u7684\u8fc7\u7a0b\u3002</li> </ul> <p></p> <ul> <li>Upsert stream\uff08\uff09\uff1a\u5177\u6709\u4e24\u79cd\u7c7b\u578b\u6d88\u606f\u7684\u6d41\uff0cupsert\u6d88\u606f\u548cdelete\u6d88\u606f\u3002\u8f6c\u6362\u4e3aupsert\u6d41\u7684\u52a8\u6001\u8868\u9700\u8981\u4e00\u4e2a(\u53ef\u80fd\u662f\u590d\u5408\u7684)\u552f\u4e00\u952e\u3002\u5177\u6709\u552f\u4e00\u952e\u7684\u52a8\u6001\u8868\u901a\u8fc7\u5c06INSERT\u548cUPDATE\u66f4\u6539\u7f16\u7801\u4e3aupsert\u6d88\u606f\uff0c\u5c06DELETE\u66f4\u6539\u7f16\u7801\u4e3aDELETE\u6d88\u606f\uff0c\u4ece\u800c\u8f6c\u6362\u4e3a\u6d41\u3002\u4e0e\u56de\u9000\u6d41\u7684\u4e3b\u8981\u533a\u522b\u662fUPDATE\u66f4\u6539\u4f7f\u7528\u5355\u4e2a\u6d88\u606f\u7f16\u7801\uff0c\u56e0\u6b64\u6548\u7387\u66f4\u9ad8\u3002</li> </ul> <p></p> <p>\u5c06\u52a8\u6001\u8868\u8f6c\u6362\u4e3aDataStream\u65f6\uff0c\u53ea\u652f\u6301\u8ffd\u52a0\u548c\u6536\u56de\u6d41\u3002</p>"},{"location":"distributed_computing/flink/dynamic_table.html#_6","title":"\u67e5\u8be2\u914d\u7f6e","text":"<p>\u4f46\u662f\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u8fde\u7eed\u7684\u67e5\u8be2\uff0c\u60a8\u5fc5\u987b\u9650\u5236\u5b83\u4eec\u6240\u7ef4\u62a4\u7684\u72b6\u6001\u7684\u5927\u5c0f\uff0c\u4ee5\u907f\u514d\u5728\u63a5\u6536\u65e0\u8fb9\u754c\u7684\u8f93\u5165\u6d41\u65f6\u8017\u5c3d\u5b58\u50a8\u7a7a\u95f4\u3002\u5b83\u53d6\u51b3\u4e8e\u8f93\u5165\u6570\u636e\u548c\u67e5\u8be2\u672c\u8eab\u7684\u7279\u5f81\uff0c\u662f\u5426\u9700\u8981\u9650\u5236\u72b6\u6001\u5927\u5c0f\uff0c\u4ee5\u53ca\u5b83\u662f\u5426\u4ee5\u53ca\u5982\u4f55\u5f71\u54cd\u8ba1\u7b97\u7ed3\u679c\u7684\u51c6\u786e\u6027\u3002</p> <p>Flink\u7684Table API\u548cSQL\u63a5\u53e3\u63d0\u4f9b\u53c2\u6570\u6765\u8c03\u4f18\u8fde\u7eed\u67e5\u8be2\u7684\u51c6\u786e\u6027\u548c\u8d44\u6e90\u6d88\u8017\u3002\u8fd9\u4e9b\u53c2\u6570\u662f\u901a\u8fc7<code>TableConfig</code>\u5bf9\u8c61\u6307\u5b9a\u7684\uff0c\u8be5\u5bf9\u8c61\u53ef\u4ee5\u4ece<code>TableEnvironment</code>\u4e2d\u83b7\u5f97\u3002</p> <pre><code>StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\nStreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);\n\n// obtain query configuration from TableEnvironment\nTableConfig tConfig = tableEnv.getConfig();\n// set query parameters\ntConfig.setIdleStateRetentionTime(Time.hours(12), Time.hours(24));\n\n// define query\nTable result = ...\n\n// create TableSink\nTableSink&lt;Row&gt; sink = ...\n\n// register TableSink\ntableEnv.registerTableSink(\n  \"outputTable\",               // table name\n  new String[]{...},           // field names\n  new TypeInformation[]{...},  // field types\n  sink);                       // table sink\n\n// emit result Table via a TableSink\nresult.executeInsert(\"outputTable\");\n\n// convert result Table into a DataStream&lt;Row&gt;\nDataStream&lt;Row&gt; stream = tableEnv.toAppendStream(result, Row.class);\n</code></pre>"},{"location":"distributed_computing/flink/dynamic_table.html#_7","title":"\u7a7a\u95f2\u72b6\u6001\u4fdd\u6301\u65f6\u95f4","text":"<p>\u8bb8\u591a\u67e5\u8be2\u5728\u4e00\u4e2a\u6216\u591a\u4e2a\u952e\u5c5e\u6027\u4e0a\u805a\u5408\u6216\u8054\u63a5\u8bb0\u5f55\u3002\u5f53\u5728\u6d41\u4e0a\u6267\u884c\u8fd9\u6837\u7684\u67e5\u8be2\u65f6\uff0c\u8fde\u7eed\u67e5\u8be2\u9700\u8981\u6536\u96c6\u8bb0\u5f55\u6216\u7ef4\u62a4\u6bcf\u4e2a\u952e\u7684\u90e8\u5206\u7ed3\u679c\u3002\u5982\u679c\u8f93\u5165\u6d41\u7684\u952e\u57df\u662f\u4e0d\u65ad\u53d8\u5316\u7684\uff0c\u5373\u6d3b\u52a8\u952e\u503c\u662f\u968f\u65f6\u95f4\u53d8\u5316\u7684\uff0c\u90a3\u4e48\u968f\u7740\u89c2\u5bdf\u5230\u8d8a\u6765\u8d8a\u591a\u4e0d\u540c\u7684\u952e\uff0c\u8fde\u7eed\u67e5\u8be2\u5c06\u79ef\u7d2f\u8d8a\u6765\u8d8a\u591a\u7684\u72b6\u6001\u3002\u7136\u800c\uff0c\u952e\u901a\u5e38\u5728\u4e00\u6bb5\u65f6\u95f4\u540e\u53d8\u4e3a\u975e\u6d3b\u52a8\u7684\uff0c\u5b83\u4eec\u76f8\u5e94\u7684\u72b6\u6001\u53d8\u5f97\u9648\u65e7\u548c\u65e0\u7528\u3002</p> <p>Idle State Retention Time\u53c2\u6570\u5b9a\u4e49\u5728\u5220\u9664\u952e\u4e4b\u524d\uff0c\u952e\u7684\u72b6\u6001\u5728\u4e0d\u66f4\u65b0\u7684\u60c5\u51b5\u4e0b\u4fdd\u7559\u591a\u957f\u65f6\u95f4\u3002</p> <p>\u901a\u8fc7\u5220\u9664\u952e\u7684\u72b6\u6001\uff0c\u8fde\u7eed\u67e5\u8be2\u5b8c\u5168\u5fd8\u8bb0\u5b83\u4ee5\u524d\u89c1\u8fc7\u8fd9\u4e2a\u952e\u3002\u5982\u679c\u5904\u7406\u4e00\u4e2a\u5177\u6709\u952e\u7684\u8bb0\u5f55(\u5176\u72b6\u6001\u4e4b\u524d\u5df2\u88ab\u5220\u9664)\uff0c\u5219\u8be5\u8bb0\u5f55\u5c06\u88ab\u89c6\u4e3a\u5177\u6709\u76f8\u5e94\u952e\u7684\u7b2c\u4e00\u4e2a\u8bb0\u5f55\u3002</p> <p>\u6709\u4e24\u4e2a\u53c2\u6570\u53ef\u4ee5\u914d\u7f6e\u7a7a\u95f2\u72b6\u6001\u4fdd\u7559\u65f6\u95f4\uff1a</p> <ul> <li>\u6700\u5c0f\u7a7a\u95f2\u72b6\u6001\u4fdd\u7559\u65f6\u95f4\u5b9a\u4e49\u4e86\u5728\u5220\u9664\u975e\u6d3b\u52a8\u952e\u4e4b\u524d\uff0c\u8be5\u952e\u7684\u72b6\u6001\u81f3\u5c11\u4fdd\u7559\u4e86\u591a\u957f\u65f6\u95f4\uff1b</li> <li>\u6700\u5927\u7a7a\u95f2\u72b6\u6001\u4fdd\u7559\u65f6\u95f4\u5b9a\u4e49\u4e86\u5728\u5220\u9664\u975e\u6d3b\u52a8\u952e\u4e4b\u524d\uff0c\u5176\u72b6\u6001\u6700\u591a\u4fdd\u7559\u591a\u957f\u65f6\u95f4\uff1b</li> </ul> <p>\u6e05\u7406\u72b6\u6001\u9700\u8981\u989d\u5916\u7684\u7c3f\u8bb0\uff0c\u5bf9\u4e8eminTime\u548cmaxTime\u7684\u8f83\u5927\u5dee\u5f02\uff0c\u7c3f\u8bb0\u7684\u6210\u672c\u4f1a\u66f4\u4f4e\u3002\u201cminTime\u201d\u4e0e\u201cmaxTime\u201d\u7684\u65f6\u95f4\u5dee\u81f3\u5c11\u4e3a5\u5206\u949f\u3002</p>"},{"location":"distributed_computing/flink/flink.html","title":"Flink","text":"<p>Apache Flink - Stateful Computations over Data Stream</p> <p></p> <p>\u57fa\u4e8e\u64cd\u4f5c\u7b26\uff08Operator\uff09\u7684\u8fde\u7eed\u6d41\u6a21\u578b\uff0c\u53ef\u4ee5\u505a\u5230\u5fae\u79d2\u7ea7\u522b\u7684\u5ef6\u8fdf\u3002</p> <ul> <li>\u6279\u6d41\u4e00\u4f53\u5316\uff1b</li> <li>\u7cbe\u5bc6\u7684\u72b6\u6001\u7ba1\u7406\uff1b</li> <li>\u4e8b\u4ef6\u65f6\u95f4\u652f\u6301\uff1b</li> <li>\u7cbe\u786e\u4e00\u6b21\u7684\u72b6\u6001\u4e00\u81f4\u6027\u4fdd\u969c\uff1b</li> </ul>"},{"location":"distributed_computing/flink/flink.html#_1","title":"\u67b6\u6784","text":"<p>\u7531<code>JobManger</code>\u548c<code>TaskManager</code>\u7ec4\u6210\u3002</p> <p></p>"},{"location":"distributed_computing/flink/flink.html#client","title":"Client","text":"<p>Client\u4e0d\u662f\u8fd0\u884c\u65f6\u548c\u7a0b\u5e8f\u6267\u884c\u7684\u4e00\u90e8\u5206\uff0c\u800c\u662f\u7528\u4e8e\u51c6\u5907\u6570\u636e\u6d41\u5e76\u5c06\u6570\u636e\u6d41\u53d1\u9001\u5230JobManager\u3002\u5728\u6b64\u4e4b\u540e\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u65ad\u5f00\u8fde\u63a5(Detached \u6a21\u5f0f)\uff0c\u6216\u8005\u4fdd\u6301\u8fde\u63a5\u4ee5\u63a5\u6536\u8fdb\u5ea6\u62a5\u544a(Attached \u6a21\u5f0f)\u3002</p>"},{"location":"distributed_computing/flink/flink.html#jobmanager","title":"JobManager","text":"<p>JobManager\uff08\u7c7b\u4f3cSpark Driver\uff09\u6709\u8bb8\u591a\u4e0e\u534f\u8c03Flink\u5e94\u7528\u7a0b\u5e8f\u7684\u5206\u5e03\u5f0f\u6267\u884c\u76f8\u5173\u7684\u804c\u8d23:\u5b83\u51b3\u5b9a\u4ec0\u4e48\u65f6\u5019\u5b89\u6392\u4e0b\u4e00\u4e2a\u4efb\u52a1(\u6216\u4e00\u7ec4\u4efb\u52a1)\uff0c\u5bf9\u5b8c\u6210\u7684\u4efb\u52a1\u6216\u6267\u884c\u5931\u8d25\u4f5c\u51fa\u53cd\u5e94\uff0c\u534f\u8c03\u68c0\u67e5\u70b9\uff0c\u534f\u8c03\u6545\u969c\u6062\u590d\u7b49\u7b49\u3002\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1a</p> <ul> <li>ResourceManager\uff1aResourceManager\u8d1f\u8d23Flink\u96c6\u7fa4\u4e2d\u7684\u8d44\u6e90\u5206\u914d\u548c\u53d1\u653e\uff0c\u7ba1\u7406slot\uff08\u8d44\u6e90\u8c03\u5ea6\u7684\u5355\u5143\uff09\uff0c\u5bf9Yarn\u3001K8s\u3001Standalone\u90fd\u63d0\u4f9b\u4e0d\u540c\u7684\u5b9e\u73b0\u3002\u5728Standalone\u6a21\u5f0f\u4e0b\uff0cResourceManager\u53ea\u80fd\u5206\u53d1\u53ef\u7528\u7684TaskManager\u7684slots\uff0c\u4e0d\u80fd\u81ea\u5df1\u542f\u52a8\u65b0\u7684TaskManager\u3002</li> <li>Dispatcher\uff1a\u63d0\u4f9b\u4e86\u4e00\u4e2aREST\u63a5\u53e3\u6765\u63d0\u4ea4Flink\u5e94\u7528\u7a0b\u5e8f\u4ee5\u4f9b\u6267\u884c\uff0c\u5e76\u4e3a\u6bcf\u4e2a\u63d0\u4ea4\u7684\u4f5c\u4e1a\u542f\u52a8\u4e00\u4e2a\u65b0\u7684JobMaster\u3002\u5b83\u8fd8\u8fd0\u884cFlink web\u6765\u63d0\u4f9b\u5173\u4e8e\u4f5c\u4e1a\u6267\u884c\u7684\u4fe1\u606f\u3002</li> <li>JobMaster\uff1aJobMaster\u8d1f\u8d23\u7ba1\u7406\u5355\u4e2aJobGraph\u7684\u6267\u884c\u3002\u591a\u4e2a\u4f5c\u4e1a\u53ef\u4ee5\u5728\u4e00\u4e2aFlink\u96c6\u7fa4\u4e2d\u540c\u65f6\u8fd0\u884c\uff0c\u6bcf\u4e2a\u4f5c\u4e1a\u90fd\u6709\u81ea\u5df1\u7684JobMaster\u3002</li> </ul> <p>JobManager\u53ef\u4ee5\u8fdb\u884c\u9ad8\u53ef\u7528\u914d\u7f6e\u3002</p>"},{"location":"distributed_computing/flink/flink.html#taskmanagers","title":"TaskManagers","text":"<p>TaskManagers(\u4e5f\u79f0\u4e3aworkers)\u6267\u884c\u6570\u636e\u6d41\u7684\u4efb\u52a1\uff0c\u5e76\u7f13\u51b2\u548c\u4ea4\u6362\u6570\u636e\u6d41\u3002</p> <p>\u5fc5\u987b\u59cb\u7ec8\u81f3\u5c11\u6709\u4e00\u4e2aTaskManager\u3002TaskManager\u4e2d\u6700\u5c0f\u7684\u8d44\u6e90\u8c03\u5ea6\u5355\u4f4d\u662f\u4efb\u52a1\u69fd\u4f4d\u3002TaskManager\u7684\u4efb\u52a1\u69fd\u4f4d\u6570\u8868\u793a\u5e76\u53d1\u5904\u7406\u7684\u4efb\u52a1\u6570\u3002</p> <p>\u6ce8\u610f\uff0c\u591a\u4e2a\u64cd\u4f5c\u7b26\u53ef\u4ee5\u5728\u4e00\u4e2a\u4efb\u52a1\u69fd\u4e2d\u6267\u884c\u3002</p>"},{"location":"distributed_computing/flink/flink.html#_2","title":"\u5e76\u884c\u7b56\u7565","text":""},{"location":"distributed_computing/flink/flink.html#_3","title":"\u5e76\u884c\u5ea6","text":"<p>\u4e00\u4e2a\u7279\u5b9a operator \u7684 subtask \u7684\u4e2a\u6570\u88ab\u79f0\u4e4b\u4e3a\u5176 parallelism(\u5e76\u884c\u5ea6)\uff1a</p> <ul> <li>\u4e00\u4e2astream\u7684\u5e76\u884c\u5ea6\u603b\u662f\u7b49\u540c\u4e8e\u5176producing operator\u7684\u5e76\u884c\u5ea6\uff1b</li> <li>\u4e00\u4e2a\u7a0b\u5e8f\u4e2d\uff0c\u4e0d\u540c\u7684operator\u53ef\u80fd\u5177\u6709\u4e0d\u540c\u7684\u5e76\u884c\u5ea6\u3002</li> </ul>"},{"location":"distributed_computing/flink/flink.html#_4","title":"\u4efb\u52a1\u548c\u64cd\u4f5c","text":"<p>\u5bf9\u4e8e\u5206\u5e03\u5f0f\u6267\u884c\uff0cFlink\u5c06\u64cd\u4f5c\u5b50\u4efb\u52a1\u94fe\u6210\u4efb\u52a1\uff08 chains operator subtasks together into tasks\uff09\u3002</p> <p>\u6bcf\u4e2aTask\u7531\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\uff0c\u5c06\u64cd\u4f5c\u7b26\u94fe\u63a5\u5230\u4efb\u52a1\u4e2d\u662f\u4e00\u79cd\u6709\u7528\u7684\u4f18\u5316\uff1a</p> <ul> <li>\u5c06\u4e00\u4e2athread\u5bf9\u5e94\u4e00\u4e2asubtask\u4f18\u5316\u4e3a\u4e00\u4e2athread\u5bf9\u5e94\u4e00\u4e2asubtask-chain\u4e2d\u7684\u591a\u4e2asubtask\uff1b</li> <li>\u5b83\u51cf\u5c11\u4e86\u7ebf\u7a0b\u5230\u7ebf\u7a0b\u5207\u6362\u548c\u7f13\u51b2\u7684\u5f00\u9500\uff0c\u5e76\u5728\u964d\u4f4e\u5ef6\u8fdf\u7684\u540c\u65f6\u589e\u52a0\u4e86\u603b\u4f53\u541e\u5410\u91cf\u3002</li> </ul> <p>\u4e0b\u56fe\u4e2d\u7684\u6837\u4f8b\u6570\u636e\u6d41\u4f7f\u7528\u4e94\u4e2a\u5b50\u4efb\u52a1\u6267\u884c\uff0c\u56e0\u6b64\u4f7f\u7528\u4e94\u4e2a\u5e76\u884c\u7ebf\u7a0b\u3002</p> <ul> <li>Source/map \u5e76\u884c\u5ea62\uff08\u88ab\u5408\u5e76\uff09\uff0c KeyBy \u5e76\u884c\u5ea62\uff0c Sink \u5e76\u884c\u5ea61\uff1b</li> </ul> <p></p>"},{"location":"distributed_computing/flink/flink.html#_5","title":"\u4efb\u52a1\u69fd\u548c\u69fd\u5171\u4eab","text":"<p>\u9ed8\u8ba4\u6240\u6709 task \u90fd\u5728\u540c\u4e00\u4e2a\u69fd\u4e2d\uff08default\uff09</p> <p>\u6bcf\u4e2aworker (TaskManager)\u662f\u4e00\u4e2aJVM\u8fdb\u7a0b\uff0c\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u7ebf\u7a0b\u4e2d\u6267\u884c\u4e00\u4e2a\u6216\u591a\u4e2a\u5b50\u4efb\u52a1\uff0c\u80fd\u63a5\u53d7\u7684\u4efb\u52a1\u6570\u91cf\u7531<code>task slots</code>\u51b3\u5b9a\u3002</p> <p>\u6bcf\u4e2a\u4efb\u52a1\u69fd\u4ee3\u8868TaskManager\u8d44\u6e90\u7684\u4e00\u4e2a\u56fa\u5b9a\u5b50\u96c6\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u6709\u4e09\u4e2a\u69fd\u7684TaskManager\u4f1a\u5c06\u5176\u6258\u7ba1\u5185\u5b58\u76841/3\u5206\u914d\u7ed9\u6bcf\u4e2a\u69fd\u3002\u5bf9\u8d44\u6e90\u8fdb\u884c\u63d2\u69fd\u610f\u5473\u7740\u5b50\u4efb\u52a1\u4e0d\u4f1a\u4e0e\u5176\u4ed6\u4f5c\u4e1a\u7684\u5b50\u4efb\u52a1\u7ade\u4e89\u6258\u7ba1\u5185\u5b58\uff0c\u800c\u662f\u62e5\u6709\u4e00\u5b9a\u6570\u91cf\u7684\u9884\u7559\u6258\u7ba1\u5185\u5b58\u3002\u6ce8\u610f\u8fd9\u91cc\u6ca1\u6709CPU\u9694\u79bb\uff1b\u76ee\u524d\uff0c\u69fd\u53ea\u5206\u79bb\u4efb\u52a1\u7684\u6258\u7ba1\u5185\u5b58\u3002</p> <p>\u901a\u8fc7\u8c03\u6574\u4efb\u52a1\u69fd\u4f4d\u6570\uff0c\u7528\u6237\u53ef\u4ee5\u5b9a\u4e49\u5b50\u4efb\u52a1\u4e4b\u95f4\u7684\u9694\u79bb\u65b9\u5f0f\u3002\u6bcf\u4e2aTaskManager\u6709\u4e00\u4e2a\u69fd\u610f\u5473\u7740\u6bcf\u4e2a\u4efb\u52a1\u7ec4\u5728\u5355\u72ec\u7684JVM\u4e2d\u8fd0\u884c(\u4f8b\u5982\uff0c\u53ef\u4ee5\u5728\u5355\u72ec\u7684\u5bb9\u5668\u4e2d\u542f\u52a8)\u3002\u62e5\u6709\u591a\u4e2a\u63d2\u69fd\u610f\u5473\u7740\u66f4\u591a\u7684\u5b50\u4efb\u52a1\u5171\u4eab\u540c\u4e00\u4e2aJVM\u3002\u540c\u4e00\u4e2aJVM\u4e2d\u7684\u4efb\u52a1\u5171\u4eabTCP\u8fde\u63a5(\u901a\u8fc7\u591a\u8def\u590d\u7528)\u548c\u5fc3\u8df3\u6d88\u606f\u3002\u5b83\u4eec\u8fd8\u53ef\u4ee5\u5171\u4eab\u6570\u636e\u96c6\u548c\u6570\u636e\u7ed3\u6784\uff0c\u4ece\u800c\u51cf\u5c11\u6bcf\u4e2a\u4efb\u52a1\u7684\u5f00\u9500\u3002</p> <p></p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cFlink\u5141\u8bb8\u5b50\u4efb\u52a1\u5171\u4eab\u69fd\u4f4d\uff0c\u5373\u4f7f\u5b83\u4eec\u662f\u4e0d\u540c\u4efb\u52a1\u7684\u5b50\u4efb\u52a1\uff0c\u53ea\u8981\u5b83\u4eec\u6765\u81ea\u540c\u4e00\u4f5c\u4e1a\u3002\u7ed3\u679c\u662f\u4e00\u4e2a\u69fd\u53ef\u80fd\u5bb9\u7eb3\u6574\u4e2a\u4f5c\u4e1a\u7ba1\u9053\u3002\u5141\u8bb8\u8fd9\u79cd\u63d2\u69fd\u5171\u4eab\u6709\u4e24\u4e2a\u4e3b\u8981\u597d\u5904\uff1a</p> <ul> <li>Flink\u96c6\u7fa4\u9700\u8981\u7684\u4efb\u52a1\u69fd\u6570\u91cf\u4e0e\u4f5c\u4e1a\u4e2d\u4f7f\u7528\u7684\u6700\u9ad8\u5e76\u884c\u5ea6\u5b8c\u5168\u76f8\u540c\u3002\u4e0d\u9700\u8981\u8ba1\u7b97\u4e00\u4e2a\u7a0b\u5e8f\u603b\u5171\u5305\u542b\u591a\u5c11\u4efb\u52a1(\u5e76\u884c\u5ea6\u4e0d\u540c)\u3002</li> <li>\u540c\u4e00\u4e2aslot \u53ef\u4ee5\u8fd0\u884c\u6574\u4e2a job \u7684\u6d41\u6c34\u7ebf\uff0c\u66f4\u597d\u7684\u8d44\u6e90\u5229\u7528\u3002</li> <li>\u5982\u679c\u6ca1\u6709\u63d2\u69fd\u5171\u4eab\uff0c\u975e\u5bc6\u96c6\u578bsource/map()\u5b50\u4efb\u52a1\u5c06\u963b\u585e\u4e0e\u8d44\u6e90\u5bc6\u96c6\u578bwindow\u5b50\u4efb\u52a1\u4e00\u6837\u591a\u7684\u8d44\u6e90\u3002\u4f7f\u7528\u69fd\u5171\u4eab\uff0c\u5c06\u793a\u4f8b\u4e2d\u7684\u57fa\u672c\u5e76\u884c\u5ea6\u4ece2\u589e\u52a0\u52306\uff0c\u53ef\u4ee5\u5145\u5206\u5229\u7528\u69fd\u8d44\u6e90\uff0c\u540c\u65f6\u786e\u4fdd\u7e41\u91cd\u7684\u5b50\u4efb\u52a1\u516c\u5e73\u5730\u5206\u5e03\u5728taskmanager\u4e2d\u3002</li> </ul> <p></p> <p>\u4e0d\u540coperator \u7684 subtask \u662f\u542f\u52a8\u591a\u7ebf\u7a0b\u5e76\u7b49\u5f85\uff1f</p>"},{"location":"distributed_computing/flink/flink.html#_6","title":"\u6570\u636e\u4f20\u8f93","text":""},{"location":"distributed_computing/flink/flink.html#subtask","title":"\u540c\u4e00\u4e2aSubTask","text":"<p>\u5f53\u5904\u4e8e\u4e0a\u4e0b\u6e38\u7684\u4e24\u4e2a\u7b97\u5b50\u5904\u4e8e\u540c\u4e00\u4e2a\u7b97\u5b50\u94fe\u4e2d(OperatorChain)\uff0c\u5728\u6267\u884c\u7684\u65f6\u5019\u5c31\u4f1a\u88ab\u8c03\u5ea6\u81f3\u540c\u4e00\u4e2aSubTask\u4e2d\u3002</p> <ul> <li>\u6570\u636e\u4f20\u8f93\u662f\u76f4\u63a5\u901a\u8fc7Java\u7684\u65b9\u6cd5\u8c03\u7528\u5b9e\u73b0\uff0c\u4e0d\u9700\u8981\u6570\u636e\u5e8f\u5217\u5316\uff0c\u8282\u7701\u4e86\u7ebf\u7a0b\u5207\u6362\u7684\u5f00\u9500</li> </ul>"},{"location":"distributed_computing/flink/flink.html#taskmanagersubtask","title":"\u540c\u4e00\u4e2aTaskManager\u7684\u4e0d\u540cSubTask","text":"<p>\u540c\u4e00\u4e2aTaskManager\uff08JVM\u8fdb\u7a0b\uff09\u5185\u90e8\u7684\u4e0d\u540cSubTask\uff08\u7ebf\u7a0b\uff09\u4e4b\u95f4\u7684\u6d41\u6570\u636e\u4f20\u8f93\u3002\u4e24\u4e2aSubTask\u4e4b\u95f4\u5171\u4eab\u540c\u4e00\u4e2aBuffer Pool\uff0c\u901a\u8fc7<code>wait/notifyAll</code>\u6765\u540c\u6b65\uff0cInputGate\u8d1f\u8d23\u8bfb\u53d6Buffer\u3002</p>"},{"location":"distributed_computing/flink/flink.html#taskmanagersubtask_1","title":"\u4e0d\u540cTaskManager\u4e4b\u95f4\u7684SubTask","text":"<p>\u91c7\u7528Netty\u6846\u67b6\uff0c\u901a\u8fc7Socket\u4f20\u9012\uff0c\u4e5f\u5b58\u5728\u6570\u636e\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u8fc7\u7a0b\u3002</p>"},{"location":"distributed_computing/flink/flink.html#_7","title":"\u5e94\u7528\u6267\u884c","text":"<p>Flink\u5e94\u7528\u7a0b\u5e8f\u7684\u4f5c\u4e1a\u53ef\u4ee5\u63d0\u4ea4\u7ed9\u957f\u65f6\u95f4\u8fd0\u884c\u7684Flink\u4f1a\u8bdd\u96c6\u7fa4\u3001\u4e13\u7528\u7684Flink\u4f5c\u4e1a\u96c6\u7fa4\u6216Flink\u5e94\u7528\u7a0b\u5e8f\u96c6\u7fa4\uff08\u53c2\u89c1\u90e8\u7f72\u6a21\u5f0f\uff09\u3002\u8fd9\u4e9b\u9009\u9879\u4e4b\u95f4\u7684\u533a\u522b\u4e3b\u8981\u4e0e\u96c6\u7fa4\u7684\u751f\u547d\u5468\u671f\u548c\u8d44\u6e90\u9694\u79bb\u4fdd\u8bc1\u6709\u5173\u3002</p>"},{"location":"distributed_computing/flink/flink.html#flink-session-cluster","title":"Flink Session Cluster","text":"<ul> <li>\u96c6\u7fa4\u751f\u547d\u5468\u671f\uff1a\u5728Flink\u4f1a\u8bdd\u96c6\u7fa4\u4e2d\uff0c\u5ba2\u6237\u7aef\u8fde\u63a5\u5230\u4e00\u4e2a\u9884\u5148\u5b58\u5728\u7684\u3001\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u96c6\u7fa4\uff0c\u8be5\u96c6\u7fa4\u53ef\u4ee5\u63a5\u53d7\u591a\u4e2a\u4f5c\u4e1a\u63d0\u4ea4\u3002\u5373\u4f7f\u5728\u6240\u6709\u4f5c\u4e1a\u5b8c\u6210\u540e\uff0c\u96c6\u7fa4(\u548cJobManager)\u4ecd\u5c06\u7ee7\u7eed\u8fd0\u884c\uff0c\u76f4\u5230\u624b\u52a8\u505c\u6b62\u4f1a\u8bdd\u3002\u56e0\u6b64\uff0cFlink Session Cluster\u7684\u751f\u5b58\u671f\u4e0d\u4e0e\u4efb\u4f55Flink Job\u7684\u751f\u5b58\u671f\u7ed1\u5b9a\u3002</li> <li>\u8d44\u6e90\u9694\u79bb\uff1aTaskManager\u69fd\u4f4d\u5728\u4f5c\u4e1a\u63d0\u4ea4\u65f6\u7531ResourceManager\u5206\u914d\uff0c\u4f5c\u4e1a\u5b8c\u6210\u540e\u91ca\u653e\u3002\u56e0\u4e3a\u6240\u6709\u4f5c\u4e1a\u90fd\u5171\u4eab\u540c\u4e00\u4e2a\u96c6\u7fa4\uff0c\u6240\u4ee5\u5728\u63d0\u4ea4\u4f5c\u4e1a\u9636\u6bb5\u5b58\u5728\u4e00\u4e9b\u5bf9\u96c6\u7fa4\u8d44\u6e90\u7684\u7ade\u4e89\u2014\u2014\u6bd4\u5982\u7f51\u7edc\u5e26\u5bbd\u3002\u8fd9\u79cd\u5171\u4eab\u8bbe\u7f6e\u7684\u4e00\u4e2a\u9650\u5236\u662f\uff0c\u5982\u679c\u4e00\u4e2aTaskManager\u5d29\u6e83\u4e86\uff0c\u90a3\u4e48\u6240\u6709\u5728\u8fd9\u4e2aTaskManager\u4e0a\u8fd0\u884c\u7684\u4efb\u52a1\u90fd\u4f1a\u5931\u8d25\uff1b\u7c7b\u4f3c\uff0c\u5982\u679cJobManager\u4e0a\u53d1\u751f\u4e00\u4e9b\u81f4\u547d\u9519\u8bef\uff0c\u5b83\u5c06\u5f71\u54cd\u96c6\u7fa4\u4e2d\u8fd0\u884c\u7684\u6240\u6709\u4f5c\u4e1a\u3002</li> <li>\u5176\u4ed6\u8003\u8651\uff1a\u4f7f\u7528\u9884\u5148\u5b58\u5728\u7684\u96c6\u7fa4\u53ef\u4ee5\u8282\u7701\u5927\u91cf\u7533\u8bf7\u8d44\u6e90\u548c\u542f\u52a8taskmanager\u7684\u65f6\u95f4\u3002\u5f53\u4f5c\u4e1a\u7684\u6267\u884c\u65f6\u95f4\u975e\u5e38\u77ed\uff0c\u800c\u9ad8\u542f\u52a8\u65f6\u95f4\u4f1a\u5bf9\u7aef\u5230\u7aef\u7528\u6237\u4f53\u9a8c\u4ea7\u751f\u8d1f\u9762\u5f71\u54cd\u65f6\uff0c\u8fd9\u4e00\u70b9\u975e\u5e38\u91cd\u8981\u2014\u2014\u5c31\u50cf\u77ed\u67e5\u8be2\u7684\u4ea4\u4e92\u5206\u6790\u90a3\u6837\uff0c\u4f5c\u4e1a\u53ef\u4ee5\u4f7f\u7528\u73b0\u6709\u8d44\u6e90\u5feb\u901f\u6267\u884c\u8ba1\u7b97\u3002</li> </ul>"},{"location":"distributed_computing/flink/flink.html#flink-job-clusterdeprecated","title":"Flink Job Cluster(deprecated)","text":"<ul> <li>\u96c6\u7fa4\u751f\u547d\u5468\u671f\uff1a\u5728Flink\u4f5c\u4e1a\u96c6\u7fa4\u4e2d\uff0c\u53ef\u7528\u7684\u96c6\u7fa4\u7ba1\u7406\u5668(\u5982YARN)\u7528\u4e8e\u4e3a\u6bcf\u4e2a\u63d0\u4ea4\u7684\u4f5c\u4e1a\u542f\u52a8\u96c6\u7fa4\uff0c\u8be5\u96c6\u7fa4\u4ec5\u5bf9\u8be5\u4f5c\u4e1a\u53ef\u7528\u3002\u5728\u8fd9\u91cc\uff0c\u5ba2\u6237\u7aef\u9996\u5148\u4ece\u96c6\u7fa4\u7ba1\u7406\u5668\u8bf7\u6c42\u8d44\u6e90\u4ee5\u542f\u52a8JobManager\uff0c\u5e76\u5c06\u4f5c\u4e1a\u63d0\u4ea4\u7ed9\u8fd0\u884c\u5728\u6b64\u8fdb\u7a0b\u4e2d\u7684Dispatcher\u3002\u7136\u540e\u6839\u636e\u4f5c\u4e1a\u7684\u8d44\u6e90\u9700\u6c42\u60f0\u6027\u5730\u5206\u914d\u4efb\u52a1\u7ba1\u7406\u5668\u3002\u4e00\u65e6\u4f5c\u4e1a\u5b8c\u6210\uff0cFlink\u4f5c\u4e1a\u96c6\u7fa4\u5c31\u4f1a\u88ab\u62c6\u9664\u3002</li> <li>\u8d44\u6e90\u9694\u79bb\uff1aJobManager\u4e2d\u7684\u81f4\u547d\u9519\u8bef\u53ea\u5f71\u54cd\u5728\u8be5Flink\u4f5c\u4e1a\u96c6\u7fa4\u4e2d\u8fd0\u884c\u7684\u4e00\u4e2a\u4f5c\u4e1a\u3002</li> <li>\u5176\u4ed6\u8003\u8651\uff1a\u56e0\u4e3aResourceManager\u7533\u8bf7\u5e76\u7b49\u5f85\u5916\u90e8\u8d44\u6e90\u7ba1\u7406\u7ec4\u4ef6\u542f\u52a8TaskManager\u8fdb\u7a0b\u548c\u5206\u914d\u8d44\u6e90\uff0clink\u4f5c\u4e1a\u96c6\u7fa4\u66f4\u9002\u5408\u957f\u671f\u8fd0\u884c\u3001\u9ad8\u7a33\u5b9a\u6027\u8981\u6c42\u3001\u542f\u52a8\u5ef6\u8fdf\u4e0d\u654f\u611f\u7684\u4f5c\u4e1a\u3002</li> </ul>"},{"location":"distributed_computing/flink/flink.html#flink-application-cluster","title":"Flink Application Cluster","text":"<ul> <li> <p>\u96c6\u7fa4\u751f\u547d\u5468\u671f\uff1a\u4e00\u4e2aFlink\u5e94\u7528\u7a0b\u5e8f\u96c6\u7fa4\u662f\u4e00\u4e2a\u4e13\u7528\u7684Flink\u96c6\u7fa4\uff0c\u5b83\u53ea\u6267\u884c\u6765\u81ea\u4e00\u4e2aFlink\u5e94\u7528\u7a0b\u5e8f\u7684\u4efb\u52a1\uff0c\u5176\u4e2dmain()\u65b9\u6cd5\u8fd0\u884c\u5728\u96c6\u7fa4\u800c\u4e0d\u662f\u5ba2\u6237\u7aef\u4e0a\u3002\u5c06\u5e94\u7528\u7a0b\u5e8f\u903b\u8f91\u548c\u4f9d\u8d56\u6253\u5305\u5230\u4e00\u4e2a\u53ef\u6267\u884c\u7684\u4f5c\u4e1aJAR\u4e2d\uff0c\u5e76\u4e14\u96c6\u7fa4\u5165\u53e3\u70b9\uff08ApplicationClusterEntryPoint\uff09\u8d1f\u8d23\u8c03\u7528main()\u65b9\u6cd5\u6765\u63d0\u53d6JobGraph\u3002\u4f8b\u5982\uff0c\u8fd9\u5141\u8bb8\u60a8\u50cf\u5728Kubernetes\u4e0a\u90e8\u7f72\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u4e00\u6837\u90e8\u7f72Flink\u5e94\u7528\u7a0b\u5e8f\u3002Flink\u5e94\u7528\u7a0b\u5e8f\u96c6\u7fa4\u7684\u751f\u547d\u5468\u671f\u4e0eFlink\u5e94\u7528\u7a0b\u5e8f\u7684\u751f\u547d\u5468\u671f\u7ed1\u5b9a\u5728\u4e00\u8d77\u3002</p> </li> <li> <p>\u8d44\u6e90\u9694\u79bb\uff1a\u5728\u4e00\u4e2aFlink\u5e94\u7528\u7a0b\u5e8f\u96c6\u7fa4\u4e2d\uff0cResourceManager\u548cDispatcher\u88ab\u9650\u5b9a\u4e3a\u4e00\u4e2aFlink\u5e94\u7528\u7a0b\u5e8f\uff0c\u8fd9\u63d0\u4f9b\u4e86\u6bd4Flink\u4f1a\u8bdd\u96c6\u7fa4\u66f4\u597d\u7684\u5173\u6ce8\u70b9\u5206\u79bb\u3002</p> </li> </ul>"},{"location":"distributed_computing/flink/flink_action.html","title":"Flink \u5b9e\u6218","text":"<ul> <li>\uff1f\uff1f\u901a\u8fc7 watermark \u5904\u7406\u6570\u636e\u5206\u533a\u7684\u8fdb\u5ea6\u53bb\u4e0b\u53d1\u4e00\u6761\u4e8b\u4ef6\u9a71\u52a8\u7684\u6d88\u606f\u62c9\u8d77\u4e0b\u4e00\u4e2a\u79bb\u7ebf\u6216\u8005\u5b9e\u65f6\u7684\u4f5c\u4e1a\uff1f\uff1f</li> </ul>"},{"location":"distributed_computing/flink/flink_action.html#flinkbilibiliai","title":"Flink\u5728bilibili\u5927\u6570\u636e\u4e0eAI\u65b9\u5411\u7684\u63a2\u7d22\u4e0e\u5b9e\u8df5","text":""},{"location":"distributed_computing/flink/flink_action.html#_1","title":"\u6574\u4f53\u94fe\u8def","text":"<ul> <li>ConfigBroadcast \u7684\u6a21\u5757\u6765\u89e3\u51b3\u7ba1\u9053\u5143\u6570\u636e\u5b9e\u65f6\u66f4\u65b0\u3001\u70ed\u52a0\u8f7d\u7684\u95ee\u9898\uff1b</li> <li>\u6bcf\u5206\u949f\u4f1a\u8fdb\u884c\u4e00\u6b21 checkpoint\uff0c\u9488\u5bf9\u589e\u91cf\u7684\u5b9e\u9645\u6570\u636e\u8fdb\u884c Append\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u63d0\u4f9b\u5206\u949f\u7ea7\u7684\u67e5\u8be2\u3002</li> </ul>"},{"location":"distributed_computing/flink/flink_action.html#_2","title":"\u5206\u533a\u611f\u5e94","text":"<ul> <li>\u9996\u5148\u5728 Source \u4f1a\u57fa\u4e8e\u6d88\u606f\u5f53\u4e2d\u7684 Eventime \u6765\u751f\u6210 Watermark\uff0cWatermark \u4f1a\u7ecf\u8fc7\u6bcf\u4e00\u5c42\u7684\u5904\u7406\u4f20\u9012\u5230 Sink\uff0c\u6700\u540e\u4f1a\u901a\u8fc7 Commiter \u6a21\u5757\uff0c\u4ee5\u5355\u7ebf\u7a0b\u7684\u65b9\u5f0f\u6765\u6c47\u603b\u6240\u6709 Watermark \u6d88\u606f\u7684\u8fdb\u5ea6\uff1b</li> <li>\u5f53Commiter\u6a21\u5757\u53d1\u73b0\u5168\u5c40 Watermark \u5df2\u7ecf\u63a8\u8fdb\u5230\u4e0b\u4e2a\u5c0f\u65f6\u7684\u5206\u533a\u7684\u65f6\u5019\uff0c\u5b83\u4f1a\u4e0b\u53d1\u4e00\u6761\u6d88\u606f\u5230 Hive MetaStore\uff0c\u6765\u901a\u77e5\u4e0a\u5c0f\u65f6\u5206\u533a\u6570\u636e ready\uff0c\u4ece\u800c\u53ef\u4ee5\u8ba9\u4e0b\u6e38\u7684\u8c03\u5ea6\u53ef\u4ee5\u66f4\u5feb\u7684\u901a\u8fc7\u6d88\u606f\u9a71\u52a8\u7684\u65b9\u5f0f\u6765\u62c9\u8d77\u4f5c\u4e1a\u7684\u8fd0\u884c\u3002</li> </ul>"},{"location":"distributed_computing/flink/flink_action.html#cdc","title":"CDC\u7ba1\u9053","text":"<ul> <li>\u6d41\u6279\u4f5c\u4e1a\u8054\u52a8</li> <li>\u9996\u5148\u662f\u901a\u8fc7 Datax \u5c06 MySQL \u7684\u6570\u636e\u5168\u91cf\u4e00\u6b21\u6027\u540c\u6b65\u5230\u7684 HDFS\uff1b</li> <li>\u901a\u8fc7 spark \u7684 job\uff0c\u5c06\u6570\u636e\u521d\u59cb\u5316\u6210 HUDI \u7684\u521d\u59cb\u5feb\u7167\uff1b</li> <li>\u4fdd\u969c\u6570\u636e\u4e0d\u4e22\u4e0d\u91cd</li> <li>Canal \u5199 Kafka \uff0c\u5f00\u542f\u4e8b\u52a1\u7684\u673a\u5236\uff0c\u4fdd\u8bc1\u6570\u636e\u5728\u4f20\u8f93\u8fc7\u7a0b\u5f53\u4e2d\u7684\u4e0d\u4e22\u4e0d\u91cd\uff1b</li> <li>\u5168\u5c40\u552f\u4e00 id \u52a0\u6beb\u79d2\u7ea7\u7684\u65f6\u95f4\u6233\uff0cStreaming job \u505a\u53bb\u91cd\uff1b</li> <li>\u5168\u94fe\u8def\u8d28\u91cf\u76d1\u63a7</li> <li>\u5b9e\u73b0Trace\uff0c\u57fa\u4e8eClickHouse\u5b58\u50a8\uff0c\u7edf\u8ba1\u5404\u4e2a\u73af\u8282IO\uff1b</li> </ul>"},{"location":"distributed_computing/flink/flink_action.html#-","title":"\u7a33\u5b9a\u6027 - \u5c0f\u6587\u4ef6\u7684\u5408\u5e76","text":"<ul> <li>\u6bcf\u5206\u949f\u7684 Checkpoint\uff0c\u6587\u4ef6\u6570\u7684\u653e\u5927\u975e\u5e38\u4e25\u91cd\uff1b</li> <li>\u5f15\u5165 merge \u7684 operater \u6765\u5b9e\u73b0\u6587\u4ef6\u7684\u5408\u5e76\uff0c\u57fa\u4e8e\u5e76\u53d1\u5ea6\u6a2a\u5411\u5408\u5e76\uff0c\u4e00\u4e2a writer \u4f1a\u5bf9\u5e94\u4e00\u4e2a merge\uff1b</li> </ul>"},{"location":"distributed_computing/flink/flink_action.html#hdfs","title":"HDFS \u901a\u4fe1","text":"<p>\u4f5c\u4e1a\u5806\u79ef\u6bd4\u8f83\u4e25\u91cd\u7684\u95ee\u9898\uff0c\u5b9e\u9645\u5206\u6790\u5176\u5b9e\u4e3b\u662f\u548c HDFS \u901a\u4fe1\u6709\u5f88\u5927\u7684\u5173\u7cfb\uff1b</p> <ul> <li> <p>\u56db\u4e2a\u5173\u952e\u7684\u6b65\u9aa4\uff1a\u521d\u59cb\u5316 state\u3001Invoke\u3001Snapshot \u4ee5\u53ca Notify Checkpoint complete</p> </li> <li> <p>\u6838\u5fc3\u95ee\u9898\u4e3b\u8981\u53d1\u751f\u5728 Invoke \u9636\u6bb5\uff0c\u8fbe\u5230\u6587\u4ef6\u7684\u6eda\u52a8\u6761\u4ef6\u65f6\u89e6\u53d1 flush \u548c close\uff08NameNode\u901a\u4fe1\u963b\u585e\uff09</p> </li> <li> <p>Snapshot \u9636\u6bb5\uff0c\u4e00\u4e2a\u7ba1\u9053\u4e0a\u767e\u6761\u6d41\u4e00\u65e6\u89e6\u53d1 Snapshot\uff0c\u4e32\u884c\u6267\u884c flush \u548c close \u4e5f\u4f1a\u975e\u5e38\u7684\u6162</p> </li> </ul> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li>\u51cf\u5c11\u4e86\u6587\u4ef6\u7684\u65a9\u65ad\uff08close\u6b21\u6570\uff09\uff0c Snapshot \u9636\u6bb5\uff0c\u901a\u8fc7\u6587\u4ef6\u7eed\u5199\u7684\u65b9\u5f0f\u66ff\u4ee3close\uff1b</li> <li>\u5f02\u6b65\u5316 close\uff0c\u9488\u5bf9 Invoke \u548c Snapshot \u7684 close\uff0c\u5c06\u72b6\u6001\u7ba1\u7406\u5230 state \u5f53\u4e2d\uff0c\u901a\u8fc7\u521d\u59cb\u5316 state \u6765\u8fdb\u884c\u6587\u4ef6\u7684\u6062\u590d</li> <li>\u9488\u5bf9\u591a\u6761\u6d41\uff0cSnapshot \u8fd8\u505a\u4e86\u5e76\u884c\u5316\u7684\u5904\u7406</li> </ul> <p></p>"},{"location":"distributed_computing/flink/flink_action.html#-_1","title":"\u7a33\u5b9a\u6027-\u5206\u533a\u5bb9\u9519","text":"<ul> <li>\u5b9e\u9645\u5728\u7ba1\u9053\u591a\u6761\u6d41\u7684\u60c5\u51b5\u4e0b\uff0c\u6709\u4e9b\u6d41\u7684\u6570\u636e\u5e76\u4e0d\u662f\u6bcf\u4e2a\u5c0f\u65f6\u90fd\u662f\u8fde\u7eed\u7684\uff0c Watermark \u6ca1\u6709\u529e\u6cd5\u6b63\u5e38\u63a8\u8fdb\uff0c\u5f15\u53d1\u7a7a\u5206\u533a\u7684\u95ee\u9898\uff1b</li> <li>\u5f15\u5165 PartitionRecover \u6a21\u5757\uff0c\u5b83\u4f1a\u6839\u636e Watermark \u6765\u63a8\u8fdb\u5206\u533a\u7684\u901a\u77e5\uff1b</li> <li> <p>\u9488\u5bf9\u6709\u4e9b\u6d41\u7684 Watermark\uff0c\u5982\u679c\u5728 ideltimeout \u8fd8\u6ca1\u6709\u66f4\u65b0\u7684\u60c5\u51b5\u4e0b\uff0cRecover \u6a21\u5757\u6765\u8fdb\u884c\u5206\u533a\u7684\u8ffd\u52a0\u3002\u5728\u6bcf\u4e2a\u5206\u533a\u7684\u672b\u5c3e\u5230\u8fbe\u7684\u65f6\u5019\uff0c\u52a0\u4e0a delay time \u6765\u626b\u63cf\u6240\u6709\u6d41\u7684 Watermark\uff0c\u7531\u6b64\u6765\u8fdb\u884c\u515c\u5e95\u3002</p> </li> <li> <p>\u5728\u4f20\u8f93\u8fc7\u7a0b\u5f53\u4e2d\uff0c\u5f53 Flink \u4f5c\u4e1a\u91cd\u542f\u7684\u65f6\u5019\uff0c\u4f1a\u9047\u5230\u4e00\u6ce2\u50f5\u5c38\u7684\u6587\u4ef6</p> </li> <li>\u5728 DAG \u7684 commit \u7684\u8282\u70b9\uff0c\u53bb\u505a\u6574\u4e2a\u5206\u533a\u901a\u77e5\u524d\u7684\u50f5\u5c38\u6587\u4ef6\u7684\u6e05\u7406\u5220\u9664\uff0c\u6765\u5b9e\u73b0\u6574\u4e2a\u50f5\u5c38\u6587\u4ef6\u7684\u6e05\u7406</li> <li></li> </ul>"},{"location":"distributed_computing/flink/pyflink.html","title":"PyFlink","text":""},{"location":"distributed_computing/flink/pyflink.html#_1","title":"\u539f\u7406","text":"<ul> <li>\u91c7\u7528 Py4j\uff0c\u5c06 Java API \u6620\u5c04\u4e3a Python API\uff0c\u4fdd\u6301\u548c Java \u4e00\u6837\u7684\u8bed\u4e49\uff1b</li> <li>Python UDF\uff08Apache Beam\u7684\u5b9e\u73b0\u548c\u601d\u8def\uff09\uff1b</li> </ul>"},{"location":"distributed_computing/flink/pyflink.html#shell","title":"Shell","text":"<pre><code># MINI Cluster\nbin/pyflink-shell.sh local\n\n# Remote Cluster\nbin/pyflink-shell.sh remote 172.16.2.125 8081\n</code></pre>"},{"location":"distributed_computing/flink/pyflink.html#pyflink-shellsh-jobmanager","title":"pyflink-shell.sh \u6307\u5b9a jobmanager","text":"<p>\u901a\u8fc7 </p> <pre><code># \u503c\u4e3a`remote -m 172.16.2.125:8081`\nexport SUBMIT_ARGS=${OPTIONS[@]}\n</code></pre> <p>\u7136\u540e\u5728 java_gateway.py \u4e2d\u83b7\u53d6</p> <pre><code>submit_args = os.environ.get(\"SUBMIT_ARGS\", \"local\")\ncommand += shlex.split(submit_args)\n# ...\n# command \u5185\u5bb9\u4e3a['/home/experiment/.conda/envs/flink/lib/python3.7/site-packages/pyflink/./bin/pyflink-gateway-server.sh', '-c', 'org.apache.flink.client.python.PythonGatewayServer', 'remote', '-m', '172.16.2.125:8081']\np = Popen(command, stdin=PIPE, preexec_fn=preexec_func, env=env)\n</code></pre> <p>\u5728 <code>pyflink-gateway-server.sh</code>\u4e2d</p> <pre><code># exec /home/experiment/.conda/envs/flink/lib/python3.7/site-packages/pyflink/bin/flink run -m 172.16.2.125:8081 -c org.apache.flink.client.python.PythonGatewayServer\nexec \"$FLINK_BIN_DIR\"/flink run ${ARGS[@]} -c ${DRIVER}\n</code></pre> <p><code>flink run</code> \u542f\u52a8\u7c7b <code>org.apache.flink.client.cli.CliFrontend</code>\uff0c\u5728 remote \u73af\u5883\u91cc\u6267\u884c PythonGatewayServer \u7c7b\uff0c\u5176\u662f\u4e2apy4j\u7684\u7c7b\uff08\u5b83\u83b7\u53d6\u7684ExecutionEnvironment\u5c31\u662fremote\u73af\u5883\uff09\u3002</p> <p>\u7b80\u8a00\u4e4b\uff0c\u5728 import pyflink \u524d\uff0c\u53ef\u4ee5\u901a\u8fc7shell\u6216python\u8bbe\u7f6e\u73af\u5883\u53d8\u91cfSUBMIT_ARGS\uff0c\u76f4\u63a5\u5728python\u4e2d\u83b7\u53d6\u5230remote\u73af\u5883\u3002</p>"},{"location":"distributed_computing/flink/pyflink.html#jar","title":"\u989d\u5916\u7684 Jar \u4f9d\u8d56","text":"<p>\u5982\u679cpyflink\u4e2d\u9700\u8981\u8c03\u7528\u5230\u7b2c\u4e09\u65b9\u7684jar\u5305\uff0c\u9700\u8981\u6307\u5b9a\u53c2\u6570<code>-C classpaths</code></p>"},{"location":"distributed_computing/flink/pyflink.html#yarn","title":"Yarn","text":"<p>per job \u6a21\u5f0f\u5e9f\u5f03</p> <p>Application Mode</p> <pre><code>./bin/flink run-application -t yarn-application \\\n      -Djobmanager.memory.process.size=1024m \\\n      -Dtaskmanager.memory.process.size=1024m \\\n      -Dyarn.application.name=&lt;ApplicationName&gt; \\\n      -Dyarn.ship-files=/path/to/shipfiles \\\n      -pyarch shipfiles/venv.zip \\\n      -pyclientexec venv.zip/venv/bin/python3 \\\n      -pyexec venv.zip/venv/bin/python3 \\\n      -pyfs shipfiles \\\n      -pym word_count\n</code></pre> <p>Session \u6a21\u5f0f</p> <pre><code>$ ./bin/flink run \\\n      --target yarn-session\n      --python examples/python/table/word_count.py\n</code></pre>"},{"location":"distributed_computing/flink/usage.html","title":"\u4f7f\u7528","text":""},{"location":"distributed_computing/flink/usage.html#flink-coreapp","title":"Flink Core\u548cApp\u4f9d\u8d56","text":"<ul> <li>Flink Core\uff1a<code>lib/flink-dist-*.jar</code>\uff0c\u4e0d\u5305\u542b\u4efb\u4f55\u7684connector\u7684\u4f9d\u8d56\uff1b</li> <li>User Application Dependencies \uff1aconnectors\uff0cformats\u6216\u8005\u7528\u6237\u5e94\u7528\u9700\u8981\u7684jar\u5305\uff0c\u4e0d\u8981\u5305\u542bflink\u7684\u8fd0\u884c\u65f6jar\u5305\u3002</li> </ul>"},{"location":"distributed_computing/flink/usage.html#_2","title":"\u9879\u76ee\u914d\u7f6e","text":"<p>flink\u7684\u6838\u5fc3\u4f9d\u8d56\uff0c\u8bbe\u7f6e\u4e3aprovided\u3002</p> <pre><code>&lt;dependency&gt;\n  &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n  &lt;artifactId&gt;flink-streaming-java_2.11&lt;/artifactId&gt;\n  &lt;version&gt;1.13.0&lt;/version&gt;\n  &lt;scope&gt;provided&lt;/scope&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"distributed_computing/flink/usage.html#_3","title":"\u6dfb\u52a0\u4f9d\u8d56","text":"<p>\u4f7f\u7528jar-with-dependencies\u5c06\u4f9d\u8d56\u6253\u5305\u8fdb\u53bb\u3002</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n    &lt;artifactId&gt;flink-connector-kafka_2.11&lt;/artifactId&gt;\n    &lt;version&gt;1.13.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"distributed_computing/flink/usage.html#scala","title":"Scala\u7248\u672c","text":"<p>scala 2.11\u8ddfscala 2.12\u4e0d\u517c\u5bb9\uff0cscala 2.12.8\u4e4b\u540e\u7248\u672c\u8ddf\u4e4b\u524d\u7684scala.2.12.x\u4e0d\u517c\u5bb9\u3002</p>"},{"location":"distributed_computing/flink/usage.html#hadoop","title":"Hadoop\u4f9d\u8d56","text":"<p>General rule: It should never be necessary to add Hadoop dependencies directly to your application.</p> <p>Flink\u901a\u8fc7<code>HADOOP_CLASSPATH</code>\u6307\u5b9aHadoop\u4f9d\u8d56</p> <pre><code>export HADOOP_CLASSPATH=`hadoop classpath`\n</code></pre>"},{"location":"distributed_computing/flink/usage.html#hadoop-compatiabletodo","title":"Hadoop Compatiable(TODO)","text":"<p>https://ci.apache.org/projects/flink/flink-docs-release-1.13/docs/dev/dataset/hadoop_compatibility/</p>"},{"location":"distributed_computing/flink/user-defined-sink-source.html","title":"User-defined Sources &amp; Sinks","text":"<p>\u52a8\u6001\u8868\u662fFlink\u7684Table &amp; SQL API\u7684\u6838\u5fc3\u6982\u5ff5\uff0c\u7528\u4e8e\u7edf\u4e00\u5904\u7406\u6709\u754c\u548c\u65e0\u754c\u6570\u636e\u3002</p> <p>\u56e0\u4e3a\u52a8\u6001\u8868\u53ea\u662f\u4e00\u4e2a\u903b\u8f91\u6982\u5ff5\uff0c\u6240\u4ee5Flink\u5e76\u4e0d\u62e5\u6709\u6570\u636e\u672c\u8eab\u3002\u76f8\u53cd\uff0c\u52a8\u6001\u8868\u7684\u5185\u5bb9\u5b58\u50a8\u5728\u5916\u90e8\u7cfb\u7edf(\u5982\u6570\u636e\u5e93\u3001\u952e\u503c\u5b58\u50a8\u3001\u6d88\u606f\u961f\u5217)\u6216\u6587\u4ef6\u4e2d\u3002</p> <p>\u52a8\u6001Source\u548c\u52a8\u6001Sink\u53ef\u7528\u4e8e\u4ece\u5916\u90e8\u7cfb\u7edf\u8bfb\u5199\u6570\u636e\uff0c\u4e0b\u6587\u5168\u90e8\u79f0\u4e3a\u8fde\u63a5\u5668\uff08connectors\uff09\u3002</p>"},{"location":"distributed_computing/flink/user-defined-sink-source.html#_1","title":"\u6982\u89c8","text":"<p>\u5728\u8bb8\u591a\u60c5\u51b5\u4e0b\uff0c\u5b9e\u73b0\u8005\u4e0d\u9700\u8981\u4ece\u5934\u5f00\u59cb\u521b\u5efa\u65b0\u7684\u8fde\u63a5\u5668\uff0c\u800c\u662f\u5e0c\u671b\u7a0d\u5fae\u4fee\u6539\u73b0\u6709\u7684\u8fde\u63a5\u5668\u6216\u6302\u94a9\u5230\u73b0\u6709\u7684\u5806\u6808\u4e2d\u3002</p> <p>\u4e0b\u6587\u89e3\u91ca\u4e86\u8868\u8fde\u63a5\u5668\u7684\u4e00\u822c\u67b6\u6784\uff0c\u4ece API \u4e2d\u7684\u7eaf\u58f0\u660e\u5230\u5c06\u5728\u96c6\u7fa4\u4e0a\u6267\u884c\u7684\u8fd0\u884c\u65f6\u4ee3\u7801\u3002</p> <p>\u5b9e\u5fc3\u7bad\u5934\u663e\u793a\u5728\u8f6c\u6362\u8fc7\u7a0b\u4e2d\u5bf9\u8c61\u5982\u4f55\u4ece\u4e00\u4e2a\u9636\u6bb5\u8f6c\u6362\u4e3a\u5176\u4ed6\u5bf9\u8c61\u3002</p> <p></p>"},{"location":"distributed_computing/flink/user-defined-sink-source.html#_2","title":"\u5143\u6570\u636e","text":"<p>Table API\u548cSQL\u662f\u58f0\u660e\u5f0fAPIs\u3002\u56e0\u6b64\uff0c\u6267\u884c<code>CREATE TABLE</code>\u8bed\u53e5\u5bfc\u81f4\u5bf9\u4e8e\u76ee\u6807catalog\u66f4\u65b0\u5143\u6570\u636e\u3002</p> <p>\u5bf9\u4e8e\u5927\u591a\u6570catalog\u5b9e\u73b0\uff0c\u4e0d\u4f1a\u4e3a\u6b64\u7c7b\u64cd\u4f5c\u4fee\u6539\u5916\u90e8\u7cfb\u7edf\u4e2d\u7684\u7269\u7406\u6570\u636e\u3002\u7279\u5b9a\u4e8e\u8fde\u63a5\u5668\u7684\u4f9d\u8d56\u9879\u4e0d\u5fc5\u51fa\u73b0\u5728\u7c7b\u8def\u5f84\u4e2d\u3002<code>WITH</code>\u5b50\u53e5\u4e2d\u58f0\u660e\u7684\u9009\u9879\u65e2\u4e0d\u7ecf\u8fc7\u9a8c\u8bc1\u4e5f\u4e0d\u4ee5\u5176\u4ed6\u65b9\u5f0f\u89e3\u91ca\u3002</p> <p>\u52a8\u6001\u8868\u7684\u5143\u6570\u636e\uff08\u901a\u8fc7 DDL \u521b\u5efa\u6216\u7531catalog\u63d0\u4f9b\uff09\u8868\u793a\u4e3a<code>CatalogTable</code>\uff0c\u5fc5\u8981\u65f6\u8868\u540d\u4f1a\u88ab\u89e3\u6790\u6210<code>CatalogTable</code>\u3002</p>"},{"location":"distributed_computing/flink/user-defined-sink-source.html#planning","title":"Planning","text":""},{"location":"distributed_computing/flink/user-defined-sink-source.html#runtime","title":"Runtime","text":""},{"location":"distributed_computing/flink/user-defined-sink-source.html#_3","title":"\u6269\u5c55\u70b9","text":""},{"location":"distributed_computing/flink/versions.html","title":"\u7248\u672c\u66f4\u65b0\u5386\u53f2","text":"<p>1.12.0</p>"},{"location":"distributed_computing/flink/versions.html#-gpu","title":"- \u652f\u6301GPU\u7b49\u8d44\u6e90\u7533\u8bf7\uff1b","text":""},{"location":"distributed_computing/gpu/arch.html","title":"GPU","text":""},{"location":"distributed_computing/gpu/arch.html#cpugpu","title":"CPU\u4e0eGPU\u4f53\u7cfb\u7ed3\u6784\u5bf9\u6bd4","text":""},{"location":"distributed_computing/gpu/arch.html#gpu_1","title":"GPU\u8ba1\u7b97\u5e94\u7528","text":"<p>Nvidia GPU\u67b6\u6784\u53d8\u8fc1\u53f2</p> <p>https://www.expreview.com/68156.html https://www.cnblogs.com/timlly/p/11471507.html</p> <p></p>"},{"location":"distributed_computing/gpu/arch.html#_1","title":"\u786c\u4ef6\u6982\u5ff5","text":"<ul> <li>\u663e\u5b58\uff1aGPU\u7684\u5185\u5b58\uff0c</li> <li>SP\uff1a\u6700\u57fa\u672c\u7684\u5904\u7406\u5355\u5143\uff0cstreaming processor\uff0c\u4e5f\u79f0\u4e3aCuda core</li> <li>SM\uff1a\u591a\u4e2aSP\u52a0\u4e0a\u5176\u4ed6\u7684\u4e00\u4e9b\u8d44\u6e90\u7ec4\u6210\u4e00\u4e2astreaming multiprocessor\uff0c\u4e5f\u53ebGPU\u5927\u6838\uff0c\u5176\u4ed6\u8d44\u6e90\u5982\uff1awarp scheduler\uff0cregister\uff0cshared memory\u7b49\u3002</li> </ul> <p>Tesla T4\uff1aTuring \u67b6\u6784\uff08\u7b2c7\u4ee3\uff09\uff0c\u76ee\u524d\u5df2\u7ecf\u6f14\u8fdb\u5230\u7b2c8 \u4ee3Ampere;</p> <p>**Turing TU102 Full GPU with 72 SM Units **</p> <p></p> <p>**Turing TU102 Streaming Multiprocessor (SM) **</p> <p></p>"},{"location":"distributed_computing/gpu/arch.html#_2","title":"\u7f16\u7a0b\u8bed\u8a00","text":""},{"location":"distributed_computing/gpu/arch.html#cuda","title":"CUDA","text":"<p>NVIDIA GPU\u7684\u7f16\u7a0b\u8bed\u8a00\uff0c\u89c1 Cuda\u7f16\u7a0b</p>"},{"location":"distributed_computing/gpu/arch.html#rocmhip","title":"ROCm(HIP)","text":"<p>ROCm \u7684\u76ee\u6807\u662f\u5efa\u7acb\u53ef\u66ff\u4ee3 CUDA \u7684\u751f\u6001\uff08\u56fe1\uff09\uff0c\u5e76\u5728\u6e90\u7801\u7ea7\u522b\u4e0a\u5bf9 CUDA \u7a0b\u5e8f\u7684\u652f\u6301\u3002</p> <p>AMD GPU\u7684\u7f16\u7a0b\u8bed\u8a00\uff0c\u89c1HIP\u7f16\u7a0b</p> <p></p>"},{"location":"distributed_computing/gpu/cuda/install.html","title":"\u5b89\u88c5","text":""},{"location":"distributed_computing/gpu/cuda/install.html#cuda","title":"Cuda","text":"<p>\u5b98\u7f51\uff1ahttps://developer.nvidia.com/cuda-downloads </p> <p>\u5728 https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html \u8fd9\u91cc\u53ef\u4ee5\u67e5\u8be2\u5230\u6211\u4eec\u5e94\u8be5\u4e0b\u8f7d\u54ea\u4e2a\u7248\u672c</p>"},{"location":"distributed_computing/gpu/cuda/install.html#cudnn","title":"CuDNN","text":"<p>\u5b98\u7f51 https://developer.nvidia.com/rdp/cudnn-download</p> <p>\u5982\u679c\u4f7f\u7528 Conda \u5b89\u88c5\uff0c\u53ef\u4ee5\u5b89\u88c5\u5bf9\u5e94\u7684Cuda\u3002\u539f\u751f\u5b89\u88c5\u7684cuda\u80af\u5b9a\u662f conda-cudatoolkit \u7684\u8d85\u96c6</p> <pre><code># \u6dfb\u52a0\u6e90\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main\n\nconda install cudatoolkit=10.1\nconda install cudnn=7.0.5\n</code></pre>"},{"location":"distributed_computing/gpu/cuda/install.html#nccl","title":"NCCL","text":"<p>GPU\u64cd\u4f5c\uff08AllReduce\u7b49\uff09\u7684\u5e93\uff0cnccl \u5b89\u88c5</p> <pre><code># conda \u5b89\u88c5\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge\nconda install nccl=2.5\n# \u7cfb\u7edf\u5b89\u88c5\n# https://docs.nvidia.com/deeplearning/nccl/install-guide/index.html\n</code></pre>"},{"location":"distributed_computing/gpu/cuda/pragram.html","title":"\u7f16\u7a0b","text":""},{"location":"distributed_computing/gpu/cuda/pragram.html#_2","title":"\u5185\u5b58","text":""},{"location":"distributed_computing/gpu/cuda/pragram.html#_3","title":"\u67b6\u6784","text":"<ul> <li>Registers</li> <li>kernel\u4e2d\u6ca1\u6709\u4ec0\u4e48\u7279\u6b8a\u58f0\u660e\u7684\u81ea\u52a8\u53d8\u91cf\u90fd\u662f\u653e\u5728\u5bc4\u5b58\u5668\u4e2d\uff0c\u5f53\u6570\u7ec4\u7684\u7d22\u5f15\u662fconstant\u7c7b\u578b\u4e14\u5728\u7f16\u8bd1\u671f\u80fd\u88ab\u786e\u5b9a\u7684\u8bdd\uff0c\u6570\u7ec4\u4e5f\u662f\u653e\u5728\u5bc4\u5b58\u5668\u4e2d\uff1b</li> <li>\u5bc4\u5b58\u5668\u53d8\u91cf\u662f\u6bcf\u4e2a\u7ebf\u7a0b\u79c1\u6709\u7684\uff0c\u4e00\u65e6thread\u6267\u884c\u7ed3\u675f\uff0c\u5bc4\u5b58\u5668\u53d8\u91cf\u5c31\u4f1a\u5931\u6548\uff1b\u907f\u514dregister spilling\u5230local memory\u4e0a\uff1b</li> <li>\u6bcf\u4e2athread\u4f7f\u7528\u7684\u5bc4\u5b58\u5668\u6570\u91cf\u662f255\u4e2a\uff1b</li> <li>Local memory\uff1a\u5728local memory\u4e2d\u7684\u53d8\u91cf\u672c\u8d28\u4e0a\u8ddfglobal memory\u5728\u540c\u4e00\u5757\u5b58\u50a8\u533a\uff1b</li> <li>\u4e0d\u80fd\u786e\u5b9a\u5b83\u4eec\u662f\u7528\u5e38\u91cf\u7d22\u5f15\u7684\u6570\u7ec4\u6216\u4efb\u4f55\u8d85\u8fc7\u5bc4\u5b58\u5668\u9650\u5236\u7684\u53d8\u91cf\uff1b</li> <li>\u8f83\u5927\u7684\u7ed3\u6784\u4f53\u6216\u8005\u6570\u7ec4\uff0c\u4e5f\u5c31\u662f\u90a3\u4e9b\u53ef\u80fd\u4f1a\u6d88\u8017\u5927\u91cfregister\u7684\u53d8\u91cf\uff1b</li> <li>\u6bcf\u4e2a\u7ebf\u7a0b\u7684local memory\u5927\u5c0f\u4e3a512KB\uff1b</li> <li>Shared memory\uff1a</li> <li>\u4ee5block\u4e3a\u5355\u4f4d\u5206\u914d\uff0c\u6839\u636e\u8ba1\u7b97\u529b\u4e0d\u540c\u5176\u5927\u5c0f\u4e5f\u4e0d\u540c\uff1b</li> <li>\u83b7\u53d6shared memory\u7684\u6570\u636e\u524d\u5fc5\u987b\u5148\u7528__syncthreads()\u540c\u6b65\uff1b</li> <li>\u5212\u5206\u4e3a\u4e0d\u540c\u7684bank\uff0c\u4e0d\u540cbank\u7684\u6570\u636e\u53ef\u4ee5\u540c\u65f6\u83b7\u53d6\uff0c\u540c\u4e00\u4e2abank\u7684\u6570\u636e\u540c\u65f6\u83b7\u53d6\u9700\u8981\u6309\u5e8f\uff1b\uff0832\u4e2abank\uff09</li> <li>Constant memory\uff1a</li> <li>64KB\uff1b</li> <li>\u521d\u59cb\u5316\u5fc5\u987b\u5728host\u7aef\u4f7f\u7528cudaMemcpyToSymbol\u51fd\u6570\uff1b</li> <li>Texture and Surface memory </li> <li>Global Memory</li> </ul> <p>\u65b0\u7684\u5171\u4eab\u5185\u5b58\u67b6\u6784(Turing)</p> <p>\u7edf\u4e00shared memory\uff0cL1 and texture caching\u3002</p> <p></p>"},{"location":"distributed_computing/gpu/cuda/pragram.html#_4","title":"\u5185\u5b58\u4fee\u9970","text":"<p>\u53d8\u91cf\u5b9a\u4e49\u65f6\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u8fdb\u884c\u4fee\u9970</p> <p><code>__device__</code> \uff1a\u5b58\u50a8\u5728\u8bbe\u5907\u4e0a\uff0c\u9ed8\u8ba4\u4e3aglobal memory</p> <ul> <li><code>__shared__</code> \uff1a shared memory</li> <li>block\u7ea7\u7684\u751f\u547d\u5468\u671f\uff0cblock\u5185\u6240\u6709\u7ebf\u7a0b\u5171\u4eab</li> <li><code>__constant__</code> \uff1aconstant memory</li> <li>\u7c7b\u578b\u53ef\u4ee5\u662f\u53d8\u91cf\u3001\u6570\u7ec4\uff0c\u4f46\u4e0d\u80fd\u662f\u6307\u9488\uff1b</li> <li><code>__managed__</code> \uff1a\u53d8\u91cf\u5728\u8bbe\u5907\u548c\u4e3b\u673a\u4e0a\u90fd\u80fd\u5f15\u7528\u53ca\u64cd\u4f5c</li> </ul> <p><code>__restrict__</code>\uff1aC99 \u4e2d\u6d88\u9664\u6307\u9488\u522b\u540d\u95ee\u9898</p> <ul> <li>\u5b9a\u4e49\u6307\u9488\u53d8\u91cf\uff0c\u8868\u660e\u8be5\u53d8\u91cf\u6ca1\u6709\u522b\u540d\uff1b</li> <li>\u66f4\u597d\u7684\u7f16\u8bd1\u5668\u4f18\u5316\uff1b</li> </ul>"},{"location":"distributed_computing/gpu/cuda/pragram.html#l2-cache","title":"L2 Cache","text":"<p>L2 cache\u662fGlobal memory\u7684\u7f13\u5b58\uff0c\u4eceCuda 11.0\u8d77\uff0c\u8ba1\u7b97\u529b8.0\u4ee5\u4e0a\u7684device\u53ef\u4ee5\u63a7\u5236L2 cache\u7684\u5b58\u50a8\uff0c\u83b7\u53d6global memory\u66f4\u9ad8\u5e26\u5bbd\u548c\u66f4\u4f4e\u5ef6\u8fdf\u3002</p> <p>TODO\uff1a\u4f7f\u7528</p>"},{"location":"distributed_computing/gpu/cuda/pragram.html#shared-memory","title":"Shared Memory","text":"<p>\u6bd4global memory\u66f4\u4f4e\u7684\u5ef6\u8fdf\uff0c\u53ef\u4ee5\u7528\u6765\u51cf\u5c11\u9891\u7e41\u7684global memory\u8bbf\u95ee\uff0c\u89c1\u77e9\u9635\u4e58\u6cd5\u793a\u4f8b\u4f18\u5316\u3002</p>"},{"location":"distributed_computing/gpu/cuda/pragram.html#page-locked-host-memory","title":"Page-Locked Host Memory","text":"<p>\u5206\u914dpage-locked(pinned)\u4e3b\u673a\u5185\u5b58\uff0c \u76f8\u5bf9\u4e8emalloc\u5206\u914d\u7684\u5e38\u89c4\u9875\u5185\u5b58\uff08\u53ef\u4ee5\u88ab\u4ea4\u6362\u5230\u78c1\u76d8\u4e0a\uff09\u3002</p> <ul> <li> <p>cudaHostAlloc()\u548ccudaHostFree()\u51fd\u6570\u3002</p> </li> <li> <p>cudaHostRegister()\u53ef\u4ee5page-lock\u7531malloc\u51fd\u6570\u7533\u8bf7\u7684\u5185\u5b58\u3002</p> </li> <li> <p>page-locked\u7684\u4e3b\u673a\u5185\u5b58\u548cdevice\u5185\u5b58\u95f4\u7684\u62f7\u8d1d\u53ef\u4ee5\u548ckernel\u6267\u884c\u5e76\u53d1\uff1b</p> </li> <li>\u9700\u8981\u5728\u5185\u5b58\u4e2d\u6709\u8fde\u7eed\u7684\u7a7a\u95f4\uff0c\u5982\u679c\u5185\u5b58\u7d27\u5f20\uff0c\u53ef\u80fd\u5206\u914d\u65f6\u95f4\u4f1a\u5f88\u957f\u6216\u8005\u5931\u8d25\u3002</li> </ul>"},{"location":"distributed_computing/gpu/cuda/pragram.html#portable","title":"Portable \u5185\u5b58","text":"<p>cudaHostAllocPortable</p> <p>\u5206\u9875\u9501\u5b9a\u5185\u5b58\u5757\u53ef\u4ee5\u4e0e\u7cfb\u7edf\u4e2d\u7684\u4efb\u4f55\u8bbe\u5907\u4e00\u8d77\u4f7f\u7528\uff08\u591aGPU\u5361\u7cfb\u7edf\uff09\u3002</p>"},{"location":"distributed_computing/gpu/cuda/pragram.html#write-combining","title":"Write-Combining \u5185\u5b58","text":"<p>cudaHostAllocWriteCombined </p> <p>\u907f\u514d\u4f7f\u7528\u4e3b\u673a\u7684L1\u548cL2\u7f13\u5b58\uff0c\u5f53\u6210\u53ea\u5199\u5185\u5b58\uff0c\u56e0\u6b64\u8bfb\u53d6\u4f1a\u6bd4\u8f83\u6162\u3002</p>"},{"location":"distributed_computing/gpu/cuda/pragram.html#mapped","title":"Mapped \u5185\u5b58","text":"<p>cudaHostAllocMapped </p> <p>\u5206\u9875\u9501\u5b9a\u5185\u5b58\u5757\u53ef\u4ee5\u6620\u5c04\u5230device\u5185\u5b58\u3002</p>"},{"location":"distributed_computing/gpu/cuda/pragram.html#_5","title":"\u51fd\u6570","text":"<ul> <li> <p>Device\u4e0a\u7684\u5185\u5b58\u6709\u4e24\u79cd\u5206\u914d\u5f62\u5f0f\uff1aLinear memory \u6216 CUDA arrays\u3002</p> </li> <li> <ul> <li>Linear memory  : \u4f7f\u7528 cudaMalloc\uff0ccudaFree\u548ccudaMemCpy\uff0c\u8ba1\u7b97\u529b6.0\u4e4b\u540e\u5730\u5740\u7a7a\u95f4\u5728X86_64\u4e3a47\u4f4d\uff1b</li> <li>Linear memory\u4e5f\u53ef\u4ee5\u4f7f\u7528cudaMallocPitch() \u548c cudaMalloc3D()\uff0c\u81ea\u52a8\u5bf92D/3D\u6570\u7ec4padding\u5bf9\u9f50\uff1b</li> </ul> </li> <li>Cuda Arrays\u662f\u5bf9Texture memory\u7684\u4e0d\u900f\u660e\u7684\u5185\u5b58\u5e03\u5c40\u4f18\u5316\u5b9e\u73b0\uff1b</li> </ul> <pre><code>// cudaMallocPitch\uff0c2D\u6570\u7ec4\u793a\u4f8b Host code\nint width = 64, height = 64;\nfloat* devPtr;\nsize_t pitch;\ncudaMallocPitch(&amp;devPtr, &amp;pitch, width * sizeof(float), height);\nMyKernel&lt;&lt;&lt;100, 512&gt;&gt;&gt;(devPtr, pitch, width, height);\n// Device code\n__global__ void MyKernel(float* devPtr, size_t pitch, int width, int height) {\n\u00a0\u00a0\u00a0\u00a0for (int r = 0; r &lt; height; ++r) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0float* row = (float*)((char*)devPtr + r * pitch);  // important\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int c = 0; c &lt; width; ++c) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0float element = row[c];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre>"},{"location":"distributed_computing/gpu/cuda/pragram.html#device","title":"Device\u5185\u5b58","text":"<p>\u5206\u914d\uff1a</p> <ul> <li>cudaMalloc</li> </ul> <p>\u9500\u6bc1</p> <ul> <li>cudaFree</li> </ul>"},{"location":"distributed_computing/gpu/cuda/pragram.html#host","title":"Host\u5185\u5b58","text":""},{"location":"distributed_computing/gpu/cuda/pragram.html#_6","title":"\u5185\u5b58\u6570\u636e\u4f20\u9012","text":"<p><code>cudaError_t cudaMemcpy ( void* dst, const void* src, size_t count,cudaMemcpyKind kind )</code></p> <ul> <li><code>kind</code>\u53ef\u4ee5\u4e3a\uff1acudaMemcpyHostToDevice\uff0ccudaMemcpyDeviceToHost\uff0ccudaMemcpyDeviceToDevice\uff0ccudaMemcpyHostToHost</li> </ul> <p><code>__host__ cudaError_t cudaMemcpyToSymbol ( const T&amp; symbol, const void* src, size_t count, size_t offset = 0, cudaMemcpyKind kind = cudaMemcpyHostToDevice )</code></p> <ul> <li><code>symbol</code> is a variable that resides in global or constant memory space. </li> <li>Copies data to the given symbol on the device</li> </ul> <p><code>__host__ cudaError_t cudaMemcpyFromSymbol ( void* src, const T&amp; symbol, size_t count, size_t offset = 0, cudaMemcpyKind kind = cudaMemcpyDeviceToHost)</code></p> <ul> <li> <p><code>symbol</code> is a variable that resides in global or constant memory space. </p> </li> <li> <p>Copies data from the given symbol on the device</p> </li> </ul>"},{"location":"distributed_computing/gpu/cuda/pragram.html#kernel","title":"Kernel","text":"<p>\u6240\u6709CUDA kernel\u7684\u542f\u52a8\u90fd\u662f\u5f02\u6b65\u7684\uff0c\u5f53CUDA kernel\u88ab\u8c03\u7528\u65f6\uff0c\u63a7\u5236\u6743\u4f1a\u7acb\u5373\u8fd4\u56de\u7ed9CPU\u3002</p> <p></p> <p>kernel\u6309\u7167\u7ebf\u7a0b\u7f51\u683c\uff08Grid\uff09\u7684\u6982\u5ff5\u5728\u663e\u5361\u786c\u4ef6\uff08GPU\uff09\u4e0a\u6267\u884c\u3002\u5f53\u8981\u6267\u884c\u8fd9\u4e9b\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u6bcf\u4e00\u4e2aGrid\u53c8\u628a\u4efb\u52a1\u5206\u6210\u4e00\u90e8\u5206\u4e00\u90e8\u5206\u7684block\uff0cblock\u518d\u5206\u7ebf\u7a0b\u6765\u5b8c\u6210\u3002</p>"},{"location":"distributed_computing/gpu/cuda/pragram.html#kernelparam1-param2","title":"Kernel&lt;&lt;&gt;&gt;(param1, param2, ...) <ul> <li>Dg\uff1agrid\u7684\u5c3a\u5bf8\uff0c\u8bf4\u660e\u4e00\u4e2agrid\u542b\u6709\u591a\u5c11\u4e2ablock\uff0cdim3/int\u7c7b\u578b</li> <li>Db\uff1ablock\u7684\u5c3a\u5bf8\uff0c\u8bf4\u660e\u4e00\u4e2ablock\u542b\u6709\u591a\u5c11\u4e2athread\uff0cdim3/int\u7c7b\u578b</li> <li>Ns\uff1a\u53ef\u9009\u53c2\u6570\uff0c\u5982\u679ckernel\u4e2d\u7531\u52a8\u6001\u5206\u914d\u5185\u5b58\u7684shared memory\uff0c\u9700\u8981\u5728\u6b64\u6307\u5b9a\u5927\u5c0f\uff0c\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff1b</li> <li>S\uff1a\u53ef\u9009\u53c2\u6570\uff0c\u8868\u793a\u8be5kernel\u5904\u5728\u54ea\u4e2a\u6d41\u5f53\u4e2d\u3002</li> </ul> <p>\u4e0d\u540cGPU\u8ba1\u7b97\u529b\u4e2dkernel\u7684grid\u3001block\u7684\u9650\u5236 </p> <ul> <li>grid\u5c3a\u5bf8\uff0c\u6700\u591a\u4e3a&lt;2^31-1, 65535, 65535&gt; <li>block\u5c3a\u5bf8\uff0c\u6700\u591a\u4e3a&lt;1024, 1024, 64&gt;","text":""},{"location":"distributed_computing/gpu/cuda/pragram.html#_7","title":"\u5185\u7f6e\u53d8\u91cf <p>gridDim</p> <ul> <li>\u5e38\u6570\uff0c\u6700\u591a\u4e09\u7ef4\uff0c\u4fdd\u5b58\u7ebf\u7a0b\u683c(grid)\u4e2d\u6bcf\u4e00\u7ef4\u7684\u5927\u5c0f\u3002</li> </ul> <p>blockDim</p> <ul> <li>\u5e38\u6570\uff0c\u6700\u591a\u4e09\u7ef4\uff0c\u4fdd\u5b58\u7684\u662f\u7ebf\u7a0b\u5757(block)\u4e2d\u6bcf\u4e00\u7ef4\u7684\u7ebf\u7a0b\u6570\u91cf\u3002</li> </ul> <p>blockIdx</p> <ul> <li>\u5f53\u524d\u6267\u884c\u8bbe\u5907\u4ee3\u7801\u7684\u7ebf\u7a0b\u5757\u7684\u7d22\u5f15\u3002</li> </ul> <p>threadIdx</p> <ul> <li>\u5f53\u524d\u6267\u884c\u8bbe\u5907\u4ee3\u7801\u7684\u7ebf\u7a0b\u7d22\u5f15\u3002</li> </ul>","text":""},{"location":"distributed_computing/gpu/cuda/pragram.html#_8","title":"\u4fee\u9970 <p><code>__host__</code> ( \u7b49\u4ef7\u4e8e\u6ca1\u6709\u4fee\u9970 )</p> <ul> <li>\u5728 host \u4e0a\u6267\u884c\uff0c\u901a\u8fc7 host \u8c03\u7528</li> </ul> <p><code>__device__</code></p> <ul> <li>\u5728 device(GPU) \u6267\u884c\uff0c\u901a\u8fc7 device \u8c03\u7528</li> </ul> <p><code>__global__</code></p> <ul> <li> <p>\u8fd4\u56de\u4e3avoid\uff0c\u4e0d\u80fd\u662f\u6210\u5458\u51fd\u6570</p> </li> <li> <p>\u5728 device \u4e0a\u6267\u884c\uff0c\u53ef\u4ee5\u901a\u8fc7 host \u8c03\u7528\uff0c\u6216\u8005 device \u8c03\u7528\uff08\u8ba1\u7b97\u529b\u5927\u4e8e3.2\uff0cT4\u8ba1\u7b97\u529b7.5\uff09</p> </li> </ul>","text":""},{"location":"distributed_computing/gpu/cuda/pragram.html#runtime","title":"RunTime","text":""},{"location":"distributed_computing/gpu/cuda/pragram.html#_9","title":"\u6267\u884c\u8bf4\u660e <ul> <li>CUDA\u7684\u8bbe\u5907\u5728\u5b9e\u9645\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u4ee5block\u4e3a\u5355\u4f4d\uff0c\u628a\u4e00\u4e2a\u4e2ablock\u5206\u914d\u7ed9SM\u8fdb\u884c\u8fd0\u7b97\uff1b</li> <li>block\u4e2d\u7684thread\u53c8\u4f1a\u4ee5warp\uff08\u7ebf\u7a0b\u675f\uff09\u4e3a\u5355\u4f4d\uff0c\u5bf9thread\u8fdb\u884c\u5206\u7ec4\u8ba1\u7b97\u3002</li> <li>\u76ee\u524dCUDA\u7684warp\u5927\u5c0f\u90fd\u662f32\uff0c\u4e5f\u5c31\u662f\u8bf432\u4e2athread\u4f1a\u88ab\u7ec4\u6210\u4e00\u4e2awarp\u6765\u4e00\u8d77\u6267\u884c\u3002</li> <li>\u540c\u4e00\u4e2awarp\u4e2d\u7684thread\u6267\u884c\u7684\u6307\u4ee4\u662f\u76f8\u540c\u7684\uff0c\u53ea\u662f\u5904\u7406\u7684\u6570\u636e\u4e0d\u540c\u3002</li> <li>\u4e00\u4e2aSM \u4e00\u6b21\u53ea\u4f1a\u6267\u884c\u4e00\u4e2ablock \u91cc\u7684\u4e00\u4e2awarp</li> <li>\u5f53\u9047\u5230\u6b63\u5728\u6267\u884c\u7684warp \u9700\u8981\u7b49\u5f85\u7684\u65f6\u5019\uff08\u4f8b\u5982\u5b58\u53d6global memory \u5c31\u4f1a\u8981\u7b49\u597d\u4e00\u6bb5\u65f6\u95f4\uff09\uff0c\u5c31\u5207\u6362\u5230\u522b\u7684warp\u6765\u7ee7\u7eed\u505a\u8fd0\u7b97</li> </ul>","text":""},{"location":"distributed_computing/gpu/cuda/pragram.html#_10","title":"\u5f02\u6b65\u5e76\u53d1\u6267\u884c <p>CUDA\u5c06\u4ee5\u4e0b\u64cd\u4f5c\u66b4\u9732\u4e3a\u53ef\u4ee5\u76f8\u4e92\u5e76\u53d1\u64cd\u4f5c\u7684\u72ec\u7acb\u4efb\u52a1\u3002</p> <ul> <li>Computation on the host;</li> <li>Computation on the device;</li> <li>Memory transfers from the host to the device;</li> <li>Memory transfers from the device to the host;</li> <li>Memory transfers within the memory of a given device;</li> <li>Memory transfers among devices.</li> </ul>","text":""},{"location":"distributed_computing/gpu/cuda/pragram.html#hostdevice","title":"Host\u548cDevice\u7684\u5e76\u53d1","text":"<p>\u4ee5\u4e0bdevice\u4e0a\u7684\u64cd\u4f5c\u5bf9Host\u662f\u5f02\u6b65\uff1a</p> <ul> <li>Kernel launches\uff0c<code>CUDA_LAUNCH_BLOCKING</code>\u8bbe\u7f6e\u4e3a1\u65f6\u8868\u793aBlock\uff1b</li> <li>\u5355\u4e2adevice\u5185\u7684\u5185\u5b58\u62f7\u8d1d;</li> <li>Memory copies from host to device of a memory block of 64 KB or less;</li> <li>\u4ee5<code>Async</code>\u7ed3\u5c3e\u7684\u5185\u5b58\u62f7\u8d1d\u51fd\u6570;</li> <li>Memory set function calls.</li> </ul>"},{"location":"distributed_computing/gpu/cuda/pragram.html#kernel_1","title":"\u5e76\u53d1\u7684kernel\u6267\u884c","text":"<ul> <li> <p>\u4e0d\u540c\u8ba1\u7b97\u529b\u7684GPU\uff0c\u5176kernel\u5e76\u53d1\u6570\u4e5f\u4e0d\u4e00\u6837\uff0cSM7.5\u53ef\u4ee5\u5e76\u53d1128</p> </li> <li> <p>\u4e0d\u540cCUDA context\u7684kernel\u4e0d\u80fd\u5e76\u53d1\u6267\u884c\uff1b</p> </li> <li> <p>\u4f7f\u7528\u8bb8\u591atextures\u6216\u5927\u91cflocal\u5185\u5b58\u7684kernel\u4e0d\u592a\u53ef\u80fd\u4e0e\u5176\u4ed6kernel\u5e76\u53d1\u6267\u884c\u3002</p> </li> </ul>"},{"location":"distributed_computing/gpu/cuda/pragram.html#_11","title":"\u6570\u636e\u4f20\u8f93\u548c\u5185\u6838\u6267\u884c\u7684\u91cd\u53e0","text":""},{"location":"distributed_computing/gpu/cuda/pragram.html#_12","title":"\u5e76\u53d1\u7684\u6570\u636e\u4f20\u8f93","text":""},{"location":"distributed_computing/gpu/cuda/pragram.html#streams","title":"Streams","text":"<p>\u901a\u8fc7streams\u8fdb\u884c\u5e76\u53d1\u64cd\u4f5c\u3002</p> <pre><code>// API\u64cd\u4f5c\ncudaStream_t stream;\ncudaStreamCreate(&amp;stream);\ncudaMemcpy(d_a, a, numBytes, cudaMemcpyHostToDevice, stream);\ncudaStreamDestroy(stream);\n</code></pre> <p>\u5728cuda\u4e2d\u4e00\u4e2aStream\u662f\u7531Host\u4ee3\u7801\u53d1\u5e03\u7684\u4e00\u7cfb\u5217\u5728Device\u4e0a\u6267\u884c\u7684\u64cd\u4f5c\uff0c\u5fc5\u987b\u786e\u4fdd\u987a\u5e8f\u6267\u884c\u3002\u4e0d\u540cstreams\u91cc\u9762\u7684\u64cd\u4f5c\u53ef\u4ee5\u4ea4\u53c9\u6267\u884c\u6216\u8005\u5e76\u53d1\u6267\u884c\u3002</p> <p>\u9ed8\u8ba4stream\uff1a</p> <p>Device\u64cd\u4f5c\u5305\u62ec\uff1a\u6570\u636e\u4f20\u8f93\u548ckernels\uff0c\u5728cuda\u4e2d\uff0c\u6240\u6709\u7684\u8bbe\u5907\u64cd\u4f5c\u90fd\u5728stream\u4e2d\u6267\u884c\u3002\u5f53\u6ca1\u6709\u6307\u5b9astream\u65f6\uff0c\u4f7f\u7528\u9ed8\u8ba4\u7684stream\u3002\u9ed8\u8ba4stream\u662f\u4e00\u4e2a\u9488\u5bf9\u8bbe\u5907\u64cd\u4f5c\u540c\u6b65\u7684stream\uff0c\u53ea\u6709\u5f53\u6240\u6709\u4e4b\u524d\u8bbe\u5907\u4e0a\u4efb\u4f55stream\u91cc\u9762\u7684\u64cd\u4f5c\u5168\u90e8\u5b8c\u6210\u65f6\uff0c\u624d\u5f00\u59cb\u9ed8\u8ba4stream\u91cc\u9762\u64cd\u4f5c\u7684\u6267\u884c\uff0c\u5e76\u4e14\u9ed8\u8ba4stream\u91cc\u9762\u7684\u4e00\u4e2a\u64cd\u4f5c\u5fc5\u987b\u5b8c\u6210\uff0c\u5176\u4ed6\u4efb\u4f55stream\u91cc\u9762\u7684\u64cd\u4f5c\u624d\u80fd\u5f00\u59cb\u3002</p> <p>\u4f8b\u5982\u4ee5\u4e0b\u4ee3\u7801\uff1a</p> <pre><code>cudaMemcpy(d_a, a, numBytes, cudaMemcpyHostToDevice);\nincrement&lt;&lt;&lt;1,N&gt;&gt;&gt;(d_a)\ncudaMemcpy(a, d_a, numBytes, cudaMemcpyDeviceToHost);\n</code></pre> <p>\u4ece\u8bbe\u5907\u7aef\u6765\u770b\uff0c\u8fd9\u4e09\u4e2a\u64cd\u4f5c\u90fd\u5728\u9ed8\u8ba4stream\u4e2d\uff0c\u5e76\u4e14\u6309\u987a\u5e8f\u6267\u884c\uff1b\u4ece\u4e3b\u673a\u7aef\u6765\u770b\uff0c\u6570\u636e\u4f20\u8f93\u662f\u963b\u585e\u7684\u6216\u8005\u540c\u6b65\u4f20\u8f93\uff0c\u800ckernel\u662f\u5f02\u6b65\u7684\u3002\u7b2c\u4e00\u6b65\u4e3b\u673a\u5230\u8bbe\u5907\u7684\u6570\u636e\u4f20\u8f93\u662f\u540c\u6b65\u7684\uff0cCPU\u7ebf\u7a0b\u4e0d\u80fd\u5230\u8fbe\u7b2c\u4e8c\u884c\u76f4\u5230\u4e3b\u673a\u5230\u8bbe\u5907\u7684\u6570\u636e\u4f20\u8f93\u5b8c\u6210\u3002\u4e00\u65e6kernel\u88ab\u5904\u7406\uff0cCPU\u7ebf\u7a0b\u79fb\u5230\u7b2c\u4e09\u884c\uff0c\u4f46\u662f\u8be5\u884c\u7684\u4f20\u8f93\u4e0d\u80fd\u5f00\u59cb\uff0c\u56e0\u4e3a\u8bbe\u5907\u7aef\u6b63\u5728\u6267\u884c\u7b2c\u4e8c\u884c\u7684\u5185\u5bb9\u3002</p> <p>\u975e\u9ed8\u8ba4stream\uff1a</p> <ul> <li>\u975e\u9ed8\u8ba4stream\u4e2d\u7684\u6570\u636e\u4f20\u8f93\u4f7f\u7528\u51fd\u6570<code>cudaMemcpyAsync()</code>\uff0c\u8fd9\u4e2a\u51fd\u6570\u5728\u4e3b\u673a\u7aef\u662f\u975e\u963b\u585e\u7684\uff0c\u4f20\u8f93\u5904\u7406\u540e\u63a7\u5236\u6743\u9a6c\u4e0a\u8fd4\u56de\u7ed9\u4e3b\u673a\u7ebf\u7a0b\u3002</li> </ul> <p>\u663e\u793a\u540c\u6b65\uff1a</p> <pre><code>cudaStreamSynchronize(stream); // \u7b49\u5f85\u8be5\u6d41\u4e0b\u7684\u6240\u6709\u64cd\u4f5c\u5b8c\u6210\ncudaDeviceSynchronize();\ncudaStreamWaitEvent();\ncudaStreamQuery()\n</code></pre> <p>\u9690\u5f0f\u540c\u6b65\uff1a</p> <p>\u5982\u679c\u4e3b\u673a\u7ebf\u7a0b\u5728\u5b83\u4eec\u4e4b\u95f4\u6267\u884c\u4e86\u4ee5\u4e0b\u64cd\u4f5c\u4e4b\u4e00\uff0c\u4e0d\u540cstreams\u7684\u4e24\u4e2a\u547d\u4ee4\u64cd\u4f5c\u4e0d\u80fd\u5e76\u53d1\uff1a</p> <ul> <li>page-lock\u7684host\u5185\u5b58\u5206\u914d\uff1b</li> <li>device\u5185\u5b58\u5206\u914d\u6216\u8bbe\u7f6e\uff1b</li> <li>\u540c\u4e00\u4e2adevice\u5185\u5b58\u7684\u62f7\u8d1d\uff1b</li> <li>\u4efb\u610f\u5bf9NULL Stream\uff08\u9ed8\u8ba4stream\uff09\u7684Cuda\u547d\u4ee4\uff1b</li> <li>\u5728L1/shared\u5185\u5b58\u914d\u7f6e\u7684\u4ea4\u6362\uff1b</li> </ul> <p>\u91cd\u53e0\u884c\u4e3a(TODO)\uff1a</p> <p>Host Functions (Callbacks)(TODO)</p> <p>Stream Priorities(TODO)</p>"},{"location":"distributed_computing/gpu/cuda/pragram.html#_13","title":"\u793a\u4f8b","text":""},{"location":"distributed_computing/gpu/cuda/pragram.html#_14","title":"\u77e9\u9635\u4e58\u6cd5","text":""},{"location":"distributed_computing/gpu/cuda/pragram.html#_15","title":"\u57fa\u672c\u601d\u8def","text":"<p>\u5c06C\u77e9\u9635\u7684\u884c\u3001\u5217\uff0c\u5212\u5206\u6210 Blocks\uff0c\u6bcf\u4e2aBlock\u91cc\u9762\u662fThreads\uff0ckernel\u8ba1\u7b97\u65f6\u6bcf\u4e2athread\u5bf9\u5e94\u4e00\u4e2aC\u4e2d\u4e00\u4e2a\u5143\u7d20\uff0c\u83b7\u53d6A\u4e2d\u5bf9\u5e94\u884c\uff0cB\u4e2d\u5bf9\u5e94\u5217\u3002</p> <p>\u4f46\u662f\u8be5\u65b9\u6cd5\u6709\u91cd\u590d\u8bfb\u53d6\uff0cA\u4e2d\u6bcf\u4e00\u884c\u548cB\u4e2d\u6bcf\u4e00\u5217\u3002</p> <p></p>"},{"location":"distributed_computing/gpu/cuda/pragram.html#_16","title":"\u4f18\u5316\u601d\u8def","text":"<pre><code>// Matrices are stored in row-major order:\n// M(row, col) = *(M.elements + row * M.stride + col)\ntypedef struct {\n\u00a0\u00a0\u00a0\u00a0int width;\n\u00a0\u00a0\u00a0\u00a0int height;\n\u00a0\u00a0\u00a0\u00a0int stride; \n\u00a0\u00a0\u00a0\u00a0float* elements;\n} Matrix;\n\n// Get a matrix element\n__device__ float GetElement(const Matrix A, int row, int col) {\n\u00a0\u00a0\u00a0\u00a0return A.elements[row * A.stride + col];\n}\n\n// Set a matrix element\n__device__ void SetElement(Matrix A, int row, int col, float value){\n\u00a0\u00a0\u00a0\u00a0A.elements[row * A.stride + col] = value;\n}\n\n// Get the BLOCK_SIZExBLOCK_SIZE sub-matrix Asub of A that is\n// located col sub-matrices to the right and row sub-matrices down\n// from the upper-left corner of A\n__device__ Matrix GetSubMatrix(Matrix A, int row, int col) {\n\u00a0\u00a0\u00a0\u00a0Matrix Asub;\n\u00a0\u00a0\u00a0\u00a0Asub.width\u00a0\u00a0\u00a0\u00a0= BLOCK_SIZE;\n\u00a0\u00a0\u00a0\u00a0Asub.height\u00a0\u00a0 = BLOCK_SIZE;\n\u00a0\u00a0\u00a0\u00a0Asub.stride\u00a0\u00a0 = A.stride;\n\u00a0\u00a0\u00a0\u00a0Asub.elements = &amp;A.elements[A.stride * BLOCK_SIZE * row + BLOCK_SIZE * col];\n\u00a0\u00a0\u00a0\u00a0return Asub;\n}\n\n// Thread block size\n#define BLOCK_SIZE 16\n// Forward declaration of the matrix multiplication kernel\n__global__ void MatMulKernel(const Matrix, const Matrix, Matrix);\n\n// Matrix multiplication - Host code\n// Matrix dimensions are assumed to be multiples of BLOCK_SIZE\nvoid MatMul(const Matrix A, const Matrix B, Matrix C) {\n\u00a0\u00a0\u00a0\u00a0// Load A and B to device memory\n\u00a0\u00a0\u00a0\u00a0Matrix d_A;\n\u00a0\u00a0\u00a0\u00a0d_A.width = d_A.stride = A.width; d_A.height = A.height;\n\u00a0\u00a0\u00a0\u00a0size_t size = A.width * A.height * sizeof(float);\n\u00a0\u00a0\u00a0\u00a0cudaMalloc(&amp;d_A.elements, size);\n\u00a0\u00a0\u00a0\u00a0cudaMemcpy(d_A.elements, A.elements, size,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 cudaMemcpyHostToDevice);\n\u00a0\u00a0\u00a0\u00a0Matrix d_B;\n\u00a0\u00a0\u00a0\u00a0d_B.width = d_B.stride = B.width; d_B.height = B.height;\n\u00a0\u00a0\u00a0\u00a0size = B.width * B.height * sizeof(float);\n\u00a0\u00a0\u00a0\u00a0cudaMalloc(&amp;d_B.elements, size);\n\u00a0\u00a0\u00a0\u00a0cudaMemcpy(d_B.elements, B.elements, size,\n\u00a0\u00a0\u00a0\u00a0cudaMemcpyHostToDevice);\n\n\u00a0\u00a0\u00a0\u00a0// Allocate C in device memory\n\u00a0\u00a0\u00a0\u00a0Matrix d_C;\n\u00a0\u00a0\u00a0\u00a0d_C.width = d_C.stride = C.width; d_C.height = C.height;\n\u00a0\u00a0\u00a0\u00a0size = C.width * C.height * sizeof(float);\n\u00a0\u00a0\u00a0\u00a0cudaMalloc(&amp;d_C.elements, size);\n\n\u00a0\u00a0\u00a0\u00a0// Invoke kernel\n\u00a0\u00a0\u00a0\u00a0dim3 dimBlock(BLOCK_SIZE, BLOCK_SIZE);\n\u00a0\u00a0\u00a0\u00a0dim3 dimGrid(B.width / dimBlock.x, A.height / dimBlock.y);\n\u00a0\u00a0\u00a0\u00a0MatMulKernel&lt;&lt;&lt;dimGrid, dimBlock&gt;&gt;&gt;(d_A, d_B, d_C);\n\n\u00a0\u00a0\u00a0\u00a0// Read C from device memory\n\u00a0\u00a0\u00a0\u00a0cudaMemcpy(C.elements, d_C.elements, size,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 cudaMemcpyDeviceToHost);\n\n\u00a0\u00a0\u00a0\u00a0// Free device memory\n\u00a0\u00a0\u00a0\u00a0cudaFree(d_A.elements);\n\u00a0\u00a0\u00a0\u00a0cudaFree(d_B.elements);\n\u00a0\u00a0\u00a0\u00a0cudaFree(d_C.elements);\n}\n\n// Matrix multiplication kernel called by MatMul()\n__global__ void MatMulKernel(Matrix A, Matrix B, Matrix C) {\n\u00a0\u00a0\u00a0\u00a0// Block row and column\n\u00a0\u00a0\u00a0\u00a0int blockRow = blockIdx.y;\n\u00a0\u00a0\u00a0\u00a0int blockCol = blockIdx.x;\n\n\u00a0\u00a0\u00a0\u00a0// Each thread block computes one sub-matrix Csub of C\n\u00a0\u00a0\u00a0\u00a0Matrix Csub = GetSubMatrix(C, blockRow, blockCol);\n\n\u00a0\u00a0\u00a0\u00a0// Each thread computes one element of Csub\n\u00a0\u00a0\u00a0\u00a0// by accumulating results into Cvalue\n\u00a0\u00a0\u00a0\u00a0float Cvalue = 0;\n\n\u00a0\u00a0\u00a0\u00a0// Thread row and column within Csub\n\u00a0\u00a0\u00a0\u00a0int row = threadIdx.y;\n\u00a0\u00a0\u00a0\u00a0int col = threadIdx.x;\n\n\u00a0\u00a0\u00a0\u00a0// Loop over all the sub-matrices of A and B that are\n\u00a0\u00a0\u00a0\u00a0// required to compute Csub\n\u00a0\u00a0\u00a0\u00a0// Multiply each pair of sub-matrices together\n\u00a0\u00a0\u00a0\u00a0// and accumulate the results\n\u00a0\u00a0\u00a0\u00a0for (int m = 0; m &lt; (A.width / BLOCK_SIZE); ++m) {\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Get sub-matrix Asub of A\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Matrix Asub = GetSubMatrix(A, blockRow, m);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Get sub-matrix Bsub of B\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Matrix Bsub = GetSubMatrix(B, m, blockCol);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Shared memory used to store Asub and Bsub respectively\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0__shared__ float As[BLOCK_SIZE][BLOCK_SIZE];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0__shared__ float Bs[BLOCK_SIZE][BLOCK_SIZE];\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Load Asub and Bsub from device memory to shared memory\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Each thread loads one element of each sub-matrix\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0As[row][col] = GetElement(Asub, row, col);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Bs[row][col] = GetElement(Bsub, row, col);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Synchronize to make sure the sub-matrices are loaded\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// before starting the computation\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0__syncthreads();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Multiply Asub and Bsub together\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int e = 0; e &lt; BLOCK_SIZE; ++e)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Cvalue += As[row][e] * Bs[e][col];\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Synchronize to make sure that the preceding\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// computation is done before loading two new\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// sub-matrices of A and B in the next iteration\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0__syncthreads();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0// Write Csub to device memory\n\u00a0\u00a0\u00a0\u00a0// Each thread writes one element\n\u00a0\u00a0\u00a0\u00a0SetElement(Csub, row, col, Cvalue);\n}\n</code></pre>"},{"location":"distributed_computing/gpu/opencl/opencl.html","title":"OpenCL","text":"<p>Open Computing Language\uff0c\u5f00\u653e\u8fd0\u7b97\u8bed\u8a00</p> <p>OpenCL \u4e0d\u4ec5\u53ef\u4ee5\u5728\u5404\u4e2a\u54c1\u724c\u7684\u663e\u5361\u4e0a\u4f7f\u7528\uff0c\u8fd8\u652f\u6301 CPU \u3001Cell\u3001FPGA \u3001\u4ee5\u53ca  DSP\uff08\u6570\u5b57\u4fe1\u53f7\u5904\u7406\u5668\uff09\u7b49\u5176\u4ed6\u7c7b\u578b\u7684\u5904\u7406\u5668\u3002</p>"},{"location":"distributed_computing/gpu/rocm/hip.html","title":"HIP","text":"<p>HIP is a C++ runtime API \u3002\u6211\u4eec\u4f7f\u7528C++\u8bed\u8a00\uff0c\u53ef\u4ee5\u8c03\u7528HIP\u7684API\u6765\u8fdb\u884c\u7f16\u7a0b\u3002HIP\u53ef\u4ee5\u8fd0\u884c\u5728ROCm\u5e73\u53f0\uff0c\u4e5f\u53ef\u4ee5\u8fd0\u884c\u5728CUDA\u5e73\u53f0\u3002</p>"},{"location":"distributed_computing/gpu/rocm/hip.html#cuda","title":"Cuda \u517c\u5bb9\u6027","text":"<p>Runtime Support</p> <p>Not Support</p>"},{"location":"distributed_computing/gpu/rocm/hip.html#cudahip","title":"CUDA\u8f6cHIP","text":"<p>A \u5361\u548c N \u5361\u5728 warp size \u4e0a\u6709\u5dee\u5f02\uff0c\u5728\u5bf9\u79fb\u690d\u4ee3\u7801\u8fdb\u884c\u6027\u80fd\u4f18\u5316\u65f6\u4e5f\u9700\u8981\u8003\u8651\u3002</p> <p>HIP\u63d0\u4f9b\u4e86\u79fb\u690d\u5de5\u5177 \u201chipify\u201d\uff0c\u53ef\u4ee5\u5e2e\u52a9\u4f60\u5c06cuda\u6e90\u4ee3\u7801\u8f6c\u6362\u6210HIP\uff0c\u4e0e\u539f\u59cb\u7684CUDA\u5e94\u7528\u7a0b\u5e8f\u76f8\u6bd4\u6ca1\u6709\u5f00\u9500\u3002</p> <p>\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u901a\u8fc7 \u201dcuda\u201c \u548c \u201dhip\u201c\u5b57\u7b26\u7684\u76f8\u4e92\u66ff\u6362\uff08e.g. cudaMalloc -&gt; hipMalloc\uff09\uff0c\u53ef\u4ee5\u5728\u6e90\u7801\u7ea7\u522b\u5b8c\u6210\u79fb\u690d</p>"},{"location":"distributed_computing/ray/paper.html","title":"Paper","text":"<p>[toc]</p>"},{"location":"distributed_computing/ray/paper.html#ray-a-distributed-framework-for-emerging-ai-application","title":"Ray : A Distributed Framework for Emerging AI Application","text":"<p>Ray\uff1a\u5df2\u6709\u7684\u7cfb\u7edf\u65e0\u6cd5\u540c\u4f7f\u6ee1\u8db3AI\u8bad\u7ec3\u3001\u6a21\u62df\u548c\u670d\u52a1\u3002</p> <ul> <li>\u5206\u5e03\u5f0f\u6846\u67b6\uff0c\u5c06\u8bad\u7ec3\u3001\u6a21\u62df\u548c\u670d\u52a1\u4e8e\u65b0\u5174RL\u5e94\u7528\u7a0b\u5e8f\u7684\u5fc5\u8981\u7ec4\u4ef6\u7ed3\u5408\u8d77\u6765\u3002</li> <li>\u5728\u52a8\u6001\u4efb\u52a1\u6267\u884c\u5f15\u64ce\u4e4b\u4e0a\u7edf\u4e00\u4e86\u53c2\u4e0e\u8005(actor)\u548c\u4efb\u52a1(task)\u5e76\u884c\u62bd\u8c61\u3002</li> <li>\u53ef\u6269\u5c55\u6027\uff0c\u63a7\u5236\u72b6\u6001\u5b58\u50a8\u5728\u5206\u7247\u5143\u6570\u636e\u5b58\u50a8\uff0c\u81ea\u4e0b\u800c\u4e0a\u7684\u5206\u5e03\u5f0f\u8c03\u5ea6\u7b56\u7565\u3002</li> </ul> <p>\u5f3a\u5316\u5b66\u4e60\u7cfb\u7edf\u4e09\u8981\u7d20\uff1a\u8bad\u7ec3\uff0c\u6a21\u62df\uff0c\u670d\u52a1</p> <p></p> <p>\u6beb\u79d2\u7ea7\u7684\u5ef6\u8fdf\u6bcf\u79d2\u5904\u7406\u6570\u767e\u4e07\u4e2a\u5f02\u6784\u4efb\u52a1</p> <ul> <li>\u5206\u5e03\u5f0f\u8c03\u5ea6\uff1b</li> <li>\u5206\u5e03\u5f0f\u5143\u6570\u636e\u5b58\u50a8\u3002</li> </ul> <p>\u65e0\u72b6\u6001\u7684Task\uff0c\u548c\u6709\u72b6\u6001\u7684Actor\u3002</p> \u540d\u79f0 \u63cf\u8ff0 futures = f.remote(args) \u8fdc\u7a0b\u6267\u884c\u51fd\u6570f.remote()\u53ef\u4ee5\u63a5\u53d7\u5bf9\u8c61\u6216\u671f\u8d27\u4f5c\u4e3a\u8f93\u5165\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u6216\u591a\u4e2a\u671f\u8d27\u3002\u8fd9\u662f\u975e\u963b\u585e\u7684 objects = ray.get(futures) \u8fd4\u56de\u4e0e\u4e00\u4e2a\u6216\u591a\u4e2a\u671f\u8d27\u5173\u8054\u7684\u503c\u3002\u8fd9\u662f\u963b\u585e ready futures = ray.wait(futures,k,timeout) \u4e00\u65e6k\u5b8c\u6210\u6216\u8d85\u65f6\uff0c\u8fd4\u56de\u76f8\u5e94\u4efb\u52a1\u5df2\u5b8c\u6210\u7684\u671f\u8d27\u3002 actor = Class.remote(args)\u6216futures = actor.method.remote(args) \u5c06class\u7c7b\u5b9e\u4f8b\u5316\u4e3a\u8fdc\u7a0b\u53c2\u4e0e\u8005\uff0c\u5e76\u8fd4\u56de\u5b83\u7684\u53e5\u67c4\u3002\u8c03\u7528\u8fdc\u7a0b\u53c2\u4e0e\u8005\u4e0a\u7684\u65b9\u6cd5\u5e76\u8fd4\u56de\u4e00\u4e2a\u6216\u591a\u4e2a\u671f\u8d27\u3002\u4e24\u8005\u90fd\u662f\u963b\u585e\u3002 <p>\u5141\u8bb8\u5d4c\u5957\u7684\u8fdc\u7a0b\u51fd\u6570\u3002</p>"},{"location":"distributed_computing/ray/paper.html#_1","title":"\u4ecb\u7ecd","text":"<p>\u5927\u6570\u636e  --&gt;\u3000\u8ba1\u7b97\u5904\u7406\u6846\u67b6\uff08\u6279\u5904\u7406\u3001\u6d41\u5904\u7406\u3001\u56fe\u5904\u7406\uff09</p> <p>\u9762\u5411\u6570\u636e\u7684\u5e94\u7528 --&gt; AI \u6216\u8005 \u673a\u5668\u5b66\u4e60\uff0c\u6df1\u5ea6\u5b66\u4e60\u7f51\u7edc\uff0cAI\u6846\u67b6\uff08Tensorflow\u3001PyTorch\u3001MxNet\uff09</p> <p>\u65b0\u5174\u7684AI\u5e94\u7528 --&gt; \u5f3a\u5316\u5b66\u4e60\uff08\u52a8\u6001\u73af\u5883\uff0c\u5b9e\u65f6\u53cd\u5e94\uff09\uff0c\u4ee3\u8868\uff1aAlphaGo</p> <p>The central goal of an RL application is to learn a policy-a mapping from the state of the environment to a choice of action\u2014that yields effective performance over time, e.g., winning a game or piloting a drone.</p> <p>\u5f3a\u5316\u5b66\u4e60\u7cfb\u7edf\u8981\u6c42\uff1a</p> <ul> <li>\u7ec6\u7c92\u5ea6(fine-grained)\u8ba1\u7b97\uff0crendering actions in milliseconds when interacting   with the real world\uff1b</li> <li>\u652f\u6301\u65f6\u95f4\uff08\u4e00\u6b21\u6a21\u62df\u7684\u65f6\u95f4\u53ef\u80fd\u662f\u6beb\u79d2\u5230\u5c0f\u65f6\u7ea7\u522b\uff09\u548c\u8d44\u6e90\u7684\u5f02\u6784\uff08GPU\u8bad\u7ec3\uff0cCPU\u6a21\u62df\uff09\uff1b</li> <li>\u52a8\u6001\u8c03\u5ea6\uff08\u4eff\u771f\u7ed3\u679c\u6216\u8005\u73af\u5883\u7684\u4ea4\u4e92\u4f1a\u6539\u53d8\u672a\u6765\u7684\u8ba1\u7b97\uff09</li> </ul>"},{"location":"distributed_computing/ray/paper.html#_2","title":"\u4f53\u7cfb\u7ed3\u6784","text":""},{"location":"distributed_computing/ray/paper.html#_3","title":"\u5e94\u7528\u5c42","text":"<ul> <li>driver\uff1a\u6267\u884c\u7528\u6237\u7a0b\u5e8f\u7684\u8fdb\u7a0b\uff1b</li> <li>worker\uff1a\u6267\u884c\u7531\u9a71\u52a8\u7a0b\u5e8f\u6216\u5176\u4ed6worker\u7a0b\u5e8f\u8c03\u7528\u7684\u4efb\u52a1(\u8fdc\u7a0b\u51fd\u6570)\u7684\u65e0\u72b6\u6001\u8fdb\u7a0b\u3002</li> <li>actor\uff1a\u6709\u72b6\u6001\u7684\u8fdb\u7a0b\uff0c\u5728\u8c03\u7528\u65f6\u53ea\u6267\u884c\u5b83\u516c\u5f00\u7684\u65b9\u6cd5\u3002</li> </ul>"},{"location":"distributed_computing/ray/paper.html#_4","title":"\u7cfb\u7edf\u5c42","text":"<ul> <li> <p>\u5168\u5c40\u5b58\u50a8\u63a7\u5236GCS\uff1a\u4fdd\u6301\u7cfb\u7edf\u7684\u5bb9\u9519\u6027\u548c\u4f4e\u5ef6\u8fdf\uff0c\u6bcf\u79d2\u53ef\u52a8\u6001\u751f\u6210\u6570\u767e\u4e07\u4e2a\u4efb\u52a1\u3002</p> </li> <li> <p>\u5177\u6709pub-sub\u7684KV\u5b58\u50a8\uff0c\u5206\u7247(shard)\u7684\u65b9\u5f0f\u5b9e\u73b0\u6269\u5c55\uff0c\u6bcf\u4e2a\u5207\u7247\u94fe\u5f0f\u590d\u5236\u5b9e\u73b0\u5bb9\u9519\u3002</p> </li> <li> <p>\u5c06\u5bf9\u8c61\u7684\u5143\u6570\u636e\u5b58\u50a8\u5728 GCS \u4e2d\u800c\u4e0d\u662f\u8c03\u5ea6\u5668\u91cc\uff0c\u4ece\u800c\u5c06\u4efb\u52a1\u5206\u6d3e\u4e0e\u4efb\u52a1\u8c03\u5ea6\u5b8c\u5168\u89e3\u8026\u3002</p> </li> <li> <p>\u5206\u5e03\u5f0f\u8c03\u5ea6\uff1a\u6ee1\u8db3\u6570\u636e\u672c\u5730\u6027\u548c\u6bcf\u79d2\u767e\u4e07\u7ea7\u7684\u8c03\u5ea6</p> </li> <li> <p>\u5168\u5c40\u8c03\u5ea6\u7a0b\u5e8f\u548c\u8282\u70b9\u672c\u5730\u8c03\u5ea6\u7a0b\u5e8f\u7ec4\u6210\u7684\u4e24\u7ea7\u5c42\u6b21\u8c03\u5ea6\u7a0b\u5e8f\u3002</p> </li> <li>\u81ea\u4e0b\u5411\u4e0a\u7684\u8c03\u5ea6\uff0c\u4efb\u52a1\u5148\u63d0\u4ea4\u5230\u672c\u5730\u8c03\u5ea6\u7a0b\u5e8f\u3002</li> </ul> <p></p> <p>\u6ce8\uff1a\u5728 0.5 \u7248\u672c\u4e4b\u540e\uff0c\u5168\u5c40\u8c03\u5ea6\u5668\u5df2\u7ecf\u88ab\u53bb\u6389\uff0c\u53d8\u6210\u4e00\u4e2a\u53bb\u4e2d\u5fc3\u5316\u7684\u8c03\u5ea6\u67b6\u6784\uff0c\u5e76\u4e14\u5e76\u6ca1\u6709\u5148\u5c06\u4efb\u52a1\u4f18\u5148\u63d0\u4ea4\u5230\u672c\u5730\u3002\u5f53\u7136\uff0c\u8bbe\u8ba1\u8fd8\u5728\u6839\u636e\u5b9e\u73b0\u60c5\u51b5\u4e0d\u65ad\u53d8\u5316\u4e2d\u3002</p> <ul> <li> <p>\u5206\u5e03\u5f0f\u5bf9\u8c61\u5b58\u50a8\uff1a\u5185\u5b58\u4e2d\u7684\u5206\u5e03\u5f0f\u5b58\u50a8\u7cfb\u7edf\u6765\u5b58\u50a8\u6bcf\u4e2a\u4efb\u52a1\u6216\u65e0\u72b6\u6001\u8ba1\u7b97\u7684\u8f93\u5165\u548c\u8f93\u51fa</p> </li> <li> <p>\u540c\u4e00\u8282\u70b9\u4e0a\u5171\u4eab\u5185\u5b58\uff0c\u4e0d\u540c\u4efb\u52a1\u4ee5\u96f6\u62f7\u8d1d\u7684\u4ee3\u4ef7\u8fdb\u884c\u6570\u636e\u5171\u4eab\uff0c\u6570\u636e\u683c\u5f0f\u7528Apache Arrow\uff1b</p> </li> <li>\u5bf9\u8c61\u5b58\u50a8\u53ea\u63a5\u53d7\u4e0d\u53ef\u53d8\u6570\u636e\uff0c\u4e0d\u652f\u6301\u5206\u5e03\u5f0f\u7684\u5bf9\u8c61</li> </ul>"},{"location":"distributed_computing/ray/paper.html#_5","title":"\u6267\u884c\u793a\u4f8b\u6d41\u7a0b","text":""},{"location":"distributed_computing/ray/ray.html","title":"Ray","text":"<p>[toc]</p>"},{"location":"distributed_computing/ray/ray.html#ray","title":"Ray","text":"<p>Fast and Simple Distributed Computing</p> <p>Build any application at any scale.</p>"},{"location":"distributed_computing/spark/index.html","title":"Spark","text":""},{"location":"distributed_computing/spark/index.html#spark_1","title":"Spark\u57fa\u672c\u539f\u7406\u3001\u6784\u67b6\u548c\u7f16\u7a0b\u6280\u672f","text":"<ul> <li>\u4e3a\u4ec0\u4e48\u4f1a\u6709Spark\uff1f</li> <li>Spark\u4e3b\u8981\u4f53\u7cfb\u7ed3\u6784\u548c\u7ec4\u4ef6\uff1f</li> <li>Spark\u96c6\u7fa4\u7684\u4e3b\u8981\u6784\u6210\uff1f</li> <li>Spark\u5e94\u7528\u7a0b\u5e8f\u7684\u4e3b\u8981\u7ed3\u6784\uff1f</li> <li>\u3002\u3002\u3002</li> </ul>"},{"location":"distributed_computing/spark/index.html#spark_2","title":"Spark\u57fa\u672c\u6982\u5ff5","text":"Term Meaning Application User program built on Spark. Consists of  a driver program and executors on the cluster. Application jar A jar containing the user's Spark  application. In some cases users will want to create an \"uber jar\"  containing their application along with its dependencies. The user's jar  should never include Hadoop or Spark libraries, however, these will be added  at runtime. Driver program The process running the main() function of  the application and creating the SparkContext Cluster manager An external service for acquiring resources  on the cluster (e.g. standalone manager, Mesos, YARN) Deploy mode Distinguishes where the driver process runs.  In \"cluster\" mode, the framework launches the driver inside of the  cluster. In \"client\" mode, the submitter launches the driver  outside of the cluster. Worker node Any node that can run application code in the  cluster Executor A process launched for an application on a  worker node, that runs tasks and keeps data in memory or disk storage across  them. Each application has its own executors. Task A unit of work that will be sent to one  executor Job A parallel computation consisting of  multiple tasks that gets spawned in response to a Spark action (e.g. save, collect); you'll see this term used in the driver's logs. Stage Each job gets divided into smaller sets of  tasks called stages that  depend on each other (similar to the map and reduce stages in MapReduce);  you'll see this term used in the driver's logs."},{"location":"distributed_computing/spark/index.html#spark_3","title":"Spark\u5185\u90e8\u539f\u7406","text":"<ul> <li>Shuffle\u7684\u51e0\u79cd\u65b9\u5f0f\u53ca\u5176\u533a\u522b</li> <li>\u5e8f\u5217\u5316\u65b9\u5f0f\u53ca\u5176\u4f7f\u7528\u573a\u666f</li> <li>\u51fd\u6570\u7684\u95ed\u5305\u6e05\u7406</li> </ul>"},{"location":"distributed_computing/spark/index.html#spark_4","title":"Spark\u6027\u80fd\u8c03\u4f18","text":"<ul> <li>\u5bf9\u6bd4kryo\u548cjava\u539f\u751f\u7684\u5e8f\u5217\u5316\u6027\u80fd\uff1f</li> <li>Spark Web UI\u7684\u67e5\u770b\uff0c\u53ca\u6307\u6807\u5206\u6790\uff1f</li> <li>\u6570\u636e\u503e\u659c\uff0c\u600e\u4e48\u89e3\u51b3\uff1f</li> <li>\u5e76\u53d1\u5ea6\u600e\u4e48\u914d\u7f6e\uff1f</li> <li>GC\u4fe1\u606f\u600e\u4e48\u67e5\u770b\uff0c\u5404\u4e2a\u5b57\u6bb5\u4ee3\u8868\u4ec0\u4e48\u610f\u4e49\uff0c\u5982\u4f55\u4f18\u5316GC\u6027\u80fd\uff1f</li> </ul>"},{"location":"distributed_computing/spark/index.html#spark_5","title":"Spark\u4ee3\u7801\u5b9e\u6218","text":"<ul> <li>\u5165\u95e8\u7ea7\uff1aword count\u7b97\u6cd5\u5e76\u884c\u5316\u5b9e\u73b0\u548c\u6027\u80fd\u5206\u6790\uff1f</li> <li>\u8fdb\u9636\u7ea7\uff1aKmeans\u7b97\u6cd5\u5e76\u884c\u5316\u5b9e\u73b0\u548c\u6027\u80fd\u5206\u6790\uff1f</li> <li>\u6bd5\u4e1a\u7ea7\uff1aFDTD3d\u7684\u4ee3\u7801\u5e76\u884c\u5316\u5b9e\u73b0\u548c\u6027\u80fd\u5206\u6790\uff1f</li> </ul> <p>Spark SQL</p> <p>Spark Graph</p> <p>Spark Streaming</p> <p>Spark MLlib</p>"},{"location":"distributed_computing/spark/index.html#_1","title":"\u53c2\u8003\u8d44\u6599","text":""},{"location":"distributed_computing/spark/index.html#_spark-definitive_guide_2018","title":"\u4e66\u7c4d_Spark Definitive_Guide_2018","text":""},{"location":"distributed_computing/spark/index.html#ppt_spark","title":"PPT_Spark\u539f\u7406\u3001\u67b6\u6784\u3001\u7f16\u7a0b","text":""},{"location":"distributed_computing/spark/profile_tools.html","title":"Profile tools","text":"<p>[toc]</p>"},{"location":"distributed_computing/spark/profile_tools.html#_1","title":"\u6027\u80fd\u5206\u6790\u5de5\u5177","text":""},{"location":"distributed_computing/spark/profile_tools.html#spark","title":"Spark \u539f\u751f","text":""},{"location":"distributed_computing/spark/profile_tools.html#spark-metrics","title":"Spark Metrics","text":""},{"location":"distributed_computing/spark/profile_tools.html#advanced-instrumentation","title":"Advanced Instrumentation","text":"<p>\u5206\u6790Spark jobs\u7684\u5de5\u5177:  \u5bf9\u4e8e\u591a\u4f5c\u4e1a\u540c\u65f6\u8fd0\u884c\uff0c\u96be\u4ee5\u5206\u6790\u6bcf\u4e2a\u5e94\u7528\u7684\u6027\u80fd\uff1b</p> <ul> <li>\u96c6\u7fa4\u7ea7\u522b\u7684\u76d1\u63a7\u5de5\u5177\uff1a\u5982 Ganglia, \u63d0\u4f9b\u96c6\u7fa4\u6574\u4f53\u5229\u7528\u7387\u548c\u8d44\u6e90\u74f6\u9888\u5206\u6790\uff1b</li> <li>OS\u5206\u6790\u5de5\u5177\uff1a\u5982 dstat, iostat, \u548c iotop\uff1b</li> <li>JVM\u7cfb\u5217\u5de5\u5177\uff1a\u5982 <code>jstack</code>\u63d0\u4f9b\u6808\u5206\u6790, <code>jmap</code>\u5206\u6790\u5806\u5feb\u7167\uff0c<code>jstat</code> \u62a5\u544a\u65f6\u95f4\u5e8f\u5217\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c <code>jconsole</code>\uff0c<code>jvisualvm</code>\uff0c<code>jmc</code>\u7b49\u3002</li> </ul> <p>Spark\u63d0\u4f9b\u63d2\u4ef6API\uff0c\u652f\u6301\u5728\u5e94\u7528\u4e2d\u6dfb\u52a0<code>custom instrumentation code</code>\uff1a</p> <ul> <li><code>spark.plugins</code></li> <li><code>spark.plugins.defaultList</code></li> </ul> <p>\u652f\u6301\u201c,\u201d\u5206\u9694\u7684\u7c7b\u540d\uff08\u5b9e\u73b0 <code>org.apache.spark.api.plugin.SparkPlugin</code> \u63a5\u53e3\uff09\u3002</p> <ul> <li>\u786e\u4fdd\u81ea\u5b9a\u4e49\u7684plugin\u7684jar\u5305\uff0cspark\u5e94\u7528\u53ef\u89c1\uff1b</li> </ul>"},{"location":"distributed_computing/spark/profile_tools.html#uber-jvm-profiler","title":"Uber JVM Profiler","text":"<p>\u89c1 spark\u7684executor\u7684\u6027\u80fd\u5206\u6790\u4f7f\u7528</p>"},{"location":"distributed_computing/spark/profile_tools.html#_2","title":"\u95ee\u9898\u5206\u6790","text":"<p>https://github.com/g1thubhub/phil_stopwatch</p> <p>https://g1thubhub.github.io/4-bigdata-riddles</p>"},{"location":"distributed_computing/spark/profile_tools.html#_3","title":"\u9700\u8981\u7684\u76d1\u63a7\u529f\u80fd","text":"<p>\u6a2a\u8f74\uff1a</p> <ul> <li>\u65f6\u95f4</li> <li>Stage\u7684\u5f00\u59cb\u548c\u7ed3\u675f\u8282\u70b9\uff1b\uff08Spark Timeline\uff09</li> <li>Task\u7684\u5f00\u59cb\u548c\u7ed3\u675f\u8282\u70b9\uff1b\uff08Spark Timeline\uff0c\u4f46\u662f\u6ca1\u6709\u6574\u5408\u6240\u6709Stage\u7684Task\u7684\u540c\u4e00\u4e2a\u89c6\u56fe\uff09</li> </ul> <p>\u65f6\u95f4\u4f5c\u4e3a\u6a2a\u8f74\uff1a</p> <ul> <li>\u8fdb\u7a0b\u7684CPU\u4f7f\u7528\u7387\uff1b\uff08\u975e\u5e38\u6709\u7528\uff09</li> <li>\u8fdb\u7a0b\u7684\u5185\u5b58\u4f7f\u7528\u7387\uff0c\u5806\u548c\u975e\u5806\u5185\u5b58\uff1b\uff08\u5206\u914d\u5408\u9002\u7684\u5185\u5b58\uff09</li> <li>\u540c\u4e00\u65f6\u95f4\u5e76\u53d1\u7684\u4efb\u52a1\u6570\uff1b\u4efb\u52a1\u7684\u6267\u884c\u65f6\u5e8f\u56fe\uff1b</li> <li>\u8282\u70b9\u7684CPU\u4f7f\u7528\u7387\uff1b\uff08\u76d1\u63a7\u8f6f\u4ef6\u53ef\u770b\uff09</li> <li>\u8282\u70b9\u7684\u5185\u5b58\u4f7f\u7528\u7387\uff1b\uff08\u76d1\u63a7\u8f6f\u4ef6\u53ef\u770b\uff09</li> </ul>"},{"location":"distributed_computing/spark/profile_tools.html#the-fatso","title":"The Fatso\uff08\u74f6\u9888\u70b9\uff09","text":"<p>\u9700\u8981\u5bf9 JVM \u8fdb\u884c\u5806\u6808\u8fdb\u884cprofile\uff0c\u627e\u51fa\u8017\u65f6\u7684\u51fd\u6570\u3002</p>"},{"location":"distributed_computing/spark/profile_tools.html#the-straggler","title":"The Straggler\uff08\u62d6\u540e\u817f\u8005\uff09","text":"<p>\u901a\u8fc7Task\u7684\u5f00\u59cb\u548c\u7ed3\u675f\u65f6\u95f4\uff0c\u53ef\u4ee5\u627e\u51faStraggler\u3002</p> <p>\u901a\u8fc7\u540c\u4e00\u65f6\u95f4\u7684\u5e76\u53d1\u4efb\u52a1\u6570\uff0c\u53ef\u4ee5\u627e\u51faStraggler\uff08\u6709\u7684\u65f6\u95f4\u53ea\u6709\u6781\u5c11\u6570\u5e76\u53d1\uff09\u3002</p>"},{"location":"distributed_computing/spark/profile_tools.html#the-slacker","title":"The Slacker\uff08\u61d2\u60f0\u8005\uff09","text":"<p>cpu\u5229\u7528\u7387\u4f4e\uff1f\u7cfb\u7edf\u5927\u90e8\u5206\u7a7a\u95f2\uff0cstage\u662f\u548c\u5916\u90e8DB\u6216\u8005HDFS\u8fdb\u884c\u4ea4\u4e92\uff0c\u6ca1\u6709\u4f7f\u7528\u8db3\u591f\u7684\u5199\u5206\u533a\u3002</p> <p>\u901a\u8fc7CPU profile\u548c\u706b\u7130\u56fe\uff0c\u53ef\u4ee5\u770b\u51fa\u51fd\u6570\u8017\u65f6\u4f46CPU\u5229\u7528\u7387\u4e0d\u9ad8\uff0c\u5728\u505aIO\u7684\u4e8b\u60c5\u3002</p>"},{"location":"distributed_computing/spark/profile_tools.html#the-heckler","title":"The Heckler","text":"<p>\u7b2c\u4e09\u65b9\u5e93\u4e2d\u6bd4\u8f83\u91cd\u7684\u5bf9\u8c61\u521b\u5efa\u4f7f\u7528\u65b9\u5f0f\uff1a</p> <ul> <li>\u6bcf\u6761\u8bb0\u5f55\u521b\u5efa\u4e00\u4e2a\uff0cmap</li> <li>\u6bcf\u4e2a\u5206\u533a\u521b\u5efa\u4e00\u4e2a\uff0cmapPartition</li> <li>\u591a\u7ebf\u7a0b\u5b89\u5168\uff0c\u5219Broadcast\uff0c\u6bcf\u4e2aexecutor\u4e00\u4e2a</li> </ul> <p>\u4ece\u65e5\u5fd7\u4e2d\u622a\u53d6\u4fe1\u606f\uff0c\u6b63\u5219\u5339\u914d\uff0c\u83b7\u53d6Top N\u8fdb\u884c\u5c55\u793a\uff1b</p> <p>\u5d29\u6e83\u7684\u539f\u56e0\u901a\u5e38\u4e0d\u662f\u5f88\u660e\u663e\uff0c\u9700\u8981\u5bf9\u65e5\u5fd7\u6587\u4ef6\u8fdb\u884c\u7b5b\u9009\uff0c\u4ece\u65e5\u5fd7\u4e2d\u5c31\u622a\u53d6\u9519\u8bef\u4fe1\u606f\uff0c\u6309\u65f6\u95f4\u987a\u5e8f\u5012\u6392\u663e\u793a</p>"},{"location":"distributed_computing/spark/profile_tools.html#sparklens","title":"Sparklens","text":""},{"location":"distributed_computing/spark/profile_tools.html#_4","title":"\u524d\u8a00","text":"<p>2021/10/18</p> <p>\u9020\u6210 Spark \u4efb\u52a1\u6027\u80fd\u4f4e\u4e0b\u7684\u539f\u56e0\u4e3b\u8981\u6709 3 \u4e2a\uff1a</p> <ul> <li>Driver \u8ba1\u7b97\u65f6\u95f4\u957f\uff1b</li> <li>\u5b58\u5728\u4efb\u52a1\u503e\u659c\uff1b</li> <li>\u4efb\u52a1\u6570\u4e0d\u591f\uff0c\u5b58\u5728\u5e76\u884c\u5ea6\u95ee\u9898\uff1b</li> </ul> <p>\u6839\u636e\u60c5\u51b5\uff0c\u53ef\u4ee5\u5b9e\u73b0\u4e24\u4e2a\u4f18\u5316\u76ee\u6807\uff1a</p> <ul> <li>\u51cf\u5c11\u5e94\u7528\u7a0b\u5e8f\u7684\u8fd0\u884c\u65f6\u95f4\uff1b</li> <li>\u901a\u8fc7\u4f7f\u7528\u66f4\u5c11\u7684\u8d44\u6e90\u4f7f\u5176\u66f4\u597d\u5730\u5de5\u4f5c\uff1b</li> </ul> <p>\u200b       \u4efb\u4f55 Spark \u5e94\u7528\u7a0b\u5e8f\u7684\u6027\u80fd\u90fd\u53ef\u901a\u8fc7 Yarn Web UI \u6216 Spark Web UI \u6765\u89c2\u5bdf\uff0c\u4f46\u6ca1\u6709\u63d0\u4f9b\u8be6\u7ec6\u6307\u6807\u3002\u73b0\u6709\u591a\u79cd\u5de5\u5177\u53ef\u7528\u4e8e Spark \u6027\u80fd\u76d1\u63a7\uff0c\u63d0\u4f9b\u4e86\u66f4\u8be6\u7ec6\u7684\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\u7ec6\u8282\uff1a</p> <ul> <li>Sparklens</li> <li>Sparklint\uff1a\u6700\u65b0\u7248\u672c2018\u5e74</li> <li>Dr. Elephant\uff1aA job and flow-level performance monitoring and tuning tool for Apache Hadoop and Apache Spark</li> <li>SparkOscope \uff1a\u6700\u65b0\u7248\u672c2017\u5e74</li> </ul>"},{"location":"distributed_computing/spark/profile_tools.html#sparklens_1","title":"\u4e00\u3001\u4ec0\u4e48\u662f Sparklens","text":"<p>Sparklens \u662f\u4e00\u4e2a\u5185\u7f6e Spark Scheduler \u6a21\u62df\u5668\u7684 Spark \u5206\u6790\u548c\u6027\u80fd\u9884\u6d4b\u5de5\u5177\u3002</p> <p>Sparklens \u4f5c\u7528\uff1a</p> <ul> <li>\u4f7f\u7528\u6237\u66f4\u5bb9\u6613\u7406\u89e3 Spark \u4efb\u52a1\u7684\u53ef\u4f38\u7f29\u6027\u9650\u5236\u3002</li> <li>\u6709\u52a9\u4e8e\u4e86\u89e3\u7ed9\u5b9a Spark \u4efb\u52a1\u4f7f\u7528\u7684\u8ba1\u7b97\u8d44\u6e90\u7684\u6548\u7387\u3002</li> <li>\u63d0\u4f9b Spark \u4efb\u52a1\u5404\u4e2a\u9636\u6bb5\u7684\u5404\u79cd\u4fe1\u606f\u3002</li> <li>\u63d0\u4f9b\u4e86\u53ef\u7528\u4e8e\u4f18\u5316\u7684\u540e\u7eed\u6b65\u9aa4\u7684\u60f3\u6cd5\u3002</li> <li>\u6709\u52a9\u4e8e\u5c06 Spark \u5e94\u7528\u7a0b\u5e8f\u8c03\u4f18\u4f5c\u4e3a\u4e00\u79cd\u5b9a\u4e49\u660e\u786e\u7684\u65b9\u6cd5/\u8fc7\u7a0b\u3002</li> </ul>"},{"location":"distributed_computing/spark/profile_tools.html#sparklens_2","title":"\u4e8c\u3001\u5982\u4f55\u4f7f\u7528Sparklens","text":"<p>\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u4f7f\u7528 Sparklens\uff1a</p> <ul> <li>\u548c Spark \u4efb\u52a1\u4e00\u540c\u8fd0\u884c\uff1b</li> <li>\u5728 Spark \u4efb\u52a1\u8fd0\u884c\u540e\u8fd0\u884c\uff1b</li> <li>\u4ece event-log \u91cc\u83b7\u53d6\u62a5\u544a\uff1b</li> </ul> <p><code>sparklens_2.11-0.3.2.jar</code> \u4ee5 scala-2.11 \u7f16\u8bd1\uff0c\u786e\u4fddScala\u548cJava\u7248\u672c\u4e0eSpark\u96c6\u7fa4\u6240\u9700\u7684\u7248\u672c\u76f8\u5bf9\u5e94\u3002\u76ee\u524d\u652f\u6301\uff0cJava 7/8\u3001Scala 2.11.8\u548cSpark 2.X\u3002  </p> <p>\u4ee5\u4e0b\u64cd\u4f5c\u57fa\u4e8e Spark 2.4.4\u3001Java 8\u3001Scala 2.11.8</p>"},{"location":"distributed_computing/spark/profile_tools.html#1-job","title":"1\u3001\u548c Job \u4e00\u8d77\u8fd0\u884c","text":"<p>\u200b       \u8fd9\u79cd\u65b9\u5f0f\u662f\u6307\u5f53\u4f60\u7684job\u5728\u8fd0\u884c\u7684\u65f6\u5019\uff0cSparklens \u4f1a\u5b9e\u65f6\u7684\u5f00\u59cb\u6536\u96c6job\u7684\u8fd0\u884c\u4fe1\u606f\uff0c\u6700\u540e\u6253\u5370\u7ed3\u679c\u3002</p> <p>\u200b       \u53ea\u8981\u4f60\u7684\u8282\u70b9\u80fd\u8054\u7f51\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u5728\u4f7f\u7528 <code>spark-submit</code> \u6216 <code>spark-shell</code> \u65f6\uff0c\u52a0\u4e0a\u5982\u4e0b\u4e24\u884c\uff08\u5982\u679c\u6ca1\u6709\u7f51\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4ece\u7f51\u4e0a\u4e0b\u8f7d package \u4e4b\u540e\u6253\u5305\u8fd0\u884c\uff09\uff1a</p> <pre><code>--packages qubole:sparklens:0.3.2-s_2.11\n--conf spark.extraListeners=com.qubole.sparklens.QuboleJobListener\n</code></pre> <p>\u4f8b\uff1a</p> <pre><code>spark-submit \\\n--master spark://hadoop004:7077 \\\n--packages qubole:sparklens:0.3.2-s_2.11 \\\n--conf spark.extraListeners=com.qubole.sparklens.QuboleJobListener \\\n--class sparksqltest.SparkSQLtest SparkSQLtest.jar\n</code></pre> <p>\u6216</p> <pre><code>spark-shell \\\n--master spark://hadoop004:7077 \\\n--packages qubole:sparklens:0.3.2-s_2.11 \\\n--conf spark.extraListeners=com.qubole.sparklens.QuboleJobListener\n</code></pre>"},{"location":"distributed_computing/spark/profile_tools.html#2job","title":"2\u3001Job \u8dd1\u5b8c\u4e4b\u540e\u4f7f\u7528","text":"<p>\u200b       \u4f60\u53ef\u4ee5\u9009\u62e9\u4e0d\u5728\u4efb\u52a1\u8fd0\u884c\u65f6\u8fd0\u884c Sparklens\uff0c\u4f46\u5728\u4efb\u52a1\u8fd0\u884c\u540e\u4f7f\u7528 Sparklens\u3002\u8fd9\u79cd\u65b9\u5f0f\u4f1a\u5728\u4f60\u7684 job \u8fd0\u884c\u65f6\u751f\u6210\u4e00\u4e2a Json \u6587\u4ef6\uff0c\u8def\u5f84\u9ed8\u8ba4\u662f /tmp/Sparklens\u3002\u5982\u679c\u4f60\u60f3\u8981\u8bbe\u7f6e\u81ea\u5df1\u7684\u8def\u5f84\uff0c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e spark.sparklens.data.dir \u6765\u5b8c\u6210\u3002</p> <ol> <li>\u9996\u5148\u4f60\u9700\u8981\u5728\u8fd0\u884c\u4f60\u81ea\u5df1\u7684 spark job \u7684\u65f6\u5019\u5728\u63d0\u4ea4\u547d\u4ee4\u91cc\u9762\u52a0\u4e0a\uff1a</li> </ol> <pre><code>--packages qubole:sparklens:0.3.2-s_2.11\n--conf spark.extraListeners=com.qubole.sparklens.QuboleJobListener\n--conf spark.sparklens.reporting.disabled=true\n</code></pre> <ol> <li>\u4e4b\u540e\u6839\u636e\u751f\u6210\u7684 Json \u6587\u4ef6\uff0c\u53e6\u5916\u542f\u52a8\u4e00\u4e2a Job \u6765\u83b7\u53d6\u5206\u6790\u4f60\u7684 Sparklens \u7684\u62a5\u544a\u7ed3\u679c\uff1a</li> </ol> <pre><code>spark-submit \\\n--packages qubole:sparklens:0.3.1-s_2.11 \\\n--class com.qubole.sparklens.app.ReporterApp qubole-dummy-arg &lt;filename&gt;\n</code></pre> <p>\u4f8b\uff0c\u4e4b\u524d\u6240\u793a spark \u4efb\u52a1\u79bb\u7ebf\u8fd0\u884c Sparklens\uff1a</p> <pre><code>spark-submit \\\n--master spark://hadoop004:7077 \\\n--packages qubole:sparklens:0.3.2-s_2.11 \\\n--conf spark.extraListeners=com.qubole.sparklens.QuboleJobListener \\\n--conf spark.sparklens.reporting.disabled=true \\\n--conf spark.sparklens.data.dir=/home/hadoop \\\n--class sparksqltest.SparkSQLtest SparkSQLtest.jar\n</code></pre> <p>\u901a\u8fc7\u63a7\u5236\u53f0\u65e5\u5fd7\u53ef\u67e5\u770b\u751f\u6210\u7684 Json \u6587\u4ef6\u4fdd\u5b58\u8def\u5f84\uff1a</p> <p>Saving sparkLens data to /home/hadoop/app-20211012144030-0017.sparklens.json</p> <p>\u542f\u52a8\u4e00\u4e2a Job \u6765\u83b7\u53d6\u5206\u6790\u4f60\u7684 Sparklens \u7684\u62a5\u544a\u7ed3\u679c\uff1a</p> <pre><code>spark-submit \\\n--packages qubole:sparklens:0.3.2-s_2.11 \\\n--class com.qubole.sparklens.app.ReporterApp qubole-dummy-arg /home/hadoop/app-20211012144030-0017.sparklens.json\n</code></pre>"},{"location":"distributed_computing/spark/profile_tools.html#3event-log","title":"3\u3001\u4eceevent-log\u91cc\u9762\u83b7\u53d6","text":"<p>\u200b       \u8fd9\u79cd\u65b9\u5f0f\u5c31\u662f\u6839\u636e event log \u6765\u751f\u6210 Sparklens \u7684\u62a5\u544a\uff0c\u5f53\u7136\u4f60\u9700\u8981\u5728\u4f60\u7684 spark job \u91cc\u9762 enable event-log\u3002\u8fd9\u79cd\u65b9\u6cd5\u652f\u6301 event log \u6587\u4ef6\u6240\u652f\u6301\u7684\u4efb\u4f55\u6587\u4ef6\u5f62\u5f0f\uff1atext\u3001 snappy\u3001lz4\u3001lzf</p> <pre><code>spark-submit \\\n--packages qubole:sparklens:0.3.1-s_2.11 \\\n--class com.qubole.sparklens.app.ReporterApp qubole-dummy-arg &lt;filename&gt; source=history\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5c06\u4e8b\u4ef6\u5386\u53f2\u6587\u4ef6\u8f6c\u6362\u4e3aSparklens Json\u6587\u4ef6:</p> <pre><code>spark-submit \\\n--packages qubole:sparklens:0.3.2-s_2.11 \\\n--class com.qubole.sparklens.app.EventHistoryToSparklensJson qubole-dummy-arg &lt;srcDir&gt; &lt;targetDir&gt;\n</code></pre> <p>\u4f8b\uff0c\u4e4b\u524d\u6240\u793a spark \u4efb\u52a1\u4ece event-log \u91cc\u83b7\u53d6 Sparklens \u7684\u62a5\u544a\uff1a</p> <pre><code>spark-submit \\\n--master spark://hadoop004:7077 \\\n--conf spark.eventLog.enabled=true \\\n--conf spark.eventLog.dir=/home/hadoop/data \\\n--class sparksqltest.SparkSQLtest SparkSQLtest.jar\n</code></pre> <p>\u4eceevent-log\u91cc\u9762\u83b7\u53d6 Sparklens \u7684\u62a5\u544a\uff1a</p> <pre><code>spark-submit \\\n--packages qubole:sparklens:0.3.2-s_2.11 \\\n--class com.qubole.sparklens.app.ReporterApp qubole-dummy-arg /home/hadoop/data/app-20211012145019-0018 source=history\n</code></pre> <p>\u5c06\u4e8b\u4ef6\u5386\u53f2\u6587\u4ef6\u8f6c\u6362\u4e3a Sparklens Json \u6587\u4ef6:</p> <pre><code>spark-submit \\\n--packages qubole:sparklens:0.3.2-s_2.11 \\\n--class com.qubole.sparklens.app.EventHistoryToSparklensJson qubole-dummy-arg /home/hadoop/data/app-20211012145019-0018 /home/hadoop/data\n</code></pre>"},{"location":"distributed_computing/spark/profile_tools.html#sparklens_3","title":"\u4e09\u3001Sparklens \u62a5\u544a\u63d0\u4f9b\u7684\u8be6\u7ec6\u6027\u80fd\u6307\u6807","text":"<p>Sparklens \u62a5\u544a\u63d0\u4f9b\u975e\u5e38\u8be6\u7ec6\u7684\u7684\u6027\u80fd\u6307\u6807\uff1a</p>"},{"location":"distributed_computing/spark/profile_tools.html#1","title":"1\u3001\u57fa\u4e8e\u4efb\u52a1\u7684\u6c47\u603b\u6307\u6807","text":""},{"location":"distributed_computing/spark/profile_tools.html#2","title":"2\u3001\u4efb\u52a1\u8fd0\u884c\u65f6\u957f","text":"<p>\u200b       job/stage \u65f6\u95f4\u8868\uff0c\u663e\u793a\u4f5c\u4e1a\u4e2d\u5e76\u884c\u9636\u6bb5\u662f\u5982\u4f55\u8c03\u5ea6\u7684\u3002\u8fd9\u4f7f\u5f97\u5728\u4f5c\u4e1a\u7ea7\u522b\u5f88\u5bb9\u6613\u53ef\u89c6\u5316\u5e26\u6709\u9636\u6bb5\u4f9d\u8d56\u6027\u7684DAG\u3002</p> <p></p>"},{"location":"distributed_computing/spark/profile_tools.html#3spark","title":"3\u3001Spark \u662f\u5426\u9ad8\u6548","text":"<p>\u200b       Spark\u4efb\u52a1\u7684\u603b\u65f6\u95f4\u53ef\u4ee5\u5206\u4e3a\u82b1\u8d39\u5728\u9a71\u52a8\u7a0b\u5e8f\u4e0a\u7684\u65f6\u95f4\u548c\u82b1\u8d39\u5728\u6267\u884c\u7a0b\u5e8f\u4e0a\u7684\u65f6\u95f4\u3002\u5f53 Spark \u5e94\u7528\u7a0b\u5e8f\u5728\u9a71\u52a8\u7a0b\u5e8f\u4e0a\u82b1\u8d39\u592a\u591a\u65f6\u95f4\u65f6\uff0c\u5c31\u4f1a\u6d6a\u8d39\u6267\u884c\u7a0b\u5e8f\u7684\u8ba1\u7b97\u65f6\u95f4\u3002</p> <p></p> \u5217\u540d \u8bf4\u660e Driver WallClock \u9a71\u52a8\u7a0b\u5e8f\u5b8c\u6210\u6267\u884c\u6240\u9700\u7684\u603b\u65f6\u95f4\u3002 Executors WallClock \u6240\u6709 executors \u5b8c\u6210\u5176\u6267\u884c\u6240\u82b1\u8d39\u7684\u603b\u65f6\u95f4\u3002 Total WallClock Driver WallClock + Executors WallClock"},{"location":"distributed_computing/spark/profile_tools.html#4","title":"4\u3001\u7406\u60f3\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u65f6\u95f4\u7684\u4f30\u8ba1","text":"<p>\u200b       \u7406\u60f3\u7684\u5e94\u7528\u7a0b\u5e8f\u65f6\u95f4\u662f\u901a\u8fc7\u5047\u8bbe\u5e94\u7528\u7a0b\u5e8f\u7684\u6240\u6709\u9636\u6bb5\u7684\u6570\u636e\u7684\u7406\u60f3\u5206\u533a\uff08\u4efb\u52a1 = \u6838\u5fc3\u548c\u65e0\u504f\u659c\uff09\u6765\u8ba1\u7b97\u7684\u3002</p> <p></p>"},{"location":"distributed_computing/spark/profile_tools.html#5","title":"5\u3001\u6700\u4f73\u6267\u884c\u8005\u6570\u91cf","text":"<p>\u200b       \u53ef\u4ee5\u770b\u5230\u5728\u4efb\u4f55\u7ed9\u5b9a\u65f6\u95f4\u6709\u591a\u5c11\u4e2a executor \u53ef\u7528\u3002Sparklens \u7ed8\u5236\u4e86\u5e94\u7528\u7a0b\u5e8f\u4e2d\u4e0d\u540c Spark \u4f5c\u4e1a\u4f7f\u7528\u7684\u6267\u884c\u7a0b\u5e8f\uff0c\u4ee5\u53ca\u53ef\u4ee5\u5728\u76f8\u540c\u7684\u6302\u949f\u65f6\u95f4\u5185\u5b8c\u6210\u76f8\u540c\u5de5\u4f5c\u7684\u6700\u5c11\u6570\u91cf\u7684\u6267\u884c\u7a0b\u5e8f\uff08\u7406\u60f3\u60c5\u51b5\uff09\u3002</p> <p></p>"},{"location":"distributed_computing/spark/profile_tools.html#6","title":"6\u3001\u8ba1\u7b97\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5","text":"<p>\u200b       \u5b83\u544a\u8bc9\u6211\u4eec\u6709\u591a\u5c11\u5206\u914d\u7ed9\u5e94\u7528\u7a0b\u5e8f\u7684\u8ba1\u7b97\u8d44\u6e90\u6839\u672c\u6ca1\u6709\u4f7f\u7528\u3002</p> <p></p>"},{"location":"distributed_computing/spark/profile_tools.html#7","title":"7\u3001\u5404\u9636\u6bb5\u53c2\u6570","text":"<p>\u200b       \u8bb8\u591a\u6709\u8da3\u7684\u9636\u6bb5\u53c2\u6570\uff0c\u5982\u8f93\u5165\u3001\u8f93\u51fa\u3001Shuffle\u8f93\u5165\u548c\u6bcf\u4e2a\u9636\u6bb5\u7684Shuffle\u8f93\u51fa\u3002</p> <p>\u200b       OneCoreComputeHours \u53ef\u7528\uff0c\u6bcf\u4e2a\u9636\u6bb5\u4f7f\u7528\u5b83\u6765\u53d1\u73b0\u4f4e\u6548\u7684\u9636\u6bb5\u3002</p> <p></p>"},{"location":"distributed_computing/spark/profile_tools.html#8","title":"8\u3001\u6bcf\u9636\u6bb5\u6307\u6807","text":"<p>\u200b       \u7531\u4e8e\u7f3a\u4e4f\u4efb\u52a1\u6216\u504f\u5dee\uff0c\u6267\u884c\u5668\u4e5f\u53ef\u80fd\u6d6a\u8d39\u8ba1\u7b97\u65f6\u95f4\u3002</p> <p></p> <p>\u5176\u4e2d\uff1a</p> \u5217\u540d \u8bf4\u660e PRatio stage \u4e2d\u4efb\u52a1\u6570\u9664\u4ee5\u6838\u6570\uff0c\u8868\u793a stage \u4e2d\u7684\u5e76\u884c\u5ea6\u3002PRatio &gt; 1 =&gt; \u4efb\u52a1\u8fc7\u591a\uff0cPRatio &lt; 1 =&gt; \u5185\u6838\u8fc7\u591a\u3002 TaskSkew stage \u4e2d\u6700\u5927\u4efb\u52a1\u7684\u6301\u7eed\u65f6\u95f4\u9664\u4ee5\u4e2d\u4f4d\u6570\u4efb\u52a1\u7684\u6301\u7eed\u65f6\u95f4\uff0c\u8868\u793a stage \u4e2d\u7684\u503e\u659c\u7a0b\u5ea6\u3002\u8d8a\u4f4e\u8d8a\u597d\u3002 TaskStageSke stage \u4e2d\u6700\u5927\u4efb\u52a1\u7684\u6301\u7eed\u65f6\u95f4\u9664\u4ee5\u8be5\u9636\u6bb5\u7684\u603b\u6301\u7eed\u65f6\u95f4\u3002\u8868\u793a\u6700\u5927\u4efb\u52a1\u5bf9 stage \u7684\u65f6\u95f4\u5f71\u54cd\u3002\u8d8a\u4f4e\u8d8a\u597d\u3002 OIRatio \u8f93\u51fa\u4e0e\u8f93\u5165\u6bd4\u3002stage \u7684\u603b\u8f93\u51fa(\u7ed3\u679c+ shuffle \u8f93\u51fa)\u9664\u4ee5\u603b\u8f93\u5165(\u8f93\u5165\u6570\u636e+ shuffle \u8f93\u5165)\u3002 <p>\u4e0b\u9762\u8fd9\u4e9b\u6307\u6807\u4ee3\u8868\u4e86\u8fd9\u4e2a\u9636\u6bb5\u7684\u65f6\u95f4\u5206\u5e03\uff1a</p> \u5217\u540d \u8bf4\u660e ShuffleWrite \u5728 stage \u9636\u6bb5\u4e2d\u6240\u6709\u4efb\u52a1\u8fdb\u884c shuffle \u5199\u5165\u6240\u82b1\u8d39\u7684\u767e\u5206\u6bd4\u3002 ReadFetch \u5728 stage \u9636\u6bb5\u4e2d\u6240\u6709\u4efb\u52a1\u8fdb\u884c shuffle \u8bfb\u6240\u82b1\u8d39\u7684\u767e\u5206\u6bd4\u3002 GC \u5728 stage \u9636\u6bb5\u4e2d\u6240\u6709\u4efb\u52a1\u8fdb\u884c GC \u6240\u82b1\u8d39\u7684\u767e\u5206\u6bd4\u3002"},{"location":"distributed_computing/spark/profile_tools.html#sparklens-ui","title":"\u56db\u3001Sparklens UI","text":"<p>\u200b       \u6240\u6709\u4e0a\u8ff0\u53c2\u6570\u4e5f\u53ef\u4ee5\u901a\u8fc7 Sparklens UI \u4ee5\u56fe\u5f62\u65b9\u5f0f\u89c2\u5bdf\uff0c\u5c06\u5f97\u5230\u7684 Sparklens Json \u6587\u4ef6\u4e0a\u4f20\u81f3 http://sparklens.qubole.com/\uff0c\u5373\u5f97\u5230\u4e00\u4efd Sparklens UI \u56fe\u5f62\u754c\u9762\u3002</p> <p>Sparklens UI \u5305\u62ec\u4e94\u4e2a\u5173\u952e\u7ec4\u4ef6\uff1a</p> <ul> <li>\u6548\u7387\u7edf\u8ba1\uff1b</li> <li>\u6a21\u62df\uff1b</li> <li>\u6bcf\u9636\u6bb5\u6307\u6807\uff1b</li> <li>\u7406\u60f3\u6267\u884c\u5668\uff1b</li> <li>\u805a\u5408\u6307\u6807\u3002</li> </ul> <p></p>"},{"location":"distributed_computing/spark/profile_tools.html#streaming","title":"\u4e94\u3001\u4f7f\u7528 Streaming \u6d41\u5e94\u7528\u7a0b\u5e8f","text":"<p>\u200b   Streaminglens \u662f\u8fd0\u884c\u5728\u5fae\u6279\u5904\u7406\u6a21\u5f0f\u4e0b\u7684 Spark \u7ed3\u6784\u5316\u6d41\u5e94\u7528\u7a0b\u5e8f\u7684\u5206\u6790\u5de5\u5177\u3002\u7531\u4e8e\u6bcf\u4e2a\u5fae\u6279\u7684\u6267\u884c\u8ba1\u5212\u662f\u76f8\u540c\u7684\uff0c\u53ef\u4ee5\u4e0d\u65ad\u5730\u4ece\u4ee5\u524d\u7684\u5fae\u6279\u5b66\u4e60\uff0c\u4ee5\u9884\u6d4b\u4e0b\u4e00\u4e2a\u5fae\u6279\u7684\u7406\u60f3 spark \u96c6\u7fa4\u914d\u7f6e\u3002Streaminglens \u6bcf5\u5206\u949f\u5206\u6790\u6700\u540e\u4e00\u4e2a\u5fae\u6279\u5904\u7406\u7684\u6267\u884c\u8fd0\u884c\uff0c\u7ed9\u51fa\u6d41\u7ba1\u9053\u5065\u5eb7\u72b6\u51b5\u7684\u603b\u4f53\u6982\u5ff5\u3002</p> <p>\u200b   \u5728\u5206\u6790\u8fc7\u7a0b\u4e2d\uff0cStreaminglens\u8ba1\u7b97\u5b8c\u6210\u5fae\u6279\u5904\u7406\u7684\u4e34\u754c\u65f6\u95f4\u3002Critical Time\u662f\u6307\u5728\u65e0\u9650\u4e2a\u6267\u884c\u5668\u7684\u60c5\u51b5\u4e0b\uff0c Spark \u4f5c\u4e1a\u5b8c\u6210\u6240\u9700\u7684\u6700\u5c0f\u65f6\u95f4\u3002</p> <p>\u200b   \u6839\u636e\u5173\u952e\u65f6\u95f4\u3001\u5b9e\u9645\u6279\u5904\u7406\u8fd0\u884c\u65f6\u95f4\u7684\u6bd4\u8f83\uff0cstreaminglens\u51b3\u5b9a\u6d41\u7ba1\u9053\u7684\u72b6\u6001\u4e3a<code>Optimum</code>, <code>Underprovisioned</code>, <code>Overprovisioned</code> or <code>Unhealthy</code>\uff0c\u5e76\u7ed9\u51fa\u9002\u5f53\u7684\u5efa\u8bae\u6765\u8c03\u4f18 spark \u96c6\u7fa4\u3002</p>"},{"location":"distributed_computing/spark/profile_tools.html#streaming-pipeline","title":"\u4e00\u3001Streaming Pipeline \u72b6\u6001","text":"\u72b6\u6001 \u63cf\u8ff0 No New Batches \u7ba1\u9053\u4e2d\u6ca1\u6709\u65b0\u7684\u6570\u636e\u3002\u5982\u679c\u8fd9\u79cd\u72b6\u6001\u5728\u6570\u636e\u6444\u5165\u540e\u4ecd\u7136\u5b58\u5728\uff0c\u53ef\u80fd\u4f1a\u6709\u4e00\u4e9b\u6279\u5904\u7406\u88ab\u5361\u4f4f\uff0c\u8bf7\u68c0\u67e5Spark UI\u3002 Overprovisioned \u6279\u5904\u7406\u5b8c\u6210\u65f6\u95f4\u8fdc\u8fdc\u5c11\u4e8e\u9884\u671f\u7684SLA\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u964d\u4f4e\u96c6\u7fa4\u89c4\u6a21\u4ee5\u964d\u4f4e\u6210\u672c\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c\u4f60\u770b\u5230\u8fd9\u4e2a\u72b6\u6001\uff0c\u4f46\u6d41\u662f\u6ede\u540e\u7684\uff0c\u964d\u4f4e\u89e6\u53d1\u95f4\u9694\u6216\u68c0\u67e5\u5177\u4f53\u7684\u5efa\u8bae\u3002 Optimum \u6d41\u5a92\u4f53\u7ba1\u9053\u6b63\u5728\u8f7b\u677e\u5730\u6ee1\u8db3SLA\u3002 Underprovisioned \u60a8\u9700\u8981\u5347\u7ea7\u96c6\u7fa4\u6765\u5339\u914d\u9884\u671f\u7684\u5fae\u6279\u5904\u7406SLA\u3002 Unhealthy \u60a8\u9700\u8981\u901a\u8fc7\u6539\u53d8spark\u96c6\u7fa4\u6216\u7ba1\u9053\u914d\u7f6e\u6765\u589e\u52a0Source\u7ea7\u522b\u7684\u6444\u5165\u3002"},{"location":"distributed_computing/spark/profile_tools.html#_5","title":"\u4e8c\u3001\u5982\u4f55\u83b7\u53d6\u62a5\u544a\uff1f","text":"<p>\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u83b7\u53d6 Streaminglens \u62a5\u544a\uff1a</p> <ul> <li>\u6253\u5370\u5728Spark Application\u7684\u9a71\u52a8\u65e5\u5fd7\u4e2d\u3002</li> <li>Streaminglens \u901a\u8fc7 Dropwizard \u53d1\u5e03\u5176\u6307\u6807\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7Apache Spark\u4e2d\u4efb\u4f55\u53d7\u652f\u6301\u7684\u6307\u6807\u96c6\u67e5\u770b\u8fd9\u4e9b\u6307\u6807\u3002</li> <li>\u60a8\u53ef\u4ee5\u4f7f\u7528\u81ea\u5df1\u7684\u81ea\u5b9a\u4e49\u62a5\u544a\u5668\uff0c\u4ee5\u6bcf\u4e00\u5c0f\u65f6\u67e5\u770b\u6d41\u7ba1\u9053\u7684\u805a\u5408\u8fd0\u884c\u72b6\u51b5\u548c\u5efa\u8bae\u3002</li> </ul>"},{"location":"distributed_computing/spark/profile_tools.html#streaminglens","title":"\u4e09\u3001Streaminglens \u62a5\u544a\u63d0\u4f9b\u7684\u4fe1\u606f","text":"<p>Streaminglens\u5728\u5206\u6790\u4e86\u4e0a\u4e00\u4e2a\u5fae\u6279\u7684\u6267\u884c\u540e\u63d0\u4f9b\u4ee5\u4e0b\u62a5\u544a\uff1a</p> <ul> <li>\u6279\u91cf\u8fd0\u884c\u65f6\u95f4\uff0c\u4e34\u754c\u65f6\u95f4\u548c\u89e6\u53d1\u95f4\u9694\u7684\u6bd4\u8f83\uff1b</li> <li>\u6d41\u7ba1\u9053\u7684\u72b6\u6001\u4e3a<code>Underprovisioned</code>, <code>Optimum</code>, <code>Overprovisioned</code> or <code>Unhealthy</code>\u3002</li> <li>\u6bcf\u4e00\u5c0f\u65f6\u5bf9\u6d41\u7ba1\u9053\u8fdb\u884c\u805a\u5408\u72b6\u6001\uff0c\u5e76\u63d0\u4f9b\u5efa\u8bae\uff0c\u4ee5\u9632\u7ba1\u9053\u4e0d\u662f\u6700\u4f18\u7684\u3002</li> </ul> <p>\u9a71\u52a8\u7a0b\u5e8f\u65e5\u5fd7\u4e2d\u7684\u4e00\u4e2a\u793a\u4f8b\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p>"},{"location":"distributed_computing/spark/profile_tools.html#streaminglens_1","title":"\u56db\u3001\u600e\u6837\u4f7f\u7528 Streaminglens \uff1f","text":""},{"location":"distributed_computing/spark/profile_tools.html#1-streaminglens-spark","title":"1\u3001\u6dfb\u52a0 streaminglens \u5305\u81f3 Spark \u4efb\u52a1\u4e2d","text":"<p>\u200b       \u901a\u8fc7\u4f7f\u7528<code>--packages</code>\u547d\u4ee4\u884c\u9009\u9879\uff0c\u53ef\u4ee5\u5c06 Streaminglens jar \u6dfb\u52a0\u5230\u901a\u8fc7 Spark -shell \u6216 Spark -submit \u542f\u52a8\u7684Spark\u4f5c\u4e1a\u4e2d\u3002\u4f8b\u5982\uff1a</p> <pre><code>spark-shell --packages com.qubole:spark-streaminglens_2.11:0.5.3\n</code></pre> <p>\u6216</p> <pre><code>spark-submit \\\n--master spark://hadoop004:7077 \\\n--packages com.qubole:spark-streaminglens_2.11:0.5.3 \\\n--class SparkStreamingWordCount SparkStreamingtest.jar\n</code></pre> <p>\u6216\u8005\uff0c\u53ef\u4ee5\u4ecehttps://mvnrepository.com/artifact/com.qubole/spark-streaminglens_2.11/0.5.3\u4e2d\u4e0b\u8f7d jar\uff0c\u4f7f\u7528<code>--jars</code>\u9009\u9879\u5c06\u5b83\u6dfb\u52a0\u5230 spark-submit \u547d\u4ee4\u884c\u9009\u9879\u4e2d\uff0c\u4f8b\uff1a</p> <pre><code>spark-submit \\\n--class spark://hadoop004:7077 \\\n--jars /home/hadoop/spark-streaminglens_2.11-0.5.3.jar \\\n--class StructuredStreamingWordCount SparkStreamingtest.jar \n</code></pre>"},{"location":"distributed_computing/spark/profile_tools.html#2-streaminglens","title":"2\u3001\u521d\u59cb\u5316 streaminglens","text":"<p>\u9700\u8981\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u521d\u59cb\u5316 streaminglens </p> <ol> <li>\u6dfb\u52a0\u73af\u5883\u4f9d\u8d56</li> </ol> <pre><code>&lt;dependency&gt;\n &lt;groupId&gt;com.qubole&lt;/groupId&gt;\n &lt;artifactId&gt;spark-streaminglens_2.11&lt;/artifactId&gt;\n &lt;version&gt;0.5.3&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <ol> <li>\u521d\u59cb\u5316 streaminglens </li> </ol> <pre><code>import com.qubole.spark.streaminglens._\n\nvar options: Map[String, String] = Map();\noptions += (\"streamingLens.analysisIntervalMinutes\" -&gt; \"1\");\nval streamingLens = new StreamingLens(spark,options)\n</code></pre>"},{"location":"distributed_computing/spark/profile_tools.html#3","title":"3\u3001\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u62a5\u544a","text":"<p>\u53ef\u4ee5\u4f7f\u7528\u81ea\u5df1\u7684\u81ea\u5b9a\u4e49\u62a5\u544a\u5668\u6765\u62a5\u544a\u6d41\u7ba1\u9053\u7684\u805a\u5408\u8fd0\u884c\u72b6\u51b5\u548c\u76f8\u5173\u5efa\u8bae\u3002\u53ea\u9700\u7f16\u5199\u7c7b\u7ee7\u627f<code>streaminglen7sreporterinterface</code> \uff0c\u5e76\u901a\u8fc7<code>streamingLens.reporter.className</code>\u9009\u9879\u4f20\u9012\u7c7b\u540d\uff0c\u5e76\u5c06<code>streamingLens.reporter.enabled</code>\u8bbe\u7f6e\u4e3atrue\u3002\u8fd8\u53ef\u4ee5\u901a\u8fc7<code>streamingLens.reporter.intervalMinutes</code>\u9009\u9879\u914d\u7f6e\u62a5\u544a\u9891\u7387\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u805a\u5408\u8fd0\u884c\u72b6\u51b5\u548c\u5efa\u8bae\u6bcf\u4e00\u5c0f\u65f6\u62a5\u544a\u4e00\u6b21\u3002</p> <pre><code>var options: Map[String, String] = Map();\noptions += (\"streamingLens.reporter.className\" -&gt; \"streamingLensreport\");\noptions += (\"streamingLens.reporter.enabled\" -&gt; \"true\");\noptions += (\"streamingLens.reporter.intervalMinutes\" -&gt; \"60\");\nval streamingLens = new StreamingLens(spark,options)\n</code></pre>"},{"location":"distributed_computing/spark/profile_tools.html#4-streaminglens","title":"4\u3001\u914d\u7f6e StreamingLens \u9009\u9879","text":"<p>Streaminglens \u652f\u6301\u591a\u79cd\u914d\u7f6e\u9009\u9879\uff1a</p> \u540d\u79f0 \u9ed8\u8ba4 \u542b\u4e49 <code>streamingLens.analysisIntervalMinutes</code> 5 mins \u5fae\u6279\u6b21\u5206\u6790\u7684\u9891\u7387\u3002 <code>streamingLens.criticalPathAnalysis. overProvisionPercentage</code> 0.3 (or 30%) \u5c06 spark \u96c6\u7fa4\u89c6\u4e3a over-provisoned \u72b6\u6001\u7684\u767e\u5206\u6bd4\uff0c\u4f8b\u5982:\u5982\u679c\u6279\u5904\u7406\u8fd0\u884c\u65f6\u95f4\u5c0f\u4e8e\u9884\u671f\u5fae\u6279SLA\u768430%\uff0c\u5219\u8ba4\u4e3a\u96c6\u7fa4\u72b6\u6001\u4e3a over-provisoned\u3002 <code>streamingLens.criticalPathAnalysis. underProvisionPercentage</code> 0.7 (or 70%) \u5c06 spark \u96c6\u7fa4\u89c6\u4e3a under-provisioned \u72b6\u6001\u7684\u767e\u5206\u6bd4\uff0c\u4f8b\u5982:\u5982\u679c\u6279\u5904\u7406\u8fd0\u884c\u65f6\u95f4\u8d85\u8fc7\u9884\u671f\u5fae\u6279SLA\u768470%\uff0c\u5219\u8ba4\u4e3a\u96c6\u7fa4\u72b6\u6001\u4e3a under-provisioned\u3002 <code>streamingLens.criticalPathAnalysis. criticalPathPercentage</code> 0.7 (or 70%) \u8003\u8651 spark \u5e94\u7528\u7a0b\u5e8f\u914d\u7f6e\u4e0d\u6b63\u786e\u7684\u767e\u5206\u6bd4\uff0c\u4f8b\u5982:\u5982\u679c\u5173\u952e\u65f6\u95f4\u8d85\u8fc7\u9884\u671f\u5fae\u6279SLA\u768470%\uff0c\u5219\u8ba4\u4e3a\u7ba1\u9053\u4e0d\u5065\u5eb7\uff0c spark \u96c6\u7fa4\u914d\u7f6e\u4e0d\u6b63\u786e\u3002 <code>streamingLens.minBatches</code> 1 \u5728\u8fdb\u884c\u4e0b\u4e00\u6b21\u5206\u6790\u4e4b\u524d\u5fc5\u987b\u5b8c\u6210\u7684\u6700\u5c11\u6279\u6b21\u3002 <code>streamingLens.maxResultsRetention</code> 30 \u8981\u4fdd\u7559\u5728\u5185\u5b58\u4e2d\u7684\u5206\u6790\u7ed3\u679c\u7684\u6570\u91cf\u3002 <code>streamingLens.maxBatchesRetention</code> 10 \u5728\u5185\u5b58\u4e2d\u4fdd\u7559\u5ea6\u91cf\u7684\u6279\u6570\u3002 <code>streamingLens.maxAnalysisTimeSeconds</code> 5 \u5728\u8d85\u65f6\u5206\u6790\u4e4b\u524d\u7b49\u5f85\u7684\u79d2\u6570\u3002 <code>streamingLens.maxRetries</code> 3 \u5728\u5206\u6790\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\u65f6\u7684\u91cd\u8bd5\u6b21\u6570\u3002 <code>streamingLens.shouldLogResults</code> true \u662f\u5426\u5728spark driver\u65e5\u5fd7\u4e2d\u6253\u5370\u5206\u6790\u7ed3\u679c\u3002 <code>streamingLens.reporter.enabled</code> false \u662f\u5426\u5728\u4efb\u4f55\u81ea\u5b9a\u4e49\u8f93\u51fa\u4e2d\u8f6c\u50a8\u5206\u6790\u7ed3\u679c\u3002 <code>streamingLens.expectedMicroBatchSLAMillis</code> 1000 * 60 * 2 SLA\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\u4e3a\u6beb\u79d2\u3002 <code>streamingLens.reporter.className</code> \u62a5\u544a\u5668\u7c7b\u7684\u5b8c\u5168\u89e3\u6790\u7684 classname \u3002 <code>streamingLens.reporter.discountFactor</code> 0.95 \u5728\u8ba1\u7b97\u805a\u5408\u72b6\u6001\u65f6\uff0c\u5c06\u65e9\u671f\u5fae\u6279\u6b21\u6253\u6298\u7684\u6307\u6570\u56e0\u5b50\u3002 <code>streamingLens.reporter.intervalMinutes</code> 60 \u62a5\u544a\u6d41\u67e5\u8be2\u8fd0\u884c\u72b6\u51b5\u7684\u9891\u7387\u3002"},{"location":"distributed_computing/spark/profile_tools.html#5-streaminglens","title":"5. \u505c\u6b62 Streaminglens","text":"<p>\u53ef\u4ee5\u505c\u6b62 streaminglens \u5728\u4e00\u4e2a\u8fd0\u884c\u7684spark\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u4ee5\u4e0b streaminglens API:</p> <pre><code>streamingLens.stopStreamingLens()\n</code></pre>"},{"location":"distributed_computing/spark/profile_tools.html#sparklens-on-spark-3x","title":"\u516d\u3001Sparklens on Spark 3.X","text":"<p>\u73af\u5883\u7248\u672c\uff1aHadoop 3.3.1\u3001Spark 3.1.2\u3001Java 8\u3001Scala 2.12.10</p>"},{"location":"distributed_computing/spark/profile_tools.html#1_1","title":"1\u3001\u83b7\u53d6\u6e90\u7801\u5e76\u8fdb\u884c\u7f16\u8bd1","text":"<ol> <li>\u6587\u4ef6 build.sbt</li> </ol> <pre><code>scalaVersion := \"2.11.8\"\ncrossScalaVersions := Seq(\"2.10.6\", \"2.11.8\")\nspName := \"qubole/sparklens\"\nsparkVersion := \"2.0.0\"\n</code></pre> <p>\u6539\u4e3a</p> <pre><code>scalaVersion := \"2.12.10\"\ncrossScalaVersions := Seq(\"2.10.6\", \"2.11.8\", \"2.12.10\")\nspName := \"qubole/sparklens\"\nsparkVersion := \"3.1.1\"\n</code></pre> <ol> <li>\u6587\u4ef6 project/plugins.sbt</li> </ol> <pre><code>resolvers += \"Spark Package Main Repo\" at \"https://dl.bintray.com/spark-packages/maven\"\n</code></pre> <p>\u6539\u4e3a</p> <pre><code>resolvers += \"Spark Package Main Repo\" at \"https://repos.spark-packages.org\"\n</code></pre> <ol> <li>\u6587\u4ef6 src/main/scala/com/qubole/sparklens/QuboleJobListener.scala</li> </ol> <pre><code>failedStages += s\"\"\" Stage ${si.stageId} attempt ${si.attemptId} in job ${stageIDToJobID(si.stageId)} failed.\n</code></pre> <p>\u6539\u4e3a</p> <pre><code>failedStages += s\"\"\" Stage ${si.stageId} attempt ${si.attemptNumber} in job ${stageIDToJobID(si.stageId)} failed.\n</code></pre> <ol> <li>\u6587\u4ef6 src/main/scala/com/qubole/sparklens/helper/HDFSConfigHelper.scala</li> </ol> <pre><code>if (sparkConfOptional.isDefined) {\n SparkHadoopUtil.get.newConfiguration(sparkConfOptional.get)\n}else {\n val sparkConf = new SparkConf()\n SparkHadoopUtil.get.newConfiguration(sparkConf)\n}\n</code></pre> <p>\u6539\u4e3a</p> <pre><code>// After Spark 3.0.0 SparkHadoopUtil is made private to make it work only within the spark\n// using reflection code here to access the newConfiguration method of the SparkHadoopUtil\nval sparkHadoopUtilClass = Class.forName(\"org.apache.spark.deploy.SparkHadoopUtil\")\nval sparkHadoopUtil = sparkHadoopUtilClass.newInstance()\nval newConfigurationMethod = sparkHadoopUtilClass.getMethod(\"newConfiguration\", classOf[SparkConf])\nif (sparkConfOptional.isDefined) {\n newConfigurationMethod.invoke(sparkHadoopUtil, sparkConfOptional.get).asInstanceOf[Configuration]\n} else {\n val sparkConf = new SparkConf()\n newConfigurationMethod.invoke(sparkHadoopUtil, sparkConf).asInstanceOf[Configuration]\n}\n</code></pre> <ol> <li>\u6587\u4ef6 version.sbt</li> </ol> <pre><code>version in ThisBuild := \"0.3.2\"\n</code></pre> <p>\u6539\u4e3a</p> <pre><code>version in ThisBuild := \"0.4.0\"\n</code></pre>"},{"location":"distributed_computing/spark/profile_tools.html#2_1","title":"2\u3001\u6253\u5305","text":"<pre><code>sbt compile \nsbt package \nsbt clean \n</code></pre>"},{"location":"distributed_computing/spark/profile_tools.html#3_1","title":"3\u3001\u63d0\u4ea4\u4efb\u52a1","text":"<pre><code>spark-submit \\\n--master yarn \\\n--jars sparklens_2.12-0.4.0.jar \\\n--conf spark.extraListeners=com.qubole.sparklens.QuboleJobListener \\\n--class sparksqltest.SparkSQLtest SparkSQLtest.jar\n</code></pre> <pre><code>spark-submit \\\n--jars sparklens_2.12-0.4.0.jar \\\n--class com.qubole.sparklens.app.ReporterApp qubole-dummy-arg /tmp/sparklens/application_1634174539117_0001.sparklens.json\n</code></pre>"},{"location":"distributed_computing/spark/pyspark.html","title":"PySpark","text":""},{"location":"distributed_computing/spark/pyspark.html#_1","title":"\u539f\u7406","text":"<p>\u5176\u4e2d\u767d\u8272\u90e8\u5206\u662f\u65b0\u589e\u7684Python\u8fdb\u7a0b\uff1a</p> <ul> <li>\u5728Driver\u7aef\uff0c\u901a\u8fc7Py4j\u5b9e\u73b0\u5728Python\u4e2d\u8c03\u7528Java\u7684\u65b9\u6cd5\uff0c\u5373\u5c06\u7528\u6237\u5199\u7684PySpark\u7a0b\u5e8f\u201d\u6620\u5c04\u201d\u5230JVM\u4e2d\uff1b</li> <li>Python\u8fdb\u7a0b\u901a\u8fc7Py4j\u8c03\u7528Java\u65b9\u6cd5\u63d0\u4ea4Job\uff0cJob\u8fd0\u884c\u7ed3\u679c\u901a\u8fc7\u672c\u5730Socket\u88ab\u62c9\u53d6\u5230Python\u8fdb\u7a0b</li> <li> <p>\u5bf9\u4e8e\u5927\u6570\u636e\u91cf\uff0c\u4f8b\u5982\u5e7f\u64ad\u53d8\u91cf\u7b49\uff0cPython\u8fdb\u7a0b\u548cJVM\u8fdb\u7a0b\u662f\u901a\u8fc7\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6765\u4ea4\u4e92\uff0c\u4ee5\u51cf\u5c11\u8fdb\u7a0b\u95f4\u7684\u6570\u636e\u4f20\u8f93</p> </li> <li> <p>\u5728Executor\u7aef\uff0c\u5219\u4e0d\u9700\u8981\u501f\u52a9Py4j\uff0c\u56e0\u4e3aExecutor\u7aef\u8fd0\u884c\u7684Task\u903b\u8f91\u662f\u7531Driver\u53d1\u8fc7\u6765\u7684\uff0c\u90a3\u662f\u5e8f\u5217\u5316\u540e\u7684\u5b57\u8282\u7801\u3002</p> </li> <li>\u6bcf\u4e2aExecutor\u4e0a\u6709\u4e00\u4e2a\u516c\u5171\u7684pyspark.deamon\u8fdb\u7a0b\uff0c\u8d1f\u8d23\u63a5\u6536Task\u8bf7\u6c42\uff0c\u5e76<code>fork pyspark.worker</code>\u8fdb\u7a0b\u5355\u72ec\u5904\u7406\u6bcf\u4e2aTask\uff0c\u5b9e\u9645\u6570\u636e\u5904\u7406\u8fc7\u7a0b\u4e2d\uff0cpyspark.worker\u8fdb\u7a0b\u548c JVM Task \u4f1a\u8f83\u9891\u7e41\u5730\u8fdb\u884c\u672c\u5730Socket\u6570\u636e\u901a\u4fe1\u3002</li> <li>\u6570\u636e\u901a\u8fc7\u672c\u5730 socket \u534f\u8bae\u53d1\u9001\u7ed9Python Worker\uff0c\u671f\u95f4\u9700\u8981\u5c06 InternalRow \u8f6c\u5316\u4e3a Java\u5bf9\u8c61\uff0c\u7136\u540e\u518d\u7528 Java Pickle \u8fdb\u884c\u5e8f\u5217\u5316(\u4e00\u6b21)\uff0c\u8fd9\u4e2a\u65f6\u5019\u624d\u80fd\u901a\u8fc7\u7f51\u7edc\u53d1\u9001\u7ed9Worker\u3002</li> </ul> <p>Python \u4ee3\u7801\u7684\u5e8f\u5217\u5316\uff1a</p> <ul> <li>driver\u7aef\u5728\u8c03\u7528\u65f6\u5c06\u5176\u95ed\u5305\u5e8f\u5217\u5316</li> </ul>"},{"location":"distributed_computing/spark/pyspark.html#arrow","title":"Arrow\u52a0\u901f","text":""},{"location":"distributed_computing/spark/pyspark.html#_2","title":"\u5206\u6790","text":"<p>spark.sql.execution.arrow.pyspark.enabled \u9ed8\u8ba4 false</p> <p>\u4e00\u6b21\u8ba1\u7b97\uff0c\u9700\u8981\u89e6\u53d1\u4e24\u6b21 Java / Python \u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u3002</p> <ul> <li>Spark \u89e6\u53d1\u8ba1\u7b97\u65f6\uff08\u5982\u52a0\u8f7d\u6570\u636e\uff09\uff0c\u628a\u6570\u636e\u8f6c\u6210\u5185\u90e8\u5b58\u50a8\u683c\u5f0f InternalRow\uff0c\u518d\u8f6c\u5316\u4e3aJava\u5bf9\u8c61\uff0c\u7136\u540e\u518d\u7528 Java Pickle\u8fdb\u884c\u5e8f\u5217\u5316\u53d1\u9001\u7ed9Worker</li> <li>Worker\u63a5\u6536\u540e\uff0c\u518d\u4e00\u6761\u4e00\u6761\u53cd\u5e8f\u5217\u5316(python pickle)\u8f6c\u5316\u4e3aPython\u5bf9\u8c61\u8fdb\u884c\u5904\u7406\uff1b</li> <li>\u5904\u7406\u5b8c\u6210\u540e\uff0c\u518d\u7528 pickle \u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u53d1\u9001\u7ed9Java Executor\uff1b</li> <li>Java Executor\u83b7\u53d6\u6570\u636e\u540e\uff0c\u9700\u8981\u518d\u53cd\u5e8f\u5217\u5316\uff0c\u7136\u540e\u8f6c\u5316\u4e3aInternalRow\u7ee7\u7eed\u8fdb\u884c\u5904\u7406\u3002</li> </ul> <p>Arrow \u6539\u9020\uff1a<code>spark.sql.execution.arrow.maxRecordsPerBatch</code>\uff08\u9ed8\u8ba410000\uff09</p> <ul> <li>\u5206\u533a\u88ab\u8f6c\u4e3a\u591a\u4e2aArrow record batches\uff0c\u4f1a\u5f15\u8d77\u4e34\u65f6\u6027\u7684\u5185\u5b58\u9ad8\u5cf0\uff1b</li> </ul>"},{"location":"distributed_computing/spark/pyspark.html#fallback","title":"FallBack","text":"<p>spark.sql.execution.arrow.pyspark.fallback.enabled \u9ed8\u8ba4 true</p> <p>\u4e0d\u4e00\u5b9a\u9002\u7528\u6240\u6709\u60c5\u51b5\uff08\u5373\u652f\u6301\u6240\u6709\u7684\u6570\u636e\u7c7b\u578b\uff09\uff0c\u5f53\u51fa\u9519\u65f6\uff0c\u4f1a\u81ea\u52a8\u56de\u9000\u5230\u672a\u4f18\u5316\u7684\u5b9e\u73b0\u3002</p> <p>Currently(V3.4.0), all Spark SQL data types are supported by Arrow-based conversion except <code>ArrayType</code> of <code>TimestampType</code>. </p> <p><code>MapType</code> and <code>ArrayType</code> of nested <code>StructType</code> are only supported when using PyArrow 2.0.0 and above.</p>"},{"location":"distributed_computing/spark/spark_barrier.html","title":"RDD Barrier","text":"<p>SPIP\uff1aSupport Barrier Execution Mode in Apache Spark</p> <p>\u7528\u4e8eMPI\u6216\u8005\u5206\u5e03\u5f0f\u673a\u5668\u5b66\u4e60\u7684\u573a\u666f\uff0c\u8981\u6c42\u6240\u6709\u7684Task\u5fc5\u987b\u540c\u65f6\u540c\u65f6\u6267\u884c\uff1b</p> <p>\u5728 barrier stage \u4e2d\u6267\u884c MPI \u7a0b\u5e8f\u793a\u4f8b\uff1a</p> <pre><code>rdd.barrier().mapPartitions(iter =&gt; {\n    // Write iter to disk\n    ???\n\n    val context = BarrierTaskContext.get()\n    // Sets a global barrier and waits until all tasks in this stage hit this barrier\n    context.barrier()\n\n    if (context.partitionId() == 0) {\n        val hosts = context.getTaskInfos().map(_.host)\n        // Set up MPI machine file using host infos.\n        ???\n\n        // Launch the MPI job by calling mpirun.\n        ???\n    }\n\n    // Wait until the MPI job finished.\n    context.barrier()\n\n    // collect output and return\n    ???\n})\n</code></pre>"},{"location":"distributed_computing/spark/spark_basic.html","title":"Spark\u57fa\u7840","text":""},{"location":"distributed_computing/spark/spark_basic.html#_1","title":"\u4e8b\u4ef6","text":"<p>Spark 2.3 \u4e4b\u524d\uff0c\u4e8b\u4ef6\u5904\u7406\u662f\u5355\u7ebf\u7a0b\u7684\u67b6\u6784\uff0c\u5982\u679c\u4f5c\u4e1a\u5f88\u5927\u5f88\u591a tasks\uff0c\u5f88\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e8b\u4ef6\u5904\u7406\u51fa\u73b0\u5ef6\u8fdf\uff0c\u8fdb\u4e00\u6b65\u5bfc\u81f4\u4f5c\u4e1a\u6027\u80fd\u51fa\u73b0\u95ee\u9898\uff1b</p> <ul> <li>Spark 2.3 \u5f15\u5165\u591a\u7ebf\u7a0b\u4e8b\u4ef6\u5904\u7406\u67b6\u6784\uff0c\u4e8b\u4ef6\u5206\u4e3a\u56db\u79cd\u7c7b\u578b\uff0c\u6bcf\u79cd\u7c7b\u578b\u90fd\u5728\u4e00\u4e2a\u5355\u7ebf\u7a0b\u4e2d\u987a\u5e8f\u5904\u7406\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_basic.html#rpc","title":"RPC","text":"<p>\u62c6\u5206\u51fa\u6765\u7684Spark-rpc\u7528\u4e8e\u5b66\u4e60\uff0c\u89c1 https://gitee.com/import-github/spark-rpc</p> <p>\u57fa\u4e8enetty\u81ea\u5df1\u5b9e\u73b0\u4e86\u4e00\u5957RPC\u6846\u67b6\uff0c\u4fdd\u7559\u4e86Akka\u7684\u98ce\u683c\uff0c\u91c7\u7528RpcEndpoint\u6a21\u62dfActor, RpcEndpointRef\u6a21\u62dfActorRef, RpcEnv\u6a21\u62dfActorSystem\u3002</p> <ul> <li>RpcEnv\uff0cRPC\u901a\u4fe1\u7684\u57fa\u7840\uff0c\u5185\u90e8\u5305\u542b\u4f5c\u4e3a\u670d\u52a1\u7aef\u548c\u63a5\u6536\u6d88\u606f\u7ec4\u4ef6\u4ee5\u53ca\u4f5c\u4e3a\u5ba2\u6237\u7aef\u53d1\u9001\u6d88\u606f\u7684\u7ec4\u4ef6\u3002\u6bcf\u4e2a\u5355\u72ec\u7684\u8fdb\u7a0b\u4f1a\u521b\u5efa\u4e00\u4e2aRpcEnv\uff0c\u76ee\u524d\u7248\u672c\u662fNettyRpcEnv\u3002 </li> <li>Dispatcher\uff0c\u7528\u4e8e\u670d\u52a1\u7aef\u63a5\u6536\u5206\u53d1\u6d88\u606f\u3002\u5185\u90e8\u4f7f\u7528receivers\u6570\u7ec4\u7f13\u5b58\u63a5\u6536\u5230\u7684\u6d88\u606f\uff0c\u5e76\u7528\u7ebf\u7a0b\u6c60\u8f6e\u8bad\u5904\u7406\u3002 </li> <li>outboxes\uff0c\u5411\u5916\u53d1\u9001\u6d88\u606f\uff0c\u5185\u90e8\u6839\u636e\u4e0d\u540c\u7684endpointref\u7ec4\u7ec7\u5230\u4e0d\u540c\u7684outbox\u4e2d\uff0c\u5373\u540c\u4e00\u63a5\u6536\u8005\u7684\u6d88\u606f\u4f1a\u4e00\u8d77\u5b58\u653e\u5728\u76f8\u540c\u7684outbox\u4e2d\u3002</li> </ul>"},{"location":"distributed_computing/spark/spark_conf.html","title":"Spark\u4e0b\u7684Hadoop\u914d\u7f6e","text":"<p>\u9ed8\u8ba4\u7684HDFS\u5730\u5740\uff0c\u4e0d\u9700\u8981\u914d\u7f6e ip:port</p>"},{"location":"distributed_computing/spark/spark_conf.html#task","title":"Task","text":""},{"location":"distributed_computing/spark/spark_conf.html#sparkexcludeonfailure","title":"spark.excludeOnFailure","text":"<p>Spark \u9488\u5bf9 Task \u5931\u8d25\u6709\u91cd\u8bd5\u673a\u5236\uff0c\u4f46\u662f\u5f53\u4e00\u4e2a Task \u5728\u67d0\u4e00\u53f0 host\u4e0a\u7684 \u4e00\u4e2a Spark Executor \u5b9e\u4f8b\u6267\u884c\u5931\u8d25\uff0c\u4e0b\u4e00\u6b21\u91cd\u8bd5\u8c03\u5ea6\u56e0\u4e3a\u8003\u8651 <code>Data Locality</code> \u8fd8\u662f\u4f1a\u5927\u6982\u7387\u7684\u9009\u62e9\u90a3\u4e2a host \u4e0a\u7684 Executor\u3002\u5982\u679c\u5931\u8d25\u662f\u56e0\u4e3a <code>\u673a\u5668\u574f\u76d8</code>\u5f15\u8d77\u7684\uff0c\u90a3\u91cd\u8bd5\u8fd8\u662f\u4f1a\u5931\u8d25\uff0c\u91cd\u8bd5\u6b21\u6570\u8fbe\u5230\u6700\u5927\u540e\u90a3\u6700\u7ec8\u6574\u4e2a Job \u5931\u8d25\u3002\u800c\u5f00\u542f blacklist \u529f\u80fd\u53ef\u4ee5\u89e3\u51b3\u6b64\u7c7b\u95ee\u9898\uff0c\u5c06\u53d1\u751f\u5931\u8d25\u7684 Executor \u5b9e\u4f8b\u6216\u8005 host \u6dfb\u52a0\u5230\u9ed1\u540d\u5355\uff0c\u90a3\u4e48\u91cd\u8bd5\u53ef\u4ee5\u9009\u62e9\u5176\u4ed6\u5b9e\u4f8b\u6216\u8005 host \uff0c\u4ece\u800c\u63d0\u9ad8\u4efb\u52a1\u7684 <code>\u5bb9\u9519</code>\u80fd\u529b\u3002</p>"},{"location":"distributed_computing/spark/spark_connect_client.html","title":"Spark Connect","text":"<p>In Apache Spark 3.4, Spark Connect introduced a decoupled client-server architecture that allows remote connectivity to Spark clusters using the DataFrame API and unresolved logical plans as the protocol. </p> <p>Spark Connect supports most Scala APIs, including Dataset, functions, and Column.</p> <ul> <li>\u5f53\u524d \uff083.4.0\uff09\u4e0d\u652f\u6301 SparkContext \u548c RDD \u7684API\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_connect_client.html#_1","title":"\u67b6\u6784","text":""},{"location":"distributed_computing/spark/spark_connect_client.html#_2","title":"\u539f\u7406","text":"<p>Spark Connect\u5ba2\u6237\u7aef\u5c06 DataFrame \u64cd\u4f5c\u8f6c\u6362\u4e3a\u672a\u89e3\u6790\u7684\u903b\u8f91\u67e5\u8be2\u8ba1\u5212\uff0c\u5e76\u7528 Protocol Buffers \u8fdb\u884c\u7f16\u7801\uff0c\u901a\u8fc7 gRPC \u53d1\u9001\u7ed9 Server\u3002</p> <p>Spark Server\u4e0a\u5d4c\u5165\u7684Spark Connect\u7aef\u70b9\u63a5\u6536\u672a\u89e3\u6790\u7684\u903b\u8f91\u8ba1\u5212\u5e76\u5c06\u5176\u8f6c\u6362\u4e3aSpark\u7684\u903b\u8f91\u8ba1\u5212\u8fd0\u7b97\u7b26\u3002\u7136\u540e\u6807\u51c6\u7684Spark\u6267\u884c\u8fc7\u7a0b\u4ecb\u5165\u3002</p> <p>\u7ed3\u679c\u901a\u8fc7 gRPC \u4f5c\u4e3a Apache Arrow \u7f16\u7801\u7684\u884c\u6279\u5904\u7406 \u6d41\u5f0f\u4f20\u8f93\u56de\u5ba2\u6237\u7aef\u3002</p> <p></p>"},{"location":"distributed_computing/spark/spark_connect_client.html#_3","title":"\u4f7f\u7528","text":""},{"location":"distributed_computing/spark/spark_connect_client.html#spark-connect-server","title":"\u542f\u52a8 Spark connect server","text":"<pre><code># \u901a\u8fc7 spark-submit (client \u6a21\u5f0f?) \u7684\u65b9\u5f0f\uff0c\u8fd0\u884c org.apache.spark.sql.connect.service.SparkConnectServer\n./sbin/start-connect-server.sh --packages org.apache.spark:spark-connect_2.12:3.4.0\n</code></pre>"},{"location":"distributed_computing/spark/spark_connect_client.html#client","title":"Client \u4f7f\u7528","text":"<pre><code>from pyspark.sql import SparkSession\nspark = SparkSession.builder.remote(\"sc://localhost\").getOrCreate()\n</code></pre>"},{"location":"distributed_computing/spark/spark_faq.html","title":"FAQ","text":""},{"location":"distributed_computing/spark/spark_faq.html#_1","title":"\u8fd0\u884c","text":"<p>pyspark yarn-client \u5e94\u7528\uff0ctask\u7684\u6267\u884c\u65f6\u95f4\u4e3a1h\uff0c\u7ed3\u675f\u540e\u53d1\u73b0driver\u7aef\u548cam\u8fde\u63a5\u5f02\u5e38\uff1b</p> <p>\u4fe1\u606f\uff1a</p> <p>20/01/08 17:00:55 ERROR client.TransportResponseHandler: Still have 1 requests outstanding when connection from /127.0.0.1:53680 is closed 20/01/08 17:00:55 ERROR cluster.YarnSchedulerBackend$YarnSchedulerEndpoint: Sending RequestExecutors(0,0,Map(),Set()) to AM was unsuccessful java.io.IOException: Connection from /127.0.0.1:53680 closed         at org.apache.spark.network.client.TransportResponseHandler.channelInactive(TransportResponseHandler.java:146)</p> <p>\u5b9a\u4f4d\uff1a</p> <ul> <li> <p>driver\u7aefk8s docker\u5e94\u7528\uff0ctcp keepalive\u65f6\u95f4\u4e3a10min\uff1b</p> </li> <li> <p>yarn am \u7aef\u7269\u7406\u673a\uff0ctcp keepalive\u65f6\u95f4\u4e3a30min\uff1b</p> </li> <li> <p>TODO\uff1a\u539f\u7406\uff1fdriver \u7aef\u8fde\u63a5\u65ad\u6389\uff0c\u8fd8\u672a\u89e6\u53d1\u4fdd\u6d3b\uff1f</p> </li> </ul> <p>\u7f51\u7edc\u8fde\u63a5\u62d3\u6251\uff1a</p> <p>driver docker -&gt;   ??  -&gt; yarn am</p>"},{"location":"distributed_computing/spark/spark_faq.html#windows","title":"windows\u4e0b\u5f00\u53d1","text":""},{"location":"distributed_computing/spark/spark_faq.html#intellij-ideaspark-string-null-chmod-0644","title":"\u901a\u8fc7Intellij Idea\u8fd0\u884cspark\u7a0b\u5e8f\uff0c\u9047\u5230\u6587\u4ef6\u8bfb\u5199\u65f6\uff0c\u62a5\u9519 string: null chmod 0644","text":"<p>\u89e3\u51b3\u65b9\u6848\u89c1StackOverflow\u3002</p> <p>\u5c06https://github.com/cdarlint/winutils\u4e2d\u5bf9\u5e94hadoop\u7248\u672c\u4e2d\u7684bin\u4e0b\u7684winutils\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u5e76\u914d\u7f6eHADOOP_HOME\uff0c\u5e76\u5c06 <code>bin/</code>\u76ee\u5f55\u52a0\u5165 <code>path</code>\u73af\u5883\u53d8\u91cf\u4e2d\uff1b</p>"},{"location":"distributed_computing/spark/spark_faq.html#sparksqlthe-root-scratch-dir-tmphive-on-hdfs-should-be-writable","title":"SparkSQL\u542f\u52a8\u65f6\uff0c\u62a5The  root scratch dir: /tmp/hive on HDFS should be writable","text":"<p>\u89e3\u51b3\u65b9\u6848\uff0c\u901a\u8fc7winutils\u4fee\u6539\u6743\u9650\uff08\\tmp\\hive\u76ee\u5f55\u662f\u5728\u78c1\u76d8\u9a71\u52a8\u76ee\u5f55\u4e0b\u7684\uff09\u3002</p> <pre><code>%HADOOP_HOME%\\bin\\winutils.exe ls \\tmp\\hive\n%HADOOP_HOME%\\bin\\winutils.exe chmod 777 \\tmp\\hive\n%HADOOP_HOME%\\bin\\winutils.exe ls \\tmp\\hive\n</code></pre>"},{"location":"distributed_computing/spark/spark_format.html","title":"Spark\u6570\u636e\u683c\u5f0f","text":""},{"location":"distributed_computing/spark/spark_format.html#csv","title":"CSV","text":""},{"location":"distributed_computing/spark/spark_format.html#header","title":"Header","text":"<p>\u6839\u636e\u53c2\u6570\u6307\u5b9a\uff0c<code>option(\"header\", \"true\")</code></p>"},{"location":"distributed_computing/spark/spark_format.html#_1","title":"\u6570\u636e\u7c7b\u578b","text":"<p>\u9ed8\u8ba4\u5168\u90e8\u5f53\u4f5c<code>String</code>\u5904\u7406\uff1b</p> <p>\u53c2\u6570\u652f\u6301\u81ea\u52a8\u63a8\u65ad\uff0c<code>option(\"inferSchema\", \"true\")</code></p> <ul> <li>\u5148\u5c06\u6574\u4e2a\u6570\u636e\u8bfb\u53d6\u6210DataSet[String]\uff1b</li> <li>\u6839\u636eHeader\uff0c\u5c06DataSet\u8f6c\u6210RDD[Array[String]]\uff1b</li> <li>\u5bf9RDD\u7684\u6bcf\u4e2a\u5143\u7d20\u4e2d\u6bcf\u4e2a\u6570\u636e\u8fdb\u884c\u7c7b\u578b\u63a8\u65ad\uff0c\u5e76\u6309\u89c4\u5219\u805a\u5408\uff1b</li> <li>int -&gt; long -&gt; decimal -&gt; double -&gt; timestamp -&gt; boolean -&gt; string \u7684\u987a\u5e8f\uff1b</li> <li>\u4e0d\u540c\u7c7b\u578b\u6bd4\u8f83\u65f6\uff0c\u7c7b\u578b\u63d0\u5347</li> </ul>"},{"location":"distributed_computing/spark/spark_graphx.html","title":"Graphx","text":"<p>Spark for graphs and graph-parallel computation.</p> <p>\u57fa\u4e8e RDD \u5c01\u88c5 Graph \u62bd\u8c61\uff08a directed multigraph with properties attached to each vertex and edge\uff09\u3002</p> <ul> <li>\u6709\u5411\u56fe\uff1a\u8fb9\u5b58\u5728\u65b9\u5411\uff1b</li> <li>\u591a\u91cd\u56fe\uff1a\u4e24\u4e2a\u9876\u70b9\u95f4\u5b58\u5728\u591a\u6761\u8fb9\uff1b</li> <li>\u5c5e\u6027\u56fe\uff1a\u8fb9\u548c\u9876\u70b9\u90fd\u5177\u5907\u5c5e\u6027\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_graphx.html#_1","title":"\u5c5e\u6027\u56fe","text":"<p>\u9876\u70b9\uff1a\u901a\u8fc7\u552f\u4e00\u768464\u4f4dlong\u578b\u6807\u8bc6\uff08VertexId\uff09\uff0c\u4e0d\u5bf9\u9876\u70b9\u6807\u8bc6\u7b26\u65bd\u52a0\u4efb\u4f55\u6392\u5e8f\u7ea6\u675f\u3002\uff1b</p> <pre><code>class Graph[VD, ED] {\n  val vertices: VertexRDD[VD]\n  val edges: EdgeRDD[ED]\n}\n</code></pre> <p>\u6ce8\uff1a\u5f53\u9876\u70b9\u548c\u8fb9\u7c7b\u578b\u662f\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff08\u5982int\u3001double\uff09\u65f6\uff0c\u901a\u8fc7\u5c06\u5b83\u4eec\u5b58\u50a8\u5728\u4e13\u7528\u6570\u7ec4\u4e2d\u6765\u51cf\u5c11\u5185\u5b58\u5360\u7528\u3002</p> <p>Graph \u9664\u4e86 vertices \u548c edges\uff0c\u5b9a\u4e49 triplets \u89c6\u56fe \uff08<code>RDD[EdgeTriplet[VD, ED]]</code>\uff09</p> <p></p>"},{"location":"distributed_computing/spark/spark_graphx.html#_2","title":"\u7b97\u5b50","text":"<p>Graph \u548c GraphOps \uff08\u9690\u5f0f\u8f6c\u6362\uff09\u7c7b\u4e2d\u3002</p> <pre><code>/** Summary of the functionality in the property graph */\nclass Graph[VD, ED] {\n  // Information about the Graph ===================================================================\n  val numEdges: Long\n  val numVertices: Long\n  val inDegrees: VertexRDD[Int]\n  val outDegrees: VertexRDD[Int]\n  val degrees: VertexRDD[Int]\n  // Views of the graph as collections =============================================================\n  val vertices: VertexRDD[VD]\n  val edges: EdgeRDD[ED]\n  val triplets: RDD[EdgeTriplet[VD, ED]]\n  // Functions for caching graphs ==================================================================\n  def persist(newLevel: StorageLevel = StorageLevel.MEMORY_ONLY): Graph[VD, ED]\n  def cache(): Graph[VD, ED]\n  def unpersistVertices(blocking: Boolean = false): Graph[VD, ED]\n  // Change the partitioning heuristic  ============================================================\n  def partitionBy(partitionStrategy: PartitionStrategy): Graph[VD, ED]\n  // Transform vertex and edge attributes ==========================================================\n  def mapVertices[VD2](map: (VertexId, VD) =&gt; VD2): Graph[VD2, ED]\n  def mapEdges[ED2](map: Edge[ED] =&gt; ED2): Graph[VD, ED2]\n  def mapEdges[ED2](map: (PartitionID, Iterator[Edge[ED]]) =&gt; Iterator[ED2]): Graph[VD, ED2]\n  def mapTriplets[ED2](map: EdgeTriplet[VD, ED] =&gt; ED2): Graph[VD, ED2]\n  def mapTriplets[ED2](map: (PartitionID, Iterator[EdgeTriplet[VD, ED]]) =&gt; Iterator[ED2])\n    : Graph[VD, ED2]\n  // Modify the graph structure ====================================================================\n  def reverse: Graph[VD, ED]\n  def subgraph(\n      epred: EdgeTriplet[VD,ED] =&gt; Boolean = (x =&gt; true),\n      vpred: (VertexId, VD) =&gt; Boolean = ((v, d) =&gt; true))\n    : Graph[VD, ED]\n  def mask[VD2, ED2](other: Graph[VD2, ED2]): Graph[VD, ED]\n  def groupEdges(merge: (ED, ED) =&gt; ED): Graph[VD, ED]\n  // Join RDDs with the graph ======================================================================\n  def joinVertices[U](table: RDD[(VertexId, U)])(mapFunc: (VertexId, VD, U) =&gt; VD): Graph[VD, ED]\n  def outerJoinVertices[U, VD2](other: RDD[(VertexId, U)])\n      (mapFunc: (VertexId, VD, Option[U]) =&gt; VD2)\n    : Graph[VD2, ED]\n  // Aggregate information about adjacent triplets =================================================\n  def collectNeighborIds(edgeDirection: EdgeDirection): VertexRDD[Array[VertexId]]\n  def collectNeighbors(edgeDirection: EdgeDirection): VertexRDD[Array[(VertexId, VD)]]\n  def aggregateMessages[Msg: ClassTag](\n      sendMsg: EdgeContext[VD, ED, Msg] =&gt; Unit,\n      mergeMsg: (Msg, Msg) =&gt; Msg,\n      tripletFields: TripletFields = TripletFields.All)\n    : VertexRDD[A]\n  // Iterative graph-parallel computation ==========================================================\n  def pregel[A](initialMsg: A, maxIterations: Int, activeDirection: EdgeDirection)(\n      vprog: (VertexId, VD, A) =&gt; VD,\n      sendMsg: EdgeTriplet[VD, ED] =&gt; Iterator[(VertexId, A)],\n      mergeMsg: (A, A) =&gt; A)\n    : Graph[VD, ED]\n  // Basic graph algorithms ========================================================================\n  def pageRank(tol: Double, resetProb: Double = 0.15): Graph[Double, Double]\n  def connectedComponents(): Graph[VertexId, ED]\n  def triangleCount(): Graph[Int, ED]\n  def stronglyConnectedComponents(numIter: Int): Graph[VertexId, ED]\n}\n</code></pre>"},{"location":"distributed_computing/spark/spark_graphx.html#_3","title":"\u793a\u4f8b","text":"<p>\u793a\u4f8b\u56fe\u8868\u793a\uff1a</p> <p></p>"},{"location":"distributed_computing/spark/spark_graphx.html#_4","title":"\u6784\u9020","text":"<pre><code>// Assume the SparkContext has already been constructed\nval sc: SparkContext\n// Create an RDD for the vertices\nval users: RDD[(VertexId, (String, String))] =\n  sc.parallelize(Seq((3L, (\"rxin\", \"student\")), (7L, (\"jgonzal\", \"postdoc\")),\n                       (5L, (\"franklin\", \"prof\")), (2L, (\"istoica\", \"prof\"))))\n// Create an RDD for edges\nval relationships: RDD[Edge[String]] =\n  sc.parallelize(Seq(Edge(3L, 7L, \"collab\"),    Edge(5L, 3L, \"advisor\"),\n                       Edge(2L, 5L, \"colleague\"), Edge(5L, 7L, \"pi\")))\n// Define a default user in case there are relationship with missing user\nval defaultUser = (\"John Doe\", \"Missing\")\n// Build the initial Graph\nval graph = Graph(users, relationships, defaultUser)\n</code></pre>"},{"location":"distributed_computing/spark/spark_job_scheduling.html","title":"Spark \u4f5c\u4e1a\u8c03\u5ea6","text":"<p>https://spark.apache.org/docs/latest/job-scheduling.html#</p>"},{"location":"distributed_computing/spark/spark_job_scheduling.html#_1","title":"\u914d\u7f6e\u53c2\u6570","text":"<p>Spark Scheduler Configuration</p> <p>\u9ed1\u540d\u5355\u673a\u5236</p> <p><code>spark.excludeOnFailure.enabled</code>\uff1afalse\uff0c\u8bbe\u7f6e\u4e3atrue\u65f6\u4f1a\u7981\u6b62\u5411\u5931\u8d25\u6b21\u6570\u8fc7\u591a\u7684executors\u4e0a\u8c03\u5ea6task\uff1b</p> <ul> <li>\u5177\u4f53\u7684\u7b97\u6cd5\u53c2\u6570\u7531\u5404\u79cd\u914d\u7f6e\u51b3\u5b9a\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_job_scheduling.html#_2","title":"\u5e94\u7528\u95f4\u8c03\u5ea6","text":"<p>\u5728\u591a\u4e2a\u5e94\u7528\u4e4b\u95f4\u8c03\u5ea6\uff0c\u4f46\u4e0d\u652f\u6301\u8de8\u5e94\u7528\u7684\u5185\u5b58\u5171\u4eab</p> <ul> <li> <p>Standalone\uff1a\u9ed8\u8ba4FIFO\uff0c\u63a7\u5236 <code>spark.cores.max</code>\u548c <code>spark.executor.memory</code> \u63a7\u5236\u5e94\u7528\u4f7f\u7528\u7684\u8d44\u6e90\uff1b</p> </li> <li> <p>Yarn\uff1a<code>--num-executors</code>\uff0c<code>--executor-memory</code>\uff0c<code>--executor-cores</code> \u5373 <code>spark.executor.instances</code>, <code>spark.executor.memory</code>, <code>spark.executor.cores</code> \u63a7\u5236\u5e94\u7528\u4f7f\u7528\u7684\u8d44\u6e90\uff1b</p> </li> <li> <p>Mesos\uff1a<code>spark.mesos.coarse</code>\u8bbe\u7f6etrue\uff0c<code>spark.cores.max</code>\u548c<code>spark.executor.memory</code></p> </li> <li>\u53e6\u5916\u8fd8\u652f\u6301CPU\u6838\u7684\u52a8\u6001\u5171\u4eab\uff0c\u5f53\u524dapp\u6ca1\u6709Task\u8fd0\u884c\uff0c\u5219\u7533\u8bf7\u7684cores\u53ef\u4ee5\u88ab\u5176\u5b83app\u4f7f\u7528</li> </ul>"},{"location":"distributed_computing/spark/spark_job_scheduling.html#_3","title":"\u52a8\u6001\u8d44\u6e90\u5206\u914d","text":"<p>Spark\u63d0\u4f9b\u4e86\u4e00\u79cd\u57fa\u4e8e\u5de5\u4f5c\u8d1f\u8f7d\u52a8\u6001\u8c03\u6574\u5e94\u7528\u7a0b\u5e8f\u5360\u7528\u7684\u8d44\u6e90\u7684\u673a\u5236\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5982\u679c\u8d44\u6e90\u4e0d\u518d\u88ab\u4f7f\u7528\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u5c06\u5b83\u4eec\u8fd4\u56de\u7ed9\u96c6\u7fa4\uff0c\u5e76\u5728\u7a0d\u540e\u6709\u9700\u8981\u65f6\u518d\u6b21\u8bf7\u6c42\u5b83\u4eec\u3002\u652f\u6301Standalone\uff0cYarn\uff0cMesos\uff0cK8s\u3002\u4e24\u79cd\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <ul> <li><code>spark.dynamicAllocation.enabled</code>\uff1atrue\uff0c<code>spark.dynamicAllocation.shuffleTracking.enabled</code>\uff1atrue\uff1b</li> <li>Experimental\uff1a\u5bf9\u4e8ejob\u9700\u8981\u4f7f\u7528\u7684shuffle files\u6240\u5728\u7684executor\uff0c\u4e0d\u4f1a\u88ab\u91ca\u653e\uff1b</li> <li><code>spark.dynamicAllocation.enabled</code>\uff1atrue\uff0c<code>spark.shuffle.service.enabled</code>\uff1atrue\uff1b</li> <li>\u6bcf\u4e2aworker\u8282\u70b9\uff0c\u4f1a\u542f\u52a8<code>external shuffle service</code>\uff1b</li> </ul> <p>\u8d44\u6e90\u5206\u914d\u548c\u56de\u6536</p> <ul> <li>\u5f53\u6709pending\u7684task\u65f6\uff0c\u6bcf  <code>spark.dynamicAllocation.sustainedSchedulerBacklogTimeout</code> \uff08\u9ed8\u8ba41s\uff09\u89e6\u53d1</li> <li>\u8bf7\u6c42executor\u5206\u914d\uff1a\u5f53\u5b58\u5728pending task\u6301\u7eed\u65f6\u95f4\u8d85\u8fc7  <code>spark.dynamicAllocation.schedulerBacklogTimeout</code> (\u9ed8\u8ba4 1s)</li> <li> <p>\u6307\u6570\u7ea7\u5206\u914d\uff0c\u7b2c\u4e00\u6b21\u6ee1\u8db3\u5206\u914d1\uff0c\u7b2c\u4e8c\u6b21\u6ee1\u8db3\u5206\u914d 2 ... </p> </li> <li> <p>\u5f53 executor \u7a7a\u95f2\u8d85\u8fc7 <code>spark.dynamicAllocation.executorIdleTimeout</code>\uff08\u9ed8\u8ba460s\uff09 \u65f6\uff0c\u4f1a\u88ab\u56de\u6536\uff1b</p> </li> </ul> <p>Cache\u6570\u636e\u7684Executor\uff1a</p> <ul> <li>\u9ed8\u8ba4\u4e0d\u4f1a\u88ab\u56de\u6536\uff0c\u914d\u7f6e <code>spark.dynamicAllocation.cachedExecutorIdleTimeout</code>\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_job_scheduling.html#_4","title":"\u5e94\u7528\u5185\u8c03\u5ea6","text":"<p>\u5355\u4e2aSparkContext \u5b9e\u4f8b\uff0c\u901a\u8fc7\u591a\u7ebf\u7a0b\uff0c\u89e6\u53d1\u591a\u4e2aaction\u3002Spark\u7684\u8c03\u5ea6\u5668\u662f\u7ebf\u7a0b\u5b89\u5168\uff0c\u652f\u6301\u5e94\u7528\u540c\u65f6\u670d\u52a1\u591a\u4e2a\u8bf7\u6c42\u3002</p>"},{"location":"distributed_computing/spark/spark_job_scheduling.html#fifofair","title":"\u8c03\u5ea6\u7b56\u7565\uff08FIFO/Fair\uff09","text":"<p>\u901a\u8fc7Fair\u6216FIFO\u8c03\u5ea6\uff1b<code>spark.scheduler.mode</code>\uff0c\u9ed8\u8ba4FIFO</p> <ul> <li>FIFO\uff1a\u53ea\u6709\u524d\u9762\u7684job\u6ca1\u6709\u5360\u636e\u6240\u6709\u8d44\u6e90\u65f6\uff0c\u540e\u7eed\u7684job\u624d\u53ef\u4ee5\u8fd0\u884c\uff1b</li> <li>FAIR\uff1a\u901a\u8fc7round robin\u6a21\u5f0f\u5728jobs\u95f4\u5206\u914dTasks\uff0c\u9002\u7528\u4e8e\u591a\u7528\u6237\u7684\u573a\u666f\uff1b</li> </ul> <p>\u914d\u7f6e\u8c03\u5ea6\u7b56\u7565</p> <pre><code>val conf = new SparkConf().setMaster(...).setAppName(...)\nconf.set(\"spark.scheduler.mode\", \"FAIR\")\nval sc = new SparkContext(conf)\n</code></pre> <p>FAIR\u652f\u6301\u8c03\u5ea6\u6c60\uff0c\u5c06jobs\u653e\u5230\u4e0d\u540c\u7684\u6c60\u4e2d\u8fd0\u884c\uff0c\u4f8b\u5982\uff0c\u540c\u4e00\u4e2a\u7528\u6237\u53ef\u80fd\u8fd0\u884c\u5f88\u591ajob\uff0c\u4f46\u662f\u60f3\u8981\u7528\u6237\u5747\u5206\u8d44\u6e90\u800c\u4e0d\u662fjob\u5747\u5206\u8d44\u6e90</p> <pre><code>// \u5bf9\u4e0d\u540c\u7ebf\u7a0b\u8bbe\u7f6e\u4e0d\u540c\u7684\u6c60\uff0c\u8fd9\u4e2a\u7ebf\u7a0b\u63d0\u4ea4\u7684\u4efb\u4f55job\u90fd\u4f1a\u4f7f\u7528\u8fd9\u4e2apool name\nsc.setLocalProperty(\"spark.scheduler.pool\", \"pool1\")\n</code></pre>"},{"location":"distributed_computing/spark/spark_job_scheduling.html#_5","title":"\u8c03\u5ea6\u914d\u7f6e","text":"<p>\u9ed8\u8ba4\uff0c\u6bcf\u4e2apool\u5171\u4eab\u96c6\u7fa4\u8d44\u6e90\u3002\u4f46\u9ed8\u8ba4\u7684pool\u4e2djob\u95f4\u662fFair\uff0c\u81ea\u5b9a\u4e49\u65f6pool\u4e2djob\u95f4\u662fFIFO\uff1b</p> <ul> <li>\u81ea\u5b9a\u4e49\u7684pool\u652f\u6301\u914d\u7f6e\uff0c\u901a\u8fc7fairscheduler.xml\u6587\u4ef6</li> <li>schedulingMode\uff1aFIFO\uff08\u9ed8\u8ba4) \u6216 FAIR</li> <li>weight\uff1a\u9ed8\u8ba4\u4e3a1\uff0cpool\u7684\u4f18\u5148\u7ea7\uff0c\u8d8a\u5927\uff0c\u5176\u4e2d\u7684Task\u4f1a\u8d8a\u5148\u6267\u884c</li> <li>minShare\uff1a\u6700\u5c0f\u7684cpu\u6838\u6570\uff0c\u9ed8\u8ba4\u4e3a0</li> </ul> <p>\u9ed8\u8ba4\u7684\u8c03\u5ea6\u914d\u7f6e\u6587\u4ef6\u4e3a<code>conf/fairscheduler.xml</code>\uff0c\u53ef\u4ee5\u663e\u793a\u8bbe\u7f6e</p> <pre><code>conf.set(\"spark.scheduler.allocation.file\", \"/path/to/file\")\n</code></pre> <p>\u6587\u4ef6\u5185\u5bb9\u7c7b\u4f3c\uff1a\u6ca1\u6709\u5728XML\u6587\u4ef6\u4e2d\u914d\u7f6e\u7684\u4efb\u4f55\u6c60\u5c06\u7b80\u5355\u5730\u83b7\u5f97\u6240\u6709\u8bbe\u7f6e\u7684\u9ed8\u8ba4\u503c(\u8c03\u5ea6\u6a21\u5f0fFIFO\u3001\u6743\u91cd1\u548cminShare 0)\u3002</p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;allocations&gt;\n  &lt;pool name=\"production\"&gt;\n    &lt;schedulingMode&gt;FAIR&lt;/schedulingMode&gt;\n    &lt;weight&gt;1&lt;/weight&gt;\n    &lt;minShare&gt;2&lt;/minShare&gt;\n  &lt;/pool&gt;\n  &lt;pool name=\"test\"&gt;\n    &lt;schedulingMode&gt;FIFO&lt;/schedulingMode&gt;\n    &lt;weight&gt;2&lt;/weight&gt;\n    &lt;minShare&gt;3&lt;/minShare&gt;\n  &lt;/pool&gt;\n&lt;/allocations&gt;\n</code></pre> <p>JDBC \u5ba2\u6237\u7aefSession\u8bbe\u7f6eFair Scheduler Pool\uff0c\u53ef\u4ee5\u8bbe\u7f6e\uff1a</p> <pre><code>SET spark.sql.thriftserver.scheduler.pool=accounting;\n</code></pre>"},{"location":"distributed_computing/spark/spark_job_scheduling.html#pyspark","title":"PySpark \u5e76\u884c\u4f5c\u4e1a","text":"<p>\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cPySpark\u4e0d\u652f\u6301\u540c\u6b65PVM\u7ebf\u7a0b\u548cJVM\u7ebf\u7a0b\uff0c\u5e76\u4e14\u5728\u591a\u4e2aPVM\u7ebf\u7a0b\u4e2d\u542f\u52a8\u591a\u4e2a\u4f5c\u4e1a\u5e76\u4e0d\u4fdd\u8bc1\u542f\u52a8\u6bcf\u4e2a\u5bf9\u5e94JVM\u7ebf\u7a0b\u4e2d\u7684\u6bcf\u4e2a\u4f5c\u4e1a\u3002</p> <p>\u4e3a\u4e86\u540c\u6b65PVM\u7ebf\u7a0b\u548cJVM\u7ebf\u7a0b\uff0c\u60a8\u5e94\u8be5\u5c06<code>PYSPARK_PIN_THREAD</code>\u73af\u5883\u53d8\u91cf\u8bbe\u7f6e\u4e3atrue\u3002\u8fd9\u79cd\u56fa\u5b9a\u7ebf\u7a0b\u6a21\u5f0f\u5141\u8bb8\u4e00\u4e2aPVM\u7ebf\u7a0b\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684JVM\u7ebf\u7a0b\u3002</p> <p>\u6ce8\uff1aPYSPARK_PIN_THREAD\u76ee\u524d\u8fd8\u5904\u4e8e\u8bd5\u9a8c\u9636\u6bb5\u3002</p>"},{"location":"distributed_computing/spark/spark_listener.html","title":"Spark \u76d1\u542c\u5668","text":"<p>Spark \u4e2d\u63d0\u4f9b\u4e86\u4e8b\u4ef6\u76d1\u542c\u673a\u5236\uff0c\u53ef\u4ee5\u5728 Application/Job/Stage/Task \u7b49\u9636\u6bb5\u505a\u81ea\u5b9a\u4e49\u7684\u5904\u7406\u903b\u8f91\u3002</p> <pre><code>// \u6267\u884c\u662f\u5f02\u6b65\u7684\uff0c\u5373 caller \u53d1\u9001\u4e8b\u4ef6\u65f6\uff0c\u5904\u7406\u5728\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\uff0c\u4e0d\u4f1a\u963b\u585e caller\nsparkContext.addSparkListener(new SparkListener() extends SparkListenerInterface {\n    // job\u542f\u52a8\u7684\u4e8b\u4ef6\n    override def onJobStart(jobStart: SparkListenerJobStart): Unit = { }\n    ... ...\n})\n</code></pre> <p>SparkContext \u7684\u4e8b\u4ef6\u76d1\u542c\u5668\u662f\u7531 <code>LiveListenerBus</code>\u7ba1\u7406\uff0c<code>LiveListenBus</code>\u9ed8\u8ba4\u63d0\u4f9b\u56db\u4e2a\u76d1\u542c\u5668\u603b\u7ebf\uff1a</p> <ul> <li><code>shared</code>\uff1a\u6240\u6709\u7684\u4e0d\u662fSpark\u5185\u90e8\u7684\u76d1\u542c\u5668\u5171\u4eab\u7684\u603b\u7ebf\uff0c\u901a\u8fc7 SparkContext \u6ce8\u518c\u7684\u90fd\u6709\u5176\u5904\u7406\uff1b</li> <li><code>appStatus</code>\uff1a\u5e94\u7528\u72b6\u6001\u603b\u7ebf\uff1b</li> <li><code>executorManagement</code>\uff1aexecutor\u7ba1\u7406\u603b\u7ebf\uff0c\u5173\u5fc3executor\u4e0a\u4e0b\u7ebf\u7b49\u4e8b\u4ef6\uff08\u5982\u7528\u4e8e\u68c0\u6d4b idle executor\uff09\uff1b</li> <li><code>eventLog</code>\uff1a\u65e5\u5fd7\u4e8b\u4ef6\u603b\u7ebf\uff1b</li> </ul> <p>\u6bcf\u4e2a\u603b\u7ebf\u7c7b\u578b\u662f<code>AsyncEventQueue</code>\uff0c\u5176\u57fa\u7c7b\u662f<code>SparkListenerBus</code></p> <pre><code>// \u76d1\u542c\u5668\u7c7b\u578b\u662f SparkListenerInterface\uff0c\u5904\u7406\u4e8b\u4ef6\u662f SparkListenerEvent\ntrait SparkListenerBus extends ListenerBus[SparkListenerInterface, SparkListenerEvent] {\n  // \u7ee7\u627f ListenerBus \u8c03\u7528 listener \u7684 onXXX \u51fd\u6570\uff0c\u540c\u6b65\u8c03\u7528\n  protected override def doPostEvent( listener: SparkListenerInterface,\n      event: SparkListenerEvent): Unit = { ... ... }\n}\n\ntrait ListenerBus[L &lt;: AnyRef, E] extends Logging {\n    // \u5185\u90e8\u7ef4\u62a4\u4e86\u6240\u6709\u7684 listener\u5217\u8868\uff08\u5e76\u53d1\u5b89\u5168\uff09\n\n    // \u7ed9\u6240\u6709\u7684 listener \u5e7f\u64ad\u4e8b\u4ef6\uff0c\u8c03\u7528 doPostEvent \u65b9\u6cd5\uff0c\u8c03\u7528\u8005\u5e94\u8be5\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\n    def postToAll(event: E): Unit = { ... ... }\n\n    // \u5b50\u7c7b\u5b9e\u73b0\n    protected def doPostEvent(listener: L, event: E): Unit\n}\n</code></pre> <p><code>AsyncEventQueue</code>\u5185\u90e8\u7ef4\u62a4\u4e86<code>LinkedBlockingQueue</code>\uff0c\u5176\u5bb9\u91cf\u9ed8\u8ba4\u662f10000\uff0c\u5f02\u6b65\u4e8b\u4ef6\u5904\u7406\uff1a</p> <ul> <li><code>spark.scheduler.listenerbus.eventqueue.$name.capacity</code>\uff1a\u8be5\u53c2\u6570\u914d\u7f6e\u5bb9\u91cf\u5927\u5c0f\uff0c<code>$name</code>\u662f\u4e0a\u5356\u5f04\u56db\u4e2a\u540d\u5b57\u4e4b\u4e00\uff1b</li> <li><code>post</code>\u65b9\u6cd5\uff0c\u5c06\u4e8b\u4ef6\u52a0\u5165\u961f\u5217\uff0c\u8d85\u8fc7\u5bb9\u91cf\uff08\u65e0\u6cd5\u6dfb\u52a0\uff09\u5219\u4e22\u5f03\u5e76\u8bb0\u5f55\u65e5\u5fd7\uff1b</li> <li>\u63d0\u4f9b\u5355\u72ec\u7684\u7ebf\u7a0b\uff0c\u6267\u884c<code>dispatch</code>\u65b9\u6cd5\uff0c\u4ece\u961f\u5217\u4e2d\u963b\u585e\u6027\u83b7\u53d6\u4e8b\u4ef6\uff08\u62ff\u4e0d\u5230\u5219\u7b49\u5f85\uff09\uff1b</li> </ul> <p><code>AsyncEventQueue</code>\u4e2d\u7ebf\u7a0b\u505c\u6b62\u7684\u903b\u8f91\uff0c\u662f\u901a\u8fc7\u653e\u5165<code>POISON_PILL</code>\u4e8b\u4ef6\uff08\u4e00\u4e2a\u7279\u6b8a\u4e8b\u4ef6\uff09\u5b9e\u73b0\uff1a</p> <ul> <li>\u4fdd\u8bc1\u5185\u90e8\u6240\u6709\u7684\u4e8b\u4ef6\u90fd\u88ab\u5904\u7406\u5b8c\uff0c\u56e0\u4e3a<code>take</code>\u4f1a\u963b\u585e\u7b49\u5f85\u3002</li> </ul> <pre><code>private def dispatch(): Unit = LiveListenerBus.withinListenerThread.withValue(true) {\n  var next: SparkListenerEvent = eventQueue.take()\n  while (next != POISON_PILL) {\n    val ctx = processingTime.time()\n      try {\n        super.postToAll(next)\n      } finally {\n        ctx.stop()\n      }\n    eventCount.decrementAndGet()\n    next = eventQueue.take()\n  }\n  eventCount.decrementAndGet()\n}\n\nprivate[scheduler] def stop(): Unit = {\n  if (!started.get()) {\n    throw new IllegalStateException(s\"Attempted to stop $name that has not yet started!\")\n  }\n  if (stopped.compareAndSet(false, true)) {\n    eventCount.incrementAndGet()\n    eventQueue.put(POISON_PILL)\n  }\n  // This thread might be trying to stop itself as part of error handling -- we can't join\n  // in that case.\n  if (Thread.currentThread() != dispatchThread) {\n    // If users don't want to wait for the dispatch to end until all events are drained,\n    // they can control the waiting time by themselves.\n    // By default, the `waitingTimeMs` is set to 0,\n    // which means it will wait until all events are drained.\n    val exitTimeoutMs = conf.get(LISTENER_BUS_EXIT_TIMEOUT)\n    dispatchThread.join(exitTimeoutMs)\n  }\n}\n\nval POISON_PILL = new SparkListenerEvent() { }\n</code></pre>"},{"location":"distributed_computing/spark/spark_monitor.html","title":"Spark Monitor","text":"<p>RSS/VM \u5185\u5b58\uff1aPID \u4e3a executor\u8fdb\u7a0b\u7684\u7236PID\uff0c\u641c\u7d22\u5176\u6240\u6709\u7684\u5b50PID</p> <ul> <li>java / python / other\uff1a\u6839\u636e\u8fdb\u7a0b\u540d\u533a\u5206\uff0c</li> </ul>"},{"location":"distributed_computing/spark/spark_monitor.html#metrics","title":"Metrics","text":"<p>\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u4f1a\u521d\u59cb\u5316 MetricsSystem</p> <ul> <li>SparkEnv \u4f1a\u521d\u59cb\u5316 MetricsSystem\uff0c\u4f46\u5e76\u4e0d\u542f\u52a8\uff1b</li> <li>Driver\uff1aSparkContext \u521b\u5efaDriver env\uff0c\u5e76\u542f\u52a8\u6bcf\u4e2a\u914d\u7f6e\u7684 Sink\uff08\u5c06 servlet\u7684 sink \u6dfb\u52a0\u5230 UI \u4e2d\uff09\uff1b</li> <li>Executor\uff1aCoarseGrainedExecutorBackend \u521b\u5efa Executor Env\uff0c\u5e76\u542f\u52a8\u6bcf\u4e2a\u914d\u7f6e\u7684 Sink\uff08\u4f46\u5e76\u6ca1\u6709UI\uff0c\u65e0\u6cd5\u6dfb\u52a0 servlet\uff09\uff1b</li> <li>ExternalShuffleService</li> <li>Standalone Master</li> <li>Standlone Worker</li> </ul> <p>\u6709\u4e24\u79cd\uff0c\u4e00\u79cd\u5728Driver\u7aef\uff08\u901a\u8fc7\u5fc3\u8df3\u83b7\u53d6\uff0c\u5305\u62ecDriver/Executor\u7684metrics\uff09\uff0c\u53e6\u4e00\u79cd\u5219\u662f\u6bcf\u4e2a\u8fdb\u7a0b\u5355\u72ec\u7684Metrics\u3002</p>"},{"location":"distributed_computing/spark/spark_monitor.html#driver-ui","title":"Driver UI","text":"<ul> <li><code>/metrics/executors/prometheus</code>\u6216\u8005<code>/api/v1/applications/[app-id]/executors</code>\uff1a\u53ea\u80fd\u63d0\u4f9b\u5185\u5b58\u7684\u5cf0\u503c\uff0c\u901a\u8fc7<code>ExecutorSummary</code>\u83b7\u53d6\uff1b</li> </ul> <pre><code>spark_info{version=\"3.0.2\", revision=\"648457905c4ea7d00e3d88048c63f360045f0714\"} 1.0\n... ...\n... ...\nmetrics_executor_ProcessTreeJVMVMemory_bytes{application_id=\"app-20221118102536-0010\", application_name=\"Spark Pi\", executor_id=\"0\"} 7801798656\nmetrics_executor_ProcessTreeJVMRSSMemory_bytes{application_id=\"app-20221118102536-0010\", application_name=\"Spark Pi\", executor_id=\"0\"} 710107136\nmetrics_executor_ProcessTreePythonVMemory_bytes{application_id=\"app-20221118102536-0010\", application_name=\"Spark Pi\", executor_id=\"0\"} 0\nmetrics_executor_ProcessTreePythonRSSMemory_bytes{application_id=\"app-20221118102536-0010\", application_name=\"Spark Pi\", executor_id=\"0\"} 0\n</code></pre>"},{"location":"distributed_computing/spark/spark_monitor.html#metrics-sink","title":"Metrics Sink","text":"<pre><code>*.sink.prometheusServlet.class=org.apache.spark.metrics.sink.PrometheusServlet\n*.sink.prometheusServlet.path=/metrics/prometheus\nmaster.sink.prometheusServlet.path=/metrics/master/prometheus\napplications.sink.prometheusServlet.path=/metrics/applications/prometheus\n</code></pre> <ul> <li>Sink\uff1a\u80fd\u591f\u62ff\u5230\u5b9e\u65f6\u5185\u5b58\u503c\uff0c\u4f46\u9700\u8981\u6bcf\u4e2aexecutor\u5355\u72ec\u83b7\u53d6\uff1b</li> <li><code>ConsoleSink</code>\uff0c<code>CSVSink</code>\uff1adriver/executor \u90fd\u4f1a\u6267\u884c\uff1b</li> <li><code>MetricsServelt</code>\uff0c<code>PrometheusServlet</code> \uff1a\u53ea\u6709Driver\u6709UI\uff0c\u624d\u80fd\u901a\u8fc7Rest\u63a5\u53e3\u8bbf\u95ee\uff0cExecutor\u7684\u6570\u636e\u65e0\u6cd5\u8bbf\u95ee\uff1b</li> </ul> <pre><code>metrics_app_20221118102536_0010_driver_ExecutorMetrics_ProcessTreeJVMRSSMemory_Number{type=\"gauges\"} 2964197376\nmetrics_app_20221118102536_0010_driver_ExecutorMetrics_ProcessTreeJVMRSSMemory_Value{type=\"gauges\"} 2964197376\nmetrics_app_20221118102536_0010_driver_ExecutorMetrics_ProcessTreeJVMVMemory_Number{type=\"gauges\"} 18204434432\nmetrics_app_20221118102536_0010_driver_ExecutorMetrics_ProcessTreeJVMVMemory_Value{type=\"gauges\"} 18204434432\nmetrics_app_20221118102536_0010_driver_ExecutorMetrics_ProcessTreeOtherRSSMemory_Number{type=\"gauges\"} 0\n</code></pre>"},{"location":"distributed_computing/spark/spark_monitor.html#sink","title":"\u81ea\u5b9a\u4e49SInk","text":""},{"location":"distributed_computing/spark/spark_monitor.html#prometheus","title":"Prometheus \u5b9e\u65f6\u503c\u65b9\u6848","text":"<ul> <li>Prometheus gateway push sink\uff1a\u901a\u8fc7\u81ea\u5b9a\u4e49Sink\u5b9e\u73b0\u5411Prometheus Gateway \u63a8\u9001\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_monitor.html#source","title":"\u81ea\u5b9a\u4e49 Source","text":"<p>Demo \u793a\u4f8b</p> <pre><code>spark.metrics.conf.[component_name].source.jvm.class=[source_name]\n// \u4f8b\u5982 spark \u81ea\u5e26\u7684\n\"spark.metrics.conf.*.source.jvm.class\" = \"org.apache.spark.metrics.source.JvmSource\"\n</code></pre>"},{"location":"distributed_computing/spark/spark_optimize.html","title":"Spark \u8c03\u4f18","text":""},{"location":"distributed_computing/spark/spark_optimize.html#_1","title":"\u6570\u636e\u503e\u659c","text":"<p>\u6570\u636e\u503e\u659c\u53ea\u4f1a\u53d1\u751f\u5728shuffle\u8fc7\u7a0b\u4e2d</p>"},{"location":"distributed_computing/spark/spark_optimize.html#_2","title":"\u5b9a\u4f4d","text":"<ul> <li>\u5728WebUI\u4e0a\uff0c\u67e5\u770bstage\u5404\u4e2atask\u5206\u914d\u7684\u6570\u636e\u91cf\uff1b</li> <li>\u6839\u636estage\uff0c\u786e\u5b9a\u5bf9\u5e94\u7684\u6e90\u7801\u4f4d\u7f6e\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_optimize.html#_3","title":"\u89e3\u51b3","text":"<p>\u5206\u6790key\u7684\u6570\u636e\u5206\u5e03\u60c5\u51b5</p> <ul> <li> <p>\u9884\u5148\u5904\u7406\uff08\u4e00\u6b21\u5904\u7406\uff0c\u591a\u6b21\u4f7f\u7528\u7684\u573a\u666f\uff09\uff1a\u5c06\u6570\u636e\u63d0\u524d\u9884\u5904\u7406\uff08\u4ecd\u7136\u6709\u6570\u636e\u503e\u659c\u95ee\u9898\uff09\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u6570\u636e\uff0c\u4e0d\u9700\u8981\u518d\u4f7f\u7528shuffle\uff1b</p> </li> <li> <p>\u4e24\u9636\u6bb5\u805a\u5408\uff08\u5c40\u90e8\u805a\u5408+\u5168\u5c40\u805a\u5408\uff09\uff1a\u9488\u5bf9\u5355\u6b21\u4f7f\u7528\u7684\u573a\u666f\uff0c\u4ec5\u4ec5\u9002\u7528\u4e8e\u805a\u5408\u7c7b\u7684shuffle\u64cd\u4f5c\uff08\u4e0d\u9002\u5408join\uff09</p> </li> <li>\u5c06\u539f\u672c\u76f8\u540c\u7684key\u901a\u8fc7\u9644\u52a0\u968f\u673a\u524d\u7f00\u7684\u65b9\u5f0f\uff0c\u53d8\u6210\u591a\u4e2a\u4e0d\u540c\u7684key\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_optimize.html#_4","title":"\u76f8\u5173\u53c2\u6570\u8c03\u4f18","text":""},{"location":"distributed_computing/spark/spark_optimize.html#sparkshufflefilebuffer","title":"spark.shuffle.file.buffer","text":"<ul> <li>\u9ed8\u8ba4\u503c\uff1a32k</li> <li>\u53c2\u6570\u8bf4\u660e\uff1a\u8be5\u53c2\u6570\u7528\u4e8e\u8bbe\u7f6eshuffle write task\u7684BufferedOutputStream\u7684buffer\u7f13\u51b2\u5927\u5c0f\u3002\u5c06\u6570\u636e\u5199\u5230\u78c1\u76d8\u6587\u4ef6\u4e4b\u524d\uff0c\u4f1a\u5148\u5199\u5165buffer\u7f13\u51b2\u4e2d\uff0c\u5f85\u7f13\u51b2\u5199\u6ee1\u4e4b\u540e\uff0c\u624d\u4f1a\u6ea2\u5199\u5230\u78c1\u76d8\u3002</li> <li>\u8c03\u4f18\u5efa\u8bae\uff1a\u5982\u679c\u4f5c\u4e1a\u53ef\u7528\u7684\u5185\u5b58\u8d44\u6e90\u8f83\u4e3a\u5145\u8db3\u7684\u8bdd\uff0c\u53ef\u4ee5\u9002\u5f53\u589e\u52a0\u8fd9\u4e2a\u53c2\u6570\u7684\u5927\u5c0f\uff08\u6bd4\u598264k\uff09\uff0c\u4ece\u800c\u51cf\u5c11shuffle write\u8fc7\u7a0b\u4e2d\u6ea2\u5199\u78c1\u76d8\u6587\u4ef6\u7684\u6b21\u6570\uff0c\u4e5f\u5c31\u53ef\u4ee5\u51cf\u5c11\u78c1\u76d8IO\u6b21\u6570\uff0c\u8fdb\u800c\u63d0\u5347\u6027\u80fd\u3002\u5728\u5b9e\u8df5\u4e2d\u53d1\u73b0\uff0c\u5408\u7406\u8c03\u8282\u8be5\u53c2\u6570\uff0c\u6027\u80fd\u4f1a\u67091%~5%\u7684\u63d0\u5347\u3002</li> </ul>"},{"location":"distributed_computing/spark/spark_optimize.html#sparkreducermaxsizeinflight","title":"spark.reducer.maxSizeInFlight","text":"<ul> <li>\u9ed8\u8ba4\u503c\uff1a48m</li> <li>\u53c2\u6570\u8bf4\u660e\uff1a\u8be5\u53c2\u6570\u7528\u4e8e\u8bbe\u7f6eshuffle read task\u7684buffer\u7f13\u51b2\u5927\u5c0f\uff0c\u800c\u8fd9\u4e2abuffer\u7f13\u51b2\u51b3\u5b9a\u4e86\u6bcf\u6b21\u80fd\u591f\u62c9\u53d6\u591a\u5c11\u6570\u636e\u3002</li> <li>\u8c03\u4f18\u5efa\u8bae\uff1a\u5982\u679c\u4f5c\u4e1a\u53ef\u7528\u7684\u5185\u5b58\u8d44\u6e90\u8f83\u4e3a\u5145\u8db3\u7684\u8bdd\uff0c\u53ef\u4ee5\u9002\u5f53\u589e\u52a0\u8fd9\u4e2a\u53c2\u6570\u7684\u5927\u5c0f\uff08\u6bd4\u598296m\uff09\uff0c\u4ece\u800c\u51cf\u5c11\u62c9\u53d6\u6570\u636e\u7684\u6b21\u6570\uff0c\u4e5f\u5c31\u53ef\u4ee5\u51cf\u5c11\u7f51\u7edc\u4f20\u8f93\u7684\u6b21\u6570\uff0c\u8fdb\u800c\u63d0\u5347\u6027\u80fd\u3002\u5728\u5b9e\u8df5\u4e2d\u53d1\u73b0\uff0c\u5408\u7406\u8c03\u8282\u8be5\u53c2\u6570\uff0c\u6027\u80fd\u4f1a\u67091%~5%\u7684\u63d0\u5347\u3002</li> </ul>"},{"location":"distributed_computing/spark/spark_optimize.html#sparkshuffleiomaxretries","title":"spark.shuffle.io.maxRetries","text":"<ul> <li>\u9ed8\u8ba4\u503c\uff1a3</li> <li>\u53c2\u6570\u8bf4\u660e\uff1ashuffle read task\u4eceshuffle write task\u6240\u5728\u8282\u70b9\u62c9\u53d6\u5c5e\u4e8e\u81ea\u5df1\u7684\u6570\u636e\u65f6\uff0c\u5982\u679c\u56e0\u4e3a\u7f51\u7edc\u5f02\u5e38\u5bfc\u81f4\u62c9\u53d6\u5931\u8d25\uff0c\u662f\u4f1a\u81ea\u52a8\u8fdb\u884c\u91cd\u8bd5\u7684\u3002\u8be5\u53c2\u6570\u5c31\u4ee3\u8868\u4e86\u53ef\u4ee5\u91cd\u8bd5\u7684\u6700\u5927\u6b21\u6570\u3002\u5982\u679c\u5728\u6307\u5b9a\u6b21\u6570\u4e4b\u5185\u62c9\u53d6\u8fd8\u662f\u6ca1\u6709\u6210\u529f\uff0c\u5c31\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4f5c\u4e1a\u6267\u884c\u5931\u8d25\u3002</li> <li>\u8c03\u4f18\u5efa\u8bae\uff1a\u5bf9\u4e8e\u90a3\u4e9b\u5305\u542b\u4e86\u7279\u522b\u8017\u65f6\u7684shuffle\u64cd\u4f5c\u7684\u4f5c\u4e1a\uff0c\u5efa\u8bae\u589e\u52a0\u91cd\u8bd5\u6700\u5927\u6b21\u6570\uff08\u6bd4\u598260\u6b21\uff09\uff0c\u4ee5\u907f\u514d\u7531\u4e8eJVM\u7684full gc\u6216\u8005\u7f51\u7edc\u4e0d\u7a33\u5b9a\u7b49\u56e0\u7d20\u5bfc\u81f4\u7684\u6570\u636e\u62c9\u53d6\u5931\u8d25\u3002\u5728\u5b9e\u8df5\u4e2d\u53d1\u73b0\uff0c\u5bf9\u4e8e\u9488\u5bf9\u8d85\u5927\u6570\u636e\u91cf\uff08\u6570\u5341\u4ebf~\u4e0a\u767e\u4ebf\uff09\u7684shuffle\u8fc7\u7a0b\uff0c\u8c03\u8282\u8be5\u53c2\u6570\u53ef\u4ee5\u5927\u5e45\u5ea6\u63d0\u5347\u7a33\u5b9a\u6027\u3002</li> </ul>"},{"location":"distributed_computing/spark/spark_optimize.html#sparkshuffleioretrywait","title":"spark.shuffle.io.retryWait","text":"<ul> <li>\u9ed8\u8ba4\u503c\uff1a5s</li> <li>\u53c2\u6570\u8bf4\u660e\uff1a\u5177\u4f53\u89e3\u91ca\u540c\u4e0a\uff0c\u8be5\u53c2\u6570\u4ee3\u8868\u4e86\u6bcf\u6b21\u91cd\u8bd5\u62c9\u53d6\u6570\u636e\u7684\u7b49\u5f85\u95f4\u9694\uff0c\u9ed8\u8ba4\u662f5s\u3002</li> <li>\u8c03\u4f18\u5efa\u8bae\uff1a\u5efa\u8bae\u52a0\u5927\u95f4\u9694\u65f6\u957f\uff08\u6bd4\u598260s\uff09\uff0c\u4ee5\u589e\u52a0shuffle\u64cd\u4f5c\u7684\u7a33\u5b9a\u6027\u3002</li> </ul>"},{"location":"distributed_computing/spark/spark_optimize.html#sparkshufflesortbypassmergethreshold","title":"spark.shuffle.sort.bypassMergeThreshold","text":"<ul> <li>\u9ed8\u8ba4\u503c\uff1a200</li> <li>\u53c2\u6570\u8bf4\u660e\uff1a\u5982\u679cshuffle read task\u7684\u6570\u91cf\u5c0f\u4e8e\u8fd9\u4e2a\u9608\u503c\uff08\u9ed8\u8ba4\u662f200\uff09\u4e14\u6ca1\u6709map\u7aef\u805a\u5408\uff0c\u5219shuffle write\u8fc7\u7a0b\u4e2d\u4e0d\u4f1a\u8fdb\u884c\u6392\u5e8f\u64cd\u4f5c\uff0c\u800c\u662f\u76f4\u63a5\u6309\u7167\u672a\u7ecf\u4f18\u5316\u7684HashShuffleManager\u7684\u65b9\u5f0f\u53bb\u5199\u6570\u636e\uff0c\u4f46\u662f\u6700\u540e\u4f1a\u5c06\u6bcf\u4e2atask\u4ea7\u751f\u7684\u6240\u6709\u4e34\u65f6\u78c1\u76d8\u6587\u4ef6\u90fd\u5408\u5e76\u6210\u4e00\u4e2a\u6587\u4ef6\uff0c\u5e76\u4f1a\u521b\u5efa\u5355\u72ec\u7684\u7d22\u5f15\u6587\u4ef6\u3002</li> <li>\u8c03\u4f18\u5efa\u8bae\uff1a\u5f53\u4f60\u4f7f\u7528SortShuffleManager\u65f6\uff0c\u5982\u679c\u7684\u786e\u4e0d\u9700\u8981\u6392\u5e8f\u64cd\u4f5c\uff0c\u90a3\u4e48\u5efa\u8bae\u5c06\u8fd9\u4e2a\u53c2\u6570\u8c03\u5927\u4e00\u4e9b\uff0c\u5927\u4e8eshuffle read task\u7684\u6570\u91cf\u3002\u90a3\u4e48\u6b64\u65f6\u5c31\u4f1a\u81ea\u52a8\u542f\u7528bypass\u673a\u5236\uff0cmap-side\u5c31\u4e0d\u4f1a\u8fdb\u884c\u6392\u5e8f\uff0c\u51cf\u5c11\u4e86\u6392\u5e8f\u7684\u6027\u80fd\u5f00\u9500\u3002\u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u4e0b\uff0c\u4f9d\u7136\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u78c1\u76d8\u6587\u4ef6\uff0c\u56e0\u6b64shuffle write\u6027\u80fd\u6709\u5f85\u63d0\u9ad8\u3002</li> </ul>"},{"location":"distributed_computing/spark/spark_output.html","title":"Committers","text":""},{"location":"distributed_computing/spark/spark_output.html#batch","title":"Batch","text":""},{"location":"distributed_computing/spark/spark_output.html#hadoop-fileoutputformat","title":"Hadoop FileOutputFormat","text":"<p>Hadoop\u7684<code>FileOutputFormat</code> \u548c <code>FileOutputCommitter</code>\uff0c\u5206\u4e3a<code>commitTask, commitJob, recoveryTask, abortTask, abortJob</code> \u51e0\u4e2a\u51fd\u6570\u3002</p> <p><code>mapreduce.fileoutputcommitter.algorithm.version</code>\uff1a\u9ed8\u8ba4\u4e3a1</p> <ul> <li>\u503c\u4e3a1\u65f6\uff1a</li> <li>Task \u7ebf\u7a0b\u5c06 TaskAttempt \u6570\u636e\u5199\u5165 <code>${output.dir.root}/_temporary/${appAttempt}/_temporary/${taskAttempt}</code></li> <li>commitTask \u7531 Task \u7ebf\u7a0b\u5c06 <code>${output.dir.root}/_temporary/${appAttempt}/_temporary/${taskAttempt}</code> \u79fb\u52a8\u5230 <code>${output.dir.root}/_temporary/${appAttempt}/${taskAttempt}</code></li> <li>commitJob \u7531 Driver \u5355\u7ebf\u7a0b\u4f9d\u6b21\u5c06\u6240\u6709 <code>${output.dir.root}/_temporary/${appAttempt}/${taskAttempt}</code> \u79fb\u52a8\u5230 <code>${output.dir.root}</code>\uff0c\u7136\u540e\u521b\u5efa <code>_SUCCESS</code> \u6807\u8bb0\u6587\u4ef6</li> <li>recoverTask \u7531 Task \u7ebf\u7a0b\u5c06 <code>${output.dir.root}/_temporary/${preAppAttempt}/${preTaskAttempt}</code> \u79fb\u52a8\u5230 <code>${output.dir.root}/_temporary/${appAttempt}/${taskAttempt}</code></li> <li>\u503c\u4e3a2\u65f6\uff1a\uff08hadoop 2.7 \u4e4b\u540e\u7248\u672c\uff09</li> <li>Task \u7ebf\u7a0b\u5c06 TaskAttempt \u6570\u636e\u5199\u5165 <code>${output.dir.root}/_temporary/${appAttempt}/_temporary/${taskAttempt}</code></li> <li>commitTask \u7531 Task \u7ebf\u7a0b\u5c06 <code>${output.dir.root}/_temporary/${appAttempt}/_temporary/${taskAttempt}</code> \u79fb\u52a8\u5230 <code>${output.dir.root}</code></li> <li>commitJob \u521b\u5efa <code>_SUCCESS</code> \u6807\u8bb0\u6587\u4ef6</li> <li>recoverTask \u65e0\u9700\u4efb\u4f55\u64cd\u4f5c</li> </ul> <p>V1 vs. V2 committer \u6027\u80fd\u5bf9\u6bd4</p> <ul> <li>V1 \u5728 Job \u6267\u884c\u7ed3\u675f\u540e\uff0c\u5728 Driver \u7aef\u901a\u8fc7 commitJob \u65b9\u6cd5\uff0c\u5355\u7ebf\u7a0b\u4e32\u884c\u5c06\u6240\u6709 Task \u7684\u8f93\u51fa\u6587\u4ef6\u79fb\u52a8\u5230\u8f93\u51fa\u6839\u76ee\u5f55\u3002\u79fb\u52a8\u4ee5\u6587\u4ef6\u4e3a\u5355\u4f4d\uff0c\u5f53 Task \u4e2a\u6570\u8f83\u591a\uff08\u5927 Job\uff0c\u6216\u8005\u5c0f\u6587\u4ef6\u5f15\u8d77\u7684\u5927\u91cf\u5c0f Task\uff09\uff0cName Node RPC \u8f83\u6162\u65f6\uff0c\u8be5\u8fc7\u7a0b\u8017\u65f6\u8f83\u4e45\u3002\u5728\u5b9e\u8df5\u4e2d\uff0c\u53ef\u80fd\u56e0\u6b64\u53d1\u751f\u6240\u6709 Task \u5747\u6267\u884c\u7ed3\u675f\uff0c\u4f46 Job \u4e0d\u7ed3\u675f\u7684\u95ee\u9898\u3002\u751a\u81f3 commitJob \u8017\u65f6\u6bd4 \u6240\u6709 Task \u6267\u884c\u65f6\u95f4\u8fd8\u8981\u957f</li> <li>\u800c V2 \u5728 Task \u7ed3\u675f\u540e\uff0c\u7531 Task \u5728 commitTask \u65b9\u6cd5\u5185\uff0c\u5c06\u81ea\u5df1\u7684\u6570\u636e\u6587\u4ef6\u79fb\u52a8\u5230\u8f93\u51fa\u6839\u76ee\u5f55\u3002\u4e00\u65b9\u9762\uff0cTask \u7ed3\u675f\u65f6\u5373\u79fb\u52a8\u6587\u4ef6\uff0c\u4e0d\u9700\u7b49\u5f85 Job \u7ed3\u675f\u624d\u79fb\u52a8\u6587\u4ef6\uff0c\u5373\u6587\u4ef6\u79fb\u52a8\u66f4\u65e9\u53d1\u8d77\uff0c\u4e5f\u66f4\u65e9\u7ed3\u675f\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u4e0d\u540c Task \u95f4\u5e76\u884c\u79fb\u52a8\u6587\u4ef6\uff0c\u6781\u5927\u7f29\u77ed\u4e86\u6574\u4e2a Job \u5185\u6240\u6709 Task \u7684\u6587\u4ef6\u79fb\u52a8\u8017\u65f6</li> </ul> <p>V1 vs. V2 committer \u4e00\u81f4\u6027\u5bf9\u6bd4</p> <ul> <li>V1 \u53ea\u6709 Job \u7ed3\u675f\uff0c\u624d\u4f1a\u5c06\u6570\u636e\u6587\u4ef6\u79fb\u52a8\u5230\u8f93\u51fa\u6839\u76ee\u5f55\uff0c\u624d\u4f1a\u5bf9\u5916\u53ef\u89c1\u3002\u5728\u6b64\u4e4b\u524d\uff0c\u6240\u6709\u6587\u4ef6\u5747\u5728 <code>${output.dir.root}/_temporary/${appAttempt}</code> \u53ca\u5176\u5b50\u6587\u4ef6\u5185\uff0c\u5bf9\u5916\u4e0d\u53ef\u89c1\u3002</li> <li>commitJob \u8fc7\u7a0b\u53ef\u80fd\u8017\u65f6\u8f83\u4e45\uff0c\u5982\u679c\u5728\u6b64\u8fc7\u7a0b\u4e2d\uff0cDriver \u5931\u8d25\uff0c\u5219\u53ef\u80fd\u53d1\u751f\u90e8\u5206 Task \u6570\u636e\u88ab\u79fb\u52a8\u5230 ${output.dir.root} \u5bf9\u5916\u53ef\u89c1\uff0c\u90e8\u5206 Task \u7684\u6570\u636e\u672a\u53ca\u65f6\u79fb\u52a8\uff0c\u5bf9\u5916\u4e0d\u53ef\u89c1\u7684\u95ee\u9898\u3002\u6b64\u65f6\u53d1\u751f\u4e86\u6570\u636e\u4e0d\u4e00\u81f4\u6027\u7684\u95ee\u9898</li> <li>V2 \u5f53 Task \u7ed3\u675f\u65f6\uff0c\u7acb\u5373\u5c06\u6570\u636e\u79fb\u52a8\u5230 ${output.dir.root}\uff0c\u7acb\u5373\u5bf9\u5916\u53ef\u89c1\u3002\u5982\u679c Application \u6267\u884c\u8fc7\u7a0b\u4e2d\u5931\u8d25\u4e86\uff0c\u5df2 commit \u7684 Task \u6570\u636e\u4ecd\u7136\u5bf9\u5916\u53ef\u89c1\uff0c\u800c\u5931\u8d25\u7684 Task \u6570\u636e\u6216\u672a\u88ab commit \u7684 Task \u6570\u636e\u5bf9\u5916\u4e0d\u53ef\u89c1\u3002\u4e5f\u5373 V2 \u66f4\u6613\u53d1\u751f\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898</li> </ul>"},{"location":"distributed_computing/spark/spark_output.html#s3acommitter","title":"S3ACommitter","text":"<p>Apache Hadoop Amazon Web Services support \u2013 Committing work to S3 with the S3A Committers</p> <p>staging(directory/partitioned), magic committer</p> <ul> <li>MinIO \u6ca1\u6709\u4e00\u81f4\u6027\u7f3a\u70b9\uff0c\u56e0\u4e3a\u5b83\u662f\u4e25\u683c\u4e00\u81f4\uff0c\u53ef\u4ee5\u4f7f\u7528 magic committer\uff08high performance than stage committer\uff09\uff1b</li> </ul> <p>stage committer</p> <ul> <li>\u91c7\u7528S3 Multipart Upload\u673a\u5236\u66ff\u6362\u4e86Rename\u673a\u5236\uff1b</li> <li>S3\u800c\u8a00\uff0cRename\u4e0d\u4ec5\u4ec5\u4f1a\u5e26\u6765\u6027\u80fd\u95ee\u9898\uff0c\u8fd8\u53ef\u80fd\u56e0\u4e3aS3\u7684\u201c\u6700\u7ec8\u4e00\u81f4\u6027\u201d\u7279\u6027\u800c\u5931\u8d25<ul> <li>rename \u7b49\u4ef7\u4e8e \u4f7f\u7528List + Copy + Delete\u4e09\u4e2a\u52a8\u4f5c\uff0c\u4f46\u662f\u6ca1\u6709\u539f\u5b50\u6027\uff1b</li> <li>\u6700\u7ec8\u4e00\u81f4\u6027\uff0c\u4f1a\u5bfc\u81f4\u6587\u4ef6\u65b0\u589e/\u5220\u9664\u65f6\uff0cList\u53ef\u80fd\u4f1a\u62ff\u5230\u7f3a\u5931\u7684\u4fe1\u606f\u6216\u8005\u88ab\u5220\u9664\u7684\u4fe1\u606f\uff1b</li> </ul> </li> <li>\u6bcf\u4e2aTask\u4e2d\u5c06\u6570\u636e\u5148\u5199\u5165\u5230\u672c\u5730\u78c1\u76d8\uff0c\u7136\u540e\u91c7\u7528Multipart Upload\u65b9\u5f0f\u4e0a\u4f20\u5230S3\uff1b</li> <li>\u6240\u6709Task\u90fd\u5b8c\u6210\u540e\uff0c\u7531 Job \u7edf\u4e00\u5411 S3\u53d1\u9001Complete\u4fe1\u53f7\uff0c\u6b64\u65f6\u6587\u4ef6\u5bf9\u5916\u53ef\u89c1\uff1b<ul> <li>\u8fd9\u91cc\u7684 RPC \u6b21\u6570\u662f\u9488\u5bf9\u6bcf\u4e2aTask\u7684\u6587\u4ef6\u90fd\u8981\u53d1\u9001\u4e00\u6b21\uff1f</li> </ul> </li> <li>\u4e5f\u53ef\u4ee5\u5728 CommitTask \u9636\u6bb5\uff0c\u8fdb\u884c <code>Upload Completion</code> \uff08\u7c7b\u4f3c FileOutputFormat V2\uff09\uff1b </li> </ul> <p></p>"},{"location":"distributed_computing/spark/spark_output.html#filecommitprotocol","title":"FileCommitProtocol","text":"<p>Spark \u81ea\u8eab\u62bd\u8c61\u51fa\u6765\u7684 File Commit \u534f\u8bae\uff0c\u5b9a\u4e49\u4e86 setupJob, commitTask \u7b49\u9636\u6bb5\u3002</p> <ul> <li>RDD\uff1a<code>SparkHadoopWriter</code>-&gt;<code>HadoopMapReduceCommitProtocol</code></li> <li>DataFrame\uff1a<code>DataSource</code>-&gt;<code>InsertIntoHadoopFsRelationCommand</code> -&gt; <code>SQLHadoopMapReduceCommitProtocol</code></li> </ul>"},{"location":"distributed_computing/spark/spark_output.html#streaming","title":"Streaming","text":""},{"location":"distributed_computing/spark/spark_output.html#manifestfilecommitprotocol","title":"ManifestFileCommitProtocol","text":"<p>tracks the list of valid files in a manifest file, used in structured streaming.</p>"},{"location":"distributed_computing/spark/spark_plugin.html","title":"Spark Plugin","text":"<p><code>SparkPlugin</code>\u63a5\u53e3\u5b9a\u4e49\u4e24\u4e2a\u51fd\u6570\uff1a</p> <ul> <li>\u53ef\u4ee5\u7528\u6765\u542f\u52a8\u670d\u52a1\uff1b</li> <li>\u652f\u6301\u81ea\u5b9a\u4e49 metrics\uff1b</li> </ul> <pre><code>DriverPlugin driverPlugin();\n\nExecutorPlugin executorPlugin();\n</code></pre>"},{"location":"distributed_computing/spark/spark_plugin.html#driver-plugin","title":"Driver Plugin","text":"<pre><code>public interface DriverPlugin {\n  default Map&lt;String, String&gt; init(SparkContext sc, PluginContext pluginContext) {\n    return Collections.emptyMap();\n  }\n  default void registerMetrics(String appId, PluginContext pluginContext) {}\n  default Object receive(Object message) throws Exception {\n    throw new UnsupportedOperationException();\n  }\n  default void shutdown() {}\n}\n</code></pre>"},{"location":"distributed_computing/spark/spark_plugin.html#executor-plugin","title":"Executor Plugin","text":"<pre><code>public interface ExecutorPlugin {\n  /** \n   * block executor initialization until it returns.\n   * register all metrics with the context's registry\n   */\n  default void init(PluginContext ctx, Map&lt;String, String&gt; extraConf) {}\n  default void shutdown() {}\n\n  // \u53ef\u4ee5\u901a\u8fc7 TaskContext.get \u83b7\u53d6\u5f53\u524d\u6267\u884c\u7684 Task \u4fe1\u606f\uff0c\u6ce8\u610f\u4e00\u4e2aExecutor\u53ef\u4ee5\u5e76\u884c\u8fd0\u884c\u591a\u4e2aTask\n  default void onTaskStart() {}\n  default void onTaskSucceeded() {}\n  default void onTaskFailed(TaskFailedReason failureReason) {}\n}\n</code></pre>"},{"location":"distributed_computing/spark/spark_rdd_compute.html","title":"RDD\u7684action\u7684\u6267\u884c\u6d41\u7a0b\uff1a","text":""},{"location":"distributed_computing/spark/spark_rdd_compute.html#rdd-action","title":"RDD action","text":"<p>RDD.Action -&gt; SparkContext.runJob -&gt; DagScheduler.runJob -&gt; submitJob -&gt; \u63d0\u4ea4JobSubmitted\u4e8b\u4ef6</p> <p>DAGSchedulerEventProcessLoop\u7ebf\u7a0b onReceive -&gt; dagScheduler.handleJobSubmitted -&gt; createResultStage\uff0csubmitStage </p> <ul> <li> <p>createResultStage     -&gt; getOrCreateParentStages -&gt; getShuffleDependencies\uff08\u4f1a\u89e6\u53d1new     ShuffleDependency\uff09, getOrCreateShuffleMapStage</p> </li> <li> <ul> <li>getOrCreateShuffleMapStage -&gt;      getMissingAncestorShuffleDependencies\uff08\u83b7\u53d6\u672a\u521b\u5efa\u7684\u7236\u7684Shuffle\u4f9d\u8d56\uff09, createShuffleMapStage -&gt; getOrCreateParentStages\uff08\u9012\u5f52\uff09</li> </ul> </li> <li> <p>\u9012\u5f52\u521b\u5efaShuffleMapStage\uff0c\u5982\u679c\u90fd\u662f\u7a84\u4f9d\u8d56\uff0c\u5219\u8ba1\u7b97getShuffleDependencies\u4f1a\u4e00\u76f4\u5230\u521d\u59cb\u7684RDD\uff1b</p> </li> <li> <p>submitStage -&gt; activeJobForStage, getMissingParentStages -&gt; submitMissingTasks -&gt; getPreferredLocs, taskScheduler.submitTasks</p> </li> <li> <ul> <li>submitStage \u4f1a\u5224\u65adstage\u662f\u5426\u5728waiting,      running, failed\u4e2d\uff1b</li> </ul> </li> <li>submitMissingTasks \u4f1a\u83b7\u53d6RDD\u7684\u5206\u533a\u7684preferredLocs\uff1b</li> <li>submitMissingTasks\u7684\u5e8f\u5217\u5316\uff1b</li> </ul> <p>TODO\uff1asubmitTasks\u4e4b\u540e\u7684\u52a8\u4f5c</p> <p>\u5982\u4f55RDD\u7684preferredLocs\uff0c\u8ba1\u7b97\u7684\u4f4d\u7f6e\uff1a</p> <p>1\uff09\u5982\u679c\u6709Cache\uff0c\u5219\u83b7\u53d6Cache\u7684\u8282\u70b9\uff08Executor\uff09\u4f4d\u7f6e\uff1b</p> <p>2\uff09\u5982\u679c\u662fInput RDD\u6216\u8005Shuffle RDD\uff0c\u5219\u901a\u8fc7RDD\u7684preferredLocations\u8ba1\u7b97\uff1b</p> <p>3) \u5982\u679c\u662f\u7a84\u4f9d\u8d56\u7684RDD\uff0c\u5219\u83b7\u53d6\u5176\u7236RDD\u7684preferredLocs\uff1b</p> <p>handleJobSubmitted\u65f6cacheLocs\u4fdd\u5b58cached RDD\u7684\u4f4d\u7f6e\uff0c\u6bcf\u6b21Job\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u6e05\u7a7aMap\uff0c\u7136\u540e\u518dgetCachedLocs\u51fd\u6570\u4e2d\u8fdb\u884c\u8d4b\u503c\u3002</p> <p>\u4e00\u4e2aStage\u5c5e\u4e8e\u591a\u4e2aJobIds?? submitStage\u65f6\u5019\uff0c\u4f1a\u5224\u65ad activeJobForStage</p>"},{"location":"distributed_computing/spark/spark_rdd_compute.html#rdd-cache","title":"RDD cache","text":"<p>cache\u64cd\u4f5c\u5fc5\u987b\u5728action\u64cd\u4f5c\u4e4b\u524d\u6267\u884c\uff0c\u53ef\u4ee5\u6839\u636e\u5176\u6267\u884c\u8fc7\u7a0b\u63a8\u65ad\u51fa\u539f\u56e0\u3002</p>"},{"location":"distributed_computing/spark/spark_rdd_compute.html#_1","title":"\u6267\u884c\u8fc7\u7a0b","text":"<p>FinalRDD\u5728\u8ba1\u7b97\u8c03\u7528compute\u51fd\u6570\u65f6\uff0cRDD\u4f1a\u8c03\u7528\u7236RDD\u7684iterator\u65b9\u6cd5\uff0c\u5176\u4e2diterator\u4f1a\u5148\u5224\u65adcache\uff0c\u518dcheckpoint\uff0c\u6700\u540e\u518dcompute\uff1b - \u7b2c\u4e00\u6b21\u8ba1\u7b97\u7684\u65f6\u5019\uff0c\u4f1a\u6839\u636eStorageLevel\u5c06\u6570\u636e\u4fdd\u5b58\u5728BlockManager\u4e2d\uff08getOrElseUpdate\u51fd\u6570\uff09\uff1b - unpersist\u65f6\uff0c\u4f1a\u89e6\u53d1BlockManagerMaster\u7684removeRDD\u65b9\u6cd5\uff1b</p>"},{"location":"distributed_computing/spark/spark_rdd_compute.html#rdd-checkpoint","title":"RDD checkpoint","text":"<p>RDD checkpoint\u4f1a\u91cd\u65b0\u8ba1\u7b97\u4e00\u6b21RDD\uff0c\u89c1 SPARK-8582\uff0c\u56e0\u6b64\u63a8\u8350\u5728checkpoint\u524d\uff0c\u5148\u8fdb\u884ccache\u3002</p> <p>\u5728\u6267\u884cRDD action\u8ba1\u7b97\u65f6\uff0c\u5728<code>SparkContext.runJob</code>\u6700\u540e\u4f1a\u6267\u884c<code>rdd.doCheckpoint</code>\u8fdb\u884cRDD\u7684checkpoint\u3002</p>"},{"location":"distributed_computing/spark/spark_retry.html","title":"Spark\u91cd\u8bd5","text":""},{"location":"distributed_computing/spark/spark_retry.html#applicationmaster","title":"ApplicationMaster \u91cd\u8bd5","text":"<p>Yarn \u4e0a\u4f1a\u914d\u7f6e\u4f5c\u4e1a\u91cd\u8bd5\u6b21\u6570\u3002</p>"},{"location":"distributed_computing/spark/spark_retry.html#executor","title":"Executor \u91cd\u8bd5","text":"<p>\u53c2\u6570\uff1aspark.yarn.max.executor.failures= max( numExecutors * 2 , 3)</p> <p>\u8bf4\u660e\uff1a\u5982\u679c executor failed \u4e00\u5b9a\u6570\u91cf\u540e\uff0c\u6574\u4e2a Spark \u4efb\u52a1\u5c31\u4f1akill \u6389\u3002</p>"},{"location":"distributed_computing/spark/spark_retry.html#stage","title":"Stage \u91cd\u8bd5","text":"<p>Spark Stage Restarts</p> <p>\u53c2\u6570\uff1aspark.stage.maxConsecutiveAttempts=\u9ed8\u8ba4\u4e3a 4</p> <p>\u8bf4\u660e\uff1a\u5728\u4e00\u4e2a stage \u88ab\u4e2d\u6b62\u4e4b\u524d\uff0c\u5141\u8bb8\u7684\u8fde\u7eed stage \u91cd\u8bd5\u7684\u6b21\u6570</p>"},{"location":"distributed_computing/spark/spark_retry.html#rddbarrier","title":"RDDBarrier","text":"<p>Spark\u8fd8\u4e3aMPI\u4efb\u52a1\u5f15\u5165\u4e86\u4e00\u79cd\u65b0\u7684\u5bb9\u9519\u673a\u5236\uff1a\u5f53\u4efb\u4f55MPI\u4efb\u52a1\u5728\u4e2d\u95f4\u5931\u8d25\u65f6\uff0cSpark\u5c06\u4e2d\u6b62\u6240\u6709\u4efb\u52a1\u5e76\u91cd\u65b0\u542f\u52a8\u8be5stage\u3002</p> <ul> <li>Stage\u662fShuffleMapStage\uff0c\u5219\u4f1a\u7ec8\u6b62\u8be5Stage\u6240\u6709Task\uff0c\u5e76\u8fdb\u884cStage\u6574\u4f53\u91cd\u8bd5\uff0c\u8d85\u8fc7\u91cd\u8bd5\u6b21\u6570\uff08\u9ed8\u8ba44\uff09\uff0c\u4f5c\u4e1a\u5931\u8d25\uff1b</li> <li>Stage\u662fResultStage\uff0c\u5219\u4e0d\u4f1a\u91cd\u8bd5\uff0c\u4f5c\u4e1a\u5931\u8d25\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_retry.html#_1","title":"\u4ec0\u4e48\u60c5\u51b5\u4f1a\u91cd\u8bd5","text":"<p>\u82e5\u4efb\u52a1\u6267\u884c\u5931\u8d25\u7684\u539f\u56e0\u662f\uff1aFetchFailed\uff0c\u8bf4\u660e\u662fTask\u83b7\u53d6\u8fdc\u7aef\u7684shuffle\u6570\u636e\u5931\u8d25\u3002\u901a\u8fc7<code>DAGSchedulerEventProcessLoop</code>\u53d1\u9001<code>ResubmitFailedStages</code>\u4e8b\u4ef6\uff0c\u518d\u6b21\u5c1d\u8bd5\u63d0\u4ea4\u8be5Stage</p>"},{"location":"distributed_computing/spark/spark_retry.html#task","title":"Task \u91cd\u8bd5","text":""},{"location":"distributed_computing/spark/spark_retry.html#_2","title":"\u914d\u7f6e","text":"<ul> <li>spark.task.maxFailures</li> </ul> <p>\u9ed8\u8ba4\u4e3a 4\u6b21\uff0c\u5141\u8bb8\u91cd\u8bd5\u6b21\u6570=\u6b64\u503c-1\u3002</p>"},{"location":"distributed_computing/spark/spark_retry.html#_3","title":"\u4ec0\u4e48\u60c5\u51b5\u4f1a\u91cd\u8bd5\uff1f","text":"<p>\u5f53RDD\u8fdb\u884cMap\u7684\u65f6\u5019\uff0c\u629b\u51fa ArrayIndexOutOfBoundsException \u65f6\uff0cSpark\u5df2\u7ecf\u8fdb\u884c\u91cd\u8bd5\uff0c\u5373\u53ea\u8981\u629b\u51fa\u5f02\u5e38\u90fd\u4f1a\u91cd\u8bd5</p> <ul> <li>Task 2 in stage 2.0 failed 4 times</li> </ul> <p></p>"},{"location":"distributed_computing/spark/spark_retry.html#_4","title":"\u91cd\u8bd5\u5931\u8d25\u7ed3\u679c","text":"<p>Task \u91cd\u8bd5\u6b21\u6570\u8d85\u8fc7 <code>spark.task.maxFailures</code>\uff0c\u5219 taskSet \u4f1a\u5931\u8d25\uff0c\u5373\u4e00\u4e2a stage \u5931\u8d25\u3002stage \u5931\u8d25\u5bfc\u81f4\u6574\u4e2a Job \u5c31\u5931\u8d25\uff0cspark \u4f1a\u53d6\u6d88\u8be5 stage \u5bf9\u5e94\u7684 job \u5305\u542b\u7684\u6240\u6709 task\uff0c\u5e76\u8fd4\u56de\u7528\u6237\u4efb\u52a1\u6267\u884c\u5931\u8d25\u3002</p>"},{"location":"distributed_computing/spark/spark_scheduler.html","title":"\u8c03\u5ea6","text":""},{"location":"distributed_computing/spark/spark_scheduler.html#taskschduler","title":"TaskSchduler","text":""},{"location":"distributed_computing/spark/spark_seralizer.html","title":"Spark \u5e8f\u5217\u5316","text":""},{"location":"distributed_computing/spark/spark_seralizer.html#_1","title":"\u5e8f\u5217\u5316\u65b9\u5f0f","text":""},{"location":"distributed_computing/spark/spark_seralizer.html#java-seralizer","title":"Java Seralizer","text":"<p><code>org.apache.spark.serializer.JavaSerializer</code></p>"},{"location":"distributed_computing/spark/spark_seralizer.html#kryo-seralizer","title":"Kryo Seralizer","text":"<p><code>org.apache.spark.serializer.KryoSerializer</code></p> <ul> <li> <p>KryoSerializer\u4e2d\u4f1a\u9ed8\u8ba4\u6ce8\u518c\u6765\u6e90\u4e8eTwitter Chill library\u4e2d\u7684AllScalaRegistrar\u7684\u7c7b\uff1b</p> </li> <li> <p>\u5bf9\u4e8e\u81ea\u5b9a\u4e49\u7684\u7c7b\uff0c\u9700\u8981\u81ea\u884c\u6ce8\u518c</p> </li> </ul> <pre><code>val conf = new SparkConf().setMaster(...).setAppName(...)\nconf.registerKryoClasses(Array(classOf[MyClass1], classOf[MyClass2]))\nval sc = new SparkContext(conf)\n</code></pre>"},{"location":"distributed_computing/spark/spark_seralizer.html#_2","title":"\u5e94\u7528\u573a\u666f","text":"<p>SparkEnv\u4e2d\u4f1a\u521b\u5efaserializer\uff0cclosureSerializer\u548cserializerManager\u4e09\u4e2a\u5b9e\u4f8b</p>"},{"location":"distributed_computing/spark/spark_seralizer.html#serializer","title":"serializer","text":"<ul> <li>\u901a\u8fc7<code>spark.serializer</code>\u53c2\u6570\u6307\u5b9a\uff0c\u9ed8\u8ba4\u662f<code>JavaSerializer</code>\uff1b</li> <li>\u7528\u4e8e\u4ee5\u4e0b\u573a\u666f</li> <li>shuffle RDD between executors\uff1b</li> <li>RDD serialized cache\uff1b</li> <li>Broadcast\u5bf9\u8c61\u7684\u4f20\u8f93\uff1b</li> <li>ResultTask/ShuffleMapTask\u7684\u7ed3\u679c\u7684\u5e8f\u5217\u5316\uff0c\u8fd4\u56de\u7ed9Driver\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_seralizer.html#closureserializer","title":"closureSerializer","text":"<ul> <li>\u95ed\u5305\u6e05\u7406\u7684\u5e8f\u5217\u5316\u5de5\u4f5c\uff0c\u662f JavaSerializer\uff1b</li> <li>Task\u7684\u5e8f\u5217\u5316\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_seralizer.html#serializermanager","title":"serializerManager","text":"<ul> <li>\u5176\u6210\u5458\u53d8\u91cfdefaultSerializer\u662fSparkEnv\u4e2d\u7684serializer\u5b9e\u4f8b\uff08\u5373\u6839\u636e\u914d\u7f6e\u786e\u5b9a\uff09\uff1b</li> <li>RDD Shuffle\u65f6\u7684\u5e8f\u5217\u5316\u5224\u65ad\uff0cShuffleRDD.getDependencies -&gt; SerializerManager.getSerializer</li> <li>\u5bf9\u4e8eShuffledRDD\u5982\u679cK, V\u662f\u57fa\u672c\u7c7b\u578b\u3001String\u3001Array\u57fa\u672c\u7c7b\u578b\uff0c\u5219\u4f7f\u7528kryo\u5e8f\u5217\u5316\uff1b</li> <li>\u5426\u5219\uff0c\u4f7f\u7528defaultSerializer</li> </ul>"},{"location":"distributed_computing/spark/spark_seralizer.html#task","title":"Task\u5e8f\u5217\u5316\u6d41\u7a0b","text":"<p>driver\u7aef\u4f1a\u5c06Task\u5e8f\u5217\u5316\uff0c\u5e76\u53d1\u9001\u7ed9executor\uff0cexecutor\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u3002</p> <p>Task\u5728\u5e8f\u5217\u5316\u7684\u65f6\u5019\u4e3b\u8981\u662f\u8981\u5e8f\u5217\u5316\u8be5stage\u4e2d\u7684\u6700\u540e\u4e00\u4e2aRDD\uff08\u540e\u9762\u79f0\u4e3afinalRDD\uff09\u3002</p> <p>\u5728\u5e8f\u5217\u5316RDD\u65f6\uff0c\u9700\u8981\u5e8f\u5217\u5316RDD\u7684\u6210\u5458\u53d8\u91cf\u6709<code>RDD id\uff0cdependencies_\uff0cstorageLevel</code>\u7b49\uff0c\u6700\u4e3b\u8981\u7684\u662f<code>dependencies_</code>\u53d8\u91cf\uff0c\u5b83\u5b58\u653e\u7740\u8be5RDD\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u8be5RDD\u5982\u4f55\u4f9d\u8d56\u4e8e\u5176\u4ed6\u7684\u54ea\u4e9bRDDs\uff0c\u8fd9\u4e2a\u4f9d\u8d56\u5173\u7cfb\u4fd7\u79f0\u4e3alineage\u3002</p> <p>\u5f53\u5e8f\u5217\u5316\u540e\u7684task\u53d1\u5230remote worker\u4e0a\u65f6\uff0cexecutor\u53ea\u9700\u8981\u53cd\u5e8f\u5217\u5316\u51fafinalRDD\uff0c\u7136\u540e\u901a\u8fc7\u5b83\u7684lineage\u5c31\u53ef\u4ee5\u4ece\u6700\u521d\u7684\u6570\u636e\u6e90\uff08\u6216\u8005shuffleMapTask\u7684\u8ba1\u7b97\u7ed3\u679c\uff09\u4e00\u6b65\u6b65\u8ba1\u7b97\u5f97\u5230finalRDD\u3002</p> <p>\u7531\u4e8e\u5728\u5e8f\u5217\u5316finalRDD\u7684<code>dependencies_</code>\u65f6\u4f1a\u5e8f\u5217\u5316finalRDD\u4f9d\u8d56\u7684\u4e0a\u6e38\u7684RDDs\u7684<code>dependencies_</code>\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5e8f\u5217\u5316\u8fc7\u7a0b\u5b9e\u9645\u4e0a\u662flineage\u7684\u56de\u6eaf\u8fc7\u7a0b\u3002\u5047\u8bbelineage\u662f\u8fd9\u6837\u7684 <code>RDD a =&gt; RDD b =&gt; RDD c =&gt; finalRDD</code>\uff0c\u90a3\u4e48\u9996\u5148\u5e8f\u5217\u5316<code>finalRDD</code>\uff0c\u7136\u540e\u987a\u7740dependencies\u53bb\u5e8f\u5217\u5316<code>RDD c</code>\uff0c\u7136\u540e\u987a\u7740dependencies\u53bb\u5e8f\u5217\u5316<code>RDD b</code>\uff0c\u6700\u540e\u987a\u7740dependencies\u53bb\u5e8f\u5217\u5316<code>RDD a</code>\u3002\u53ef\u89c1lineage\u957f\u5ea6\u8d8a\u957f\uff0c\u5e8f\u5217\u5316\u94fe\u8d8a\u957f\uff0c\u6700\u7ec8\u53ef\u4ee5\u9020\u6210\u6808\u6ea2\u51fa\u3002</p> <ul> <li>cache\u4e0d\u4f1a\u65a9\u65ad\u4e16\u7cfblineage\uff0c\u56e0\u6b64\u4e0d\u4f1a\u5f71\u54cd\u5e8f\u5217\u5316\u7684\u957f\u5ea6\uff1b</li> <li>checkpoint\u4f1a\u65a9\u65ad\u4e16\u7cfb\uff0c\u56e0\u4e3aRDD\u7684<code>dependencies</code>\u51fd\u6570\u4f1a\u5224\u65adcheckpointRDD\u662f\u5426\u5b58\u5728\uff0c\u4e0d\u5b58\u5728\u65f6\u624d\u4f1a<code>getDependencies</code>\u5e76\u8bbe\u7f6e<code>dependencies_</code>\uff1b\u5e76\u4e14\u4f1a\u5728checkpoint\u540e\uff0c\u8c03\u7528<code>markCheckpointed</code>\u51fd\u6570\u5c06<code>dependencies_</code>\u7f6e\u4e3a\u7a7a\uff1b</li> </ul> <p>ShuffledRDD\u53ef\u4ee5\u65ad\u6389\u5e8f\u5217\u5316\u65f6\u7684lineage\uff0c\u4e5f\u5c31\u662f\u8bf4\u5e8f\u5217\u5316\u94fe\u78b0\u5230ShuffledRDD\u5c31\u505c\u6b62\u4e86\uff0c\u8fd9\u4e0estage\u5212\u5206\u65b9\u6cd5\u4e00\u81f4</p> <ul> <li>ShuffleDependency\u662f\u4e0d\u4f1a\u4fdd\u5b58\u4f9d\u8d56\u7684RDD\uff0c\u4f46\u662fOneToOneDependency\u7b49\u7a84\u4f9d\u8d56\u4f1a\u4fdd\u5b58\u4f9d\u8d56\u7684RDD\uff1b</li> </ul> <p>DagScheduler\u5728<code>submitMissingTasks</code>\u51fd\u6570\u4e2d\u5e8f\u5217\u5316\uff08JavaSerializer\uff09stage\u4e2d\u7684rdd\u548cdependency\u6210\u4e3aBroadcast\u53d8\u91cftaskBinary\uff0c\u6bcf\u4e2a\u5206\u533a\u6620\u5c04\u4e3a\u4e00\u4e2aTask(ShuffleMapTask\u6216ResultTask\uff09\u5305\u542btaskBinary\uff0c\u7136\u540e\u901a\u8fc7TaskScheduler\u63d0\u4ea4TaskSet\uff08\u5c01\u88c5Array[Task]\uff09\u3002</p> <p>TaskSetManager\u7684resourceOffer\u4e2d\u5c06Task\u518d\u6b21\u5e8f\u5217\u5316(JavaSerializer)\uff0c\u5e76\u8fd4\u56deTaskDescription(encode\u5b9a\u4e49\u5e8f\u5217\u5316\uff09</p>"},{"location":"distributed_computing/spark/spark_shuffle.html","title":"Spark Shuffle","text":""},{"location":"distributed_computing/spark/spark_shuffle.html#spark-shuffle_1","title":"Spark Shuffle\u7684\u65b9\u5f0f","text":"<p>m\uff1ashuffle\u524d\u7684\u5206\u533a\u6570\uff08\u5373map\u6570\uff09\uff0cr\uff1ashuffle\u540e\u7684\u5206\u533a\u6570\uff08\u5373reduce\u6570\uff09</p>"},{"location":"distributed_computing/spark/spark_shuffle.html#hashshuffle160","title":"HashShuffle(1.6.0\u7248\u672c\u540e\u79fb\u9664)","text":"<ul> <li>0.8.1\u7248\u672c\u4e4b\u524d\u4ea7\u751f\u6587\u4ef6\u6570\u4e3a m * r\uff0c\u4ea7\u751f\u4e2d\u95f4\u6587\u4ef6\u592a\u5927\uff0c\u6269\u5c55\u6027\u5dee\uff1b</li> </ul> <ul> <li>0.8.1\u7248\u672c\u540e\u5f15\u5165 file consolidation\uff0c\u6bcf\u4e2acore\u4e0a\u7684map\u5171\u7528\u6587\u4ef6\uff08\u540c\u65f6\u6700\u591a\u8fd0\u884ccore\u4e2amap\uff09\u548c\u7f13\u5b58\uff0c\u6587\u4ef6\u4e2a\u6570\u4e3acores *  r\uff1b</li> </ul> <p>\u5047\u5982\u4e0b\u6e38 Stage \u7684\u5206\u533a\u6570 N \u5f88\u5927\uff0c\u8fd8\u662f\u4f1a\u5728\u6bcf\u4e2a Executor \u4e0a\u751f\u6210 N \u4e2a\u6587\u4ef6\uff0c\u540c\u6837\uff0c\u5982\u679c\u4e00\u4e2a Executor \u4e0a\u6709 K \u4e2a Core\uff0c\u8fd8\u662f\u4f1a\u5f00 K*N \u4e2a Writer Handler\uff0c\u6240\u4ee5\u8fd9\u91cc\u4ecd\u7136\u5bb9\u6613\u5bfc\u81f4OOM\u3002</p>"},{"location":"distributed_computing/spark/spark_shuffle.html#sortshuffle","title":"SortShuffle","text":"<p>Spark \u53c2\u8003\u4e86 MapReduce \u4e2d Shuffle \u7684\u5904\u7406\u65b9\u5f0f\uff0c\u5f15\u5165\u57fa\u4e8e\u6392\u5e8f\u7684 Shuffle \u5199\u64cd\u4f5c\u673a\u5236\u3002</p>"},{"location":"distributed_computing/spark/spark_shuffle.html#bypassmergesortshufflewriter","title":"BypassMergeSortShuffleWriter","text":"<ul> <li>Hash Shuffle\u7684\u4e00\u79cd\u6539\u8fdb\uff0c\u7684Shuffle\u64cd\u4f5c</li> <li>r\u5206\u533a\u5bf9\u5e94r\u4e2a\u5355\u72ec\u7684\u6587\u4ef6\uff0cmap\u7aef\u6570\u636e\u76f4\u63a5\u5199\u5230\u5bf9\u5e94\u7684\u6587\u4ef6\u91cc\uff0c\u6700\u540e\u518d\u5c06\u8fd9\u4e9b\u6587\u4ef6\u5408\u5e76\uff0c\u751f\u6210index\u548cdata\u6587\u4ef6\uff1b</li> <li>\u9700\u8981\u5e76\u53d1\u6253\u5f00\u591a\u4e2a\u6587\u4ef6\uff0c\u5bf9\u5185\u5b58\u7684\u6d88\u8017\u8f83\u5927\uff1b</li> <li>\u4f7f\u7528\u6761\u4ef6\uff1a</li> <li>\u5206\u533a\u6570\u5c0f\u4e8espark.shuffle.sort.bypassMergeThreshold(default 200)\uff0c\u4e14\u6ca1\u6709map\u7aef\u7684combine\uff1b</li> <li>\u9ed8\u8ba4Sort\uff08\u5206\u533a\u6570\u5c0f\u4e8e200\uff09\u65f6\uff0c\u91c7\u7528\u8be5\u6392\u5e8f\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_shuffle.html#sortshufflewriter","title":"SortShuffleWriter","text":"<ul> <li>1.2\u7248\u672c\u540e\u5f15\u5165\uff0c\u6bcf\u4e2amap\u53ea\u8f93\u51fa\u4e00\u4e2areduce\u6587\u4ef6\u548c\u4e00\u4e2aindex\u6587\u4ef6\uff0cindex\u6587\u4ef6\u6839\u636ereducer\u5e8f\u53f7\u5f97\u5230\u6570\u636e\u504f\u79fb\u91cf</li> </ul>"},{"location":"distributed_computing/spark/spark_shuffle.html#unsafeshufflewriter","title":"UnsafeShuffleWriter","text":"<ul> <li>\u76f4\u63a5\u5728serialized binary data\u4e0asort\u800c\u4e0d\u662fjava objects\uff0c\u51cf\u5c11\u4e86memory\u7684\u5f00\u9500\u548cGC\u7684overhead\uff1b</li> <li>\u63d0\u4f9bcache-efficient sorter\uff0c\u4f7f\u7528\u4e00\u4e2a8bytes\u7684\u6307\u9488\uff0c\u628a\u6392\u5e8f\u8f6c\u5316\u6210\u4e86\u4e00\u4e2a\u6307\u9488\u6570\u7ec4\u7684\u6392\u5e8f\uff1b</li> <li>spill\u7684merge\u8fc7\u7a0b\u4e5f\u65e0\u9700\u53cd\u5e8f\u5217\u5316\u5373\u53ef\u5b8c\u6210\uff1b</li> </ul> <p>Shuffle\u7684\u65b9\u5f0f\u901a\u8fc7SortShuffleManager\u7c7b\u4e2dregisterShuffle\u51fd\u6570\u8fdb\u884c\u5224\u65ad\uff0c\u4f7f\u7528BypassMergeSortShuffleWriter\u3001UnsafeShuffleWriter\u8fd8\u662fSortShuffleWriter\u3002</p>"},{"location":"distributed_computing/spark/spark_shuffle.html#spark-shuffle_2","title":"Spark Shuffle \u539f\u7406/\u6d41\u7a0b","text":"<p>\u6d41\u7a0b\u601d\u7ef4\u5bfc\u56fe</p>"},{"location":"distributed_computing/spark/spark_shuffle.html#shuffle","title":"\u5916\u7f6eShuffle \u670d\u52a1","text":"<p>\u7528\u4e8e\u52a8\u6001 Executor \u7533\u8bf7\u65f6\uff0c\u5f53 Executor \u4e0d\u518d\u9700\u8981\u65f6\u53ef\u4ee5\u91ca\u653e\uff0c\u4f46\u662f\u5176 shuffle \u6570\u636e\u4ecd\u7136\u9700\u8981\u88ab\u7ba1\u7406\u3002</p> <p><code>spark.shuffle.service.enabled</code> \u4f7f\u7528\u5916\u7f6e shuffle\uff1b</p> <p><code>spark.shuffle.service.port</code> \uff1a\u7aef\u53e3\u53f7\uff0c\u9ed8\u8ba47337</p> <p>ESS Shuffle \u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>\u6bcf\u4e2a Spark Executor \u5728\u542f\u52a8\u540e\u90fd\u4f1a\u548c\u4f4d\u4e8e\u540c\u4e00\u4e2a\u8282\u70b9\u4e0a\u9762\u7684 Spark External Shuffle Service \uff08ESS\uff09\u8fdb\u884c\u6ce8\u518c\u5176\u7269\u5316 Shuffle \u6570\u636e\u4f4d\u7f6e\uff1b</li> <li>\u5728 Map \u4efb\u52a1\u7ed3\u675f\u65f6\uff0c\u5b83\u4f1a\u4ea7\u751f 2 \u4e2a\u6587\u4ef6\uff0c\u4e00\u4e2a\u7528\u6765\u5b58\u50a8 Shuffle \u6570\u636e\uff0c\u53e6\u4e00\u4e2a\u7528\u6765\u7d22\u5f15\u524d\u8005\u7684 Shuffle \u5757</li> <li>\u5f53\u4e0b\u4e00\u4e2a Stage \u7684 Reduce \u4efb\u52a1\u5f00\u59cb\u8fd0\u884c\u65f6\uff0c\u5b83\u4eec\u4f1a\u67e5\u8be2 Spark \u7684Driver \u4ee5\u83b7\u53d6\u8f93\u5165\u7684 Shuffle \u5757\u7684\u4f4d\u7f6e</li> <li>\u6bcf\u4e2aReduce \u4efb\u52a1\u5c06\u4f1a\u5efa\u7acb\u548c\u5bf9\u5e94\u7684 Spark ESS \u5b9e\u4f8b\u7684\u8fde\u63a5\uff0c\u4ee5\u4fbf\u83b7\u53d6\u5176\u8f93\u5165\u6570\u636e</li> </ul>"},{"location":"distributed_computing/spark/spark_shuffle.html#push-based-shuffle","title":"Push-based Shuffle","text":"<p>Currently push-based shuffle is only supported for Spark on YARN with external shuffle service.</p> <p>Push-based shuffle improves performance for long running jobs/queries which involves large disk I/O during shuffle.</p> <p>Currently it is not well suited for jobs/queries which runs quickly dealing with lesser amount of shuffle data. </p> <p>ESS \u95ee\u9898\u5bfc\u81f4Spark\u4efb\u52a1\u7684\u7a33\u5b9a\u6027\u4e0d\u9ad8\uff1a</p> <ul> <li>Spark ESS \u6bcf\u4e2a FETCH \u8bf7\u6c42\u53ea\u4f1a\u8bfb\u53d6\u4e00\u4e2a Shuffle \u5757</li> <li>Shuffle \u5757\u7684\u5e73\u5747\u5927\u5c0f\u51b3\u5b9a\u4e86\u6bcf\u6b21\u76d8\u8bfb\u7684\u5e73\u5747\u6570\u636e\u91cf\uff0c\u5982\u679c\u5b58\u5728\u5927\u91cf\u5c0f Shuffle \u5757\u5bfc\u81f4\u78c1\u76d8 I/O \u4f4e\u6548</li> <li>Reduce \u4efb\u52a1\u5728\u5efa\u7acb\u4e0e\u8fdc\u7a0b Spark ESS \u7684\u8fde\u63a5\u65f6\u51fa\u73b0\u5931\u8d25\u7684\u60c5\u51b5\uff0c\u5b83\u4f1a\u7acb\u5373\u5931\u8d25\u6574\u4e2a\u7684 Shuffle Reduce Stage\uff0c\u5bfc\u81f4\u524d\u9762\u7684 Stage \u91cd\u8bd5\uff0c\u6765\u91cd\u65b0\u751f\u6210\u62c9\u53d6\u4e0d\u5230\u7684 Shuffle \u6570\u636e\u3002</li> <li>Spark \u5f53\u524d\u7684 Shuffle \u673a\u5236\u4f1a\u5bfc\u81f4 Reduce \u4efb\u52a1\u7684\u6570\u636e\u672c\u5730\u6027\u5f88\u5c11\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u4efb\u52a1\u8f93\u5165\u6570\u636e\u5206\u6563\u5728\u6240\u6709\u7684 Map \u4efb\u52a1\u4e2d\uff0c\u65e0\u6cd5\u4f7f\u7528\u672c\u5730\u8bfb\u51cf\u5c11RPC\uff1b</li> </ul> <p>Push-Based Shuffle \u539f\u7406\uff1aexternal shuffle services \u4ece \u5c0f\u7684\u968f\u673a\u78c1\u76d8\u8bfb \u53d8\u6210 \u5927\u5757\u7684\u987a\u5e8f\u8bfb\uff1b</p> <ul> <li>map \u4efb\u52a1\u751f\u6210\u7684 shuffle block \u88ab push \u5230 \u8fdc\u7aef\u7684 ESS \u4e2d\u4e14\u88ab\u5408\u5e76\uff08\u6bcf\u4e2a shuffle \u5206\u533a\u53ea\u6709\u4e00\u4e2a\u6587\u4ef6\uff09\uff1b</li> <li>reduce \u4efb\u52a1\u83b7\u53d6\u5408\u5e76\u540e\u7684shuffle\u5206\u533a\u6570\u548c\u539f\u59cb\u7684shuffle blocks\uff0c\u4f5c\u4e3a\u8f93\u5165\u6570\u636e\uff1b</li> <li>\u5bb9\u5fcd\u90e8\u5206 push \u64cd\u4f5c\u6210\u529f\uff0c\u539f\u59cb\u7684block\u548c\u5408\u5e76\u540e\u7684\u5206\u533a\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u8f93\u5165\uff1b</li> <li>Reduce Task \u7684\u5927\u90e8\u5206\u90fd\u5408\u5e76\u5728\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u672c\u5730\u6027\u6765\u8c03\u5ea6\u5b9e\u73b0\u66f4\u597d\u7684 Reducer \u6570\u636e\u672c\u5730\u6027\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_shuffle.html#spark-shuffle_3","title":"Spark Shuffle \u62e5\u585e\u63a7\u5236","text":""},{"location":"distributed_computing/spark/spark_shuffle.html#spark-remote-shuffle","title":"Spark Remote Shuffle","text":""},{"location":"distributed_computing/spark/spark_shuffle.html#_1","title":"\u95ee\u9898\u548c\u89e3\u51b3\u65b9\u6848","text":"<p>\u7a33\u5b9a\u6027\uff1aSpark\u9636\u6bb5\u7684Shuffle Write\u7684\u6570\u636e\u5b58\u50a8\u4e8eMapper\u7684\u672c\u5730\u78c1\u76d8\uff0c\u53ea\u6709\u4e00\u4e2a\u526f\u672c\u3002\u5982\u679c\u8be5\u673a\u5668\u51fa\u73b0\u6545\u969c\u6216\u8005I/O\u6ee1\u8f7d\u3001CPU\u6ee1\u8f7d\u65f6\uff0cReducer\u65e0\u6cd5\u8bfb\u53d6\u8be5\u6570\u636e\uff0c\u9020\u6210FetchFailedException\uff0c\u8fdb\u800c\u5f15\u8d77\u91cd\u8bd5Stage\u3002\u91cd\u8bd5\u4f1a\u9020\u6210\u4f5c\u4e1a\u7684\u6267\u884c\u65f6\u95f4\u589e\u957f\uff0c\u540c\u65f6\uff0c\u6267\u884c\u65f6\u95f4\u8d8a\u957f\uff0c\u51fa\u73b0Shuffle\u6570\u636e\u65e0\u6cd5\u8bfb\u53d6\u7684\u53ef\u80fd\u6027\u8d8a\u5927\uff0c\u9020\u6210\u66f4\u591a\u7684\u91cd\u8bd5\uff0c\u5982\u6b64\u7684\u6076\u6027\u5faa\u73af\u5bfc\u81f4\u4f5c\u4e3a\u6267\u884c\u5931\u8d25\u3002</p> <p>\u6027\u80fd\uff1a\u6bcf\u4e2a Mapper \u7684\u6570\u636e\u4f1a\u88ab\u5927\u91cf Reducer \u8bfb\u53d6\uff0c\u5bf9\u4e8e Mapper \u8f93\u51fa\u6587\u4ef6\u800c\u8a00\uff0c\u5b58\u5728\u5927\u91cf\u7684\u968f\u673a\u8bfb\u53d6\u3002\u800c HDD \u7684\u968f\u673a IO \u6027\u80fd\u8fdc\u4f4e\u4e8e\u987a\u5e8f IO\u3002\u6700\u7ec8\u7684\u73b0\u8c61\u662f\uff0cReducer \u8bfb\u53d6 Shuffle \u6570\u636e\u975e\u5e38\u6162\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u901a\u8fc7\u5c06Shuffle\u7684\u4e2d\u95f4\u6570\u636e\u5728\u5b58\u50a8\u5230\u672c\u5730\u78c1\u76d8\u4e4b\u540e\uff0c\u518d\u4e0a\u4f20\u5230HDFS\u521b\u5efa\u526f\u672c\u3002Reducer\u9996\u5148\u901a\u8fc7External Shuffle Service\u8bfb\u53d6Shuffle\u6570\u636e\uff0c\u5982\u679c\u8bfb\u53d6\u5931\u8d25\uff0c\u518d\u4eceHDFS\u8bfb\u53d6\u3002</p> <ul> <li>\u76f4\u63a5\u5199HDFS\uff0c\u4f1a\u9020\u6210NameNode\u538b\u529b\u8fc7\u5927\uff0c\u6027\u80fd\u4e0b\u964d\uff0c\u598210000\u4e2areducer\u548cmapper\uff0c\u9700\u8981\u8bfb\u53d6\u6570\u636e\u548c\u7d22\u5f15\u6587\u4ef6\u5171 2 \u4ebf\u6b21\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_shuffle.html#_2","title":"\u4ee3\u7801\u5b9e\u73b0\u539f\u7406","text":"<p>Shuffle HDFS \u5bfc\u56fe</p>"},{"location":"distributed_computing/spark/spark_shuffle.html#_3","title":"\u5de5\u7a0b","text":"<p>\u89c1 github \u76f8\u5173\u9879\u76ee\uff1a</p> <p>https://github.com/oap-project/remote-shuffle</p> <p>https://github.com/uber/RemoteShuffleService</p> <p>\u7edf\u4e00 remote shuffle</p>"},{"location":"distributed_computing/spark/spark_stage.html","title":"Stage\u5212\u5206","text":""},{"location":"distributed_computing/spark/spark_stage.html#narrowdependency","title":"\u7a84\u4f9d\u8d56(NarrowDependency)","text":"<p>Each partition of the child RDD depends on a small number of partitions of the parent RDD\uff1b</p> <ul> <li>\u7a84\u4f9d\u8d56\u53ef\u4ee5\u8fdb\u884c\u5206\u533apipeline\u8ba1\u7b97\uff1b</li> <li>\u5b50\u7c7b\u6709OneToOneDependency\u548cRangeDependency\uff1b</li> <li>RDD\u7684\u7b1b\u5361\u5c14\u79efcartesian\u662f\u533f\u540d\u7a84\u4f9d\u8d56\u5b50\u7c7b\uff1b</li> </ul> <p></p>"},{"location":"distributed_computing/spark/spark_stage.html#shuffledependency","title":"\u5bbd\u4f9d\u8d56(ShuffleDependency)","text":"<p>\u5b50RDD\u7684\u6bcf\u4e2a\u5206\u533a\u6570\u636e\u4f9d\u8d56\u4e8e\u7236RDD\u7684\u6240\u6709\u5206\u533a\u3002</p>"},{"location":"distributed_computing/spark/spark_stage.html#stage_1","title":"Stage\u5212\u5206\u6d41\u7a0b","text":"<ol> <li>\u4ece\u540e\u5f80\u524d\u63a8\u7b97\uff0c\u9047\u5230 ShuffleDependency \u5c31\u65ad\u5f00\uff0c\u9047\u5230 NarrowDependency \u5c31\u5c06\u5176\u52a0\u5165\u8be5 stage\u3002\u6bcf\u4e2a stage \u91cc\u9762 task \u7684\u6570\u76ee\u7531\u8be5 stage \u6700\u540e\u4e00\u4e2a RDD \u4e2d\u7684 partition \u4e2a\u6570\u51b3\u5b9a</li> <li>Spark\u7684Stage\u7684\u5212\u5206\uff0c\u662f\u9012\u5f52\u6c42parent stage\uff0c\u5e76\u4e3a\u6bcf\u4e2astage\u63d0\u4f9bincremental id\uff08createShuffleMapStage)\uff0c\u6700\u540e\u4e00\u4e2astage id \u4e3a 0\uff1b</li> <li>\u6bcf\u4e2a RDD \u5305\u542b\u7684 getDependency() \u8d1f\u8d23\u786e\u7acb RDD \u7684\u6570\u636e\u4f9d\u8d56\uff0ccompute() \u65b9\u6cd5\u8d1f\u8d23\u63a5\u6536 parent RDDs\u6216\u8005 data block \u6d41\u5165\u7684 records\uff0c\u8fdb\u884c\u8ba1\u7b97\uff0c\u7136\u540e\u8f93\u51fa record\u3002</li> <li>\u6574\u4e2a computing chain \u6839\u636e\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\u81ea\u540e\u5411\u524d\u5efa\u7acb\uff0c\u9047\u5230 ShuffleDependency \u540e\u5f62\u6210 stage\u3002\u5728\u6bcf\u4e2astage \u4e2d\uff0c\u6bcf\u4e2a RDD \u4e2d\u7684 compute() \u8c03\u7528 parentRDD.iterator() \u6765\u5c06 parent RDDs \u4e2d\u7684 records \u4e00\u4e2a\u4e2a fetch \uff1b</li> <li>TaskSchedulerImpl\u7684resourceOffers\u51fd\u6570\uff1afill each node with tasks in a round-robin manner so that tasks are balanced across the cluster</li> </ol>"},{"location":"distributed_computing/spark/spark_version.html","title":"docs","text":""},{"location":"distributed_computing/spark/spark_version.html#sql","title":"SQL","text":""},{"location":"distributed_computing/spark/spark_version.html#bloom-filter-join330","title":"Bloom Filter Join\uff083.3.0\uff09","text":""},{"location":"distributed_computing/spark/spark_version.html#structured-streaming","title":"Structured Streaming","text":""},{"location":"distributed_computing/spark/spark_version.html#metrics","title":"Metrics","text":""},{"location":"distributed_computing/spark/spark_version.html#conf","title":"Conf","text":""},{"location":"distributed_computing/spark/spark_yarn.html","title":"Spark Yarn","text":""},{"location":"distributed_computing/spark/spark_yarn.html#_1","title":"\u67b6\u6784","text":"<p>Spark \u76f8\u5173\u6982\u5ff5\uff1a</p> <ul> <li>Driver\uff1a\u548cClusterManager\u901a\u4fe1\uff0c\u8fdb\u884c\u8d44\u6e90\u7533\u8bf7\u3001\u4efb\u52a1\u5206\u914d\u5e76\u76d1\u7763\u5176\u8fd0\u884c\u72b6\u51b5\u7b49\u3002</li> <li>ClusterManager\uff1a\u8fd9\u91cc\u6307YARN\u3002</li> <li>DAGScheduler\uff1a\u628aspark\u4f5c\u4e1a\u8f6c\u6362\u6210Stage\u7684DAG\u56fe\u3002</li> <li>TaskScheduler\uff1a\u628aTask\u5206\u914d\u7ed9\u5177\u4f53\u7684Executor\u3002</li> </ul> <p>YARN\u76f8\u5173\u6982\u5ff5\uff1a</p> <ul> <li>ResourceManager\uff1a\u8d1f\u8d23\u6574\u4e2a\u96c6\u7fa4\u7684\u8d44\u6e90\u7ba1\u7406\u548c\u5206\u914d\u3002</li> <li>ApplicationMaster\uff1aYARN\u4e2d\u6bcf\u4e2aApplication\u5bf9\u5e94\u4e00\u4e2aAM\u8fdb\u7a0b\uff0c\u8d1f\u8d23\u4e0eRM\u534f\u5546\u83b7\u53d6\u8d44\u6e90\uff0c\u83b7\u53d6\u8d44\u6e90\u540e\u544a\u8bc9NodeManager\u4e3a\u5176\u5206\u914d\u5e76\u542f\u52a8Container\u3002</li> <li>NodeManager\uff1a\u6bcf\u4e2a\u8282\u70b9\u7684\u8d44\u6e90\u548c\u4efb\u52a1\u7ba1\u7406\u5668\uff0c\u8d1f\u8d23\u542f\u52a8/\u505c\u6b62Container\uff0c\u5e76\u76d1\u89c6\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u3002</li> <li>Container\uff1aYARN\u4e2d\u7684\u62bd\u8c61\u8d44\u6e90\u3002</li> </ul>"},{"location":"distributed_computing/spark/spark_yarn.html#yarn-client","title":"Yarn-Client","text":"<p>client\u6a21\u5f0f\u4e0b\uff0cdriver\u8fd0\u884c\u5728client\u7684\u8fdb\u7a0b\u4e2d\u3002\uff08YarnClientClusterScheduler =&gt; YarnClusterScheduler\uff09</p> <p></p> <ul> <li>Client \u5411 RM \u7533\u8bf7\u542f\u52a8 AM\u3002\u540c\u65f6 driver \u521d\u59cb\u5316Spark Context\uff0cDAGScheduler\u3001YarnClusterScheduler\u7b49\uff1b</li> <li>RM \u6536\u5230\u8bf7\u6c42\uff0c\u5728\u96c6\u7fa4\u4e2d\u9009\u62e9\u4e00\u4e2a NM \u5206\u914d\u7b2c\u4e00\u4e2aContainer\uff0c\u4f5c\u4e3a AM\u3002AM\u4e0d\u8fd0\u884c SparkContext\uff0c\u53ea\u662f\u8ddfClient \u901a\u4fe1\u8fdb\u884c\u8d44\u6e90\u7533\u8bf7\uff1b</li> <li>Client \u4e0e AM \u8fdb\u884c\u8fde\u63a5\uff0c\u5411 RM \u6ce8\u518c\uff0c\u6839\u636e\u4efb\u52a1\u4fe1\u606f\u901a\u8fc7 AM \u5411 RM \u7533\u8bf7\u8d44\u6e90\uff1b</li> <li>AM \u7533\u8bf7\u5230\u8d44\u6e90 Container \u540e\uff0c\u4e0e\u5bf9\u5e94\u7684 NM \u8fdb\u884c\u901a\u4fe1\uff0c\u8981\u6c42\u5b83\u5728\u83b7\u53d6\u7684Container\u4e2d\u542f\u52a8CoarseGrained Backend\uff0cCoarseGrainedExecutorBackend\u542f\u52a8\u540e\u4f1a\u5411Client\u4e2d\u7684SparkContext\u6ce8\u518c\u5e76\u7533\u8bf7Task\uff1b</li> <li>client\u4e2d\u7684 SparkContext \u5206\u914d Task \u7ed9 CoarseGrainedExecutorBackend \u6267\u884c\uff0cCoarseGrainedExecutorBackend \u8fd0\u884c Task \u5e76\u5411 Driver \u6c47\u62a5\u8fd0\u884c\u7684\u72b6\u6001\u548c\u8fdb\u5ea6\uff0c\u4ee5\u8ba9 Client \u968f\u65f6\u638c\u63e1\u5404\u4e2a\u4efb\u52a1\u7684\u8fd0\u884c\u72b6\u6001\uff0c\u4ece\u800c\u53ef\u4ee5\u5728\u4efb\u52a1\u5931\u8d25\u65f6\u91cd\u65b0\u542f\u52a8\u4efb\u52a1\uff1b</li> <li>\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u5b8c\u6210\u540e\uff0cClient\u7684SparkContext\u5411ResourceManager\u7533\u8bf7\u6ce8\u9500\u5e76\u5173\u95ed\u81ea\u5df1\u3002</li> </ul>"},{"location":"distributed_computing/spark/spark_yarn.html#yarn-cluster","title":"Yarn-Cluster","text":"<p>\u4e0e client \u6a21\u5f0f\u7684\u533a\u522b\uff1a</p> <ul> <li>Driver \u8fdb\u7a0b\u8fd0\u884c\u5728 AM \u4e2d\uff0c\u4e0e RM \u8fdb\u884c\u8d44\u6e90\u7684\u7533\u8bf7\uff1b</li> </ul> <p></p>"},{"location":"distributed_computing/spark/spark_yarn.html#yarn-cluster-executor","title":"Yarn Cluster Executor \u7533\u8bf7","text":"<p>\u6e90\u7801\u7c7b\uff1a<code>YarnAllocator</code></p>"},{"location":"distributed_computing/spark/spark_yarn.html#_2","title":"\u6d41\u7a0b","text":"<p>1\u3001ApplicationMaster\u4e2d\u4f1a\u521b\u5efaYarnAllocator\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u9996\u5148\u8c03\u7528\u4e00\u6b21YarnAllocator.allocateResources()\u8fdb\u884c\u8d44\u6e90\u8bf7\u6c42\u5206\u914d\uff0c\u63a5\u4e0b\u6765\u4f1a\u521b\u5efareportThread\u7ebf\u7a0b\uff0c\u8be5\u7ebf\u7a0b\u4f1a\u5faa\u73af\u4e0d\u65ad\u7684\u8c03\u7528YarnAllocator.allocateResources()\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u5728allocateResources()\u4e2d\uff1b</p> <p>2\u3001YarnAllocator\u9996\u5148\u4f1a\u521b\u5efaContainerRequest\uff0cContainerRequest\u7684\u8bf7\u6c42\u6570=\u603b\u7684executor\u6570\uff0c\u5bf9\u4e8e\u56fa\u5b9aexecutor\u6570\u91cf\uff08\u5373\u6ca1\u6709\u914d\u7f6eexecutor\u52a8\u6001\u5206\u914d\uff09\u7684application\uff0cContainerRequest\u8bf7\u6c42\u7684container\u662f\u4efb\u610f\u8282\u70b9\u7684\uff0c\u5373\u5b8c\u5168\u7531ResourceManager\u968f\u673a\u5206\u914d\u3002\u5982\u679cExecutor\u662f\u52a8\u6001\u5206\u914d\u7684\uff0c\u90a3\u4e48\u4f1a\u5c3d\u53ef\u80fd\u6309\u7167\u6700\u5927\u5316\u6570\u636e\u672c\u5730\u7b56\u7565\u8bf7\u6c42container\uff1b</p> <p>3\u3001amClient \u5411 ResourceManager\u63d0\u4ea4\u8d44\u6e90\u8bf7\u6c42\uff0c\u518d\u8c03\u7528 allocate \u83b7\u53d6RM\u7ed9\u5206\u914d\u7684containers\uff1b</p> <p>4\u3001\u5bf9\u5206\u914d\u5230\u7684containers\u8fdb\u884c\u7b5b\u9009\uff0c\u5339\u914d\u4e4b\u524d\u7684ContainerRequest\uff0c\u6ee1\u8db3\u8bf7\u6c42\u7684container\u624d\u4f1a\u88ab\u8ba4\u4e3a\u662f\u53ef\u7528\u7684\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0cContainerRequest\u662f\u4efb\u610f\u8282\u70b9\uff0cRM\u5206\u914d\u7684container\u90fd\u80fd\u6ee1\u8db3\u9700\u6c42\u3002\u67d0\u4e9b\u60c5\u51b5\u4e0bcontainer\u53ef\u80fd\u4e0d\u6ee1\u8db3\uff0c\u90a3\u4e48\u4f1a\u628a\u4e0d\u6ee1\u8db3\u7684container\u8d44\u6e90\u91ca\u653e\u6389\uff1b</p> <p>5\u3001\u5bf9\u7b5b\u9009\u5b8c\u7684container\uff0c\u6bcf\u4e2acontainer\u88ab\u5c01\u88c5\u4e3aExecutorRunnable\uff0c\u7531\u4e00\u4e2a\u72ec\u7acb\u7684\u7ebf\u7a0b\u6765\u542f\u52a8\u3002\u5177\u4f53\u662f\u521b\u5efaContainerLaunchContext\uff0c\u7531nmClient(NodeManager\u5ba2\u6237\u7aef)\u8d1f\u8d23\u542f\u52a8Container\uff08\u5165\u53e3\u7c7b\u662f YarnCoarseGrainedExecutorBackend\uff09\uff1b</p> <p>container \u7b5b\u9009\u7684\u903b\u8f91\uff1a</p> <p>1\u3001\u9996\u5148\u6839\u636e\u63a5\u6536\u5230\u7684container\u7684 host\u5728amClient\u4e2d\u8fdb\u884c\u7684\u5339\u914d</p> <p>2\u3001\u4ece1\u4e2d\u5269\u4f59\u7684container\u4e2d\u518d\u6b21\u8fdb\u884crack\u7684\u5339\u914d</p> <p>3\u3001\u540c1\u30012\u7c7b\u4f3c\uff0c\u4ece2\u4e2d\u5269\u4f59\u7684container\u5bf9\u4efb\u610f\u4f4d\u7f6e\u7684ContainerRequest\u8fdb\u884c\u5339\u914d</p> <p>4\u3001\u7ecf\u8fc7\u5c42\u5c42\u5339\u914d\u7b5b\u9009\u540e\uff0c\u53ef\u7528\u7684container\u90fd\u6dfb\u52a0\u5230containerToUse\u5217\u8868\u4e2d\uff0c\u4e0d\u6ee1\u8db3\u8bf7\u6c42\u7684container\u8d44\u6e90\u5c06\u88ab\u91ca\u653e</p> <p>5\u3001\u8c03\u7528runAllocatedContainers()\u65b9\u6cd5\u5728container\u4e0a\u542f\u52a8Executor\u8fdb\u7a0b</p>"},{"location":"distributed_computing/spark/spark_yarn.html#_3","title":"\u672c\u5730\u6027","text":"<p>\u5bf9\u4e8e\u9759\u6001 Executor\uff1a</p> <ul> <li>\u7533\u8bf7 Executor \u65f6\uff0c\u4e0d\u6e05\u695a\u9700\u8981\u54ea\u4e9b\u6570\u636e\u7684\uff0c\u56e0\u6b64\u7533\u8bf7\u65f6\u6ca1\u6709\u672c\u5730\u6027\u53ef\u8a00\uff1b</li> </ul> <p>\u5bf9\u4e8e\u52a8\u6001 Executor\uff08dynamic==true\uff09\uff1a</p> <ul> <li>\u6839\u636e Host \u4e0a\u7684 Task \u4fe1\u606f\uff0c\u7533\u8bf7Container\uff0c\u5177\u5907\u672c\u5730\u6027\uff1b</li> </ul> <p>Spark \u5728\u8fd0\u884c\u65f6\uff0c\u53ef\u4ee5\u518d\u7533\u8bf7 Executors\uff0cSparkContext::requestExecutors</p> <p>Spark \u5728\u8c03\u5ea6 Task \u65f6\uff0c\u4f1a\u8003\u8651\u6570\u636e\u7684\u672c\u5730\u6027(TODO)\u3002</p>"},{"location":"distributed_computing/spark/spark_yarn.html#_4","title":"\u914d\u7f6e","text":"<p>1\uff09\u914d\u7f6e<code>HADOOP_CONF_DIR</code>\u548c<code>YARN_CONF_DIR</code>\u73af\u5883\u53d8\u91cf\uff1b</p> <ul> <li>\u76f4\u63a5\u901a\u8fc7 new SparkConf()\uff0c\u9700\u8981\u5c06\u5176\u52a0\u5165CLASSPATH\u4e2d\uff1b</li> </ul> <p>2\uff09Spark Runtime jars\uff1a<code>spark.yarn.archive</code> \u6216\u8005 <code>spark.yarn.jars</code></p>"},{"location":"distributed_computing/spark/spark_yarn.html#gpu","title":"GPU","text":"<p>Spark \u5411 Yarn \u7533\u8bf7\u8d44\u6e90\uff0c\u901a\u8fc7\u914d\u7f6e\u7684discoverScript\uff0c\u53d1\u73b0Container\uff08driver/executor\uff09\u7684GPU\u5361\uff1b</p> <p>Spark\u7684Scheduler\u4f1a\u6839\u636eexecutor\u7684GPU\u8d44\u6e90\u4fe1\u606f\uff0c\u5206\u914dTask\u4f5c\u4e1a\uff0c\u5e76\u5c06\u8d44\u6e90\u4fe1\u606f\u4f20\u5165Task\uff1b</p> <p>Spark\u5206\u533a\uff08Task\uff09\u53ef\u4ee5\u901a\u8fc7TaskContext\u83b7\u53d6Task\u4f7f\u7528\u7684\u8d44\u6e90\u4fe1\u606f(\u6bd4\u5982Task\u53ef\u4ee5\u4f7f\u7528\u7684GPU\u5361\u53f7)\uff1b</p>"},{"location":"distributed_computing/spark/spark_yarn.html#_5","title":"\u81ea\u5b9a\u4e49\u8d44\u6e90\u7533\u8bf7","text":"<p>\u5982\u7533\u8bf7\u81ea\u5b9a\u4e49\u8d44\u6e90 dcu\uff1a</p> <p><code>--conf spark.executor.resource.dcu.discoveryScript=/opt/hc-software/spark/bin/getDcusResources.sh</code></p> <ul> <li>\u7528\u4e8eexecutor\u4e2d\u914d\u7f6edcu\u83b7\u53d6\u811a\u672c</li> </ul> <p><code>--conf spark.executor.resource.dcu.amount=2</code></p> <ul> <li>\u7528\u4e8e\u914d\u7f6espark\u4fa7\u7684\u8d44\u6e90\u540d\u79f0\u53ca\u5176\u6570\u91cf</li> </ul> <p>\u5728Yarn\u4e0a\u65f6\uff0c\u6ce8\u610f\uff1a<code>--conf spark.yarn.executor.resource.dcu.amount=2</code></p> <ul> <li>\u7528\u4e8e\u914d\u7f6espark\u5728yarn\u4fa7\u7684\u8d44\u6e90\u540d\u79f0\u53ca\u5176\u6570\u91cf</li> </ul>"},{"location":"distributed_computing/spark/spark_yarn.html#_6","title":"\u8282\u70b9\u6807\u7b7e\uff08\u5206\u533a\uff09","text":"<p>\u53ef\u4ee5\u901a\u8fc7Yarn\u7684\u961f\u5217\u8ddf\u5206\u533a\u4e00\u5bf9\u4e00\u7ed1\u5b9a\uff0c\u8bbe\u7f6e\u961f\u5217\u7684\u9ed8\u8ba4\u5206\u533a\u6807\u7b7e\uff0c\u907f\u514d Spark \u4fa7\u7684\u914d\u7f6e\u3002</p> <p><code>spark.yarn.am.nodeLabelExpression</code></p> <p><code>spark.yarn.executor.nodeLabelExpression</code></p>"},{"location":"distributed_computing/spark/spark_yarn.html#placement-constraint","title":"\u8282\u70b9\u5c5e\u6027\uff08Placement Constraint\uff09","text":"<p>Spark 3.4 \u5f53\u524d\u4e0d\u652f\u6301 Placement Constraint\u3002</p>"},{"location":"distributed_computing/spark/deep_learning/basic.html","title":"databricks/spark-deep-learning","text":"<p>\u63d0\u4f9b\u4e00\u4e9bhigh-level\u7684API\uff0c\u628a\u5e95\u5c42\u7684\u6a21\u578b\u8fdb\u884c\u7ec4\u4ef6\u5316\uff0c\u540c\u65f6\u5b83\u671f\u671b\u53ef\u4ee5\u517c\u5bb9\u5e95\u5c42\u6df1\u5ea6\u5f0f\u5b66\u4e60\u6846\u67b6\u3002</p>"},{"location":"distributed_computing/spark/deep_learning/basic.html#yahootensorflowonspark","title":"Yahoo/TensorflowOnSpark","text":"<p>TensorflowOnSpark Pipeline\u5f00\u53d1\u4e86\u4e24\u4e2aAPI\uff0c\u4e00\u4e2a\u662fTFEstimator\uff0c\u53e6\u4e00\u4e2a\u662fTFModel\uff0c\u63d0\u4f9b\u4e86\u8fd9\u4e24\u4e2a\u4e4b\u540e\uff0c\u53ef\u4ee5\u76f4\u63a5\u628a\u5b83\u4eec\u96c6\u6210\u5230spark-deep-learning pipeline\u91cc\u9762\uff0c\u8fdb\u884c\u8fdb\u4e00\u6b65\u7684\u8bad\u7ec3\u3002</p>"},{"location":"distributed_computing/spark/livy/apache_livy.html","title":"Apache Livy","text":""},{"location":"distributed_computing/spark/optimize/Optimized_Shuffle_Service.html","title":"Riffle: Optimized Shuffle Service for Large-Scale Data Analytics","text":""},{"location":"distributed_computing/spark/optimize/Optimized_Shuffle_Service.html#1","title":"1. \u76ee\u6807","text":"<p>\u5927\u89c4\u6a21\u6570\u636e\u5904\u7406\u7cfb\u7edf\u4e2d\u968f\u7740\u6570\u636e\u91cf\u7684\u589e\u52a0\uff0cShuffle\u64cd\u4f5c\u79f0\u4e3a\u7cfb\u7edf\u7684\u6027\u80fd\u548c\u53ef\u6269\u5c55\u6027\u74f6\u9888\uff1a</p> <ul> <li>\u78c1\u76d8IO\u64cd\u4f5c\u7684\u8d85\u7ebf\u6027\u589e\u957f\uff1b</li> </ul>"},{"location":"distributed_computing/spark/optimize/Optimized_Shuffle_Service.html#2","title":"2. \u601d\u8def","text":"<ul> <li>\u5c06\u5c0f\u7684\u3001\u968f\u673a\u7684\u78c1\u76d8IO\u64cd\u4f5c\u53d8\u6210\u5927\u7684\u3001\u987a\u5e8f\u7684\u78c1\u76d8IO\u64cd\u4f5c</li> <li>\u5c06\u788e\u7247\u5f0f\u7684\u4e2d\u95f4shuffle\u6587\u4ef6\u5408\u5e76\u6210\u5927\u7684\u5757\u6587\u4ef6</li> </ul>"},{"location":"distributed_computing/spark/optimize/Optimized_Shuffle_Service.html#3","title":"3. \u5b9e\u73b0","text":""},{"location":"distributed_computing/spark/optimize/Optimized_Shuffle_Service.html#31","title":"3.1 \u4e2d\u592e\u8c03\u5ea6\u5668","text":"<ul> <li>\u8bb0\u5f55\u4e2d\u95f4\u7684shuffle\u6587\u4ef6\uff0c\u52a8\u6001\u534f\u8c03\u5408\u5e76\u64cd\u4f5c\uff1b</li> </ul>"},{"location":"distributed_computing/spark/optimize/Optimized_Shuffle_Service.html#32-shuffle","title":"3.2 Shuffle\u5408\u5e76\u670d\u52a1","text":"<ul> <li>\u5728\u6bcf\u4e2a\u7269\u7406\u8282\u70b9\u4e0a\u8fd0\u884c\uff0c\u9ad8\u6548\u5730\u5c06\u591a\u4e2a\u5c0f\u6587\u4ef6\u5408\u5e76\u6210\u5927\u6587\u4ef6\uff1b</li> </ul>"},{"location":"distributed_computing/spark/optimize/Optimized_Shuffle_Service.html#321","title":"3.2.1 \u7ec6\u8282","text":"<ul> <li>\u5c06\u5408\u5e76\u64cd\u4f5c\u548cmap\u4efb\u52a1\u91cd\u53e0\uff1b</li> <li>\u9632\u6b62straggler\u7684\u989d\u5916\u5ef6\u8fdf\u65f6\u95f4</li> <li>best-effort merge\u9608\u503c\uff0c\u4e0d\u4e00\u5b9a\u5c06\u6240\u6709\u7684map\u8f93\u51fa\u6587\u4ef6\u90fd\u5408\u5e76\uff1b</li> <li>\u5bb9\u9519\uff0c\u5728\u5408\u5e76\u6587\u4ef6\u548cshuffle\u51fa\u9519\u65f6</li> <li> <p>\u4fdd\u7559shuffle\u7684\u5408\u5e76\u6587\u4ef6\u548c\u539f\u59cb\u6587\u4ef6\uff1b</p> </li> <li> <p>\u591a\u79cd\u5408\u5e76\u7b56\u7565\uff1a</p> </li> <li>N\u4e2a\u6587\u4ef6\u5408\u5e76\uff0c\u6216\u8005\u7279\u5b9aBlock Size\u5408\u5e76\uff1b</li> </ul> <p></p> <ul> <li>\u5bf9\u6bcf\u4e2ashuffle\u6587\u4ef6\uff0c\u5206\u914d\u4e00\u4e2a\u7f13\u51b2\u533a\u7528\u4e8e\u5f02\u6b65\u8bfb\u53d6\u548c\u7f13\u5b58\u7d22\u5f15\u6587\u4ef6\uff1b\u5206\u914d\u4e00\u4e2a\u5355\u72ec\u7684\u7f13\u51b2\u533a\u6765\u5f02\u6b65\u5199\u5165\u5408\u5e76\u7684\u8f93\u51fa\u6587\u4ef6</li> <li>\u6309\u987a\u5e8f\u8bfb\u53d6Block\uff0c\u5e76\u5408\u5e76\u5230\u7f13\u51b2\u533a\u518d\u5199\u5165\uff1b</li> </ul> <p></p>"},{"location":"distributed_computing/spark/optimize/Optimized_Shuffle_Service.html#33","title":"3.3 \u8ba1\u7b97\u5b58\u50a8\u5206\u79bb\u67b6\u6784\u4e0b\u7684\u5408\u5e76\u8bf7\u6c42\u5747\u8861","text":"<p>\u5728\u6bcf\u4e2a\u8ba1\u7b97\u8282\u70b9\u8fd0\u884c\u4e00\u4e2aMerger\u8fdb\u7a0b</p> <ul> <li>\u6bcf\u4e2aMerger\u8fdb\u7a0b\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u5408\u5e76\u672c\u5730\u7684\u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u5408\u5e76\u5176\u5b83\u7269\u7406\u8282\u70b9\u7684\u6587\u4ef6\uff1f    </li> <li> <p>map\u7684\u8f93\u51fa\u6570\u636e\u662f\u672c\u5730\u4e34\u65f6\u76ee\u5f55\uff0c\u4e0d\u662f\u7269\u7406\u8282\u70b9\u7684 \u5b58\u50a8\u76ee\u5f55\uff1f</p> </li> <li> <p>\u201cpower of two choices\u201d \u7b56\u7565\u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\uff0c\u968f\u673a\u9009\u62e9\u4e24\u4e2a\u5408\u5e76\u8fdb\u7a0b\uff0c\u9009\u62e9\u961f\u5217\u6700\u77ed\u7684\u4e00\u4e2a\u8fdb\u884c\u63d0\u4ea4\u3002</p> </li> </ul> <p></p>"},{"location":"distributed_computing/spark/optimize/PushBased_Shuffle.html","title":"Push based Shuffle Service for Largescale Data Processing","text":"<p>2020 VLDB</p>"},{"location":"distributed_computing/spark/optimize/spark_action.html","title":"Spark \u5b9e\u6218","text":""},{"location":"distributed_computing/spark/optimize/spark_action.html#hive-sparksql","title":"Hive \u8fc1\u79fb\u5230 SparkSQL","text":""},{"location":"distributed_computing/spark/optimize/spark_action.html#jdbc-spark-thrift-serversql","title":"JDBC-Spark Thrift Server\u7684SQL\u6267\u884c\u7684\u8fdb\u5ea6\u65e5\u5fd7","text":"<p>Spark-2.3 \u5df2\u4fee\u590d\u3002</p>"},{"location":"distributed_computing/spark/optimize/spark_action.html#_1","title":"\u5c0f\u6587\u4ef6\u95ee\u9898","text":"<p>SparkSQL \u5728\u5199\u6570\u636e\u65f6\u4f1a\u4ea7\u751f\u5f88\u591a\u5c0f\u6587\u4ef6\uff0c\u4f1a\u5bf9 namenode \u4ea7\u751f\u5f88\u5927\u7684\u538b\u529b\uff0c\u8fdb\u800c\u5e26\u6765\u6574\u4e2a\u7cfb\u7edf\u7a33\u5b9a\u6027\u7684\u9690\u60a3\u3002</p> <ul> <li>\u901a\u8fc7 Coalesce and Repartition \u7684SQL hint \u5b9a\u4e49\u8f93\u51fa\u6587\u4ef6\u4e2a\u6570\uff1b</li> <li>\u7a0b\u5e8f\u65b9\u5f0f\u5b9a\u65f6\u626b\u63cf\u5408\u5e76\uff1b</li> <li><code>spark.hadoop.mapreduce.fileoutputcommitter.algorithm.version</code>\u8bbe\u7f6e\u4e3a2\uff0c\u89e3\u51b3commit\u8017\u65f6\u95ee\u9898\uff1b</li> </ul>"},{"location":"distributed_computing/spark/optimize/spark_action.html#spark_1","title":"Spark\u4f5c\u4e1a\u76d1\u63a7","text":"<ul> <li>\u8fd1\u5b9e\u65f6\u7684\u8bfb\u53d6 EventLog \u4ea7\u751f\u7684 Spark \u4e8b\u4ef6\uff0c\u901a\u8fc7\u4e8b\u4ef6\u56de\u653e\u5e76\u7ed3\u5408 REST API \u6700\u7ec8\u5f62\u6210\u6211\u4eec\u9700\u8981\u7684 Job \u6570\u636e\uff1b</li> <li>Spark + Prometheus</li> </ul>"},{"location":"distributed_computing/spark/optimize/spark_action.html#sql","title":"SQL\u591a\u5f15\u64ce\u81ea\u52a8\u9009\u62e9","text":"<p>SQL \u5f15\u64ce\u9009\u62e9\u901a\u8fc7 SQL \u89e3\u6790\uff0c\u8bed\u6cd5\u68c0\u67e5\uff0c\u89c4\u5219\u5339\u914d\uff0c\u5404\u4e2a\u5f15\u64ce\u7684\u8d44\u6e90\u8d1f\u8f7d\u60c5\u51b5\u7b49\u7b49\u56e0\u7d20\u6700\u7ec8\u7ed9\u7528\u6237\u9009\u62e9\u5408\u9002\u7684\u5f15\u64ce\uff08Presto/SparkSQL/Hive \uff09\u6765\u6267\u884c\u8ba1\u7b97</p>"},{"location":"distributed_computing/spark/optimize/spark_action.html#not-in-subquery","title":"\u4f4e\u6548\u4e14\u5371\u9669\u7684 Not in Subquery","text":"<p><code>select * from t1 where f1 not in (select f1 from t2)</code>\uff0c\u5bf9\u4e8e \u201c not in subquery \u201d\u7684\u573a\u666f\u6700\u7ec8\u90fd\u4f1a\u9009\u62e9 BroadcastNestedLoopJoinExec \uff08\uff1f\uff1f\uff09\u7269\u7406\u6267\u884c\u8ba1\u5212\uff0c\u800c BroadcastNestedLoopJoinExec \u662f\u4e00\u4e2a\u975e\u5e38\u4f4e\u6548\u7684\u7269\u7406\u6267\u884c\u8ba1\u5212\uff0c\u5185\u90e8\u5b9e\u73b0\u5c06 subquery <code>broadcast</code> \u6210\u4e00\u4e2a <code>list</code>\uff0c\u7136\u540e t1 \u6bcf\u4e00\u6761\u8bb0\u5f55\u901a\u8fc7 <code>loop</code> \u904d\u5386 list \u53bb\u5339\u914d\u662f\u5426\u5b58\u5728\u3002\u7531\u4e8e\u5b83\u7684\u4f4e\u6548\u53ef\u80fd\u4f1a\u957f\u65f6\u95f4\u5360\u7528 executor \u8d44\u6e90\uff0c\u540c\u65f6 subquery \u7ed3\u679c\u6570\u636e\u91cf\u6bd4\u8f83\u5927\u7684\u60c5\u51b5\u4e0b\uff0cbroadcast \u53ef\u80fd\u5e26\u6765 driver \u7684 OOM \u98ce\u9669\u3002</p>"},{"location":"distributed_computing/spark/optimize/spark_action.html#-","title":"\u7269\u5316\u5217-\u5d4c\u5957\u5217\u67e5\u8be2\u6027\u80fd\u4f4e\u4e0b\u7684\u4f18\u5316","text":""},{"location":"distributed_computing/spark/optimize/spark_action.html#_2","title":"\u573a\u666f","text":"<ul> <li>\u4e0d\u540c\u7684\u4e8b\u4ef6\u65e5\u5fd7\u6709\u5f88\u591a\u4e0d\u540c\u7684\u4fe1\u606f\uff0c\u4e3a\u4e8b\u4ef6\u65e5\u5fd7\u7684\u6bcf\u4e2a\u5b57\u6bb5\u90fd\u521b\u5efa\u4e00\u4e2a\u5217\u5b58\u50a8\u662f\u975e\u5e38\u4e0d\u660e\u667a\uff0c\u6240\u4ee5\u5728\u5b57\u8282\u4e8b\u4ef6\u65e5\u5fd7\u7684\u5b58\u50a8\u5c31\u4e24\u5217 Event type\uff08String\u7c7b\u578b\uff09\u548c Message\uff08Map\u7c7b\u578b\uff09\u3002\u6240\u6709\u7684\u4e8b\u4ef6\u4fe1\u606f\u90fd\u662f\u5b58\u653e\u5728 Message \u4e2d\u7684\uff1b</li> <li>\u7ef4\u5ea6\u6570\u636e\uff08Dimension data\uff09\uff0c\u7ef4\u5ea6\u8868\u91cc\u9762\u7684\u6570\u636e\u662f\u4ece MySQL dump \u8fc7\u6765\u7684\u3002MySQL \u4e2d\u5bf9\u5e94\u8868\u7684\u5b57\u6bb5\u53ef\u80fd\u4f1a\u589e\u52a0\uff0c\u4e5f\u53ef\u80fd\u4f1a\u51cf\u5c11\u3002\u5728\u7ef4\u5ea6\u8868\u91cc\u9762\u4e0d\u80fd\u7b80\u5355\u7684\u5220\u9664\u5bf9\u5e94\u7684\u5217\uff0c\u5426\u5219\u6570\u636e\u53ef\u80fd\u4f1a\u4e22\u5931\u3002\u6240\u4ee5\u5bf9\u4e8e\u7ef4\u5ea6\u6570\u636e\uff0c\u4e00\u4e9b\u5e38\u7528\u7684\u5217\u662f\u4ee5\u4e00\u5217\u4e00\u5217\u5355\u72ec\u5b58\u50a8\u7684\uff1b\u5176\u4ed6\u4e00\u4e9b\u5217\u662f\u5b58\u50a8\u5728\u4e00\u4e2a map \u7c7b\u578b\u7684\u5217\u4e2d\u3002</li> </ul>"},{"location":"distributed_computing/spark/optimize/spark_action.html#_3","title":"\u95ee\u9898","text":"<p>\u5728\u6570\u636e\u4ed3\u5e93\u9886\u57df\uff0c\u4f7f\u7528\u590d\u6742\u7c7b\u578b\uff08\u5982map\uff09\u4e2d\u7684\u4e00\u5217\u6216\u591a\u5217\uff0c\u5bf9\u6027\u80fd\u5f71\u54cd\u6bd4\u8f83\u5927\uff1a</p> <ul> <li>\u5927\u91cf\u6d88\u8017 IO\uff0c\u56e0\u4e3a\u8bfb\u53d6\u8be5\u5217\u65f6\u9700\u8981\u5c06\u6574\u4e2a\u5217\u8bfb\u51fa\u6765\uff1b</li> <li>\u8bfb\u53d6\u5d4c\u5957\u7c7b\u578b\u5217\u65f6\u4e0d\u80fd\u5229\u7528\u5411\u91cf\u5316\u8bfb\u53d6\uff1b</li> <li>\u8bfb\u53d6\u5d4c\u5957\u5217\u65f6\u4e0d\u80fd\u4f7f\u7528\u7b97\u5b50\u4e0b\u63a8\uff08Filter pushdown\uff09\u3002</li> </ul> <p></p>"},{"location":"distributed_computing/spark/optimize/spark_action.html#_4","title":"\u89e3\u51b3\u65b9\u6cd5","text":"<p>\u793a\u4f8b\uff1abase_table \u7684\u8868\uff0c\u91cc\u9762\u6709\u4e09\u4e2a\u5b57\u6bb5\uff1aitem\u3001count \u4ee5\u53ca people\uff0c\u5176\u4e2d people \u5b57\u6bb5\u662f map \u7c7b\u578b\u7684\u3002\u73b0\u5728\u6211\u4eec\u8981\u67e5\u8be2 people \u5b57\u6bb5\u91cc\u9762\u7684 age \u5b57\u6bb5\u3002</p>"},{"location":"distributed_computing/spark/optimize/spark_action.html#_5","title":"\u5355\u72ec\u8868","text":"<p>sub_table \u7684\u8868\uff1a</p> <ul> <li>\u9664\u4e86\u5305\u542b base_table \u7684\u6240\u6709\u5b57\u6bb5\u4e4b\u5916\u8fd8\u65b0\u589e\u4e86\u4e00\u4e2a\u65b0\u5b57\u6bb5 age\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u5176\u5b9e\u662f people \u4e2d age \u5b57\u6bb5\u7684\u503c\u3002</li> </ul> <p></p> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u544a\u8bc9\u4e0b\u6e38\u6240\u6709\u4f7f\u7528\u5230 base_table \u7684\u7528\u6237\u6765\u4f7f\u7528 sub_table\uff1b</li> <li>sub_table \u660e\u663e\u5360\u7528\u4e86\u91cd\u590d\u7684\u5b58\u50a8\uff1b</li> <li>\u4e0d\u80fd\u5904\u7406\u9891\u7e41\u7684\u5b50\u5b57\u6bb5\u66f4\u6539</li> </ul>"},{"location":"distributed_computing/spark/optimize/spark_action.html#_6","title":"\u5d4c\u5957\u5217\u7684\u5411\u91cf\u5316\u8bfb","text":"<p>Parquet vectorized reader\uff0c\u53ef\u4ee5\u5411\u91cf\u5316\u8bfb\u53d6\u5d4c\u5957\u6570\u636e\u7c7b\u578b\u3002\u5e76\u4e14\u652f\u6301\u5bf9 struct \u7c7b\u578b\u7684\u8fc7\u6ee4\u4e0b\u63a8\uff0c\u4f46\u662f map \u7c7b\u578b\u7684\u6570\u636e\u5e76\u4e0d\u652f\u6301\u3002</p> <p></p> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u9700\u8981\u5206\u522b\u91cd\u6784 Parquet \u548c ORC \u7684\u5411\u91cf\u5316\u8bfb\u53d6\u903b\u8f91\uff1b</li> <li>Array/Map \u6570\u636e\u7c7b\u578b\u7684\u8fc7\u6ee4\u4e0b\u63a8\u76ee\u524d\u8fd8\u4e0d\u652f\u6301\uff1b</li> <li>\u5d4c\u5957\u7c7b\u578b\u6570\u636e\u7684\u5411\u91cf\u5316\u8bfb\u53d6\u6027\u80fd\u6ca1\u6709\u7b80\u5355\u6570\u636e\u7c7b\u578b\u7684\u9ad8</li> </ul>"},{"location":"distributed_computing/spark/optimize/spark_action.html#_7","title":"\u7269\u5316\u5217","text":"<p>\u7269\u5316\u5217\uff08materialized column\uff09\uff0c\u900f\u660e\u5730\u89e3\u51b3\u4e86\u4efb\u610f\u5217\u5f0f\u5b58\u50a8\uff08\u4e0d\u4ec5\u4ec5\u662fParquet\uff09\u7684\u4e0a\u8ff0\u95ee\u9898\uff1a</p> <ul> <li>\u6dfb\u52a0 MATERIALIZED \u5173\u952e\u5b57\uff1b</li> <li>\uff1f\u9700\u8981\u5bf9Parquet\u6587\u4ef6\u8bfb\u53d6\uff0c\u8fdb\u884c\u91cd\u65b0\u5199\uff1f</li> </ul> <p>\u7ed3\u679c\uff1a</p> <ul> <li>\u5f80\u8868\u91cc\u9762\u63d2\u5165\u4e86\u4e00\u4e2a\u540d\u4e3a age \u5b57\u6bb5\uff0c\u81ea\u52a8\u63d2\u5165\uff1b</li> <li>rewrite \u6210 <code>select age from base_table</code>\uff0c\u81ea\u52a8\u8bfb\u53d6\uff1b</li> </ul> <p></p>"},{"location":"distributed_computing/spark/optimize/spark_action.html#_8","title":"\u6027\u80fd","text":"<p>\u7269\u5316\u5217\u7684\u6027\u80fd\uff1a\u67e5\u8be2\u6027\u80fd\u5747\u6709\u5f88\u5927\u63d0\u5347\uff0c\u67e5\u8be2\u8bfb\u7684\u6570\u636e\u91cf\u5927\u5927\u51cf\u5c11\u3002</p> <p></p>"},{"location":"distributed_computing/spark/spark_sql/index.html","title":"Spark SQL","text":"<p>http://spark.apache.org/docs/latest/sql-programming-guide.html</p>"},{"location":"distributed_computing/spark/spark_sql/index.html#dataframe","title":"DataFrame","text":"<p>Koalas\uff1a\u57fa\u4e8e Spark DataFrame \u5b9e\u73b0\u7684\u5206\u5e03\u5f0f Pandas DataFrame\uff0c\u5df2\u7ecf\u88ab\u96c6\u6210\u5230 Spark 3.x \u4e2d\u3002</p>"},{"location":"distributed_computing/spark/spark_sql/index.html#sql","title":"SQL\u8bed\u6cd5","text":""},{"location":"distributed_computing/spark/spark_sql/index.html#_1","title":"\u8f85\u52a9\u8bed\u53e5","text":""},{"location":"distributed_computing/spark/spark_sql/index.html#refresh","title":"refresh","text":"<p><code>REFRESH</code> is used to invalidate and refresh all the cached data (and the associated metadata) for all Datasets that contains the given data source path. Path matching is by prefix, i.e. \u201c/\u201d would invalidate everything that is cached.</p> <pre><code>df = spark.read.format(\"hudi\").load(basePath+\"/*/*\")\ndf.createOrReplaceTempView(\"track_log\")\n# \u5237\u65b0\u8868\u7684\u5143\u6570\u636e\u548cdata\nspark.sql(\"refresh table mytable\")\n</code></pre>"},{"location":"distributed_computing/spark/spark_sql/index.html#catalog","title":"Catalog","text":"<p>Catalog \u4e3b\u8981\u7528\u4e8e\u5404\u79cd\u51fd\u6570\u8d44\u6e90\u4fe1\u606f\u548c\u5143\u6570\u636e\u4fe1\u606f\uff08\u6570\u636e\u5e93\u3001\u6570\u636e\u8868\u3001\u6570\u636e\u89c6\u56fe\u3001\u6570\u636e\u5206\u533a\u4e0e\u51fd\u6570\u7b49)\u7684\u7edf\u4e00\u7ba1\u7406\u3002</p>"},{"location":"distributed_computing/spark/spark_sql/index.html#sessioncatalog","title":"SessionCatalog","text":"<p>\u5728 Spark 2.x \u4e2d\uff0cSpark SQL\u4e2d\u7684 Catalog \u4f53\u7cfb\u5b9e\u73b0\u4ee5 <code>SessionCatalog</code> \u4e3a\u4e3b\u4f53\uff0c\u901a\u8fc7<code>SparkSession</code> \uff08Spark\u7a0b\u5e8f\u5165\u53e3\uff09\u63d0\u4f9b\u7ed9\u5916\u90e8\u8c03\u7528\u3002</p> <p>\u4e00\u822c\u4e00\u4e2a<code>SparkSession</code>\u5bf9\u5e94\u4e00\u4e2a<code>SessionCatalog</code>\u3002</p> <p>\u672c\u8d28\u4e0a\uff0c <code>SessionCatalog</code>\u8d77\u5230\u4e86\u4e00\u4e2a\u4ee3\u7406\u7684\u4f5c\u7528\uff0c\u5bf9\u5e95\u5c42\u7684\u5143\u6570\u636e\u4fe1\u606f\u3001\u4e34\u65f6\u8868\u4fe1\u606f\u3001\u89c6\u56fe\u4fe1\u606f\u548c\u51fd\u6570\u4fe1\u606f\u8fdb\u884c\u4e86\u5c01\u88c5\u3002</p> <ul> <li>GlobalTempViewManager(\u5168\u5c40\u7684\u4e34\u65f6\u89c6\u56fe\u7ba1\u7406)\uff1a\u7528\u4e8e Session \u95f4\uff08\u540c\u8fdb\u7a0b\uff09\u5171\u4eab\u5168\u5c40\u4e34\u65f6\u8868\uff1b</li> <li>FunctionResourceLoader(\u51fd\u6570\u8d44\u6e90\u52a0\u8f7d\u5668) \uff1a\u9664\u5185\u7f6e\u5b9e\u73b0\u7684\u5404\u79cd\u51fd\u6570\u5916\uff0c\u8fd8\u652f\u6301\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\u548cHive\u4e2d\u7684\u5404\u79cd\u51fd\u6570</li> <li>FunctionRegistry(\u51fd\u6570\u6ce8\u518c\u63a5\u53e3)\uff1a\u5b9e\u73b0\u5bf9\u51fd\u6570\u7684\u6ce8\u518c(Register)\u3001\u67e5\u627e(Lookup)\u548c\u5220\u9664(Drop)\u7b49\u529f\u80fd</li> <li>ExternalCatalog\uff1a\u7528\u6765\u7ba1\u7406\u6570\u636e\u5e93(Databases)\u3001\u6570\u636e\u8868(Tables)\u3001\u6570\u636e\u5206\u533a(Partitions)\u548c\u51fd\u6570(Functions)\u7684\u63a5\u53e3\uff0c\u5177\u4f53\u5b9e\u73b0\u6709</li> <li><code>InMemoryCatalog</code>\uff1a\u5c06\u4e0a\u8ff0\u4fe1\u606f\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u4e00\u822c\u7528\u4e8e\u6d4b\u8bd5\u6216\u6bd4\u8f83\u7b80\u5355\u7684SQL\u5904\u7406\uff08\u6ca1\u6709metastore\u4fe1\u606f\uff09\uff0c\u91cd\u542f\u65e0\u6cd5\u8bc6\u522b\u4e4b\u524d\u521b\u5efa\u8fc7\u7684\u6570\u636e\u3002</li> <li><code>HiveExternalCatalog</code>\uff1a\u5b9e\u73b0\u6301\u4e45\u5316\u7684\u7ba1\u7406\uff0c\u5e94\u7528\u5728\u751f\u4ea7\u73af\u5883\u4e2d</li> </ul>"},{"location":"distributed_computing/spark/spark_sql/index.html#v2sessioncatalog","title":"V2SessionCatalog","text":"<p>TableCatalog\uff1a\u5b9a\u4e49 catalog API \u7528\u6765 create\uff0calter\uff0cload \u548c drop \u8868</p> <p>FunctionCatalog\uff1a\u5b9a\u4e49 catalog API \u7528\u6765\u64cd\u4f5c\u51fd\u6570</p> <p>SupportsNamespaces\uff1a\u5b9a\u4e49 catalog API \u7528\u6765\u64cd\u4f5c Namespace</p> <p>V2SessionCatalog\uff1a\u4fdd\u8bc1\u540e\u5411\u517c\u5bb9\u6027\uff0c\u662f\u5bf9 SessionCatalog \u7684\u5c01\u88c5\u3002</p>"},{"location":"distributed_computing/spark/spark_sql/index.html#catalog_1","title":"\u81ea\u5b9a\u4e49Catalog","text":"<p>TODO</p>"},{"location":"distributed_computing/spark/spark_sql/index.html#catalogmanager","title":"CatalogManager","text":"<p>Spark \u901a\u8fc7CatalogManager \u53ef\u4ee5\u540c\u65f6\u7ba1\u7406\u5185\u90e8\u8fde\u63a5\u591a\u4e2acatalog\uff0c\u901a\u8fc7 <code>spark.sql.catalog.${name}</code> \u53ef\u4ee5\u6ce8\u518c\u591a\u4e2acatalog\uff0cSpark\u9ed8\u8ba4\u7684catalog\u7531 <code>spark.sql.catalog.spark_catalog</code> \u53c2\u6570\u6307\u5b9a\u3002\u901a\u5e38\u7684\u505a\u6cd5\u662f\uff0c\u81ea\u5b9a\u4e49catalog\u7c7b\u7ee7\u627f <code>DelegatingCatalogExtension \u5b9e\u73b0</code>\uff0c\u7136\u540e\u901a\u8fc7 <code>spark.sql.catalog.spark_catalog</code> \u53c2\u6570\u6765\u6307\u5b9a\u81ea\u5b9a\u4e49catalog\u7c7b\u3002</p> <ul> <li>\u5982 Hudi \u4f7f\u7528\u65f6\u7684 <code>org.apache.spark.sql.hudi.catalog.HoodieCatalog</code></li> </ul> <p>\u591a\u4e2a catalog\uff08\u6bd4\u5982\u4e24\u4e2a hive metatore\uff09 \u65f6\u53ef\u4ee5\u4f7f\u7528\u5168\u8def\u5f84\u8bbf\u95ee\u8868\u540d</p> <pre><code>select * from spark_catalog.database_1.table_1\n</code></pre>"},{"location":"distributed_computing/spark/spark_sql/index.html#hive","title":"Hive","text":"<p>Spark \u53ef\u4ee5\u8bfb\u5199 Hive \u4e2d\u7684 \u8868\u3002</p> <pre><code>val spark = SparkSession\n  .builder()\n  .appName(\"Spark Hive Example\")\n  .config(\"spark.sql.warehouse.dir\", warehouseLocation)\n  // \u5fc5\u987b\u6709 hive \u7684 classpath\n  .enableHiveSupport()\n  .getOrCreate()\n\n// saveAsTable \u5c06\u8868\u5199\u5165\u5230 hive \u4e2d\ndf.write.mode(SaveMode.Overwrite).saveAsTable(\"hive_records\")\n</code></pre> <ul> <li>\u5982\u679c\u6ca1\u914d\u7f6e hive-site.xml\uff0c\u5219\u6570\u636e\u4f1a\u5b58\u50a8\u5728<code>spark.sql.warehouse.dir</code>\uff08\u9ed8\u8ba4application\u542f\u52a8\u7684\u5f53\u524d\u76ee\u5f55\u7684<code>spark-warehouse</code>\uff09\u4e0b\uff0c\u540c\u65f6\u5f53\u524d\u76ee\u5f55\u4e0b\u521b\u5efa<code>metastore_db</code>\u5b58\u50a8\u5143\u6570\u636e\uff08\u901a\u8fc7 Derby\uff09\u3002</li> </ul>"},{"location":"distributed_computing/spark/spark_sql/datasource.html","title":"\u6570\u636e\u6e90","text":""},{"location":"distributed_computing/spark/spark_sql/datasource.html#datasource-v1v2","title":"DataSource V1\u4e0eV2","text":"<p>Spark 2.3\u4ee5\u524d\u6570\u636e\u6e90\u76f8\u5173\u7684API\u4e00\u822c\u53eb\u505aV1 API\uff0c\u5b83\u4ee5RDD\u4e3a\u57fa\u7840\uff0c\u5411\u4e0a\u6269\u5c55schema\u4fe1\u606f\uff0c\u5f62\u6210DataFrame\u3002</p> <p>\u4e4b\u540e\u7684\u7248\u672c\u5219\u662f\u53e6\u4e00\u79cd\u5b9e\u73b0\u601d\u8def\uff0c\u76f4\u63a5\u57fa\u4e8e\u65b0\u7684\u63a5\u53e3\u5728DataFrame\u7684\u601d\u8def\u4e0a\u63d0\u4f9b\u6570\u636e\u3002</p> <p>\u5728<code>DataFrameReader</code>\u4e2d\uff0c\u4f1a\u5148\u627e V2 \u5b9e\u73b0\uff0c\u627e\u4e0d\u5230\u5219\u4f1a\u518d\u627e V1 \u5b9e\u73b0\uff1b</p> <pre><code>DataSource.lookupDataSourceV2(source, sparkSession.sessionState.conf)\n          .map {...}\n          .getOrElse(loadV1Source(paths: _*))\n</code></pre>"},{"location":"distributed_computing/spark/spark_sql/datasource.html#v1","title":"V1","text":"<p>\u8bfb\u53d6\u5404\u79cd\u6765\u6e90\u7684\u6570\u636e\uff0c\u652f\u6301\u5bf9\u6570\u636e\u6e90\u7684\u8bfb\u53d6\u8fdb\u884c\u4f18\u5316\uff0c\u6bd4\u5982\u5217\u88c1\u526a\u3001\u8fc7\u6ee4\u4e0b\u63a8\u7b49\u7b49\u3002</p> <p>2.3 \u7248\u672c\u63a8\u51faV2\uff0cV1\u7684\u4e0d\u8db3\uff1a</p> <ul> <li>\u90e8\u5206\u63a5\u53e3\u4f9d\u8d56 SQLContext \u548c DataFrame</li> <li>\u540e\u7eed\u88ab\u4fee\u590d</li> <li>\u6269\u5c55\u80fd\u529b\u6709\u9650\uff0c\u96be\u4ee5\u4e0b\u63a8\u5176\u4ed6\u7b97\u5b50</li> <li>\u4ec5\u652f\u6301 filter \u4e0b\u63a8\u548c\u5217\u4fee\u526a\uff08PrunedFilteredScan\uff09\uff0c\u5982\u679c\u60f3\u6dfb\u52a0\u5982 limit \u5176\u4ed6\u4f18\u5316\uff0c\u9700\u8981\u65b0\u589e\u63a5\u53e3\uff1b</li> <li>\u7f3a\u4e4f\u5bf9\u5217\u5f0f\u5b58\u50a8\u8bfb\u53d6\u7684\u652f\u6301</li> <li>\u4ec5\u652f\u6301\u4ee5\u884c\u5f0f\u7684\u5f62\u5f0f\u8bfb\u53d6\u6570\u636e</li> <li>\u7f3a\u4e4f\u5206\u533a\u548c\u6392\u5e8f\u4fe1\u606f</li> <li>\u7269\u7406\u5b58\u50a8\u4fe1\u606f\uff08\u4f8b\u5982\u5206\u533a\u548c\u6392\u5e8f\uff09\u4e0d\u4f1a\u4ece\u6570\u636e\u6e90\u4f20\u9012\u5230 Spark \u8ba1\u7b97\u5f15\u64ce\uff0c\u5982\u5bf9\u4e8e HBase/Cassandra \u8fd9\u4e9b\u9488\u5bf9\u5206\u533a\u8bbf\u95ee\u8fdb\u884c\u4e86\u4f18\u5316\u7684\u6570\u636e\u5e93</li> <li>\u5199\u64cd\u4f5c\u4e0d\u652f\u6301\u4e8b\u52a1</li> <li>\u5f53\u6570\u636e\u90e8\u5206\u5199\u5165\u6570\u636e\u5e93\u5e76\u4e14\u4f5c\u4e1a\u51fa\u73b0\u5f02\u5e38\u65f6\uff0cSpark \u6570\u636e\u6e90\u63a5\u53e3\u5c06\u4e0d\u4f1a\u6e05\u7406\u8fd9\u4e9b\u884c\uff1b</li> <li>\u5199 HDFS \u6587\u4ef6\u65f6\uff0c\u5982\u679c\u5199\u6210\u529f\u5c06\u751f\u6210\u4e00\u4e2a\u540d\u4e3a _SUCCESS \u7684\u6587\u4ef6\uff0c\u4f46\u662f\u8fd9\u79cd\u673a\u5236\u5728\u6570\u636e\u5e93\u4e2d\u662f\u4e0d\u5b58\u5728</li> <li>\u4e0d\u652f\u6301\u6d41\u5904\u7406</li> <li>Kafka \u8fd9\u6837\u7684\u6570\u636e\u6e90\u4e0d\u5f97\u4e0d\u8c03\u7528\u4e00\u4e9b\u4e13\u7528\u7684\u5185\u90e8 API \u6216\u8005\u72ec\u81ea\u5b9e\u73b0\u3002</li> </ul>"},{"location":"distributed_computing/spark/spark_sql/datasource.html#v2","title":"V2","text":"<p>V2 \u8bbe\u8ba1</p>"},{"location":"distributed_computing/spark/spark_sql/datasource.html#_2","title":"\u81ea\u5b9a\u4e49\u6570\u636e\u6e90","text":"<p>Spark\u539f\u7406\u56fe\u89e3\uff1aDataSource V1 API\u4e0e\u81ea\u5b9a\u4e49\u6570\u636e\u6e90</p>"},{"location":"distributed_computing/spark/spark_sql/datasource.html#v1_1","title":"V1\u81ea\u5b9a\u4e49","text":"<p>\u5173\u952e\u70b9:</p> <ul> <li><code>DataSourceRegister</code>\uff0c\u6807\u8bc6\u662f\u6570\u636e\u6e90\u670d\u52a1\u7c7b\uff0cSpark\u4f1a\u4ee5\u5b83\u6765\u626b\u63cf\u5b9e\u73b0\u7c7b\uff1b</li> <li><code>RelationProvider</code>\uff0c\u6807\u8bc6\u662f\u5173\u7cfb\u578b\u7684\u6570\u636e\u6e90\uff0c\u53ef\u4ee5\u5728Spark SQL\u4e2d\u4f7f\u7528\uff1b</li> <li><code>BaseRelation</code>\uff0c\u63cf\u8ff0DataFrame\u7684Schema\u4fe1\u606f \uff1b</li> <li><code>TableScan</code>, \u63d0\u4f9b\u65e0\u53c2\u7684\u6570\u636e\u626b\u63cf\u670d\u52a1\uff1b<code>PrunedScan</code>\uff0c\u63d0\u4f9b\u5217\u88c1\u526a\u7684\u6570\u636e\u626b\u63cf\u670d\u52a1\uff1b<code>PrunedFilteredScan</code>\uff0c\u63d0\u4f9b\u5217\u88c1\u526a\u548c\u8fc7\u6ee4\u4e0b\u63a8\u7684\u6570\u636e\u626b\u63cf\u670d\u52a1\u3002\u4e09\u4e2ascan\u63a5\u53e3\u4efb\u9009\u5176\u4e00</li> </ul> <p>\u6d41\u7a0b\uff1a</p> <ul> <li><code>loadV1Source</code>\u4e2d\u8c03\u7528<code>DataSource</code>\u7684<code>apply</code>\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u5e76\u8c03\u7528\u5176<code>resolveRelation</code>\u521b\u5efa<code>BaseRelation</code>\uff0c\u7136\u540e\u901a\u8fc7<code>SparkSession</code>\u521b\u5efa<code>DataFrame</code>\u8fd4\u56de\uff1b</li> </ul> <p>\u81ea\u5b9a\u4e49</p> <ul> <li>\u5b9e\u73b0\u7c7b\u5fc5\u987b\u7ee7\u627f<code>DataSourceRegister</code>\uff0c\u5426\u5219\u65e0\u6cd5\u4f7f\u7528\u7b80\u79f0\u81ea\u52a8\u626b\u63cf\u5230\u8be5\u5b9e\u73b0\u7c7b</li> <li>\u5b9e\u73b0\u7c7b\u9700\u8981\u7ee7\u627f<code>RelationProvider</code>\uff0c\u624d\u80fd\u6807\u8bc6\u4e3a\u5173\u7cfb\u578b\u7684\u6570\u636e\u6e90\uff0c\u5728SparkSQL\u624d\u80fd\u4f7f\u7528</li> <li>shortName\u4e2d\u7684\u7b80\u79f0\u7528\u4e8e\u4f7f\u7528\u65f6format\u4e2d\u6307\u5b9a\u683c\u5f0f</li> <li>\u4e00\u822c\u5728\u5b9e\u73b0\u4e2d\u4f1a\u901a\u8fc7<code>option()</code>\u4f20\u9012\u81ea\u5b9a\u4e49\u53c2\u6570\uff0c\u53c2\u6570\u4f1a\u4f20\u5165parameters</li> <li>\u5728createRelation\u9700\u8981\u83b7\u53d6\u76f8\u5173\u4fe1\u606f\uff0c\u521b\u5efaSchema\uff0c\u8fd9\u91cc\u5199\u6b7b\u6a21\u62df\u4e86\u4e00\u4e0b\u3002\u6b63\u5e38\u5982\u679c\u662fmysql\u4e4b\u7c7b\u7684\uff0c\u9700\u8981\u8fde\u63a5\u6570\u636e\u5e93\u83b7\u53d6\u5bf9\u5e94\u8868\u7684\u5b57\u6bb5\u4ee5\u53ca\u7c7b\u578b\u4fe1\u606f\u3002</li> </ul> <pre><code>class TestProvider extends DataSourceRegister with RelationProvider {\n    override def shortName(): String = \"test\"\n\n    override def createRelation(sqlContext: SQLContext,\n                                parameters: Map[String, String]): BaseRelation = {\n        // 1 \u901a\u8fc7\u53c2\u6570\u7b49\u751f\u6210schema\u4fe1\u606f\n        val schema = StructType(Seq(\n            StructField(\"name\", StringType, nullable = true),\n            StructField(\"age\", IntegerType, nullable = true),\n            StructField(\"address\", StringType, nullable = true)\n        ))\n\n        // 2 \u521b\u5efaBaseRelation\n        TestRelation(schema)(sqlContext.sparkSession)\n    }\n}\n\ncase class TestRelation(override val schema: StructType)\n                       (@transient val spark: SparkSession)\n    extends BaseRelation with PrunedFilteredScan {\n    override def sqlContext: SQLContext = spark.sqlContext\n\n    override def buildScan(requiredColumns: Array[String],\n                           filters: Array[Filter]): RDD[Row] = {\n        // \u6784\u5efa\u67e5\u8be2\u8fd4\u56deRDD\uff0c\u6839\u636erequiredColumns\u8fdb\u884c\u5217\u88c1\u526a\uff0cfilters\u8fdb\u884c\u8c13\u8bcd\u4e0b\u63a8\n        spark.createDataFrame(Seq(Stud(\"a\", 10, \"aaa\"), Stud(\"b\", 20, \"bbb\")))\n            .rdd\n    }\n}\n\ncase class Stud(name: String, age: Int, address: String)\n</code></pre> <p>\u4f7f\u7528\uff0c\u6ce8\u610f\u8fd8\u9700\u8981\u5355\u72ec\u914d\u7f6eSPI\u7684\u53d1\u73b0\u6587\u4ef6\uff1a</p> <pre><code>import org.apache.spark.sql.SparkSession\n\nobject Test2 {\n  def main(args: Array[String]): Unit = {\n    val spark: SparkSession = SparkSession.builder()\n      .master(\"local\")\n      .getOrCreate()\n\n    val df = spark.read.format(\"test\")\n      .load()\n\n      df.select(\"name\")\n        .filter(\"age &gt; 15\")\n        .show(false)\n  }\n}\n</code></pre>"},{"location":"distributed_computing/spark/spark_sql/features.html","title":"Spark SQL \u539f\u7406\u7279\u6027","text":""},{"location":"distributed_computing/spark/spark_sql/features.html#_1","title":"\u5411\u91cf\u5316\u6267\u884c\u548c\u4ee3\u7801\u751f\u6210","text":""},{"location":"distributed_computing/spark/spark_sql/features.html#java","title":"Java\u5411\u91cf\u5316","text":"<p>\u5411\u91cf\u5316\u4ee3\u7801\uff1a</p> <pre><code>for (int i-0; i &lt; pos.length; i++) {\n    pos[i] = pos[i] + mov[i];\n}\n</code></pre> <p>Java\u4ee3\u7801\u5411\u91cf\u5316\u6267\u884c\uff1a</p> <ul> <li>\u81ea\u52a8\u7684\uff1a\u4e0d\u80fd\u624b\u52a8\u63a7\u5236\uff0c\u53ea\u80fd\u7531 JVM \u81ea\u52a8\u5904\u7406\u3002\u6ca1\u6709\u529e\u6cd5\u505a\u5230\u50cf C++ \u4e00\u6837\u76f4\u63a5\u8c03\u4e00\u4e2a\u5e95\u5c42\u7684 CPU \u6307\u4ee4\uff1b</li> <li>\u9690\u5f0f\u7684\uff1a\u4ee3\u7801\u5c42\u9762\u65e0\u6cd5\u627e\u5230\u5411\u91cf\u5316\u7684\u663e\u5f0f\u8c03\u7528\uff0c\u6574\u4e2a\u8fc7\u7a0b\u662f\u9690\u5f0f\u7684\uff0c\u6bd4\u5982\u4e0a\u9762\u7684 for \u5faa\u73af\u88ab\u5411\u91cf\u5316\u6267\u884c\uff1b</li> <li>\u4e0d\u53ef\u9760\u7684\uff1a\u4f9d\u8d56\u4e8e JVM \u8fd0\u884c\u671f\u7684\u70ed\u70b9\u4ee3\u7801\u8ddf\u8e2a\u4ee5\u53ca JIT \uff0c\u6240\u4ee5\u6574\u4e2a\u8fc7\u7a0b\u662f\u4e0d\u53ef\u9760\u7684\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_sql/features.html#volcano-iterator-model","title":"\u706b\u5c71\u8fed\u4ee3\u6a21\u578b\uff08Volcano Iterator Model\uff09","text":"<p>\u73b0\u5728\u5927\u591a\u6570\u5927\u6570\u636e\u7cfb\u7edf\u6216\u8005\u8bf4\u6570\u636e\u5e93\u5e95\u5c42\uff0c\u5bf9 SQL \u8fdb\u884c\u5904\u7406\u65f6\u901a\u5e38\u4f1a\u91c7\u7528\u7684\u6a21\u578b\u3002</p> <p>\u6a21\u578b\u5177\u6709\u6613\u62bd\u8c61\u3001\u6613\u5b9e\u73b0\u3001\u4ee5\u53ca\u80fd\u591f\u901a\u8fc7\u7b97\u5b50\u7ec4\u5408\u8868\u8fbe\u590d\u6742\u67e5\u8be2\u8fd9\u4e09\u4e2a\u4f18\u52bf\u3002</p> <ul> <li>\u5927\u91cf\u865a\u51fd\u6570\u7684\u8c03\u7528\uff0c\u5c31\u53ef\u80fd\u4f1a\u5bfc\u81f4 CPU \u7684\u4e2d\u65ad\u548c\u8017\u65f6</li> </ul> <p></p>"},{"location":"distributed_computing/spark/spark_sql/features.html#spark-code-generation","title":"Spark Code Generation","text":"<ul> <li>\u51cf\u5c11\u57fa\u672c\u7c7b\u578b\u7684\u81ea\u52a8\u88c5\u7bb1\uff1b</li> <li>\u907f\u514d\u591a\u6001\u8c03\u7528\uff08\u706b\u5c71\u8fed\u4ee3\u6a21\u578b\uff09\uff1b</li> <li>\u5229\u7528SIMD\u6279\u91cf\u5904\u7406\u6570\u636e\uff08JVM\u5411\u91cf\u5316\uff09\uff1b</li> <li>\u5176\u5b83Fix\uff08\u7b97\u5b50\u878d\u5408/\u7f29\u51cf\u6808\u6df1\uff09\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_sql/features.html#stagewhole-stage-code-generation","title":"\u6574\u4f53Stage\u4ee3\u7801\u751f\u6210\uff08Whole-stage code generation\uff09","text":"<p>\u4f7f\u5f97\u8ba1\u7b97\u5f15\u64ce\u7684\u7269\u7406\u6267\u884c\u901f\u5ea6\u80fd\u8fbe\u5230 hard code \u7684\u6027\u80fd\uff1a</p> <ul> <li>\u5bf9\u7269\u7406\u6267\u884c\u7684\u591a\u6b21\u8c03\u7528\u8f6c\u6362\u4e3a\u4ee3\u7801 for \u5faa\u73af\uff0c\u51cf\u5c11\u4e2d\u95f4\u6267\u884c\u7684\u51fd\u6570\u8c03\u7528\u6b21\u6570</li> </ul> <p>\u793a\u4f8b\uff1aselect count(*) from store_sales where ss_item_sk = 1000</p> <p>\u901a\u5e38\u7269\u7406\u8ba1\u5212\u7684\u4ee3\u7801\u662f\u8fd9\u6837\u5b9e\u73b0\u7684\uff1a</p> <pre><code>class Filter(child: Operator, predicate: (Row =&gt; Boolean)) {\n    def next(): Row = {\n        var current = child.next()\n\n        while (current != null &amp;&amp; !predicate(current)) {\n            current == child.next();\n        }\n        return current\n    }\n}\n</code></pre> <p>\u4f46\u662f\u771f\u6b63\u5982\u679c\u6211\u4eec\u7528 hard code \u5199\u7684\u8bdd\uff0c\u4ee3\u7801\u662f\u8fd9\u6837\u7684\uff1a</p> <pre><code>var count = 0\nfor (ss_item_sk in store_sales) {\n    if (ss_item_sk == 1000) {\n        count += 1\n    }\n}\n</code></pre> <p>\u539f\u56e0\uff1a</p> <ul> <li>\u907f\u514dvirtual function dispatch\uff1bnext()\u7b49\u51fd\u6570\u8c03\u7528\u5728\u64cd\u4f5c\u7cfb\u7edf\u5c42\u9762\uff0c\u4f1a\u88ab\u7f16\u8bd1\u4e3avirtual function dispatch\u3002</li> <li>\u901a\u8fc7CPU Register\u5b58\u53d6\u4e2d\u95f4\u6570\u636e\uff0c\u800c\u4e0d\u662f\u5185\u5b58\u7f13\u51b2\uff1a\u5728Volcano Iterator Model\u4e2d\uff0c\u6bcf\u6b21\u4e00\u4e2aoperator\u5c06\u6570\u636e\u4ea4\u7ed9\u4e0b\u4e00\u4e2aoperator\uff0c\u90fd\u9700\u8981\u5c06\u6570\u636e\u5199\u5165\u5185\u5b58\u7f13\u51b2\u4e2d\u3002\u7136\u800c\u5728\u624b\u5199\u4ee3\u7801\u4e2d\uff0cJVM JIT\u7f16\u8bd1\u5668\u4f1a\u5c06\u8fd9\u4e9b\u6570\u636e\u5199\u5165CPU Register\u3002</li> <li>Loop Unrolling \u548c SIMD\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_sql/features.html#aqespark-30","title":"\u81ea\u9002\u5e94\u67e5\u8be2\u6267\u884c\u8bbe\u8ba1\uff08AQE\uff0cSpark 3.0\uff09","text":"<p>\u4e0b\u56fe\u8868\u793a\u4e86\u4f7f\u7528 DataFrames \u6267\u884c\u7b80\u5355\u7684\u5206\u7ec4\u8ba1\u6570\u67e5\u8be2\u65f6\u53d1\u751f\u7684\u5206\u5e03\u5f0f\u5904\u7406\uff1a</p> <p></p> <p>Spark \u5728\u7b2c\u4e00\u9636\u6bb5\uff08stage\uff09\u786e\u5b9a\u4e86\u9002\u5f53\u7684\u5206\u533a\u6570\u91cf\uff0c\u4f46\u5bf9\u4e8e\u7b2c\u4e8c\u9636\u6bb5\uff0c\u4f7f\u7528\u9ed8\u8ba4\u7684\u5206\u533a\u6570 200\uff0c\u5373\u4f7f\u624b\u52a8\u8bbe\u7f6e\u5206\u533a\u6570\uff0c\u4f46\u662f\u4e5f\u6709\u4ee5\u4e0b\u6311\u6218\uff1a</p> <ul> <li>\u6bcf\u4e2a\u67e5\u8be2\u90fd\u8bbe\u7f6e\u8fd9\u4e2a\u5c5e\u6027\u662f\u975e\u5e38\u7e41\u7410\u7684\uff1b</li> <li>\u968f\u7740\u4e1a\u52a1\u7684\u53d8\u5316\uff0c\u4e4b\u524d\u8bbe\u7f6e\u7684\u503c\u53ef\u80fd\u4f1a\u8fc7\u65f6\uff1b</li> <li>\u8fd9\u4e2a\u8bbe\u7f6e\u5c06\u5e94\u7528\u4e8e\u540c\u4e00\u4e2a\u7a0b\u5e8f\u91cc\u9762\u7684\u6240\u6709 Shuffle \u64cd\u4f5c\u4e2d\u3002</li> </ul> <p>\u57fa\u4e8e\u7cbe\u786e\u7684\u8fd0\u884c\u65f6\u7edf\u8ba1\u4fe1\u606f\u8fdb\u884c\u4f18\u5316\uff0c\u5f15\u5165\u4e86 Query Stages \u7684\u6982\u5ff5\uff0c\u4ee5 Query Stage \u4e3a\u7c92\u5ea6\uff0c\u8fdb\u884c\u8fd0\u884c\u65f6\u7684\u4f18\u5316</p> <p></p> <p>Query Stage \u662f\u7531 Shuffle \u6216 broadcast exchange \u5212\u5206\u7684\uff0c\u5728\u8fd0\u884c\u4e0b\u4e00\u4e2a Query Stage \u4e4b\u524d\uff0c\u4e0a\u4e00\u4e2a Query Stage \u7684\u8ba1\u7b97\u9700\u8981\u5168\u90e8\u5b8c\u6210\uff0c\u8fd9\u662f\u8fdb\u884c\u8fd0\u884c\u65f6\u4f18\u5316\u7684\u7edd\u4f73\u65f6\u673a\uff0c\u56e0\u4e3a\u6b64\u65f6\u6240\u6709\u5206\u533a\u4e0a\u7684\u6570\u636e\u7edf\u8ba1\u90fd\u662f\u53ef\u7528\u7684\uff0c\u5e76\u4e14\u540e\u7eed\u64cd\u4f5c\u8fd8\u6ca1\u6709\u5f00\u59cb\u3002</p> <p>\u53c2\u6570</p> <p><code>spark.sql.adaptive.enabled</code>\uff1a\u662f\u5426\u5f00\u542f\u81ea\u9002\u5e94\u4f18\u5316\uff0c\u9ed8\u8ba4<code>true</code>\u3002</p>"},{"location":"distributed_computing/spark/spark_sql/features.html#_2","title":"\u81ea\u9002\u5e94\u8c03\u6574\u5206\u533a\u6570","text":"<p>Spark \u5c06\u4f1a\u628a\u8fde\u7eed\u7684 shuffle partitions \u8fdb\u884c\u5408\u5e76\uff08coalesce contiguous shuffle partitions\uff09\u4ee5\u51cf\u5c11\u5206\u533a\u6570\u3002</p> <p>\u76f8\u5173\u53c2\u6570\uff1a</p> <p><code>spark.sql.adaptive.coalescePartitions.enabled</code>\uff1a\u662f\u5426\u5f00\u542f\u81ea\u9002\u5e94\u5206\u533a\u7f29\u51cf\uff0c\u9ed8\u8ba4<code>true</code>\uff1b</p> <p><code>spark.sql.adaptive.advisoryPartitionSizeInBytes</code>\uff1a\u81ea\u9002\u5e94\u5206\u533a\u6240\u89c1\u7684\u5206\u533a\u7684\u5212\u5206\u5927\u5c0f\uff0c\u9ed8\u8ba464MB\uff1b</p> <p><code>spark.sql.adaptive.coalescePartitions.minPartitionSize</code>\uff1a\u81ea\u9002\u5e94\u5206\u533a\u6240\u89c1\u7684\u5206\u533a\u7684\u6700\u5c0f\u5927\u5c0f\uff1b</p> <p><code>spark.sql.adaptive.coalescePartitions.parallelismFirst</code>\uff1a\u6839\u636e\u96c6\u7fa4\u9ed8\u8ba4\u5e76\u884c\u5ea6\uff0c\u8bbe\u7f6e\u5206\u533a\u5927\u5c0f\uff08\u5c3d\u53ef\u80fd\u5229\u7528\u8d44\u6e90\u5e76\u53d1\uff09\uff0c\u800c\u4e0d\u662f\u6839\u636e<code>advisoryPartitionSizeInBytes</code>\uff0c\u9ed8\u8ba4<code>true</code>\uff0c\u63a8\u8350<code>false</code>\uff1b</p> <p>\u793a\u4f8b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <ul> <li>\u4e09\u4e2a\u975e\u5e38\u5c0f\u7684\u5206\u533a\uff0c\u4e3a\u6bcf\u4e2a\u5206\u533a\u542f\u52a8\u4e00\u4e2a\u5355\u72ec\u7684\u4efb\u52a1\u5c06\u662f\u4e00\u79cd\u6d6a\u8d39\uff1b</li> <li>\u4f7f\u7528 AQE \u4e4b\u540e\uff0cSpark \u5c06\u8fd9\u4e09\u4e2a\u5c0f\u5206\u533a\u5408\u5e76\u4e3a\u4e00\u4e2a\uff0c\u6700\u7ec8\u7684\u805a\u5408\u53ea\u9700\u8981\u6267\u884c\u4e09\u4e2a\u4efb\u52a1\uff0c\u800c\u4e0d\u662f\u4e94\u4e2a\u3002</li> </ul> <p></p> <p></p>"},{"location":"distributed_computing/spark/spark_sql/features.html#sort-merge-joins-broadcast-joins","title":"\u52a8\u6001\u5c06 Sort Merge Joins \u8f6c\u6362\u6210 Broadcast Joins","text":"<p>Spark \u4f30\u8ba1\u53c2\u52a0 join \u7684\u8868\u6570\u636e\u91cf\u5c0f\u4e8e\u5e7f\u64ad\u5927\u5c0f\u7684\u9608\u503c\uff08<code>spark.sql.autoBroadcastJoinThreshold</code>\uff09\u65f6\uff0c\u5176\u4f1a\u5c06 Join \u7b56\u7565\u8c03\u6574\u4e3a broadcast hash join\u3002\u4f46\u662f\uff0c\u5f88\u591a\u60c5\u51b5\u90fd\u53ef\u80fd\u5bfc\u81f4\u8fd9\u79cd\u5927\u5c0f\u4f30\u8ba1\u51fa\u9519\uff0c\u6bd4\u5982\u8868\u7684\u7edf\u8ba1\u4fe1\u606f\u4e0d\u51c6\u786e\u7b49\uff08\u4e14\u7edf\u8ba1\u4fe1\u606f\u53ea\u80fd\u652f\u6301Hive\u6216\u8005\u6587\u4ef6\u7cfb\u7edf\uff09\u3002</p> <p>AQE\uff0cSpark \u53ef\u4ee5\u5229\u7528\u8fd0\u884c\u65f6\u7684\u7edf\u8ba1\u4fe1\u606f\u52a8\u6001\u8c03\u6574 Join \u65b9\u5f0f\uff0c\u53ea\u8981\u53c2\u4e0e Join \u7684\u4efb\u4f55\u4e00\u65b9\u7684\u5927\u5c0f\u5c0f\u4e8e\u5e7f\u64ad\u5927\u5c0f\u7684\u9608\u503c\u65f6\uff0c\u5373\u53ef\u5c06 Join \u7b56\u7565\u8c03\u6574\u4e3a broadcast hash join\u3002\u8fdb\u4e00\u6b65\u5c06\u5e38\u89c4\u7684 shuffle \u4f18\u5316\u4e3a\u672c\u5730\u5316 shuffle\u6765\u51cf\u5c11\u7f51\u7edc\u6d41\u91cf\u3002</p> <p>\u53c2\u6570\uff1a</p> <ul> <li> <p><code>spark.sql.adaptive.autoBroadcastJoinThreshold</code>\uff1a\u81ea\u9002\u5e94\u4f18\u5316\u7684Broadcast\u8868\u7684\u9608\u503c\uff0c\u9ed8\u8ba4\u540c<code>spark.sql.autoBroadcastJoinThreshold</code>\uff0c10M\uff1b</p> </li> <li> <p><code>spark.sql.adaptive.localShuffleReader.enabled</code>\uff1asort merge\u8f6c\u4e3abroadcast join\u65f6\uff0c\u662f\u5426\u5f00\u542f\u672c\u5730\u8bfbshuffle\u6570\u636e\uff0c\u9ed8\u8ba4<code>true</code>\uff1b</p> </li> </ul>"},{"location":"distributed_computing/spark/spark_sql/features.html#sort-merge-joins-shuffled-hash-join","title":"\u52a8\u6001\u5c06Sort Merge Joins\u8f6c\u6362\u4e3a Shuffled hash join","text":"<p>AQE converts sort-merge join to shuffled hash join when all post shuffle partitions are smaller than a threshold\u3002</p> <p>\u53c2\u6570</p> <ul> <li><code>spark.sql.adaptive.maxShuffledHashJoinLocalMapThreshold</code>\uff1a\u4f7f\u7528 build local hash map\u7684\u5206\u533a\u6700\u5927\u5927\u5c0f\uff1b</li> </ul>"},{"location":"distributed_computing/spark/spark_sql/features.html#join","title":"\u52a8\u6001\u4f18\u5316\u503e\u659c\u7684 join","text":"<p>AQE \u503e\u659c Join \u4f18\u5316\u4ece shuffle \u6587\u4ef6\u7edf\u8ba1\u4fe1\u606f\u4e2d\u81ea\u52a8\u68c0\u6d4b\u5230\u8fd9\u79cd\u503e\u659c\u3002\u7136\u540e\uff0c\u5b83\u5c06\u503e\u659c\u7684\u5206\u533a\u5206\u5272\u6210\u66f4\u5c0f\u7684\u5b50\u5206\u533a\uff0c\u8fd9\u4e9b\u5b50\u5206\u533a\u5c06\u5206\u522b\u4ece\u53e6\u4e00\u7aef\u8fde\u63a5\u5230\u76f8\u5e94\u7684\u5206\u533a\u3002</p> <p>\u5047\u8bbe\u8868 A join \u8868B\uff0c\u5176\u4e2d\u8868 A \u7684\u5206\u533a A0 \u91cc\u9762\u7684\u6570\u636e\u660e\u663e\u5927\u4e8e\u5176\u4ed6\u5206\u533a\u3002</p> <p></p> <p>\u5c06\u628a\u5206\u533a A0 \u5206\u6210\u4e24\u4e2a\u5b50\u5206\u533a\uff0c\u5e76\u5c06\u6bcf\u4e2a\u5b50\u5206\u533a join \u8868 B \u7684\u76f8\u5e94\u5206\u533a B0\u3002</p> <p></p> <p>\u5982\u679c\u6ca1\u6709\u8fd9\u4e2a\u4f18\u5316\uff0c\u5c06\u6709\u56db\u4e2a\u4efb\u52a1\u8fd0\u884c sort merge join\uff0c\u5176\u4e2d\u4e00\u4e2a\u4efb\u52a1\u5c06\u82b1\u8d39\u975e\u5e38\u957f\u7684\u65f6\u95f4\u3002\u5728\u6b64\u4f18\u5316\u4e4b\u540e\uff0c\u5c06\u67095\u4e2a\u4efb\u52a1\u8fd0\u884c join\uff0c\u4f46\u6bcf\u4e2a\u4efb\u52a1\u5c06\u82b1\u8d39\u5927\u81f4\u76f8\u540c\u7684\u65f6\u95f4\uff0c\u4ece\u800c\u83b7\u5f97\u603b\u4f53\u66f4\u597d\u7684\u6027\u80fd\u3002</p> <p>\u53c2\u6570\uff1a</p> <ul> <li>spark.sql.adaptive.skewJoin.enabled \uff1a\u662f\u5426\u542f\u7528\u503e\u659c Join \u5904\u7406\uff1b</li> <li>spark.sql.adaptive.skewJoin.skewedPartitionFactor\uff1a\u5982\u679c\u4e00\u4e2a\u5206\u533a\u7684\u5927\u5c0f\u5927\u4e8e\u8fd9\u4e2a\u6570\u4e58\u4ee5\u5206\u533a\u5927\u5c0f\u7684\u4e2d\u503c\uff08median partition size\uff09\uff0c\u5e76\u4e14\u4e5f\u5927\u4e8e<code>spark.sql.adaptive.skewedPartitionThresholdInBytes</code> \u8fd9\u4e2a\u5c5e\u6027\u503c\uff0c\u90a3\u4e48\u5c31\u8ba4\u4e3a\u8fd9\u4e2a\u5206\u533a\u662f\u503e\u659c\u7684\u3002</li> <li>spark.sql.adaptive.skewedPartitionThresholdInBytes\uff1a\u5224\u65ad\u5206\u533a\u662f\u5426\u503e\u659c\u7684\u9608\u503c\uff0c\u9ed8\u8ba4\u4e3a 256MB\uff0c\u8fd9\u4e2a\u53c2\u6570\u7684\u503c\u5e94\u8be5\u8981\u8bbe\u7f6e\u7684\u6bd4 spark.sql.adaptive.advisoryPartitionSizeInBytes \u5927\u3002</li> </ul>"},{"location":"distributed_computing/spark/spark_sql/features.html#dynamic-partition-pruning-dpp","title":"\u52a8\u6001\u5206\u533a\u88c1\u51cf\uff08Dynamic Partition Pruning\uff0c\u7b80\u79f0 DPP\uff09","text":"<p>\u5f00\u542f\u4e86\u52a8\u6001\u5206\u533a\u88c1\u51cf\uff0c\u90a3\u4e48 AQE \u5c06\u4e0d\u4f1a\u88ab\u89e6\u53d1\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u5177\u6709\u591a\u4e2a\u5206\u533a\u7684\u4e8b\u5b9e\u8868(fact table)\uff0c\u4e3a\u4e86\u65b9\u4fbf\u8bf4\u660e\uff0c\u6211\u4eec\u7528\u4e0d\u540c\u989c\u8272\u4ee3\u8868\u4e0d\u540c\u7684\u5206\u533a\u3002\u53e6\u5916\uff0c\u6211\u4eec\u8fd8\u6709\u4e00\u4e2a\u6bd4\u8f83\u5c0f\u7684\u7ef4\u5ea6\u8868(dimension table)\uff0c\u7ef4\u5ea6\u8868\u4e0d\u662f\u5206\u533a\u8868\u3002</p> <pre><code>Select * from iteblog.Students join iteblog.DailyRoutine where iteblog.DailyRoutine.subject = 'English'; \n</code></pre> <p>\u5728\u903b\u8f91\u8ba1\u5212\u548c\u7269\u7406\u8ba1\u5212\u4e0a\u90fd\u6709\u5b9e\u73b0\uff1a</p> <ul> <li>\u5728\u903b\u8f91\u8ba1\u5212\u9636\u6bb5\u5c31\u77e5\u9053\u4e8b\u5b9e\u8868\u9700\u8981\u626b\u63cf\u54ea\u4e9b\u5206\u533a\uff1a\u5728\u903b\u8f91\u8ba1\u5212\u5c42\u9762\uff0c\u901a\u8fc7\u7ef4\u5ea6\u8868\u6784\u9020\u51fa\u4e00\u4e2a\u8fc7\u6ee4\u5b50\u67e5\u8be2\uff0c\u7136\u540e\u5728\u626b\u63cf\u4e8b\u5b9e\u8868\u4e4b\u524d\u52a0\u4e0a\u8fd9\u4e2a\u8fc7\u6ee4\u5b50\u67e5\u8be2\u3002\u4f46\u662f\uff0c\u7269\u7406\u8ba1\u5212\u6267\u884c\u8d77\u6765\u8fd8\u662f\u6bd4\u8f83\u4f4e\u6548\u3002\u56e0\u4e3a\u91cc\u9762\u6709\u91cd\u590d\u7684\u5b50\u67e5\u8be2\uff08\u6bcf\u4e2a\u5206\u533a\u90fd\u9700\u8981\u83b7\u53d6\u5b50\u67e5\u8be2\u7684\u7ed3\u679c\uff09\uff0c\u9700\u8981\u627e\u51fa\u4e00\u79cd\u65b9\u6cd5\u6765\u6d88\u9664\u8fd9\u4e2a\u91cd\u590d\u7684\u5b50\u67e5\u8be2\u3002</li> </ul> <p></p> <ul> <li>\u907f\u514d\u626b\u63cf\u65e0\u7528\u7684\u6570\u636e\uff1a\u5728\u7269\u7406\u8ba1\u5212\u5c42\u9762\uff0c\u5728\u7ef4\u5ea6\u8868\u4e0a\u8fd0\u884c\u4e0a\u9762\u6784\u9020\u7684\u8fc7\u6ee4\uff0c\u7136\u540e\u5c06\u7ed3\u679c\u5e7f\u64ad\u5230\u4e8b\u5b9e\u8868\u7aef\uff0c\u4ece\u800c\u8fbe\u5230\u907f\u514d\u626b\u63cf\u65e0\u7528\u7684\u6570\u636e\u6548\u679c\u3002</li> </ul> <p>\u5728 broadcast hash join \u4e2d\u5927\u8868\u8fdb\u884c build relation \u7684\u65f6\u5019\u62ff\u5230\u7ef4\u5ea6\u8868\u7684\u5e7f\u64ad\u7ed3\u679c(broadcast results)\uff0c\u7136\u540e\u5728 build relation \u7684\u65f6\u5019(Scan \u524d)\u8fdb\u884c\u52a8\u6001\u8fc7\u6ee4\uff0c\u4ece\u800c\u8fbe\u5230\u907f\u514d\u626b\u63cf\u65e0\u7528\u7684\u6570\u636e\u6548\u679c\u3002\u5177\u4f53\u5982\u4e0b\uff1a</p> <p></p> <p>\u5982\u679c\u5c06<code>spark.sql.optimizer.dynamicPartitionPruning.reuseBroadcastOnly</code>\u8bbe\u7f6e\u4e3a<code>false</code>\uff0c\u90a3\u4e48 DPP \u4e5f\u53ef\u4ee5\u5728\u5176\u4ed6\u7c7b\u578b\u7684 Join \u4e0a\u8fd0\u884c\uff0c\u6bd4\u5982 <code>SortMergeJoin</code>\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cSpark \u5c06\u4f30\u8ba1 DPP \u8fc7\u6ee4\u5668\u662f\u5426\u786e\u5b9e\u63d0\u9ad8\u4e86\u67e5\u8be2\u6027\u80fd\u3002DPP \u53ef\u4ee5\u6781\u5927\u5730\u63d0\u9ad8\u9ad8\u5ea6\u9009\u62e9\u6027\u67e5\u8be2\u7684\u6027\u80fd\uff0c</p> <p>\u52a8\u6001\u5206\u533a\u88c1\u526a\u9002\u7528\u6761\u4ef6</p> <p>\u5e76\u4e0d\u662f\u4ec0\u4e48\u67e5\u8be2\u90fd\u4f1a\u542f\u7528\u52a8\u6001\u88c1\u526a\u4f18\u5316\u7684\uff0c\u5fc5\u987b\u6ee1\u8db3\u4ee5\u4e0b\u51e0\u4e2a\u6761\u4ef6\uff1a</p> <ul> <li><code>spark.sql.optimizer.dynamicPartitionPruning.enabled</code>\uff1a \u53c2\u6570\u5fc5\u987b\u8bbe\u7f6e\u4e3a true\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u503c\u9ed8\u8ba4\u5c31\u662f\u542f\u7528\u7684;</li> <li>\u9700\u8981\u88c1\u51cf\u7684\u8868\u5fc5\u987b\u662f\u5206\u533a\u8868\uff0c\u800c\u4e14\u5206\u533a\u5b57\u6bb5\u5fc5\u987b\u5728 join \u7684 on \u6761\u4ef6\u91cc\u9762;</li> <li>Join \u7c7b\u578b\u5fc5\u987b\u662f INNER, LEFT SEMI (\u5de6\u8868\u662f\u5206\u533a\u8868), LEFT OUTER (\u53f3\u8868\u662f\u5206\u533a\u8868), or RIGHT OUTER (\u5de6\u8868\u662f\u5206\u533a\u8868)\u3002</li> <li>\u6ee1\u8db3\u4e0a\u9762\u7684\u6761\u4ef6\u4e5f\u4e0d\u4e00\u5b9a\u4f1a\u89e6\u53d1\u52a8\u6001\u5206\u533a\u88c1\u51cf\uff0c\u8fd8\u5fc5\u987b\u6ee1\u8db3 <code>spark.sql.optimizer.dynamicPartitionPruning.useStats</code> \u548c <code>spark.sql.optimizer.dynamicPartitionPruning.fallbackFilterRatio</code> \u4e24\u4e2a\u53c2\u6570\u7efc\u5408\u8bc4\u4f30\u51fa\u4e00\u4e2a\u8fdb\u884c\u52a8\u6001\u5206\u533a\u88c1\u51cf\u662f\u5426\u6709\u76ca\u7684\u503c\uff0c\u6ee1\u8db3\u4e86\u624d\u4f1a\u8fdb\u884c\u52a8\u6001\u5206\u533a\u88c1\u51cf\u3002</li> </ul>"},{"location":"distributed_computing/spark/spark_sql/sql_cli.html","title":"\u5206\u5e03\u5f0fSQL\u5f15\u64ce","text":""},{"location":"distributed_computing/spark/spark_sql/sql_cli.html#thriftjdbcodbc","title":"\u8fd0\u884cThrift\u7684JDBC/ODBC \u670d\u52a1","text":"<pre><code>./sbin/start-thriftserver.sh \\\n  --hiveconf hive.server2.thrift.port=&lt;listening-port&gt; \\\n  --hiveconf hive.server2.thrift.bind.host=&lt;listening-host&gt; \\\n  --master &lt;master-uri&gt;\n  ...\n</code></pre>"},{"location":"distributed_computing/spark/spark_sql/sql_cli.html#spark-sql-cli","title":"\u8fd0\u884cSpark SQL CLI","text":"<p>./bin/spark-sql</p> <p>Spark SQL CLI\u4e0d\u80fd\u548cThrift JDBC\u670d\u52a1\u5668\u8fde\u63a5\u3002</p> <p>\u4ee5\u672c\u5730\u6a21\u5f0f\u8fd0\u884cHive metastore\uff0c\u4ece\u547d\u4ee4\u884c\u6267\u884c\u67e5\u8be2\u8bed\u53e5\u3002</p> <p>Hive\u7684\u914d\u7f6ehive-site.xml\uff0ccore-site.xml\u548chdfs-site.xml\u9700\u8981\u653e\u5230spark\u7684\u914d\u7f6econf\u76ee\u5f55\u3002</p>"},{"location":"distributed_computing/spark/structured_streaming/index.html","title":"Structured Streaming","text":"<p>Structured Streaming provides fast, scalable, fault-tolerant, end-to-end exactly-once stream processing without the user having to reason about streaming.</p>"},{"location":"distributed_computing/spark/structured_streaming/index.html#_1","title":"\u4ecb\u7ecd","text":"<p>\u4e00\u6b21\u6027\u8bed\u4e49\u4fdd\u8bc1\uff1a</p> <ul> <li>checkpoint \u548c write-ahead logs</li> </ul> <p>\u6267\u884c\u5f15\u64ce\uff1a</p> <ul> <li>micro-batch processing\uff08\u9ed8\u8ba4\uff09\uff0c100ms\u7684\u5ef6\u8fdf\uff0cexactly once\u8bed\u4e49\uff1b</li> <li>continous processing\uff0c1ms\u7684\u5ef6\u8fdf\uff0cas-least once\u8bed\u4e49\uff1b</li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/index.html#_2","title":"\u793a\u4f8b","text":"<p>readStream\uff1a\u6d41\u5f0f\u8bfb\u53d6</p> <p>writeStream\uff1a\u6d41\u5f0f\u5199\u51fa</p> <ul> <li>start\uff1a\u542f\u52a8\u6d41\u5f0f\u6570\u636e</li> </ul> <pre><code>import org.apache.spark.sql.functions._\nimport org.apache.spark.sql.SparkSession\n\nval spark = SparkSession\n  .builder\n  .appName(\"StructuredNetworkWordCount\")\n  .getOrCreate()\n\nimport spark.implicits._\n\n// Create DataFrame representing the stream of input lines from connection to localhost:9999\nval lines = spark.readStream\n  .format(\"socket\")\n  .option(\"host\", \"localhost\")\n  .option(\"port\", 9999)\n  .load()\n\n// Split the lines into words\nval words = lines.as[String].flatMap(_.split(\" \"))\n\n// Generate running word count\nval wordCounts = words.groupBy(\"value\").count()\n\n// Start running the query that prints the running counts to the console\nval query = wordCounts.writeStream\n  .outputMode(\"complete\")\n  .format(\"console\")\n  .start()\n\nquery.awaitTermination()\n</code></pre> <p>\u53d1\u9001\u7aef\uff1a</p> <pre><code>$ nc -lk 9999\napache spark\napache hadoop\n</code></pre> <p>\u63a5\u6536\u7aef\uff1a</p> <pre><code>$ ./bin/run-example org.apache.spark.examples.sql.streaming.StructuredNetworkWordCount localhost 9999\n\n-------------------------------------------\nBatch: 0\n-------------------------------------------\n+------+-----+\n| value|count|\n+------+-----+\n|apache|    1|\n| spark|    1|\n+------+-----+\n\n-------------------------------------------\nBatch: 1\n-------------------------------------------\n+------+-----+\n| value|count|\n+------+-----+\n|apache|    2|\n| spark|    1|\n|hadoop|    1|\n+------+-----+\n</code></pre>"},{"location":"distributed_computing/spark/structured_streaming/index.html#_3","title":"\u7f16\u7a0b\u6a21\u578b","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#_4","title":"\u57fa\u672c\u6982\u5ff5","text":"<p>\u6d41\u4e0a\u7684\u65b0\u6570\u636e\u50cf\u8868\u4e0a\u7684\u65b0\u7684\u4e00\u884c\uff1a</p> <p>\u200b   </p> <p>\u5bf9\u8f93\u5165\u7684\u67e5\u8be2\u5c06\u751f\u6210\u201c\u7ed3\u679c\u8868\u201d\u3002\u6bcf\u89e6\u53d1\u4e00\u6b21\uff08\u6bd4\u5982\u8bf4\uff0c\u6bcf1\u79d2\uff09\uff0c\u5c31\u4f1a\u5411\u8f93\u5165\u8868\u8ffd\u52a0\u65b0\u884c\uff0c\u6700\u7ec8\u66f4\u65b0\u7ed3\u679c\u8868\uff1a</p> <p></p> <p>\u8f93\u51fa\u6570\u636e\u7684\u6a21\u5f0f\uff1a</p> <ul> <li><code>\u5b8c\u5168\u6a21\u5f0f</code>\uff1a\u6574\u4e2a\u66f4\u65b0\u540e\u7684\u201c\u7ed3\u679c\u8868\u201d\u5199\u5230\u5916\u90e8\u5b58\u50a8\uff0c\u7531\u5916\u90e8\u5b58\u50a8\u5f15\u64ce\u51b3\u5b9a\u600e\u4e48\u5904\u7406\u5199\u6574\u5f20\u8868\uff1b</li> <li><code>\u8ffd\u52a0\u6a21\u5f0f</code>\uff1a\u4e0a\u6b21\u89e6\u53d1\u5199\u5165\u540e\u7684\u201c\u7ed3\u679c\u8868\u201c\u4e2d\u8ffd\u52a0\u7684\u65b0\u7684\u6570\u636e\u5199\u5230\u5916\u90e8\u5b58\u50a8</li> <li>\u9002\u7528\u4e8e\u201d\u7ed3\u679c\u8868\u201c\u4e2d\u5df2\u7ecf\u5b58\u5728\u7684\u6570\u636e\u4e0d\u4f1a\u66f4\u65b0\u7684\u60c5\u51b5\uff1b</li> <li><code>\u66f4\u65b0\u6a21\u5f0f</code>\uff1a\u4e0a\u6b21\u89e6\u53d1\u5199\u5165\u540e\u7684\u201c\u7ed3\u679c\u8868\u201c\u4e2d\u66f4\u65b0\u7684\u6570\u636e\u5199\u5230\u5916\u90e8\u5b58\u50a8</li> <li>\u5982\u679c\u6ca1\u6709\u805a\u5408\u64cd\u4f5c\uff0c\u7b49\u4ef7\u4e8e<code>\u5b8c\u5168\u6a21\u5f0f</code>\uff1b</li> </ul> <p>\u4ee5<code>WordCount</code>\u4e3a\u4f8b\uff0c\u9610\u660e\u5b8c\u5168\u6a21\u5f0f\u662f\u6570\u636e\u5199\u51fa\u7684\u60c5\u51b5\uff1a</p> <p></p> <p>Note\uff1a</p> <ul> <li>\u7ed3\u6784\u5316\u6d41\u5f0f\u5904\u7406\u4e0d\u4f1a\u5177\u4f53\u5316\u6574\u4e2a\u8868\u3002\u5b83\u4ece\u6d41\u6570\u636e\u6e90\u8bfb\u53d6\u6700\u65b0\u7684\u53ef\u7528\u6570\u636e\uff0c\u589e\u91cf\u5904\u7406\u4ee5\u66f4\u65b0\u7ed3\u679c\uff0c\u7136\u540e\u4e22\u5f03\u6e90\u6570\u636e\u3002</li> <li>\u5b83\u53ea\u4fdd\u7559\u66f4\u65b0\u7ed3\u679c\u6240\u9700\u7684\u6700\u5c0f\u4e2d\u95f4\u72b6\u6001\u6570\u636e\uff08\u4f8b\u5982\uff0c\u524d\u9762\u793a\u4f8b\u4e2d\u7684\u4e2d\u95f4\u8ba1\u6570\uff09\u3002</li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/index.html#_5","title":"\u4e8b\u4ef6\u65f6\u95f4\u548c\u5ef6\u8fdf\u6570\u636e","text":"<ul> <li>\u652f\u6301\u4e8b\u4ef6\u65f6\u95f4\uff0c\u5d4c\u5165\u5230\u6570\u636e\u672c\u8eab\u4e2d\u7684\u65f6\u95f4\uff0c\u4f8b\u5982\u7269\u8054\u7f51\u7b49\u7b49\u5305\u542b\u53d1\u751f\u65f6\u95f4\u7684\u6570\u636e\uff1b</li> <li>watermarking\uff1a\u5904\u7406\u6bd4\u9884\u671f\u665a\u5230\u8fbe\u7684\u6570\u636e\uff1b</li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/index.html#_6","title":"\u5bb9\u9519","text":"<p>\u63d0\u4f9b\u7aef\u5230\u7aef\u7684\u4ec5\u4e00\u6b21\u6027\uff08Exactly Once\uff09\u8bed\u4e49\uff0c\u901a\u8fc7\u8bbe\u8ba1Source\u3001Sink\u548c\u6267\u884c\u5f15\u64ce\uff0c\u53ef\u9760\u5730\u8ddf\u8e2a\u5904\u7406\u7684\u786e\u5207\u8fdb\u5ea6\uff0c\u4ece\u800c\u4f7f\u5176\u80fd\u591f\u901a\u8fc7\u91cd\u65b0\u542f\u52a8\u548c/\u6216\u91cd\u65b0\u5904\u7406\u6765\u5904\u7406\u4efb\u4f55\u7c7b\u578b\u7684\u6545\u969c\u3002</p> <ul> <li>Replayable source\uff1a\u5047\u8bbe\u5177\u6709offsets\uff0c\u5982Kafka\uff0c\u6587\u4ef6\u504f\u79fb\u91cf\u7b49\uff1b</li> <li>Engine\uff1acheckpoint \u548c write-ahead logs\uff0c\u8bb0\u5f55\u6bcf\u6b21\u89e6\u53d1\u65f6\u5904\u7406\u7684\u6570\u636e\u7684\u504f\u79fb\u91cf\uff1b</li> <li>Idempotent sink\uff1a\u5047\u8bbe\u5177\u6709\u5e42\u7b49\u6027\uff0c\u53ef\u4ee5\u591a\u6b21\u5904\u7406\u91cd\u590d\u7684\u6570\u636e\uff1b</li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/index.html#api","title":"API","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#input-source","title":"Input Source","text":"<p>\u5185\u7f6e\u7684\u6570\u636e\u6e90</p> <ul> <li>File\uff1a\u8bfb\u53d6\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c\u4ee5\u6587\u4ef6\u66f4\u6539\u7684\u65f6\u95f4\u4e3a\u987a\u5e8f\uff1a</li> <li>\u652f\u6301\u5bb9\u9519\uff0cReplayable\uff1b</li> <li>\u6587\u4ef6\u683c\u5f0f\uff1atext, CSV, JSON, ORC, Parquet\uff1b</li> <li>\u6587\u4ef6\u7684\u6dfb\u52a0\u9700\u8981\u539f\u5b50\u6027\uff0c\u5982HDFS\u7684mv\u64cd\u4f5c\uff1b</li> <li>Kafka\uff1a\u652f\u6301Kafka 0.10.0 \u4ee5\u4e0a\u7248\u672c</li> <li>\u652f\u6301\u5bb9\u9519\uff0cReplayable\uff1b</li> <li>Socket Source\uff08for testing\uff09\u548c Rate Source\uff08for testing\uff09</li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/index.html#_7","title":"\u7c7b\u578b\u63a8\u5bfc\u548c\u5206\u533a\u6570","text":"<p>\u9ed8\u8ba4\u9700\u8981\u624b\u52a8\u6267\u884cschema\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e<code>spark.sql.streaming.schemaInference</code>\u4e3a<code>true</code>\u81ea\u52a8\u63a8\u5bfc\u3002</p> <p>\u652f\u6301\u5206\u533a\u7684\u6570\u636e\u8bfb\u53d6\uff0c\u5373\u76ee\u5f55\u540d\u4e3a/key=value/\u3002</p>"},{"location":"distributed_computing/spark/structured_streaming/index.html#_8","title":"\u64cd\u4f5c\u7b97\u5b50","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#-","title":"\u57fa\u672c\u64cd\u4f5c-\u9009\u62e9\u3001\u6620\u5c04\u3001\u805a\u5408","text":"<p>DataFrame\u7684\u7b97\u5b50\u64cd\u4f5c</p> <pre><code>case class DeviceData(device: String, deviceType: String, signal: Double, time: DateTime)\n\nval df: DataFrame = ... // streaming DataFrame with IOT device data with schema { device: string, deviceType: string, signal: double, time: string }\nval ds: Dataset[DeviceData] = df.as[DeviceData]    // streaming Dataset with IOT device data\n\n// Select the devices which have signal more than 10\ndf.select(\"device\").where(\"signal &gt; 10\")      // using untyped APIs   \nds.filter(_.signal &gt; 10).map(_.device)         // using typed APIs\n\n// Running count of the number of updates for each device type\ndf.groupBy(\"deviceType\").count()                          // using untyped API\n\n// Running average signal for each device type\nimport org.apache.spark.sql.expressions.scalalang.typed\nds.groupByKey(_.deviceType).agg(typed.avg(_.signal))    // using typed API\n</code></pre> <p>\u6ce8\u518c\u6210\u4e34\u65f6\u8868\uff0c\u4f7f\u7528SQL\u64cd\u4f5c</p> <pre><code>df.createOrReplaceTempView(\"updates\")\nspark.sql(\"select count(*) from updates\")  // returns another streaming DF\n</code></pre>"},{"location":"distributed_computing/spark/structured_streaming/index.html#todo","title":"\u7a97\u53e3\u64cd\u4f5c\uff08TODO\uff09","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#_9","title":"\u5904\u7406\u5ef6\u8fdf\u6570\u636e\u548c\u6c34\u4f4d","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#join","title":"Join\u64cd\u4f5c","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#-join","title":"\u6d41-\u6279join","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#-join_1","title":"\u6d41-\u6d41join","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#inner-joins-with-optional-watermarking","title":"Inner Joins with optional Watermarking","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#outer-joins-with-watermarking","title":"Outer Joins with Watermarking","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#semi-joins-with-watermarking","title":"Semi Joins with Watermarking","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#support-matrix-for-joins-in-streaming-queries","title":"Support matrix for joins in streaming queries","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#todo_1","title":"\u6d41\u53bb\u91cd\uff08TODO\uff09","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#todo_2","title":"\u591a\u6c34\u4f4d\u5904\u7406\u7b56\u7565\uff08TODO\uff09","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#_10","title":"\u4efb\u610f\u7684\u72b6\u6001\u64cd\u4f5c","text":"<p>\u5f88\u591a\u573a\u666f\u9700\u8981\u9664\u4e86\u805a\u5408\u4e4b\u5916\u7684\u72b6\u6001\u64cd\u4f5c\u3002</p> <p><code>mapGroupsWithState</code>\u548c<code>flatMapGroupsWithState</code>\u7b97\u5b50\uff1a</p>"},{"location":"distributed_computing/spark/structured_streaming/index.html#_11","title":"\u4e0d\u652f\u6301\u7684\u64cd\u4f5c","text":"<ul> <li>\u94fe\u5f0f\u805a\u5408\uff1b</li> <li>limit\u548ctake\uff1b</li> <li>distinct\uff1b</li> <li>Sort\u64cd\u4f5c\u53ea\u5141\u8bb8\u5728<code>\u5b8c\u5168\u6a21\u5f0f</code>\u7684\u805a\u5408\u540e\uff1b</li> <li>join\u4e2d\u7684\u76f8\u5173\u9650\u5236\uff1b</li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/index.html#limitation-of-global-watermarktodo","title":"Limitation of global watermark\uff08TODO\uff09","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#_12","title":"\u5f00\u59cb\u6d41\u5f0f\u67e5\u8be2","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#_13","title":"\u8f93\u51fa\u6a21\u5f0f","text":"<ul> <li><code>\u5b8c\u5168\u6a21\u5f0f</code>\uff1a\u6574\u4e2a\u66f4\u65b0\u540e\u7684\u201c\u7ed3\u679c\u8868\u201d\u5199\u5230\u5916\u90e8\u5b58\u50a8\uff0c\u9002\u5408\u805a\u5408\u8868\uff1b</li> <li><code>\u8ffd\u52a0\u6a21\u5f0f</code>\uff1a\u4e0a\u6b21\u89e6\u53d1\u5199\u5165\u540e\u7684\u201c\u7ed3\u679c\u8868\u201c\u4e2d\u8ffd\u52a0\u7684\u65b0\u7684\u6570\u636e\u5199\u5230\u5916\u90e8\u5b58\u50a8</li> <li>\u9002\u7528\u4e8e\u201d\u7ed3\u679c\u8868\u201c\u4e2d\u5df2\u7ecf\u5b58\u5728\u7684\u6570\u636e\u4e0d\u4f1a\u66f4\u65b0\u7684\u60c5\u51b5\uff1b</li> <li><code>\u66f4\u65b0\u6a21\u5f0f</code>\uff1a\u4e0a\u6b21\u89e6\u53d1\u5199\u5165\u540e\u7684\u201c\u7ed3\u679c\u8868\u201c\u4e2d\u66f4\u65b0\u7684\u6570\u636e\u5199\u5230\u5916\u90e8\u5b58\u50a8</li> <li>\u5982\u679c\u6ca1\u6709\u805a\u5408\u64cd\u4f5c\uff0c\u7b49\u4ef7\u4e8e<code>\u5b8c\u5168\u6a21\u5f0f</code>\uff1b</li> </ul> Query Type Supported Output Modes Notes Queries with aggregation Aggregation on event-time with watermark Append, Update, Complete Append mode uses watermark to drop old aggregation state. But the output of a windowed aggregation is delayed the late threshold specified in <code>withWatermark()</code> as by the modes semantics, rows can be added to the Result Table only once after they are finalized (i.e. after watermark is crossed). See the Late Data section for more details.  Update mode uses watermark to drop old aggregation state.  Complete mode does not drop old aggregation state since by definition this mode preserves all data in the Result Table. Other aggregations Complete, Update Since no watermark is defined (only defined in other category), old aggregation state is not dropped.  Append mode is not supported as aggregates can update thus violating the semantics of this mode. Queries with <code>mapGroupsWithState</code> Update Aggregations not allowed in a query with <code>mapGroupsWithState</code>. Queries with <code>flatMapGroupsWithState</code> Append operation mode Append Aggregations are allowed after <code>flatMapGroupsWithState</code>. Update operation mode Update Aggregations not allowed in a query with <code>flatMapGroupsWithState</code>. Queries with <code>joins</code> Append Update and Complete mode not supported yet. See the support matrix in the Join Operations section for more details on what types of joins are supported. Other queries Append, Update Complete mode not supported as it is infeasible to keep all unaggregated data in the Result Table."},{"location":"distributed_computing/spark/structured_streaming/index.html#sink","title":"Sink","text":"<ul> <li>File sink - Stores the output to a directory.</li> <li>Kafka sink - Stores the output to one or more topics in Kafka.</li> <li>Foreach sink - Runs arbitrary computation on the records in the output. See later in the section for more details.</li> <li>Console sink (for debugging) - Prints the output to the console/stdout every time there is a trigger. Both, Append and Complete output modes, are supported. </li> <li>Memory sink (for debugging) - The output is stored in memory as an in-memory table. Both, Append and Complete output modes, are supported. </li> </ul> Sink Supported Output Modes Options Fault-tolerant Notes File Sink Append <code>path</code>: path to the output directory, must be specified. <code>retention</code>: time to live (TTL) for output files. Output files which batches were committed older than TTL will be eventually excluded in metadata log. This means reader queries which read the sink's output directory may not process them. You can provide the value as string format of the time. (like \"12h\", \"7d\", etc.) By default it's disabled.  For file-format-specific options, see the related methods in DataFrameWriter (Scala/Java/Python/R). E.g. for \"parquet\" format options see <code>DataFrameWriter.parquet()</code> Yes (exactly-once) Supports writes to partitioned tables. Partitioning by time may be useful. Kafka Sink Append, Update, Complete See the Kafka Integration Guide Yes (at-least-once) Foreach Sink Append, Update, Complete None Yes (at-least-once) More details in the next section ForeachBatch Sink Append, Update, Complete None Depends on the implementation More details in the next section Console Sink Append, Update, Complete <code>numRows</code>: Number of rows to print every trigger (default: 20) <code>truncate</code>: Whether to truncate the output if too long (default: true) No Memory Sink Append, Complete None No. But in Complete Mode, restarted query will recreate the full table. Table name is the query n"},{"location":"distributed_computing/spark/structured_streaming/index.html#foreachbatch","title":"ForeachBatch","text":"<p>Note:</p> <ul> <li><code>foreachBatch</code>\u9ed8\u8ba4\u53ea\u63d0\u4f9b at-least-once write\u4fdd\u8bc1\uff0c\u4f46\u662f\u53ef\u4ee5\u4f7f\u7528<code>batchId</code>\u4f5c\u4e3a\u8f93\u51fa\u7684\u53bb\u91cd\uff0c\u83b7\u53d6\u4e00\u6b21\u6027\u8bed\u4e49\u3002</li> <li><code>foreachBatch</code> \u4e0d\u80fd\u5728<code>continuous processing</code>\u6a21\u5f0f\uff08\u4f7f\u7528foreach\uff09\u4e0b\u4f7f\u7528\u3002</li> </ul> <pre><code>streamingDF.writeStream.foreachBatch { (batchDF: DataFrame, batchId: Long) =&gt;\n  batchDF.persist()\n  batchDF.write.format(...).save(...)  // location 1\n  batchDF.write.format(...).save(...)  // location 2\n  batchDF.unpersist()\n}\n</code></pre>"},{"location":"distributed_computing/spark/structured_streaming/index.html#foreach","title":"Foreach","text":"<p>Note: Spark does not guarantee same output for (partitionId, epochId), so deduplication cannot be achieved with (partitionId, epochId). </p> <p>\u5b9e\u73b0ForeachWrite\u7c7b</p> <pre><code>streamingDatasetOfString.writeStream.foreach(\n  new ForeachWriter[String] {\n\n    def open(partitionId: Long, version: Long): Boolean = {\n      // Open connection\n    }\n\n    def process(record: String): Unit = {\n      // Write string to connection\n    }\n\n    def close(errorOrNull: Throwable): Unit = {\n      // Close the connection\n    }\n  }\n).start()\n</code></pre> <p>\u542f\u52a8\u6d41\u7a0b\uff1a</p> <ul> <li>For each partition with partition_id:</li> <li>For each batch/epoch of streaming data with epoch_id:<ul> <li>Method open(partitionId, epochId) is called.</li> <li>If open(\u2026) returns true, for each row in the partition and batch/epoch, method process(row) is called.</li> <li>Method close(error) is called with error (if any) seen while processing rows.</li> </ul> </li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/index.html#table-api","title":"\u6d41\u5f0fTable API","text":"<p><code>DataStreamWriter.toTable()</code> \u5c06\u6d41\u5f0f\u7684DataFrame\u5199\u4f5c\u4e3a\u8868\uff1b</p> <p><code>DataStreamReader.table()</code>\u8bfb\u8868\u4f5c\u4e3aDataFrame\u3002</p> <pre><code>val spark: SparkSession = ...\n\n// Create a streaming DataFrame\nval df = spark.readStream\n  .format(\"rate\")\n  .option(\"rowsPerSecond\", 10)\n  .load()\n\n// Write the streaming DataFrame to a table\ndf.writeStream\n  .option(\"checkpointLocation\", \"path/to/checkpoint/dir\")\n  .toTable(\"myTable\")\n\n// Check the table result\nspark.read.table(\"myTable\").show()\n\n// Transform the source dataset and write to a new table\nspark.readStream\n  .table(\"myTable\")\n  .select(\"value\")\n  .writeStream\n  .option(\"checkpointLocation\", \"path/to/checkpoint/dir\")\n  .format(\"parquet\")\n  .toTable(\"newTable\")\n\n// Check the new table result\nspark.read.table(\"newTable\").show()\n</code></pre>"},{"location":"distributed_computing/spark/structured_streaming/index.html#_14","title":"\u89e6\u53d1\u5668","text":"Trigger Type Description unspecified (default) \u9ed8\u8ba4\u662f\u5fae\u6279\u5904\u7406\u6a21\u5f0f\uff0c\u53ea\u8981\u524d\u9762\u5fae\u6279\u5904\u7406\u5b8c\uff0c\u751f\u6210\u65b0\u7684\u5fae\u6279\u6570\u636e\u3002 Fixed interval micro-batches \u5fae\u6279\u6a21\u5f0f\uff1a1. \u5982\u679c\u5728\u95f4\u9694\u65f6\u95f4\u5185\u5904\u7406\u5b8c\u5fae\u6279\u6570\u636e\uff0c\u5219\u7b49\u5f85\u5230\u4e0b\u4e00\u4e2a\u95f4\u9694\u65f6\u95f4\uff0c\u751f\u6210\u5fae\u6279\u6570\u636e\u5e76\u5904\u7406\uff1b2. \u5982\u679c\u95f4\u9694\u65f6\u95f4\u5185\u672a\u5904\u7406\u5b8c\uff0c\u5219\u5728\u524d\u9762\u6570\u636e\u5904\u7406\u5b8c\u540e\uff0c\u7acb\u5373\u4ea7\u751f\u65b0\u7684\u5fae\u6279\u6570\u636e\u5904\u7406\uff0c\u4e0d\u7b49\u5230\u4e0b\u4e00\u4e2a\u95f4\u9694\u65f6\u95f4\uff1b3. \u5982\u679c\u6ca1\u6709\u65b0\u6570\u636e\u53ef\u7528\uff0c\u5219\u4e0d\u4f1a\u542f\u52a8\u5fae\u6279\u5904\u7406\u3002 One-time micro-batch \u67e5\u8be2\u5c06\u53ea\u6267\u884c\u4e00\u4e2a\u5fae\u6279\u5904\u7406\u6765\u5904\u7406\u6240\u6709\u53ef\u7528\u6570\u636e\uff0c\u7136\u540e\u81ea\u884c\u505c\u6b62\u3002\u8fd9\u5728\u5e0c\u671b\u5b9a\u671f\u542f\u52a8\u96c6\u7fa4\u3001\u5904\u7406\u81ea\u4e0a\u4e00\u4e2a\u5468\u671f\u4ee5\u6765\u53ef\u7528\u7684\u6240\u6709\u5185\u5bb9\uff0c\u7136\u540e\u5173\u95ed\u96c6\u7fa4\u7684\u573a\u666f\u4e2d\u975e\u5e38\u6709\u7528\u3002\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5927\u5927\u8282\u7701\u6210\u672c\u3002 Continuous with fixed checkpoint interval (experimental) The query will be executed in the new low-latency, continuous processing mode. <p>\u793a\u4f8b</p> <pre><code>import org.apache.spark.sql.streaming.Trigger\n\n// Default trigger (runs micro-batch as soon as it can)\ndf.writeStream\n  .format(\"console\")\n  .start()\n\n// ProcessingTime trigger with two-seconds micro-batch interval\ndf.writeStream\n  .format(\"console\")\n  .trigger(Trigger.ProcessingTime(\"2 seconds\"))\n  .start()\n\n// One-time trigger\ndf.writeStream\n  .format(\"console\")\n  .trigger(Trigger.Once())\n  .start()\n\n// Continuous trigger with one-second checkpointing interval\ndf.writeStream\n  .format(\"console\")\n  .trigger(Trigger.Continuous(\"1 second\"))\n  .start()\n</code></pre>"},{"location":"distributed_computing/spark/structured_streaming/index.html#_15","title":"\u7ba1\u7406\u6d41\u5f0f\u67e5\u8be2","text":"<p><code>start()</code>\u8fd4\u56de\u7684Query\uff0c\u57fa\u672c\u7684API\uff1a</p> <pre><code>val query = df.writeStream.format(\"console\").start()   // get the query object\n\nquery.id          // get the unique identifier of the running query that persists across restarts from checkpoint data\n\nquery.runId       // get the unique id of this run of the query, which will be generated at every start/restart\n\nquery.name        // get the name of the auto-generated or user-specified name\n\nquery.explain()   // print detailed explanations of the query\n\nquery.stop()      // stop the query\n\nquery.awaitTermination()   // block until query is terminated, with stop() or with error\n\nquery.exception       // the exception if the query has been terminated with error\n\nquery.recentProgress  // an array of the most recent progress updates for this query\n\nquery.lastProgress    // the most recent progress update of this streaming query\n</code></pre> <p>\u53ef\u4ee5\u5728\u4e00\u4e2aSparkSession\u4e2d\u542f\u52a8\u591a\u4e2aquery\uff0c\u67e5\u8be2\u5e76\u53d1\u6267\u884c\uff0c\u5171\u7528\u96c6\u7fa4\u8d44\u6e90</p> <p><code>sparkSession.streams()</code> \u83b7\u53d6 <code>StreamingQueryManager</code></p> <pre><code>val spark: SparkSession = ...\n\nspark.streams.active    // get the list of currently active streaming queries\n\nspark.streams.get(id)   // get a query object by its unique id\n\nspark.streams.awaitAnyTermination()   // block until any one of them terminates\n</code></pre>"},{"location":"distributed_computing/spark/structured_streaming/index.html#todo_3","title":"\u76d1\u63a7\u6d41\u5f0f\u67e5\u8be2\uff08TODO\uff09","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#_16","title":"\u4ea4\u4e92\u5f0f\u8bfb\u53d6\u6307\u6807","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#api_1","title":"\u5f02\u6b65API\u62a5\u544a\u6307\u6807","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#dropwizards","title":"\u4f7f\u7528DropWizards\u6c47\u62a5\u6307\u6807","text":""},{"location":"distributed_computing/spark/structured_streaming/index.html#checkpointing","title":"\u901a\u8fc7checkpointing\u5bb9\u9519","text":"<p>\u5982\u679c\u51fa\u73b0\u6545\u969c\u6216\u6545\u610f\u5173\u95ed\uff0c\u53ef\u4ee5\u6062\u590d\u4ee5\u524d\u67e5\u8be2\u7684\u8fdb\u5ea6\u548c\u72b6\u6001\uff0c\u5e76\u5728\u505c\u6b62\u7684\u4f4d\u7f6e\u7ee7\u7eed\u8bfb\u53d6\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528\u68c0\u67e5\u70b9\u4f4d\u7f6e\u914d\u7f6e\u67e5\u8be2\uff0c\u8be5\u67e5\u8be2\u5c06\u6240\u6709\u8fdb\u5ea6\u4fe1\u606f\uff08\u5373\u6bcf\u4e2a\u89e6\u53d1\u5668\u4e2d\u5904\u7406\u7684\u504f\u79fb\u91cf\u8303\u56f4\uff09\u548c\u6b63\u5728\u8fd0\u884c\u7684\u805a\u5408\uff08\u4f8b\u5982\uff0c\u5feb\u901f\u793a\u4f8b\u4e2d\u7684\u5b57\u6570\uff09\u4fdd\u5b58\u5230\u68c0\u67e5\u70b9\u4f4d\u7f6e\u3002</p> <p>\u6b64\u68c0\u67e5\u70b9\u4f4d\u7f6e\u5fc5\u987b\u662fHDFS\u517c\u5bb9\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u8def\u5f84\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u542f\u52a8\u67e5\u8be2\u65f6\u5728DataStreamWriter\u4e2d\u8bbe\u7f6e\u4e3a\u9009\u9879\u3002</p> <pre><code>aggDF\n  .writeStream\n  .outputMode(\"complete\")\n  .option(\"checkpointLocation\", \"path/to/HDFS/dir\")\n  .format(\"memory\")\n  .start()\n</code></pre> <p>\u8be6\u7ec6\u539f\u7406\u89c1\u5bb9\u9519</p>"},{"location":"distributed_computing/spark/structured_streaming/index.html#todo_4","title":"\u6d41\u5f0f\u67e5\u8be2\u6539\u53d8\u65f6\u7684\u6062\u590d\u8bed\u4e49\uff08TODO\uff09","text":"<p>\u5728\u4ece\u540c\u4e00\u68c0\u67e5\u70b9\u4f4d\u7f6e\u91cd\u65b0\u542f\u52a8\u65f6\uff0c\u5141\u8bb8\u5728\u6d41\u67e5\u8be2\u4e2d\u8fdb\u884c\u54ea\u4e9b\u66f4\u6539\u5b58\u5728\u9650\u5236\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u4e0d\u5141\u8bb8\u7684\u66f4\u6539\uff0c\u6216\u8005\u66f4\u6539\u7684\u6548\u679c\u6ca1\u6709\u5f97\u5230\u5f88\u597d\u7684\u5b9a\u4e49\uff1a</p>"},{"location":"distributed_computing/spark/structured_streaming/index.html#continuous-processing-experimental","title":"Continuous Processing [Experimental]","text":"<p>\u53ea\u80fd\u63d0\u4f9b at-least-once \u8bed\u4e49\u3002</p>"},{"location":"distributed_computing/spark/structured_streaming/index.html#_17","title":"\u539f\u7406","text":"<p>\u5982\u4e0b\u56fe\u6240\u793a\uff1a<code>epoch</code> \u662f <code>input</code> \u4e2d\u6570\u636e\u88ab\u53d1\u9001\u7ed9 <code>operator</code> \u5904\u7406\u7684\u6700\u5c0f\u5355\u4f4d\uff0c\u5728\u5904\u7406\u8fc7\u7a0b\u4e2d\uff0c<code>epoch</code> \u7684 <code>offset</code> \u4f1a\u88ab\u8bb0\u5f55\u5230 <code>wal</code> \u4e2d\u3002\u53e6\u5916 <code>continuous</code> \u6a21\u5f0f\u4e0b\u7684 <code>snapshot</code> \u5b58\u50a8\u4f7f\u7528\u7684\u4e00\u81f4\u6027\u7b97\u6cd5\u662f <code>Chandy-Lamport</code> \u7b97\u6cd5\u3002</p> <p></p>"},{"location":"distributed_computing/spark/structured_streaming/index.html#_18","title":"\u8ddf\u5fae\u6279\u6a21\u5f0f\u7684\u5bf9\u6bd4","text":"<p>\u4e0e micro-batch \u6a21\u5f0f\u7f3a\u70b9\u548c\u4f18\u70b9\u90fd\u5f88\u660e\u663e\u3002</p> <ul> <li>\u7f3a\u70b9\u662f\u4e0d\u5bb9\u6613\u505a\u6269\u5c55</li> <li>\u4f18\u70b9\u662f\u5ef6\u8fdf\u66f4\u4f4e</li> </ul> <p></p> <p></p>"},{"location":"distributed_computing/spark/structured_streaming/index.html#todo_5","title":"\u989d\u5916\u4fe1\u606f\uff08TODO\uff09","text":""},{"location":"distributed_computing/spark/structured_streaming/implementation.html","title":"Structured Streaming \u5b9e\u73b0\u601d\u8def\u4e0e\u5b9e\u73b0\u6982\u8ff0","text":""},{"location":"distributed_computing/spark/structured_streaming/implementation.html#_1","title":"\u6267\u884c","text":""},{"location":"distributed_computing/spark/structured_streaming/implementation.html#streamexecution","title":"StreamExecution\uff1a\u6301\u7eed\u67e5\u8be2\u7684\u8fd0\u8f6c\u5f15\u64ce","text":"<p>\u5148\u5b9a\u4e49\u597d Dataset/DataFrame \u7684\u4ea7\u751f\u3001\u53d8\u6362\u548c\u5199\u51fa\uff0c\u518d\u542f\u52a8 <code>StreamExection</code> \u53bb\u6301\u7eed\u67e5\u8be2\u3002\u8fd9\u4e9b Dataset/DataFrame \u7684\u4ea7\u751f\u3001\u53d8\u6362\u548c\u5199\u51fa\u7684\u4fe1\u606f\u5c31\u5bf9\u5e94\u4fdd\u5b58\u5728 <code>StreamExecution</code> \u975e\u5e38\u91cd\u8981\u7684 3 \u4e2a\u6210\u5458\u53d8\u91cf\u4e2d\uff1a</p> <ul> <li><code>sources</code>: streaming data \u7684\u4ea7\u751f\u7aef\uff08\u6bd4\u5982 kafka \u7b49\uff09</li> <li><code>logicalPlan</code>: DataFrame/Dataset \u7684\u4e00\u7cfb\u5217\u53d8\u6362\uff08\u5373\u8ba1\u7b97\u903b\u8f91\uff09</li> <li><code>sink</code>: \u6700\u7ec8\u7ed3\u679c\u5199\u51fa\u7684\u63a5\u6536\u7aef\uff08\u6bd4\u5982 file system \u7b49\uff09</li> </ul> <p>StreamExection \u53e6\u5916\u7684\u91cd\u8981\u6210\u5458\u53d8\u91cf\u662f\uff1a</p> <ul> <li><code>currentBatchId</code>: \u5f53\u524d\u6267\u884c\u7684 id</li> <li><code>batchCommitLog</code>: \u5df2\u7ecf\u6210\u529f\u5904\u7406\u8fc7\u7684\u6279\u6b21\u6709\u54ea\u4e9b</li> <li><code>offsetLog</code>, <code>availableOffsets</code>, <code>committedOffsets</code>: \u5f53\u524d\u6267\u884c\u9700\u8981\u5904\u7406\u7684 source data \u7684 meta \u4fe1\u606f</li> <li><code>offsetSeqMetadata</code>: \u5f53\u524d\u6267\u884c\u7684 watermark \u4fe1\u606f\uff08event time \u76f8\u5173\uff0c\u672c\u6587\u6682\u4e0d\u6d89\u53ca\u3001\u53e6\u6587\u89e3\u6790\uff09\u7b49</li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/implementation.html#streamexecution_1","title":"StreamExecution \u7684\u6301\u7eed\u67e5\u8be2","text":"<p>\u4e00\u6b21\u6267\u884c\u7684\u8fc7\u7a0b\u5982\u4e0a\u56fe\uff1b\u8fd9\u91cc\u6709 6 \u4e2a\u5173\u952e\u6b65\u9aa4\uff1a</p> <ol> <li>StreamExecution \u901a\u8fc7 Source.getOffset() \u83b7\u53d6\u6700\u65b0\u7684 offsets\uff0c\u5373\u6700\u65b0\u7684\u6570\u636e\u8fdb\u5ea6\uff1b</li> <li>StreamExecution \u5c06 offsets \u7b49\u5199\u5165\u5230 offsetLog \u91cc</li> <li>\u8fd9\u91cc\u7684 offsetLog \u662f\u4e00\u4e2a\u6301\u4e45\u5316\u7684 WAL (Write-Ahead-Log)\uff0c\u662f\u5c06\u6765\u53ef\u7528\u4f5c\u6545\u969c\u6062\u590d\u7528</li> <li>StreamExecution \u6784\u9020\u672c\u6b21\u6267\u884c\u7684 LogicalPlan</li> <li>(3a) \u5c06\u9884\u5148\u5b9a\u4e49\u597d\u7684\u903b\u8f91\uff08\u5373 StreamExecution \u91cc\u7684 logicalPlan \u6210\u5458\u53d8\u91cf\uff09\u5236\u4f5c\u4e00\u4e2a\u526f\u672c\u51fa\u6765</li> <li>(3b) \u7ed9\u5b9a\u521a\u521a\u53d6\u5230\u7684 offsets\uff0c\u901a\u8fc7 Source.getBatch(offsets) \u83b7\u53d6\u672c\u6267\u884c\u65b0\u6536\u5230\u7684\u6570\u636e\u7684 Dataset/DataFrame \u8868\u793a\uff0c\u5e76\u66ff\u6362\u5230 (3a) \u4e2d\u7684\u526f\u672c\u91cc</li> <li>\u7ecf\u8fc7 (3a), (3b) \u4e24\u6b65\uff0c\u6784\u9020\u5b8c\u6210\u7684 LogicalPlan \u5c31\u662f\u9488\u5bf9\u672c\u6267\u884c\u65b0\u6536\u5230\u7684\u6570\u636e\u7684 Dataset/DataFrame \u53d8\u6362\uff08\u5373\u6574\u4e2a\u5904\u7406\u903b\u8f91\uff09\u4e86</li> <li>\u89e6\u53d1\u5bf9\u672c\u6b21\u6267\u884c\u7684 LogicalPlan \u7684\u4f18\u5316\uff0c\u5f97\u5230 IncrementalExecution</li> <li>\u903b\u8f91\u8ba1\u5212\u7684\u4f18\u5316\uff1a\u901a\u8fc7 Catalyst \u4f18\u5316\u5668\u5b8c\u6210</li> <li>\u7269\u7406\u8ba1\u5212\u7684\u751f\u6210\u4e0e\u9009\u62e9\uff1a\u7ed3\u679c\u662f\u53ef\u4ee5\u76f4\u63a5\u7528\u4e8e\u6267\u884c\u7684 RDD DAG</li> <li>\u903b\u8f91\u8ba1\u5212\u3001\u4f18\u5316\u7684\u903b\u8f91\u8ba1\u5212\u3001\u7269\u7406\u8ba1\u5212\u3001\u53ca\u6700\u540e\u7ed3\u679c RDD DAG\uff0c\u5408\u5e76\u8d77\u6765\u5c31\u662f IncrementalExecution</li> <li>\u5c06\u8868\u793a\u8ba1\u7b97\u7ed3\u679c\u7684 Dataset/DataFrame (\u5305\u542b IncrementalExecution) \u4ea4\u7ed9 Sink\uff0c\u5373\u8c03\u7528 Sink.add(ds/df)</li> <li>\u8ba1\u7b97\u5b8c\u6210\u540e\u7684 commit</li> <li>(6a) \u901a\u8fc7 Source.commit() \u544a\u77e5 Source \u6570\u636e\u5df2\u7ecf\u5b8c\u6574\u5904\u7406\u7ed3\u675f\uff1bSource \u53ef\u6309\u9700\u5b8c\u6210\u6570\u636e\u7684 garbage-collection</li> <li>(6b) \u5c06\u672c\u6b21\u6267\u884c\u7684\u6279\u6b21 id \u5199\u5165\u5230 batchCommitLog \u91cc</li> </ol>"},{"location":"distributed_computing/spark/structured_streaming/implementation.html#streamexecution_2","title":"StreamExecution \u7684\u6301\u7eed\u67e5\u8be2\uff08\u589e\u91cf\uff09","text":"<p>Structured Streaming \u5728\u7f16\u7a0b\u6a21\u578b\u4e0a\u66b4\u9732\u7ed9\u7528\u6237\u7684\u662f\uff0c\u6bcf\u6b21\u6301\u7eed\u67e5\u8be2\u770b\u505a\u9762\u5bf9\u5168\u91cf\u6570\u636e\uff08\u800c\u4e0d\u4ec5\u4ec5\u662f\u672c\u6b21\u6267\u884c\u6536\u5230\u7684\u6570\u636e\uff09\uff0c\u6240\u4ee5\u6bcf\u6b21\u6267\u884c\u7684\u7ed3\u679c\u662f\u9488\u5bf9\u5168\u91cf\u6570\u636e\u8fdb\u884c\u8ba1\u7b97\u7684\u7ed3\u679c\u3002</p> <p>\u4f46\u662f\u5728\u5b9e\u9645\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u7531\u4e8e\u5168\u91cf\u6570\u636e\u4f1a\u8d8a\u6512\u8d8a\u591a\uff0c\u90a3\u4e48\u6bcf\u6b21\u5bf9\u5168\u91cf\u6570\u636e\u8fdb\u884c\u8ba1\u7b97\u7684\u4ee3\u4ef7\u548c\u6d88\u8017\u4f1a\u8d8a\u6765\u8d8a\u5927\u3002</p> <p>Structured Streaming \u7684\u505a\u6cd5\u662f\uff1a</p> <ul> <li>\u5f15\u5165\u5168\u5c40\u8303\u56f4\u3001\u9ad8\u53ef\u7528\u7684 StateStore</li> <li>\u8f6c\u5168\u91cf\u4e3a\u589e\u91cf\uff0c\u5373\u5728\u6bcf\u6b21\u6267\u884c\u65f6\uff1a</li> <li>\u5148\u4ece StateStore \u91cc restore \u51fa\u4e0a\u6b21\u6267\u884c\u540e\u7684\u72b6\u6001</li> <li>\u7136\u540e\u52a0\u5165\u672c\u6267\u884c\u7684\u65b0\u6570\u636e\uff0c\u518d\u8fdb\u884c\u8ba1\u7b97</li> <li>\u5982\u679c\u6709\u72b6\u6001\u6539\u53d8\uff0c\u5c06\u628a\u6539\u53d8\u7684\u72b6\u6001\u91cd\u65b0 save \u5230 StateStore \u91cc</li> <li>\u4e3a\u4e86\u5728 Dataset/DataFrame \u6846\u67b6\u91cc\u5b8c\u6210\u5bf9 StateStore \u7684 restore \u548c save \u64cd\u4f5c\uff0c\u5f15\u5165\u4e24\u4e2a\u65b0\u7684\u7269\u7406\u8ba1\u5212\u8282\u70b9 \u2014\u2014 <code>StateStoreRestoreExec</code> \u548c <code>StateStoreSaveExec</code></li> </ul> <p>\u6240\u4ee5 Structured Streaming \u5728\u7f16\u7a0b\u6a21\u578b\u4e0a\u66b4\u9732\u7ed9\u7528\u6237\u7684\u662f\uff0c\u6bcf\u6b21\u6301\u7eed\u67e5\u8be2\u770b\u505a\u9762\u5bf9\u5168\u91cf\u6570\u636e\uff0c\u4f46\u5728\u5177\u4f53\u5b9e\u73b0\u4e0a\u8f6c\u6362\u4e3a\u589e\u91cf\u7684\u6301\u7eed\u67e5\u8be2\u3002</p>"},{"location":"distributed_computing/spark/structured_streaming/implementation.html#_2","title":"\u5bb9\u9519","text":"<p>\u7531\u4e8e exectutor \u8282\u70b9\u7684\u6545\u969c\u53ef\u7531 Spark \u6846\u67b6\u672c\u8eab\u5f88\u597d\u7684 handle\uff0c\u4e0d\u5f15\u8d77\u53ef\u7528\u6027\u95ee\u9898\uff0c\u6211\u4eec\u672c\u8282\u7684\u6545\u969c\u6062\u590d\u53ea\u8ba8\u8bba driver \u6545\u969c\u6062\u590d\u3002</p> <p>\u5982\u679c\u5728\u67d0\u4e2a\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f driver \u6545\u969c\uff0c\u90a3\u4e48\u91cd\u65b0\u8d77\u6765\u7684 StreamExecution\uff1a</p> <ul> <li>\u8bfb\u53d6 WAL offsetlog \u6062\u590d\u51fa\u6700\u65b0\u7684 offsets \u7b49\uff1b\u76f8\u5f53\u4e8e\u53d6\u4ee3\u6b63\u5e38\u6d41\u7a0b\u91cc\u7684 (1)(2) \u6b65</li> <li>\u8bfb\u53d6 batchCommitLog \u51b3\u5b9a\u662f\u5426\u9700\u8981\u91cd\u505a\u6700\u8fd1\u4e00\u4e2a\u6279\u6b21</li> <li>\u5982\u679c\u9700\u8981\uff0c\u90a3\u4e48\u91cd\u505a (3a), (3b), (4), (5), (6a), (6b) \u6b65</li> <li>\u8fd9\u91cc\u7b2c (5) \u6b65\u9700\u8981\u5206\u4e24\u79cd\u60c5\u51b5\u8ba8\u8bba<ul> <li>(i) \u5982\u679c\u4e0a\u6b21\u6267\u884c\u5728 (5) \u7ed3\u675f\u524d\u5373\u5931\u6548\uff0c\u90a3\u4e48\u672c\u6b21\u6267\u884c\u91cc sink \u5e94\u8be5\u5b8c\u6574\u5199\u51fa\u8ba1\u7b97\u7ed3\u679c</li> <li>(ii) \u5982\u679c\u4e0a\u6b21\u6267\u884c\u5728 (5) \u7ed3\u675f\u540e\u624d\u5931\u6548\uff0c\u90a3\u4e48\u672c\u6b21\u6267\u884c\u91cc sink \u53ef\u4ee5\u91cd\u65b0\u5199\u51fa\u8ba1\u7b97\u7ed3\u679c\uff08\u8986\u76d6\u4e0a\u6b21\u7ed3\u679c\uff09\uff0c\u4e5f\u53ef\u4ee5\u8df3\u8fc7\u5199\u51fa\u8ba1\u7b97\u7ed3\u679c\uff08\u56e0\u4e3a\u4e0a\u6b21\u6267\u884c\u5df2\u7ecf\u5b8c\u6574\u5199\u51fa\u8fc7\u8ba1\u7b97\u7ed3\u679c\u4e86\uff09</li> </ul> </li> </ul> <p>\u8fd9\u6837\u5373\u53ef\u4fdd\u8bc1\u6bcf\u6b21\u6267\u884c\u7684\u8ba1\u7b97\u7ed3\u679c\uff0c\u5728 sink \u8fd9\u4e2a\u5c42\u9762\uff0c\u662f \u4e0d\u91cd\u4e0d\u4e22 \u7684 \u2014\u2014 \u5373\u4f7f\u4e2d\u95f4\u53d1\u751f\u8fc7 1 \u6b21\u6216\u4ee5\u4e0a\u7684\u5931\u6548\u548c\u6062\u590d\u3002</p>"},{"location":"distributed_computing/spark/structured_streaming/implementation.html#_3","title":"\u72b6\u6001\u5b58\u50a8","text":"<p>\u5728 Structured Streaming \u91cc\uff0cStateStore \u6a21\u5757\u63d0\u4f9b\u4e86 \u5206\u7247\u7684\u3001\u5206\u7248\u672c\u7684\u3001\u53ef\u8fc1\u79fb\u7684\u3001\u9ad8\u53ef\u7528  key-value store\u3002</p> <p>\u57fa\u4e8e\u8fd9\u4e2a StateStore \u6a21\u5757\uff0cStreamExecution \u5b9e\u73b0\u4e86 \u589e\u91cf\u7684 \u6301\u7eed\u67e5\u8be2\u3001\u548c\u5f88\u597d\u7684\u6545\u969c\u6062\u590d\u4ee5\u7ef4\u62a4 end-to-end exactly-once guarantees\u3002</p>"},{"location":"distributed_computing/spark/structured_streaming/implementation.html#_4","title":"\u603b\u4f53\u601d\u8def","text":"<ul> <li>\u5206\u5e03\u5f0f\u5b9e\u73b0</li> <li>\u8dd1\u5728\u73b0\u6709 Spark \u7684 driver-executors \u67b6\u6784\u4e0a\uff1b</li> <li>driver \u7aef\u662f\u8f7b\u91cf\u7ea7\u7684 coordinator\uff0c\u53ea\u505a\u534f\u8c03\u5de5\u4f5c\uff1b</li> <li>executor \u7aef\u8d1f\u8d23\u72b6\u6001\u7684\u5b9e\u9645\u5206\u7247\u7684\u8bfb\u5199\uff1b</li> <li>\u72b6\u6001\u5206\u7247</li> <li>\u4ee5 <code>operatorId</code>+<code>partitionId</code> \u4e3a\u5207\u5206\u4f9d\u636e\uff1a\u4e00\u4e2a\u5e94\u7528\u91cc\u53ef\u80fd\u4f1a\u5305\u542b\u591a\u4e2a\u9700\u8981\u72b6\u6001\u7684 operator\uff0c\u800c\u4e14 operator \u672c\u8eab\u4e5f\u662f\u5206 partition \u6267\u884c\uff1b</li> <li>\u4ee5\u5206\u7247\u4e3a\u57fa\u672c\u5355\u4f4d\u8fdb\u884c\u72b6\u6001\u7684\u8bfb\u5165\u548c\u5199\u51fa\uff1b</li> <li> <p>\u6bcf\u4e2a\u5206\u7247\u91cc\u662f\u4e00\u4e2a key-value \u7684 store\uff0ckey \u548c value \u7684\u7c7b\u578b\u90fd\u662f <code>UnsafeRow</code>\uff0c\u53ef\u4ee5\u6309 key \u67e5\u8be2\u6216\u66f4\u65b0\u3002</p> </li> <li> <p>\u72b6\u6001\u5206\u7248\u672c</p> </li> <li>\u56e0\u4e3a StreamExection \u4f1a\u6301\u7eed\u4e0d\u65ad\u5730\u6267\u884c\u6279\u6b21\uff0c\u56e0\u800c\u540c\u4e00\u4e2a operator \u540c\u4e00\u4e2a partition \u7684\u72b6\u6001\u4e5f\u662f\u968f\u7740\u65f6\u95f4\u4e0d\u65ad\u66f4\u65b0\u3001\u4ea7\u751f\u65b0\u7248\u672c\u7684\u6570\u636e\uff1b</li> <li>\u72b6\u6001\u7684\u7248\u672c\u662f\u4e0e StreamExecution \u7684\u8fdb\u5c55\u4e00\u81f4\uff0c\u6bd4\u5982 StreamExection \u7684\u6279\u6b21 id = 7 \u5b8c\u6210\u65f6\uff0c\u90a3\u4e48\u6240\u6709 version = 7 \u7684\u72b6\u6001\u5373\u5df2\u7ecf\u6301\u4e45\u5316\u3002</li> <li>\u6279\u91cf\u8bfb\u5165\u548c\u5199\u51fa\u5206\u7247</li> <li>\u5bf9\u4e8e\u6bcf\u4e2a\u5206\u7247\uff0c\u8bfb\u5165\u65f6<ul> <li>\u6839\u636e operator + partition + version\uff0c \u4ece HDFS \u8bfb\u5165\u6570\u636e\uff0c\u5e76\u7f13\u5b58\u5728\u5185\u5b58\u91cc</li> </ul> </li> <li>\u5bf9\u4e8e\u6bcf\u4e2a\u5206\u7247\uff0c\u5199\u51fa\u65f6<ul> <li>\u7d2f\u8ba1\u5f53\u524d\u7248\u672c\uff08\u5373 StreamExecution \u7684\u5f53\u524d\u6279\u6b21\uff09\u7684\u591a\u884c\u7684\u72b6\u6001\u4fee\u6539\uff0c\u4e00\u6b21\u6027\u5199\u51fa\u5230 HDFS \u4e00\u4e2a\u4fee\u6539\u7684\u6d41\u6c34 log\uff0c\u6d41\u6c34 log \u5199\u5b8c\u5373\u6807\u5fd7\u672c\u6279\u6b21\u7684\u72b6\u6001\u4fee\u6539\u5b8c\u6210</li> <li>\u540c\u65f6\u5e94\u7528\u4fee\u6539\u5230\u5185\u5b58\u4e2d\u7684\u72b6\u6001\u7f13\u5b58</li> </ul> </li> </ul> <p>\u5173\u4e8e StateStore \u7684 operator, partiton, version \u6709\u4e00\u4e2a\u56fe\u7247\u53ef\u5e2e\u52a9\u7406\u89e3\uff1a</p> <p></p>"},{"location":"distributed_computing/spark/structured_streaming/implementation.html#a-statestore","title":"(a) StateStore \u5728\u4e0d\u540c\u7684\u8282\u70b9\u4e4b\u95f4\u5982\u4f55\u8fc1\u79fb","text":"<p>\u5728 StreamExecution \u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u968f\u65f6\u5728 operator \u5b9e\u9645\u6267\u884c\u7684 executor \u8282\u70b9\u4e0a\u5524\u8d77\u4e00\u4e2a\u72b6\u6001\u5b58\u50a8\u5206\u7247\u3001\u5e76\u8bfb\u5165\u524d\u4e00\u4e2a\u7248\u672c\u7684\u6570\u636e\u5373\u53ef\uff08\u5982\u679c executor \u4e0a\u5df2\u7ecf\u5b58\u5728\u4e00\u4e2a\u5206\u7247\uff0c\u90a3\u4e48\u5c31\u76f4\u63a5\u91cd\u7528\uff0c\u4e0d\u7528\u5524\u8d77\u5206\u7247\u3001\u4e5f\u4e0d\u7528\u8bfb\u5165\u6570\u636e\u4e86\uff09\u3002</p> <p></p> <p>\u6211\u4eec\u4e0a\u8282\u8bb2\u8fc7\uff0c\u6301\u4e45\u5316\u7684\u72b6\u6001\u662f\u5728 HDFS \u4e0a\u7684\u3002\u90a3\u4e48\u5982\u4e0a\u56fe\u6240\u793a\uff1a</p> <ul> <li><code>executor a</code>, \u5524\u8d77\u4e86 <code>operator = 1, partition = 1</code> \u7684\u72b6\u6001\u5b58\u50a8\u5206\u7247\uff0c\u4ece HDFS \u91cc\u4f4d\u4e8e\u672c\u673a\u7684\u6570\u636e\u526f\u672c load \u8fdb\u6765 <code>version = 5</code> \u7684\u6570\u636e\uff1b</li> <li>\u4e00\u4e2a executor \u8282\u70b9\u53ef\u4ee5\u6267\u884c\u591a\u4e2a operator\uff0c\u90a3\u4e48\u4e5f\u5c31\u53ef\u4ee5\u5728\u4e00\u4e2a executor \u4e0a\u5524\u8d77\u591a\u4e2a\u72b6\u6001\u5b58\u50a8\u5206\u7247\uff08\u5206\u522b\u5bf9\u5e94\u4e0d\u540c\u7684 operator + partition\uff09\uff0c\u5982\u56fe\u793a <code>executor b</code>\uff1b</li> <li>\u5728\u4e00\u4e9b\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u4ece\u5176\u4ed6\u8282\u70b9\u7684 HDFS \u6570\u636e\u526f\u672c\u4e0a load \u72b6\u6001\u6570\u636e\uff0c\u5982\u56fe\u4e2d <code>executor c</code> \u9700\u8981\u4ece <code>executor b</code> \u7684\u786c\u76d8\u4e0a load \u6570\u636e\uff1b</li> <li>\u53e6\u5916\u8fd8\u6709\u7684\u60c5\u51b5\u662f\uff0c\u540c\u4e00\u4efd\u6570\u636e\u88ab\u540c\u65f6 load \u5230\u4e0d\u540c\u7684 executor \u4e0a\uff0c\u5982 <code>executor d</code> \u548c <code>executor a</code> \u5373\u662f\u8bfb\u5165\u4e86\u540c\u4e00\u4efd\u6570\u636e \u2014\u2014 \u63a8\u6d4b\u6267\u884c\u65f6\u5c31\u5bb9\u6613\u4ea7\u751f\u8fd9\u79cd\u60c5\u51b5 \u2014\u2014 \u8fd9\u65f6\u4e5f\u4e0d\u4f1a\u4ea7\u751f\u95ee\u9898\uff0c\u56e0\u4e3a load \u8fdb\u6765\u7684\u662f\u540c\u4e00\u4efd\u6570\u636e\uff0c\u7136\u540e\u5728\u4e24\u4e2a\u8282\u70b9\u4e0a\u5404\u81ea\u4fee\u6539\uff0c\u6700\u7ec8\u53ea\u4f1a\u6709\u4e00\u4e2a\u8282\u70b9\u80fd\u591f\u6210\u529f\u63d0\u4ea4\u5bf9\u72b6\u6001\u7684\u4fee\u6539\u3002</li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/implementation.html#b-statestore","title":"(b) StateStore \u7684\u66f4\u65b0\u548c\u67e5\u8be2","text":"<p>\u5728\u4e00\u4e2a\u72b6\u6001\u5b58\u50a8\u5206\u7247\u91cc\uff0c\u662f key-value \u7684 store\u3002\u8fd9\u4e2a key-value \u7684 store \u652f\u6301\u5982\u4e0b\u64cd\u4f5c\uff1a</p> <pre><code>  /* == CRUD \u589e\u5220\u6539\u67e5 =============================== */\n\n  // \u67e5\u8be2\u4e00\u6761 key-value\n  def get(key: UnsafeRow): Option[UnsafeRow]\n\n  // \u65b0\u589e\u3001\u6216\u4fee\u6539\u4e00\u6761 key-value\n  def put(key: UnsafeRow, value: UnsafeRow): Unit\n\n  // \u5220\u9664\u4e00\u6761\u7b26\u5408\u6761\u4ef6\u7684 key-value\n  def remove(condition: UnsafeRow =&gt; Boolean): Unit\n  // \u6839\u636e key \u5220\u9664 key-value\n  def remove(key: UnsafeRow): Unit\n\n  /* == \u6279\u91cf\u64cd\u4f5c\u76f8\u5173 =============================== */\n\n  // \u63d0\u4ea4\u5f53\u524d\u6267\u884c\u6279\u6b21\u7684\u6240\u6709\u4fee\u6539\uff0c\u5c06\u5237\u51fa\u5230 HDFS\uff0c\u6210\u529f\u540e\u7248\u672c\u5c06\u81ea\u589e\n  def commit(): Long\n\n  // \u653e\u5f03\u5f53\u524d\u6267\u884c\u6279\u6b21\u7684\u6240\u6709\u4fee\u6539\n  def abort(): Unit\n\n  // \u5f53\u524d\u72b6\u6001\u5206\u7247\u3001\u5f53\u524d\u7248\u672c\u7684\u6240\u6709 key-value \u72b6\u6001\n  def iterator(): Iterator[(UnsafeRow, UnsafeRow)]\n\n  // \u5f53\u524d\u72b6\u6001\u5206\u7247\u3001\u5f53\u524d\u7248\u672c\u6bd4\u4e0a\u4e00\u4e2a\u7248\u672c\u7684\u6240\u6709\u589e\u91cf\u66f4\u65b0\n  def updates(): Iterator[StoreUpdate]\n</code></pre> <p>\u4f7f\u7528 StateStore \u7684\u4ee3\u7801\u53ef\u4ee5\u8fd9\u6837\u5199\uff08\u73b0\u5728\u90fd\u662f Structured Streaming \u5185\u90e8\u5b9e\u73b0\u5728\u4f7f\u7528 StateStore\uff0c\u4e0a\u5c42\u7528\u6237\u65e0\u9700\u9762\u5bf9\u8fd9\u4e9b\u7ec6\u8282\uff09\uff1a</p> <pre><code>  // \u5728\u6700\u5f00\u59cb\uff0c\u83b7\u53d6\u6b63\u786e\u7684\u72b6\u6001\u5206\u7247(\u6309\u9700\u91cd\u7528\u5df2\u6709\u5206\u7247\u6216\u8bfb\u5165\u65b0\u7684\u5206\u7247)\n  val store = StateStore.get(StateStoreId(checkpointLocation, operatorId, partitionId), ..., version, ...)\n\n  // \u5f00\u59cb\u8fdb\u884c\u4e00\u4e9b\u66f4\u6539\n  store.put(...)\n  store.remove(...)\n\n  // \u66f4\u6539\u5b8c\u6210\uff0c\u6279\u91cf\u63d0\u4ea4\u7f13\u5b58\u5728\u5185\u5b58\u91cc\u7684\u66f4\u6539\u5230 HDFS\n  store.commit()\n\n  // \u67e5\u770b\u5f53\u524d\u72b6\u6001\u5206\u7247\u7684\u6240\u6709 key-value / \u521a\u521a\u66f4\u65b0\u4e86\u7684 key-value\n  store.iterator()\n  store.updates()\n</code></pre>"},{"location":"distributed_computing/spark/structured_streaming/implementation.html#c-statestore","title":"(c) StateStore \u7684\u7ef4\u62a4","text":"<p>\u524d\u9762 StateStore \u5728\u5199\u51fa\u72b6\u6001\u7684\u66f4\u65b0\u65f6\uff0c\u662f\u5199\u51fa\u7684\u4fee\u6539\u6d41\u6c34 log\u3002</p> <p>StateStore \u672c\u8eab\u4e5f\u5e26\u4e86 maintainess \u5373\u7ef4\u62a4\u6a21\u5757\uff0c\u4f1a\u5468\u671f\u6027\u7684\u5728\u540e\u53f0\u5c06\u8fc7\u53bb\u7684\u72b6\u6001\u548c\u6700\u8fd1\u82e5\u5e72\u7248\u672c\u7684\u6d41\u6c34 log \u8fdb\u884c\u5408\u5e76\uff0c\u5e76\u628a\u5408\u5e76\u540e\u7684\u7ed3\u679c\u91cd\u65b0\u5199\u56de\u5230 HDFS\uff1a<code>old_snapshot + delta_a + delta_b + \u2026 =&gt; lastest_snapshot</code>\u3002</p>"},{"location":"distributed_computing/spark/structured_streaming/implementation.html#d-statestore","title":"(d) StateStore \u7684\u6545\u969c\u6062\u590d","text":"<p>StateStore \u7684\u6240\u6709\u72b6\u6001\u4ee5 HDFS \u4e3a\u51c6\u3002\u5982\u679c\u67d0\u4e2a\u72b6\u6001\u5206\u7247\u5728\u66f4\u65b0\u8fc7\u7a0b\u4e2d\u5931\u8d25\u4e86\uff0c\u90a3\u4e48\u8fd8\u6ca1\u6709\u5199\u51fa\u7684\u66f4\u65b0\u4f1a\u4e0d\u53ef\u89c1\u3002</p> <p>\u6062\u590d\u65f6\u4e5f\u662f\u4ece HDFS \u8bfb\u5165\u6700\u8fd1\u53ef\u89c1\u7684\u72b6\u6001\uff0c\u5e76\u914d\u5408 StreamExecution \u7684\u6267\u884c\u6279\u6b21\u91cd\u505a\u3002\u91cd\u65b0\u8ba1\u7b97\u7684\u7c92\u5ea6\u662f Spark \u7684\u5355\u4e2a task\uff0c\u5373\u4e00\u4e2a partition \u7684\u8f93\u5165\u6570\u636e + \u4e00\u4e2a partition \u7684\u72b6\u6001\u5b58\u50a8\u3002</p> <p>\u4ece HDFS \u8bfb\u5165\u6700\u8fd1\u53ef\u89c1\u7684\u72b6\u6001\u65f6\uff0c\u5982\u679c\u6709\u6700\u65b0\u7684 snapshot\uff0c\u4e5f\u5c31\u7528\u6700\u65b0\u7684 snapshot\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5c31\u8bfb\u5165\u7a0d\u65e7\u4e00\u70b9\u7684 snapshot \u548c\u65b0\u7684 deltas\uff0c\u5148\u505a\u4e00\u4e0b\u6700\u65b0\u72b6\u6001\u7684\u5408\u5e76\u3002</p>"},{"location":"distributed_computing/spark/structured_streaming/implementation.html#_5","title":"\u5bb9\u9519","text":"<p>Spark\u7684checkpoint\u53ef\u4ee5\u81ea\u52a8\u6062\u590d\uff0c\u4e0d\u9700\u8981\u624b\u5de5\u64cd\u4f5c\u3002</p>"},{"location":"distributed_computing/spark/structured_streaming/implementation.html#_6","title":"\u76ee\u5f55\u7ec4\u7ec7\uff08\u540c\u6b65\u64cd\u4f5c\uff09","text":"<ul> <li>offsets</li> <li>\u8bb0\u5f55\u6bcf\u4e2a\u6279\u6b21\u4e2d\u7684\u504f\u79fb\u91cf\u3002\u4e3a\u4e86\u4fdd\u8bc1\u7ed9\u5b9a\u7684\u6279\u6b21\u59cb\u7ec8\u5305\u542b\u76f8\u540c\u7684\u6570\u636e\uff0c\u5728\u5904\u7406\u6570\u636e\u524d\u5c06\u5176\u5199\u5165\u6b64\u65e5\u5fd7\u8bb0\u5f55</li> <li>commits</li> <li> <p>\u8bb0\u5f55\u5df2\u5b8c\u6210\u7684\u6279\u6b21\uff0c\u91cd\u542f\u4efb\u52a1\u68c0\u67e5\u5b8c\u6210\u7684\u6279\u6b21\u4e0e offsets \u6279\u6b21\u8bb0\u5f55\u6bd4\u5bf9\uff0c\u786e\u5b9a\u63a5\u4e0b\u6765\u8fd0\u884c\u7684\u6279\u6b21</p> </li> <li> <p>metadata</p> </li> <li>metadata \u4e0e\u6574\u4e2a\u67e5\u8be2\u5173\u8054\u7684\u5143\u6570\u636e\uff0c\u76ee\u524d\u4ec5\u4fdd\u7559\u5f53\u524djob id</li> <li>sources</li> <li>sources \u76ee\u5f55\u4e3a\u6570\u636e\u6e90(Source)\u65f6\u5404\u4e2a\u6279\u6b21\u8bfb\u53d6\u8be6\u60c5\uff1b</li> <li>file system\u4f5c\u4e3a\u8f93\u5165\u65f6\uff0c\u8bb0\u5f55\u6bcf\u4e2abatch\u5904\u7406\u7684\u6587\u4ef6\u540d\uff1b</li> <li>state</li> <li>\u5b58\u50a8\u72b6\u6001\u6570\u636e\uff0c\u901a\u8fc7<code>StateStoreProvider</code>\u5b50\u7c7b\u5b9e\u73b0</li> <li>sinks</li> <li>sinks \u76ee\u5f55\u4e3a\u6570\u636e\u63a5\u6536\u7aef(Sink)\u65f6\u6279\u6b21\u7684\u5199\u51fa\u8be6\u60c5</li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/implementation.html#hdfsbackendstatestoreproviderbatchcheckpoint","title":"HDFSBackendStateStoreProvider\uff08\u6bcf\u6b21batch\u540c\u6b65checkpoint\uff09","text":"<p>Fault-tolerance model\uff1a                                                                          </p> <ul> <li>Every set of updates is written to a delta file before committing.                           </li> <li>The state store is responsible for managing, collapsing and cleaning up of delta files.       </li> <li>Multiple attempts to commit the same version of updates may overwrite each other. Consistency guarantees depend on whether multiple attempts have the same updates and  the overwrite semantics of underlying file system.                                            </li> <li>Background maintenance of files ensures that last versions of the store is always recoverable to ensure re-executed RDD operations re-apply updates on the correct past version of the store.                    </li> </ul> <p>\u914d\u7f6e</p> <ul> <li><code>spark.sql.streaming.maxBatchesToRetainInMemory</code>\u914d\u7f6e\u5728\u5185\u5b58\u4e2d\u6700\u591a\u4fdd\u5b58\u7684version\u7684statestore\u7684\u4e2a\u6570\uff1b</li> </ul> <p>\u542f\u52a8\u5b9a\u65f6\u7ebf\u7a0b<code>state-store-maintenance-task</code>\uff0c\u6267\u884csnapshot\u64cd\u4f5c\u548c\u6e05\u9664\u8fc7\u671f\u7684\u68c0\u67e5\u70b9\u6587\u4ef6\u3002</p> <ul> <li><code>spark.sql.streaming.stateStore.maintenanceInterval</code>\u53c2\u6570\u914d\u7f6e\u5b9a\u671f\u65f6\u95f4\uff0c\u9ed8\u8ba41\u5206\u949f\uff1b</li> <li><code>spark.sql.streaming.stateStore.minDeltasForSnapshot</code>\uff1a\u5f53executor\u5bf9\u5e94\u7684state store\u7684delta\u6587\u4ef6\u6570\u8d85\u8fc7\u65f6\uff0c\u624d\u4f1a\u88ab\u5408\u5e76\u6210snapshots\uff0c\u9ed8\u8ba410\uff1b</li> <li><code>spark.sql.streaming.minBatchesToRetain</code>\uff0c\u6e05\u7406\u65f6\u6700\u591a\u4fdd\u7559\u7684\u53ef\u6062\u590d\u7684\u6700\u8fd1\u7684version\u7684\u6570\u91cf\uff0c\u9ed8\u8ba4100\uff1b</li> </ul> <p>\u200b                                                               </p>"},{"location":"distributed_computing/spark/structured_streaming/kafka.html","title":"Spark kafka\u4f7f\u7528","text":"<p>\u4f9d\u8d56</p> <pre><code>groupId = org.apache.spark\nartifactId = spark-sql-kafka-0-10_2.12\nversion = 3.1.2\n</code></pre> <pre><code>// Subscribe to 1 topic, with headers\nval df = spark\n  .readStream\n  .format(\"kafka\")\n  .option(\"kafka.bootstrap.servers\", \"host1:port1,host2:port2\")\n  .option(\"subscribe\", \"topic1,topic2\")   // \u8ba2\u9605\u591a\u4e2a\u4e3b\u9898\uff0c\u9017\u53f7\u9694\u5f00\n  .option(\"includeHeaders\", \"true\")\n  .load()\ndf.selectExpr(\"CAST(key AS STRING)\", \"CAST(value AS STRING)\", \"headers\")\n  .as[(String, String, Array[(String, Array[Byte])])]\n</code></pre>"},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html","title":"Structured Streaming: A Declarative API for Real-Time Applications in Apache Spark","text":""},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_1","title":"\u80cc\u666f","text":"<p>\u65e9\u671f\u7684\u6d41\u5904\u7406\u7cfb\u7edf\uff08\u5982Spark Streaming\uff09\u5b58\u5728\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ol> <li>\u7cfb\u7edf\u9700\u8981\u7528\u6237\u53bb\u8003\u8651\u590d\u6742\u7684\u7269\u7406\u6267\u884c\u6982\u5ff5\uff0c\u6bd4\u5982 at-least-once delivery\u3001\u72b6\u6001\u5b58\u50a8\u3001\u89e6\u53d1\u6a21\u5f0f\u7b49\u6d41\u5904\u7406\u72ec\u6709\u7684\u6982\u5ff5\uff1b</li> <li>\u8bb8\u591a\u7cfb\u7edf\u53ea\u5173\u6ce8\u6d41\u8ba1\u7b97\u8fd9\u4e00\u4ef6\u4e8b\uff0c\u4f46\u5728\u5b9e\u9645\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u6d41\u5904\u7406\u4ec5\u4ec5\u662f\u4e00\u4e2a\u5927\u578b\u5546\u4e1a\u5e94\u7528\u7a0b\u5e8f\u7684\u4e00\u90e8\u5206\uff0c\u8be5\u5e94\u7528\u7a0b\u5e8f\u540c\u65f6\u8fd8\u4f1a\u5305\u62ec\u6279\u5904\u7406\u3001\u9759\u6001\u6570\u636e\u8fde\u63a5\u548c\u4ea4\u4e92\u5f0f\u67e5\u8be2\u7b49\u5904\u7406\u6d41\u7a0b\u3002</li> </ol>"},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_2","title":"\u9700\u6c42","text":"<ol> <li>\u964d\u4f4e\u7528\u6237\u7f16\u7a0b\u7684\u96be\u5ea6\uff1b</li> <li>\u4e0e\u5176\u5b83\u8ba1\u7b97\u6a21\u5f0f\u7edf\u4e00\u3002</li> </ol>"},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_3","title":"\u96be\u70b9","text":"<p>\u6d41\u7cfb\u7edf\u7684\u96be\u70b9\uff1a</p> <ul> <li>\u590d\u6742\u6027\u548c\u4f4e\u5c42\u6b21\u7684API\uff1a\u7531\u4e8e\u5176\u590d\u6742\u7684\u8bed\u4e49\uff0c\u7528\u6237\u603b\u8ba4\u4e3a\u6d41\u5904\u7406\u7cfb\u7edf\u4e0d\u5982\u6279\u5904\u7406\u7cfb\u7edf\u5bb9\u6613\u4f7f\u7528\uff1a</li> <li>\u67d0\u4e9b\u4ec5\u5728\u6570\u636e\u6d41\u5904\u7406\u4e2d\u5b58\u5728\u7684\u65b0\u7684\u6982\u5ff5\uff0c\u6bd4\u5982\uff0c\u5728\u6536\u5230\u4e0e\u67d0\u79cd\u7279\u5b9a\u5b9e\u4f53\u76f8\u5173\u7684\u5168\u90e8\u6570\u636e\u4e4b\u524d\uff0c\u7528\u6237\u5c31\u9700\u8981\u8003\u8651\u597d\u5e94\u8be5\u8f93\u51fa\u4ec0\u4e48\u7c7b\u578b\u7684\u4e2d\u95f4\u7ed3\u679c\uff1b</li> <li>\u4f4e\u5c42\u6b21\u7684API\uff0c\u8fd9\u4e9bAPI\u603b\u662f\u8981\u6c42\u7528\u6237\u4ece\u7269\u7406\u64cd\u4f5c\u7b97\u5b50\u7684\u5c42\u9762\u6765\u63cf\u8ff0\u81ea\u5df1\u7279\u5b9a\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u4e14\u8bed\u4e49\u5341\u5206\u590d\u6742\u3002</li> <li>\u5728\u7aef\u5230\u7aef\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u96c6\u6210\uff1a\u76ee\u524d\u591a\u6570Stream API\u7740\u91cd\u5173\u6ce8\u7684\u662f\u5982\u4f55\u4ece\u6570\u636e\u6e90\u8bfb\u53d6\u6570\u636e\u6d41\uff0c\u4ee5\u53ca\u5982\u4f55\u5c06\u6570\u636e\u6d41\u8f93\u51fa\u5230sink\u4e2d\uff0c\u4f46\u662f\u5546\u4e1a\u7684\u7aef\u5230\u7aef\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u7684\u662f\u66f4\u591a\u5176\u4ed6\u7684\u4efb\u52a1\u3002</li> <li>\u5728\u6700\u65b0\u7684\u6570\u636e\u4e0a\u8fdb\u884c\u4ea4\u4e92\u5f0f\u67e5\u8be2\u3002\u5982\u5728\u7ed3\u6784\u5316\u5b58\u50a8\uff08\u5982RDBM\u6216Hive\uff09\u4e2d\u5b9e\u73b0\u5bf9\u6c47\u603b\u8868\u7684\u66f4\u65b0\uff1b</li> <li>ETL\u4f5c\u4e1a\u4e2d\u9700\u8981\u7528\u5230\u6d41\u5904\u7406\uff0c\u5982\u5c06\u6d41\u6570\u636e\u548c\u9759\u6001\u6570\u636e\uff08\u5176\u4ed6\u5b58\u50a8\u7cfb\u7edf\uff09\u8fdb\u884cjoin\uff0c\u4e24\u4e2a\u7cfb\u7edf\u7684\u4e00\u81f4\u6027\uff08\u5982\u9759\u6001\u6570\u636e\u66f4\u65b0\u600e\u4e48\u529e\uff09\uff1b</li> <li>\u9700\u8981\u628a\u6d41\u5a92\u4f53\u4e1a\u52a1\u903b\u8f91\u5f53\u4f5c\u6279\u5904\u7406\u5e94\u7528\u7a0b\u5e8f\u6765\u8fd0\u884c\uff0c\u5982\u5728\u65e7\u6570\u636e\u4e0a\u56de\u586b\u7ed3\u679c\u7b49\uff0c\u91cd\u5199\u4ee3\u7801\u8017\u65f6\u4e14\u6613\u9519\u3002</li> <li>\u64cd\u4f5c\u5c42\u9762\u7684\u6311\u6218\uff1a</li> <li>\u5bb9\u9519\u7387\uff1a\u5355\u4e2a\u8282\u70b9\u5931\u6548\u3001\u5e94\u7528\u4e0b\u7ebf\u3001\u5e94\u7528\u91cd\u542f\uff1b</li> <li>\u4ee3\u7801\u66f4\u65b0\uff1a<ul> <li>\u4e1a\u52a1\u4ee3\u7801\u66f4\u65b0\u540e\uff0c\u5e0c\u671b\u5e94\u7528\u7a0b\u5e8f\u4ece\u5b83\u505c\u6b62\u7684\u5730\u65b9\u91cd\u65b0\u542f\u52a8\uff0c\u6216\u8005\u53ef\u80fd\u5e0c\u671b\u91cd\u65b0\u8ba1\u7b97\u7531\u4e8e\u9519\u8bef\u800c\u51fa\u9519\u7684\u8fc7\u53bb\u7684\u7ed3\u679c\uff1b</li> <li>\u7cfb\u7edf\u8fd0\u884c\u65f6\u66f4\u65b0\uff0c\u5982Spark\u5347\u7ea7\uff1b</li> </ul> </li> <li>\u53ef\u4f38\u7f29\u6027\uff1a\u52a8\u6001\u5730\u63d0\u9ad8\u548c\u964d\u4f4e\u5e94\u7528\u7a0b\u5e8f\u7684\u8d1f\u8f7d\uff1b</li> <li>\u62d6\u540e\u817f\u8005\uff1a\u8282\u70b9\u95ee\u9898\uff08\u7531\u4e8e\u786c\u4ef6\u7b49\u539f\u56e0\uff09\u5bfc\u81f4\u5e94\u7528\u541e\u5410\u6162\u65f6\uff0c\u7cfb\u7edf\u80fd\u591f\u81ea\u52a8\u5904\u7406\uff1b</li> <li>\u76d1\u63a7\u673a\u5236\uff1a\u4e86\u89e3\u7cfb\u7edf\u8d1f\u8f7d\u3001\u79ef\u538b\u3001\u72b6\u6001\u5927\u5c0f\u548c\u5176\u4ed6\u6307\u6807\u3002</li> <li>\u6210\u672c\u6027\u80fd\u7684\u6311\u6218\uff1a\u6d41\u5e94\u7528\u7a0b\u5e8f\u662f\u5168\u5929\u5019\u8fd0\u884c</li> <li>\u5982\u679c\u4e0d\u8fdb\u884c\u52a8\u6001\u7f29\u653e\uff0c\u5e94\u7528\u7a0b\u5e8f\u5c06\u5728\u9ad8\u5cf0\u65f6\u95f4\u4e4b\u5916\u6d6a\u8d39\u8d44\u6e90\uff1b\u5373\u4f7f\u662f\u91cd\u65b0\u4f38\u7f29\uff0c\u8fde\u7eed\u5730\u8ba1\u7b97\u4e00\u4e2a\u7ed3\u679c\u4e5f\u53ef\u80fd\u6bd4\u8fd0\u884c\u4e00\u4e2a\u5b9a\u671f\u7684\u6279\u5904\u7406\u4f5c\u4e1a\u66f4\u6602\u8d35\uff1b</li> <li></li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_4","title":"\u5df2\u6709\u7684\u89e3\u51b3\u65b9\u6848","text":"<p>Spark SS \u6700\u65e9\u7684\u6279\u6d41\u4e00\u4f53\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u7aef\u5230\u7aef\u7684\u5e94\u7528\u7f16\u7a0b\u6846\u67b6\u3002</p>"},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_5","title":"\u672c\u6587\u7684\u89e3\u51b3\u65b9\u6848","text":"<ul> <li>\u63d0\u4f9b\u589e\u91cf\u67e5\u8be2\u6a21\u578b\uff1a\u901a\u8fc7Spark SQL/DataFrame\u6a21\u5f0f\uff0c\u81ea\u52a8\u589e\u91cf\u5316\u67e5\u8be2\u9759\u6001\u6570\u636e\u3002</li> <li>\u5fae\u6279\u6a21\u5f0f</li> <li>\u4f4e\u5ef6\u8fdf\u7684\u6301\u7eed\u7b97\u5b50</li> <li>\u652f\u6301\u7aef\u5230\u7aef\u7684\u5e94\u7528\uff1a</li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_6","title":"\u7cfb\u7edf\u8bbe\u8ba1","text":""},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_7","title":"\u6982\u8981","text":"<ol> <li>\u5c06\u5904\u7406\u65f6\u95f4\u4ece\u89e6\u53d1\u5668\u548c\u4e8b\u52a1\u65f6\u95f4\u4e2d\u5206\u79bb\u51fa\u6765\uff1b</li> <li>\u4e3a\u4e86\u6027\u80fd\u4f7f\u7528\u4e86\u5173\u7cfb\u578b\u6267\u884c\u5f15\u64ce\uff1b</li> <li>\u63d0\u4f9b\u4e86\u96c6\u6210\u5316\u8bed\u8a00\u7684API\u3002</li> </ol> <p>\u8f93\u5165\u548c\u8f93\u51fa\u8bbe\u7f6e\uff1a \u53ef\u8fde\u63a5\u81f3\u591a\u79cd\u8f93\u5165\u6e90\u548c\u8f93\u51fa\u63a5\u6536\u5668\uff0c\u4e0e\u73b0\u6709\u7684 \u201cexactly-once\"\u7cfb\u7edf\u7c7b\u4f3c\uff0c\u7528\u4e24\u70b9\u6765\u4fdd\u8bc1\u6b64\u6027\u80fd\u4ee5\u53ca\u5bb9\u9519\u7387\uff1a</p> <ul> <li>\u8f93\u5165\u6e90\u662f\u53ef\u91cd\u653e\u7684\uff0c\u5373\u5f53\u6709\u8282\u70b9\u5d29\u6e83\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u53ef\u4ee5\u6839\u636eoffset\u91cd\u8bfb\u6700\u8fd1\u7684\u8f93\u5165\u6570\u636e\uff08\u5982kafka\uff0cfile system\u7b49\uff09\uff1b</li> <li>\u8f93\u51fa\u63a5\u6536\u5668\u652f\u6301\u5e42\u7b49\u5199\u5165\uff0c\u4ee5\u4fdd\u8bc1\u53ef\u9760\u6062\u590d\u3002</li> </ul> <p>API\uff1a\u7528\u6279\u5904\u7406\uff08Spark SQL/DataFrame\uff09\u7684\u65b9\u5f0f\u6765\u5904\u7406\u6570\u636e\u6d41\u3002</p> <ul> <li>\u6d41\u4f5c\u4e3a\u65e0\u9650\u8868\uff0c\u5728\u5904\u7406\u65f6\u7528table\u6765\u4ee3\u66ff\u8f93\u5165stream\u4e2d\u7684\u6240\u6709\u6570\u636e\uff0c\u7136\u540e\u7531\u5f15\u64ce\u6765\u51b3\u5b9a\u5982\u4f55\u5bf9\u8be5\u8868\u8fdb\u884c\u589e\u91cf\u67e5\u8be2\u4e0e\u66f4\u65b0\uff1b</li> <li>Triggles\uff1a\u89e6\u53d1\u5668\u6765\u63a7\u5236\u5f15\u64ce\u8ba1\u7b97\u65b0\u7ed3\u679c\u548c\u66f4\u65b0\u8f93\u51fa\u63a5\u6536\u5668\u7684\u9891\u7387\uff1b</li> <li>\u6807\u8bb0\u4e8b\u52a1\u65f6\u95f4\u5217\uff0c\u540c\u65f6\u8bbe\u7f6ewatermark\u7b56\u7565\uff0cwindow\u64cd\u4f5c\u7531Sql\u4e2d\u805a\u5408\u64cd\u4f5c\u5b9e\u73b0\uff1b</li> <li>\u6dfb\u52a0\u72b6\u6001\u64cd\u4f5c\u7b26\uff0c\u8ddf\u8e2a\u548c\u66f4\u65b0\u72b6\u6001\uff1b</li> </ul> <p>\u6267\u884c\uff1a\u4e00\u65e6\u6536\u5230\u67e5\u8be2\uff0cSS\u4f1a\u4f18\u5316\u8be5\u67e5\u8be2\uff0c\u4f7f\u4e4b\u589e\u91cf\u5316\uff0c\u7136\u540e\u5f00\u59cb\u6267\u884c\u5b83\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7cfb\u7edf\u4f7f\u7528\u7c7b\u4f3c\u4e8eSpark Streaming\u4e2d\u7684microbatch\u6a21\u578b\uff08\u652f\u6301\u52a8\u6001\u8d1f\u8f7d\u5e73\u8861\uff0c\u7f29\u653e\uff0c\u6545\u969c\u6062\u590d\u548c\u96f6\u6563\u7f13\u89e3\uff09\u6765\u8ba1\u7b97\u3002</p> <p>\u5bb9\u9519\u7387\u4fdd\u969c\uff1a\u7528\u4e86\u4e24\u79cd\u6301\u4e45\u5316\u5b58\u50a8\uff1a</p> <ul> <li>\u9884\u5199\u65e5\u5fd7\uff0c\u7528\u4e8e\u8bb0\u5f55\u5df2\u7ecf\u5904\u7406\u8fc7\u5e76\u53ef\u9760\u5199\u5165\u8f93\u51fa\u63a5\u6536\u5668\u7684\u8f93\u5165\u6570\u636e\uff1b</li> <li>\u72b6\u6001\u5b58\u50a8\uff0c\u5927\u89c4\u6a21\u5b58\u50a8\uff0c\u4fdd\u5b58\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u805a\u5408\u64cd\u4f5c\u7684\u64cd\u4f5c\u72b6\u6001\u7684\u5feb\u7167\uff1b</li> </ul> <p>\u64cd\u4f5c\u7279\u5f81\uff1a</p> <ul> <li>\u4e24\u79cd\u6301\u4e45\u5316\u5b58\u50a8\u4f7f\u4e4b\u53ef\u4ee5\u5b9e\u73b0\u56de\u6eda\u4e0e\u5feb\u901f\u6062\u590d\uff1b</li> <li>\u6267\u884c\u5fae\u6279\u6b21\u7684\u80fd\u529b\u4f7f\u4e4b\u80fd\u81ea\u9002\u5e94\u5730\u6279\u91cf\u5904\u7406\u6570\u636e\u3002</li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_8","title":"\u7f16\u7a0b\u6a21\u578b","text":"<p>\u8bed\u4e49\uff1a  \uff081\uff09 \u6bcf\u4e2a\u8f93\u5165\u6e90\u63d0\u4f9b\u4e00\u7ec4\u968f\u65f6\u95f4\u90e8\u5206\u6709\u5e8f\u7684\u8bb0\u5f55\uff0c\u6bd4\u5982kafka\u662f\u5206\u533a\u5185\u4fdd\u8bc1\u6709\u5e8f\uff1b  \uff082\uff09 \u7528\u6237\u63d0\u4f9b\u67e5\u8be2\u8bed\u53e5\uff0c\u8de8\u8f93\u5165\u6570\u636e\u5730\u6267\u884c\u547d\u4ee4\uff0c\u6700\u7ec8\u8f93\u51fa\u7ed3\u679c\u8868\uff1b  \uff083\uff09 \u89e6\u53d1\u5668\u662f\u544a\u77e5\u7cfb\u7edf\uff0c\u4f55\u65f6\u5bf9\u7ed3\u679c\u8868\u6267\u884c\u4e00\u4e2a\u65b0\u7684\u589e\u91cf\u5316\u8ba1\u7b97\u548c\u66f4\u65b0\uff1b  \uff084\uff09 \u4e09\u79cd\u8f93\u51fa\u6a21\u5f0f\uff1aComplete**\u5c06\u6587\u4ef6\u5b8c\u5168\u91cd\u5199\u3002Append*\u8ffd\u52a0\u6570\u636e\u5230\u7ed3\u679c\u8868\u3002Update*\u6839\u636ekey\u6765\u66f4\u65b0\u7ed3\u679c\u8868\u3002</p>"},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#prefix-consistencytodo","title":"\u524d\u7f00\u4e00\u81f4\u6027\uff08prefix consistency\uff09TODO","text":"<p>watermark \uff1a\u6c34\u4f4d\uff0c\u5bf9\u4e8e\u91c7\u7528record\u4e2d\u7684\u5217\u4f5c\u4e3aevent time\u7684\u573a\u666f\uff0c\u5bf9\u4e8e\u5ef6\u8fdf\u7684\u6570\u636e\u7684\u65e0\u6548\u5224\u65ad\u3002</p> <ul> <li>a delay threshold \\(t_C\\)\u200b for a given timestamp column \\(C\\)\u200b. At any point in time, the watermark for \\(C\\)\u200b is \\(max(C) \u2212t_C\\)\u200b, that is, \\(t_C\\)\u200b seconds before the maximum event time seen so far in C.</li> </ul> <p>stateful operator\uff1a\u81ea\u5b9a\u4e49\u7684\u6d41\u5904\u7406\u903b\u8f91\uff0c<code>UDFs with state</code></p>"},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_9","title":"\u67e5\u8be2\u8ba1\u5212","text":"<p>Catalyst extensible optimizer in Spark SQL</p>"},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_10","title":"\u5206\u6790","text":""},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_11","title":"\u589e\u91cf","text":""},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_12","title":"\u4f18\u5316","text":"<p>\u590d\u7528SparkSQL\u67e5\u8be2\u4f18\u5316\uff1a</p> <ul> <li>predicate pushdown, projection pushdown, expression simplification\uff1b</li> <li>Tungsten binary format\uff1b</li> <li>runtime code generator\uff1b</li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_13","title":"\u5e94\u7528\u6267\u884c","text":""},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_14","title":"\u72b6\u6001\u7ba1\u7406\u548c\u6062\u590d","text":"<ul> <li>write-ahead log that supports durable, atomic writes at low latency\uff1b</li> <li>a state store that can store larger amounts of data durably and allows parallel access.</li> </ul> <ol> <li>As input opeartor read data, master writes the start and end offsets of each epoch durably to the log\uff1b</li> <li>Any operators requiring state checkpoint their state periodically and asynchronosuly to the state store, using incremental checkpoints when possible\uff08eppch id with state data\uff09\uff1b</li> <li>Output operators write the epochs they committed to the log\uff1bThe master waits for all nodes running an operator to report a commit for a given epoch before allowing commits for the next epoch\uff1b</li> <li>Upon recovery, the new instance of the application starts by reading the log to find the last epoch that has not been committed to the sink, including its start and end offsets</li> </ol>"},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_15","title":"\u5fae\u6279\u6a21\u5f0f","text":"<p>\u91c7\u7528Spark Streaming\u7684\u79bb\u6563\u6d41\u6267\u884c\u6a21\u5f0f\uff1a</p> <ul> <li>\u52a8\u6001\u8d1f\u8f7d\u5747\u8861\uff1a\u6bcf\u4e2aoperator\u7684\u5de5\u4f5c\u88ab\u5212\u5206\u4e3a\u5c0f\u7684\u3001\u72ec\u7acb\u7684\u4efb\u52a1\uff0c\u8fd9\u4e9b\u4efb\u52a1\u53ef\u4ee5\u88ab\u8c03\u5ea6\u5230\u4efb\u4f55\u8282\u70b9\u4e0a\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u67d0\u4e9b\u64cd\u4f5c\u7684\u6267\u884c\u901f\u5ea6\u6162\u4e8e\u5176\u4ed6\u64cd\u4f5c\uff0c\u7cfb\u7edf\u53ef\u4ee5\u81ea\u52a8\u5728\u5404\u4e2a\u8282\u70b9\u4e4b\u95f4\u5e73\u8861\u8fd9\u4e9b\u4efb\u52a1\u3002</li> <li>\u7ec6\u7c92\u5ea6\u5bb9\u9519\uff1a\u8282\u70b9\u5b95\u673a\u65f6\uff0c\u53ea\u9700\u8981\u8be5\u8282\u70b9\u7684\u4efb\u52a1\u91cd\u505a\uff0c\u4e0d\u9700\u8981\u5c06\u6574\u4e2a\u96c6\u7fa4\u56de\u6eda\u5230\u4e0a\u4e00\u4e2acheckpoint\uff1b</li> <li>\u62d6\u540e\u817f\u8005\u8fc1\u79fb\uff1a\u5982batch\u6a21\u5f0f\u4e00\u6837\uff0c\u591a\u4e2a\u5907\u4efd\u4efb\u52a1\uff1b</li> <li>\u53ef\u6269\u5c55\u6027\uff1a\u53ef\u4ee5\u52a8\u6001\u7684\u589e\u52a0/\u5220\u9664\u8282\u70b9\uff0c\u4efb\u52a1\u4f1a\u81ea\u52a8\u8c03\u5ea6\u5230\u53ef\u7528\u7684\u8282\u70b9\uff1b</li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_16","title":"\u6301\u7eed\u6a21\u5f0f","text":"<p>long-live operator</p> <ol> <li>The master( driver ) launches long-running tasks on each partition using Spark\u2019s scheduler that each read one partition of the input source (e.g., Kinesis stream) but execute multiple epochs. If one of these tasks fails, Spark will simply relaunch it\uff1b</li> <li>Epochs are coordinated differently. The master periodically tells nodes to start a new epoch, and receives a start offset for the epoch on each input partition, which it inserts into the writeahead log. When it asks them to start the next epoch, it also receives end offsets for the previous one, writes these to the log, and tells nodes to commit the epoch when it has written all the end offsets. Thus, the master is not on the critical path for inspecting all the input sources and defining start/end offsets.</li> </ol> <p>\u6682\u65f6\u4e0d\u652f\u6301straggler\u5904\u7406\u548c\u52a8\u6001\u8d1f\u8f7d\u5747\u8861\u3002</p>"},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_17","title":"\u64cd\u4f5c\u7279\u6027","text":"<ul> <li> <p>\u4ee3\u7801\u70ed\u66f4\u65b0\uff0c\u5982\u7528\u6237\u4ee3\u7801\u7684bug\u4fee\u590d\uff0cspark\u4ee3\u7801\u66f4\u65b0\u7b49\uff0c\u53ea\u8981\u7528\u6237\u4e0d\u66f4\u6539state schema\uff1b</p> </li> <li> <p>\u624b\u52a8\u56de\u6eda\uff0c\u5982\u53d1\u73b0\u903b\u8f91\u9519\u8bef\uff0c\u53ef\u4ee5\u901a\u8fc7\u67e5\u770bwrite-ahead log\uff08json\u683c\u5f0f\uff09\uff0c\u56de\u6eda\u5230\u7279\u5b9a\u7684epoch\uff1b</p> </li> <li> <p>\u6279\u6d41\u5f02\u6784\u6267\u884c\uff0c\u5982ETL\u4f5c\u4e3a\u4e00\u6b21\u6267\u884c\u7684\u6d41\u4f5c\u4e1a\uff08\u4fdd\u7559\u8f93\u5165\u504f\u79fb\u91cf\uff0c\u65b9\u4fbf\u4e0b\u4e00\u6b21\u64cd\u4f5c\uff09\uff0c\u8282\u7701\u7b97\u529b\uff1b</p> </li> <li> <p>\u76d1\u63a7\uff0c\u5982\u541e\u5410\u91cf\u7b49\uff1b</p> </li> </ul>"},{"location":"distributed_computing/spark/structured_streaming/ss_sigmod_2018.html#_18","title":"\u5b9e\u9a8c\u6548\u679c","text":"<p>\u5b9e\u9a8c\u57fa\u51c6\uff1aYahoo! Streaming Benchmark</p> <p>\u5b9e\u9a8c\u73af\u5883\uff1afive c3.2xlarge Amazon EC2 workers\uff0c8 core\uff0c15GB\u5185\u5b58</p> <p>Source\uff1aKafka 40\u5206\u533a</p> <p>Sink\uff1aKafka</p> <p>\u6027\u80fd\uff1a6500 records / s</p>"},{"location":"distributed_computing/spark/structured_streaming/usage.html","title":"\u914d\u7f6e","text":""},{"location":"distributed_computing/spark/structured_streaming/usage.html#file-sinksource","title":"File Sink/Source","text":"<p>\u5c3d\u91cf\u4f7f\u7528\u7b2c\u4e09\u65b9\uff0c\u5982Hudi\u3001Iceberg\u7b49\uff0c\u800c\u4e0d\u8981\u4f7f\u7528\u539f\u751f\uff0c\u5f53\u524d\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff083.1.0\u5bf9Filesink\u52a0\u4e86retension\u914d\u7f6e\uff09\uff1a</p> <p></p> <p></p> <p>fileSource \u6570\u636e\u6e90\u7aef\uff1a\u914d\u7f6e\u5728 FileStreamSourceLog \u5f15\u7528</p> <ul> <li> <p>\u95ee\u9898\uff1acheckpoint\u4e2d\u7684source\u4e2dcompact\u4f1a\u8d8a\u6765\u8d8a\u5927</p> </li> <li> <p>spark.sql.streaming.fileSource.log.deletion (\u9ed8\u8ba4true)\uff0c\u5220\u9664\u8fc7\u671f\u65e5\u5fd7\u6587\u4ef6</p> </li> <li>spark.sql.streaming.fileSource.log.compactInterval (\u9ed8\u8ba410)\uff0c\u65e5\u5fd7\u6587\u4ef6\u5408\u5e76\u9608\u503c</li> <li>spark.sql.streaming.fileSource.log.cleanupDelay (\u9ed8\u8ba410m)\uff0c\u65e5\u5fd7\u6587\u4ef6\u4fdd\u7559\u65f6\u95f4</li> </ul> <p>fileSink \u63a5\u6536\u7aef\uff1a\u914d\u7f6e\u5728 FileStreamSinkLog \u5f15\u7528</p> <ul> <li>\u95ee\u9898\uff1a$OUT_PATH/_spark_metadata\u4e2d\u4f1a\u4fdd\u5b58\u6bcf\u6b21\u7684\u6587\u4ef6\uff0c\u4f5c\u4e3a\u6d41\u5f0f\u8bfb\u53d6\u7684\u4f9d\u636e\uff1f\uff08\u5f53\u524d3.1\uff09</li> </ul> <pre><code>v1\n{\"path\":\"file:///E:/spark_test/part-00000-70e530af-2072-4a07-a5ab-e1436e4fac25-c000.json\",\"size\":0,\"isDir\":false,\"modificationTime\":1630404583569,\"blockReplication\":1,\"blockSize\":33554432,\"action\":\"add\"}\n{\"path\":\"file:///E:/spark_test/part-00000-8151d857-8d7c-4a52-8e10-2856b8d4fe91-c000.json\",\"size\":56,\"isDir\":false,\"modificationTime\":1630404585406,\"blockReplication\":1,\"blockSize\":33554432,\"action\":\"add\"}\n{\"path\":\"file:///E:/spark_test/part-00001-4220c406-e887-4f69-b8f6-71521f148512-c000.json\",\"size\":56,\"isDir\":false,\"modificationTime\":1630404585406,\"blockReplication\":1,\"blockSize\":33554432,\"action\":\"add\"}\n</code></pre> <ul> <li>spark.sql.streaming.fileSink.log.deletion (\u9ed8\u8ba4true)\uff0c\u5220\u9664\u8fc7\u671f\u65e5\u5fd7\u6587\u4ef6CompactibleFileStreamLog</li> <li>spark.sql.streaming.fileSink.log.compactInterval (\u9ed8\u8ba410)\uff0c\u65e5\u5fd7\u6587\u4ef6\u5408\u5e76\u9608\u503c</li> <li>spark.sql.streaming.fileSink.log.cleanupDelay (\u9ed8\u8ba410m)\uff0c\u65e5\u5fd7\u6587\u4ef6\u4fdd\u7559\u65f6\u95f4</li> </ul>"},{"location":"distributed_computing/spark/toree/apache_toree.html","title":"Apache Toree","text":"<p>Toree is an Scala kernel for the Jupyter Notebook platform providing interactive access to Apache Spark.</p> <p></p>"},{"location":"distributed_consensus/Etcd.html","title":"Etcd","text":"<p>Distributed reliable key-value store for the most critical data of a distributed system.</p> <p>\u89e3\u51b3\u5206\u5e03\u5f0f\u4e2d\u6570\u636e\u4e00\u81f4\u6027\u7684\u95ee\u9898\uff0c\u6570\u636e\u5206\u4e3a\u63a7\u5236\u6570\u636e\u548c\u5e94\u7528\u6570\u636e\u3002</p> <p>etcd\u5904\u7406\u7684\u6570\u636e\u9ed8\u8ba4\u4e3a\u63a7\u5236\u6570\u636e\uff0c\u5bf9\u4e8e\u5e94\u7528\u6570\u636e\u53ea\u63a8\u8350\u5904\u7406\u6570\u636e\u91cf\u5c0f\u4f46\u66f4\u65b0\u8bbf\u95ee\u9891\u7e41\u7684\u60c5\u51b5\u3002</p>"},{"location":"distributed_consensus/Etcd.html#_1","title":"\u573a\u666f","text":"<p>\u7279\u70b9\uff1a</p> <ul> <li>Simple: well-defined, user-facing API (gRPC)</li> <li>Secure: automatic TLS with optional client cert authentication</li> <li>Fast: Benchmarked at 1000s of writes/s per instance</li> <li>Reliable: properly distributed using Raft</li> </ul> <p>\u4f7f\u7528\u573a\u666f\uff1a</p> <ul> <li>\u670d\u52a1\u53d1\u73b0</li> <li>\u6d88\u606f\u53d1\u5e03\u548c\u8ba2\u9605</li> <li>\u8d1f\u8f7d\u5747\u8861</li> <li>\u5206\u5e03\u5f0f\u901a\u77e5\u548c\u534f\u8c03</li> <li>\u5206\u5e03\u5f0f\u9501\u4e0e\u7ade\u9009</li> <li>\u5206\u5e03\u5f0f\u961f\u5217</li> <li>\u96c6\u7fa4\u76d1\u63a7</li> </ul>"},{"location":"distributed_consensus/apache_ratis.html","title":"Apache Ratis","text":"<p>Apache Ratis is a highly customizable Raft protocol implementation in Java. </p>"},{"location":"distributed_consensus/apache_ratis.html#_1","title":"\u6982\u5ff5","text":"<p>TermIndex\uff1a</p> <ul> <li>Term</li> <li>Index</li> </ul> <p>API \u652f\u6301\u540c\u6b65<code>io</code>\uff0c\u5f02\u6b65<code>async</code>\uff1b</p> <p>\u8bf7\u6c42\u7c7b\u578b\uff1a<code>RaftClientRequest</code></p> <ul> <li><code>writeRequestType()</code></li> <li><code>dataStreamRequestType()</code></li> <li><code>readRequestType()</code></li> <li><code>watchRequestType()</code></li> </ul> <p>RaftPeer\uff1aRaft \u534f\u8bae\u4e2d\u7684\u8282\u70b9</p> <ul> <li>Id\uff1a\u552f\u4e00 Id \u8868\u793a</li> <li>Address\uff1a</li> <li>AdminAddress</li> <li>ClientAddress</li> <li>DataStreamAddress</li> <li>Priority</li> <li>StartupRole</li> </ul> <p>RaftGroup\uff1a\u591a\u4e2a Peer \u7ec4\u6210\u7684 Raft \u96c6\u7fa4</p> <ul> <li>RatfGroupId\uff1a\u6807\u8bc6 Group \u7684\u552f\u4e00 Id</li> <li>Peers\uff1a<code>List&lt;RaftPeer&gt;</code></li> </ul> <p>RaftClient</p> <ul> <li> <p>group\uff1a\u5373RaftGroup\uff1b</p> </li> <li> <p>clientRpc\uff1a\u9ed8\u8ba4\u4e0d\u8bbe\u7f6e\uff0c\u5219\u4e3a<code>Grpc</code>\uff0c\u8fd8\u652f\u6301<code>Netty</code>\u548c<code>HadoopRpc</code>\uff1b</p> </li> <li> <p>\u914d\u7f6e\uff08properties)\uff1a</p> </li> <li> <p>StorageDir\uff1a<code>raft.server.storage.dir</code>\uff0c\u5b58\u50a8\u76ee\u5f55</p> </li> <li>serverPort\uff1a<code>raft.grpc.server.port</code>\uff0c</li> </ul> <p>RaftServer</p> <ul> <li>serverId\uff1aRaftPeer\u7684Id\uff1a</li> <li>group\uff1a\u5373RaftGroup\uff1b</li> <li>\u914d\u7f6e\uff08properties)\uff1a</li> <li>StorageDir\uff1a<code>raft.server.storage.dir</code>\uff0c\u5b58\u50a8\u76ee\u5f55</li> <li> <p>serverPort\uff1a<code>raft.grpc.server.port</code>\uff0c</p> </li> <li> <p>StateMachine\uff1a\u7ee7\u627f<code>BaseStateMachine</code>\uff0c\u6700\u91cd\u8981\u7684\u65b9\u6cd5</p> </li> <li>load the latest snapshot</li> <li>Apply a committed log entry to the state machine</li> </ul>"},{"location":"distributed_consensus/apache_ratis.html#_2","title":"\u793a\u4f8b","text":""},{"location":"distributed_consensus/apache_ratis.html#_3","title":"\u5168\u5c40\u8ba1\u6570\u5668","text":"<pre><code>public classs AppStateMachine extends BaseStateMachine {\n    // \u72b6\u6001\u673a\u5b58\u50a8\uff08\u4f7f\u7528 raft.server.storage.dir\uff09\n    private final SimpleStateMachineStorage storage = new SimpleStateMachineStorage();\n    private final AtomicInteger counter = new AtomicInteger(0);\n\n    // Initialize the state machine storage and then load the state.\n    @Override\n    public void initialize(RaftServer server, RaftGroupId groupId, RaftStorage raftStorage) throws IOException {\n        super.initialize(server, groupId, raftStorage);\n        storage.init(raftStorage);\n        reinitialize();\n    }\n\n    // Simply load the latest snapshot.\n    @Override\n    public void reinitialize() throws IOException {\n        // \u4ece\n        load(storage.getLatestSnapshot());\n    }\n\n    // Store the current state as a snapshot file in the {@link #storage}.\n    public long takeSnapshot() {\n        // \u83b7\u53d6 snapshot \u6587\u4ef6\n        // \u5199\u5165 state \u4fe1\u606f \uff08\u5305\u62ec Term Index\uff09\n    }\n\n    // Query the state machine. The request must be read-only.\n    @Override\n    public CompletableFuture&lt;Message&gt; query(Message request) {\n    }\n\n    // Apply a committed log entry to the state machine. \n    @Override\n    public CompletableFuture&lt;Message&gt; applyTransaction(TransactionContext trx) {\n        // TransactionContext \u4e2d\u5305\u542b TermIndex\uff0cMessage\uff0c\u5e76\u4e14\u8fd4\u56de Message \u7ed9 Client\n    }\n}\n</code></pre>"},{"location":"distributed_consensus/consensus.html","title":"\u5206\u5e03\u5f0f\u5171\u8bc6","text":""},{"location":"distributed_consensus/consensus.html#paxo","title":"Paxo","text":""},{"location":"distributed_consensus/consensus.html#raft","title":"Raft","text":""},{"location":"distributed_consensus/consistency.html","title":"\u5206\u5e03\u5f0f\u4e00\u81f4\u6027(consistency)","text":""},{"location":"distributed_consensus/consistency.html#cap","title":"CAP\u7406\u8bba","text":"<p>\u5bf9\u4e8e\u5206\u5e03\u5f0f\u7cfb\u7edf\u5de5\u7a0b\u5b9e\u8df5\uff0c CAP \u7406\u8bba\u66f4\u5408\u9002\u7684\u63cf\u8ff0\u662f\uff1a\u5728\u6ee1\u8db3\u5206\u533a\u5bb9\u9519\u7684\u524d\u63d0\u4e0b\uff0c\u6ca1\u6709\u7b97\u6cd5\u80fd\u540c\u65f6\u6ee1\u8db3\u6570\u636e\u5f3a\u4e00\u81f4\u6027\u548c\u670d\u52a1\u53ef\u7528\u6027\u3002</p> <ul> <li> <p>Consistency\uff1a\u4e00\u81f4\u6027\uff0c\u6307\u5f3a\u4e00\u81f4\u6027\uff08\u7ebf\u6027\u4e00\u81f4\u6027\uff09\u3002\u5982\u679c\u4e00\u4e2a\u5199\u64cd\u4f5c\u8fd4\u56de\u6210\u529f\uff0c\u90a3\u4e48\u4e4b\u540e\u7684\u8bfb\u8bf7\u6c42\u90fd\u5fc5\u987b\u8bfb\u5230\u8fd9\u4e2a\u65b0\u6570\u636e</p> </li> <li> <p>Availability\uff1a\u53ef\u7528\u6027\u3002\u7cfb\u7edf\u63d0\u4f9b\u7684\u670d\u52a1\u5fc5\u987b\u5904\u4e8e 100% \u53ef\u7528\u7684\u72b6\u6001\uff0c\u5bf9\u4e8e\u7528\u6237\u7684\u6bcf\u4e00\u4e2a\u64cd\u4f5c\u8bf7\u6c42\uff0c\u7cfb\u7edf\u603b\u80fd\u591f\u5728\u6709\u9650\u7684\u65f6\u95f4\u5185\u8fd4\u56de\u5408\u7406\u7684\u54cd\u5e94</p> </li> <li> <p>Partition Tolerant\uff1a\u7f51\u7edc\u5206\u533a\u5bb9\u9519\u6027\u3002\u5f53\u51fa\u73b0\u7f51\u7edc\u5206\u533a\u540e\uff0c\u7cfb\u7edf\u80fd\u591f\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\u3002</p> </li> </ul> <p>\u5728\u51fa\u73b0\u7f51\u7edc\u5206\u533a\u540e\uff0c\u4f1a\u51fa\u73b0\u53ef\u7528\u6027\u548c\u4e00\u81f4\u6027\u7684\u95ee\u9898\uff0c\u6211\u4eec\u5fc5\u987b\u8981\u5728\u8fd9\u4e24\u8005\u4e4b\u95f4\u8fdb\u884c\u53d6\u820d\uff1aCP \u6216 AP\u3002</p>"},{"location":"distributed_consensus/consistency.html#cp","title":"CP \u67b6\u6784","text":"<p>\u5f53\u7f51\u7edc\u5206\u533a\u51fa\u73b0\u540e\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u4e00\u81f4\u6027\uff0c\u5c31\u5fc5\u987b\u62d2\u63a5\u8bf7\u6c42\uff0c\u5426\u5219\u65e0\u6cd5\u4fdd\u8bc1\u4e00\u81f4\u6027\uff1a</p> <p></p> <p>CP \u67b6\u6784\u4fdd\u8bc1\u5ba2\u6237\u7aef\u5728\u83b7\u53d6\u6570\u636e\u65f6\u4e00\u5b9a\u662f\u6700\u8fd1\u7684\u5199\u64cd\u4f5c\uff0c\u6216\u8005\u83b7\u53d6\u5230\u5f02\u5e38\u4fe1\u606f\uff0c\u7edd\u4e0d\u4f1a\u51fa\u73b0\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\u3002</p> <ul> <li>\u5f53\u6ca1\u6709\u51fa\u7f51\u7edc\u5206\u533a\u65f6\uff0c\u7cfb\u7edf A \u4e0e\u7cfb\u7edf B \u7684\u6570\u636e\u4e00\u81f4\uff0cX=1\u3002</li> <li>\u5c06\u7cfb\u7edf A \u7684 X \u4fee\u6539\u4e3a 2\uff0cX=2\u3002</li> <li>\u5f53\u51fa\u73b0\u7f51\u7edc\u5206\u533a\u540e\uff0c\u7cfb\u7edf A \u4e0e\u7cfb\u7edf B \u4e4b\u95f4\u7684\u6570\u636e\u540c\u6b65\u6570\u636e\u5931\u8d25\uff0c\u7cfb\u7edf B \u7684 X=1\u3002</li> <li>\u5f53\u5ba2\u6237\u7aef\u8bf7\u6c42\u7cfb\u7edf B \u65f6\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u4e00\u81f4\u6027\uff0c\u6b64\u65f6\u7cfb\u7edf B \u5e94\u62d2\u7edd\u670d\u52a1\u8bf7\u6c42\uff0c\u8fd4\u56de\u9519\u8bef\u7801\u6216\u9519\u8bef\u4fe1\u606f\u3002</li> </ul>"},{"location":"distributed_consensus/consistency.html#ap","title":"AP \u67b6\u6784","text":"<p>\u5f53\u7f51\u7edc\u5206\u533a\u51fa\u73b0\u540e\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u53ef\u7528\u6027\uff0c\u7cfb\u7edf B \u53ef\u4ee5\u8fd4\u56de\u65e7\u503c\uff0c\u4fdd\u8bc1\u7cfb\u7edf\u7684\u53ef\u7528\u6027\uff1a</p> <ul> <li>\u5f53\u6ca1\u6709\u51fa\u7f51\u7edc\u5206\u533a\u65f6\uff0c\u7cfb\u7edf A \u4e0e\u7cfb\u7edf B \u7684\u6570\u636e\u4e00\u81f4\uff0cX=1\u3002</li> <li>\u5c06\u7cfb\u7edf A \u7684 X \u4fee\u6539\u4e3a 2\uff0cX=2\u3002</li> <li>\u5f53\u51fa\u73b0\u7f51\u7edc\u5206\u533a\u540e\uff0c\u7cfb\u7edf A \u4e0e\u7cfb\u7edf B \u4e4b\u95f4\u7684\u6570\u636e\u540c\u6b65\u6570\u636e\u5931\u8d25\uff0c\u7cfb\u7edf B \u7684 X=1\u3002</li> <li>\u5f53\u5ba2\u6237\u7aef\u8bf7\u6c42\u7cfb\u7edf B \u65f6\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u53ef\u7528\u6027\uff0c\u6b64\u65f6\u7cfb\u7edf B \u5e94\u8fd4\u56de\u65e7\u503c\uff0cX=1\u3002</li> </ul>"},{"location":"distributed_consensus/consistency.html#base","title":"BASE \u7406\u8bba","text":"<p>\u5373\u4fbf\u65e0\u6cd5\u505a\u5230\u5f3a\u4e00\u81f4\u6027\uff0c\u4f46\u5e94\u8be5\u91c7\u7528\u9002\u5408\u7684\u65b9\u5f0f\u4fdd\u8bc1\u6700\u7ec8\u4e00\u81f4\u6027\u3002</p> <ul> <li>Basically Available\uff1a\u57fa\u672c\u53ef\u7528\uff0c\u5206\u5e03\u5f0f\u7cfb\u7edf\u5728\u51fa\u73b0\u6545\u969c\u7684\u65f6\u5019\uff0c\u5141\u8bb8\u635f\u5931\u90e8\u5206\u53ef\u7528\u6027\uff0c\u5373\u4fdd\u8bc1\u6838\u5fc3\u53ef\u7528\u3002</li> <li>\u54cd\u5e94\u65f6\u95f4\u4e0a\u7684\u635f\u5931\uff1a\u65f6\u5ef6\u589e\u52a0\uff1b</li> <li>\u7cfb\u7edf\u529f\u80fd\u4e0a\u7684\u635f\u5931\uff1a\u670d\u52a1\u964d\u7ea7\uff1b</li> <li>Soft State\uff1a\u5141\u8bb8\u7cfb\u7edf\u5b58\u5728\u4e2d\u95f4\u72b6\u6001\uff0c\u800c\u8be5\u4e2d\u95f4\u72b6\u6001\u4e0d\u4f1a\u5f71\u54cd\u7cfb\u7edf\u6574\u4f53\u53ef\u7528\u6027\u3002</li> <li>\u5141\u8bb8\u7cfb\u7edf\u5728\u4e0d\u540c\u8282\u70b9\u7684\u6570\u636e\u526f\u672c\u4e4b\u95f4\u8fdb\u884c\u6570\u636e\u540c\u6b65\u7684\u8fc7\u7a0b\u5b58\u5728\u5ef6\u65f6\uff1b</li> <li>Eventual Consistency\uff1a\u6700\u7ec8\u4e00\u81f4\u6027\uff0c\u7cfb\u7edf\u4e2d\u7684\u6240\u6709\u6570\u636e\u526f\u672c\u7ecf\u8fc7\u4e00\u5b9a\u65f6\u95f4\u540e\uff0c\u6700\u7ec8\u80fd\u591f\u8fbe\u5230\u4e00\u81f4\u7684\u72b6\u6001\u3002</li> </ul>"},{"location":"distributed_consensus/consistency.html#_1","title":"\u5206\u5e03\u5f0f\u4e8b\u52a1\u534f\u8bae","text":""},{"location":"distributed_consensus/consistency.html#2pc","title":"2PC(\u4e8c\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae)","text":"<p>\u5f53\u4e00\u4e2a\u4e8b\u52a1\u8de8\u8d8a\u591a\u4e2a\u8282\u70b9\u65f6\uff0c\u4e3a\u4e86\u4fdd\u6301\u4e8b\u52a1\u7684 ACID \u7279\u6027\uff0c\u9700\u8981\u5f15\u5165\u4e00\u4e2a\u4f5c\u4e3a\u534f\u8c03\u8005\u7684\u7ec4\u4ef6\u6765\u7edf\u4e00\u638c\u63a7\u6240\u6709\u8282\u70b9\uff08\u79f0\u4f5c\u53c2\u4e0e\u8005\uff09\u7684\u64cd\u4f5c\u7ed3\u679c\u5e76\u6700\u7ec8\u6307\u793a\u8fd9\u4e9b\u8282\u70b9\u662f\u5426\u8981\u628a\u64cd\u4f5c\u7ed3\u679c\u8fdb\u884c\u771f\u6b63\u7684\u63d0\u4ea4\uff08\u6bd4\u5982\u5c06\u66f4\u65b0\u540e\u7684\u6570\u636e\u5199\u5165\u78c1\u76d8\u7b49\u7b49\uff09\u3002</p> <p>\u7b97\u6cd5\u601d\u8def\u53ef\u4ee5\u6982\u62ec\u4e3a\uff1a\u53c2\u4e0e\u8005\u5c06\u64cd\u4f5c\u6210\u8d25\u901a\u77e5\u534f\u8c03\u8005\uff0c\u518d\u7531\u534f\u8c03\u8005\u6839\u636e\u6240\u6709\u53c2\u4e0e\u8005\u7684\u53cd\u9988\u60c5\u62a5\u51b3\u5b9a\u5404\u53c2\u4e0e\u8005\u662f\u5426\u8981\u63d0\u4ea4\u64cd\u4f5c\u8fd8\u662f\u4e2d\u6b62\u64cd\u4f5c\u3002</p> <p>\u57fa\u4e8e\u4ee5\u4e0b\u5047\u8bbe\uff1a</p> <ul> <li>\u5b58\u5728\u4e00\u4e2a\u8282\u70b9\u4f5c\u4e3a\u534f\u8c03\u8005\uff08Coordinator\uff09\uff0c\u5176\u4ed6\u8282\u70b9\u4f5c\u4e3a\u53c2\u4e0e\u8005\uff08Cohorts\uff09\uff0c\u4e14\u8282\u70b9\u4e4b\u95f4\u53ef\u4ee5\u8fdb\u884c\u7f51\u7edc\u901a\u4fe1\uff1b</li> <li>\u6240\u6709\u8282\u70b9\u90fd\u91c7\u7528\u9884\u5199\u5f0f\u65e5\u5fd7\uff0c\u4e14\u65e5\u5fd7\u88ab\u5199\u5165\u540e\u5373\u88ab\u4fdd\u6301\u5728\u53ef\u9760\u7684\u5b58\u50a8\u8bbe\u5907\u4e0a\uff0c\u5373\u4f7f\u8282\u70b9\u635f\u574f\u4e0d\u4f1a\u5bfc\u81f4\u65e5\u5fd7\u6570\u636e\u7684\u6d88\u5931\uff1b</li> <li>\u6240\u6709\u8282\u70b9\u4e0d\u4f1a\u6c38\u4e45\u6027\u635f\u574f\uff0c\u5373\u4f7f\u635f\u574f\u540e\u4ecd\u7136\u53ef\u4ee5\u6062\u590d\u3002</li> </ul> <p></p> <p>\u4e8c\u9636\u6bb5\u63d0\u4ea4\u5206\u4e3a\u4e24\u9636\u6bb5\uff1a</p> <ul> <li>\u6295\u7968\u9636\u6bb5\uff08Prepares\uff09</li> <li>\u534f\u8c03\u8005\u5411\u6240\u6709\u53c2\u4e0e\u8005\u8be2\u95ee\u662f\u5426\u53ef\u4ee5\u6267\u884c\u63d0\u4ea4\u64cd\u4f5c\uff0c\u5e76\u5f00\u59cb\u7b49\u5f85\u5404\u53c2\u4e0e\u8005\u7684\u54cd\u5e94\u3002</li> <li>\u53c2\u4e0e\u8005\u6267\u884c\u4e8b\u52a1\u64cd\u4f5c\uff0c\u5982\u679c\u6267\u884c\u6210\u529f\u5c31\u8fd4\u56de Yes \u54cd\u5e94\uff0c\u5982\u679c\u6267\u884c\u5931\u8d25\u5c31\u8fd4\u56de No \u54cd\u5e94\u3002</li> <li>\u5982\u679c\u534f\u8c03\u8005\u63a5\u53d7\u53c2\u4e0e\u8005\u54cd\u5e94\u8d85\u65f6\uff0c\u4e5f\u4f1a\u8ba4\u4e3a\u6267\u884c\u4e8b\u52a1\u64cd\u4f5c\u5931\u8d25\u3002</li> <li>\u63d0\u4ea4\u9636\u6bb5\uff08Commit\uff09</li> <li>\u5982\u679c\u7b2c\u4e00\u9636\u6bb5\u6c47\u603b\u6240\u6709\u53c2\u4e0e\u8005\u90fd\u8fd4\u56de Yes \u54cd\u5e94\uff0c\u534f\u8c03\u8005\u5411\u6240\u6709\u53c2\u4e0e\u8005\u53d1\u51fa\u63d0\u4ea4\u8bf7\u6c42\uff0c\u6240\u6709\u53c2\u4e0e\u8005\u63d0\u4ea4\u4e8b\u52a1\u3002</li> <li>\u5982\u679c\u7b2c\u4e00\u9636\u6bb5\u4e2d\u6709\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u53c2\u4e0e\u8005\u8fd4\u56de No \u54cd\u5e94\uff0c\u534f\u8c03\u8005\u5411\u6240\u6709\u53c2\u4e0e\u8005\u53d1\u51fa\u56de\u6eda\u8bf7\u6c42\uff0c\u6240\u6709\u53c2\u4e0e\u8005\u8fdb\u884c\u56de\u6eda\u64cd\u4f5c\u3002</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u5355\u70b9\u6545\u969c\uff1a\u4e00\u65e6\u534f\u8c03\u8005\u53d1\u751f\u6545\u969c\uff0c\u53c2\u4e0e\u8005\u4f1a\u4e00\u76f4\u963b\u585e\uff0c\u7279\u522b\u662f\u5728\u7b2c\u4e8c\u9636\u6bb5\uff0c\u534f\u8c03\u8005\u6545\u969c\u5bfc\u81f4\u53c2\u4e0e\u8005\u9501\u5b9a\u4e8b\u52a1\u8d44\u6e90\u65e0\u6cd5\u5b8c\u6210\u4e8b\u52a1\u64cd\u4f5c\uff1b</li> <li>\u540c\u6b65\u963b\u585e\uff1a\u6240\u6709\u8282\u70b9\u5728\u6267\u884c\u64cd\u4f5c\u65f6\u90fd\u662f\u540c\u6b65\u963b\u585e\u7684\uff0c\u5f53\u53c2\u4e0e\u8005\u5360\u6709\u516c\u5171\u8d44\u6e90\u65f6\uff0c\u5176\u4ed6\u7b2c\u4e09\u65b9\u8282\u70b9\u8bbf\u95ee\u516c\u5171\u8d44\u6e90\u4e0d\u5f97\u4e0d\u5904\u4e8e\u963b\u585e\u72b6\u6001\uff1b</li> <li>\u6570\u636e\u4e0d\u4e00\u81f4\uff1a\u7b2c\u4e8c\u9636\u6bb5\u7f51\u7edc\u6545\u969c\u7b49\u539f\u56e0\u5bfc\u81f4\u53ea\u901a\u77e5\u90e8\u5206\u53c2\u4e0e\u8005\uff0c\u5bfc\u81f4\u53ea\u6709\u90e8\u5206\u53c2\u4e0e\u8005\u63d0\u4ea4\u4e8b\u52a1\uff0c\u6570\u636e\u4ea7\u751f\u4e0d\u4e00\u81f4\uff1b</li> </ul> <p>\u95ee\u9898\uff1a</p> <ul> <li>\u534f\u8c03\u8005\u5728\u7b2c\u4e8c\u9636\u6bb5\u53d1\u9001\u63d0\u4ea4\u8bf7\u6c42\u4e4b\u540e\u6302\u6389\uff0c\u800c\u552f\u4e00\u63a5\u53d7\u5230\u8fd9\u6761\u6d88\u606f\u7684\u53c2\u4e0e\u8005\u6267\u884c\u4e4b\u540e\u4e5f\u6302\u6389\uff1a</li> <li>\u534f\u8c03\u8005\u901a\u8fc7\u9009\u4e3e\u534f\u8bae\u4ea7\u751f\u65b0\u7684\u534f\u8c03\u8005\uff0c\u4f46\u4e0d\u786e\u5b9a\u5df2\u7ecf\u6267\u884c\u8fc7\u4e8b\u52a1\u7684\u53c2\u4e0e\u8005\u662f\u6267\u884c\u7684\u63d0\u4ea4\u4e8b\u52a1\u8fd8\u662f\u4e2d\u65ad\u4e8b\u52a1\u3002</li> <li>\u534f\u8c03\u8005\u7684\u9884\u5199\u65e5\u5fd7\u53ea\u662f\u672c\u5730\u5b58\u50a8\uff0c\u65e0\u6cd5\u5e94\u7528\u4e8e\u65b0\u7684\u534f\u8c03\u8005\uff08\u53ef\u4ee5\u901a\u8fc7Paxos/Raft \u89e3\u51b3\uff1f\uff09\uff1b</li> </ul>"},{"location":"distributed_consensus/consistency.html#3pc","title":"3PC(\u4e09\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae)","text":"<p>\u65e0\u8bba\u662f 2PC \u8fd8\u662f 3PC \u90fd\u4e0d\u80fd\u4fdd\u8bc1\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u7684\u6570\u636e 100% \u4e00\u81f4\u3002</p> <p>\u89e3\u51b3\u4e24\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae\u7684\u7f3a\u70b9\u800c\u8bbe\u8ba1\u7684\u3002\u4e0e\u4e24\u9636\u6bb5\u63d0\u4ea4\u4e0d\u540c\u7684\u662f\uff0c\u4e09\u9636\u6bb5\u63d0\u4ea4\u662f\u201c\u975e\u963b\u585e\u201d\u534f\u8bae\u3002</p> <ul> <li>\u4f7f\u5f97\u539f\u5148\u5728\u4e24\u9636\u6bb5\u63d0\u4ea4\u4e2d\uff0c\u53c2\u4e0e\u8005\u5728\u6295\u7968\u4e4b\u540e\uff0c\u7531\u4e8e\u534f\u8c03\u8005\u53d1\u751f\u5d29\u6e83\u6216\u9519\u8bef\uff0c\u800c\u5bfc\u81f4\u53c2\u4e0e\u8005\u5904\u4e8e\u65e0\u6cd5\u77e5\u6653\u662f\u5426\u63d0\u4ea4\u6216\u8005\u4e2d\u6b62\u7684\u201c\u4e0d\u786e\u5b9a\u72b6\u6001\u201d\u6240\u4ea7\u751f\u7684\u53ef\u80fd\u76f8\u5f53\u957f\u7684\u5ef6\u65f6\u7684\u95ee\u9898\u5f97\u4ee5\u89e3\u51b3\u3002</li> </ul> <p></p> <p>\u5206\u4e3a\u4e09\u9636\u6bb5\uff1a</p> <ul> <li> <p>CanCommit\uff1a\u534f\u8c03\u8005\u5411\u53c2\u4e0e\u8005\u53d1\u9001 Commit \u8bf7\u6c42\uff0c\u53c2\u4e0e\u8005\u5982\u679c\u53ef\u4ee5\u63d0\u4ea4\u5c31\u8fd4\u56de Yes \u54cd\u5e94\uff0c\u5426\u5219\u8fd4\u56de No \u54cd\u5e94\u3002</p> </li> <li> <p>PreCommit\uff1a\u534f\u8c03\u8005\u6839\u636e\u53c2\u4e0e\u8005\u5728\u8be2\u95ee\u9636\u6bb5\u7684\u54cd\u5e94\u5224\u65ad\u662f\u5426\u6267\u884c\u4e8b\u52a1\u8fd8\u662f\u4e2d\u65ad\u4e8b\u52a1\uff1a</p> </li> <li> <p>\u5982\u679c\u6240\u6709\u53c2\u4e0e\u8005\u90fd\u8fd4\u56de Yes\uff0c\u5219\u6267\u884c\u4e8b\u52a1\u3002</p> </li> <li>\u5982\u679c\u53c2\u4e0e\u8005\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u53c2\u4e0e\u8005\u8fd4\u56de No \u6216\u8005\u8d85\u65f6\uff0c\u5219\u4e2d\u65ad\u4e8b\u52a1\u3002</li> </ul> <p>\u53c2\u4e0e\u8005\u6267\u884c\u5b8c\u64cd\u4f5c\u4e4b\u540e\u8fd4\u56de ACK \u54cd\u5e94\uff0c\u540c\u65f6\u5f00\u59cb\u7b49\u5f85\u6700\u7ec8\u6307\u4ee4\u3002</p> <ul> <li> <p>DoCommit\uff1a\u534f\u8c03\u8005\u6839\u636e\u53c2\u4e0e\u8005\u5728\u51c6\u5907\u9636\u6bb5\u7684\u54cd\u5e94\u5224\u65ad\u662f\u5426\u6267\u884c\u4e8b\u52a1\u8fd8\u662f\u4e2d\u65ad\u4e8b\u52a1</p> </li> <li> <p>\u5982\u679c\u6240\u6709\u53c2\u4e0e\u8005\u90fd\u8fd4\u56de\u6b63\u786e\u7684 ACK \u54cd\u5e94\uff0c\u5219\u63d0\u4ea4\u4e8b\u52a1\u3002</p> </li> <li>\u5982\u679c\u53c2\u4e0e\u8005\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u53c2\u4e0e\u8005\u6536\u5230\u9519\u8bef\u7684 ACK \u54cd\u5e94\u6216\u8005\u8d85\u65f6\uff0c\u5219\u4e2d\u65ad\u4e8b\u52a1\u3002</li> <li>\u5982\u679c\u53c2\u4e0e\u8005\u65e0\u6cd5\u53ca\u65f6\u63a5\u6536\u5230\u6765\u81ea\u534f\u8c03\u8005\u7684\u63d0\u4ea4\u6216\u8005\u4e2d\u65ad\u4e8b\u52a1\u8bf7\u6c42\u65f6\uff0c\u4f1a\u5728\u7b49\u5f85\u8d85\u65f6\u4e4b\u540e\uff0c\u4f1a\u7ee7\u7eed\u8fdb\u884c\u4e8b\u52a1\u63d0\u4ea4\u3002</li> </ul> <p>\u534f\u8c03\u8005\u6536\u5230\u6240\u6709\u53c2\u4e0e\u8005\u7684 ACK \u54cd\u5e94\uff0c\u5b8c\u6210\u4e8b\u52a1\u3002</p> <p>\u4e09\u9636\u6bb5\u63d0\u4ea4\u89e3\u51b3\u4e8c\u9636\u6bb5\u63d0\u4ea4\u4e2d\u5b58\u5728\u7684\u7531\u4e8e\u534f\u8c03\u8005\u548c\u53c2\u4e0e\u8005\u540c\u65f6\u6302\u6389\u53ef\u80fd\u5bfc\u81f4\u7684\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898\u548c\u5355\u70b9\u6545\u969c\u95ee\u9898\uff0c\u5e76\u51cf\u5c11\u963b\u585e\u3002</p> <p>\u4e09\u9636\u6bb5\u63d0\u4ea4\u7684\u95ee\u9898\uff1a\u5728\u63d0\u4ea4\u9636\u6bb5\u5982\u679c\u53d1\u9001\u7684\u662f\u4e2d\u65ad\u4e8b\u52a1\u8bf7\u6c42\uff0c\u4f46\u662f\u7531\u4e8e\u7f51\u7edc\u95ee\u9898\uff0c\u5bfc\u81f4\u90e8\u5206\u53c2\u4e0e\u8005\u6ca1\u6709\u63a5\u5230\u8bf7\u6c42\u3002</p> <ul> <li>\u53c2\u4e0e\u8005\u4f1a\u5728\u7b49\u5f85\u8d85\u65f6\u4e4b\u540e\u6267\u884c\u63d0\u4ea4\u4e8b\u52a1\u64cd\u4f5c\uff0c\u8fd9\u6837\u8fd9\u4e9b\u7531\u4e8e\u7f51\u7edc\u95ee\u9898\u5bfc\u81f4\u63d0\u4ea4\u4e8b\u52a1\u7684\u53c2\u4e0e\u8005\u7684\u6570\u636e\u5c31\u4e0e\u63a5\u53d7\u5230\u4e2d\u65ad\u4e8b\u52a1\u8bf7\u6c42\u7684\u53c2\u4e0e\u8005\u5b58\u5728\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002</li> </ul>"},{"location":"distributed_consensus/consistency.html#mq2pc","title":"\u57fa\u4e8eMQ\u76842PC","text":"<p>RocketMQ \u57284.3.0\u7248\u4e2d\u5df2\u7ecf\u652f\u6301\u5206\u5e03\u5f0f\u4e8b\u52a1\u6d88\u606f\uff0c\u91c7\u7528\u4e862PC\uff08\u4e24\u9636\u6bb5\u63d0\u4ea4\uff09+ \u8865\u507f\u673a\u5236\uff08\u4e8b\u52a1\u72b6\u6001\u56de\u67e5\uff09\u7684\u601d\u60f3\u6765\u5b9e\u73b0\u4e86\u63d0\u4ea4\u4e8b\u52a1\u6d88\u606f\uff0c\u540c\u65f6\u589e\u52a0\u4e00\u4e2a\u8865\u507f\u903b\u8f91\u6765\u5904\u7406\u4e8c\u9636\u6bb5\u8d85\u65f6\u6216\u8005\u5931\u8d25\u7684\u6d88\u606f\u3002</p> <p></p> <p>\u6b63\u5e38\u4e8b\u52a1\u6d88\u606f\u7684\u53d1\u9001\u53ca\u63d0\u4ea4\u7684\u6267\u884c\u6d41\u7a0b\uff1a</p> <ul> <li>\u53d1\u9001 Prepare \u6d88\u606f\u5230\u6d88\u606f\u4e2d\u95f4\u4ef6\u3002</li> <li>\u53d1\u9001\u6210\u529f\u540e\uff0c\u6267\u884c\u672c\u5730\u4e8b\u52a1\u3002</li> <li>\u5982\u679c\u4e8b\u52a1\u6267\u884c\u6210\u529f\uff0c\u5219 Commit\uff0c\u6d88\u606f\u4e2d\u95f4\u4ef6\u5c06\u6d88\u606f\u4e0b\u53d1\u81f3\u6d88\u8d39\u7aef\u3002</li> <li>\u5982\u679c\u4e8b\u52a1\u6267\u884c\u5931\u8d25\uff0c\u5219\u56de\u6eda\uff0c\u6d88\u606f\u4e2d\u95f4\u4ef6\u5c06\u8fd9\u6761 Prepare \u6d88\u606f\u5220\u9664\u3002</li> <li>\u6d88\u8d39\u7aef\u63a5\u6536\u5230\u6d88\u606f\u8fdb\u884c\u6d88\u8d39\uff0c\u5982\u679c\u6d88\u8d39\u5931\u8d25\uff0c\u5219\u4e0d\u65ad\u91cd\u8bd5\u3002</li> </ul> <p>\u4e8b\u52a1\u6d88\u606f\u7684\u8865\u507f\u6d41\u7a0b\uff1a</p> <ul> <li>\u5728\u7f51\u7edc\u95ea\u65ad\u6216\u8005\u662f\u5e94\u7528\u91cd\u542f\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u5bfc\u81f4\u751f\u4ea7\u8005\u53d1\u9001\u7684\u4e8c\u6b21\u786e\u8ba4\u6d88\u606f\u672a\u80fd\u5230\u8fbeBroker\u670d\u52a1\u7aef\uff0c\u7ecf\u8fc7\u56fa\u5b9a\u65f6\u95f4\u540e\uff0cBroker\u670d\u52a1\u7aef\u5c06\u4f1a\u5bf9\u6ca1\u6709Commit/Rollback\u7684\u4e8b\u52a1\u6d88\u606f\uff08pending\u72b6\u6001\u7684\u6d88\u606f\uff09\u8fdb\u884c\u201c\u56de\u67e5\u201d\uff1b</li> <li>\u751f\u4ea7\u8005\u6536\u5230\u56de\u67e5\u6d88\u606f\u540e\uff0c\u68c0\u67e5\u56de\u67e5\u6d88\u606f\u5bf9\u5e94\u7684\u672c\u5730\u4e8b\u52a1\u6267\u884c\u7684\u6700\u7ec8\u7ed3\u679c\uff1b</li> <li>\u751f\u4ea7\u8005\u6839\u636e\u672c\u5730\u4e8b\u52a1\u72b6\u6001\uff0c\u518d\u6b21\u63d0\u4ea4\u4e8c\u6b21\u786e\u8ba4\u7ed9Broker\uff0c\u7136\u540eBroker\u91cd\u65b0\u5bf9\u534a\u4e8b\u52a1\u6d88\u606fCommit\u6216\u8005Rollback\uff1b</li> </ul>"},{"location":"distributed_consensus/consistency.html#_2","title":"\u4e00\u81f4\u6027\u5206\u7c7b","text":"<p>\u5f3a\u4e00\u81f4\u6027\u5305\u62ec\u7ebf\u6027\u4e00\u81f4\u6027\u548c\u987a\u5e8f\u4e00\u81f4\u6027\uff0c\u5176\u4ed6\u7684\u5982\u6700\u7ec8\u4e00\u81f4\u90fd\u662f\u5f31\u4e00\u81f4\u6027\u3002</p> <ul> <li>\u7ebf\u6027\u4e00\u81f4\u6027 Linearizability consistency \uff0c\u4e5f\u53eb\u539f\u5b50\u6027</li> <li>\u987a\u5e8f\u4e00\u81f4\u6027 Sequential consistency</li> <li>\u56e0\u679c\u4e00\u81f4\u6027 Causal consistency</li> <li>\u6700\u7ec8\u4e00\u81f4\u6027 Eventual consistency</li> </ul>"},{"location":"distributed_consensus/consistency.html#_3","title":"\u62dc\u5360\u5ead\u5c06\u519b\u95ee\u9898","text":""},{"location":"distributed_consensus/consistency.html#_4","title":"\u7ecf\u5178\u8d44\u6599","text":"<p>\u300aDistributed systems theory for the distributed systems engineer\u300b\u63a8\u8350 4 \u4efd\u9605\u8bfb\u6750\u6599\u5171\u540c\u6982\u62ec\u6784\u5efa\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u96be\u70b9\uff0c\u4ee5\u53ca\u6240\u6709\u5de5\u7a0b\u5e08\u5fc5\u987b\u514b\u670d\u7684\u6280\u672f\u96be\u9898\u3002</p> <ul> <li>\u300aDistributed Systems for Fun and Profit\u300b</li> <li>\u300aNotes on distributed systems for young bloods\u300b</li> <li>\u300aA Note on Distributed Systems\u300b</li> <li>\u300aThe fallacies of distributed computing\u300b</li> </ul> <p>\u5931\u8d25\u548c\u65f6\u95f4\uff08Failure and Time\uff09\uff1a</p> <ul> <li>\u5206\u5e03\u5f0f\u7cfb\u7edf\u5de5\u7a0b\u5e08\u9762\u4e34\u7684\u5f88\u591a\u56f0\u96be\u90fd\u53ef\u4ee5\u5f52\u548e\u4e8e\u4e24\u4e2a\u6839\u672c\u539f\u56e0\uff1a\u8fdb\u7a0b\u53ef\u80fd\u4f1a\u5931\u8d25\uff1b\u6ca1\u6709\u597d\u65b9\u6cd5\u8868\u660e\u8fdb\u7a0b\u5931\u8d25\u3002</li> </ul> <p>\u300a\u5206\u5e03\u5f0f\u7cfb\u7edf\u539f\u7406\u4e0e\u8303\u578b\u300b\u7cfb\u7edf\u6027\u5730\u5b66\u4e60\u57fa\u7840\u77e5\u8bc6\uff0c\u4e86\u89e3\u7f16\u5199\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u57fa\u672c\u539f\u5219\u548c\u903b\u8f91\u3002</p>"},{"location":"distributed_consensus/distributed_id_generator.html","title":"\u5206\u5e03\u5f0fID\u751f\u6210\u7b97\u6cd5","text":"<p>\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u7ecf\u5e38\u9700\u8981\u5168\u5c40\u552f\u4e00\u7684ID\u4f5c\u4e3a\u6570\u636e\u5e93\u4e3b\u952e\u3002\u5206\u5e03\u5f0fID\u7684\u6838\u5fc3\u9700\u6c42\uff1a</p> <ul> <li>\u5168\u5c40\u552f\u4e00</li> <li>\u8d8b\u52bf\u6709\u5e8f | \u5355\u8c03\u9012\u589e</li> <li>id\u4e0d\u80fd\u8fde\u7eed</li> </ul>"},{"location":"distributed_consensus/distributed_id_generator.html#uuid","title":"UUID","text":"<p>\u4f18\u70b9\uff1a</p> <ul> <li>\u672c\u5730\u751f\u6210ID\uff0c\u4e0d\u9700\u8981\u8fdb\u884c\u8fdc\u7a0b\u8c03\u7528\uff0c\u65f6\u5ef6\u4f4e</li> <li>\u6269\u5c55\u6027\u597d\uff0c\u57fa\u672c\u53ef\u4ee5\u8ba4\u4e3a\u6ca1\u6709\u6027\u80fd\u4e0a\u9650</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u65e0\u6cd5\u4fdd\u8bc1\u8d8b\u52bf\u9012\u589e</li> <li>uuid\u8fc7\u957f\uff0c\u5f80\u5f80\u7528\u5b57\u7b26\u4e32\u8868\u793a\uff0c\u4f5c\u4e3a\u4e3b\u952e\u5efa\u7acb\u7d22\u5f15\u67e5\u8be2\u6548\u7387\u4f4e\uff0c\u5e38\u89c1\u4f18\u5316\u65b9\u6848\u4e3a\u201c\u8f6c\u5316\u4e3a\u4e24\u4e2auint64\u6574\u6570\u5b58\u50a8\u201d\u6216\u8005\u201c\u6298\u534a\u5b58\u50a8\u201d\uff08\u6298\u534a\u540e\u4e0d\u80fd\u4fdd\u8bc1\u552f\u4e00\u6027\uff09</li> </ul>"},{"location":"distributed_consensus/distributed_id_generator.html#id_1","title":"\u6570\u636e\u5e93\u81ea\u589eID","text":"<p>\u4f7f\u7528\u6570\u636e\u5e93\u7684 auto_increment \u6765\u751f\u6210\u5168\u5c40\u552f\u4e00\u9012\u589eID </p> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u7b80\u5355\uff0c\u65e0\u5176\u5b83\u7ec4\u4ef6\u4f9d\u8d56</li> <li>\u80fd\u591f\u4fdd\u8bc1\u552f\u4e00\u6027\u548c\u9012\u589e\u6027</li> <li>\u6b65\u957f\u56fa\u5b9a</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u6269\u5c55\u6027\u5dee\uff0c\u6027\u80fd\u6709\u4e0a\u9650\uff1a\u56e0\u4e3a\u5199\u5165\u662f\u5355\u70b9\uff0c\u6570\u636e\u5e93\u4e3b\u5e93\u7684\u5199\u6027\u80fd\u51b3\u5b9aID\u7684\u751f\u6210\u6027\u80fd\u4e0a\u9650\uff0c\u5e76\u4e14\u96be\u4ee5\u6269\u5c55</li> <li>\u4e3b\u4ece\u5207\u6362\u65f6\u7684\u4e0d\u4e00\u81f4\u53ef\u80fd\u4f1a\u5bfc\u81f4\u91cd\u590d\u53d1\u53f7 </li> <li>\u6570\u636e\u5728\u63d2\u5165\u524d\uff0c\u65e0\u6cd5\u83b7\u5f97ID\u3002\u6570\u636e\u5728\u63d2\u5165\u540e\uff0c\u83b7\u53d6\u7684ID\u867d\u7136\u662f\u552f\u4e00\u7684\uff0c\u4f46\u4e00\u5b9a\u8981\u7b49\u5230\u4e8b\u52a1\u63d0\u4ea4\u540e\uff0cID\u624d\u7b97\u662f\u6709\u6548\u7684\u3002\u6709\u4e9b\u53cc\u5411\u5f15\u7528\u7684\u6570\u636e\uff0c\u4e0d\u5f97\u4e0d\u63d2\u5165\u540e\u518d\u505a\u4e00\u6b21\u66f4\u65b0\uff0c\u6bd4\u8f83\u9ebb\u70e6 </li> </ul> <p>\u6539\u8fdb\u65b9\u6cd5\uff1a</p> <ul> <li>\u6570\u636e\u6c34\u5e73\u5207\u5206\uff0c\u4fdd\u8bc1\u5404\u4e3b\u5e93\u751f\u6210\u7684ID\u4e0d\u91cd\u590d\uff0c\u4f46\u4e0d\u5bb9\u6613\u6269\u5c55\uff0c\u9700\u8981\u63d0\u524d\u89c4\u5212</li> </ul> <p>\u7c7b\u4f3c\u7684\u8fd8\u6709redis\u7684incr\u5b9e\u73b0\u3002</p>"},{"location":"distributed_consensus/distributed_id_generator.html#snowflake","title":"SnowFlake\u7b97\u6cd5","text":"<p>\u91c7\u7528 41bit \u6beb\u79d2\u65f6\u95f4\u6233\uff0c\u52a0\u4e0a10bit \u673a\u5668ID\uff0c\u52a0\u4e0a12bit \u5e8f\u5217\u53f7\uff0c\u7406\u8bba\u4e0a\u6700\u591a\u652f\u63011024\u53f0\u673a\u5668\u6bcf\u79d2\u751f\u62104096000\u4e2a\u5e8f\u5217\u53f7\u3002workerID\u53ef\u4ee5\u901a\u8fc7ZK\u7ba1\u7406\u3002</p> <p>\u4f18\u70b9\uff1a</p> <p>1\uff09\u6beb\u79d2\u6570\u5728\u9ad8\u4f4d\uff0c\u81ea\u589e\u5e8f\u5217\u5728\u4f4e\u4f4d\uff0c\u6574\u4e2aID\u90fd\u662f\u8d8b\u52bf\u9012\u589e\u7684\uff1b</p> <p>2\uff09\u4e0d\u4f9d\u8d56\u6570\u636e\u5e93\u7b49\u7b2c\u4e09\u65b9\u7cfb\u7edf\uff0c\u4ee5\u670d\u52a1\u7684\u65b9\u5f0f\u90e8\u7f72\uff0c\u7a33\u5b9a\u6027\u66f4\u9ad8\uff0c\u751f\u6210ID\u7684\u6027\u80fd\u4e5f\u662f\u975e\u5e38\u9ad8\u7684\uff1b</p> <p>3\uff09\u53ef\u4ee5\u6839\u636e\u81ea\u8eab\u4e1a\u52a1\u7279\u6027\u5206\u914dbit\u4f4d\uff0c\u975e\u5e38\u7075\u6d3b\u3002</p> <p>\u7f3a\u70b9\uff1a</p> <p>\u5f3a\u4f9d\u8d56\u673a\u5668\u65f6\u949f\uff0c\u5982\u679c\u673a\u5668\u4e0a\u65f6\u949f\u56de\u62e8\uff0c\u4f1a\u5bfc\u81f4\u53d1\u53f7\u91cd\u590d\u6216\u8005\u670d\u52a1\u4f1a\u5904\u4e8e\u4e0d\u53ef\u7528\u72b6\u6001\u3002</p>"},{"location":"distributed_consensus/distributed_id_generator.html#leaf-segment","title":"Leaf-Segment","text":"<p>Leaf-segment\u5bf9\u6570\u636e\u5e93\u81ea\u589eID\u65b9\u6848\u505a\u4e86\u5982\u4e0b\u6539\u53d8\uff1a</p> <p>1\uff09\u539f\u65b9\u6848\u6bcf\u6b21\u83b7\u53d6ID\u90fd\u5f97\u8bfb\u5199\u4e00\u6b21\u6570\u636e\u5e93\uff0c\u9020\u6210\u6570\u636e\u5e93\u538b\u529b\u5927\u3002\u6539\u4e3a\u5229\u7528proxy server\u6279\u91cf\u83b7\u53d6\uff0c\u6bcf\u6b21\u83b7\u53d6\u4e00\u4e2asegment(step\u51b3\u5b9a\u5927\u5c0f)\u53f7\u6bb5\u7684\u503c\u3002\u7528\u5b8c\u4e4b\u540e\u518d\u53bb\u6570\u636e\u5e93\u83b7\u53d6\u65b0\u7684\u53f7\u6bb5\uff0c\u53ef\u4ee5\u5927\u5927\u7684\u51cf\u8f7b\u6570\u636e\u5e93\u7684\u538b\u529b\uff1b</p> <p>2\uff09\u5404\u4e2a\u4e1a\u52a1\u4e0d\u540c\u7684\u53d1\u53f7\u9700\u6c42\u7528biz_tag\u5b57\u6bb5\u6765\u533a\u5206\uff0c\u6bcf\u4e2abiz-tag\u7684ID\u83b7\u53d6\u76f8\u4e92\u9694\u79bb\uff0c\u4e92\u4e0d\u5f71\u54cd\u3002\u5982\u679c\u4ee5\u540e\u6709\u6027\u80fd\u9700\u6c42\u9700\u8981\u5bf9\u6570\u636e\u5e93\u6269\u5bb9\uff0c\u4e0d\u9700\u8981\u4e0a\u8ff0\u63cf\u8ff0\u7684\u590d\u6742\u7684\u6269\u5bb9\u64cd\u4f5c\uff0c\u53ea\u9700\u8981\u5bf9biz_tag\u5206\u5e93\u5206\u8868\u5c31\u884c\u3002</p> <p>3\uff09\u53ccbuffer\u7f13\u5b58\uff0c\u7b2c\u4e00\u4e2abuffer\u6d88\u8d39\u5230\u4e00\u5b9a\u7a0b\u5ea6\uff0c\u5f02\u6b65\u7ebf\u7a0b\u83b7\u53d6\u53e6\u4e00\u4e2abuffer\u7684\u53f7\u6bb5\uff1b</p> <p>Leaf-segment\u65b9\u6848\u53ef\u4ee5\u751f\u6210\u8d8b\u52bf\u9012\u589e\u7684ID\uff0c\u540c\u65f6ID\u53f7\u662f\u53ef\u8ba1\u7b97\u7684\uff0c\u4f46\u4e0d\u9002\u7528\u4e8e\u8ba2\u5355ID\u751f\u6210\u573a\u666f </p>"},{"location":"distributed_consensus/lamport_timestamp.html","title":"\u903b\u8f91\u65f6\u949f","text":"<p>\u6bd4\u5982 A\uff0cB\uff0c\u65e5\u5fd7\u670d\u52a1\u5668 \u4e09\u53f0\u673a\u5668\uff0c\u7528\u6237\u53d1\u8d77\u4e00\u4e2a\u8d2d\u4e70\u64cd\u4f5c\uff0c\u9996\u5148\u7b2c\u4e00\u4e2a\u8bf7\u6c42\u5728 Server A \u4e0a\u9762\u521b\u5efa\u4e86\u8ba2\u5355\uff0c\u4e4b\u540e\u652f\u4ed8\u64cd\u4f5c\u5728 Server B \u4e0a\u8fdb\u884c\u3002\u7136\u540e\u4e3a\u4e86\u8bb0\u5f55\u7528\u6237\u64cd\u4f5c\uff0cServer A \u548c Server B \u5f02\u6b65\u53d1\u9001\u65e5\u5fd7\u5199\u5165\u8bf7\u6c42\u5230\u8fbe\u65e5\u5fd7\u670d\u52a1\u5668\u3002\u5047\u8bbe\u4e24\u6761\u65e5\u5fd7\u540c\u65f6\u5230\u8fbe\uff0c\u90a3\u4e48\u65e5\u5fd7\u670d\u52a1\u5668\u8be5\u5982\u4f55\u533a\u5206\u5148\u540e\u987a\u5e8f</p> <p></p> <p>\u7edd\u5bf9\u65f6\u95f4\u6233\u7684\u95ee\u9898\uff1a</p> <ul> <li>\u5373\u4f7f\u5b9a\u671f\u8fdb\u884c NTP \u65f6\u95f4\u540c\u6b65\uff0c\u4e0d\u540c\u673a\u5668\u5185\u90e8\u65f6\u95f4\u8ba1\u7b97\u4e5f\u4f1a\u4ea7\u751f\u8bef\u5dee\uff0c\u53ef\u80fd\u6709\u4e9b\u673a\u5668\u65f6\u95f4\u524d\u8fdb\u7684\u5feb\u70b9\uff0c\u6709\u4e9b\u673a\u5668\u4f1a\u6162\u70b9\uff0c\u8fd9\u79cd\u73b0\u8c61\u4e5f\u53eb Clock Drift\uff1b</li> </ul>"},{"location":"distributed_consensus/lamport_timestamp.html#logic-clock","title":"Logic Clock","text":"<p>\u5f15\u5165\u903b\u8f91\u65f6\u95f4\uff0c\u5176\u4e2d Logic Clock \u4e2d\u6700\u51fa\u540d\u7684\u5c31\u662f <code>Lamport Timestamp</code>\u3002\u901a\u8fc7\u903b\u8f91\u65f6\u95f4\uff0c\u6211\u4eec\u53ef\u4ee5\u5224\u65ad\u4e0d\u540c\u4e8b\u4ef6\u7684\u56e0\u679c\u987a\u5e8f\u5173\u7cfb\u3002</p> <p>\u903b\u8f91\u65f6\u949f\u6307\u7684\u662f\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u7528\u4e8e\u533a\u5206\u4e8b\u4ef6\u7684\u53d1\u751f\u987a\u5e8f\u7684\u65f6\u95f4\u673a\u5236\u3002</p> <p>\u903b\u8f91\u65f6\u949f\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u7684\u65f6\u5e8f\u95ee\u9898\uff0c\u5373\u5982\u4f55\u5b9a\u4e49a\u5728b\u4e4b\u524d\u53d1\u751f\u3002</p> <p>\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u6309\u662f\u5426\u5b58\u5728\u8282\u70b9\u4ea4\u4e92\u53ef\u5206\u4e3a\u4e09\u7c7b\u4e8b\u4ef6\uff0c\u4e00\u7c7b\u53d1\u751f\u4e8e\u8282\u70b9\u5185\u90e8\uff0c\u4e8c\u662f\u53d1\u9001\u4e8b\u4ef6\uff0c\u4e09\u662f\u63a5\u6536\u4e8b\u4ef6\u3002</p> <p>\u903b\u8f91\u65f6\u949f C \u8bf4\u660e\uff1a</p> <ul> <li>\u5bf9\u4e8e\u4efb\u610f\u4e8b\u4ef6a, b\uff1a\u5982\u679c\\(a -&gt; b\\)\uff08<code>-&gt;</code>\u8868\u793aa\u5148\u4e8eb\u53d1\u751f\uff09\uff0c\u90a3\u4e48\\(C(a) &lt; C(b)\\)\uff1b\u53cd\u4e4b\u4e0d\u7136,\uff0c\u56e0\u4e3a\u6709\u53ef\u80fd\u662f\u5e76\u53d1\u4e8b\u4ef6 </li> <li>\u5982\u679ca\u548cb\u90fd\u662f\u8fdb\u7a0bPi\u91cc\u7684\u4e8b\u4ef6\uff0c\u5e76\u4e14a\u5728b\u4e4b\u524d\uff0c\u90a3\u4e48Ci(a) &lt; Ci(b)\uff1b</li> <li>\u5982\u679ca\u662f\u8fdb\u7a0bPi\u91cc\u5173\u4e8e\u67d0\u6d88\u606f\u7684\u53d1\u9001\u4e8b\u4ef6\uff0cb\u662f\u53e6\u4e00\u8fdb\u7a0bPj\u91cc\u5173\u4e8e\u8be5\u6d88\u606f\u7684\u63a5\u6536\u4e8b\u4ef6\uff0c\u90a3\u4e48Ci(a) &lt; Cj(b)\uff1b</li> </ul> <p>\u504f\u5e8f\uff1a</p> <ul> <li>\u6307\u5b58\u5728\u201c\u5e8f\u201d\u8fd9\u4e2a\u6982\u5ff5\uff0c\u6ee1\u8db3\u81ea\u53cd\u6027\u3001\u53cd\u5bf9\u79f0\u6027\u548c\u4f20\u9012\u6027\uff1b</li> <li>\u4e0d\u662f\u4efb\u4f55\u4e24\u4e2a\u5143\u7d20\u4e4b\u95f4\u90fd\u6709\u8fd9\u4e2a\u5e8f\u7684\u5148\u540e\u5173\u7cfb\uff1b</li> <li>\u6bd4\u5982\u96c6\u5408\u4e4b\u95f4\u7684\u5305\u542b\u5173\u7cfb\uff0c\u5c31\u662f\u4e00\u4e2a\u504f\u5e8f\u5173\u7cfb\uff0c\u4f46\u5e76\u4e0d\u662f\u4efb\u4f55\u4e24\u4e2a\u96c6\u5408\u4e4b\u95f4\u90fd\u5b58\u5728\u5305\u542b\u5173\u7cfb\u3002</li> </ul>"},{"location":"distributed_consensus/lamport_timestamp.html#lamport-timestamp","title":"Lamport Timestamp","text":"<p>Lamport\u903b\u8f91\u65f6\u949f\u53ea\u4fdd\u8bc1\u56e0\u679c\u5173\u7cfb\uff08\u504f\u5e8f\uff09\u7684\u6b63\u786e\u6027\uff0c\u4e0d\u4fdd\u8bc1\u7edd\u5bf9\u65f6\u5e8f\u7684\u6b63\u786e\u6027\u3002</p> <p>Lamport Timestamp \u662f\u4e00\u79cd\u8861\u91cf\u65f6\u95f4\u548c\u56e0\u679c\u5173\u7cfb\u7684\u65b9\u6cd5\uff0c\u7b97\u6cd5\u7684\u5b9e\u73b0\u9075\u5faa\u4ee5\u4e0b\u89c4\u5219\uff1a</p> <ul> <li>\u6bcf\u4e00\u53f0\u673a\u5668\u5185\u90e8\u90fd\u6709\u4e00\u4e2a\u65f6\u95f4\u6233\uff08Timestamp\uff09\uff0c\u521d\u59cb\u503c\u4e3a 0\u3002</li> <li>\u673a\u5668\u6267\u884c\u4e00\u4e2a\u4e8b\u4ef6\uff08event\uff09\u4e4b\u540e\uff0c\u8be5\u673a\u5668\u7684 timestamp + 1\u3002</li> <li>\u5f53\u673a\u5668\u53d1\u9001\u4fe1\u606f\uff08message\uff09\u7ed9\u53e6\u4e00\u53f0\u673a\u5668\uff0c\u5b83\u4f1a\u9644\u5e26\u4e0a\u81ea\u5df1\u7684\u65f6\u95f4\u6233\uff0c\u5982  \u3002 <li>\u5f53\u673a\u5668\u63a5\u53d7\u5230\u4e00\u6761 message\uff0c\u5b83\u4f1a\u5c06\u672c\u673a\u7684 timestamp \u548c message \u7684 timestamp \u8fdb\u884c\u5bf9\u6bd4\uff0c\u9009\u53d6\u5927\u7684 timestamp \u5e76 +1\u3002</li> <p></p> <p>\u5982\u679ca\u53d1\u751f\u5728b\u4e4b\u524d(happened before)\uff0c\u8bb0\u4f5c a -&gt; b\uff0c\u5219\u6709C(a) &lt; C(b)\u3002</p> <p>\u5982\u679cC(a) &lt; C(b)\uff0c\u5e76\u4e0d\u80fd\u8bf4\u660ea -&gt; b\uff0c\u4e5f\u5c31\u662f\u8bf4C(a) &lt; C(b)\u662fa -&gt; b\u7684\u5fc5\u8981\u4e0d\u5145\u5206\u6761\u4ef6\uff0c\u5373Lamport\u903b\u8f91\u65f6\u949f\u53ea\u5177\u5907\u504f\u5e8f\u5173\u7cfb\u3002</p> <p>\u5982\u4f55\u5f97\u5230\u5168\u5e8f\u5173\u7cfb\uff1a</p> <ul> <li>\u5229\u7528\u7ed9\u8fdb\u7a0b\u7f16\u53f7\uff0c\u5229\u7528\u8fdb\u7a0b\u7f16\u53f7\u7684\u5927\u5c0f\u6765\u6392\u5e8f\uff1b</li> <li>\u5047\u8bbea\u3001b\u5206\u522b\u5728\u8282\u70b9P\u3001Q\u4e0a\u53d1\u751f\uff0cPi\u3001Qj\u5206\u522b\u8868\u793a\u6211\u4eec\u7ed9P\u3001Q\u7684\u7f16\u53f7\uff0c\u5982\u679c C(a) = C(b) \u5e76\u4e14 Pi &lt; Qj\uff0c\u540c\u6837\u5b9a\u4e49\u4e3aa\u53d1\u751f\u5728b\u4e4b\u524d\uff0c\u8bb0\u4f5c a =&gt; b\u3002</li> <li>Lamport\u903b\u8f91\u65f6\u949f\u662f\u4e00\u4e2a\u6b63\u786e\u7684\u7b97\u6cd5\uff0c\u5373\u6709\u56e0\u679c\u5173\u7cfb\u7684\u4e8b\u4ef6\u65f6\u5e8f\u4e0d\u4f1a\u9519\uff0c\u4f46\u5e76\u4e0d\u662f\u4e00\u4e2a\u516c\u5e73\u7684\u7b97\u6cd5\uff0c\u5373\u6ca1\u6709\u56e0\u679c\u5173\u7cfb\u7684\u4e8b\u4ef6\u65f6\u5e8f\u4e0d\u4e00\u5b9a\u7b26\u5408\u5b9e\u9645\u60c5\u51b5\u3002</li> </ul>"},{"location":"distributed_consensus/lamport_timestamp.html#vector-clock","title":"Vector Clock","text":"<p>Lamport\u65f6\u95f4\u6233\u5e2e\u52a9\u6211\u4eec\u5f97\u5230\u4e8b\u4ef6\u987a\u5e8f\u5173\u7cfb\uff0c\u4f46\u8fd8\u6709\u4e00\u79cd\u987a\u5e8f\u5173\u7cfb\u4e0d\u80fd\u7528Lamport\u65f6\u95f4\u6233\u5f88\u597d\u5730\u8868\u793a\u51fa\u6765\uff0c\u90a3\u5c31\u662f\u540c\u65f6\u53d1\u751f\u5173\u7cfb(concurrent)\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u4f60\u5176\u5b9e\u65e0\u6cd5\u5355\u7eaf\u7684\u901a\u8fc7 logic clock \u6bd4\u8f83\u6765\u5224\u65ad Process 1 \u4e2d\u7684\u4e8b\u4ef6 3 \u548c Process 2 \u4e2d\u7684\u4e8b\u4ef6 8 \u662f\u5426\u6709\u5173\u7cfb\u3002</p> <p></p> <p>\u5982\u679c\u4e8b\u4ef6 3 \u6267\u884c\u65f6\u95f4\u5ef6\u8fdf\u51e0\u79d2\uff0c\u8fd9\u4e0d\u4f1a\u5f71\u54cd\u5230\u4e8b\u4ef6 8\u3002\u6240\u4ee5\u4e24\u4e2a\u4e8b\u4ef6\u4e92\u4e0d\u5e72\u6d89\uff0c\u4e3a\u4e86\u5224\u65ad\u4e24\u4e2a\u4e8b\u4ef6\u662f\u5426\u4e3a\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u5f15\u5165\u4e86 Vector Clock\uff08\u5411\u91cf\u903b\u8f91\u65f6\u95f4\uff09\u3002</p>"},{"location":"distributed_consensus/lamport_timestamp.html#_2","title":"\u7b97\u6cd5\u5b9e\u73b0","text":"<p>Vector Clock \u662f\u901a\u8fc7\u5411\u91cf\uff08\u6570\u7ec4\uff09\u5305\u542b\u4e86\u4e00\u7ec4 Logic Clock\uff0c\u91cc\u9762\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u662f\u4e00\u4e2a Logic Clock\u3002\u5982\u4e0a\u56fe\uff0c\u6211\u4eec\u6709 3 \u53f0\u673a\u5668\uff0c\u90a3\u4e48 Vector Clock \u5c31\u5305\u542b\u4e09\u4e2a\u5143\u7d20\uff0c\u6bcf\u4e00\u4e2a\u5143\u7d20\u7684\u7d22\u5f15\uff08index\uff09\u6307\u5411\u81ea\u5df1\u673a\u5668\u7684\u7d22\u5f15\u3002</p> <ul> <li>\u6bcf\u4e00\u53f0\u673a\u5668\u90fd\u521d\u59cb\u5316\u6240\u6709\u7684 timestamp \u4e3a 0\u3002\u4f8b\u5982\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u6bcf\u4e00\u53f0\u673a\u5668\u521d\u59cb\u7684 Vector Clock \u5747\u4e3a <code>[0, 0, 0]</code> \u3002</li> <li>\u5f53\u673a\u5668\u5904\u7406\u4e00\u4e2a event\uff0c\u5b83\u4f1a\u5728\u5411\u91cf\u4e2d\u5c06\u548c\u81ea\u5df1\u7d22\u5f15\u76f8\u540c\u7684\u5143\u7d20\u7684 timestamp + 1\u3002\u4f8b\u5982 1 \u53f7 \u673a\u5668\u5904\u7406\u4e86\u4e00\u4e2a event\uff0c\u90a3\u4e48 1 \u53f7\u673a\u5668\u7684 Vector Clock \u53d8\u4e3a <code>[1, 0, 0]</code> \u3002</li> <li>\u6bcf\u5f53\u53d1\u9001 message \u65f6\uff0c\u5b83\u4f1a\u5c06\u5411\u91cf\u4e2d\u81ea\u5df1\u7684 timestamp + 1\uff0c\u5e76\u9644\u5e26\u5728 message \u4e2d\u8fdb\u884c\u53d1\u9001\u3002\u5982 **** \u3002</li> <li>\u5f53\u4e00\u53f0\u673a\u5668\u63a5\u6536\u5230 message \u65f6\uff0c\u5b83\u4f1a\u628a\u81ea\u5df1\u7684 Vector Clock \u548c message \u4e2d\u7684 Vector Clock \u8fdb\u884c\u9010\u4e00\u5bf9\u6bd4\uff08\u6bcf\u4e00\u4e2a timestamp \u9010\u4e00\u5bf9\u6bd4\uff09\uff0c\u5e76\u5c06 timestamp \u66f4\u65b0\u4e3a\u66f4\u5927\u7684\u90a3\u4e2a\uff08\u7c7b\u4f3c\u4e8e Lamport Timestamp \u7684\u64cd\u4f5c\uff09\u3002\u7136\u540e\u5b83\u4f1a\u5bf9\u4ee3\u8868\u81ea\u5df1\u7684 timestamp + 1\u3002</li> </ul> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>2020-05-01-8ndGfw</p> <p>\u7531\u6b64\u6211\u4eec\u4e5f\u53ef\u4ee5\u77e5\u9053\uff0c\u5982\u679c  \uff0c\u90a3\u4e48  \u7684 Vector Clock \u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u4f1a\u5c0f\u4e8e  \u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u3002</p> <p>\u5224\u65ad\u4e24\u4e2a\u4e8b\u4ef6\u662f\u5426\u5e76\u884c\u6216\u72ec\u7acb</p> <p>\u56de\u5230\u521a\u521a\u5224\u65ad\u4e24\u4e2a\u4e8b\u4ef6\u662f\u4e0d\u662f\u6709\u5173\u8054\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230 Process 1 \u4e2d\u7684 <code>[3, 0, 0]</code> \u548c Process 2 \u4e2d\u7684 <code>[2, 4, 2]</code> \uff0c\u5176\u4e2d 3 &gt; 2 \u800c 0 &lt; 4\uff0c0 &lt; 2 \u3002\u6709\u4e9b timestamp \u5927\u4e8e\u5bf9\u65b9\uff0c\u800c\u6709\u4e9b timestamp \u53c8\u5c0f\u4e8e\u5bf9\u65b9\uff0c\u7531\u6b64\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5\u8fd9\u4e24\u4e2a\u4e8b\u4ef6\u662f\u4e92\u4e0d\u76f8\u5e72\u7684\u3002</p>"},{"location":"distributed_consensus/lamport_timestamp.html#_3","title":"\u7f3a\u9677","text":""},{"location":"distributed_consensus/lamport_timestamp.html#scale","title":"\u7cfb\u7edf\u4f38\u7f29\uff08Scale\uff09\u7f3a\u9677","text":"<p>\u5176\u5b9e Vector Clock \u5bf9\u8d44\u6e90\u7684\u4f38\u7f29\u652f\u6301\u5e76\u4e0d\u662f\u5f88\u597d\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u4e00\u4e2a key \u6765\u8bf4\uff0c\u968f\u7740\u670d\u52a1\u5668\u6570\u91cf\u7684\u589e\u52a0\uff0cVector Clock \u4e2d\u5411\u91cf\u7684\u5143\u7d20\u4e5f\u540c\u6837\u589e\u957f\u3002\u5047\u8bbe\u96c6\u7fa4\u6709 1000 \u53f0\u673a\u5668\uff0c\u6bcf\u6b21\u4f20\u9012\u4fe1\u606f\u65f6\u90fd\u8981\u643a\u5e26\u8fd9\u4e2a\u957f\u5ea6\u4e3a 1000 \u7684 Vector\uff0c\u8fd9\u4e2a\u6027\u80fd\u4e0d\u592a\u597d\u63a5\u53d7\u3002</p>"},{"location":"distributed_consensus/lamport_timestamp.html#_4","title":"\u975e\u552f\u4e00\u7f3a\u9677","text":"<p>\u5728\u6b63\u5e38\u7684\u7cfb\u7edf\u4e0b\u9762\uff0c\u5047\u8bbe\u6240\u6709\u7684\u6d88\u606f\u90fd\u662f\u6709\u5e8f\u7684\uff08\u5373\u540c\u4e00\u53f0\u673a\u5668\u53d1\u9001 \u6d88\u606f 1 \u548c 2 \u5230\u53e6\u4e00\u53f0\u673a\u5668\uff0c\u53e6\u4e00\u53f0\u673a\u5668\u4e5f\u4f1a\u5148\u63a5\u6536\u5230\u6d88\u606f 1 \u518d\u63a5\u6536\u6d88\u606f 2\uff09\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u6bcf\u4e00\u53f0\u673a\u5668\u7684 Vector Clock \u6765\u6062\u590d\u5b83\u4eec\u4e4b\u95f4\u7684\u8ba1\u7b97\uff08computation\uff09\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e00\u79cd\u8ba1\u7b97\u90fd\u6709\u7740\u5bf9\u5e94\u81ea\u5df1\u72ec\u4e00\u65e0\u4e8c\u7684 Vector Clock\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u6d88\u606f\u4e0d\u662f\u6709\u5e8f\u7684\uff0c\u6d88\u606f\u4e4b\u95f4\u4f1a\u2018\u8d85\u8f66\u2018\uff08overtaking\uff09\uff0c\u90a3\u4e48\u95ee\u9898\u5c31\u6765\u4e86\uff0c\u770b\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5927\u5bb6\u770b\u770b\u5de6\u53f3\u4e24\u5f20\u56fe\uff0c\u4e24\u79cd\u4e0d\u4e00\u6837\u7684\u8ba1\u7b97\u65b9\u5f0f\uff0c\u4f46\u662f\u6700\u7ec8  \u548c  \u4e0a\u9762\u4ea7\u751f\u4e86\u76f8\u540c\u7684 Vector Clock\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u76f8\u540c\u7684 Vector Clock \u5e76\u4e0d\u4ee3\u8868\u552f\u4e00\u7684 computation\u3002</p> <p></p> <p>\u8fd9\u5f20\u56fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u770b  \u8282\u70b9\u4e2d\u7684 \uff0c\u6211\u4eec\u65e0\u6cd5\u5224\u65ad\u8fd9\u4e2a  \u662f\u4ece  \u90a3\u8fb9\u7684  \u4f20\u9012\u8fc7\u6765\u8fd8\u662f  \u81ea\u5df1\u5904\u7406\u4e86\u4e00\u4e2a\u4e8b\u4ef6\uff0c\u5728\u81ea\u5df1  \u7684\u57fa\u7840\u4e0a\u9762 +1 \u3002</p> <p>\u89e3\u51b3\u529e\u6cd5 1</p> <p>\u5728 Vector Clock \u4e2d\u6dfb\u52a0\u4e8b\u4ef6\u7c7b\u578b\uff0c\u4f8b\u5982\u7528\u5185\u90e8\uff08internal\uff09\uff0c\u53d1\u9001\uff08send\uff09\uff0c\u63a5\u6536\uff08receive\uff093 \u79cd\u4e8b\u4ef6\u8868\u660e Vector Clock\u3002\u4f46\u662f\u8fd9\u6837\u7684\u8bdd\u8fd8\u662f\u6709\u95ee\u9898\uff0c</p> <p></p> <p>\u6211\u4eec\u6807\u660e\u4e86 send \u548c receive \u4e24\u79cd\u4e8b\u4ef6\uff0c\u4f46\u662f\u7ed3\u679c\u8fd8\u662f\u4e0d\u540c\u7684 computation \u4ea7\u751f\u4e86\u76f8\u540c\u7684 Vector Clock\u3002</p> <p>\u89e3\u51b3\u529e\u6cd5 2</p> <p>\u5c06 Vector Clock \u6539\u4e3a\u65e2\u5305\u542b\u63a5\u6536\u5230\u6d88\u606f\u7684\u65f6\u95f4\u548c\u672c\u5730\u65f6\u95f4\u3002\u4f8b\u5982\u4e0b\u9762\u8fd9\u4e2a\u56fe\uff1a</p> <p></p> <p>\u5c06\u5de6\u8fb9\u56fe\u6539\u4e3a  \uff0c\u53f3\u8fb9\u56fe\u4e2d\u53d8\u4e3a  \u3002</p> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u6cd5\uff0c\u6211\u4eec\u80fd\u591f\u786e\u5b9a\u6bcf\u4e00\u79cd computation \u6709\u7740\u552f\u4e00\u7684 Vector Clock\u3002\u867d\u7136\u8fd9\u79cd\u4f1a\u5bfc\u81f4 Vector Clock \u4f53\u79ef\u589e\u957f\u4e86\u4e00\u500d\u3002</p> <p>\u5f53\u7136\u8fd9\u79cd\u65b9\u6cd5\u4e5f\u4e0d\u4e00\u5b9a\u5b8c\u5168\u9700\u8981\uff0c\u56e0\u4e3a\u53ea\u8981\u6211\u4eec\u80fd\u591f\u4fdd\u8bc1\u6d88\u606f\u53d1\u9001\u5230\u8fbe\u7684\u6709\u5e8f\uff0c\u5373\u4e0d\u4ea7\u751f\u6d88\u606f\u8d85\u8f66\uff08Overtaking\uff09\u7684\u60c5\u51b5\u4e0b\uff0c\u539f\u6765\u7684 Vector Clock \u4e5f\u591f\u7528\u4e86</p>"},{"location":"distributed_consensus/raft_paper.html","title":"Raft \u7b97\u6cd5","text":"<p>\u590d\u5236\u72b6\u6001\u673a\uff08Replicated State Machine\uff09\uff1a\u96c6\u7fa4\u4e2d\u7684\u6bcf\u53f0\u673a\u5668\u7684\u72b6\u6001\u673a\uff0c\u901a\u8fc7\u6267\u884c\u76f8\u540c\u7684\u65e5\u5fd7\u5e8f\u5217\uff0c\u5c06\u8fd0\u7b97\u5f97\u5230\u4e00\u81f4\u7684\u6700\u7ec8\u72b6\u6001\u3002</p> <p>Raft \u5b9e\u73b0\u4e00\u81f4\u6027\u7684\u65b9\u5f0f\u662f\uff1a\u9996\u5148\u9009\u4e3e\u51fa\u4e00\u4e2a\u96c6\u7fa4\u9886\u5bfc\u8005\uff0c\u7136\u540e\u8ba9\u5b83\u5168\u6743\u7ba1\u7406\u65e5\u5fd7\u3002</p> <p>\u8282\u70b9\u7684\u72b6\u6001\uff1aLeader\u3001Follower\u548cCandidate\u3002\u72b6\u6001\u6d41\u8f6c\u56fe\u793a\uff1a</p> <p></p> <p>Raft \u628a\u65f6\u95f4\u5206\u5272\u6210\u4efb\u610f\u957f\u5ea6\u7684\u4efb\u671f\uff08term\uff0c\u4f5c\u4e3a\u903b\u8f91\u65f6\u949f\uff09\uff0c\u4efb\u671f\u7528\u8fde\u7eed\u7684\u6574\u6570\u6807\u8bb0\uff0c\u6bcf\u4e00\u6bb5\u4efb\u671f\u4ece\u4e00\u6b21\u9009\u4e3e\u5f00\u59cb\uff0c\u4e00\u4e2a\u6216\u8005\u591a\u4e2a candidate \u5c1d\u8bd5\u6210\u4e3a leader \uff1a</p> <ul> <li>\u5982\u679c\u4e00\u4e2a candidate \u8d62\u5f97\u9009\u4e3e\uff0c\u7136\u540e\u4ed6\u5c31\u5728\u8be5\u4efb\u671f\u5269\u4e0b\u7684\u65f6\u95f4\u91cc\u5145\u5f53 leader \uff1b</li> <li>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4e00\u6b21\u9009\u4e3e\u65e0\u6cd5\u9009\u51fa leader \u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e00\u4efb\u671f\u4f1a\u4ee5\u6ca1\u6709 leader \u7ed3\u675f\uff1b</li> <li>\u4e00\u4e2a\u65b0\u7684\u4efb\u671f\uff08\u5305\u542b\u4e00\u6b21\u65b0\u7684\u9009\u4e3e\uff09\u4f1a\u5f88\u5feb\u91cd\u65b0\u5f00\u59cb\uff1b</li> <li>Raft \u4fdd\u8bc1\u4e86\u5728\u4efb\u610f\u4e00\u4e2a\u4efb\u671f\u5185\uff0c\u6700\u591a\u53ea\u6709\u4e00\u4e2a leader \u3002</li> </ul> <p></p> <p>\u6bcf\u4e00\u4e2a\u670d\u52a1\u5668\u8282\u70b9\u5b58\u50a8\u4e00\u4e2a\u5f53\u524d\u4efb\u671f\u53f7\uff0c\u8be5\u7f16\u53f7\u968f\u7740\u65f6\u95f4\u5355\u8c03\u9012\u589e\uff1a</p> <ul> <li>\u670d\u52a1\u5668\u4e4b\u95f4\u901a\u4fe1\u7684\u65f6\u5019\u4f1a\u4ea4\u6362\u5f53\u524d\u4efb\u671f\u53f7\uff1a</li> <li>\u5982\u679c\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u5f53\u524d\u4efb\u671f\u53f7\u6bd4\u5176\u4ed6\u7684\u5c0f\uff0c\u8be5\u670d\u52a1\u5668\u4f1a\u5c06\u81ea\u5df1\u7684\u4efb\u671f\u53f7\u66f4\u65b0\u4e3a\u8f83\u5927\u7684\u90a3\u4e2a\u503c\uff1b</li> <li>\u5982\u679c\u4e00\u4e2a candidate \u6216\u8005 leader \u53d1\u73b0\u81ea\u5df1\u7684\u4efb\u671f\u53f7\u8fc7\u671f\u4e86\uff0c\u5b83\u4f1a\u7acb\u5373\u56de\u5230 follower \u72b6\u6001\uff1b</li> <li>\u5982\u679c\u4e00\u4e2a\u8282\u70b9\u63a5\u6536\u5230\u4e00\u4e2a\u5305\u542b\u8fc7\u671f\u7684\u4efb\u671f\u53f7\u7684\u8bf7\u6c42\uff0c\u5b83\u4f1a\u76f4\u63a5\u62d2\u7edd\u8fd9\u4e2a\u8bf7\u6c42\u3002</li> </ul>"},{"location":"distributed_consensus/raft_paper.html#_1","title":"\u72b6\u6001","text":""},{"location":"distributed_consensus/raft_paper.html#follower","title":"Follower","text":"<ul> <li>\u8282\u70b9\u5f00\u59cb\u542f\u52a8\u65f6\uff0c\u8d77\u59cb\u72b6\u6001\u4e3aFollower\uff0c\u53ea\u8981\u80fd\u4eceleader\u6216\u8005candidate\u63a5\u6536\u6d88\u606f\uff0c\u5219\u4e00\u76f4\u4fdd\u6301\u72b6\u6001\u4e3afollower\uff1b</li> <li>\u54cd\u5e94candidates\u548cleader\u7684Rpc\uff1b</li> <li>Client\u8bf7\u6c42follower\uff0cfollower\u4f1a\u91cd\u5b9a\u5411\u7ed9leader\uff1b</li> <li>\u5982\u679c\u5728\u9009\u4e3e\u8d85\u65f6\u65f6\u95f4\u5185\u6ca1\u6709\u6536\u5230\u73b0\u4efbLeader\u7684AppendEntries\u7684RPC\u6216\u6388\u4e88\u5019\u9009\u4eba\u6295\u7968\u6743\uff1f\uff1f\u5c06\u81ea\u8eab\u72b6\u6001\u8f6c\u6362\u4e3aCandidate\uff1b</li> </ul>"},{"location":"distributed_consensus/raft_paper.html#candidate","title":"Candidate","text":"<ul> <li>\u72b6\u6001\u53ea\u5b58\u5728<code>Leader</code>\u9009\u4e3e\u671f\u95f4\uff1b</li> </ul>"},{"location":"distributed_consensus/raft_paper.html#leader","title":"Leader","text":"<ul> <li>\u5468\u671f\u6027\u5411Follower\u53d1\u9001\u5fc3\u8df3\uff08\u4e0d\u5305\u542b\u65e5\u5fd7\u6761\u76ee\u7684AppendEntires RPC\uff09\uff0c\u7ef4\u6301Leader\u72b6\u6001\uff1b</li> </ul>"},{"location":"distributed_consensus/raft_paper.html#_2","title":"\u9886\u5bfc\u8005\u9009\u4e3e","text":"<p>Follower -&gt; Condidate </p> <ul> <li> <p>\u589e\u52a0\u81ea\u5df1\u7684\u5f53\u524d\u4efb\u671f\u53f7\uff1b</p> </li> <li> <p>\u6295\u7968\u7ed9\u81ea\u5df1\uff1b</p> </li> <li> <p>\u5e76\u884c\u5730\u5411\u96c6\u7fa4\u4e2d\u7684\u5176\u4ed6\u670d\u52a1\u5668\u8282\u70b9\u53d1\u9001 RequestVote RPC\uff08\u8ba9\u5176\u4ed6\u670d\u52a1\u5668\u8282\u70b9\u6295\u7968\u7ed9\u5b83\uff09\uff1b</p> </li> <li> <p>\u5bf9\u4e8e\u540c\u4e00\u4e2a\u4efb\u671f\uff0c\u6bcf\u4e2a\u670d\u52a1\u5668\u8282\u70b9\u53ea\u4f1a\u6295\u7ed9\u4e00\u4e2a candidate \uff0c\u6309\u7167\u5148\u6765\u5148\u670d\u52a1\uff08first-come-first-served\uff09\u7684\u539f\u5219\uff1b</p> </li> <li> <p>\u4e00\u76f4\u4fdd\u6301candidate\u72b6\u6001\uff0c\u76f4\u5230\uff1a</p> </li> <li> <p>\u81ea\u5df1\u8d62\u5f97\u4e86\u8fd9\u6b21\u7684\u9009\u4e3e\uff08\u6536\u5230\u8fc7\u534a\u7684\u6295\u7968\uff09\uff1b</p> <ul> <li>\u72b6\u6001\u53d8\u4e3aLeader\uff0c\u4f1a\u5411\u5176\u4ed6\u7684\u670d\u52a1\u5668\u8282\u70b9\u53d1\u9001\u5fc3\u8df3\u6d88\u606f\u6765\u786e\u5b9a\u81ea\u5df1\u7684\u5730\u4f4d\u5e76\u963b\u6b62\u65b0\u7684\u9009\u4e3e\u3002</li> <li>\u5176\u4ed6\u7684\u670d\u52a1\u5668\u8282\u70b9\u6210\u4e3a leader\uff1b</li> <li>\u4f1a\u6536\u5230\u53e6\u4e00\u4e2a\u58f0\u79f0\u81ea\u5df1\u662f leader \u7684\u670d\u52a1\u5668\u8282\u70b9\u53d1\u6765\u7684 AppendEntries RPC \uff1b</li> <li>\u5982\u679c\u8fd9\u4e2a leader \u7684\u4efb\u671f\u53f7\uff08\u5305\u542b\u5728RPC\u4e2d\uff09\u4e0d\u5c0f\u4e8e candidate \u5f53\u524d\u7684\u4efb\u671f\u53f7\uff0c\u90a3\u4e48 candidate \u4f1a\u627f\u8ba4\u8be5 leader \u7684\u5408\u6cd5\u5730\u4f4d\u5e76\u56de\u5230 follower \u72b6\u6001\uff1b</li> <li>\u5982\u679c RPC \u4e2d\u7684\u4efb\u671f\u53f7\u6bd4\u81ea\u5df1\u7684\u5c0f\uff0c\u90a3\u4e48 candidate \u5c31\u4f1a\u62d2\u7edd\u8fd9\u6b21\u7684 RPC \u5e76\u4e14\u7ee7\u7eed\u4fdd\u6301 candidate \u72b6\u6001\u3002</li> <li>\u4e00\u6bb5\u65f6\u95f4\u4e4b\u540e\u6ca1\u6709\u4efb\u4f55\u83b7\u80dc\u8005\uff0c\u5982\u6709\u591a\u4e2a follower \u540c\u65f6\u6210\u4e3a candidate \uff0c\u90a3\u4e48\u9009\u7968\u53ef\u80fd\u4f1a\u88ab\u74dc\u5206\u4ee5\u81f3\u4e8e\u6ca1\u6709 candidate \u8d62\u5f97\u8fc7\u534a\u7684\u6295\u7968\u3002</li> <li>\u6bcf\u4e00\u4e2a\u5019\u9009\u4eba\u90fd\u4f1a\u8d85\u65f6\uff0c\u7136\u540e\u901a\u8fc7\u589e\u52a0\u5f53\u524d\u4efb\u671f\u53f7\u6765\u5f00\u59cb\u4e00\u8f6e\u65b0\u7684\u9009\u4e3e\uff1b</li> </ul> </li> </ul> <p>\u968f\u673a\u9009\u4e3e\u8d85\u65f6\u65f6\u95f4\u907f\u514d\u65e0\u9650\u91cd\u590d\u8be5\u60c5\u51b5\uff1b</p> <ul> <li>Follower\u6709\u4e0d\u540c\u7684\u9009\u4e3e\u8d85\u65f6\u65f6\u95f4\uff0c\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u53ea\u6709\u4e00\u4e2a\u670d\u52a1\u5668\u4f1a\u9009\u4e3e\u8d85\u65f6\uff0c\u5728\u5176\u5b83\u8282\u70b9\u8d85\u65f6\u524d\u8d62\u5f97\u9009\u62e9\u5e76\u53d1\u9001\u5fc3\u8df3\uff1b</li> </ul>"},{"location":"distributed_consensus/raft_paper.html#_3","title":"\u65e5\u5fd7\u590d\u5236","text":"<p>Leader</p> <ul> <li>leader \u53d1\u8d77\uff0c\u7528\u6765\u590d\u5236\u65e5\u5fd7\u548c\u63d0\u4f9b\u4e00\u79cd\u5fc3\u8df3\u673a\u5236\uff1b</li> <li>\u5ba2\u6237\u7aef\u7684\u6bcf\u4e00\u4e2a\u8bf7\u6c42\u90fd\u5305\u542b\u4e00\u6761\u5c06\u88ab\u590d\u5236\u72b6\u6001\u673a\u6267\u884c\u7684\u6307\u4ee4\uff0c\u5e76\u884c\u7684\u53d1\u8d77 AppendEntries RPC \u7ed9\u5176\u4ed6\u7684\u670d\u52a1\u5668\uff0c\u8ba9\u5b83\u4eec\u590d\u5236\u8be5\u6761\u76ee\uff1b</li> <li> <p>\u5f53\u8be5\u6761\u76ee\u88ab\u5b89\u5168\u5730\u590d\u5236\uff08\u4e0b\u9762\u4f1a\u4ecb\u7ecd\uff09\uff0cleader \u4f1a\u5e94\u7528\u8be5\u6761\u76ee\u5230\u5b83\u7684\u72b6\u6001\u673a\u4e2d\uff08\u72b6\u6001\u673a\u6267\u884c\u8be5\u6307\u4ee4\uff09\u7136\u540e\u628a\u6267\u884c\u7684\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</p> </li> <li> <p>\u5982\u679c follower \u5d29\u6e83\u6216\u8005\u8fd0\u884c\u7f13\u6162\uff0c\u6216\u8005\u7f51\u7edc\u4e22\u5305\uff0c\u9886\u5bfc\u4eba\u4f1a\u4e0d\u65ad\u5730\u91cd\u8bd5 AppendEntries RPC\uff08\u5373\u4f7f\u5df2\u7ecf\u56de\u590d\u4e86\u5ba2\u6237\u7aef\uff09\u76f4\u5230\u6240\u6709\u7684 follower \u6700\u7ec8\u90fd\u5b58\u50a8\u4e86\u6240\u6709\u7684\u65e5\u5fd7\u6761\u76ee\u3002</p> </li> </ul> <p></p> <p>Raft \u7b97\u6cd5\u4fdd\u8bc1\u6240\u6709\u5df2\u63d0\u4ea4\u7684\u65e5\u5fd7\u6761\u76ee\u90fd\u662f\u6301\u4e45\u5316\u7684\u5e76\u4e14\u6700\u7ec8\u4f1a\u88ab\u6240\u6709\u53ef\u7528\u7684\u72b6\u6001\u673a\u6267\u884c\u3002</p> <p>Raft \u7b97\u6cd5\u4fdd\u8bc1\u6240\u6709\u5df2\u63d0\u4ea4\u7684\u65e5\u5fd7\u6761\u76ee\u90fd\u662f\u6301\u4e45\u5316\u7684\u5e76\u4e14\u6700\u7ec8\u4f1a\u88ab\u6240\u6709\u53ef\u7528\u7684\u72b6\u6001\u673a\u6267\u884c\u3002\u4e00\u65e6\u521b\u5efa\u8be5\u65e5\u5fd7\u6761\u76ee\u7684 leader \u5c06\u5b83\u590d\u5236\u5230\u8fc7\u534a\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u8be5\u65e5\u5fd7\u6761\u76ee\u5c31\u4f1a\u88ab\u63d0\u4ea4\uff08\u4f8b\u5982\u6761\u76ee 7\uff09\u3002\u540c\u65f6\uff0cleader \u65e5\u5fd7\u4e2d\u8be5\u65e5\u5fd7\u6761\u76ee\u4e4b\u524d\u7684\u6240\u6709\u65e5\u5fd7\u6761\u76ee\u4e5f\u90fd\u4f1a\u88ab\u63d0\u4ea4\uff0c\u5305\u62ec\u7531\u5176\u4ed6 leader \u521b\u5efa\u7684\u6761\u76ee\u3002</p> <p>Follower \u4e00\u65e6\u77e5\u9053\u67d0\u4e2a\u65e5\u5fd7\u6761\u76ee\u5df2\u7ecf\u88ab\u63d0\u4ea4\u5c31\u4f1a\u5c06\u8be5\u65e5\u5fd7\u6761\u76ee\u5e94\u7528\u5230\u81ea\u5df1\u7684\u672c\u5730\u72b6\u6001\u673a\u4e2d\uff08\u6309\u7167\u65e5\u5fd7\u7684\u987a\u5e8f\uff09\u3002</p> <p>\u65e5\u5fd7\u5339\u914d\u7279\u6027\uff1a</p> <ul> <li>\u5982\u679c\u4e0d\u540c\u65e5\u5fd7\u4e2d\u7684\u4e24\u4e2a\u6761\u76ee\u62e5\u6709\u76f8\u540c\u7684\u7d22\u5f15\u548c\u4efb\u671f\u53f7\uff0c\u90a3\u4e48\u4ed6\u4eec\u5b58\u50a8\u4e86\u76f8\u540c\u7684\u6307\u4ee4\u3002</li> <li>\u5982\u679c\u4e0d\u540c\u65e5\u5fd7\u4e2d\u7684\u4e24\u4e2a\u6761\u76ee\u62e5\u6709\u76f8\u540c\u7684\u7d22\u5f15\u548c\u4efb\u671f\u53f7\uff0c\u90a3\u4e48\u4ed6\u4eec\u4e4b\u524d\u7684\u6240\u6709\u65e5\u5fd7\u6761\u76ee\u4e5f\u90fd\u76f8\u540c\u3002</li> </ul>"},{"location":"distributed_consensus/raft_paper.html#_4","title":"\u5b89\u5168\u6027","text":"<ul> <li> <p>\u4fdd\u8bc1\u4e86\u5bf9\u4e8e\u7ed9\u5b9a\u7684\u4efb\u610f\u4efb\u671f\u53f7\uff0c leader \u90fd\u5305\u542b\u4e86\u4e4b\u524d\u5404\u4e2a\u4efb\u671f\u6240\u6709\u88ab\u63d0\u4ea4\u7684\u65e5\u5fd7\u6761\u76ee\u3002</p> </li> <li> <p>\u4fdd\u8bc1\u65b0 leader \u5728\u5f53\u9009\u65f6\u5c31\u5305\u542b\u4e86\u4e4b\u524d\u6240\u6709\u4efb\u671f\u53f7\u4e2d\u5df2\u7ecf\u63d0\u4ea4\u7684\u65e5\u5fd7\u6761\u76ee\uff0c\u4e0d\u9700\u8981\u518d\u4f20\u9001\u8fd9\u4e9b\u65e5\u5fd7\u6761\u76ee\u7ed9\u65b0 leader \u3002</p> </li> <li> <p>Raft \u4f7f\u7528\u6295\u7968\u7684\u65b9\u5f0f\u6765\u963b\u6b62 candidate \u8d62\u5f97\u9009\u4e3e\u9664\u975e\u8be5 candidate \u5305\u542b\u4e86\u6240\u6709\u5df2\u7ecf\u63d0\u4ea4\u7684\u65e5\u5fd7\u6761\u76ee\u3002</p> </li> <li> <p>RequestVote RPC \u4e2d\u5305\u542b\u4e86 candidate \u7684\u65e5\u5fd7\u4fe1\u606f\uff0c\u5982\u679c\u6295\u7968\u8005\u81ea\u5df1\u7684\u65e5\u5fd7\u6bd4 candidate \u7684\u8fd8\u65b0\uff0c\u5b83\u4f1a\u62d2\u7edd\u6389\u8be5\u6295\u7968\u8bf7\u6c42\u3002</p> </li> <li> <p>Raft \u901a\u8fc7\u6bd4\u8f83\u4e24\u4efd\u65e5\u5fd7\u4e2d\u6700\u540e\u4e00\u6761\u65e5\u5fd7\u6761\u76ee\u7684\u7d22\u5f15\u503c\u548c\u4efb\u671f\u53f7\u6765\u5b9a\u4e49\u8c01\u7684\u65e5\u5fd7\u6bd4\u8f83\u65b0\u3002\u5982\u679c\u4e24\u4efd\u65e5\u5fd7\u6700\u540e\u6761\u76ee\u7684\u4efb\u671f\u53f7\u4e0d\u540c\uff0c\u90a3\u4e48\u4efb\u671f\u53f7\u5927\u7684\u65e5\u5fd7\u66f4\u65b0\u3002\u5982\u679c\u4e24\u4efd\u65e5\u5fd7\u6700\u540e\u6761\u76ee\u7684\u4efb\u671f\u53f7\u76f8\u540c\uff0c\u90a3\u4e48\u65e5\u5fd7\u8f83\u957f\u7684\u90a3\u4e2a\u66f4\u65b0\u3002</p> </li> <li> <p>\u5f53 leader \u590d\u5236\u4e4b\u524d\u4efb\u671f\u5185\u7684\u65e5\u5fd7\u6761\u76ee\u65f6\uff0c\u8fd9\u4e9b\u65e5\u5fd7\u6761\u76ee\u90fd\u4fdd\u7559\u539f\u6765\u7684\u4efb\u671f\u53f7\u3002</p> </li> <li>Raft \u6c38\u8fdc\u4e0d\u4f1a\u901a\u8fc7\u8ba1\u7b97\u526f\u672c\u6570\u76ee\u7684\u65b9\u5f0f\u6765\u63d0\u4ea4\u4e4b\u524d\u4efb\u671f\u5185\u7684\u65e5\u5fd7\u6761\u76ee\uff1a</li> <li>\u53ea\u6709 leader \u5f53\u524d\u4efb\u671f\u5185\u7684\u65e5\u5fd7\u6761\u76ee\u624d\u901a\u8fc7\u8ba1\u7b97\u526f\u672c\u6570\u76ee\u7684\u65b9\u5f0f\u6765\u63d0\u4ea4\uff1b\u4e00\u65e6\u5f53\u524d\u4efb\u671f\u7684\u67d0\u4e2a\u65e5\u5fd7\u6761\u76ee\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u88ab\u63d0\u4ea4\uff0c\u90a3\u4e48\u7531\u4e8e\u65e5\u5fd7\u5339\u914d\u7279\u6027\uff0c\u4e4b\u524d\u7684\u6240\u6709\u65e5\u5fd7\u6761\u76ee\u4e5f\u90fd\u4f1a\u88ab\u95f4\u63a5\u5730\u63d0\u4ea4\u3002</li> </ul>"},{"location":"distributed_consensus/raft_paper.html#follower-candidate","title":"Follower \u548c candidate \u5d29\u6e83","text":"<ul> <li>RequestVote \u548c AppendEntries RPCs \u90fd\u4f1a\u5931\u8d25\u3002Raft \u901a\u8fc7\u65e0\u9650\u7684\u91cd\u8bd5\u6765\u5904\u7406\u8fd9\u79cd\u5931\u8d25\uff1b\u5982\u679c\u5d29\u6e83\u7684\u673a\u5668\u91cd\u542f\u4e86\uff0c\u90a3\u4e48\u8fd9\u4e9b RPC \u5c31\u4f1a\u6210\u529f\u5730\u5b8c\u6210\uff1b</li> <li>Raft \u7684 RPCs \u90fd\u662f\u5e42\u7b49\u7684\uff0c\u6240\u4ee5\u8fd9\u6837\u7684\u91cd\u8bd5\u4e0d\u4f1a\u9020\u6210\u4efb\u4f55\u4f24\u5bb3\u3002</li> <li>\u4e00\u4e2a follower \u5982\u679c\u6536\u5230 AppendEntries \u8bf7\u6c42\u4f46\u662f\u5b83\u7684\u65e5\u5fd7\u4e2d\u5df2\u7ecf\u5305\u542b\u4e86\u8fd9\u4e9b\u65e5\u5fd7\u6761\u76ee\uff0c\u5b83\u5c31\u4f1a\u76f4\u63a5\u5ffd\u7565\u8fd9\u4e2a\u65b0\u7684\u8bf7\u6c42\u4e2d\u7684\u8fd9\u4e9b\u65e5\u5fd7\u6761\u76ee\u3002</li> </ul>"},{"location":"distributed_consensus/raft_paper.html#timing","title":"\u5b9a\u65f6\uff08timing\uff09\u548c\u53ef\u7528\u6027","text":"<p>Leader \u9009\u4e3e\u662f Raft \u4e2d\u5b9a\u65f6\u6700\u4e3a\u5173\u952e\u7684\u65b9\u9762\u3002 \u53ea\u8981\u6574\u4e2a\u7cfb\u7edf\u6ee1\u8db3\u4e0b\u9762\u7684\u65f6\u95f4\u8981\u6c42\uff0cRaft \u5c31\u53ef\u4ee5\u9009\u4e3e\u51fa\u5e76\u7ef4\u6301\u4e00\u4e2a\u7a33\u5b9a\u7684 leader\uff1a</p> <p>\u5e7f\u64ad\u65f6\u95f4\uff08broadcastTime\uff09 &lt;&lt; \u9009\u4e3e\u8d85\u65f6\u65f6\u95f4\uff08electionTimeout\uff09 &lt;&lt; \u5e73\u5747\u6545\u969c\u95f4\u9694\u65f6\u95f4\uff08MTBF\uff09</p> <ul> <li>\u5e7f\u64ad\u65f6\u95f4\u6307\u7684\u662f\u4e00\u4e2a\u670d\u52a1\u5668\u5e76\u884c\u5730\u53d1\u9001 RPCs \u7ed9\u96c6\u7fa4\u4e2d\u6240\u6709\u7684\u5176\u4ed6\u670d\u52a1\u5668\u5e76\u63a5\u6536\u5230\u54cd\u5e94\u7684\u5e73\u5747\u65f6\u95f4\uff1b</li> <li>\u5e73\u5747\u6545\u969c\u95f4\u9694\u65f6\u95f4\u5c31\u662f\u5bf9\u4e8e\u4e00\u53f0\u670d\u52a1\u5668\u800c\u8a00\uff0c\u4e24\u6b21\u6545\u969c\u95f4\u9694\u65f6\u95f4\u7684\u5e73\u5747\u503c\uff1b</li> </ul> <p>Raft \u7684 RPCs \u9700\u8981\u63a5\u6536\u65b9\u5c06\u4fe1\u606f\u6301\u4e45\u5316\u5730\u4fdd\u5b58\u5230\u7a33\u5b9a\u5b58\u50a8\u4e2d\u53bb\uff0c\u6240\u4ee5\u5e7f\u64ad\u65f6\u95f4\u5927\u7ea6\u662f 0.5 \u6beb\u79d2\u5230 20 \u6beb\u79d2\u4e4b\u95f4\uff0c\u53d6\u51b3\u4e8e\u5b58\u50a8\u7684\u6280\u672f\u3002\u56e0\u6b64\uff0c\u9009\u4e3e\u8d85\u65f6\u65f6\u95f4\u53ef\u80fd\u9700\u8981\u5728 10 \u6beb\u79d2\u5230 500 \u6beb\u79d2\u4e4b\u95f4\u3002</p>"},{"location":"distributed_consensus/raft_paper.html#_5","title":"\u96c6\u7fa4\u6210\u5458\u53d8\u66f4","text":"<p>\u56fe\u793a\uff1a\u76f4\u63a5\u4ece\u4e00\u79cd\u914d\u7f6e\u8f6c\u5230\u53e6\u4e00\u79cd\u914d\u7f6e\u662f\u4e0d\u5b89\u5168\u7684\uff0c\u56e0\u4e3a\u5404\u4e2a\u673a\u5668\u4f1a\u5728\u4e0d\u540c\u7684\u65f6\u5019\u8fdb\u884c\u8f6c\u6362\u3002\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u96c6\u7fa4\u4ece 3 \u53f0\u673a\u5668\u53d8\u6210\u4e86 5 \u53f0\u3002\u4e0d\u5e78\u7684\u662f\uff0c\u5b58\u5728\u8fd9\u6837\u7684\u4e00\u4e2a\u65f6\u95f4\u70b9\uff0c\u540c\u4e00\u4e2a\u4efb\u671f\u91cc\u4e24\u4e2a\u4e0d\u540c\u7684 leader \u4f1a\u88ab\u9009\u51fa\u3002\u4e00\u4e2a\u83b7\u5f97\u65e7\u914d\u7f6e\u91cc\u8fc7\u534a\u673a\u5668\u7684\u6295\u7968\uff0c\u4e00\u4e2a\u83b7\u5f97\u65b0\u914d\u7f6e\u91cc\u8fc7\u534a\u673a\u5668\u7684\u6295\u7968\u3002</p> <p>\u5728 Raft \u4e2d\uff0c\u96c6\u7fa4\u5148\u5207\u6362\u5230\u4e00\u4e2a\u8fc7\u6e21\u7684\u914d\u7f6e\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u8054\u5408\u4e00\u81f4\uff08joint consensus\uff09\uff1b\u4e00\u65e6\u8054\u5408\u4e00\u81f4\u5df2\u7ecf\u88ab\u63d0\u4ea4\u4e86\uff0c\u90a3\u4e48\u7cfb\u7edf\u5c31\u5207\u6362\u5230\u65b0\u7684\u914d\u7f6e\u4e0a\u3002\u8054\u5408\u4e00\u81f4\u7ed3\u5408\u4e86\u8001\u914d\u7f6e\u548c\u65b0\u914d\u7f6e\uff1a</p> <ul> <li>\u65e5\u5fd7\u6761\u76ee\u88ab\u590d\u5236\u7ed9\u96c6\u7fa4\u4e2d\u65b0\u3001\u8001\u914d\u7f6e\u7684\u6240\u6709\u670d\u52a1\u5668\u3002</li> <li>\u65b0\u3001\u65e7\u914d\u7f6e\u7684\u670d\u52a1\u5668\u90fd\u53ef\u4ee5\u6210\u4e3a leader \u3002</li> <li>\u8fbe\u6210\u4e00\u81f4\uff08\u9488\u5bf9\u9009\u4e3e\u548c\u63d0\u4ea4\uff09\u9700\u8981\u5206\u522b\u5728\u4e24\u79cd\u914d\u7f6e\u4e0a\u83b7\u5f97\u8fc7\u534a\u7684\u652f\u6301\u3002</li> </ul> <p>\u670d\u52a1\u5668\u603b\u662f\u4f7f\u7528\u5b83\u65e5\u5fd7\u4e2d\u6700\u65b0\u7684\u914d\u7f6e\uff0c\u65e0\u8bba\u8be5\u914d\u7f6e\u65e5\u5fd7\u662f\u5426\u5df2\u7ecf\u88ab\u63d0\u4ea4\uff1f</p> <p>\u4e09\u4e2a\u95ee\u9898\uff1a</p> <p>1\uff09</p> <p>2\uff09</p> <p>3\uff09</p> <p>\u5f53\u670d\u52a1\u5668\u8ba4\u4e3a\u5f53\u524d leader \u5b58\u5728\u65f6\uff0c\u670d\u52a1\u5668\u4f1a\u5ffd\u7565RequestVote RPCs \u3002\u7279\u522b\u7684\uff0c\u5f53\u670d\u52a1\u5668\u5728\u6700\u5c0f\u9009\u4e3e\u8d85\u65f6\u65f6\u95f4\u5185\u6536\u5230\u4e00\u4e2a RequestVote RPC\uff0c\u5b83\u4e0d\u4f1a\u66f4\u65b0\u4efb\u671f\u53f7\u6216\u8005\u6295\u7968\u3002\u8fd9\u4e0d\u4f1a\u5f71\u54cd\u6b63\u5e38\u7684\u9009\u4e3e\uff0c\u6bcf\u4e2a\u670d\u52a1\u5668\u5728\u5f00\u59cb\u4e00\u6b21\u9009\u4e3e\u4e4b\u524d\uff0c\u81f3\u5c11\u7b49\u5f85\u6700\u5c0f\u9009\u4e3e\u8d85\u65f6\u65f6\u95f4\u3002\u76f8\u53cd\uff0c\u8fd9\u6709\u5229\u4e8e\u907f\u514d\u88ab\u79fb\u9664\u7684\u670d\u52a1\u5668\u7684\u6270\u4e71\uff1a\u5982\u679c leader \u80fd\u591f\u53d1\u9001\u5fc3\u8df3\u7ed9\u96c6\u7fa4\uff0c\u90a3\u5b83\u5c31\u4e0d\u4f1a\u88ab\u66f4\u5927\u7684\u4efb\u671f\u53f7\u5e9f\u9edc\u3002</p>"},{"location":"distributed_consensus/raft_paper.html#_6","title":"\u65e5\u5fd7\u538b\u7f29","text":"<p>\u5feb\u7167\u6280\u672f\u662f\u65e5\u5fd7\u538b\u7f29\u6700\u7b80\u5355\u7684\u65b9\u6cd5</p> <p>\u589e\u91cf\u538b\u7f29\u65b9\u6cd5\uff0c\u4f8b\u5982\u65e5\u5fd7\u6e05\u7406\u6216\u8005\u65e5\u5fd7\u7ed3\u6784\u5408\u5e76\u6811\uff08log-structured merge trees\uff0cLSM \u6811\uff09</p> <p>\u901a\u8fc7\u5199\u65f6\u590d\u5236\u7684\u6280\u672f\uff0c\u8fd9\u6837\u65b0\u7684\u66f4\u65b0\u5c31\u53ef\u4ee5\u5728\u4e0d\u5f71\u54cd\u6b63\u5728\u5199\u7684\u5feb\u7167\u7684\u60c5\u51b5\u4e0b\u88ab\u63a5\u6536</p>"},{"location":"distributed_consensus/raft_paper.html#prevote","title":"PreVote","text":"<p>\u5728Basic Raft\u7b97\u6cd5\u4e2d\uff0c\u5f53\u4e00\u4e2aFollower\u4e0e\u5176\u4ed6\u8282\u70b9\u7f51\u7edc\u9694\u79bb\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>Follower_2\u5728electionTimeout\u6ca1\u6536\u5230\u5fc3\u8df3\u4e4b\u540e\uff0c\u4f1a\u53d1\u8d77\u9009\u4e3e\uff0c\u5e76\u8f6c\u4e3aCandidate\u3002\u6bcf\u6b21\u53d1\u8d77\u9009\u4e3e\u65f6\uff0c\u4f1a\u628aTerm\u52a0\u4e00\u3002\u7531\u4e8e\u7f51\u7edc\u9694\u79bb\uff0c\u5b83\u65e2\u4e0d\u4f1a\u88ab\u9009\u6210Leader\uff0c\u4e5f\u4e0d\u4f1a\u6536\u5230Leader\u7684\u6d88\u606f\uff0c\u800c\u662f\u4f1a\u4e00\u76f4\u4e0d\u65ad\u5730\u53d1\u8d77\u9009\u4e3e\uff0cTerm\u4f1a\u4e0d\u65ad\u589e\u5927\u3002</p> <p>\u4e00\u6bb5\u65f6\u95f4\u4e4b\u540e\uff0c\u8fd9\u4e2a\u8282\u70b9\u7684Term\u4f1a\u975e\u5e38\u5927\u3002\u5728\u7f51\u7edc\u6062\u590d\u4e4b\u540e\uff0c\u8fd9\u4e2a\u8282\u70b9\u4f1a\u628a\u5b83\u7684Term\u4f20\u64ad\u5230\u96c6\u7fa4\u7684\u5176\u4ed6\u8282\u70b9\uff0c\u5bfc\u81f4\u5176\u4ed6\u8282\u70b9\u66f4\u65b0\u81ea\u5df1\u7684term\uff0c\u53d8\u4e3aFollower\u3002\u7136\u540e\u89e6\u53d1\u91cd\u65b0\u9009\u4e3b\uff0c\u4f46\u8fd9\u4e2a\u65e7\u7684Follower_2\u8282\u70b9\u7531\u4e8e\u5176\u65e5\u5fd7\u4e0d\u662f\u6700\u65b0\uff0c\u5e76\u4e0d\u4f1a\u6210\u4e3aLeader\u3002\u6574\u4e2a\u96c6\u7fa4\u88ab\u8fd9\u4e2a\u7f51\u7edc\u9694\u79bb\u8fc7\u7684\u65e7\u8282\u70b9\u6270\u4e71\uff0c\u663e\u7136\u9700\u8981\u907f\u514d\u7684\u3002</p> <p>Raft\u4f5c\u8005\u535a\u58eb\u8bba\u6587\u300aCONSENSUS: BRIDGING THEORY AND PRACTICE\u300b\u7684\u7b2c9.6\u8282 \"Preventing disruptions when a server rejoins the cluster\"\u63d0\u5230\u4e86PreVote\u7b97\u6cd5\u7684\u5927\u6982\u5b9e\u73b0\u601d\u8def\u3002</p> <p>\u5728PreVote\u7b97\u6cd5\u4e2d\uff0cCandidate\u9996\u5148\u8981\u786e\u8ba4\u81ea\u5df1\u80fd\u8d62\u5f97\u96c6\u7fa4\u4e2d\u5927\u591a\u6570\u8282\u70b9\u7684\u6295\u7968\uff0c\u8fd9\u6837\u624d\u4f1a\u628a\u81ea\u5df1\u7684term\u589e\u52a0\uff0c\u7136\u540e\u53d1\u8d77\u771f\u6b63\u7684\u6295\u7968\u3002\u5176\u4ed6\u6295\u7968\u8282\u70b9\u540c\u610f\u53d1\u8d77\u9009\u4e3e\u7684\u6761\u4ef6\u662f\uff08\u540c\u65f6\u6ee1\u8db3\u4e0b\u9762\u4e24\u4e2a\u6761\u4ef6\uff09\uff1a</p> <ul> <li>\u6ca1\u6709\u6536\u5230\u6709\u6548\u9886\u5bfc\u7684\u5fc3\u8df3\uff0c\u81f3\u5c11\u6709\u4e00\u6b21\u9009\u4e3e\u8d85\u65f6\u3002</li> <li>Candidate\u7684\u65e5\u5fd7\u8db3\u591f\u65b0\uff08Term\u66f4\u5927\uff0c\u6216\u8005Term\u76f8\u540craft index\u66f4\u5927\uff09\u3002</li> </ul> <p>PreVote\u7b97\u6cd5\u89e3\u51b3\u4e86\u7f51\u7edc\u5206\u533a\u8282\u70b9\u5728\u91cd\u65b0\u52a0\u5165\u65f6\uff0c\u4f1a\u4e2d\u65ad\u96c6\u7fa4\u7684\u95ee\u9898\u3002\u5728PreVote\u7b97\u6cd5\u4e2d\uff0c\u7f51\u7edc\u5206\u533a\u8282\u70b9\u7531\u4e8e\u65e0\u6cd5\u83b7\u5f97\u5927\u90e8\u5206\u8282\u70b9\u7684\u8bb8\u53ef\uff0c\u56e0\u6b64\u65e0\u6cd5\u589e\u52a0\u5176Term\u3002\u7136\u540e\u5f53\u5b83\u91cd\u65b0\u52a0\u5165\u96c6\u7fa4\u65f6\uff0c\u5b83\u4ecd\u7136\u65e0\u6cd5\u9012\u589e\u5176Term\uff0c\u56e0\u4e3a\u5176\u4ed6\u670d\u52a1\u5668\u5c06\u4e00\u76f4\u6536\u5230\u6765\u81eaLeader\u8282\u70b9\u7684\u5b9a\u671f\u5fc3\u8df3\u4fe1\u606f\u3002\u4e00\u65e6\u8be5\u670d\u52a1\u5668\u4ece\u9886\u5bfc\u8005\u63a5\u6536\u5230\u5fc3\u8df3\uff0c\u5b83\u5c06\u8fd4\u56de\u5230Follower\u72b6\u6001\uff0cTerm\u548cLeader\u4e00\u81f4\u3002</p>"},{"location":"distributed_consensus/raft_paper.html#client","title":"Client","text":"<p>\u5f53\u5ba2\u6237\u7aef\u7b2c\u4e00\u6b21\u542f\u52a8\u7684\u65f6\u5019\uff0c\u5b83\u4f1a\u968f\u673a\u6311\u9009\u4e00\u4e2a\u670d\u52a1\u5668\u8fdb\u884c\u901a\u4fe1\u3002\u5982\u679c\u5ba2\u6237\u7aef\u7b2c\u4e00\u6b21\u6311\u9009\u7684\u670d\u52a1\u5668\u4e0d\u662f leader \uff0c\u90a3\u4e48\u8be5\u670d\u52a1\u5668\u4f1a\u62d2\u7edd\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u5e76\u4e14\u63d0\u4f9b\u5173\u4e8e\u5b83\u6700\u8fd1\u63a5\u6536\u5230\u7684\u9886\u5bfc\u4eba\u7684\u4fe1\u606f\uff08AppendEntries \u8bf7\u6c42\u5305\u542b\u4e86 leader \u7684\u7f51\u7edc\u5730\u5740\uff09\u3002\u5982\u679c leader \u5df2\u7ecf\u5d29\u6e83\u4e86\uff0c\u5ba2\u6237\u7aef\u8bf7\u6c42\u5c31\u4f1a\u8d85\u65f6\uff1b\u5ba2\u6237\u7aef\u4e4b\u540e\u4f1a\u518d\u6b21\u968f\u673a\u6311\u9009\u670d\u52a1\u5668\u8fdb\u884c\u91cd\u8bd5\u3002</p>"},{"location":"distributed_consensus/raft_paper.html#state-machine","title":"State Machine","text":"<p>\u72b6\u6001\u673a\uff0c\u5e94\u7528 logEntry\uff0c\u53ef\u4ee5\u901a\u8fc7logEntry\u6062\u590dstate machine\u7684\u5185\u5b58\u72b6\u6001\u3002</p>"},{"location":"distributed_consensus/6.824/distributed_fs.html","title":"Distributed fs","text":""},{"location":"distributed_consensus/6.824/distributed_fs.html#gfs","title":"GFS","text":"<p>\u8bba\u6587</p> <p>Big Storage\u7684\u5faa\u73af\u95ee\u9898\uff1a</p> <ul> <li>Performance -&gt; Sharding \uff08\u6027\u80fd\u5bfc\u81f4\u6570\u636e\u5206\u7247\uff09</li> <li>Sharding -&gt; Faults (\u6570\u636e\u5206\u7247\u5230\u96c6\u7fa4\uff0c\u670d\u52a1\u5668\u6545\u969c)</li> <li>Faults -&gt; Tolerance \uff08\u5bb9\u9519\u6027)</li> <li>Tolerance -&gt; Replication (\u590d\u5236\u89e3\u51b3\u5bb9\u9519\u6027\uff09</li> <li>Replication -&gt; Inconsistency \uff08\u590d\u5236\u5e26\u6765\u4e0d\u4e00\u81f4\u6027\uff09</li> <li>Consistency -&gt; Low Performance \uff08\u4e00\u81f4\u6027\u8981\u6c42\u5bfc\u81f4\u4f4e\u6027\u80fd\uff09</li> </ul> <p>\u5f3a\u4e00\u81f4\u6027</p> <p>Master MetaData</p> <ul> <li>file_name -&gt; </li> <li>array of chunk ids/handles \uff08\u6587\u4ef6\u540d\u5bf9\u5e94\u7684\u6570\u636e\u5757\uff09\u975e\u6613\u5931\u6027</li> <li>chunk handle -&gt;</li> <li>list of chunk servers\uff08chunk\u6240\u5728\u7684\u670d\u52a1\u5668\uff09</li> <li>chunk version \uff08\u7248\u672c\u53f7\uff09\u975e\u6613\u5931\u6027<ul> <li>chunk server\u53ef\u80fd\u79bb\u7ebf\uff0c\u65e0\u6cd5\u53d6\u6700\u5927\u503c</li> </ul> </li> <li>primary chunk server \uff08\u4e3b\u6570\u636e\u5757\u670d\u52a1\u5668\uff09</li> <li>lease expiration (primary server\u7684\u79df\u7ea6\u65f6\u95f4)</li> </ul> <p>\u6062\u590d</p> <ul> <li>\u78c1\u76d8\u5b58\u50a8\uff1aLOG + CHECKPOINT </li> </ul> <p>Read</p> <ul> <li>filename + offset  -&gt; chunk handle, chunk servers \uff1b</li> <li>client \u9009\u62e9\u4e00\u4e2achunk server\uff08\u89c4\u5219\u662f\u4ec0\u4e48\uff1f\uff09\uff0c\u8bfb\u53d6\u6570\u636e\uff1b</li> </ul> <p>Write\uff08append\uff09</p> <ul> <li> <p>No primary for chunk ? Master will do </p> </li> <li> <p>Find up to date Replicas</p> </li> <li>Pick prmary, second chunk server</li> <li>Increment chunk version</li> <li>Tells primary, second the newest version</li> <li>Master write newest version to disk</li> </ul> <p>Master\u7684\u7248\u672c\u53f7\uff0c\u4f4e\u4e8echunk server\uff1f</p> <ul> <li>TODO\uff1aMaster\u7248\u672c\u53f7\u5199\u78c1\u76d8\u548c\u544a\u8bc9Primary\u7684\u987a\u5e8f\uff1f</li> </ul> <p>Primary picks offset</p> <p>all replicas told wo write at offset</p> <p>IF all 'yes', primary return 'success' to client ELSE 'no' to client</p> <p>S plit brain</p>"},{"location":"distributed_consensus/6.824/primary_backup_replication.html","title":"Primary backup replication","text":""},{"location":"distributed_consensus/6.824/primary_backup_replication.html#primary-backup-replication","title":"Primary Backup Replication","text":"<p>Failure \u5bb9\u9519</p> <ul> <li>\u652f\u6301\uff1afail stop faults\uff0c\u65ad\u7535/\u8282\u70b9\u4e0b\u7ebf</li> <li>no relevant failure</li> </ul> <p>state transfer\uff1a\u53d1\u9001\u72b6\u6001\uff0c\u6bd4\u5982\u5185\u5b58\u5f53\u524d\u72b6\u51b5</p> <p>replicated state machine\uff1a\u53d1\u9001\u4e8b\u4ef6\uff0c\u6bd4\u5982\u5bf9\u5185\u5b58\u7684\u64cd\u4f5c</p>"},{"location":"financial/index.html","title":"Index","text":"<p>\u56e0\u534e\u6cf0\u9879\u76ee\u4e86\u89e3\u7684\u91d1\u878d\u77e5\u8bc6</p> <p>\u591a\u56e0\u5b50\u6a21\u578b</p>"},{"location":"financial/quantitative_analysis.html","title":"Quantitative analysis","text":"<p>[toc]</p>"},{"location":"financial/quantitative_analysis.html#_1","title":"\u91cf\u5316\u5206\u6790","text":""},{"location":"financial/multi_factor_model/index.html","title":"\u591a\u56e0\u5b50\u6a21\u578b\u4f53\u7cfb\u521d\u63a2","text":""},{"location":"financial/multi_factor_model/index.html#_2","title":"\u4e3b\u52a8\u5b9a\u91cf\u7ec4\u5408\u7ba1\u7406","text":"<p>\u88ab\u52a8\u7ba1\u7406\u53c8\u79f0\u6307\u6570\u5316\u7ba1\u7406\uff0c\u76ee\u6807\u662f\u5c3d\u53ef\u80fd\u7684\u8ddf\u8e2a\u67d0\u4e2a\u80a1\u7968\u6307\u6570\u6216\u8005\u5176\u4ed6\u57fa\u51c6\uff0c\u4f7f\u5f97\u6295\u8d44\u7ec4\u5408\u7684\u7ee9\u6548\u4e0e\u4e1a\u7ee9\u57fa\u51c6\u504f\u79bb\u6700\u5c0f\u3002  </p> <p>\u4e3b\u52a8\u7ba1\u7406\u76f8\u4fe1\u901a\u8fc7\u5408\u7406\u7684\u9009\u62e9\u80a1\u7968\uff0c\u6295\u8d44\u7ec4\u5408\u7684\u6536\u76ca\u53ef\u4ee5\u6218\u80dc\u67d0\u4e2a\u80a1\u7968\u6307\u6570\u6216\u8005\u5176\u4ed6\u57fa\u51c6\u3002  </p> <ul> <li>\u5b9a\u6027\u7ba1\u7406\u4f9d\u8d56\u4e8e\u6295\u8d44\u7ecf\u7406\u5bf9\u4e8e\u5e02\u573a\u548c\u4e2a\u80a1\u7684\u5b9a\u6027\u5224\u65ad \uff0c\u57fa\u4e8e\u8d22\u52a1\u62a5\u8868\u7b49\u5f62\u6210\u8ba4\u77e5\uff1b</li> <li>\u5b9a\u91cf\u7ba1\u7406\u6839\u636e\u80fd\u591f\u5f97\u5230\u7684\u516c\u5f00\u6570\u636e\uff0c\u57fa\u4e8e\u6570\u5b66\u548c\u7edf\u8ba1\u7684\u65b9\u6cd5\uff0c\u5efa\u7acb\u7edf\u4e00\u7684\u5b9a\u91cf\u6a21\u578b\u5bf9\u80a1\u7968\u8fdb   \u884c\u533a\u5206\u5e76\u4f9d\u6b64\u8fdb\u884c\u6295\u8d44\u51b3\u7b56\u3002  </li> </ul> <p>\u5b9a\u91cf\u7ba1\u7406\u4e3b\u8981\u4ece\u7edf\u8ba1\u7684\u89d2\u5ea6\u7814\u7a76\u56e0\u5b50\u6536\u76ca\u7387\u7684\u53d8\u5316\u89c4\u5f8b\uff0c\u5e76\u4ece\u7ec4\u5408\u7684\u89d2\u5ea6\u5bf9\u56e0\u5b50\u66b4\u9732\u8fdb\u884c\u7ba1\u7406\u4ee5\u6c42\u8d85\u8d8a\u57fa\u51c6\uff1b</p> <p>\u4e3b\u52a8\u5b9a\u91cf\u7ba1\u7406\u672c\u8d28\u662f\u7edf\u8ba1\u5957\u5229\uff0c\u5173\u6ce8\u70b9\u662f\u56e0\u5b50\uff08\u5171\u6027\uff09\uff0c\u800c\u975e\u80a1\u7968\uff08\u4e2a\u6027\uff09\u3002</p> <p>\u5b9a\u6027\u7ba1\u7406\u4e3b\u8981\u7814\u7a76\u4e2a\u80a1\u7684\u6b8b\u5dee\u6536\u76ca\u7387\uff0c\u5373\u4ece\u56e0\u5b50\u89d2\u5ea6\u65e0\u6cd5\u89e3\u91ca\u7684\u8d85\u989d\u6536\u76ca\u7387 \u3002</p> <p>\u591a\u56e0\u5b50\u6a21\u578b\u662f\u98ce\u9669\u6536\u76ca\u5173\u7cfb\u7684\u5b9a\u91cf\u8868\u8fbe\uff0c\u56e0\u5b50\u662f\u4e0d\u540c\u7c7b\u578b\u98ce\u9669\u7684\u89e3\u91ca\u53d8\u91cf\u3002</p> <p>\u98ce\u9669</p> <p>\u4e1a\u754c\u6700\u6807\u51c6\u7684\u5b9a\u4e49\u662f\u6536\u76ca\u7684\u6807\u51c6\u5dee\uff08standard deviation\uff09\uff0c\u6807\u51c6\u5dee\u8861\u91cf\u4e86\u6536\u76ca\u7387\u5728\u5747\u503c\u9644\u8fd1 \u5206\u5e03\u8303\u56f4\u7684\u5bbd\u5ea6\u3002\u968f\u7740\u6807\u51c6\u5dee\u7684\u51cf\u5c0f\uff0c\u6536\u76ca\u7387\u7684\u5206\u5e03\u8303\u56f4\u8d8a\u6765\u8d8a\u7a84\uff0c\u6536\u76ca\u7684\u786e\u5b9a\u6027\u8d8a\u6765\u8d8a\u5f3a $$ st\ud835\udc51(\\tilde{r}) = \\sqrt{Var(\\tilde{r})} \\ \\sqrt{Var(\\tilde{r})} = \ud835\udc38[(\\tilde{r} - \\overline{r})^2] \\ \\tilde{r}: \u6536\u76ca\u7387 \\  \\overline{r}: \u9884\u671f\u56de\u62a5\u6216\u8005\u5e73\u5747\u56de\u62a5\u7387 \\ \ud835\udc46\ud835\udc61\ud835\udc51(\ud835\udc65): \ud835\udc65\u7684\u6807\u51c6\u5dee \\ \ud835\udc49\ud835\udc4e\ud835\udc5f(\ud835\udc65): \ud835\udc65\u7684\u65b9\u5dee \\ \ud835\udc38(\ud835\udc65): \ud835\udc65\u7684\u9884\u671f\u503c $$ \u6295\u8d44\u7ec4\u5408\u7684\u6536\u76ca\u7387\u7b49\u4e8e\u7ec4\u5408\u4e2d\u5404\u8d44\u4ea7\u6536\u76ca\u7387\u7684\u52a0\u6743\u5e73\u5747\uff0c\u4f46\u662f\u6295\u8d44\u7ec4\u5408\u7684\u6807\u51c6\u5dee\u5e76\u4e0d\u7b49\u4e8e\u7ec4 \u5408\u4e2d\u5404\u8d44\u4ea7\u6807\u51c6\u5dee\u7684\u52a0\u6743\u5e73\u5747\uff0c\u800c\u662f\u5c0f\u4e8e\u7b49\u4e8e\u7ec4\u5408\u4e2d\u5404\u8d44\u4ea7\u6807\u51c6\u5dee\u7684\u52a0\u6743\u5e73\u5747\uff0c\u5373\u6574\u4f53\u98ce\u9669 \u5c0f\u4e8e\u90e8\u5206\u98ce\u9669\u4e4b\u548c\u2014\u2014\u8fd9\u662f\u8fdb\u884c\u7ec4\u5408\u6295\u8d44\u5206\u6563\u98ce\u9669\u7684\u5173\u952e\u3002  </p> <p>\u9700\u8981\u4f30\u8ba1\u7684\u53c2\u6570\u603b\u7ed3\u5230\u4e00\u4e2a\u534f\u65b9\u5dee\uff08covariance\uff09 \u77e9\u9635 V \u4e2d\uff1a $$ V = \\left[\\begin{matrix} &amp;\\sigma_{11} &amp;\\sigma_{12} &amp;\\dots &amp;\\sigma_{1N} \\ &amp;\\sigma_{21} &amp;\\sigma_{22} &amp;\\dots &amp;\\sigma_{2N} \\ &amp;\\dots &amp;\\vdots &amp;\\ddots &amp;\\vdots \\ &amp;\\sigma_{N1} &amp;\\sigma_{N2} &amp;\\dots &amp;\\sigma_{NN} \\ \\end{matrix} \\right] $$</p> <p>\u534f\u65b9\u5dee\u77e9\u9635\u5305\u542b\u4e86\u8ba1\u7b97\u6295\u8d44\u7ec4\u5408\u98ce\u9669\u6240\u9700\u7684\u6240\u6709\u4fe1\u606f\uff0c\u98ce\u9669\u6a21\u578b\u7684\u76ee\u6807\u5c31\u662f\u5c31\u662f\u7cbe\u51c6\u7684\u9884\u6d4b \u534f\u65b9\u5dee\u77e9\u9635\u3002 </p> <p>\u7ecf\u5178\u7684\u591a\u56e0\u5b50\u6a21\u578b\u8868\u8fbe\u5f0f $$ \\tilde{r}j = \\sum{k=1}^K{X_{jk}\\tilde{f}k} + \\tilde{u}_j \\ \ud835\udc4b{\ud835\udc57\ud835\udc58}: \u80a1\u7968\ud835\udc57\u5728\u56e0\u5b50\ud835\udc58\u4e0a\u7684\u56e0\u5b50\u66b4\u9732\uff08\u56e0\u5b50\u8f7d\u8377\uff09\\ \\tilde{f}_\ud835\udc58:\u56e0\u5b50\ud835\udc58\u7684\u56e0\u5b50\u6536\u76ca \\ \\tilde{u}_\ud835\udc57: \u80a1\u7968\ud835\udc57\u7684\u6b8b\u5dee\u6536\u76ca $$ \u5b9a\u91cf\u7ba1\u7406\u4e3b\u8981\u4ece\u7edf\u8ba1\u7684\u89d2\u5ea6\u7814\u7a76\u56e0\u5b50\u6536\u76ca\u7387\u7684\u53d8\u5316\u89c4\u5f8b*\uff0c\u5e76\u4e14\u4ece\u7ec4\u5408\u7684\u89d2\u5ea6\u5bf9\u56e0\u5b50\u66b4\u9732\u8fdb\u884c \u7ba1\u7406\u4ee5\u8d85\u8d8a\u57fa\u51c6\uff1b</p> <p>\u5b9a\u6027\u7ba1\u7406\u4e3b\u8981\u7814\u7a76\u4e2a\u80a1\u7684\u6b8b\u5dee\u6536\u76ca\u7387\uff0c\u5373\u4ece\u56e0\u5b50\u89d2\u5ea6\u65e0\u6cd5\u89e3\u91ca\u7684\u8d85\u989d\u6536\u76ca \u7387\u3002</p> <p>\u5b9a\u91cf\u7ba1\u7406\u4e3b\u8981\u7814\u7a76$ \\sum_{k=1}^K{X_{jk}*\\tilde{f}_k}\\(\uff0c\u5b9a\u6027\u7ba1\u7406\u4e3b\u8981\u7814\u7a76\\)\\tilde{u}_\ud835\udc57$\u3002</p> <p>Alpha \u7684\u5b9a\u4e49</p> <p>\u9ad8\u4e8e\u5e02\u573a\u7684\u8fd9\u90e8\u5206\u6536\u76ca\u79f0\u4e4b\u4e3a\u8d85\u989d\u6536\u76ca\uff0c\u4e5f\u5c31\u662f\u8be5\u57fa\u91d1\u7b56\u7565\u7684Alpha\u3002\u800c\u5e02\u573a\u672c\u8eab\u7684\u6da8\u8dcc\u5e45\uff0c\u79f0\u4e4b\u4e3aBeta\u3002</p> <p>Alpha \u548c Beta \u662f\u76f8\u8f85\u76f8\u6210\u7684\uff0c\u5206\u522b\u662f\u4f7f\u7528\u7ebf\u6027\u56de\u5f52\u5c06\u7ec4\u5408\u6536\u76ca\u7387\u5206\u89e3\u4e3a\u4e0e\u4e1a\u7ee9\u57fa\u51c6\u76f8\u5173\u7684\u90e8\u5206\u548c\u4e1a\u7ee9\u57fa\u51c6\u4e0d\u76f8\u5173\u7684\u6b8b\u5dee\u90e8\u5206\u3002\u5982\u679c\\(\ud835\udc5f_P(\ud835\udc61)\\)\u662f\u6295\u8d44\u7ec4\u5408\u5728\u65f6\u70b9\ud835\udc61 = 1, 2, 3, \u22ef , \ud835\udc47\u4e0a\u7684\u8d85\u989d\u6536\u76ca\u7387\uff0c\\(r_\ud835\udc35(\ud835\udc61)\\)\u662f\u4e1a\u7ee9\u57fa\u51c6\u5728\u540c\u65f6\u671f\u7684\u8d85\u989d\u6536\u76ca\u7387\uff0c\u90a3\u4e48\u56de\u5f52\u6a21\u578b\u4e3a\uff1a $$ r_\ud835\udc43(\ud835\udc61) = \\alpha_\ud835\udc43 + \\beta_\ud835\udc43 \u2217 \ud835\udc5f_\ud835\udc35(\ud835\udc61) + \\varepsilon_\ud835\udc43(\ud835\udc61) $$</p> <p>\u5229\u7528\u56de\u5f52\u5206\u6790\u8ba1\u7b97\u51fa\u6765\u7684\\(\ud835\udefd_\ud835\udc43\\)\u548c\\(\ud835\udefc_\ud835\udc43\\)\u7684\u4f30\u8ba1\u503c\u79f0\u4e3a\u5b9e\u73b0\u7684\u6216\u8005\u5386\u53f2\u7684 Beta \u548c Alpha\u3002\u7ec4\u5408\ud835\udc43\u7684\u6b8b \u5dee\u6536\u76ca\u7387\u662f\uff1a $$ \\theta_\ud835\udc43(\ud835\udc61) = \\alpha_\ud835\udc43 + \\varepsilon_\ud835\udc43(\ud835\udc61) $$</p> <p>\\(\ud835\udefc_\ud835\udc43\\)\u662f\u5e73\u5747\u6b8b\u5dee\u6536\u76ca\u7387\uff0c \\(\ud835\udf00_\ud835\udc43(\ud835\udc61)\\)\u662f\u6b8b\u5dee\u6536\u76ca\u7387\u4e2d\u5747\u503c\u4e3a\u96f6\u7684\u968f\u673a\u9879\u3002</p> <p>\u6839\u636e\u5b9a\u4e49\uff0c\u4e1a\u7ee9\u57fa\u51c6\u7ec4\u5408\u7684\u6b8b\u5dee\u6536\u76ca\u7387\u603b\u662f\u7b49\u4e8e\u96f6\uff0c\u5373\\(\ud835\udf03_\ud835\udc35 = 0\\)\u603b\u662f\u6210\u7acb\u3002\u56e0\u6b64\uff0c\u4e1a\u7ee9\u57fa\u51c6\u7ec4 \u5408\u7684 Alpha \u5fc5\u7136\u7b49\u4e8e\u96f6\uff0c\u5373\\(\ud835\udefc_\ud835\udc35 = 0\\)\u3002\u4e3a\u4e86\u4fdd\u8bc1\\(\ud835\udefc_\ud835\udc35\\) = 0\uff0c\u6211\u4eec\u8981\u6c42\u80a1\u7968\u5c42\u9762\u7684 Alpha \u5217\u5411\u91cf\u6ee1 \u8db3\u4e1a\u7ee9\u57fa\u51c6\u4e2d\u6027\u7684\u7ea6\u675f\u3002  </p> <p>\u4e1a\u7ee9\u7684\u8861\u91cf</p> <p>\u5e38\u7528\u6307\u6807\u662f\u4fe1\u606f\u6bd4\u7387IR\uff0c\u8868\u793a\u5e74\u5316\u6b8b\u5dee\u6536\u76ca\u7387\u5bf9\u5e74\u5316\u6b8b\u5dee\u98ce\u9669\u7684\u6bd4\u503c\u3002 $$ IR_p = \\frac{\\alpha_p}{\\omega_p} $$ \u7531\u4e8e\u4e3b\u52a8\u7ba1\u7406\u662f\u4e2a\u96f6\u548c\u6e38\u620f\uff0c\u6240\u4ee5\u4fe1\u606f\u6bd4\u7387IR\u5177\u6709\u5747\u503c\u4e3a0\u7684\u5bf9\u79f0\u5206\u5e03\u3002</p> <p>\u4fe1\u606f\u6bd4\u4f8b\u7684\u4e00\u79cd\u5206\u89e3\u65b9\u5f0f\u662f\uff1a</p> \\[ IR = \ud835\udc3c\ud835\udc36 \u2217 \\sqrt{\ud835\udc35\ud835\udc45} \\] <p>\u5373\u6295\u8d44\u7ec4\u5408\u7684\u4fe1\u606f\u6bd4\u7387 IR \u53d6\u51b3\u4e8e\u6295\u8d44\u7b56\u7565\u7684\u5e7f\u5ea6 BR\u548c\u4fe1\u606f\u7cfb\u6570 IC\u3002</p> <ol> <li>BR\uff08Breadth\uff09\uff1a\u6295\u8d44\u7b56\u7565\u7684\u5e7f\u5ea6\uff0c\u5373\u7b56\u7565\u6bcf\u5e74\u5bf9\u8d85\u989d\u6536\u76ca\u7387\u505a\u51fa\u7684\u72ec\u7acb\u9884\u6d4b\u6570\u76ee\uff1b</li> <li>IC\uff08Information Coefficient\uff09\uff1a\u4fe1\u606f\u7cfb\u6570\u662f\u6bcf\u4e2a\u9884\u6d4b\u4e0e\u5b9e\u73b0\u7ed3\u679c\u4e4b\u95f4\u7684\u76f8\u5173\u7cfb\u6570\u3002</li> </ol> <p>\u8fd9\u4e2a\u5b9a\u5f8b\u660e\u786e\u5730\u544a\u8bc9\u6211\u4eec\uff1a \u8981\u60f3\u63d0\u9ad8\u4fe1\u606f\u6bd4\u7387\uff0c\u5c31\u8981\u505a\u5f97\u9891\u7e41\uff08\u9ad8\u5e7f\u5ea6 BR\uff09 \u5e76\u4e14\u505a\u5f97\u51fa\u8272\uff08\u9ad8\u80fd\u529b IC\uff09\u3002  </p>"},{"location":"financial/multi_factor_model/mfm.html","title":"\u591a\u56e0\u5b50\u6a21\u578b","text":""},{"location":"financial/multi_factor_model/mfm.html#_2","title":"\u6a21\u578b\u548c\u6982\u5ff5","text":"<p>\u591a\u56e0\u5b50\u6a21\u578b\u65b9\u7a0b\uff1a $$ \\tilde{r}j = \\sum{k=1}^K{X_{jk}\\tilde{f}k} + \\tilde{u}_j \\ \ud835\udc4b{\ud835\udc57\ud835\udc58}: \u80a1\u7968\ud835\udc57\u5728\u56e0\u5b50\ud835\udc58\u4e0a\u7684\u56e0\u5b50\u66b4\u9732\uff08\u56e0\u5b50\u8f7d\u8377\uff09\\ \\tilde{f}_\ud835\udc58:\u56e0\u5b50\ud835\udc58\u7684\u56e0\u5b50\u6536\u76ca \\ \\tilde{u}_\ud835\udc57: \u80a1\u7968\ud835\udc57\u7684\u6b8b\u5dee\u6536\u76ca $$ \u591a\u56e0\u5b50\u6a21\u578b\u6709\u4e09\u79cd\u4e3b\u8981\u8868\u73b0\u5f62\u5f0f*\uff1a</p> <ul> <li>\u5b8f\u89c2\u7ecf\u6d4e\u56e0\u5b50\u6a21\u578b\uff1a\u53ef\u89c2\u5bdf\u5230\u7684\u5b8f\u89c2\u7ecf\u6d4e\u6570\u636e\u5e8f\u5217\uff0c\u6bd4\u5982\u901a\u8d27\u81a8\u80c0\u7387\u3001\u5229\u7387\u7b49\u6307\u6807\uff0c\u4f5c\u4e3a\u80a1\u7968\u5e02\u573a\u6536\u76ca\u7387\u53d8\u52a8\u7684\u4e3b\u8981\u89e3\u91ca\u53d8\u91cf\u3002  </li> <li>\u57fa\u672c\u9762\u56e0\u5b50\u6a21\u578b\uff1a\u4f7f\u7528\u53ef\u89c2\u5bdf\u5230\u7684\u80a1\u7968\u81ea\u8eab\u7684\u57fa\u672c\u5c5e\u6027\uff0c\u6bd4\u5982\u5206\u7ea2\u6bd4\u4f8b\u3001\u4f30\u503c\u6c34\u5e73\u3001\u6210\u957f\u6027\u3001\u6362\u624b\u7387\u7b49\u6307\u6807\uff0c\u4f5c\u4e3a\u80a1\u7968\u5e02\u573a\u6536\u76ca\u7387\u53d8\u52a8\u7684\u4e3b\u8981\u89e3\u91ca\u53d8\u91cf\u3002\u57fa\u672c\u9762\u56e0\u5b50\u4e3b\u8981\u662f\u8fdb\u884c\u6a2a\u622a\u9762\u5206\u6790\uff0c\u786e\u5b9a\u80a1\u7968\u6536\u76ca\u7387\u5bf9\u56e0\u5b50\u7684\u654f\u611f\u6027\uff08Beta \u503c\uff09</li> <li>\uff0c\u57fa\u672c\u9762\u56e0\u5b50\u4e00\u822c\u53ef\u4ee5\u5f52\u7eb3\u4e3a\u57fa\u672c\u9762\u7c7b\u3001\u4f30\u503c\u7c7b\u3001\u5e02\u573a\u7c7b\u3002</li> <li>\u7edf\u8ba1\u56e0\u5b50\u6a21\u578b\uff1a\u4ece\u80a1\u7968\u6536\u76ca\u7387\u7684\u534f\u65b9\u5dee\u77e9\u9635\u4e2d\u63d0\u53d6\u7edf\u8ba1\u56e0\u5b50\uff0c\u4f5c\u4e3a\u80a1\u7968\u5e02\u573a\u6536\u76ca\u7387\u53d8\u52a8\u7684\u4e3b\u8981\u89e3\u91ca\u53d8\u91cf\u3002\u5e38\u89c1\u7684\u7edf\u8ba1\u5206\u6790\u65b9\u6cd5\u6709\u4e3b\u6210\u5206\u5206\u6790\u3001\u6700\u5927\u4f3c\u7136\u5206\u6790\u548c\u9884\u671f\u6700\u5927\u5316\u5206\u6790\u3002</li> </ul> <p>\u57fa\u672c\u9762\u56e0\u5b50\u6a21\u578b</p> <p>\u4e3b\u6d41\u7684\u7814\u7a76\u6a21\u578b\u3002\u5047\u8bbe\uff1a \u5177\u6709\u7c7b\u4f3c\u201c\u5c5e\u6027\u201d\u7684\u80a1\u7968\uff0c\u5728\u5e02\u573a\u4e0a\u5e94\u8be5\u6709\u76f8\u4f3c\u7684\u6536\u76ca\u7387\u3002  </p> <p>\u591a\u56e0\u5b50\u6a21\u578b\u8bc6\u522b\u8fd9\u4e9b\u5171\u540c\u7684\u57fa\u672c\u9762\u56e0\u5b50\uff0c\u5e76\u4e14\u4f30\u8ba1\u6536\u76ca\u7387\u5bf9\u8fd9\u4e9b\u56e0\u5b50\u7684\u654f\u611f\u6027\uff0c\u5f97\u51fa\u80a1\u7968\u6216\u8005\u7ec4\u5408\u7684\u9884\u671f\u6536\u76ca\u7387\uff0c\u6700\u540e\u901a\u8fc7\u98ce\u9669\u6a21\u578b\uff0c\u6839\u636e\u6295\u8d44\u8005\u7684\u6536\u76ca\u2014\u98ce\u9669\u504f\u597d\u6311\u9009\u5408\u9002\u7684\u80a1\u7968\u5e76\u8fdb\u884c\u6743\u91cd\u5206\u914d\u3002</p> <p>\u5047\u8bbe\u4e00\u4e2a\u6295\u8d44\u7ec4\u5408\u7531\ud835\udc41\u4e2a\u80a1\u7968\u7ec4\u6210\uff0c\u5b83\u4eec\u5728\u7ec4\u5408\u4e2d\u7684\u6743\u91cd\u5206\u522b\u662f\\(\u210e_{p1}, \u210e_{p2}, \u2026 , \u210e_{p\ud835\udc41}\\)\uff0c\u5219\u7ec4\u5408\u7684\u6536\u76ca\u7387\u4e3a\uff1a $$ \\tilde{r_p} = \\sum_{k=1}^K{\\tilde{X_{pk}} * \\tilde{f_k}} + \\sum_{j=1}^N{h_{pj} * \\tilde{u_j}} \\ \u5176\u4e2d\uff0c\\tilde{\ud835\udc4b_{p\ud835\udc58}} = \\sum_{j=1}^N{\u210e_{p\ud835\udc57}} \u2217 \ud835\udc4b_{\ud835\udc57\ud835\udc58} $$ \u591a\u56e0\u5b50\u6a21\u578b\u98ce\u9669\u9884\u6d4b</p> <p>\u5bf9\u4e8e\u4e00\u4e2a\u5305\u542b\ud835\udc41\u53ea\u80a1\u7968\u548c\ud835\udc3e\u4e2a\u56e0\u5b50\u7684\u7cfb\u7edf\uff0c\u591a\u56e0\u5b50\u6a21\u578b\u672c\u8d28\u4e0a\u662f\u5c06\u5bf9\u4e8e\ud835\udc41\u53ea\u80a1\u7968\u7684\u6536\u76ca\u2014\u98ce\u9669\u9884\u6d4b\u8f6c\u53d8\u6210\u5bf9\u4e8e\ud835\udc3e\u4e2a\u56e0\u5b50\u7684\u6536\u76ca\u2014\u98ce\u9669\u9884\u6d4b\u3002  </p> <p>\u5047\u8bbe\u6b8b\u5dee\u6536\u76ca\u7387\\(\\tilde{\ud835\udc62_\ud835\udc57}\\)\u4e0e\u56e0\u5b50\u6536\u76ca\u7387\\(\\tilde{f_\ud835\udc58}\\)\u72ec\u7acb\uff0c\u5e76\u4e14\u4e0d\u540c\u80a1\u7968\u7684\u6b8b\u5dee\u6536\u76ca\u7387\u4e4b\u95f4\u4e5f\u4e92\u76f8\u72ec\u7acb\u3002\u5728\u591a\u56e0\u5b50\u6a21\u578b\u7684\u6846\u67b6\u4e0b\uff0c\u5e02\u573a\u7684\u98ce\u9669\u7ed3\u6784\u53d8\u4e3a\uff1a $$ V_{i,j}=\\sum_{k1,k2=1}^{K}{X_{i,k1} * F_{k1,k2} * X_{j,k2}} + \\Delta_{i,j} \\ V_{i,j}: \u80a1\u7968\ud835\udc56\u548c\u80a1\u7968\ud835\udc57\u7684\u534f\u65b9\u5dee \\ X_{i,k1}: \u80a1\u7968\ud835\udc56\u5bf9\u56e0\u5b50\ud835\udc581 \u7684\u66b4\u9732\u5ea6\uff08\u56e0\u5b50\u8f7d\u8377\uff09 \\ F_{k1,k2}: \u56e0\u5b50\ud835\udc581\u548c\u56e0\u5b50\ud835\udc582\u4e4b\u95f4\u7684\u6536\u76ca\u7387\u534f\u65b9\u5dee \\ \\Delta_{i,j}: \u80a1\u7968\ud835\udc56\u548c\u80a1\u7968\ud835\udc57\u4e4b\u95f4\u6b8b\u5dee\u7684\u534f\u65b9\u5dee\uff0c \ud835\udc56 \u2260 \ud835\udc57\u65f6\u4e3a 0 $$ \u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u6295\u8d44\u7ec4\u5408\ud835\udc43\u90fd\u53ef\u4ee5\u7528\u4e00\u4e2a\ud835\udc41\u7ef4\u5411\u91cf\\(\u210e_p\\)\u6765\u63cf\u8ff0\uff0c\u5176\u4e2d\\(\u210e_p\\)\u662f\u7ec4\u5408\ud835\udc43\u5728\ud835\udc41\u53ea\u80a1\u7968\u4e0a\u7684\u6301\u4ed3\u6743\u91cd\u3002\u5219\u7ec4\u5408\ud835\udc43\u7684\u56e0\u5b50\u66b4\u9732\u5ea6\u662f\uff1a</p> <p>$$ x_p = X^T * h_p $$ \u7ec4\u5408\ud835\udc43\u7684\u65b9\u5dee\u4e3a\uff1a</p> <p>$$ \\sigma_p^2 = \ud835\udc65_p^\ud835\udc47 \u2217 \ud835\udc39 \u2217 \ud835\udc65_p + \u210e_p^\ud835\udc47 \u2217 \u2206 \u2217 \u210e_p = \u210e_p^\ud835\udc47 \u2217 \ud835\udc49 \u2217 \u210e_p $$ \u591a\u56e0\u5b50\u6a21\u578b\u98ce\u9669\u5206\u89e3</p> <p>\u5f71\u54cd\u80a1\u7968\u6536\u76ca\u7684\u56e0\u5b50\u6309\u7167\u903b\u8f91\u53ef\u4ee5\u5206\u6210\u4e09\u79cd\u7c7b\u578b\uff1a  </p> <ul> <li>\u5e02\u573a\u98ce\u9669\uff1a\u725b\u5e02\u548c\u718a\u5e02\uff0c\u6d89\u53ca\u6240\u6709\u80a1\u7968\uff1b</li> <li>\u884c\u4e1a\u98ce\u9669\uff1a\u76f8\u540c\u6216\u76f8\u4f3c\u4e1a\u52a1\u7684\u516c\u53f8\u7684\u80a1\u7968\uff1b</li> <li>\u98ce\u683c\u98ce\u9669\uff1a\u9664\u4e0a\u8ff0\u4e24\u79cd\u5916\uff0c\u80a1\u7968\u5e02\u573a\u7ed3\u6784\u8868\u73b0\u5728\u4e00\u5b9a\u65f6\u671f\u5185\u5448\u73b0\u5f3a\u70c8\u7684\u98ce\u683c\u7279\u5f81\u3002</li> <li>\u6682\u5206\u4e3a12\u7c7b\u7684\u98ce\u683c\u56e0\u5b50\u3002</li> </ul>"},{"location":"financial/multi_factor_model/mfm.html#_3","title":"\u6784\u5efa\u6d41\u7a0b","text":""},{"location":"financial/multi_factor_model/mfm.html#_4","title":"\u6784\u5efa\u6d41\u7a0b\u56fe","text":"<p>\u6b8b\u5dee\u5f02\u65b9\u5dee\u5206\u6790\uff1a\u5982\u679c\u56de\u5f52\u7684\u6b8b\u5dee\u9879\u5177\u6709\u4e0d\u540c\u7684\u65b9\u5dee\uff0c\u5219\u79f0\u56de\u5f52\u6a21\u578b\u5b58\u5728\u5f02\u65b9\u5dee\u3002\u5982\u679c\u5b58\u5728\u5f02\u65b9\u5dee\uff0c\u5219\u4f20\u7edf\u7684\u6700\u5c0f\u4e8c\u4e58\u56de\u5f52\u5f97\u5230\u7684\u53c2\u6570\u4f30\u8ba1\u91cf\u4e0d\u662f\u6709\u6548\u4f30\u8ba1\u91cf\uff0c\u6240\u4ee5\u5728\u8fdb\u884c\u591a\u5143\u7ebf\u6027\u56de\u5f52\u4e4b\u524d\u5fc5\u987b\u8fdb\u884c\u6b8b\u5dee\u7684\u5f02\u65b9\u5dee\u5206\u6790\u3002 \u6839\u636e Barra \u7684\u6587\u6863\uff0c \u53ef\u4ee5\u91c7\u7528\u4e2a\u80a1\u6d41\u901a\u5e02\u503c\u7684\u5e73\u65b9\u6839\u4f5c\u4e3a\u6743\u91cd\u8fdb\u884c\u52a0\u6743\u6700\u5c0f\u4e8c\u4e58\u6cd5\u56de\u5f52\uff0c\u7ecf\u5b9e\u8df5\u5728\u5927\u90e8\u5206\u622a\u9762\u671f\u4e0a\u53ef\u4ee5\u6d88\u9664\u5f02\u65b9\u5dee\u7684\u5f71\u54cd\uff1b  </p>"},{"location":"financial/multi_factor_model/mfm.html#_5","title":"\u51c6\u5907\u5de5\u4f5c","text":""},{"location":"financial/multi_factor_model/mfm.html#_6","title":"\u57fa\u7840\u6570\u636e\u91c7\u96c6","text":"<p>\u4e3b\u8981\u6307\u98ce\u683c\u56e0\u5b50\u7684\u57fa\u7840\u6570\u636e\u91c7\u96c6\u3002</p> <ul> <li>\u786e\u5b9a\u5907\u9009\u56e0\u5b50\u6c60\uff1b</li> <li>\u786e\u5b9a\u56e0\u5b50\u7684\u5177\u4f53\u8ba1\u7b97\u65b9\u6cd5\u3002</li> </ul> \u5927\u7c7b\u56e0\u5b50 \u5177\u4f53\u56e0\u5b50 \u56e0\u5b50\u63cf\u8ff0 \u4f30\u503c\u56e0\u5b50 \uff08Value Factor\uff09 EP \u51c0\u5229\u6da6\uff08TTM\uff0c \u8fc7\u53bb12\u4e2a\u6708\uff09 /\u603b\u5e02\u503c EPcut \u6263\u9664\u975e\u7ecf\u5e38\u6027\u635f\u76ca\u540e\u51c0\u5229\u6da6/\u603b\u5e02\u503c BP \u51c0\u8d44\u4ea7/\u603b\u5e02\u503c SP \u8425\u4e1a\u6536\u5165/\u603b\u5e02\u503c NCFP \u51c0\u73b0\u91d1\u6d41/\u603b\u5e02\u503c OCFP \u7ecf\u8425\u6027\u73b0\u91d1\u6d41/\u603b\u5e02\u503c FCFP \u81ea\u7531\u73b0\u91d1\u6d41/\u603b\u5e02\u503c DP \u5206\u7ea2/\u603b\u5e02\u503c \u6210\u957f\u56e0\u5b50 \uff08Growth Factor\uff09 sales_growth_q \u8425\u4e1a\u6536\u5165\u589e\u957f\u7387_\u5f53\u5b63\u540c\u6bd4 sales_growth_ttm \u8425\u4e1a\u6536\u5165\u589e\u957f\u7387_TTM \u540c\u6bd4 sales_growth_3y \u8425\u4e1a\u6536\u5165\u589e\u957f\u7387_\u4e09\u5e74\u590d\u5408\u589e\u957f\u7387 profit_growth_q \u6263\u975e\u540e\u51c0\u5229\u6da6\u589e\u957f\u7387_\u5f53\u5b63\u540c\u6bd4 profit_growth_ttm \u6263\u975e\u540e\u51c0\u5229\u6da6\u589e\u957f\u7387_TTM \u540c\u6bd4 profit_growth_3y \u6263\u975e\u548c\u51c0\u5229\u6da6\u589e\u957f\u7387_\u4e09\u5e74\u590d\u5408\u589e\u957f\u7387 operationcashflow_growth_q \u7ecf\u8425\u6027\u73b0\u91d1\u6d41\u589e\u957f\u7387_\u5f53\u5b63\u540c\u6bd4 operationcashflow_growth_ttm \u7ecf\u8425\u6027\u73b0\u91d1\u6d41\u589e\u957f\u7387_TTM \u540c\u6bd4 operationcashflow_growth_3y \u7ecf\u8425\u6027\u73b0\u91d1\u6d41\u589e\u957f\u7387_\u4e09\u5e74\u590d\u5408\u589e\u957f\u7387 \u8d22\u52a1\u8d28\u91cf\u56e0\u5b50 \uff08Financial Quality Factor\uff09 roe_q ROE_\u5f53\u5b63 roe_ttm ROE_TTM roa_q ROA_\u5f53\u5b63 roa_ttm ROA_TTM grossprofitmargin_q \u6bdb\u5229\u7387_\u5f53\u5b63 grossprofitmargin_ttm \u6bdb\u5229\u7387_TTM profitmargin_q \u6263\u975e\u540e\u5229\u6da6\u7387_\u5f53\u5b63 profitmargin_ttm \u6263\u975e\u540e\u5229\u6da6\u7387_TTM assetturnover_q \u8d44\u4ea7\u5468\u8f6c\u7387_\u5f53\u5b63 assetturnover_ttm \u8d44\u4ea7\u5468\u8f6c\u7387_TTM operationcashflowratio_q \u7ecf\u8425\u6027\u73b0\u91d1\u6d41/\u51c0\u5229\u6da6_\u5f53\u5b63 operationcashflowratio_ttm \u7ecf\u8425\u6027\u73b0\u91d1\u6d41/\u51c0\u5229\u6da6_TTM \u6760\u6746\u56e0\u5b50 \uff08Leverage Factor\uff09 marketvalue_leverage \uff08\u5e02\u503c+\u4f18\u5148\u80a1+\u957f\u671f\u8d1f\u503a\uff09 /\u5e02\u503c financial_leverage \u603b\u8d44\u4ea7/\u666e\u901a\u80a1\u6743\u76ca debtequityratio \u957f\u671f\u503a\u52a1/\u666e\u901a\u80a1\u6743\u76ca cashration \u73b0\u91d1\u6bd4\u7387 currentratio \u6d41\u52a8\u6bd4\u7387 \u89c4\u6a21\u56e0\u5b50 \uff08Size Factor\uff09 ln_capital \u5e02\u503c\u5bf9\u6570 \u52a8\u91cf\u56e0\u5b50 \uff08Momentum Factor\uff09 HAlpha \u4e2a\u80a160\u4e2a\u6708\u6536\u76ca\u5bf9\u6caa\u6307\u56de\u5f52\u7684 Alpha relative_strength_1m \u6700\u8fd1\u4e00\u4e2a\u6708\u6536\u76ca\u7387 relative_strength_2m \u6700\u8fd1\u4e24\u4e2a\u6708\u6536\u76ca\u7387 relative_strength_3m \u6700\u8fd1\u4e09\u4e2a\u6708\u6536\u76ca\u7387 relative_strength_6m \u6700\u8fd1\u516d\u4e2a\u6708\u6536\u76ca\u7387 relative_strength_12m \u6700\u8fd1\u5341\u4e8c\u4e2a\u6708\u6536\u76ca\u7387 \u6ce2\u52a8\u7387\u56e0\u5b50 \uff08Volatility Factor\uff09 high_low_1m \u6700\u9ad8\u4ef7/\u6700\u4f4e\u4ef7\uff08\u6700\u8fd1\u4e00\u4e2a\u6708\u5185\u4ef7\u683c\uff09 high_low_2m \u6700\u9ad8\u4ef7/\u6700\u4f4e\u4ef7\uff08\u6700\u8fd1\u4e24\u4e2a\u6708\u5185\u4ef7\u683c\uff09 high_low_3m \u6700\u9ad8\u4ef7/\u6700\u4f4e\u4ef7\uff08\u6700\u8fd1\u4e09\u4e2a\u6708\u5185\u4ef7\u683c\uff09 high_low_6m \u6700\u9ad8\u4ef7/\u6700\u4f4e\u4ef7\uff08\u6700\u8fd1\u516d\u4e2a\u6708\u5185\u4ef7\u683c\uff09 high_low_12m \u6700\u9ad8\u4ef7/\u6700\u4f4e\u4ef7\uff08\u6700\u8fd1\u5341\u4e8c\u4e2a\u6708\u5185\u4ef7\u683c\uff09 std_1m \u6700\u8fd1\u4e00\u4e2a\u6708\u7684\u65e5\u6536\u76ca\u7387\u6807\u51c6\u5dee std_2m \u6700\u8fd1\u4e24\u4e2a\u6708\u7684\u65e5\u6536\u76ca\u7387\u6807\u51c6\u5dee std_3m \u6700\u8fd1\u4e09\u4e2a\u6708\u7684\u65e5\u6536\u76ca\u7387\u6807\u51c6\u5dee std_6m \u6700\u8fd1\u516d\u4e2a\u6708\u7684\u65e5\u6536\u76ca\u7387\u6807\u51c6\u5dee std_12m \u6700\u8fd1\u5341\u4e8c\u4e2a\u6708\u7684\u65e5\u6536\u76ca\u7387\u6807\u51c6\u5dee ln_price \u80a1\u4ef7\u53d6\u5bf9\u6570 beta_consistence \u4e2a\u80a160\u4e2a\u6708\u6536\u76ca\u5bf9\u6caa\u6307\u56de\u5f52 beta \u4e58\u4ee5\u6b8b\u5dee\u6807\u51c6\u5dee \u6362\u624b\u7387\u56e0\u5b50 \uff08Turnover Factor\uff09 turnover_1m \u6700\u8fd1\u4e00\u4e2a\u6708\u6362\u624b\u7387 turnover_2m \u6700\u8fd1\u4e24\u4e2a\u6708\u6362\u624b\u7387 turnover_3m \u6700\u8fd1\u4e09\u4e2a\u6708\u6362\u624b\u7387 turnover_6m \u6700\u8fd1\u516d\u4e2a\u6708\u6362\u624b\u7387 turnover_12m \u6700\u8fd1\u5341\u4e8c\u4e2a\u6708\u6362\u624b\u7387 \u6539\u8fdb\u7684\u52a8\u91cf\u56e0\u5b50 \uff08Modified Momentum Factor\uff09 weighted_strength_1m \u6700\u8fd1\u4e00\u4e2a\u6708\u6362\u624b\u7387\u52a0\u6743\u65e5\u5747\u6536\u76ca\u7387 weighted _strength_2m \u6700\u8fd1\u4e24\u4e2a\u6708\u6362\u624b\u7387\u52a0\u6743\u65e5\u5747\u6536\u76ca\u7387 weighted _strength_3m \u6700\u8fd1\u4e09\u4e2a\u6708\u6362\u624b\u7387\u52a0\u6743\u65e5\u5747\u6536\u76ca\u7387 weighted _strength_6m \u6700\u8fd1\u516d\u4e2a\u6708\u6362\u624b\u7387\u52a0\u6743\u65e5\u5747\u6536\u76ca\u7387 weighted_strength_12m \u6700\u8fd1\u5341\u4e8c\u4e2a\u6708\u6362\u624b\u7387\u52a0\u6743\u65e5\u5747\u6536\u76ca\u7387 \u5206\u6790\u5e08\u60c5\u7eea\u56e0\u5b50 \uff08Sentiment Factor\uff09 rating_average Wind \u5e73\u5747\u8bc4\u7ea7 rating_change Wind \u8bc4\u7ea7\uff1a\uff08\u4e0a\u8c03\u6570-\u4e0b\u8c03\u6570\uff09 /\u603b\u8bc4\u7ea7\u6570 rating_targetprice Wind \u4e00\u81f4\u76ee\u6807\u4ef7/\u73b0\u4ef7-1 \u80a1\u4e1c\u56e0\u5b50 \uff08Shareholder Factor\uff09 holder_avgpct \u6237\u5747\u6301\u80a1\u6bd4\u4f8b holder_avgpctchange_half \u6237\u5747\u6301\u80a1\u6bd4\u4f8b\u8fc7\u53bb\u534a\u5e74\u589e\u957f\u7387 holder_avgpctchange \u6237\u5747\u6301\u80a1\u6bd4\u4f8b\u8fc7\u53bb\u4e00\u5e74\u589e\u957f\u7387 \u6280\u672f\u56e0\u5b50 \uff08Technical Factor\uff09 macd macd dif dif dea de"},{"location":"financial/multi_factor_model/mfm.html#_7","title":"\u6570\u636e\u6807\u51c6\u5316","text":"<p>\u56e0\u5b50\u7684\u91cf\u7eb2\u4e0d\u4e00\u81f4\uff0c\u91c7\u7528\u6807\u51c6\u5316\u5904\u7406\uff1a</p> <ul> <li>\u76f4\u63a5\u5bf9\u56e0\u5b50\u8f7d\u8377\u539f\u59cb\u503c\u8fdb\u884c\u6807\u51c6\u5316\uff1b \u6216</li> <li>\u4fdd\u7559\u56e0\u5b50\u8f7d\u8377\u4e4b\u95f4\u7684\u539f\u59cb\u5206\u5e03\u5173\u7cfb\uff0c\u4f46\u56de\u5f52\u65f6\u4f1a\u53d7\u6781\u7aef\u503c\u5f71\u54cd\uff1b</li> <li>\u5148\u5c06\u56e0\u5b50\u8f7d\u8377\u539f\u59cb\u503c\u8f6c\u4e3a\u6392\u5e8f\u503c\uff0c\u518d\u8fdb\u884c\u6807\u51c6\u5316\u3002</li> <li>\u6807\u51c6\u5316\u540e\u7684\u5206\u5e03\u662f\u6b63\u6001\u5206\u5e03\uff0c\u5bb9\u6613\u770b\u51fa\u56e0\u5b50\u8f7d\u8377\u548c\u6536\u76ca\u7387\u95f4\u7684\u76f8\u5173\u6027\u7684\u65b9\u5411\u3002</li> </ul> <p>\u56e0\u5b50\u8f7d\u8377\u539f\u59cb\u503c\u6807\u51c6\u5316</p> <p>\u4e2d\u4f4d\u6570\u53bb\u6781\u503c\u6cd5 $$ \\tilde{x_i}=\\begin{cases}x_M+nD_{MAD}, \\quad if \\quad x_i&gt;x_M+nD_{MAD} \\ x_M-nD_{MAD}, \\quad if \\quad x_i &lt; x_M+nD_{MAD}\\ x_i, \\qquad\\qquad\\qquad\\qquad\\qquad\\qquad else  \\end{cases} \\ x_M: \u5e8f\u5217x_i\u7684\u4e2d\u4f4d\u6570 \\ D_{MAD}: \u5e8f\u5217|x_i-x_M|\u7684\u4e2d\u4f4d\u6570 \\ \\tilde{x_i}: x_i\u53bb\u6781\u503c\u4fee\u6b63\u540e\u7684\u503c $$</p> <p>\u6570\u636e\u53bb\u6781\u503c\u540e\u7684\u5e8f\u5217\u518d\u8fdb\u884c\u6807\u51c6\u5316\uff1a</p> <p>$$ \\tilde{x_i}=\\frac{x_i-u}{\\sigma} \\ u:\u5e8f\u5217x_i\u7684\u5747\u503c \\ \\sigma: \u5e8f\u5217x_i\u7684\u6807\u51c6\u5dee \\ \\tilde{x_i}:\u5e8f\u5217x_i\u6807\u51c6\u5316\u4e4b\u540e\u7684\u503c $$ \u56e0\u5b50\u8f7d\u8377\u6392\u5e8f\u503c\u6807\u51c6\u5316</p> <p>\u7b2c\u4e00\u6b65\u5c06\u539f\u59cb\u5e8f\u5217\u8f6c\u6362\u4e3a\u5e8f\u5173\u7cfb\u5e8f\u5217\uff1b $$ \\tilde{x_i}= rank(x_i) \\ \\tilde{x_i}: x_i\u5728\u5e8f\u5217\u4e2d\u7684\u6392\u5e8f\u503c $$ \u7b2c\u4e8c\u6b65\u6807\u51c6\u5316\u65b9\u6cd5\u4e0e\u524d\u9762\u7684\u6807\u51c6\u5316\u65b9\u6cd5\u4e00\u81f4\u3002  </p>"},{"location":"financial/multi_factor_model/mfm.html#_8","title":"\u6709\u6548\u56e0\u5b50\u8bc6\u522b","text":"<p>\u6b65\u9aa4\u4e00\uff1a\u5355\u56e0\u5b50\u56de\u5f52\u786e\u5b9a\u6bcf\u4e2a\u56e0\u5b50\u6bcf\u671f\u7684\u56e0\u5b50\u6536\u76ca</p> <p>\u5e02\u573a\u98ce\u9669\u3001\u884c\u4e1a\u98ce\u9669\u3001\u98ce\u683c\u98ce\u9669\u662f\u5f71\u54cd\u80a1\u7968\u6536\u76ca\u6700\u4e3b\u8981\u7684\u4e09\u79cd\u56e0\u7d20\uff0c\u5728\u9a8c\u8bc1\u98ce\u683c\u56e0\u5b50\u6709\u6548\u6027\u65f6\uff0c \u5fc5\u987b\u8003\u8651\u5e02\u573a\u56e0\u5b50\u548c\u884c\u4e1a\u56e0\u5b50\u7684\u5f71\u54cd\u3002\u5bf9\u4e8e\u5e02\u573a\u56e0\u5b50\u548c\u884c\u4e1a\u56e0\u5b50\u7684\u5904\u7406\u65b9\u5f0f\u6709\u4e24\u79cd\uff1a</p> <ol> <li>\u5e02\u573a\u56e0\u5b50\u548c\u884c\u4e1a\u56e0\u5b50\u540c\u65f6\u7eb3\u5165\u6a21\u578b\uff1b</li> <li>\u4ec5\u7eb3\u5165\u884c\u4e1a\u56e0\u5b50\uff0c\u800c\u5c06\u5e02\u573a\u56e0\u5b50\u5305\u542b\u5728\u884c\u4e1a\u56e0\u5b50\u4e2d\u3002  </li> </ol> <p>\u91c7\u7528\u7b2c\u4e8c\u79cd\u7684\u5355\u56e0\u5b50\u56de\u5f52\u6a21\u578b\u5982\u4e0b $$ \\tilde{r_j^t}=\\sum_{s=1}^S{X_{js}^t}\\tilde{f_s^t}+X_{jk}^t\\tilde{f_k^t}+\\tilde{u_j^t} \\ \\tilde{r_j^t}: \u80a1\u7968j\u5728\u7b2ct\u671f\u7684\u6536\u76ca\u7387 \\ X_{js}^t: \u80a1\u7968j\u5728\u7b2ct\u671f\u5728\u884c\u4e1as\u4e0a\u7684\u66b4\u9732 \\ \\tilde{f_s^t}: \u884c\u4e1as\u5728\u7b2ct\u671f\u7684\u6536\u76ca\u7387 \\ X_{jk}^t: \u80a1\u7968j\u5728\u7b2ct\u671f\u5728\u884c\u4e1ak\u4e0a\u7684\u66b4\u9732 \\ \\tilde{f_k^t}: \u56e0\u5b50k\u5728\u7b2ct\u671f\u7684\u6536\u76ca\u7387 \\ \\tilde{u_j}: \u80a1\u7968j\u7684\u6b8b\u5dee\u6536\u76ca\u7387 $$ \u56e0\u5b50\\(X_{js}^t\\)\u662f\u4e2a0-1\u54d1\u53d8\u91cf\uff0c\u5373\u5982\u679c\u80a1\u7968j\u5c5e\u4e8e\u884c\u4e1as\uff0c\u5219\u66b4\u9732\u5ea6\u4e3a1\uff0c\u5426\u5219\u4e3a0\u3002\u6709\u7684\u6a21\u578b\uff0c\u53ef\u4ee5\u5bf9\u516c\u53f8\u6240\u5c5e\u884c\u4e1a\u8fdb\u884c\u62c6\u5206\uff0c0.5\u5c5e\u4e8e\u884c\u4e1aa\uff0c0.5\u5c5e\u4e8e\u884c\u4e1ab\u3002</p> <p>\u884c\u4e1a\u5206\u7c7b\u6709\u4e24\u79cd\uff1a1\uff09GICS\u98ce\u683c\u7684\u884c\u4e1a\u5206\u7c7b\uff0c\u53ef\u4ee5\u53c2\u8003\u4e2d\u8bc1\u6307\u6570\u516c\u53f8\u53d1\u5e03\u7684\u4e2d\u8bc1\u884c\u4e1a\u6307\u6570\u7cfb\u5217\uff1b2\uff09\u672c\u571f\u884c\u4e1a\u5206\u7c7b\uff0c\u53ef\u4ee5\u53c2\u8003\u4e2d\u4fe1\u884c\u4e1a\u6307\u6570\u7cfb\u5217\u3002</p> <p>\u6b65\u9aa4\u4e8c\uff1a\u56e0\u5b50\u6536\u76ca\u7387\u5e8f\u5217t\u68c0\u9a8c(TODO)</p> <p>\\(\\tilde{f_k^t}\\)\u662f\u56e0\u5b50k\u5728\u7b2ct\u671f\u7684\u6536\u76ca\u7387\uff0c\u9700\u8981\u786e\u5b9a\u56e0\u5b50k\u5728\u7b2ct\u671f\u662f\u5426\u548c\u80a1\u7968\u6536\u76ca\u7387\u663e\u8457\u76f8\u5173\uff0c\u5373\\(\\tilde{f_k^t}\\)\u663e\u8457\u4e0d\u4e3a0\uff0c\u5bf9\\(\\tilde{f_k^t}\\)\u8fdb\u884ct\u68c0\u9a8c\uff1a $$ t = \\frac{\\tilde{x}-u}{\\sigma/\\sqrt{n-1}} \\ t: x\u7684t\u7edf\u8ba1\u91cf \\ \\tilde{x}: \u6837\u672c\u7684\u5747\u503c \\ u: \u603b\u4f53\u7684\u5747\u503c \\ \\sigma: \u6837\u672c\u6807\u51c6\u5dee \\ n: \u6837\u672c\u7684\u5bb9\u91cf \\ $$</p> <ul> <li>t\u503c\u7edd\u5bf9\u503c\u5e8f\u5217\u7684\u5747\u503c \uff1a\u6bcf\u4e00\u671f\u7684\u622a\u9762\u56de\u5f52\uff0c\u90fd\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u56e0\u5b50\u6536\u76ca\u7387\\(\\tilde{f_k^t}\\)\u7684t\u503c\uff1b</li> <li>t\u503c\u7edd\u5bf9\u503c\u5e8f\u5217\u5927\u4e8e2\u7684\u6bd4\u4f8b : \u907f\u514d\u5c11\u6570\u6570\u503c\u7279\u522b\u5927\u7684\u6837\u672c\u503c\u62c9\u9ad8\u5747\u503c\uff1b</li> <li>\u56e0\u5b50\u6536\u76ca\u7387\\(\\tilde{f_k}^t\\)\u5e8f\u5217\u7684t\u503c\u68c0\u9a8c \uff08TODO\uff1a\u533a\u522b\u662f\u5565\uff1f\uff09\uff1a\u89c2\u5bdf\u56e0\u5b50\u6536\u76ca\u7387\u5e8f\u5217\u7684\u65b9\u5411\u4e00\u81f4\u6027\u3002</li> </ul> <p>\u6709\u6548\u56e0\u5b50\uff1a</p> <ul> <li>\u6536\u76ca\u7c7b\u56e0\u5b50\uff1a\\(\\tilde{f_k}^t\\)\u7684t\u503c\u663e\u8457\u4e0d\u4e3a0\uff0c\u4e14\u65b9\u5411\u6027\u76f8\u5bf9\u660e\u786e\u3002</li> <li>\u98ce\u9669\u7c7b\u56e0\u5b50\uff1a\\(\\tilde{f_k}^t\\)\u7684t\u503c\u57280\u9644\u8fd1\uff0c\u6536\u76ca\u7387\u65b9\u5411\u76f8\u5bf9\u4e0d\u660e\u786e\u3002</li> </ul> <p>\u6b65\u9aa4\u4e09\uff1a \u8f85\u52a9\u9274\u522b\u4e4b\u56e0\u5b50 IC \u503c</p> <p>\u56e0\u5b50\ud835\udc58\u7684 IC \u503c\u4e00\u822c\u662f\u6307\u4e2a\u80a1\u7b2c\ud835\udc47\u671f\u5728\u56e0\u5b50\ud835\udc58\u4e0a\u7684\u66b4\u9732\u5ea6\u4e0e\ud835\udc47 + 1\u671f\u7684\u6536\u76ca\u7387\u7684\u76f8\u5173\u7cfb\u6570\uff0c\u8bc4\u4ef7\u8be5\u56e0\u5b50\u8fdb\u884c\u6536\u76ca\u7387\u9884\u6d4b\u7684\u7a33\u5b9a\u6027\u3002\u56e0\u5b50\u6536\u76ca\u7387\u672c\u8d28\u4e0a\u662f\u4e2a\u659c\u7387\uff0c\u4e0d\u80fd\u4ee3\u8868\u4efb\u4f55\u7a33\u5065\u6027\u7684\u4fe1\u606f\u3002</p> <p>\u56e0\u5b50t\u503c\u548cIC\u4e4b\u95f4\u5177\u6709\u67d0\u79cd\u6b63\u76f8\u5173\u5173\u7cfb\u3002</p> <p>\u6ce8\uff1a\u5728\u56e0\u5b50\u6807\u51c6\u5316\u5904\u7406\u4e4b\u540e\uff0c\u5728\u6bcf\u4e2a\u622a\u9762\u671f\u4e0a\u7528\u5176\u505a\u56e0\u53d8\u91cf\u5bf9\u5e02\u503c\u56e0\u5b50\u53ca\u884c\u4e1a\u56e0\u5b50\u7b49\u505a\u7ebf\u6027\u56de\u5f52\uff0c\u53d6\u6b8b\u5dee\u4f5c\u4e3a\u56e0\u5b50\u503c\u7684\u4e00\u4e2a\u66ff\u4ee3\uff0c\u8fd9\u79cd\u505a\u6cd5\u53ef\u4ee5\u6d88\u9664\u56e0\u5b50\u5728\u884c\u4e1a\u3001\u677f\u5757\u3001\u5e02\u503c\u7b49\u65b9\u9762\u7684\u504f\u79bb\u3002  </p> <p>\u6b65\u9aa4\u56db\uff1a \u8f85\u52a9\u9274\u522b\u4e4b\u56e0\u5b50\u6253\u5206\u6cd5\u56de\u6d4b</p> <p>\u4f9d\u7167\u56e0\u5b50\u503c\u5bf9\u80a1\u7968\u8fdb\u884c\u6253\u5206\uff0c\u6784\u5efa\u6295\u8d44\u7ec4\u5408\u56de\u6d4b\uff0c\u662f\u6700\u76f4\u89c2\u7684\u8861\u91cf\u6307\u6807\u4f18\u52a3\u7684\u624b\u6bb5\u3002  </p> <p>\u5728\u67d0\u4e2a\u622a\u9762\u671f\u4e0a\uff0c\u53ef\u4ee5\u6839\u636e\u4e00\u4e2a\u6216\u51e0\u4e2a\u56e0\u5b50\u503c\u5bf9\u4e2a\u80a1\u8fdb\u884c\u6253\u5206\uff0c\u5c06\u6240\u6709\u4e2a\u80a1\u4f9d\u7167\u5206\u6570\u8fdb\u884c\u6392\u5e8f\uff0c\u7136\u540e\u5206\u4e3a\ud835\udc41\u4e2a\u6295\u8d44\u7ec4\u5408\uff0c\u8fdb\u884c\u56de\u6d4b\u3002  </p>"},{"location":"financial/multi_factor_model/mfm.html#_9","title":"\u6536\u76ca\u6a21\u578b","text":""},{"location":"financial/multi_factor_model/mfm.html#_10","title":"\u5927\u7c7b\u56e0\u5b50\u5206\u6790","text":"<p>\u540c\u7c7b\u56e0\u5b50\u53ef\u80fd\u624d\u80fd\u5728\u8f83\u5f3a\u7684\u76f8\u5173\u6027\uff0c\u591a\u5143\u7ebf\u6027\u56de\u5f52\u65f6\u9020\u6210\u591a\u91cd\u5171\u7ebf\u6027\uff08\u6307\u56de\u5f52\u6a21\u578b\u4e2d\u7684\u89e3\u91ca\u53d8\u91cf\u4e4b\u95f4\u7531\u4e8e\u5b58\u5728\u7cbe\u786e\u76f8\u5173\u5173\u7cfb\u6216\u9ad8\u5ea6\u76f8\u5173\u6027\u800c\u4f7f\u6a21\u578b\u4f30\u8ba1\u5931\u771f\u4e0d\u51c6\uff09\u3002</p> <p>\u6b65\u9aa4\u4e00\uff1a\u540c\u7c7b\u578b\u56e0\u5b50\u7684\u76f8\u5173\u6027\u68c0\u9a8c</p> <p>\u540c\u7c7b\u578b\u7684\ud835\udc3e\u5019\u9009\u56e0\u5b50\uff0c\u5411\u524d\u9009\u53d6\ud835\udc40\u4e2a\u6708\u7684\u6570\u636e\u4f5c\u4e3a\u6837\u672c\uff1a</p> <ol> <li> <p>\u6309\u6708\u8ba1\u7b97\u51fa\u56e0\u5b50\u8f7d\u8377\u4e4b\u95f4\u7684\u76f8\u5173\u7cfb\u6570\u77e9\u9635\u548c\u6bcf\u4e2a\u56e0\u5b50\u6536\u76ca\u7387\uff1a    $$    \\rho^t=\\left[\\begin{matrix}1 &amp;\\rho_{12}^t &amp;\\cdots &amp;\\rho_{1K}^t \\    \\rho_{21}^t &amp;1 &amp;\\cdots &amp;\\cdots \\    \\vdots &amp;\\vdots &amp;\\ddots &amp;\\cdots \\    \\rho_{K1}^t &amp;\\cdots &amp;\\cdots &amp;1    \\end{matrix}\\right]    $$</p> </li> <li> <p>\u6839\u636eM\u4e2a\u6708\u7684\u76f8\u5173\u7cfb\u6570\u8fdb\u884c\u68c0\u9a8c\uff0c\u68c0\u9a8c\u65b9\u6cd5\u5305\u62ec\u76f8\u5173\u7cfb\u6570\u7edd\u5bf9\u503c\u7684\u5747\u503c\u3001\u4e2d\u4f4d\u6570\u3001t\u68c0\u9a8c\u7b49\u3002    $$    \\sum_{t=1}^M|\\rho_{ij}^t| / M \\    median(|\\rho_{ij}^t|) t = 1, 2, ...M \\    t = \\frac{\\overline{|\\rho_{ij}^t|} - u}{\\sigma / \\sqrt{M-1}}    $$</p> </li> </ol> <p>\u6b65\u9aa4\u4e8c\uff1a\u56e0\u5b50\u53d6\u820d\u6216\u56e0\u5b50\u5408\u6210</p> <p>\u5bf9\u4e8e\u76f8\u5173\u6027\u8f83\u9ad8\u7684\u56e0\u5b50\u96c6\u5408\uff0c\u9700\u8981\u8fdb\u884c\u5904\u7406\u3002</p> <ul> <li>\u56e0\u5b50\u53d6\u820d\uff1a\u6839\u636e\u56e0\u5b50\u6709\u6548\u6027\u8fdb\u884c\u6392\u5e8f\uff0c\u8c03\u4f18\u6709\u6548\u7684\u56e0\u5b50\u8fdb\u884c\u4fdd\u7559\uff1b</li> <li>\u56e0\u5b50\u5408\u6210\uff1a\u5c3d\u53ef\u80fd\u4fdd\u7559\u56e0\u5b50\u6709\u6548\u4fe1\u606f:</li> <li>\u7b49\u6743\u6cd5\uff1a\u56e0\u5b50\u7b49\u6743\u91cd\u5730\u8fdb\u884c\u5408\u6210\u65b0\u7684\u56e0\u5b50\uff0c\u518d\u91cd\u65b0\u8fdb\u884c\u6807\u51c6\u5316\uff1b</li> <li>\u5386\u53f2\u6536\u76ca\u7387\u52a0\u6743\u6cd5\uff1a\u56e0\u5b50\u6309\u7167\u5404\u81ea\u5386\u53f2\u6536\u76ca\u7387\u4f5c\u4e3a\u6743\u91cd\uff0c\u8fdb\u884c\u5408\u6210\uff0c\u5728\u91cd\u65b0\u6807\u51c6\u5316\uff1b<ul> <li>\u83b7\u5f97\u6700\u5927\u89e3\u91ca\u529b\u7684\u5927\u7c7b\u56e0\u5b50\uff0c\u4f46\u5171\u7ebf\u6027\u95ee\u9898\u5bfc\u81f4\u56de\u5f52\u7b97\u51fa\u56e0\u5b50\u6536\u76ca\u7387\u4e0d\u7a33\u5b9a\u3002</li> </ul> </li> <li>\u5386\u53f2\u4fe1\u606f\u6bd4\u4f8b\u52a0\u6743\u6cd5\uff1a\u56e0\u5b50\u6309\u7167\u5386\u53f2IC\u503c\u5bf9\u56e0\u5b50\u8f7d\u8377\u8fdb\u884c\u5408\u6210\u3002<ul> <li>\u8003\u8651\u5386\u53f2\u7387\u548c\u6ce2\u52a8\u7387\uff0c\u66f4\u52a0\u7a33\u5065\u3002</li> </ul> </li> <li>\u4e3b\u6210\u5206\u5206\u6790\uff1a\u5bf9\u56e0\u5b50\u96c6\u5408\u8fdb\u884c\u4e3b\u6210\u5206\u5206\u6790\uff0c\u96c6\u5408\u6536\u76ca\u7387\u6392\u5e8f\u9009\u62e9\u4e00\u4e2a\u6216\u51e0\u4e2a\u4e3b\u6210\u5206\u7684\u7ec4\u5408\u7cfb\u6570\u4f5c\u4e3a\u6743\u91cd\u5408\u6210\u5927\u7c7b\u56e0\u5b50\u3002<ul> <li>\u504f\u6280\u672f\u5206\u6790\uff0c\u6307\u6807\u53ef\u80fd\u65e0\u7279\u6b8a\u7684\u7ecf\u6d4e\u5b66\u542b\u4e49\u3002\u9002\u5ea6\u91c7\u7528\u3002</li> </ul> </li> </ul>"},{"location":"financial/multi_factor_model/mfm.html#_11","title":"\u56e0\u5b50\u5171\u7ebf\u6027\u5206\u6790","text":"<p>\u9488\u5bf9\u4e0d\u540c\u7c7b\u578b\u7684\u56e0\u5b50\u7684\u5171\u7ebf\u6027\u5206\u6790\u3002</p> <p>\u7ecf\u6d4e\u542b\u4e49\u4e0d\u540c\u7684\u56e0\u5b50\uff0c\u5b58\u5728\u660e\u663e\u76f8\u5173\u6027\uff0c\u53ea\u80fd\u6709\u6240\u53d6\u820d\uff0c\u4fdd\u7559\u66f4\u52a0\u663e\u8457\u7684\u56e0\u5b50\uff0c\u800c\u820d\u5f03\u4e0d\u663e\u8457\u7684\u56e0\u5b50\u3002</p>"},{"location":"financial/multi_factor_model/mfm.html#_12","title":"\u6b8b\u5dee\u5f02\u65b9\u5dee\u5206\u6790","text":"<p>\u540c\u65b9\u5dee\uff1a\u4e3a\u4e86\u4fdd\u8bc1\u56de\u5f52\u53c2\u6570\u4f30\u8ba1\u91cf\u5177\u6709\u826f\u597d\u7684\u7edf\u8ba1\u6027\u8d28\uff0c\u7ecf\u5178\u7ebf\u6027\u56de\u5f52\u6a21\u578b\u7684\u4e00\u4e2a\u91cd\u8981\u5047\u5b9a\uff1a\u603b\u4f53\u56de\u5f52\u51fd\u6570\u4e2d\u7684\u968f\u673a\u8bef\u5dee\u9879\u6ee1\u8db3\u540c\u65b9\u5dee\u6027\uff0c\u5373\u5b83\u4eec\u90fd\u6709\u76f8\u540c\u7684\u65b9\u5dee\u3002  </p> <p>\u5982\u679c\u4e0d\u6ee1\u8db3\u5047\u5b9a\uff0c\u5373\u968f\u673a\u8bef\u5dee\u9879\u5177\u6709\u4e0d\u540c\u7684\u8bef\u5dee\uff0c\u5219\u79f0\u7ebf\u6027\u56de\u5f52\u5b58\u5728\u5f02\u65b9\u5dee\u6027\u3002</p> <p>\u56de\u5f52\u6a21\u578b\uff1a $$ \\tilde{r_j}=\\sum_{k=1}^K{X_{jk}*\\tilde{f_k}}+\\tilde{u_j} $$ \u5982\u679c\u6b8b\u5dee\u9879\u7684\u6761\u4ef6\u65b9\u5dee\u76f8\u540c\uff0c\u5373 \\(Var(\\tilde{u_\ud835\udc57}|\ud835\udc4b_{\ud835\udc571}, \ud835\udc4b_{\ud835\udc572}, \u2026 \ud835\udc4b_{\ud835\udc57\ud835\udc3e}) = \\sigma^2\\)\uff0c\u5219\u79f0\u4e3a\u540c\u65b9\u5dee\u6027\uff1b</p> <p>\u5982\u679c\u6b8b\u5dee\u9879\u7684\u6761\u4ef6\u65b9\u5dee\u4e0d\u76f8\u540c\uff0c\u5373\\(Var(\\tilde{u_\ud835\udc57}|\ud835\udc4b_{\ud835\udc571}, \ud835\udc4b_{\ud835\udc572}, \u2026 \ud835\udc4b_{\ud835\udc57\ud835\udc3e}) = \\sigma_j^2\\)\uff0c\u5219\u79f0\u4e3a\u5f02\u65b9\u5dee\u6027\u3002 </p> <p>\u5f02\u65b9\u5dee\u6027\u5bf9\u666e\u901a\u6700\u5c0f\u4e8c\u4e58\u6cd5\uff08Ordinary Least Square\uff0c OLS\uff09\u4f30\u8ba1\u7684\u5f71\u54cd\uff0c\u4e3b\u8981\u6709\u4e09\u70b9\uff1a</p> <ol> <li> <p>\u56de\u5f52\u7cfb\u6570\u7684 OLS \u4f30\u8ba1\u91cf\u4ecd\u7136\u662f\u65e0\u504f\u7684\u3001\u4e00\u81f4\u7684\u3001\u5e76\u4e14\u4e0d\u5f71\u54cd\\(\ud835\udc45^2\\)\u548c\u8c03\u6574\u7684\\(\ud835\udc45^2\\)\u3002</p> </li> <li> <p>\u56de\u5f52\u6807\u51c6\u5dee\u7684\u4f30\u8ba1\u4e0d\u518d\u662f\u65e0\u504f\u7684\uff0c\u4ece\u800c\u56de\u5f52\u7cfb\u6570 OLS \u4f30\u8ba1\u91cf\u7684\u65b9\u5dee\u4e0d\u518d\u662f\u65e0\u504f\u7684\uff0cOLS \u4f30\u8ba1\u91cf\u4e0d\u518d\u662f\u6709\u6548\u7684\u548c\u6e10\u8fd1\u6709\u6548\u7684\u3002</p> </li> <li> <p>\ud835\udc61\u7edf\u8ba1\u91cf\u4e0d\u670d\u4ece\ud835\udc61\u5206\u5e03\uff0c \ud835\udc39\u7edf\u8ba1\u91cf\u4e5f\u4e0d\u670d\u4ece\ud835\udc39\u5206\u5e03\uff0c\u4ece\u800c\u65e0\u8fdb\u884c\u5047\u8bbe\u68c0\u9a8c\u548c\u533a\u95f4\u4f30\u8ba1\uff0c\u4e5f\u65e0\u6cd5\u8fdb\u884c\u533a\u95f4\u9884\u6d4b\u3002</p> </li> </ol> <p>\u5bf9\u4e8e\u6a21\u578b\u662f\u5426\u5b58\u5728\u5f02\u65b9\u5dee\u7684\u68c0\u9a8c\uff0c\u53ef\u4ee5\u91c7\u7528 Breusch-Pagan test \u6216\u8005 White test \u4e24\u79cd\u65b9\u6cd5\u3002</p> <p>Breusch-Pagan test $$ Y = \\beta_0 + \\beta_1X_1 + ... + \\beta_KX_K + u \\ Var(u|X_1, ..., X_K)=E(u^2|X_1, ..., X_K)=\\alpha_0 + \\alpha_1 * X_1 +...+\\alpha_KX_K + v $$ \u9996\u5148\u6839\u636e\u6a21\u578b1\u4f30\u8ba1\u51fa\\(\\tilde{u^2}\\)\uff0c\u7136\u540e\u4ee5\\(\\tilde{u^2}\\)\u4e3a\u56e0\u53d8\u91cf\uff0c\u5f97\u5230\\(R_u^2\\) $$ \\tilde{u^2}=\\alpha_0 + \\alpha_1 * X_1 +...+\\alpha_KX_K + v $$ \u8ba1\u7b97\u6a21\u578b\u7684F\u7edf\u8ba1\u91cf\uff0c\u6216\u8005\u6784\u9020\u7edf\u8ba1\u91cf\\(LM=nR_u^2\\sim\\chi^2(K)\\)</p> <p>\u5bf9\u4e8e\\(\ud835\udc3b_0: \ud835\udefc_1 = 0, \ud835\udefc_2 = 0 \u2026 , \ud835\udefc_\ud835\udc3e = 0\\)\uff0c\u5982\u679c\ud835\udc39\u7edf\u8ba1\u91cf\u6216\u8005\ud835\udc3f\ud835\udc40\u7edf\u8ba1\u91cf\u662f\u663e\u8457\u7684\uff0c\u5219\u62d2\u7edd\u539f\u5047\u8bbe\uff0c \u8bf4\u660e\u6a21\u578b\u5b58\u5728\u5f02\u65b9\u5dee\u3002</p> <p>White Test (TODO)</p> <p>\u5bf9\u4e8e\u5b58\u5728\u5f02\u65b9\u5dee\u7684\u6a21\u578b\uff0c\u91c7\u7528\u52a0\u6743\u6700\u5c0f\u4e8c\u4e58\u6cd5\uff08WLS\uff09\u3002</p> <ul> <li>\u5df2\u77e5\u65b9\u5dee\uff1a\uff08TODO\uff09</li> <li>\u672a\u77e5\u65b9\u5dee\uff1a\u4f30\u8ba1\u5f02\u65b9\u5dee\u7684\u51fd\u6570\u5f62\u5f0f\uff0c\u5c5e\u4e8e\u53ef\u884c\u7684\u5e7f\u4e49\u6700\u5c0f\u4e8c\u4e58\u6cd5\u3002</li> </ul>"},{"location":"financial/multi_factor_model/mfm.html#_13","title":"\u591a\u5143\u7ebf\u6027\u56de\u5f52","text":"<p>\u56e0\u5b50\u96c6\u7684\u8f6c\u6362\u6b65\u9aa4\uff1a 1. \u56e0\u5b50\u96c6\ud835\udc391\uff1a\u6700\u539f\u59cb\u7684\u56e0\u5b50\u96c6\uff1b 2. \u56e0\u5b50\u96c6\ud835\udc392\uff1a\u5bf9\ud835\udc391\u6709\u6548\u56e0\u5b50\u7b5b\u9009\u540e\u7684\u56e0\u5b50\u96c6\uff1b 3. \u56e0\u5b50\u96c6\ud835\udc393\uff1a\u5bf9\ud835\udc392\u5927\u7c7b\u56e0\u5b50\u5206\u6790\uff0c\u7ecf\u8fc7\u56e0\u5b50\u53d6\u820d\u6216\u8005\u56e0\u5b50\u5408\u6210\u4e4b\u540e\u7684\u56e0\u5b50\u96c6\uff1b 4. \u56e0\u5b50\u96c6\ud835\udc394\uff1a\u5bf9\ud835\udc393\u8fdb\u884c\u591a\u91cd\u5171\u7ebf\u6027\u5206\u6790\uff0c\u53d6\u820d\u4e4b\u540e\u7684\u6700\u7ec8\u56e0\u5b50\u96c6\u3002</p> <p>\u5728\u5bf9\u56e0\u5b50\u96c6\ud835\udc394\u505a\u6b8b\u5dee\u7684\u5f02\u65b9\u5dee\u5206\u6790\u5904\u7406\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u6b63\u5f0f\u8fdb\u884c\u591a\u5143\u7ebf\u6027\u56de\u5f52\uff0c\u4f30\u8ba1\u6bcf\u671f\u7684\u56e0 \u5b50\u6536\u76ca\u5e8f\u5217\u3002</p> <p>$$ \\tilde{r_j^t}=\\sum_{s=1}^S{X_{js}^t}\\tilde{f_s^t}+X_{jk}^t\\tilde{f_k^t}+\\tilde{u_j^t} \\ \\tilde{r_j^t}: \u80a1\u7968j\u5728\u7b2ct\u671f\u7684\u6536\u76ca\u7387 \\ X_{js}^t: \u80a1\u7968j\u5728\u7b2ct\u671f\u5728\u884c\u4e1as\u4e0a\u7684\u66b4\u9732 \\ \\tilde{f_s^t}: \u884c\u4e1as\u5728\u7b2ct\u671f\u7684\u6536\u76ca\u7387 \\ X_{jk}^t: \u80a1\u7968j\u5728\u7b2ct\u671f\u5728\u884c\u4e1ak\u4e0a\u7684\u66b4\u9732 \\ \\tilde{f_k^t}: \u56e0\u5b50k\u5728\u7b2ct\u671f\u7684\u6536\u76ca\u7387 \\ \\tilde{u_j}: \u80a1\u7968j\u7684\u6b8b\u5dee\u6536\u76ca\u7387 $$ \u7ecf\u5178\u56de\u5f52\u6a21\u578b\u7684\u57fa\u672c\u5047\u8bbe\uff1a</p> <ol> <li> <p>\u53c2\u6570\u7684\u7ebf\u6027\u6027\uff1a \u56de\u5f52\u6a21\u578b\u5bf9\u4e8e\u53c2\u6570\u800c\u8a00\u662f\u7ebf\u6027\u7684\uff1b</p> </li> <li> <p>\u6837\u672c\u7684\u968f\u673a\u6027\uff1a \u6837\u672c\u662f\u4ece\u603b\u4f53\u4e2d\u968f\u673a\u62bd\u6837\u5f97\u5230\u7684\uff1b</p> </li> <li> <p>\u4e0d\u5b58\u5728\u5b8c\u5168\u5171\u7ebf\u6027\uff1a\u6bcf\u4e2a\u89e3\u91ca\u53d8\u91cf\u5177\u6709\u4e00\u5b9a\u53d8\u5f02\u5e76\u4e14\u81ea\u53d8\u91cf\u4e4b\u95f4\u4e0d\u5b58\u5728\u5b8c\u5168\u7684\u7ebf\u6027\u76f8\u5173\u5173\u7cfb\uff1b</p> </li> <li> <p>\u96f6\u6761\u4ef6\u5747\u503c\uff1a \\(E(u_j|X_{1j}, X_{2j}, ... , X_{Kj}) = 0\\)\uff1b</p> </li> <li> <p>\u540c\u65b9\u5dee\u6027\uff1a \\(Var(u_j|X_{1j}, X_{2j}, ... , X_{Kj}) = \\sigma^2\\)\uff1b</p> </li> <li> <p>\u6b63\u6001\u6027\uff1a \\(u_j\\)\u72ec\u7acb\u4e8e\u6240\u6709\u53d8\u91cf\uff0c\u5e76\u4e14\\(u_j \\sim N(0, \\rho^2)\\)\u3002</p> </li> </ol> <p>\u6240\u4ee5\u524d\u9762\u7684\u5927\u7c7b\u56e0\u5b50\u5206\u6790\uff0c\u56e0\u5b50\u5171\u7ebf\u6027\u5206\u6790\uff0c\u6b8b\u5dee\u5f02\u65b9\u5dee\u5206\u6790\uff0c\u672c\u8d28\u90fd\u662f\u8ba9\u56e0\u5b50\u80fd\u591f\u6ee1\u8db3\u7ecf\u5178\u56de\u5f52\u6a21\u578b\u7684\u57fa\u672c\u5047\u8bbe\u3002</p> <p>\u4f30\u8ba1\u56e0\u5b50\u9884\u671f\u6536\u76ca</p> <p>\u591a\u5143\u7ebf\u6027\u56de\u5f52\uff0c\u53ef\u4ee5\u5f97\u5230\u6240\u6709\u56e0\u5b50\u7684\u5386\u53f2\u6536\u76ca\u7387\u5e8f\u5217\uff08\\(\\tilde{f_K^T}\uff0ck=1,2,\\cdots, K;t=1,2,\\cdots,T\\)\uff09 $$ F=\\left[\\begin{matrix} \\tilde{f_1^1} &amp;\\tilde{f_2^1} &amp;\\cdots &amp;\\tilde{f_K^1} \\ \\tilde{f_2^1} &amp;\\tilde{f_2^2} &amp;\\cdots &amp;\\tilde{f_K^2} \\ \\vdots &amp;\\vdots &amp;\\ddots &amp;\\vdots \\ \\tilde{f_1^T} &amp;\\cdots &amp;\\cdots &amp;\\tilde{f_K^T} \\end{matrix}\\right] $$ \u5bf9 T+1 \u671f\u56e0\u5b50\u7684\u9884\u671f\u6536\u76ca\u7387\u7684\u4f30\u8ba1\uff0c\u53ef\u4ee5\u91c7\u7528\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\uff1a</p> <ol> <li> <p>\u5386\u53f2\u5747\u503c\u6cd5\uff1a\u7528\u524dN\u671f\u56e0\u5b50\u5386\u53f2\u6536\u76ca\u7387\u7684\u5747\u503c\u4f5c\u4e3aT+1\u671f\u56e0\u5b50\u7684\u9884\u671f\u6536\u76ca\u7387    $$    \\tilde{f_k^{T+1}}=\\frac{\\sum_{t=T-n+1}^T{\\tilde{f_k^t}}}{N}    $$    \u4e00\u822c\u60c5\u51b5\u4e0b\uff0cN\u7684\u53d6\u503c\u4e3a36\u621660\uff0c\u5373\u524d36\u4e2a\u6708\u621660\u4e2a\u6708\u7684\u5747\u503c\u3002</p> </li> <li> <p>\u6307\u6570\u52a0\u6743\u79fb\u52a8\u5e73\u5747\u6cd5(EWMA)\uff1a\u8d8a\u8fd1\u7684\u89c2\u6d4b\u503c\u6743\u91cd\u8d8a\u5927\uff0c\u8d8a\u8fdc\u7684\u89c2\u6d4b\u503c\u6743\u91cd\u8d8a\u8f7b\u3002    $$    EWMA(t)=\\lambda\\tilde{f_k^t}+(1-\\lambda)EWMA(t-1), t=1,2,\\cdots,n \\    \\tilde{f_k^{T+1}}=EWMA(t) \\    EWMA(t) : t\u65f6\u523b\u7684\u4fee\u6b63\u4f30\u8ba1\u91cf \\    \\tilde{f_k^t} : t\u65f6\u523b\u7684\u56e0\u5b50\u6536\u76ca\u7387\u89c2\u5bdf\u503c \\    \\lambda : \u6743\u91cd\u56e0\u5b50    $$</p> </li> <li> <p>\u65f6\u95f4\u5e8f\u5217\u9884\u6d4b\u6cd5\uff08TODO\uff09</p> </li> </ol> <p>3.1 \\(AR(q)\\)\uff0c\u81ea\u56de\u5f52\u6a21\u578b</p> <p>3.2 \\(MA(p)\\)\uff0c\u79fb\u52a8\u5e73\u5747\u6a21\u578b</p> <p>3.3 \\(ARMA(q,p)\\)\uff0c\u81ea\u56de\u5f52\u79fb\u52a8\u5e73\u5747\u6a21\u578b\uff0c\u662fAR\u548cMA\u7684\u7ec4\u5408\u3002</p> <p>ARIMA\u662fARMA\u6a21\u578b\u5728\u65f6\u95f4\u5e8f\u5217\u4e00\u9636\u5dee\u5206\u4e0a\u7684\u5e94\u7528\u3002</p> <ol> <li> <p>\u6ee4\u6ce2\u6cd5\u63d0\u53d6\u8d8b\u52bf\u9879\uff1aHP\u6ee4\u6ce2\u6cd5\u63d0\u53d6\u56e0\u5b50\u5386\u53f2\u7d2f\u8ba1\u6536\u76ca\u7387\u7684\u8d8b\u52bf\u9879\uff0c\u4ee5\u6ee4\u6ce2\u66f2\u7ebf\u7684\u7ec8\u503c\u9664\u4ee5\u6837\u672c\u671f\u7684\u957f\u5ea6\u4f5c\u4e3a\u56e0\u5b50\u7684\u9884\u671f\u6536\u76ca\u7387\u3002</p> </li> <li> <p>\u4eba\u5de5\u53c2\u6570\u5c11\uff0c\u83b7\u53d6\u56e0\u5b50\u6536\u76ca\u7387\u957f\u671f\u53d8\u5316\u89c4\u5f8b\u7684\u540c\u65f6\u80fd\u5c3d\u91cf\u6d88\u9664\u566a\u58f0\u7684\u5f71\u54cd\u3002</p> </li> </ol> <p>\u5176\u5b83\u9884\u6d4b\u6a21\u578b\uff0c\u8fd8\u6709\u5982ARCH\u3001GARCH\u3001\u6ee4\u6ce2\u3001\u795e\u7ecf\u7f51\u7edc\u3001\u9057\u4f20\u7b97\u6cd5\u7b49\u3002</p> <p>\u6ce8\uff1a\u5728\u5bf9T+1\u671f\u56e0\u5b50\u9884\u671f\u6536\u76ca\u505a\u4f30\u8ba1\u65f6\uff0c\u9700\u8981\u8003\u8651\u56e0\u5b50\u6536\u76ca\u7387\u65b9\u5411\u7684\u7ea6\u675f\u6761\u4ef6\u3002\u5982\u679c\u76f8\u53cd\uff0c\u5219\u9700\u8981\u7f6e0\u5904\u7406\u3002</p> <p>\u8ba1\u7b97\u80a1\u7968\u9884\u671f\u6536\u76ca</p> <p>\u4f30\u7b97\u51fa\ud835\udc47+1\u671f\u7684\u56e0\u5b50\u6536\u76ca\u7387\u5411\u91cf(\\(\\tilde{f_1^{T+1}}, \\tilde{f_2^{T+1}}, ... , \\tilde{f_k^{T+1}}\\))\u540e\uff0c\u4ee5\u53ca\u8ba1\u7b97\u51fa\ud835\udc47 + 1\u671f\u7684\u56e0\u5b50\u8f7d\u8377\u77e9 \u9635\uff1a $$ X^{T+1}=\\left[\\begin{matrix} X_{11}^{T+1} &amp;X_{12}^{T+1} &amp;\\cdots &amp;X_{1K}^{T+1} \\ X_{21}^{T+1} &amp;X_{22}^{T+1} &amp;\\cdots &amp;X_{2K}^{T+1}\\ \\vdots &amp;\\vdots &amp;\\ddots &amp;\\vdots\\ X_{N1}^{T+1} &amp;\\cdots &amp;\\cdots &amp;X_{NK}^{T+1} \\end{matrix}\\right] $$</p> <p>\u6839\u636e\u6a21\u578b $$ \\tilde{r_j^{T+1}}=\\sum_{k=1}^{K}{X_{jk}^{T+1}*\\tilde{f_k^{T+1}}} $$ \u53ef\u4ee5\u8ba1\u7b97\u51faT+1\u671f\u6bcf\u53ea\u80a1\u7968\u7684\u9884\u671f\u6536\u76ca\u7387\u5411\u91cf(\\(\\tilde{r_1^{T+1}}\uff0c\\cdots, \\tilde{r_N^{T+1}}\\))\u3002</p>"},{"location":"financial/multi_factor_model/mfm.html#_14","title":"\u98ce\u9669\u6a21\u578b","text":"<p>\u591a\u56e0\u5b50\u6a21\u578b\u7684\u98ce\u9669\u5206\u89e3</p> <p>\u591a\u56e0\u5b50\u98ce\u9669\u6a21\u578b\u7684\u4e3b\u8981\u89c2\u70b9\u662f\uff0c\u80a1\u7968\u7684\u6536\u76ca\u7387\u53ef\u4ee5\u88ab\u4e00\u7ec4\u5171\u540c\u56e0\u5b50\u548c\u4e00\u4e2a\u4ec5\u4e0e\u8be5\u80a1\u7968\u6709\u5173\u7684\u7279\u5f02\u56e0\u5b50\u89e3\u91ca\uff0c\u5373\u4efb\u4f55\u80a1\u7968\u7684\u6536\u76ca\u7387\u6765\u81ea\u4e24\u4e2a\u65b9\u9762\uff1a\u5171\u540c\uff08\u56e0\u5b50\uff09\u90e8\u5206\uff0c\u7279\u5f02\u90e8\u5206\u3002  </p> <p>\u7ec4\u5408\u6536\u76ca\u7387\uff1a</p> <ul> <li>\u4e1a\u7ee9\u57fa\u51c6\u6536\u76ca\u7387</li> <li>\u4e3b\u52a8\u6536\u76ca\u7387\uff08\u4e3b\u52a8\u8d85\u989d\u6536\u76ca\u7387)</li> <li>\u7279\u5b9a\u4e3b\u52a8\u6536\u76ca\u7387(\u7279\u5f02\u90e8\u5206)</li> <li>\u56e0\u5b50\u4e3b\u52a8\u6536\u76ca\u7387\uff08\u5171\u540c\u90e8\u5206)<ul> <li>\u5e02\u573a\u56e0\u5b50\u6536\u76ca\u7387</li> <li>\u884c\u4e1a\u56e0\u5b50\u6536\u76ca\u7387</li> <li>\u98ce\u683c\u56e0\u5b50\u6536\u76ca\u7387</li> </ul> </li> </ul> <p>\u5728\u591a\u56e0\u5b50\u6a21\u578b\u4e2d\uff0c\u80a1\u7968\u5bf9\u4e8e\u5e02\u573a\u56e0\u5b50\u7684\u56e0\u5b50\u66b4\u9732\u7edf\u4e00\u4e3a1\uff0c\u5bf9\u4e8e\u884c\u4e1a\u56e0\u5b50\u7684\u56e0\u5b50\u66b4\u9732\u65f6\u4e00\u4e2a0-1\u54d1\u53d8\u91cf\uff08\u5982\u679c\u80a1\u7968\u5c5e\u4e8e\u67d0\u4e00\u884c\u4e1a\u4e3a1\uff0c\u5426\u5219\u4e3a0\uff09\u3002\u591a\u56e0\u5b50\u6a21\u578b\u672c\u8d28\u4e0a\u662f\u4e2a\u7edf\u8ba1\u5957\u5229\u6a21\u578b\uff0c\u4e0d\u9002\u5408\u5bf9\u5e02\u573a\u56e0\u5b50\u548c\u884c\u4e1a\u56e0\u5b50\u8fdb\u884c\u6536\u76ca\u9884\u6d4b\u548c\u98ce\u9669\u7ba1\u7406\u3002\u5176\u5173\u6ce8\u7684\u91cd\u70b9\u662f\u98ce\u683c\u56e0\u5b50\u7684\u6536\u76ca\u9884\u6d4b\u548c\u98ce\u9669\u7ba1\u7406\u3002</p> <p>\u56fd\u5185\u5e02\u573a\u591a\u56e0\u5b50\u6a21\u578b\u6700\u6d41\u884c\u7684\u7528\u6cd5\u662f\uff1a</p> <ul> <li>\u901a\u8fc7\u80a1\u6307\u671f\u8d27\u5bf9\u51b2\u7ec4\u5408\u7684\u5e02\u573a\u98ce\u9669\uff08\u5e02\u503c\u5bf9\u51b2\uff09\uff1b</li> <li>\u901a\u8fc7\u884c\u4e1a\u4e2d\u6027\u5bf9\u51b2\u7ec4\u5408\u7684\u884c\u4e1a\u98ce\u9669\uff08\u4ee5\u4e1a\u7ee9\u57fa\u51c6\u7684\u884c\u4e1a\u6743\u91cd\u4e3a\u57fa\u51c6\u8fdb\u884c\u5bf9\u9f50\uff0c\u5373\u7ec4\u5408\u5728\u6bcf\u4e2a\u884c\u4e1a\u4e0a\u7684\u6743\u91cd\u5206\u914d\u4e0e\u4e1a\u7ee9\u57fa\u51c6\u4e00\u81f4\uff09\u3002</li> </ul>"},{"location":"financial/multi_factor_model/mfm.html#_15","title":"\u56e0\u5b50\u534f\u65b9\u5dee\u77e9\u9635","text":""},{"location":"financial/multi_factor_model/mfm.html#_16","title":"\u6b8b\u5dee\u98ce\u9669\u4f30\u8ba1","text":""},{"location":"financial/multi_factor_model/mfm.html#_17","title":"\u4f18\u5316\u6a21\u578b","text":""},{"location":"financial/multi_factor_model/mfm.html#_18","title":"\u4e8c\u6b21\u89c4\u5212","text":""},{"location":"financial/multi_factor_model/mfm.html#_19","title":"\u6536\u76ca\u76ee\u6807\u548c\u98ce\u9669\u76ee\u6807","text":""},{"location":"financial/multi_factor_model/mfm.html#_20","title":"\u4e2a\u80a1\u4e0a\u4e0b\u9650\u7ea6\u675f","text":""},{"location":"financial/multi_factor_model/mfm.html#_21","title":"\u884c\u4e1a\u6743\u91cd\u7ea6\u675f","text":""},{"location":"financial/multi_factor_model/mfm.html#_22","title":"\u56e0\u5b50\u66b4\u9732\u7ea6\u675f","text":""},{"location":"financial/multi_factor_model/mfm.html#_23","title":"\u591a\u56e0\u5b50\u6a21\u578b\u7684\u7ee9\u6548\u5206\u6790","text":""},{"location":"financial/multi_factor_model/mfm.html#_24","title":"\u5e38\u7528\u7684\u4e1a\u7ee9\u5206\u6790\u6307\u6807","text":""},{"location":"financial/multi_factor_model/mfm.html#_25","title":"\u6536\u76ca\u7387\u56de\u5f52","text":""},{"location":"financial/multi_factor_model/mfm.html#_26","title":"\u57fa\u4e8e\u591a\u56e0\u5b50\u7684\u4e1a\u7ee9\u56de\u5f52","text":""},{"location":"financial/multi_factor_model/mfm.html#_27","title":"\u4e1a\u7ee9\u5f52\u56e0\u65b9\u5f0f","text":""},{"location":"hadoop/IPC.html","title":"IPC","text":"<p>[toc]</p>"},{"location":"hadoop/IPC.html#ipc","title":"IPC","text":"<p>IPC\uff1a\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0cInter-Process Communication\u3002</p> <p>RPC\uff1a\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\uff0cRemote Procedure Call\uff0c\u5b9e\u73b0 IPC\u3002</p>"},{"location":"hadoop/IPC.html#engine","title":"Engine","text":"<p>Client \u7aef Socket\uff0c\u963b\u585e\u6027\uff1b</p> <p>Server \u7aef Connection \u4f7f\u7528 NIO\uff1b</p> <p>Hadoop\u6709\u4e24\u4e2a<code>RPCEngine</code>\u5b9e\u73b0\uff1a</p> <ul> <li><code>WritableRpcEngine</code>\uff1a\u5c06\u8bf7\u6c42\u5e8f\u5217\u5316\u53d1\u9001\u5230Server\u7aef\uff0c\u901a\u8fc7\u53cd\u5c04\u67e5\u627e\u5339\u914d\u7684\u65b9\u6cd5\uff0c\u6267\u884c\u5e76\u8fd4\u56de\u7ed3\u679c\uff1b</li> <li><code>ProtobufRpcEngine</code>\uff1a\u57fa\u4e8e protobuf 2\u7248\u672c\uff1b</li> </ul> <p>\u5982\u4f55\u51b3\u5b9a\u662fWritableEngine\u8fd8\u662fProtobufEngine</p> <ul> <li>\u901a\u8fc7<code>RPC.setProtocolEngine()</code>\u6ce8\u518c\u67d0\u4e2a\u63a5\u53e3\u7684Engine\u7c7b\u578b\uff0c\u5982\u679c\u6ca1\u6709\u6ce8\u518c\uff0c<code>RPC.getProtocolEngine</code>\u9ed8\u8ba4\u903b\u8f91\u4f1a\u8d70<code>WritableRpcEngine</code>\uff1b</li> </ul>"},{"location":"hadoop/IPC.html#writable","title":"Writable","text":""},{"location":"hadoop/IPC.html#protobuf","title":"Protobuf","text":"<p>\u7248\u672c\u53f7</p>"},{"location":"hadoop/IPC.html#server","title":"Server\uff08\u670d\u52a1\u7aef\uff09","text":"<pre><code>RPC.Builder builder = new RPC.Builder(conf);\nbuilder.setProtocol(MPDProtocol.class);\nbuilder.setInstance(this);\nbuilder.setBindAddress(\"0.0.0.0\");\nbuilder.setPort(0);\nServer server = builder.build();\n</code></pre>"},{"location":"hadoop/IPC.html#proxy","title":"Proxy(\u5ba2\u6237\u7aef)","text":"<pre><code>// addr\u662f\u91cd\u70b9\nRPC.getProxy(MPDProtocol.class, MPDProtocol.versionID, addr, conf);\n</code></pre> <p>YarnClient \u83b7\u53d6 ApplicationReport # getRpcPort \u83b7\u53d6 Application \u7684 Rpc\u7aef\u53e3\uff0cClient\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u7aef\u53e3\u8fde\u63a5AM RPC\uff1b</p> <p>AM \u542f\u52a8 Container\u65f6\uff0c\u901a\u8fc7\u5c06AM\u7684Rpc\u7aef\u53e3\u8bbe\u7f6eContainer\u7684\u73af\u5883\u53d8\u91cf\uff1b</p>"},{"location":"hadoop/IPC.html#_1","title":"\u7248\u672c\u53f7","text":"<p>Client\u7aef\u4f9d\u8d56\u7684Protocol\u7684\u7248\u672c\u53f7\uff0c\u8ddfServer\u7aef\u7684Protocol\u53ef\u80fd\u4e0d\u4e00\u6837\u3002</p> <ul> <li> <p>\u63a5\u53e3\u4e2d\u5b9a\u4e49<code>long versionID = 234234L</code>\u7684\u5b57\u6bb5</p> </li> <li> <p>\u6216\u63a5\u53e3\u5b9e\u73b0<code>VersionedProtocol</code>\u7684\u63a5\u53e3</p> </li> </ul>"},{"location":"hadoop/auth.html","title":"Hadoop \u5b89\u5168","text":""},{"location":"hadoop/auth.html#authentication","title":"Authentication","text":"<p>\u9ed8\u8ba4NameNode\u548cResourceManager\u4e0d\u9700\u8981\u8ba4\u8bc1\uff0c\u5373\u4f7f\u7528\u6237\u6ca1\u6709\u670d\u52a1\u7aef\u8d85\u7ea7\u7528\u6237\u7684\u6743\u9650\uff0c\u4f46\u7528\u6237\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u53ef\u4ee5\u7528\u8d85\u7ea7\u7528\u6237\u8fdb\u884c\u4efb\u610f\u64cd\u4f5c\u3002</p> <p>\u5728\u8fd9\u79cdSimple Auth\u673a\u5236\u4e0b\uff0cClient\u7aef\u63d0\u53d6\u672c\u5730OS login username\u53d1\u9001\u7ed9Server\uff0cServer\u6beb\u65e0\u4fdd\u7559\u5730\u63a5\u53d7username\uff0c\u5e76\u4ee5\u6b64\u8eab\u4efd\u8fd0\u884cJob\u3002\u5b9e\u9645\u4e0a\uff0cHadoop\u672c\u8eab\u6ca1\u6709\u505a\u4efb\u4f55\u8ba4\u8bc1\u3002</p>"},{"location":"hadoop/auth.html#hadoop-auth","title":"Hadoop Auth","text":"<p>Hadoop Auth\u662f\u4e00\u4e2aJava\u5e93\uff0c\u5b83\u7531\u4e00\u4e2a\u5ba2\u6237\u673a\u548c\u4e00\u4e2a\u670d\u52a1\u5668\u7ec4\u4ef6\u7ec4\u6210\uff0c\u7528\u4e8e\u4e3aHTTP\u542f\u7528Kerberos SPNEGO\u8eab\u4efd\u9a8c\u8bc1\u3002</p> <p>Hadoop\u9ed8\u8ba4\u652f\u6301\u7684\u8eab\u4efd\u9a8c\u8bc1\u673a\u5236\u5305\u62ecSimple\u9a8c\u8bc1(\u4e5f\u79f0\u4e3a\u4f2a\u8eab\u4efd\u9a8c\u8bc1)\u548cKerberos SPNEGO\u8eab\u4efd\u9a8c\u8bc1\uff0c\u8fd8\u6709\u5176\u4ed6\u7684\u9a8c\u8bc1\u65b9\u5f0f\uff08LDAP\u7b49\uff09\u3002</p>"},{"location":"hadoop/auth.html#hadoop-security","title":"Hadoop Security\u7b80\u5355\u4ecb\u7ecd","text":"<p>\u57282010\u5e74\uff0c\u5b89\u5168\u7279\u6027\u88ab\u52a0\u5165Hadoop\uff08HADOOP-4487\uff09\uff0c\u4e3b\u8981\u5b9e\u73b0\u4e0b\u9762\u4e24\u4e2a\u76ee\u6807\uff1a</p> <ol> <li>\u62d2\u7edd\u672a\u6388\u6743\u7684\u64cd\u4f5c\u8bbf\u95eeHDFS\u4e2d\u7684\u6570\u636e\u3002</li> <li>\u5728\u5b9e\u73b01\u7684\u57fa\u7840\u4e0a\uff0c\u907f\u514d\u592a\u5927\u7684\u6027\u80fd\u635f\u8017\u3002</li> </ol> <p>\u4e3a\u4e86\u5b9e\u73b0\u7b2c\u4e00\u4e2a\u76ee\u6807\uff0c\u6211\u4eec\u9700\u8981\u4fdd\u8bc1\uff1a</p> <ol> <li>\u4efb\u4f55\u4e00\u4e2a\u5ba2\u6237\u7aef\u8981\u8bbf\u95ee\u96c6\u7fa4\u5fc5\u987b\u8981\u7ecf\u8fc7\u8ba4\u8bc1\uff0c\u4ee5\u786e\u4fdd\u5b83\u5c31\u662f\u81ea\u5df1\u58f0\u79f0\u7684\u8eab\u4efd\u3002</li> <li>\u96c6\u7fa4\u4e2d\u4efb\u4f55\u670d\u52a1\u5668\uff0c\u9700\u8981\u88ab\u8ba4\u8bc1\u4e3a\u96c6\u7fa4\u4e2d\u7684\u4e00\u90e8\u5206\u3002</li> </ol> <p>Kerberos\u88ab\u9009\u4f5c\u57fa\u7840\u7684\u8ba4\u8bc1\u670d\u52a1\u3002\u5176\u5b83\u7684\u673a\u5236\uff0c\u5982\uff1aDelegation Token, Block Access Token, Trust\u7b49\u88ab\u52a0\u5165\u5f53\u505aKerberos\u7684\u8865\u5145\u3002\u7279\u522b\u662fDelegation Token\u673a\u5236\u88ab\u5f15\u5165\uff0c\u5176\u4e3b\u8981\u7528\u4ee5\u5b9e\u73b0\u7b2c\u4e8c\u4e2a\u76ee\u6807\uff08\u8be6\u60c5\u89c1\u4e0b\u4e00\u8282\uff09\u3002</p> <p></p>"},{"location":"hadoop/auth.html#rpc","title":"RPC","text":"<p>Hadoop RPC\u4e2d\u91c7\u7528SASL\uff08Simple Authentication and Security Layer\uff0c\u7b80\u5355\u8ba4\u8bc1\u548c\u5b89\u5168\u5c42\uff09\u8fdb\u884c\u5b89\u5168\u8ba4\u8bc1\uff0c\u5177\u4f53\u8ba4\u8bc1\u65b9\u6cd5\u6d89\u53caKerberos\u548cDIGEST-MD5\u4e24\u79cd\u3002</p> <ul> <li>Kerberos\u7528\u4e8e\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u4e4b\u95f4\u5efa\u7acb\u4e00\u6761\u5b89\u5168\u7684\u7f51\u7edc\u8fde\u63a5\uff0c\u4e4b\u540e\u5ba2\u6237\u7aef\u53ef\u901a\u8fc7\u8be5\u8fde\u63a5\u4ece\u670d\u52a1\u5668\u7aef\u83b7\u53d6\u4e00\u4e2a\u5bc6\u94a5\u3002\u7531\u4e8e\u8be5\u5bc6\u94a5\u4ec5\u6709\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u77e5\u9053\uff0c\u56e0\u6b64\uff0c\u63a5\u4e0b\u6765\u5ba2\u6237\u7aef\u53ef\u4f7f\u7528\u8be5\u5171\u4eab\u5bc6\u94a5\u83b7\u53d6\u670d\u52a1\u7684\u8ba4\u8bc1\u3002</li> <li>\u5171\u4eab\u5bc6\u94a5\u8fdb\u884c\u5b89\u5168\u8ba4\u8bc1\uff08\u4f7f\u7528DIGEST-MD5\u534f\u8bae\uff09\uff0c\u5b83\u53ea\u6d89\u53ca\u8ba4\u8bc1\u53cc\u65b9\u800c\u4e0d\u5fc5\u6d89\u53ca\u7b2c\u4e09\u65b9\u5e94\u7528\uff08\u6bd4\u5982Kerberos\u4e2d\u7684KDC\uff09\uff0c\u5c06\u57fa\u4e8e\u5171\u4eab\u5bc6\u94a5\u751f\u6210\u7684\u5b89\u5168\u8ba4\u8bc1\u51ed\u8bc1\u79f0\u4e3a\u4ee4\u724c\uff08Token\uff09\u3002</li> </ul>"},{"location":"hadoop/auth.html#hadooptoken","title":"Hadoop\u4e2dToken","text":"<ul> <li>Delegation Tokens\u5728\u5176\u5b83\u670d\u52a1\u4e2d\u7684\u5e94\u7528\uff0c\u5982\uff1aApache Oozie, Apache Hive, and Apache Hadoop\u2019s YARN RM\uff0c\u8fd9\u4e9b\u670d\u52a1\u90fd\u662f\u7528Delegation Tokens\u8ba4\u8bc1\u673a\u5236\u3002</li> <li>Block Access Token\uff1aclient\u5728\u8bbf\u95eeHDFS\u4e0a\u7684\u6587\u4ef6\u65f6\uff0c\u9996\u5148\u9700\u8981\u548cNameNode\u901a\u4fe1\uff0c\u83b7\u53d6\u8be5\u6587\u4ef6\u7684Block\u4f4d\u7f6e\u4fe1\u606f\u3002\u7136\u540e\u76f4\u63a5\u548cDataNode\u901a\u4fe1\u8bbf\u95ee\u8fd9\u4e9bBlocks\u3002\u8bbf\u95ee\u6743\u9650\u7684\u68c0\u67e5\u662f\u5728NameNode\u7aef\u5b8c\u6210\u3002\u4f46\u662f\uff0cclient\u76f4\u63a5\u8bbf\u95eeDataNode\u4e2d\u7684Block\u6570\u636e\uff0c\u8fd9\u4e5f\u9700\u8981\u505a\u6743\u9650\u8ba4\u8bc1\u3002Block Access Tokens\u5c31\u662f\u7528\u6765\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\u3002Block Access Tokens\u662f\u7531NameNode\u53d1\u5e03\u7ed9Client\uff0c\u7136\u540e\u7531Client\u53d1\u9001\u7ed9DataNode\u3002Block Access Tokens\u7684\u751f\u547d\u5468\u671f\u5f88\u77ed\uff08\u9ed8\u8ba410\u5c0f\u65f6\uff09\uff0c\u5e76\u4e14\u4e0d\u80fd\u66f4\u65b0\u3002\u4e5f\u5c31\u610f\u5473\u7740\u5982\u679c\u4e00\u4e2aBlock Access Token\u8fc7\u671f\uff0c\u90a3\u4e48client\u5fc5\u987b\u91cd\u65b0\u83b7\u53d6\u4e00\u4e2a\u65b0\u7684token\u3002</li> <li>Authentication Token\uff1aHadoop\u4e2d\u8fd8\u6709\u4e00\u79cd\u673a\u5236\u79f0\u4e3a\uff1aAuthentication Token\uff0c\u4e3b\u8981\u76ee\u7684\u662f\u5b9e\u73b0\u4e00\u79cd\u66f4\u8f7b\u91cf\u7ea7\u3001\u9ad8\u53ef\u6269\u5c55\u7684\u8ba4\u8bc1\u65b9\u6848\u3002\u7c7b\u4f3c\u4e8eclient\u548cserver\u7aef\u7684cookie\u3002Authentication Tokens\u7531server\u7aef\u6388\u6743\uff0c\u4e14\u65e0\u6cd5\u66f4\u65b0\u4ee5\u53ca\u4eff\u5192\u4ed6\u4eba\u3002\u548cDelegation Tokens\u4e0d\u540c\u7684\u662f\uff0cserver\u7aef\u4e0d\u9700\u8981\u5355\u72ec\u5b58\u50a8Authentication Tokens.</li> </ul> <p>\u5728Hadoop\u4e2d\uff0c\u4ee4\u724c\u4e0eKerberos\u4e4b\u95f4\u6ca1\u6709\u4efb\u4f55\u4f9d\u8d56\u5173\u7cfb\uff0cKerberos\u4ec5\u4ec5\u662f\u8fdb\u884c\u7528\u6237\u8eab\u4efd\u9a8c\u8bc1\u7684\u7b2c\u4e00\u9053\u9632\u7ebf\uff0c\u7528\u6237\u5b8c\u5168\u53ef\u4ee5\u91c7\u7528\u5176\u4ed6\u5b89\u5168\u8ba4\u8bc1\u673a\u5236\u66ff\u6362Kerberos\u3002\u56e0\u6b64\uff0c\u57fa\u4e8e\u4ee4\u724c\u7684\u5b89\u5168\u673a\u5236\u5177\u6709\u66f4\u597d\u7684\u7075\u6d3b\u6027\u548c\u6269\u5c55\u6027\u3002</p>"},{"location":"hadoop/auth.html#delegation-token","title":"Delegation Token","text":"<p>\u53ea\u4f7f\u7528Kerberos\u5b9e\u73b0\u8ba4\u8bc1\u673a\u5236\uff0c\u4f46\u4f1a\u6709\u4e00\u5b9a\u95ee\u9898\uff0c\u5c24\u5176\u662f\u5e94\u7528\u5728\u50cfHadoop\u8fd9\u6837\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u3002\u60f3\u50cf\u4e00\u4e0b\uff0c\u5bf9\u4e8e\u6bcf\u4e2aMapReduce\u4efb\u52a1\uff0c\u5982\u679c\u6240\u6709\u7684\u4efb\u52a1\u90fd\u9700\u8981\u4f7f\u7528TGT (Ticket Granting Ticket)\u901a\u8fc7Kerberos\u6765\u8fdb\u884c\u8ba4\u8bc1\uff0cKDC\uff08Kerberos Key Distribution Center\uff09\u5c06\u5f88\u5feb\u6210\u4e3a\u7cfb\u7edf\u74f6\u9888\u3002</p> <p></p> <p>Delegation Tokens\u4f5c\u4e3aKerberos\u7684\u4e00\u4e2a\u8865\u5145\uff0c\u5b9e\u73b0\u4e86\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u8ba4\u8bc1\u673a\u5236\u3002Kerberos\u662f\u4e09\u65b9\u8ba4\u8bc1\u534f\u8bae\uff0c\u800cDelegation Tokens\u53ea\u6d89\u53ca\u5230\u4e24\u65b9\u3002</p> <p>Delegation Tokens\u7684\u8ba4\u8bc1\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>client\u901a\u8fc7Kerberos\u4e0eServer\u5b8c\u6210\u8ba4\u8bc1\uff0c\u5e76\u4eceserver\u83b7\u53d6\u76f8\u5e94\u7684Delegation Tokens\u3002</li> <li>client\u4e0eserver\u4e4b\u95f4\u540e\u7eed\u7684\u8ba4\u8bc1\u90fd\u662f\u901a\u8fc7Delegation Tokens\uff0c\u800c\u4e0d\u8fdb\u8fc7Kerberos\u3002</li> </ol> <p>\u8003\u8651\u5230\u9ad8\u53ef\u7528\u6027\uff0cDelegation Tokens\u4f1a\u88abserver\u8fdb\u884c\u6301\u4e45\u5316\u3002HDFS NameNode\u5c06Delegation Tokens\u6301\u4e45\u5316\u5230\u5143\u6570\u636e\u4e2d\uff08\u53c8\u79f0\u4e3a\uff1afsimage and edit logs\uff09\uff0cKMS\u4f1a\u5c06\u5176\u4ee5ZNodes\u5f62\u5f0f\u6301\u4e45\u5316\u5230ZooKeeper\u4e2d\u3002\u5373\u4f7f\u670d\u52a1\u91cd\u542f\u6216\u6545\u969c\u5207\u6362\uff0cDelegation Tokens\u4e5f\u4f1a\u4e00\u76f4\u53ef\u7528\u3002</p>"},{"location":"hadoop/auth.html#serverdelegation-tokens","title":"server\u7aef\u7684Delegation Tokens","text":"<p>server\u7aef\uff08HDFS NN\u548cKMS\uff09\u4e3b\u8981\u8d1f\u8d23\uff1a</p> <ol> <li>\u53d1\u5e03Delegation Tokens\uff0c\u5e76\u4fdd\u5b58\u7528\u4ee5\u9a8c\u8bc1\u3002</li> <li>\u54cd\u5e94\u66f4\u65b0Delegation Tokens\u8bf7\u6c42\u3002</li> <li>\u5f53client\u7aef\u6267\u884c\u5220\u9664\u64cd\u4f5c\u6216token\u8fc7\u671f\u65f6\uff0c\u79fb\u9664Token\u3002</li> <li>\u901a\u8fc7\u9a8c\u8bc1client\u63d0\u4f9b\u7684Tokens\u548cserver\u7aef\u5b58\u50a8\u7684token\u662f\u5426\u4e00\u81f4\uff0c\u6765\u5bf9client\u8fdb\u884c\u8ba4\u8bc1\u3002</li> </ol> <p>Delegation Token\u4e3b\u8981\u7531\u4e24\u90e8\u5206\u7ec4\u6210\uff1apublic\u90e8\u5206\u548cprivate\u90e8\u5206\uff0c\u5728Server\u7aef\u4ee5\u5f62\u5f0f\u5b58\u50a8\u5728hashmap\u4e2d\uff0c\u5176\u4e2dpublic\u90e8\u5206\u4f5c\u4e3akey\uff0cprivate\u90e8\u5206\u4f5c\u4e3avalue\u3002 <p>\u53ea\u6709Delegation Token\u7684renewer(renew-interval\uff0c\u9ed8\u8ba424\u5c0f\u65f6\uff09\u53ef\u4ee5\u5728token\u8fc7\u671f\u524d\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c\u3002\u6bcf\u6b21\u66f4\u65b0\u8fc7\u540e\uff0ctoken\u7684\u8fc7\u671f\u65f6\u95f4\u4f1a\u5ef6\u957f\u4e00\u4e2a\u66f4\u65b0\u5468\u671f\uff08renew-interval\uff09\uff0c\u76f4\u5230token\u8fbe\u5230\u6700\u5927\u751f\u547d\u5468\u671f\uff08\u9ed8\u8ba47\u5929\uff09\u3002</p>"},{"location":"hadoop/auth.html#clientdelegation-tokens","title":"client\u7aef\u7684Delegation tokens","text":"<p>client\u4e3b\u8981\u8d1f\u8d23\uff1a</p> <ol> <li>\u4eceserver\u7aef\u8bf7\u6c42\u4e00\u4e2a\u65b0\u7684Delegation Tokens\uff0c\u8bf7\u6c42\u540c\u65f6\u53ef\u4ee5\u6307\u5b9atoken\u7684\u66f4\u65b0\u8005\uff08renewer\uff09\u3002</li> <li>\u66f4\u65b0Delegation Tokens\uff08\u5982\u679cclient\u5c06\u81ea\u5df1\u6307\u5b9a\u4e3arenewer\uff09\uff0c\u4ea6\u6216\u8bf7\u6c42\u522b\u7684\u7ec4\u4ef6\u66f4\u65b0token\uff08\u6307\u5b9a\u7684renewer\uff09</li> <li>\u5411server\u53d1\u9001\u53d6\u6d88Delegation Tokens\u7684\u8bf7\u6c42\u3002</li> <li>\u63d0\u4f9bDelegation Tokens\u4f9bserver\u8fdb\u884c\u8ba4\u8bc1\u3002</li> </ol>"},{"location":"hadoop/auth.html#example-delegation-tokens","title":"Example: Delegation Tokens\u7684\u751f\u547d\u5468\u671f","text":"<p>\u56fe\u4e2d\u901a\u5e38\u67095\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>client\u5e0c\u671b\u5728\u96c6\u7fa4\u4e2d\u8fd0\u884c\u4e00\u4e2ajob\uff0c\u5b83\u5206\u522b\u4eceNameNode\u548cKMS\u83b7\u53d6HDFS Delegation Token\u548cKMS Delegation Token\u3002</li> <li>client\u5c06\u4f5c\u4e1a\u63d0\u4ea4\u5230YARN\u8d44\u6e90\u7ba1\u7406\u5668\uff08RM\uff09\uff0c\u540c\u65f6\u63d0\u4ea4\u7684\u8fd8\u6709step1\u4e2d\u83b7\u53d6\u7684Delegation Token\u4ee5\u53caApplicationSubmissionContext\u3002</li> <li>YARN RM\u901a\u8fc7\u66f4\u65b0\u64cd\u4f5c\u6765\u6838\u5b9e\u63a5\u6536\u7684Token\uff0c\u968f\u540e\uff0cYARN\u542f\u52a8job\uff0c\u5e76\u5c06\u5176\u548cDelegation Tokens\u4e00\u540c\u5206\u53d1\u5230\u5404\u4e2aworker\u8282\u70b9\u4e0a\u3002</li> <li>\u6bcf\u4e2a\u5de5\u4f5c\u8282\u70b9\u4e2d\u7684Task\u5229\u7528\u8fd9\u4e9bToken\u6765\u8fdb\u884c\u8ba4\u8bc1\uff0c\u6bd4\u5982\uff1a\u9700\u8981\u8bbf\u95eeHDFS\u4e0a\u6570\u636e\u65f6\uff0c\u4f7f\u7528HDFS Delegation Token\u8fdb\u884c\u8ba4\u8bc1\u3002\u9700\u8981\u89e3\u5bc6HDFS\u52a0\u5bc6\u533a\u7684\u6587\u4ef6\u65f6\uff0c\u4f7f\u7528KMS Delegation Token\u3002</li> <li>job\u7ed3\u675f\u540e\uff0cRM\u5219\u53d6\u6d88\u8be5job\u7684Delegation Tokens\u3002</li> </ol>"},{"location":"hadoop/auth.html#_1","title":"\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u5e94\u7528","text":"<p>Delegations Tokens\u8d85\u8fc7\u5176\u6700\u5927\u751f\u547d\u5468\u671f\u540e\u65e0\u6cd5\u88ab\u66f4\u65b0\uff0c\u90a3\u4e48\u5982\u679c\u4e00\u4e2a\u4efb\u52a1\u9700\u8981\u8fd0\u884c\u65f6\u95f4\u6bd4token\u7684\u6700\u5927\u751f\u547d\u5468\u671f\u8fd8\u8981\u957f\u600e\u4e48\u529e\uff1f</p> <ul> <li> <p>Hadoop\u65e0\u6cd5\u901a\u8fc7\u73b0\u6709\u7684\u914d\u7f6e\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff1b</p> </li> <li> <p>\u5bf9\u4e8espark-submit\u63d0\u4ea4\u7684\u4efb\u52a1\uff0cSpark\u5df2\u7ecf\u5b9e\u73b0\u4e00\u4e9b\"\u795e\u5947\"\u7684\u53c2\u6570\uff0cSpark\u83b7\u53d6Delegation Tokens\uff0c\u5e76\u7528\u5b83\u505a\u8ba4\u8bc1\uff0c\u4f46Spark\u5728token\u5c06\u8981\u8fc7\u671f\u65f6\u5e76\u4e0d\u4f1a\u66f4\u65b0tokens\uff0c\u800c\u662f\u83b7\u53d6\u4e00\u4e2a\u65b0\u7684token\u3002\u8fd9\u5c31\u53ef\u4ee5\u8ba9\u5e94\u7528\u6c38\u8fdc\u5730\u8fd0\u884c\u4e0b\u53bb\u3002\u9700\u8981\u4e3aspark\u5e94\u7528\u751f\u6210Kerberos keytab\u6587\u4ef6\u3002</p> </li> <li> <p>\u957f\u8017\u65f6\u4f5c\u4e1a\uff0c\u4f60\u5e94\u8be5\u8003\u8651\u5229\u7528YARN documentation about long-lived services\u4e2d\u63cf\u8ff0\u7684\u673a\u5236\uff0c\u6216\u8005\u4e3atoken\u66f4\u65b0\u8005\u589e\u52a0\u4e00\u4e9b\u81ea\u5b9a\u4e49\u903b\u8f91\uff0c\u7528\u6765\u5728\u73b0\u6709tokens\u5373\u5c06\u8fc7\u671f\u65f6\uff0c\u91cd\u65b0\u83b7\u53d6delegation tokens\u3002</p> </li> </ul>"},{"location":"hadoop/auth.html#271-bug","title":"2.7.1 Bug","text":"<p>Failed to Update HDFS Delegation Token for long running application in HA mode</p> <ul> <li>NameNode HA</li> <li>Kerberos</li> <li>HDFS Delegation Token</li> </ul>"},{"location":"hadoop/auth.html#hadoop-key-management-server-kms","title":"Hadoop Key Management Server (KMS)","text":"<p>Hadoop Key Management Server\uff08KMS\uff09\u662f\u4e00\u4e2a\u57fa\u4e8eHadoopKeyProvider API\u7f16\u5199\u7684\u5bc6\u94a5\u7ba1\u7406\u670d\u52a1\u5668\u3002\u4ed6\u63d0\u4f9b\u4e86\u4e00\u4e2aclient\u548c\u4e00\u4e2aserver\u7ec4\u4ef6\uff0cclient\u548cserver\u4e4b\u95f4\u57fa\u4e8eHTTP\u534f\u8bae\u4f7f\u7528REST API\u901a\u4fe1\u3002</p> <p>Client\u662fKeyProvider\u7684\u5b9e\u73b0\uff0c\u4f7f\u7528KMS HTTP REST API\u4e0eKMS\u4ea4\u4e92\u3002KMS\u548c\u5b83\u7684client\u6709\u5185\u7f6e\u7684\u5b89\u5168\u673a\u5236\uff0c\u652f\u6301HTTP SPNEGO Kerberos\u8ba4\u8bc1\u548cHTTPS\u5b89\u5168\u4f20\u8f93\u3002</p> <p>KMS\u662f\u4e00\u4e2aJava Jetty Web\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>Kms\u548cHdfs\u914d\u5408\u4f7f\u7528\u7684\u4f5c\u7528\u65e8\u5728\u8865\u5168hdfs\u6743\u9650\u7ba1\u63a7\u7684\u5b89\u5168\u6f0f\u6d1e\uff0c\u6b63\u5e38\u4f7f\u7528hdfs\u65f6\uff0c\u7528\u6237\u611f\u89c9\u4e0d\u5230\u6587\u4ef6\u52a0\u5bc6\u7684\u5b58\u5728\uff0c\u6240\u4ee5\u53eb\u201chdfs\u900f\u660e\u52a0\u5bc6\u201d\u3002</p>"},{"location":"hadoop/auth.html#hadoopsecurity","title":"Hadoop\u5b89\u5168(security)\u6a21\u5f0f","text":"<p>When Hadoop is configured to run in secure mode, each Hadoop service and each user must be authenticated by Kerberos.</p>"},{"location":"hadoop/auth.html#authentication_1","title":"Authentication","text":""},{"location":"hadoop/auth.html#hadoop-daemons","title":"Hadoop Daemons\u7684\u7528\u6237\u8d26\u6237","text":"User:Group Daemons hdfs:hadoop NameNode, Secondary NameNode, JournalNode, DataNode yarn:hadoop ResourceManager, NodeManager mapred:hadoop MapReduce JobHistory Server"},{"location":"hadoop/auth.html#hadoop-daemonskerberos-principals","title":"Hadoop Daemons\u7684Kerberos principals","text":"<p>\u6bcf\u4e2aHadoop\u670d\u52a1\u5b9e\u4f8b\u5fc5\u987b\u4f7f\u7528\u5176Kerberos principal \u548c keytab \u6587\u4ef6\u4f4d\u7f6e\u8fdb\u884c\u914d\u7f6e\u3002</p> <ul> <li>HDFS\uff1aNameNode\uff0cSecondary NameNode\uff0cDataNode </li> <li>YARN\uff1aResourceManager\uff0cNodeManager </li> <li>MapReduce JobHistory Server</li> </ul>"},{"location":"hadoop/auth.html#kerberos-principalsos","title":"\u5c06Kerberos principals\u6620\u5c04\u4e3aOS \u7528\u6237\u8d26\u6237","text":"<p>hadoop.security.auth_to_local\uff1a\u6307\u5b9a\u6620\u5c04\u89c4\u5219</p> <ul> <li>RULE:exp \uff1a</li> <li>DEFAULT \uff1a</li> </ul> <p>hadoop.security.auth_to_local.mechanism\uff1a</p> <ul> <li><code>hadoop</code> \uff1a</li> <li><code>MIT</code> \uff1a</li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>&lt;property&gt;\n  &lt;name&gt;hadoop.security.auth_to_local&lt;/name&gt;\n  &lt;value&gt;\n    RULE:[2:$1/$2@$0]([ndj]n/.*@REALM.\\TLD)s/.*/hdfs/\n    RULE:[2:$1/$2@$0]([rn]m/.*@REALM\\.TLD)s/.*/yarn/\n    RULE:[2:$1/$2@$0](jhs/.*@REALM\\.TLD)s/.*/mapred/\n    DEFAULT\n  &lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"hadoop/auth.html#_2","title":"\u7528\u6237\u6620\u5c04\u5230\u7528\u6237\u7ec4","text":"<p>hadoop.security.group.mapping</p> <p>https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/GroupsMapping.html</p>"},{"location":"hadoop/auth.html#service-level-authorization","title":"Service Level Authorization","text":""},{"location":"hadoop/auth.html#authentication-for-web-consoles","title":"Authentication for Web Consoles","text":""},{"location":"hadoop/auth.html#data-confidentiality","title":"Data Confidentiality","text":""},{"location":"hadoop/cmd.html","title":"Cmd","text":""},{"location":"hadoop/cmd.html#unable-to-load-native-hadoop-library-for-your-platform","title":"Unable to load native-hadoop library for your platform","text":"<p><code>hadoop checknative -a</code> \u68c0\u67e5native library</p> <p>\u539f\u56e0\uff1a</p> <p>Apache\u63d0\u4f9b\u7684hadoop\u672c\u5730\u5e93\u662f32\u4f4d\u7684\uff0c\u800c\u572864\u4f4d\u7684\u670d\u52a1\u5668\u4e0a\u5c31\u4f1a\u6709\u95ee\u9898\uff0c\u56e0\u6b64\u9700\u8981\u81ea\u5df1\u7f16\u8bd164\u4f4d\u7684\u7248\u672c\u3002</p> <p>\u89e3\u51b3\uff1a</p> <ul> <li> <p>http://dl.bintray.com/sequenceiq/sequenceiq-bin/  \u4e0b\u8f7d\u5bf9\u5e94\u7684\u7f16\u8bd1\u7248\u672c\uff1b</p> </li> <li> <p>\u5c06\u51c6\u5907\u597d\u768464\u4f4d\u7684lib\u5305\u89e3\u538b\u5230\u5df2\u7ecf\u5b89\u88c5\u597d\u7684hadoop\u5b89\u88c5\u76ee\u5f55\u7684lib/native \u548c lib\u76ee\u5f55\u4e0b\uff1b</p> </li> </ul>"},{"location":"hadoop/configuration.html","title":"Hadoop Configuration","text":"<p>new Configuration() \u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d</p> <ul> <li>Configuration\u7684\u7c7b\u521d\u59cb\u5316\u4f1a\u52a0\u8f7d<code>core-default.xml</code>\u548c<code>core-site.xml</code>\u4f5c\u4e3adefaultResource\uff1b</li> <li>ConfigUtil\u4e2d\u4f1a\u52a0\u8f7d\uff08\u8fd9\u4e2a\u4e0d\u4e00\u5b9a\u90fd\u4f1a\u89e6\u53d1\uff0c\u76ee\u524d\u6240\u77e5FileSystem\u548cUserGroupInformation\u4f1a\u89e6\u53d1\uff0c\u7531ReflectionUtils\u4e2d\u7684newInstance\u7684setConf\u4e2d\u4f1a\u52a0\u8f7d\uff09</li> <li><code>mapred-default.xml</code></li> <li><code>mapred-site.xml</code></li> <li><code>yarn-default.xml</code></li> <li><code>yarn-site.xml</code></li> </ul>"},{"location":"hadoop/configuration.html#security","title":"\u5b89\u5168(Security)\u914d\u7f6e","text":"Parameter Value Notes <code>hadoop.security.authentication</code> <code>kerberos</code> <code>simple</code> : No authentication. (default)  <code>kerberos</code> : Enable authentication by Kerberos."},{"location":"hadoop/configuration.html#delegation-token","title":"Delegation Token\u914d\u7f6e","text":"<p>dfs.namenode.delegation.token.renew-interval </p> <p>\u9ed8\u8ba4\uff1a86400000  (1 day)</p> <p>dfs.namenode.delegation.token.max-lifetime </p> <p>\u9ed8\u8ba4\uff1a604800000  (7 days)</p> <p>dfs.namenode.delegation.key.update-interval </p> <p>\u9ed8\u8ba4\uff1a86400000  (1 day)</p> <p>yarn.resourcemanager.delegation.key.update-interval</p> <p>\u9ed8\u8ba4\uff1a86400000  (1 day)</p> <p>yarn.resourcemanager.delegation.token.max-lifetime</p> <p>\u9ed8\u8ba4\uff1a604800000  (7 days)</p> <p>yarn.resourcemanager.delegation.token.renew-interval</p> <p>\u9ed8\u8ba4\uff1a86400000  (1 day)</p>"},{"location":"hadoop/configuration.html#kms","title":"KMS","text":"<p>hadoop.kms.authentication.type</p> <p>\u9ed8\u8ba4\uff1asimple\uff0c\u53ef\u9009kerberos</p>"},{"location":"hadoop/jars.html","title":"jars","text":""},{"location":"hadoop/jars.html#classpath-isolation","title":"Classpath isolation","text":"<p>Hadoop 3.0 \u9632\u6b62\u4e0d\u540c\u7248\u672cjar\u5305\u51b2\u7a81\uff0chttps://issues.apache.org/jira/browse/HADOOP-11656</p>"},{"location":"hadoop/jars.html#hadoop-client","title":"hadoop-client","text":"<p>\u540c\u6837\u7684protobuf\u7c7b\uff0c\u5728client\u548chdfs\u4e2d\u90fd\u4f1a\u6709\uff1a</p> <ul> <li> <p>hadoop-client-api \u4e2d\u7684proto \u751f\u6210\u7c7b\uff0c\u5176Google Protobuf\u7c7b\u4f1a\u88abshaded\uff1b</p> </li> <li> <p>\u4f46\u662f hadoop-hdfs-api\u4e2d\u7684proto\u751f\u6210\u7c7b\uff0c\u5176Google Protobuf\u7c7b\u4e0d\u4f1a\u88abshaded\uff1b</p> </li> </ul>"},{"location":"hadoop/kerberos.html","title":"Kerberos","text":"<p>[toc]</p>"},{"location":"hadoop/kerberos.html#kerberos","title":"Kerberos\u534f\u8bae","text":""},{"location":"hadoop/proxy_user.html","title":"\u4ee3\u7406\u7528\u6237","text":"<p><code>core-site/xml</code>\uff1a</p> <pre><code> &lt;property&gt;\n     &lt;name&gt;hadoop.proxyuser.super.hosts&lt;/name&gt;\n     &lt;value&gt;host1,host2&lt;/value&gt;\n   &lt;/property&gt;\n   &lt;property&gt;\n     &lt;!-- super \u7528\u6237\u53ef\u4ee5\u6a21\u62dfgroup1, group2\u4e0b\u7684\u7528\u6237 --&gt;\n     &lt;name&gt;hadoop.proxyuser.super.groups&lt;/name&gt;\n     &lt;value&gt;group1,group2&lt;/value&gt;\n   &lt;/property&gt;\n &lt;property&gt;\n     &lt;!-- super \u7528\u6237\u53ef\u4ee5\u6a21\u62dfuser1, user2\u7528\u6237 --&gt;\n     &lt;name&gt;hadoop.proxyuser.super.users&lt;/name&gt;\n     &lt;value&gt;user1,user2&lt;/value&gt;\n   &lt;/property&gt;\n</code></pre> <pre><code>// \u5982\u679c\u542f\u52a8\u8fdb\u7a0b\u7684\u7528\u6237\u4e0d\u662f\u914d\u7f6e\u7684\u8d85\u7ea7\u7528\u6237\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7\u73af\u5883\u53d8\u91cf HADOOP_PROXY_USER \u6307\u5b9a\u4e3a\u76f8\u5e94\u7684\u8d85\u7ea7\u7528\u6237\u5373\u53ef\nUserGroupInformation ugi =\n                UserGroupInformation.createProxyUser(userName, UserGroupInformation.getLoginUser());\nreturn ugi.doAs(action);\n</code></pre>"},{"location":"hadoop/proxy_user.html#kerberos","title":"Kerberos","text":"<pre><code>// \u8bbe\u7f6e\u5168\u5c40\u7684\u767b\u5f55\u7528\u6237\nUserGroupInformation.loginUserFromKeytab(\"hq/master@HQGF.COM\",\"E:/kerberosconf/hq.keytab\");\n// \u4ee3\u7406\u7528\u6237\nUserGroupInformation ugi = UserGroupInformation.createProxyUser(userName, UserGroupInformation.getLoginUser());\nugi.doAs(action);\n</code></pre> <pre><code>// \u8bbe\u7f6e\u5f53\u524d\u7528\u6237\nUserGroupInformation ugi = UserGroupInformation.loginUserFromKeytabAndReturnUGI(\"hq/master@HQGF.COM\",\"E:/kerberosconf/hq.keytab\");\nugi.doAs(action);\n</code></pre>"},{"location":"languages/go/channel.html","title":"Channel","text":"<p>channel \u7684\u96f6\u503c\u4e3a nil\uff1a</p> <ul> <li>\u5728 nil \u901a\u9053\u4e0a\u53d1\u9001\u548c\u63a5\u6536\u5c06\u4f1a\u6c38\u8fdc\u963b\u585e\uff1b</li> <li>select\u8bed\u53e5\u4e2d\uff0c\u5982\u679c\u901a\u9053\u4e3anil\uff0c\u5c06\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u9009\u62e9\uff1b</li> </ul> <p>Go \u8bed\u8a00\u63d0\u4f9b\u4e86\u4e00\u79cd\u4e0d\u540c\u7684\u5e76\u53d1\u6a21\u578b\uff0c\u5373\u901a\u4fe1\u987a\u5e8f\u8fdb\u7a0b\uff08Communicating sequential processes\uff0cCSP\uff09\u3002</p> <p>Goroutine \u548c Channel \u5206\u522b\u5bf9\u5e94 CSP \u4e2d\u7684\u5b9e\u4f53\u548c\u4f20\u9012\u4fe1\u606f\u7684\u5a92\u4ecb\uff0cGoroutine \u4e4b\u95f4\u4f1a\u901a\u8fc7 Channel \u4f20\u9012\u6570\u636e\u3002</p>"},{"location":"languages/go/channel.html#_1","title":"\u57fa\u672c\u4f7f\u7528","text":"<p>\u76ee\u524d\u7684 Channel \u6536\u53d1\u64cd\u4f5c\u5747\u9075\u5faa\u4e86\u5148\u8fdb\u5148\u51fa\u7684\u8bbe\u8ba1\uff0c\u5177\u4f53\u89c4\u5219\u5982\u4e0b\uff1a</p> <ul> <li>\u5148\u4ece Channel \u8bfb\u53d6\u6570\u636e\u7684 Goroutine \u4f1a\u5148\u63a5\u6536\u5230\u6570\u636e\uff1b</li> <li>\u5148\u5411 Channel \u53d1\u9001\u6570\u636e\u7684 Goroutine \u4f1a\u5f97\u5230\u5148\u53d1\u9001\u6570\u636e\u7684\u6743\u5229\uff1b</li> </ul> <p>\u7528\u6cd5\uff1a</p> <pre><code>// \u521b\u5efa channel\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4ee3\u8868Channel\u7684\u7f13\u5b58\u7684\u5927\u5c0f\uff0c\u4e0d\u8bbe\u7f6e\u6216\u8005\u4e3a0\uff0c\n// \u8868\u793a\u6ca1\u6709\u7f13\u5b58\uff0c\u53ea\u6709sender\u548creceiver\u90fd\u51c6\u5907\u597d\u4e86\u540e\u5b83\u4eec\u7684\u901a\u8baf(communication)\u624d\u4f1a\u53d1\u751f(Blocking)\nch := make(chan int)\n// \u4eceChannel ch\u4e2d\u63a5\u6536\u6570\u636e\uff0c\u5e76\u5c06\u6570\u636e\u8d4b\u503c\u7ed9v\nx := &lt;- ch\n// \u53d1\u9001\u503c x \u5230 Channel ch \u4e2d\nch &lt;- x\n//\nclose(ch)\n</code></pre> <ul> <li>\u5982\u679cchannel c \u5df2\u7ecf\u88ab\u5173\u95ed,\u7ee7\u7eed\u5f80\u5b83\u53d1\u9001\u6570\u636e\u4f1a\u5bfc\u81f4<code>panic: send on closed channel</code>;</li> <li>\u4f46\u662f\u4ece\u8fd9\u4e2a\u5173\u95ed\u7684channel\u4e2d\u4e0d\u4f46\u53ef\u4ee5\u8bfb\u53d6\u51fa\u5df2\u53d1\u9001\u7684\u6570\u636e\uff0c\u8fd8\u53ef\u4ee5\u4e0d\u65ad\u7684\u8bfb\u53d6\u96f6\u503c\uff1b</li> <li>\u5982\u679c\u901a\u8fc7<code>range</code>\u8bfb\u53d6\uff0cchannel\u5173\u95ed\u540efor\u5faa\u73af\u4f1a\u8df3\u51fa\uff1b</li> <li><code>i, ok := &lt;-c</code>\u53ef\u4ee5\u67e5\u770b Channel\u7684\u72b6\u6001\uff08<code>i</code>\u4e3a 0\uff0c <code>ok</code>\u4e3a false\uff09\uff1b</li> </ul>"},{"location":"languages/go/channel.html#_2","title":"\u540c\u6b65","text":"<p>channel \u7528\u5728 goroutine \u4e4b\u95f4\u7684\u540c\u6b65\u3002 \u4e0b\u9762\u7684\u4f8b\u5b50\u4e2dmain goroutine\u901a\u8fc7done channel\u7b49\u5f85worker\u5b8c\u6210\u4efb\u52a1\u3002 worker\u505a\u5b8c\u4efb\u52a1\u540e\u53ea\u9700\u5f80channel\u53d1\u9001\u4e00\u4e2a\u6570\u636e\u5c31\u53ef\u4ee5\u901a\u77e5main goroutine\u4efb\u52a1\u5b8c\u6210\u3002</p> <pre><code>import (\n    \"fmt\"\n    \"time\"\n)\nfunc worker(done chan bool) {\n    time.Sleep(time.Second)\n    // \u901a\u77e5\u4efb\u52a1\u5df2\u5b8c\u6210\n    done &lt;- true\n}\nfunc main() {\n    done := make(chan bool, 1)\n    go worker(done)\n    // \u7b49\u5f85\u4efb\u52a1\u5b8c\u6210\n    &lt;-done\n}\n</code></pre>"},{"location":"languages/go/channel.html#select","title":"select","text":"<p><code>select</code> \u4e5f\u80fd\u591f\u8ba9 Goroutine \u540c\u65f6\u7b49\u5f85\u591a\u4e2a Channel \u53ef\u8bfb\u6216\u8005\u53ef\u5199\uff0c\u5728\u591a\u4e2a\u6587\u4ef6\u6216\u8005 Channel\u72b6\u6001\u6539\u53d8\u4e4b\u524d\uff0c<code>select</code> \u4f1a\u4e00\u76f4\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\u6216\u8005 Goroutine\u3002</p> <pre><code>func fibonacci(c, quit chan int) {\n    x, y := 0, 1\n    for {  // \u5faa\u73af\u8ba1\u7b97\n        select {\n        case c &lt;- x:  // \u8ba1\u7b97\u7684\u503c\u53d1\u9001\u5230 channel c \u4e2d\n            x, y = y, x+y\n        case &lt;-quit:  // \u5982\u679c channel quit \u6709\u8f93\u5165\uff0c\u5219\u9000\u51fa\n            fmt.Println(\"quit\")\n            return\n        }\n    }\n}\n</code></pre> <p>\u4e0a\u8ff0\u63a7\u5236\u7ed3\u6784\u4f1a\u7b49\u5f85 <code>c &lt;- x</code> \u6216\u8005 <code>&lt;-quit</code> \u4e24\u4e2a\u8868\u8fbe\u5f0f\u4e2d\u4efb\u610f\u4e00\u4e2a\u8fd4\u56de\u3002</p> <p>\u65e0\u8bba\u54ea\u4e00\u4e2a\u8868\u8fbe\u5f0f\u8fd4\u56de\u90fd\u4f1a\u7acb\u523b\u6267\u884c <code>case</code> \u4e2d\u7684\u4ee3\u7801\uff0c\u5f53 <code>select</code> \u4e2d\u7684\u4e24\u4e2a <code>case</code> \u540c\u65f6\u88ab\u89e6\u53d1\u65f6\uff0c\u4f1a\u968f\u673a\u6267\u884c\u5176\u4e2d\u7684\u4e00\u4e2a\u3002</p>"},{"location":"languages/go/channel.html#_3","title":"\u8d85\u65f6","text":"<p>select \u5982\u679c\u6ca1\u6709case\u9700\u8981\u5904\u7406\uff0cselect\u8bed\u53e5\u5c31\u4f1a\u4e00\u76f4\u963b\u585e\u7740\u3002\u8fd9\u65f6\u5019\u6211\u4eec\u53ef\u80fd\u5c31\u9700\u8981\u4e00\u4e2a\u8d85\u65f6\u64cd\u4f5c\uff0c\u7528\u6765\u5904\u7406\u8d85\u65f6\u7684\u60c5\u51b5\u3002</p> <ul> <li><code>time.After</code>\u65b9\u6cd5\uff0c\u8fd4\u56de\u4e00\u4e2a\u7c7b\u578b\u4e3a<code>&lt;-chan Time</code>\u7684\u5355\u5411\u7684channel\uff0c\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u53d1\u9001\u4e00\u4e2a\u5f53\u524d\u65f6\u95f4\u7ed9\u8fd4\u56de\u7684channel\u4e2d\u3002</li> </ul> <pre><code>import \"time\"\nimport \"fmt\"\nfunc main() {\n    c1 := make(chan string, 1)\n    go func() {\n        time.Sleep(time.Second * 2)\n        c1 &lt;- \"result 1\"\n    }()\n    select {\n    case res := &lt;-c1:\n        fmt.Println(res)\n    case &lt;-time.After(time.Second * 1):\n        fmt.Println(\"timeout 1\")\n    }\n}\n</code></pre>"},{"location":"languages/go/channel.html#timerticker","title":"Timer\u548cTicker","text":"<p><code>timer</code>\u662f\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u4ee3\u8868\u672a\u6765\u7684\u4e00\u4e2a\u5355\u4e00\u4e8b\u4ef6\uff0c\u4f60\u53ef\u4ee5\u544a\u8bc9timer\u4f60\u8981\u7b49\u5f85\u591a\u957f\u65f6\u95f4\uff0c\u5b83\u63d0\u4f9b\u4e00\u4e2aChannel\uff0c\u5728\u5c06\u6765\u7684\u90a3\u4e2a\u65f6\u95f4\u90a3\u4e2aChannel\u63d0\u4f9b\u4e86\u4e00\u4e2a\u65f6\u95f4\u503c\u3002</p> <ul> <li>\u5355\u7eaf\u7684\u7b49\u5f85\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528<code>time.Sleep</code>\u6765\u5b9e\u73b0\uff1b</li> </ul> <pre><code>timer2 := time.NewTimer(time.Second)\ngo func() {\n    &lt;-timer2.C\n    fmt.Println(\"Timer 2 expired\")\n}()\nstop2 := timer2.Stop()\nif stop2 {\n    fmt.Println(\"Timer 2 stopped\")\n}\n</code></pre> <p><code>ticker</code>\u662f\u4e00\u4e2a\u5b9a\u65f6\u89e6\u53d1\u7684\u8ba1\u65f6\u5668\uff0c\u5b83\u4f1a\u4ee5\u4e00\u4e2a\u95f4\u9694(interval)\u5f80Channel\u53d1\u9001\u4e00\u4e2a\u4e8b\u4ef6(\u5f53\u524d\u65f6\u95f4)\uff0c\u800cChannel\u7684\u63a5\u6536\u8005\u53ef\u4ee5\u4ee5\u56fa\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u4eceChannel\u4e2d\u8bfb\u53d6\u4e8b\u4ef6\u3002\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2dticker\u6bcf500\u6beb\u79d2\u89e6\u53d1\u4e00\u6b21\uff0c\u4f60\u53ef\u4ee5\u89c2\u5bdf\u8f93\u51fa\u7684\u65f6\u95f4\u3002</p> <ul> <li>\u7c7b\u4f3ctimer, ticker\u4e5f\u53ef\u4ee5\u901a\u8fc7<code>Stop</code>\u65b9\u6cd5\u6765\u505c\u6b62\u3002\u4e00\u65e6\u5b83\u505c\u6b62\uff0c\u63a5\u6536\u8005\u4e0d\u518d\u4f1a\u4ecechannel\u4e2d\u63a5\u6536\u6570\u636e\u4e86\u3002</li> </ul> <pre><code>ticker := time.NewTicker(time.Millisecond * 500)\ngo func() {\n    for t := range ticker.C {\n        fmt.Println(\"Tick at\", t)\n    }\n}()\ntime.Sleep(time.Second * 2)\nticker.Stop()\n</code></pre>"},{"location":"languages/go/concurrency.html","title":"\u5e76\u53d1","text":"<p><code>sync</code> \u5305\u4e2d\u63d0\u4f9b\u4e86\u7528\u4e8e\u540c\u6b65\u7684\u4e00\u4e9b\u57fa\u672c\u539f\u8bed\uff0c\u5305\u62ec\u5e38\u89c1\u7684 <code>sync.Mutex</code>\u3001<code>sync.RWMutex</code>\u3001<code>sync.WaitGroup</code>\u3001<code>sync.Once</code> \u548c <code>sync.Cond</code>\uff1b</p> <p>Go \u4e2d\uff1a</p> <ul> <li> <p>\u8d4b\u503c\u64cd\u4f5c\u4e0d\u5b58\u5728\u6307\u4ee4\u91cd\u6392\u7684\u95ee\u9898</p> </li> <li> <p>\u5bf9\u53d8\u91cf\u7684\u8bfb\u548c\u5199\uff08\u8d85\u8fc7\u4e00\u4e2a\u673a\u5668\u5b57\u7684\u53d8\u91cf\u65f6\uff09\u90fd\u6ca1\u6709\u539f\u5b50\u6027\u7684\u4fdd\u8bc1</p> </li> </ul>"},{"location":"languages/go/concurrency.html#_2","title":"\u5e76\u53d1\u6a21\u578b","text":"<p>Go\u8bed\u8a00\u7684\u5e76\u53d1\u6a21\u578b\u662f\u57fa\u4e8eCSP\uff08Communicating Sequential Processes\uff09\u3002</p> <ul> <li>\u901a\u8fc7 goroutine \u548c channel \u6765\u5b8c\u6210</li> </ul>"},{"location":"languages/go/concurrency.html#goroutine","title":"goroutine","text":"<p><code>go f(x, y, z)</code> \u5f00\u542f\u4e00\u4e2a\u65b0\u7684 goroutine \u6267\u884c f(x, y, z)</p> <ul> <li><code>sync.Mutex</code> \u89e3\u51b3\u7ebf\u7a0b\u4e92\u65a5\uff0c<code>channel</code> \u89e3\u51b3\u7ebf\u7a0b\u534f\u4f5c</li> </ul>"},{"location":"languages/go/concurrency.html#go","title":"Go \u5185\u5b58\u6a21\u578b","text":"<p>https://go.dev/ref/mem</p> <p>\u95ee\u9898\uff1a</p> <ul> <li>Mutex \u4e2d\u5bf9\u53d8\u91cf\u7684\u8bbf\u95ee\uff0c\u600e\u4e48\u786e\u4fdd\u62ff\u5230\u7684\u662f\u5185\u5b58\u7684\u503c\uff0c\u800c\u4e0d\u662f\u5bc4\u5b58\u5668\u7684\u65e7\u503c\uff1f</li> <li>\u7279\u5b9a\u7684\u7f16\u8bd1\u6307\u4ee4\uff1f</li> </ul> <pre><code>var a string\nvar done bool\n\nfunc setup() {\n    a = \"hello, world\"      // A\n    done = true\n}\n\nfunc main() {\n    go setup()\n    for !done {\n    }\n    print(a)                // B\n}\n</code></pre> <p>\u8fd9\u4e2a\u4f8b\u5b50\uff0c\u5f88\u5e76\u4e0d\u80fd\u786e\u4fdd\u6253\u5370 \u201chello, world\u201d\uff0cprint(a) \u6267\u884c\u7684\u65f6\u5019 a \u662f\u53ef\u80fd\u6ca1\u6709\u8d4b\u503c\u7684\uff0c\u6ca1\u6709\u4efb\u4f55\u89c4\u5219\u4fdd\u8bc1 A &lt;= B \u8fd9\u4e2a\u987a\u5e8f\u3002</p> <ul> <li>a=\"hello, world\" \u548c done=true \u8fd9\u4e24\u884c\u4ee3\u7801\u7684\u5b9e\u9645\u6267\u884c\u987a\u5e8f\u5e76\u6ca1\u6709\u4efb\u4f55\u4fdd\u8bc1\u54c8\uff0ccpu \u662f\u53ef\u4ee5\u4e71\u5e8f\u6267\u884c\u7684\uff1b</li> <li>\u66f4\u7cdf\u7cd5\u7684\uff0cmain \u7a0b\u5e8f\u5f88\u6709\u53ef\u80fd\u4f1a\u6b7b\u5faa\u73af\uff0c\u56e0\u4e3a done \u7684\u8d4b\u503c\u662f\u5728\u53e6\u4e00\u4e2a\u5e76\u53d1\u7684 goroutine \u91cc\uff0c\u5e76\u4e14\u6ca1\u6709\u786e\u4fdd\u88ab main \u51fd\u6570\u53ef\u89c1\u3002</li> </ul>"},{"location":"languages/go/concurrency.html#happen-before","title":"Happen Before\u4fdd\u8bc1","text":""},{"location":"languages/go/concurrency.html#go-routine","title":"go routine","text":"<p>The <code>go</code> statement that starts a new goroutine is synchronized before the start of the goroutine's execution.</p> <p>go routine \u542f\u52a8\u524d\uff0c\u5176\u524d\u9762\u6267\u884c\u7684\u4ee3\u7801\u80af\u5b9a\u5df2\u7ecf\u6267\u884c\u5b8c\u6210\uff1b</p>"},{"location":"languages/go/concurrency.html#channel","title":"channel","text":"<p>\u5728\u6709\u7f13\u51b2\u7684\u901a\u9053\u65f6\u5019\u5411\u901a\u9053\u5199\u5165\u4e00\u4e2a\u6570\u636e\u603b\u662f happen before \u8fd9\u4e2a\u6570\u636e\u88ab\u4ece\u901a\u9053\u4e2d\u8bfb\u53d6\u5b8c\u6210</p> <ul> <li>\u591a\u4e2agoroutine\u4e2d\u5bf9\u5171\u4eab\u53d8\u91cf\u7684\u5e76\u53d1\u8bbf\u95ee\u53d8\u6210\u4e86\u53ef\u9884\u89c1\u7684\u4e32\u884c\u5316\u64cd\u4f5c</li> </ul> <p>\u65e0\u7f13\u51b2\u7684\u901a\u9053\u6765\u8bf4\u4ece\u901a\u9053\u8bfb\u53d6\u5143\u7d20 happen before \u5411\u901a\u9053\u53d1\u9001\u5199\u5165\u6570\u636e\u5b8c\u6210</p>"},{"location":"languages/go/concurrency.html#lock","title":"Lock","text":"<p>sync.Mutex\uff08\u4e92\u65a5\u9501\uff09\u548c sync.RWMutex\uff08\u8bfb\u5199\u9501\uff09</p> <p>\u9501\u53d8\u91cf L\uff0c\u7b2c n \u6b21\u8c03\u7528 <code>L.Unlock()</code> \u903b\u8f91\u5148\u4e8e\uff08\u7ed3\u679c\u53ef\u89c1\u4e8e\uff09\u7b2c m \u6b21\u8c03\u7528 <code>L.Lock()</code> \u64cd\u4f5c\uff08n &lt;= m\uff09\u3002</p> <ul> <li>\u5982\u7b2c 1 \u6b21\u7684\u89e3\u9501\u53ef\u89c1\u4e8e\u7b2c\u4e8c\u6b21\u7684\u52a0\u9501\uff1b</li> </ul> <p><code>sync.RWMutex</code> \u7c7b\u578b\u7684\u9501\u53d8\u91cf L\uff0c\u8bf4\u7684\u662f <code>L.Unlock( )</code> \u53ef\u89c1\u4e8e <code>L.Rlock( )</code> \uff0c\u7b2c n \u6b21\u7684 <code>L.Runlock( )</code> \u5148\u4e8e \u7b2c n+1 \u6b21\u7684 <code>L.Lock()</code> \uff08n &lt;= m\uff09\u3002\u3002</p>"},{"location":"languages/go/concurrency.html#atomic","title":"atomic","text":"<p>Golang \u4e2d\u7684 atomic \u662f SC \u6700\u5f3a\u8bed\u4e49\u7684\uff0c\u4e0d\u5141\u8bb8\u5b58\u5728\u4efb\u4f55\u7684\u91cd\u6392\u3002</p>"},{"location":"languages/go/concurrency.html#mutex","title":"Mutex","text":"<p>Go \u6807\u51c6\u5e93\u4e2d\u7684 Mutex \u662f\u4e0d\u53ef\u91cd\u5165\u3002</p> <ul> <li>Mutex \u672c\u8eab\u5e76\u6ca1\u6709\u5305\u542b\u6301\u6709\u8fd9\u628a\u9501\u7684 goroutine \u7684\u4fe1\u606f</li> <li>\u9501\u53ef\u4ee5\u88ab\u672a\u6301\u6709\u7684 goroutine \u91ca\u653e\uff0c\u56e0\u6b64\u8981\u9075\u5faa\u201c\u8c01\u7533\u8bf7\uff0c\u8c01\u91ca\u653e\u201d\u7684\u539f\u5219</li> </ul> <pre><code>func (m *Mutex) Lock() {\n    // Fast path: grab unlocked mutex.\n    if atomic.CompareAndSwapInt32(&amp;m.state, 0, 1) {\n        return\n    }\n    // Slow path (outlined so that the fast path can be inlined)\n    m.lockSlow()\n}\nfunc (m *Mutex) Unlock() {\n    // Fast path: drop lock bit.\n    new := atomic.AddInt32(&amp;m.state, -mutexLocked)\n    if new != 0 {\n        // Outlined slow path to allow inlining the fast path.\n        // To hide unlockSlow during tracing we skip one extra frame when tracing GoUnblock.\n        m.unlockSlow(new)\n    }\n}\n</code></pre> <p>\u5176\u5b9e\u73b0\u7ec6\u8282\uff1a</p> <ul> <li> <p>spin \u673a\u5236\u9488\u5bf9\u4e34\u754c\u533a\u6267\u884c\u77ed\u7684\u573a\u666f\uff1b</p> </li> <li> <p>\u901a\u8fc7\u4fe1\u53f7\u91cf\u6765\u963b\u585e\u672a\u7533\u8bf7\u5230\u9501\u7684 goroutine\uff1b</p> </li> </ul> <p></p>"},{"location":"languages/go/concurrency.html#_3","title":"\u4f7f\u7528","text":"<p>\u7981\u6b62\uff1a</p> <ul> <li>Copy \u5df2\u4f7f\u7528\u7684 Mutex\uff1aMutex \u662f\u6709\u72b6\u6001\u7684\uff1b</li> <li>\u91cd\u5165\uff08\u6301\u6709\u9501\u7684\u60c5\u51b5\u4e0b\u518d\u8c03\u7528lock\uff09\uff1aMutex \u4e0d\u652f\u6301\u91cd\u5165\uff0c\u56e0\u4e3a\u672a\u8bb0\u5f55\u6301\u6709\u9501\u7684 goroutine \u4fe1\u606f\uff1b</li> </ul>"},{"location":"languages/go/concurrency.html#once","title":"Once","text":"<p>\u5b9e\u73b0\u5355\u4f8b</p>"},{"location":"languages/go/context.html","title":"Context","text":"<p>\u4e0a\u4e0b\u6587 <code>context.Context</code> Go \u8bed\u8a00\u4e2d\u7528\u6765\u8bbe\u7f6e\u622a\u6b62\u65e5\u671f\u3001\u540c\u6b65\u4fe1\u53f7\uff0c\u4f20\u9012\u8bf7\u6c42\u76f8\u5173\u503c\u7684\u7ed3\u6784\u4f53\u3002</p> <p>\u53ef\u80fd\u4f1a\u521b\u5efa\u591a\u4e2a Goroutine \u6765\u5904\u7406\u4e00\u6b21\u8bf7\u6c42\uff0c\u800c <code>context.Context</code> \u7684\u4f5c\u7528\u662f\u5728\u4e0d\u540c Goroutine \u4e4b\u95f4\u540c\u6b65\u8bf7\u6c42\u7279\u5b9a\u6570\u636e\u3001\u53d6\u6d88\u4fe1\u53f7\u4ee5\u53ca\u5904\u7406\u8bf7\u6c42\u7684\u622a\u6b62\u65e5\u671f\u3002</p> <p></p> <p>\u6bcf\u4e00\u4e2a <code>context.Context</code> \u90fd\u4f1a\u4ece\u6700\u9876\u5c42\u7684 Goroutine \u4e00\u5c42\u4e00\u5c42\u4f20\u9012\u5230\u6700\u4e0b\u5c42\u3002<code>context.Context</code> \u53ef\u4ee5\u5728\u4e0a\u5c42 Goroutine \u6267\u884c\u51fa\u73b0\u9519\u8bef\u65f6\uff0c\u5c06\u4fe1\u53f7\u53ca\u65f6\u540c\u6b65\u7ed9\u4e0b\u5c42\u3002</p>"},{"location":"languages/go/context.html#_1","title":"\u6784\u9020","text":"<p>\u4e0d\u53ef\u53d8\u6027</p>"},{"location":"languages/go/context.html#contextbackground","title":"context.BackGround","text":"<ul> <li>returns a non-nil, empty Context</li> <li>never canceled, has no values, and has no deadline</li> <li>as the top-level Context for incoming requests</li> </ul>"},{"location":"languages/go/context.html#contexttodo","title":"context.TODO","text":"<ul> <li>returns a non-nil, empty Context</li> <li>never canceled, has no values, and has no deadline</li> <li>use context.TODO when it's unclear</li> </ul>"},{"location":"languages/go/context.html#contextwithvalue","title":"context.WithValue","text":"<p>a copy of parent in which the value associated with key is val.</p> <ul> <li>Users of WithValue should define their own types for keys, not use built-in type or string ;</li> </ul> <pre><code>// ctx \u4e2d\u5b58\u50a8\u4e86 \"a\" \u4e3a 1\nctx := context.withValue(context.Background(), \"a\", 1)\n</code></pre> <p>\u5b9e\u9645\u83b7\u53d6\u7684\u65f6\u5019\uff0c\u662f\u4ece\u5f53\u524d\u5c42\u5f00\u59cb\u9010\u5c42\u7684\u8fdb\u884c\u5411\u4e0a\u9012\u5f52\uff0c\u76f4\u81f3\u627e\u5230\u67d0\u4e2a\u5339\u914d\u7684key \u6216\u8005\u8fd4\u56de nil\u3002</p>"},{"location":"languages/go/context.html#contextwithcancel","title":"context.WithCancel","text":"<p>a copy of parent with a new Done channel.</p> <p>The returned context's Done channel is closed when the returned cancel function is called or when the parent context's Done channel is closed, whichever happens first.</p> <p>\u53d6\u6d88\u67d0\u4e2aparent\u7684goroutine, \u5b9e\u9645\u4e0a\u4f1a\u9012\u5f52\u5c42\u5c42cancel\u6389\u81ea\u5df1\u7684child context\u7684done chan\u4ece\u800c\u8ba9\u6574\u4e2a\u8c03\u7528\u94fe\u4e2d\u6240\u6709\u76d1\u542ccancel\u7684goroutine\u9000\u51fa</p> <ul> <li>\u5f53\u4ee3\u7801\u6267\u884c\u5b8c\u6210\u540e\uff0c\u5e94\u5f53\u7acb\u5373\u6267\u884c <code>cancel</code> \u51fd\u6570\uff08\u8fd9\u91cc\u7684cancel \u6709 complete\u7684\u542b\u4e49\uff09\uff1b</li> </ul> <pre><code>type cancelCtx struct {\n    Context\n\n    mu       sync.Mutex            // protects following fields \u4fdd\u62a4\u5c5e\u6027\n    done     chan struct{}         // created lazily, closed by first cancel call\n    // \u8bb0\u5f55\u5b50 context \u7684cancel\n    children map[canceler]struct{} // set to nil by the first cancel call\n    err      error                 // set to non-nil by the first cancel call\n}\n</code></pre>"},{"location":"languages/go/context.html#contextwithtimeout","title":"context.WithTimeout","text":"<p>\u5b9e\u73b0\u539f\u7406\uff1a\u542f\u52a8\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u7136\u540e\u5728\u8d85\u65f6\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u5c06\u5f53\u524d\u7684context\u7ed9cancel\u6389\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u76d1\u542c\u5728\u5f53\u524d\u548c\u4e0b\u5c42\u7684<code>context.Done()</code>\u7684<code>goroutine</code>\u7684\u9000\u51fa</p> <pre><code>type timerCtx struct {\n    cancelCtx\n    timer *time.Timer // timer\u5b9a\u65f6\u5668\n\n    deadline time.Time //\u7ec8\u6b62\u65f6\u95f4\n}\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <ul> <li>\u5373\u65f6\u8d85\u65f6\u8fd4\u56de\u4e86\uff0c\u4f46\u662f\u5b50\u534f\u7a0b\u4ecd\u5728\u7ee7\u7eed\u8fd0\u884c\uff0c\u76f4\u5230\u81ea\u5df1\u9000\u51fa</li> </ul> <pre><code>func main() {\n    ctx, cancel := context.WithTimeout(context.Background(), 1*time.Second)\n    // cancel \u4e00\u5b9a\u8981\u6267\u884c\n    defer cancel()\n\n    go handle(ctx, 500*time.Millisecond)\n    select {\n    case &lt;-ctx.Done():\n        fmt.Println(\"main\", ctx.Err())\n    }\n}\n\nfunc handle(ctx context.Context, duration time.Duration) {\n    select {\n    case &lt;-ctx.Done():\n        fmt.Println(\"handle\", ctx.Err())\n    case &lt;-time.After(duration):\n        // 500ms &lt; 1s, run here\n        fmt.Println(\"process request with\", duration)\n    }\n}\n</code></pre>"},{"location":"languages/go/go.html","title":"Go\u57fa\u7840\u8bed\u6cd5","text":""},{"location":"languages/go/go.html#_1","title":"\u4f7f\u7528","text":"<p>go\u5305\u4e0b\u8f7d\u7684\u4ee3\u7406 https://goproxy.io/zh/</p> <pre><code>export GOPROXY=https://proxy.golang.com.cn,direct\n</code></pre>"},{"location":"languages/go/go.html#_2","title":"\u53d8\u91cf","text":"<p>\u53d8\u91cf\u5b9a\u4e49\u53ea\u6709var\uff0c\u51fd\u6570\u5916\u4e0d\u80fd\u7528 := \u8d4b\u503c\uff0c\u53d8\u91cf\u672a\u521d\u59cb\u5316\u6709\u96f6\u503c\uff1b</p> <pre><code>var a int = 1  // \u7b49\u4ef7\u4e8e \nvar a  =       // \u7c7b\u578b\u81ea\u52a8\u63a8\u65ad\uff0c\u7b49\u4ef7\u4e8e\na := 1\n</code></pre> <p>\u5e38\u91cf\u7528const\uff0c\u4e0d\u80fd\u7528<code>:=</code></p> <pre><code>const a = 1\n</code></pre> <p>make\u4e5f\u662f\u4e00\u4e2a\u5185\u5efa\u51fd\u6570\uff0c\u7528\u6765\u4e3a slice\uff0cmap \u6216 chan \u7c7b\u578b\u5206\u914d\u5185\u5b58\u548c\u521d\u59cb\u5316\u4e00\u4e2a\u5bf9\u8c61\u3002</p> <ul> <li>new \u7684\u4f5c\u7528\u662f\u521d\u59cb\u5316\u4e00\u4e2a\u6307\u5411\u7c7b\u578b\u7684\u6307\u9488(*T)\uff0cmake \u7684\u4f5c\u7528\u662f\u53ea\u4e3a slice\uff0cmap \u6216 chan \u521d\u59cb\u5316\u5e76\u8fd4\u56de\u5f15\u7528\uff08T\uff09\uff1b</li> </ul>"},{"location":"languages/go/go.html#_3","title":"\u5faa\u73af","text":"<pre><code>for key, value := range oldMap {\n    newMap[key] = value\n}\n</code></pre>"},{"location":"languages/go/go.html#_4","title":"\u6307\u9488","text":"<p>\u51fd\u6570\u8fd4\u56de\u5c40\u90e8\u53d8\u91cf\u7684\u5730\u5740\u662f\u5b89\u5168\u7684\uff08\u4f46\u662fC/C++\u4e2d\uff0c\u51fd\u6570\u8fd4\u56de\u5c40\u90e8\u53d8\u91cf\u7684\u5730\u5740\u662f\u4e0d\u5b89\u5168\u7684\uff09</p> <ul> <li>go\u8bed\u8a00\u7f16\u8bd1\u5668\u4f1a\u81ea\u52a8\u51b3\u5b9a\u628a\u4e00\u4e2a\u53d8\u91cf\u653e\u5728\u6808\u8fd8\u662f\u653e\u5728\u5806\uff0c\u7f16\u8bd1\u5668\u4f1a\u505a\u9003\u9038\u5206\u6790(escape analysis)\uff0c\u5f53\u53d1\u73b0\u53d8\u91cf\u7684\u4f5c\u7528\u57df\u6ca1\u6709\u8dd1\u51fa\u51fd\u6570\u8303\u56f4\uff0c\u5c31\u53ef\u4ee5\u5728\u6808\u4e0a\uff0c\u53cd\u4e4b\u5219\u5fc5\u987b\u5206\u914d\u5728\u5806\uff1b</li> <li>\u5bf9\u4e8e\u52a8\u6001new\u51fa\u6765\u7684\u5c40\u90e8\u53d8\u91cf\uff0cgo\u8bed\u8a00\u7f16\u8bd1\u5668\u4e5f\u4f1a\u6839\u636e\u662f\u5426\u6709\u9003\u9038\u884c\u4e3a\u6765\u51b3\u5b9a\u662f\u5206\u914d\u5728\u5806\u8fd8\u662f\u6808\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u5206\u914d\u5728\u5806\u4e2d\u3002</li> </ul>"},{"location":"languages/go/go.html#_5","title":"\u8d4b\u503c","text":"<p>golang\u4e2d\u53ea\u6709\u503c\u4f20\u9012\uff0c\u6ca1\u6709\u5f15\u7528\u4f20\u9012\u3002\u56e0\u4e3a\u62f7\u8d1d\u7684\u5185\u5bb9\u6709\u65f6\u5019\u662f\u975e\u5f15\u7528\u7c7b\u578b\uff08int\u3001string\u3001struct\u7b49\u8fd9\u4e9b\uff09\uff0c\u8fd9\u6837\u5c31\u5728\u51fd\u6570\u4e2d\u5c31\u65e0\u6cd5\u4fee\u6539\u539f\u5185\u5bb9\u6570\u636e\uff1b\u6709\u7684\u662f\u5f15\u7528\u7c7b\u578b\uff08\u6307\u9488\u3001map\u3001slice\u3001chan\u7b49\u8fd9\u4e9b\uff09\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fee\u6539\u539f\u5185\u5bb9\u6570\u636e\u3002</p>"},{"location":"languages/go/go.html#_6","title":"\u503c\u7c7b\u578b","text":"<p>\u503c\u7c7b\u578b\u5305\u62ec\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff1aint\uff0cfloat\uff0cbool\uff0cstring\uff0c\u4ee5\u53ca\u6570\u7ec4\u548c\u7ed3\u6784\u4f53(struct)\u3002</p> <p>\u503c\u7c7b\u578b\u53d8\u91cf\u58f0\u660e\u540e\uff0c\u4e0d\u7ba1\u662f\u5426\u5df2\u7ecf\u8d4b\u503c\uff0c\u7f16\u8bd1\u5668\u4e3a\u5176\u5206\u914d\u5185\u5b58\uff0c\u6b64\u65f6\u8be5\u503c\u5b58\u50a8\u4e8e\u6808\u4e0a\u3002</p> <pre><code>//\u6570\u7ec4\u7684\u8d4b\u503c\nvar c =[]int32{1,2,3}    //\u5b9a\u4e49\u4e00\u4e2a\u957f\u5ea6\u4e3a3\u7684int\u7c7b\u578b\u7684\u6570\u7ec4\nd := c      //\u5c06\u6570\u7ec4c\u8d4b\u503c\u7ed9d\nd[1] = 100  //\u4fee\u6539\u6570\u7ec4d\u4e2d\u7d22\u5f15\u4e3a1\u7684\u503c\u4e3a100\nfmt.Printf(\"c\u7684\u503c\u662f%v\uff0cc\u7684\u5185\u5b58\u5730\u5740\u662f%p\\n\",c,&amp;c)   //c\u7684\u503c\u662f[1 2 3]\uff0cc\u7684\u5185\u5b58\u5730\u5740\u662f0xc42000a180\nfmt.Printf(\"d\u7684\u503c\u662f%v\uff0cd\u7684\u5185\u5b58\u5730\u5740\u662f%p\\n\",d,&amp;d)   //d\u7684\u503c\u662f[1 100 3]\uff0cd\u7684\u5185\u5b58\u5730\u5740\u662f0xc42000a1a0\n</code></pre> <p>\u81ea\u5b9a\u4e49\u7684struct</p> <pre><code>func main() {\n    p:=Person{\"\u5f20\u4e09\"}\n    fmt.Printf(\"\u539f\u59cbPerson\u7684\u5185\u5b58\u5730\u5740\u662f\uff1a%p\\n\",&amp;p)\n    modify(p)\n    fmt.Println(p)\n}\n\ntype Person struct {\n    Name string\n}\n\n func modify(p Person) {\n     fmt.Printf(\"\u51fd\u6570\u91cc\u63a5\u6536\u5230Person\u7684\u5185\u5b58\u5730\u5740\u662f\uff1a%p\\n\",&amp;p)\n     p.Name = \"\u674e\u56db\"\n }\n\n// \u539f\u59cbPerson\u7684\u5185\u5b58\u5730\u5740\u662f\uff1a0xc4200721b0 \n// \u51fd\u6570\u91cc\u63a5\u6536\u5230Person\u7684\u5185\u5b58\u5730\u5740\u662f\uff1a0xc4200721c0\n// {\u5f20\u4e09}\n</code></pre>"},{"location":"languages/go/go.html#_7","title":"\u5f15\u7528\u7c7b\u578b","text":"<p>\u5f15\u7528\u7c7b\u578b\u5305\u62ec\u6307\u9488\uff0cslice\u5207\u7247\uff0cmap \uff0cchan\uff0cinterface\u3002</p> <p>\u53d8\u91cf\u76f4\u63a5\u5b58\u653e\u7684\u5c31\u662f\u4e00\u4e2a\u5185\u5b58\u5730\u5740\u503c\uff0c\u8fd9\u4e2a\u5730\u5740\u503c\u6307\u5411\u7684\u7a7a\u95f4\u5b58\u7684\u624d\u662f\u503c\u3002\u6240\u4ee5\u4fee\u6539\u5176\u4e2d\u4e00\u4e2a\uff0c\u53e6\u5916\u4e00\u4e2a\u4e5f\u4f1a\u4fee\u6539\uff08\u540c\u4e00\u4e2a\u5185\u5b58\u5730\u5740\uff09\u3002</p>"},{"location":"languages/go/go.html#_8","title":"\u679a\u4e3e","text":"<p><code>go</code> \u4e2d\u6ca1\u6709\u679a\u4e3e\u53d8\u91cf\uff0c\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7 <code>const</code> \u5b9e\u73b0\u540c\u6837\u529f\u80fd\u3002</p> <pre><code>type WeekDay int \nconst (\n    SUNDAY WeekDay = iota  \n    MONDAY \n    TUESDAY \n    WEDNESDAY \n    THURSDAY \n    FRIDAY\n    SATURDAY \n)\n</code></pre>"},{"location":"languages/go/go.html#_9","title":"\u6570\u7ec4\u548c\u5207\u7247","text":"<p>\u6570\u7ec4\u548c\u5207\u7247\uff1a<code>len</code>\u6c42\u957f\u5ea6\uff0c\u4e0b\u6807\u4ece0\u5f00\u59cb\uff0c<code>cap</code> \u83b7\u53d6\u5bb9\u91cf\u3002</p> <ul> <li>\u6570\u7ec4\u662f\u5177\u6709\u76f8\u540c\u552f\u4e00\u7c7b\u578b\u7684\u4e00\u7ec4\u5df2\u7f16\u53f7\u4e14\u957f\u5ea6\u56fa\u5b9a\u7684\u6570\u636e\u9879\u5e8f\u5217</li> </ul> <p>\u5207\u7247\u4e0d\u8981\u6c42\u6307\u5b9a\u957f\u5ea6\uff1b\u6570\u7ec4\u590d\u5236\uff08=\uff09\u662f\u62f7\u8d1d\uff0c\u5207\u7247\u590d\u5236\u662f\u5f15\u7528\uff08\u56e0\u4e3a\u5207\u7247\u5b58\u50a8\u7684\u662f\u6307\u9488\u3001\u957f\u5ea6\u3001\u5bb9\u91cf\u4e09\u4e2a\u4fe1\u606f\uff09\uff1a</p> <ul> <li> <p>\u7c7b\u578b <code>[n]T</code> \u662f\u4e00\u4e2a\u6709 n \u4e2a\u7c7b\u578b\u4e3a T \u7684\u503c\u7684\u6570\u7ec4\uff0c\u5982 <code>var a [2]int</code>\u8868\u793a\u67092\u4e2a\u5143\u7d20\u7684int\u578b\u6570\u7ec4\u3002\u6570\u7ec4\u7684\u957f\u5ea6\u662f\u7c7b\u578b\u4e00\u90e8\u5206\uff1b</p> </li> <li> <p>slice\u6307\u5411\u4e00\u4e2a\u5e8f\u5217\u7684\u503c\uff0c\u5305\u542b\u957f\u5ea6\u4fe1\u606f\uff0c[]T\u662f\u4e00\u4e2a\u5143\u7d20\u7c7b\u578b\u4e3aT\u7684slice\uff0c\u5982 <code>s := []int {1,2,3,4}</code>\uff1b</p> </li> <li> <p>slice\u53ef\u4ee5\u91cd\u65b0\u5207\u7247\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684slice\u503c\u6307\u5411\u76f8\u540c\u7684\u6570\u7ec4\uff1b<code>s[low:high]</code>\u5305\u542b\u4ecelow\u5230 high-1 \u7684\u5143\u7d20\uff0clow\u3001high\u53ef\u4ee5\u662f\u53d8\u91cf\uff1b</p> </li> <li> <p>slice \u7531\u51fd\u6570 make \u521b\u5efa\u3002\u8fd9\u4f1a\u5206\u914d\u4e00\u4e2a\u5168\u662f\u96f6\u503c\u7684\u6570\u7ec4\u5e76\u4e14\u8fd4\u56de\u4e00\u4e2a slice \u6307\u5411\u8fd9\u4e2a\u6570\u7ec4\uff1a</p> <p><code>a := make([]int, 5, 10) // len(a)=5, capacity=10, capacity\u53ef\u4ee5\u7701\u7565\uff1b</code></p> </li> <li> <p>slice \u7684\u96f6\u503c\u662fnil\uff0c\u901a\u8fc7append\u53ef\u4ee5\u5411slice\u6dfb\u52a0\u5143\u7d20\uff1b <code>var s [] int; s = append(s, 2)</code></p> </li> <li> <p>for \u5faa\u73af\u7684 range \u683c\u5f0f\u53ef\u4ee5\u5bf9 slice \u6216\u8005 map \u8fdb\u884c\u8fed\u4ee3\u5faa\u73af\uff0c<code>for i, v := range pow{}</code>\uff0c\u5176\u4e2di\u662f\u4e0b\u6807\uff0cv\u662f\u503c\uff1b\u4e0d\u9700\u8981\u7d22\u5f15\u65f6\uff0c\u53ef\u4ee5\u7528_\u4ee3\u66ffi\uff0c\u4e0d\u9700\u8981\u503c\u65f6\u53ea\u9700i\u5373\u53ef\uff1b</p> </li> <li> <p>\u4e00\u4e2a\u6570\u7ec4\u53d8\u91cf\u8868\u793a\u6574\u4e2a\u6570\u7ec4\uff0c\u5b83\u4e0d\u662f\u6307\u5411\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684\u6307\u9488\uff08\u4e0d\u50cf C \u8bed\u8a00\u7684\u6570\u7ec4\uff09\u3002 \u5f53\u4e00\u4e2a\u6570\u7ec4\u53d8\u91cf\u88ab\u8d4b\u503c\u6216\u8005\u88ab\u4f20\u9012\u7684\u65f6\u5019\uff0c\u5b9e\u9645\u4e0a\u4f1a\u590d\u5236\u6574\u4e2a\u6570\u7ec4\u3002\u56e0\u6b64\u53ef\u4ee5\u4f20\u9012\u6307\u9488\uff0c\u4f46\u8bb0\u4f4f\u6570\u7ec4\u6307\u9488\u4e0d\u662f\u6570\u7ec4\u3002</p> </li> <li> <p>\u5207\u7247\u64cd\u4f5c\uff08\u6307\u4e0b\u6807\u53d6\u503c\uff09\u5e76\u4e0d\u590d\u5236\u5207\u7247\u6307\u5411\u7684\u5143\u7d20\u3002\u5b83\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5207\u7247\u5e76\u590d\u7528\u539f\u6765\u5207\u7247\u7684\u5e95\u5c42\u6570\u7ec4\u3002\u8fd9\u4f7f\u5f97\u5207\u7247\u64cd\u4f5c\u548c\u6570\u7ec4\u7d22\u5f15\u4e00\u6837\u9ad8\u6548\u3002\u56e0\u6b64\uff0c\u901a\u8fc7\u4e00\u4e2a\u65b0\u5207\u7247\u4fee\u6539\u5143\u7d20\u4f1a\u5f71\u54cd\u5230\u539f\u59cb\u5207\u7247\u7684\u5bf9\u5e94\u5143\u7d20\u3002</p> </li> <li> <p>\u5c0f\u7684\u5185\u5b58\u5f15\u7528\u5bfc\u81f4\u4fdd\u5b58\u6240\u6709\u7684\u6570\u636e\u3002\u6839\u636e\u60c5\u5f62\u62f7\u8d1d\u6570\u636e\u5230\u65b0\u7684\u5207\u7247\u4e2d\u3002</p> </li> </ul>"},{"location":"languages/go/go.html#append","title":"append \u51fd\u6570","text":"<pre><code>slice2 := append(slice1, 23, 15)\n</code></pre> <p>\u4ee5\u4e0a\u5bf9\u5207\u7247 <code>slice1</code> \u8fdb\u884c <code>append</code> \u64cd\u4f5c\u3002\u8be5\u64cd\u4f5c\u9075\u5faa\u4ee5\u4e0b\u539f\u5219\uff1a</p> <ol> <li><code>append</code> \u51fd\u6570\u5bf9\u4e00\u4e2a\u5207\u7247 <code>slice1</code> \u8fdb\u884c\u8ffd\u52a0\u64cd\u4f5c\uff0c\u5e76\u8fd4\u56de\u53e6\u4e00\u4e2a\u957f\u5ea6\u4e3a <code>len(slice1) + \u8ffd\u52a0\u4e2a\u6570</code> \u7684\u5207\u7247\uff0c\u539f\u5207\u7247\u4e0d\u88ab\u6539\u52a8\uff0c\u4e24\u4e2a\u5207\u7247\u6240\u6307\u5411\u7684\u5e95\u5c42\u6570\u7ec4\u53ef\u80fd\u662f\u540c\u4e00\u4e2a\u4e5f\u53ef\u80fd\u4e0d\u662f\uff0c\u53d6\u51b3\u4e8e\u7b2c\u4e8c\u6761\uff1a</li> <li><code>slice1</code> \u662f\u5bf9\u5176\u5e95\u5c42\u6570\u7ec4\u7684\u4e00\u6bb5\u5f15\u7528\uff0c\u82e5 append \u8ffd\u52a0\u5b8c\u4e4b\u540e\u6ca1\u6709\u7a81\u7834 <code>slice1</code> \u7684\u5bb9\u91cf\uff0c\u5219\u5b9e\u9645\u4e0a\u8ffd\u52a0\u7684\u6570\u636e\u6539\u53d8\u4e86\u5176\u5e95\u5c42\u6570\u7ec4\u5bf9\u5e94\u7684\u503c\uff0c\u5e76\u4e14 <code>append</code> \u51fd\u6570\u8fd4\u56de\u5bf9\u5e95\u5c42\u6570\u7ec4\u65b0\u7684\u5f15\u7528\uff08\u5207\u7247\uff09\uff1b\u82e5 <code>append</code> \u8ffd\u52a0\u7684\u6570\u636e\u91cf\u7a81\u7834\u4e86 <code>slice1</code> \u7684\u6700\u5927\u5bb9\u91cf\uff08\u5e95\u5c42\u6570\u7ec4\u957f\u5ea6\u56fa\u5b9a\uff0c\u65e0\u6cd5\u589e\u52a0\u957f\u5ea6\u8d4b\u4e88\u65b0\u503c\uff09\uff0c\u5219 <code>Go</code> \u4f1a\u5728\u5185\u5b58\u4e2d\u7533\u8bf7\u65b0\u7684\u6570\u7ec4\uff08\u6570\u7ec4\u5185\u7684\u503c\u4e3a\u8ffd\u52a0\u64cd\u4f5c\u4e4b\u540e\u7684\u503c\uff09\uff0c\u5e76\u8fd4\u56de\u5bf9\u65b0\u6570\u7ec4\u7684\u5f15\u7528\uff08\u5207\u7247\uff09\u3002</li> </ol>"},{"location":"languages/go/go.html#_10","title":"\u51fd\u6570","text":"<p>\u51fd\u6570\u7684\u5b9a\u4e49\uff1a \u7c7b\u578b\u5199\u5728\u53d8\u91cf\u540d\u540e\u9762\uff0c\u7c7b\u578b\u4e00\u81f4\uff0c\u53ef\u4ee5\u5199\u6210<code>(x, y int)</code>\uff0c\u8fd4\u56de\u503c\u5199\u5728\u53c2\u6570\u5b9a\u4e49\u540e\u9762</p> <pre><code>func add(x int, y int) int { return x + y}\n// \u7ed9\u8fd4\u56de\u503c\u547d\u540d\uff0c\u8fd4\u56de\u4e24\u4e2aint\u503c\uff0c\u4e0d\u9700\u8981\u663e\u793a return\u53d8\u91cf\nfunc split(sum int) (x, y int) {x = \u2026 y = \u2026 return}\n</code></pre>"},{"location":"languages/go/go.html#defer","title":"defer","text":"<p>\u5728\u540c\u4e00\u4e2a\u51fd\u6570\u5185\u90e8\u8c03\u7528\u591a\u4e2a defer \u8bed\u53e5\uff0c\u6267\u884c\u987a\u5e8f\u662f\u540e\u8fdb\u5148\u51fa\uff08LIFO\uff09</p> <p>\u5c06\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\u7684\u6267\u884c\u63a8\u8fdf\u5230\u5305\u542b\u8be5 <code>defer</code> \u8bed\u53e5\u7684\u51fd\u6570\u6267\u884c\u5b8c\u6bd5\uff0c\u65e0\u8bba\u662f\u6b63\u5e38\u8fd4\u56de\u8fd8\u662fpanic \u5f02\u5e38\u9000\u51fa\uff0c\u90fd\u4f1a\u88ab\u6267\u884c\u3002</p> <ul> <li>\u901a\u5e38\u7528\u4e8e\u8d44\u6e90\u91ca\u653e\u548c\u6e05\u7406\uff0c\u4fdd\u8bc1\u4e00\u5b9a\u6267\u884c\uff1b</li> <li>\u53c2\u6570\u503c\u7684\u5373\u65f6\u6c42\u503c\uff1a\u5f53 <code>defer</code> \u8bed\u53e5\u88ab\u6267\u884c\u65f6\uff0c\u4f20\u9012\u7ed9\u5b83\u7684\u51fd\u6570\u53c2\u6570\u4f1a\u88ab\u7acb\u5373\u6c42\u503c\uff0c\u5e76\u5b58\u50a8\u8d77\u6765\uff1b</li> </ul>"},{"location":"languages/go/go.html#map","title":"\u6620\u5c04Map","text":"<pre><code>m := map[int]int{1: 1, 2: 12, 3: 13}\nvalue, ok := m[1]\n</code></pre> <p><code>map[key]</code>\uff1a\u5982\u679ckey\u4e0d\u5b58\u5728\uff0c\u5219value\u4e3akey\u7684\u7c7b\u578b\u7684\u9ed8\u8ba4\u503c\uff0cok\u4e3afalse\uff1b</p>"},{"location":"languages/go/go.html#_11","title":"\u7ed3\u6784\u4f53","text":"<p>\u53ef\u4ee5\u76f4\u63a5\u5f15\u7528\u5b50\u7ed3\u6784\u4f53\u7684\u6210\u5458\u53d8\u91cf\uff1f</p> <p>Go\u4e2d\u6ca1\u6709\u7c7b\uff0c\u53ef\u4ee5\u5728\u7ed3\u6784\u4f53\u4e2d\u5b9a\u4e49\u65b9\u6cd5\uff0c\u65b9\u6cd5\u63a5\u6536\u8005 \u51fa\u73b0\u5728<code>func</code>\u5173\u952e\u5b57\u548c\u65b9\u6cd5\u540d\u4e4b\u95f4\u7684\u53c2\u6570\u4e2d\uff1a\u503c\u7c7b\u578b</p> <ol> <li>\u63a5\u6536\u8005\u4e3a\u6307\u9488\u65f6\uff0c\u4e00\u5c11\u62f7\u8d1d\u5f00\u9500\uff0c\u4e8c\u53ef\u4ee5\u4fee\u6539\u4f20\u8fdb\u53bb\u7684\u63a5\u6536\u8005\u6307\u5411\u7684\u503c\uff1b</li> </ol> <pre><code>type Dog struct {\n    X int\n}; \nfunc (v *Dog) Abs() int { return -v.X }\n// \u4f7f\u7528\n(&amp;Dog{1}).Abs()\n</code></pre>"},{"location":"languages/go/go.html#_12","title":"\u7ed3\u6784\u4f53\u5d4c\u5957\u548c\u533f\u540d\u6210\u5458","text":"<p>\u533f\u540d\u6210\u5458\uff1a\u5b9a\u4e49\u4e0d\u5e26\u540d\u79f0\u7684\u7ed3\u6784\u6210\u5458\uff0c\u53ea\u9700\u6307\u5b9a\u7c7b\u578b\uff0c\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u533f\u540d\u7684\u7ed3\u6784\u4f53\u7684\u6210\u5458\uff0c\u540c\u6837\u53ef\u4ee5\u8bbf\u95ee\u533f\u540d\u6210\u5458\u7684\u5185\u90e8\u65b9\u6cd5\uff1b</p> <ul> <li>\u533f\u540d\u6210\u5458\u5177\u6709\u9690\u5f0f\u7684\u540d\u5b57\uff0c\u56e0\u6b64\u4e0d\u80fd\u5728\u4e00\u4e2a\u7ed3\u6784\u4f53\u4e2d\u5b9a\u4e49\u4e24\u4e2a\u76f8\u540c\u7c7b\u578b\u7684\u533f\u540d\u6210\u5458\uff0c\u5426\u5219\u4f1a\u51b2\u7a81\uff1b</li> </ul> <pre><code>type Point struct {\n    X, Y int\n}\ntype Circle struct {\n    Point\n    Radius int\n}\nfunc (p *Point) addOne() {}\n\nvar c Circle\nc.X = 1 // \u76f4\u63a5\u8bbf\u95ee X\n(&amp;cc).addOne() // \u6216\u8005 c.addOne()\uff0c\u76f4\u63a5\u4f7f\u7528Point\u7684\u65b9\u6cd5\n</code></pre>"},{"location":"languages/go/go.html#_13","title":"\u63a5\u53e3","text":"<p>\u63a5\u53e3\uff1a\u662f\u6709\u4e00\u7ec4\u65b9\u6cd5\u5b9a\u4e49\u7684\u96c6\u5408\uff0c\u63a5\u53e3\u7c7b\u578b\u7684\u503c\u53ef\u4ee5\u5b58\u653e\u5b9e\u73b0\u8fd9\u4e9b\u65b9\u6cd5\u7684\u4efb\u4f55\u503c</p> <pre><code>type Abser interface {          \n    Abs() int\n}\nvar a Abser  // a\u53ef\u4ee5\u8d4b\u503c\u4e3a\u4efb\u610f\u5b9e\u73b0Abs() float64\u65b9\u6cd5\u7684\u7c7b\u578b\u503c\n// \u7c7b\u578b\u901a\u8fc7\u5b9e\u73b0\u65b9\u6cd5\u6765\u5b9e\u73b0\u63a5\u53e3\uff0c\u6ca1\u6709\u663e\u793a\u58f0\u660e\u5fc5\u8981\uff0c\u56e0\u6b64\u65e0\u9700\u5173\u952e\u5b57\"implements\"\u3002\na = &amp;Dog{2}  // a = Dog(2)\u662f\u9519\u7684\uff0c\u56e0\u4e3a\u6ca1\u6709\u5b9a\u4e49Dog\u7c7b\u578b\u7684Abs\u65b9\u6cd5\n// \u63a5\u53e3\u7c7b\u578b\u65ad\u8a00\uff1a \nvalue, ok := element.(T) // \u5c06element\u5f53\u4f5cT\u7c7b\u578b\uff0cvalue\u662f\u8f6c\u6362\u540e\u7ed3\u679c\uff0cok\u8868\u793a\u6210\u529f\u4e0e\u5426\uff0cnil\u8868\u793a\u6210\u529f\uff1b\n</code></pre>"},{"location":"languages/go/go.html#_14","title":"\u6a21\u5757\uff08\u5305\uff09","text":"<p>Golang1.11\u7248\u672c\u4e4b\u524d\u5982\u679c\u6211\u4eec\u8981\u81ea\u5b9a\u4e49\u5305\u7684\u8bdd\u5fc5\u987b\u628a\u9879\u76ee\u653e\u5728 GOPATH \u76ee\u5f55\u3002</p> <p>Go1.11\u7248\u672c\u4e4b\u540e\u65e0\u9700\u624b\u52a8\u914d\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u4f7f\u7528 go mod \u7ba1\u7406\u9879\u76ee\uff0c\u4e5f\u4e0d\u9700\u8981\u975e\u5f97\u628a\u9879\u76ee\u653e\u5230 GOPATH</p> <p>GO111MODULE \u6709\u4e09\u4e2a\u503c\uff1aoff, on\u548cauto\uff08\u9ed8\u8ba4\u503c\uff09\u3002</p> <ul> <li> <p>GO111MODULE=off\uff0c\u65e0\u6a21\u5757\u652f\u6301\uff0cgo\u547d\u4ee4\u884c\u5c06\u4e0d\u4f1a\u652f\u6301module\u529f\u80fd\uff0c\u5bfb\u627e\u4f9d\u8d56\u5305\u7684\u65b9\u5f0f\u5c06\u4f1a\u6cbf\u7528\u65e7\u7248\u672c\u90a3\u79cd\u901a\u8fc7vendor\u76ee\u5f55\u6216\u8005GOPATH\u6a21\u5f0f\u6765\u67e5\u627e</p> </li> <li> <p>GO111MODULE=on\uff0c\u6a21\u5757\u652f\u6301\uff0cgo\u547d\u4ee4\u884c\u4f1a\u4f7f\u7528modules\uff0c\u800c\u4e0d\u4f1a\u53bbGOPATH\u76ee\u5f55\u4e0b\u67e5\u627e\u3002</p> </li> <li> <p>GO111MODULE=auto\uff0c\u9ed8\u8ba4\u503c\uff0cgo\u547d\u4ee4\u884c\u5c06\u4f1a\u6839\u636e\u5f53\u524d\u76ee\u5f55\u6765\u51b3\u5b9a\u662f\u5426\u542f\u7528module\u529f\u80fd\u3002</p> </li> </ul> <p>\u8fd9\u79cd\u60c5\u51b5\u4e0b\u53ef\u4ee5\u5206\u4e3a\u4e24\u79cd\u60c5\u5f62\uff1a</p> <ul> <li>\u5f53\u524d\u76ee\u5f55\u5728GOPATH/src\u4e4b\u5916\u4e14\u8be5\u76ee\u5f55\u5305\u542bgo.mod\u6587\u4ef6\uff0c\u5f00\u542f\u6a21\u5757\u652f\u6301\u3002</li> <li>\u5f53\u524d\u6587\u4ef6\u5728\u5305\u542bgo.mod\u6587\u4ef6\u7684\u76ee\u5f55\u4e0b\u9762\u3002</li> </ul> <pre><code>go mod init demo\n\n# demo\u4e3a\u9879\u76ee\u6587\u4ef6\u5939,\u751f\u6210go.mod\u6587\u4ef6\u5982\u4e0b\uff1a\n#######\n# module demo\n# go 1.17\n#######\n</code></pre>"},{"location":"languages/go/go.html#init","title":"init\u51fd\u6570","text":"<ul> <li><code>init</code>\u51fd\u6570\u7528\u4e8e\u5305\u7684\u521d\u59cb\u5316\uff0c\u5982\u521d\u59cb\u5316\u5305\u4e2d\u7684\u53d8\u91cf\uff0c\u8fd9\u4e2a\u521d\u59cb\u5316\u5728<code>package xxx</code>\u7684\u65f6\u5019\u5b8c\u6210\uff0c\u4e5f\u5c31\u662f\u5728<code>main</code>\u4e4b\u524d\u5b8c\u6210\uff1b</li> <li>\u6bcf\u4e2a\u5305\u53ef\u4ee5\u62e5\u6709\u591a\u4e2a<code>init</code>\u51fd\u6570\uff0c \u6bcf\u4e2a\u5305\u7684\u6e90\u6587\u4ef6\u4e5f\u53ef\u4ee5\u62e5\u6709\u591a\u4e2a<code>init</code>\u51fd\u6570\uff1b</li> <li>\u540c\u4e00\u4e2a\u5305\u4e2d\u591a\u4e2a<code>init</code>\u51fd\u6570\u7684\u6267\u884c\u987a\u5e8f\u662f\u6ca1\u6709\u660e\u786e\u5b9a\u4e49\u7684\uff0c\u4f46\u662f\u4e0d\u540c\u5305\u7684<code>init</code>\u51fd\u6570\u662f\u6839\u636e\u5305\u5bfc\u5165\u7684\u4f9d\u8d56\u5173\u7cfb\u51b3\u5b9a\u7684\uff1b</li> <li><code>init</code>\u51fd\u6570\u4e0d\u80fd\u88ab\u5176\u4ed6\u51fd\u6570\u8c03\u7528\uff0c\u5176\u5b9e\u5728<code>main</code>\u51fd\u6570\u4e4b\u524d\u81ea\u52a8\u6267\u884c\u7684\u3002</li> </ul> <p>\u793a\u4f8b\uff1a\u5148\u6267\u884cinit\uff0c\u518d\u6267\u884cmain</p> <pre><code>package main \n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"do in main\")\n}\n\n\nfunc init() {\n    fmt.Println(\"do in init1\")\n}\n\nfunc init() {\n    fmt.Println(\"do in init2\")\n}  \n</code></pre>"},{"location":"languages/go/go.html#_15","title":"\u5f15\u7528","text":"<p><code>import _ \" \"</code></p> <p>\u4e0d\u5141\u8bb8\u5bfc\u5165\u4e0d\u4f7f\u7528\u7684\u5305\u3002\u4f46\u662f\u6709\u65f6\u5019\u6211\u4eec\u5bfc\u5165\u5305\u53ea\u662f\u4e3a\u4e86\u505a\u4e00\u4e9b\u521d\u59cb\u5316\u7684\u5de5\u4f5c\uff0c\u8fd9\u6837\u5c31\u5e94\u8be5\u91c7\u7528<code>import _ \" \"</code>\u7684\u5f62\u5f0f</p>"},{"location":"languages/go/go.html#_16","title":"\u53ef\u89c1\u6027","text":"<p>\u5728 Go \u4e2d\uff0c\u9996\u5b57\u6bcd\u5927\u5199\u7684\u540d\u79f0\u662f\u88ab\u5bfc\u51fa\u7684\uff0c\u5982<code>math.Pi</code>\uff1b\uff08\u9996\u5b57\u6bcd\u5927\u5199\u4ee3\u8868\u5bf9\u5916\u90e8\u53ef\u89c1\uff0c\u9996\u5b57\u6bcd\u5c0f\u5199\u4ee3\u8868\u5bf9\u5916\u90e8\u4e0d\u53ef\u89c1\uff0c\u9002\u7528\u4e8e\u6240\u6709\u5bf9\u8c61\uff0c\u5305\u62ec\u65b9\u6cd5\u548c\u6210\u5458\uff09</p> <p>\u53d8\u91cf\u7684\u53ef\u89c1\u6027\uff1a</p> <ul> <li>\u58f0\u660e\u5728\u51fd\u6570\u5185\u90e8\uff0c\u662f\u51fd\u6570\u7684\u672c\u5730\u503c\uff0c\u7c7b\u4f3c private\uff1b</li> <li>\u58f0\u660e\u5728\u51fd\u6570\u5916\u90e8\uff0c\u662f\u5bf9\u5f53\u524d\u5305\u53ef\u89c1\uff08\u5305\u5185\u6240\u6709.go\u6587\u4ef6\u90fd\u53ef\u89c1\uff09\u7684\u5168\u5c40\u503c\uff0c\u7c7b\u4f3cprotect\uff1b</li> <li>\u58f0\u660e\u5728\u51fd\u6570\u5916\u90e8\u4e14\u9996\u5b57\u6bcd\u5927\u5199\u662f\u6240\u6709\u5305\u53ef\u89c1\u7684\u5168\u5c40\u503c\uff0c\u7c7b\u4f3cpublic\uff1b</li> </ul> <p>\u51fd\u6570\u7684\u53ef\u89c1\u6027\uff1a</p> <ul> <li>\u5c0f\u5199\u5f00\u5934\uff0c\u5219\u5305\u5185\u53ef\u89c1\uff1b</li> <li>\u5927\u5199\u5f00\u5934\uff0c\u5219\u5168\u5c40\u53ef\u89c1\uff1b</li> </ul>"},{"location":"languages/go/go.html#_17","title":"\u9519\u8bef\u548c\u5f02\u5e38","text":"<p><code>error</code>\u7c7b\u578b\u8868\u793a\u9519\u8bef\uff0c\u503c\u4f4d<code>nil</code>\u8868\u793a\u6ca1\u6709\u9519\u8bef\uff1b</p> <p><code>panic</code>\u8868\u793a\u5f02\u5e38\uff0c\u53ef\u4ee5\u901a\u8fc7<code>recover</code>\u6062\u590d\uff1b</p> <p>golang\u63d0\u4f9b\u4e86 recover \u673a\u5236\u8fdb\u884c\u65ad\u70b9\u8c03\u8bd5</p> <pre><code>func A() { \n    defer func() { \n        if r := recover(); r != nil { \n            fmt.Println(\"Recovered in f\", r) // \u65ad\u70b9\u8bbe\u4e8e\u6b64\uff0c\u5f53\u53d1\u751ferror\u7684\u65f6\uff0cGoLand\u53ef\u4fdd\u5b58error\u53d1\u751f\u65f6\u7684\u73b0\u573a\n         } \n    } () \n    // \u6b63\u5e38\u7684\u51fd\u6570\u4ee3\u7801\u903b\u8f91\n}\n</code></pre>"},{"location":"languages/go/lint.html","title":"Tools","text":""},{"location":"languages/go/lint.html#golangci-lint","title":"golangci-lint","text":""},{"location":"languages/go/lint.html#_1","title":"\u5b89\u88c5","text":"<p>Releases \u00b7 golangci/golangci-lint (github.com)</p>"},{"location":"languages/go/lint.html#_2","title":"\u4f7f\u7528","text":"<pre><code>golangci-lint run \n</code></pre>"},{"location":"languages/go/lint.html#go-vet","title":"Go Vet","text":"<p>vet \u662f golang \u4e2d\u81ea\u5e26\u7684\u9759\u6001\u5206\u6790\u5de5\u5177\uff0c\u53ef\u4ee5\u8ba9\u6211\u4eec\u68c0\u67e5\u51fa package \u6216\u8005\u6e90\u7801\u6587\u4ef6\u4e2d\u4e00\u4e9b\u9690\u542b\u7684\u9519\u8bef\u3002</p> <p>go \u8fd8\u6709\u5f88\u591a\u8d28\u91cf\u5de5\u5177\uff0c\u6700\u5e38\u7528\u7684\u5c31\u662f go imports(\u6765\u68c0\u6d4b\u5f15\u7528\u5305\u7684\u95ee\u9898)\uff0cgofmt(\u4ee3\u7801\u683c\u5f0f\u95ee\u9898)\uff0cgolangci-lint(\u8bed\u6cd5\u68c0\u6d4b)</p>"},{"location":"languages/go/module.html","title":"Go \u7248\u672c\u7ba1\u7406","text":""},{"location":"languages/go/module.html#gopath","title":"GOPATH","text":"<p>Go 1.5 \u4e4b\u524d\uff0cGo \u6700\u539f\u59cb\u7684\u4f9d\u8d56\u7ba1\u7406\u4f7f\u7528\u7684\u662f go get\uff0c\u6267\u884c\u547d\u4ee4\u540e\u4f1a\u62c9\u53d6\u4ee3\u7801\u653e\u5165 <code>GOPATH/src</code></p> <ul> <li>\u65e0\u6cd5\u8fdb\u884c\u7248\u672c\u63a7\u5236\uff0c\u4f9d\u8d56\u51b2\u7a81\uff1b</li> </ul>"},{"location":"languages/go/module.html#go-vendor","title":"Go Vendor","text":"<p>Go 1.5 \u7248\u672c\u63a8\u51fa\u4e86 vendor \u673a\u5236\uff0c\u4ece Go1.6 \u8d77\uff0c\u9ed8\u8ba4\u5f00\u542f vendor \u673a\u5236\u3002</p> <ul> <li>\u6bcf\u4e2a\u9879\u76ee\u7684\u6839\u76ee\u5f55\u4e0b\u53ef\u4ee5\u6709\u4e00\u4e2a vendor \u76ee\u5f55\uff0c\u91cc\u9762\u5b58\u653e\u4e86\u8be5\u9879\u76ee\u7684\u4f9d\u8d56\u7684 package</li> </ul>"},{"location":"languages/go/module.html#go-module","title":"Go Module","text":"<p>Go 1.12 \u7248\u672c Go Modules \u6210\u4e3a\u9ed8\u8ba4\u7684\u4f9d\u8d56\u7ba1\u7406\u65b9\u5f0f</p> <ul> <li>go.mod \u6587\u4ef6\u5b9a\u4e49 module path \u548c\u4f9d\u8d56\u5e93\u7684\u7248\u672c</li> <li>go.sum \u7684\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u5305\u542b\u7279\u5b9a\u4f9d\u8d56\u5305\u7684\u7248\u672c\u5185\u5bb9\u7684\u6563\u5217\u54c8\u5e0c\u503c</li> </ul>"},{"location":"languages/go/module.html#_1","title":"\u793a\u4f8b","text":"<pre><code># \u5982\u679c\u4f60\u7684\u7248\u672c\u5df2\u7ecf &gt;=2.0.0\uff0c\u6309\u7167 Go \u7684\u89c4\u8303\uff0c\u4f60\u5e94\u8be5\u52a0\u4e0a major \u7684\u540e\u7f00\uff0c\u5982 \n# module xliu.sample.com/clientgo/v2\n# \u597d\u5904\u662f\u4e00\u4e2a\u9879\u76ee\u4e2d\u53ef\u4ee5\u4f7f\u7528\u4f9d\u8d56\u5e93\u7684\u4e0d\u540c\u7684 major \u7248\u672c\uff0c\u5b83\u4eec\u53ef\u4ee5\u5171\u5b58\nmodule xliu.sample.com/clientgo\n\n# \u4ee3\u7801\u6240\u9700\u8981\u7684 Go \u7684\u6700\u4f4e\u7248\u672c\ngo 1.18\n\n# \u9700\u8981\u7684\u5404\u4e2a\u4f9d\u8d56\u5e93\u4ee5\u53ca\u5b83\u4eec\u7684\u7248\u672c\nrequire (\n    k8s.io/apimachinery v0.24.17\n    k8s.io/client-go v0.24.17\n)\n\n# indirect \u6ce8\u91ca\uff0c\u95f4\u63a5\u7684\u4f7f\u7528\u4e86\u8fd9\u4e2a\u5e93\uff0c\u4f46\u662f\u53c8\u6ca1\u6709\u88ab\u5217\u5230\u67d0\u4e2a go.mod \nrequire (\n    github.com/PuerkitoBio/purell v1.1.1 // indirect\n    # \u4f2a\u7248\u672c\u53f7\uff0c\u56e0\u4e3a\u4f9d\u8d56\u5e93\u6ca1\u6709\u53d1\u5e03\u7248\u672c\n    github.com/PuerkitoBio/urlesc v0.0.0-20170810143723-de5bf2ad4578 // indirect\n    github.com/davecgh/go-spew v1.1.1 // indirect\n    github.com/emicklei/go-restful v2.9.5+incompatible // indirect\n    github.com/go-logr/logr v1.2.0 // indirect\n    github.com/go-openapi/jsonpointer v0.19.5 // indirect\n    github.com/go-openapi/jsonreference v0.19.5 // indirect\n    github.com/go-openapi/swag v0.19.14 // indirect\n    github.com/gogo/protobuf v1.3.2 // indirect\n    github.com/golang/protobuf v1.5.2 // indirect\n    github.com/google/gnostic v0.5.7-v3refs // indirect\n    github.com/google/gofuzz v1.1.0 // indirect\n    github.com/imdario/mergo v0.3.5 // indirect\n    github.com/josharian/intern v1.0.0 // indirect\n    github.com/json-iterator/go v1.1.12 // indirect\n    github.com/mailru/easyjson v0.7.6 // indirect\n    github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd // indirect\n    github.com/modern-go/reflect2 v1.0.2 // indirect\n    github.com/munnerz/goautoneg v0.0.0-20191010083416-a7dc8b61c822 // indirect\n    github.com/spf13/pflag v1.0.5 // indirect\n    golang.org/x/net v0.8.0 // indirect\n    golang.org/x/oauth2 v0.0.0-20211104180415-d3ed0bb246c8 // indirect\n    golang.org/x/sys v0.6.0 // indirect\n    golang.org/x/term v0.6.0 // indirect\n    golang.org/x/text v0.8.0 // indirect\n    golang.org/x/time v0.0.0-20220210224613-90d013bbcef8 // indirect\n    google.golang.org/appengine v1.6.7 // indirect\n    google.golang.org/protobuf v1.27.1 // indirect\n    gopkg.in/inf.v0 v0.9.1 // indirect\n    gopkg.in/tomb.v1 v1.0.0-20141024135613-dd632973f1e7 // indirect\n    gopkg.in/yaml.v2 v2.4.0 // indirect\n    gopkg.in/yaml.v3 v3.0.1 // indirect\n    k8s.io/api v0.24.17 // indirect\n    k8s.io/klog/v2 v2.60.1 // indirect\n    k8s.io/kube-openapi v0.0.0-20220328201542-3ee0da9b0b42 // indirect\n    k8s.io/utils v0.0.0-20220210201930-3a6ce19ff2f9 // indirect\n    sigs.k8s.io/json v0.0.0-20211208200746-9f7c6b3444d2 // indirect\n    sigs.k8s.io/structured-merge-diff/v4 v4.2.3 // indirect\n    sigs.k8s.io/yaml v1.2.0 // indirect\n)\n\n# replace \u53ef\u4ee5\u66ff\u6362\u67d0\u4e2a\u5e93\u7684\u6240\u6709\u7248\u672c\u5230\u53e6\u4e00\u4e2a\u5e93\u7684\u7279\u5b9a\u7248\u672c\uff0c\u4e5f\u53ef\u4ee5\u66ff\u6362\u67d0\u4e2a\u5e93\u7684\u7279\u5b9a\u7248\u672c\u5230\u53e6\u4e00\u4e2a\u5e93\u7684\u7279\u5b9a\u7248\u672c\u3002\n</code></pre>"},{"location":"languages/go/reflector.html","title":"Go \u4e2d\u53cd\u5c04","text":""},{"location":"languages/go/test.html","title":"Go Test","text":""},{"location":"languages/go/test.html#run","title":"Run","text":"<p><code>go run main.go</code></p> <ul> <li>go run main.go\u65f6\uff0c\u4e0d\u4f1a\u81ea\u52a8\u52a0\u8f7dmain.go\u540c\u7ea7\u76ee\u5f55\u4e0b\uff0c\u540c\u4e00\u4e2apackage\u4e0d\u540c\u6587\u4ef6</li> </ul> <p>\u4f46\u662f\uff0c\u5982\u679cmain.go\u6587\u4ef6\u91cc\u9762\u8c03\u7528\u4e86\uff0c\u540c\u7ea7\u76ee\u5f55\u4e0b(\u540c\u4e00\u4e2apackage\u4e0d\u540c\u6587\u4ef6)test.go\u6587\u4ef6\u7684\u51fd\u6570\uff0c\u5219\u9700\u8981\u901a\u8fc7\u4ee5\u4e0b\u8bed\u53e5\u8c03\u7528\uff1a</p> <ul> <li><code>go run .</code>    run\u4e4b\u540e\u7684\u70b9\uff0c\u4ee3\u8868\u5f53\u524d\u76ee\u5f55</li> <li><code>go run main.go test.go</code>   \u76f4\u63a5\u4f7f\u7528\u6587\u4ef6\u8def\u5f84\uff0c\u6765\u624b\u52a8\u52a0\u8f7d\u5f15\u5165\u6587\u4ef6</li> </ul>"},{"location":"languages/go/test.html#go-test_1","title":"\u539f\u751fGo Test","text":"<p>\u5728\u6d4b\u8bd5\u51fd\u6570\u4e2d\uff0c\u4f7f\u7528Error\uff0cFail\u6216\u8005\u76f8\u5173\u65b9\u6cd5\u6765\u8868\u793a\u6d4b\u8bd5\u5931\u8d25\u3002</p> <ul> <li> <p>\u6d4b\u8bd5\u6587\u4ef6\u4e0e\u6e90\u4ee3\u7801\u6587\u4ef6\u653e\u5728\u4e00\u5757\uff0c\u6d4b\u8bd5\u6587\u4ef6\u7684\u6587\u4ef6\u540d\u4ee5<code>_test.go</code>\u7ed3\u5c3e\u3002</p> </li> <li> <p>\u6d4b\u8bd5\u6587\u4ef6\u4e0d\u4f1a\u88ab\u6b63\u5e38\u7f16\u8bd1\uff0c\u53ea\u4f1a\u5728\u4f7f\u7528<code>go test</code>\u547d\u4ee4\u65f6\u7f16\u8bd1\u3002</p> </li> </ul> <p>\u6d4b\u8bd5\u7528\u4f8b\u6709\u56db\u79cd\u5f62\u5f0f\uff1a</p> <ul> <li>TestXxxx(t *testing.T) // \u57fa\u672c\u6d4b\u8bd5\u7528\u4f8b</li> <li>BenchmarkXxxx(b *testing.B) // \u538b\u529b\u6d4b\u8bd5\u7684\u6d4b\u8bd5\u7528\u4f8b</li> <li>Example_Xxx() // \u6d4b\u8bd5\u63a7\u5236\u53f0\u8f93\u51fa\u7684\u4f8b\u5b50</li> <li>TestMain(m *testing.M) // \u6d4b\u8bd5Main\u51fd\u6570</li> </ul>"},{"location":"languages/go/test.html#_1","title":"\u5b50\u6d4b\u8bd5","text":"<p><code>T</code>\u548c<code>B</code>\u7684<code>Run()</code>\u65b9\u6cd5\u53ef\u4ee5\u76f4\u63a5\u6267\u884c\u5b50\u529f\u80fd\u6d4b\u8bd5\u548c\u5b50\u6027\u80fd\u6d4b\u8bd5\uff0c\u800c\u4e0d\u7528\u4e3a\u6bcf\u4e00\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u5355\u72ec\u7f16\u5199\u4e00\u4e2a\u6d4b\u8bd5\u51fd\u6570\u3002\u8fd9\u6837\u4fbf\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3c\u4e8e\u8868\u9a71\u52a8\u57fa\u51c6\u6d4b\u8bd5\u548c\u521b\u5efa\u5206\u5c42\u6d4b\u8bd5\u3002\u8fd9\u79cd\u65b9\u6cd5\u4e5f\u63d0\u4f9b\u4e86\u4e00\u79cd\u65b9\u5f0f\u6765\u5904\u7406\u5171\u540c\u7684\u548c\u3002 <pre><code>func TestFoo(t *testing.T) {\n   // &lt;setup code&gt;\n   t.Run(\"A=1\", func(t *testing.T) { ... })\n   t.Run(\"A=2\", func(t *testing.T) { ... })\n   t.Run(\"B=1\", func(t *testing.T) { ... })\n   t.Run(\"A=1\", func(t *testing.T) { ... })\n   // &lt;tear-down code&gt;\n}\n</code></pre> <p>\u6bcf\u4e00\u4e2a\u5b50\u529f\u80fd\u6d4b\u8bd5\u548c\u5b50\u6027\u80fd\u6d4b\u8bd5\u90fd\u6709\u552f\u4e00\u7684\u540d\u5b57\uff1a\u9876\u5c42\u7684\u6d4b\u8bd5\u51fd\u6570\u7684\u540d\u5b57\u548c\u4f20\u5165<code>Run()</code>\u65b9\u6cd5\u7684\u5b57\u7b26\u4e32\u7528<code>/</code>\u8fde\u63a5\uff0c\u540e\u9762\u518d\u52a0\u4e0a\u4e00\u4e2a\u53ef\u9009\u7684\u7528\u4e8e\u6d88\u9664\u6b67\u4e49\u7684\u5b57\u7b26\u4e32\u3002\u4e0a\u9762\u7684\u56db\u4e2a\u5b50\u6d4b\u8bd5\u7684\u552f\u4e00\u540d\u5b57\u662f\uff1a</p> <ul> <li>TestFoo/A=1</li> <li>TestFoo/A=2</li> <li>TestFoo/B=1</li> <li>TestFoo/A=1#01</li> </ul> <p>\u547d\u4ee4\u884c\u4e2d\u7684<code>-run</code>\u53c2\u6570\u548c<code>-bench</code>\u53c2\u6570\u662f\u53ef\u9009\u7684\uff0c\u53ef\u7528\u6765\u5339\u914d\u6d4b\u8bd5\u7528\u4f8b\u7684\u540d\u5b57\u3002\u5bf9\u4e8e\u5305\u542b\u591a\u4e2a\u659c\u6760\u5206\u9694\u5143\u7d20\u7684\u6d4b\u8bd5\uff0c\u4f8b\u5982subtests\uff0c\u53c2\u6570\u672c\u8eab\u662f\u659c\u6760\u5206\u9694\u7684\uff0c\u8868\u8fbe\u5f0f\u4f9d\u6b21\u5339\u914d\u6bcf\u4e2aname\u5143\u7d20\u3002\u7531\u4e8e\u662f\u53ef\u9009\u53c2\u6570\uff0c\u56e0\u6b64\u7a7a\u8868\u8fbe\u5f0f\u5339\u914d\u6240\u6709\u7684\u5b57\u7b26\u4e32\u3002</p> <pre><code>go test -run ''      # Run all tests.\ngo test -run Foo     # Run top-level tests matching \"Foo\", such as \"TestFooBar\".\ngo test -run Foo/A=  # For top-level tests matching \"Foo\", run subtests matching \"A=\".\ngo test -run /A=1    # For all top-level tests, run subtests matching \"A=1\".\n</code></pre>"},{"location":"languages/go/test.html#_2","title":"\u8df3\u8fc7\u51fd\u6570","text":"<p>\u529f\u80fd\u6d4b\u8bd5\u6216\u6027\u80fd\u6d4b\u8bd5\u65f6\u53ef\u4ee5\u8df3\u8fc7\u4e00\u4e9b\u6d4b\u8bd5\u51fd\u6570\u3002</p> <pre><code>func TestTimeConsuming(t *testing.T) {\n   if testing.Short() {\n      t.Skip(\"skipping test in short mode.\")\n   }\n   ...\n}\n</code></pre>"},{"location":"languages/go/test.html#ginkgo","title":"Ginkgo","text":"<p>Ginkgo\u662f\u4e00\u4e2aBDD\u98ce\u683c\u7684Go\u6d4b\u8bd5\u6846\u67b6</p>"},{"location":"languages/go/packages/basic.html","title":"\u57fa\u7840\u5305","text":""},{"location":"languages/go/packages/basic.html#net","title":"net","text":""},{"location":"languages/go/packages/basic.html#pprof","title":"pprof","text":"<p>golang \u63d0\u4f9b\u7684 pprof \u5de5\u5177\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5206\u6790\u6027\u80fd\u4e0a\u7684\u95ee\u9898\u6bd4\u5982cpu\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u5806\u5185\u5b58\u5206\u914d\uff0cgoroutine \u6b7b\u9501\u60c5\u51b5\u7b49\u3002</p> <pre><code>mux := http.NewServeMux()\nmux.HandleFunc(\"/debug/pprof/\", pprof.Index)\nmux.HandleFunc(\"/debug/pprof/cmdline\", pprof.Cmdline)\nmux.HandleFunc(\"/debug/pprof/profile\", pprof.Profile)\nmux.HandleFunc(\"/debug/pprof/symbol\", pprof.Symbol)\nmux.HandleFunc(\"/debug/pprof/trace\", pprof.Trace)\n\npprofServer := http.Server{\n    Addr:    pprofAddr,\n    Handler: mux,\n}\nsetupLog.Info(\"Starting pprof HTTP server\", \"pprof server address\", pprofServer.Addr)\n\ngo func() {\n    go func() {\n        ctx := context.Background()\n        &lt;-ctx.Done()\n\n        ctx, cancelFunc := context.WithTimeout(context.Background(), 60*time.Minute)\n        defer cancelFunc()\n\n        if err := pprofServer.Shutdown(ctx); err != nil {\n            setupLog.Error(err, \"Failed to shutdown debug HTTP server\")\n        }\n    }()\n\n    if err := pprofServer.ListenAndServe(); !errors.Is(http.ErrServerClosed, err) {\n        setupLog.Error(err, \"Failed to start debug HTTP server\")\n        panic(err)\n    }\n}()\n</code></pre>"},{"location":"languages/go/packages/basic.html#json","title":"json","text":"<p>json\u5305\u662f\u901a\u8fc7\u53cd\u5c04\u673a\u5236\u6765\u5b9e\u73b0\u7f16\u89e3\u7801\u7684\uff0c\u56e0\u6b64\u7ed3\u6784\u4f53\u5fc5\u987b\u5bfc\u51fa\u6240\u8f6c\u6362\u7684\u5b57\u6bb5\uff0c\u4e0d\u5bfc\u51fa\u7684\u5b57\u6bb5\u4e0d\u4f1a\u88abjson\u5305\u89e3\u6790\u3002</p> <pre><code>type DebugInfo struct {\n   Level  string `json:\"level,omitempty\"` // Level\u89e3\u6790\u4e3alevel,\u5ffd\u7565\u7a7a\u503c\n   Msg    string `json:\"message\"`     // Msg\u89e3\u6790\u4e3amessage\n   Author string `json:\"-\"`        // \u5ffd\u7565Author\n}\n</code></pre>"},{"location":"languages/go/packages/basic.html#log","title":"log","text":""},{"location":"languages/go/packages/basic.html#zap-logging","title":"Zap logging","text":"<p>zap\u662fuber\u5f00\u6e90\u7684\u4e00\u6b3e\u9ad8\u6027\u80fd\u65e5\u5fd7\u7ec4\u4ef6\u6846\u67b6</p>"},{"location":"languages/go/packages/basic.html#githubcomgolangglog","title":"github.com/golang/glog","text":""},{"location":"languages/go/packages/basic.html#githubcomgo-logrlogr","title":"github.com/go-logr/logr","text":"<p>A simple logging interface for Go</p> <p>Log \u95e8\u9762\u5b9e\u73b0\uff08\u7c7b\u4f3cslf4j\uff09</p> <pre><code>log.V(1).Info(\"job count\", \"active jobs\", len(activeJobs), \"successful jobs\", len(successfulJobs), \"failed jobs\", len(failedJobs))\n</code></pre>"},{"location":"languages/go/packages/basic.html#githubcomgo-logrglogr","title":"github.com/go-logr/glogr","text":"<p>An implementation of logr (Go logging) with glog</p>"},{"location":"languages/go/packages/basic.html#githubcomgo-logrzapr","title":"github.com/go-logr/zapr","text":"<p>A logr implementation using Zap</p> <p>\u4f7f\u7528</p> <pre><code>import (\n    \"fmt\"\n\n    \"go.uber.org/zap\"\n    \"github.com/go-logr/logr\"\n    \"github.com/go-logr/zapr\"\n)\n\nfunc main() {\n    var log logr.Logger\n\n    zapLog, err := zap.NewDevelopment()\n    if err != nil {\n        panic(fmt.Sprintf(\"who watches the watchmen (%v)?\", err))\n    }\n    log = zapr.NewLogger(zapLog)\n\n    log.Info(\"Logr in action!\", \"the answer\", 42)\n}\n</code></pre>"},{"location":"languages/go/packages/basic.html#clicobra","title":"CLI\uff08Cobra\uff09","text":"<p>CLI\uff1aA Commander for modern Go CLI interactions</p> <ul> <li>Easy subcommand-based CLIs: <code>app server</code>, <code>app fetch</code>, etc.</li> <li>Fully POSIX-compliant flags (including short &amp; long versions)</li> <li>Nested subcommands</li> <li>Global, local and cascading flags</li> <li>Easy generation of applications &amp; commands with <code>cobra init</code> &amp; <code>cobra add cmdname</code></li> <li>Intelligent suggestions (<code>app srver</code>... did you mean <code>app server</code>?)</li> <li>Automatic help generation for commands and flags</li> <li>Automatic help flag recognition of <code>-h</code>, <code>--help</code>, etc.</li> <li>Automatically generated shell autocomplete for your application (bash, zsh, fish, powershell)</li> <li>Automatically generated man pages for your application</li> <li>Command aliases so you can change things without breaking them</li> <li>The flexibility to define your own help, usage, etc.</li> <li>Optional seamless integration with viper for 12-factor apps</li> </ul>"},{"location":"languages/go/packages/basic.html#_2","title":"\u539f\u7406","text":"<p>Commands represent actions</p> <p>Args are things </p> <p>Flags are modifiers for those actions.</p> <pre><code># server is a command, and port is a flag\n$ hugo server --port=1313\n</code></pre>"},{"location":"languages/go/packages/basic.html#demo","title":"demo","text":"<pre><code>import ( \"github.com/spf13/cobra\" )\nvar (\n    short                bool\n    metricsAddr          string\n    enableLeaderElection bool\n    development          bool\n    pprofAddr            string\n)\nvar cmd = &amp;cobra.Command{\n    Use:   \"dataset-controller\",\n    Short: \"controller for dataset\",\n}\nvar startCmd = &amp;cobra.Command{\n    Use:   \"start\",\n    Short: \"start dataset-controller in Kubernetes\",\n    Run: func(cmd *cobra.Command, args []string) {\n        handle()\n    }\n}\n\nfunc init() {\n    startCmd.Flags().StringVarP(&amp;metricsAddr, \"metrics-addr\", \"\", \":8080\", \"The address the metric endpoint binds to.\")\n    startCmd.Flags().BoolVarP(&amp;enableLeaderElection, \"enable-leader-election\", \"\", false, \"Enable leader election for controller manager. Enabling this will ensure there is only one active controller manager.\")\n    startCmd.Flags().BoolVarP(&amp;development, \"development\", \"\", true, \"Enable development mode for fluid controller.\")\n    startCmd.Flags().StringVarP(&amp;pprofAddr, \"pprof-addr\", \"\", \"\", \"The address for pprof to use while exporting profiling results\")\n    cmd.AddCommand(startCmd)\n}\n\nfunc main() {\n    if err := cmd.Execute(); err != nil {\n        fmt.Fprintf(os.Stderr, \"%s\", err.Error())\n        os.Exit(1)\n    }\n}\n</code></pre>"},{"location":"languages/go/packages/basic.html#template","title":"Template","text":"<p>https://golang.google.cn/pkg/text/template/</p> <p>\u6a21\u677f\u5f15\u64ce</p>"},{"location":"languages/go/packages/basic.html#viper","title":"viper\uff08\u914d\u7f6e\u8bfb\u5199\uff09","text":"<p><code>go get github.com/spf13/viper</code></p>"},{"location":"languages/go/packages/basic.html#_3","title":"\u8bfb","text":"<pre><code>viper.SetConfigName(\"config\") // name of config file (without extension)\nviper.SetConfigType(\"yaml\") // REQUIRED if the config file does not have the extension in the name\nviper.AddConfigPath(\"/etc/appname/\")   // path to look for the config file in\nviper.AddConfigPath(\"$HOME/.appname\")  // call multiple times to add many search paths\nviper.AddConfigPath(\".\")               // optionally look for config in the working directory\nerr := viper.ReadInConfig() // Find and read the config file\nif err != nil { // Handle errors reading the config file\n    panic(fmt.Errorf(\"fatal error config file: %w\", err))\n}\n</code></pre>"},{"location":"languages/go/packages/grpc.html","title":"Grpc","text":""},{"location":"languages/go/packages/grpc.html#todo-github","title":"\u793a\u4f8b(TODO\uff0c\u7ed9\u51fa github \u94fe\u63a5)","text":"<p><code>product.proto</code></p> <pre><code>syntax = 'proto3'\npackage ecommerce.v1;\n\nmessage ProductID {\n    string value = 1;\n}\nmessage Product {\n    string id = 1;\n    string name = 2;\n    string description = 3;\n    float price = 4;\n}\n\nservice ProductInfo {\n    rpc addProduct(Product) returns (ProductID);\n    rpc getProduct(ProductID) returns (Product);\n}\n</code></pre> <p><code>go.mod</code></p> <pre><code>module productinfo/service\n\nrequire (\n    github.com/golang/protobuf v1.3.2\n    google.golang.org/grpc v1.24.0\n)\n</code></pre> <p>\u5b89\u88c5\u7f16\u8bd1\u63d2\u4ef6</p> <pre><code>go get -u google.golang.org/grpc\ngo get - github.com/golang/protobuf/protoc-gen-go\n\nprotoc -I ecommerce ecommerce/product.proto --go_out=plugins=grpc:&lt;module_dir_path&gt;/ecommerce\n</code></pre> <p>grpc \u670d\u52a1\u7aef</p> <pre><code>func main() {\n    lis, err = net.Listen(\"tcp\", port)\n    ...\n}\n</code></pre> <pre><code>go build -i -v -o bin/server\n</code></pre>"},{"location":"languages/go/packages/unix.html","title":"Unix","text":""},{"location":"languages/go/packages/unix.html#_1","title":"\u5185\u5b58\u5171\u4eab","text":"<p><code>golang.org/x/sys/unix</code> \u63d0\u4f9b\u4e86 unix \u5e95\u5c42 API\uff0c\u4e0b\u9762\u4ee5\u8fd9\u4e2a\u5e93\u5c55\u793a\u4f7f\u7528 mmap \u5171\u4eab\u5185\u5b58\u3002</p> <p></p>"},{"location":"languages/go/packages/unix.html#mmap","title":"mmap","text":"<p><code>unix</code> \u63d0\u4f9b\u4e86 <code>Mmap/Munmap</code> \u65b9\u6cd5\uff0c\u5bf9\u67d0\u4e2a\u6587\u4ef6\u8fdb\u884c\u6620\u5c04</p> <pre><code>func AttachShmWithMmap(f *os.File, offset int64, length int, prot int, flags int) (ShardData, error) {\n data, err := unix.Mmap(int(f.Fd()), offset, length, prot, flags)\n if err != nil {\n  return ShardData{}, err\n }\n return ShardData{data: data}, nil\n}\n\nfunc DetachShmWithMmap(data ShardData) error {\n return unix.Munmap(data.data)\n}\n\nf, err := os.OpenFile(\"./block\", os.O_RDWR, 0666)\nif err != nil {\n panic(err)\n}\ndefer f.Close()\n\ninitData := make([]byte, 1024)\nif _, err = f.Write(initData); err != nil {\n panic(err)\n}\n\ndata, err := AttachShmWithMmap(f, 0, 1024, unix.PROT_WRITE|unix.PROT_READ, unix.MAP_SHARED)\nif err != nil {\n panic(err)\n}\ndefer DetachShmWithMmap(data)\n</code></pre>"},{"location":"languages/go/packages/unix.html#sysv","title":"SysV","text":"<p>\u57fa\u4e8e tmpfs</p> <p>SysV \u4e3a\u6bcf\u4e00\u5757\u5185\u5b58\u8bbe\u5b9a\u4ee5\u4e00\u4e2a\u552f\u4e00\u7684 int \u7c7b\u578b key\uff0c\u53ef\u4ee5\u4f7f\u7528\u76f8\u540c\u7684 Key \u83b7\u53d6\u540c\u4e00\u4e2a\u5185\u5b58\u6bb5\u3002\u53ea\u8981\u4e24\u4e2a\u7a0b\u5e8f\u4f7f\u7528\u4e86\u76f8\u540c key\uff0c\u4fbf\u53ef\u4ee5\u5b9e\u73b0\u5185\u5b58\u6bb5\u7684\u5171\u4eab\u3002</p> <p>SysV \u7684\u4e3b\u8981 Api \u662f\u56db\u4e2a\u51fd\u6570\uff1a</p> <ol> <li><code>shmget</code>\uff1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5171\u4eab\u5185\u5b58\u5916\uff0c\u4e5f\u53ef\u7528\u4e8e\u6253\u5f00\u4e00\u4e2a\u5df2\u5b58\u5728\u7684\u5171\u4eab\u5185\u5b58</li> <li><code>shmat</code>\uff1a\u4f7f\u7528\u524d\uff0c\u9644\u52a0\uff08attach\uff09\u5185\u5b58\u5230\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\u4e2d</li> <li><code>shmdt</code>\uff1a\u4f7f\u7528\u540e\uff0c\u4f7f\u5171\u4eab\u5185\u5b58\u533a\u57df\u4e0e\u8be5\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\u5206\u79bb\uff08detach\uff09</li> <li><code>shmctl</code>\uff1a\u5171\u4eab\u5185\u5b58\u63a7\u5236\uff08\u52a0\u9501\u3001\u5220\u9664\u7b49\uff09</li> </ol> <pre><code>func AttachShmWithSysV(key, size, flag int) (ShardData, error) {\n id, err := unix.SysvShmGet(key, size, flag)\n if err != nil {\n  return ShardData{}, err\n }\n\n data, err := unix.SysvShmAttach(id, 0, 0)\n if err != nil {\n  return ShardData{}, err\n }\n\n return ShardData{id: id, data: data}, nil\n}\n\nfunc DetachShmWithSysV(data ShardData) error {\n if err := unix.SysvShmDetach(data.data); err != nil {\n  return err\n }\n\n _, err := unix.SysvShmCtl(data.id, unix.IPC_RMID, nil)\n if err != nil {\n  return err\n }\n return nil\n}\n</code></pre>"},{"location":"languages/go/packages/unix.html#posix","title":"POSIX","text":"<p>POSIX \u5171\u4eab\u5185\u5b58\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u4e5f\u662f\u4e3a\u4e86\u5f25\u8865\u4e0a\u8ff0\u4e24\u79cd\u5171\u4eab\u5185\u5b58\u7684\u4e0d\u8db3\uff1a</p> <ol> <li>SysV \u4f7f\u7528\u4e86\u4e00\u4e2a\u9ed1\u76d2\u7684\uff08\u4e0d\u53ef\u89c1\u7684 tmpfs\uff09\u7684\u552f\u4e00 key\uff0c\u8fd9\u70b9\u548c\u57fa\u4e8e\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684 Unix IO \u6a21\u578b\u4e0d\u7b26</li> <li>mmap \u867d\u7136\u65b9\u4fbf\uff0c\u4f46\u662f\u5374\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u591a\u8fdb\u7a0b\u5171\u4eab\u7684\u6587\u4ef6\uff0c\u5982\u679c\u5171\u4eab\u7684\u5185\u5bb9\u65e0\u6301\u4e45\u5316\u9700\u6c42\uff0c\u8fd9\u767d\u767d\u6d6a\u8d39\u4e86 IO \u8d44\u6e90</li> </ol> <p>POSIX \u901a\u8fc7\u6298\u4e2d\u7684\u65b9\u5f0f\u8fdb\u884c\u89e3\u51b3\uff0c\u5c31\u662f\u4f7f\u7528\u6302\u8f7d\u4e8e <code>/dev/shm</code> \u76ee\u5f55\u4e0b\u7684\u4e13\u7528 tmpfs \u6587\u4ef6\u7cfb\u7edf\uff08\u4e0d\u518d\u4e0d\u53ef\u89c1\uff09\uff0c\u800c\u4e14\u4f7f\u7528\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5229\u7528 <code>mmap</code> \u5bf9\u5185\u5b58\u8fdb\u884c\u6620\u5c04\uff08\u6216\u8bf4 attach\uff09\u3002</p> <p>golang \u5b98\u65b9\u5e93\u63d0\u4f9b\u7684 POSIX \u5171\u4eab\u5185\u5b58\u63a5\u53e3\uff0c\u4f46\u7531\u4e8e POSIX \u5171\u4eab\u5185\u5b58\u7684\u5b9e\u73b0\u975e\u5e38\u76f4\u767d\uff0c\u76f4\u63a5\u5728 <code>/dev/shm/</code> \u76ee\u5f55\u4e0b\u521b\u5efa\u6587\u4ef6\uff0c\u4f7f\u7528 <code>mmap</code> \u6620\u5c04\uff0c\u5c31\u53ef\u4ee5\u4f7f go \u7a0b\u5e8f\u4f7f\u7528 POSIX \u5171\u4eab\u5185\u5b58\u3002</p>"},{"location":"languages/java/packages/apache_commons.html","title":"Apache commons","text":"<p>[toc]</p>"},{"location":"languages/java/packages/apache_commons.html#apache-commons","title":"Apache Commons","text":"<p>2021/10</p>"},{"location":"languages/java/packages/apache_commons.html#_1","title":"\u5e38\u7528\u7684","text":""},{"location":"languages/java/packages/apache_commons.html#collections","title":"Collections","text":"<p>ArrayUtils, StringUtils \u7b49\u5de5\u5177\u7c7b</p>"},{"location":"languages/java/packages/apache_commons.html#configuration","title":"Configuration","text":"<p>properties\u914d\u7f6e\u9ad8\u7ea7\u8bfb\u53d6\u65b9\u6cd5\uff08\u8bfb\u53d6\u6210List\u6216\u8005Array\u7b49\uff09\uff1a</p> <pre><code>FileBasedConfigurationBuilder&lt;PropertiesConfiguration&gt; builder = new FileBasedConfigurationBuilder&lt;&gt;(PropertiesConfiguration.class).configure(new Parameters().properties().setFileName(\"conf/conf.properties\").setListDelimiterHandler(new DefaultListDelimiterHandler(',')));\n</code></pre>"},{"location":"languages/java/packages/apache_commons.html#io","title":"IO","text":"<p>FileUtils\uff1adeleteDirectory\uff0ccontentEquals\uff0ccontentEqualsIgnoreEOL\uff0cisFileNewer\uff0cisFileOlder\uff0ccopyFileToDirectory</p>"},{"location":"languages/java/packages/apache_commons.html#lang","title":"Lang","text":"<p>Pair, Triple\u7c7b</p>"},{"location":"languages/java/packages/apache_commons.html#proper","title":"Proper","text":"Component Description Release Date BCEL Byte Code Engineering Library - analyze, create, and manipulate Java class files 2020-06-10 BeanUtils Easy-to-use wrappers around the Java reflection and introspection APIs. 2019-08-13 BSF Bean Scripting Framework - interface to scripting languages, including JSR-223 2010-06-24 ~~Chain~~ ~~Chain of Responsibility pattern implemention.~~ 2010 -04-12 CLI Command Line arguments parser. 2017-03-09 Codec General encoding/decoding algorithms (for example phonetic, base64, URL). 2020-09-01 Collections Extends or augments the Java Collections Framework. 2019-07-08 Compress Defines an API for working with tar, zip and bzip2 files. 2020-02-08 Configuration Reading of configuration/preferences files in various formats. 2020-03-11 Crypto A cryptographic library optimized with AES-NI wrapping Openssl or JCE algorithm implementations. 2020-09-02 CSV Component for reading and writing comma separated value files. 2020-02-06 Daemon Alternative invocation mechanism for unix-daemon-like java code. 2019-09-30 DBCP Database connection pooling services. 2020-09-25 DbUtils JDBC helper library. 2017-07-20 Digester XML-to-Java-object mapping utility. 2011-12-13 Email Library for sending e-mail from Java. 2017-08-01 ~~Exec~~ ~~API for dealing with external process execution and environment management in Java.~~ 2014-11-06 FileUpload File upload capability for your servlets and web applications. 2019-01-16 ~~Functor~~ ~~A functor is a function that can be manipulated as an object, or an object representing a single, generic function.~~ 2014-02-17 Geometry Space and coordinates. 2020-07-19 Imaging (previously called Sanselan) A pure-Java image library. 2019-05-02 IO Collection of I/O utilities. 2020-09-10 ~~JCI~~ ~~Java Compiler Interface~~ 2013-10-14 JCS Java Caching System 2020-08-16 Jelly XML based scripting and processing engine. 2017-09-27 Jexl Expression language which extends the Expression Language of the JSTL. 2017-04-14 JXPath Utilities for manipulating Java Beans using the XPath syntax. 2008-08-14 Lang Provides extra functionality for classes in java.lang. 2021-03-01 Logging Wrapper around a variety of logging API implementations. 2014-07-11 Math Lightweight, self-contained mathematics and statistics components. 2015-04-17 Net Collection of network utilities and protocol implementations. 2021-02-19 Numbers Number types (complex, quaternion, fraction) and utilities (arrays, combinatorics). 2020-04-08 OGNL An Object-Graph Navigation Language 2013-??-?? Pool Generic object pooling component. 2020-09-29 Proxy Library for creating dynamic proxies. 2008-02-28 RDF Common implementation of RDF 1.1 that could be implemented by systems on the JVM. 2017-12-07 RNG Implementations of random numbers generators. 2019-11-11 SCXML An implementation of the State Chart XML specification aimed at creating and maintaining a Java SCXML engine. It is capable of executing a state machine defined using a SCXML document, and abstracts out the environment interfaces. 2008-12-01 Statistics Statistics. ????-??-?? Text Apache Commons Text is a library focused on algorithms working on strings. 2019-07-25 Validator Framework to define validators and validation rules in an xml file. 2020-08-07 VFS Virtual File System component for treating files, FTP, SMB, ZIP and such like as a single logical file system. 2021-03-10 Weaver Provides an easy way to enhance (weave) compiled bytecode. 2018-09-07"},{"location":"languages/java/packages/apache_commons.html#sandbox","title":"Sandbox\uff08\u6b63\u5728\u5f00\u53d1\u7684\u9879\u76ee\uff09","text":"\u6a21\u5757 \u529f\u80fd BeanUtils2 Redesign of Commons BeanUtils. ClassScan Find Class interfaces, methods, fields, and annotations without loading. CLI2 Redesign of Commons CLI. Convert Commons-Convert aims to provide a single library dedicated to the task of converting an object of one type to another. Finder Java library inspired by the UNIX find command. Flatfile Java library for working with flat data structures. Graph A general purpose Graph APIs and algorithms. I18n Adds the feature of localized message bundles that consist of one or many localized texts that belong together. Think of an error message that consists of title, text, summary and error details. Id Id is a component used to generate identifiers. Inject Implementation of JSR 330, a standards compliant dependency injection framework Javaflow Continuation implementation to capture the state of the application. JNet JNet allows to use dynamically register url stream handlers through the java.net API. Monitoring Monitoring aims to provide a simple but extensible monitoring solution for Java applications. Nabla Nabla provides automatic differentiation classes that can generate derivative of any function implemented in the Java language. OpenPGP Interface to signing and verifying data using OpenPGP. Performance A small framework for microbenchmark clients, with implementations for Commons DBCP and Pool. Pipeline Provides a set of pipeline utilities designed around work queues that run in parallel to sequentially process data objects data objects."},{"location":"languages/java/packages/apache_commons.html#dormant","title":"Dormant\uff08\u521a\u542f\u52a8\u6216\u8005\u5df2\u7ecf\u505c\u6b62\u7ef4\u62a4\u7684\u9879\u76ee\uff09","text":"\u6a21\u5757 \u63cf\u8ff0 Attributes Runtime API to metadata attributes such as doclet tags. Betwixt Services for mapping JavaBeans to XML documents, and vice versa. Cache Cache provides object caching services. Clazz Clazz focuses on introspection and class manipulation. Contract This component makes all the nice features available to the java programming language that come along with contract based programming. Convert Commons-Convert aims to provide a single library dedicated to the task of converting an object of one type to another. EL Interpreter for the Expression Language defined by the JSP 2.0 specification. Discovery Tools for locating resources by mapping service/reference names to resource names. Events Commons-Events provides additional classes for firing and handling events. It focusses on the Java Collections Framework, providing decorators to other collections that fire events. Feedparser A Java RSS/Atom parser designed to elegantly support all versions of RSS (0.9, 0.91, 0.92, 1.0, and 2.0), Atom 0.5 (and future versions) as well as easy ad hoc extension and RSS 1.0 modules capability. JJar Jakarta JAR Archive Repository Launcher Cross platform Java application launcher. Latka Commons-Latka is an HTTP functional testing suite for automated QA, acceptance and regression testing. Mapper Mapper is a thin abstraction layer around a project's chosen data mapping technology (a.k.a. DAO pattern). Messenger Messenger is an easy to use and lightweight framework for working with JMS in the web tier. Modeler Mechanisms to create Model MBeans compatible with JMX specification. Primitives Smaller, faster and easier to work with types supporting Java primitive types. Resources Resources provides a lightweight framework for defining and looking up internationalized message strings keyed by a java.util.Locale and a message key. Scaffold Scaffold is a toolkit for building web applications. ThreadPool ThreadPool is a simple component for asynchronously dispatching work to another thread in a pool for simple multi threaded programming. Transaction Implementations for multi level locks, transactional collections and transactional file access. Workflow Workflow provides a framework for building workflow management systems. XMLIO Simple and fast importer for XML configuration or import files."},{"location":"languages/java/packages/blas.html","title":"Blas","text":"<p>Java Blas\u5e93\uff1a</p> <ul> <li>jblas is based on BLAS and LAPACK\uff1b</li> <li>Apache Commons Math for the most popular mathematics library in Java (not using netlib-java\uff09\uff1b</li> <li>Breeze for high performance linear algebra in Scala and Spark (builds on top of netlib-java 1.1.2)\uff1b</li> </ul> <p>\u514d\u8d39\u7248\u4e0d\u518d\u63d0\u4f9b\uff1a</p> <ul> <li> <p>Matrix Toolkits for Java for high performance linear algebra in Java (builds on top of netlib-java)\uff1b</p> </li> <li> <p>netlib-java is a wrapper for low-level BLAS, LAPACK and ARPACK\uff08\u4e0d\u518d\u5f00\u53d1\u514d\u8d39\u7248\uff09\uff1b</p> </li> </ul> <p>\u5e95\u5c42\u5e93\u5b89\u88c5\uff1a</p> <ul> <li> <p>yum install atlas</p> </li> <li> <p>yum install lapack</p> </li> </ul> <p>scala\u4f7f\u7528demo </p> <pre><code>import breeze.linalg.DenseMatrix  \nval m = DenseMatrix.rand(100, 100)  \nval res = m * m  \n</code></pre> <p>scala -cp spark-assembly-1.4.0-hadoop2.6.0.jar</p> <p>\u770b\u5230\u6709\u7c7b\u4f3c\u4e00\u4e0b\u4fe1\u606f\u8f93\u51fa\u5219\u8868\u660eblas\u5b89\u88c5\u5e76\u8c03\u7528\u6210\u529f\uff1a</p> <p>Dec 03, 2015 12:59:42 AM com.github.fommil.jni.JniLoader liberalLoad</p> <p>INFO: successfully loaded /tmp/jniloader4368196623437279381netlib-native_system-linux-i686.so</p>"},{"location":"languages/java/packages/dataformat_json.html","title":"JSON Processor","text":"<p>scala\u548cJava\u8bfb\u53d6json\u6587\u4ef6\uff0c\u4f7f\u7528Jackson\u5305\uff1b</p>"},{"location":"languages/java/packages/dataformat_json.html#fasterxml-jackson","title":"FasterXML Jackson","text":"<p>github\u5730\u5740\uff1ahttps://github.com/FasterXML/jackson</p> <p>\u4e00\u822c\u4f1a\u76f4\u63a5\u4f7f\u7528data-bind\uff0c\u5c06JSON\u4e0eJava\u5bf9\u8c61\u8fdb\u884c\u8f6c\u6362\uff0chttps://github.com/FasterXML/jackson-databind</p> <p>Maven\u5730\u5740</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;\n    &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;\n    &lt;version&gt;${jackson.version.core}&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"languages/java/packages/dataformat_json.html#_1","title":"\u652f\u6301\u7684\u6570\u636e\u683c\u5f0f","text":"<p>text\uff1aJSON, CSV, Java Properties, YAML, XML</p> <p>binary\uff1aAvro, BSON(binary json), CBOR, Smile, Protobuf, </p> <pre><code>&lt;!-- \u6570\u636e\u683c\u5f0f\u7684jar\u5305\u5f15\u5165 --&gt;\n&lt;dependency&gt;\n  &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;\n  &lt;artifactId&gt;jackson-dataformat-yaml&lt;/artifactId&gt;\n  &lt;version&gt;2.9.2&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"languages/java/packages/dataformat_json.html#_2","title":"\u4f7f\u7528","text":"<pre><code>ObjectMapper mapper = new ObjectMapper(new YAMLFactory());  // different factory\nUser user = mapper.readValue(yamlSource, User.class);\n// \u5e26\u6cdb\u578b\u7684\u53cd\u5e8f\u5217\u5316\nResult&lt;List&lt;AfsStatus&gt;&gt;&gt; tmp = mapper.readValue(yamlSource, new TypeReference&lt;Result&lt;List&lt;AfsStatus&gt;&gt;&gt;() {});\n// \u6216\u8005\nYAMLFactory factory = new YAMLFactory();\nYAMLParser parser = factory.createParser(yamlString);\nwhile (parser.nextToken() != null) {\n  // do something!\n}\n</code></pre>"},{"location":"languages/java/packages/dataformat_json.html#projects","title":"Projects","text":""},{"location":"languages/java/packages/dataformat_json.html#core-modules","title":"Core Modules","text":"<ul> <li> <p>Streaming(\"jackson-core\"): \u5b9a\u4e49\u5e95\u5c42\u7684streaming API\uff0c\u5305\u542bJSON\u7684\u5b9e\u73b0\uff1b</p> </li> <li> <p>Annotations(\"jackson-annotations\"): \u6807\u51c6\u7684Jackson\u6ce8\u89e3\uff1b</p> </li> <li> <p>Databind(\"jackson-databind\")\uff1a\u5b9e\u73b0data-binding\u548c\u5bf9\u8c61\u5e8f\u5217\u5316\uff0c\u57fa\u4e8e\u4e0a\u9762\u4e24\u4e2a\u5305\u5b9e\u73b0\uff1b</p> </li> </ul>"},{"location":"languages/java/packages/dataformat_json.html#else","title":"Else","text":"<ul> <li>JVM\u8bed\u8a00\uff1aKotlin \u5305\uff0cScala \u5305\uff1b</li> <li>\u6570\u636e\u683c\u5f0f\uff1a\u89c1\u652f\u6301\u7684\u6570\u636e\u683c\u5f0f\uff1b</li> <li>\u6570\u636e\u7c7b\u578b\uff1a\u652f\u6301\u5e38\u7528\u7684\uff0c\u6807\u51c6\u7684\u6570\u636e\u7c7b\u578b\u7684\u6620\u5c04\u8f6c\u6362</li> <li>\u5b98\u65b9\uff1aCollection\u7c7b\uff0cHibernate\uff0cJava 8 Modules \u7b49\uff1b</li> </ul>"},{"location":"languages/java/packages/dataformat_json.html#_3","title":"\u8bfb\u53d6\u65b9\u5f0f","text":"<p>\u652f\u6301</p> <ul> <li>Stream: JsonFactory\uff08\u7ebf\u7a0b\u5b89\u5168\uff0c\u4e00\u6b21\u6027\u914d\u7f6e\uff09\u7c7b\u8bfb\u53d6\uff0clow-level\uff1b</li> <li>databind: ObjectMapper\uff08\u7ebf\u7a0b\u5b89\u5168\uff09 \u7c7b\u8bfb\u53d6\uff1b</li> <li>\u5bf9\u8c61\u6620\u5c04\uff0cPOJO\u5bf9\u8c61\u3001Map\u3001List\u7b49\uff1b</li> <li>Tree Model\uff1a\u9002\u7528\u4e8e\u7ed3\u6784\u52a8\u6001\u53d8\u6362\uff0c\u96be\u4ee5\u7528java\u5bf9\u8c61\u7b80\u5355\u8868\u793a\uff1b</li> <li>Streaming\uff1amapper.getFactory\u8f6c\u6362\u5230\u6d41\u5f0f\u5904\u7406\uff0clow level\uff1b</li> </ul>"},{"location":"languages/java/packages/dataformat_json.html#_4","title":"\u81ea\u5b9a\u4e49\u7c7b\u89e3\u6790","text":"<pre><code>ObjectMapper objectMapper = new ObjectMapper()\nSimpleModule module = new SimpleModule();\nmodule.addDeserializer(Schema.class, new SchemaDeserializer());\nobjectMapper.registerModule(module);\n</code></pre>"},{"location":"languages/java/packages/dataformat_json.html#_5","title":"\u591a\u6001\u5e8f\u5217\u5316","text":"<pre><code>@JsonTypeInfo(use = JsonTypeInfo.Id.NAME, include = JsonTypeInfo.As.PROPERTY,property = \"name\")\n@JsonSubTypes(value = {\n     @JsonSubTypes.Type(value = Daedalus.class, name = \"Daedalus\"),\n     @JsonSubTypes.Type(value = HugeDrink.class, name = \"Huge drink\"),\n     @JsonSubTypes.Type(value = StarWand.class, name = \"Star wand\"),\n})\npublic interface Equipment {\n}\n\n@Data\npublic class StarWand implements Equipment{\n    private String name;\n    private int length;\n    private int price;\n    private List&lt;String&gt; effect;\n}\n\n// @JsonSubTypes\u7684\u6ce8\u89e3,\u53ef\u4ee5\u901a\u8fc7\u4ee3\u7801\u64cd\u4f5c\nmapper.registerSubtypes(new NamedType(HugeDrink.class, \"Huge drink\"));\nmapper.registerSubtypes(new NamedType(Daedalus.class, \"Daedalus\"));\nmapper.registerSubtypes(new NamedType(StarWand.class, \"Star wand\"));\n</code></pre> <p>\u65b0\u589e\u5b50\u7c7b\u7684\u65f6\u5019\u90fd\u8981\u53bb\u52a0\u4e00\u4e0bJsonSubTypes\uff0c\u901a\u8fc7 <code>@JsonTypeIdResolver</code> \u89e3\u51b3</p> <pre><code>@JsonTypeInfo(use = JsonTypeInfo.Id.CUSTOM, property = \"type\")\n@JsonTypeIdResolver(SchemaIdResolver.class)\npublic interface Equipment {\n}\n\npublic class SchemaIdResolver extends TypeIdResolverBase {\n}\n\n// \u5904\u7406\u4e0d\u5b58\u5728\u7684 type \u6216\u8005 \u4e22\u5931\u65f6\uff0c\u5982\u4f55\u5904\u7406\nobjectMapper.setConfig( objectMapper.getDeserializationConfig().withHandler(new DeserializationProblemHandler() {\n            @Override\n            public JavaType handleMissingTypeId(DeserializationContext ctxt, JavaType baseType, TypeIdResolver idResolver, String failureMsg) throws IOException {\n                return baseType;\n            }\n\n            @Override\n            public JavaType handleUnknownTypeId(DeserializationContext ctxt, JavaType baseType, String subTypeId, TypeIdResolver idResolver, String failureMsg) throws IOException {\n                return baseType;\n            }\n        }));\n</code></pre>"},{"location":"languages/java/packages/dataformat_json.html#_6","title":"\u679a\u4e3e","text":"<pre><code>// \u4f7f\u7528 ENUM \u7684 toString \u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\nobjectMapper.configure(SerializationFeature.WRITE_ENUMS_USING_TO_STRING, true);\nobjectMapper.configure(DeserializationFeature.READ_ENUMS_USING_TO_STRING, true);\n</code></pre>"},{"location":"languages/java/packages/dataformat_json.html#jsonpath","title":"JsonPath","text":"<p>JsonPath \uff1a\u6839\u636e\u8def\u5f84\u89e3\u6790\u6240\u9700\u7684\u6570\u636e</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.jayway.jsonpath&lt;/groupId&gt;\n    &lt;artifactId&gt;json-path&lt;/artifactId&gt;\n    &lt;version&gt;2.4.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u901a\u8fc7SPI\u673a\u5236\uff0c\u652f\u6301Gson\uff0cFastXML jackson \u7b49json\u89e3\u6790\u5de5\u5177\u3002</p>"},{"location":"languages/java/packages/dataformat_json.html#fastjson","title":"FastJSON","text":"<p>\u963f\u91cc\u7684 json\u5de5\u5177\uff0c\u540c\u65f6\u652f\u6301 json \u89e3\u6790\u548c JSONPath \u3002</p>"},{"location":"languages/java/packages/dataformat_table.html","title":"Dataformat table","text":"<p>[toc]</p>"},{"location":"languages/java/packages/dataformat_table.html#_1","title":"\u8868\u683c\u5904\u7406","text":""},{"location":"languages/java/packages/dataformat_table.html#csv","title":"CSV","text":"<ul> <li>opencsv \uff1b</li> <li>Apache Commons CSV\uff1b</li> </ul>"},{"location":"languages/java/packages/dataformat_table.html#excel","title":"Excel","text":""},{"location":"languages/java/packages/dataformat_table.html#apache-poimicrosoftwordexcelppt","title":"Apache POI\uff08MicroSoft(Word/Excel/PPT)\uff09","text":"<p>Apache POI\u662fApache\u7ec4\u7ec7\u63d0\u4f9b\u7684\u9488\u5bf9\u5fae\u8f6foffice\uff08\u4e3b\u8981\u9488\u5bf9Excel\uff09\u8fdb\u884c\u5bfc\u5165\u548c\u5bfc\u51fa\u64cd\u4f5c\u7684\u5f00\u6e90\u5de5\u5177\u5305\u3002</p> <p>xlsx \u683c\u5f0f\u57fa\u4e8e XML, \u5176\u5904\u7406\u65f6\u7684\u5185\u5b58\u5360\u7528\u8981\u9ad8\u4e8e\u5904\u7406 xls \u683c\u5f0f\u6240\u9700\u8981\u7684\u5185\u5b58\u3002</p> <p>HSSF \u5904\u7406 xls \u683c\u5f0f\u6587\u4ef6\uff1b</p> <p>XSSF \u5904\u7406 xlsx \u683c\u5f0f\u6587\u4ef6\uff1b</p> <p></p>"},{"location":"languages/java/packages/dataformat_table.html#easyexcelalibaba","title":"EasyExcel(Alibaba)","text":"<p>https://github.com/alibaba/easyexcel</p>"},{"location":"languages/java/packages/dataformat_xml.html","title":"Dataformat xml","text":"<p>[toc]</p>"},{"location":"languages/java/packages/dataformat_xml.html#xml","title":"XML","text":""},{"location":"languages/java/packages/dataformat_xml.html#_1","title":"\u683c\u5f0f","text":"<p>xmlns \u5373 XML NameSpace\uff0c\u540d\u7a7a\u95f4\uff0c\u524d\u7f00\u6765\u9632\u6b62\u6807\u7b7e\u51b2\u7a81\uff1b\u9ed8\u8ba4\u540d\u7a7a\u95f4\uff0c\u4e0d\u9700\u8981\u52a0\u524d\u7f00\uff1b</p> <p>xmlns:mvc \u8868\u793amvc\u540d\u7a7a\u95f4\u3002</p> <p>xsi:schemaLocation \u5b9a\u4e49\u4e86XML Namespace\u548c\u5bf9\u5e94\u7684 XSD\uff08Xml Schema Definition\uff09\u6587\u6863\u7684\u4f4d\u7f6e\u7684\u5173\u7cfb\uff1b</p> <ul> <li>\u7b2c\u4e00\u4e2aURI\u662f\u5b9a\u4e49\u7684 XML Namespace\u7684\u503c\uff1b</li> <li>\u7b2c\u4e8c\u4e2aURI\u7ed9\u51faSchema\u6587\u6863\u7684\u4f4d\u7f6e\uff0cSchema\u5904\u7406\u5668\u5c06\u4ece\u8fd9\u4e2a\u4f4d\u7f6e\u8bfb\u53d6Schema\u6587\u6863\uff0c\u8be5\u6587\u6863\u7684targetNamespace\u5fc5\u987b\u4e0e\u7b2c\u4e00\u4e2aURI\u76f8\u5339\u914d\u3002</li> </ul> <p>xsi \u5df2\u7ecf\u6210\u4e3a\u4e86\u4e00\u4e2a\u4e1a\u754c\u9ed8\u8ba4\u7684\u7528\u4e8e XSD\uff08XML Schema Definition) \u6587\u4ef6\u7684\u547d\u540d\u7a7a\u95f4\u3002 </p> <p>XSD \u6587\u4ef6\uff08XML Schema Definition\uff0c\u4e5f\u5e38\u5e38\u79f0\u4e3a Schema \u6587\u4ef6\uff09\u662f\u7528\u6765\u5b9a\u4e49 xml \u6587\u6863\u7ed3\u6784\u7684\u3002</p> <ul> <li>XSD \u6821\u9a8cXML\u6587\u4ef6\u5185\u5bb9\u7684\u5408\u6cd5\u6027\uff0c\u4e00\u4e2a XML \u914d\u7f6e\u6587\u4ef6\u662f\u5408\u6cd5\u7684 XML \u6587\u4ef6\u683c\u5f0f\uff0c \u4f46\u5176\u4e0d\u4e00\u5b9a\u7b26\u5408\u8be5 XML \u7684 XSD \u6a21\u5f0f\u3002</li> </ul> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 xmlns:context=\"http://www.springframework.org/schema/context\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 xmlns:mvc=\"http://www.springframework.org/schema/mvc\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 xsi:schemaLocation=\"http://www.springframework.org/schema/beans \n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 http://www.springframework.org/schema/beans/spring-beans.xsd\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 http://www.springframework.org/schema/context \n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 http://www.springframework.org/schema/context/spring-context.xsd\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 http://www.springframework.org/schema/mvc\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 http://www.springframework.org/schema/mvc/spring-mvc.xsd\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;context:component-scan base-package=\"xxx.xxx.controller\" /&gt;\n\u00a0\u00a0\u00a0\u00a0 \n\u00a0\u00a0\u00a0\u00a0&lt;context:annotation-config/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;mvc:default-servlet-handler/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;mvc:annotation-driven/&gt;\n\u00a0\u00a0\u00a0\u00a0 \n\u00a0\u00a0\u00a0\u00a0&lt;mvc:resources mapping=\"/images/**\" location=\"/images/\" /&gt;\n\u00a0\u00a0\u00a0\u00a0 \n\u00a0\u00a0\u00a0\u00a0&lt;bean id=\"xxx\" class=\"xxx.xxx.xxx.Xxx\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"xxx\" value=\"xxxx\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/bean&gt;\n&lt;/beans&gt;\n</code></pre>"},{"location":"languages/java/packages/dataformat_xml.html#xmlxsd","title":"\u81ea\u5b9a\u4e49xml\u548cxsd","text":"<p>\u53ef\u4ee5\u53c2\u8003 Jackson \u7684xml\u8bfb\u53d6\u6210 Java POJO \u7c7b\u3002</p>"},{"location":"languages/java/packages/dataformat_xml.html#xsd","title":"xsd","text":"<pre><code>&lt;?xml version=\"1.0\" encoding= \"UTF-8\"?&gt;\n&lt;xsd:schema xmlns= \"http://customer/xsd-a\" xmlns:xsd= \"http://www.w3.org/2001/XMLSchema\"\n     targetNamespace=\"http://customer/xsd-a\" elementFormDefault=\"qualified\" &gt;\n     &lt;xsd:simpleType name =\"IDType\"&gt; \n           &lt;xsd:restriction base =\"xsd:string\"&gt;\n               &lt;xsd:pattern value= \"[\\w,\\-,_]{1,32}\"&gt;&lt;/xsd:pattern &gt;\n           &lt;/xsd:restriction &gt;\n     &lt;/xsd:simpleType &gt;\n     &lt;!-- \u5b9a\u4e49\u7c7b\u578b --&gt;\n     &lt;xsd:complexType name =\"jobType\"&gt;\n           &lt;xsd:sequence &gt;\n               &lt;xsd:element name =\"jobId\" type=\"IDType\"&gt;\n                    &lt;xsd:annotation &gt;\n                         &lt;xsd:documentation &gt;&lt;![CDATA[\u4efb\u52a1ID\uff0c\u552f\u4e00\u533a\u522b\u4e00\u4e2a\u5e76\u884c\u8ba1\u7b97\u4efb\u52a1\uff0c\u5fc5\u987b\u552f\u4e00 ]]&gt;&lt;/xsd:documentation &gt;\n                    &lt;/xsd:annotation &gt;\n               &lt;/xsd:element &gt;\n               &lt;xsd:element name =\"jobName\" type= \"xsd:string\" minOccurs =\"0\"&gt;\n                    &lt;xsd:annotation &gt;\n                         &lt;xsd:documentation &gt;&lt;![CDATA[\u4efb\u52a1\u540d\u79f0\uff0c\u53ef\u9009 ]]&gt;&lt;/xsd:documentation &gt;\n                    &lt;/xsd:annotation &gt;\n               &lt;/xsd:element &gt;\n             &lt;/xsd:sequence &gt;\n     &lt;/xsd:complexType &gt;\n     &lt;!-- \u5b9a\u4e49\u7c7b\u578b --&gt;\n     &lt;xsd:complexType name =\"jobBundleType\"&gt;\n           &lt;xsd:sequence &gt;\n               &lt;xsd:element name =\"job\" maxOccurs= \"unbounded\" type=\"jobType\" &gt;&lt;/xsd:element &gt;\n           &lt;/xsd:sequence &gt;\n           &lt;xsd:attribute name =\"bundleName\" type= \"IDType\"&gt;&lt;/xsd:attribute &gt;\n     &lt;/xsd:complexType &gt;\n    &lt;xsd:element name =\"jobBundle\" type=\"jobBundleType\"&gt; &lt;/xsd:element &gt;\n&lt;/xsd:schema&gt;\n</code></pre>"},{"location":"languages/java/packages/dataformat_xml.html#xml_1","title":"xml","text":"<pre><code>&lt;?xml version=\"1.0\" encoding= \"UTF-8\"?&gt;\n&lt;jobBundle bundleName= \"sldfjlaksd\" xmlns= \"http://customer/xsd-a\"\n     xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n     xsi:schemaLocation=\"http://customer/xsd-a  http://customer/xsd-a.xsd\"&gt;\n     &lt;job&gt;\n           &lt;jobId&gt;df-asd_asdf238-sdf_adf&lt;/jobId&gt;\n           &lt;distributorClassName &gt;&lt;/distributorClassName &gt;\n     &lt;/job&gt;\n&lt;/jobBundle&gt;\n</code></pre>"},{"location":"languages/java/packages/dataformat_xml.html#java","title":"java","text":"<pre><code>SAXReader reader = new SAXReader(true);\nreader.setEntityResolver(new FileResolver());\nreader.setFeature(\"http://apache.org/xml/features/validation/schema\", true);\nDocument document = reader.read(new File(\"D:\\\\Project\\\\xmlparser\\\\src\\\\test.xml\"));\nElement root = document.getRootElement();\n\n// FileResolver.java\uff08\u8bfb\u53d6\u81ea\u5b9a\u4e49\u6587\u4ef6\uff0c\u5c06xml\u4e2d\u81ea\u5b9a\u4e49\u7684xsd\u6620\u5c04\u4e3a\u672c\u5730\u6587\u4ef6\u8bfb\u53d6\uff0c\u53c2\u8003Spring\u7684PluggableSchemaResolver\uff09\npublic class FileResolver implements EntityResolver {\n    @Override\n    public InputSource resolveEntity(String publicId, String systemId) {\n    \u00a0\u00a0\u00a0\u00a0if (systemId != null &amp;&amp; systemId.endsWith(\".xsd\")) {\n    \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String resourceLocation = getSchemaMappings().get(systemId);\n    \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (resourceLocation != null) {\n    \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0InputStream resource = FileResolver.class.getResourceAsStream(resourceLocation) ;\n    \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (resource != null) {\n    \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0InputSource source = new InputSource(resource);\n    \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0source.setPublicId(publicId);\n    \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0source.setSystemId(systemId);\n    \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return source;\n    \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n    \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n    \u00a0\u00a0\u00a0\u00a0}\n    \u00a0\u00a0\u00a0\u00a0return null;\n    }\n}\n</code></pre>"},{"location":"languages/java/packages/ehcache.html","title":"Ehcache","text":"<p>[toc]</p>"},{"location":"languages/java/packages/ehcache.html#ehcache","title":"Ehcache","text":"<p>EhCache \u662f\u4e00\u4e2a\u7eafJava\u7684\u8fdb\u7a0b\u5185\u7f13\u5b58\u6846\u67b6\uff0c\u652f\u6301\u5185\u5b58\u548c\u78c1\u76d8\u5b58\u50a8\uff0c\u7f13\u5b58\u52a0\u8f7d\u5668\uff0c\u7f13\u5b58\u6269\u5c55\uff0c\u7f13\u5b58\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\uff0c\u4e00\u4e2agzip\u7f13\u5b58servlet\u8fc7\u6ee4\u5668\uff0c\u652f\u6301REST\u548cSOAP api\u7b49\u7279\u70b9\u3002</p>"},{"location":"languages/java/packages/grpc.html","title":"Grpc","text":""},{"location":"languages/java/packages/grpc.html#_1","title":"\u539f\u7406","text":""},{"location":"languages/java/packages/grpc.html#managedchannel","title":"ManagedChannel","text":"<ul> <li>\u662f\u5426\u6709\u8fde\u63a5\u6c60\uff1a</li> </ul>"},{"location":"languages/java/packages/grpc.html#_2","title":"\u914d\u7f6e","text":""},{"location":"languages/java/packages/grpc.html#_3","title":"Grpc","text":""},{"location":"languages/java/packages/http.html","title":"Apache HttpComponents","text":"<p>The Commons HttpClient project is now end of life, and is no longer being developed. It has been replaced by the Apache HttpComponents project in its HttpClient and HttpCore modules, which offer better performance and more flexibility.</p>"},{"location":"languages/java/packages/http.html#_1","title":"\u4f7f\u7528","text":""},{"location":"languages/java/packages/hutools.html","title":"\u5de5\u5177\u5305","text":""},{"location":"languages/java/packages/hutools.html#hutools","title":"Hutools","text":"<p>\u4e00\u4e2aJava\u57fa\u7840\u5de5\u5177\u7c7b\uff0c\u5bf9\u6587\u4ef6\u3001\u6d41\u3001\u52a0\u5bc6\u89e3\u5bc6\u3001\u8f6c\u7801\u3001\u6b63\u5219\u3001\u7ebf\u7a0b\u3001XML\u7b49JDK\u65b9\u6cd5\u8fdb\u884c\u5c01\u88c5\uff0c\u7ec4\u6210\u5404\u79cdUtil\u5de5\u5177\u7c7b\uff0c\u540c\u65f6\u63d0\u4f9b\u4ee5\u4e0b\u7ec4\u4ef6\uff1a</p> \u6a21\u5757 \u4ecb\u7ecd hutool-aop JDK\u52a8\u6001\u4ee3\u7406\u5c01\u88c5\uff0c\u63d0\u4f9b\u975eIOC\u4e0b\u7684\u5207\u9762\u652f\u6301 hutool-bloomFilter \u5e03\u9686\u8fc7\u6ee4\uff0c\u63d0\u4f9b\u4e00\u4e9bHash\u7b97\u6cd5\u7684\u5e03\u9686\u8fc7\u6ee4 hutool-cache \u7b80\u5355\u7f13\u5b58\u5b9e\u73b0 hutool-core \u6838\u5fc3\uff0c\u5305\u62ecBean\u64cd\u4f5c\u3001\u65e5\u671f\u3001\u5404\u79cdUtil\u7b49 hutool-cron \u5b9a\u65f6\u4efb\u52a1\u6a21\u5757\uff0c\u63d0\u4f9b\u7c7bCrontab\u8868\u8fbe\u5f0f\u7684\u5b9a\u65f6\u4efb\u52a1 hutool-crypto \u52a0\u5bc6\u89e3\u5bc6\u6a21\u5757\uff0c\u63d0\u4f9b\u5bf9\u79f0\u3001\u975e\u5bf9\u79f0\u548c\u6458\u8981\u7b97\u6cd5\u5c01\u88c5 hutool-db JDBC\u5c01\u88c5\u540e\u7684\u6570\u636e\u64cd\u4f5c\uff0c\u57fa\u4e8eActiveRecord\u601d\u60f3 hutool-dfa \u57fa\u4e8eDFA\u6a21\u578b\u7684\u591a\u5173\u952e\u5b57\u67e5\u627e hutool-extra \u6269\u5c55\u6a21\u5757\uff0c\u5bf9\u7b2c\u4e09\u65b9\u5c01\u88c5\uff08\u6a21\u677f\u5f15\u64ce\u3001\u90ae\u4ef6\u3001Servlet\u3001\u4e8c\u7ef4\u7801\u3001Emoji\u3001FTP\u3001\u5206\u8bcd\u7b49\uff09 hutool-http \u57fa\u4e8eHttpUrlConnection\u7684Http\u5ba2\u6237\u7aef\u5c01\u88c5 hutool-log \u81ea\u52a8\u8bc6\u522b\u65e5\u5fd7\u5b9e\u73b0\u7684\u65e5\u5fd7\u95e8\u9762 hutool-script \u811a\u672c\u6267\u884c\u5c01\u88c5\uff0c\u4f8b\u5982Javascript hutool-setting \u529f\u80fd\u66f4\u5f3a\u5927\u7684Setting\u914d\u7f6e\u6587\u4ef6\u548cProperties\u5c01\u88c5 hutool-system \u7cfb\u7edf\u53c2\u6570\u8c03\u7528\u5c01\u88c5\uff08JVM\u4fe1\u606f\u7b49\uff09 hutool-json JSON\u5b9e\u73b0 hutool-captcha \u56fe\u7247\u9a8c\u8bc1\u7801\u5b9e\u73b0 hutool-poi \u9488\u5bf9POI\u4e2dExcel\u548cWord\u7684\u5c01\u88c5 hutool-socket \u57fa\u4e8eJava\u7684NIO\u548cAIO\u7684Socket\u5c01\u88c5 hutool-jwt JSON Web Token (JWT)\u5c01\u88c5\u5b9e\u73b0 <p>\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u5bf9\u6bcf\u4e2a\u6a21\u5757\u5355\u72ec\u5f15\u5165\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5f15\u5165<code>hutool-all</code>\u65b9\u5f0f\u5f15\u5165\u6240\u6709\u6a21\u5757\u3002</p>"},{"location":"languages/java/packages/hutools.html#_2","title":"\u4f7f\u7528","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;cn.hutool&lt;/groupId&gt;\n    &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;\n    &lt;version&gt;5.8.16&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"languages/java/packages/hutools.html#guava","title":"Guava \u5e38\u7528","text":""},{"location":"languages/java/packages/hutools.html#ratelimit","title":"RateLimit \u9650\u6d41","text":"<p>RateLimiter \u6d41\u63a7\uff1bCache \u7ebf\u7a0b\u5b89\u5168\u7684\u7f13\u5b58\uff1b</p>"},{"location":"languages/java/packages/hutools.html#cache","title":"Cache \u7f13\u5b58","text":""},{"location":"languages/java/packages/hutools.html#caffine","title":"Caffine \u66ff\u4ee3","text":""},{"location":"languages/java/packages/image.html","title":"Image","text":""},{"location":"languages/java/packages/image.html#_1","title":"\u8bfb\u5199","text":"<p>BufferedImage \uff1a\u56fe\u50cf\u7c7b</p> <p>ImageIO\uff1a\u56fe\u5f62\u8bfb\u5199\u5de5\u5177\u7c7b</p> <pre><code>// \u8bfb\u53d6\u56fe\u7247\nFile input = new File(\"ceshi.jpg\");\nBufferedImage image = ImageIO.read(input);\n\n// \u6839\u636e\u56fe\u7247\u683c\u5f0f\uff0c\u521b\u5efaImageWrite\u7c7b\nIterator&lt;ImageWriter&gt; writers =  ImageIO.getImageWritersByFormatName(\"jpg\");\nImageWriter writer = (ImageWriter) writers.next();\n\n// \u521b\u5efa\u5bf9\u5e94\u7684\u6587\u4ef6\u6d41\nFile compressedImageFile = new File(\"bbcompress.jpg\");\nOutputStream os =new FileOutputStream(compressedImageFile);\nImageOutputStream ios = ImageIO.createImageOutputStream(os);\n\n// \u8bbe\u7f6e\u8f93\u51fa\u6d41\nwriter.setOutput(ios);\n\n// \u8bbe\u7f6e\u53c2\u6570\uff08\u538b\u7f29\u6a21\u5f0f\u548c\u538b\u7f29\u8d28\u91cf\uff09\nImageWriteParam param = writer.getDefaultWriteParam();\nparam.setCompressionMode(ImageWriteParam.MODE_EXPLICIT);\nparam.setCompressionQuality(0.01f);\n\n// \u5c06\u56fe\u50cf\u5199\u51fa\nwriter.write(null, new IIOImage(image, null, null), param);\n\nos.close();\nios.close();\nwriter.dispose();\n</code></pre>"},{"location":"languages/java/packages/image.html#compress","title":"Compress","text":"<p>JDK</p> <pre><code>// \u8bbe\u7f6e\u53c2\u6570\uff08\u538b\u7f29\u6a21\u5f0f\u548c\u538b\u7f29\u8d28\u91cf\uff09\nImageWriteParam param = writer.getDefaultWriteParam();\nparam.setCompressionMode(ImageWriteParam.MODE_EXPLICIT);\nparam.setCompressionQuality(0.01f);\n</code></pre> <p>\u538b\u7f29\u6a21\u5f0f\u4e00\u5171\u6709\u56db\u79cd\uff1a</p> <ul> <li>MODE_EXPLICIT \u8868\u793a ImageWriter \u53ef\u4ee5\u6839\u636e\u540e\u7eed\u7684 set \u7684\u9644\u52a0\u4fe1\u606f\u8fdb\u884c\u5e73\u94fa\u548c\u538b\u7f29\uff0c\u6bd4\u5982\u8bf4\u63a5\u4e0b\u6765\u7684 <code>setCompressionQuality()</code> \u65b9\u6cd5\u3002</li> </ul> <p><code>setCompressionQuality()</code> \u65b9\u6cd5\u7684\u53c2\u6570\u662f\u4e00\u4e2a 0-1 \u4e4b\u95f4\u7684\u6570\uff0c0.0 \u8868\u793a\u5c3d\u6700\u5927\u7a0b\u5ea6\u538b\u7f29\uff0c1.0 \u8868\u793a\u4fdd\u8bc1\u56fe\u50cf\u8d28\u91cf\u5f88\u91cd\u8981\u3002</p> <ul> <li>\u6709\u635f\u538b\u7f29\uff1a\u538b\u7f29\u8d28\u91cf\u5e94\u8be5\u63a7\u5236\u6587\u4ef6\u5927\u5c0f\u548c\u56fe\u50cf\u8d28\u91cf\u4e4b\u95f4\u7684\u6743\u8861\uff08\u4f8b\u5982\uff0c\u901a\u8fc7\u5728\u5199\u5165 JPEG \u56fe\u50cf\u65f6\u9009\u62e9\u91cf\u5316\u8868\uff09\uff1b</li> <li>\u65e0\u635f\u538b\u7f29\uff1a\u538b\u7f29\u8d28\u91cf\u53ef\u7528\u4e8e\u63a7\u5236\u6587\u4ef6\u5927\u5c0f\u548c\u6267\u884c\u538b\u7f29\u6240\u9700\u7684\u65f6\u95f4\u4e4b\u95f4\u7684\u6743\u8861\uff08\u4f8b\u5982\uff0c\u901a\u8fc7\u4f18\u5316\u884c\u8fc7\u6ee4\u5668\u5e76\u5728\u5199\u5165 PNG \u56fe\u50cf\u65f6\u8bbe\u7f6e ZLIB \u538b\u7f29\u7ea7\u522b\uff09\u3002</li> </ul> <p>OpenCV</p> <pre><code>OpenCV.loadShared();\n\nMat src = Imgcodecs.imread(imagePath);\n\n// \u7b2c\u4e00\u4e2a\u53c2\u6570 IMWRITE_JPEG_QUALITY \u8868\u793a\u5bf9\u56fe\u7247\u7684\u8d28\u91cf\u8fdb\u884c\u6539\u53d8\uff0c\u7b2c\u4e8c\u4e2a\u662f\u8d28\u91cf\u56e0\u5b50\uff0c1-100\uff0c\u503c\u8d8a\u5927\u8868\u793a\u8d28\u91cf\u8d8a\u9ad8\u3002\nMatOfInt dstImage = new MatOfInt(Imgcodecs.IMWRITE_JPEG_QUALITY, 10);\n\nImgcodecs.imwrite(imageOutPath, src, dstImage);\n</code></pre>"},{"location":"languages/java/packages/image.html#_2","title":"\u7b2c\u4e09\u65b9","text":""},{"location":"languages/java/packages/image.html#commons-imaging","title":"Commons Imaging","text":"<p>Apache Commons Imaging\uff0c\u4e00\u4e2a\u8bfb\u53d6\u548c\u5199\u5165\u5404\u79cd\u56fe\u50cf\u683c\u5f0f\u7684\u5e93\uff0c\u5305\u62ec\u5feb\u901f\u89e3\u6790\u56fe\u50cf\u4fe1\u606f\uff08\u5982\u5927\u5c0f\uff0c\u989c\u8272\uff0c\u7a7a\u95f4\uff0cICC\u914d\u7f6e\u6587\u4ef6\u7b49\uff09\u548c\u5143\u6570\u636e\u3002</p>"},{"location":"languages/java/packages/image.html#metadata-extractor","title":"metadata-extractor","text":"<p>\u56fe\u50cf\u5904\u7406\uff1aJava\u7528\u4e8e\u56fe\u50cf\u8bfb\u53d6\u548c\u5904\u7406\u7684\u5305\uff1b</p> <p>https://drewnoakes.com/code/exif/</p> <p>https://github.com/drewnoakes/metadata-extractor</p> <p>Extracts Exif, IPTC, XMP, ICC and other metadata from image, video and audio files</p> <p>maven\u4f9d\u8d56</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.drewnoakes&lt;/groupId&gt;\n    &lt;artifactId&gt;metadata-extractor&lt;/artifactId&gt;\n    &lt;version&gt;2.13.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"languages/java/packages/image.html#opencv","title":"OpenCV","text":"<p>\u7531BSD\u8bb8\u53ef\u8bc1\u53d1\u5e03\uff0c\u53ef\u4ee5\u514d\u8d39\u5b66\u4e60\u548c\u5546\u4e1a\u4f7f\u7528\uff0c\u63d0\u4f9b\u4e86\u5305\u62ec C/C++\u3001Python \u548c Java \u7b49\u4e3b\u6d41\u7f16\u7a0b\u8bed\u8a00\u5728\u5185\u7684\u63a5\u53e3\u3002OpenCV \u4e13\u4e3a\u8ba1\u7b97\u6548\u7387\u800c\u8bbe\u8ba1\uff0c\u5f3a\u8c03\u5b9e\u65f6\u5e94\u7528\uff0c\u53ef\u4ee5\u5145\u5206\u53d1\u6325\u591a\u6838\u5904\u7406\u5668\u7684\u4f18\u52bf\u3002</p> <p>openpnp \u5bf9 opencv \u505a\u7b80\u5355\u7684\u5c01\u88c5\uff08\u5c06windows/linux\u7b49\u5e73\u53f0\u7684opencv\u52a8\u6001\u5e93\u653e\u5165jar\u5305\u4e2d\uff0c\u5e76\u4e14\u63d0\u4f9bOpenCV.loadShared\u8fdb\u884c\u52a0\u8f7d\uff09\u3002</p> <pre><code>&lt;dependency&gt;\n &lt;groupId&gt;org.openpnp&lt;/groupId&gt;\n &lt;artifactId&gt;opencv&lt;/artifactId&gt;\n &lt;version&gt;4.5.5&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"languages/java/packages/jmh.html","title":"JMH","text":"<p>http://openjdk.java.net/projects/code-tools/jmh/</p> <p>\u8fd0\u884c JMH \u57fa\u51c6\u6d4b\u8bd5\u7684\u63a8\u8350\u65b9\u6cd5\u662f\u4f7f\u7528Maven\u8bbe\u7f6e\u4e00\u4e2a\u72ec\u7acb\u7684\u9879\u76ee\uff0c\u8be5\u9879\u76ee\u4f9d\u8d56\u4e8e\u5e94\u7528\u7a0b\u5e8f\u7684jar\u6587\u4ef6\u3002</p> <pre><code>$ mvn archetype:generate \\\n          -DinteractiveMode=false \\\n          -DarchetypeGroupId=org.openjdk.jmh \\\n          -DarchetypeArtifactId=jmh-java-benchmark-archetype \\\n          -DgroupId=org.sample \\\n          -DartifactId=test \\\n          -Dversion=1.0\n\n$ cd test/\n$ mvn clean install\n\njava -jar target/benchmarks.jar\n</code></pre> <p>JMH\u662fOpen JDK9\u81ea\u5e26\u7684\uff0c\u5982\u679c\u4f60\u662f JDK9 \u4e4b\u524d\u7684\u7248\u672c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5bfc\u5165 openjdk</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.openjdk.jmh&lt;/groupId&gt;\n    &lt;artifactId&gt;jmh-core&lt;/artifactId&gt;\n    &lt;version&gt;1.19&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.openjdk.jmh&lt;/groupId&gt;\n    &lt;artifactId&gt;jmh-generator-annprocess&lt;/artifactId&gt;\n    &lt;version&gt;1.19&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>FileSearchBenchmark.java </p>"},{"location":"languages/java/packages/netty.html","title":"Netty","text":"<p>[toc]</p>"},{"location":"languages/java/packages/netty.html#netty","title":"Netty","text":""},{"location":"languages/java/packages/netty.html#_1","title":"\u7ec4\u6210","text":""},{"location":"languages/java/packages/netty.html#_2","title":"\u4f7f\u7528","text":""},{"location":"languages/java/packages/qrcode.html","title":"\u4e8c\u7ef4\u7801","text":""},{"location":"languages/java/packages/qrcode.html#zxing","title":"zxing","text":"<p>ZXing (\"Zebra Crossing\") barcode scanning library for Java, Android</p>"},{"location":"languages/python/basic.html","title":"Python","text":""},{"location":"languages/python/basic.html#_1","title":"\u89e3\u91ca\u5668","text":""},{"location":"languages/python/basic.html#cpython","title":"CPython","text":"<p>\u5b98\u65b9\u7248\u672c\u7684\u89e3\u91ca\u5668\uff1aCpython\uff0c\u7528C\u8bed\u8a00\u5f00\u53d1\u7684\uff0c\u8fd0\u884cpython\uff0c\u5c31\u662f\u542f\u52a8CPython\u89e3\u91ca\u5668\uff0cCPython\u662f\u4f7f\u7528\u6700\u5e7f\u7684Python\u89e3\u91ca\u5668</p>"},{"location":"languages/python/basic.html#ipython","title":"IPython","text":"<p>IPython\u662f\u57fa\u4e8eCPython\u4e4b\u4e0a\u7684\u4e00\u4e2a\u4ea4\u4e92\u5f0f\u89e3\u91ca\u5668</p>"},{"location":"languages/python/basic.html#pypy","title":"PyPy","text":"<p>PyPy\u662f\u7528Python\u5b9e\u73b0\u7684\u89e3\u91ca\u5668\uff0cPyPy\u91c7\u7528 JIT \u6280\u672f\uff0c\u5bf9 Python \u4ee3\u7801\u8fdb\u884c\u52a8\u6001\u7f16\u8bd1</p>"},{"location":"languages/python/basic.html#jython","title":"Jython","text":"<p>Jython\u662f\u8fd0\u884c\u5728Java\u5e73\u53f0\u4e0a\u7684Python\u89e3\u91ca\u5668\uff0c\u53ef\u4ee5\u76f4\u63a5\u628aPython\u4ee3\u7801\u7f16\u8bd1\u6210Java\u5b57\u8282\u7801\u6267\u884c</p>"},{"location":"languages/python/basic.html#_2","title":"\u57fa\u7840","text":"<p>\u8f6c\u4e3a\u5b57\u7b26\u4e32\u65b9\u6cd5</p> <ul> <li>str() :  \u5b57\u7b26\u4e32\u7684\u5f62\u5f0f</li> <li>repr() : \u4f5c\u7528\u5728\u5b57\u7b26\u4e32\u4e0a\u65f6\u4f1a\u591a\u4e00\u5c42\u5f15\u53f7</li> </ul>"},{"location":"languages/python/basic.html#todo","title":"\u5b50\u8fdb\u7a0b(TODO)","text":"<p>os.popen</p>"},{"location":"languages/python/basic.html#-m","title":"-m","text":"<p>python -m run.py</p> <p>\u4f5c\u7528\u662f\uff1a\u628a run.py \u6587\u4ef6\u5f53\u505a\u6a21\u5757\u542f\u52a8</p> <p>\u76f4\u63a5\u542f\u52a8\u662f\u628arun.py\u6587\u4ef6\uff0c\u6240\u5728\u7684\u76ee\u5f55\u653e\u5230\u4e86sys.path\u5c5e\u6027\u4e2d\u3002\u6a21\u5757\u542f\u52a8\u662f\u628a\u4f60\u8f93\u5165\u547d\u4ee4\u7684\u76ee\u5f55\uff08\u4e5f\u5c31\u662f\u5f53\u524d\u8def\u5f84\uff09\uff0c\u653e\u5230\u4e86sys.path\u5c5e\u6027</p>"},{"location":"languages/python/basic.html#psutil","title":"Psutil","text":"<p>\u5728Python\u4e2d\u83b7\u53d6\u7cfb\u7edf\u4fe1\u606f\u7684\u6a21\u5757\uff0c\u5305\u62ec\uff1a</p> <ul> <li>CPU\u4fe1\u606f\uff0c\u903b\u8f91\u6838\u6570\u3001\u7269\u7406\u6838\u6570\uff0ccpu_times\uff08\u7528\u6237/\u7cfb\u7edf/\u7a7a\u95f2\u65f6\u95f4\uff09\uff1b</li> <li>top\uff1b</li> <li>\u7269\u7406\u5185\u5b58\u548c\u4ea4\u6362\u533a\u4fe1\u606f\uff1b</li> <li>\u78c1\u76d8\u4fe1\u606f\uff0c\u78c1\u76d8\u5206\u533a\u3001\u4f7f\u7528\u7387\u548cIO\uff1b</li> <li>\u7f51\u7edc\u63a5\u53e3\u548c\u7f51\u7edc\u8fde\u63a5\u4fe1\u606f\uff1b</li> <li>\u8fdb\u7a0b\u7684\u8be6\u7ec6\u4fe1\u606f\uff1b</li> </ul>"},{"location":"languages/python/basic.html#_3","title":"\u7c7b","text":""},{"location":"languages/python/basic.html#super","title":"super","text":"<p>https://mozillazg.com/2016/12/python-super-is-not-as-simple-as-you-thought.html</p> <ul> <li> <p>Python 3 \u53ef\u4ee5\u4f7f\u7528\u76f4\u63a5\u4f7f\u7528 super().xxx \u4ee3\u66ff super(Class, self).xxx</p> </li> <li> <p>super \u5305\u542b\u4e86\u4e24\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u4fe1\u606f: \u4e00\u4e2a MRO(Method Resolution Order) \u5217\u8868\u4ee5\u53ca MRO \u4e2d\u7684\u4e00\u4e2a\u7c7b\u3002\u5f53\u4ee5\u5982\u4e0b\u65b9\u5f0f\u8c03\u7528 super \u65f6: super(a_type, obj)  MRO \u5217\u8868\u6307\u7684\u662f type(obj) \u7684 MRO \u5217\u8868, MRO \u4e2d\u7684\u90a3\u4e2a\u7c7b\u5c31\u662f a_type , \u540c\u65f6 isinstance(obj, a_type) == True \u3002</p> </li> <li> <p>\u4e3e\u4e2a\u6817\u5b50, \u6709\u4e2a MRO \u5217\u8868:</p> </li> </ul> <p>[A, B, C, D, E, object]</p> <p>\u4e0b\u9762\u7684\u8c03\u7528:</p> <p>super(C, A).foo()</p> <p>super \u53ea\u4f1a\u4ece C \u4e4b\u540e\u67e5\u627e\uff0c\u5373: \u53ea\u4f1a\u5728 D \u6216 E \u6216 object \u4e2d\u67e5\u627e foo \u65b9\u6cd5\u3002</p>"},{"location":"languages/python/basic.html#atexit","title":"AtExit","text":"<p>python atexit \u6a21\u5757\u5b9a\u4e49\u4e86\u4e00\u4e2a register \u51fd\u6570\uff0c\u7528\u4e8e\u5728 python \u89e3\u91ca\u5668\u4e2d\u6ce8\u518c\u4e00\u4e2a\u9000\u51fa\u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u5728\u89e3\u91ca\u5668\u6b63\u5e38\u7ec8\u6b62\u65f6\u81ea\u52a8\u6267\u884c,\u4e00\u822c\u7528\u6765\u505a\u4e00\u4e9b\u8d44\u6e90\u6e05\u7406\u7684\u64cd\u4f5c\u3002 atexit \u6309\u6ce8\u518c\u7684\u76f8\u53cd\u987a\u5e8f\u6267\u884c\u8fd9\u4e9b\u51fd\u6570; \u4f8b\u5982\u6ce8\u518cA\u3001B\u3001C\uff0c\u5728\u89e3\u91ca\u5668\u7ec8\u6b62\u65f6\u6309\u987a\u5e8fC\uff0cB\uff0cA\u8fd0\u884c\u3002</p> <p>Note\uff1a\u5982\u679c\u7a0b\u5e8f\u662f\u975e\u6b63\u5e38crash\uff0c\u6216\u8005\u901a\u8fc7os._exit()\u9000\u51fa\uff0c\u6ce8\u518c\u7684\u9000\u51fa\u51fd\u6570\u5c06\u4e0d\u4f1a\u88ab\u8c03\u7528\u3002</p>"},{"location":"languages/python/basic.html#_4","title":"\u4f7f\u7528\u65b9\u5f0f","text":"<pre><code>from atexit import register\n</code></pre> <p>\u88c5\u9970\u5668 @register \u6216\u8005register\u8c03\u7528</p>"},{"location":"languages/python/cython.html","title":"Cython","text":"<p>Cython is an optimising static compiler for both the Python programming language and the extended Cython programming language (based on Pyrex). It makes writing C extensions for Python as easy as Python itself.</p> <p>Cython\u5b9a\u4e49\u5355\u72ec\u7684\u4e00\u95e8\u8bed\u8a00\uff0c\u4e13\u95e8\u7528\u6765\u5199\u5728Python\u91cc\u9762import\u7528\u7684\u6269\u5c55\u5e93\u3002\u672c\u8eab\u662f\u4e2apython \u5305\u3002</p>"},{"location":"languages/python/cython.html#_1","title":"\u7f16\u8bd1","text":"<p>Cython \u4f1a\u5148\u628a .PXD,    .PY,   .PYW,  .PYX \u6587\u4ef6\u8f6c\u6362\u6210 .C \u4e2d\u95f4\u4ee3\u7801\uff0c \u518d\u7f16\u8bd1\u6210 windows\u4e2d.pyd\u548clinux\u4e2d.so\u6587\u4ef6\u3002</p> <p>cython</p> <ul> <li>\u5c06<code>py</code>\u6216<code>pyx</code>\u6587\u4ef6\u7f16\u8bd1\u6210C/C++\u6587\u4ef6\uff1b</li> </ul> <p>cythonize</p> <pre><code># \u751f\u6210.c \u548c.so \u6587\u4ef6\ncythonize -a -i yourmod.pyx\n</code></pre> <ul> <li>\u5c06<code>py</code>\u6216<code>pyx</code>\u6587\u4ef6\u7f16\u8bd1\u6210C/C++\u6587\u4ef6\uff0c\u5c06C/C++\u6587\u4ef6\u7f16\u8bd1\u6210\u6269\u5c55\u6a21\u5757\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ecepython\u4e2d\u5bfc\u5165\u3002</li> <li>\u63a5\u6536\u591a\u4e2a\u6e90\u6587\u4ef6\u548cglob\u6a21\u5f0f\u5982<code>**/*.pyx</code></li> </ul>"},{"location":"languages/python/cython.html#pyx","title":"pyx\u6587\u4ef6","text":"<p>Cython\u6e90\u7801\u6587\u4ef6</p>"},{"location":"languages/python/cython.html#pxd","title":"pxd\u6587\u4ef6","text":"<p>Cython\u5934\u6587\u4ef6\u3002</p>"},{"location":"languages/python/cython.html#pyd","title":"pyd\u6587\u4ef6","text":"<p>.pyd \u6587\u4ef6\u662f\u7531\u975e Python\u7684\u7f16\u7a0b\u8bed\u8a00\u7f16\u5199 (\u6216\u76f4\u63a5\u628a .py \u6587\u4ef6\u8f6c\u6362\u6210 .c \u4e2d\u95f4\u6587\u4ef6) \u7f16\u8bd1\u751f\u6210\u7684 Python \u6269\u5c55\u6a21\u5757\uff0c\u662f\u7c7b\u4f3c .so, .dll \u52a8\u6001\u94fe\u63a5\u5e93\u7684\u4e00\u79cd Python \u6587\u4ef6\u3002</p> <p>Cython \u53ef\u5c06\u4e2a\u4eba\u57fa\u4e8e Python \u8bed\u8a00\u7f16\u5199\u7684 Python \u6a21\u5757\u7f16\u8bd1\u6210\u5177\u6709 C \u8bed\u8a00\u7279\u6027\u7684 .pyd \u6587\u4ef6\u3002</p>"},{"location":"languages/python/cython.html#_2","title":"Cython","text":""},{"location":"languages/python/pip.html","title":"Pip","text":""},{"location":"languages/python/pip.html#_1","title":"\u6e90\u4fee\u6539","text":"<p>pip install jpype1 -i https://pypi.tuna.tsinghua.edu.cn/simple</p> <p>https://pypi.douban.com/simple/ </p>"},{"location":"languages/python/pip.html#pip-install","title":"pip install \u9ed8\u8ba4\u5b89\u88c5\u8def\u5f84\u4fee\u6539","text":"<pre><code>python -m site\n\nUSER_BASE python.exe\u542f\u52a8\u7a0b\u5e8f\u8def\u5f84\nUSER_SITE \u4f9d\u8d56\u5b89\u88c5\u5305\u57fa\u7840\u8def\u5f84\n\n# \u67e5\u770b\u5bf9\u5e94\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\npython -m site -help\n</code></pre>"},{"location":"languages/python/profile.html","title":"Profile","text":"<p>[toc]</p>"},{"location":"languages/python/profile.html#python","title":"Python\u6027\u80fd\u5206\u6790\u5de5\u5177","text":""},{"location":"languages/python/profile.html#profile","title":"profile","text":"<p>\u7eafpython\u8bed\u8a00\u5b9e\u73b0\uff0c\u8fd4\u56de\u51fd\u6570\u6574\u4f53\u635f\u8017\u3002</p>"},{"location":"languages/python/profile.html#cprofile","title":"cProfile","text":"<p>cProfile\u662f\u6807\u51c6\u7248Python\u89e3\u91ca\u5668\u9ed8\u8ba4\u7684\u6027\u80fd\u5206\u6790\u5668\u3002</p> <p>cProfile\u662f\u4e00\u79cd\u786e\u5b9a\u6027\u5206\u6790\u5668\uff0c\u53ea\u6d4b\u91cfCPU\u65f6\u95f4\uff0c\u4e0d\u5173\u5fc3\u5185\u5b58\u3002</p> <p>\u540cprofile\uff0c\u90e8\u5206\u5b9e\u73b0native\u5316\uff0c\u8fd4\u56de\u51fd\u6570\u6574\u4f53\u635f\u8017\u3002</p> <pre><code>python -m cProfile del.py\n</code></pre>"},{"location":"languages/python/profile.html#line-profile","title":"Line Profile","text":"<p>\u4ee3\u7801\u884c\u7ea7\u522b\u7684CPU\u65f6\u95f4\u76d1\u63a7</p> <p><code>pip install line_profiler</code></p>"},{"location":"languages/python/profile.html#memory-profiler","title":"Memory Profiler","text":"<p>\u83b7\u53d6\u8fdb\u7a0b\u7684\u5185\u5b58\u7533\u8bf7\uff08\u800c\u4e0d\u662f\u5b9e\u9645\u4f7f\u7528\uff09\u7684\u6570\u91cf\uff0c\u652f\u6301\u884c\u7ea7\u522b\u7684\u76d1\u63a7\uff1b</p>"},{"location":"languages/python/profile.html#scalene-cpugpu","title":"Scalene\uff1a\u5185\u5b58 / CPU/GPU \u5206\u6790\u5668","text":"<p>Scalene: a high-performance CPU, GPU and memory profiler for Python.</p>"},{"location":"languages/python/profile.html#_1","title":"\u529f\u80fd","text":"<ul> <li>\u884c\u548c\u51fd\u6570\uff1a\u62a5\u544a\u6709\u5173\u6574\u4e2a\u51fd\u6570\u548c\u6bcf\u4e2a\u72ec\u7acb\u4ee3\u7801\u884c\u7684\u4fe1\u606f\uff1b</li> <li>\u7ebf\u7a0b\uff1a\u652f\u6301 Python \u7ebf\u7a0b\uff1b</li> <li>\u591a\u8fdb\u7a0b\u5904\u7406\uff1a\u652f\u6301\u4f7f\u7528 multiprocessing \u5e93\uff1b</li> <li>Python \u4e0e C \u7684\u65f6\u95f4\uff1aScalene \u7528\u5728 Python \u4e0e\u672c\u673a\u4ee3\u7801\uff08\u4f8b\u5982\u5e93\uff09\u4e0a\u7684\u65f6\u95f4\uff1b</li> <li>\u7cfb\u7edf\u65f6\u95f4\uff1a\u533a\u5206\u7cfb\u7edf\u65f6\u95f4\uff08\u4f8b\u5982\uff0c\u4f11\u7720\u6216\u6267\u884c I / O \u64cd\u4f5c\uff09\uff1b</li> <li>GPU\uff1a\u62a5\u544a\u5728\u82f1\u4f1f\u8fbe GPU \u4e0a\u4f7f\u7528\u7684\u65f6\u95f4\uff08\u5982\u679c\u6709\uff09\uff1b</li> <li>\u590d\u5236\u91cf\uff1a\u62a5\u544a\u6bcf\u79d2\u8981\u590d\u5236\u7684\u6570\u636e\u91cf\uff1b</li> <li>\u6cc4\u6f0f\u68c0\u6d4b\uff1a\u81ea\u52a8\u67e5\u660e\u53ef\u80fd\u9020\u6210\u5185\u5b58\u6cc4\u6f0f\u7684\u7ebf\u8def\u3002</li> </ul>"},{"location":"languages/python/profile.html#_2","title":"\u4f7f\u7528","text":"<p>\u5b89\u88c5\uff1a</p> <pre><code>pip install scalene\n</code></pre> <p>Scalene \u7684\u4f7f\u7528\u975e\u5e38\u7b80\u5355\uff1a</p> <pre><code>scalene &lt;yourapp.py&gt;\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528\u9b54\u672f\u547d\u4ee4\u5728 Jupyter notebook \u4e2d\u4f7f\u7528\u5b83\uff1a</p> <pre><code>%load_ext scalene\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\u5982\u56fe\uff1a</p> <p></p>"},{"location":"languages/python/str.html","title":"\u5b57\u7b26\u4e32","text":""},{"location":"languages/python/str.html#format","title":"format","text":"<pre><code>a = \"I'm %s. I'm %d year old\" % ('Vamei', 99)\n# or\n\"I'm %(name)s. I'm %(age)d year old\" % {'name':'Vamei', 'age':99}\n# or\n\"I'm {name}. I'm {age} year old\".format(name='Vamei', age=99)\n# or\nname='Vamei', age=99\nf\"I'm {name}. I'm {age} year old\"\n</code></pre> \u683c\u5f0f %s  \u5b57\u7b26\u4e32 (\u91c7\u7528str()\u7684\u663e\u793a) %d  \u5341\u8fdb\u5236\u6574\u6570 %e  \u6307\u6570 (\u57fa\u5e95\u5199\u4e3ae) %g  \u6307\u6570(e)\u6216\u6d6e\u70b9\u6570 (\u6839\u636e\u663e\u793a\u957f\u5ea6) %r  \u5b57\u7b26\u4e32 (\u91c7\u7528repr()\u7684\u663e\u793a) %i  \u5341\u8fdb\u5236\u6574\u6570 %E  \u6307\u6570 (\u57fa\u5e95\u5199\u4e3aE) %G  \u6307\u6570(E)\u6216\u6d6e\u70b9\u6570 (\u6839\u636e\u663e\u793a\u957f\u5ea6) %c  \u5355\u4e2a\u5b57\u7b26 %o  \u516b\u8fdb\u5236\u6574\u6570 %f  \u6d6e\u70b9\u6570 %%  \u5b57\u7b26\"%\" %b  \u4e8c\u8fdb\u5236\u6574\u6570 %x  \u5341\u516d\u8fdb\u5236\u6574\u6570 %F  \u6d6e\u70b9\u6570\uff0c\u4e0e\u4e0a\u76f8\u540c"},{"location":"languages/python/str.html#string-r-b-u-f","title":"string \u5f00\u5934r b u f","text":"<pre><code># bytes\u5b57\u8282\u7b26\uff0c\u6253\u5370\u4ee5b\u5f00\u5934\nb'input\\n'\n# \u975e\u8f6c\u4e49\u539f\u751f\u5b57\u7b26\uff0c\u7ecf\u5904\u7406'\\n'\u53d8\u6210\u4e86'\\\\'\u548c'n'\u3002\u4e5f\u5c31\u662f\\n\u8868\u793a\u7684\u662f\u4e24\u4e2a\u5b57\u7b26\uff0c\u800c\u4e0d\u662f\u6362\u884c\u3002\nr'input\\n'               \n# unicode\u7f16\u7801\u5b57\u7b26\uff0cpython3\u9ed8\u8ba4\u5b57\u7b26\u4e32\u7f16\u7801\u65b9\u5f0f\u3002\nu'input\\n'          \n# \u53d8\u91cf\u66ff\u6362\nf\"I'm {name}. I'm {age} year old\" \n</code></pre> <p>\u5982\u679c\u8981\u5c06\u73b0\u6709\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u539f\u59cb\u5b57\u7b26\u4e32\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u50cf\u4e0b\u9762\u90a3\u6837\u91cd\u65b0\u5206\u914d </p> <pre><code>s1 = \"welcome\\tto\\tPython\" \nraw_s1 = \"%r\" % s1 \nprint(raw_s1) # \u4f1a\u6253\u5370 welcome\\tto\\tPython\n</code></pre>"},{"location":"languages/python/uml.html","title":"Python\u751f\u6210UML\u7c7b\u56fe","text":""},{"location":"languages/python/uml.html#pyreverse","title":"Pyreverse","text":"<p>pyreverse\u80fd\u65b9\u4fbf\u7684\u751f\u6210uml\u7c7b\u56fe\uff0cpylint\u91cc\u81ea\u5e26\u4e86pyreverse\u8fd9\u4e2a\u5de5\u5177\u3002\u4f7f\u7528pip\u5b89\u88c5pylint <code>pip install pylint</code></p>"},{"location":"languages/python/jupyter/jupyter-hub.html","title":"Jupyter hub","text":"<p>[toc]</p>"},{"location":"languages/python/jupyter/jupyter-hub.html#jupyter-hub","title":"Jupyter-Hub","text":"<p>\u7cfb\u7edf\u7ec4\u4ef6\uff1a</p> <ul> <li>a Hub (tornado process) that is the heart of JupyterHub</li> <li>a configurable http proxy (node-http-proxy) that receives the requests from the client\u2019s browser</li> <li>multiple single-user Jupyter notebook servers (Python/IPython/tornado) that are monitored by Spawners</li> <li>an authentication class that manages how users can access the system</li> </ul>"},{"location":"languages/python/jupyter/jupyter-hub.html#_1","title":"\u539f\u7406","text":"<p>\u542f\u52a8jupyterlab\u65f6\uff0c\u5982\u679c\u7528\u6237\u4e0d\u5b58\u5728\uff0c\u9ed8\u8ba4\u662f\u4f1a\u521b\u5efa\uff1f</p>"},{"location":"languages/python/jupyter/jupyter-hub.html#authenticator","title":"Authenticator","text":"<p>\u9ed8\u8ba4\u4f7f\u7528PAMAuthenticator\uff0c\u7528\u7528\u6237\u540d\u548c\u5bc6\u7801\u8fdb\u884cLinux\u7cfb\u7edf\u7528\u6237\u8ba4\u8bc1\u3002</p> <p>LocalAuthenticator/PAMAuthenticator\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u914d\u7f6e\uff0c\u5141\u8bb8\u81ea\u52a8\u521b\u5efa\u7cfb\u7edf\u7528\u6237\uff1a</p> <pre><code>c.LocalAuthenticator.create_system_users = True\n</code></pre>"},{"location":"languages/python/jupyter/jupyter-hub.html#spawner","title":"Spawner","text":"<p>\u9ed8\u8ba4\u662fLocalProcessSpawner\uff0c\u4f7f\u7528\u7cfb\u7edf\u7528\u6237\u542f\u52a8jupyter_labhub\u8fdb\u7a0b\uff1b</p>"},{"location":"languages/python/jupyter/jupyter-hub.html#_2","title":"\u5b89\u88c5","text":"<p>Install JupyterHub and JupyterLab from the ground up</p>"},{"location":"languages/python/jupyter/jupyter-hub.html#custom-proxy","title":"Custom Proxy","text":"<p>configurable-http-proxy (CHP)</p> <p>In general, for a proxy to be usable by JupyterHub, it must:</p> <ol> <li>support websockets without prior knowledge of the URL where websockets may occur</li> <li>support trie-based routing (i.e. allow different routes on <code>/foo</code> and <code>/foo/bar</code> and route based on specificity)</li> <li>adding or removing a route should not cause existing connections to drop</li> </ol> <p>Optionally, if the JupyterHub deployment is to use host-based routing, the Proxy must additionally support routing based on the Host of the request.</p>"},{"location":"languages/python/jupyter/jupyter-hub.html#custom-authenticators","title":"Custom Authenticators","text":"<p>REMOTE_USER Authenticator </p>"},{"location":"languages/python/jupyter/jupyter-hub.html#custom-spawner","title":"Custom Spawner","text":""},{"location":"languages/python/jupyter/jupyter-hub.html#systemdspawner","title":"SystemdSpawner","text":"<pre><code># systemd v211\u4ee5\u4e0a\uff0c\u652f\u6301\u5b89\u5168\u7279\u6027\u9700\u8981systemd v227\n$ systemctl --version | head -1\nsystemd 231\n</code></pre> <ul> <li>\u652f\u6301cpu/memory\u914d\u7f6e\uff1acgroup\uff1b</li> <li>\u652f\u6301\u52a8\u6001\u7528\u6237\uff0c\u4e0d\u9700\u8981\u672c\u5730\u6709\u5bf9\u5e94\u7684\u7cfb\u7edf\u7528\u6237\uff1b(systemd 235\u4ee5\u4e0a)</li> <li>http://0pointer.net/blog/dynamic-users-with-systemd.html</li> <li>\u914d\u7f6e\u72b6\u6001\u5b58\u50a8\u7684\u76ee\u5f55\uff0c\u4fdd\u5b58\u4f1a\u8bdd\u72b6\u6001</li> </ul>"},{"location":"languages/python/jupyter/jupyter-hub.html#yarnspawner","title":"YarnSpawner","text":"<p>\u5c06spanwer\u542f\u52a8\u5728Yarn\u4e0a\u3002</p> <ul> <li>\u7528\u6237\u521b\u5efa\u95ee\u9898\uff1ajupyterlab\u4e2d\u7684\u6587\u4ef6\u5b58\u50a8\u7684\u8def\u5f84\uff1f</li> <li></li> <li> <p>\u4ee3\u7406\u7528\u6237\u673a\u5236\uff1ahadoop\u5141\u8bb8\u4f7f\u7528\u7279\u5b9a\u7528\u6237\u5982'juyterhub'\u6a21\u62df\u4efb\u4f55\u7528\u6237\uff1b</p> </li> <li> <p>\u72b6\u6001\u5b58\u50a8\u95ee\u9898\uff1a</p> </li> <li> <p>jupyter-hdfscm \u5c06 notebook \u5b58\u50a8\u5728HDFS\u4e0a\uff1b</p> </li> <li> <p>Python\u73af\u5883\u95ee\u9898\uff1a</p> </li> <li>\u6bcf\u4e2a\u8282\u70b9\u4e00\u6837\u7684Python\u73af\u5883\uff1b</li> <li>\u6216\u8005Conda\u6253\u5305\u73af\u5883\uff0c\u4e0a\u4f20\u5230HDFS\uff0c\u7136\u540e\u4f5c\u4e3aContainer\u8d44\u6e90\u88ab\u4e0b\u8f7d\uff1b</li> </ul>"},{"location":"languages/python/packages/java_python.html","title":"Java/Python\u4e92\u76f8\u8c03\u7528","text":""},{"location":"languages/python/packages/java_python.html#jpype","title":"JPype","text":"<p>JPype is cross language bridge to allow Python programs full access to Java class libraries.</p>"},{"location":"languages/python/packages/java_python.html#pyjnius","title":"PyJnius","text":"<p>A Python module to access Java classes as Python classes using the Java Native Interface (JNI)</p>"},{"location":"languages/python/packages/java_python.html#_1","title":"\u5165\u95e8","text":"<pre><code>pip install pyjnius\n</code></pre> <pre><code>&gt;&gt;&gt; from jnius import autoclass\n&gt;&gt;&gt; autoclass('java.lang.System').out.println('Hello world')\nHello world\n\n&gt;&gt;&gt; Stack = autoclass('java.util.Stack')\n&gt;&gt;&gt; stack = Stack()\n&gt;&gt;&gt; stack.push('hello')\n&gt;&gt;&gt; stack.push('world')\n&gt;&gt;&gt; print stack.pop()\nworld\n&gt;&gt;&gt; print stack.pop()\nhello\n</code></pre>"},{"location":"languages/python/packages/java_python.html#py4j","title":"Py4j","text":"<p>Py4J enables Python programs to dynamically access arbitrary Java objects, also enables Java programs to call back Python objects.</p> <p>Python for Java\uff0c\u901a\u8fc7 socket \u8fdb\u884c\u6d88\u606f\u53d1\u9001\uff0c\u4f7f\u5f97 Python \u4e2d\u53ef\u4ee5\u8c03\u7528 Java\u4ee3\u7801 / Java \u4e5f\u53ef\u4ee5\u56de\u8c03Python\u5bf9\u8c61\u3002</p>"},{"location":"languages/python/packages/java_python.html#_2","title":"\u5165\u95e8","text":"<p>Java \u7aef\u542f\u52a8\u670d\u52a1\uff1a</p> <pre><code>GatewayServer gatewayServer = new GatewayServer(new EntryPoint(), 25555);\ngatewayServer.start();\nSystem.out.println(\"Gateway Server Started\");\n</code></pre> <p>Python\u7aef\uff1a</p> <pre><code>from py4j.java_gateway import JavaGateway, GatewayParameters\n\ngateway = JavaGateway(gateway_parameters=GatewayParameters(port=25555))\n# \u83b7\u53d6String\u7c7b\u578b\nJString = gateway.jvm.java.lang.String\n\n# \u8f6c\u6362\u6210Python\u4e2d\u7684\u5b57\u7b26\u4e32\na = JString(\"213\")\n</code></pre> <p>TODO: Java \u56de\u8c03 Python</p>"},{"location":"languages/python/packages/java_python.html#_3","title":"\u5e8f\u5217\u5316","text":""},{"location":"languages/python/packages/java_python.html#netrazorvinepicklehttpsgithubcomirmenpickle","title":"<code>net.razorvine.pickle</code>(https://github.com/irmen/pickle)","text":"<p>Java and .NET library for Python's pickle serialization protocol</p> <p>Apache Spark\u91c7\u7528\u8be5\u5e93\u5c06Java\u5bf9\u8c61\u5e8f\u5217\u5316\u6210Pickle\u683c\u5f0f\uff0c\u7136\u540ePython\u8fdb\u884c\u8bfb\u53d6\u3002</p> <p>Java \u8bfb\u5199 pickle \uff08Python\u5e8f\u5217\u5316\u683c\u5f0f\uff09\u6587\u4ef6\u3002</p> <p>Pickle protocol version support: </p> <ul> <li>reading: 0,1,2,3,4,5;</li> <li>writing: 2. </li> </ul>"},{"location":"languages/python/packages/java_python.html#python-to-java-unpickling","title":"Python to Java (unpickling)","text":"PYTHON JAVA None null bool boolean int int long long or BigInteger (depending on size) string String unicode String complex net.razorvine.pickle.objects.ComplexNumber datetime.date java.util.Calendar datetime.datetime java.util.Calendar datetime.time net.razorvine.pickle.objects.Time datetime.timedelta net.razorvine.pickle.objects.TimeDelta float double (float isn't used) array.array array of appropriate primitive type (char, int, short, long, float, double) list java.util.List tuple Object[] set java.util.Set dict java.util.Map bytes byte[] bytearray byte[] decimal BigDecimal custom class Map (dict with class attributes including its name in \"class\") Pyro4.core.URI net.razorvine.pyro.PyroURI Pyro4.core.Proxy net.razorvine.pyro.PyroProxy Pyro4.errors.* net.razorvine.pyro.PyroException Pyro4.utils.flame.FlameBuiltin net.razorvine.pyro.FlameBuiltin Pyro4.utils.flame.FlameModule net.razorvine.pyro.FlameModule Pyro4.utils.flame.RemoteInteractiveConsole net.razorvine.pyro.FlameRemoteConsole"},{"location":"languages/python/packages/java_python.html#java-to-python-pickling","title":"Java to Python (pickling)","text":"JAVA PYTHON null None boolean bool byte int char str/unicode (length 1) String str/unicode double float float float int int short int BigDecimal decimal BigInteger long any array array if elements are primitive type (else tuple) Object[] tuple (cannot contain self-references) byte[] bytearray java.util.Date datetime.datetime java.util.Calendar datetime.datetime java.sql.Date datetime.date java.sql.Time datetime.time java.sql.Timestamp datetime.datetime Enum the enum value as string java.util.Set set Map, Hashtable dict Vector, Collection list Serializable treated as a JavaBean, see below. JavaBean dict of the bean's public properties + <code>__class__</code> for the bean's type. net.razorvine.pyro.PyroURI Pyro4.core.URI net.razorvine.pyro.PyroProxy cannot be pickled."},{"location":"languages/python/packages/lightning.html","title":"Lightning","text":"<p>http://lightning-viz.org/clients/#python</p>"},{"location":"languages/python/packages/mars.html","title":"Mars","text":"<p>alibaba\u5f00\u6e90\uff1ahttps://github.com/mars-project/mars</p> <p>Mars \u662f\u57fa\u4e8e\u5f20\u91cf\u7684\uff0c\u7528\u4e8e\u8fdb\u884c\u5927\u89c4\u6a21\u6570\u636e\u8ba1\u7b97\u7684\u7edf\u4e00\u8ba1\u7b97\u6846\u67b6\u3002</p> <p>Mars \u5229\u7528\u5e76\u884c\u548c\u5206\u5e03\u5f0f\u6280\u672f\u52a0\u901f numpy\u3001pandas\u3001scikit-learn \u548c Python \u51fd\u6570\u3002</p>"},{"location":"languages/python/packages/mars.html#_1","title":"\u67b6\u6784","text":""},{"location":"languages/python/packages/poetry.html","title":"Poetry","text":"<p>Python \u5305\u7ba1\u7406\u5de5\u5177</p>"},{"location":"languages/python/packages/poetry.html#_1","title":"\u73af\u5883\u7ba1\u7406","text":"<p>\u9ed8\u8ba4\u4f7f\u7528 virtualenv \u521b\u5efa\u865a\u62df\u73af\u5883\u3002</p> <ul> <li>\u5173\u95ed\u81ea\u52a8\u521b\u5efa env</li> </ul> <pre><code>poetry config virtualenvs.create false\n</code></pre> <p>\u7f13\u5b58\u9ed8\u8ba4\u4f4d\u7f6e<code>cache-dir</code></p> <pre><code>macOS: ~/Library/Caches/pypoetry\nWindows: C:\\Users\\&lt;username&gt;\\AppData\\Local\\pypoetry\\Cache\nUnix: ~/.cache/pypoetry\n</code></pre>"},{"location":"languages/python/packages/poetry.html#_2","title":"\u4f7f\u7528","text":"<pre><code>poetry new poetry-demo\n</code></pre> <p>\u76ee\u5f55\u7ed3\u6784\u7ec4\u7ec7\u5982\u4e0b\uff1a</p> <pre><code>poetry-demo\n\u251c\u2500\u2500 pyproject.toml\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 poetry_demo\n\u2502   \u2514\u2500\u2500 __init__.py\n\u2514\u2500\u2500 tests\n    \u2514\u2500\u2500 __init__.py\n</code></pre> <p>\u914d\u7f6e\u8bf4\u660e\u6587\u4ef6</p> <pre><code>[tool.poetry]\nname = \"poetry-demo\"\nversion = \"0.1.0\"\ndescription = \"\"\nauthors = [\"S\u00e9bastien Eustace &lt;sebastien@eustace.io&gt;\"]\nreadme = \"README.md\"\npackages = [{include = \"poetry_demo\"}]\n\n[tool.poetry.dependencies]\npython = \"^3.7\"\n\n\n[build-system]\nrequires = [\"poetry-core\"]\nbuild-backend = \"poetry.core.masonry.api\"\n</code></pre> <p>\u5b89\u88c5\u4f9d\u8d56</p> <pre><code>poetry install\n</code></pre>"},{"location":"languages/python/packages/resource_limit.html","title":"\u8d44\u6e90\u9650\u5236","text":""},{"location":"languages/python/packages/resource_limit.html#resource","title":"Resource","text":"<p><code>setrlimit()</code>\u51fd\u6570\u9650\u5236\u8d44\u6e90\u4f7f\u7528\uff0c\u8bbe\u7f6e\u7279\u5b9a\u8d44\u6e90\u4e0a\u9762\u7684\u8f6f\u9650\u5236\u548c\u786c\u9650\u5236\u3002</p> <p>\u8f6f\u9650\u5236\u662f\u4e00\u4e2a\u503c\uff0c\u5f53\u8d85\u8fc7\u8fd9\u4e2a\u503c\u7684\u65f6\u5019\u64cd\u4f5c\u7cfb\u7edf\u901a\u5e38\u4f1a\u53d1\u9001\u4e00\u4e2a\u4fe1\u53f7\u6765\u9650\u5236\u6216\u901a\u77e5\u8be5\u8fdb\u7a0b\u3002 \u786c\u9650\u5236\u662f\u7528\u6765\u6307\u5b9a\u8f6f\u9650\u5236\u80fd\u8bbe\u5b9a\u7684\u6700\u5927\u503c\u3002\u901a\u5e38\u6765\u8bb2\uff0c\u8fd9\u4e2a\u7531\u7cfb\u7edf\u7ba1\u7406\u5458\u901a\u8fc7\u8bbe\u7f6e\u7cfb\u7edf\u7ea7\u53c2\u6570\u6765\u51b3\u5b9a\u3002</p> <ul> <li>RLIMIT_AS\uff1amaximum area (in bytes) of address space</li> <li>RLIMIT_RSS\uff1amaximum resident set size</li> <li>RLIMIT_VMEM\uff1alargest area of mapped memory</li> </ul>"},{"location":"languages/python/packages/resource_limit.html#cgroups","title":"Cgroups","text":"<p>Cgroups \uff1aA library to manage cgroups Linux kernel feature.</p> <ul> <li>\u901a\u8fc7cgroups\u6765\u9650\u5236cpu\u548cmemory\u7684\u4f7f\u7528\uff1b</li> <li>\u652f\u6301\u5b9e\u65f6\u4fee\u6539\u5e76\u751f\u6548\uff1b</li> </ul>"},{"location":"languages/python/packages/resource_limit.html#_2","title":"\u5b89\u88c5","text":"<p><code>pip install cgroups</code></p>"},{"location":"languages/python/packages/resource_limit.html#_3","title":"\u4f7f\u7528","text":"<pre><code>import os\nimport subprocess\n\nfrom cgroups import Cgroup\n\n# First we create the cgroup 'charlie' and we set it's cpu and memory limits\ncg = Cgroup('charlie')\ncg.set_cpu_limit(50)\ncg.set_memory_limit(500)\n\n# Then we a create a function to add a process in the cgroup\ndef in_my_cgroup():\n    pid  = os.getpid()\n    cg = Cgroup('charlie')\n    cg.add(pid)\n\n# And we pass this function to the preexec_fn parameter of the subprocess call\n# in order to add the process to the cgroup\np1 = subprocess.Popen(['worker_1'], preexec_fn=in_my_cgroup)\np2 = subprocess.Popen(['worker_2'], preexec_fn=in_my_cgroup)\np3 = subprocess.Popen(['worker_3'], preexec_fn=in_my_cgroup)\n\n# Processes worker_1, worker_2, and worker_3 are now in the cgroup 'charlie'\n# and all limits of this cgroup apply to them\n\n# We can change the cgroup limit while those process are still running\ncg.set_cpu_limit(80)\n\n# And of course we can add other applications to the cgroup\n# Let's say we have an application running with pid 27033\ncg.add(27033)\n</code></pre>"},{"location":"languages/scala/akka.html","title":"Akka","text":"<p>[toc]</p>"},{"location":"languages/scala/akka.html#akka","title":"Akka","text":"<p>Scala/Java \u7684\u7f51\u7edc\u901a\u4fe1\u5e93\uff0c\u4eceScala 2.11.0\u5f00\u59cb\uff0cScala Actors\u5e93\u5df2\u7ecf\u5e9f\u5f03\u3002</p> <p>Akka\u7684\u54f2\u5b66\u662f\u57fa\u4e8eEnd to End Argument[1]\u8fd9\u4e2a\u4e8b\u5b9e\u7684\uff0c\u5373\uff1a\u5728\u5206\u5e03\u5f0f\u73af\u5883\u4e2d\uff0creliable\u7684\u901a\u4fe1\u9700\u8981\u5728application\u5c42\u6765\u786e\u4fdd\uff0c\u4e2d\u95f4\u4ef6\u5c42\u6216\u8005infrastructure\u53ea\u80fd\u63d0\u4f9b\u6548\u7387\u4e0a\u7684\u5e2e\u52a9\uff0c\u800c\u7edd\u5bf9\u65e0\u6cd5\u4fdd\u8bc1reliability\uff1b</p> <p>\u4ee3\u7801\u89c1\"scalaactorakka.zip\"</p>"},{"location":"languages/scala/basic.html","title":"\u57fa\u7840","text":""},{"location":"languages/scala/basic.html#eq-equals","title":"==, eq, equals","text":"<p>\u6839\u636e\u5b98\u65b9API\u7684\u5b9a\u4e49\uff1a</p> <pre><code>// The expression x == that is equivalent to if (x eq null) that eq null else x.equals(that).\nfinal def ==(arg0: Any): Boolean\n\n// Tests whether the argument (that) is a reference to the receiver object (this).\nfinal def eq(arg0: AnyRef): Boolean\n\n// The equality method for reference types.\ndef equals(arg0: Any): Boolean\n</code></pre> <p>\u7b80\u8a00\u4e4b\uff0cequals\u65b9\u6cd5\u662f\u68c0\u67e5\u503c\u662f\u5426\u76f8\u7b49\uff0c\u800ceq\u65b9\u6cd5\u68c0\u67e5\u7684\u662f\u5f15\u7528\u662f\u5426\u76f8\u7b49\uff0c==\u5224\u65ad\u7684\u662f\u503c\u76f8\u7b49\u6216\u8005\u5f15\u7528\u76f8\u7b49</p> <p>Array() \u65b0\u5efa\u51fa\u6765\u7684\u5bf9\u8c61\u7684equals\u65b9\u6cd5\u662fObject\u7684\u65b9\u6cd5\uff0c\u8981\u901a\u8fc7sameElements\u65b9\u6cd5\uff0c arr1 sameElements arr2</p>"},{"location":"languages/scala/basic.html#sealed","title":"sealed","text":"<p>\u4fee\u9970class\u6216trait\uff1a\u4e0d\u80fd\u5728\u7c7b\u5b9a\u4e49\u7684\u6587\u4ef6\u4e4b\u5916\u5b9a\u4e49\u65b0\u7684\u5b50\u7c7b</p>"},{"location":"languages/scala/basic.html#option-either-try","title":"Option-Either-Try","text":"<p>Option\uff1aOption\u662f\u62bd\u8c61\u7c7b\uff0cSome\u548cNone\u662f\u5176\u5b50\u7c7b\u5b9e\u73b0\uff0c\u7528\u6765\u9632\u6b62\u7a7a\u6307\u9488\u8c03\u7528\u7684\u95ee\u9898\uff0c\u4e14\u65e0\u9700\u591a\u4f59\u7684 if \u5224\u65ad\u3002</p> <p>Try\uff1a\u5bf9\u4e8e\u53ef\u80fd\u629b\u51fa\u5f02\u5e38\u7684\u64cd\u4f5c\uff0c\u4f7f\u7528Try\u8fdb\u884c\u5c01\u88c5\uff0c\u5f97\u5230Try\u7684\u5b50\u7c7b Success \u6216 Failure \u3002</p> <p>Either\uff1a\u8868\u793a\u4e0d\u540c\u8f93\u5165\u4f1a\u5f97\u5230\u4e24\u4e2a\u4e0d\u540c\u7684\u7c7b\u578b Left\uff0c Right\u3002</p>"},{"location":"languages/scala/basic.html#case-class","title":"case-class","text":"<p>\u6837\u4f8b\u7c7b\uff08case class\uff09\u9002\u5408\u7528\u4e8e\u4e0d\u53ef\u53d8\u7684\u6570\u636e\u3002\u5b83\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u7c7b\uff0c\u80fd\u591f\u88ab\u4f18\u5316\u4ee5\u7528\u4e8e\u6a21\u5f0f\u5339\u914d\u3002</p> <ul> <li>\u521b\u5efa case class \u548c\u5b83\u7684\u4f34\u751f object</li> <li>\u5b9e\u73b0\u4e86 apply \u65b9\u6cd5\u8ba9\u4f60\u4e0d\u9700\u8981\u901a\u8fc7 new \u6765\u521b\u5efa\u7c7b\u5b9e\u4f8b</li> <li>\u9ed8\u8ba4\u4e3a\u4e3b\u6784\u9020\u51fd\u6570\u53c2\u6570\u5217\u8868\u7684\u6240\u6709\u53c2\u6570\u524d\u52a0 val</li> <li>\u6dfb\u52a0\u5929\u7136\u7684 hashCode\u3001equals \u548c toString \u65b9\u6cd5\u3002\u7531\u4e8e == \u5728 Scala \u4e2d\u603b\u662f\u4ee3\u8868 equals\uff0c\u6240\u4ee5 case class \u5b9e\u4f8b\u603b\u662f\u53ef\u6bd4\u8f83\u7684</li> <li>\u751f\u6210\u4e00\u4e2a <code>copy</code> \u65b9\u6cd5\u4ee5\u652f\u6301\u4ece\u5b9e\u4f8b a \u751f\u6210\u53e6\u4e00\u4e2a\u5b9e\u4f8b b\uff0c\u5b9e\u4f8b b \u53ef\u4ee5\u6307\u5b9a\u6784\u9020\u51fd\u6570\u53c2\u6570\u4e0e a \u4e00\u81f4\u6216\u4e0d\u4e00\u81f4</li> <li>\u7531\u4e8e\u7f16\u8bd1\u5668\u5b9e\u73b0\u4e86 unapply \u65b9\u6cd5\uff0c\u4e00\u4e2a case class \u652f\u6301\u6a21\u5f0f\u5339\u914d</li> </ul>"},{"location":"languages/scala/basic.html#case-object","title":"case-object","text":"<p>\u7c7b\u4e2d\u6709\u53c2\u548c\u65e0\u53c2\uff0c\u5f53\u7c7b\u6709\u53c2\u6570\u7684\u65f6\u5019\uff0c\u7528case class \uff0c\u5f53\u7c7b\u6ca1\u6709\u53c2\u6570\u7684\u65f6\u5019\u90a3\u4e48\u7528case object\u3002</p>"},{"location":"languages/scala/basic.html#try-catch","title":"try-catch","text":"<p>TODO: </p>"},{"location":"languages/scala/scala_style.html","title":"Scalastyle","text":"<p>Current Version 1.0.1</p> <p>Total 69 Rules</p>"},{"location":"languages/scala/scala_test.html","title":"Scala Test","text":""},{"location":"languages/scala/scala_test.html#maven","title":"Maven\u914d\u7f6e","text":""},{"location":"languages/scala/scala_test.html#funsuite","title":"FunSuite","text":""},{"location":"languages/scala/scala_test.html#beforeandafterall","title":"BeforeAndAfterAll","text":""},{"location":"languages/scala/packages/json.html","title":"JSON","text":"<p>scala\u4e2d\u8fdb\u884cjson\u8f6c\u6362\u7684\u65b9\u6cd5</p>"},{"location":"languages/scala/packages/json.html#json_1","title":"\u81ea\u5e26\u7684json","text":""},{"location":"languages/scala/packages/json.html#_1","title":"JSON","text":""},{"location":"languages/scala/packages/json.html#fastxml-jackson","title":"fastxml jackson","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.fasterxml.jackson.module&lt;/groupId&gt;\n    &lt;artifactId&gt;jackson-module-scala_2.13&lt;/artifactId&gt;\n    &lt;version&gt;2.10.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"machine_learning/AI_Frameworks.html","title":"\u5206\u5e03\u5f0f AI \u6846\u67b6","text":"<p>\u9664\u4e86\u539f\u751f\u7684\u5206\u5e03\u5f0fAI\u6846\u67b6\uff08\u5982TF\uff0cPytorch\uff09\uff0c\u8fd9\u91cc\u66f4\u6ce8\u91cd\u591a\u7528\u6237\u3001\u5206\u5e03\u5f0f\u3001\u8d44\u6e90\u7ba1\u7406\u3002</p> <p>TODO\uff1a</p> <ul> <li>\u4e2d\u77f3\u5316\u7684AI\u8d44\u6599\u6574\u7406</li> </ul> <p>\u57fa\u4e8eSpark\u7684\u6570\u636e\u5e76\u884c\u5316\u7684\u65b9\u5f0f\uff1a\u6a21\u578b\u5728\u6bcf\u4e2aworker\u90fd\u6709</p> <ul> <li> <p>\u540c\u6b65\u5747\u503c\u5316\uff08\u53c2\u6570\u670d\u52a1\u5668\uff09\uff1a\u5728N\u8f6e\u8fed\u4ee3\u540e\u7b80\u5355\u5747\u503c\u5316\u53c2\u6570</p> </li> <li> <p>N = 1\uff0c\u6027\u80fd\u5f00\u9500\u5927\uff1b</p> </li> <li>N \u503c\u5927\uff0c\u6bcf\u4e2a worker \u4e2d\u7684\u672c\u5730\u53c2\u6570\u4e4b\u95f4\u7684\u533a\u522b\u4f1a\u8fc7\u5927\uff0c\u5bfc\u81f4\u5e73\u5747\u5316\u540e\u7684\u6a21\u578b\u8f83\u5dee\uff08N \u4e2a\u4e0d\u540c\u5c40\u90e8\u6781\u5c0f\u503c\u7684\u5747\u503c\u4e0d\u80fd\u4fdd\u8bc1\u662f\u4e00\u4e2a\u5c40\u90e8\u6781\u5c0f\u503c\uff09\uff1b</li> <li> <p>\u6bcf10-20\u4e2aminibatch\uff08\u6bcf\u4e2a worker\uff09\u6392\u5e8f\u7684\u5e73\u5747\u5316\u5468\u671f\u4ecd\u7136\u53ef\u4ee5\u5f88\u597d\u7684\u6267\u884c\u3002</p> </li> <li> <p>\u5f02\u6b65\u66f4\u65b0\uff08\u53c2\u6570\u670d\u52a1\u5668\uff09\uff1a\u5728\u53c2\u6570\u5411\u91cf\u4e2d\u5f15\u5165\u5f02\u6b65\u66f4\u65b0</p> </li> <li> <p>\u8fc7\u671f\u68af\u5ea6\u95ee\u9898\uff1a\u68af\u5ea6\uff08\u66f4\u65b0\uff09\u7684\u8ba1\u7b97\u9700\u8981\u65f6\u95f4\uff0c\u5728\u4e00\u4e2a worker \u5b8c\u6210\u8fd9\u4e9b\u8ba1\u7b97\u5e76\u5c06\u7ed3\u679c\u5e94\u7528\u4e8e\u5168\u5c40\u53c2\u6570\u5411\u91cf\u524d\uff0c\u8fd9\u4e9b\u53c2\u6570\u53ef\u80fd\u5df2\u7ecf\u66f4\u65b0\u8fc7\u8bb8\u591a\u6b21</p> </li> </ul> <p></p> <ul> <li> <p>\u89e3\u51b3\u65b9\u5f0f\uff1a</p> <ul> <li>\u6839\u636e\u68af\u5ea6\u503c\u7684\u5ef6\u8fdf\u5ea6\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u66f4\u65b0\u7684 \u2206Wi,j\uff0c\u72ec\u7acb\u7f29\u653e\u6bcf\u4e00\u4e2a\u03bb\u503c\uff1b</li> <li>\u5b9e\u65bd\u300c\u8f6f\u300d\u540c\u6b65\u89c4\u5219 ( [9] )\uff1a\u4e0d\u7acb\u5373\u66f4\u65b0\u5168\u5c40\u53c2\u6570\u5411\u91cf\uff0c\u800c\u662f\u4f1a\u7b49\u5f85\u4ee5\u4ece n \u4e2a\u5b66\u4e60\u5668\u4e2d\u6536\u96c6 s \u4e2a \u2206Wj \u66f4\u65b0\uff08s \u662f\u4e00\u5e38\u6570\uff0c1 \u2264 s \u2264 n\uff09\uff1b</li> <li>\u5229\u7528\u540c\u6b65\u53bb\u9650\u5236\u5ef6\u8fdf\u5ea6\uff1a\u5bf9\u8f83\u5feb\u7684\u5b66\u4e60\u5668\u8fdb\u884c\u5ef6\u8fdf\uff0c\u4ee5\u786e\u4fdd\u6574\u4f53\u6700\u5927\u7684\u5ef6\u8fdf\u5ea6\u5c0f\u4e8e\u4e00\u4e2a\u9600\u503c\u3002</li> </ul> </li> <li> <p>\u5206\u5e03\u5f0f\u540c\u6b65\u66f4\u65b0\uff08\u65e0\u53c2\u6570\u670d\u52a1\u5668\uff09\uff1a</p> </li> <li>RingAllReduce\uff1a\u7f51\u7edc\u5e26\u5bbd\u6700\u4f18</li> <li>\u5206\u5e03\u5f0f\u5f02\u6b65\u66f4\u65b0\uff08\u65e0\u53c2\u6570\u670d\u52a1\u5668\uff09\uff1a</li> <li>\u70b9\u5bf9\u70b9\u7684\u53c2\u6570\u4f20\u8f93\u4ee5\u5bf9\u4e8e\u5b66\u4e60\u5668\u4e4b\u95f4\u8fdb\u884c\u66f4\u65b0\uff1b</li> </ul>"},{"location":"machine_learning/AI_Frameworks.html#spark","title":"\u57fa\u4e8e Spark","text":""},{"location":"machine_learning/AI_Frameworks.html#analytics-zoointel","title":"Analytics Zoo/Intel","text":"<p>Intel \u65e9\u671f\u8fd8\u6709\u4e00\u4e2aTOY(Tensorflow On Yarn) \u9879\u76ee\uff0c\u4e5f\u652f\u6301CPU\uff0c2017\u5e74\u5df2\u7ecf\u6ca1\u6709\u66f4\u65b0\uff1b</p> <p>\u7edf\u4e00\u7684\u57fa\u4e8eSpark\u7684\u5206\u5e03\u5f0fTensorflow, Keras, Pytorch and BigDL\u7684\u5206\u6790+AI\u5e73\u53f0</p> <p>\u53ea\u652f\u6301CPU\u8bad\u7ec3\u3002</p>"},{"location":"machine_learning/AI_Frameworks.html#horovoduber","title":"Horovod/Uber","text":"<p>\u57fa\u4e8eSpark\u7684Horovod\uff0c\u9700\u8981\u5c06\u6570\u636e\u5148\u5199\u6210Parquet\u5b58\u50a8\uff0c\u5927\u6570\u636e\u7684\u65f6\u5019\u901f\u5ea6\u5f88\u6162\u3002</p>"},{"location":"machine_learning/AI_Frameworks.html#tensorflowonsparkyahoo","title":"TensorFlowOnSpark/Yahoo","text":"<ul> <li>\u9700\u8981\u5bf9TF\u4ee3\u7801\u8fdb\u884c\u4fee\u6539\u9002\u914d\u3002</li> </ul>"},{"location":"machine_learning/AI_Frameworks.html#spark-deep-learningdatabricks","title":"Spark Deep Learning/Databricks","text":"<p>\u91c7\u7528 Horovod \u8fdb\u884c AI \u8bad\u7ec3\uff0c\u4f46 Horovod \u8fd0\u884c\u914d\u7f6e\u590d\u6742\uff0c\u4e14\u9700\u8981\u5c06\u6570\u636e\u5199\u6210Parquet\uff0c\u6ca1\u6709 TF\u539f\u751fon Spark\u597d\u7528\u3002</p> <ul> <li>Image IO</li> <li>Transfer learning</li> <li>Distributed hyperparameter tuning</li> <li>Model as SQL functions</li> </ul>"},{"location":"machine_learning/AI_Frameworks.html#spark_tensorflow_distributor-tensorflow","title":"Spark_tensorflow_distributor / Tensorflow","text":"<p>Tensorflow ecosystem \u63d0\u4f9b\u7684\u5b98\u65b9 TF On Spark\u7684\u5206\u5e03\u5f0f\u8bad\u7ec3\u6846\u67b6\u3002</p> <ul> <li>Spark executor \u901a\u8fc7barrier\u81ea\u7ec4 TF \u7f51\u7edc\uff1b</li> <li>TF \u539f\u751f\u4ee3\u7801\uff0c\u65e0\u9700\u4efb\u4f55\u6539\u52a8\uff1b</li> </ul>"},{"location":"machine_learning/AI_Frameworks.html#yarn-native","title":"Yarn Native","text":"<p>\u57fa\u4e8eSpark\uff0c\u80af\u5b9a\u662f\u53ef\u4ee5\u5728Yarn\u4e0a\u8fd0\u884c\u3002</p>"},{"location":"machine_learning/AI_Frameworks.html#tonylinkedin","title":"TonY/LinkedIn","text":"<p>https://github.com/tony-framework/TonY</p> <p>\u652f\u6301 Tensorflow\uff0cPyTorch\uff0cMxNet\uff0cHorovod</p> <p>\u652f\u6301Ring-AllReduce\uff08\u5373\u4e0d\u9700\u8981PS\uff09</p> <p>\u652f\u6301\u5f02\u6784\u8d44\u6e90\u7684\u7533\u8bf7\uff0c\u5982\u5bf9PS\u670d\u52a1\u5668\u7533\u8bf7\u8f83\u5c11\u5185\u5b58\u548cCPU\uff0c\u5bf9Worker\u7533\u8bf7\u8f83\u5927\u5185\u5b58\u548cGPUs\u3002</p> <p>\u6709\u5bf9\u5e94\u7684Tracking url\u3002</p> <p></p>"},{"location":"machine_learning/AI_Frameworks.html#submarineapache","title":"Submarine\uff08Apache\uff09","text":"<p>\u57fa\u4e8e TonY \u5b9e\u73b0 AI on Yarn\u3002</p>"},{"location":"machine_learning/AI_Frameworks.html#xlearningqihoo360","title":"XLearning/Qihoo360","text":"<p>deep learning frameworks \u5982 TensorFlow, MXNet, Caffe, Theano, PyTorch, Keras, XGBoost\u3002</p> <p>\u652f\u6301GPU\u3002</p>"},{"location":"machine_learning/AI_Frameworks.html#yarn-native-service","title":"Yarn Native Service","text":""},{"location":"machine_learning/AI_Frameworks.html#k8s","title":"\u57fa\u4e8eK8s","text":""},{"location":"machine_learning/AI_Frameworks.html#kubeflowkubenetes","title":"Kubeflow/Kubenetes","text":"<p>\u4e0d\u53ef\u4ee5\u8fd0\u884c\u5728Hadoop\u4e0a\uff0c\u81f3\u591a\u652f\u63015000\u53f0\u8282\u70b9\uff08https://kubernetes.io/docs/setup/best-practices/cluster-large/\uff09</p>"},{"location":"machine_learning/AI_Frameworks.html#submarinapache","title":"Submarin(Apache)","text":"<p>https://submarine.apache.org/</p> <ul> <li>\u652f\u6301 K8s \u548c Yarn\uff1b</li> <li>\u91c7\u7528MLFlow \u8bb0\u5f55\u5b9e\u9a8c\u7ed3\u679c\uff0c\u5e76\u8fdb\u884c\u5bf9\u6bd4\uff1b</li> </ul>"},{"location":"machine_learning/AI_Frameworks.html#automl-tookit","title":"AutoML Tookit","text":""},{"location":"machine_learning/AI_Frameworks.html#pyspark","title":"\u5206\u5e03\u5f0f\u7b97\u6cd5\uff1apyspark","text":"<ul> <li>MLlib + Automated MLFlow\uff1aCrossValidator\u548cTrainValidatorSplit</li> </ul>"},{"location":"machine_learning/AI_Frameworks.html#sklearntensorflow","title":"\u5355\u673a\u7b97\u6cd5\uff1a sklearn\uff0ctensorflow","text":"<ul> <li>Hyperopt + Automated MLflow </li> </ul>"},{"location":"machine_learning/AI_Frameworks.html#autodl-tookit","title":"AutoDL Tookit","text":""},{"location":"machine_learning/ML.html","title":"\u673a\u5668\u5b66\u4e60","text":"<p>\u673a\u5668\u5b66\u4e60\u7b97\u6cd5\u5206\u6210\u4e09\u7c7b\uff1a\u6709\u76d1\u7763\u5b66\u4e60\u3001\u65e0\u76d1\u7763\u5b66\u4e60\u3001\u589e\u5f3a\u5b66\u4e60</p> <ul> <li>\u6709\u76d1\u7763\u5b66\u4e60\u9700\u8981\u6807\u8bc6\u6570\u636e\uff08\u7528\u4e8e\u8bad\u7ec3\uff0c\u5373\u6709\u6b63\u4f8b\u53c8\u6709\u8d1f\u4f8b\uff09\uff0c\u65e0\u76d1\u7763\u5b66\u4e60\u4e0d\u9700\u8981\u6807\u8bc6\u6570\u636e\uff0c\u589e\u5f3a\u5b66\u4e60\u4ecb\u4e8e\u4e24\u8005\u4e4b\u95f4\uff08\u6709\u90e8\u5206\u6807\u8bc6\u6570\u636e\uff09\u3002</li> </ul> <p>\u6709\u76d1\u7763\u5b66\u4e60\uff1a</p> <ul> <li>\u51b3\u7b56\u6811</li> <li>\u6734\u7d20\u8d1d\u53f6\u65af\u5206\u7c7b\u5668</li> <li>\u6700\u5c0f\u4e8c\u4e58\u6cd5</li> <li>\u903b\u8f91\u56de\u5f52</li> <li>\u652f\u6301\u5411\u91cf\u673a\uff08SVM\uff09</li> <li>\u96c6\u6210\u5b66\u4e60</li> </ul> <p>\u65e0\u76d1\u7763\u5b66\u4e60</p> <ul> <li>\u805a\u7c7b\u7b97\u6cd5\uff1a\u4e2d\u5fc3\u805a\u7c7b\u3001\u5173\u8054\u805a\u7c7b\u3001\u5bc6\u5ea6\u805a\u7c7b\u3001\u6982\u7387\u805a\u7c7b\u3001\u964d\u7ef4\u3001\u795e\u7ecf\u7f51\u7edc/\u6df1\u5ea6\u5b66\u4e60\u3002</li> <li>\u4e3b\u6210\u5206\u5206\u6790\uff08PCA\uff09\uff1a\u4e3b\u6210\u5206\u5206\u6790\u662f\u5229\u7528\u6b63\u4ea4\u53d8\u6362\u5c06\u4e00\u4e9b\u5217\u53ef\u80fd\u76f8\u5173\u6570\u636e\u8f6c\u6362\u4e3a\u7ebf\u6027\u65e0\u5173\u6570\u636e\uff0c\u627e\u5230\u4e3b\u6210\u5206\u3002</li> <li>SVD\u77e9\u9635\u5206\u89e3\uff1aPCA\u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a\u7b80\u5316\u7248\u672c\u7684SVD\u5206\u89e3\u3002</li> <li>\u72ec\u7acb\u6210\u5206\u5206\u6790(ICA)\uff1a\u53d1\u73b0\u5b58\u5728\u4e8e\u968f\u673a\u53d8\u91cf\u4e0b\u7684\u9690\u6027\u56e0\u7d20\uff0c\u5047\u8bbe\u6f5c\u5728\u56e0\u7d20\u5c5e\u4e8e\u975e\u9ad8\u65af\u5206\u5e03\u3001\u5e76\u4e14\u76f8\u4e92\u72ec\u7acb\uff0c\u79f0\u4e4b\u4e3a\u53ef\u89c2\u6d4b\u6570\u636e\u7684\u72ec\u7acb\u6210\u5206\u3002</li> </ul>"},{"location":"machine_learning/ML.html#_2","title":"\u5206\u7c7b","text":""},{"location":"machine_learning/ML.html#k-","title":"K-\u8fd1\u90bb\u7b97\u6cd5","text":"<p>\u4f18\u7f3a\u70b9\u548c\u9002\u7528\u8303\u56f4     \u7cbe\u5ea6\u9ad8\u3001\u5bf9\u5f02\u5e38\u503c\u4e0d\u654f\u611f\u3001\u65e0\u6570\u636e\u8f93\u5165\u5047\u5b9a     \u65f6\u7a7a\u590d\u6742\u5ea6\u9ad8     \u6570\u636e\uff1a\u6570\u503c\u578b\u548c\u6807\u79f0\u578b</p>"},{"location":"machine_learning/ML.html#_3","title":"\u6734\u7d20\u8d1d\u53f6\u65af","text":"<p>\u4f18\u7f3a\u70b9\u548c\u9002\u7528\u8303\u56f4     \u6570\u636e\u5c11\u7684\u65f6\u5019\u4ecd\u7136\u6709\u6548\uff0c\u5904\u7406\u591a\u7c7b\u522b\u5206\u7c7b     \u8f93\u5165\u6570\u636e\u7684\u51c6\u5907\u65b9\u5f0f\u654f\u611f     \u6570\u636e\uff1a\u6807\u79f0\u578b\uff08\u591a\u9879\u5f0f\u548c\u4f2f\u52aa\u5229\uff080-1\uff09\u6a21\u578b\uff09\uff0c\u6570\u503c\u578b\uff08\u9ad8\u65af\u6a21\u578b\uff09    </p>"},{"location":"machine_learning/ML.html#logistic-regression","title":"Logistic Regression","text":"<p>\u4f18\u7f3a\u70b9\u548c\u9002\u7528\u8303\u56f4     \u8ba1\u7b97\u4ee3\u4ef7\u4e0d\u9ad8\uff0c\u65e0\u9700\u5047\u8bbe\u6570\u636e\u5206\u5e03\uff0c\u5f97\u5230\u8fd1\u4f3c\u6982\u7387\u9884\u6d4b     \u5bb9\u6613\u6b20\u62df\u5408\uff0c\u7cbe\u5ea6\u53ef\u80fd\u4e0d\u9ad8     \u6570\u636e\uff1a\u6570\u503c\u578b\u548c\u6807\u79f0\u578b</p>"},{"location":"machine_learning/ML.html#_4","title":"\u51b3\u7b56\u6811","text":"<p>\u4f18\u7f3a\u70b9\u548c\u9002\u7528\u8303\u56f4       \u8ba1\u7b97\u590d\u6742\u5ea6\u4e0d\u9ad8\uff0c\u4e2d\u95f4\u503c\u7f3a\u5931\u4e0d\u654f\u611f\uff0c\u53ef\u4ee5\u5904\u7406\u4e0d\u76f8\u5173\u7279\u5f81     \u8fc7\u62df\u5408     \u6570\u636e\uff1a\u6570\u503c\u578b\u548c\u6807\u79f0\u578b</p>"},{"location":"machine_learning/ML.html#_5","title":"\u805a\u7c7b","text":""},{"location":"machine_learning/ML.html#_6","title":"\u7279\u5f81\u5de5\u7a0b","text":"<p>Featuretools\u662f\u6267\u884c\u81ea\u52a8\u5316\u7279\u5f81\u5de5\u7a0b\u7684\u6846\u67b6</p>"},{"location":"machine_learning/ML.html#_7","title":"\u964d\u7ef4","text":"<p>\u964d\u7ef4\u662f\u57282\u7ef4\u62163\u7ef4\u4e2d\u5c55\u73b0\u591a\u7ef4\u6570\u636e\uff08\u5177\u6709\u591a\u4e2a\u7279\u5f81\u7684\u6570\u636e\uff0c\u4e14\u5f7c\u6b64\u5177\u6709\u76f8\u5173\u6027\uff09\u7684\u6280\u672f\u3002</p> <p>\u964d\u7ef4\u7b97\u6cd5\uff1a</p> <ol> <li> <p>\u4e3b\u6210\u5206\u5206\u6790\uff08\u7ebf\u6027\uff09</p> </li> <li> <p>t-SNE\uff08\u975e\u53c2\u6570/\u975e\u7ebf\u6027\uff09</p> </li> <li> <p>\u8428\u8499\u6620\u5c04\uff08\u975e\u7ebf\u6027\uff09</p> </li> <li> <p>\u7b49\u8ddd\u6620\u5c04\uff08\u975e\u7ebf\u6027\uff09</p> </li> <li> <p>\u5c40\u90e8\u7ebf\u6027\u5d4c\u5165(\u975e\u7ebf\u6027)</p> </li> <li> <p>\u89c4\u8303\u76f8\u5173\u5206\u6790\uff08\u975e\u7ebf\u6027\uff09</p> </li> <li> <p>SNE(\u975e\u7ebf\u6027)</p> </li> <li> <p>\u6700\u5c0f\u65b9\u5dee\u65e0\u504f\u4f30\u8ba1\uff08\u975e\u7ebf\u6027\uff09</p> </li> <li> <p>\u62c9\u666e\u62c9\u65af\u7279\u5f81\u56fe\uff08\u975e\u7ebf\u6027\uff09</p> </li> </ol> <p>\u9664t-SNE\u4e4b\u5916\u7684\u5927\u591a\u6570\u975e\u7ebf\u6027\u6280\u672f\u90fd\u4e0d\u80fd\u540c\u65f6\u4fdd\u7559\u6570\u636e\u7684\u5c40\u90e8\u548c\u5168\u5c40\u7ed3\u6784\u3002</p>"},{"location":"machine_learning/ML.html#pca","title":"\u4e3b\u6210\u5206\u5206\u6790\uff08PCA\uff0c\u7ebf\u6027\uff09","text":"<p>\u5177\u6709\u5927\u91cf\u7279\u5f81\u7684\u6570\u636e\u96c6\u7684\u964d\u7ef4\u548c\u53ef\u89c6\u5316\u3002</p> <ul> <li>\u7ebf\u6027\u7b97\u6cd5\u3002 \u5b83\u4e0d\u80fd\u89e3\u91ca\u7279\u5f81\u4e4b\u95f4\u7684\u590d\u6742\u591a\u9879\u5f0f\u5173\u7cfb\uff1b</li> <li>\u5f53\u6570\u636e\u96c6\u4e0d\u540c\u7ef4\u5ea6\u4e0a\u7684\u65b9\u5dee\u5206\u5e03\u4e0d\u5747\u5300\u7684\u65f6\u5019\uff0cPCA\u6700\u6709\u7528\uff1b</li> </ul> <p>\u539f\u7406\uff1a\u5c06\u9ad8\u7ef4\u6570\u636e\u96c6\u6620\u5c04\u5230\u4f4e\u7ef4\u7a7a\u95f4\u7684\u540c\u65f6\uff0c\u5c3d\u53ef\u80fd\u7684\u4fdd\u7559\u66f4\u591a\u53d8\u91cf\u3002</p>"},{"location":"machine_learning/ML.html#t-sne","title":"t-SNE\uff08\u975e\u7ebf\u6027\uff09","text":"<p>t-\u5206\u5e03\u5f0f\u968f\u673a\u90bb\u57df\u5d4c\u5165\u662f\u4e00\u79cd\u7528\u4e8e\u6316\u6398\u9ad8\u7ef4\u6570\u636e\u7684\u975e\u7ebf\u6027\u964d\u7ef4\u7b97\u6cd5\u3002 \u5b83\u5c06\u591a\u7ef4\u6570\u636e\u6620\u5c04\u5230\u9002\u5408\u4e8e\u4eba\u7c7b\u89c2\u5bdf\u7684\u4e24\u4e2a\u6216\u591a\u4e2a\u7ef4\u5ea6\u3002</p> <ul> <li> <p>\u901a\u8fc7\u57fa\u4e8e\u5177\u6709\u591a\u4e2a\u7279\u5f81\u7684\u6570\u636e\u70b9\u7684\u76f8\u4f3c\u6027\u8bc6\u522b\u89c2\u5bdf\u5230\u7684\u6a21\u5f0f\u6765\u627e\u5230\u6570\u636e\u4e2d\u7684\u89c4\u5f8b\u3002</p> </li> <li> <p>\u57fa\u4e8e\u5728\u90bb\u57df\u56fe\u4e0a\u968f\u673a\u6e38\u8d70\u7684\u6982\u7387\u5206\u5e03\uff0c\u53ef\u4ee5\u5728\u6570\u636e\u4e2d\u627e\u5230\u5176\u7ed3\u6784\u5173\u7cfb\u3002</p> </li> </ul> <p>\u5e94\u7528\u96c6\u4e2d\u5728\u56fe\u50cf\u5904\u7406\uff0c\u81ea\u7136\u8bed\u8a00\u5904\u7406\uff0c\u57fa\u56e0\u6570\u636e\u4ee5\u53ca\u8bed\u97f3\u5904\u7406\u3002\u5b83\u8fd8\u88ab\u7528\u4e8e\u63d0\u9ad8\u5fc3\u8111\u626b\u63cf\u56fe\u50cf\u7684\u5206\u6790\u3002</p>"},{"location":"machine_learning/ML.html#pcasklearn","title":"PCA\u4e0eSklearn\u793a\u4f8b","text":"<pre><code># importing the required packages\nfrom time import time\n\nimport matplotlib.pyplot as plt\nimport numpy as np\nfrom matplotlib import offsetbox\nfrom sklearn import (manifold, datasets, decomposition)\n\n# Loading and curating the data\ndigits = datasets.load_digits(n_class=10)\nX = digits.data\ny = digits.target\nn_samples, n_features = X.shape\nn_neighbors = 30\n\n\n# Function to Scale and visualize the embedding vectors\ndef plot_embedding(X, title=None):\n    x_min, x_max = np.min(X, 0), np.max(X, 0)\n    X = (X - x_min) / (x_max - x_min)\n    plt.figure()\n    ax = plt.subplot(111)\n    for i in range(X.shape[0]):\n        plt.text(X[i, 0], X[i, 1], str(digits.target[i]), color=plt.cm.Set1(y[i] / 10.),\n                 fontdict={'weight': 'bold', 'size': 9})\n    if hasattr(offsetbox, 'AnnotationBbox'):\n        # only print thumbnails with matplotlib&gt; 1.0\n        shown_images = np.array([[1., 1.]])  # just something big\n    for i in range(digits.data.shape[0]):\n        dist = np.sum((X[i] - shown_images) ** 2, 1)\n        if np.min(dist) &lt; 4e-3:\n            # don't show points that are too close\n            continue\n        shown_images = np.r_[shown_images, [X[i]]]\n        imagebox = offsetbox.AnnotationBbox(offsetbox.OffsetImage(digits.images[i], cmap=plt.cm.gray_r), X[i])\n        ax.add_artist(imagebox)\n        plt.xticks([]), plt.yticks([])\n    if title is not None:\n        plt.title(title)\n\n\n# ----------------------------------------------------------------------\n# Plot images of the digits\nn_img_per_row = 20\nimg = np.zeros((10 * n_img_per_row, 10 * n_img_per_row))\nfor i in range(n_img_per_row):\n    ix = 10 * i + 1\n    for j in range(n_img_per_row):\n        iy = 10 * j + 1\n        img[ix:ix + 8, iy:iy + 8] = X[i * n_img_per_row + j].reshape((8, 8))\n        plt.imshow(img, cmap=plt.cm.binary)\n        plt.xticks([])\n        plt.yticks([])\n        plt.title('A selection from the 64-dimensional digits dataset')\n\n# Computing PCA\nprint(\"Computing PCA projection\")\nt0 = time()\nX_pca = decomposition.TruncatedSVD(n_components=2).fit_transform(X)\nplot_embedding(X_pca, \"Principal Components projection of the digits (time %.2fs)\" % (time() - t0))\n\n# Computing t-SNE\nprint(\"Computing t-SNE embedding\")\nt0 = time()\ntsne = manifold.TSNE(n_components=2, init='pca', random_state=0)\nX_tsne = tsne.fit_transform(X)\nplot_embedding(X_tsne, \"t-SNE embedding of the digits (time %.2fs)\" % (time() - t0))\nplt.show()\n</code></pre>"},{"location":"machine_learning/ML.html#_8","title":"\u6570\u503c\u5f52\u4e00\u5316","text":"<p>\u200b   \u6b27\u51e0\u91cc\u5fb7\u8ddd\u79bb\u53d7\u5355\u4f4d\u5f71\u54cd\uff0c\u5e94\u5f53\u5148\u5f52\u4e00\u5316\uff1b\u4f59\u5f26\u8ddd\u79bb\u5219\u65e0\u9700\u5f52\u4e00\u5316 \u200b   \u5f52\u4e00\u52300~1\u6216-1~1\u4e4b\u95f4\uff0c\u5373min-max\u6216z-score</p>"},{"location":"machine_learning/ML.html#_9","title":"\u7279\u5f81\u9009\u62e9","text":"<p>Feature Selection  ( FS ) </p> <p>\u7279\u5f81\u9009\u62e9\u7684\u7684\u4e00\u822c\u6d41\u7a0b\uff1a \u627e\u4e00\u4e2a\u96c6\u5408\uff0c\u7136\u540e\u9488\u5bf9\u67d0\u4e2a\u5b66\u4e60\u7b97\u6cd5\uff0c \u6d4b\u8bd5\u6548\u679c\u5982\u4f55\uff0c \u4e00\u76f4\u5faa\u73af\u76f4\u5230\u627e\u5230\u6700\u4f18\u96c6\u5408\u4e3a\u6b62\u3002</p> <p>\u5e38\u89c1\u7684\u641c\u7d22\u7b97\u6cd5\uff1a</p> <ul> <li>\u7a77\u4e3e\u6cd5\uff08Exhaustive\uff09\uff1a \u66b4\u529b\u7a77\u5c3d</li> <li>\u8d2a\u5fc3\u6cd5\uff08Greedy Selection\uff09\uff1a \u7ebf\u6027\u65f6\u95f4</li> <li>\u6a21\u62df\u9000\u706b\uff08Simulated Annealing\uff09\uff1a \u968f\u673a\u5c1d\u8bd5\u627e\u6700\u4f18</li> <li>\u57fa\u56e0\u7b97\u6cd5\uff08Genetic Algorithm\uff09\uff1a \u7ec4\u5408\u6df1\u5ea6\u4f18\u5148\u5c1d\u8bd5</li> <li>\u90bb\u5c45\u641c\u7d22\uff08Variable Neighbor Search\uff09\uff1a \u5229\u7528\u76f8\u8fd1\u5173\u7cfb\u641c\u7d22</li> </ul>"},{"location":"machine_learning/ML.html#_10","title":"\u7279\u5f81\u62bd\u53d6","text":"<p>Feature Extraction ( FE )</p>"},{"location":"machine_learning/ML.html#_11","title":"\u63a8\u8350\u7b97\u6cd5","text":"<p>\u63a8\u8350\u6a21\u578b\u4f1a\u8d1f\u8d23\u6536\u96c6\u8bf8\u5982\u7528\u6237\u504f\u597d\u3001\u7269\u54c1\u63cf\u8ff0\u8fd9\u4e9b\u53ef\u7528\u4f5c\u63a8\u8350\u51ed\u501f\u7684\u6570\u636e\uff0c\u636e\u6b64\u9884\u6d4b\u7279\u5b9a\u7528\u6237\u7ec4\u53ef\u80fd\u611f\u5174\u8da3\u7684\u7269\u54c1\u3002</p> <p>\u4e3b\u8981\u7684\u63a8\u8350\u7b97\u6cd5\u7cfb\u5217\u6709\u56db\u4e2a\uff1a</p> <ul> <li>\u534f\u540c\u8fc7\u6ee4\uff08Collaborative Filtering\uff09\u7684\u63a8\u8350\u7b97\u6cd5</li> <li>\u57fa\u4e8e\u5185\u5bb9\u8fc7\u6ee4\uff08Content-based Filtering\uff09\u7684\u63a8\u8350\u7b97\u6cd5</li> <li>\u6df7\u5408\u578b\u63a8\u8350\u7b97\u6cd5</li> <li>\u6d41\u884c\u5ea6\u63a8\u8350\u7b97\u6cd5</li> </ul>"},{"location":"machine_learning/ML.html#_12","title":"\u534f\u540c\u8fc7\u6ee4","text":""},{"location":"machine_learning/ML.html#_13","title":"\u57fa\u4e8e\u90bb\u57df(\u76f8\u4f3c)\u7c7b\u578b\u7684\u534f\u540c\u8fc7\u6ee4","text":"<p>\u4e24\u79cd\u65b9\u5f0f\u90fd\u80fd\u4e3a\u540c\u4e00\u540d\u7528\u6237\u5f97\u51fa\u4e0d\u540c\u7684\u63a8\u8350\u7ed3\u679c\uff0c\u5c3d\u7ba1\u4e24\u8005\u7684\u8f93\u5165\u5185\u5bb9\u662f\u76f8\u540c\u7684\u3002</p> <p>\u57fa\u4e8e\u7528\u6237\u7684\u534f\u540c\u8fc7\u6ee4\uff08\u7528\u6237\u95f4\u5173\u7cfb\uff09\uff1a\u63a2\u7d22\u5bf9\u7269\u54c1\u62e5\u6709\u76f8\u4f3c\u54c1\u5473\u7684\u7528\u6237\uff0c\u5e76\u57fa\u4e8e\u5f7c\u6b64\u559c\u7231\u7684\u7269\u54c1\u6765\u8fdb\u884c\u4e92\u63a8\u3002</p> <ul> <li>\u6839\u636e\u7528\u6237\u5bf9\u7269\u54c1\u7684\u8bc4\u5206\uff0c\u8ba1\u7b97\u7528\u6237\u95f4\u7684\u76f8\u4f3c\u6027\uff08\u5982\u4f59\u5f26\u51fd\u6570\uff09\uff0c\u53d6\u6700\u76f8\u4f3c\u7684\u7528\u6237\u6240\u9605\u8bfb\u7684\u4e66\u7c4d\uff0c\u8fdb\u884c\u52a0\u6743\u5bf9\u8fd9\u540d\u7528\u6237\u5c1a\u672a\u8bc4\u5206\u7684\u4e66\u7c4d\u8fdb\u884c\u63a8\u8350\u3002</li> </ul> <p>\u57fa\u4e8e\u7269\u54c1\u7684\u534f\u540c\u8fc7\u6ee4\uff08\u7269\u54c1\u95f4\u5173\u7cfb\uff09\uff1a\u57fa\u4e8e\u7528\u6237\u559c\u7231\u7684\u7269\u54c1\uff0c\u63a8\u8350\u7c7b\u4f3c\u7684\u4e1c\u897f\u3002\u800c\u8fd9\u79cd\u76f8\u4f3c\u6027\u5efa\u7acb\u5728\u7269\u54c1\u540c\u65f6\u51fa\u73b0\u7684\u57fa\u7840\u4e0a\uff0c\u6bd4\u5982\u8d2d\u4e70\u4e86x\u7269\u54c1\u7684\u7528\u6237\u4e5f\u8d2d\u4e70\u4e86y\u7269\u54c1\u3002</p> <ul> <li>\u6839\u636e\u7528\u6237\u6b64\u524d\u66fe\u8bc4\u8fc7\u5206\u7684\u7269\u54c1\uff0c\u8ba1\u7b97\u7269\u54c1\u95f4\u76f8\u4f3c\u6027\uff0c\u63a8\u8350\u4e0e\u5176\u6700\u4e3a\u76f8\u4f3c\u7684\u7269\u54c1\u3002</li> </ul> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u7b80\u5355\u9ad8\u6548\uff0c\u4e14\u751f\u6210\u7684\u63a8\u8350\u7ed3\u679c\u51c6\u786e\u3001\u4e2a\u6027\u5316\uff1b</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u66f4\u5bb9\u6613\u63a8\u8350\u6d41\u884c\u7269\u54c1\uff08\u6d41\u884c\u5ea6\u504f\u597d\u95ee\u9898\uff09\uff0c\u51b7\u542f\u52a8\u95ee\u9898\uff08\u65b0\u7528\u6237/\u65b0\u7528\u54c1\uff09\uff0c\u7ef4\u5ea6\u7206\u70b8\u8ba1\u7b97\u91cf\u7684\u95ee\u9898\uff0c\u6570\u636e\u7a00\u758f\u7684\u95ee\u9898</li> </ul>"},{"location":"machine_learning/ML.html#_14","title":"\u57fa\u4e8e\u6a21\u578b\u7684\u534f\u540c\u8fc7\u6ee4","text":"<p>\u5982\u77e9\u9635\u56e0\u5b50\u5206\u89e3\uff0c\u53d7\u9650\u73bb\u5c14\u5179\u66fc\u673a\uff0c\u8d1d\u53f6\u65af\u7f51\u7edc\u7b49\uff1b</p> <ul> <li>\u77e9\u9635\u56e0\u5f0f\u5206\u89e3\uff1a\u5176\u6f5c\u5728\u7279\u6027\u4ee3\u8868\u7528\u6237\u5982\u4f55\u5bf9\u7269\u54c1\u8fdb\u884c\u8bc4\u5206\u3002\u6839\u636e\u7528\u6237\u4e0e\u7269\u54c1\u7684\u6f5c\u5728\u8868\u73b0\uff0c\u9884\u6d4b\u7528\u6237\u5bf9\u672a\u8bc4\u5206\u7684\u7269\u54c1\u7684\u559c\u7231\u7a0b\u5ea6\u3002</li> </ul>"},{"location":"machine_learning/ML.html#_15","title":"\u5185\u5bb9\u8fc7\u6ee4","text":"<p>\u5047\u8bbe\u6bcf\u4e2a\u7269\u54c1\u90fd\u6709\u8db3\u591f\u7684\u63cf\u8ff0\u4fe1\u606f\u53ef\u4f5c\u4e3a\u7279\u5f81\u5411\u91cf\uff08y\uff09\uff08\u6bd4\u5982\u6807\u9898\u3001\u5e74\u4ee3\u3001\u63cf\u8ff0\uff09\uff0c\u800c\u8fd9\u4e9b\u7279\u5f81\u5411\u91cf\u4f1a\u88ab\u7528\u6765\u521b\u5efa\u7528\u6237\u504f\u597d\u6a21\u578b\u3002</p> <p>\u4fe1\u606f\u68c0\u7d22\uff1a\u5982tfidf\u3001Okapi BM25\u7b49\uff1b</p> <p>\u673a\u5668\u5b66\u4e60\uff1a\u5982\u6734\u7d20\u8d1d\u53f6\u65af\u3001SVM\u3001\u51b3\u7b56\u6811\u7b49\uff1b</p> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u514b\u670d\u6d41\u884c\u5ea6\u504f\u89c1\uff0c\u4ee5\u53ca\u65b0\u7269\u54c1\u7684\u51b7\u542f\u52a8\u95ee\u9898\uff1b</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u6548\u679c\u4e0d\u5982\u90a3\u4e9b\u57fa\u4e8e\u4f7f\u7528\u6570\u636e\u7684\u7cfb\u7edf\uff08\u6bd4\u5982\u534f\u540c\u8fc7\u6ee4\u7b97\u6cd5\uff09\uff1b</li> <li>\u8fc7\u5ea6\u4e13\u4e1a\u5316\u7684\u95ee\u9898\uff08\u63a8\u8350\u76f8\u540c\u7c7b\u578b\u7684\u5546\u54c1\uff09\uff0c\u65e0\u610f\u5916\u4e4b\u559c\uff1b</li> </ul>"},{"location":"machine_learning/ML.html#_16","title":"\u6df7\u5408\u7b97\u6cd5","text":"<p>\u7ed3\u5408\u4e24\u79cd\u751a\u81f3\u66f4\u591a\u7684\u57fa\u7840\u63a8\u8350\u7b97\u6cd5\uff0c\u4ee5\u521b\u5efa\u65b0\u6df7\u5408\u7b97\u6cd5\u3002\uff08\u52a0\u6743\u6216\u8005\u96c6\u6210\uff09</p> <p>\u6d41\u884c\u5ea6\u7b97\u6cd5\uff08\u4e0b\u8f7d\u6700\u591a\u7b49\u6d41\u884c\u5ea6\u6307\u6807\uff09\u53ef\u4ee5\u5f15\u5bfc\u63a8\u8350\u7cfb\u7edf\u5728\u6362\u5230\u5176\u4ed6\u66f4\u5207\u5408\u7528\u6237\u5174\u8da3\u70b9\u7684\u7b97\u6cd5\uff08\u6bd4\u5982\u534f\u540c\u8fc7\u6ee4\u7b97\u6cd5\u4ee5\u53ca\u57fa\u4e8e\u5185\u5bb9\u8fc7\u6ee4\u7684\u7b97\u6cd5\uff09\u524d\u83b7\u5f97\u8db3\u591f\u7684\u6d3b\u8dc3\u5ea6\u4e0e\u4f7f\u7528\u91cf\u3002\u6d41\u884c\u5ea6\u6a21\u578b\u4e5f\u53ef\u4ee5\u5f15\u5165\u6df7\u5408\u7b97\u6cd5\u4e2d\uff0c\u4ece\u800c\u89e3\u51b3\u65b0\u7528\u6237\u7684\u51b7\u542f\u52a8\u95ee\u9898\u3002</p>"},{"location":"machine_learning/ML.html#_17","title":"\u5176\u4ed6\u7b97\u6cd5\u548c\u5b9e\u8df5","text":"<p>\u8fd8\u6709\u8bb8\u591a\u5176\u4ed6\u7b97\u6cd5\u4e5f\u53ef\u7528\u4e8e\u52a0\u5f3a\u63a8\u8350\u7cfb\u7edf\uff0c\u5982\uff1a</p> <ul> <li>\u6df1\u5ea6\u5b66\u4e60\u7b97\u6cd5</li> <li>\u793e\u4f1a\u5316\u63a8\u8350</li> <li>\u57fa\u4e8e\u673a\u5668\u5b66\u4e60\u7684\u6392\u5e8f\u65b9\u6cd5</li> <li>Multi-armed bandits\u63a8\u8350\u7b97\u6cd5\uff08\u63a2\u7d22/\u5229\u7528\uff09</li> <li>\u60c5\u666f\u611f\u77e5\u63a8\u8350\uff08\u5f20\u91cf\u5206\u89e3&amp;\u5206\u89e3\u673a\uff09</li> </ul> <p>\u5728\u5b9e\u8df5\u4e2d\uff1a</p> <ul> <li>\u4e00\u822c\u5982\u679c\u5728\u63a8\u8350\u6a21\u578b\u4e2d\u4f7f\u7528\u534f\u540c\u8fc7\u6ee4\u7b97\u6cd5\uff0c\u5c31\u4e0d\u4f1a\u72af\u592a\u5927\u9519\u8bef\uff1b</li> <li>\u534f\u540c\u8fc7\u6ee4\u7b97\u6cd5\u4f3c\u4e4e\u6bd4\u5176\u4ed6\u7b97\u6cd5\u66f4\u4f18\u79c0\uff0c\u4f46\u5728\u51b7\u542f\u52a8\u7528\u6237\u53ca\u7269\u54c1\u65b9\u9762\u4f1a\u6709\u95ee\u9898\uff0c\u56e0\u6b64\u901a\u5e38\u4f1a\u4f7f\u7528\u57fa\u4e8e\u5185\u5bb9\u7684\u7b97\u6cd5\u4f5c\u4e3a\u8f85\u52a9\uff1b</li> <li>\u9009\u62e9\u6570\u636e\u96c6\u3001\u5904\u7406\u3001\u540e\u5904\u7406\u3001\u5728\u7ebf\u6a21\u5757\u53ca\u7528\u6237\u754c\u9762\u4e5f\u540c\u6837\u91cd\u8981\uff1b</li> </ul>"},{"location":"machine_learning/ML.html#_18","title":"\u8d85\u53c2\u8c03\u4f18","text":"<p>\u795e\u7ecf\u7f51\u7edc\u7684\u9009\u62e9\uff1a</p> <ul> <li>\u7f51\u7edc\u6709\u591a\u6df1\u3001\u591a\u5bbd\uff1f</li> <li>\u6bcf\u4e00\u5c42\u662f\u8981\u7528\u4ec0\u4e48\u7ed3\u6784\uff1f\u7ebf\u6027\u5c42\u8fd8\u662f\u5377\u79ef\u5c42\uff1f</li> <li>\u5c42\u4e0e\u5c42\u4e4b\u95f4\u5e94\u8be5\u5982\u4f55\u8fde\u63a5\uff1f</li> <li>\u5e94\u8be5\u4f7f\u7528\u4ec0\u4e48\u6837\u7684Activation\uff1f</li> <li>\u5e94\u8be5\u4f7f\u7528\u4ec0\u4e48\u6837\u7684\u4f18\u5316\u7b97\u6cd5\uff1f</li> <li>\u4f18\u5316\u7b97\u6cd5\u7684\u521d\u59cb\u6b65\u957f\u662f\u591a\u5c11\uff0c\u521d\u59cb\u6b65\u957f\u5728\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u5e94\u8be5\u5982\u4f55\u4e0b\u964d\uff1f</li> <li>\u5e94\u8be5\u4f7f\u7528\u4ec0\u4e48\u6837\u7684\u521d\u59cb\u5316\uff1f</li> <li>\u662f\u5426\u9700\u8981\u4f7f\u7528Momentum\u7b97\u6cd5\uff1f\u5982\u679c\u662f\uff0c\u5177\u4f53\u901f\u7387\u662f\u591a\u5c11\uff1f</li> <li>\u5377\u79ef\u5c42\u91cc\u9762\u662f\u5426\u8981\u52a0\u5165\u5e38\u6570\u9879\uff1f</li> <li>\u662f\u5426\u9700\u8981\u4f7f\u7528Dropout\uff1f</li> <li>\u662f\u5426\u9700\u8981\u4f7f\u7528Batch norm\uff1f\u662f\u5426\u9700\u8981\u81ea\u52a8\u8c03\u6574Batch norm\u7684\u53c2\u6570\uff1f</li> <li>\u662f\u5426\u9700\u8981\u4f7f\u7528Weight decay\uff0cWeight decay\u901f\u5ea6\u662f\u591a\u5c11\uff1f</li> <li>Mini batch\u7684\u5927\u5c0f\u662f\u591a\u5c11\uff1f</li> </ul> <p>\u9ed1\u76d2\u4f18\u5316 \uff08black-box function optimization\uff09:</p> <ul> <li>\u7f51\u683c\u641c\u7d22 \uff08grid search\uff09\uff1a\u901a\u8fc7\u904d\u5386\u7ed9\u5b9a\u7684\u53c2\u6570\u7ec4\u5408\u6765\u4f18\u5316\u6a21\u578b\u8868\u73b0\u7684\u65b9\u6cd5\u3002\u7f51\u683c\u641c\u7d22\u7684\u95ee\u9898\u662f\u5f88\u5bb9\u6613\u53d1\u751f\u7ef4\u5ea6\u707e\u96be\uff0c\u4f18\u70b9\u662f\u5f88\u5bb9\u6613\u5e76\u884c\u3002</li> <li>\u968f\u673a\u641c\u7d22 \uff08random search\uff09\uff1a\u5229\u7528\u968f\u673a\u6570\u6c42\u6781\u5c0f\u70b9\u800c\u6c42\u5f97\u51fd\u6570\u8fd1\u4f3c\u7684\u6700\u4f18\u89e3\u7684\u65b9\u6cd5\u3002</li> <li>\u8d1d\u53f6\u65af\u4f18\u5316\uff1a\u8fed\u4ee3\u7684\u4f18\u5316\u7b97\u6cd5\uff0c\u5305\u542b\u4e24\u4e2a\u4e3b\u8981\u7684\u5143\u7d20\uff0c\u8f93\u5165\u6570\u636e\u5047\u8bbe\u7684\u6a21\u578b\u548c\u4e00\u4e2a\u91c7\u96c6\u51fd\u6570\u7528\u6765\u6765\u51b3\u5b9a\u4e0b\u4e00\u6b65\u8981\u8bc4\u4f30\u54ea\u4e00\u4e2a\u70b9</li> </ul>"},{"location":"machine_learning/ML.html#_19","title":"\u5de5\u5177","text":"<p>\u9ed1\u76d2\u4f18\u5316\u7684\u5de5\u5177\uff1a</p> <ul> <li>hyperopt</li> </ul> <p>hyperopt \u662f\u4e00\u4e2aPython\u5e93\uff0c\u53ef\u4ee5\u7528\u6765\u5bfb\u627e\u5b9e\u6570,\u79bb\u6563\u503c,\u6761\u4ef6\u7ef4\u5ea6\u7b49\u641c\u7d22\u7a7a\u95f4\u7684\u6700\u4f73\u503c</p> <ul> <li>Google Vizier</li> </ul> <p>Google\u7684\u5185\u90e8\u7684\u673a\u5668\u5b66\u4e60\u7cfb\u7edf Google Vizier\u80fd\u591f\u5229\u7528\u8fc1\u79fb\u5b66\u4e60\u7b49\u6280\u672f\u81ea\u52a8\u4f18\u5316\u5176\u4ed6\u673a\u5668\u5b66\u4e60\u7cfb\u7edf\u7684\u8d85\u53c2\u6570</p> <ul> <li>advisor\uff1ahttps://github.com/tobegit3hub/advisor</li> </ul> <p>Google Vizier\u7684\u5f00\u6e90\u5b9e\u73b0</p> <ul> <li>katib\uff1ahttps://github.com/kubeflow/katib</li> </ul> <p>\u57fa\u4e8eKubernetes\u7684\u8d85\u53c2\u6570\u4f18\u5316\u5de5\u5177</p>"},{"location":"machine_learning/ML.html#harmonica","title":"Harmonica","text":"<p>\u8bba\u6587\uff1a Hyperparameter Optimization: A Spectral Approach (arxiv.org)</p> <p>\u6e90\u7801\uff1ahttps://github.com/callowbird/Harmonica</p> <ul> <li>\u9002\u7528\u4e8e\u79bb\u6563\u53c2\u6570\u7684\u60c5\u51b5\uff0c\u4e14\u79bb\u6563\u53c2\u6570\u90fd\u53ef\u4ee5\u8f6c\u5316\u4e3a\u5e03\u5c14\u53c2\u6570\uff0c\u56e0\u6b64\u53ea\u8003\u8651\u53c2\u6570\u662f\u5e03\u5c14\u7684\u60c5\u51b5\uff1b</li> <li>\u5bf9\u4e8e\u8fde\u7eed\u53c2\u6570\uff0c\u53ef\u4ee5\u4f7f\u7528\u8d4c\u535a\u673a(Multi-armed Bandit)+\u6700\u901f\u4e0b\u964d\u6cd5(Gradient Descent)\u65b9\u6cd5\uff0c\u6216\u8005\u628a\u5b83\u4eec\u79bb\u6563\u5316\u6210\u4e3a\u79bb\u6563\u53c2\u6570\uff1b</li> </ul> <p>\u62c9\u9501\uff08Lasso\uff09\u7b97\u6cd5\uff1a\u5df2\u77e5<code>y=Ax</code>\uff0c\u5df2\u77e5\u5411\u91cfy \u548c\u77e9\u9635A \uff0c\u60f3\u8981\u6c42x\u3002 </p> <ul> <li>\u5f53 A \u5f88\u6241\u65f6\uff08\u884c\u5c11\u5217\u591a\uff09\uff0cx\u7684\u7ef4\u5ea6\u5f88\u9ad8\uff0c\u5047\u8bbex\u5f88\u7a00\u758f\uff0c\u8fd9\u901a\u8fc7lasso\u53ef\u4ee5\u6c42\u89e3x\uff1b</li> </ul> <p>\u77e9\u9635\u53ef\u4ee5\u770b\u505a\u662f\u6d4b\u91cf\u77e9\u9635\uff0c100\u884c\u8868\u793a\u5c1d\u8bd5100\u4e2a\u4e0d\u540c\u7684\u53c2\u6570\u7ec4\u5408\uff0c10000\u5217\u8868\u793a\u6bcf\u4e2a\u53c2\u6570\u7ec4\u5408\u53ef\u4ee5\u89c2\u5bdf\u5230\u670910000\u4e2a\u7279\u5f81\uff1a</p> <ul> <li>\u8ba4\u4e3a\u9700\u8981\u4f18\u5316\u7684\u8fd9\u4e2a\u53c2\u6570\u51fd\u6570\uff0c\u672c\u8d28\u662f\u4e00\u4e2a\u7ebf\u6027\u51fd\u6570\uff0c\u66f4\u52a0\u786e\u5207\u5730\u8bf4\uff0c\u662f\u4e00\u4e2a\u7a00\u758f\u7684\u7ebf\u6027\u51fd\u6570\uff1b</li> <li>\u53c2\u6570\u51fd\u6570\u51e0\u4e4e\u4e00\u5b9a\u4e0d\u662f\u53c2\u6570\u7684\u7ebf\u6027\u53e0\u52a0\uff0c\u4f46\u662f\u5b83\u4e00\u5b9a\u53ef\u4ee5\u5199\u6210\u67d0\u4e9b\u7279\u5f81\u7684\u7ebf\u6027\u53e0\u52a0\uff1b</li> </ul> <p>\u4f8b\u5982\uff1a\u6df1\u5ea6\u795e\u7ecf\u7f51\u7edc\u5bf9\u56fe\u50cf\u5206\u7c7b\u53ef\u4ee5\u770b\u505a\u662f\u5b83\u7684\u524dn-1\u5c42\u5bf9\u56fe\u7247\u7684\u50cf\u7d20\u8fdb\u884c\u7279\u5f81\u63d0\u53d6\uff0c\u5f97\u5230\u4e86\u6700\u540e\u4e00\u5c42\u7684\u7279\u5f81\u5411\u91cf\u3002\u7136\u540e\u6700\u540e\u4e00\u5c42\u518d\u505a\u4e00\u4e2a\u7ebf\u6027\u53e0\u52a0\uff08linear layer\uff09\uff0c\u5f97\u5230\u4e86\u6700\u540e\u7684\u7b54\u6848\u3002</p> <ul> <li>\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u770b\uff0c\u5176\u5b9e\u795e\u7ecf\u7f51\u7edc\u4e5f\u5047\u8bbe\u56fe\u7247\u5206\u7c7b\u7684\u51fd\u6570\u662f\u4e00\u4e2a\u7ebf\u6027\u51fd\u6570\uff0c\u4e0d\u8fc7\u7ebf\u6027\u51fd\u6570\u7684\u7279\u5f81\u5411\u91cf\u662f\u795e\u7ecf\u7f51\u7edc\u81ea\u5df1\u5b66\u51fa\u6765\u3002</li> </ul> <p>\u4efb\u4f55\u7684\u57fa\u4e8en\u4e2a\u5e03\u5c14\u53c2\u6570\u7684\u53c2\u6570\u51fd\u6570\uff0c\u90fd\u53ef\u4ee5\u5199\u6210\u57fa\u4e8e2^n\u4e2a\u5085\u91cc\u53f6\u57fa\u51fd\u6570\uff08Fourier Basis\uff09\u7684\u7ebf\u6027\u53e0\u52a0\u3002</p> <p>\u95ee\u98981\uff1a\u7ef4\u5ea6\u8fc7\u5927\uff0c\u82e5n\u6bd4\u8f83\u5927\uff0c\u6bd4\u5982\u670960\uff0c\u90a3\u4e482^n\u663e\u7136\u4e0d\u53ef\u63a5\u53d7</p> <ul> <li>\u4f4e\u5ea6\u6570\u5085\u91cc\u53f6\u57fa\uff08Low degree Fourier Basis\uff09\uff0c\u5373\u90a3\u4e9b\u6700\u591a\u53ea\u5305\u542bd\u4e2a\u53c2\u6570\u76f8\u4e58\u7684\u57fa\u51fd\u6570\uff08\u7279\u5f81\u6570\u964d\u4e3an^d\uff0cd=3,4\uff09</li> </ul> <p>\u95ee\u98982\uff1a\u62c9\u9501\u7b97\u6cd5\u80fd\u591f\u627e\u5230x\u7684\u524d\u63d0\u662fx\u662f\u4e00\u4e2a\u7a00\u758f\u5411\u91cf\u3002\u4f46\u662f\uff0c\u5b9e\u9645\u4e0ax\u6839\u672c\u5c31\u4e0d\u662f\u4e00\u4e2a\u7a00\u758f\u5411\u91cf</p> <ul> <li>\u591a\u5c42Lasso\uff0c\u5148\u8dd1\u4e00\u6b21\u62c9\u9501\u5f97\u5230\u90e8\u5206\u91cd\u8981\u7684\u7279\u5f81\uff085\u30016\u4e2a\uff09\uff0c\u56fa\u5b9a\u8fd9\u4e9b\u7279\u5f81\u5bf9\u5269\u4e0b\u7684\u53c2\u6570\u91cd\u65b0\u8fdb\u884c\u968f\u673a\u91c7\u6837\uff0c\u7136\u540e\u8dd1\u62c9\u9501</li> </ul> <p>Harmonica\u7b97\u6cd5\u6d41\u7a0b\uff1a</p> <ol> <li>\u5728\u53c2\u6570\u7a7a\u95f4\u4e2d\uff0c\u968f\u673a\u91c7\u6837\uff08\u6bd4\u5982\uff09100\u4e2a\u70b9\uff1b</li> <li>\u5bf9\u6bcf\u4e2a\u70b9\u8ba1\u7b97\u4f4e\u5ea6\u6570\u5085\u91cc\u53f6\u57fa\u7684\u7279\u5f81\u5411\u91cf\uff0c\u6355\u6349\u53c2\u6570\u4e4b\u95f4\u7684\u76f8\u5173\u6027\uff1b</li> <li>\u5bf9\u4e8e\u8ba1\u7b97\u597d\u7684100\u4e2a\u7279\u5f81\u5411\u91cf\uff0c\u8dd1\u62c9\u9501\u7b97\u6cd5\uff0c\u5f97\u5230\uff08\u6bd4\u5982\uff09 5\u4e2a\u91cd\u8981\u7684\u7279\u5f81\uff0c\u4ee5\u53ca\u8fd9\u4e9b\u7279\u5f81\u5bf9\u5e94\u7684\u53c2\u6570\uff1b</li> <li>\u56fa\u5b9a\u8fd9\u4e9b\u53c2\u6570\u7684\u503c\uff0c\u5f97\u5230\u4e86\u65b0\u7684\u8c03\u53c2\u6570\u95ee\u9898\uff08\u53c2\u6570\u4e2a\u6570\u51cf\u5c11\uff0c\u641c\u7d22\u7a7a\u95f4\u964d\u4f4e\uff09\u3002\u56de\u5230\u7b2c\u4e00\u6b65</li> </ol> <p>Harmonica\u7684\u51e0\u4e2a\u4f18\u70b9\uff1a</p> <ul> <li>\u5bf9\u53c2\u6570\u4e2a\u6570\u7684\u589e\u957f\u4e0d\u654f\u611f</li> <li>\u4f18\u5316\u901f\u5ea6\u6781\u5feb\u4e14\u5bb9\u6613\u5e76\u884c</li> <li>\u53ef\u4ee5\u81ea\u52a8\u9ad8\u6548\u5730\u63d0\u53d6\u91cd\u8981\u7684\u7279\u5f81</li> </ul>"},{"location":"machine_learning/ML.html#meta-learning","title":"\u5143\u5b66\u4e60 Meta Learning","text":"<p>\u901a\u8fc7\u5bf9\u73b0\u6709\u7684\u5b66\u4e60\u4efb\u52a1\u4e4b\u95f4\u7684\u6027\u80fd\u5dee\u5f02\u8fdb\u884c\u7cfb\u7edf\u7684\u89c2\u6d4b\uff0c\u7136\u540e\u5b66\u4e60\u5df2\u6709\u7684\u7ecf\u9a8c\u548c\u5143\u6570\u636e\uff0c\u7528\u4e8e\u66f4\u597d\u7684\u6267\u884c\u65b0\u7684\u5b66\u4e60\u4efb\u52a1\u3002</p>"},{"location":"machine_learning/ML.html#automl","title":"AutoML","text":"<p>Auto-Sklearn</p> <p>AutoKeras</p> <p>TPOT</p> <p>Python auto_ml </p> <p>\u8d85\u53c2\u8c03\u4f18\uff1a\u6709\u7f51\u683c\u641c\u7d22\u3001\u968f\u673a\u68af\u5ea6\u4e0b\u964d\u548c\u8d1d\u53f6\u65af\u8d85\u53c2\u4f18\u5316\u3002</p> <ul> <li>\u7f51\u683c\u641c\u7d22\u6548\u7387\u6162\uff0c\u968f\u673a\u68af\u5ea6\u5c40\u90e8\u6700\u4f18\uff1b</li> </ul> <p>\u6a21\u578b\u9009\u62e9\u7684\u540c\u65f6\u8fdb\u884c\u8d85\u53c2\u8c03\u4f18\uff1a\u5f3a\u5316\u5b66\u4e60\uff0c\u7ecf\u5178\u95ee\u9898\u201c\u591a\u6447\u81c2\u5a03\u5a03\u673a\u201d\u3002</p> <p>\u540c\u65f6\u9009\u62e9\u7279\u5f81\u5de5\u7a0b\u3001\u6a21\u578b\u9009\u62e9\u548c\u8d85\u53c2\u8c03\u4f18\uff1aQ-Learning\u3002</p> <p>\u5143\u5b66\u4e60\uff1a\u9488\u5bf9Q-Learning\u7684\u51b7\u542f\u52a8\u95ee\u9898</p>"},{"location":"machine_learning/ML.html#_20","title":"\u795e\u7ecf\u7f51\u7edc\u67b6\u6784\u641c\u7d22","text":"<p>\u4ee5Google\u63d0\u51fa\u7684\u9ad8\u6548\u795e\u7ecf\u7f51\u7edc\u67b6\u6784\u641c\u7d22\u7b97\u6cd5ENAS\u4e3a\u4f8b\uff0c\u5b83\u514b\u670d\u4e86\u795e\u7ecf\u67b6\u6784\u641c\u7d22\u7b97\u529b\u6210\u672c\u5de8\u5927\u7684\u7f3a\u9677\uff0c\u5c06\u7b97\u529b\u6210\u672c\u51cf\u5c111000\u500d\u4ee5\u4e0a\uff0c\u4ec5\u7528\u4e00\u5757\u82f1\u4f1f\u8fbeGTX 1080Ti\u663e\u5361\uff0c\u5c31\u80fd\u572816\u4e2a\u5c0f\u65f6\u4e4b\u5185\u5b8c\u6210\u67b6\u6784\u641c\u7d22\u3002</p> <p>\u81ea\u52a8\u5316\u7684\u795e\u7ecf\u7f51\u7edc\u67b6\u6784\u641c\u7d22NAS\uff1a</p> <ul> <li>ENAS\u4f7f\u7528\u4e00\u4e2aRNN\uff08\u79f0\u4e3acontroller\uff09\u51b3\u5b9a\u6bcf\u4e2a\u8282\u70b9\u7684\u8ba1\u7b97\u7c7b\u578b\u548c\u9009\u62e9\u6fc0\u6d3b\u54ea\u4e9b\u8fb9\u3002ENAS\u4e2d\u4f7f\u7528\u8282\u70b9\u6570\u4e3a12\u7684\u641c\u7d22\u7a7a\u95f4\uff0c\u8ba1\u7b97\u7c7b\u578b\u4e3atanh\uff0crelu\uff0cidentity\uff0csigmoid\u56db\u79cd\u6fc0\u6d3b\u51fd\u6570\uff0c\u6240\u4ee5\u641c\u7d22\u7a7a\u95f4\u6709 \u7ea64^N*N!\u79cd\u7ea610^15\u79cd\u795e\u7ecf\u7f51\u7edc\u67b6\u6784\u3002</li> </ul>"},{"location":"machine_learning/auto_encoder.html","title":"Auto Encoder","text":"<p>\u7c7b\u4f3c\u4e8e\u964d\u7ef4</p> <p>PCA</p> <p>\u6587\u672c\u62bd\u53d6\uff1f</p> <p>\u76f8\u4f3c\u56fe\u50cf\u8bc6\u522b</p> <p>AutoEncoder\u4e00\u822ccoder\u5c0f\u4e8e\u539f\u59cb\u6570\u636e\u8f93\u5165\uff1f</p> <ul> <li>why\uff1f</li> </ul> <p>Greedy Lay-wise Pre-training again</p> <ul> <li> <p>\u57fa\u672c\u4e0d\u7528</p> </li> <li> <p>\u5927\u91cfunlabel data\u8fd8\u662f\u6709\u7528\uff1f</p> </li> </ul> <p>De-noise Auto Encoder</p>"},{"location":"machine_learning/datasets.html","title":"\u6570\u636e\u96c6","text":""},{"location":"machine_learning/datasets.html#_2","title":"\u4eba\u8138\u5173\u952e\u70b9\u68c0\u6d4b\u6570\u636e\u5e93","text":"<p>\u73b0\u9636\u6bb5\u4eba\u8138\u5173\u952e\u70b9\u68c0\u6d4b\u6570\u636e\u5e93\u901a\u5e38\u4e3a\u590d\u6742\u73af\u5883\u4e0b\u91c7\u96c6\u7684\u6570\u636e\u5e93\u3002</p> <p>LFPW \uff1a1132 \u5e45\u8bad\u7ec3\u4eba\u8138\u56fe\u50cf\u548c 300 \u5e45\u6d4b\u8bd5\u4eba\u8138\u56fe\u50cf\uff0c\u5927\u90e8\u5206\u4e3a\u6b63\u9762\u4eba\u8138\u56fe\u50cf\uff0c\u6bcf\u4e2a\u4eba\u8138\u6807\u5b9a 29 \u4e2a\u5173\u952e\u70b9\u3002</p> <p>AFLW \uff1a25993 \u5e45\u91c7\u96c6\u7684\u4eba\u8138\u56fe\u50cf\uff0c\u6bcf\u4e2a\u4eba\u8138\u6807\u5b9a 21 \u4e2a\u5173\u952e\u70b9\u3002</p> <p>COFW \uff1a\u5305\u542b LFPW \u8bad\u7ec3\u96c6\u4e2d\u7684 845 \u5e45\u4eba\u8138\u56fe\u50cf\u4ee5\u53ca\u5176\u4ed6 500 \u5e45\u906e\u6321\u4eba\u8138\u56fe\u50cf\uff0c\u6d4b\u8bd5\u96c6\u4e3a 507 \u5e45\u4e25\u91cd\u906e\u6321\uff08\u540c\u65f6\u5305\u542b\u59ff\u6001\u548c\u8868\u60c5\u7684\u53d8\u5316\uff09\u7684\u4eba\u8138\u56fe\u50cf\uff1b</p> <p>MVFW \uff1a\u591a\u89c6\u89d2\u4eba\u8138\u6570\u636e\u96c6\uff0c\u5305\u62ec 2050 \u5e45\u8bad\u7ec3\u4eba\u8138\u56fe\u50cf\u548c 450 \u5e45\u6d4b\u8bd5\u4eba\u8138\u56fe\u50cf\uff0c\u6bcf\u4e2a\u4eba\u8138\u6807\u5b9a 68 \u4e2a\u5173\u952e\u70b9\u3002</p> <p>OCFW \uff1a\u5305\u542b 2951 \u5e45\u8bad\u7ec3\u4eba\u8138\u56fe\u50cf\uff08\u5747\u4e3a\u672a\u906e\u6321\u4eba\u8138\uff09\u548c 1246 \u5e45\u6d4b\u8bd5\u4eba\u8138\u56fe\u50cf\uff08\u5747\u4e3a\u906e\u6321\u4eba\u8138\uff09\uff0c\u6bcf\u4e2a\u4eba\u8138\u6807\u5b9a 68 \u4e2a\u5173\u952e\u70b9\u3002</p> <p>WFLW\uff1a7500 \u7528\u4e8e\u8bad\u7ec3\uff0c2500 \u5f20\u7528\u4e8e\u6d4b\u8bd5\uff0c\u9664\u4e8698\u4e2a\u5173\u952e\u70b9\u4e4b\u5916\uff0c\u8fd8\u6709\u906e\u6321\u3001\u59ff\u6001\u3001\u5986\u5bb9\u3001\u5149\u7167\u3001\u6a21\u7cca\u548c\u8868\u60c5\u7b49\u4fe1\u606f\u7684\u6807\u6ce8\u3002</p>"},{"location":"machine_learning/datasets.html#uci","title":"UCI\u6570\u636e\u96c6","text":"<p>http://archive.ics.uci.edu/ml/datasets.php</p>"},{"location":"machine_learning/datasets.html#libsvm","title":"LIBSVM","text":"<p>https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/</p>"},{"location":"machine_learning/datasets.html#_3","title":"\u4e8c\u5206\u7c7b","text":"<p>https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/binary.html</p> \u6570\u636e\u96c6\u540d\u79f0 \u884c\u6570 \u7279\u5f81\u6570 avazu 40,428,967 1,000,000 covtype.binary 581,012 54 criteo 45,840,617 1,000,000 criteo_tb 4,195,197,692 1,000,000 epsilon 400,000 2,000 HIGGS 11,000,000 28 kdd2010 (algebra) 8,407,752 20,216,830 kdd2010 (bridge to algebra) 19,264,097 29,890,095 kdd2010 raw version (bridge to algebra) 19,264,097 1,163,024 kdd2012 119,705,032 54,686,452 SUSY 5,000,000 18 url 2,396,130 3,231,961 webspam 350,000 16,609,143"},{"location":"machine_learning/datasets.html#_4","title":"\u591a\u5206\u7c7b","text":"<p>https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass.html</p>"},{"location":"machine_learning/datasets.html#_5","title":"\u56de\u5f52","text":"<p>https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/regression.html</p>"},{"location":"machine_learning/datasets.html#_6","title":"\u591a\u6807\u7b7e\u5206\u7c7b","text":"<p>https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multilabel.html</p>"},{"location":"machine_learning/datasets.html#_7","title":"\u6587\u672c\u8bed\u6599\u5e93\uff08\u4e2d\u6587\uff09","text":""},{"location":"machine_learning/datasets.html#_8","title":"\u5206\u8bcd\u8bed\u6599\u5e93","text":"<p>SIGHAN - 2nd International Chinese Word Segmentation Bakeoff</p>"},{"location":"machine_learning/datasets.html#_9","title":"\u8bcd\u6027\u6807\u6ce8\u8bed\u6599\u5e93","text":""},{"location":"machine_learning/datasets.html#_10","title":"\u547d\u540d\u5b9e\u4f53\u8bc6\u522b\u8bed\u6599\u5e93","text":""},{"location":"machine_learning/datasets.html#_11","title":"\u53e5\u6cd5\u5206\u6790\u8bed\u6599\u5e93","text":""},{"location":"machine_learning/datasets.html#_12","title":"\u6587\u672c\u5206\u7c7b\u8bed\u6599\u5e93","text":""},{"location":"machine_learning/datasets.html#_13","title":"\u8bed\u6599\u5e93\u5efa\u8bbe","text":"<p>brat(brat rapid annotation tool) \u6807\u6ce8\u8f6f\u4ef6\uff0c\u652f\u6301\u8bcd\u6027\u6807\u6ce8\u3001\u547d\u540d\u5b9e\u4f53\u8bc6\u522b\u548c\u53e5\u6cd5\u5206\u6790\u7b49\u4efb\u52a1\u3002</p>"},{"location":"machine_learning/knowledge_graph.html","title":"\u77e5\u8bc6\u56fe\u8c31","text":"<p>\u77e5\u8bc6\u56fe\u8c31\u8fd9\u4e2a\u6982\u5ff5\u6700\u65e9\u7531Google\u63d0\u51fa\uff0c\u4e3b\u8981\u662f\u7528\u6765\u4f18\u5316\u73b0\u6709\u7684\u641c\u7d22\u5f15\u64ce\u3002</p> <p>\u77e5\u8bc6\u56fe\u8c31\u672c\u8d28\u4e0a\u662f\u8bed\u4e49\u7f51\u7edc\uff0c\u662f\u4e00\u79cd\u57fa\u4e8e\u56fe\u7684\u6570\u636e\u7ed3\u6784\uff0c\u7531\u8282\u70b9(Point)\u548c\u8fb9(Edge)\u7ec4\u6210\u3002</p> <p>\u5728\u77e5\u8bc6\u56fe\u8c31\u91cc\uff0c\u6bcf\u4e2a\u8282\u70b9\u8868\u793a\u73b0\u5b9e\u4e16\u754c\u4e2d\u5b58\u5728\u7684\u201c\u5b9e\u4f53\u201d\uff0c\u6bcf\u6761\u8fb9\u4e3a\u5b9e\u4f53\u4e0e\u5b9e\u4f53\u4e4b\u95f4\u7684\u201c\u5173\u7cfb\u201d\u3002</p> <p>\u7279\u5b9a\u9886\u57df\u91cc\u7684 (Domain-Specific) \u77e5\u8bc6\u56fe\u8c31\u8868\u793a\u65b9\u5f0f\u548c\u5e94\u7528</p> <p>\u5b58\u50a8\u65b9\u5f0f\u4e3b\u8981\u6709\u4e24\u79cd\u5f62\u5f0f\uff1aRDF\u5b58\u50a8\u683c\u5f0f\uff08\u5982Apache Jena\uff09 \u548c \u56fe\u6570\u636e\u5e93\uff08\u5982 Neo4j\uff09\u3002</p>"},{"location":"machine_learning/knowledge_graph.html#_2","title":"\u5e94\u7528\u573a\u666f","text":""},{"location":"machine_learning/knowledge_graph.html#_3","title":"\u53cd\u6b3a\u8bc8","text":"<p>\u53cd\u6b3a\u8bc8\u7684\u6838\u5fc3\u662f\u4eba\uff0c\u9996\u5148\u9700\u8981\u628a\u4e0e\u501f\u6b3e\u4eba\u76f8\u5173\u7684\u6240\u6709\u7684\u6570\u636e\u6e90\u6253\u901a\uff0c\u5e76\u6784\u5efa\u5305\u542b\u591a\u6570\u636e\u6e90\u7684\u77e5\u8bc6\u56fe\u8c31\u3002</p> <p>\u6574\u5408\u501f\u6b3e\u4eba\u7684\u57fa\u672c\u4fe1\u606f\uff08\u6bd4\u5982\u7533\u8bf7\u65f6\u586b\u5199\u7684\u4fe1\u606f\uff09\uff0c\u8fd8\u53ef\u4ee5\u628a\u501f\u6b3e\u4eba\u7684\u6d88\u8d39\u8bb0\u5f55\u3001\u884c\u4e3a\u8bb0\u5f55\u3001\u7f51\u4e0a\u7684\u6d4f\u89c8\u8bb0\u5f55\u7b49\u3002</p> <ul> <li>\u4e0d\u4e00\u81f4\u6027\u9a8c\u8bc1\uff08\u77e5\u8bc6\u63a8\u7406\uff09\uff1a\u501f\u6b3e\u4eba\u586b\u5199\u540c\u4e00\u4e2a\u516c\u53f8\u7535\u8bdd\uff0c\u4f46\u662f\u516c\u53f8\u540d\u4e0d\u4e00\u6837\uff1b</li> <li>\u7ec4\u56e2\u6b3a\u8bc8\uff1a\u501f\u6b3e\u4eba\u6ca1\u6709\u76f4\u63a5\u5173\u7cfb\uff0c\u4f46\u662f\u5171\u4eab\u90e8\u5206\u4fe1\u606f\uff1b</li> <li>\u5f02\u5e38\u5206\u6790\uff1a\u9759\u6001\u5206\u6790\uff08\u5f02\u5e38\u7ed3\u6784\uff09\uff0c\u52a8\u6001\u5206\u6790\uff08\u5206\u6790\u5176\u7ed3\u6784\u968f\u65f6\u95f4\u53d8\u5316\u7684\u8d8b\u52bf\uff09\uff1b</li> </ul>"},{"location":"machine_learning/math.html","title":"\u57fa\u7840\u6570\u5b66","text":"<p>L1\u662f\u5047\u8bbe\u53c2\u6570\u670d\u4ece\u53cc\u6307\u6570\u5206\u5e03\uff0c\u5229\u4e8e\u4fdd\u8bc1\u6743\u503c\u5411\u91cf\u7684\u7a00\u758f\u6027\uff1b</p> <p>L2\u662f\u5047\u8bbe\u53c2\u6570\u670d\u4ece\u9ad8\u65af\u5206\u5e03\uff0c\u5229\u4e8e\u9632\u6b62\u8fc7\u62df\u5408\u3002</p>"},{"location":"machine_learning/math.html#_2","title":"\u6982\u5ff5","text":"<p>\u65b9\u5dee\uff08Variance\uff09\u662f\u5ea6\u91cf\u4e00\u7ec4\u6570\u636e\u7684\u5206\u6563\u7a0b\u5ea6\u3002\u65b9\u5dee\u662f\u5404\u4e2a\u6837\u672c\u4e0e\u6837\u672c\u5747\u503c\u7684\u5dee\u7684\u5e73\u65b9\u548c\u7684\u5747\u503c\uff1a </p> <p>\u534f\u65b9\u5dee\uff08Covariance\uff09\u662f\u5ea6\u91cf\u4e24\u4e2a\u53d8\u91cf\u7684\u53d8\u52a8\u7684\u540c\u6b65\u7a0b\u5ea6\uff0c\u4e5f\u5c31\u662f\u5ea6\u91cf\u4e24\u4e2a\u53d8\u91cf\u7ebf\u6027\u76f8\u5173\u6027\u7a0b\u5ea6\u3002</p> <ul> <li>\u5982\u679c\u4e24\u4e2a\u53d8\u91cf\u7684\u534f\u65b9\u5dee\u4e3a0\uff0c\u5219\u7edf\u8ba1\u5b66\u4e0a\u8ba4\u4e3a\u4e8c\u8005\u7ebf\u6027\u65e0\u5173\u3002\u6ce8\u610f\u4e24\u4e2a\u65e0\u5173\u7684\u53d8\u91cf\u5e76\u975e\u5b8c\u5168\u72ec\u7acb\uff0c\u53ea\u662f\u6ca1\u6709\u7ebf\u6027\u76f8\u5173\u6027\u800c\u5df2\u3002</li> </ul> <p>\u534f\u65b9\u5dee\u77e9\u9635\uff08Covariance matrix\uff09\u7531\u6570\u636e\u96c6\u4e2d\u4e24\u4e24\u53d8\u91cf\u7684\u534f\u65b9\u5dee\u7ec4\u6210\u3002</p>"},{"location":"machine_learning/math.html#_3","title":"\u4fe1\u606f\u71b5","text":"<p>\u4fe1\u606f\u71b5\uff1a\u4fe1\u606f\u7684\u4e0d\u786e\u5b9a\u6027\u7684\u5ea6\u91cf\uff0c\u4fe1\u606f\u7684\u672c\u8d28\u662f\u6d88\u9664\u4e0d\u786e\u5b9a\u6027\uff1a</p> <ul> <li>\u4e00\u4e2a\u9009\u62e9\u9898\uff0c\u6709A\uff0cB\u4e24\u4e2a\u9009\u9879\uff0c\u544a\u8bc9\u4f60\u6b63\u786e\u7b54\u6848\u662fA\uff0c\u5b8c\u6210\u4e00\u4e2a\u4ece\u4e0d\u786e\u5b9a\u5230\u786e\u5b9a\u7684\u8fc7\u7a0b\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u548c\u786e\u5b9a\u4e00\u4e2a\u662f0\u8fd8\u662f1\u672c\u8d28\u4e0a\u662f\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u5b83\u7684\u91cf\u7eb2\u5c31\u53eb\u505abit\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6570\u5b57\u6240\u4ee3\u8868\u7684\u7684\u4fe1\u606f\u91cf\u3002</li> </ul>"},{"location":"machine_learning/math.html#_4","title":"\u5b9a\u4e49","text":"<p>\u968f\u673a\u53d8\\(X\\)\u7684\u71b5\u503c\\(H\\)\u5b9a\u4e49\u5982\u4e0b\uff0c\u5176\u503c\u57df\u4e3a\\({x_1, ..., x_n}\\)</p> <p>\\(H(X)=- \\displaystyle \\sum_{i}{P(x_i)log_b{P(X_i)}}\\)</p> <ul> <li> <p>b\u662f\u5bf9\u6570\u6240\u4f7f\u7528\u7684\u5e95\u3002\u5f53 b = 2\uff0c\u71b5\u7684\u5355\u4f4d\u662fbit\u3002</p> </li> <li> <p>\\(P\\)\u4e3a\\(X\\)\u7684\u6982\u7387\u8d28\u91cf\u51fd\u6570\uff08probability mass function\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e8b\u4ef6\\(x_i\\)\u53d1\u751f\u7684\u6982\u7387\u3002</p> </li> </ul> <p>\u629b\u4e00\u6b21\u786c\u5e01\u662f\u6b63\u9762\u201d\u8fd9\u4e2a\u968f\u673a\u53d8\u91cfX\u7684\u4fe1\u606f\u71b5\u4e3a</p> <p>\\(H(X)=-(\\frac{1}{2}log_2{\\frac{1}{2}} + \\frac{1}{2}log_2{\\frac{1}{2}}) = 1\\)</p> <p>\u5373\u629b\u4e00\u6b21\u786c\u5e01\u662f\u6b63\u9762\u8fd9\u4e2a\u4e8b\u4ef6\u7684\u4fe1\u606f\u71b5\u53ea\u9700\u89811 bit\u3002</p>"},{"location":"machine_learning/math.html#_5","title":"\u793a\u4f8b","text":"<p>1000\u6876\u6c34\uff0c\u5176\u4e2d\u4e00\u6876\u6709\u6bd2\uff0c\u732a\u559d\u6bd2\u6c34\u540e\u4f1a\u572815\u5206\u949f\u5185\u6b7b\u53bb\uff0c\u60f3\u752815\u5206\u949f\u5185\u627e\u5230\u8fd9\u6876\u6bd2\u6c34\uff0c\u81f3\u5c11\u9700\u8981\u51e0\u5934\u732a\uff1f</p> <ol> <li>\u201d1000\u6876\u6c34\u5176\u4e2d\u6709\u4e00\u6876\u6709\u6bd2\u201c\u8fd9\u4e2a\u968f\u673a\u53d8\u91cfX\u7684\u4fe1\u606f\u71b5\u4e3a</li> </ol> <p>\\(H(X)=-log_2{\\frac{1}{1000}} = 9.966\\)</p> <ol> <li>1\u53ea\u732a\u559d\u6c34\u4ee5\u540e\u7684\u8981\u4e48\u6d3b\u7740\uff0c\u8981\u4e48\u6b7b\u53bb\uff0c\u4e00\u5171\u6709\u4e24\u79cd\u72b6\u6001\uff0c\u6240\u4ee5\u201d1\u53ea\u732a\u559d\u5b8c\u6c34\u4ee5\u540e\u7684\u72b6\u6001\u201c\u8fd9\u4e2a\u968f\u673a\u53d8\u91cfY\u7684\u4fe1\u606f\u71b5\u4e3a</li> </ol> <p>\\(H(X)=-(\\frac{1}{2}log_2{\\frac{1}{2}} + \\frac{1}{2}log_2{\\frac{1}{2}}) = 1\\)</p> <ol> <li>n\u53ea\u732a\u559d\u5b8c\u6c34\u4f1a\u6709\u79cd\u72b6\u6001\uff0c\u5373\"n\u53ea\u732a\u559d\u5b8c\u6c34\u4ee5\u540e\u7684\u72b6\u6001\"\u8fd9\u4e2a\u968f\u673a\u53d8\u91cfY\u7684\u4fe1\u606f\u71b5\u4e3a</li> </ol> <p>\\(H(X)=-\\sum^{2^n}_{i=1}\\frac{1}{2^n}log_2{\\frac{1}{2^n}} = -log_2{\\frac{1}{2^n}}=n\\)</p> <ol> <li>\u6309\u7167\u9898\u76ee\u8981\u6c42\uff0c\u5982\u679c\u81f3\u5c11\u9700\u8981n\u5934\u732a\u80fd\u591f\u627e\u5230\u8fd9\u6876\u6bd2\u6c34\uff0c\u90a3\u4e48\u968f\u673a\u53d8\u91cfY\u7684\u4fe1\u606f\u71b5\u5fc5\u987b\u8981\u5927\u4e8e\u968f\u673a\u53d8\u91cfX\u7684\u4fe1\u606f\u71b5\uff0c\u4e5f\u5c31\u662f</li> </ol> <p>\\(H(Y) &gt;= H(X)\\) \uff0c\u4e5f\u5c31\u662f$ n &gt;= 9.966$\uff0c\u5373 n = 10</p> <p>1000\u6876\u6c34\uff0c\u5176\u4e2d\u4e00\u6876\u6709\u6bd2\uff0c\u732a\u559d\u6bd2\u6c34\u540e\u4f1a\u572815\u5206\u949f\u5185\u6b7b\u53bb\uff0c\u60f3\u7528\u4e00\u4e2a\u5c0f\u65f6\u627e\u5230\u8fd9\u6876\u6bd2\u6c34\uff0c\u81f3\u5c11\u9700\u8981\u51e0\u5934\u732a\uff1f</p> <p>https://www.zhihu.com/question/60227816/answer/1274071217</p> <ol> <li>\u201d1000\u6876\u6c34\u5176\u4e2d\u6709\u4e00\u6876\u6709\u6bd2\u201c\u8fd9\u4e2a\u968f\u673a\u53d8\u91cfX\u7684\u4fe1\u606f\u71b5\u4e3a</li> </ol> <p>\\(H(X)=-log_2{\\frac{1}{1000}} = 9.966\\)</p> <ol> <li>1\u53ea\u732a1\u4e2a\u5c0f\u65f6\u4ee5\u540e\u4f1a\u67095\u79cd\u72b6\u6001\uff0c\u6240\u4ee5\u201d1\u53ea\u732a1\u4e2a\u5c0f\u65f6\u540e\u7684\u72b6\u6001\u201c\u8fd9\u4e2a\u968f\u673a\u53d8\u91cfZ\u7684\u4fe1\u606f\u71b5\u4e3a</li> </ol> <p>\\(H(Z)=-log_2{5 * \\frac{1}{5}log_2{\\frac{1}{5}}} = log_2{5}=2.3219\\)</p> <ol> <li>n\u53ea\u732a1\u4e2a\u5c0f\u65f6\u540e\u4f1a\u6709\\({5^n}\\)\u79cd\u72b6\u6001\uff0c\u5373\"n\u53ea\u732a1\u4e2a\u5c0f\u65f6\u4ee5\u540e\u7684\u72b6\u6001\"\u8fd9\u4e2a\u968f\u673a\u53d8\u91cfY\u7684\u4fe1\u606f\u71b5\u4e3a</li> </ol> <p>\\(H(X)=-\\sum^{5^n}_{i=1}\\frac{1}{5^n}log_2{\\frac{1}{5^n}} = -log_2{\\frac{1}{5^n}}=2.3219n\\)</p> <ol> <li>\u5982\u679c\u81f3\u5c11\u9700\u8981n\u5934\u732a\u80fd\u591f\u627e\u5230\u8fd9\u6876\u6bd2\u6c34\uff0c\u90a3\u4e48\u968f\u673a\u53d8\u91cfY\u7684\u4fe1\u606f\u71b5\u5fc5\u987b\u8981\u5927\u4e8e\u968f\u673a\u53d8\u91cfX\u7684\u4fe1\u606f\u71b5</li> </ol> <p>$H(Y) &gt;= H(X) $\uff0c\u5373 \\(n &gt;= 9.966 / 2.3219 = 4.292\\)\uff0c\u5373 n = 5</p>"},{"location":"machine_learning/math.html#_6","title":"\u5085\u91cc\u53f6\u53d8\u6362","text":"<p>\u5085\u91cc\u53f6\u7ea7\u6570\uff0c\u5728\u65f6\u57df\u662f\u4e00\u4e2a\u5468\u671f\u4e14\u8fde\u7eed\u7684\u51fd\u6570\uff0c\u800c\u5728\u9891\u57df\u662f\u4e00\u4e2a\u975e\u5468\u671f\u79bb\u6563\u7684\u51fd\u6570\u3002</p> <p>\u5085\u91cc\u53f6\u53d8\u6362\uff0c\u5219\u662f\u5c06\u4e00\u4e2a\u65f6\u57df\u975e\u5468\u671f\u7684\u8fde\u7eed\u4fe1\u53f7\uff0c\u8f6c\u6362\u4e3a\u4e00\u4e2a\u5728\u9891\u57df\u975e\u5468\u671f\u7684\u8fde\u7eed\u4fe1\u53f7\u3002</p>"},{"location":"machine_learning/ai4sys/index.html","title":"Index","text":"<p>[toc]</p>"},{"location":"machine_learning/ai4sys/index.html#ai4sys","title":"AI4Sys","text":"<p>\u6765\u6e90\uff1ahttps://ucbrise.github.io/cs294-ai-sys-fa19/#</p> <p>PPT\uff1ahttps://gitee.com/oscsc/ai4-sys-course</p> <p>[01.]</p> <p>03. ML \u751f\u547d\u5468\u671f</p> <p>05.\u6df1\u5ea6\u5b66\u4e60\u6846\u67b6</p> <p>06.\u5206\u5e03\u5f0f\u8bad\u7ec3</p> <ul> <li>A Few Useful Things to Know About Machine Learning</li> </ul> <p>provide some context on high-levels ideas in ML</p> <ul> <li>Principles of Computer System Design</li> </ul> <p>provide some context on high-levels ideas in Systems</p> <ul> <li>SysML&amp; Berkeley view of systems challenges for AI</li> </ul> <p>\u89c2\u5bdf\u5173\u4e8eAI-System\u7814\u7a76\u4e2d\u7684\u4e24\u4e2a\u6846\u67b6\u8bbe\u8ba1</p> <p>picture_03: ml_lifecycle</p> <p>project_05: deep_learning_frameworks</p> <p>picture_06: distributed_learning</p> <p>project_07:prediction serving</p> <p>preject_11\uff1aAdversaries </p>"},{"location":"machine_learning/ai4sys/adversaries.html","title":"Adversaries","text":"<p>[toc]</p>"},{"location":"machine_learning/ai4sys/adversaries.html#adversaries-ml","title":"Adversaries ML","text":"<p>Protect the data, the model, and the query (Sensitive).</p> <p>Training: Data Poisoning Attack</p> <ul> <li> <p>Scenario: Spammers rating emails to affect classifier.</p> </li> <li> <p>Real-world problem</p> </li> <li> <p>Kinds of Attacks</p> <ul> <li> <p>Train model to misclassify their spam as spam.</p> </li> <li> <p>Train model to misclassify everything (DoS attack). why?</p> </li> <li> <p>Train model to classify competitor email as spam.</p> </li> <li>Responses</li> <li>Careful validation of training data </li> <li>Reject on negative impact (RONI) defense</li> <li>Personalization  </li> </ul> </li> </ul>"},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html","title":"\u6df1\u5ea6\u5b66\u4e60\u6846\u67b6","text":""},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html#_2","title":"\u76ee\u6807","text":"<ul> <li>\u673a\u5668\u5b66\u4e60\u6846\u67b6\u7684\u5386\u53f2\u6f14\u8fdb\uff1b</li> <li>\u58f0\u660e\u5f0f\u548c\u547d\u4ee4\u5f0f\u7684DSL\uff08Domain Specific Language\uff09\uff1b</li> <li>\u81ea\u52a8\u5fae\u5206\uff1b</li> </ul> <p>\u65e9\u671f\u7684 ML/\u7edf\u8ba1 \u8bed\u8a00</p> <ul> <li>S -&gt; R</li> <li>Matlab\uff0cOctave\u5f00\u6e90\u7248</li> </ul> <p>\u73b0\u5728\uff1a2012\u5e74\u540e\uff0c\u5927\u91cf\u4eceMatlab\u8f6c\u5230Python</p> <ul> <li>Python\uff1aiPython (2001) + SciPy (2001) + Matplotlib (2003) + NumPy (2006)</li> <li>sklearn\uff1a\u57fa\u7840ML\u7b97\u6cd5\u548c\u6a21\u578b \uff082007\uff09</li> </ul> <p>\u673a\u5668\u5b66\u4e60\u5e93</p> <ul> <li>LIBLINEAR/LIBSVM\uff082008\uff09\uff1a\u7ebf\u6027\u6a21\u578b\u548cSVM\uff0cin sklean</li> <li>Vowpal Wabbit\uff1a2010\uff0c\u6cdb\u5316\u7ebf\u6027\u6a21\u578b\u7b49</li> <li>Weka\uff081997\uff09\uff1aJava\u7684\u673a\u5668\u5b66\u4e60\u7b97\u6cd5</li> <li>Xgboost\uff082014\uff09\uff1a\u5206\u5e03\u5f0f\u7684boosted\u51b3\u7b56\u6811</li> </ul> <p>\u5206\u5e03\u5f0f\u673a\u5668\u5b66\u4e60\u5e93</p> <ul> <li>Mahout\uff082009\uff09\uff1aML on Hadoop</li> <li>GraphLab\uff082010\uff09\uff1a\u56fe\u7ed3\u6784\u7b97\u6cd5</li> <li>SparkML\uff082014\uff09\uff1a\u53c2\u8003GraphLab\u3001Sklearn\u3001SystemML\uff1b\u5185\u5b58Cache\uff1b</li> </ul> <p>Embedded Domain Specific Languages</p> <ul> <li> <p>\u4f5c\u4e3a\u7279\u5b9a\u4efb\u52a1\u7684 libraries \u6216 \u8bed\u8a00\u6269\u5c55</p> </li> <li> <p>\u662fDSL \u548c \u901a\u7528\u8bed\u8a00\u7684\u7ed3\u5408\uff0c\u7ed3\u5408\u53cc\u65b9\u7684\u597d\u5904\uff0c\u5982\u7ebf\u6027\u4ee3\u6570\u5e93</p> </li> </ul> <p>ML Pipelines</p> <ul> <li>Sklearn Pipelines</li> <li>Spark ML Pipelines</li> </ul> <p>SystemML \u548c KeyStone ML</p> <ul> <li>SystemML \uff1aR like\uff0cnot embedded</li> <li>KeyStone ML\uff1aembedded scala DSL\uff0con top of spark</li> </ul> <p>\u6df1\u5ea6\u5b66\u4e60\u6846\u67b6\uff1a</p> <ul> <li>Theano (2008), Caffe (2014), MXNet (2015), TensorFlow (2015), PyTorch (2016)</li> <li>\u81ea\u52a8\u5fae\u5206 + \u786c\u4ef6\u52a0\u901f</li> </ul>"},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html#_3","title":"\u81ea\u52a8\u5fae\u5206","text":""},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html#_4","title":"\u8ba1\u7b97\u5bfc\u6570\u7684\u65b9\u6cd5","text":"<ul> <li>\u624b\u52a8\u5b9e\u73b0\uff1a\u8d39\u529b\u4e14\u5bb9\u6613\u51fa\u9519</li> <li>\u6570\u503c\u5fae\u5206\uff1a\u7b80\u5355\uff0c\u6602\u8d35\u548c\u654f\u611f\u7684\u6570\u5b57\u7cbe\u5ea6</li> <li>\u7b26\u53f7\u5fae\u5206\uff1a\u8ba1\u7b97\u673a\u4ee3\u6570\u7cfb\u7edf\uff0c\u4f46\u8868\u8fbe\u4e66\u6307\u6570\u589e\u957f</li> </ul>"},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html#chain-rule","title":"Chain Rule","text":""},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html#_5","title":"\u524d\u5411\u5fae\u5206","text":"<ul> <li> <p>\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8ba1\u7b97\u5fae\u5206</p> </li> <li> <p>\u591a\u8f93\u51fa\u7684\u5355\u5fae\u5206\uff0c\u6709\u6548\uff0c\u56e0\u9700\u8981\u5bf9\u6bcf\u4e2a\u8f93\u5165\u53d8\u91cf\u6267\u884c\u5fae\u5206</p> </li> </ul>"},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html#_6","title":"\u540e\u5411\u5fae\u5206\uff08\u540e\u5411\u4f20\u64ad\uff09","text":"<ul> <li>Hinton\uff0c 1986</li> <li> <p>\u5c06\u4e2d\u95f4\u5fae\u5206\u8ba1\u7b97\u7684\u7ed3\u679c\uff0c\u7f13\u5b58\u8d77\u6765</p> </li> <li> <p>\u591a\u5fae\u5206\u8ba1\u7b97\u548c\u6709\u6548\uff0c\u9700\u8981caching</p> </li> </ul>"},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html#_7","title":"\u58f0\u660e\u5f0f\u548c\u547d\u4ee4\u5f0f","text":""},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html#define-and-run","title":"\u58f0\u660e\u5f0f\uff08define and run\uff09","text":"<p>\u9759\u6001\u8ba1\u7b97\u56fe\uff1a\u5982Theano (2010), Caffe (2014), TensorFlow (2015)</p> <ul> <li>\u66f4\u5bb9\u6613\u4f18\u5316\u3001\u5206\u5e03\u5f0f\u548c\u6a21\u578b\u5bfc\u51fa</li> </ul>"},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html#define-by-run","title":"\u547d\u4ee4\u5f0f\uff08define by run\uff09","text":"<p>\u52a8\u6001\u8ba1\u7b97\u56fe\uff1a\u5982 Chainer (2015), autograd (2016), PyTorch (2017) </p> <ul> <li>\u63a8\u7406\u548c\u68af\u5ea6\u7684\u89e3\u91ca\u6267\u884c</li> <li>\u66f4\u5bb9\u6613\u7f16\u7a0b\u548c\u8c03\u8bd5</li> </ul>"},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html#hybrid","title":"\u6df7\u5408\uff08Hybrid\uff09","text":"<p>\u5982 TensorFlow Eager, MXNet</p>"},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html#pytorch-tenforflow","title":"Pytorch &amp; TenforFlow","text":"<p>Pytorch</p> <ul> <li>\u547d\u4ee4\u5f0f\u7684DL\u5e93\uff0c\u7c7b\u4f3cNumpy\uff08on GPUs\uff09</li> <li>\u652f\u6301\u81ea\u52a8\u5fae\u5206</li> </ul>"},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html#_8","title":"\u9605\u8bfb","text":""},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html#automatic-differentiation-in-ml-where-we-are-and-where-we-should-be-going","title":"Automatic differentiation in ML: Where we are and where we should be going\uff1f","text":""},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html#tensorflow-a-system-for-large-scale-machine-learning","title":"TensorFlow: A System for Large-Scale Machine Learning","text":""},{"location":"machine_learning/ai4sys/deep_learning_frameworks.html#tensorflow-large-scale-machine-learning-on-heterogeneous-distributed-systems","title":"TensorFlow: Large-Scale Machine Learning on Heterogeneous Distributed Systems","text":""},{"location":"machine_learning/ai4sys/distributed_learning.html","title":"\u5206\u5e03\u5f0f\u8bad\u7ec3","text":"<p>\u7cfb\u7edf\u5224\u65ad</p> <ul> <li>\u6700\u4f4e\u7684\u65f6\u95f4\u5b66\u4e60\u5230\u6700\u597d\u7684\u6a21\u578b\uff08\u6d4b\u8bd5\u6837\u672c\u9519\u8bef\u7387\u6307\u6807\uff09</li> <li>\u590d\u6742\u5ea6\uff1a\u662f\u5426\u5f15\u5165\u989d\u5916\u7684\u8bad\u7ec3\u590d\u6742\u5ea6\uff08\u5982\u8d85\u53c2\u6570\uff09</li> <li>\u7a33\u5b9a\u6027\uff1a\u7cfb\u7edf\u8bad\u7ec3\u6a21\u578b\u7684\u4e00\u81f4\u6027\uff1f</li> <li>\u4ee3\u4ef7\uff1a\u66f4\u591a\u7684\u82b1\u8d39\u4f1a\u83b7\u5f97\u66f4\u597d\u7684\u7ed3\u679c\uff1f</li> </ul>"},{"location":"machine_learning/ai4sys/distributed_learning.html#mr-spark","title":"MR &amp; Spark","text":"<p>Map-Reduce is not optimized for iteration and multi-stage computation\u3002</p> <ul> <li>\u91cd\u590d\u6027\u7684\u8bfb\u53d6\u8bad\u7ec3\u6570\u636e\u548c\u8f93\u51fa\u4e2d\u95f4\u7ed3\u679c\u6a21\u578b</li> </ul> <p>Spark \uff1a Iteration and Multi-stage computation</p> <p>TODO\uff1a\u91cd\u8981\uff1a\u548c distributed.md \u8fdb\u884c\u5408\u5e76</p>"},{"location":"machine_learning/ai4sys/distributed_learning.html#_2","title":"\u53c2\u6570\u66f4\u65b0","text":""},{"location":"machine_learning/ai4sys/distributed_learning.html#bspbulk-synchronous-parallel","title":"BSP\uff08Bulk Synchronous Parallel \uff09","text":"<p>\u540c\u6b65\uff0c\u8282\u70b9\u6570\u636e\u6216\u8ba1\u7b97\u6027\u80fd\u5dee\u5f02\u5bfc\u81f4\u6027\u80fd\u6d6a\u8d39\u3002</p> <p></p>"},{"location":"machine_learning/ai4sys/distributed_learning.html#aspasynchronous-parallel","title":"ASP\uff08ASynchronous Parallel \uff09","text":"<p>\u5f02\u6b65\uff0c\u53ef\u4ee5\u4f7f\u7528 Parameter Server\uff0c\u56e0\u4e3a\u5f02\u6b65\u9700\u8981\u53c2\u6570\u7684\u66f4\u65b0\uff0c\u9700\u8981\u5c06\u5176\u5b83\u8282\u70b9\u7684\u53c2\u6570\u6536\u96c6\u5e76\u66f4\u65b0\u81ea\u5df1\u7684\u53c2\u6570\u3002</p> <p></p>"},{"location":"machine_learning/ai4sys/distributed_learning.html#_3","title":"\u5e76\u884c","text":"<p>Parameter Server\u662f\u6570\u636e\u5e76\u884c\u548c\u6a21\u578b\u5e76\u884c\uff1f</p>"},{"location":"machine_learning/ai4sys/distributed_learning.html#_4","title":"\u6570\u636e\u5e76\u884c","text":"<p>\u6a21\u578b\u5728\u6bcf\u4e2a\u673a\u5668\u4e0a\u590d\u5236\u4e00\u4efd\u3002</p> <p>\u540c\u6b65\u6267\u884c\uff1a\u7ed3\u679c\u786e\u5b9a\u6027\uff0c\u963b\u585e\uff0c\u9700\u8981\u8f83\u5927\u7684batch-size\uff0c\u4e0d\u652f\u6301batch normalization</p> <p>\u5f02\u6b65\u6267\u884c\uff1a\u6d88\u9664\u963b\u585e\uff0cbatched\u4e0d\u9700\u8981\u8de8\u8282\u70b9\uff1f\u5f71\u54cd\u6536\u655b</p> <p>\u95ee\u9898\uff1a\u6a21\u578b\u548c\u6fc0\u6d3b\u53c2\u6570\u5fc5\u987b\u5728\u6bcf\u4e2a\u8282\u70b9\u5b58\u50a8</p> <p></p>"},{"location":"machine_learning/ai4sys/distributed_learning.html#_5","title":"\u6a21\u578b\u5e76\u884c","text":"<p>\u5c06\u6a21\u578b\u5728\u673a\u5668\u95f4\u5212\u5206\uff0c\u590d\u5236\u6570\u636e\u3002</p> <p>\u6a21\u578b\u5982\u4f55\u5207\u5206\uff1a\u5c42\u95f4\u5212\u5206\u3001\u5355\u5c42\u5212\u5206</p> <p></p>"},{"location":"machine_learning/ai4sys/distributed_learning.html#aletnet-distbelief","title":"AletNet \u548c DistBelief","text":"<p>DistBelief \u9996\u5148\u63d0\u51fa PS \u7684\u67b6\u6784\u548cDownPour SGD\u7b97\u6cd5\uff0cSandblaster L-BFGS\u7b97\u6cd5\u3002</p> <p>\u6a21\u578b\u5e76\u884c\u5728\u89c4\u6a21\u5927\u7684\u8bed\u8a00\u6a21\u578b\u4e2d\u4ecd\u7136\u5728\u4f7f\u7528\uff0c\u6bd4\u5982BERT\uff1b</p> <p>batch-size \u4e0d\u662f\u8d8a\u5927\u8d8a\u597d\uff0c\u4f1a\u5f71\u54cd\u6cdb\u5316\u6027\u80fd\uff1b</p> <p>\u5c0fbatch\u7684\u68af\u5ea6\u4e0b\u964d\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u662fregularizer\uff1b</p> <p></p> <p>Scale the learning rate linearly with the batch size</p> <p></p>"},{"location":"machine_learning/ai4sys/distributed_learning.html#all-reduce","title":"All-Reduce","text":"<p>\u673a\u5668\u5b66\u4e60\u4e2d\u7ecf\u5e38\u9700\u8981\u5bf9\u68af\u5ea6\u8fdb\u884c\u6c42\u548c\uff0c\u5e76\u8fd4\u56de\u6700\u65b0\u7684\u7ed9worker</p> <p>P \uff1a\u673a\u5668\u4e2a\u6570</p> <p>N \uff1a\u53c2\u6570\u4e2a\u6570</p> <p>\u603b\u7684\u6570\u636e\u53d1\u9001\u91cf\uff1a( P - 1) * N * 2</p> <p>\u6247\u5165\u8868\u793a\u540c\u65f6\u4ece\u51e0\u4e2a\u8282\u70b9\u63a5\u53d7\u6570\u636e</p>"},{"location":"machine_learning/ai4sys/distributed_learning.html#masterall-reduce","title":"\u5355\u4e2aMaster\u7684All-Reduce","text":"<p>\u540c\u6b65\u68af\u5ea6\u66f4\u65b0\uff0c\u5c06\u5404\u4e2a\u5206\u533a\u8ba1\u7b97\u51fa\u6765\u7684\u68af\u5ea6\u6c47\u603b\u5230master\u4e0a\u8fdb\u884c\u3002</p> <p>\u673a\u5668\u7684\u6700\u5927\u6247\u5165\uff1aP - 1</p> <p>\u673a\u5668\u7684\u6700\u5927\u6570\u636e\u91cf\uff1a( P - 1) * N</p> <p>\u901a\u4fe1\u6b65\u9aa4\uff1a2</p>"},{"location":"machine_learning/ai4sys/distributed_learning.html#parameter-server","title":"Parameter Server","text":"<p>P\u4e2aServer\uff0c\u6bcf\u4e2a\u673a\u5668\u5bf9N\u53c2\u6570\u91cf\u5212\u5206\u4e3aP\u4efd\uff0c\u6bcf\u4e2a\u673a\u5668\u8d1f\u8d23\u89c4\u7ea61\u4efd\u3002</p> <p>\u673a\u5668\u7684\u6700\u5927\u6247\u5165\uff1aP - 1</p> <p>\u89c4\u7ea6\u540e\u5355\u53f0\u673a\u5668\u7684\u6570\u636e\u91cf\uff1a( P - 1) * N / P</p> <p>\u901a\u4fe1\u6b65\u9aa4\uff1a2</p>"},{"location":"machine_learning/ai4sys/distributed_learning.html#recursive-halving-and-doubling","title":"recursive halving and doubling","text":"<p>\u7ecf\u5178\u7684\u6811\u5f62\u7b97\u6cd5</p> <p>\u673a\u5668\u7684\u6700\u5927\u6247\u5165\uff1a1</p> <p>\u673a\u5668\u7684\u6700\u5927\u6570\u636e\u91cf\uff1aN</p> <p>\u901a\u4fe1\u6b65\u9aa4\uff1a2 * logP</p>"},{"location":"machine_learning/ai4sys/distributed_learning.html#ring-allreduce","title":"Ring-AllReduce","text":"<p>NCCL 2.3 \u7248\u672c\u91c7\u7528</p> <p>\u5c06\u6570\u636e\u5207\u6210P\u4efd\uff0c\u5faa\u73af\u53d1\u9001P-1\u8f6e\u6570\u636e\u8fdb\u884c\u90e8\u5206\u805a\u5408\u3002\u5ef6\u8fdf\u4e0eGPU\u7684\u6570\u91cf\u6210\u7ebf\u6027\u5173\u7cfb\u3002</p> <p>\u53e6\u5916\uff0c\u6709\u4e00\u4e9b\u57fa\u4e8ering\u7684\u5c42\u6b21\u7684\uff0c2D\u7684\u4f18\u5316\u7b97\u6cd5\u3002</p> <p>\u673a\u5668\u7684\u6700\u5927\u6247\u5165\uff1a1</p> <p>\u5355\u6b21\u673a\u5668\u7684\u6700\u5927\u6570\u636e\u91cf\uff1aN / P\uff0c\u6bcf\u8f6e\u6240\u6709\u673a\u5668\u7684\u5e26\u5bbd\u4e3a N</p> <p>\u901a\u4fe1\u6b65\u9aa4\uff1a2 * (P - 1)</p>"},{"location":"machine_learning/ai4sys/distributed_learning.html#double-binary-tree-all-reducetodo","title":"Double Binary Tree All-Reduce\uff08TODO\uff09","text":"<p>NCCL 2.4\u7248\u672c\u91c7\u7528\uff0cMPI\u4e2d\u7684\u7b97\u6cd52009\uff08Two-Tree Algorithms for Full Bandwidth Broadcast, Reduction and Scan\uff09</p> <p>\u5176\u4e3b\u8981\u601d\u60f3\u662f\u5229\u7528\u4e8c\u53c9\u6811\u4e2d\u5927\u7ea6\u4e00\u534a\u8282\u70b9\u662f\u53f6\u5b50\u8282\u70b9\u7684\u7279\u6027\uff0c\u901a\u8fc7\u5c06\u53f6\u5b50\u8282\u70b9\u53d8\u6362\u4e3a\u975e\u53f6\u5b50\u8282\u70b9\uff0c\u5f97\u5230\u4e24\u9897\u4e8c\u53c9\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u5728\u5176\u4e2d\u4e00\u9897\u4e8c\u53c9\u6811\u4e0a\u662f\u53f6\u5b50\u8282\u70b9\uff0c\u5728\u53e6\u4e00\u9897\u4e8c\u53c9\u6811\u4e0a\u662f\u975e\u53f6\u5b50\u8282\u70b9\u3002</p>"},{"location":"machine_learning/ai4sys/distributed_learning.html#_6","title":"\u9605\u8bfb","text":""},{"location":"machine_learning/ai4sys/distributed_learning.html#mllib-fast-training-of-glms-using-spark-mllib2019","title":"MLlib*: Fast Training of GLMs using Spark MLlib\uff0c2019.","text":"<p>\u89e3\u51b3broadcast -&gt; collect -&gt; broadcast \u7684\u5faa\u73af\uff0c\u907f\u514ddrvier\u7aef\u74f6\u9888\u3002</p> <ul> <li>model averaging : \u6bcf\u4e2a\u5206\u533a\u72ec\u81ea\u91c7\u7528SGD\u8bad\u7ec3\u51fa\u6a21\u578b\uff0c\u7136\u540e\u5c06\u5206\u533a\u7684\u6a21\u578b\u53d6\u5e73\u5747\u4f5c\u4e3a\u6574\u4f53\u6a21\u578b\uff0c\u518d\u5206\u53d1\u5230\u6bcf\u4e2a\u5206\u533a\u4e0a\u8fdb\u884c\u4e0b\u4e00\u8f6e\u8bad\u7ec3\uff1b </li> <li> <p>\u5206\u533a\u8bad\u7ec3\u65f6\uff0c\u9488\u5bf9L2\u6b63\u5219\u5316\uff0c\u91c7\u53d6\u4e86\u57fa\u4e8e\u9608\u503c\u7684\u5ef6\u8fdf\u65b9\u6cd5\u66f4\u65b0\u6a21\u578b\u53c2\u6570\uff1b</p> </li> <li> <p>Distributed Aggregation using AllReduce : driver\u6bcf\u8f6e\u4e0d\u518d\u6c47\u603b\u5206\u533a\u6a21\u578b\uff0c\u800c\u662f\u901a\u8fc7\u5206\u533a\u70b9\u5bf9\u70b9shuffle\u8ba1\u7b97\u6574\u4f53\u6a21\u578b\uff1b</p> </li> <li>Stochastic gradient descent tricks \u7b2c18.5.1\u7ae0\u8282\uff0c\u8fdb\u884c\u68af\u5ea6\u7684\u66f4\u65b0\uff1b</li> </ul>"},{"location":"machine_learning/ai4sys/distributed_learning.html#scaling-distributed-machine-learning-with-the-parameter-server","title":"Scaling Distributed Machine Learning with the Parameter Server","text":""},{"location":"machine_learning/ai4sys/distributed_learning.html#pipedream-generalized-pipeline-parallelism-for-dnn-training","title":"PipeDream: Generalized Pipeline Parallelism for DNN Training","text":""},{"location":"machine_learning/ai4sys/distributed_learning.html#adaptive-communication-strategies-to-achieve-the-best-error-runtime-trade-off-in-local-update-sgd","title":"Adaptive Communication Strategies to Achieve the Best Error-Runtime Trade-off in Local-Update SGD","text":""},{"location":"machine_learning/ai4sys/ml_lifecycle.html","title":"ML Lifecycle","text":"<p>\u673a\u5668\u5b66\u4e60\u7684\u751f\u547d\u5468\u671f</p> <ul> <li>\u6311\u6218\u548c\u673a\u9047</li> <li>\u79d1\u5b66\u53ca VS \u5de5\u7a0b\u5e08</li> </ul> <p>\u5173\u952e\u7684\u6982\u5ff5</p> <ul> <li>\u8d85\u53c2\u6570</li> <li>\u6a21\u578b\u6d41\u6c34\u7ebf\uff0c\u7279\u5f81\uff0c\u7279\u5f81\u5de5\u7a0b</li> <li>\u70ed\u542f\u52a8\uff0c\u7ec6\u7c92\u5ea6\u8c03\u4f18</li> <li>\u53cd\u9988\u5faa\u73af\uff0c\u91cd\u65b0\u8bad\u7ec3\u548c\u6301\u7eed\u8bad\u7ec3</li> </ul>"},{"location":"machine_learning/ai4sys/ml_lifecycle.html#_1","title":"\u7ec4\u6210","text":""},{"location":"machine_learning/ai4sys/ml_lifecycle.html#_2","title":"\u6a21\u578b\u5f00\u53d1","text":"<p>\u6570\u636e\u79d1\u5b66\u5bb6\u65e0\u6cd5\u505a\u7684\u4e8b\u60c5\uff1a\u6570\u636e\u6536\u96c6\uff0c\u6e05\u6d17\u548c\u53ef\u89c6\u5316</p> <ul> <li>\u786e\u5b9a\u6f5c\u5728\u7684\u6570\u636e\u6765\u6e90</li> <li>\u8fde\u63a5\u5408\u5e76\u591a\u4e2a\u6765\u6e90\u7684\u6570\u636e</li> <li>\u5904\u7406\u7f3a\u5931\u503c\u548c\u79bb\u7fa4\u503c</li> <li>\u7ed8\u5236\u8d8b\u52bf\u8bc6\u522b\u5f02\u5e38</li> </ul> <p>\u6570\u636e\u79d1\u5b66\u5bb6\u505a\u7684\u4e8b\u60c5\uff1a\u7279\u5f81\u5de5\u7a0b\uff0c\u8bad\u7ec3\u548c\u9a8c\u8bc1</p> <ul> <li>\u6784\u5efa\u597d\u7684\u7279\u5f81\u51fd\u6570</li> <li>\u8bbe\u8ba1\u65b0\u7684\u6a21\u578b\u67b6\u6784</li> <li>\u8c03\u6574\u8d85\u53c2\u6570</li> <li>\u9a8c\u8bc1\u6a21\u578b\u51c6\u786e\u6027</li> </ul> <p>\u7279\u5f81\uff1a</p> <ul> <li>\u7279\u5f81\u8fde\u63a5\uff1a\u5728\u4e00\u4e2a\u7279\u5f81\u4e2d\u7ec4\u5408\u591a\u4e2a\u6570\u636e\u6e90</li> <li>\u7279\u5f81\u91cd\u7528\uff1a\u591a\u4e2a\u4efb\u52a1\u4e2d\u91cd\u7528\u76f8\u540c\u7684\u7279\u5f81\uff08\u5982\u7528\u6237\u6807\u7b7e\uff0c\u4ea7\u54c1\u5185\u5d4c\u7684\u4fe1\u606f\uff09</li> <li>\u9884\u6d4b\u4f5c\u4e3a\u7279\u5f81\uff1a\u4e00\u4e2a\u4efb\u52a1\u7684\u9884\u6d4b\u4f5c\u4e3a\u53e6\u4e00\u4e2a\u4efb\u52a1\u7684\u7279\u5f81</li> <li>\u7279\u5f81\u7f13\u5b58\uff1a\u7279\u5f81\u503c\u7ecf\u5e38\u662f\u9884\u5148\u8ba1\u7b97\u51fa\u6765\u5e76\u7f13\u5b58</li> <li>\u52a8\u6001\u7279\u5f81\uff1a\u7279\u5f81\u6bd4\u6a21\u578b\u66f4\u5e38\u88ab\u4fee\u6539\uff0c\u4f1a\u51fa\u73b0 covariate shift \u7684\u95ee\u9898</li> </ul> <p>\u8d85\u53c2\u6570\uff1a</p> <ul> <li>\u624b\u52a8\u8bbe\u7f6e\uff0c\u6216\u8005\u4ea4\u53c9\u9a8c\u8bc1\u8fdb\u884c\u8c03\u4f18</li> <li>\u4e3a\u4ec0\u4e48\u4e0d\u5728\u6a21\u578b\u4e2d\u76f4\u63a5\u5b66\u4e60\uff1f</li> <li>\u5982\u4f55\u76f4\u63a5\u5b66\u4e60\u6a21\u578b\uff1f</li> </ul> <p>\u6a21\u578b\u5f00\u53d1\u7684\u8f93\u51fa</p> <ul> <li>\u62a5\u544a\u548c\u4eea\u8868\u677f</li> <li>\u8bad\u7ec3\u7684\u6a21\u578b\uff08\u76f4\u63a5\u8f93\u51fa\u8fd9\u4e2a\uff0c\u975e\u5e38\u4e0d\u597d\uff09</li> <li>\u65e0\u6cd5\u6839\u636e\u65b0\u6570\u636e\u91cd\u65b0\u8bad\u7ec3\u6a21\u578b</li> <li>\u65e0\u6cd5\u8ddf\u8e2a\u6570\u636e\u548c\u8c03\u8bd5\u4ee3\u7801</li> <li>\u65e0\u6cd5\u6355\u83b7\u5f00\u53d1\u65f6\u7684\u4f9d\u8d56</li> <li>\u65e0\u6cd5\u5408\u89c4\u7684\u5ba1\u8ba1\u8bad\u7ec3\uff08audit training for compliance\uff09\uff0c\u5982GDPR\uff08\u901a\u7528\u6570\u636e\u4fdd\u62a4\u6761\u4f8b\uff09- </li> </ul>"},{"location":"machine_learning/ai4sys/ml_lifecycle.html#_3","title":"\u8bad\u7ec3","text":"<ul> <li> <p>\u8bad\u7ec3\u7684\u6d41\u6c34\u7ebf\uff08Traning Pipelines\uff09</p> </li> <li> <p>\u63cf\u8ff0\u4e86\u5982\u4f55\u4ece\u6570\u636e\u6e90\u8bad\u7ec3\u51fa\u6a21\u578b</p> </li> <li> <p>\u5728\u5927\u89c4\u6a21\u5b9e\u65f6\u6570\u636e\u4e0a\u8bad\u7ec3\u6a21\u578b</p> </li> <li> <p>\u5728\u65b0\u6570\u636e\u4e0a\u91cd\u65b0\u8bad\u7ec3\u6a21\u578b</p> </li> <li> <p>\u81ea\u52a8\u9a8c\u8bc1\u51c6\u786e\u7387</p> </li> <li> <p>\u7ba1\u7406\u6a21\u578b\u7684\u7248\u672c\u4fe1\u606f</p> </li> <li> <p>\u9700\u8981\u5f88\u5c11\u7684\u673a\u5668\u5b66\u4e60\u7684\u4e13\u4e1a\u77e5\u8bc6</p> <p></p> </li> <li> <p>\u70ed\u542f\u52a8</p> </li> <li>\u968f\u7740\u65f6\u95f4\u7684\u8fc1\u79fb\u5b66\u4e60</li> <li>\u6570\u636e\u5206\u5e03\u4f1a\u6539\u53d8\uff0c\u4f46\u4e0d\u4f1a\u8fc5\u901f\u6539\u53d8</li> <li>\u9700\u8981\u4e00\u79cd\u673a\u5236\u53ef\u4ee5\u5408\u9002\u5730\u8bbe\u7f6e\u5b66\u4e60\u7387\uff08\u5178\u578b\u4f1a\u8bbe\u7f6e\u542f\u52a8\u975e\u5e38\u5c0f\uff09</li> <li> <p>\u707e\u96be\u6027\u5fd8\u8bb0\uff1a\u65e7\u6570\u636e\u4e0a\u7684\u6a21\u578b\u9000\u5316\uff0c\u53ef\u4ee5\u901a\u8fc7\u6301\u7eed\u8bad\u7ec3\u65e7\u6570\u636e\u89e3\u51b3</p> </li> <li> <p>\u7ec6\u7c92\u5ea6\u8c03\u4f18</p> </li> <li> <p>\u4f7f\u7528\u5c0f\u7684\u5b66\u4e60\u7387\u5bf9\u65b0\u7684\u6570\u636e\u96c6\u6216\u8005\u9884\u6d4b\u4efb\u52a1\uff0c\u8bad\u7ec3\u9884\u8bad\u7ec3\u6216\u90e8\u5206\u9884\u8bad\u7ec3\u7684\u6a21\u578b</p> <ul> <li>\u5feb\u901f\u8bad\u7ec3\uff0c\u63d0\u5347\u51c6\u786e\u5ea6</li> </ul> </li> <li> <p>Context</p> </li> <li>How was the model or data created ?</li> <li>What is the latest or best version ?</li> <li>Who is responsible?</li> <li>Composition</li> <li>\u6a21\u578b\u53ef\u4ee5\u88ab\u7ec4\u5408\u7528\u6765\u89e3\u51b3\u65b0\u7684\u95ee\u9898\uff0c\u4f46\u53ef\u80fd\u4f1a\u9020\u6210\u9519\u8bef\u7684\u7ed3\u679c<ul> <li>\u9700\u8981\u8ddf\u8e2a\u7ec4\u6210\u5e76\u9a8c\u8bc1\u7aef\u5230\u7aef\u51c6\u786e\u6027</li> <li>\u9700\u8981\u6a21\u578b\u7684\u5355\u5143\u548c\u96c6\u6210\u6d4b\u8bd5</li> </ul> </li> </ul>"},{"location":"machine_learning/ai4sys/ml_lifecycle.html#_4","title":"\u63a8\u7406","text":"<p>\u76ee\u6807\uff1a\u5728\u7206\u53d1\u6027\u9ad8\u8d1f\u8f7d\u65f6\uff0c\u9884\u6d4b\u6027\u80fd ~10ms</p> <p>\u6df1\u5ea6\u795e\u7ecf\u7f51\u7edc\u5bfc\u81f4\u66f4\u52a0\u8d1f\u8f7d -&gt; \u65b0\u7684ML\u7b97\u6cd5\u548c\u7cfb\u7edf</p> <p>\u52a0\u5165\u53cd\u9988\uff08Incorporating feedback\uff09</p> <ul> <li> <p>\u6a21\u578b\u66f4\u65b0\uff1a\u65b0\u6570\u636e\u6765\u4e34\u65f6\u91cd\u65b0\u8bad\u7ec3</p> </li> <li> <p>\u5468\u671f\u6027\uff1a\u6279\u5904\u7406\u548c\u9a8c\u8bc1</p> </li> <li> <p>\u6301\u7eed\u6027\uff08\u5728\u7ebf\u5b66\u4e60\uff09\uff1a\u6700\u65b0\u7684\u6a21\u578b</p> <ul> <li>\u9700\u8981\u9a8c\u8bc1\uff0c\u5b66\u4e60\u7387\u8bbe\u7f6e\u3002\u3002\u3002\u975e\u5e38\u590d\u6742</li> <li>\u7279\u5f81\u66f4\u65b0\uff1a\u65b0\u6570\u636e\u53ef\u80fd\u4f1a\u6539\u53d8\u7279\u5f81</li> <li>\u4f8b\u5982\uff1a\u66f4\u65b0\u7528\u6237\u7684\u70b9\u51fb\u5386\u53f2  -&gt; \u65b0\u7684\u9884\u6d4b</li> <li>\u6bd4\u5728\u7ebf\u5b66\u4e60\u66f4\u52a0\u9c81\u68d2</li> </ul> </li> </ul> <p>\u53cd\u9988\u5faa\u73af\uff08Feedback Cycles\uff09</p> <ul> <li> <p>\u6a21\u578b\u63cf\u8ff0\u6536\u96c6\u6570\u636e\u7684\u504f\u89c1\uff08bias the data they collect\uff09</p> </li> <li> <p>\u5982 \u5185\u5bb9\u63a8\u8350</p> </li> <li> <p>\u7279\u5f81\u6a21\u578b\u53cd\u5e94\u65e9\u671f\u7684\u6a21\u578b\u504f\u89c1</p> </li> <li> <p>Exploration - Exploitation Trade-off</p> </li> <li> <p>Exploration\uff1a\u89c2\u5bdf\u4e0d\u540c\u7684\u8f93\u51fa</p> </li> <li> <p>Exploitation\uff1a\u5229\u7528\u6a21\u578b\u83b7\u53d6\u9884\u6d4b\u7684\u6700\u4f73\u89e3\u51b3\u65b9\u6848 </p> </li> <li> <p>\u89e3\u51b3\u65b9\u6848</p> </li> <li> <p>Randomization\uff08\u03b5-greedy\uff09\uff1a\u4e0d\u5b9a\u671f\u5ffd\u7565\u6a21\u578b</p> </li> <li>Bandit Algorithms / Thompson Sampling \uff1a\u6700\u4f18\u5730\u5e73\u8861exploration\u548cexploitation\uff08\u4e3b\u8981\u7684\u7814\u7a76\u7684\u9886\u57df\uff09</li> </ul>"},{"location":"machine_learning/ai4sys/ml_lifecycle.html#readings","title":"Readings","text":""},{"location":"machine_learning/ai4sys/ml_lifecycle.html#hidden-technical-debt-in-machine-learning-systems","title":"Hidden Technical Debt in Machine Learning Systems","text":"<p>Google\u9762\u4e34\u7684\u6311\u6218\u7684\u6982\u8ff0</p> <ul> <li>\u63cf\u8ff0</li> <li>\u5173\u952e\u70b9</li> <li>\u8d21\u732e</li> </ul>"},{"location":"machine_learning/ai4sys/ml_lifecycle.html#tfx-a-tensorflow-based-production-scale-machine-learing-platform","title":"TFX: A TensorFlow-Based Production-Scale Machine Learing Platform","text":"<p>https://www.tensorflow.org/tfx : \u90e8\u5206\u96c6\u6210</p> <p>Google\u5bf9\u4e8e\u4e0a\u9762\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848</p> <ul> <li>\u63cf\u8ff0</li> <li>\u5173\u952e\u70b9</li> <li>\u8d21\u732e</li> </ul>"},{"location":"machine_learning/ai4sys/ml_lifecycle.html#towards-unified-data-and-lifecycle-management-for-deep-learning","title":"Towards Unified Data and Lifecycle Management for Deep Learning","text":"<p>\u53ef\u9009\u7684\u6570\u636e\u5e93\u793e\u533a\u89e3\u51b3\u65b9\u6848</p> <ul> <li>\u63cf\u8ff0</li> <li>\u5173\u952e\u70b9</li> <li>\u8d21\u732e</li> </ul>"},{"location":"machine_learning/ai4sys/ml_lifecycle.html#_5","title":"\u76f8\u5173\u7684\u7cfb\u7edf","text":"<p>Doing Machine Learning the Uber Way: Five Lessons From the First Three Years of Michelangelo</p> <p>Introducing FBLearner Flow: Facebook\u2019s AI backbone</p> <p>KubeFlow: Kubernetes Pipeline Orchestration Framework</p> <p>DeepBird: Twitters ML Deployment Framework</p> <p>Mlflow: A System to Accelerate the Machine Learning Lifecycle</p> <p>Data Engineering Bulletin on the Machine Learning Lifecycle </p> <ul> <li>Full disclosure: I was the editor</li> </ul>"},{"location":"machine_learning/ai4sys/prediction_serving.html","title":"Prediction serving","text":"<p>[toc]</p>"},{"location":"machine_learning/ai4sys/prediction_serving.html#prediction-serving","title":"Prediction Serving","text":"<p>\u4f4e\u5ef6\u8fdf\uff0810ms\uff09\uff0c\u5176\u6311\u6218\u578b\uff1a</p> <ul> <li>\u6a21\u578b\uff1a\u6a21\u578b\u590d\u6742\uff0c\u5927\u91cf\u53c2\u6570\uff1b</li> <li>\u67e5\u8be2\uff1a\u590d\u6742\u67e5\u8be2\uff0c\u5982Top K\uff1b</li> <li>\u7279\u5f81\uff1a\u7279\u5f81\u591a\uff0cjoin\u591a\u8868\uff1b</li> </ul> <p>\u4e24\u79cd\u89e3\u51b3\u65b9\u5f0f\uff1a</p> <ul> <li>\u79bb\u7ebf\u9884\u8ba1\u7b97\uff1a</li> <li>\u5728\u7ebf\u5b9e\u65f6\u8ba1\u7b97\uff1a</li> </ul> <p>Clipper\uff1a\u5b66\u672f\u7814\u7a76\u4ea7\u7269\uff0c\u4e0d\u518d\u7ef4\u62a4</p> <p>Clipper is a low-latency prediction serving system for machine learning. </p> <p></p> <ul> <li>\u589e\u957fbatch size\uff0c\u76f4\u5230\u5ef6\u8fdf\u8d85\u8fc7\u9608\u503c\uff1b</li> <li>\u5982\u679c\u5ef6\u8fdf\u8d85\u8fc7SLO\uff0c\u5219\u5c06batch size\u6309\u6bd4\u4f8b\u7f29\u5c0f\uff1b</li> </ul>"},{"location":"machine_learning/ai_demo/index.html","title":"AI\u6848\u4f8b","text":"<p>\u6587\u672c\u5230\u8bed\u97f3\u7684\u8f6c\u6362\uff08\u751f\u4ea7\u7ea7\u522b\uff09\uff1ahttps://github.com/coqui-ai/tts</p> <p>PULSE - \u8be5\u5f00\u6e90\u9879\u76ee\u53ef\u4ee5\u901a\u8fc7\u7ed9\u56fe\u7247\u589e\u52a0\u50cf\u7d20\u70b9\u6765\u5b9e\u73b0\u53bb\u9a6c\u8d5b\u514b\u6216\u9ad8\u6e05\u5316</p> <p>Depix - \u7ed9\u6253\u4e86\u9a6c\u8d5b\u514b\u7684\u6587\u5b57\u53bb\u7801</p> <p>TecoGAN - \u7ed9\u89c6\u9891\u53bb\u9a6c\u8d5b\u514b\u6216\u8005\u8fdb\u884c\u8d85\u5206\u8fa8\u7387</p> <p>StyleCLIP - AI\u81ea\u52a8 P\u56fe\uff0c\u89c1\u6ca1\u89c1\u8fc7\u626b\u628a\u5934\u7684\u9a6c\u65af\u514b</p> <p>EssayKiller_V2 - \u4e00\u4e2a\u4eba\u5229\u7528\u4e09\u4e2a\u6708\uff0c\u5f00\u53d1\u4e86\u4e00\u4e2a\u4f1a\u5199\u4f5c\u6587\u7684\u4eba\u5de5\u667a\u80fd</p> <p>style2paints - \u4e0d\u9700\u8981\u5b89\u88c5\u4efb\u4f55\u73af\u5883\u3001\u505a\u4efb\u4f55\u914d\u7f6e\uff0c\u4e0b\u8f7d\u7136\u540e\u53cc\u51fb\uff0c\u5c31\u53ef\u4ee5\u7ed9\u7ebf\u63cf\u56fe\u753b\u4e0a\u8272</p> <p>TODO\uff1a</p> <p>https://www.cnblogs.com/einyboy/p/3594432.html</p>"},{"location":"machine_learning/ai_demo/tools.html","title":"\u56fe\u50cf","text":""},{"location":"machine_learning/ai_demo/tools.html#opencvtodo","title":"OpenCV\u5bf9\u6bd4\u56fe\u50cf\u5dee\u5f02\uff08TODO\uff09","text":"<p>https://blog.csdn.net/hahabeibei123456789/article/details/98937944</p>"},{"location":"machine_learning/ai_demo/tools.html#_2","title":"\u4e8c\u7ef4\u7801\u98ce\u683c\u8fc1\u79fb","text":"<p>[1] ArtCoder: An End-to-end Method for Generating Scanning-robust Stylized QR Codes.</p> <p>\u539f\u94fe\u63a5\uff1ahttps://github.com/SwordHolderSH/ArtCoder</p> <p>gitee\u94fe\u63a5\uff1ahttps://gitee.com/import-github/ArtCoder</p>"},{"location":"machine_learning/ai_demo/tools.html#_3","title":"\u6587\u672c\u751f\u6210\u6848\u4f8b","text":"<p>\u8bd7\u8bcd\u751f\u6210\uff08RNN+LSTM\uff09</p>"},{"location":"machine_learning/deep_learning/index.html","title":"\u6df1\u5ea6\u5b66\u4e60","text":""},{"location":"machine_learning/deep_learning/index.html#_2","title":"\u6fc0\u6d3b\u51fd\u6570","text":"<p>\u4f5c\u4e3a\u51b3\u5b9a\u795e\u7ecf\u7f51\u7edc\u662f\u5426\u4f20\u9012\u4fe1\u606f\u7684\u300c\u5f00\u5173\u300d\uff0c\u6fc0\u6d3b\u51fd\u6570\u5bf9\u4e8e\u795e\u7ecf\u7f51\u7edc\u800c\u8a00\u81f3\u5173\u91cd\u8981\u3002</p> <p>\u5e38\u89c1\u7684\u6fc0\u6d3b\u51fd\u6570\u6709\uff1a</p> <ul> <li>Sigmod</li> <li>RELU</li> <li>GELU</li> </ul>"},{"location":"machine_learning/deep_learning/index.html#sigmoid","title":"Sigmoid","text":"<p>\u65e9\u671f\u4eba\u5de5\u795e\u7ecf\u5143\u4f7f\u7528\u4e8c\u5143\u9608\u503c\u5355\u5143\uff08Hopfield, 1982; McCulloch &amp; Pitts, 1943\uff09\u3002\u4e8c\u5143\u51b3\u7b56\u901a\u8fc7 Sigmoid \u6fc0\u6d3b\u51fd\u6570\u8fdb\u884c\u5e73\u6ed1\u5316\uff0c\u4ece\u800c\u5177\u6709\u975e\u5e38\u5feb\u7684\u89e3\u7801\u901f\u5ea6\uff0c\u5e76\u53ef\u4ee5\u5229\u7528\u53cd\u5411\u4f20\u64ad\u8fdb\u884c\u8bad\u7ec3\u3002</p> <p>\u968f\u7740\u7f51\u7edc\u6df1\u5ea6\u7684\u4e0d\u65ad\u589e\u52a0\uff0c\u5229\u7528 Sigmoid \u6fc0\u6d3b\u51fd\u6570\u6765\u8bad\u7ec3\u8bc1\u5b9e\u4e0d\u5982\u975e\u5e73\u6ed1\u3001\u4f4e\u6982\u7387\u6027\u7684 ReLU \u6709\u6548\u3002</p>"},{"location":"machine_learning/deep_learning/index.html#relu","title":"RELU","text":"<p>ReLU \u53ef\u4ee5\u5bf9\u6297\u68af\u5ea6\u7206\u70b8/\u6d88\u5931\u95ee\u9898\uff0c\u8ba1\u7b97\u6548\u7387\u4e5f\u5f88\u9ad8\u3002</p> <p>RELU \u662f\u4eba\u5de5\u795e\u7ecf\u7f51\u7edc\u4e2d\u6700\u5e38\u7528\u7684\u6fc0\u6d3b\u51fd\u6570\uff08activation function\uff09\uff0c\u901a\u5e38\u6307\u4ee3\u4ee5\u300c\u659c\u5761\u300d\u51fd\u6570\u53ca\u5176\u53d8\u79cd\u4e3a\u4ee3\u8868\u7684\u975e\u7ebf\u6027\u51fd\u6570\u65cf\u3002\u8fd9\u4e2a\u51fd\u6570\u65cf\u6bd4\u8f83\u5e38\u89c1\u7684\u6709 ReLU \u4ee5\u53ca Leaky ReLU\u3002</p> <p>\\(f(x) = max(0, x)\\)</p> <p></p>"},{"location":"machine_learning/deep_learning/index.html#gelu","title":"GELU","text":"<p>GELU : Gaussian Error Linear Units.</p> <p>BERT\u3001RoBERTa\u3001ALBERT \u7b49\u76ee\u524d\u4e1a\u5185\u9876\u5c16\u7684 NLP \u6a21\u578b\u90fd\u4f7f\u7528\u4e86\u8fd9\u79cd\u6fc0\u6d3b\u51fd\u6570\u3002</p> <p>GELU \u4e0e\u968f\u673a\u6b63\u5219\u5316\u6709\u5173\uff0c\u56e0\u4e3a\u5b83\u662f\u81ea\u9002\u5e94 Dropout \u7684\u4fee\u6b63\u9884\u671f\uff08Ba &amp; Frey, 2013\uff09\u3002\u8fd9\u8868\u660e\u795e\u7ecf\u5143\u8f93\u51fa\u7684\u6982\u7387\u6027\u66f4\u9ad8\u3002</p> <p></p>"},{"location":"machine_learning/deep_learning/index.html#_3","title":"\u68af\u5ea6\u6d88\u5931/\u68af\u5ea6\u7206\u70b8","text":"<ul> <li>\u7cbe\u5fc3\u8bbe\u8ba1\u7684\u6743\u503c\u521d\u59cb\u5316\u65b9\u6cd5\u3001BatchNorm \u6216 LayerNorm \u8fd9\u7c7b\u6807\u51c6\u5316\u6280\u672f\uff1b</li> <li>ReZero is All You Need: Fast Convergence at Large Depth\uff1b</li> </ul>"},{"location":"machine_learning/deep_learning/index.html#tricks","title":"Tricks","text":""},{"location":"machine_learning/deep_learning/index.html#_4","title":"\u56fe\u50cf\u5206\u7c7b\u4efb\u52a1","text":"<p>\u6765\u6e90\uff1ahttps://mp.weixin.qq.com/s/LXjR2tGwcP0MLcHrSOB72w</p> <p>\u56fe\u50cf\u5206\u7c7b\u4e2d\u7684\u5404\u79cd\u6280\u5de7\u5bf9\u4e8e\u76ee\u6807\u68c0\u6d4b\u3001\u56fe\u50cf\u5206\u5272\u7b49\u4efb\u52a1\u4e5f\u6709\u5f88\u597d\u7684\u4f5c\u7528\uff1a</p>"},{"location":"machine_learning/deep_learning/index.html#warmup","title":"Warmup","text":"<p>\u6e90\u4e8e ResNet \u8bba\u6587\uff0c\u5b66\u4e60\u7387\u9884\u70ed\uff08\u5b66\u4e60\u7387\u52a8\u6001\u53d8\u66f4\uff09</p> <ul> <li>\u521a\u5f00\u59cb\u8bad\u7ec3\u65f6\u6a21\u578b\u7684\u6743\u91cd(weights)\u662f\u968f\u673a\u521d\u59cb\u5316\u7684\uff0c\u9009\u62e9\u4e00\u4e2a\u8f83\u5927\u7684\u5b66\u4e60\u7387\uff0c\u53ef\u80fd\u4f1a\u5e26\u6765\u6a21\u578b\u7684\u4e0d\u7a33\u5b9a\uff1b</li> <li>\u5b66\u4e60\u7387\u9884\u70ed\u5c31\u662f\u5728\u521a\u5f00\u59cb\u8bad\u7ec3\u7684\u65f6\u5019\u5148\u4f7f\u7528\u4e00\u4e2a\u8f83\u5c0f\u7684\u5b66\u4e60\u7387\uff0c\u8bad\u7ec3\u4e00\u4e9bepoches\uff0c\u7b49\u6a21\u578b\u7a33\u5b9a\u65f6\u518d\u4fee\u6539\u4e3a\u9884\u5148\u8bbe\u7f6e\u7684\u5b66\u4e60\u7387\u8fdb\u884c\u8bad\u7ec3</li> <li>gradual warmup \u4ece\u6700\u5f00\u59cb\u7684\u5c0f\u5b66\u4e60\u7387\u5f00\u59cb\uff0c\u6bcf\u4e2aiteration\u589e\u5927\u4e00\u70b9\uff0c\u76f4\u5230\u6700\u521d\u8bbe\u7f6e\u7684\u6bd4\u8f83\u5927\u7684\u5b66\u4e60\u7387\u3002</li> </ul>"},{"location":"machine_learning/deep_learning/index.html#linear-scaling-learning-rate","title":"Linear scaling learning rate","text":"<ul> <li>batch size\u7684\u589e\u5927\uff0c\u8fbe\u5230\u76f8\u540c\u7cbe\u5ea6\u6240\u9700\u8981\u7684epoch\u6570\u91cf\u8d8a\u6765\u8d8a\u591a\uff1b\u589e\u5927batch size\u4e0d\u4f1a\u6539\u53d8\u68af\u5ea6\u7684\u671f\u671b\uff0c\u4f46\u662f\u4f1a\u964d\u4f4e\u5b83\u7684\u65b9\u5dee\uff1b</li> <li>batch size\u4e3a256\u65f6\u9009\u62e9\u7684\u5b66\u4e60\u7387\u662f0.1\uff0c\u5f53\u6211\u4eec\u628abatch size\u53d8\u4e3a\u4e00\u4e2a\u8f83\u5927\u7684\u6570b\u65f6\uff0c\u5b66\u4e60\u7387\u5e94\u8be5\u53d8\u4e3a 0.1 \u00d7 b/256\uff1b</li> </ul>"},{"location":"machine_learning/deep_learning/index.html#cosine-learning-rate-decay","title":"Cosine learning rate decay","text":"<p>\u5728warmup\u4e4b\u540e\u7684\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\uff0c\u5b66\u4e60\u7387\u4e0d\u65ad\u8870\u51cf\u662f\u4e00\u4e2a\u63d0\u9ad8\u7cbe\u5ea6\u7684\u597d\u65b9\u6cd5\uff0c\u6709step decay\u548ccosine decay\u3002</p> <ul> <li>\u5bf9\u4e8ecosine decay\uff0c\u5047\u8bbe\u603b\u5171\u6709T\u4e2abatch\uff08\u4e0d\u8003\u8651warmup\u9636\u6bb5\uff09\uff0c\u5728\u7b2ct\u4e2abatch\u65f6\uff0c\u5b66\u4e60\u7387\u03b7_t\u4e3a</li> </ul> <p>\\(\\eta_t = \\frac{1}{2} (1 + cos(\\frac{t\\pi}{T}))\\eta\\)</p> <p></p>"},{"location":"machine_learning/deep_learning/index.html#label-smoothing","title":"Label-smoothing","text":"<ul> <li> <p>inception-v2\uff0c\u6700\u540e\u4e00\u5c42\u4e00\u822c\u662f\u5168\u8fde\u63a5\u5c42\uff0c\u7136\u540e\u5bf9\u5e94\u6807\u7b7e\u7684one-hot\u7f16\u7801</p> </li> <li> <p>\u5bf9\u4e8e\u4e00\u4e2a\u7531\u591a\u4eba\u6807\u6ce8\u7684\u6570\u636e\u96c6\uff0c\u4e0d\u540c\u4eba\u6807\u6ce8\u7684\u51c6\u5219\u53ef\u80fd\u4e0d\u540c\uff0c\u6bcf\u4e2a\u4eba\u7684\u6807\u6ce8\u4e5f\u53ef\u80fd\u4f1a\u6709\u4e00\u4e9b\u9519\u8bef\u3002\u6a21\u578b\u5bf9\u6807\u7b7e\u7684\u8fc7\u5206\u76f8\u4fe1\u4f1a\u5bfc\u81f4\u8fc7\u62df\u5408</p> </li> <li>LSR \u901a\u8fc7\u5728\u6807\u7b7ey\u4e2d\u52a0\u5165\u566a\u58f0\uff0c\u5b9e\u73b0\u5bf9\u6a21\u578b\u7ea6\u675f\uff0c\u964d\u4f4e\u6a21\u578b\u8fc7\u62df\u5408\u7a0b\u5ea6\u7684\u4e00\u79cd\u6b63\u5219\u5316\u65b9\u6cd5</li> <li>\u516c\u5f0f\uff1a\u03b5\u662f\u4e00\u4e2a\u5c0f\u7684\u5e38\u6570\uff0cK\u662f\u7c7b\u522b\u7684\u6570\u76ee\uff0cy\u662f\u56fe\u7247\u7684\u771f\u6b63\u7684\u6807\u7b7e\uff0ci\u4ee3\u8868\u7b2ci\u4e2a\u7c7b\u522b\uff0cq_i\u662f\u56fe\u7247\u4e3a\u7b2ci\u7c7b\u7684\u6982\u7387</li> </ul> <p>\\(q_i = \\begin{cases}1-\\epsilon \\qquad\\qquad  if\\quad i=y \\\\ \\epsilon/(K-1) \\qquad otherwise \\end{cases}\\)</p>"},{"location":"machine_learning/deep_learning/index.html#random-image-cropping-and-patching","title":"Random image cropping and patching","text":"<ul> <li>\u968f\u673a\u88c1\u526a\u56db\u4e2a\u56fe\u7247\u7684\u4e2d\u90e8\u5206\uff0c\u7136\u540e\u628a\u5b83\u4eec\u62fc\u63a5\u4e3a\u4e00\u4e2a\u56fe\u7247\uff0c\u540c\u65f6\u6df7\u5408\u8fd9\u56db\u4e2a\u56fe\u7247\u7684\u6807\u7b7e\u3002</li> <li>Ix, Iy\u662f\u539f\u59cb\u56fe\u7247\u7684\u5bbd\u548c\u9ad8\u3002w\u548ch\u79f0\u4e3aboundary position\uff0c\u5b83\u51b3\u5b9a\u4e86\u56db\u4e2a\u88c1\u526a\u5f97\u5230\u7684\u5c0f\u56fe\u7247\u7684\u5c3a\u5bf8\u3002w\u548ch\u4ecebeta\u5206\u5e03Beta(\u03b2, \u03b2)\u4e2d\u968f\u673a\u751f\u6210\uff0c\u03b2\u4e5f\u662fRICAP\u7684\u8d85\u53c2\u6570\u3002\u6700\u7ec8\u62fc\u63a5\u7684\u56fe\u7247\u5c3a\u5bf8\u548c\u539f\u56fe\u7247\u5c3a\u5bf8\u4fdd\u6301\u4e00\u81f4\u3002</li> </ul>"},{"location":"machine_learning/deep_learning/index.html#knowledge-distillation","title":"Knowledge Distillation","text":"<p>\u6a21\u578b\u538b\u7f29\u7684\u4e00\u79cd\u5e38\u7528\u7684\u65b9\u6cd5</p> <p>\u77e5\u8bc6\u84b8\u998f\uff1a\u4f7f\u7528\u4e00\u4e2a\u6559\u5e08\u6a21\u578b\u6765\u5e2e\u52a9\u5f53\u524d\u7684\u6a21\u578b\uff08\u5b66\u751f\u6a21\u578b\uff09\u8bad\u7ec3</p> <ul> <li>\u6559\u5e08\u6a21\u578b\u662f\u4e00\u4e2a\u8f83\u9ad8\u51c6\u786e\u7387\u7684\u9884\u8bad\u7ec3\u6a21\u578b\uff0c\u56e0\u6b64\u5b66\u751f\u6a21\u578b\u53ef\u4ee5\u5728\u4fdd\u6301\u6a21\u578b\u590d\u6742\u5ea6\u4e0d\u53d8\u7684\u60c5\u51b5\u4e0b\u63d0\u5347\u51c6\u786e\u7387\uff1b</li> <li>\u84b8\u998f\u635f\u5931\u6765\u60e9\u7f5a\u5b66\u751f\u6a21\u578b\u548c\u6559\u5e08\u6a21\u578b\u7684\u8f93\u51fa\u4e4b\u95f4\u7684\u5dee\u5f02</li> </ul>"},{"location":"machine_learning/deep_learning/index.html#cutout","title":"Cutout","text":"<p>\u6b63\u5219\u5316\u65b9\u6cd5\uff1a\u5728\u8bad\u7ec3\u65f6\u968f\u673a\u628a\u56fe\u7247\u7684\u4e00\u90e8\u5206\u51cf\u6389\uff0c\u8fd9\u6837\u80fd\u63d0\u9ad8\u6a21\u578b\u7684\u9c81\u68d2\u6027\u3002</p>"},{"location":"machine_learning/deep_learning/index.html#random-erasing","title":"Random erasing","text":"<p>\u6b63\u5219\u5316\u65b9\u6cd5\uff1a\u6a21\u62df\u7269\u4f53\u906e\u6321\u60c5\u51b5\u7684\u6570\u636e\u589e\u5f3a\u65b9\u6cd5\uff0c\u4f46\u7528\u968f\u673a\u6570\u6216\u8005\u6570\u636e\u96c6\u4e2d\u50cf\u7d20\u7684\u5e73\u5747\u503c\u66ff\u6362\u539f\u6765\u7684\u50cf\u7d20\u503c\uff0c\u4e14\u66ff\u6362\u6389\u7684\u533a\u57df\u5927\u5c0f\u662f\u968f\u673a\u3002</p>"},{"location":"machine_learning/deep_learning/index.html#mixup-training","title":"Mixup training.","text":"<p>\u6570\u636e\u589e\u5f3a\u7684\u65b9\u6cd5\uff1a\u6bcf\u6b21\u53d6\u51fa2\u5f20\u56fe\u7247\uff0c\u7136\u540e\u5c06\u5b83\u4eec\u7ebf\u6027\u7ec4\u5408\uff0c\u5f97\u5230\u65b0\u7684\u56fe\u7247\uff0c\u4ee5\u6b64\u6765\u4f5c\u4e3a\u65b0\u7684\u8bad\u7ec3\u6837\u672c\uff0c\u8fdb\u884c\u7f51\u7edc\u7684\u8bad\u7ec3\u3002</p> <p>Mixup\u65b9\u6cd5\u4e3b\u8981\u589e\u5f3a\u4e86\u8bad\u7ec3\u6837\u672c\u4e4b\u95f4\u7684\u7ebf\u6027\u8868\u8fbe\uff0c\u589e\u5f3a\u7f51\u7edc\u7684\u6cdb\u5316\u80fd\u529b\uff0c\u4e0d\u8fc7mixup\u65b9\u6cd5\u9700\u8981\u8f83\u957f\u7684\u65f6\u95f4\u624d\u80fd\u6536\u655b\u5f97\u6bd4\u8f83\u597d\u3002</p> <p>\\(\\hat{x}=\\lambda x_i + (1-\\lambda)x_j\\)</p> <p>\\(\\hat{y}=\\lambda y_i + (1-\\lambda)y_j\\)</p> <ul> <li>\u03bb\u662f\u4eceBeta(\u03b1, \u03b1)\u968f\u673a\u91c7\u6837\u7684\u6570\uff0c\u5728[0,1]\u4e4b\u95f4\u3002\u5728\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\uff0c\u4ec5\u4f7f\u7528\\((\\hat{x}, \\hat{y})\\)\u3002</li> </ul> <pre><code>for (images, labels) in train_loader:\n    l = np.random.beta(mixup_alpha, mixup_alpha)\n    index = torch.randperm(images.size(0))\n\n    images_a, images_b = images, images[index]\n    labels_a, labels_b = labels, labels[index]\n\n    mixed_images = l * images_a + (1 - l) * images_b\n\n    outputs = model(mixed_images)\n\n    loss = l * criterion(outputs, labels_a) + (1- l) * criterion(outputs, labels_b)\n\n    acc = l * accuracy(outputs, labels_a)[0] + (1- l) * accuracy(outputs, labels_b)[0]\n</code></pre>"},{"location":"machine_learning/deep_learning/index.html#adabound","title":"AdaBound","text":"<p>Optimizer\uff1a\u7ec3\u8fc7\u7a0b\u50cfadam\u4e00\u6837\u5feb\uff0c\u5e76\u4e14\u50cfSGD\u4e00\u6837\u597d\u3002</p> <p></p>"},{"location":"machine_learning/deep_learning/index.html#autoaugment","title":"AutoAugment","text":"<p>\u6570\u636e\u589e\u5f3a\uff1a\u641c\u7d22\u9002\u5408\u5f53\u524d\u95ee\u9898\u7684\u6570\u636e\u589e\u5f3a\u65b9\u6cd5\u7684\u65b9\u6cd5\u3002</p>"},{"location":"machine_learning/deep_learning/index.html#_5","title":"\u6b63\u5219\u5316\u65b9\u6cd5","text":"<ul> <li>Dropout</li> <li>L1/L2\u6b63\u5219</li> <li>Batch Normalization</li> <li>Early stopping</li> <li>Random cropping</li> <li>Mirroring</li> <li>Rotation</li> <li>Color shifting</li> <li>PCA color augmentation</li> </ul>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html","title":"\u56fe\u89e3 GPT-2\uff08\u53ef\u89c6\u5316 Transformer \u8bed\u8a00\u6a21\u578b\uff09","text":"<p>\u539f\u6587\uff1a\u56fe\u89e3 GPT-2\uff08\u53ef\u89c6\u5316\u8f6c\u6362\u5668\u8bed\u8a00\u6a21\u578b\uff09\u2014\u2014Jay Alammar </p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#1gpt2","title":"\u7b2c1\u90e8\u5206\uff1aGPT2 \u548c\u8bed\u8a00\u5efa\u6a21","text":""},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#_1","title":"\u4ec0\u4e48\u662f\u8bed\u8a00\u6a21\u578b","text":"<p>\u8bed\u8a00\u6a21\u578b\u2014\u2014\u57fa\u672c\u4e0a\u662f\u4e00\u79cd\u673a\u5668\u5b66\u4e60\u6a21\u578b\uff0c\u80fd\u591f\u67e5\u770b\u53e5\u5b50\u7684\u4e00\u90e8\u5206\u5e76\u9884\u6d4b\u4e0b\u4e00\u4e2a\u5355\u8bcd\u3002</p> <ul> <li>\u6700\u8457\u540d\u7684\u8bed\u8a00\u6a21\u578b\u662f\u667a\u80fd\u624b\u673a\u952e\u76d8\uff0c\u5b83\u6839\u636e\u60a8\u5f53\u524d\u8f93\u5165\u7684\u5185\u5bb9\u5efa\u8bae\u4e0b\u4e00\u4e2a\u5355\u8bcd\u3002</li> </ul> <p>GPT-2 \u662f\u5728\u4e00\u4e2a\u540d\u4e3a WebText \u7684 40GB \u6d77\u91cf\u6570\u636e\u96c6\u4e0a\u8bad\u7ec3\u7684\u3002</p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#_2","title":"\u7528\u4e8e\u8bed\u8a00\u5efa\u6a21\u7684\u8f6c\u6362\u5668","text":"<p>\u6700\u521d\u7684 transformer \u6a21\u578b\u7531\u7f16\u7801\u5668\u548c\u89e3\u7801\u5668\u7ec4\u6210\uff0c\u6bcf\u4e2a\u662f\u7531\u591a\u4e2a\u79f0\u4e3a\u8f6c\u6362\u5757\uff08Transformer Blocks\uff09\u7684\u6808\u6784\u6210\u3002</p> <ul> <li>\u8be5\u6a21\u578b\u89e3\u51b3\u4e86\u673a\u5668\u7ffb\u8bd1\u95ee\u9898\u3002  </li> </ul> <p></p> <p>\u5728\u968f\u540e\u7684\u8bb8\u591a\u7814\u7a76\u5de5\u4f5c\u4e2d\u90fd\u629b\u5f03\u4e86\u7f16\u7801\u5668\u6216\u89e3\u7801\u5668\uff0c\u53ea\u4f7f\u7528\u4e00\u5806\u8f6c\u6362\u5757\u2014\u2014\u5c06\u5b83\u4eec\u5806\u53e0\u5f97\u5c3d\u53ef\u80fd\u9ad8\u3002</p> <p></p> <p>GPT-2 \u7684\u5c0f\u6a21\u578b\u5230\u7279\u5927\u6a21\u578b\u7684\u6a21\u578b\u7ef4\u5ea6</p> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#bert","title":"\u4e0e BERT \u7684\u4e00\u4e2a\u533a\u522b","text":"<p>GPT-2 \u662f\u4f7f\u7528 transformer \u89e3\u7801\u5668\u5757\u6784\u5efa\u7684\u3002\u53e6\u4e00\u65b9\u9762\uff0cBERT \u4f7f\u7528transformer \u7f16\u7801\u5668\u5757\u3002</p> <ul> <li>GPT-2 \u4e0e\u4f20\u7edf\u8bed\u8a00\u6a21\u578b\u4e00\u6837\uff0c\u4e00\u6b21\u8f93\u51fa\u4e00\u4e2a Token\u3002</li> <li>made RNNs unreasonably effective\uff1a\u5728\u751f\u6210\u6bcf\u4e2a\u4ee4\u724c\u540e\uff0c\u8be5\u4ee4\u724c\u88ab\u6dfb\u52a0\u5230\u8f93\u5165\u5e8f\u5217\u4e2d\u3002\u8be5\u65b0\u5e8f\u5217\u5c06\u6210\u4e3a\u6a21\u578b\u4e0b\u4e00\u6b65\u7684\u8f93\u5165\u3002</li> </ul> <p></p> <p>GPT2 \u4ee5\u53ca\u4e00\u4e9b\u540e\u6765\u7684\u6a21\u578b\uff0c\u5982 TransformerXL \u548c XLNet\uff0c\u672c\u8d28\u4e0a\u662f\u81ea\u52a8\u56de\u5f52\u7684</p> <ul> <li> <p>BERT\u5931\u53bb\u81ea\u52a8\u56de\u5f52\u65f6\uff0c\u83b7\u5f97\u4e86\u5c06\u5355\u8bcd\u4e24\u8fb9\u7684\u4e0a\u4e0b\u6587\u5408\u5e76\u4ee5\u83b7\u5f97\u66f4\u597d\u7ed3\u679c\u7684\u80fd\u529b\u3002</p> </li> <li> <p>XLNet \u6062\u590d\u4e86\u81ea\u56de\u5f52\uff0c\u540c\u65f6\u627e\u5230\u4e86\u4e00\u79cd\u66ff\u4ee3\u65b9\u6cd5\u6765\u5408\u5e76\u53cc\u65b9\u7684\u4e0a\u4e0b\u6587\u3002</p> </li> </ul>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#_3","title":"\u8f6c\u6362\u5757\u7684\u6f14\u53d8","text":""},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#the-encoder-block","title":"The Encoder Block \u7f16\u7801\u5668\u6a21\u5757","text":"<p>\u9996\u5148\u662f\u7f16\u7801\u5668\u5757</p> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#the-decoder-block","title":"The Decoder Block \u89e3\u7801\u5668\u5757","text":"<p>\u5176\u6b21\uff0c\u89e3\u7801\u5668\u5757\u4e0e\u7f16\u7801\u5668\u5757\u7684\u67b6\u6784\u7565\u6709\u4e0d\u540c\uff0c\u8be5\u5c42\u5141\u8bb8\u5b83\u5173\u6ce8\u7f16\u7801\u5668\u4e2d\u7684\u7279\u5b9a\u6bb5\uff1a</p> <p></p> <p>\u81ea\u6211\u6ce8\u610f\u529b\u5c42\u7684\u4e00\u4e2a\u5173\u952e\u533a\u522b\u662f\uff0c\u5b83\u5c4f\u853d\u4e86\u672a\u6765\u7684\u4ee4\u724c</p> <ul> <li>\u4e0d\u662f\u901a\u8fc7\u50cf BERT \u90a3\u6837\u5c06\u5355\u8bcd\u66f4\u6539\u4e3a [mask]\uff0c\u800c\u662f\u901a\u8fc7\u5e72\u6270\u81ea\u6ce8\u610f\u529b\u8ba1\u7b97\u6765\u963b\u6b62\u6765\u81ea\u6b63\u5728\u8ba1\u7b97\u7684\u4f4d\u7f6e\u53f3\u4fa7\u7684\u4ee4\u724c\u7684\u4fe1\u606f\u3002</li> </ul> <p>\u4f8b\u5982\uff0c\u5982\u679c\u6211\u4eec\u8981\u7a81\u51fa\u663e\u793a\u4f4d\u7f6e #4 \u7684\u8def\u5f84\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5b83\u53ea\u5141\u8bb8\u5173\u6ce8\u5f53\u524d\u548c\u4ee5\u524d\u7684Token</p> <p>\u91cd\u8981\u7684\u662f\u8981\u660e\u786e\u81ea\u6211\u6ce8\u610f\u529b\uff08BERT \u4f7f\u7528\u7684\u4e1c\u897f\uff09\u548c\u63a9\u853d\u7684\u81ea\u6211\u6ce8\u610f\u529b\uff08GPT-2 \u4f7f\u7528\u7684\u4e1c\u897f)\u4e4b\u95f4\u7684\u533a\u522b\u3002</p> <ul> <li>\u6b63\u5e38\u7684\u81ea\u6ce8\u610f\u529b\u5141\u8bb8\u4e00\u4e2a\u4f4d\u7f6e\u5728\u5176\u53f3\u4fa7\u7684Token\u5904\u8fbe\u5230\u5cf0\u503c\uff08allows a position to peak at tokens to its right\uff09</li> <li>Masked\u7684\u81ea\u6ce8\u610f\u529b\u53ef\u4ee5\u9632\u6b62\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\uff1b</li> </ul> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#the-decoder-only-block","title":"The Decoder-Only Block \u4ec5\u89e3\u7801\u5668\u5757","text":"<p>\u5728\u539f\u59cb\u8bba\u6587\u4e4b\u540e\uff0c\u901a\u8fc7\u603b\u7ed3\u957f\u5e8f\u5217\u751f\u6210\u7ef4\u57fa\u767e\u79d1\u63d0\u51fa\u4e86\u53e6\u4e00\u79cd\u80fd\u591f\u8fdb\u884c\u8bed\u8a00\u5efa\u6a21\u7684\u8f6c\u6362\u5668\u6a21\u5757\u7684\u6392\u5217\u3002</p> <ul> <li>\u6a21\u578b\u79f0\u4e3a\u201cTransformer-Decoder\u201d\uff1a\u6254\u6389\u4e86 Transformer \u7f16\u7801\u5668</li> </ul> <p>\u8fd9\u4e2a\u65e9\u671f\u7684\u57fa\u4e8e Transformer \u7684\u8bed\u8a00\u6a21\u578b\u7531\u516d\u4e2a transformer \u89e3\u7801\u5668\u5757\u5806\u6808\u7ec4\u6210\uff1a</p> <ul> <li>\u8fd9\u4e9b\u5757\u4e0e\u539f\u59cb\u89e3\u7801\u5668\u5757\u975e\u5e38\u76f8\u4f3c\uff0c\u53ea\u662f\u5b83\u4eec\u53d6\u6d88\u4e86\u7b2c\u4e8c\u4e2a\u81ea\u6ce8\u610f\u529b\u5c42\u3002</li> <li>\u8be5\u6a21\u578b\u73b0\u5728\u53ef\u4ee5\u5728\u67d0\u4e2a\u6bb5\u4e2d\u5904\u7406\u591a\u8fbe 4,000 \u4e2a\u4ee4\u724c\u2014\u2014\u8fd9\u662f\u5bf9\u539f\u59cb transformer \u4e2d\u7684 512 \u7684\u5927\u89c4\u6a21\u5347\u7ea7\u3002</li> </ul> <p></p> <p>OpenAI GPT-2 \u6a21\u578b\u4f7f\u7528\u8fd9\u4e9b\u4ec5\u9650\u89e3\u7801\u5668\u7684\u5757\u3002</p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#gpt-2","title":"\u8111\u5916\u79d1\u901f\u6210\u8bfe\u7a0b\uff1a\u6df1\u5165\u4e86\u89e3 GPT-2","text":"<p>GPT-2 \u53ef\u4ee5\u5904\u7406 1024 \u4e2a tokens\u3002\u6bcf\u4e2a token \u90fd\u6cbf\u7740\u81ea\u5df1\u7684\u8def\u5f84\u6d41\u7ecf\u6240\u6709\u89e3\u7801\u5668\u5757\u3002</p> <p></p> <p>\u8fd0\u884c\u7ecf\u8fc7\u8bad\u7ec3\u7684 GPT-2 \u7684\u6700\u7b80\u5355\u65b9\u6cd5\u662f\u8ba9\u5b83\u81ea\u5df1\u6f2b\u65e0\u8fb9\u9645\uff08\u8fd9\u5728\u6280\u672f\u4e0a\u79f0\u4e3a\u751f\u6210\u65e0\u6761\u4ef6\u6837\u672c\uff09\u3002\u6216\u8005\uff0c\u6211\u4eec\u53ef\u4ee5\u63d0\u793a\u5b83\u8ba9\u5b83\u8c08\u8bba\u67d0\u4e2a\u4e3b\u9898\uff08\u53c8\u540d\u751f\u6210\u4ea4\u4e92\u5f0f\u6761\u4ef6\u6837\u672c\uff09\u3002</p> <ul> <li>\u5728\u6f2b\u65e0\u8fb9\u9645\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u5730\u5c06\u5f00\u59cb\u6807\u8bb0\u4ea4\u7ed9\u5b83\u5e76\u8ba9\u5b83\u5f00\u59cb\u751f\u6210\u5355\u8bcd\uff08\u7ecf\u8fc7\u8bad\u7ec3\u7684\u6a21\u578b\u7528 <code>&lt;|endoftext|&gt;</code> \u5176\u5f00\u59cb\u6807\u8bb0\u3002\u8ba9\u6211\u4eec\u6539\u79f0\u5b83 <code>&lt;s&gt;</code> \uff09</li> </ul> <p></p> <p>\u6a21\u578b\u53ea\u6709\u4e00\u4e2a\u8f93\u5165\u6807\u8bb0\uff0c\u56e0\u6b64\u8be5\u8def\u5f84\u5c06\u662f\u552f\u4e00\u7684\u6d3b\u52a8\u6807\u8bb0\u3002\u4ee4\u724c\u901a\u8fc7\u6240\u6709\u5c42\u8fde\u7eed\u5904\u7406\uff0c\u7136\u540e\u6cbf\u7740\u8be5\u8def\u5f84\u751f\u6210\u5411\u91cf\u3002</p> <ul> <li>\u8be5\u5411\u91cf\u53ef\u4ee5\u6839\u636e\u6a21\u578b\u7684\u8bcd\u6c47\u91cf\uff08\u6a21\u578b\u77e5\u9053\u7684\u6240\u6709\u5355\u8bcd\uff0c\u5728 GPT-2 \u7684\u60c5\u51b5\u4e0b\u4e3a 50,000 \u4e2a\u5355\u8bcd\uff09\u8fdb\u884c\u8bc4\u5206\u3002</li> </ul> <p>\u5728\u672c\u4f8b\u4e2d\uff0c\u6211\u4eec\u9009\u62e9\u4e86\u6982\u7387\u6700\u9ad8\u7684\u4ee3\u5e01\u201cthe\u201d\u3002\u5728\u4e0b\u4e00\u6b65\u4e2d\uff0c\u6211\u4eec\u5c06\u7b2c\u4e00\u6b65\u7684\u8f93\u51fa\u6dfb\u52a0\u5230\u8f93\u5165\u5e8f\u5217\u4e2d\uff0c\u5e76\u8ba9\u6a21\u578b\u8fdb\u884c\u4e0b\u4e00\u4e2a\u9884\u6d4b\uff1a</p> <p></p> <p>\u7b2c\u4e8c\u6761\u8def\u5f84\u662f\u6b64\u8ba1\u7b97\u4e2d\u552f\u4e00\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u7684\u8def\u5f84\u3002GPT-2 \u7684\u6bcf\u4e00\u5c42\u90fd\u4fdd\u7559\u4e86\u81ea\u5df1\u5bf9\u7b2c\u4e00\u4e2a\u4ee4\u724c\u7684\u89e3\u91ca\uff0c\u5e76\u5c06\u4f7f\u7528\u5b83\u6765\u5904\u7406\u7b2c\u4e8c\u4e2a\u4ee4\u724c\u3002GPT-2 \u4e0d\u4f1a\u6839\u636e\u7b2c\u4e8c\u4e2a\u4ee4\u724c\u91cd\u65b0\u89e3\u91ca\u7b2c\u4e00\u4e2a\u4ee4\u724c\u3002</p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#_4","title":"\u66f4\u6df1\u5165\u5730\u4e86\u89e3\u5185\u90e8","text":""},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#_5","title":"\u8f93\u5165\u7f16\u7801","text":"<p>\u4ece\u8f93\u5165\u5f00\u59cb\uff0c\u8be5\u6a21\u578b\u5728\u5176\u5d4c\u5165\u77e9\u9635\u4e2d\u67e5\u627e\u8f93\u5165\u8bcd\u7684\u5d4c\u5165\u3002</p> <ul> <li>\u6bcf\u4e00\u884c\u90fd\u662f\u4e00\u4e2a\u5355\u8bcd\u5d4c\u5165\uff1a\u4e00\u4e2a\u6570\u5b57\u5217\u8868\uff0c\u4ee3\u8868\u4e00\u4e2a\u5355\u8bcd\u5e76\u6355\u83b7\u5b83\u7684\u4e00\u4e9b\u542b\u4e49\u3002\u5728\u4e0d\u540c\u7684 GPT2 \u6a21\u578b\u5927\u5c0f\u4e2d\uff0c\u8be5\u5217\u8868\u7684\u5927\u5c0f\u662f\u4e0d\u540c\u7684\u3002\u6700\u5c0f\u7684\u6a21\u578b\u4f7f\u7528\u6bcf\u4e2a\u5b57/\u6807\u8bb0 768 \u7684\u5d4c\u5165\u5927\u5c0f\u3002</li> </ul> <p></p> <p>\u5728\u5f00\u59cb\u65f6\uff0c\u6211\u4eec\u5728\u5d4c\u5165\u77e9\u9635 <code>&lt;s&gt;</code> \u4e2d\u67e5\u627e\u5f00\u59cb\u6807\u8bb0\u7684\u5d4c\u5165\u3002\u5728\u5c06\u5176\u4f20\u9012\u7ed9\u6a21\u578b\u4e2d\u7684\u7b2c\u4e00\u4e2a\u6a21\u5757\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u5408\u5e76\u4f4d\u7f6e\u7f16\u7801\uff1a\u4e00\u4e2a\u4fe1\u53f7\uff0c\u6307\u793a\u5e8f\u5217\u4e2d Transformer Blocks\u4e2d\u5355\u8bcd\u7684\u987a\u5e8f</p> <ul> <li>\u8bad\u7ec3\u6a21\u578b\u7684\u4e00\u90e8\u5206\u662f\u4e00\u4e2a\u77e9\u9635\uff0c\u5176\u4e2d\u5305\u542b\u8f93\u5165\u4e2d 1024 \u4e2a\u4f4d\u7f6e\u4e2d\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u4f4d\u7f6e\u7f16\u7801\u5411\u91cf\u3002</li> </ul> <p></p> <p>\u6709\u4e86\u8fd9\u4e2a\uff0c\u6211\u4eec\u5c31\u5df2\u7ecf\u4ecb\u7ecd\u4e86\u5728\u5c06\u8f93\u5165\u8bcd\u4f20\u9012\u5230\u7b2c\u4e00\u4e2a\u8f6c\u6362\u5668\u5757\u4e4b\u524d\u5982\u4f55\u5904\u7406\u8f93\u5165\u8bcd\u3002\u6211\u4eec\u8fd8\u77e5\u9053\u6784\u6210\u8bad\u7ec3\u7684 GPT-2 \u7684\u4e24\u4e2a\u6743\u91cd\u77e9\u9635\u3002</p> <p></p> <p>\u5411\u7b2c\u4e00\u4e2a\u8f6c\u6362\u5668\u6a21\u5757\u53d1\u9001\u4e00\u4e2a\u5b57\u610f\u5473\u7740\u67e5\u627e\u5176\u5d4c\u5165\u5e76\u4e0e\u4f4d\u7f6e #1 \u7684\u4f4d\u7f6e\u7f16\u7801\u5411\u91cf\u76f8\u52a0\u3002</p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#_6","title":"\u5806\u6808\u4e4b\u65c5","text":"<p>\u7b2c\u4e00\u4e2a\u5757\u73b0\u5728\u53ef\u4ee5\u5904\u7406 token\uff0c\u65b9\u6cd5\u662f\u9996\u5148\u901a\u8fc7\u81ea\u6ce8\u610f\u529b\u8fc7\u7a0b\uff0c\u7136\u540e\u901a\u8fc7\u5176\u795e\u7ecf\u7f51\u7edc\u5c42\u3002\u4e00\u65e6\u7b2c\u4e00\u4e2a\u8f6c\u6362\u5668\u5757\u5904\u7406\u4e86token\uff0c\u5b83\u5c31\u4f1a\u5c06\u5176\u751f\u6210\u7684\u5411\u91cf\u53d1\u9001\u5230\u5806\u6808\u4e2d\uff0c\u7531\u4e0b\u4e00\u4e2a\u5757\u5904\u7406\u3002\u6bcf\u4e2a\u5757\u7684\u8fc7\u7a0b\u662f\u76f8\u540c\u7684\uff0c\u4f46\u6bcf\u4e2a\u5757\u5728\u81ea\u6ce8\u610f\u529b\u548c\u795e\u7ecf\u7f51\u7edc\u5b50\u5c42\u4e2d\u90fd\u6709\u81ea\u5df1\u7684\u6743\u91cd\u3002</p> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#self-attention-recap","title":"Self-Attention Recap \u81ea\u6211\u5173\u6ce8\u56de\u987e","text":"<p>\u8bed\u8a00\u5728\u5f88\u5927\u7a0b\u5ea6\u4e0a\u4f9d\u8d56\u4e8e\u4e0a\u4e0b\u6587\u3002\u4f8b\u5982\uff0c\u770b\u7b2c\u4e8c\u5b9a\u5f8b\uff1a</p> <p>Second Law of Robotics \u673a\u5668\u4eba\u7b2c\u4e8c\u5b9a\u5f8b A robot must obey the orders given it by human beings except where such orders would conflict with the First Law. \u673a\u5668\u4eba\u5fc5\u987b\u670d\u4ece\u4eba\u7c7b\u4e0b\u8fbe\u7684\u547d\u4ee4\uff0c\u9664\u975e\u8fd9\u4e9b\u547d\u4ee4\u4e0e\u7b2c\u4e00\u5b9a\u5f8b\u76f8\u51b2\u7a81\u3002</p> <p>\u6a21\u578b\u5904\u7406\u8fd9\u53e5\u8bdd\u65f6\uff0c\u5b83\u5fc5\u987b\u80fd\u591f\u77e5\u9053\uff1a</p> <ul> <li>it  \u6307\u7684\u662f\u673a\u5668\u4eba</li> <li>such orders  \u662f\u6307\u6cd5\u5f8b\u7684\u65e9\u671f\u90e8\u5206\uff0c\u5373\u201c\u4eba\u7c7b\u6240\u4e0b\u8fbe\u7684\u547d\u4ee4\u201d</li> <li>The First Law  \u662f\u6307\u6574\u4e2a\u7b2c\u4e00\u5b9a\u5f8b</li> </ul> <p>\u8fd9\u5c31\u662f\u81ea\u6211\u5173\u6ce8\uff08self-attention\uff09\u7684\u4f5c\u7528\u3002\u5b83\u70d8\u7119\uff08bakes\uff09\u6a21\u578b\u5bf9\u76f8\u5173\u548c\u76f8\u5173\u5355\u8bcd\u7684\u7406\u89e3\uff0c\u8fd9\u4e9b\u5355\u8bcd\u5728\u5904\u7406\u67d0\u4e2a\u5355\u8bcd\u4e4b\u524d\u89e3\u91ca\u8be5\u5355\u8bcd\u7684\u4e0a\u4e0b\u6587\uff08\u901a\u8fc7\u795e\u7ecf\u7f51\u7edc\u4f20\u9012\u5b83\uff09\u3002\u5b83\u901a\u8fc7\u4e3a\u53e5\u6bb5\u4e2d\u6bcf\u4e2a\u5355\u8bcd\u7684\u76f8\u5173\u6027\u5206\u914d\u5206\u6570\uff0c\u5e76\u52a0\u5176\u5411\u91cf\u8868\u793a\u6765\u505a\u5230\u8fd9\u4e00\u70b9\u3002</p> <ul> <li>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u9876\u90e8\u5757\u4e2d\u7684\u8fd9\u4e2a\u81ea\u6211\u6ce8\u610f\u529b\u5c42\u5728\u5904\u7406\u201c\u5b83\u201d\u8fd9\u4e2a\u8bcd\u65f6\u4f1a\u6ce8\u610f\u201c\u673a\u5668\u4eba\u201d\u3002\u5b83\u5c06\u4f20\u9012\u7ed9\u5176\u795e\u7ecf\u7f51\u7edc\u7684\u5411\u91cf\u662f\u4e09\u4e2a\u5355\u8bcd\u4e2d\u6bcf\u4e2a\u5355\u8bcd\u7684\u5411\u91cf\u4e58\u4ee5\u5b83\u4eec\u7684\u5206\u6570\u7684\u603b\u548c\u3002</li> </ul> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#self-attention-process","title":"Self-Attention Process \u81ea\u6211\u5173\u6ce8\u8fc7\u7a0b","text":"<p>\u81ea\u6ce8\u610f\u529b\u6cbf\u7740\u53e5\u6bb5\uff08segment\uff09\u4e2d\u6bcf\u4e2a token \u7684\u8def\u5f84\u8fdb\u884c\u5904\u7406\u3002\u91cd\u8981\u7ec4\u6210\u90e8\u5206\u662f\u4e09\u4e2a\u5411\u91cf\uff1a</p> <ul> <li>Query: \u67e5\u8be2\u662f\u5f53\u524d\u5355\u8bcd\u7684\u8868\u793a\u5f62\u5f0f\uff0c\u7528\u4e8e\u5bf9\u6240\u6709\u5176\u4ed6\u5355\u8bcd\uff08\u4f7f\u7528\u5176\u952e\uff09\u8fdb\u884c\u8bc4\u5206\u3002\u53ea\u5173\u5fc3\u5f53\u524d\u6b63\u5728\u5904\u7406\u7684 token \u7684\u67e5\u8be2\u3002</li> <li>Key: \u5173\u952e\u5411\u91cf\u5c31\u50cf\u53e5\u6bb5\u4e2d\u6240\u6709\u5355\u8bcd\u7684\u6807\u7b7e\u3002\u5b83\u4eec\u662f\u6211\u4eec\u5728\u641c\u7d22\u76f8\u5173\u5355\u8bcd\u65f6\u6240\u5339\u914d\u7684\u3002</li> <li>Value: \u503c\u5411\u91cf\u662f\u5b9e\u9645\u7684\u5355\u8bcd\u8868\u793a\uff0c\u4e00\u65e6\u6211\u4eec\u5bf9\u6bcf\u4e2a\u5355\u8bcd\u7684\u76f8\u5173\u6027\u8fdb\u884c\u4e86\u8bc4\u5206\uff0c\u8fd9\u4e9b\u503c\u5c31\u662f\u6211\u4eec\u52a0\u8d77\u6765\u8868\u793a\u5f53\u524d\u5355\u8bcd\u7684\u503c\u3002</li> </ul> <p></p> <p>\u4e00\u4e2a\u7c97\u7565\u7684\u7c7b\u6bd4\u662f\u628a\u5b83\u60f3\u8c61\u6210\u5728\u6587\u4ef6\u67dc\u91cc\u641c\u7d22\u3002</p> <ul> <li> <p>\u67e5\u8be2\u5c31\u50cf\u6b63\u5728\u7814\u7a76\u7684\u4e3b\u9898\u7684\u4fbf\u7b7e\u3002</p> </li> <li> <p>\u94a5\u5319\u5c31\u50cf\u67dc\u5b50\u91cc\u6587\u4ef6\u5939\u7684\u6807\u7b7e\u3002</p> </li> </ul> <p>\u5f53\u60a8\u5c06\u6807\u7b7e\u4e0e\u4fbf\u7b7e\u5339\u914d\u65f6\uff0c\u6211\u4eec\u4f1a\u53d6\u51fa\u8be5\u6587\u4ef6\u5939\u7684\u5185\u5bb9\uff0c\u8fd9\u4e9b\u5185\u5bb9\u662f\u503c\u5411\u91cf\u3002\u9664\u4e86\u60a8\u4e0d\u4ec5\u8981\u67e5\u627e\u4e00\u4e2a\u503c\uff0c\u8fd8\u8981\u67e5\u627e\u6765\u81ea\u6df7\u5408\u6587\u4ef6\u5939\u7684\u503c\u7684\u6df7\u5408\u503c\u3002</p> <p>\u5c06\u67e5\u8be2\u5411\u91cf\u4e58\u4ee5\u6bcf\u4e2a\u952e\u5411\u91cf\u4f1a\u751f\u6210\u6bcf\u4e2a\u6587\u4ef6\u5939\u7684\u5206\u6570\uff08\u4ece\u6280\u672f\u4e0a\u8bb2\uff1a\u70b9\u79ef\u540e\u8ddf softmax\uff09\u3002</p> <p></p> <p>\u6211\u4eec\u5c06\u6bcf\u4e2a\u503c\u4e58\u4ee5\u5b83\u7684\u5206\u6570\u5e76\u76f8\u52a0\u2014\u2014\u4ece\u800c\u4ea7\u751f\u6211\u4eec\u7684\u81ea\u6211\u5173\u6ce8\u7ed3\u679c\u3002</p> <ul> <li>\u8fd9\u79cd\u4ef7\u503c\u5411\u91cf\u7684\u52a0\u6743\u6df7\u5408\u5bfc\u81f4\u4e00\u4e2a\u5411\u91cf\u5c06 50% \u7684\u201c\u6ce8\u610f\u529b\u201d\u652f\u4ed8\u7ed9\u5355\u8bcd <code>robot</code> \uff0c30% \u652f\u4ed8\u7ed9\u5355\u8bcd <code>a</code> \uff0c19% \u652f\u4ed8\u7ed9\u5355\u8bcd <code>it</code> \u3002</li> </ul>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#model-output","title":"Model Output \u6a21\u578b\u8f93\u51fa","text":"<p>\u5f53\u6a21\u578b\u4e2d\u7684\u9876\u90e8\u6a21\u5757\u4ea7\u751f\u5176\u8f93\u51fa\u5411\u91cf\uff08\u5176\u81ea\u8eab\u81ea\u6ce8\u610f\u529b\u7684\u7ed3\u679c\uff0c\u7136\u540e\u662f\u5176\u81ea\u8eab\u7684\u795e\u7ecf\u7f51\u7edc\uff09\u65f6\uff0c\u6a21\u578b\u5c06\u8be5\u5411\u91cf\u4e58\u4ee5\u5d4c\u5165\u77e9\u9635\u3002</p> <p></p> <p>\u56de\u60f3\u4e00\u4e0b\uff0c\u5d4c\u5165\u77e9\u9635\u4e2d\u7684\u6bcf\u4e00\u884c\u90fd\u5bf9\u5e94\u4e8e\u6a21\u578b\u8bcd\u6c47\u8868\u4e2d\u4e00\u4e2a\u5355\u8bcd\u7684\u5d4c\u5165\u3002\u8fd9\u79cd\u4e58\u6cd5\u7684\u7ed3\u679c\u88ab\u89e3\u91ca\u4e3a\u6a21\u578b\u8bcd\u6c47\u8868\u4e2d\u6bcf\u4e2a\u5355\u8bcd\u7684\u5206\u6570\u3002</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u5730\u9009\u62e9\u5f97\u5206\u6700\u9ad8\u7684 token\uff08top_k = 1\uff09\u3002\u4f46\u662f\uff0c\u5982\u679c\u6a21\u578b\u4e5f\u8003\u8651\u5176\u4ed6\u5355\u8bcd\uff0c\u5219\u4f1a\u83b7\u5f97\u66f4\u597d\u7684\u7ed3\u679c\u3002</p> <ul> <li>\u4e0a\u7b56\u662f\u4f7f\u7528\u5206\u6570\u4f5c\u4e3a\u9009\u62e9\u8be5\u5355\u8bcd\u7684\u6982\u7387\u4ece\u6574\u4e2a\u5217\u8868\u4e2d\u62bd\u53d6\u4e00\u4e2a\u5355\u8bcd\uff08\u56e0\u6b64\u5206\u6570\u8f83\u9ad8\u7684\u5355\u8bcd\u88ab\u9009\u4e2d\u7684\u673a\u4f1a\u66f4\u9ad8\uff09\u3002</li> <li>\u4e2d\u7b56\u662f\u5c06 top_k \u8bbe\u7f6e\u4e3a 40\uff0c\u5e76\u8ba9\u6a21\u578b\u8003\u8651\u5f97\u5206\u6700\u9ad8\u7684 40 \u4e2a\u5355\u8bcd\u3002</li> </ul> <p></p> <p>\u8fd9\u6837\uff0c\u6a21\u578b\u5c31\u5b8c\u6210\u4e86\u8fed\u4ee3\uff0c\u8f93\u51fa\u4e86\u4e00\u4e2a\u5355\u8bcd\u3002\u6a21\u578b\u7ee7\u7eed\u8fed\u4ee3\uff0c\u76f4\u5230\u751f\u6210\u6574\u4e2a\u4e0a\u4e0b\u6587\uff081024 \u4e2a\u6807\u8bb0\uff09\u6216\u76f4\u5230\u751f\u6210\u5e8f\u5217\u672b\u5c3e\u6807\u8bb0\u3002</p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#1-gpt-2","title":"\u7b2c #1 \u90e8\u5206\u7ed3\u675f\uff1aGPT-2\uff0c\u5973\u58eb\u4eec\uff0c\u5148\u751f\u4eec","text":"<p>\u5982\u679c\u4f60\u60f3\u77e5\u9053\u81ea\u6211\u5173\u6ce8\u5c42\u5185\u90e8\u5230\u5e95\u53d1\u751f\u4e86\u4ec0\u4e48\uff0c\u90a3\u4e48\u4e0b\u9762\u7684\u5956\u52b1\u90e8\u5206\u5c31\u662f\u4e3a\u4f60\u51c6\u5907\u7684\u3002</p> <p>\u6211\u521b\u5efa\u5b83\u662f\u4e3a\u4e86\u5f15\u5165\u66f4\u591a\u7684\u89c6\u89c9\u8bed\u8a00\u6765\u63cf\u8ff0\u81ea\u6211\u6ce8\u610f\u529b\uff0c\u4ee5\u4fbf\u66f4\u5bb9\u6613\u5730\u63cf\u8ff0\u540e\u6765\u7684 transformer \u6a21\u578b\uff08\u770b\u7740\u4f60\uff0cTransformerXL \u548c XLNet\uff09\u3002</p> <p>\u6211\u60f3\u5728\u8fd9\u7bc7\u6587\u7ae0\u4e2d\u6307\u51fa\u4e00\u4e9b\u8fc7\u4e8e\u7b80\u5316\u7684\u5730\u65b9\uff1a</p> <ul> <li>\u6211\u4ea4\u66ff\u4f7f\u7528\u201cwords\u201d\u548c\u201ctokens\u201d\u3002\u4f46\u5b9e\u9645\u4e0a\uff0cGPT2 \u4f7f\u7528\u5b57\u8282\u5bf9\uff08Byte Pair\uff09\u7f16\u7801\u6765\u521b\u5efa\u5176\u8bcd\u6c47\u8868\u4e2d\u7684 token\u3002\u8fd9\u610f\u5473\u7740 tokens \u901a\u5e38\u662f words \u7684\u4e00\u90e8\u5206\u3002</li> <li>\u5c55\u793a\u7684\u793a\u4f8b\u5728\u5176\u63a8\u7406/\u8bc4\u4f30\u6a21\u5f0f\u4e0b\u8fd0\u884c GPT2\u3002\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u5b83\u4e00\u6b21\u53ea\u5904\u7406\u4e00\u4e2a\u5355\u8bcd\u3002\u5728\u8bad\u7ec3\u65f6\uff0c\u6a21\u578b\u5c06\u9488\u5bf9\u8f83\u957f\u7684\u6587\u672c\u5e8f\u5217\u8fdb\u884c\u8bad\u7ec3\uff0c\u5e76\u540c\u65f6\u5904\u7406\u591a\u4e2a\u4ee4\u724c\u3002\u540c\u6837\u5728\u8bad\u7ec3\u65f6\uff0c\u6a21\u578b\u5c06\u5904\u7406\u66f4\u5927\u7684\u6279\u91cf\u5927\u5c0f \uff08512\uff09 VS \u8bc4\u4f30\u4f7f\u7528\u7684\u6279\u91cf\u5927\u5c0f\u3002</li> <li>\u6211\u81ea\u7531\u5730\u65cb\u8f6c/\u8f6c\u7f6e\u77e2\u91cf\uff0c\u4ee5\u66f4\u597d\u5730\u7ba1\u7406\u56fe\u50cf\u4e2d\u7684\u7a7a\u95f4\u3002\u5728\u5b9e\u65bd\u65f6\uff0c\u5fc5\u987b\u66f4\u52a0\u7cbe\u786e\u3002</li> <li>Transformer \u4f7f\u7528\u5927\u91cf\u7684\u5c42\u5f52\u4e00\u5316\uff0c\u8fd9\u975e\u5e38\u91cd\u8981\u3002\u5728\u8fd9\u7bc7\u6587\u7ae0\u4e2d\u66f4\u4fa7\u91cd\u4e8e\u81ea\u6211\u5173\u6ce8\u3002</li> <li>\u6709\u65f6\u6211\u9700\u8981\u663e\u793a\u66f4\u591a\u7684\u6846\u6765\u8868\u793a\u5411\u91cf\u3002\u6211\u5c06\u5176\u8868\u793a\u4e3a\u201c\u653e\u5927\u201d\u3002\u4f8b\u5982\uff1a</li> </ul> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#2","title":"\u7b2c #2 \u90e8\u5206\uff1a\u81ea\u6211\u5173\u6ce8\u7684\u56fe\u89e3","text":"<p>\u5728\u6587\u7ae0\u7684\u524d\u9762\uff0c\u6211\u4eec\u5c55\u793a\u4e86\u8fd9\u5f20\u56fe\u7247\uff0c\u4ee5\u5c55\u793a\u5728\u5904\u7406\u5355\u8bcd <code>it</code> \u7684\u5c42\u4e2d\u5e94\u7528\u7684\u81ea\u6211\u6ce8\u610f\u529b\uff1a</p> <p></p> <p>\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u5c06\u8be6\u7ec6\u4ecb\u7ecd\u5982\u4f55\u505a\u5230\u8fd9\u4e00\u70b9\u3002\u8bf7\u6ce8\u610f\uff0c\u6211\u4eec\u5c06\u4ee5\u4e00\u79cd\u5c1d\u8bd5\u7406\u89e3\u5355\u4e2a\u5355\u8bcd\u53d1\u751f\u7684\u4e8b\u60c5\u7684\u65b9\u5f0f\u6765\u770b\u5f85\u5b83\u3002\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u6211\u4eec\u5c06\u5c55\u793a\u8bb8\u591a\u5355\u5411\u91cf\u3002\u5b9e\u9645\u7684\u5b9e\u73b0\u662f\u901a\u8fc7\u5c06\u5de8\u578b\u77e9\u9635\u76f8\u4e58\u6765\u5b8c\u6210\u7684\u3002</p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#masking","title":"\u81ea\u6211\u5173\u6ce8\uff08\u65e0Masking\uff09","text":"<p>\u8ba9\u6211\u4eec\u5148\u770b\u4e00\u4e0b\u5728\u7f16\u7801\u5668\u5757\u4e2d\u8ba1\u7b97\u7684\u539f\u59cb\u7684\u81ea\u6ce8\u610f\u529b\u3002\u8ba9\u6211\u4eec\u770b\u4e00\u4e2a\u73a9\u5177 transformer block \uff0c\u5b83\u4e00\u6b21\u53ea\u80fd\u5904\u7406\u56db\u4e2a\u4ee4\u724c\u3002</p> <p>\u81ea\u6211\u5173\u6ce8\u901a\u8fc7\u4e09\u4e2a\u4e3b\u8981\u6b65\u9aa4\u5e94\u7528\uff1a</p> <ul> <li>\u4e3a\u6bcf\u4e2a\u8def\u5f84\u521b\u5efa Query\u3001Key \u548c Value \u5411\u91cf\u3002</li> <li>\u5bf9\u4e8e\u6bcf\u4e2a\u8f93\u5165\u4ee4\u724c\uff0c\u4f7f\u7528\u5176\u67e5\u8be2\u5411\u91cf\u5bf9\u6240\u6709\u5176\u4ed6\u5173\u952e\u5411\u91cf\u8fdb\u884c\u8bc4\u5206</li> <li>\u5c06\u503c\u5411\u91cf\u4e58\u4ee5\u76f8\u5173\u5206\u6570\u540e\uff0c\u5c06\u4ef7\u503c\u5411\u91cf\u76f8\u52a0\u3002</li> </ul> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#1-","title":"1- \u521b\u5efa\u67e5\u8be2\u3001\u952e\u548c\u503c\u5411\u91cf","text":"<p>\u63a5\u53d7\u5b83\u7684\u67e5\u8be2\uff0c\u5e76\u4e0e\u6240\u6709\u952e\u8fdb\u884c\u6bd4\u8f83\u3002\u8fd9\u5c06\u4e3a\u6bcf\u4e2a\u952e\u751f\u6210\u4e00\u4e2a\u5206\u6570\u3002\u81ea\u6ce8\u610f\u529b\u7684\u7b2c\u4e00\u6b65\u662f\u8ba1\u7b97\u6bcf\u4e2a\u4ee4\u724c\u8def\u5f84\u7684\u4e09\u4e2a\u5411\u91cf\uff08\u6211\u4eec\u6682\u65f6\u5ffd\u7565\u6ce8\u610f\u529b\u5934\uff09\uff1a</p> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#2-score-2-","title":"2- Score 2- \u5f97\u5206","text":"<p>\u73b0\u5728\u6211\u4eec\u6709\u4e86\u5411\u91cf\uff0c\u6211\u4eec\u53ea\u5728\u6b65\u9aa4 #2 \u4e2d\u4f7f\u7528\u67e5\u8be2\u548c\u952e\u5411\u91cf\u3002\u7531\u4e8e\u6211\u4eec\u4e13\u6ce8\u4e8e\u7b2c\u4e00\u4e2a\u4ee4\u724c\uff0c\u56e0\u6b64\u6211\u4eec\u5c06\u5176\u67e5\u8be2\u4e58\u4ee5\u6240\u6709\u5176\u4ed6\u5173\u952e\u5411\u91cf\uff0c\u4ece\u800c\u5f97\u51fa\u56db\u4e2a\u4ee4\u724c\u4e2d\u6bcf\u4e2a\u4ee4\u724c\u7684\u5206\u6570\u3002</p> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#3-","title":"3- \u603b\u548c","text":"<p>\u73b0\u5728\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5206\u6570\u4e58\u4ee5\u503c\u5411\u91cf\u3002\u5728\u6211\u4eec\u5c06\u5b83\u4eec\u76f8\u52a0\u540e\uff0c\u5f97\u5206\u9ad8\u7684\u503c\u5c06\u6784\u6210\u7ed3\u679c\u5411\u91cf\u7684\u5f88\u5927\u4e00\u90e8\u5206\u3002</p> <p></p> <p>\u5206\u6570\u8d8a\u4f4e\uff0c\u6211\u4eec\u663e\u793a\u7684\u4ef7\u503c\u5411\u91cf\u5c31\u8d8a\u900f\u660e\u3002\u8fd9\u662f\u4e3a\u4e86\u8868\u660e\u4e58\u4ee5\u4e00\u4e2a\u5c0f\u6570\u5b57\u5982\u4f55\u7a00\u91ca\u5411\u91cf\u7684\u503c\u3002</p> <p>\u5982\u679c\u6211\u4eec\u5bf9\u6bcf\u4e2a\u8def\u5f84\u6267\u884c\u76f8\u540c\u7684\u64cd\u4f5c\uff0c\u6211\u4eec\u6700\u7ec8\u4f1a\u5f97\u5230\u4e00\u4e2a\u5411\u91cf\uff0c\u8868\u793a\u5305\u542b\u8be5\u6807\u8bb0\uff08token\uff09\u7684\u9002\u5f53\u4e0a\u4e0b\u6587\u7684\u6bcf\u4e2a\u6807\u8bb0\u3002\u7136\u540e\uff0c\u8fd9\u4e9b\u88ab\u5448\u73b0\u7ed9\u8f6c\u6362\u5668\u6a21\u5757\uff08\u524d\u9988\u795e\u7ecf\u7f51\u7edc\uff09\u4e2d\u7684\u4e0b\u4e00\u4e2a\u5b50\u5c42\uff1a</p> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#masked-self-attention","title":"Masked Self-Attention\u7684\u56fe\u89e3","text":"<p>\u63a9\u853d\u7684\u81ea\u6211\u6ce8\u610f\u529b\u4e0e\u81ea\u6211\u6ce8\u610f\u529b\u76f8\u540c\uff0c\u9664\u975e\u6d89\u53ca\u5230\u6b65\u9aa4#2\u3002</p> <p>\u5047\u8bbe\u6a21\u578b\u53ea\u6709\u4e24\u4e2a\u6807\u8bb0\u4f5c\u4e3a\u8f93\u5165\uff0c\u5e76\u4e14\u6211\u4eec\u6b63\u5728\u89c2\u5bdf\u7b2c\u4e8c\u4e2a\u6807\u8bb0\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6700\u540e\u4e24\u4e2a\u6807\u8bb0\uff08token\uff09\u88ab\u5c4f\u853d\u3002\u56e0\u6b64\uff0c\u6a21\u578b\u4f1a\u5e72\u6270\u8bc4\u5206\u6b65\u9aa4\u3002\u5b83\u57fa\u672c\u4e0a\u603b\u662f\u5c06\u672a\u6765\u6807\u8bb0\u8bc4\u5206\u4e3a 0\uff0c\u56e0\u6b64\u6a21\u578b\u65e0\u6cd5\u8fbe\u5230\u672a\u6765\u5355\u8bcd\u7684\u5cf0\u503c\uff08peak to future words\uff09\uff1a</p> <p></p> <p>\u8fd9\u79cd\u63a9\u7801\u901a\u5e38\u4f5c\u4e3a\u79f0\u4e3a\u6ce8\u610f\u529b\u63a9\u7801\u7684\u77e9\u9635\u5b9e\u73b0\u3002\u60f3\u60f3\u4e00\u4e2a\u7531\u56db\u4e2a\u8bcd\u7ec4\u6210\u7684\u5e8f\u5217\uff08\u4f8b\u5982 \u201crobot must obey orders\u201d\uff09\u3002\u5728\u8bed\u8a00\u5efa\u6a21\u573a\u666f\u4e2d\uff0c\u6b64\u5e8f\u5217\u5206\u56db\u4e2a\u6b65\u9aa4\u5438\u6536 - \u6bcf\u4e2a\u5355\u8bcd\u4e00\u4e2a\u6b65\u9aa4\uff08\u73b0\u5728\u5047\u8bbe\u6bcf\u4e2a\u5355\u8bcd\u90fd\u662f\u4e00\u4e2a\u6807\u8bb0\uff09\u3002</p> <p>\u7531\u4e8e\u8fd9\u4e9b\u6a21\u578b\u662f\u6279\u91cf\u5de5\u4f5c\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u5047\u8bbe\u8fd9\u4e2a\u73a9\u5177\u6a21\u578b\u7684\u6279\u5904\u7406\u5927\u5c0f\u4e3a 4\uff0c\u5b83\u5c06\u4f5c\u4e3a\u4e00\u4e2a\u6279\u5904\u7406\u6574\u4e2a\u5e8f\u5217\uff08\u5305\u62ec\u56db\u4e2a\u6b65\u9aa4\uff09\u3002</p> <p></p> <p>\u5728\u77e9\u9635\u5f62\u5f0f\u4e2d\uff0c\u6211\u4eec\u901a\u8fc7\u5c06\u67e5\u8be2\u77e9\u9635\u4e58\u4ee5\u952e\u77e9\u9635\u6765\u8ba1\u7b97\u5206\u6570\u3002\u8ba9\u6211\u4eec\u5c06\u5176\u53ef\u89c6\u5316\u5982\u4e0b\uff0c\u9664\u4e86\u8be5\u5355\u5143\u683c\u4e2d\u4e0e\u8be5\u5355\u8bcd\u5173\u8054\u7684\u67e5\u8be2\uff08\u6216\u952e\uff09\u5411\u91cf\u4e4b\u5916\uff0c\u4e0d\u662f\u5355\u8bcd\uff1a</p> <p></p> <p>\u4e58\u6cd5\u4e4b\u540e\uff0c\u6211\u4eec\u62cd\u6253\u6211\u4eec\u7684\u6ce8\u610f\u529b\u63a9\u7801\u4e09\u89d2\u5f62\u3002\u5b83\u5c06\u6211\u4eec\u60f3\u8981\u5c4f\u853d\u7684\u5355\u5143\u683c\u8bbe\u7f6e\u4e3a -infinity \u6216\u975e\u5e38\u5927\u7684\u8d1f\u6570\uff08\u4f8b\u5982\uff0cGPT2 \u4e2d\u7684 -10 \u4ebf\uff09\uff1a</p> <p></p> <p>\u7136\u540e\uff0c\u5728\u6bcf\u4e00\u884c\u4e0a\u5e94\u7528 softmax \u4f1a\u4ea7\u751f\u6211\u4eec\u7528\u4e8e\u81ea\u6211\u6ce8\u610f\u529b\u7684\u5b9e\u9645\u5206\u6570\uff1a</p> <p></p> <p>\u6b64\u5206\u6570\u8868\u7684\u542b\u4e49\u5982\u4e0b\uff1a</p> <ul> <li>\u5f53\u6a21\u578b\u5904\u7406\u6570\u636e\u96c6\u4e2d\u7684\u7b2c\u4e00\u4e2a\u793a\u4f8b\uff08\u884c #1\uff09\u65f6\uff0c\u8be5\u793a\u4f8b\u4ec5\u5305\u542b\u4e00\u4e2a\u5355\u8bcd\uff08\u201c\u673a\u5668\u4eba\u201d\uff09\uff0c\u5176 100% \u7684\u6ce8\u610f\u529b\u5c06\u96c6\u4e2d\u5728\u8be5\u5355\u8bcd\u4e0a\u3002</li> <li>\u5f53\u6a21\u578b\u5904\u7406\u6570\u636e\u96c6\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u793a\u4f8b\uff08\u884c #2\uff09\u65f6\uff0c\u5176\u4e2d\u5305\u542b\u5355\u8bcd \uff08\u201crobot must\u201d\uff09\uff0c\u5f53\u5b83\u5904\u7406\u5355\u8bcd\u201cmust\u201d\u65f6\uff0c\u5176 48% \u7684\u6ce8\u610f\u529b\u5c06\u653e\u5728\u201c\u673a\u5668\u4eba\u201d\u4e0a\uff0c52% \u7684\u6ce8\u610f\u529b\u5c06\u653e\u5728\u201c\u5fc5\u987b\u201d\u4e0a\u3002</li> <li>\u7b49\u7b49</li> </ul>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#gpt-2-masked-self-attention","title":"GPT-2 Masked Self-Attention","text":""},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#_7","title":"\u8bc4\u4f30\u65f6\u95f4\uff1a\u4e00\u6b21\u5904\u7406\u4e00\u4e2a\u4ee4\u724c","text":"<p>\u6211\u4eec\u53ef\u4ee5\u8ba9 GPT-2 \u5b8c\u5168\u6309\u7167\u63a9\u9970\u7684\u81ea\u6211\u6ce8\u610f\u529b\u5de5\u4f5c\u65b9\u5f0f\u8fd0\u884c\u3002\u4f46\u662f\u5728\u8bc4\u4f30\u8fc7\u7a0b\u4e2d\uff0c\u5f53\u6211\u4eec\u7684\u6a21\u578b\u5728\u6bcf\u6b21\u8fed\u4ee3\u540e\u53ea\u6dfb\u52a0\u4e00\u4e2a\u65b0\u5355\u8bcd\u65f6\uff0c\u5bf9\u4e8e\u5df2\u7ecf\u5904\u7406\u8fc7\u7684\u6807\u8bb0\uff0c\u6cbf\u7740\u65e9\u671f\u8def\u5f84\u91cd\u65b0\u8ba1\u7b97\u81ea\u6211\u6ce8\u610f\u529b\u662f\u4f4e\u6548\u7684\u3002</p> <p>\u5728\u672c\u4f8b\u4e2d\uff0c\u6211\u4eec\u5904\u7406\u7b2c\u4e00\u4e2a\u4ee4\u724c\uff08\u6682\u65f6\u5ffd\u7565 <code>&lt;s&gt;</code> \uff09\u3002</p> <p></p> <p>GPT-2 \u4fdd\u7559 <code>a</code> token \u7684\u952e\u548c\u503c\u5411\u91cf\u3002\u6bcf\u4e2a\u81ea\u6ce8\u610f\u529b\u5c42\u90fd\u4fdd\u7559\u8be5\u4ee4\u724c\u7684\u5404\u81ea\u952e\u548c\u503c\u5411\u91cf\uff1a</p> <p></p> <p>\u73b0\u5728\uff0c\u5728\u4e0b\u4e00\u6b21\u8fed\u4ee3\u4e2d\uff0c\u5f53\u6a21\u578b\u5904\u7406\u5355\u8bcd <code>robot</code> \u65f6\uff0c\u5b83\u4e0d\u9700\u8981\u4e3a <code>a</code> token \u751f\u6210\u67e5\u8be2\u3001\u952e\u548c\u503c\u67e5\u8be2\u3002\u5b83\u53ea\u662f\u91cd\u7528\u5b83\u4ece\u7b2c\u4e00\u6b21\u8fed\u4ee3\u4e2d\u4fdd\u5b58\u7684\u5185\u5bb9\uff1a</p> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#gpt-2-1-","title":"GPT-2 \u81ea\u6211\u5173\u6ce8\uff1a1- \u521b\u5efa\u67e5\u8be2\u3001\u952e\u548c\u503c","text":"<p>\u5047\u8bbe\u6a21\u578b\u6b63\u5728\u5904\u7406\u5355\u8bcd <code>it</code> \u3002\u5982\u679c\u6211\u4eec\u8c08\u8bba\u7684\u662f\u5e95\u90e8\u5757\uff0c\u90a3\u4e48\u8be5\u4ee4\u724c\u7684\u8f93\u5165\u5c06\u662f <code>it</code> + \u63d2\u69fd #9 \u7684\u4f4d\u7f6e\u7f16\u7801\u7684\u5d4c\u5165\uff1a</p> <p></p> <p>transformer\u7684\u6bcf\u4e2a\u5757\u90fd\u6709\u81ea\u5df1\u7684\u6743\u91cd\uff08\u5728\u540e\u9762\u7684\u5e16\u5b50\u4e2d\u5206\u89e3\uff09\u3002\u6211\u4eec\u9047\u5230\u7684\u7b2c\u4e00\u4e2a\u662f\u6211\u4eec\u7528\u6765\u521b\u5efa\u67e5\u8be2\u3001\u952e\u548c\u503c\u7684\u6743\u91cd\u77e9\u9635\u3002</p> <p></p> <p>\u81ea\u6ce8\u610f\u529b\u5c06\u5176\u8f93\u5165\u4e58\u4ee5\u5176\u6743\u91cd\u77e9\u9635\uff08\u5e76\u6dfb\u52a0\u4e00\u4e2a\u504f\u7f6e\u5411\u91cf\uff0c\u6b64\u5904\u672a\u8bf4\u660e\uff09\u3002</p> <p>\u4e58\u6cd5\u5f97\u5230\u4e00\u4e2a\u5411\u91cf\uff0c\u8be5\u5411\u91cf\u57fa\u672c\u4e0a\u662f\u5355\u8bcd <code>it</code> \u7684\u67e5\u8be2\u3001\u952e\u548c\u503c\u5411\u91cf\u7684\u4e32\u8054\u3002</p> <p></p> <p>\u5c06\u8f93\u5165\u5411\u91cf\u4e58\u4ee5\u6ce8\u610f\u529b\u6743\u91cd\u5411\u91cf\uff08\u5e76\u5728\u540e\u65b9\u6dfb\u52a0\u504f\u5411\u91cf\uff09\u5f97\u5230\u6b64\u6807\u8bb0\u7684\u952e\u3001\u503c\u548c\u67e5\u8be2\u5411\u91cf\u3002</p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#gpt-2-15-","title":"GPT-2 \u81ea\u6211\u6ce8\u610f\u529b\uff1a1.5- \u5206\u88c2\u6210\u6ce8\u610f\u529b\u5934","text":"<p>\u5728\u524d\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u76f4\u63a5\u8fdb\u5165\u81ea\u6211\u5173\u6ce8\uff0c\u5ffd\u7565\u4e86\u201c\u591a\u5934\u201d\u90e8\u5206\u3002</p> <p>\u81ea\u6211\u6ce8\u610f\u529b\u5728Q\uff0cK\uff0cV\u5411\u91cf\u7684\u4e0d\u540c\u90e8\u5206\u8fdb\u884c\u591a\u6b21\u3002\u201c\u62c6\u5206\u201d\u6ce8\u610f\u529b\u5934\u53ea\u662f\u5c06\u957f\u5411\u91cf\u91cd\u5851\u4e3a\u77e9\u9635\u3002\u5c0f GPT2 \u6709 12 \u4e2a\u6ce8\u610f\u529b\u5934\uff0c\u56e0\u6b64\u8fd9\u5c06\u662f\u91cd\u5851\u77e9\u9635\u7684\u7b2c\u4e00\u4e2a\u7ef4\u5ea6\uff1a</p> <p></p> <p>\u5728\u524d\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u7814\u7a76\u4e86\u4e00\u4e2a\u6ce8\u610f\u529b\u5934\u5185\u90e8\u53d1\u751f\u7684\u4e8b\u60c5\u3002\u8003\u8651\u591a\u4e2a\u6ce8\u610f\u529b\u5934\u7684\u4e00\u79cd\u65b9\u6cd5\u662f\u8fd9\u6837\u7684\uff08\u5982\u679c\u6211\u4eec\u53ea\u60f3\u8c61\u5341\u4e8c\u4e2a\u6ce8\u610f\u529b\u5934\u4e2d\u7684\u4e09\u4e2a\uff09\uff1a</p> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#gpt-2-2-","title":"GPT-2 \u81ea\u6211\u5173\u6ce8\uff1a2- \u5f97\u5206","text":"<p>\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u7ee7\u7eed\u8bc4\u5206\u4e86\u2014\u2014\u6211\u4eec\u53ea\u770b\u4e00\u4e2a\u6ce8\u610f\u529b\u5934\uff08\u800c\u6240\u6709\u5176\u4ed6\u6ce8\u610f\u529b\u5934\u90fd\u5728\u8fdb\u884c\u7c7b\u4f3c\u7684\u64cd\u4f5c\uff09\uff1a</p> <p></p> <p>\u73b0\u5728\uff0ctoken \u53ef\u4ee5\u6839\u636e\u5176\u4ed6 token  \u7684\u6240\u6709\u952e\u8fdb\u884c\u8bc4\u5206\uff08\u5728\u4ee5\u524d\u7684\u8fed\u4ee3\u4e2d\uff0c\u8fd9\u4e9b\u952e\u662f\u5728 attention head #1 \u4e2d\u8ba1\u7b97\u7684\uff09\uff1a</p> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#gpt-2-3-","title":"GPT-2 \u81ea\u6211\u5173\u6ce8\uff1a3- \u603b\u548c","text":"<p>\u73b0\u5728\u5c06\u6bcf\u4e2a\u503c\u4e0e\u5176\u5206\u6570\u76f8\u4e58\uff0c\u7136\u540e\u5c06\u5b83\u4eec\u76f8\u52a0\uff0c\u4ece\u800c\u4ea7\u751f\u6ce8\u610f\u529b\u5934 #1 \u7684\u81ea\u6211\u6ce8\u610f\u7ed3\u679c\uff1a</p> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#gpt-2-35-","title":"GPT-2 \u81ea\u6211\u6ce8\u610f\u529b\uff1a3.5- \u5408\u5e76\u6ce8\u610f\u529b\u5934","text":"<p>\u6211\u4eec\u5904\u7406\u5404\u79cd\u6ce8\u610f\u529b\u5934\u7684\u65b9\u5f0f\u662f\uff0c\u6211\u4eec\u9996\u5148\u5c06\u5b83\u4eec\u8fde\u63a5\u6210\u4e00\u4e2a\u5411\u91cf\uff1a</p> <p></p> <p>\u4f46\u662f\u77e2\u91cf\u8fd8\u6ca1\u6709\u51c6\u5907\u597d\u53d1\u9001\u5230\u4e0b\u4e00\u4e2a\u5b50\u56fe\u5c42\u3002\u6211\u4eec\u9700\u8981\u9996\u5148\u628a\u8fd9\u4e2a\u5f17\u5170\u80af\u65af\u5766\u7684\u9690\u85cf\u72b6\u6001\u602a\u7269\u53d8\u6210\u4e00\u4e2a\u540c\u8d28\u7684\u8868\u793a\uff08turn this Frankenstein\u2019s-monster of hidden states into a homogenous representation\uff09\u3002</p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#gpt-2-4-","title":"GPT-2 \u81ea\u6211\u5173\u6ce8\uff1a4-\u6295\u5c04","text":"<p>\u6211\u4eec\u5c06\u8ba9\u6a21\u578b\u5b66\u4e60\u5982\u4f55\u6700\u597d\u5730\u5c06\u4e32\u8054\u7684\u81ea\u6211\u6ce8\u610f\u529b\u7ed3\u679c\u6620\u5c04\u5230\u524d\u9988\u795e\u7ecf\u7f51\u7edc\u53ef\u4ee5\u5904\u7406\u7684\u5411\u91cf\u4e2d\u3002\u8fd9\u662f\u6211\u4eec\u7684\u7b2c\u4e8c\u4e2a\u5927\u578b\u6743\u91cd\u77e9\u9635\uff0c\u5b83\u5c06\u6ce8\u610f\u529b\u5934\u7684\u7ed3\u679c\u6295\u5c04\u5230\u81ea\u6ce8\u610f\u529b\u5b50\u5c42\u7684\u8f93\u51fa\u5411\u91cf\u4e2d\uff1a</p> <p></p> <p>\u6709\u4e86\u8fd9\u4e2a\uff0c\u6211\u4eec\u5df2\u7ecf\u4ea7\u751f\u4e86\u53ef\u4ee5\u53d1\u9001\u5230\u4e0b\u4e00\u5c42\u7684\u5411\u91cf\uff1a</p> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#gpt-2-1","title":"GPT-2 \u5168\u8fde\u63a5\u795e\u7ecf\u7f51\u7edc\uff1a\u7b2c #1 \u5c42","text":"<p>\u5728\u5168\u8fde\u63a5\u795e\u7ecf\u7f51\u7edc\u4e2d\uff0c\u6a21\u5757\u5728\u81ea\u6211\u6ce8\u610f\u529b\u5728\u5176\u8868\u793a\u4e2d\u5305\u542b\u9002\u5f53\u7684\u4e0a\u4e0b\u6587\u540e\u5904\u7406\u5176\u8f93\u5165\u4ee4\u724c\u3002\u5b83\u7531\u4e24\u5c42\u7ec4\u6210\u3002\u7b2c\u4e00\u5c42\u7684\u5927\u5c0f\u662f\u6a21\u578b\u7684\u56db\u500d\uff08\u7531\u4e8e GPT2 \u5c0f\u662f 768\uff0c\u56e0\u6b64\u8be5\u7f51\u7edc\u5c06\u6709 768*4 = 3072 \u4e2a\u5355\u5143\uff09\u3002\u4e3a\u4ec0\u4e48\u662f\u56db\u6b21\uff1f\u8fd9\u53ea\u662f\u539f\u59cb\u53d8\u538b\u5668\u6eda\u52a8\u7684\u5c3a\u5bf8\uff08\u6a21\u578b\u5c3a\u5bf8\u4e3a 512\uff0c\u8be5\u6a21\u578b\u4e2d\u7684\u5c42 #1 \u4e3a 2048\uff09\u3002\u8fd9\u4f3c\u4e4e\u4e3aTransformer\u6a21\u578b\u63d0\u4f9b\u4e86\u8db3\u591f\u7684\u8868\u793a\u80fd\u529b\u6765\u5904\u7406\u8fc4\u4eca\u4e3a\u6b62\u629b\u7ed9\u5b83\u4eec\u7684\u4efb\u52a1\u3002</p> <p></p> <p>\uff08\u672a\u663e\u793a\uff1a\u504f\u7f6e\u5411\u91cf\uff09</p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#gpt-2-2-_1","title":"GPT-2 \u5168\u8fde\u63a5\u795e\u7ecf\u7f51\u7edc\uff1a\u7b2c #2 \u5c42 - \u6295\u5f71\u5230\u6a21\u578b\u7ef4\u5ea6","text":"<p>\u7b2c\u4e8c\u5c42\u5c06\u7b2c\u4e00\u5c42\u7684\u7ed3\u679c\u6295\u5c04\u56de\u6a21\u578b\u7ef4\u5ea6\uff08\u5c0f GPT2 \u4e3a 768\uff09\u3002\u6b64\u4e58\u6cd5\u7684\u7ed3\u679c\u662f\u6b64\u4ee4\u724c\u7684\u8f6c\u6362\u5668\u5757\u7684\u7ed3\u679c\u3002</p> <p></p> <p>\uff08\u672a\u663e\u793a\uff1a\u504f\u7f6e\u5411\u91cf\uff09</p> <p>\u8fd9\u662f\u6211\u4eec\u5c06\u8981\u4ecb\u7ecd\u7684 transformer block \u7684\u6700\u8be6\u7ec6\u7248\u672c\uff01\u73b0\u5728\uff0c\u60a8\u51e0\u4e4e\u5df2\u7ecf\u638c\u63e1\u4e86 Transformer \u8bed\u8a00\u6a21\u578b\u5185\u90e8\u53d1\u751f\u7684\u7edd\u5927\u591a\u6570\u60c5\u51b5\u3002\u56de\u987e\u4e00\u4e0b\uff0c\u6211\u4eec\u52c7\u6562\u7684\u8f93\u5165\u5411\u91cf\u9047\u5230\u4e86\u8fd9\u4e9b\u6743\u91cd\u77e9\u9635\uff1a</p> <p></p> <p>\u6bcf\u4e2a\u5757\u90fd\u6709\u81ea\u5df1\u7684\u4e00\u7ec4\u6743\u91cd\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u8be5\u6a21\u578b\u53ea\u6709\u4e00\u4e2a\u6807\u8bb0\u5d4c\u5165\u77e9\u9635\u548c\u4e00\u4e2a\u4f4d\u7f6e\u7f16\u7801\u77e9\u9635\uff1a</p> <p></p> <p>\u5982\u679c\u4f60\u60f3\u67e5\u770b\u6a21\u578b\u7684\u6240\u6709\u53c2\u6570\uff0c\u90a3\u4e48\u6211\u5728\u8fd9\u91cc\u7edf\u8ba1\u4e86\u5b83\u4eec\uff1a</p> <p></p> <p>\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\uff0c\u5b83\u4eec\u52a0\u8d77\u6765\u7684\u53c2\u6570\u6700\u591a\u662f 124M\uff0c\u800c\u4e0d\u662f 117M\u3002\u6211\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\uff0c\u4f46\u8fd9\u5c31\u662f\u5b83\u4eec\u4e2d\u4f3c\u4e4e\u6709\u591a\u5c11\u5728\u5df2\u53d1\u5e03\u7684\u4ee3\u7801\u4e2d\uff08\u5982\u679c\u6211\u9519\u4e86\uff0c\u8bf7\u7ea0\u6b63\u6211\uff09\u3002</p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#3","title":"\u7b2c 3 \u90e8\u5206\uff1a\u8d85\u8d8a\u8bed\u8a00\u5efa\u6a21","text":"<p>\u4ec5\u89e3\u7801\u5668\u8f6c\u6362\u5668\u4e0d\u65ad\u663e\u793a\u51fa\u8d85\u8d8a\u8bed\u8a00\u5efa\u6a21\u7684\u524d\u666f\u3002\u5728\u5f88\u591a\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u5b83\u5df2\u7ecf\u53d6\u5f97\u4e86\u6210\u529f\uff0c\u8fd9\u53ef\u4ee5\u901a\u8fc7\u4e0e\u4e0a\u8ff0\u7c7b\u4f3c\u7684\u89c6\u89c9\u6548\u679c\u6765\u63cf\u8ff0\u3002\u8ba9\u6211\u4eec\u901a\u8fc7\u67e5\u770b\u5176\u4e2d\u4e00\u4e9b\u5e94\u7528\u7a0b\u5e8f\u6765\u7ed3\u675f\u8fd9\u7bc7\u6587\u7ae0\u3002</p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#_8","title":"\u673a\u5668\u7ffb\u8bd1","text":"<p>\u8fdb\u884c\u7ffb\u8bd1\u4e0d\u9700\u8981\u7f16\u7801\u5668\u3002\u4ec5\u89e3\u7801\u5668\u8f6c\u6362\u5668\u53ef\u4ee5\u89e3\u51b3\u76f8\u540c\u7684\u4efb\u52a1\uff1a</p> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#summarization","title":"Summarization \u7efc\u8ff0","text":"<p>\u8fd9\u662f\u7b2c\u4e00\u4e2a\u4ec5\u4f7f\u7528\u89e3\u7801\u5668\u7684\u8f6c\u6362\u5668\u6240\u8bad\u7ec3\u7684\u4efb\u52a1\u3002\u5b83\u88ab\u8bad\u7ec3\u9605\u8bfb\u7ef4\u57fa\u767e\u79d1\u6587\u7ae0\uff08\u76ee\u5f55\u524d\u6ca1\u6709\u5f00\u5934\u90e8\u5206\uff09\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u603b\u7ed3\u3002\u6587\u7ae0\u7684\u5b9e\u9645\u5f00\u5934\u90e8\u5206\u88ab\u7528\u4f5c\u8bad\u7ec3\u6570\u636e\u4e2d\u7684\u6807\u7b7e\uff1a</p> <p></p> <p>\u8fd9\u7bc7\u8bba\u6587\u9488\u5bf9\u7ef4\u57fa\u767e\u79d1\u7684\u6587\u7ae0\u8bad\u7ec3\u4e86\u6a21\u578b\uff0c\u56e0\u6b64\u8bad\u7ec3\u540e\u7684\u6a21\u578b\u80fd\u591f\u603b\u7ed3\u6587\u7ae0\uff1a</p> <p></p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#_9","title":"\u8fc1\u79fb\u5b66\u4e60","text":"<p>\u5728\u4f7f\u7528\u5355\u4e2a\u9884\u8bad\u7ec3\u8f6c\u6362\u5668\u7684\u793a\u4f8b\u9ad8\u6548\u6587\u672c\u6458\u8981\u4e2d\uff0c\u4ec5\u89e3\u7801\u5668\u8f6c\u6362\u5668\u9996\u5148\u5728\u8bed\u8a00\u5efa\u6a21\u65b9\u9762\u8fdb\u884c\u9884\u8bad\u7ec3\uff0c\u7136\u540e\u8fdb\u884c\u5fae\u8c03\u4ee5\u8fdb\u884c\u6458\u8981\u3002\u4e8b\u5b9e\u8bc1\u660e\uff0c\u5728\u6709\u9650\u7684\u6570\u636e\u8bbe\u7f6e\u4e2d\uff0c\u5b83\u6bd4\u9884\u8bad\u7ec3\u7684\u7f16\u7801\u5668-\u89e3\u7801\u5668\u8f6c\u6362\u5668\u83b7\u5f97\u66f4\u597d\u7684\u7ed3\u679c\u3002</p> <p>GPT2 \u8bba\u6587\u8fd8\u663e\u793a\u4e86\u5728\u8bed\u8a00\u5efa\u6a21\u4e0a\u9884\u8bad\u7ec3\u6a21\u578b\u540e\u7684\u603b\u7ed3\u7ed3\u679c\u3002</p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#_10","title":"\u97f3\u4e50\u751f\u6210","text":"<p>Music Transformer \u4f7f\u7528\u4ec5\u89e3\u7801\u5668\u8f6c\u6362\u5668\u6765\u751f\u6210\u5177\u6709\u8868\u73b0\u529b\u7684\u65f6\u5e8f\u548c\u52a8\u6001\u7684\u97f3\u4e50\u3002</p> <ul> <li>\u201c\u97f3\u4e50\u5efa\u6a21\u201d\u5c31\u50cf\u8bed\u8a00\u5efa\u6a21\u4e00\u6837\u2014\u2014\u53ea\u662f\u8ba9\u6a21\u578b\u4ee5\u65e0\u76d1\u7763\u7684\u65b9\u5f0f\u5b66\u4e60\u97f3\u4e50\uff0c\u7136\u540e\u8ba9\u5b83\u5bf9\u8f93\u51fa\u8fdb\u884c\u91c7\u6837\uff08\u6211\u4eec\u4e4b\u524d\u79f0\u4e4b\u4e3a\u201c\u6f2b\u65e0\u8fb9\u9645\u201d\uff09\u3002</li> </ul> <p>\u5728\u97f3\u4e50\u8868\u6f14\u4e2d\uff08\u73b0\u5728\u8ba9\u6211\u4eec\u8003\u8651\u4e00\u4e0b\u94a2\u7434\uff09\uff0c\u6211\u4eec\u5fc5\u987b\u8868\u73b0\u97f3\u7b26\uff0c\u4f46\u4e5f\u8981\u8868\u73b0\u901f\u5ea6\u2014\u2014\u8861\u91cf\u94a2\u7434\u952e\u7684\u529b\u5ea6\u3002</p> <p></p> <p>A performance is just a series of these one-hot vectors. </p> <p>MIDI\u6587\u4ef6\u53ef\u4ee5\u8f6c\u6362\u6210\u8fd9\u6837\u7684\u683c\u5f0f\u3002\u672c\u6587\u5305\u542b\u4ee5\u4e0b\u793a\u4f8b\u8f93\u5165\u5e8f\u5217\uff1a</p> <p></p> <p>\u6b64\u8f93\u5165\u5e8f\u5217\u7684\u5355\u70ed\u5411\u91cf\u8868\u793a\u5f62\u5f0f\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u6211\u559c\u6b22\u8bba\u6587\u4e0a\u7684\u89c6\u89c9\u5c55\u793a\uff0c\u663e\u793a\u4e86 Music Transformer \u7684\u81ea\u6211\u6ce8\u610f\u529b\u3002\u6211\u5728\u8fd9\u91cc\u6dfb\u52a0\u4e86\u4e00\u4e9b\u6ce8\u91ca\uff1a</p> <p></p> <p>\u56fe 8\uff1a\u8fd9\u4ef6\u4f5c\u54c1\u6709\u4e00\u4e2a\u53cd\u590d\u51fa\u73b0\u7684\u4e09\u89d2\u5f62\u8f6e\u5ed3\u3002\u67e5\u8be2\u4f4d\u4e8e\u540e\u9762\u7684\u4e00\u4e2a\u9ad8\u5cf0\uff0c\u5b83\u5173\u6ce8\u4e86\u9ad8\u5cf0\u4e0a\u7684\u6240\u6709\u5148\u524d\u9ad8\u97f3\uff0c\u4e00\u76f4\u5230\u4e50\u66f2\u7684\u5f00\u5934\u3002\u201c\u8be5\u56fe\u663e\u793a\u4e86\u4e00\u4e2a\u67e5\u8be2\uff08\u6240\u6709\u6ce8\u610f\u529b\u7ebf\u7684\u6765\u6e90\uff09\u548c\u4ee5\u524d\u88ab\u5173\u6ce8\u7684\u8bb0\u5fc6\uff08\u5728\u4e2d\u7a81\u51fa\u663e\u793a\u4e86\u63a5\u6536\u66f4\u591asoftmax\u6982\u7387\u7684\u7b14\u8bb0\uff09\u3002\u6ce8\u610f\u7ebf\u7684\u989c\u8272\u5bf9\u5e94\u4e8e\u4e0d\u540c\u7684\u5934\u90e8\uff0c\u5bbd\u5ea6\u5bf9\u5e94\u4e8esoftmax\u6982\u7387\u7684\u6743\u91cd\u3002</p> <p>\u5982\u679c\u60a8\u4e0d\u6e05\u695a\u97f3\u7b26\u7684\u8fd9\u79cd\u8868\u793a\u5f62\u5f0f\uff0c\u8bf7\u89c2\u770b\u6b64\u89c6\u9891\u3002</p>"},{"location":"machine_learning/deep_learning/gpt2_illustrated.html#conclusion","title":"Conclusion \u7ed3\u8bba","text":"<p>\u6211\u4eec\u8fdb\u5165 GPT2 \u7684\u65c5\u7a0b\u5230\u6b64\u7ed3\u675f\uff0c\u4ee5\u53ca\u6211\u4eec\u5bf9\u5b83\u7684\u7236\u6a21\u578b\u2014\u2014\u4ec5\u89e3\u7801\u5668\u8f6c\u6362\u5668\u7684\u63a2\u7d22\u3002</p>"},{"location":"machine_learning/deep_learning/transformer.html","title":"Transformer","text":""},{"location":"machine_learning/deep_learning/transformer.html#self-attention","title":"self-attention\u6a21\u578b","text":"<p>sequence-to-sequence \u8fd0\u7b97\uff1a \u8f93\u5165\u4e00\u4e2a\u5411\u91cf\u5e8f\u5217\uff08a sequence of vectors\uff09\uff0c\u8f93\u51fa\u53e6\u4e00\u4e2a\u5411\u91cf\u5e8f\u5217</p> <p></p> <p>self-attention \u672c\u8eab\u662f\u4e0d\u5173\u5fc3\u8f93\u5165\u7684\u987a\u5e8f\u5c5e\u6027\u7684</p>"},{"location":"machine_learning/deep_learning/transformer.html#_1","title":"\u57fa\u7840\u7248\u5b9e\u73b0","text":"<p>\u6700\u57fa\u7840\u7684 self-attention \u6a21\u578b\u7684\u5b9e\u73b0\uff1a \u4e24\u6b21\u77e9\u9635\u4e58\u6cd5\u548c\u4e00\u6b21\u5f52\u4e00\u5316\uff08softmax\uff09\u3002</p> <ul> <li>\u8f93\u5165 X \u7531 t \u4e2a k-\u7ef4 vector \u7ec4\u6210\u7684\u5e8f\u5217\uff0c</li> <li>\u5f15\u5165\u4e00\u4e2a minibatch dimension b\uff0c</li> </ul> <p>\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a\u4e09\u7ef4\u77e9\u9635 <code>(b,t,k)</code>\uff0c\u8fd9\u5c31\u662f\u4e00\u4e2a tensor\u3002</p> <ul> <li>\u8f93\u51fa\u77e9\u9635 Y \u5c31\u662f size <code>(b, t, k)</code> \u7684 tensor\uff0c\u6bcf\u4e00\u884c\u90fd\u662f\u5bf9 \ud835\udc17 \u7684\u884c\u7684\u52a0\u6743\u3002</li> </ul> <pre><code>import torch\nimport torch.nn.functional as F\n\n# \u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e9b tensor x \u4f5c\u4e3a\u8f93\u5165\uff0c\u5b83\u662f (b, t, k) \u7ef4\u77e9\u9635\nx = ...\n\n# torch.bmm() \u662f\u6279\u91cf\u77e9\u9635\u4e58\u6cd5\uff08batched matrix multiplication\uff09\u51fd\u6570\uff0c\u5bf9\u4e00\u6279\u77e9\u9635\u6267\u884c\u4e58\u6cd5\u64cd\u4f5c\nraw_weights = torch.bmm(x, x.transpose(1, 2))\nweights = F.softmax(raw_weights, dim=2)\ny = torch.bmm(weights, x)\n</code></pre>"},{"location":"machine_learning/deep_learning/transformer.html#transformer-self-attention","title":"\u73b0\u4ee3 transformer \u5bf9 self-attention \u7684\u6269\u5c55","text":""},{"location":"machine_learning/framework/index.html","title":"AI\u8ba1\u7b97\u6846\u67b6","text":""},{"location":"machine_learning/framework/index.html#_1","title":"\u56fd\u4ea7","text":"<p>\u6e05\u534e\u5f00\u6e90\uff1aJitto</p> <p>\u767e\u5ea6\u5f00\u6e90\uff1aPaddlePaddle</p> <p>\u534e\u4e3a\u5f00\u6e90\uff1aMindSpore</p> <p>\u65f7\u89c6\u5f00\u6e90\uff1aMegEngine</p>"},{"location":"machine_learning/framework/index.html#_2","title":"\u56fd\u5916","text":"<p>fastai</p> <p>horovod</p> <p>tensorflow</p> <p>pytorch</p> <p>mxnet</p>"},{"location":"machine_learning/framework/deepspeed.html","title":"DeepSpeed","text":""},{"location":"machine_learning/framework/deepspeed.html#zero","title":"ZeRO","text":"<p>Zero Redundancy Optimizer</p> <p>ZeRO-offload\uff1adelegate some computations and memory to the host\u2019s CPU and RAM</p> <ul> <li><code>partitioning instead of replicating</code>\uff0c\u5212\u5206\u800c\u4e0d\u662f\u590d\u5236</li> </ul> <p>\u628a\u53c2\u6570\u5360\u7528\uff0c\u903b\u8f91\u4e0a\u5206\u6210\u4e09\u79cd\u7c7b\u578b\u3002\u5c06\u8fd9\u4e9b\u7c7b\u578b\u7684\u53c2\u6570\u5212\u5206\uff1a</p> <ul> <li><code>optimizer states</code>\uff1a\u5373\u4f18\u5316\u5668\u7684\u53c2\u6570\u72b6\u6001\u3002\u4f8b\u5982\uff0cAdam\u7684\u52a8\u91cf\u53c2\u6570\u3002</li> <li><code>gradients</code>\uff1a\u68af\u5ea6\u7f13\u5b58\uff0c\u5bf9\u5e94\u4e8eoptimizer\u3002</li> <li><code>parameters</code>\uff1a\u6a21\u578b\u53c2\u6570\u3002</li> </ul> <p>DeepSpeed\u7684ZeRO config\u6587\u4ef6\u5c31\u53ef\u4ee5\u5206\u4e3a\u5982\u4e0b\u51e0\u7c7b\uff1a</p> <ul> <li>ZeRO Stage 1\uff1a\u5212\u5206<code>optimizer states</code>\u3002\u4f18\u5316\u5668\u53c2\u6570\u88ab\u5212\u5206\u5230\u591a\u4e2amemory\u4e0a\uff0c\u6bcf\u4e2amomoey\u4e0a\u7684\u8fdb\u7a0b\u53ea\u8d1f\u8d23\u66f4\u65b0\u5b83\u81ea\u5df1\u90a3\u90e8\u5206\u53c2\u6570\u3002</li> <li>ZeRO Stage 2\uff1a\u5212\u5206<code>gradient</code>\u3002\u6bcf\u4e2amemory\uff0c\u53ea\u4fdd\u7559\u5b83\u5206\u914d\u5230\u7684optimizer state\u6240\u5bf9\u5e94\u7684\u68af\u5ea6\u3002\u8fd9\u5f88\u5408\u7406\uff0c\u56e0\u4e3a\u68af\u5ea6\u548coptimizer\u662f\u7d27\u5bc6\u8054\u7cfb\u5728\u4e00\u8d77\u7684\u3002\u53ea\u77e5\u9053\u68af\u5ea6\uff0c\u4e0d\u77e5\u9053optimizer state\uff0c\u662f\u6ca1\u6709\u529e\u6cd5\u4f18\u5316\u6a21\u578b\u53c2\u6570\u7684\u3002</li> <li>ZeRO Stage 3\uff1a\u5212\u5206\u6a21\u578b\u53c2\u6570\uff0c\u6216\u8005\u8bf4\uff0c\u4e0d\u540c\u7684layer. ZeRO-3\u4f1a\u5728forward\u548cbackward\u7684\u65f6\u5019\uff0c\u81ea\u52a8\u5c06\u6a21\u578b\u53c2\u6570\u5206\u914d\u5230\u591a\u4e2amemory\u3002</li> </ul> <p>ZeRO-1 \u53ea\u5206\u914d optimizer states(\u53c2\u6570\u91cf\u5f88\u5c0f)\uff0c\u5b9e\u9645\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u4e00\u822c\u53ea\u4f1a\u8003\u8651<code>ZeRO-2</code>\u548c<code>ZeRO-3</code>\u3002</p>"},{"location":"machine_learning/framework/deepspeed.html#_1","title":"\u5e76\u884c\u7b56\u7565","text":"<p>\u501f\u7528\u82f1\u4f1f\u8fbe\u7684 Megatron-LM \u6765\u4e3a\u57fa\u4e8e Transformer \u7684\u8bed\u8a00\u6a21\u578b\u63d0\u4f9b\u5927\u89c4\u6a21\u6a21\u578b\u5e76\u884c\u529f\u80fd\u3002</p> <ul> <li>32 \u4e2a worker \u8fdb\u884c 3D \u5e76\u884c\u7684\u4f8b\u5b50\u3002\u795e\u7ecf\u7f51\u7edc\u7684\u5404\u5c42\u5206\u4e3a\u56db\u4e2a\u6d41\u6c34\u7ebf\u9636\u6bb5\u3002\u6bcf\u4e2a\u6d41\u6c34\u7ebf\u9636\u6bb5\u4e2d\u7684\u5c42\u5728\u56db\u4e2a\u6a21\u578b\u5e76\u884c worker \u4e4b\u95f4\u8fdb\u4e00\u6b65\u5212\u5206\u3002\u6700\u540e\uff0c\u6bcf\u4e2a\u6d41\u6c34\u7ebf\u9636\u6bb5\u6709\u4e24\u4e2a\u6570\u636e\u5e76\u884c\u5b9e\u4f8b\uff0c\u4e14 ZeRO \u5728\u8fd9 2 \u4e2a\u526f\u672c\u4e4b\u95f4\u5212\u5206\u4f18\u5316\u5668\u72b6\u6001\u91cf\u3002</li> </ul> <p></p> <p>\u5f69\u8272\u5757\u663e\u793a\u4e0a\u56fe \u4e2d\u7684 worker \u5230\u516b\u4e2a\u8282\u70b9\uff08\u6bcf\u4e2a\u8282\u70b9\u6709\u56db\u4e2a GPU\uff09\u7684\u7cfb\u7edf\u4e0a\u7684 GPU \u7684\u6620\u5c04\u3002\u540c\u4e00\u989c\u8272\u7684 GPU \u5728\u540c\u4e00\u8282\u70b9\u4e0a\u3002</p> <p></p> <p>zero \u53ef\u4ee5\u8ba4\u4e3a\u7406\u89e3\u6210\u6570\u636e\u5e76\u884c\uff0c\u4e0d\u8fc7\u662f\u628a\u53c2\u6570sharding\u5230\u591a\u4e2a\u8bbe\u5907\u4e0a\u53bb\uff0c\u5f53\u9700\u8981\u5b8c\u6574\u53c2\u6570\u65f6\uff0c\u518d\u4ece\u5176\u5b83\u8bbe\u5907\u53d6\u8fc7\u6765\u3002\u548c tensor model parallelism \u4e0d\u4e00\u6837</p>"},{"location":"machine_learning/framework/distributed.html","title":"\u6982\u5ff5","text":"<p>\u5e38\u89c1\u7684\u5206\u5e03\u5f0f\u5e76\u884c\u7b56\u7565 - OneFlow</p> <p>\u50cfCNN\u8fd9\u7c7b\u5927\u6570\u636e\u3001\u5c0f\u6a21\u578b\u7684\u795e\u7ecf\u7f51\u7edc\u5c42\u6b21\u6700\u597d\u7528\u6570\u636e\u5e76\u884c\uff0c\u5bf9\u8d85\u5927\u7684\u5168\u8fde\u63a5\u5c42\u8fd9\u79cd\u6a21\u578b\u66f4\u5927\u7684\u5c42\u6b21\u6700\u597d\u7528\u6a21\u578b\u5e76\u884c\uff0c\u5bf9\u4e8efeature map\u8d85\u5927\u6216\u8005\u5c42\u6b21\u8d85\u6df1\u7684\u795e\u7ecf\u7f51\u7edc\u66f4\u9002\u5408\u6d41\u6c34\u5e76\u884c\u3002</p>"},{"location":"machine_learning/framework/distributed.html#_2","title":"\u6570\u636e\u5e76\u884c","text":"<p>\u6bcf\u4e00\u4e2a\u8282\u70b9\uff08\u6216\u8005\u53eb\u8fdb\u7a0b\uff09\u90fd\u6709\u4e00\u4efd\u6a21\u578b\uff0c\u7136\u540e\u5404\u4e2a\u8282\u70b9\u53d6\u4e0d\u540c\u7684\u6570\u636e\uff0c\u901a\u5e38\u662f\u4e00\u4e2abatch_size\uff0c\u7136\u540e\u5404\u81ea\u5b8c\u6210\u524d\u5411\u548c\u540e\u5411\u7684\u8ba1\u7b97\u5f97\u5230\u68af\u5ea6\u3002</p> <ul> <li>\u6570\u636e\u5e76\u884c\u7684 batch \u5927\u5c0f\u968f worker \u6570\u91cf\u63d0\u9ad8\uff0c\u5f80\u5f80\u65e0\u6cd5\u5728\u4e0d\u5f71\u54cd\u6536\u655b\u6027\u7684\u60c5\u51b5\u4e0b\u4e00\u76f4\u589e\u52a0 batch \u5927\u5c0f\uff1b</li> <li>worker \u4e4b\u95f4\u89c4\u7ea6\u68af\u5ea6\u7684\u901a\u4fe1\u5f00\u9500\u8ddf\u6a21\u578b\u5927\u5c0f\u6210\u6b63\u76f8\u5173\uff0c\u5f53\u6a21\u578b\u5f88\u5927\u6216\u901a\u4fe1\u5e26\u5bbd\u5f88\u4f4e\u65f6\uff0c\u8ba1\u7b97\u6548\u7387\u4f1a\u53d7\u9650\uff1b</li> </ul>"},{"location":"machine_learning/framework/distributed.html#ps","title":"PS","text":"<p>\u6570\u636e\u5e76\u884c\u7531\u4e8e\u4e0d\u9700\u8981\u62c6\u5206\u6a21\u578b\u5728\u5b9e\u8df5\u4e2d\u66f4\u52a0\u5e38\u7528\u3002</p> <p>\u7b2c\u4e00\u4ee3\u6570\u636e\u5e76\u884c\u5206\u5e03\u5f0f\u8bad\u7ec3\u7531\u53c2\u6570\u670d\u52a1\u5668\uff08Parameter Server\uff09\u67b6\u6784\u4e3b\u5bfc\u3002 \u5728\u53c2\u6570\u670d\u52a1\u5668\u67b6\u6784\u4e2d\uff0c\u4e00\u4e2a\u6216\u591a\u4e2a\u53c2\u6570\u670d\u52a1\u5668\u4fdd\u5b58\u5f53\u524d\u6a21\u578b\uff0c\u5e76\u5728\u6bcf\u4e2a\u8fed\u4ee3\u4e2d\u5bf9\u4e00\u7ec4\u5de5\u4f5c\u8282\u70b9\u7684\u53c2\u6570\u6216\u68af\u5ea6\u8fdb\u884c\u540c\u6b65\u3002</p> <p></p> <p>\u67b6\u6784\u7684\u95ee\u9898\u662f\u53c2\u6570\u670d\u52a1\u5668\u548c\u5de5\u4f5c\u8282\u70b9\u4e4b\u95f4\u7684\u7f51\u7edc\u8fde\u63a5\u6210\u4e3a\u74f6\u9888\u3002\u5f53\u53c2\u6570\u670d\u52a1\u5668\u7684\u5e26\u5bbd\u6210\u4e3a\u74f6\u9888\u65f6\uff0c\u5de5\u4f5c\u8282\u70b9\u65e0\u6cd5\u5229\u7528\u81ea\u5df1\u7684\u5168\u90e8\u5e26\u5bbd\uff0c \u5f53GPU\u4e4b\u95f4\u7684\u6743\u503c\u66f4\u65b0\u901a\u4fe1\u6240\u9700\u7684\u65f6\u95f4\u7ebf\u6027\u589e\u957f\u65f6\uff0c\u7f51\u7edcI/O\u5f88\u5feb\u5c31\u4f1a\u6210\u4e3a\u963b\u6b62\u8bad\u7ec3\u8fdb\u4e00\u6b65\u6269\u5c55\u7684\u74f6\u9888\uff0c\u51cf\u6162\u4e86\u8bad\u7ec3\u901f\u5ea6\u3002</p> <p>\u8fd9\u4e2a\u95ee\u9898\u4fc3\u4f7f\u4e86Ring  All Reduce\u5206\u5e03\u5f0f\u8bad\u7ec3\u67b6\u6784\u7684\u4ea7\u751f\u3002</p>"},{"location":"machine_learning/framework/distributed.html#ring-allreduce","title":"Ring-AllReduce","text":"<p>\u6570\u636e\u4f20\u8f93\u91cf= 2 ( N \u2212 1) K / N</p> <ul> <li>K : \u53c2\u6570\u4e2a\u6570</li> <li>N : GPU\u4e2a\u6570</li> </ul> <p></p>"},{"location":"machine_learning/framework/distributed.html#_3","title":"\u6a21\u578b\u5e76\u884c","text":""},{"location":"machine_learning/framework/distributed.html#_4","title":"\u5f20\u91cf\u5e76\u884c","text":"<p>\u5f20\u91cf\u5e76\u884c\u662f\u5728\u4e00\u4e2a\u64cd\u4f5c\u4e2d\u8fdb\u884c\u5e76\u884c\u8ba1\u7b97\uff0c\u5982\u77e9\u9635-\u77e9\u9635\u4e58\u6cd5\u3002 \u6d41\u6c34\u7ebf\u5e76\u884c\u662f\u5728\u5404\u5c42\u4e4b\u95f4\u8fdb\u884c\u5e76\u884c\u8ba1\u7b97\u3002</p> <p>\u5f53\u6a21\u578b\u5de8\u5927\uff0c\u5355\u673a\u5185\u5b58\u4e0d\u8db3\u7684\u65f6\u5019\uff0c\u5c06\u8ba1\u7b97\u5de5\u4f5c partition\uff0c\u540c\u4e00\u4e2a\u5927\u6a21\u578b\u7684\u4e0d\u540c\u90e8\u5206\u4ea4\u7ed9\u4e0d\u540c\u673a\u5668\u8d1f\u8d23\uff08\u6bd4\u5982\u591a\u5c42\u7f51\u7edc\u7684\u5404\u4e2a\u8282\u70b9\uff09</p> <p></p>"},{"location":"machine_learning/framework/distributed.html#_5","title":"\u6d41\u6c34\u7ebf\u5e76\u884c","text":"<p>\u6d41\u6c34\u7ebf\u5e76\u884c\u7684\u6838\u5fc3\u601d\u60f3\u662f\uff1a\u5728\u6a21\u578b\u5e76\u884c\u7684\u57fa\u7840\u4e0a\uff0c\u8fdb\u4e00\u6b65\u5f15\u5165\u6570\u636e\u5e76\u884c\u7684\u529e\u6cd5\uff0c\u5373\u628a\u539f\u5148\u7684\u6570\u636e\u518d\u5212\u5206\u6210\u82e5\u5e72\u4e2abatch\uff0c\u9001\u5165GPU\u8fdb\u884c\u8bad\u7ec3\u3002\u672a\u5212\u5206\u524d\u7684\u6570\u636e\uff0c\u53ebmini-batch\u3002\u5728mini-batch\u4e0a\u518d\u5212\u5206\u7684\u6570\u636e\uff0c\u53ebmicro-batch\u3002</p> <p>\u5f53\u795e\u7ecf\u7f51\u7edc\u8fc7\u4e8e\u5de8\u5927\uff0c\u65e0\u6cd5\u5728\u4e00\u4e2a\u8bbe\u5907\u4e0a\u5b58\u653e\u65f6\uff0c\u9664\u4e86\u4e0a\u8ff0\u7684\u6a21\u578b\u5e76\u884c\u7684\u7b56\u7565\u5916\uff0c\u8fd8\u53ef\u4ee5\u9009\u62e9\u6d41\u6c34\u5e76\u884c\u3002 \u6d41\u6c34\u5e76\u884c\u6307\u5c06\u7f51\u7edc\u5207\u4e3a\u591a\u4e2a\u9636\u6bb5\uff0c\u5e76\u5206\u53d1\u5230\u4e0d\u540c\u7684\u8ba1\u7b97\u8bbe\u5907\u4e0a\uff0c\u5404\u4e2a\u8ba1\u7b97\u8bbe\u5907\u4e4b\u95f4\u4ee5\u201c\u63a5\u529b\u201d\u7684\u65b9\u5f0f\u5b8c\u6210\u8bad\u7ec3\u3002</p> <p>\u4e0b\u56fe\uff0c\u5c55\u793a\u4e86\u4e00\u4e2a\u903b\u8f91\u4e0a\u76844\u5c42\u7f51\u7edc\uff08<code>T1</code> \u81f3 <code>T4</code>)\u662f\u5982\u4f55\u505a\u6d41\u6c34\u5e76\u884c\u7684\u3002</p> <p>4\u5c42\u7f51\u7edc\u88ab\u5207\u5206\u52302\u4e2a\u8ba1\u7b97\u8bbe\u5907\u4e0a\uff0c\u5176\u4e2d <code>GPU0</code> \u4e0a\u8fdb\u884c <code>T1</code> \u4e0e <code>T2</code> \u7684\u8fd0\u7b97\uff0c<code>GPU1</code> \u4e0a\u8fdb\u884c <code>T3</code> \u4e0e <code>T4</code> \u7684\u8ba1\u7b97\u3002</p> <p><code>GPU0</code> \u4e0a\u5b8c\u6210\u524d\u4e24\u5c42\u7684\u8ba1\u7b97\u540e\uff0c\u5b83\u7684\u8f93\u51fa\u88ab\u5f53\u4f5c <code>GPU1</code> \u7684\u8f93\u5165\uff0c\u7ee7\u7eed\u8fdb\u884c\u540e\u4e24\u5c42\u7684\u8ba1\u7b97\u3002</p> <p></p>"},{"location":"machine_learning/framework/distributed.html#_6","title":"\u6df7\u5408\u5e76\u884c","text":"<p>\u7f51\u7edc\u7684\u8bad\u7ec3\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5c06\u591a\u79cd\u5e76\u884c\u7b56\u7565\u6df7\u7528\uff0c\u4ee5 GPT-3 \u4e3a\u4f8b\uff0c\u4ee5\u4e0b\u662f\u5b83\u8bad\u7ec3\u65f6\u7684\u8bbe\u5907\u5e76\u884c\u65b9\u6848\uff1a</p> <ul> <li>\u9996\u5148\u88ab\u5206\u4e3a 64 \u4e2a\u9636\u6bb5\uff0c\u8fdb\u884c\u6d41\u6c34\u5e76\u884c\uff0c\u6bcf\u4e2a\u9636\u6bb5\u90fd\u8fd0\u884c\u5728 6 \u53f0 \u4e3b\u673a\u4e0a\uff0c\u5171 384 \u53f0\u673a\u5668\u3002</li> <li>\u57286\u53f0\u4e3b\u673a\u4e4b\u95f4\uff0c\u8fdb\u884c\u7684\u662f\u6570\u636e\u5e76\u884c\u8bad\u7ec3\uff1b</li> <li>\u6bcf\u53f0\u4e3b\u673a\u6709 8 \u5f20 GPU \u663e\u5361\uff0c\u540c\u4e00\u53f0\u673a\u5668\u4e0a\u76848\u5f20 GPU \u663e\u5361\u4e4b\u95f4\u662f\u8fdb\u884c\u6a21\u578b\u5e76\u884c\u8bad\u7ec3\u3002</li> </ul> <p></p>"},{"location":"machine_learning/framework/petastorm.html","title":"PetaStorm","text":"<p>Petastorm library enables single machine or distributed training and evaluation of deep learning models from datasets in Apache Parquet format. It supports ML frameworks such as Tensorflow, Pytorch, and PySpark and can be used from pure Python code.</p> <p>\u6df1\u5ea6\u5b66\u4e60/\u673a\u5668\u5b66\u4e60\u6846\u67b6\uff0c\u53ef\u4ee5\u8bfb\u53d6Parquet\u683c\u5f0f\u7684\u6570\u636e\u3002</p> <p>Petastorm\u4f7f\u7528 PyArrow \u5e93\u8bfb\u53d6Parquet\u6587\u4ef6</p> <p></p> <p></p>"},{"location":"machine_learning/framework/petastorm.html#_1","title":"\u751f\u6210\u6570\u636e\u96c6","text":"<p>\u5b9a\u4e49\u4e00\u4e2a\u6570\u636e\u6a21\u5f0f\uff0c\u79f0\u4e3aUnischema\uff0cPetastorm\u4f1a\u5c06\u5176\u8f6c\u6362\u4e3a\u6240\u6709\u53d7\u652f\u6301\u7684\u6846\u67b6\u683c\u5f0f\uff0c\u4f8b\u5982PySpark\uff0cTensorflow\u548c\u7eafPython\u3002</p> <ul> <li>\u5fc5\u9700\u7684\u5b57\u6bb5\u5c5e\u6027\u5305\u62ec\uff1a\u5b57\u6bb5\u540d\u79f0\uff0c\u6570\u636e\u7c7b\u578b\uff08\u7531NumPy\u6570\u636e\u7c7b\u578b\u8868\u793a\uff09\uff0c\u591a\u7ef4\u6570\u7ec4\u5f62\u72b6\uff0c\u7528\u4e8e\u6570\u636e\u7f16\u7801/\u89e3\u7801\u7684\u7f16\u89e3\u7801\u5668\u4ee5\u53ca\u5b57\u6bb5\u662f\u5426\u53ef\u4e3a\u7a7a\u3002</li> </ul> <pre><code>import numpy as np\nfrom petastorm.codecs import CompressedImageCodec, NdarrayCodec, ScalarCodec\nfrom petastorm.etl.dataset_metadata import materialize_dataset\nfrom petastorm.unischema import Unischema, UnischemaField, dict_to_spark_row\nfrom pyspark.sql import SparkSession\nfrom pyspark.sql.types import IntegerType\n\n\nHelloWorldSchema = Unischema('HelloWorldSchema', [\n   UnischemaField('id', np.int32, (), ScalarCodec(IntegerType()), False),\n   UnischemaField('image1', np.uint8, (128, 256, 3), CompressedImageCodec('png'), False),\n   UnischemaField('other_data', np.uint8, (None, 128, 30, None), NdarrayCodec(), False),\n])\n\n\ndef row_generator(x):\n   \"\"\"Returns a single entry in the generated dataset. Return a bunch of random values as an example.\"\"\"\n   return {'id': x,\n           'image1': np.random.randint(0, 255, dtype=np.uint8, size=(128, 256, 3)),\n           'other_data': np.random.randint(0, 255, dtype=np.uint8, size=(4, 128, 30, 3))}\n\n\ndef generate_hello_world_dataset(output_url='file:///tmp/hello_world_dataset'):\n   rows_count = 10\n   rowgroup_size_mb = 256\n\n   spark = SparkSession.builder.config('spark.driver.memory', '2g').master('local[2]').getOrCreate()\n   sc = spark.sparkContext\n\n   # Wrap dataset materialization portion. Will take care of setting up spark environment variables as\n   # well as save petastorm specific metadata\n   with materialize_dataset(spark, output_url, HelloWorldSchema, rowgroup_size_mb):\n\n       rows_rdd = sc.parallelize(range(rows_count))\\\n           .map(row_generator)\\\n           .map(lambda x: dict_to_spark_row(HelloWorldSchema, x))\n\n       spark.createDataFrame(rows_rdd, HelloWorldSchema.as_spark_schema()) \\\n           .coalesce(10) \\\n           .write \\\n           .mode('overwrite') \\\n           .parquet(output_url)\n</code></pre>"},{"location":"machine_learning/framework/petastorm.html#reader-api","title":"Reader API","text":""},{"location":"machine_learning/framework/petastorm.html#pure-python","title":"Pure Python","text":"<pre><code>from petastorm import make_reader\n\n with make_reader('hdfs://myhadoop/some_dataset') as reader:\n    for row in reader:\n        print(row)\n</code></pre>"},{"location":"machine_learning/framework/petastorm.html#tensorflow","title":"Tensorflow","text":"<pre><code>from petastorm.tf_utils import tf_tensors\n\nwith make_reader('file:///some/localpath/a_dataset') as reader:\n   row_tensors = tf_tensors(reader)\n   with tf.Session() as session:\n       for _ in range(3):\n           print(session.run(row_tensors))\n\n# DataSet \nfrom petastorm.tf_utils import make_petastorm_dataset\n\nwith make_reader('file:///some/localpath/a_dataset') as reader:\n    dataset = make_petastorm_dataset(reader)\n    iterator = dataset.make_one_shot_iterator()\n    tensor = iterator.get_next()\n    with tf.Session() as sess:\n        sample = sess.run(tensor)\n        print(sample.id)\n</code></pre>"},{"location":"machine_learning/framework/petastorm.html#pytorch","title":"Pytorch","text":"<pre><code>import torch\nfrom petastorm.pytorch import DataLoader\n\ntorch.manual_seed(1)\ndevice = torch.device('cpu')\nmodel = Net().to(device)\noptimizer = torch.optim.SGD(model.parameters(), lr=0.01, momentum=0.5)\n\ndef _transform_row(mnist_row):\n    transform = transforms.Compose([\n        transforms.ToTensor(),\n        transforms.Normalize((0.1307,), (0.3081,))\n    ])\n    return (transform(mnist_row['image']), mnist_row['digit'])\n\n\ntransform = TransformSpec(_transform_row, removed_fields=['idx'])\n# \u5982\u679c\u4f7f\u7528\u975e\u5e38\u5927BatchSize\uff0c\u53ef\u4ee5\u4f7f\u7528 petastorm.pytorch.BatchedDataLoader\nwith DataLoader(make_reader('file:///localpath/mnist/train', num_epochs=10,\n                            transform_spec=transform), batch_size=64) as train_loader:\n    train(model, device, train_loader, 10, optimizer, 1)\n</code></pre>"},{"location":"machine_learning/framework/petastorm.html#spark","title":"Spark","text":"<p>PetaStorm DataSet\u53ef\u4ee5\u76f4\u63a5\u88abSpark\u4f7f\u7528\u3002</p> <pre><code># Create a dataframe object from a parquet file\ndataframe = spark.read.parquet(dataset_url)\n\n# Show a schema\ndataframe.printSchema()\n\n# Count all\ndataframe.count()\n\n# Show a single column\ndataframe.select('id').show()\n</code></pre>"},{"location":"machine_learning/framework/petastorm.html#spark-convert","title":"Spark Convert","text":"<p>\u5c06 Spark DataFrame \u8f6c\u6362\u4e3a Tensorflow \u6216\u8005 Pytorch \u7684\u683c\u5f0f\uff0cSpark DataFrame\u4f1a\u5148\u4ee5Parquet\u683c\u5f0f\u843d\u76d8\uff0c\u7136\u540e\u88ab\u52a0\u8f7d\u4e3atf\u6216\u8005torch\u683c\u5f0f\u3002</p> <pre><code>from petastorm.spark import SparkDatasetConverter, make_spark_converter\nimport tensorflow.compat.v1 as tf  # pylint: disable=import-error\n\n# specify a cache dir first.\n# the dir is used to save materialized spark dataframe files\nspark.conf.set(SparkDatasetConverter.PARENT_CACHE_DIR_URL_CONF, 'hdfs:/...')\n\ndf = ... # `df` is a spark dataframe\n\n# create a converter from `df`\n# it will materialize `df` to cache dir.\nconverter = make_spark_converter(df)\n\n# make a tensorflow dataset from `converter`\nwith converter.make_tf_dataset() as dataset:\n    # the `dataset` is `tf.data.Dataset` object\n    # dataset transformation can be done if needed\n    dataset = dataset.map(...)\n    # we can train/evaluate model on the `dataset`\n    model.fit(dataset)\n    # when exiting the context, the reader of the dataset will be closed\n\n# delete the cached files of the dataframe.\nconverter.delete()\n</code></pre>"},{"location":"machine_learning/framework/petastorm.html#non-petastorm-parquet-stores","title":"Non Petastorm Parquet Stores","text":"<p>match_batch_reader\u53ef\u4ee5\u76f4\u63a5\u8bfb\u53d6Parquet\u7684\u6570\u636e\u3002</p> <code>make_reader</code> <code>make_batch_reader</code> Only Petastorm datasets (created using materializes_dataset) Any Parquet store (some native Parquet column types are not supported yet.\uff09 The reader returns one record at a time. The reader returns batches of records. The size of the batch is not fixed and defined by Parquet row-group size. Predicates passed to <code>make_reader</code> are evaluated per single row. Predicates passed to <code>make_batch_reader</code> are evaluated per batch. Can filter parquet file based on the <code>filters</code> argument. Can filter parquet file based on the <code>filters</code> argument"},{"location":"machine_learning/framework/fastai/fastai.html","title":"Fastai","text":"<p>\u57fa\u4e8ePytorch\u5c01\u88c5\u7684 AI \u5e93\u3002</p>"},{"location":"machine_learning/framework/horovod/paper.html","title":"Horovod(Uber\u5f00\u6e90)","text":"<p>Horovod : fast and easy distributed deep learning in TensorFlow, 2018.</p> <p>\u6ce8\uff1aTensorflow \u63d0\u4f9b MultiWorkerMirroredStrategy\uff0c\u91c7\u7528AllReduce\u8fdb\u884c\u68af\u5ea6\u66f4\u65b0\uff0cHorovod\u9664\u4e86\u591a\u6846\u67b6\u7edf\u4e00\u5916\uff0c\u6027\u80fd\u6ca1\u6709\u989d\u5916\u7684\u4f18\u52bf\u3002</p>"},{"location":"machine_learning/framework/horovod/paper.html#_1","title":"\u6570\u636e\u5e76\u884c","text":""},{"location":"machine_learning/framework/horovod/paper.html#timeline","title":"Timeline","text":"<p>\u7528\u6237\u53ef\u4ee5\u4f7f\u7528Horovod Timeline\uff0c\u4ee5\u67e5\u770b\u5728\u6574\u4e2a\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u7684\u6bcf\u4e2a\u65f6\u95f4\u6b65\u9aa4\u4e2d\u6bcf\u4e2a\u8282\u70b9\u6b63\u5728\u505a\u4ec0\u4e48\u3002</p> <p></p>"},{"location":"machine_learning/framework/horovod/paper.html#tensor-fusion","title":"Tensor Fusion","text":"<p>\u5982\u679c\u5f20\u91cf\u8db3\u591f\u5927\uff0cring-all-reduce\u4ee5\u4e00\u79cd\u6700\u4f73\u7684\u65b9\u5f0f\u5229\u7528\u7f51\u7edc\uff0c\u4f46\u5982\u679c\u5f20\u91cf\u975e\u5e38\u5c0f\uff0c\u5219\u4e0d\u80fd\u6709\u6548\u6216\u5feb\u901f\u5730\u5de5\u4f5c\u3002</p> <ul> <li>\u4ea4\u9519\u901a\u4fe1\u548c\u8ba1\u7b97\uff0c\u52a0\u4e0a\u80fd\u529b\u6279\u5904\u7406\u5c0f\u7684allreduce\u64cd\u4f5c\uff1b</li> </ul> <p>Tensor Fusion works by attempting to combine all the tensors that are ready to be reduced at given moment of time into one reduction operation. The algorithm of Tensor Fusion is as follows:</p> <ol> <li>Determine which tensors are ready to be reduced. Select first few tensors that fit in <code>HOROVOD_FUSION_THRESHOLD</code> bytes and have the same data type.</li> <li>Allocate fusion buffer of size <code>HOROVOD_FUSION_THRESHOLD</code> if it was not allocated before. Default fusion buffer size is 64 MB.</li> <li>Copy data of selected tensors into the fusion buffer.</li> <li>Execute the allreduce operation on the fusion buffer.</li> <li>Copy data from the fusion buffer into the output tensors.</li> <li>Repeat until there are no more tensors to reduce in this cycle.</li> </ol>"},{"location":"machine_learning/framework/horovod/paper.html#_2","title":"\u6269\u5c55\u6027","text":""},{"location":"machine_learning/framework/horovod/spark.html","title":"Spark","text":"<p>[toc]</p>"},{"location":"machine_learning/framework/horovod/spark.html#horovod-on-spark","title":"Horovod on Spark","text":""},{"location":"machine_learning/framework/horovod/spark.html#horovod-spark-estimators","title":"Horovod Spark Estimators","text":"<p>\u53ef\u4ee5\u548cSpark ML \u96c6\u6210\uff0c\u5b9a\u4e49\u4e86hvd.KerasEstimator\u548cTorchEstimator\uff0c\u7ee7\u627fSpark ML\u7684Estimator\u3002</p> <pre><code>from tensorflow import keras\nimport tensorflow as tf\nimport horovod.spark.keras as hvd\n\nmodel = keras.models.Sequential()\n    .add(keras.layers.Dense(8, input_dim=2))\n    .add(keras.layers.Activation('tanh'))\n    .add(keras.layers.Dense(1))\n    .add(keras.layers.Activation('sigmoid'))\n\n# NOTE: unscaled learning rate\noptimizer = keras.optimizers.SGD(lr=0.1)\nloss = 'binary_crossentropy'\n\nstore = HDFSStore('/user/username/experiments')\nkeras_estimator = hvd.KerasEstimator(\n    num_proc=4,\n    store=store,\n    model=model,\n    optimizer=optimizer,\n    loss=loss,\n    feature_cols=['features'],\n    label_cols=['y'],\n    batch_size=32,\n    epochs=10)\n\n\nkeras_model = keras_estimator.fit(train_df) \\\n    .setOutputCols(['predict'])\npredict_df = keras_model.transform(test_df)\n</code></pre>"},{"location":"machine_learning/framework/horovod/spark.html#_1","title":"\u539f\u7406","text":"<p>https://horovod.readthedocs.io/en/stable/contributors_include.html</p> <p>Horovod in  Spark \u4f7f\u7528 Open MPI \u6765\u8dd1 Horovod \u4f5c\u4e1a\u3002</p> <ul> <li>Horovod job\u4f5c\u4e3aSpark driver\uff0c\u5728Spark\u96c6\u7fa4\u4e2d\u521b\u5efa<code>num_procs</code>\u4e2a\u4efb\u52a1\uff08<code>horovod.spark._make_spark_thread</code>\uff09\uff0c\u6bcf\u4e2aTask\u6267\u884c<code>horovod.spark._task_fn</code>\uff0c\u5411driver\u6ce8\u518cIP\u548cPort\uff0c\u4ee5\u53cahost hash\uff08\u88abMPI\u4f5c\u4e3ahostname\uff09\uff1b</li> <li> <p>\u6240\u6709\u4f5c\u4e1a\u540c\u65f6\u542f\u52a8\uff0c\u56e0\u6b64\u9700\u8981\u786e\u4fdd\u96c6\u7fa4\u7684\u53ef\u884c\u5e76\u884c\u5ea6\uff08\u96c6\u7fa4\u7684\u6838\u6570\u5927\u4e8enum_procs * spark.task.cpus\uff09\u5927\u4e8enum_procs\uff1b</p> </li> <li> <p>Driver\u901a\u77e5\u6240\u6709tasks\u5176\u5b83task\u5df2\u7ecf\u542f\u52a8\uff0c\u6bcf\u4e2atask\u7ee7\u7eed\u521d\u59cb\u5316\u5e76\u7b49\u5f85\u7ec8\u6b62\u7684RPC\uff1b</p> </li> <li>Driver\u8fd0\u884c<code>mpi_run</code>\u542f\u52a8Python\u51fd\u6570</li> <li>\u901a\u5e38\uff0cMPI\u901a\u8fc7SSH\u8fde\u63a5\u5230host\uff0c\u4f46\u8fd9\u4e0d\u5141\u8bb8\u5728Spark executor\u4e2d\u542f\u52a8Python\u51fd\u6570\uff1b</li> <li>MPI\u8fde\u63a5executor\uff0c\u901a\u8fc7\u8c03\u7528<code>horovod.spark.driver.mpirun_rsh</code>\uff08MPI connects to each executor by invoking the <code>horovod.spark.driver.mpirun_rsh</code> method to \u201cremote shell\u201d into the executors.\uff09</li> <li>This method communicates with the task that has the smallest index per host hash. This task executes the <code>orted</code> command provided by MPI.</li> <li>\u6bcf\u4e2aexecutor\u8fd0\u884c\u5355\u4e2a<code>orted</code>\u8fdb\u7a0b\uff0c\u5728\u6bcf\u4e2aexecutor\u7684\u7b2c\u4e00\u4e2aTask\u4f1a\u6709Python\u51fd\u6570\u8fd0\u884c\u5728\u6bcf\u4e2a\u6838\u4e0a\uff08\uff1f\uff1f\uff09\uff0c\u540c\u6837host hash\u4e0b\u7684\u5176\u5b83\u7684task\u9700\u8981\u7b49\u5f85\u7b2c\u4e00\u4e2atask\u7ed3\u675f\u3002</li> </ul> <p></p>"},{"location":"machine_learning/framework/horovod/spark.html#_2","title":"\u914d\u7f6e","text":""},{"location":"machine_learning/framework/horovod/spark.html#gpu","title":"GPU\u914d\u7f6e","text":"<p>2.x\u7248\u672c</p> <p>\u5728Standalone\u6a21\u5f0f\u4e0b\uff0c\u901a\u8fc7\u5728<code>spark_env.sh</code>\u8bbe\u7f6e<code>export SPARK_WORKER_CORES=&lt;# of GPUs&gt;</code>\uff0c\u901a\u8fc7\u5c06<code>spark.task.cpus</code> \u6765\u63a7\u5236\u7533\u8bf7\u6bcf\u4e2aTask\u4f7f\u7528\u7684GPU\uff1b</p>"},{"location":"machine_learning/framework/pytorch/dataset.html","title":"Dataset","text":"<p>[toc]</p>"},{"location":"machine_learning/framework/pytorch/dataset.html#_1","title":"\u6570\u636e","text":"<p>DataSet\u5b9a\u4e49\u6570\u636e\u5982\u4f55\u4ea7\u751f\u4ee5\u53ca\u6570\u636e\u96c6\u7684\u5927\u5c0f\uff1b</p> <p>Sampler\u6839\u636eDataSet\u7684\u957f\u5ea6\uff0c\u4ea7\u751f\u6570\u636e\u96c6\u7684\u7d22\u5f15\uff1b</p> <p>DataLoader\u6839\u636eSampler\u8fd4\u56de\u7684\u7d22\u5f15\uff0c\u53bbDataSet\u4e2d\u83b7\u53d6\u5bf9\u5e94\u7684\u6570\u636e\u3002</p>"},{"location":"machine_learning/framework/pytorch/dataset.html#dataset","title":"Dataset\uff08\u63a5\u53e3\uff09","text":"<pre><code>class Dataset {}\n    \"\"\"\n    \u83b7\u53d6index\u6240\u5728\u7684\u6570\u636e\uff0c\u5982\u679c\u5e26\u6807\u7b7e\uff0c\u4ee5\u5143\u7ec4\u7684\u5f62\u5f0f\u8fd4\u56de data, label\n    \"\"\"\n    def __getitem__(self, index):\n        pass\n\n    \"\"\"\n    \u8fd4\u56de\u6570\u636e\u96c6\u7684\u5927\u5c0f\n    \"\"\"\n    def __len__(self):\n        pass\n}\n</code></pre>"},{"location":"machine_learning/framework/pytorch/dataset.html#dataloader","title":"DataLoader\uff08\u7c7b)","text":"<p>\u5177\u4f53\u7c7b\uff0c\u63a5\u6536Dataset\u5b9e\u73b0\u7c7b\u548cSampler\u5b9e\u73b0\u7c7b\uff0c\u5728Epoch\u5185\uff0c\u6839\u636e</p>"},{"location":"machine_learning/framework/pytorch/dataset.html#sampler","title":"Sampler(\u63a5\u53e3)","text":"<p>\u901a\u8fc7\u8fed\u4ee3\u5668\u7684\u5f62\u5f0f\u4f7f\u7528\uff0c\u6bcf\u6b21\u8fd4\u56de\u4e00\u7ec4Dataset\u7684\u7d22\u5f15\u3002</p> <pre><code>class Sampler(object):\n    r\"\"\"Base class for all Samplers.\n\n    Every Sampler subclass has to provide an :meth:`__iter__` method, providing a\n    way to iterate over indices of dataset elements, and a :meth:`__len__` method\n    that returns the length of the returned iterators.\n\n    .. note:: The :meth:`__len__` method isn't strictly required by\n              :class:`~torch.utils.data.DataLoader`, but is expected in any\n              calculation involving the length of a :class:`~torch.utils.data.DataLoader`.\n    \"\"\"\n\n    def __init__(self, data_source):\n        pass\n\n    def __iter__(self):\n        raise NotImplementedError\n</code></pre>"},{"location":"machine_learning/framework/pytorch/dataset.html#_2","title":"\u4f7f\u7528","text":"<pre><code>import torch\nfrom torch.utils.data import Dataset, DataLoader,RandomSampler\nimport torch.optim as optim\nimport numpy as np\n\nclass CustomizeDataSet(DataSet):\n    def __init__(self, len):\n        self.len = len\n\n    def __getitem__(self, index):\n        print(\"Get index: \", index)\n        return np.array([1,2,3,4]), np.int(index)\n\n    def __len__(self):\n        return self.len\n\ndataset = CustomizeDataSet(100)\n\ntrain_loader = DataLoader(dataset=dataset,\n                          batch_size=batch_size,\n                          sampler=RandomSampler(dataset))\n\nfor batch_idx, (data, target) in enumerate(train_loader):\n    print(\"batch_idx:\", batch_idx, \", target:\", target)\n</code></pre>"},{"location":"machine_learning/framework/pytorch/disrtibuted.html","title":"Disrtibuted","text":"<p>[toc]</p>"},{"location":"machine_learning/framework/pytorch/disrtibuted.html#_1","title":"\u8bad\u7ec3","text":""},{"location":"machine_learning/framework/pytorch/disrtibuted.html#_2","title":"\u5355\u673a\u591a\u5361\u6a21\u578b\u5e76\u884c","text":"<p>\u4e0d\u540c\u7684\u5c42\u6307\u5b9a\u4e0d\u540c\u7684gpu\u8bbe\u5907</p>"},{"location":"machine_learning/framework/pytorch/disrtibuted.html#_3","title":"\u5355\u673a\u591a\u5361\u6570\u636e\u5e76\u884c","text":"<p>nn.DataParallel\uff0c\u5355\u8282\u70b9\u3001\u5355\u8fdb\u7a0b\u3001\u591a\u7ebf\u7a0b\uff0c\u4e0d\u652f\u6301\u6a21\u578b\u5e76\u884c\u3002</p> <p>\u57fa\u4e8eParameter server\u7684\u7b97\u6cd5\uff0c\u5373\u4f7f\u5728\u5355\u53f0\u673a\u5668\u4e0a\uff0c\u7531\u4e8e\u7ebf\u7a0b\u4e4b\u95f4\u7684GIL\u7ade\u4e89\u3001\u6bcf\u4e2a\u8fed\u4ee3\u7684\u590d\u5236\u6a21\u578b\u4ee5\u53ca\u5206\u6563\u8f93\u5165\u548c\u6536\u96c6\u8f93\u51fa\u6240\u5e26\u6765\u7684\u989d\u5916\u5f00\u9500\uff0cDataParallel\u901a\u5e38\u6bd4DistributedDataParallel\u6162\u3002</p>"},{"location":"machine_learning/framework/pytorch/disrtibuted.html#_4","title":"\u5206\u5e03\u5f0f\u6570\u636e\u5e76\u884c","text":"<p>nn.parallel.DistributedDataParallel \uff08DDP\uff09\uff0c\u591a\u8fdb\u7a0b\u3001\u5355\u8282\u70b9/\u591a\u8282\u70b9\u3002</p> <p>Pytorch \u4e2d\u901a\u8fc7 torch.distributed \u5305\u63d0\u4f9b\u5206\u5e03\u5f0f\u652f\u6301\uff0c\u652f\u6301\u6570\u636e\u5e76\u884c\u548c\u6a21\u578b\u5e76\u884c\uff0c\u91c7\u7528RingAllReduce</p> <p>\u5f53DDP\u4e0e\u6a21\u578b\u5e76\u884c\u76f8\u7ed3\u5408\u65f6\uff0c\u6bcf\u4e2aDDP\u8fdb\u7a0b\u5c06\u4f7f\u7528\u6a21\u578b\u5e76\u884c\uff0c\u6240\u6709\u8fdb\u7a0b\u5171\u540c\u4f7f\u7528\u6570\u636e\u5e76\u884c\u3002</p> <ul> <li>\u7528 <code>NCCL</code> \u8fdb\u884c\u5206\u5e03\u5f0f <code>GPU</code> \u8bad\u7ec3</li> <li>\u7528 <code>Gloo</code> \u8fdb\u884c\u5206\u5e03\u5f0f <code>CPU</code> \u8bad\u7ec3</li> </ul> <p>\u6570\u636e\u5212\u5206\uff1aDDP\u5e76\u4e0d\u4f1a\u81ea\u52a8shard\u6570\u636e</p> <ul> <li>\u5982\u679c\u81ea\u5df1\u5199\u6570\u636e\u6d41\uff0c\u5f97\u6839\u636e<code>torch.distributed.get_rank()</code>\u53bbshard\u6570\u636e\uff0c\u83b7\u53d6\u81ea\u5df1\u5e94\u7528\u7684\u4e00\u4efd\uff1b</li> <li>\u5982\u679c\u7528Dataset API\uff0c\u5219\u9700\u8981\u5728\u5b9a\u4e49Dataloader\u7684\u65f6\u5019\u7528<code>DistributedSampler</code> \u53bbshard\uff1a</li> </ul> <pre><code>import torch\nfrom torch import distributed\nimport torch.nn as nn\nfrom torch.nn import functional as F\nfrom torch.utils.data import Dataset, DataLoader\nimport torch.optim as optim\nfrom torch.utils.data.distributed import DistributedSampler\nimport os\n\n# 1) \u521d\u59cb\u5316\n# init_method\u6709\u4e09\u79cd\u65b9\u5f0f\uff1a1\uff09TCP; 2\uff09File System; 3) Env, default\ntorch.distributed.init_process_group(backend=\"gloo\", init_method=None)\n\ninput_size = 28 * 28\nbatch_size = 30\ndata_size = 900\nnum_epochs = 10\n\n# 2\uff09 \u914d\u7f6e\u6bcf\u4e2a\u8fdb\u7a0b\u7684gpu\nlocal_rank = torch.distributed.get_rank()\n# torch.cuda.set_device(local_rank)\n\npid = os.getpid()\n\n# device = torch.device(\"cuda\", local_rank)\n\nclass RandomDataset(Dataset):\n    def __init__(self, input_size, length):\n        self.len = length\n        # \u751f\u6210 length \u884c\uff0c input_size\u5217\u7684\u6570\u7ec4\n        self.data = torch.randn(length, input_size)\n        self.ydata = torch.randint(0, 10, [length, 1])\n\n    def __getitem__(self, index):\n        # print(pid, \"---Get index: \", index, \"value is\", self.ydata[index])\n        return self.data[index], self.ydata[index]\n\n    def __len__(self):\n        return self.len\n\n\ndataset = RandomDataset(input_size, data_size)\n# 3\uff09\u4f7f\u7528DistributedSampler\ntrain_loader = DataLoader(dataset=dataset,\n                          batch_size=batch_size,\n                          sampler=DistributedSampler(dataset))\n\n\nclass Net(nn.Module):\n    def __init__(self):\n        super(Net, self).__init__()\n        self.conv1 = nn.Conv2d(1, 10, kernel_size=5)\n        self.conv2 = nn.Conv2d(10, 20, kernel_size=5)\n        self.conv2_drop = nn.Dropout2d()\n        self.fc1 = nn.Linear(320, 50)\n        self.fc2 = nn.Linear(50, 10)\n\n    def forward(self, x):\n        # (10, 14, 14)\n        x = F.relu(F.max_pool2d(self.conv1(x), 2))\n        # (20, 7, 7)\n        x = F.relu(F.max_pool2d(self.conv2_drop(self.conv2(x)), 2))\n        x = x.view(-1, 320)\n        x = F.relu(self.fc1(x))\n        x = F.dropout(x, training=self.training)\n        x = self.fc2(x)\n        return x\n\n\n# 4) \u5c01\u88c5\u4e4b\u524d\u8981\u628a\u6a21\u578b\u79fb\u5230\u5bf9\u5e94\u7684gpu\nmodel = Net()\n# model.to(device)\n\noptimizer = optim.SGD(model.parameters(), lr=0.01, momentum=0.5)\n# 5) \u5c01\u88c5,\u628a\u539f\u6709\u7684model\u53d8\u4e3aDDP\u6a21\u5f0f\u7684model\nmodel = torch.nn.parallel.DistributedDataParallel(model)\n\nloss_func = nn.CrossEntropyLoss()  # the target label is not one-hotted\n\nfor epoch in range(num_epochs):\n    # \u65b0\u589e2\uff1a\u8bbe\u7f6esampler\u7684epoch\uff0cDistributedSampler\u6bcf\u4e2aepoch\u5bf9\u4e8eShuffle\u751f\u6210\u4e0d\u540c\u7684\u968f\u673a\u5206\u914d\n    train_loader.sampler.set_epoch(epoch)\n    for batch_idx, (data, target) in enumerate(train_loader):\n        # data, target \u4e00= data.cuda(), target.cuda()\n        optimizer.zero_grad()\n        # print(\"Get data is \", data.shape)\n        data = data.reshape([-1, 1, 28, 28])\n        output = model(data)\n        # print(\"Get Out is \", output.shape, \"-target shape:\", target.shape)\n        # \u76ee\u6807\u5fc5\u987b\u662f1D\u6570\u7ec4\n        loss = loss_func(output, target.flatten())\n        loss.backward()\n        optimizer.step()\n        print(pid, '---Train Epoch-batch: {}-{}\\tLoss: {:.6f}'.format(epoch, batch_idx, loss.item()))\n\n# \u4fdd\u5b58\u7684\u662fmodel.module,\u5728\u8fdb\u7a0b0\u4e0a\u4fdd\u5b58\u4e00\u6b21\nif torch.distributed.get_rank() == 0:\n    torch.save(model.module, \"/root/tf/pytorch/model.ckpt\")\n</code></pre> <p>init_method\u6709\u4e09\u79cd\u65b9\u5f0f\uff1a</p> <p>1\uff09TCP</p> <p>2\uff09File System</p> <p>3\uff09Env, default</p> <p>\u542f\u52a8\u547d\u4ee4</p> <pre><code># \u673a\u56681\nCUDA_VISIBLE_DEVICES=\"4,5,6,7\" python -m torch.distributed.launch --nnodes=2 --node_rank=0 --nproc_per_node=4 \\\n  --master_addr=\"172.16.1.217\" --master_port=1234 main.py\n# \u673a\u56682\uff1a\nCUDA_VISIBLE_DEVICES=\"4,5,6,7\" python -m torch.distributed.launch --nnodes=2 --node_rank=1 --nproc_per_node=4 \\\n  --master_addr=\"172.16.1.217\" --master_port=1234 main.py\n</code></pre> <p>\u6216\u8005 <code>torch.multiprocessing.spawn</code>\uff08\u5355\u673a\u591a\u5361\u7684\u5f62\u5f0f\uff09</p> <pre><code>def demo_fn(rank, world_size):\n    dist.init_process_group(\"nccl\", rank=rank, world_size=world_size)\n    # lots of code.\n    ...\n\ndef run_demo(demo_fn, world_size):\n    mp.spawn(demo_fn,\n             args=(world_size,),\n             nprocs=world_size,\n             join=True)\n</code></pre>"},{"location":"machine_learning/framework/pytorch/disrtibuted.html#rpc-api","title":"RPC API","text":"<p>RPC API\u53ef\u4ee5\u5b9e\u73b0 PS\u3002</p> <p>\u5982\u679c\u6a21\u578b\u9700\u8981\u8de8\u591a\u4e2a\u673a\u5668\uff0c\u4f7f\u7528RPC API \u83b7\u53d6\u66f4\u901a\u7528\u7684\u5206\u5e03\u5f0f\u8bad\u7ec3\u652f\u6301\u3002</p>"},{"location":"machine_learning/framework/pytorch/install.html","title":"Install","text":""},{"location":"machine_learning/framework/pytorch/install.html#_1","title":"\u5b89\u88c5","text":"<p>\u5efa\u8bae\u91c7\u7528conda\u5b89\u88c5</p> <p>https://pytorch.org/get-started/locally/</p> <pre><code># \u6dfb\u52a0\u6e90\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/\n\n# gpu\u7248\nconda install pytorch torchvision torchaudio cudatoolkit=10.1 -c pytorch\n# cpu\u7248\nconda install pytorch torchvision torchaudio cpuonly\n</code></pre> <p>\u6216\u8005pip\u5b89\u88c5\uff08\u624b\u52a8\u5b89\u88c5 cuda \u548c cudnn\uff1f\uff09</p> <pre><code>pip install torch===1.5.0 torchvision===0.5.0 -f https://download.pytorch.org/whl/torch_stable.html\n</code></pre>"},{"location":"machine_learning/framework/pytorch/install.html#_2","title":"\u6d4b\u8bd5","text":"<pre><code>import torch\nprint(torch.cuda.is_available())\n\nprint(torch.backends.cudnn.version())\n</code></pre>"},{"location":"machine_learning/framework/tensorflow/action.html","title":"TF\u5b9e\u6218","text":"<ul> <li>\u5377\u79ef\u7f51\u7edc\uff08Convolutional Network\uff09</li> <li>\u5faa\u73af\u795e\u7ecf\u7f51\u7edc\uff08LSTM\uff09\uff08Recurrent Neural Network (LSTM)\uff09</li> <li>\u53d7\u9650\u73bb\u5c14\u5179\u66fc\u673a\uff08Restricted Boltzmann Machine\uff09</li> <li>\u6df1\u5ea6\u4fe1\u5ff5\u7f51\u7edc\uff08Deep Belief Network\uff09</li> <li>\u4f5c\u4e3aRBM\u5806\u53e0\u7684\u6df1\u5ea6\u81ea\u7f16\u7801\u5668\uff08Deep Autoencoder as stack of RBMs\uff09</li> <li>\u53bb\u566a\u81ea\u7f16\u7801\u5668\uff08Denoising Autoencoder\uff09</li> <li>\u5806\u53e0\u7684\u53bb\u566a\u81ea\u7f16\u7801\u5668\uff08Stacked Denoising Autoencoder\uff09</li> <li>\u4f5c\u4e3a\u53bb\u566a\u81ea\u7f16\u7801\u5668\u5806\u53e0\u7684\u6df1\u5ea6\u81ea\u7f16\u7801\u5668\uff08Deep Autoencoder as stack of Denoising Autoencoders\uff09</li> <li>\u591a\u5c42\u611f\u77e5\u5668\uff08MultiLayer Perceptron\uff09</li> <li>Logistic \u56de\u5f52</li> <li>\u53d8\u81ea\u7f16\u7801\u5668\uff08Variational Autoencoders\uff09</li> <li>\u6df1\u5ea6 Q \u5f3a\u5316\u5b66\u4e60\uff08Deep Q Reinforcement Learning\uff09</li> </ul>"},{"location":"machine_learning/framework/tensorflow/disrtibuted.html","title":"Disrtibuted","text":"<p>[toc]</p>"},{"location":"machine_learning/framework/tensorflow/disrtibuted.html#_1","title":"\u8bad\u7ec3\u7b56\u7565","text":"<p>Tensorflow\u5206\u5e03\u5f0f\u8bad\u7ec3\u7684\u652f\u6301\u4e3b\u8981\u662f\u901a\u8fc7 tf.distribute.Strategy \u6765\u5b9e\u73b0\uff0c</p>"},{"location":"machine_learning/framework/tensorflow/disrtibuted.html#centralstoragestrategy","title":"CentralStorageStrategy","text":"<p>\u4e2d\u592e\u5b58\u50a8\u7b56\u7565\uff0c\u53c2\u6570\u88ab\u7edf\u4e00\u5b58\u5728CPU\u91cc\uff0c\u7136\u540e\u590d\u5236\u5230\u6240\u6709GPU\u4e0a\uff0c\u4f18\u70b9\u662fGPU\u8d1f\u8f7d\u5747\u8861\u4e86\uff0c\u4f46\u662f\u4e00\u822c\u60c5\u51b5\u4e0bCPU\u548cGPU\u901a\u4fe1\u4ee3\u4ef7\u5927\uff0c\u4e0d\u5efa\u8bae\u4f7f\u7528\u3002</p>"},{"location":"machine_learning/framework/tensorflow/disrtibuted.html#mirroredstrategy","title":"MirroredStrategy","text":"<ul> <li>\u652f\u6301\u591a\u5f20GPU\u5728\u540c\u4e00\u4e2a\u673a\u5668\u4e0a\u7684\u540c\u6b65\u8bad\u7ec3\u65b9\u6cd5</li> </ul> <p>\u6bcf\u4e2aGPU\u4e0a\u4fdd\u5b58\u4e00\u4efd\u6a21\u578b\u526f\u672c\uff0c\u6a21\u578b\u4e2d\u7684\u6bcf\u4e2a\u53d8\u91cf\u90fd\u955c\u50cf\u5728\u6240\u6709\u526f\u672c\u4e2d\u3002\u8fd9\u4e9b\u53d8\u91cf\u4e00\u8d77\u5f62\u6210\u4e00\u4e2a\u540d\u4e3a<code>MirroredVariable</code>\u7684\u6982\u5ff5\u53d8\u91cf\u3002\u901a\u8fc7apply\u76f8\u540c\u7684\u66f4\u65b0\uff0c\u8fd9\u4e9b\u53d8\u91cf\u4fdd\u6301\u5f7c\u6b64\u540c\u6b65\u3002</p> <p>\u6bcf\u4e2a\u663e\u5361\u4f1a\u6536\u5230tf.data.Dataset\u4f20\u6765\u7684\u6570\u636e\uff0c\u72ec\u7acb\u8ba1\u7b97\u68af\u5ea6\uff0c\u7136\u540e\u91c7\u7528all-reduce\u7684\u65b9\u6cd5\u8fdb\u884c\u540c\u6b65\u66f4\u65b0\u3002\u591a\u4e2a\u663e\u5361\u5728\u901a\u4fe1\u65f6\u9ed8\u8ba4\u4f7f\u7528Nvidia NCCL\u8fdb\u884c\u3002</p> <pre><code># \u81ea\u5b9a\u4e49GPU\u8bbe\u5907\u53f7\nmirrored_strategy = tf.distribute.MirroredStrategy(devices=[\"/gpu:0\", \"/gpu:1\"])\n</code></pre> <p>all-reduce\u5b9e\u73b0\uff1a</p> <ul> <li><code>tf.distribute.CrossDeviceOps</code></li> <li><code>tf.distribute.HierarchicalCopyAllReduce</code></li> <li><code>tf.distribute.ReductionToOneDevice</code></li> <li><code>tf.distribute.NcclAllReduce</code> (default)</li> </ul>"},{"location":"machine_learning/framework/tensorflow/disrtibuted.html#parameterserverstrategy","title":"ParameterServerStrategy","text":"<p>Tensorflow\u6700\u521d\u7684\u5206\u5e03\u5f0f\u8bad\u7ec3\u65b9\u6cd5\uff0c\u4f7f\u7528PS\u8fdb\u884c\u591a\u673a\u5668\u5206\u5e03\u5f0f\u8bad\u7ec3</p>"},{"location":"machine_learning/framework/tensorflow/disrtibuted.html#multiworkermirroredstrategy","title":"MultiWorkerMirroredStrategy","text":"<p>\u591a\u673a\u5668\u540c\u6b65\u8bad\u7ec3\uff0c\u5728\u6bcf\u4e00\u4e2adevice\u4e0a\u5b58\u50a8\u4e00\u4efd\u6a21\u578b\u7684\u5907\u4efd\u3002</p> <pre><code># Demo\u793a\u4f8b\nimport tensorflow as tf\nimport tensorflow_datasets as tfds\nimport os\nimport json\n\nnum_epochs = 5\nbatch_size_per_replica = 64\nlearning_rate = 0.001\n\n# \u6838\u5fc3\uff1a\u8bad\u7ec3\u96c6\u7fa4\u7684\u914d\u7f6e\u4fe1\u606f\nos.environ['TF_CONFIG'] = json.dumps({\n    'cluster': {\n        'worker': [\"localhost:20000\", \"localhost:20001\"]\n    },\n    'task': {'type': 'worker', 'index': 0}\n})\nstrategy = tf.distribute.experimental.MultiWorkerMirroredStrategy()\nnum_workers = 2\nbatch_size = batch_size_per_replica * num_workers\n\ndef resize(image, label):\n    image = tf.image.resize(image, [224, 224]) / 255.0\n    return image, label\n\ndataset = tfds.load(\"cats_vs_dogs\", split=tfds.Split.TRAIN, as_supervised=True)\ndataset = dataset.map(resize).shuffle(1024).batch(batch_size)\n\nwith strategy.scope():\n    model = tf.keras.applications.MobileNetV2()\n    model.compile(\n        optimizer=tf.keras.optimizers.Adam(learning_rate=learning_rate),\n        loss=tf.keras.losses.sparse_categorical_crossentropy,\n        metrics=[tf.keras.metrics.sparse_categorical_accuracy]\n    )\n\nmodel.fit(dataset, epochs=num_epochs)\n</code></pre>"},{"location":"machine_learning/framework/tensorflow/hdfs.html","title":"HDFS","text":""},{"location":"machine_learning/framework/tensorflow/hdfs.html#_1","title":"\u914d\u7f6e","text":"<pre><code># \u8bbe\u7f6elibjvm.so \u548c libhdfs.so\u7684\u8def\u5f84\nLD_LIBRARY_PATH=$HADOOP_HOME/lib/native:$JAVA_HOME/jre/lib/amd64/server/:$LD_LIBRARY_PATH\n# \u8bbe\u7f6e hdfs \u7684jar\u5305\u8def\u5f84\nCLASSPATH=`hdfs classpath --glob`\n</code></pre> <p>\u914d\u7f6e\u540e\uff0cTF\u7684\u6a21\u578b\u548c\u68c0\u67e5\u70b9\u5c31\u53ef\u4ee5\u8bfb\u5199HDFS\u3002</p>"},{"location":"machine_learning/framework/tensorflow/install.html","title":"Install","text":"<p>\u5b89\u88c5</p> <p>https://tensorflow.google.cn/install/source#linux</p> \u7248\u672c Python \u7248\u672c \u7f16\u8bd1\u5668 \u6784\u5efa\u5de5\u5177 cuDNN CUDA tensorflow-2.4.0 3.6-3.8 GCC 7.3.1 Bazel 3.1.0 8.0 11.0 tensorflow-2.3.0 3.5-3.8 GCC 7.3.1 Bazel 3.1.0 7.6 10.1 <pre><code>conda install tensorflow=2.3.0 cudatoolkit=10.1 cudnn=7.6\n</code></pre> <p>\u6216\u8005pip\u5b89\u88c5</p> <pre><code>pip install tensorflow\n</code></pre> <p>\u6d4b\u8bd5</p> <pre><code>from tensorflow.python.client import device_lib\nprint(device_lib.list_local_devices())\n</code></pre>"},{"location":"machine_learning/framework/tensorflow/tensorflow.html","title":"Tensorflow","text":"<p>GPU\u8bad\u7ec3\u9ed8\u8ba4\u662f\u7528\u6240\u6709\u7684\u5361\uff0c\u4f46\u5185\u5b58\u4f7f\u7528\u4e0d\u5747\uff1f</p> <p></p>"},{"location":"machine_learning/framework/tensorflow/tfserving.html","title":"TFServing","text":""},{"location":"machine_learning/framework/tensorflow/tfserving.html#_1","title":"\u4fdd\u5b58\u7684\u6a21\u578b","text":"<pre><code>import tempfile\n\n# \u7248\u672c\u8def\u5f84\u662f\u81ea\u884c\u62fc\u63a5\nMODEL_DIR = tempfile.gettempdir()\nversion = 1\nexport_path = os.path.join(MODEL_DIR, str(version))\nprint('export_path = {}\\n'.format(export_path))\n\ntf.keras.models.save_model(\n    model,\n    export_path,\n    overwrite=True,\n    include_optimizer=True,\n    save_format=None,\n    signatures=None,\n    options=None\n)\n\nprint('\\nSaved model:')\n!ls -l {export_path}\n</code></pre> <p>\u8def\u5f84\u683c\u5f0f</p> <pre><code>ls /tmpfs/tmp/1\n\ndrwxr-xr-x 2 kbuilder kbuilder  4096 Mar 15 10:34 assets\n-rw-rw-r-- 1 kbuilder kbuilder    57 Mar 15 10:34 fingerprint.pb\n-rw-rw-r-- 1 kbuilder kbuilder  8757 Mar 15 10:34 keras_metadata.pb\n-rw-rw-r-- 1 kbuilder kbuilder 77904 Mar 15 10:34 saved_model.pb\ndrwxr-xr-x 2 kbuilder kbuilder  4096 Mar 15 10:34 variables\n</code></pre>"},{"location":"machine_learning/framework/tensorflow/tfserving.html#base64","title":"\u63a5\u6536\u56fe\u7247base64\u4f5c\u4e3a\u8f93\u5165","text":"<pre><code>def preprocess_input(base64_input_bytes):    \n    def decode_bytes(img_bytes):\n        img = tf.image.decode_jpeg(img_bytes, channels=3)\n        img = tf.image.resize(img, MODEL_INPUT_SHAPE)\n        img = tf.image.convert_image_dtype(img, MODEL_INPUT_DTYPE)\n        return img\n\n    base64_input_bytes = tf.reshape(base64_input_bytes, (-1,))\n    return tf.map_fn(lambda img_bytes:\n                     decode_bytes(img_bytes),\n                     elems=base64_input_bytes,                     \n                     fn_output_signature=MODEL_INPUT_DTYPE)\n\ninputs = tf.keras.layers.Input(shape=(), dtype=tf.string, name='b64_input_bytes')\nx = tf.keras.layers.Lambda(preprocess_input, name='decode_image_bytes')(inputs)\nx = my_custom_model(x)\nserving_model = tf.keras.Model(inputs, x)\n\ntf.saved_model.save(serving_model, './my_serving_model')\n</code></pre>"},{"location":"machine_learning/imagevideo/ImageCaption.html","title":"ImageCaption","text":"<p>[toc]</p>"},{"location":"machine_learning/imagevideo/ImageCaption.html#_1","title":"\u56fe\u50cf\u7406\u89e3","text":""},{"location":"machine_learning/imagevideo/capsnet.html","title":"Capsnet","text":"<p>Hinton \u80f6\u56ca\u7f51\u7edc\u76f8\u5173\u539f\u7406\u53ca\u5176\u4ee3\u7801\u5b9e\u73b0\u3002</p> <p>GitHub - XifengGuo/CapsNet-Keras at tf2.2</p>"},{"location":"machine_learning/imagevideo/deepfakes.html","title":"deepfakes","text":"<p>\u201cDeepfakes\u201d\u4e00\u8bcd\u7531\u201cDeep learning\u201d\u548c\u201cFake\u201d\u5408\u5e76\u4ea7\u751f\uff0c\u6307\u5404\u79cd\u6362\u8138\uff08face-swapping\uff09\u548c\u9762\u90e8\u91cd\u73b0\uff08face-reenactment\uff09\u65b9\u6cd5\uff0c\u5305\u62ec\u4f7f\u7528\u6700\u5148\u8fdb\u7684\u8ba1\u7b97\u673a\u89c6\u89c9\u548c\u6df1\u5ea6\u5b66\u4e60\u6280\u672f\u7684\u65b9\u6cd5\u3002</p> <p>Deepfakes\u751f\u6210\u7684\u5047\u8138\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u4e24\u5927\u7c7b\uff1a</p> <ol> <li>\u6362\u8138\uff08Face-swapping\uff09\uff1a\u5c06\u89c6\u9891\u6216\u56fe\u50cf\u4e2d\u7684\u4eba\u8138\u81ea\u52a8\u5730\u66ff\u6362\u4e3a\u5176\u4ed6\u4eba\u8138\uff0c\u8eab\u4efd\u53d1\u751f\u4e86\u6539\u53d8\u3002</li> <li>\u9762\u90e8\u91cd\u73b0\uff08Face-reenactment\uff09\uff1a\u5c06\u6e90\u89d2\u8272\u7684\u8868\u60c5\u548c\u59ff\u52bf\u8f6c\u79fb\u5230\u76ee\u6807\u89c6\u9891\u4e2d\uff0c\u800c\u76ee\u6807\u4e3b\u4f53\u7684\u8eab\u4efd\u4fdd\u6301\u4e0d\u53d8\u3002</li> </ol>"},{"location":"machine_learning/imagevideo/deepfakes.html#1-face-swapping","title":"1. \u6362\u8138\uff08Face-swapping\uff09","text":""},{"location":"machine_learning/imagevideo/deepfakes.html#original-deepfakes","title":"Original Deepfakes","text":"<p>\u539f\u7406\uff1a\u4f7f\u7528\u4e24\u5bf9encoder-decoder\uff0c\u4f46\u5728\u8bad\u7ec3\u65f6\u4e24\u4e2aencoder\u5171\u4eab\u53c2\u6570\uff0c\u4f46\u5206\u522b\u8bad\u7ec3decoder\u3002\u4f7f\u7528\u65f6\u5c06\u539f\u59cb\u8138A\u8f93\u5165Encoder\uff0c\u518d\u8fde\u63a5B\u7684Decoder\uff0c\u89e3\u7801\u5373\u53ef\u5b9e\u73b0\u5c06B\u7684\u8138\u6362\u4e3aA\u7684\u8138\u3002</p> <p>\u7f3a\u70b9\uff1a\u52b3\u52a8\u5bc6\u96c6\u548c\u6d88\u8017\u5927\u91cf\u8ba1\u7b97\u8d44\u6e90\u3002\u8be5\u65b9\u6cd5\u53ea\u6709\u5728\u62e5\u6709\u5927\u91cf\u76ee\u6807\u4eba\u7269\u56fe\u7247\u548c\u89c6\u9891\u7d20\u6750\uff08300\u52302000\u5f20\uff09\u4f5c\u4e3a\u8bad\u7ec3\u6570\u636e\u7684\u524d\u63d0\u4e0b\u624d\u80fd\u8fbe\u5230\u76f8\u5bf9\u7406\u60f3\u7684\u6548\u679c\u3002</p> <p>\u5b9e\u73b0\uff1agithub\u4e0a\u4e0e\u8be5\u65b9\u6cd5\u6700\u8d34\u8fd1\u4e14star\u6700\u9ad8\u7684\u4ee3\u7801\u5b9e\u73b0 https://github.com/deepfakes/faceswap</p>"},{"location":"machine_learning/imagevideo/deepfakes.html#faceswap-gan","title":"Faceswap-GAN","text":"<p>\u539f\u7406\uff1a\u5728\u4e0a\u4e00\u4e2a\u57fa\u4e8eAutoencoder\u7684\u65b9\u6cd5\u4e0a\u52a0\u5165adversarial loss\u548cperceptual loss\u4fbf\u53ef\u7528GAN\u5b9e\u73b0\u6362\u8138\u3002</p> <p>\u5b9e\u73b0\uff1ahttps://github.com/shaoanlu/faceswap-GAN</p>"},{"location":"machine_learning/imagevideo/deepfakes.html#3d-face-faceswap","title":"3D face FaceSwap","text":"<p>\u539f\u7406\uff1a\u901a\u8fc7\u68c0\u6d4b\u4eba\u8138landmarks\u63d0\u53d6\u4eba\u8138\u533a\u57df\uff0c\u901a\u8fc7\u8fd9\u4e9blandmarks\u7528blendshapes\u53ef\u4ee5fit\u4e00\u4e2a3D\u6a21\u677f\u6a21\u578b\uff0c\u7528\u8f93\u5165\u56fe\u50cf\u7684\u7eb9\u7406\u6700\u5c0f\u5316\u6295\u5f71\u5f62\u72b6\u548c\u5b9a\u4f4dlandmarks\u7684\u5dee\u5f02\uff0c\u8fd9\u4e2a\u6a21\u578b\u53ef\u4ee5\u53cd\u6620\u5c04\u5230\u76ee\u6807\u56fe\u50cf\u4e0a\uff0c\u6700\u540e\uff0c\u5c06\u6e32\u67d3\u6a21\u578b\u4e0e\u56fe\u50cf\u6df7\u5408\uff0c\u5e76\u8fdb\u884c\u989c\u8272\u6821\u6b63\u3002\u5b9e\u73b0\u5728\u8ba1\u7b97\u4e0a\u662f\u8f7b\u91cf\u7ea7\u7684\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728CPU\u4e0a\u6709\u6548\u5730\u8fd0\u884c\u3002</p> <p>\u5b9e\u73b0\uff1ahttps://github.com/MarekKowalski/FaceSwap</p>"},{"location":"machine_learning/imagevideo/deepfakes.html#fast-face-swap-using-cnniccv2017","title":"Fast Face-swap Using CNN(ICCV2017)","text":"<p>\u53d7\u56fe\u50cf\u98ce\u683c\u8fc1\u79fb\uff08artistic style transfer\uff09\u7684\u5f71\u54cd\uff0c\u8be5\u65b9\u6cd5\u5c06A\u7684\u4eba\u8138\u59ff\u6001\u548c\u8868\u60c5\u4f5c\u4e3acontent\uff0cB\u7684\u8eab\u4efd\u4f5c\u4e3astyle\uff0c\u751f\u6210\u65f6\u4fdd\u6301A\u7684content\u7684\u540c\u65f6\u5b66\u4e60B\u7684style\u3002</p>"},{"location":"machine_learning/imagevideo/deepfakes.html#on-face-segmentation-face-swapping-and-face-perception-2018","title":"On Face Segmentation, Face Swapping, and Face Perception (2018)","text":"<p>\u539f\u7406\uff1a\u57fa\u4e8e\u4e00\u4e2a\u5168\u5377\u79ef\u795e\u7ecf\u7f51\u7edc\uff08FCN\uff09\u4eba\u8138\u5206\u5272\u7b97\u6cd5\u6765\u5b9e\u73b0\u6362\u8138\u3002</p> <p>\u5b9e\u73b0\uff1ahttps://github.com/YuvalNirkin/face_swap</p>"},{"location":"machine_learning/imagevideo/deepfakes.html#fsgan-subject-agnostic-face-swapping-and-reenactment-iccv2019","title":"FSGAN: Subject Agnostic Face Swapping and Reenactment (ICCV2019)","text":"<p>\u539f\u7406\uff1aFSGAN\u662fsubject agnostic\uff08\u4e0d\u53ef\u77e5\u7684\uff09\uff0c\u53ef\u4ee5\u5e94\u7528\u4e8e\u6210\u5bf9\u7684\u8138\uff0c\u800c\u4e0d\u9700\u8981\u5bf9\u8fd9\u4e9b\u9762\u5b54\u8fdb\u884c\u8bad\u7ec3\u3002\u8be5\u7f51\u7edc\u91c7\u7528\u4e86\u4e00\u79cd\u65b0\u7684Poisson blending loss (\u6cca\u677e\u6df7\u5408\u635f\u8017)\uff0c\u5c06Poisson optimization (\u6cca\u677e\u4f18\u5316)\u4e0eperceptual loss\u76f8\u7ed3\u5408\u3002</p> <p>\u5b9e\u73b0\uff1ahttps://github.com/YuvalNirkin/fsgan</p>"},{"location":"machine_learning/imagevideo/deepfakes.html#faceshifter-towards-high-fidelity-and-occlusion-aware-face-swapping-arxiv2019","title":"FaceShifter: Towards High Fidelity And Occlusion Aware Face Swapping (arXiv2019)","text":"<p>\u5b9e\u73b0\uff1ahttps://github.com/mindslab-ai/faceshifter</p>"},{"location":"machine_learning/imagevideo/deepfakes.html#hififace-3d-shape-and-semantic-prior-guided-high-fidelity-face-swappingarxiv-2021","title":"HifiFace: 3D Shape and Semantic Prior Guided High Fidelity Face Swapping\uff08arXiv 2021\uff09","text":"<p>\u5b9e\u73b0\uff1ahttps://github.com/mindslab-ai/hififace</p>"},{"location":"machine_learning/imagevideo/deepfakes.html#deepfacelab","title":"DeepFaceLab","text":"<p>DeepFaceLab is a tool that utilizes machine learning to replace faces in videos. Includes prebuilt ready to work standalone Windows 7,8,10 binary.</p> <p>https://github.com/iperov/DeepFaceLab</p>"},{"location":"machine_learning/imagevideo/deepfakes.html#2-face-reenactment","title":"2. \u9762\u90e8\u91cd\u73b0\uff08Face-reenactment\uff09","text":""},{"location":"machine_learning/imagevideo/deepfakes.html#face2face-real-time-face-capture-and-reenactment-of-rgb-videos-cvpr2016","title":"Face2face: Real-time face capture and reenactment of rgb videos (CVPR2016)","text":"<p>\u5b9e\u65f6\u9762\u90e8\u91cd\u5efa\uff0c\u501f\u52a9 dlib \u548c OpenCV\uff0c\u9996\u5148\u4eba\u8138\u68c0\u6d4b\u5668\u68c0\u6d4b\u51fa\u6e90\u56fe\u7247\u4e2d\u7684\u4eba\u8138\u3001\u627e\u5230\u4eba\u8138\u4e0a\u7684\u5173\u952e\u6807\u8bb0\u70b9\uff0c\u7136\u540efit\u4e24\u4e2a3D\u6a21\u578b\uff0c\u518d\u4f7f\u7528\u9488\u5bf9\u4eba\u8138\u7684pix2pix\u8f6c\u6362\u6a21\u578b\u628a\u5173\u952e\u6807\u8bb0\u70b9\u8f6c\u6362\u4e3a\u76ee\u6807\u4eba\u8138\u56fe\u50cf\u3002\u6548\u679c\u4e5f\u4e00\u822c\u822c\uff0c\u7528\u505a\u5bf9\u6bd4\u5b9e\u9a8c\u3002</p>"},{"location":"machine_learning/imagevideo/deepfakes.html#few-shot-adversarial-learning-of-realistic-neural-talking-head-modelsarxiv2019-samsung-ai-center","title":"Few-Shot Adversarial Learning of Realistic Neural Talking Head Models(arXiv2019 Samsung AI Center)","text":"<p>\u7279\u70b9\uff1a\u5b66\u4e60\u65b0\u7684\u5934\u90e8\u6a21\u578b\u4ec5\u9700\u8981\u5c11\u91cf\u8bad\u7ec3\u7d20\u6750\uff088\u5e27\u56fe\u50cf\u751a\u7684\u81f3\u81f3\u5355\u5e27\u56fe\u50cf\uff09\u548c\u5c11\u91cf\u8bad\u7ec3\u65f6\u95f4\u3002\u8be5\u7cfb\u7edf\u4e0d\u9700\u8981\u5927\u91cf\u7684\u8bad\u7ec3\u793a\u4f8b\uff0c\u800c\u4e14\u7cfb\u7edf\u53ea\u9700\u8981\u770b\u4e00\u6b21\u56fe\u7247\u5c31\u53ef\u4ee5\u8fd0\u884c\u3002</p>"},{"location":"machine_learning/imagevideo/deepfakes.html#3-deepfake-detection","title":"3.  Deepfake Detection","text":"<p>https://zhuanlan.zhihu.com/p/92474937</p>"},{"location":"machine_learning/imagevideo/deepfakes.html#4","title":"4. \u6570\u636e\u96c6","text":"<p>https://zhuanlan.zhihu.com/p/92853899</p>"},{"location":"machine_learning/imagevideo/face_keypoint.html","title":"\u4eba\u8138\u5173\u952e\u70b9\u68c0\u6d4b\u65b9\u6cd5","text":"<p>Update until 2017/12/17.</p> <p>\u4efb\u52a1\u76ee\u6807\uff1a\u7ed9\u5b9a\u4eba\u8138\u56fe\u50cf\uff0c\u5b9a\u4f4d\u51fa\u4eba\u8138\u9762\u90e8\u7684\u5173\u952e\u533a\u57df\u4f4d\u7f6e\uff0c\u5305\u62ec\u7709\u6bdb\u3001\u773c\u775b\u3001\u9f3b\u5b50\u3001\u5634\u5df4\u3001\u8138\u90e8\u8f6e\u5ed3\u7b49\u3002</p> <p>\u4eba\u8138\u5173\u952e\u70b9\u68c0\u6d4b\u662f\u4eba\u8138\u8bc6\u522b\u4efb\u52a1\u4e2d\u91cd\u8981\u7684\u57fa\u7840\u73af\u8282\uff0c\u53ef\u5e94\u7528\u4e8e\u4eba\u8138\u59ff\u6001\u77eb\u6b63\u3001\u59ff\u6001\u8bc6\u522b\u3001\u8868\u60c5\u8bc6\u522b\u3001\u75b2\u52b3\u76d1\u6d4b\u3001\u5634\u578b\u8bc6\u522b\u7b49\u3002</p>"},{"location":"machine_learning/imagevideo/face_keypoint.html#_2","title":"\u65b9\u6cd5","text":"<p>\u68c0\u6d4b\u65b9\u6cd5\u53ef\u5206\u4e3a\u4ee5\u4e0b\u4e09\u7c7b\uff1a\u5e94\u7528\u6700\u5e7f\u6cdb\uff0c\u6548\u679c\u7cbe\u5ea6\u6700\u9ad8\u7684\u662f\u57fa\u4e8e\u6df1\u5ea6\u5b66\u4e60\u7684\u65b9\u6cd5</p> <ul> <li>ASM(Active Shape Model) \u548c AAM (Active Appearnce Model) \u7684\u4f20\u7edf\u65b9\u6cd5\uff1b</li> <li>\u57fa\u4e8e\u7ea7\u8054\u5f62\u72b6\u56de\u5f52\u7684\u65b9\u6cd5</li> <li>\u57fa\u4e8e\u6df1\u5ea6\u5b66\u4e60\u7684\u65b9\u6cd5\uff1a</li> <li>\u7ea7\u8054\uff1aDCNN\uff0cDAN(2017)</li> <li>\u591a\u4efb\u52a1\uff1aTCDCN</li> <li>\u591a\u4efb\u52a1\u7ea7\u8054\uff1aMTCNN(2016 )</li> <li>TCNN(2016 )</li> </ul>"},{"location":"machine_learning/imagevideo/face_keypoint.html#_3","title":"\u8bc4\u4ef7\u6307\u6807","text":"<p>\u7b97\u6cd5\u6240\u83b7\u53d6\u7684\u5173\u952e\u70b9\u4f4d\u7f6e\u4e0e\u771f\u5b9e\u5173\u952e\u70b9\u4f4d\u7f6e\u4e4b\u95f4\u7684\u504f\u5dee\u3002</p> <ul> <li> <p>\u91c7\u7528\u6570\u636e\u5f52\u4e00\u5316\u7b56\u7565\uff1a\u7531\u4e8e\u4e0d\u540c\u4eba\u8138\u56fe\u50cf\u7684\u5b9e\u9645\u5927\u5c0f\u96be\u514d\u4f1a\u6709\u6240\u5dee\u5f02\uff0c\u4fbf\u4e8e\u5728\u540c\u6837\u7684\u5c3a\u5ea6\u4e0b\u6bd4\u8f83\u7b97\u6cd5\u6027\u80fd\uff1b</p> </li> <li> <p>\u4e3b\u6d41\u7684\u65b9\u6cd5\u662f\u57fa\u4e8e\u4e24\u773c\u95f4\u7684\u8ddd\u79bb\u8fdb\u884c\u4eba\u8138\u5927\u5c0f\u7684\u6807\u51c6\u5316\uff1b</p> </li> </ul> <p>\\(e_x = \\frac{||\\hat{x} - x^{GT}||}{D_{IOD}}\\)</p> <p>\u5206\u5b50\u8868\u793a\u4f30\u8ba1\u503c\u4e0e\u771f\u5b9e\u503c\u7684\u6b27\u5f0f\u8ddd\u79bb\uff0c\u5206\u6bcd\u8868\u793a\u53cc\u773c\u4e2d\u5fc3\u7684\u6b27\u5f0f\u8ddd\u79bb\u3002</p>"},{"location":"machine_learning/imagevideo/format.html","title":"Format","text":"<p>[toc]</p>"},{"location":"machine_learning/imagevideo/format.html#_1","title":"\u683c\u5f0f","text":""},{"location":"machine_learning/imagevideo/format.html#_2","title":"\u56fe\u50cf","text":"<p>Ogg\u5168\u79f0\u662fOGGVobis(oggVorbis)\u662f\u4e00\u79cd\u97f3\u9891\u538b\u7f29\u683c\u5f0f\uff0c\u7c7b\u4f3c\u4e8eMP3\u7b49\u7684\u97f3\u4e50\u683c\u5f0f\u3002Ogg\u662f\u5b8c\u5168\u514d\u8d39\u3001\u5f00\u653e\u548c\u6ca1\u6709\u4e13\u5229\u9650\u5236\u7684\u3002</p>"},{"location":"machine_learning/imagevideo/format.html#m3u8","title":"M3U8\u683c\u5f0f","text":"<p>\u683c\u5f0f:</p> <ul> <li> <p>EXT-X-VERSION\uff1a\u534f\u8bae\u7248\u672c\u53f7\uff0c\u8be5\u6807\u7b7e\u4e0e\u6d41\u5a92\u4f53\u7684\u517c\u5bb9\u6027\u76f8\u5173\uff1b</p> </li> <li> <p>EXT-X-TARGETDURATION\uff1a\u8868\u793a\u6bcf\u4e2a\u89c6\u9891\u5206\u6bb5\u6700\u5927\u7684\u65f6\u957f\uff08\u5355\u4f4d\u79d2\uff09\uff1b</p> </li> <li>EXT-X-KEY\uff1a\u5a92\u4f53\u7247\u6bb5\u53ef\u4ee5\u8fdb\u884c\u52a0\u5bc6\uff0c\u800c\u8be5\u6807\u7b7e\u53ef\u4ee5\u6307\u5b9a\u89e3\u5bc6\u65b9\u6cd5\u3002</li> <li>METHOD\uff1a\u503c\u53ef\u4e3a<code>NONE</code>\uff0c<code>AES-128</code>\uff0c<code>SAMPLE-AES</code>\u5f53\u4e2d\uff1b</li> <li>URI\uff1a\u6307\u5b9a\u5bc6\u94a5\u8def\u5f84\uff0816 \u5b57\u8282\u7684\u6570\u636e\uff09\uff1b\u8be5\u952e\u662f\u5fc5\u987b\u53c2\u6570\uff0c\u9664\u975e METHOD \u4e3a<code>NONE</code>\u3002</li> <li>IV\uff1a\u8be5\u503c\u662f\u4e00\u4e2a 128 \u4f4d\u7684\u5341\u516d\u8fdb\u5236\u6570\u503c<ul> <li>AES-128 \u8981\u6c42\u4f7f\u7528\u76f8\u540c\u7684 16\u5b57\u8282 IV \u503c\u8fdb\u884c\u52a0\u5bc6\u548c\u89e3\u5bc6\uff1b</li> <li>\u5c5e\u6027\u5217\u8868\u51fa\u73b0 IV\uff0c\u5219\u4f7f\u7528\u8be5\u503c\uff1b\u5982\u679c\u672a\u51fa\u73b0\uff0c\u5219\u9ed8\u8ba4\u4f7f\u7528\u5a92\u4f53\u7247\u6bb5\u5e8f\u5217\u53f7\u4f5c\u4e3a\u5176 IV \u503c\uff0c\u4f7f\u7528\u5927\u7aef\u5b57\u8282\u5e8f\uff0c\u5f80\u5de6\u586b\u5145 0 \u76f4\u5230\u5e8f\u5217\u53f7\u6ee1\u8db3 16 \u5b57\u8282\uff08128 \u4f4d\uff09\u3002</li> </ul> </li> <li>EXTINF\uff1a\u8868\u793a\u5176\u540e URL \u6307\u5b9a\u7684\u5a92\u4f53\u7247\u6bb5\u65f6\u957f\uff08\u5355\u4f4d\u4e3a\u79d2\uff09\u3002\u6bcf\u4e2a URL \u5a92\u4f53\u7247\u6bb5\u4e4b\u524d\u5fc5\u987b\u6307\u5b9a\u8be5\u6807\u7b7e</li> </ul> <pre><code>#EXTM3U\n#EXT-X-VERSION:3\n#EXT-X-ALLOW-CACHE:YES\n#EXT-X-TARGETDURATION:6\n#EXT-X-KEY:MEATHOD=AES-128,URI=\"Njk2NTAzZGEtOGMxZS00NjJkLWI5NTItMGQ3M2M4MDQzMjU5czBvVTJYUUNkRFRNa1ZZcWd0RGQrYnpTOWpPdGVRNEpBQUFBQUFBQUFBQTl4TDFFOEgreGV5OWFKdjAwaWhoeHJTVllTcWV0VWlYT093UWNUVjJwbExTUWx5OW9SSWQz\"\n#EXT-X-MEDIA-SEQUENCE:0\n#EXTINF:6.000000,e88f7f24c8e5fb8ec1720bbac2b176fd-ld-encrypt-stream-00004.ts\n</code></pre>"},{"location":"machine_learning/imagevideo/image_feature.html","title":"\u56fe\u50cf\u7279\u5f81","text":""},{"location":"machine_learning/imagevideo/image_feature.html#hog","title":"HOG\u7279\u5f81","text":"<p>\u65b9\u5411\u68af\u5ea6\u76f4\u65b9\u56fe\uff08Histogram of Oriented Gradient, HOG\uff09\u7279\u5f81\u662f\u4e00\u79cd\u5728\u8ba1\u7b97\u673a\u89c6\u89c9\u548c\u56fe\u50cf\u5904\u7406\u4e2d\u7528\u6765\u8fdb\u884c\u7269\u4f53\u68c0\u6d4b\u7684\u7279\u5f81\u63cf\u8ff0\u5b50\u3002</p> <ul> <li>\u901a\u8fc7\u8ba1\u7b97\u548c\u7edf\u8ba1\u56fe\u50cf\u5c40\u90e8\u533a\u57df\u7684\u68af\u5ea6\u65b9\u5411\u76f4\u65b9\u56fe\u6765\u6784\u6210\u7279\u5f81\uff1b</li> <li>\u5bf9\u56fe\u50cf\u51e0\u4f55\u7684\u548c\u5149\u5b66\u7684\u5f62\u53d8\u90fd\u80fd\u4fdd\u6301\u5f88\u597d\u7684\u4e0d\u53d8\u6027</li> <li>Hog\u7279\u5f81\u7ed3\u5408SVM\u5206\u7c7b\u5668\u5df2\u7ecf\u88ab\u5e7f\u6cdb\u5e94\u7528\u4e8e\u56fe\u50cf\u8bc6\u522b\u4e2d\uff0c\u5c24\u5176\u5728\u884c\u4eba\u68c0\u6d4b\u4e2d\u83b7\u5f97\u4e86\u6781\u5927\u7684\u6210\u529f\u3002</li> </ul> <p>\uff081\uff09\u4e3b\u8981\u601d\u60f3\uff1a</p> <p>\u5728\u4e00\u526f\u56fe\u50cf\u4e2d\uff0c\u5c40\u90e8\u76ee\u6807\u7684\u8868\u8c61\u548c\u5f62\u72b6\uff08appearance and shape\uff09\u80fd\u591f\u88ab\u68af\u5ea6\u6216\u8fb9\u7f18\u7684\u65b9\u5411\u5bc6\u5ea6\u5206\u5e03\u5f88\u597d\u5730\u63cf\u8ff0\u3002\uff08\u672c\u8d28\uff1a\u68af\u5ea6\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u800c\u68af\u5ea6\u4e3b\u8981\u5b58\u5728\u4e8e\u8fb9\u7f18\u7684\u5730\u65b9\uff09\u3002</p> <p>\uff082\uff09\u5177\u4f53\u7684\u5b9e\u73b0\u65b9\u6cd5\u662f\uff1a</p> <p>\u9996\u5148\u5c06\u56fe\u50cf\u5206\u6210\u5c0f\u7684\u8fde\u901a\u533a\u57df\uff0c\u6211\u4eec\u628a\u5b83\u53eb\u7ec6\u80de\u5355\u5143\u3002\u7136\u540e\u91c7\u96c6\u7ec6\u80de\u5355\u5143\u4e2d\u5404\u50cf\u7d20\u70b9\u7684\u68af\u5ea6\u7684\u6216\u8fb9\u7f18\u7684\u65b9\u5411\u76f4\u65b9\u56fe\u3002\u6700\u540e\u628a\u8fd9\u4e9b\u76f4\u65b9\u56fe\u7ec4\u5408\u8d77\u6765\u5c31\u53ef\u4ee5\u6784\u6210\u7279\u5f81\u63cf\u8ff0\u5668\u3002</p> <p>\u5927\u6982\u8fc7\u7a0b\uff1a</p> <p>HOG\u7279\u5f81\u63d0\u53d6\u65b9\u6cd5\u5c31\u662f\u5c06\u4e00\u4e2aimage\uff08\u4f60\u8981\u68c0\u6d4b\u7684\u76ee\u6807\u6216\u8005\u626b\u63cf\u7a97\u53e3\uff09\uff1a</p> <p>1\uff09\u7070\u5ea6\u5316\uff08\u5c06\u56fe\u50cf\u770b\u505a\u4e00\u4e2ax,y,z\uff08\u7070\u5ea6\uff09\u7684\u4e09\u7ef4\u56fe\u50cf\uff09\uff1b</p> <p>2\uff09\u91c7\u7528Gamma\u6821\u6b63\u6cd5\u5bf9\u8f93\u5165\u56fe\u50cf\u8fdb\u884c\u989c\u8272\u7a7a\u95f4\u7684\u6807\u51c6\u5316\uff08\u5f52\u4e00\u5316\uff09\uff1b\u76ee\u7684\u662f\u8c03\u8282\u56fe\u50cf\u7684\u5bf9\u6bd4\u5ea6\uff0c\u964d\u4f4e\u56fe\u50cf\u5c40\u90e8\u7684\u9634\u5f71\u548c\u5149\u7167\u53d8\u5316\u6240\u9020\u6210\u7684\u5f71\u54cd\uff0c\u540c\u65f6\u53ef\u4ee5\u6291\u5236\u566a\u97f3\u7684\u5e72\u6270\uff1b</p> <p>3\uff09\u8ba1\u7b97\u56fe\u50cf\u6bcf\u4e2a\u50cf\u7d20\u7684\u68af\u5ea6\uff08\u5305\u62ec\u5927\u5c0f\u548c\u65b9\u5411\uff09\uff1b\u4e3b\u8981\u662f\u4e3a\u4e86\u6355\u83b7\u8f6e\u5ed3\u4fe1\u606f\uff0c\u540c\u65f6\u8fdb\u4e00\u6b65\u5f31\u5316\u5149\u7167\u7684\u5e72\u6270\u3002</p> <p>4\uff09\u5c06\u56fe\u50cf\u5212\u5206\u6210\u5c0fcells\uff08\u4f8b\u59826*6\u50cf\u7d20/cell\uff09\uff1b</p> <p>5\uff09\u7edf\u8ba1\u6bcf\u4e2acell\u7684\u68af\u5ea6\u76f4\u65b9\u56fe\uff08\u4e0d\u540c\u68af\u5ea6\u7684\u4e2a\u6570\uff09\uff0c\u5373\u53ef\u5f62\u6210\u6bcf\u4e2acell\u7684descriptor\uff1b</p> <p>6\uff09\u5c06\u6bcf\u51e0\u4e2acell\u7ec4\u6210\u4e00\u4e2ablock\uff08\u4f8b\u59823*3\u4e2acell/block\uff09\uff0c\u4e00\u4e2ablock\u5185\u6240\u6709cell\u7684\u7279\u5f81descriptor\u4e32\u8054\u8d77\u6765\u4fbf\u5f97\u5230\u8be5block\u7684HOG\u7279\u5f81descriptor\u3002</p> <p>7\uff09\u5c06\u56fe\u50cfimage\u5185\u7684\u6240\u6709block\u7684HOG\u7279\u5f81descriptor\u4e32\u8054\u8d77\u6765\u5c31\u53ef\u4ee5\u5f97\u5230\u8be5image\uff08\u4f60\u8981\u68c0\u6d4b\u7684\u76ee\u6807\uff09\u7684HOG\u7279\u5f81descriptor\u4e86\u3002\u8fd9\u4e2a\u5c31\u662f\u6700\u7ec8\u7684\u53ef\u4f9b\u5206\u7c7b\u4f7f\u7528\u7684\u7279\u5f81\u5411\u91cf\u4e86\u3002</p>"},{"location":"machine_learning/imagevideo/image_feature.html#lbp","title":"LBP\u7279\u5f81","text":"<p>LBP\uff08Local Binary Pattern\uff0c\u5c40\u90e8\u4e8c\u503c\u6a21\u5f0f\uff09\u662f\u4e00\u79cd\u7528\u6765\u63cf\u8ff0\u56fe\u50cf\u5c40\u90e8\u7eb9\u7406\u7279\u5f81\u7684\u7b97\u5b50\uff1a</p> <ul> <li>\u65cb\u8f6c\u4e0d\u53d8\u6027\u548c\u7070\u5ea6\u4e0d\u53d8\u6027\u7b49\u663e\u8457\u7684\u4f18\u70b9\uff1b</li> </ul> <p>\u539f\u59cb\u7684LBP\u6b65\u9aa4</p> <p>\uff081\uff09\u9996\u5148\u5c06\u68c0\u6d4b\u7a97\u53e3\u5212\u5206\u4e3a16\u00d716\u7684\u5c0f\u533a\u57df\uff08cell\uff09\uff1b</p> <p>\uff082\uff09\u5bf9\u4e8e\u6bcf\u4e2acell\u4e2d\u7684\u4e00\u4e2a\u50cf\u7d20\uff0c\u5c06\u76f8\u90bb\u76848\u4e2a\u50cf\u7d20\u7684\u7070\u5ea6\u503c\u4e0e\u5176\u8fdb\u884c\u6bd4\u8f83\uff0c\u82e5\u5468\u56f4\u50cf\u7d20\u503c\u5927\u4e8e\u4e2d\u5fc3\u50cf\u7d20\u503c\uff0c\u5219\u8be5\u50cf\u7d20\u70b9\u7684\u4f4d\u7f6e\u88ab\u6807\u8bb0\u4e3a1\uff0c\u5426\u5219\u4e3a0\u3002\u8fd9\u6837\uff0c3*3\u90bb\u57df\u5185\u76848\u4e2a\u70b9\u7ecf\u6bd4\u8f83\u53ef\u4ea7\u751f8\u4f4d\u4e8c\u8fdb\u5236\u6570\uff0c\u5373\u5f97\u5230\u8be5\u7a97\u53e3\u4e2d\u5fc3\u50cf\u7d20\u70b9\u7684LBP\u503c\uff1b</p> <p>\uff083\uff09\u7136\u540e\u8ba1\u7b97\u6bcf\u4e2acell\u7684\u76f4\u65b9\u56fe\uff0c\u5373\u6bcf\u4e2a\u6570\u5b57\uff08\u5047\u5b9a\u662f\u5341\u8fdb\u5236\u6570LBP\u503c\uff09\u51fa\u73b0\u7684\u9891\u7387\uff1b\u7136\u540e\u5bf9\u8be5\u76f4\u65b9\u56fe\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406\u3002</p> <p>\uff084\uff09\u6700\u540e\u5c06\u5f97\u5230\u7684\u6bcf\u4e2acell\u7684\u7edf\u8ba1\u76f4\u65b9\u56fe\u8fdb\u884c\u8fde\u63a5\u6210\u4e3a\u4e00\u4e2a\u7279\u5f81\u5411\u91cf\uff0c\u4e5f\u5c31\u662f\u6574\u5e45\u56fe\u7684LBP\u7eb9\u7406\u7279\u5f81\u5411\u91cf\uff1b</p> <p>\u5706\u5f62LBP\u7b97\u5b50\u7b49\u6539\u8fdb\u5b9e\u73b0\u65cb\u8f6c\u4e0d\u53d8\u6027\uff0c\u7b49\u4ef7\u6a21\u5f0f\u964d\u4f4eLBP\u503c\u7684\u53d6\u503c\u8303\u56f4\uff1b</p>"},{"location":"machine_learning/imagevideo/image_feature.html#haar","title":"Haar\u7279\u5f81","text":"<p>Haar\u7279\u5f81\u5206\u4e3a\u4e09\u7c7b\uff1a\u8fb9\u7f18\u7279\u5f81\u3001\u7ebf\u6027\u7279\u5f81\u3001\u4e2d\u5fc3\u7279\u5f81\u548c\u5bf9\u89d2\u7ebf\u7279\u5f81\uff0c\u7ec4\u5408\u6210\u7279\u5f81\u6a21\u677f\u3002\u7279\u5f81\u6a21\u677f\u5185\u6709\u767d\u8272\u548c\u9ed1\u8272\u4e24\u79cd\u77e9\u5f62\uff0c\u5e76\u5b9a\u4e49\u8be5\u6a21\u677f\u7684\u7279\u5f81\u503c\u4e3a\u767d\u8272\u77e9\u5f62\u50cf\u7d20\u548c\u51cf\u53bb\u9ed1\u8272\u77e9\u5f62\u50cf\u7d20\u548c\u3002</p> <p>Haar\u7279\u5f81\u503c\u53cd\u6620\u4e86\u56fe\u50cf\u7684\u7070\u5ea6\u53d8\u5316\u60c5\u51b5\u3002</p>"},{"location":"machine_learning/imagevideo/image_feature.html#_2","title":"\u56fe\u50cf","text":"<p>\u4e00\u5f20\u56fe\u7247\u53ef\u4ee5\u5206\u6210\u7c97\u7565\u7ed3\u6784\uff08\u4f4e\u9891\u90e8\u5206\uff09\u548c\u8fb9\u7f18\u7ec6\u8282\uff08\u9ad8\u9891\uff09\u4e24\u4e2a\u90e8\u5206\uff0c\u6bd4\u5982\u4e00\u5f20\u4f01\u9e45\u7167\u7247\u80fd\u5206\u79bb\u51fa\u4e24\u4e2a\u6210\u5206\uff1a</p> <ul> <li>\u4f01\u9e45\u8eab\u4e0a\u6bdb\u8272\u76f8\u8fd1\u7684\u90e8\u5206\u3001\u80cc\u666f\u989c\u8272\u53d8\u5316\u6bd4\u8f83\u7f13\u6162\uff0c\u5c5e\u4e8e\u4f4e\u9891\u4fe1\u606f\uff0c\u4fe1\u606f\u91cf\u8f83\u5c11\uff1b</li> <li>\u800c\u4e24\u79cd\u6bdb\u8272\u4ea4\u63a5\u7684\u90e8\u5206\u3001\u4f01\u9e45\u8eab\u4f53\u8fb9\u7f18\u7684\u989c\u8272\u53d8\u5316\u5267\u70c8\uff0c\u5c5e\u4e8e\u9ad8\u9891\u4fe1\u606f\uff0c\u4fe1\u606f\u91cf\u8f83\u591a\u3002</li> </ul> <p></p>"},{"location":"machine_learning/imagevideo/image_tranlation.html","title":"\u56fe\u50cf\u7ffb\u8bd1","text":"<p>GAN \u5728\u751f\u6210\u6e05\u6670\u56fe\u50cf\uff08sharp images\uff09\u4e0a\u7684\u6210\u529f\uff0cGAN \u5728\u56fe\u50cf\u7ffb\u8bd1\u4efb\u52a1\u4e0a\u7684\u65b9\u6cd5\u8d8a\u6765\u8d8a\u591a\uff0cpix2pix\uff0cCycleGAN\uff0cUNIT\uff0cDTN\uff0cFaderNets\uff0cDistanceGAN\uff0cGeneGAN\uff0cpix2pixHD\uff0cStarGAN \u7b49\u7b49</p>"},{"location":"machine_learning/imagevideo/object_detection.html","title":"Object detection","text":"<p>From System 1 Deep Learning to System 2 Deep Learning. NeurIPS\u20182019 Keynote</p> <p>\u8ba1\u7b97\u673a\u89c6\u89c9\u9886\u57df</p> <ul> <li>\u8bed\u4e49\u5206\u5272\uff08Semantic segmentation\uff09</li> <li>\u5206\u7c7b\u4e0e\u5b9a\u4f4d\uff08Classification and localization\uff09</li> <li>\u76ee\u6807\u68c0\u6d4b\uff08Object detection\uff09</li> <li>\u5b9e\u4f8b\u5206\u5272\uff08Instance segmentation\uff09</li> </ul>"},{"location":"machine_learning/imagevideo/object_detection.html#object-detection","title":"\u76ee\u6807\u68c0\u6d4b\uff08Object detection\uff09","text":""},{"location":"machine_learning/imagevideo/object_detection.html#_1","title":"\u57fa\u4e8e\u5019\u9009\u533a\u57df\u7684\u76ee\u6807\u68c0\u6d4b\u5668","text":"<p>\u6ed1\u52a8\u7a97\u53e3\u68c0\u6d4b\u5668</p> <ul> <li>\u66b4\u529b\u65b9\u6cd5\u662f\u4ece\u5de6\u5230\u53f3\u3001\u4ece\u4e0a\u5230\u4e0b\u6ed1\u52a8\u7a97\u53e3\uff0c\u5229\u7528\u5206\u7c7b\u8bc6\u522b\u76ee\u6807\uff1b</li> <li>\u6ed1\u52a8\u7a97\u53e3\u7684\u56fe\u50cf\u5757\u662f\u7ecf\u8fc7\u53d8\u5f62\u8f6c\u6362\u6210\u7edf\u4e00\u5927\u5c0f\uff0c\u8f93\u5165 CNN \u5206\u7c7b\u5668\u4e2d\uff1b</li> <li>\u4f7f\u7528 SVM \u5206\u7c7b\u5668\u8bc6\u522b\u7c7b\u522b \u548c \u7ebf\u6027\u56de\u5f52\u5668\u8bc6\u522b\u8fb9\u754c\u6846\u3002</li> </ul> <p></p> <p>\u9009\u62e9\u6027\u641c\u7d22</p> <p>\u4e0d\u4f7f\u7528\u66b4\u529b\u65b9\u6cd5\uff0c\u800c\u662f\u7528\u5019\u9009\u533a\u57df\u65b9\u6cd5\uff08region proposal method\uff09\u521b\u5efa\u76ee\u6807\u68c0\u6d4b\u7684\u611f\u5174\u8da3\u533a\u57df\uff08ROI\uff09</p> <ul> <li>\u5c06\u6bcf\u4e2a\u50cf\u7d20\u4f5c\u4e3a\u4e00\u7ec4\u3002\u7136\u540e\uff0c\u8ba1\u7b97\u6bcf\u4e00\u7ec4\u7684\u7eb9\u7406\uff0c\u5e76\u5c06\u4e24\u4e2a\u6700\u63a5\u8fd1\u7684\u7ec4\u7ed3\u5408\u8d77\u6765\uff1b</li> <li>\u907f\u514d\u5355\u4e2a\u533a\u57df\u541e\u566c\u5176\u4ed6\u533a\u57df\uff0c\u9996\u5148\u5bf9\u8f83\u5c0f\u7684\u7ec4\u8fdb\u884c\u5206\u7ec4\uff1b</li> <li>\u7ee7\u7eed\u5408\u5e76\u533a\u57df\uff0c\u76f4\u5230\u6240\u6709\u533a\u57df\u90fd\u7ed3\u5408\u5728\u4e00\u8d77\u3002</li> </ul> <p>\u4e0b\u56fe\u7b2c\u4e00\u884c\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u533a\u57df\u589e\u957f\uff0c\u7b2c\u4e8c\u884c\u4e2d\u7684\u84dd\u8272\u77e9\u5f62\u4ee3\u8868\u5408\u5e76\u8fc7\u7a0b\u4e2d\u6240\u6709\u53ef\u80fd\u7684 ROI\u3002</p> <p></p> <p>R-CNN</p> <p>R-CNN \u5229\u7528\u5019\u9009\u533a\u57df\u65b9\u6cd5\u521b\u5efa\u4e86\u7ea6 2000 \u4e2a ROI\u3002\u8fd9\u4e9b\u533a\u57df\u88ab\u8f6c\u6362\u4e3a\u56fa\u5b9a\u5927\u5c0f\u7684\u56fe\u50cf\uff0c\u5e76\u5206\u522b\u9988\u9001\u5230\u5377\u79ef\u795e\u7ecf\u7f51\u7edc\u4e2d\u3002\u8be5\u7f51\u7edc\u67b6\u6784\u540e\u9762\u4f1a\u8ddf\u51e0\u4e2a\u5168\u8fde\u63a5\u5c42\u5b9e\u73b0\u76ee\u6807\u5206\u7c7b\u5e76\u63d0\u70bc\u8fb9\u754c\u6846\u3002</p> <p>\u8fb9\u754c\u6846\u56de\u5f52\u5668</p> <p>\u3010R-CNN\u76ee\u6807\u68c0\u6d4b\u7cfb\u5217\u3011\u4e8c\u3001\u8fb9\u754c\u6846\u56de\u5f52\uff08Bounding-Box Regression\uff09_daipuweiai\u7684\u535a\u5ba2-CSDN\u535a\u5ba2_\u8fb9\u754c\u6846\u56de\u5f52</p> <p>\u5728\u7ed9\u5b9a\u4e00\u7ec4\u5019\u9009\u76ee\u6807\u6846P\uff0c\u5bfb\u627e\u5230\u4e00\u4e2a\u6620\u5c04f\uff0c\u4f7f\u5f97 \\(f(P) = \\hat{G} \\approx G\\)</p> <ul> <li>\u7ea2\u8272\u6846\u4ee3\u8868\u5019\u9009\u76ee\u6807\u6846\uff0c\u7eff\u8272\u6846\u4ee3\u8868\u771f\u5b9e\u76ee\u6807\u6846\uff0c\u84dd\u8272\u6846\u4ee3\u8868\u8fb9\u754c\u6846\u56de\u5f52\u7b97\u6cd5\u9884\u6d4b\u76ee\u6807\u6846</li> </ul> <p></p> <p>Fast R-CNN</p> <p>R-CNN \u9700\u8981\u975e\u5e38\u591a\u7684\u5019\u9009\u533a\u57df\u4ee5\u63d0\u5347\u51c6\u786e\u5ea6\uff0c\u4f46\u5176\u5b9e\u6709\u5f88\u591a\u533a\u57df\u662f\u5f7c\u6b64\u91cd\u53e0\u7684\uff0c\u56e0\u6b64 R-CNN \u7684\u8bad\u7ec3\u548c\u63a8\u65ad\u901f\u5ea6\u975e\u5e38\u6162\uff0c\u82e5\u6709 2000 \u4e2a\u5019\u9009\u533a\u57df\uff0c\u4e14\u6bcf\u4e00\u4e2a\u90fd\u9700\u8981\u72ec\u7acb\u5730\u9988\u9001\u5230 CNN \u4e2d\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4e0d\u540c\u7684 ROI\uff0c\u6211\u4eec\u9700\u8981\u91cd\u590d\u63d0\u53d6 2000 \u6b21\u7279\u5f81\u3002</p> <ul> <li>Fast R-CNN \u4f7f\u7528\u7279\u5f81\u63d0\u53d6\u5668\uff08CNN\uff09\u5148\u63d0\u53d6\u6574\u4e2a\u56fe\u50cf\u7684\u7279\u5f81\uff0c\u800c\u4e0d\u662f\u4ece\u5934\u5f00\u59cb\u5bf9\u6bcf\u4e2a\u56fe\u50cf\u5757\u63d0\u53d6\u591a\u6b21\uff1b</li> <li>\u5c06\u521b\u5efa\u5019\u9009\u533a\u57df\u7684\u65b9\u6cd5\u76f4\u63a5\u5e94\u7528\u5230\u63d0\u53d6\u5230\u7684\u7279\u5f81\u56fe\u4e0a\uff1b</li> </ul> <p>Fast R-CNN \u6700\u91cd\u8981\u7684\u4e00\u70b9\u5c31\u662f\u5305\u542b\u7279\u5f81\u63d0\u53d6\u5668\u3001\u5206\u7c7b\u5668\u548c\u8fb9\u754c\u6846\u56de\u5f52\u5668\u5728\u5185\u7684\u6574\u4e2a\u7f51\u7edc\u80fd\u901a\u8fc7\u591a\u4efb\u52a1\u635f\u5931\u51fd\u6570\u8fdb\u884c\u7aef\u5230\u7aef\u7684\u8bad\u7ec3\uff0c\u8fd9\u79cd\u591a\u4efb\u52a1\u635f\u5931\u5373\u7ed3\u5408\u4e86\u5206\u7c7b\u635f\u5931\u548c\u5b9a\u4f4d\u635f\u5931\u7684\u65b9\u6cd5\uff0c\u5927\u5927\u63d0\u5347\u4e86\u6a21\u578b\u51c6\u786e\u5ea6\u3002</p> <p></p> <p>ROI \u6c60\u5316</p> <p>\u5728\u5377\u79ef\u5c42\u540e\u7528\u6765\u5c06\u5377\u79ef\u5c42\u8f93\u51fa\u7684\u4e0d\u540c\u5c3a\u5bf8\u7684\u5411\u91cf\u56fa\u5b9a\u6210\u4e00\u4e2a\u5c3a\u5bf8\uff0c\u4f7f\u5176\u53ef\u4ee5\u5728\u6a21\u578b\u539f\u59cb\u8f93\u5165\u5411\u91cf\u5927\u5c0f\u4e0d\u540c\u65f6\u53ef\u5c06\u5377\u53ca\u90e8\u5206\u8f93\u51fa\u7684\u5411\u91cf\u7edf\u4e00\u89c4\u683c\u8f93\u5165\u5230\u540e\u7eed\u7684\u5168\u8fde\u63a5\u90e8\u5206\u3002</p> <p>Faster R-CNN</p> <p>Faster R-CNN \u91c7\u7528\u4e0e Fast R-CNN \u76f8\u540c\u7684\u8bbe\u8ba1\uff0c\u53ea\u662f\u5b83\u7528Region Proposal Networks\u751f\u6210\u5019\u9009\u533a\u57df\u3002</p> <p>\u57fa\u4e8e\u533a\u57df\u7684\u5168\u5377\u79ef\u795e\u7ecf\u7f51\u7edc\uff08R-FCN\uff09</p> <p>R-FCN \u901a\u8fc7\u51cf\u5c11\u6bcf\u4e2a ROI \u6240\u9700\u7684\u5de5\u4f5c\u91cf\u5b9e\u73b0\u52a0\u901f\u3002</p> <ul> <li>\u4f4d\u7f6e\u654f\u611f\u5f97\u5206\u56feposition-sensitive score map</li> </ul> <pre><code># Faster R-CNN\nfeature_maps = process(image)\nROIs = region_proposal(feature_maps)\nfor ROI in ROIs\n    patch = roi_pooling(feature_maps, ROI)\n    class_scores, box = detector(patch)         # Expensive!\n    class_probabilities = softmax(class_scores)\n\n# R-FCN\nfeature_maps = process(image)\nROIs = region_proposal(feature_maps)         \nscore_maps = compute_score_map(feature_maps)\nfor ROI in ROIs\n    V = region_roi_pool(score_maps, ROI)     \n    class_scores, box = average(V)              # Much simpler!\n    class_probabilities = softmax(class_scores)\n</code></pre>"},{"location":"machine_learning/imagevideo/object_detection.html#_2","title":"\u5355\u6b21\u68c0\u6d4b\u5668","text":"<p>YOLO </p> <p>YOLO \u5728\u5377\u79ef\u5c42\u4e4b\u540e\u4f7f\u7528\u4e86 DarkNet \u6765\u505a\u7279\u5f81\u68c0\u6d4b\u3002</p> <ul> <li>\u5e76\u6ca1\u6709\u4f7f\u7528\u591a\u5c3a\u5ea6\u7279\u5f81\u56fe\u6765\u505a\u72ec\u7acb\u7684\u68c0\u6d4b\uff1b</li> <li>\u5c06\u7279\u5f81\u56fe\u90e8\u5206\u5e73\u6ed1\u5316\uff0c\u5e76\u5c06\u5176\u548c\u53e6\u4e00\u4e2a\u8f83\u4f4e\u5206\u8fa8\u7387\u7684\u7279\u5f81\u56fe\u62fc\u63a5\uff1b</li> </ul> <p>YOLO\uff08v2\uff09\u505a\u51fa\u4e86\u5f88\u591a\u5b9e\u73b0\u4e0a\u7684\u6539\u8fdb\u3002</p> <p>YOLOv3</p> <p>YOLOv3 \u4f7f\u7528\u4e86\u66f4\u52a0\u590d\u6742\u7684\u9aa8\u5e72\u7f51\u7edc\u6765\u63d0\u53d6\u7279\u5f81\u3002DarkNet-53 \u4e3b\u8981\u7531 3 \u00d7 3 \u548c 1\u00d7 1 \u7684\u5377\u79ef\u6838\u4ee5\u53ca\u7c7b\u4f3c ResNet \u4e2d\u7684\u8df3\u8fc7\u8fde\u63a5\u6784\u6210</p> <ul> <li>\u6dfb\u52a0\u4e86\u7279\u5f81\u91d1\u5b57\u5854\uff0c\u4ee5\u66f4\u597d\u5730\u68c0\u6d4b\u5c0f\u76ee\u6807\uff1b</li> </ul> <p>\u7279\u5f81\u91d1\u5b57\u5854\u7f51\u7edc\uff08FPN\uff09</p> <p>\u7279\u5f81\u91d1\u5b57\u5854\u7f51\u7edc\uff08FPN\uff09\u662f\u4e00\u79cd\u65e8\u5728\u63d0\u9ad8\u51c6\u786e\u7387\u548c\u901f\u5ea6\u7684\u7279\u5f81\u63d0\u53d6\u5668\u3002\u5b83\u53d6\u4ee3\u4e86\u68c0\u6d4b\u5668\uff08\u5982 Faster R-CNN\uff09\u4e2d\u7684\u7279\u5f81\u63d0\u53d6\u5668\uff0c\u5e76\u751f\u6210\u66f4\u9ad8\u8d28\u91cf\u7684\u7279\u5f81\u56fe\u91d1\u5b57\u5854\u3002</p>"},{"location":"machine_learning/imagevideo/speech.html","title":"\u8bed\u97f3","text":""},{"location":"machine_learning/imagevideo/speech.html#_2","title":"\u57fa\u672c\u6982\u5ff5","text":"<p>\u8bed\u97f3\u662f\u4e00\u4e2a\u8fde\u7eed\u7684\u97f3\u9891\u6d41\uff0c\u5b83\u662f\u7531\u5927\u90e8\u5206\u7684\u7a33\u5b9a\u6001\u548c\u90e8\u5206\u52a8\u6001\u6539\u53d8\u7684\u72b6\u6001\u6df7\u5408\u6784\u6210\u3002</p> <p>\u534f\u540c\u53d1\u97f3\uff1a\u6307\u7684\u662f\u4e00\u4e2a\u97f3\u53d7\u524d\u540e\u76f8\u90bb\u97f3\u7684\u5f71\u54cd\u800c\u53d1\u751f\u53d8\u5316\uff0c\u4ece\u53d1\u58f0\u673a\u7406\u4e0a\u770b\u5c31\u662f\u4eba\u7684\u53d1\u58f0\u5668\u5b98\u5728\u4e00\u4e2a\u97f3\u8f6c\u5411\u53e6\u4e00\u4e2a\u97f3\u65f6\u5176\u7279\u6027\u53ea\u80fd\u6e10\u53d8\uff0c\u4ece\u800c\u4f7f\u5f97\u540e\u4e00\u4e2a\u97f3\u7684\u9891\u8c31\u4e0e\u5176\u4ed6\u6761\u4ef6\u4e0b\u7684\u9891\u8c31\u4ea7\u751f\u5dee\u5f02\u3002</p> <ul> <li>\u4f7f\u5f97\u97f3\u7d20\u7684\u611f\u77e5\u4e0e\u6807\u51c6\u4e0d\u4e00\u6837\uff1b</li> </ul> <p>\u6839\u636e\u4e0a\u4e0b\u6587\u6765\u8fa8\u522b\u97f3\u7d20\uff1a\u5c06\u4e00\u4e2a\u97f3\u7d20\u5212\u5206\u4e3a\u51e0\u4e2a\u4e9a\u97f3\u7d20\u5355\u5143\u3002\u5982\uff1a\u6570\u5b57\u201cthree\u201d\uff0c\u97f3\u7d20\u7684\u7b2c\u4e00\u90e8\u5206\u4e0e\u5728\u5b83\u4e4b\u524d\u7684\u97f3\u7d20\u5b58\u5728\u5173\u8054\uff0c\u4e2d\u95f4\u90e8\u5206\u662f\u7a33\u5b9a\u7684\u90e8\u5206\uff0c\u800c\u6700\u540e\u4e00\u90e8\u5206\u5219\u4e0e\u4e0b\u4e00\u4e2a\u97f3\u7d20\u5b58\u5728\u5173\u8054\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u5728\u7528HMM\u6a21\u578b\u505a\u8bed\u97f3\u8bc6\u522b\u65f6\uff0c\u9009\u62e9\u97f3\u7d20\u7684\u4e09\u72b6\u6001HMM\u6a21\u578b\u3002</p> <p>\u4e0a\u4e0b\u6587\u76f8\u5173\u5efa\u6a21\u65b9\u6cd5\u5728\u5efa\u6a21\u65f6\u8003\u8651\u4e86\u8fd9\u4e00\u5f71\u54cd\uff0c\u4ece\u800c\u4f7f\u6a21\u578b\u80fd\u66f4\u51c6\u786e\u5730\u63cf\u8ff0\u8bed\u97f3\uff0c</p> <ul> <li>\u53ea\u8003\u8651\u524d\u4e00\u97f3\u7684\u5f71\u54cd\u7684\u79f0\u4e3a Bi-Phone\uff1b</li> <li>\u8003\u8651\u524d\u4e00\u97f3\u548c\u540e\u4e00\u97f3\u7684\u5f71\u54cd\u7684\u79f0\u4e3a Tri-Phone\uff1b</li> </ul>"},{"location":"machine_learning/imagevideo/speech.html#_3","title":"\u8bed\u97f3\u8bc6\u522b","text":""},{"location":"machine_learning/imagevideo/video_process.html","title":"Video process","text":"<p>[toc]</p>"},{"location":"machine_learning/imagevideo/video_process.html#_1","title":"\u89c6\u9891\u5904\u7406","text":""},{"location":"machine_learning/imagevideo/video_process.html#_2","title":"\u62bd\u53d6\u6210\u56fe\u7247","text":"<p>\u4f7f\u7528ffmpeg\u5c06\u89c6\u9891\u62bd\u53d6\u4e3a\u591a\u4e2a\u56fe\u7247</p> <p><code>ffmpeg -i /path/to/my/video.mp4 /path/to/output/video-frame-%d.png</code></p>"},{"location":"machine_learning/imagevideo/video_process.html#_3","title":"\u4ece\u56fe\u7247\u5408\u6210","text":"<p><code>ffmpeg -i video-frame-%0d.png -c:v libx264 -vf \"fps=25,format=yuv420p\" out.mp4</code></p>"},{"location":"machine_learning/imagevideo/video_process.html#_4","title":"\u64ad\u653e\u5668","text":"<p>mpv</p> <p>\u53ea\u64ad\u653e\u97f3\u9891\u90e8\u5206\uff1a</p> <p><code>mpv --no-video {video_path}</code></p>"},{"location":"machine_learning/nlp/index.html","title":"\u81ea\u7136\u8bed\u8a00\u5904\u7406","text":"<p>\u300a\u81ea\u7136\u8bed\u8a00\u5904\u7406\u5165\u95e8\u300b</p> <p></p> <ul> <li>\u5206\u8bcd\u548c\u5e8f\u5217\u6807\u6ce8</li> </ul>"},{"location":"machine_learning/nlp/index.html#todo","title":"TODO","text":"<p>https://mp.weixin.qq.com/s/SwY02qXSbf43Odgyc-WAVw</p> <p>https://github.com/oxford-cs-deepnlp-2017/lectures</p>"},{"location":"machine_learning/nlp/chatbot.html","title":"\u81ea\u5df1\u52a8\u624b\u505a\u804a\u5929\u673a\u5668\u4eba\u6559\u7a0b","text":"<ul> <li>\u81ea\u5df1\u52a8\u624b\u505a\u804a\u5929\u673a\u5668\u4eba \u4e00-\u6d89\u53ca\u77e5\u8bc6(2016-06-09)</li> <li>\u81ea\u5df1\u52a8\u624b\u505a\u804a\u5929\u673a\u5668\u4eba \u4e8c-\u521d\u8bc6NLTK\u5e93(2016-06-10)</li> <li>\u81ea\u5df1\u52a8\u624b\u505a\u804a\u5929\u673a\u5668\u4eba \u4e09-\u8bed\u6599\u4e0e\u8bcd\u6c47\u8d44\u6e90(2016-06-12)</li> <li>\u81ea\u5df1\u52a8\u624b\u505a\u804a\u5929\u673a\u5668\u4eba \u56db-\u4f55\u987b\u52a8\u624b\uff1f\u5b8c\u5168\u81ea\u52a8\u5316\u5bf9\u8bed\u6599\u505a\u8bcd\u6027\u6807\u6ce8(2016-06-17)</li> <li>\u81ea\u5df1\u52a8\u624b\u505a\u804a\u5929\u673a\u5668\u4eba \u4e94-\u81ea\u7136\u8bed\u8a00\u5904\u7406\u4e2d\u7684\u6587\u672c\u5206\u7c7b(2016-06-21)</li> <li>\u81ea\u5df1\u52a8\u624b\u505a\u804a\u5929\u673a\u5668\u4eba \u516d-\u6559\u4f60\u600e\u4e48\u4ece\u4e00\u53e5\u8bdd\u91cc\u63d0\u53d6\u51fa\u5341\u53e5\u8bdd\u7684\u4fe1\u606f(2016-06-22)</li> <li>\u81ea\u5df1\u52a8\u624b\u505a\u804a\u5929\u673a\u5668\u4eba \u4e03-\u6587\u6cd5\u5206\u6790\u8fd8\u662f\u57fa\u4e8e\u7279\u5f81\u597d\u554a(2016-06-23)</li> <li>\u81ea\u5df1\u52a8\u624b\u505a\u804a\u5929\u673a\u5668\u4eba \u516b-\u91cd\u6e29\u81ea\u7136\u8bed\u8a00\u5904\u7406(2016-06-24)</li> <li>\u81ea\u5df1\u52a8\u624b\u505a\u804a\u5929\u673a\u5668\u4eba \u4e5d-\u804a\u5929\u673a\u5668\u4eba\u5e94\u8be5\u600e\u4e48\u505a(2016-06-25)</li> <li>\u81ea\u5df1\u52a8\u624b\u505a\u804a\u5929\u673a\u5668\u4eba \u5341-\u534a\u4e2a\u5c0f\u65f6\u641e\u5b9a\u8bcd\u6027\u6807\u6ce8\u4e0e\u5173\u952e\u8bcd\u63d0\u53d6(2016-06-28)</li> <li>\u81ea\u5df1\u52a8\u624b\u505a\u804a\u5929\u673a\u5668\u4eba \u5341\u4e00-0\u5b57\u8282\u5b58\u50a8\u6d77\u91cf\u8bed\u6599\u8d44\u6e90(2016-07-01)</li> </ul> <p>https://github.com/warmheartli/ChatBotCourse</p>"},{"location":"machine_learning/nlp/intro_2_nlp.html","title":"Introduction to Natural Language Processing","text":"<p>\u7edf\u8ba1\u673a\u5668\u5b66\u4e60\u65b9\u6cd5\u5165\u95e8\u4ecb\u7ecd\uff0c\u91c7\u7528HaNLP 1.x  \u7248\u672c\u3002</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.hankcs&lt;/groupId&gt;\n    &lt;artifactId&gt;hanlp&lt;/artifactId&gt;\n    &lt;version&gt;1.7.8&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"machine_learning/nlp/intro_2_nlp.html#_1","title":"\u57fa\u7840","text":"<p>TODO\uff1a\u81ea\u7136\u8bed\u8a00\u5904\u7406\u7684\u5c42\u6b21\uff08\u56fe\u793a\uff09</p>"},{"location":"machine_learning/nlp/intro_2_nlp.html#_2","title":"\u8bcd\u5178\u5206\u8bcd","text":"<p>\u5206\u8bcd\u5927\u81f4\u5206\u4e3a\uff1a\u57fa\u4e8e\u8bcd\u5178\u89c4\u5219\u548c\u57fa\u4e8e\u673a\u5668\u5b66\u4e60\u4e24\u79cd\u3002</p> <p>\u9f50\u592b\u5b9a\u5f8b\uff08Zipf's Law\uff09\uff1a\u5728\u81ea\u7136\u8bed\u8a00\u7684\u8bed\u6599\u5e93\u91cc\uff0c\u4e00\u4e2a\u5355\u8bcd\u51fa\u73b0\u7684\u9891\u7387\u4e0e\u5b83\u5728\u9891\u7387\u8868\u91cc\u7684\u6392\u540d\u6210\u53cd\u6bd4\u3002</p>"},{"location":"machine_learning/nlp/intro_2_nlp.html#_3","title":"\u5207\u5206\u7b97\u6cd5","text":"<ul> <li>\u5b8c\u5168\u5207\u5206</li> </ul> <p>\u627e\u51fa\u4e00\u6bb5\u6587\u672c\u4e2d\u7684\u6240\u6709\u5355\u8bcd\u3002</p> <ul> <li> <p>\u6b63\u5411\u6700\u957f\u5339\u914d</p> </li> <li> <p>\u9006\u5411\u6700\u957f\u5339\u914d</p> </li> <li>\u53cc\u5411\u6700\u957f\u5339\u914d\uff1a\u6b63\u5411\u548c\u9006\u5411\u4e2d\u8bcd\u6570\u6700\u5c11\u7684\u7ed3\u679c\uff0c\u76f8\u540c\u5219\u8fd4\u56de\u5355\u5b57\u6700\u5c11\uff0c\u82e5\u8fd8\u76f8\u540c\u8fd4\u56de\u9006\u5411\u3002</li> <li>\u542f\u53d1\uff1a\u6c49\u8bed\u4e2d\u5355\u5b57\u8bcd\u7684\u6570\u91cf\u8fdc\u5c0f\u4e8e\u975e\u5355\u5b57\u8bcd\u3002</li> </ul>"},{"location":"machine_learning/nlp/tokenize.html","title":"\u5206\u8bcd","text":"<p>\u5206\u8bcd\u662f\u8bcd\u6cd5\u5206\u6790\uff08\u5305\u62ec\u8bcd\u6027\u6807\u6ce8\u548c\u547d\u540d\u5b9e\u4f53\u8bc6\u522b\uff09\u7684\u6700\u57fa\u672c\u7684\u4efb\u52a1\u3002</p> <p>\u4e2d\u6587\u5206\u8bcd\u7684\u96be\u70b9\uff1a</p> <ul> <li>\u5206\u8bcd\u7c92\u5ea6\u4e0d\u7edf\u4e00\uff0c\u4e0d\u540c\u5e94\u7528\u5bf9\u5206\u8bcd\u7684\u7c92\u5ea6\u8981\u6c42\u4e0d\u4e00\u6837\uff1b</li> <li>\u4e2d\u6587\u6b67\u4e49\u95ee\u9898\uff1b</li> <li>\u672a\u767b\u5f55\u8bcd\uff0c\u65b0\u5174\u8bcd\u8bed\uff1b</li> </ul>"},{"location":"machine_learning/nlp/tokenize.html#_2","title":"\u5206\u8bcd\u7b97\u6cd5","text":"<p>\u57fa\u4e8e\u5b57\u5178\u7684\u5206\u8bcd\uff1a</p> <ul> <li>\u53e5\u5b50\u6309\u7167\u5b57\u5178\u5207\u5206\u6210\u8bcd\uff0c\u518d\u5bfb\u627e\u8bcd\u7684\u7684\u6700\u4f73\u7ec4\u5408\u65b9\u5f0f\uff1b</li> </ul> <p>\u57fa\u4e8e\u5b57\u7684\u5206\u8bcd\uff1a</p> <ul> <li>\u53e5\u5b50\u5206\u6210\u5b57\uff0c\u518d\u5c06\u5b57\u7ec4\u5408\u6210\u8bcd\uff0c\u5bfb\u627e\u6700\u4f18\u7684\u5207\u5206\u7b56\u7565\uff0c\u4e5f\u53ef\u4ee5\u8f6c\u5316\u4e3a\u5e8f\u5217\u6807\u6ce8\u95ee\u9898\u3002</li> </ul>"},{"location":"machine_learning/nlp/tokenize.html#_3","title":"\u57fa\u4e8e\u8bcd\u8868\u7684\u5206\u8bcd","text":"<p>\u6210\u719f\u7684\u5de5\u4e1a\u754c\u5e94\u7528\u4e0a\u51e0\u4e4e\u4e0d\u4f1a\u76f4\u63a5\u4f7f\u7528\u8bcd\u8868\u5206\u8bcd\u4f5c\u4e3a\u5206\u8bcd\u6a21\u5757\u7684\u5b9e\u73b0\u65b9\u6cd5\u3002</p>"},{"location":"machine_learning/nlp/tokenize.html#_4","title":"\u6700\u5927\u5339\u914d\u5206\u8bcd\u7b97\u6cd5","text":"<p>\u6b63\u5411\u6700\u5927\u5339\u914d</p> <p>\u5bf9\u4e8e\u8f93\u5165\u7684\u4e00\u6bb5\u6587\u672c\u4ece\u5de6\u81f3\u53f3\u3001\u4ee5\u8d2a\u5fc3\u7684\u65b9\u5f0f\u5207\u5206\u51fa\u5f53\u524d\u4f4d\u7f6e\u4e0a\u957f\u5ea6\u6700\u5927\u7684\u8bcd\u3002</p> <p>\u9006\u5411\u6700\u5927\u5339\u914d</p> <p>\u5206\u8bcd\u987a\u5e8f\u53d8\u4e3a\u4ece\u53f3\u81f3\u5de6\u3002</p>"},{"location":"machine_learning/nlp/tokenize.html#_5","title":"\u53cc\u5411\u6700\u5927\u5339\u914d","text":"<p>\u6b63\u5411\u548c\u53cd\u5411\uff0c\u9009\u62e9\u8bcd\u6700\u5c11\u7684\u5339\u914d\uff0c\u5982\u679c\u8bcd\u6570\u4e00\u6837\uff0c\u8fd4\u56de\u5355\u5b57\u6570\u6700\u5c11\u7684\u5339\u914d\uff0c\u5982\u679c\u4e5f\u4e00\u6837\uff0c\u5219\u8fd4\u56de\u9006\u5411\u5339\u914d\u3002</p> <ul> <li>\u542f\u53d1\u5f0f\uff0c\u6c49\u8bed\u4e2d\u5355\u5b57\u8bcd\u7684\u6570\u91cf\u8fdc\u8fdc\u5c0f\u4e8e\u975e\u5355\u5b57\u8bcd\uff0c\u7b97\u6cd5\u4e2d\u5c3d\u91cf\u51cf\u5c11\u7ed3\u679c\u4e2d\u7684\u5355\u5b57\u3002</li> </ul>"},{"location":"machine_learning/nlp/tokenize.html#_6","title":"\u6700\u77ed\u8def\u5f84\u5206\u8bcd\u7b97\u6cd5","text":"<p>\u5c06\u4e00\u53e5\u8bdd\u4e2d\u7684\u6240\u6709\u8bcd\u5339\u914d\u51fa\u6765\uff0c\u6784\u6210\u8bcd\u56fe\uff08DAG\uff09\uff0c\u5bfb\u627e\u4ece\u8d77\u59cb\u70b9\u5230\u7ec8\u70b9\u7684\u6700\u77ed\u8def\u5f84\u4f5c\u4e3a\u6700\u4f73\u7ec4\u5408\u3002</p> <p></p> <p>\u53ef\u4ee5\u8ba4\u4e3a\u56fe\u4e2d\u7684\u6bcf\u4e2a\u8bcd\u7684\u6743\u91cd\u90fd\u662f\u76f8\u7b49\u7684\u3002</p>"},{"location":"machine_learning/nlp/tokenize.html#_7","title":"\u57fa\u4e8e\u7edf\u8ba1\u6a21\u578b\u7684\u5206\u8bcd\u7b97\u6cd5","text":""},{"location":"machine_learning/nlp/tokenize.html#n-gram","title":"\u57fa\u4e8en-gram \u6a21\u578b\u7684\u5206\u8bcd\u7b97\u6cd5","text":"<p>\u4e0a\u4e00\u90e8\u5206\u7684DAG\u56fe\u4e2d\uff0c\u6bcf\u6761\u8def\u5f84\u7684\u6743\u91cd\u90fd\u662f\u76f8\u7b49\u7684\uff0c\u4f46\u662f\u5b9e\u9645\u4e2d\u5e38\u7528\u8bcd\u7684\u51fa\u73b0\u9891\u7387/\u6982\u7387\u6bd4\u7f55\u89c1\u8bcd\u5927\u3002</p> <p>\u5c06\u6c42\u89e3\u8bcd\u56fe\u6700\u77ed\u8def\u5f84\u7684\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\u89e3\u6700\u5927\u6982\u7387\u8def\u5f84\u7684\u95ee\u9898\uff08\u7ef4\u6bd4\u7279\u7b97\u6cd5\uff09\uff0c\u5373\u5206\u8bcd\u7ed3\u679c\u4e3a\u201c\u6700\u6709\u53ef\u80fd\u7684\u8bcd\u7684\u7ec4\u5408\u201c\u3002</p> <p>2-gram\u6a21\u578b\u7684\u516c\u5f0f\u5982\u4e0b\uff08\u4e00\u822cn\u4e3a2\uff0c3\uff09\uff1a</p> <p>\\(p(s)=\\displaystyle \\prod^{l}_{i=1}{p(w_i|w_1...w_{i-1})}\\approx\\displaystyle \\prod^{l}_{i=1}{p(w_i|w_{i-1})}\\)</p> <p></p>"},{"location":"machine_learning/nlp/tokenize.html#_8","title":"\u57fa\u4e8e\u5b57\u7684\u5206\u8bcd\uff08\u5e8f\u5217\u6807\u6ce8\uff09","text":"<p>\u5c06\u5206\u8bcd\u770b\u6210\u662f\u5e8f\u5217\u6807\u6ce8\u95ee\u9898\uff0c\u5e8f\u5217\u6807\u6ce8\uff08tagging\uff09\u6307\u7684\u662f\u7ed9\u5b9a\u4e00\u4e2a\u5e8f\u5217\\(x=x_1x_2...x_n\\)\uff0c\u627e\u51fa\u5e8f\u5217\u4e2d\u6bcf\u4e2a\u5143\u7d20\u7684\u5bf9\u5e94\u6807\u7b7e\\(y=y_1y_2...y_n\\)\u7684\u95ee\u9898\uff0c\u5176\u4e2dy\u7684\u53ef\u80fd\u53d6\u503c\u96c6\u5408\u79f0\u4e3a\u6807\u6ce8\u96c6\u3002</p> <p>\u4e2d\u6587\u5206\u8bcd\u53ef\u4ee5\u8f6c\u5316\u4e3a\u6807\u6ce8\u96c6\u4e3a<code>{\u5207\uff0c\u8fc7}</code>\u7684\u5e8f\u5217\u6807\u6ce8\u95ee\u9898\u3002</p>"},{"location":"machine_learning/nlp/tokenize.html#_9","title":"\u751f\u6210\u5f0f\u6a21\u578b\u5206\u8bcd\u7b97\u6cd5","text":"<p>\u751f\u6210\u5f0f\u6a21\u578b\u4e3b\u8981\u6709n-gram\u6a21\u578b\u3001HMM\u9690\u9a6c\u5c14\u53ef\u592b\u6a21\u578b\u3001\u6734\u7d20\u8d1d\u53f6\u65af\u5206\u7c7b\u7b49\u3002</p> <p>\u57fa\u4e8e\u5b57\u7684n-gram\u6a21\u578b\u8fdb\u884c\u5206\u8bcd\uff0c\u4e0d\u8fc7\u8fd9\u79cd\u65b9\u6cd5\u7684\u6548\u679c\u6ca1\u6709\u57fa\u4e8e\u8bcd\u7684\u6548\u679c\u8981\u597d\u3002</p>"},{"location":"machine_learning/nlp/tokenize.html#hmm","title":"HMM\u9690\u9a6c\u5c14\u53ef\u592b\u6a21\u578b","text":"<p>HMM\u6a21\u578b\u8ba4\u4e3a\u5728\u89e3\u51b3\u5e8f\u5217\u6807\u6ce8\u95ee\u9898\u65f6\u5b58\u5728\u4e24\u79cd\u5e8f\u5217\uff0c\u4e00\u79cd\u662f\u89c2\u6d4b\u5e8f\u5217\uff0c\u5373\u4eba\u4eec\u663e\u6027\u89c2\u5bdf\u5230\u7684\u53e5\u5b50\uff0c\u800c\u5e8f\u5217\u6807\u7b7e\u662f\u9690\u72b6\u6001\u5e8f\u5217\uff0c\u5373\u89c2\u6d4b\u5e8f\u5217\u4e3aX\uff0c\u9690\u72b6\u6001\u5e8f\u5217\u662fY\uff0c\u56e0\u679c\u5173\u7cfb\u4e3a<code>Y-&gt;X</code>\u3002\u56e0\u6b64\u8981\u5f97\u5230\u6807\u6ce8\u7ed3\u679cY\uff0c\u5fc5\u987b\u5bf9X\u7684\u6982\u7387\u3001Y\u7684\u6982\u7387\u3001P(X|Y)\u8fdb\u884c\u8ba1\u7b97\uff0c\u5373\u5efa\u7acbP(X,Y)\u7684\u6982\u7387\u5206\u5e03\u6a21\u578b\u3002</p> <p>\u9690\u9a6c\u5c14\u53ef\u592b\u6a21\u578b\u7684\u5b9a\u4e49\u548c\u6c42\u89e3</p>"},{"location":"machine_learning/nlp/tokenize.html#_10","title":"\u5224\u522b\u5f0f\u6a21\u578b\u7b97\u6cd5","text":"<p>\u5224\u522b\u5f0f\u6a21\u578b\u4e3b\u8981\u6709\u611f\u77e5\u673a\u3001SVM\u652f\u6301\u5411\u91cf\u673a\u3001CRF\u6761\u4ef6\u968f\u673a\u573a\u3001\u6700\u5927\u71b5\u6a21\u578b\u3001\u795e\u7ecf\u7f51\u7edc\u7b49\u3002\u5728\u5206\u8bcd\u4e2d\u5e38\u7528\u7684\u6709\u611f\u77e5\u673a\u6a21\u578b\u548cCRF\u6a21\u578b\u3002</p>"},{"location":"machine_learning/nlp/tokenize.html#_11","title":"\u5e73\u5747\u611f\u77e5\u673a\u5206\u8bcd\u7b97\u6cd5","text":""},{"location":"machine_learning/nlp/tokenize.html#crf","title":"\u6761\u4ef6\u968f\u673a\u573a\uff08CRF\uff09\u5206\u8bcd\u7b97\u6cd5","text":""},{"location":"machine_learning/nlp/tokenize.html#_12","title":"\u795e\u7ecf\u7f51\u7edc\u5206\u8bcd\u7b97\u6cd5","text":"<p>\u5728NLP\u4e2d\uff0c\u6700\u5e38\u7528\u7684\u795e\u7ecf\u7f51\u7edc\u4e3a\u5faa\u73af\u795e\u7ecf\u7f51\u7edc\uff08RNN\uff0cRecurrent Neural Network\uff09\uff0c\u5b83\u5728\u5904\u7406\u53d8\u957f\u8f93\u5165\u548c\u5e8f\u5217\u8f93\u5165\u95ee\u9898\u4e2d\u6709\u7740\u5de8\u5927\u7684\u4f18\u52bf\u3002LSTM\u4e3aRNN\u53d8\u79cd\u7684\u4e00\u79cd\uff0c\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u89e3\u51b3\u4e86RNN\u5728\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u68af\u5ea6\u6d88\u5931\u548c\u68af\u5ea6\u7206\u70b8\u7684\u95ee\u9898\u3002\u53cc\u5411\uff08Bidirectional\uff09\u5faa\u73af\u795e\u7ecf\u7f51\u7edc\u5206\u522b\u4ece\u53e5\u5b50\u7684\u5f00\u5934\u548c\u7ed3\u5c3e\u5f00\u59cb\u5bf9\u8f93\u5165\u8fdb\u884c\u5904\u7406\uff0c\u5c06\u4e0a\u4e0b\u6587\u4fe1\u606f\u8fdb\u884c\u7f16\u7801\uff0c\u63d0\u5347\u9884\u6d4b\u6548\u679c\u3002</p> <p>\u76ee\u524d\u5bf9\u4e8e\u5e8f\u5217\u6807\u6ce8\u4efb\u52a1\uff0c\u516c\u8ba4\u6548\u679c\u6700\u597d\u7684\u6a21\u578b\u662fBiLSTM+CRF\u3002</p>"},{"location":"machine_learning/nlp/transformer.html","title":"Transformer","text":"<p>Google \u572817\u5e74\u7684 Attention Is All You Need \u8bba\u6587\u4e2d\u63d0\u51fa\uff0c\u5728NLP\u7684\u591a\u4e2a\u4efb\u52a1\u4e0a\u53d6\u5f97\u4e86\u975e\u5e38\u597d\u7684\u6548\u679c\uff0c\u629b\u5f03\u4e86\u4f20\u7edf\u7684CNN\u548cRNN\uff0c\u6574\u4e2a\u7f51\u7edc\u7ed3\u6784\u5b8c\u5168\u662f\u7531Attention\u673a\u5236\u7ec4\u6210\u3002</p>"},{"location":"machine_learning/nlp/transformer.html#_1","title":"\u76f8\u5173\u5de5\u4f5c","text":"<p>\u4e00\u822c\u8bb2\u89e3Transformer\u90fd\u4f1a\u4ee5\u673a\u5668\u7ffb\u8bd1\u4efb\u52a1\u4e3a\u4f8b\u5b50\u8bb2\u89e3</p> <p></p>"},{"location":"machine_learning/nlp/transformer.html#11-seq2seq","title":"1.1 \u65e9\u671fseq2seq","text":"<p>seq2seq\u7ed3\u6784\uff0c\u4e5f\u53ef\u4ee5\u79f0\u4e3aencoder-decoder\u7ed3\u6784</p> <ul> <li>\u65e9\u671f\u4e00\u822c\u662fRNN\u6a21\u5757(\u56e0\u4e3a\u5176\u53ef\u4ee5\u6355\u83b7\u65f6\u5e8f\u4fe1\u606f)\uff0c\u540e\u6765\u5f15\u5165\u4e86LSTM\u6216\u8005GRU\u6a21\u5757\uff1b</li> <li>\u6838\u5fc3\u601d\u60f3\u662f\u901a\u8fc7Encoder\u7f16\u7801\u6210\u4e00\u4e2a\u8868\u793a\u5411\u91cf\uff0c\u7136\u540e\u7531Decoder\u6765\u8fdb\u884c\u89e3\u7801\uff0c\u7ffb\u8bd1\u6210\u76ee\u6807\u8bed\u8a00\u3002</li> </ul> <p>\u7ed3\u6784\u7f3a\u9677\uff1a\uff08\u7f16\u7801\u5355\u5143\u8f93\u51fa\u7684\u9690\u542b\u5411\u91cf\uff0c\u5176\u5305\u542b\u7684\u4fe1\u606f\u6709\u9650\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u590d\u6742\u4efb\u52a1\u53ef\u80fd\u4fe1\u606f\u4e0d\u591f\uff09</p> <ul> <li>\u4e0d\u8bba\u8f93\u5165\u548c\u8f93\u51fa\u7684\u8bed\u53e5\u957f\u5ea6\u662f\u4ec0\u4e48\uff0c\u4e2d\u95f4\u7684\u4e0a\u4e0b\u6587\u5411\u91cf\u957f\u5ea6\u90fd\u662f\u56fa\u5b9a\uff0c\u4e00\u65e6\u957f\u5ea6\u8fc7\u957f\uff0c\u4ec5\u4ec5\u9760\u4e00\u4e2a\u56fa\u5b9a\u957f\u5ea6\u7684\u4e0a\u4e0b\u6587\u5411\u91cf\u660e\u663e\u4e0d\u5408\u7406\uff1b</li> <li>\u4ec5\u4ec5\u5229\u7528\u4e0a\u4e0b\u6587\u5411\u91cf\u89e3\u7801\uff0c\u4f1a\u6709\u4fe1\u606f\u74f6\u9888\uff0c\u957f\u5ea6\u8fc7\u957f\u65f6\u5019\u4fe1\u606f\u53ef\u80fd\u4f1a\u4e22\u5931\u3002</li> </ul>"},{"location":"machine_learning/nlp/transformer.html#12-attentionseq2seq","title":"1.2 \u57fa\u4e8eattention\u7684seq2seq","text":"<p>\u6ce8\u610f\u529b\u673a\u5236Attention\uff1a</p> <ul> <li>\u5047\u8bbe\u7ed9\u5b9a\u4e00\u5f20\u56fe\u7247\uff0c\u6211\u4eec\u4f1a\u81ea\u52a8\u805a\u7126\u5230\u4e00\u4e9b\u5173\u952e\u4fe1\u606f\u4f4d\u7f6e\uff0c\u800c\u4e0d\u9700\u8981\u9010\u884c\u626b\u63cf\u5168\u56fe\uff1b</li> <li>\u672c\u8d28\u662f\u5bf9\u8f93\u5165\u7684\u81ea\u9002\u5e94\u52a0\u6743</li> </ul>"},{"location":"machine_learning/nlp/transformer.html#13-transformerseq2seq","title":"1.3 \u57fa\u4e8etransformer\u7684seq2seq","text":"<p>\u57fa\u4e8eattention\u7684seq2seq\u4e0d\u8db3\uff1a</p> <ul> <li>\u4e0d\u7ba1\u662f\u91c7\u7528RNN\u3001LSTM\u8fd8\u662fGRU\u90fd\u4e0d\u5229\u4e8e\u5e76\u884c\u8bad\u7ec3\u548c\u63a8\u7406\uff0c\u56e0\u4e3a\u76f8\u5173\u7b97\u6cd5\u53ea\u80fd\u4ece\u5de6\u5411\u53f3\u4f9d\u6b21\u8ba1\u7b97\u6216\u8005\u4ece\u53f3\u5411\u5de6\u4f9d\u6b21\u8ba1\u7b97</li> <li>\u957f\u4f9d\u8d56\u4fe1\u606f\u4e22\u5931\u95ee\u9898\uff0c\u987a\u5e8f\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u4fe1\u606f\u4f1a\u4e22\u5931\uff0c\u867d\u7136LSTM\u53f7\u79f0\u6709\u7f13\u89e3\uff0c\u4f46\u662f\u65e0\u6cd5\u5f7b\u5e95\u89e3\u51b3</li> </ul> <p>\u5305\u62ec6\u4e2a\u7ed3\u6784\u5b8c\u5168\u76f8\u540c\u7684\u7f16\u7801\u5668\uff0c\u548c6\u4e2a\u7ed3\u6784\u5b8c\u5168\u76f8\u540c\u7684\u89e3\u7801\u5668\uff0c\u5176\u4e2d\u6bcf\u4e2a\u7f16\u7801\u5668\u548c\u89e3\u7801\u5668\u8bbe\u8ba1\u601d\u60f3\u5b8c\u5168\u76f8\u540c\uff0c\u53ea\u4e0d\u8fc7\u7531\u4e8e\u4efb\u52a1\u4e0d\u540c\u800c\u6709\u4e9b\u8bb8\u533a\u522b\uff0c\u6574\u4f53\u8be6\u7ec6\u7ed3\u6784\u5982\u4e0b\u6240\u793a</p>"},{"location":"machine_learning/nlp/transformer.html#_2","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>3W\u5b57\u957f\u6587\u5e26\u4f60\u8f7b\u677e\u5165\u95e8\u89c6\u89c9transformer</li> </ul>"},{"location":"machine_learning/nlp/hanlp/index.html","title":"HanLP","text":""},{"location":"machine_learning/nlp/hanlp/index.html#1x-java","title":"1.x Java","text":""},{"location":"machine_learning/nlp/hanlp/index.html#maven","title":"maven\u4f9d\u8d56","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.hankcs&lt;/groupId&gt;\n    &lt;artifactId&gt;hanlp&lt;/artifactId&gt;\n    &lt;version&gt;portable-1.7.7&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"machine_learning/nlp/hanlp/index.html#2x-python","title":"2.x Python","text":""},{"location":"machine_learning/platform/kserve.html","title":"\u6a21\u578b\u670d\u52a1KServe","text":"<p>https://github.com/kserve/kserve/blob/master/install/v0.9.0/kserve-runtimes.yaml</p> <p>\u9488\u5bf9\u4e0d\u540c\u7c7b\u578b\u7684ML \u6846\u67b6\uff0c\u63d0\u4f9b\u4e0d\u540c\u7684\u670d\u52a1\u955c\u50cf\u3002</p>"},{"location":"machine_learning/platform/kserve.html#_1","title":"\u67b6\u6784","text":""},{"location":"machine_learning/platform/kserve.html#_2","title":"\u63a7\u5236\u5e73\u9762","text":"<p>\u8d1f\u8d23\u5bf9<code>InferenceService</code>\u81ea\u5b9a\u4e49\u8d44\u6e90\u8fdb\u884c\u8c03\u8c10\u3002</p> <p>IngressClass \u901a\u8fc7 HEADER \u63a7\u5236\u8def\u7531\uff1f</p> <p>serverless mode\uff1acreates the Knative serverless deployment for predictor, transformer, explainer to enable autoscaling</p> <p>raw deployment mode\uff1acreates Kubernetes deployment, service, ingress, HPA.</p> <p>\u7ec4\u4ef6\uff1a</p> <ul> <li>KServe Controller: \u8d1f\u8d23\u521b\u5efa <code>service, ingress resources, model server container and model agent container</code>\uff1b</li> <li>Ingress Gateway:  \u7f51\u5173\uff0c\u8def\u7531\u5916\u90e8/\u5185\u90e8\u7684\u8bf7\u6c42\uff1b</li> </ul> <p>\u5728 Serverless \u6a21\u5f0f\uff1a</p> <ul> <li>Knative Service Controller</li> <li>Knative Activator</li> <li>Knative Autoscaler</li> </ul> <p></p>"},{"location":"machine_learning/platform/kserve.html#_3","title":"\u6570\u636e\u5e73\u9762","text":"<p>\u7ec4\u4ef6\uff1a</p> <ul> <li>Component\uff1aEach endpoint is composed of multiple components: \"predictor\", \"explainer\", and \"transformer\". </li> <li>Predictor\uff1amodel server  available at a network endpoint.</li> <li>Explainer\uff1a provides model explanations in addition to predictions.</li> <li>Transformer\uff1adefine a pre and post processing step before the prediction and explanation workflows.</li> </ul>"},{"location":"machine_learning/platform/kserve.html#prediction-v1-protocol","title":"prediction v1 protocol","text":"API Verb Path Payload Readiness GET /v1/models/ Response:{\"name\": , \"ready\": true/false} Predict POST /v1/models/:predict Request:{\"instances\": []} Response:{\"predictions\": []} Explain POST /v1/models/:explain Request:{\"instances\": []} Response:{\"predictions\": [], \"explainations\": []}"},{"location":"machine_learning/platform/kserve.html#prediction-v2-protocol","title":"prediction v2 protocol","text":"<p>The Predict Protocol, version 2 is a set of HTTP/REST and GRPC APIs for inference / prediction servers.</p> <p>Health:</p> <p>GET <code>v2/health/live</code></p> <p>GET <code>v2/health/ready</code></p> <p>GET <code>v2/models/${MODEL_NAME}[/versions/${MODEL_VERSION}]/ready</code></p> <p>Server Metadata:</p> <p>GET <code>v2</code></p> <p>Model Metadata:</p> <p>GET <code>v2/models/${MODEL_NAME}[/versions/${MODEL_VERSION}]</code></p> <p>Inference:</p> <p>POST <code>v2/models/${MODEL_NAME}[/versions/${MODEL_VERSION}]/infer</code></p>"},{"location":"machine_learning/platform/kserve.html#_4","title":"\u5b89\u88c5","text":""},{"location":"machine_learning/platform/kserve.html#k8s-deployment","title":"k8s deployment","text":"<p>Raw Deployment \u6a21\u5f0f\u4e0b\u4e0d\u9700\u8981 Istio</p> <ul> <li>\u901a\u8fc7\u7ba1\u7406<code>Ingress</code>\uff0c\u63a7\u5236\u8def\u7531\uff0c\u56e0\u6b64\u90e8\u7f72 Ingress-Nginx \u5373\u53ef\u3002</li> </ul>"},{"location":"machine_learning/platform/kserve.html#ingressclass","title":"\u521b\u5efa <code>IngressClass</code>","text":"<p>https://kserve.github.io/website/0.10/admin/kubernetes_deployment/</p> <p>\u4ee5 <code>Nginx</code>\u4e3a\u4f8b\uff0c\u53c2\u8003 https://kubernetes.github.io/ingress-nginx/deploy/#quick-start\uff0c\u6ce8\u610f\u8ddf K8s \u7684\u7248\u672c\u4f9d\u8d56</p> <ul> <li>\u5b89\u88c5 ingress - nginx</li> </ul> <pre><code>helm upgrade --install ingress-nginx ingress-nginx \\\n  --repo https://kubernetes.github.io/ingress-nginx \\\n  --namespace ingress-nginx --create-namespace\n</code></pre> <ul> <li>ingress - nginx \u81ea\u5e26 IngressClass \uff08\u4e0d\u9700\u8981\u65b0\u589e\uff09</li> </ul> <pre><code>apiVersion: networking.k8s.io/v1\nkind: IngressClass\nmetadata:\n  labels:\n    app.kubernetes.io/component: controller\n    app.kubernetes.io/instance: ingress-nginx\n    app.kubernetes.io/name: ingress-nginx\n    app.kubernetes.io/part-of: ingress-nginx\n    app.kubernetes.io/version: 1.5.1\n  name: nginx\nspec:\n  controller: k8s.io/ingress-nginx\n</code></pre>"},{"location":"machine_learning/platform/kserve.html#certmanager-yaml","title":"\u5b89\u88c5 CertManager Yaml","text":"<pre><code>kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.11.0/cert-manager.yaml\n</code></pre>"},{"location":"machine_learning/platform/kserve.html#kserve-yaml","title":"\u5b89\u88c5Kserve Yaml","text":"<pre><code>kubectl apply -f https://github.com/kserve/kserve/releases/download/v0.10.0/kserve.yaml\n\nkubectl apply -f https://github.com/kserve/kserve/releases/download/v0.10.0/kserve-runtimes.yaml\n</code></pre>"},{"location":"machine_learning/platform/kserve.html#_5","title":"kserve","text":""},{"location":"machine_learning/platform/kserve.html#inferenceservice-config","title":"\u4fee\u6539  <code>inferenceservice-config</code>","text":"<p>\u90e8\u7f72\u6a21\u5f0f\u4e3a <code>RawDeployment</code></p> <pre><code>kubectl patch configmap/inferenceservice-config -n kserve --type=strategic -p '{\"data\": {\"deploy\": \"{\\\"defaultDeploymentMode\\\": \\\"RawDeployment\\\"}\"}}'\n</code></pre> <p>ingressClassName \u4e3a\u521b\u5efa\u7684 IngressClass</p> <pre><code>ingress: |-\n{\n    \"ingressClassName\" : \"your-ingress-class\",\n}\n</code></pre>"},{"location":"machine_learning/platform/kserve.html#_6","title":"\u4f7f\u7528","text":""},{"location":"machine_learning/platform/kserve.html#_7","title":"\u6a21\u578b\u652f\u6301","text":"<p>https://kserve.github.io/website/0.10/modelserving/v1beta1/serving_runtime/</p> Model Serving Runtime Exported model HTTP gRPC Default Serving Runtime Version Supported Framework (Major) Version(s) Examples Custom ModelServer -- v1, v2 v2 -- -- Custom Model LightGBM MLServer Saved LightGBM Model v2 v2 v1.0.0 (MLServer) 3 LightGBM Iris V2 LightGBM ModelServer Saved LightGBM Model v1 -- v0.10 (KServe) 3 LightGBM Iris MLFlow ModelServer Saved MLFlow Model v2 v2 v1.0.0 (MLServer) 1 MLFLow wine-classifier PMML ModelServer PMML v1 -- v0.10 (KServe) 3, 4 (PMML4.4.1) SKLearn PMML SKLearn MLServer Pickled Model v2 v2 v1.0.0 (MLServer) 1 SKLearn Iris V2 SKLearn ModelServer Pickled Model v1 -- v0.10 (KServe) 1 SKLearn Iris TFServing TensorFlow SavedModel v1 *tensorflow 2.6.2 (TFServing Versions) 2 TensorFlow flower TorchServe Eager Model/TorchScript v1, v2, *torchserve *torchserve 0.7.0 (TorchServe) 1 TorchServe mnist Triton Inference Server TensorFlow,TorchScript,ONNX v2 v2 21.09-py3 (Triton) 8 (TensoRT), 1, 2 (TensorFlow), 1 (PyTorch), 2 (Triton) Compatibility Matrix Torchscript cifar XGBoost MLServer Saved Model v2 v2 v1.0.0 (MLServer) 1 XGBoost Iris V2 XGBoost ModelServer Saved Model v1 -- v0.10 (KServe) 1 XGBoost Iris"},{"location":"machine_learning/platform/kserve.html#_8","title":"\u5355\u6a21\u578b\u90e8\u7f72","text":"<p>\u6a21\u578b\u670d\u52a1\u8fd0\u884c\u65f6\uff1a\u9488\u5bf9\u4e0d\u540c\u6846\u67b6 sklearn, tensorflow, pytorch, mlflow \u90fd\u63d0\u4f9b\u4e0d\u540c\u7684CRD\uff0c\u8fd0\u884c\u4e0d\u540c\u7684\u955c\u50cf\uff1b</p> <pre><code>apiVersion: \"serving.kserve.io/v1beta1\"\nkind: \"InferenceService\"\nmetadata:\n  name: \"flower-sample\"\n  namespace: default\nspec:\n  predictor:\n    model:\n      modelFormat:\n        name: tensorflow\n      storageUri: \"s3://kfserving-examples/models/tensorflow/flowers\"\n      # \u4fee\u6539\u8fd0\u884c\u65f6\u955c\u50cf\u7684\u7248\u672c\u53f7\n      runtimeVersion: 2.7.1\n</code></pre> <p>kubectl apply \u540e\u901a\u8fc7 <code>kubectl get isvc flower-example</code> \u67e5\u770b\u72b6\u6001</p> <pre><code>$ kubectl get isvc flower-sample\nNAME            URL                                        READY   PREV   LATEST   PREVROLLEDOUTREVISION        LATESTREADYREVISION                     AGE\nflower-sample   http://flower-sample.default.example.com   True           100       \n</code></pre> <p>\u63a5\u53e3\u8c03\u7528</p> <pre><code>MODEL_NAME=flower-sample\nINPUT_PATH=@./input.json\nSERVICE_HOSTNAME=$(kubectl get inferenceservice ${MODEL_NAME} -o jsonpath='{.status.url}' | cut -d \"/\" -f 3)\n\ncurl -v -H \"Host: ${SERVICE_HOSTNAME}\" http://${INGRESS_HOST}:${INGRESS_PORT}/v1/models/$MODEL_NAME:predict -d $INPUT_PATH\n</code></pre> <p>\u5176\u4e2d\u8f93\u5165\u6570\u636e\u683c\u5f0f\u4e3a\uff1a</p> <pre><code>{  \n    \"instances\":[  \n       {  \n          \"image_bytes\":{  \n              \"b64\": ...\n           },\n           \"key\":\"   1\"\n       }\n    ]\n}\n</code></pre>"},{"location":"machine_learning/platform/kserve.html#_9","title":"\u591a\u6a21\u578b\u90e8\u7f72","text":"<p>\u9ed8\u8ba4\u6a21\u5f0f\u662f'one model, one server' paradigm\uff0c\u5f53\u6a21\u578b\u8fc7\u591a\uff0c\u4f1a\u51fa\u73b0\uff1a</p> <ul> <li><code>Compute resource limitation</code>\uff1acpu/gpu \u7684\u8d44\u6e90\u9650\u5236</li> <li><code>Maximum pods limitation</code></li> <li>Kubelet has a maximum number of pods per node with the default limit set to 110\uff0c\u4e0d\u5efa\u8bae\u8d85\u8fc7 100\uff1b</li> <li><code>Maximum IP address limitation</code>.</li> <li>Each pod in InferenceService needs an independent IP.</li> </ul>"},{"location":"machine_learning/platform/kserve.html#_10","title":"\u4e8c\u8fdb\u5236\u6570\u636e","text":""},{"location":"machine_learning/platform/kserve.html#_11","title":"\u793a\u4f8b","text":""},{"location":"machine_learning/platform/kserve.html#_12","title":"\u57fa\u7840","text":"<p>\u521b\u5efa\u6a21\u578b\u7684 PV \u548cPVC</p> <pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: kserve-demo-pv\n  labels:\n    type: local\nspec:\n  storageClassName: manual\n  capacity:\n    storage: 2Gi\n  accessModes:\n    - ReadWriteOnce\n  hostPath:\n    path: \"/home/liuzhiqiang/tensorflow-serving/serving/tensorflow_serving/servables/tensorflow/testdata\"\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - ${NODE_NAME} \n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: kserve-demo-pvc\nspec:\n  storageClassName: manual\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 1Gi\n</code></pre> <p>\u521b\u5efa InferenceService</p> <pre><code>apiVersion: \"serving.kserve.io/v1beta1\"\nkind: \"InferenceService\"\nmetadata:\n  name: \"tensorflow-kserve\"\nspec:\n  predictor:\n    model:\n      modelFormat:\n        name: tensorflow\n      storageUri: \"pvc://kserve-demo-pvc/saved_model_half_plus_two_cpu\"\n</code></pre> <p>\u67e5\u770b\u90e8\u7f72\u72b6\u6001</p> <pre><code>$ kubectl get isvc tensorflow-kserve\nNAME            URL                                             READY     ...           AGE\ntensorflow-pvc   http://tensorflow-kserve-default.example.com   True                2m15s\n</code></pre>"},{"location":"machine_learning/platform/kserve.html#ingress","title":"Ingress \u914d\u7f6e","text":"<p>InferenceService\u7684annotation\u4f1a\u6dfb\u52a0\u5230 Ingress \u7684 annotation\uff0c\u56e0\u6b64\u901a\u8fc7\u5bf9 InferenceService \u6dfb\u52a0\u6ce8\u89e3\uff0c\u5b9e\u73b0\u5bf9 Nginx Ingress Controller\u7684\u8def\u7531\u7684\u914d\u7f6e\u5b9a\u4e49\u3002</p>"},{"location":"machine_learning/platform/kserve.html#_13","title":"\u6a21\u578b\u5b58\u50a8","text":"<p>\u652f\u6301 S3\uff0c PVC \u548c URI\u3002</p> <p>\u901a\u8fc7 <code>webhook</code>\u4fee\u6539container\uff0c\u6ce8\u5165<code>initConatainer</code>\uff08<code>kserve/storage-initializer</code>\uff09</p> <ul> <li>\u901a\u8fc7<code>emptyDir</code>\u5c06\u6a21\u578b\u6570\u636e\u5728<code>initContainer</code>\u548c<code>container</code>\u95f4\u4f20\u9012\u3002</li> </ul>"},{"location":"machine_learning/platform/kserve.html#transformers","title":"Transformers","text":"<p>an <code>InferenceService</code> component which does pre/post processing alongside with model inference</p> <ul> <li>transformer service calls to predictor service</li> </ul> <p>\u5bf9\u8f93\u5165\u6570\u636e\u505a\u9884\u5904\u7406/\u540e\u5904\u7406\u3002</p> <p><code>Kserve.Model</code>\u5b9a\u4e49\u4e09\u4e2a handlers\uff0c<code>preprocess</code>, <code>predict</code> \u548c <code>postprocess</code>\uff0c\u987a\u5e8f\u6267\u884c\uff0c\u4e14\u4e0a\u4e2a\u8f93\u51fa\u4f5c\u4e3a\u4e0b\u4e2a\u8f93\u5165\u3002</p> <ul> <li><code>predict</code>\u9ed8\u8ba4\u662f\u901a\u8fc7\u83b7\u53d6<code>predict_host</code>\u8fdb\u884c rest/grpc \u8c03\u7528\uff1b</li> <li><code>predict_host</code>\u9ed8\u8ba4\u4f1a\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\uff0c\u9ed8\u8ba4<code>REST</code>\u8c03\u7528\uff1b</li> </ul> <p>\u81ea\u5b9a\u4e49\u8f6c\u6362\u793a\u4f8b</p>"},{"location":"machine_learning/platform/kserve.html#inferencegraph","title":"InferenceGraph","text":"<p>consist of many models to make a single prediction. </p> <ul> <li>e.g. a face recognition pipeline may need to first locate faces in a image, then compute the features of the faces to match records in a database</li> </ul> <p>\u793a\u4f8b</p> <p>https://kserve.github.io/website/0.10/modelserving/inference_graph/image_pipeline/#deploy-inferencegraph</p>"},{"location":"machine_learning/platform/kserve.html#_14","title":"\u6a21\u578b\u89e3\u91ca","text":""},{"location":"machine_learning/platform/kubedl.html","title":"KubeDL","text":"<p>CNCF sandbox project\uff1aKubeDL makes deep learning workloads run on Kubernetes more easily and efficiently.</p> <p>\u6700\u65b0\u7684 Release\uff1av-0.5.0, Dec 5, 2022\uff0c\u5f53\u524d\u6d3b\u8dc3\u5ea6\u4e0d\u9ad8</p> <p>\u963f\u91cc\u5f00\u6e90\u7684\u57fa\u4e8e Kubernetes \u7684 AI \u5de5\u4f5c\u8d1f\u8f7d\u7ba1\u7406\u6846\u67b6\uff1a</p> <ul> <li>\u8bad\u7ec3\uff08Training\uff09\uff1a\u652f\u6301 Gang-Scheduling / Cron Scheduling\uff0c\u652f\u6301\u5bbf\u4e3b\u673a\u7f51\u7edc\u901a\u4fe1\uff1b</li> <li>\u6a21\u578b\u7ba1\u7406\uff08Model\uff09\uff1a\u652f\u6301 LocalPath \u548c NFS\uff1b</li> <li>\u63a8\u7406\uff08Serving\uff09\uff1a\u652f\u6301 A/B Test\uff08\u57fa\u4e8e Istio VirtualService\uff09\uff1b</li> </ul>"},{"location":"machine_learning/platform/kubedl.html#_1","title":"\u67b6\u6784","text":""},{"location":"machine_learning/platform/kubedl.html#_2","title":"\u8bad\u7ec3","text":"<p>\u8c03\u5ea6\uff1a</p> <ul> <li> <p>\u652f\u6301\u5b9a\u65f6\u8c03\u5ea6\u8fd0\u884c\uff1b</p> </li> <li> <p>GangScheduling\uff1a\u4e0e Coscheduling Scheduling Plugin, YuniKorn, Volcano, KubeBatch \u96c6\u6210\uff1b</p> </li> </ul> <p>Job Events \u6301\u4e45\u5316\uff1a\u5f53\u524d\u4ec5\u652f\u6301 <code>aliyun-sls</code></p> <ul> <li>\u9ed8\u8ba4 k8s \u5c06 events \u4ec5\u6301\u4e45\u53163 \u5c0f\u65f6\uff1b</li> </ul> <p>Job Metadata \u6301\u4e45\u5316\uff1a\u5f53\u524d\u4ec5\u652f\u6301 MySQL</p> <ul> <li>Kubernetes api-server \u901a\u5e38\u5728\u6709\u9650\u7684\u751f\u547d\u5468\u671f\u5185\u5b58\u50a8 Job \u4fe1\u606f\uff1b</li> </ul>"},{"location":"machine_learning/platform/kubedl.html#_3","title":"\u6a21\u578b","text":"<p>\u7528\u6237\u624b\u52a8\u521b\u5efa Model CRD \u6216\u8005\u7531 TrainingJob \u81ea\u52a8\u521b\u5efa</p> <ul> <li>\u89e6\u53d1 Kaniko \u6784\u5efa Model \u7684\u955c\u50cf\uff1b</li> </ul> <p></p>"},{"location":"machine_learning/platform/kubedl.html#_4","title":"\u63a8\u7406","text":"<ul> <li>\u6ce8\u5165 model-loader\u7684 init \u5bb9\u5668\u8fdb\u884c\u6a21\u578b\u52a0\u8f7d\uff1b</li> <li>\u4f7f\u7528 Istio \u7684 VirtualService \u8fdb\u884c\u6d41\u91cf\u63a7\u5236\uff1b</li> </ul>"},{"location":"machine_learning/platform/label_annotation.html","title":"\u6570\u636e\u6807\u6ce8","text":""},{"location":"machine_learning/platform/label_annotation.html#label-studio","title":"Label-Studio","text":"<p>a multi-type data labeling and annotation tool with standardized output format.</p>"},{"location":"machine_learning/platform/mlflow.html","title":"ML Flow","text":"<p>ML Flow\uff0c\u8be6\u7ec6\u5185\u5bb9\u6574\u7406\u89c1 MLflow\uff1a\u673a\u5668\u5b66\u4e60\u7684\u5168\u751f\u547d\u5468\u671f\u7684\u5f00\u6e90\u5e73\u53f0.ppt</p> <p>\u7ba1\u7406\u673a\u5668\u5b66\u4e60\u5168\u751f\u547d\u5468\u671f</p> <ul> <li>\u8bb0\u5f55\u5e76\u67e5\u8be2\u7ed3\u679c\uff1a\u4ee3\u7801\u3001\u6570\u636e\u3001\u914d\u7f6e\u3001\u7ed3\u679c\uff1b</li> <li>\u53ef\u5728\u4efb\u4f55\u5e73\u53f0\u4e0a\u91cd\u590d\u8fd0\u884c\u7684\u6253\u5305\u683c\u5f0f\uff1b</li> <li>\u5c06\u6a21\u578b\u53d1\u9001\u5230\u5404\u79cd\u90e8\u7f72\u5de5\u5177\u7684\u901a\u7528\u683c\u5f0f </li> </ul> <p>\u5e95\u5c42\u5bf9\u63a5\u591a\u79cdML\u5e93\uff0c\u4f46\u662f\u6a21\u578b\u4e0d\u80fd\u5728\u4e0d\u540c\u5e93\u4e2d\u4f7f\u7528\uff1b</p> <ul> <li>MLFlow Tracking\uff1a\u8bb0\u5f55\u548c\u67e5\u8be2\u5b9e\u9a8c\u7ed3\u679c\uff08\u5982\u4ee3\u7801\uff0c\u914d\u7f6e\uff0c\u7b97\u6cd5\u7ed3\u679c\u7b49\uff09\uff0c\u89e3\u51b3\u6a21\u578b\u53c2\u6570\u3001\u6307\u6807\u8bb0\u5f55\u7e41\u7410\uff0c\u4e14\u96be\u4ee5\u76f4\u89c2\u5bf9\u6bd4\u7684\u95ee\u9898\uff1b</li> <li>MLFlow Projects\uff1a\u6253\u5305\u683c\u5f0f\uff0c\u53ef\u4ee5\u5728\u4efb\u610f\u5e73\u53f0\u4e0a\u91cd\u73b0\u5b9e\u9a8c\u7ed3\u679c\uff0c\u89e3\u51b3ML\u7ed3\u679c\u96be\u4ee5\u91cd\u73b0\u7684\u95ee\u9898\uff1b</li> <li>MLFlow Models\uff1a\u901a\u7528\u7684\u6a21\u578b\u683c\u5f0f\uff0c\u652f\u6301\u591a\u79cd\u90e8\u7f72\u5de5\u5177\uff0c\u89e3\u51b3\u6a21\u578b\u53d1\u5e03/\u90e8\u7f72\u96be\u7684\u95ee\u9898\uff1b</li> <li>MLFlow Model Registry\uff1a\u6a21\u578b\u6765\u6e90\u548c\u7248\u672c\u7ba1\u7406\u7684\u95ee\u9898\uff1b</li> </ul> <p>\u4eae\u70b9\uff1a</p> <ul> <li>\u7edf\u4e00\u7684\u6a21\u578b\u5b58\u50a8\u89c4\u8303\uff0c\u652f\u6301\u591a\u79cd\u5e95\u5c42\u5e93\uff1b</li> <li>\u6a21\u578b\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff1b</li> <li>\u53c2\u6570\u548c\u7ed3\u679c\u53ef\u89c6\u5316\uff1b</li> </ul>"},{"location":"machine_learning/platform/mlflow.html#mlflow-tracking","title":"MLFlow Tracking","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cmlflow python API logs\u7684\u8fd0\u884c\u7ed3\u679c\u4fdd\u5b58\u5728\u672c\u5730\uff08\u8fd0\u884c\u7ed3\u675f\u540e\uff0c\u76f4\u63a5\u901a\u8fc7mlflow run\u67e5\u770b\uff09\u3002</p> <p>\u53ef\u4ee5\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf<code>MLFLOW_TRACKING_URI</code>\u6216\u8005\u8c03\u7528<code>mlflow.set_tracking_url()</code>\u5c06 logs \u7684\u7ed3\u679c\u4fdd\u5b58\u5230\u8fdc\u7a0bTracking Server\u3002</p> <p>remote tracking URIs \u652f\u6301\uff1a</p> <ul> <li>\u672c\u5730\u6587\u4ef6\u5b58\u50a8\uff0c\u5982<code>file:/my/local/dir</code>\uff1b</li> <li>db\u5b58\u50a8\uff0c<code>&lt;dialect&gt;+&lt;driver&gt;://&lt;username&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;database&gt;</code>\uff1b</li> <li>http server\uff0c\u5373 MLflow tracking server \u5730\u5740\uff1b</li> </ul>"},{"location":"machine_learning/platform/mlflow.html#tracking-server","title":"Tracking Server","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cmlflow \u4f7f\u7528 Local FS \u4f5c\u4e3a Backend / Artifact Store\uff1b</p> <p>Backend Store\uff1a\u5143\u6570\u636e\uff08\u5982\u5b9e\u9a8c\u548c\u8fd0\u884c\u7684\u53c2\u6570\u3001\u6307\u6807\u3001\u6807\u7b7e\u7b49\uff09\u5b58\u50a8</p> <ul> <li>\u6587\u4ef6\u5b58\u50a8\uff08\u53ea\u652f\u6301Local FileSystem\uff09</li> <li>SQL\u5b58\u50a8\uff08\u517c\u5bb9SQLAlchemy\uff0c\u652f\u6301mysql\uff0cpostgresql\uff0csqlite\u7b49\uff09\uff0c\u53ea\u6709SQL\u624d\u80fd\u652f\u6301\u6a21\u578b\u6ce8\u518c</li> </ul> <p>Artifact Store\uff1a\u6570\u636e\u548c\u6a21\u578b\u7684\u5b58\u50a8</p> <ul> <li>S3\uff0cAzure Blob\uff0cGoogle Cloud\uff1bFTP\uff0cSFTP\uff1b</li> <li>Local FS\uff0cNFS\uff0cHDFS</li> </ul> <p><code>no-serve-artifacts</code></p> <ul> <li>\u914d\u7f6e\u4ee3\u7406\uff0c\u4e0d\u5c06<code>artifact</code>\u7684\u64cd\u4f5c\u901a\u8fc7Tracking Server \u8fdb\u884c proxy\uff0c\u800c\u662f\u8fd4\u56de\u76f8\u5173\u8def\u5f84\uff0c\u7531Client\u76f4\u63a5\u8ddfArtifact Store\u4ea4\u4e92\uff1b</li> </ul> <pre><code>mlflow server --backend-store-uri /mnt/persistent-disk --default-artifact-root s3://my-flow-bucket/ --host 0.0.0.0 --no-serve-artifacts\n</code></pre>"},{"location":"machine_learning/platform/mlflow.html#api-logging","title":"API Logging","text":"<p>experiment \u5b9e\u9a8c\uff0c\u5305\u542b\u591a\u4e2arun\uff08\u9ed8\u8ba4\u5b58\u5728<code>default</code>\uff09\uff1b</p> <p>run : \u5355\u6b21\u8fd0\u884c\uff0cstart_run \u4f1a\u8fd4\u56de\u5f53\u524d\u7684run\uff08\u5982\u679c\u4e0d\u5b58\u5728\u5219\u521b\u5efa\u4e00\u4e2a\uff09\uff1b</p> <p>no need to call <code>start_run</code> explicitly, calling one of the logging functions with no active run automatically starts a new one.</p> <p></p>"},{"location":"machine_learning/platform/mlflow.html#automatic-logging","title":"Automatic Logging","text":"<p>\u81ea\u52a8\u8bb0\u5f55\u53c2\u6570\u3001\u6307\u6807\u548c\u6a21\u578b\uff0c\u65e0\u9700\u663e\u5f0f\u4ee3\u7801\u8bb0\u5f55\u3002</p> <p>\u652f\u6301\uff1a</p> <ul> <li>Scikit-learn</li> <li>Keras</li> <li>Gluon</li> <li>XGBoost</li> <li>LightGBM</li> <li>Statsmodels</li> <li>Spark</li> <li>Fastai</li> <li>Pytorch</li> </ul> <pre><code>import mlflow\nmlflow.autolog()\n</code></pre>"},{"location":"machine_learning/platform/mlflow.html#mlflow-projects","title":"Mlflow Projects","text":"<p>project environments: </p> <ul> <li>Virtualenv environment</li> <li>system environment</li> <li>Docker container environment : \u4f1a\u62f7\u8d1dproject\u5185\u5bb9\u5230<code>/mlflow/projects/code</code>\u76ee\u5f55\u4e0b\uff0c\u5e76\u751f\u6210\u65b0\u7684\u955c\u50cf\u5e76\u8fd0\u884c\uff1b</li> <li>conda environment</li> </ul> <p>Project File \uff1a<code>MLproject</code></p> <pre><code>name: My Project\n\nconda_env: my_env.yaml\n# or\n# docker_env:\n#    image:  mlflow-docker-example\n#    environment: [[\"NEW_ENV_VAR\", \"new_var_value\"], \"VAR_TO_COPY_FROM_HOST_ENVIRONMENT\"]\n\n\nentry_points:\n  main:\n    parameters:\n      data_file: path\n      regularization: {type: float, default: 0.1}\n    command: \"python train.py -r {regularization} {data_file}\"\n  validate:\n    parameters:\n      data_file: path\n    command: \"python validate.py {data_file}\"\n</code></pre>"},{"location":"machine_learning/platform/mlflow.html#_1","title":"\u8fd0\u884c","text":""},{"location":"machine_learning/platform/mlflow.html#k8s","title":"K8s \u8fd0\u884c","text":"<p>\u91cd\u65b0\u751f\u6210\u955c\u50cf\uff0c\u4e0a\u4f20\u5230\u955c\u50cf\u4ed3\u5e93\u4e2d\uff0c\u5e76\u542f\u52a8 K8s Job\uff1b</p> <ul> <li>\u4f7f\u7528 <code>docker_env</code></li> </ul> <p><code>kubernetes_config.json</code> \u5143\u4fe1\u606f\u6587\u4ef6\uff1a</p> <ul> <li><code>kube-context</code>\uff1ak8s \u8fd0\u884c\u73af\u5883\u4fe1\u606f\uff1b\uff08in-cluster\u5f62\u5f0f\u65f6\uff0c\u4f7f\u7528\u5f53\u524dpod\u7684service account\uff09\uff1b</li> <li><code>repository-uri</code>\uff1a\u955c\u50cf\u4ed3\u5e93\u5730\u5740\uff1b</li> <li><code>kube-job-template-path</code>\uff1ak8s job yaml\u7684\u8def\u5f84\uff1b</li> </ul> <p>\u6267\u884c\u547d\u4ee4</p> <pre><code># &lt;project_uri&gt; is a Git repository URI or a folder\nmlflow run &lt;project_uri&gt; --backend kubernetes --backend-config examples/docker/kubernetes_config.json\n</code></pre>"},{"location":"machine_learning/platform/mlflow.html#mlflow-model","title":"MLflow Model","text":""},{"location":"machine_learning/platform/mlflow.html#_2","title":"\u5b58\u50a8\u683c\u5f0f","text":"<pre><code># Directory written by mlflow.sklearn.save_model(model, \"my_model\")\nmy_model/\n\u251c\u2500\u2500 MLmodel\n\u251c\u2500\u2500 model.pkl\n\u251c\u2500\u2500 conda.yaml\n\u251c\u2500\u2500 python_env.yaml\n\u2514\u2500\u2500 requirements.txt\n</code></pre>"},{"location":"machine_learning/platform/mlflow.html#_3","title":"\u4fdd\u5b58\u548c\u52a0\u8f7d\u6a21\u578b","text":"<p>\u4fdd\u5b58\u548c\u52a0\u8f7d\u6a21\u578b</p> <pre><code>mlflow.&lt;&gt;.save_model   \u4fdd\u5b58\u6a21\u578b\u5230\u672c\u5730\nmlflow.&lt;&gt;.log_model    \u4f5c\u4e3a artifact \u5b58\u50a8\nmlflow.&lt;&gt;.load_module  \u4ece\u672c\u5730\u6216\u8005artifact\u4e2d\u52a0\u8f7d\u6a21\u578b\n</code></pre>"},{"location":"machine_learning/platform/mlflow.html#_4","title":"\u90e8\u7f72","text":"<p>\u652f\u6301 \u672c\u5730\u90e8\u7f72 \u6216\u8005\u751f\u6210Docker \u955c\u50cf\u3002</p> <ul> <li>\u672c\u5730\u90e8\u7f72</li> </ul> <pre><code>mlflow models serve -m runs:/a4599bb9b3ea4ee9b2f20a56a607fcec/model\n\nmlflow models serve -m \"models:/sk-learn-random-forest-reg-model/Production\"\n</code></pre> <ul> <li>\u6784\u5efa docker \u955c\u50cf</li> </ul> <pre><code>mlflow models build-docker -m my_model -n my-model \n</code></pre> <p><code>Rest API</code>\u5b9a\u4e494\u4e2a\u63a5\u53e3\uff1a</p> <ul> <li><code>/ping</code> used for health check</li> <li><code>/health</code> (same as /ping)</li> <li><code>/version</code> used for getting the mlflow version</li> <li><code>/invocations</code> used for scoring</li> </ul> <p>MLServer \u901a\u8fc7  <code>/invocations</code> endpoint</p> <pre><code># \u5b89\u88c5 extras \u5e93\npip install mlflow[extras]\n\nmlflow models build-docker -m my_model --enable-mlserver -n my-model\nmlflow models serve -m my_model --enable-mlserver\n</code></pre>"},{"location":"machine_learning/platform/mlflow.html#mlflow-model-registry","title":"MLflow Model Registry","text":"<p>\u7ba1\u7406\u6a21\u578b\u7684\u751f\u547d\u5468\u671f</p> <ul> <li>\u6a21\u578b\u6765\u6e90\u548c\u7248\u672c\u7ba1\u7406\u7684\u95ee\u9898\u6a21\u578b\u7248\u672c\u6a21\u578b\u6765\u6e90\u6a21\u578b\u9636\u6bb5\uff08Staging, Production, Archived\uff09</li> </ul> <pre><code># Log the sklearn model and register as version 1\nmlflow.sklearn.log_model(\n        sk_model=sk_learn_rfr,\n        artifact_path=\"sklearn-model\",\n        registered_model_name=\"sk-learn-random-forest-reg-model\"\n)\n\n# \u6ce8\u518c\u6a21\u578b\nresult = mlflow.register_model(\n    \"runs:/d16076a3ec534311817565e6527539c0/sklearn-model\",\n    \"sk-learn-random-forest-reg\"\n)\n\n# \u65b9\u5f0f3\uff1a\u901a\u8fc7Client\u6ce8\u518c\u6a21\u578b\nfrom mlflow import MlflowClient\n\nclient = MlflowClient()\nclient.create_registered_model(\"sk-learn-random-forest-reg-model\")\nresult = client.create_model_version(\n    name=\"sk-learn-random-forest-reg-model\",\n    source=\"mlruns/0/d16076a3ec534311817565e6527539c0/artifacts/sklearn-model\",\n    run_id=\"d16076a3ec534311817565e6527539c0\"\n)\n</code></pre>"},{"location":"machine_learning/platform/model_explain.html","title":"\u6a21\u578b\u89e3\u91ca","text":""},{"location":"machine_learning/platform/model_explain.html#alibi-explainer","title":"Alibi Explainer","text":""},{"location":"machine_learning/platform/model_explain.html#ai-explainability-360-aix360","title":"AI Explainability 360 (AIX360)","text":""},{"location":"machine_learning/platform/Kubeflow/kubeflow.html","title":"Kubeflow","text":"<p>The Machine Learning Toolkit for Kubernetes</p> <p>Kubeflow is an open, community driven project to make it easy to deploy and manage an ML stack on Kubernetes</p>"},{"location":"machine_learning/platform/Kubeflow/kubeflow.html#_1","title":"\u67b6\u6784","text":""},{"location":"machine_learning/platform/Kubeflow/kubeflow.html#_2","title":"\u7ec4\u4ef6","text":""},{"location":"machine_learning/platform/Kubeflow/kubeflow.html#notebook","title":"Notebook","text":""},{"location":"machine_learning/platform/Kubeflow/kubeflow.html#pipelines","title":"Pipelines","text":"<p>\u5c06\u673a\u5668\u5b66\u4e60\u7684\u5404\u4e2a\u9636\u6bb5\u8fdb\u884c\u4e32\u8054\uff0c\u540c\u65f6\u63d0\u4f9b\u4e86\u4e0b\u8ff0\u80fd\u529b\uff1a</p> <ul> <li>\u4efb\u52a1\u7f16\u6392\uff1a\u901a\u8fc7argo\u63d0\u4f9bworkflow\u7684\u80fd\u529b\uff0c\u80fd\u591f\u5b9e\u73b0\u4e30\u5bcc\u591a\u6837\u7684DAG \u5de5\u4f5c\u6d41\uff0c\u7528\u6237\u53ef\u4ee5\u6839\u636e\u7684\u4e1a\u52a1\u9700\u6c42\u5b9a\u4e49\u3001\u7ba1\u7406\u548c\u590d\u7528\u81ea\u5df1\u5de5\u4f5c\u6d41\uff1b</li> <li>\u5b9e\u9a8c\u7ba1\u7406\uff1a\u901a\u8fc7Experiments\u7684\u80fd\u529b\uff0c\u80fd\u591f\u5c55\u793a\u548c\u5bf9\u6bd4\u4e0d\u540c\u5b9e\u9a8c\u53c2\u6570\uff08\u4f8b\u5982\uff1a\u6a21\u578b\u8d85\u53c2\uff09\u4e0bPipeline\u7684\u8fd0\u884c\u7ed3\u679c\uff0c\u7528\u6237\u6839\u636e\u7ed3\u679c\u6765\u5bf9\u5de5\u4f5c\u6d41\u4efb\u52a1\u8fdb\u884c\u8c03\u4f18\uff1b</li> <li>\u6a21\u578b\u8ffd\u6eaf\uff1a\u901a\u8fc7Tracking\u7684\u80fd\u529b\uff0c\u80fd\u591f\u8bb0\u5f55\u6bcf\u4e00\u6b21Pipeline\u8fd0\u884c\u4e2d\u6bcf\u4e2astep\u7684\u8f93\u5165\u548c\u8f93\u51fa\u4fe1\u606f\uff0c\u7528\u6237\u53ef\u4ee5\u6839\u636e\u8bb0\u5f55\u7684\u5185\u5bb9\u8fdb\u884c\u95ee\u9898\u6392\u67e5\u6216\u6a21\u578b\u8c03\u4f18\uff1b</li> </ul> <p></p>"},{"location":"machine_learning/platform/Kubeflow/kubeflow.html#_3","title":"\u539f\u7406","text":"<p>\u63d0\u4f9bPython\u7684 SDK \u8ba9\u7528\u6237\u6765\u5feb\u901f\u6784\u5efa\u7b26\u5408\u81ea\u5df1\u4e1a\u52a1\u573a\u666f\u7684Pipeline.</p> <ul> <li>\u901a\u8fc7\u4ee3\u7801\u6784\u5efa Pipeline \u7684 py \u6587\u4ef6\uff0c\u6267\u884c\u540e\u751f\u6210 argo workflow \u7684 yaml\uff1b</li> <li>\u63d0\u4f9b<code>@func_to_container_op</code>\u6ce8\u89e3\u5c06 python \u51fd\u6570\u8f6c\u4e3a <code>container</code>\uff08Argo workflow\uff09\uff1b</li> </ul>"},{"location":"machine_learning/platform/Kubeflow/kubeflow.html#_4","title":"\u6a21\u5757","text":"<ul> <li> <p>Pipeline web server &amp; Pipline Service\uff1a</p> </li> <li> <p>\u7528\u6765\u521b\u5efa\u3001\u7ba1\u7406\u548c\u5c55\u793apipeline\u3001experiments\u3001runs\u548cartifacts\u7b49\u4fe1\u606f\uff1b</p> </li> <li> <p>Pipeline Persistence Agent\uff1a</p> </li> <li> <p>\u7528\u6765watch pipeline\u6267\u884c\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u5e76\u5411\u4fe1\u606f\u5199\u5165\u5230 Mysql \u548c ml metada \u4e2d\uff1b</p> </li> <li> <p>orchestration controllers\uff1a</p> </li> <li> <p>Kubeflow Pipelines\u6240\u4f7f\u7528\u7684controller\uff0c\u5178\u578b\u7684\u5982Argo Workflow controller\u7528\u6765\u6267\u884cworkflow\u3001Scheduler Workflow Controller\u7528\u6765\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\uff1b</p> </li> <li> <p>Artifact storage\uff1a</p> </li> <li> <p>\u5b58\u50a8\u6bcf\u6b21pipeline\u8fd0\u884c\u7684input\u3001output\u548c\u65e5\u5fd7\u7b49\u4fe1\u606f\uff1b</p> </li> </ul>"},{"location":"machine_learning/platform/Kubeflow/kubeflow.html#_5","title":"\u5b58\u50a8","text":"<p>MYSQL\uff1a\u5e73\u53f0\u8fd0\u884c\u7684\u4fe1\u606f\u7684\u5b58\u50a8\uff1b</p> <p>MINIO\uff1a\u4e2d\u95f4\u7ed3\u679c\u6570\u636e\u5b58\u50a8\uff1b</p>"},{"location":"machine_learning/platform/Kubeflow/kubeflow.html#_6","title":"\u6570\u636e\u7684\u8bfb\u53d6","text":""},{"location":"machine_learning/platform/Kubeflow/kubeflow.html#_7","title":"\u6570\u636e\u7684\u4f20\u8f93","text":"<p>\u901a\u8fc7 Argo \u5b9e\u73b0\u3002</p>"},{"location":"machine_learning/platform/Kubeflow/kubeflow.html#experiments","title":"Experiments","text":""},{"location":"machine_learning/platform/Kubeflow/kubeflow.html#katib","title":"Katib","text":""},{"location":"machine_learning/platform/Kubeflow/kubeflow.html#_8","title":"\u4f7f\u7528","text":""},{"location":"machine_learning/platform/Kubeflow/kubeflow.html#pipeline","title":"Pipeline","text":""},{"location":"machine_learning/platform/Kubeflow/kubeflow.html#_9","title":"\u5b89\u88c5","text":""},{"location":"machine_learning/platform/Kubeflow/kubeflow.html#pipeline_1","title":"Pipeline","text":"<pre><code>export PIPELINE_VERSION=1.8.5\nkubectl apply -k \"github.com/kubeflow/pipelines/manifests/kustomize/cluster-scoped-resources?ref=$PIPELINE_VERSION\"\nkubectl wait --for condition=established --timeout=60s crd/applications.app.k8s.io\nkubectl apply -k \"github.com/kubeflow/pipelines/manifests/kustomize/env/dev?ref=$PIPELINE_VERSION\"\n</code></pre>"},{"location":"machine_learning/platform/submarine/submarine.html","title":"Apache Submarine","text":"<p>Cloud Native Machine Learning Platform</p> <p>Apache Submarine is a unified AI platform which allows engineers and data scientists to run Machine Learning and Deep Learning workload in distributed cluster.</p> <p>\u5728\u8d44\u6e90\u7ba1\u7406\u5e73\u53f0\uff08\u5982Yarn/K8s\uff09\u8fd0\u884c\u6df1\u5ea6\u5b66\u4e60\u6846\u67b6\uff08Tensorflow, PyTorch\uff09\u7684\u9879\u76ee\uff0c\u8986\u76d6\u6574\u4e2a\u673a\u5668\u5b66\u4e60\u7684\u5168\u8fc7\u7a0b\uff1a</p> <p>\u7b97\u6cd5\u5f00\u53d1\u3001\u6a21\u578b\u6279\u91cf\u8bad\u7ec3\u3001\u6a21\u578b\u589e\u91cf\u8bad\u7ec3\u3001\u6a21\u578b\u5728\u7ebf\u670d\u52a1\u548c\u6a21\u578b\u7ba1\u7406\uff1b</p> <ul> <li>\u6570\u636e\u9884\u5904\u7406\uff1a\u901a\u8fc7notebook\u4e2dspark\u548cpython\uff0c\u8fdb\u884c\u6570\u636e\u9884\u5904\u7406</li> <li>\u673a\u5668\u5b66\u4e60\uff1a\u652f\u6301\u591a\u79cd\u673a\u5668\u5b66\u4e60\u6846\u67b6\u7528\u4e8e\u6a21\u578b\u8bad\u7ec3</li> <li>\u57fa\u7840\u8bbe\u65bd\uff1a\u652f\u6301Yarn\uff0cK8s\uff0cDocker\u7684\u8d44\u6e90\u8c03\u5ea6</li> </ul>"},{"location":"machine_learning/platform/submarine/submarine.html#roadmap","title":"RoadMap","text":"<p>2021/10/13\u65e5\uff1a\u5f53\u524dSubmarine\uff0c\u7f3a\u5c11\u6a21\u578b\u7ba1\u7406\u7684\u76f8\u5173\u529f\u80fd\uff0c\u8fd8\u4e0d\u80fd\u7528\u4e8e\u751f\u4ea7\u3002</p>"},{"location":"machine_learning/platform/submarine/submarine.html#_1","title":"\u6a21\u578b\u7ba1\u7406\u670d\u52a1","text":"<p>\u6a21\u578b\u670d\u52a1\uff0c\u6a21\u578b\u7248\u672c\uff0c\u6a21\u578b\u76d1\u63a7</p>"},{"location":"machine_learning/platform/submarine/submarine.html#_2","title":"\u80cc\u666f","text":"<ul> <li>\u624b\u5de5\u5efa\u7acb\u673a\u5668\u5b66\u4e60\u7b97\u6cd5\u6a21\u578b\u5e76\u4e0d\u5bb9\u6613\uff1a\u5df2\u7ecf\u5b58\u5728\u7684\u7b97\u6cd5\u5e93\u548c\u9884\u8bad\u7ec3\u597d\u7684\u6a21\u578b\uff0c\u4ee5\u4f9b\u590d\u7528\uff1b</li> <li>IDEs\u5f88\u96be\u8fbe\u5230\u201c\u4f60\u770b\u5230\u7684\u5c31\u662f\u60f3\u8981\u7684\u201d\u6548\u679c\uff1aNotebooks\uff08Zepplin\u6216Jupyter\uff09\uff0c\u4ea4\u4e92\u5f0f\u4ee3\u7801\u3001\u5171\u4eab\u3001\u53ef\u89c6\u5316\u3001\u8c03\u8bd5\u7b49\uff1b</li> <li>ML\u5e94\u7528\u96be\u4ee5\u8fc1\u79fb\u90e8\u7f72\uff08\u590d\u6742\u4f9d\u8d56\uff09\uff1a\u5bb9\u5668\u5316\u90e8\u7f72\uff1b</li> <li>\u673a\u5668\u5b66\u4e60\u5de5\u7a0b\u5e08\u5f88\u96be\u5b66\u4e60\u788e\u7247\u5316\u7684\u5de5\u5177\u548c\u5e93\uff1a\u4e3b\u8981\u7684\u5f00\u6e90\u6846\u67b6TF/Pytorch\uff0c\u4ee5\u53ca\u8fdb\u4e00\u6b65\u5c01\u88c5\u7684Keras\u5e93\uff1b</li> <li>\u4e0d\u540c\u7684\u5e93\u6784\u5efa\u7684\u6a21\u578b\u96be\u4ee5\u5728\u4e00\u4e2a\u673a\u5668\u5b66\u4e60pipeline\u4e2d\u5171\u7528\uff1a\u4f01\u4e1a\u7ea7\u6807\u51c6\u7684\u673a\u5668\u5b66\u4e60\u6846\u67b6TF/Pytorch/Keras\u5171\u4eab\uff0c\u4ee5\u53caONNX\uff1b</li> <li>\u5f88\u96be\u6784\u5efa\u4e00\u4e2a\u6570\u636e\u7ba1\u9053\uff0c\u5c06\u6570\u636e\u4ece\u539f\u59cb\u6570\u636e\u6e90\u8f6c\u6362\u4e3a ML \u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u7684\u8f93\u5165\uff1a\u5f00\u6e90\u5927\u6570\u636e\u884c\u4e1a\u5728\u4e3a\u6570\u636e\u6d41\u3001\u8f6c\u6362\u7b49\u63d0\u4f9b\u3001\u7b80\u5316\u3001\u7edf\u4e00\u6d41\u7a0b\u548c\u6784\u5efa\u5757\u65b9\u9762\u53d1\u6325\u7740\u91cd\u8981\u4f5c\u7528</li> </ul>"},{"location":"machine_learning/platform/submarine/submarine.html#_3","title":"\u75db\u70b9","text":"<p>\u673a\u5668\u5b66\u4e60\u5de5\u4f5c\u6d41\u7a0b\u5305\u542b\u4ee5\u4e0b\u56db\u90e8\u5206\uff1a</p> <pre><code>1) From different data sources such as edge, clickstream, logs, etc.\n   =&gt; Land to data lakes  \n\n2) From data lake, data transformation: \n   =&gt; Data transformations: Cleanup, remove invalid rows/columns, \n                            select columns, sampling, split train/test\n                            data-set, join table, etc.\n   =&gt; Data prepared for training.\n\n3) From prepared data: \n   =&gt; Training, model hyper-parameter tuning, cross-validation, etc. \n   =&gt; Models saved to storage. \n\n4) From saved models: \n   =&gt; Model assurance, deployment, A/B testing, etc.\n   =&gt; Model deployed for online serving or offline scoring.\n</code></pre> <p>\u901a\u5e38\u6570\u636e\u79d1\u5b66\u5bb6\u8d1f\u8d23\u9879\u76ee 2\uff09- 4\uff09\uff0c1\uff09\u901a\u5e38\u7531\u4e0d\u540c\u7684\u56e2\u961f\u5904\u7406\uff08\u8bb8\u591a\u516c\u53f8\u79f0\u4e3a\u6570\u636e\u5de5\u7a0b\u56e2\u961f\uff0c\u4e00\u4e9b\u6570\u636e\u5de5\u7a0b\u56e2\u961f\u8fd8\u8d1f\u8d23\u90e8\u5206\u6570\u636e\u8f6c\u6362\uff09</p>"},{"location":"machine_learning/platform/submarine/submarine.html#_4","title":"\u6d41\u7a0b\u590d\u6742/\u4e0a\u7ebf\u65f6\u95f4\u957f","text":"<p>\u4ece\u539f\u59cb\u6570\u636e\u5230\u6a21\u578b\u7684\u590d\u6742\u5de5\u4f5c\u6d41\u7a0b/\u6b65\u9aa4\uff0c\u4e0d\u540c\u6b65\u9aa4\u6240\u9700\u7684\u4e0d\u540c\u5de5\u5177\uff0c\u96be\u4ee5\u5bf9\u5de5\u4f5c\u6d41\u7a0b\u8fdb\u884c\u66f4\u6539\uff0c\u5e76\u4e14\u4e0d\u9632\u9519</p> <p>\u4ece\u539f\u59cb\u6570\u636e\u5230\u53ef\u7528\u6a21\u578b\u662f\u4e00\u4e2a\u590d\u6742\u7684\u5de5\u4f5c\u6d41\u7a0b\uff0c\u5728\u4e0e\u8bb8\u591a\u4e0d\u540c\u7684\u6570\u636e\u79d1\u5b66\u5bb6\u4ea4\u8c08\u540e\uff0c\u6211\u4eec\u4e86\u89e3\u5230\u8bad\u7ec3\u65b0\u6a21\u578b\u5e76\u63a8\u9001\u5230\u751f\u4ea7\u7684\u5178\u578b\u8fc7\u7a0b\u53ef\u80fd\u9700\u8981\u51e0\u4e2a\u6708\u5230 1-2 \u5e74\u7684\u65f6\u95f4\u3002</p> <ul> <li>\u6570\u636e\u8f6c\u6362\u9700\u8981\u50cf Spark/Hive \u8fd9\u6837\u7684\u5927\u89c4\u6a21\u5de5\u5177\u548c\u50cf Pandas \u8fd9\u6837\u7684\u5c0f\u5de5\u5177\uff1b</li> <li>\u6a21\u578b\u8bad\u7ec3\u9700\u8981\u5728 XGBoost\u3001Tensorflow\u3001Keras\u3001PyTorch \u4e4b\u95f4\u5207\u6362\uff1b</li> <li>\u6784\u5efa\u6570\u636e\u7ba1\u9053\u9700\u8981 Apache Airflow \u3001Oozie\u3001Azkaban\u7b49\u3002</li> </ul> <p>\u6709\u8bb8\u591a\u51fa\u8272\u7684\u6807\u51c6\u5316\u5f00\u6e90\u5de5\u5177\u53ef\u4ee5\u7528\u4e8e\u8bb8\u591a\u6b64\u7c7b\u76ee\u7684\u3002\u4f46\u662f\uff0c\u9700\u8981\u5bf9\u6570\u636e\u7ba1\u9053\u7684\u7279\u5b9a\u90e8\u5206\u8fdb\u884c\u66f4\u6539\u5982\u4f55\uff1f\u5728\u8bad\u7ec3\u6570\u636e\u4e2d\u6dfb\u52a0\u51e0\u5217\u7528\u4e8e\u5b9e\u9a8c\u5982\u4f55\uff1f\u5728\u6295\u5165\u751f\u4ea7\u4e4b\u524d\uff0c\u5982\u4f55\u8bad\u7ec3\u6a21\u578b\u3001\u5c06\u6a21\u578b\u63a8\u9001\u5230\u9a8c\u8bc1\u3001A/B \u6d4b\u8bd5\uff1f\u6240\u6709\u8fd9\u4e9b\u6b65\u9aa4\u90fd\u9700\u8981\u5728\u4e0d\u540c\u7684\u5de5\u5177\u3001UI \u4e4b\u95f4\u8df3\u8f6c\uff0c\u5e76\u4e14\u5f88\u96be\u8fdb\u884c\u66f4\u6539\uff0c\u5e76\u4e14\u5728\u8fd9\u4e9b\u8fc7\u7a0b\u4e2d\u65e0\u6cd5\u9632\u9519\u3002</p>"},{"location":"machine_learning/platform/submarine/submarine.html#_5","title":"\u5e95\u5c42\u8d44\u6e90\u7ba1\u7406\u5e73\u53f0\u7684\u4f9d\u8d56","text":"<p>\u673a\u5668\u5b66\u4e60\u5e73\u53f0\u6240\u9700\u7684\u4f5c\u4e1a/\u670d\u52a1\u80fd\u591f\u8fd0\u884c\uff0c\u9700\u8981\u4e00\u4e2a\u5e95\u5c42\u8d44\u6e90\u7ba1\u7406\u5e73\u53f0\u3002\u8d44\u6e90\u7ba1\u7406\u5e73\u53f0\u6709\u591a\u79cd\u9009\u62e9\uff0c\u5404\u6709\u4f18\u7f3a\u70b9\u3002</p> <ul> <li>K8s \u5e76\u6ca1\u6709\u5bf9\u50cf Spark/Flink/Hive \u90a3\u6837\u63d0\u4f9b\u597d\u7684\u652f\u6301\u5de5\u4f5c\uff1b</li> <li>\u4ece YARN \u8f6c\u79fb\u5230 K8s \u4f1a\u5b58\u5728\u5dee\u8ddd\u548c\u5927\u91cf\u5de5\u4f5c\uff0c\u7ef4\u62a4\u4e00\u4e2a\u5355\u72ec\u7684 K8s \u96c6\u7fa4\u4e5f\u662f\u57fa\u4e8e Hadoop \u7684\u6570\u636e\u57fa\u7840\u8bbe\u65bd\u7684\u5f00\u9500\u3002</li> </ul>"},{"location":"machine_learning/platform/submarine/submarine.html#_6","title":"\u5e95\u5c42\u5e73\u53f0\u7ec4\u4ef6\u7684\u4ea4\u4e92","text":"<p>\u6570\u636e\u79d1\u5b66\u5bb6\u88ab\u8feb\u4e0e\u8f83\u4f4e\u7ea7\u522b\u7684\u5e73\u53f0\u7ec4\u4ef6\u4ea4\u4e92</p> <p>\u6570\u636e\u79d1\u5b66\u5bb6\u88ab\u8feb\u5b66\u4e60\u5e95\u5c42\u5e73\u53f0\u77e5\u8bc6\uff0c\u4ee5\u4fbf\u80fd\u591f\u6784\u5efa\u771f\u5b9e\u4e16\u754c\u7684\u673a\u5668\u5b66\u4e60\u5de5\u4f5c\u6d41\u3002</p> <p>\u5927\u591a\u6570\u6570\u636e\u79d1\u5b66\u5bb6\u6765\u8bf4\uff0c\u4ed6\u4eec\u662f ML \u7b97\u6cd5/\u5e93\u3001\u7279\u5f81\u5de5\u7a0b\u7b49\u65b9\u9762\u7684\u4e13\u5bb6\u3002\u4ed6\u4eec\u4e5f\u6700\u719f\u6089 Python\u3001R\uff0c\u5176\u4e2d\u4e00\u4e9b\u4eba\u4e86\u89e3 Spark\u3001Hive \u7b49\u3002</p> <p>\u5982\u679c\u4ed6\u4eec\u88ab\u8981\u6c42\u4e0e\u8f83\u4f4e\u7ea7\u522b\u7684\u7ec4\u4ef6\u8fdb\u884c\u4ea4\u4e92\uff0c\u4f8b\u5982\u5fae\u8c03 Spark \u4f5c\u4e1a\u7684\u6027\u80fd\uff1b\u6216\u56e0\u8d44\u6e90\u9650\u5236\u800c\u65e0\u6cd5\u542f\u52a8\u6545\u969c\u6392\u9664\u4f5c\u4e1a\uff1b\u6216\u7f16\u5199 K8s/YARN \u4f5c\u4e1a\u89c4\u8303\u5e76\u5b89\u88c5\u5377\uff0c\u6b63\u786e\u8bbe\u7f6e\u7f51\u7edc\u3002\u4ed6\u4eec\u4f1a\u6320\u5934\uff0c\u901a\u5e38\u65e0\u6cd5\u6709\u6548\u5730\u6267\u884c\u8fd9\u4e9b\u64cd\u4f5c\u3002</p>"},{"location":"machine_learning/platform/submarine/submarine.html#_7","title":"\u9075\u5b88\u6570\u636e\u5b89\u5168/\u6cbb\u7406\u8981\u6c42","text":""},{"location":"machine_learning/platform/submarine/submarine.html#ml","title":"\u6ca1\u6709\u51cf\u5c11\u5e38\u89c4ML\u4ee3\u7801\u5f00\u53d1","text":"<p>\u6570\u636e\u51c6\u5907\u597d\u540e\uff0c\u6570\u636e\u79d1\u5b66\u5bb6\u9700\u8981\u505a\u51e0\u9879\u5e38\u89c4\u4efb\u52a1\u6765\u6784\u5efa ML \u7ba1\u9053\u3002\u4e3a\u4e86\u4e86\u89e3\u73b0\u6709\u7684\u6570\u636e\u96c6\uff0c\u901a\u5e38\u9700\u8981\u5bf9\u6570\u636e\u96c6\u8fdb\u884c\u62c6\u5206\uff0c\u5bf9\u6570\u636e\u96c6\u8fdb\u884c\u7edf\u8ba1\u3002\u8fd9\u4e9b\u4efb\u52a1\u6709\u4e00\u4e2a\u5171\u540c\u7684\u4ee3\u7801\u91cd\u590d\u90e8\u5206\uff0c\u8fd9\u964d\u4f4e\u4e86\u6570\u636e\u79d1\u5b66\u5bb6\u7684\u6548\u7387\u3002</p> <p>\u5e2e\u52a9\u5f00\u53d1\u4eba\u5458\u4fc3\u8fdb ML \u7ba1\u9053\u5f00\u53d1\u7684\u62bd\u8c61\u5c42/\u6846\u67b6\u53ef\u80fd\u5f88\u6709\u4ef7\u503c\u3002\u8fd9\u6bd4\u5f00\u53d1\u8005\u53ea\u9700\u8981\u586b\u5145\u56de\u8c03\u51fd\u6570\u6765\u4e13\u6ce8\u4e8e\u4ed6\u4eec\u7684\u5173\u952e\u903b\u8f91\u8981\u597d\u3002</p>"},{"location":"machine_learning/platform/submarine/submarine.html#_8","title":"\u67b6\u6784","text":"<pre><code> +-----------------------------------------------------------------+\n |            Submarine UI / CLI / REST API / SDK                  |\n |                 Mini-Submarine                                  |\n +-----------------------------------------------------------------+\n\n +--------------------Submarine Server-----------------------------+\n | +---------+ +---------+ +----------+ +----------+ +------------+|\n | |Data set | |Notebooks| |Experiment| |Models    | |Servings    ||\n | +---------+ +---------+ +----------+ +----------+ +------------+|\n |-----------------------------------------------------------------|\n |                                                                 |\n | +-----------------+ +-----------------+ +---------------------+ |\n | |Experiment       | |Compute Resource | |Other Management     | |\n | |Manager          | |   Manager       | |Services             | |\n | +-----------------+ +-----------------+ +---------------------+ |\n |   Spark, template              YARN/K8s/Docker                  |\n |   TF, PyTorch, pipeline                                         |\n |                                                                 |\n + +-----------------+                                             +\n | |Submarine Meta   |                                             |\n | |    Store        |                                             |\n | +-----------------+                                             |\n |                                                                 |\n +-----------------------------------------------------------------+\n\n  (You can use http://stable.ascii-flow.appspot.com/#Draw to draw such diagrams)\n</code></pre>"},{"location":"machine_learning/platform/submarine/submarine.html#_9","title":"\u89d2\u8272","text":"<p>\u7528\u6237\uff1a\u5355\u4e2a\u6570\u636e\u79d1\u5b66\u5bb6\u6216\u8005\u6570\u636e\u5de5\u7a0b\u5e08\uff0c\u5177\u5907\u8d44\u6e90\u914d\u989d\u3001\u8ba4\u8bc1\u7b49\uff1b</p> <p>\u56e2\u961f\uff1a\u7528\u6237\u5c5e\u4e8e\u4e00\u4e2a\u6216\u591a\u4e2a\u56e2\u961f\uff0c\u56e2\u961f\u5bf9artifacts\u5171\u4eab\uff08\u5982notebook\u3001\u6a21\u578b\u7b49\uff09\u5177\u5907ACLS\uff1b</p> <p>\u7ba1\u7406\u5458\uff1aSRE\uff0c\u7ba1\u7406\u7528\u6237\u914d\u989d\u3001\u8ba4\u8bc1\u3001\u56e2\u961f\u7b49\uff1b</p>"},{"location":"machine_learning/platform/submarine/submarine.html#_10","title":"\u8bbe\u8ba1\u4e0e\u5b9e\u73b0","text":""},{"location":"machine_learning/platform/submarine/submarine.html#environment","title":"Environment","text":"<p>\u73af\u5883\u914d\u7f6e\u6587\u4ef6\uff08\u6216\u7b80\u79f0\u73af\u5883\uff09\u5b9a\u4e49\u4e86\u4e00\u7ec4\u5e93\u548c Docker \u6620\u50cf\uff0c\u4ee5\u4fbf\u8fd0\u884cnotebook\u548cexperiment\u3002</p> <ul> <li>Docker\u955c\u50cf\u5b9a\u4e49\u73af\u5883\u7684\u57fa\u7840\u5c42\uff1b</li> <li>\u5b9a\u4e49\u4e00\u7ec4\u5e93\uff08\u5982Python/R\uff09\u8fdb\u884c\u5b89\u88c5\uff1b</li> <li>\u53ef\u4ee5\u901a\u8fc7 CLI/SDK \u6dfb\u52a0/\u5217\u51fa/\u5220\u9664/\u9009\u62e9\u73af\u5883\uff1b</li> </ul>"},{"location":"machine_learning/platform/submarine/submarine.html#experiment","title":"Experiment","text":""},{"location":"machine_learning/platform/submarine/submarine.html#_11","title":"\u8bbe\u8ba1","text":"<p>\u79bb\u7ebf\u7684\u4efb\u52a1\uff0c\u53ef\u4ee5\u662fShell\u3001R\u3001Python \u547d\u4ee4\u3001Spark\u4f5c\u4e1a\u3001SQL\u67e5\u8be2\u6216\u8005\u5de5\u4f5c\u6d41\u3002</p> <ul> <li>Experiments\u53ef\u4ee5\u901a\u8fc7UI/CLI/SDK\u63d0\u4ea4\uff1b</li> <li>Experiments\u53ef\u4ee5\u901a\u8fc7UI/CLI/SDK\u8fdb\u884c\u76d1\u63a7\u548c\u7ba1\u7406\uff1b</li> <li>Experiments\u4e0d\u8ddf\u5177\u4f53\u7684\u8d44\u6e90\u7ba1\u7406\u5e73\u53f0\u7ed1\u5b9a\uff08\u5982K8s/Yarn\uff09\uff1b</li> </ul>"},{"location":"machine_learning/platform/submarine/submarine.html#adhoc-experiment","title":"Adhoc experiment","text":"<p>\u76ee\u6807\uff1a</p> <ul> <li>\u8fd0\u884c adhoc \u811a\u672c\uff1b</li> <li>\u5728Yarn/K8s\u4e0a\u8fd0\u884cTF/Pytorch\u7a0b\u5e8f\uff1b</li> <li>\u4f5c\u4e1a\u53ef\u4ee5\u8bbf\u95eeHDFS/S3\u4e0a\u7684\u6a21\u578b\u548c\u6570\u636e\uff1b</li> <li>\u901a\u8fc7\u7b80\u5355\u914d\u7f6e\uff0c\u53ef\u4ee5\u8fd0\u884c\u5206\u5e03\u5f0f\u7684TF/Pytorch\uff1b</li> <li>\u652f\u6301\u8fd0\u884c\u7528\u6237\u6307\u5b9a\u7684Docker\u955c\u50cf\uff1b</li> <li>\u652f\u6301\u81ea\u5b9aGPU\u548c\u5176\u5b83\u8d44\u6e90\uff1b</li> </ul>"},{"location":"machine_learning/platform/submarine/submarine.html#predefined-experiment-library","title":"Predefined experiment library","text":"<p>\u8bad\u7ec3deepfm\u6a21\u578b\u7684\u793a\u4f8b\uff1a</p> <pre><code>{\n  \"input\": {\n    \"train_data\": [\"hdfs:///user/submarine/data/tr.libsvm\"],\n    \"valid_data\": [\"hdfs:///user/submarine/data/va.libsvm\"],\n    \"test_data\": [\"hdfs:///user/submarine/data/te.libsvm\"],\n    \"type\": \"libsvm\"\n  },\n  \"output\": {\n    \"save_model_dir\": \"hdfs:///user/submarine/deepfm\",\n    \"metric\": \"auc\"\n  },\n  \"training\": {\n    \"batch_size\" : 512,\n    \"field_size\": 39,\n    \"num_epochs\": 3,\n    \"feature_size\": 117581,\n    ...\n  }\n}\n</code></pre> <p>\u76ee\u6807\uff1a</p> <ul> <li>\u9884\u5148\u5b9a\u4e49\u7684\u5b9e\u9a8c\u5e93\u53ef\u4ee5\u7528\u6237\u5171\u4eab\uff08\u57fa\u4e8e\u540c\u4e00\u4e2a\u5e73\u53f0\uff09\uff1b</li> <li>\u7528\u6237\u53ef\u4ee5\u901a\u8fc7UI/REST API\u6dfb\u52a0\u65b0\u7684\u6216\u8005\u4fee\u6539\u9884\u5b9a\u4e49\u7684\u5b9e\u9a8c\u5e93\uff1b</li> <li>\u652f\u6301AutoML\uff0c\u8d85\u53c2\u8c03\u4f18\uff1b</li> </ul>"},{"location":"machine_learning/platform/submarine/submarine.html#pipeline","title":"pipeline","text":"<p>\u76ee\u6807\uff1a</p> <ul> <li>pipeline\u662fexperiments\u7684DAG\uff0c\u88ab\u5f53\u4f5c\u7279\u6b8a\u7c7b\u578b\u7684experiment\uff1b</li> <li>\u7528\u6237\u53ef\u4ee5\u63d0\u4ea4/\u7ec8\u6b62\u4e00\u4e2apipeline\uff1b</li> <li>pipeline\u53ef\u4ee5\u901a\u8fc7UI/API\u7ee7\u7eed\u5b81\u521b\u5efa\u548c\u63d0\u4ea4\uff1b</li> </ul>"},{"location":"machine_learning/platform/submarine/submarine.html#_12","title":"\u5b9e\u73b0","text":""},{"location":"machine_learning/platform/submarine/submarine.html#notebook","title":"Notebook","text":"<p>\u76ee\u6807</p> <ul> <li>\u7528\u6237\u53ef\u4ee5\u521b\u5efa/\u7f16\u8f91/\u5220\u9664notebook\uff1b</li> <li>Notebooks\u53ef\u4ee5\u88ab\u6301\u4e45\u5316\uff0c\u4ee5\u4fbf\u4ece\u9519\u8bef\u4e2d\u6062\u590d\uff1b</li> <li>\u7528\u6237\u53ef\u4ee5\u8ffd\u8e2aNotebook\u7684\u5386\u53f2\u7248\u672c\uff1b</li> <li>Notebook\u53ef\u4ee5\u88ab\u4e0d\u540c\u7684\u7528\u6237\u5171\u4eab\uff1b</li> <li>\u7528\u6237\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2anotebook\u7684\u4e00\u7ec4\u53c2\u6570\uff0c\u8fd0\u884c\u50cfjob\u90a3\u6837\u6267\u884c\u5355\u4e2anotebook\uff1b</li> <li>\u4e0d\u540c\u7684\u7528\u6237\u53ef\u4ee5\u540c\u65f6\u534f\u4f5c\u540c\u4e00\u4e2anotebook\uff1b</li> </ul>"},{"location":"machine_learning/platform/submarine/submarine.html#server","title":"Server","text":""},{"location":"machine_learning/platform/submarine/submarine.html#model","title":"Model","text":"<p>\u6a21\u578b\u8bad\u7ec3\uff1a</p> <ul> <li>Submarine-SDK \u63d0\u4f9b\u8ddf\u8e2a/\u6307\u6807 API\uff0c\u5141\u8bb8\u5f00\u53d1\u4eba\u5458\u4ece Submarine Workbench UI \u6dfb\u52a0\u8ddf\u8e2a/\u6307\u6807\u548c\u67e5\u770b\u8ddf\u8e2a/\u6307\u6807\u3002</li> </ul> <p>\u6a21\u578b\u7ba1\u7406\uff1a</p> <ul> <li>\u6a21\u578b\u5de5\u4ef6\u7531\u5b9e\u9a8c\u6216notebook\u751f\u6210\uff1b</li> <li>\u6a21\u578b\u7531\u6765\u81ea\u4e00\u4e2a\u6216\u591a\u4e2a\u6587\u4ef6\u7684artifacts\u7ec4\u6210\uff1b</li> <li>\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u4fdd\u5b58\u3001\u6807\u8bb0\u3001\u6253\u7248\u672c\u751f\u6210\u7684\u6a21\u578b\uff1b</li> <li>\u6a21\u578b\u4fdd\u5b58\u540e\uff0c\u7528\u6237\u53ef\u4ee5\u5bf9\u6a21\u578b\u8fdb\u884c\u5728\u7ebf\u6a21\u578b\u670d\u52a1\u6216\u79bb\u7ebf\u8bc4\u5206\uff1b</li> </ul> <p>\u6a21\u578b\u670d\u52a1</p> <ul> <li>\u6a21\u578b\u4fdd\u5b58\u540e\uff0c\u7528\u6237\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u670d\u52a1\u811a\u672c\u3001\u4e00\u4e2a\u6a21\u578b\u5e76\u521b\u5efa\u4e00\u4e2aWeb\u670d\u52a1\u6765\u4e3a\u6a21\u578b\u63d0\u4f9b\u670d\u52a1\uff1b</li> <li>\u901a\u8fc7 CLI/API/UI \u7ba1\u7406\uff08\u6dfb\u52a0/\u505c\u6b62\uff09\u6a21\u578b\u670d\u52a1\u7aef\u70b9\u3002</li> </ul>"},{"location":"machine_learning/platform/submarine/submarine.html#security","title":"Security","text":"<p>\u6709 4 \u79cd\u5bf9\u8c61\u9700\u8981\u8bbf\u95ee\u63a7\u5236\uff1a</p> <ul> <li>\u8d44\u4ea7\u5c5e\u4e8e Submarine \u7cfb\u7edf\uff0c\u5305\u62ecnotebook\u3001\u5b9e\u9a8c\u548c\u7ed3\u679c\u3001\u6a21\u578b\u3001\u9884\u5b9a\u4e49\u7684\u5b9e\u9a8c\u5e93\u3001\u73af\u5883\u914d\u7f6e\u6587\u4ef6\u3002</li> <li>\u6570\u636e\u5b89\u5168\u3002\uff08\u8c01\u62e5\u6709\u4ec0\u4e48\u6570\u636e\uff0c\u6bcf\u4e2a\u7528\u6237\u53ef\u4ee5\u8bbf\u95ee\u4ec0\u4e48\u6570\u636e\uff09\u3002</li> <li>\u7528\u6237\u51ed\u636e\u3002\uff08\u5982LDAP\uff09\u3002</li> <li>\u5176\u4ed6\u5b89\u5168\u6027\uff0c\u4f8b\u5982 Git repo \u8bbf\u95ee\u7b49\u3002</li> </ul> <p>\u5bf9\u4e8e\u6570\u636e\u5b89\u5168/\u7528\u6237\u51ed\u8bc1/\u5176\u4ed6\u5b89\u5168\uff0c\u5b83\u5c06\u59d4\u6258\u7ed9\u7b2c\u4e09\u65b9\u5e93\uff0c\u4f8b\u5982 Apache Ranger\u3001IAM \u89d2\u8272\u7b49\u3002</p> <p>\u5c5e\u4e8e Submarine \u7cfb\u7edf\u7684\u8d44\u4ea7\u5c06\u7531 Submarine \u81ea\u5df1\u5904\u7406\u3002</p> <p>\u7ba1\u7406\u5458\u64cd\u4f5c</p> <ul> <li>\u7ba1\u7406\u5458\u4f7f\u7528\u201c\u7528\u6237\u7ba1\u7406\u7cfb\u7edf\u201d\u6765\u52a0\u5165\u65b0\u7528\u6237\u3001\u4e0a\u4f20\u7528\u6237\u51ed\u636e\u3001\u5206\u914d\u8d44\u6e90\u914d\u989d\u7b49\u3002</li> <li>\u7ba1\u7406\u5458\u53ef\u4ee5\u521b\u5efa\u65b0\u7528\u6237\u3001\u65b0\u56e2\u961f\u3001\u66f4\u65b0\u7528\u6237/\u56e2\u961f\u6620\u5c04\u3002\u6216\u8005\u5220\u9664\u7528\u6237/\u56e2\u961f\u3002</li> <li>\u7ba1\u7406\u5458\u53ef\u4ee5\u8bbe\u7f6e\u7528\u6237\u7684\u8d44\u6e90\u914d\u989d\uff08\u5982\u679c\u4e0e\u7cfb\u7edf\u9ed8\u8ba4\u503c\u4e0d\u540c\uff09\u3001\u6743\u9650\u3001\u4e0a\u4f20/\u66f4\u65b0\u5fc5\u8981\u7684\u51ed\u636e\uff08\u5982 Kerberos \u5bc6\u94a5\u8868\uff09\u3002</li> <li>\u5982\u679c DE/DS \u5177\u6709\u7ba1\u7406\u5458\u8bbf\u95ee\u6743\u9650\uff0c\u5219 DE/DS \u4e5f\u53ef\u4ee5\u662f\u7ba1\u7406\u5458\u3002\uff08\u5c31\u50cf\u7279\u6743\u7528\u6237\u4e00\u6837\uff09\u3002\u5f53\u96c6\u7fa4\u4ec5\u7531\u7528\u6237\u5171\u4eab\u6216\u4ec5\u7531\u5c0f\u56e2\u961f\u5171\u4eab\u65f6\uff0c\u8fd9\u5c06\u975e\u5e38\u6709\u7528\u3002</li> <li><code>Resource Quota Management System</code>\u5e2e\u52a9\u7ba1\u7406\u5458\u7ba1\u7406\u56e2\u961f\u3001\u7ec4\u7ec7\u7684\u8d44\u6e90\u914d\u989d\u3002\u8d44\u6e90\u53ef\u4ee5\u662f\u673a\u5668\u8d44\u6e90\uff0c\u5982 CPU/\u5185\u5b58/\u78c1\u76d8\u7b49\u3002\u5b83\u8fd8\u53ef\u4ee5\u5305\u62ec\u975e\u673a\u5668\u8d44\u6e90\uff0c\u5982\u57fa\u4e8e $$ \u7684\u9884\u7b97\u3002</li> </ul>"},{"location":"machine_learning/platform/submarine/submarine.html#storage","title":"Storage","text":""},{"location":"machine_learning/platform/submarine/submarine.html#_13","title":"\u8bbe\u8ba1","text":""},{"location":"machine_learning/platform/submarine/submarine.html#_14","title":"\u6570\u636e\u96c6","text":"<ul> <li>\u9700\u8981\u6807\u8bb0\u6570\u636e\u96c6\uff0c\u8fd9\u4e9b\u6570\u636e\u96c6\u5c06\u7528\u4e8e\u8bad\u7ec3\u5e76\u7531\u4e0d\u540c\u7528\u6237\u8de8\u5e73\u53f0\u5171\u4eab\u3002</li> <li>\u5bf9\u5b9e\u9645\u6570\u636e\u7684\u8bbf\u95ee\u5c06\u7531 Apache Ranger / Hive Metastore \u7b49 3rd \u65b9\u7cfb\u7edf\u5904\u7406\uff0c\u8fd9\u8d85\u51fa\u4e86 Submarine \u7684\u8303\u56f4\u3002\u3002</li> </ul>"},{"location":"machine_learning/platform/submarine/submarine.html#_15","title":"\u5b9e\u73b0","text":""},{"location":"machine_learning/platform/submarine/submarine.html#_16","title":"\u8d44\u6e90\u7ba1\u7406","text":""},{"location":"machine_learning/platform/submarine/submarine.html#yarn","title":"Yarn","text":"<p>\u5bf9\u4e8eYarn\u7684\u652f\u6301\uff0c\u91c7\u7528TonY\uff0c\u5176\u662fLinkedIn\u5f00\u6e90\u7684\uff0c\u5728Hadoop\u4e0a\u4f7f\u7528Tensorflow\uff08\u5177\u4f53\u89c1\u6df1\u5ea6\u5b66\u4e60\u6846\u67b6\uff09\u3002</p>"},{"location":"machine_learning/platform/submarine/submarine.html#k8s","title":"K8s","text":""},{"location":"machine_learning/platform/submarine/submarine.html#ha","title":"HA","text":""},{"location":"machine_learning/platform/submarine/submarine.html#services-deployment","title":"Services Deployment","text":""},{"location":"machine_learning/tools/index.html","title":"\u5de5\u5177","text":"<p>\u7528\u4e8e\u7279\u5b9a\u573a\u666f\u7684\u673a\u5668\u5b66\u4e60\u7b97\u6cd5\u3002</p>"},{"location":"machine_learning/tools/packages.html","title":"\u673a\u5668\u5b66\u4e60\u5305","text":""},{"location":"machine_learning/tools/packages.html#_2","title":"\u76ee\u6807\u68c0\u6d4b","text":""},{"location":"machine_learning/tools/packages.html#bbaug-pytorch","title":"BBAug: \u6570\u636e\u589e\u5f3a\u5305(PyTorch)","text":"<p>Google Paper: Learning Data Augmentation Strategies for Object Detection.</p> <p>BBAug\u662f\u4e00\u4e2apython\u5305\uff0c\u5b83\u5b9e\u73b0\u4e86\u8c37\u6b4cBrain Team\u7684\u6240\u6709\u7b56\u7565\uff0c\u7528\u4e8e\u751f\u6210\u66f4\u591a\u7684\u56fe\u7247\uff08\u5bf9\u539f\u56fe\u5f62\u7684\u7269\u4f53\u8fdb\u884c\u88c1\u526a/\u5e73\u79fb\u7b49\u7b56\u7565\uff09\u3002</p>"},{"location":"machine_learning/tools/packages.html#_3","title":"\u65f6\u95f4\u5e8f\u5217","text":""},{"location":"machine_learning/tools/packages.html#neuralprophet","title":"NeuralProphet","text":"<p>\u6848\u4f8b\uff1ahttps://zhuanlan.zhihu.com/p/405914462</p>"},{"location":"opensourefund/apache.html","title":"Apache \u9879\u76ee\u5386\u53f2","text":"<p>\u89c1  Gitee projectsfound: \u53ca\u65f6\u53d1\u73b0Apache\u7b49\u57fa\u91d1\u4f1a\u7684\u65b0\u9879\u76ee (gitee.com)</p>"},{"location":"opensourefund/linux.html","title":"Linux","text":"<p>[toc]</p>"},{"location":"opensourefund/linux.html#linux","title":"Linux","text":""},{"location":"opensourefund/linux.html#cncf","title":"CNCF","text":"<p>\u7531Linux\u57fa\u91d1\u4f1a\u53d1\u8d77\uff0c\u81f4\u529b\u4e8e\u7ba1\u7406\u548c\u8fd0\u8f6c\u539f\u751f\u4e91\u9879\u76ee\u3002</p>"},{"location":"opensourefund/linux.html#containerd","title":"Containerd\uff08\u5bb9\u5668\u8fd0\u884c\u65f6\uff09","text":"<p>An industry-standard container runtime with an emphasis on simplicity, robustness and portability.</p>"},{"location":"opensourefund/linux.html#coredns","title":"CoreDNS\uff08\u670d\u52a1\u53d1\u73b0\uff09","text":"<p>DNS and Service Discovery.</p>"},{"location":"opensourefund/linux.html#cortexprometheus","title":"Cortex\uff08\u5206\u5e03\u5f0fPrometheus\uff09","text":"<p>Horizontally scalable, highly available, multi-tenant, long term Prometheus.</p>"},{"location":"opensourefund/linux.html#envoy","title":"Envoy\uff08\u7f51\u7edc\u4ee3\u7406\uff09","text":"<p>An open source edge and service proxy, designed for cloud-native applications.</p>"},{"location":"opensourefund/linux.html#etcdkey-value","title":"Etcd\uff08\u5206\u5e03\u5f0f\u3001\u9ad8\u53ef\u9760\u7684key-value\u5b58\u50a8\u7cfb\u7edf\uff09","text":"<p>A distributed, reliable key-value store for the most critical data of a distributed system\u3002</p> <p>\u53ef\u4ee5\u76d1\u542c\u7279\u5b9akey\u6216\u8005\u76ee\u5f55\u7684value\u7684\u53d8\u5316\u3002</p>"},{"location":"opensourefund/linux.html#fluentdlogging","title":"Fluentd\uff08Logging\uff09","text":"<p>an open source data collector for unified logging layer.</p>"},{"location":"opensourefund/linux.html#grpcrpc","title":"Grpc\uff08RPC\u6846\u67b6\uff09","text":"<p>A high performance, open source universal RPC framework.    </p>"},{"location":"opensourefund/linux.html#helmk8s","title":"Helm\uff08K8s\u5305\u7ba1\u7406\uff09","text":"<p>the best way to find, share, and use software built for Kubernetes.</p>"},{"location":"opensourefund/linux.html#jagger","title":"Jagger\uff08\u5206\u5e03\u5f0f\u8ffd\u8e2a\uff09","text":"<p>open source, end-to-end distributed tracing.</p>"},{"location":"opensourefund/linux.html#k8s","title":"K8s\uff08\u5bb9\u5668\u8c03\u5ea6\u7ba1\u7406\uff09","text":"<p>Production-Grade Container Orchestration.</p>"},{"location":"opensourefund/linux.html#open-policy-agent","title":"Open Policy Agent\uff08\u4e91\u539f\u751f\u7684\u8eab\u4efd\u9a8c\u8bc1\u548c\u6388\u6743\u7b56\u7565\uff09","text":"<p>Policy-based control for cloud native environments.</p>"},{"location":"opensourefund/linux.html#opentracing","title":"OpenTracing\uff08\u5206\u5e03\u5f0f\u8ffd\u8e2a\u89c4\u8303\uff09","text":"<p>Distributed Tracing API.</p>"},{"location":"opensourefund/linux.html#prometheusmetrics","title":"Prometheus\uff08metrics\u5b58\u50a8\u3001\u544a\u8b66\u3001\u76d1\u63a7\u7cfb\u7edf\uff09","text":"<p>ower your metrics and alerting with a leading open-source monitoring solution.</p>"},{"location":"opensourefund/linux.html#rookk8s","title":"Rook\uff08\u4e91\u539f\u751fK8s\u7684\u5b58\u50a8\uff09","text":"<p>Open-Source, Cloud-Native Storage for Kubernetes\uff0cProduction ready management for File, Block and Object Storage.</p>"},{"location":"opensourefund/linux.html#tikvkv","title":"TiKV\uff08\u5206\u5e03\u5f0f\u4e8b\u52a1\u578b\u7684kV\u6570\u636e\u5e93\uff09","text":"<p>A distributed transactional key-value database.</p>"},{"location":"opensourefund/linux.html#thanosprometheus","title":"Thanos\uff08Prometheus\u96c6\u7fa4\u7248\uff09","text":"<p>Open source, highly available Prometheus setup with long term storage capabilities.</p>"},{"location":"opensourefund/linux.html#tufthe-update-framework","title":"TUF\uff08The Update Framework\uff09","text":"<p>A framework for securing software update systems.</p>"},{"location":"opensourefund/linux.html#vitessmysql","title":"Vitess\uff08MySQL\u96c6\u7fa4\u7248\uff09","text":"<p>A database clustering system for horizontal scaling of MySQL.</p>"},{"location":"opensourefund/linux.html#voladnok8ssandbox","title":"Voladno\uff08K8s\u539f\u751f\u6279\u5904\u7406\u7cfb\u7edf\uff0csandbox\uff09","text":""},{"location":"opensourefund/linux.html#_1","title":"... ...","text":""},{"location":"opensourefund/linux.html#lf","title":"LF\u4eba\u5de5\u667a\u80fd\u4e0e\u6570\u636e\u57fa\u91d1\u4f1a","text":""},{"location":"opensourefund/linux.html#delta","title":"Delta\uff08\u6df1\u5ea6\u5b66\u4e60\u7684\u81ea\u7136\u8bed\u8a00\u5904\u7406\u548c\u8bed\u97f3\u8bc6\u522b\u5e73\u53f0\uff09","text":"<p>a deep learning based end-to-end natural language and speech processing platform.</p>"},{"location":"opensourefund/linux.html#_2","title":"\u5176\u5b83\u5b50\u57fa\u91d1","text":""},{"location":"opensourefund/linux.html#ceph","title":"Ceph\uff08\u96c6\u7fa4\u6587\u4ef6\u7cfb\u7edf\uff09","text":""},{"location":"opensourefund/linux.html#chubaofs","title":"ChubaoFS\uff08\u4e91\u539f\u751f\u5206\u5e03\u5f0f\u6587\u4ef6/\u5bf9\u8c61\u5b58\u50a8\uff09","text":"<p>\u4e00\u4e2a\u4e91\u539f\u751f\u5b58\u50a8\u5e73\u53f0\uff0c\u63d0\u4f9b\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u4e0e\u5bf9\u8c61\u5b58\u50a8\u670d\u52a1\uff0c\u4e3a\u4e91\u539f\u751f\u5e94\u7528\u63d0\u4f9b\u8ba1\u7b97\u4e0e\u5b58\u50a8\u5206\u79bb\u7684\u6301\u4e45\u5316\u5b58\u50a8\u65b9\u6848</p>"},{"location":"opensourefund/linux.html#datahub","title":"DataHub\uff08\u6570\u636e\u751f\u6210\u5e93\uff09","text":"<p>a set of python libraries dedicated to the production of synthetic data to be used in tests, machine learning training, statistical analysis, and other use cases.</p>"},{"location":"opensourefund/linux.html#jenkinscicd","title":"Jenkins\uff08CI/CD\u5e73\u53f0\uff09","text":"<p>hundreds of plugins to support building, deploying and automating any project.</p>"},{"location":"opensourefund/linux.html#jenkins-x-cicd","title":"Jenkins X\uff08\u4e91\u539f\u751f\u5e94\u7528\u7684 CI/CD \u5b9e\u73b0\uff09","text":"<p>provides pipeline automation, built-in GitOps, and preview environments to help teams collaborate and accelerate their software delivery at any scale.</p>"},{"location":"opensourefund/linux.html#linux_1","title":"Linux","text":""},{"location":"opensourefund/linux.html#jquery-nodejs","title":"JQuery / Nodejs","text":""},{"location":"paper_reading/cfs.html","title":"A Distributed File System for Large Scale Container Platforms","text":""},{"location":"paper_reading/cfs.html#_1","title":"\u6458\u8981","text":"<p>CFS\uff1a\u5927\u89c4\u6a21\u5bb9\u5668\u5e73\u53f0\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf</p> <ul> <li>\u652f\u6301\u987a\u5e8f\u548c\u968f\u673a\u6587\u4ef6\u8bbf\u95ee\uff0c\u5e76\u4f18\u5316\u5927\u6587\u4ef6\u548c\u5c0f\u6587\u4ef6\uff1b</li> </ul>"},{"location":"paper_reading/cfs.html#_2","title":"\u5f15\u8a00","text":"<p>\u5173\u952e\u7279\u6027\uff1a</p> <ul> <li>\u901a\u7528\u7684\u9ad8\u6027\u80fd\u5b58\u50a8\uff08\u9488\u5bf9\u5927/\u5c0f\u6587\u4ef6\uff09\uff1b</li> <li>\u573a\u666f\u611f\u77e5\u7684\u590d\u5236\u56e0\u5b50\uff1b</li> <li>\u65e0\u9700\u6570\u636e\u8fc1\u79fb\u7684\u5b58\u50a8\u6269\u5bb9\uff1b</li> <li>Relaxed Posix \u8bed\u4e49\u548c\u5143\u6570\u636e\u539f\u5b50\u6027\uff1b</li> </ul>"},{"location":"paper_reading/how_to_read_a_paper.html","title":"Paper\u9605\u8bfb\u6982\u8981","text":"<p>\u4e09\u8d9f\u9605\u8bfb\u6cd5</p>"},{"location":"paper_reading/how_to_read_a_paper.html#5-10","title":"\u7b2c\u4e00\u8d9f\uff085-10\u5206\u949f\uff09","text":"<p>\u9605\u8bfb\u6807\u51c6</p> <ul> <li> <p>\u4ed4\u7ec6\u9605\u8bfb\u6807\u9898\u3001\u6458\u8981\u548c\u5f15\u8a00\uff1b</p> </li> <li> <p>\u8bfb\u6bcf\u8282\u548c\u5b50\u8282\u7684\u5f00\u5934\uff0c\u5ffd\u7565\u5176\u5b83\uff1b</p> </li> <li>\u8bfb\u7ed3\u8bba\uff1b  </li> <li>\u6d4f\u89c8\u53c2\u8003\u4e66\u76ee\uff0c\u5728\u8111\u6d77\u4e2d\u52fe\u51fa\u4f60\u5df2\u7ecf\u8bfb\u8fc7\u7684\uff1b</li> </ul> <p>\u5b8c\u6210\u6807\u51c6</p> <ul> <li>\u8bba\u6587\u7684\u7c7b\u522b\uff1a\u8861\u91cf\u6027\u8bba\u6587\uff1f\u5df2\u6709\u7cfb\u7edf\u7684\u5206\u6790\u578b\u8bba\u6587\uff1f\u7814\u7a76\u539f\u578b\u7684\u63cf\u8ff0\uff1f</li> <li>\u4e0a\u4e0b\u6587\uff1a\u548c\u5176\u5b83\u8bba\u6587\u7684\u76f8\u5173\u6027\uff1f\u5206\u6790\u95ee\u9898\u7684\u7406\u8bba\u4f9d\u636e\u662f\u4ec0\u4e48\uff1f</li> <li>\u6b63\u786e\u6027\uff1a\u5047\u8bbe\u662f\u4e0d\u662f\u6709\u6548\u7684\uff1f</li> <li>\u8d21\u732e\uff1a\u6587\u7ae0\u7684\u4e3b\u8981\u8d21\u732e\u662f\u4ec0\u4e48\uff1f</li> <li>\u6e05\u6670\uff1a\u6587\u7ae0\u7684\u4e66\u5199\u662f\u5426\u6e05\u6670\uff1f</li> </ul>"},{"location":"paper_reading/how_to_read_a_paper.html#_1","title":"\u7b2c\u4e8c\u8d9f\uff08\u4e00\u5c0f\u65f6\uff09","text":"<p>\u9605\u8bfb\u6807\u51c6</p> <ul> <li> <p>\u66f4\u4ed4\u7ec6\u5730\u9605\u8bfb\u8bba\u6587\uff0c\u4f46\u5ffd\u7565\u8bf8\u5982\u8bc1\u660e\u4e4b\u7c7b\u7684\u7ec6\u8282\u3002\u5b83\u6709\u52a9\u4e8e\u8bb0\u4e0b\u8981\u70b9\uff0c\u6216\u5728\u9605\u8bfb\u65f6\u5728\u9875\u8fb9\u7a7a\u767d\u5904\u505a\u6ce8\u91ca\u3002</p> </li> <li> <p>\u6807\u8bb0\u76f8\u5173\u7684\u672a\u8bfb\u53c2\u8003\u6587\u732e\u4ee5\u4f9b\u8fdb\u4e00\u6b65\u9605\u8bfb(\u8fd9\u662f\u4e86\u89e3\u8bba\u6587\u80cc\u666f\u7684\u597d\u65b9\u6cd5)\uff1b</p> </li> </ul> <p>\u9a8c\u8bc1\u6807\u51c6</p> <ul> <li>\u628a\u62a5\u544a\u7684\u4e3b\u8981\u5185\u5bb9\uff0c\u8fde\u540c\u652f\u6301\u6027\u7684\u8bc1\u636e\uff0c\u603b\u7ed3\u7ed9\u522b\u4eba\u542c\u3002</li> </ul>"},{"location":"paper_reading/how_to_read_a_paper.html#1-4","title":"\u7b2c\u4e09\u8d9f\uff081-4\u5c0f\u65f6\uff09","text":"<p>\u9605\u8bfb\u6807\u51c6</p> <ul> <li>\u8bc6\u522b\u548c\u6311\u6218\u6bcf\u4e00\u4e2a\u9648\u8ff0\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5047\u8bbe\u3002</li> <li>\u81ea\u5df1\u5982\u4f55\u8868\u8fbe\u4e00\u4e2a\u7279\u5b9a\u7684\u60f3\u6cd5\u3002</li> </ul> <p>\u9a8c\u8bc1\u6807\u51c6\uff1a</p> <ul> <li>\u80fd\u4ece\u8bb0\u5fc6\u4e2d\u91cd\u5efa\u6574\u7bc7\u6587\u7ae0\u7684\u7ed3\u6784\uff0c\u5e76\u80fd\u8bc6\u522b\u51fa\u5b83\u7684\u4f18\u7f3a\u70b9\u3002</li> <li>\u5e94\u8be5\u80fd\u591f\u6307\u51fa\u9690\u542b\u7684\u5047\u8bbe\u3001\u76f8\u5173\u5de5\u4f5c\u4e2d\u7f3a\u5c11\u7684\u5f15\u7528\u4ee5\u53ca\u5b9e\u9a8c\u6216\u5206\u6790\u6280\u672f\u4e2d\u7684\u6f5c\u5728\u95ee\u9898\u3002</li> </ul>"},{"location":"scheduler_system/index.html","title":"\u5206\u5e03\u5f0f\u5468\u671f\u6027\u4efb\u52a1\u7cfb\u7edf","text":"<p>\u5185\u5bb9\u6765\u6e90\u4e8e\u4e66\u7c4d\u300a\u8c37\u6b4cSRE\u300b</p>"},{"location":"scheduler_system/index.html#_2","title":"\u5e42\u7b49\u6027","text":""},{"location":"scheduler_system/index.html#cron","title":"\u5206\u5e03\u5f0fCron","text":""},{"location":"scheduler_system/index.html#_3","title":"\u8d44\u6e90\u548c\u4f5c\u4e1a\u8c03\u5ea6\u7cfb\u7edf","text":"<p>Volcano\uff1a\u9ad8\u6027\u80fd\u5de5\u4f5c\u8d1f\u8f7d\u573a\u666f\u4e0b\u57fa\u4e8eKubernetes\u7684\u5bb9\u5668\u6279\u91cf\u8c03\u5ea6\u5f15\u64ce</p> <p>Yunikorn\uff1a</p>"},{"location":"scheduler_system/index.html#_4","title":"\u8c03\u5ea6\u5668\u7684\u5206\u7c7b","text":"<p>\u4e1a\u5185\u7684\u96c6\u7fa4\u8c03\u5ea6\u7cfb\u7edf\u6309\u7167\u67b6\u6784\u533a\u5206\uff0c\u53ef\u4ee5\u5206\u4e3a\u5355\u4f53\u5f0f\u8c03\u5ea6\u5668\u3001\u4e24\u7ea7\u8c03\u5ea6\u5668\u3001\u5171\u4eab\u72b6\u6001\u8c03\u5ea6\u5668\u3001\u5206\u5e03\u5f0f\u8c03\u5ea6\u5668\u548c\u6df7\u5408\u8c03\u5ea6\u5668\u8fd9\u4e94\u79cd\u4e0d\u540c\u67b6\u6784\uff08\u89c1\u4e0b\u56fe\uff09</p> <p></p> <ul> <li>\u5355\u4f53\u5f0f\u8c03\u5ea6\u5668\uff1a\u4f7f\u7528\u590d\u6742\u7684\u8c03\u5ea6\u7b97\u6cd5\u7ed3\u5408\u96c6\u7fa4\u7684\u5168\u5c40\u4fe1\u606f\uff0c\u8ba1\u7b97\u51fa\u9ad8\u8d28\u91cf\u7684\u653e\u7f6e\u70b9\uff0c\u4e0d\u8fc7\u5ef6\u8fdf\u8f83\u9ad8\u3002\u5982Google\u7684Borg\u7cfb\u7edf\u3001\u5f00\u6e90\u7684Kubernetes\u7cfb\u7edf\u3002</li> <li>\u4e24\u7ea7\u8c03\u5ea6\u5668\uff1a\u901a\u8fc7\u5c06\u8d44\u6e90\u8c03\u5ea6\u548c\u4f5c\u4e1a\u8c03\u5ea6\u5206\u79bb\uff0c\u89e3\u51b3\u5355\u4f53\u5f0f\u8c03\u5ea6\u5668\u7684\u5c40\u9650\u6027\u3002\u4e24\u7ea7\u8c03\u5ea6\u5668\u5141\u8bb8\u6839\u636e\u7279\u5b9a\u7684\u5e94\u7528\u505a\u4e0d\u540c\u7684\u4f5c\u4e1a\u8c03\u5ea6\u903b\u8f91\uff0c\u4e14\u540c\u65f6\u4fdd\u6301\u4e86\u4e0d\u540c\u4f5c\u4e1a\u4e4b\u95f4\u5171\u4eab\u96c6\u7fa4\u8d44\u6e90\u7684\u7279\u6027\uff0c\u53ef\u662f\u65e0\u6cd5\u5b9e\u73b0\u9ad8\u4f18\u5148\u7ea7\u5e94\u7528\u7684\u62a2\u5360\u3002\u5177\u6709\u4ee3\u8868\u6027\u7684\u7cfb\u7edf\u662fApache Mesos\u548cHadoop YARN\u3002</li> <li>\u5171\u4eab\u72b6\u6001\u8c03\u5ea6\u5668\uff1a\u901a\u8fc7\u534a\u5206\u5e03\u5f0f\u7684\u65b9\u5f0f\u6765\u89e3\u51b3\u4e24\u7ea7\u8c03\u5ea6\u5668\u7684\u5c40\u9650\u6027\uff0c\u5171\u4eab\u72b6\u6001\u4e0b\u7684\u6bcf\u4e2a\u8c03\u5ea6\u5668\u90fd\u62e5\u6709\u4e00\u4efd\u96c6\u7fa4\u72b6\u6001\u7684\u526f\u672c\uff0c\u4e14\u8c03\u5ea6\u5668\u72ec\u7acb\u5bf9\u96c6\u7fa4\u72b6\u6001\u526f\u672c\u8fdb\u884c\u66f4\u65b0\u3002\u4e00\u65e6\u672c\u5730\u7684\u72b6\u6001\u526f\u672c\u53d1\u751f\u53d8\u5316\uff0c\u6574\u4e2a\u96c6\u7fa4\u7684\u72b6\u6001\u4fe1\u606f\u5c31\u4f1a\u88ab\u66f4\u65b0\uff0c\u4f46\u6301\u7eed\u8d44\u6e90\u4e89\u62a2\u4f1a\u5bfc\u81f4\u8c03\u5ea6\u5668\u6027\u80fd\u4e0b\u964d\u3002\u5177\u6709\u4ee3\u8868\u6027\u7684\u7cfb\u7edf\u662fGoogle\u7684Omega\u548c\u5fae\u8f6f\u7684Apollo\u3002</li> <li>\u5206\u5e03\u5f0f\u8c03\u5ea6\u5668\uff1a\u4f7f\u7528\u8f83\u4e3a\u7b80\u5355\u7684\u8c03\u5ea6\u7b97\u6cd5\u4ee5\u5b9e\u73b0\u9488\u5bf9\u5927\u89c4\u6a21\u7684\u9ad8\u541e\u5410\u3001\u4f4e\u5ef6\u8fdf\u5e76\u884c\u4efb\u52a1\u653e\u7f6e\uff0c\u4f46\u7531\u4e8e\u8c03\u5ea6\u7b97\u6cd5\u8f83\u4e3a\u7b80\u5355\u5e76\u7f3a\u4e4f\u5168\u5c40\u7684\u8d44\u6e90\u4f7f\u7528\u89c6\u89d2\uff0c\u5f88\u96be\u8fbe\u5230\u9ad8\u8d28\u91cf\u7684\u4f5c\u4e1a\u653e\u7f6e\u6548\u679c\uff0c\u4ee3\u8868\u6027\u7cfb\u7edf\u5982\u52a0\u5dde\u5927\u5b66\u7684Sparrow\u3002</li> <li>\u6df7\u5408\u8c03\u5ea6\u5668\u5c06\u5de5\u4f5c\u8d1f\u8f7d\u5206\u6563\u5230\u96c6\u4e2d\u5f0f\u548c\u5206\u5e03\u5f0f\u7ec4\u4ef6\u4e0a\uff0c\u5bf9\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u4efb\u52a1\u4f7f\u7528\u590d\u6742\u7b97\u6cd5\uff0c\u5bf9\u77ed\u65f6\u95f4\u8fd0\u884c\u7684\u4efb\u52a1\u5219\u4f9d\u8d56\u4e8e\u5206\u5e03\u5f0f\u5e03\u5c40\u3002\u5fae\u8f6fMercury\u5c31\u91c7\u53d6\u4e86\u8fd9\u79cd\u8fd9\u79cd\u65b9\u6848\u3002</li> </ul>"},{"location":"scheduler_system/index.html#_5","title":"\u5de5\u4f5c\u6d41\u8c03\u5ea6\u7cfb\u7edf","text":""},{"location":"scheduler_system/index.html#apache-oozie","title":"Apache Oozie","text":"<p>Oozie(\u9a6f\u8c61\u4eba) is a workflow scheduler system to manage Apache Hadoop jobs, supporting several types of Hadoop jobs out of the box (such as Java map-reduce, Streaming map-reduce, Pig, Hive, Sqoop and Distcp) as well as system specific jobs (such as Java programs and shell scripts).</p>"},{"location":"scheduler_system/index.html#api","title":"API","text":"<p>\u652f\u6301 Web\uff0cRestApi\uff0cJava API \u64cd\u4f5c\uff1b</p>"},{"location":"scheduler_system/index.html#dophinscheduler","title":"DophinScheduler","text":"<p>\u5206\u5e03\u5f0f\u6613\u6269\u5c55\u7684\u53ef\u89c6\u5316DAG\u5de5\u4f5c\u6d41\u4efb\u52a1\u8c03\u5ea6\u7cfb\u7edf\u3002</p>"},{"location":"scheduler_system/index.html#argo-workflow","title":"Argo Workflow","text":"<p>an open source container-native workflow engine for orchestrating parallel jobs on Kubernetes.</p>"},{"location":"scheduler_system/index.html#tekton-pipelines","title":"Tekton Pipelines","text":""},{"location":"scheduler_system/index.html#apache-airflow","title":"Apache Airflow","text":""},{"location":"scheduler_system/index.html#couler","title":"Couler","text":"<p>a unified interface for constructing and managing workflows on different workflow engines, such as Argo Workflows, Tekton Pipelines, and Apache Airflow.</p>"},{"location":"scheduler_system/index.html#_6","title":"\u793a\u4f8b","text":"<pre><code>import couler.argo as couler\nfrom couler.argo_submitter import ArgoSubmitter\n\ncouler.run_container(\n    image=\"docker/whalesay\", command=[\"cowsay\"], args=[\"hello world\"]\n)\n\nsubmitter = ArgoSubmitter()\nresult = couler.run(submitter=submitter)\n</code></pre>"},{"location":"scheduler_system/apache_dolphin_scheduler.html","title":"Apache Dolphin Scheduler","text":"<p>\u5206\u5e03\u5f0f\u6613\u6269\u5c55\u7684\u53ef\u89c6\u5316DAG\u5de5\u4f5c\u6d41\u4efb\u52a1\u8c03\u5ea6\u7cfb\u7edf\u3002</p> <p>\u4ee5DAG\u7684\u65b9\u5f0f\u5c06Task\u7ec4\u88c5\u8d77\u6765\uff0c\u5b9e\u65f6\u76d1\u63a7\u4efb\u52a1\u7684\u8fd0\u884c\u72b6\u6001\uff0c\u652f\u6301\u91cd\u8bd5\u3001\u4ece\u6307\u5b9a\u8282\u70b9\u6062\u590d\u5931\u8d25\u3001\u6682\u505c\u548cKill\u4efb\u52a1\u7b49\u64cd\u4f5c\u3002</p>"},{"location":"scheduler_system/apache_dolphin_scheduler.html#_1","title":"\u7279\u6027","text":"<ul> <li>\u53ef\u89c6\u5316DAG\uff0c\u7b80\u5355\u64cd\u4f5c\u3001\u5b9e\u65f6\u67e5\u770b\uff0c\u652f\u6301\u6570\u4e07\u4efb\u52a1\u8fd0\u884c\uff1b</li> <li>\u8c03\u7528\u9ad8\u53ef\u7528\uff0c\u6d41\u7a0b\u5bb9\u9519\u3001\u5931\u8d25\u91cd\u8bd5\u3001\u56de\u6eda\u3001\u8f6c\u79fb\u7b49\uff1b</li> <li>\u4e30\u5bcc\u7684\u4efb\u52a1\u7c7b\u578b\uff0c\u8de8\u8bed\u8a00\uff0c\u81ea\u5b9a\u4e49\u63d2\u4ef6\uff1b</li> <li>\u4efb\u52a1\u4f9d\u8d56\uff0c\u6d41\u7a0b\u4f9d\u8d56\uff1b</li> <li>\u4efb\u52a1\u65e5\u5fd7/\u544a\u8b66\u673a\u5236\uff1b</li> <li>\u8865\u6570\uff0c\u6570\u636e\u91cd\u5237\uff1b</li> </ul>"},{"location":"scheduler_system/apache_dolphin_scheduler.html#_2","title":"\u67b6\u6784","text":""},{"location":"scheduler_system/apache_dolphin_scheduler.html#_3","title":"\u6982\u5ff5","text":"<p>\u5de5\u4f5c\u7ec4\uff08Worker\u7ec4\uff09\uff1a\u5de5\u4f5c\u6d41\u8fd0\u884c\u65f6\u9700\u8981\u9009\u5b9a\u5de5\u4f5c\u7ec4\uff0c</p> <ul> <li>\u53ef\u7528\u4e8e\u5bf9\u4e0d\u540c\u7684\u8282\u70b9\u8fdb\u884c\u5206\u7c7b\uff0c\u6bd4\u5982\u67d0\u4e2a\u8282\u70b9\u5177\u5907\u5927\u6570\u636e\u73af\u5883\uff0c\u5fc5\u987b\u8fd0\u884c\u5728\u8be5\u8282\u70b9\u4e0a\uff1b</li> </ul> <p>\u73af\u5883\uff1a\u7ed1\u5b9a\u5728 Worker \u7ec4\uff0c\u914d\u7f6e\u4e0d\u540c\u7684\u73af\u5883\u53d8\u91cf\u4fe1\u606f\uff1b</p>"},{"location":"scheduler_system/apache_dolphin_scheduler.html#_4","title":"\u8c03\u5ea6","text":"<p>\u5206\u914d\u4efb\u52a1\u81f3\u540c\u4e00 worker \u7ec4\u7684\u4e0d\u540c\u673a\u5668\u4e0a\uff0c\u9ed8\u8ba4\u63d0\u4f9b\u4e86\u4e09\u79cd\u7b97\u6cd5\uff1a</p> <ul> <li>\u52a0\u6743\u968f\u673a\uff08random\uff09</li> <li>\u5e73\u6ed1\u8f6e\u8be2\uff08roundrobin\uff09</li> <li>\u7ebf\u6027\u8d1f\u8f7d\uff08lowerweight\uff09\uff0c\u9ed8\u8ba4\u914d\u7f6e\u4e3a\u7ebf\u6027\u52a0\u6743\u8d1f\u8f7d</li> </ul>"},{"location":"scheduler_system/apache_yunikorn.html","title":"Apache Yunikorn\uff08Incubating\uff09","text":"<p>YuniKorn\u662f\u5bf9kubernetes \u670d\u52a1\u548c\u6279\u4efb\u52a1\u8d1f\u8f7d\u7684\u8c03\u5ea6\u589e\u5f3a\u3002YuniKorn\u80fd\u591f\u4ee3\u66ffKubernetes\u9ed8\u8ba4\u7684\u8c03\u5ea6\u5668</p> <p>2022/11/25</p> <p>Cloudera\u53d1\u8d77\u5e76\u5f00\u6e90\u7684\u9879\u76ee\uff0c\u5b9a\u4f4d\u4e8e\u8de8\u5e73\u53f0\u7684\u901a\u7528\u8c03\u5ea6\u5668\uff0c\u5f53\u524d\u53ef\u4ee5\u652f\u6301Kubernetes\uff0cYARN\u7684\u652f\u6301\u8fd8\u5728\u5f00\u53d1\u4e2d\u3002</p>"},{"location":"scheduler_system/apache_yunikorn.html#_1","title":"\u529f\u80fd","text":"<ul> <li>\u8c03\u5ea6\u80fd\u529b\uff1a\u5185\u7f6e\u5168\u9762\u7684\u8c03\u5ea6\u529f\u80fd\uff0c\u5305\u62ec\u5c42\u6b21\u961f\u5217\u3001 \u8de8\u961f\u5217\u7684\u8d44\u6e90\u516c\u5e73\u6027\u3001\u4f5c\u4e1a\u6392\u5e8f (FIFO/FAIR)\u3001 \u53ef\u63d2\u62d4\u8282\u70b9\u6392\u5e8f\u7b56\u7565\u3001\u62a2\u5360\u7b49\u3002</li> <li>K8s\u8d44\u6e90\u8c03\u5ea6\u5668\uff1a\u5b8c\u5168\u517c\u5bb9 K8s\uff0c\u662f\u9ed8\u8ba4 K8s \u8c03\u5ea6\u7684\u66ff\u4ee3\u65b9\u6848\uff0c\u4f46\u529f\u80fd\u66f4\u5f3a\u5927\u3002 \u5bf9\u73b0\u6709\u7684 K8s \u5e94\u7528\u7a0b\u5e8f\u5b8c\u5168\u900f\u660e\u3002</li> <li>\u4e91\u539f\u751f\uff1a\u652f\u6301\u672c\u5730\u548c\u4e91\u7aef\u7528\u4f8b\uff0c\u5728\u4e91\u4e0a\u8fd0\u884c\u65f6\uff0c\u5b83\u4e0e\u5f39\u6027\u4f38\u7f29\u63a7\u5236\u5668\u5171\u540c\u534f\u4f5c\uff0c\u4ee5\u5e26\u6765\u6700\u5927\u7684\u8d44\u6e90\u5f39\u6027\u548c\u66f4\u597d\u7684\u541e\u5410\u91cf\u3002</li> </ul>"},{"location":"scheduler_system/apache_yunikorn.html#_2","title":"\u5e94\u7528\u611f\u77e5\u8c03\u5ea6","text":"<p>\u8bc6\u522b\u7528\u6237\u3001\u4f5c\u4e1a\u6216\u8005\u961f\u5217\uff0c\u5e76\u5728\u505a\u51fa\u8c03\u5ea6\u51b3\u7b56\u65f6\uff0c\u8003\u8651\u66f4\u591a\u4e0e\u5b83\u4eec\u76f8\u5173\u7684\u56e0\u7d20\uff0c\u5982\u8d44\u6e90\u3001\u6392\u5e8f\u7b49\u3002</p> <p>\u80fd\u591f\u5bf9\u8d44\u6e90\u914d\u989d\u3001\u8d44\u6e90\u516c\u5e73\u6027\u548c\u4f18\u5148\u7ea7\u8fdb\u884c\u7ec6\u7c92\u5ea6\u63a7\u5236\uff0c\u8fd9\u662f\u591a\u79df\u6237\u8ba1\u7b97\u7cfb\u7edf\u6700\u91cd\u8981\u7684\u9700\u6c42\u3002</p>"},{"location":"scheduler_system/apache_yunikorn.html#_3","title":"\u5c42\u6b21\u8d44\u6e90\u961f\u5217","text":"<p>\u961f\u5217\u7684\u5c42\u6b21\u7ed3\u6784\u53ef\u4ee5\u5728\u903b\u8f91\u4e0a\u6620\u5c04\u5230\u7ec4\u7ec7\u7ed3\u6784\u3002\u8fd9\u4e3a\u4e0d\u540c\u79df\u6237\u63d0\u4f9b\u4e86\u5bf9\u8d44\u6e90\u7684\u7ec6\u7c92\u5ea6\u63a7\u5236\u3002</p> <p>\u6700\u5c0f/\u6700\u5927\u961f\u5217\u5bb9\u91cf\u6765\u4e3a\u6bcf\u4e2a\u79df\u6237\u8bbe\u5b9a\u5176\u5f39\u6027\u8d44\u6e90\u914d\u989d\u3002</p>"},{"location":"scheduler_system/apache_yunikorn.html#_4","title":"\u4f5c\u4e1a\u6392\u5e8f\u548c\u6392\u961f","text":"<p>\u6392\u5e8f\u7b56\u7565\u51b3\u5b9a\u54ea\u4e2a\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u9996\u5148\u83b7\u5f97\u8d44\u6e90\uff0c\u5982\u679c\u5269\u4f59\u7684\u5bb9\u91cf\u4e0d\u591f\uff0c\u5b83\u4eec\u53ef\u4ee5\u6392\u961f\u7b49\u5f85\uff0c\u76f4\u5230\u91ca\u653e\u4e00\u4e9b\u8d44\u6e90\u3002\u7b80\u5316\u5ba2\u6237\u7aef\u64cd\u4f5c\u3002</p>"},{"location":"scheduler_system/apache_yunikorn.html#_5","title":"\u8d44\u6e90\u516c\u5e73\u6027","text":""},{"location":"scheduler_system/apache_yunikorn.html#_6","title":"\u8d44\u6e90\u9884\u7559","text":"<p>\u81ea\u52a8\u4e3a\u672a\u5b8c\u6210\u7684\u8bf7\u6c42\u8fdb\u884c\u8d44\u6e90\u9884\u7559\uff0c\u907f\u514d\u8fd9\u4e2a Pod \u9700\u8981\u7684\u8d44\u6e90\u88ab\u540e\u6765\u63d0\u4ea4\u7684\u66f4\u5c0f\u7684\u3001\u66f4\u4e0d\u6311\u5254\u7684 Pod \u6240\u6324\u5360\u3002 </p> <p>\u5728\u6279\u5904\u7406\u5de5\u4f5c\u8d1f\u8f7d\u573a\u666f\u4e2d\u975e\u5e38\u91cd\u8981\uff0c\u56e0\u4e3a\u5f53\u5bf9\u96c6\u7fa4\u63d0\u4ea4\u5927\u91cf\u5f02\u6784 Pod \u65f6\uff0c\u5f88\u6709\u53ef\u80fd\u4e00\u4e9b Pod \u4f1a\u5904\u4e8e\u201c\u9965\u997f\u201d\u72b6\u6001\uff0c\u5373\u4f7f\u5b83\u4eec\u63d0\u4ea4\u5f97\u66f4\u65e9\u3002</p>"},{"location":"scheduler_system/apache_yunikorn.html#_7","title":"\u541e\u5410\u91cf","text":"<p>\u4e0e\u9ed8\u8ba4\u8c03\u5ea6\u7a0b\u5e8f\u76f8\u6bd4\uff0cYuniKorn\u5b9e\u73b0\u4e862 \u500d~4 \u500d\u7684\u6027\u80fd\u63d0\u5347\u3002</p>"},{"location":"scheduler_system/apache_yunikorn.html#_8","title":"\u67b6\u6784","text":""},{"location":"scheduler_system/apache_yunikorn.html#todohttpsyunikornapacheorgzh-cndocsnextdesignarchitecture","title":"TODO(https://yunikorn.apache.org/zh-cn/docs/next/design/architecture)","text":""},{"location":"scheduler_system/apache_yunikorn.html#_9","title":"\u5b89\u88c5","text":""},{"location":"scheduler_system/apache_yunikorn.html#_10","title":"\u90e8\u7f72\u6a21\u5f0f","text":"<p>\u63d2\u4ef6\u6a21\u5f0f\u8fd8\u672a\u8fbe\u5230\u6807\u51c6\u6a21\u5f0f\u7684\u6210\u719f\u5ea6</p> <ul> <li>\u6807\u51c6\u6a21\u5f0f \uff1aYuniKorn\u4f5c\u4e3a\u81ea\u5b9a\u4e49\u6a21\u5f0f\u8fd0\u884cKubernetes\u8c03\u5ea6\u7a0b\u5e8f</li> <li>\u63d2\u4ef6\u6a21\u5f0f \uff1aYuniKorn\u88ab\u5b9e\u73b0\u4e3a\u9ed8\u8ba4Kubernetes\u8c03\u5ea6\u6846\u67b6\u4e4b\u4e0a\u7684\u4e00\u7ec4\u63d2\u4ef6\u3002</li> </ul> <p>\u5efa\u8bae\u540c\u65f6\u8fd0\u884c\u51c6\u5165\u63a7\u5236\u5668(admin controller)\uff0c\u8fd9\u4f1a\u786e\u4fdd\u53ea\u6709\u4e00\u4e2a\u8c03\u5ea6\u7a0b\u5e8f\u5728Kubernetes\u96c6\u7fa4\u4e2d\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u3002</p> <p>\u5f53\u51c6\u5165\u63a7\u5236\u5668\u8fd0\u884c\u65f6\uff0c\u6240\u6709pod\u5c06\u4f1a\u7ed5\u8fc7Kubernetes\u7684\u9ed8\u8ba4\u8c03\u5ea6\u5668\uff0c\u9664\u4e86YuniKorn\u672c\u8eab\u7684pod\u3002</p>"},{"location":"scheduler_system/apache_yunikorn.html#helm","title":"helm \u5b89\u88c5","text":"<ul> <li>\u9ed8\u8ba4\u5b89\u88c5<code>scheduler</code>\u3001<code>web-server</code>\u3001<code>admission-controller</code>\uff0c\u91c7\u7528\u6807\u51c6\u6a21\u5f0f\uff1b</li> <li><code>enableSchedulerPlugin</code>\u914d\u7f6e\u8bbe\u7f6e\u4e3a<code>true</code>\uff0c\u91c7\u7528\u63d2\u4ef6\u6a21\u5f0f\uff1b</li> </ul> <pre><code>helm repo add yunikorn https://apache.github.io/yunikorn-release\nhelm repo update\nkubectl create namespace yunikorn\nhelm install yunikorn yunikorn/yunikorn --namespace yunikorn\n</code></pre>"},{"location":"scheduler_system/apache_yunikorn.html#todo","title":"\u6307\u5bfc\uff08TODO\uff09","text":"<p>https://yunikorn.apache.org/zh-cn/docs/next/user_guide/usergroup_resolution</p>"},{"location":"scheduler_system/apache_yunikorn.html#gangscheduling","title":"GangScheduling","text":""},{"location":"scheduler_system/apache_yunikorn.html#_11","title":"\u4f7f\u7528","text":""},{"location":"scheduler_system/apache_yunikorn.html#spark-on-k8s-with-yunikorntodo","title":"Spark On K8s with Yunikorn(TODO)","text":""},{"location":"scheduler_system/argoworkflow.html","title":"Argo Workflow","text":"<p>an open source container-native workflow engine for orchestrating parallel jobs on Kubernetes.</p> <p>\u662f\u4e00\u4e2a\u4e91\u539f\u751f\u5de5\u4f5c\u6d41\u5f15\u64ce\uff0c\u4e13\u6ce8\u4e8e\u7f16\u6392\u5e76\u884c\u4efb\u52a1\u3002\u5b83\u7684\u7279\u70b9\u5982\u4e0b\uff1a</p> <ol> <li>\u4f7f\u7528 Kubernetes \u81ea\u5b9a\u4e49\u8d44\u6e90(CR)\u5b9a\u4e49\u5de5\u4f5c\u6d41\uff0c\u5176\u4e2d\u5de5\u4f5c\u6d41\u4e2d\u7684\u6bcf\u4e2a\u6b65\u9aa4\u90fd\u662f\u4e00\u4e2a\u5bb9\u5668\u3002</li> <li>\u5c06\u591a\u6b65\u9aa4\u5de5\u4f5c\u6d41\u5efa\u6a21\u4e3a\u4e00\u7cfb\u5217\u4efb\u52a1\uff0c\u6216\u8005\u4f7f\u7528\u6709\u5411\u65e0\u73af\u56fe\uff08DAG\uff09\u63cf\u8ff0\u4efb\u52a1\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\u3002</li> <li>\u53ef\u4ee5\u5728\u77ed\u65f6\u95f4\u5185\u8f7b\u677e\u8fd0\u884c\u7528\u4e8e\u673a\u5668\u5b66\u4e60\u6216\u6570\u636e\u5904\u7406\u7684\u8ba1\u7b97\u5bc6\u96c6\u578b\u4f5c\u4e1a\u3002</li> <li>argo workflows \u53ef\u4ee5\u770b\u4f5c Tekton \u7684\u52a0\u5f3a\u7248\uff0c\u56e0\u6b64\u663e\u7136\u4e5f\u53ef\u4ee5\u901a\u8fc7 argo workflows \u8fd0\u884c CI/CD \u6d41\u6c34\u7ebf(Pipielines)\u3002</li> </ol> <p>Argo workflows \u5219\u5047\u8bbe\u300c\u4efb\u52a1\u300d\u4e4b\u95f4\u662f\u6709\u4f9d\u8d56\u5173\u7cfb\u7684\uff0c\u9488\u5bf9\u8fd9\u4e2a\u4f9d\u8d56\u5173\u7cfb\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e24\u79cd\u534f\u8c03\u7f16\u6392\u300c\u4efb\u52a1\u300d\u7684\u65b9\u6cd5\uff1aSteps \u548c DAG\u3002</p> <p>\u53ef\u4ee5\u6839\u636e\u7528\u6237\u63d0\u4ea4\u7684\u7f16\u6392\u6a21\u677f\uff0c\u5f88\u5bb9\u6613\u7684\u6784\u5efa\u51fa\u4e00\u4e2a\u6709\u76f8\u4e92\u4f9d\u8d56\u5173\u7cfb\u7684\u5de5\u4f5c\u6d41\u3002Argo Workflow \u5c31\u53ef\u4ee5\u5904\u7406\u8fd9\u4e9b\u4f9d\u8d56\u5173\u7cfb\uff0c\u5e76\u4e14\u6309\u7167\u7528\u6237\u8bbe\u5b9a\u7684\u987a\u5e8f\u4f9d\u6b21\u8fd0\u884c\u3002</p> <p></p>"},{"location":"scheduler_system/argoworkflow.html#_1","title":"\u529f\u80fd","text":""},{"location":"scheduler_system/argoworkflow.html#_2","title":"\u5206\u7c7b","text":"<p>\u5f53 Workflow \uff08\u524d\u7aef/\u540e\u7aef/\u6d4b\u8bd5\u7b49\uff09\u8d8a\u6765\u8d8a\u591a\u7684\u65f6\u5019\uff0c\u5982\u679c\u4e0d\u505a\u5206\u7c7b\uff0c\u4e00\u5806 WorkflowTemplate \u5806\u5728\u4e00\u8d77\u5c31\u4f1a\u663e\u5f97\u7279\u522b\u6df7\u4e71\u3002</p> <p>\u901a\u8fc7 namespace / labels \u8fdb\u884c\u5206\u7c7b\u3002</p>"},{"location":"scheduler_system/argoworkflow.html#_3","title":"\u89e6\u53d1","text":"<ul> <li> <p>\u624b\u52a8\u89e6\u53d1\uff1a\u624b\u52a8\u63d0\u4ea4\u4e00\u4e2a Workflow</p> </li> <li> <p>\u5b9a\u65f6\u89e6\u53d1\uff1aCronWorkflow</p> </li> <li>\u901a\u8fc7 Git \u4ed3\u5e93\u53d8\u66f4\u89e6\u53d1\uff1a\u501f\u52a9 argo-events \u53ef\u4ee5\u5b9e\u73b0\u6b64\u529f\u80fd\uff0c\u8be6\u89c1\u5176\u6587\u6863</li> </ul>"},{"location":"scheduler_system/argoworkflow.html#secrets","title":"secrets \u7ba1\u7406","text":"<p>\u6d41\u6c34\u7ebf\uff0c\u53ef\u4ee5\u4ece kubernetes secrets/configmap \u4e2d\u83b7\u53d6\u4fe1\u606f(Git \u79c1\u94a5\u3001Harbor \u4ed3\u5e93\u51ed\u636e\u3001CD \u9700\u8981\u7684 kubeconfig)\uff0c\u5c06\u4fe1\u606f\u6ce8\u5165\u5230\u73af\u5883\u53d8\u91cf\u4e2d\u3001\u6216\u8005\u4ee5\u6587\u4ef6\u5f62\u5f0f\u6302\u8f7d\u5230 Pod \u4e2d\u3002</p>"},{"location":"scheduler_system/argoworkflow.html#artifacts","title":"Artifacts","text":"<p>\u652f\u6301\u63a5\u5165\u5bf9\u8c61\u5b58\u50a8\uff0c\u505a\u5168\u5c40\u7684 Artifact \u4ed3\u5e93\uff0c\u672c\u5730\u53ef\u4ee5\u4f7f\u7528 MinIO.</p>"},{"location":"scheduler_system/argoworkflow.html#_4","title":"\u955c\u50cf\u6784\u5efa","text":"<p>Kaniko \u5bf9\u6784\u5efa\u7f13\u5b58\u7684\u652f\u6301\u4e5f\u5f88\u597d\uff0c\u53ef\u4ee5\u76f4\u63a5\u5c06\u7f13\u5b58\u5b58\u50a8\u5728\u5bb9\u5668\u955c\u50cf\u4ed3\u5e93\u4e2d\u3002</p>"},{"location":"scheduler_system/argoworkflow.html#_5","title":"\u4fe1\u606f\u4f20\u9012","text":"<p>Argo\u7684\u6b65\u9aa4\u95f4\u53ef\u4ee5\u4f20\u9012\u4fe1\u606f\uff0c\u5373\u4e0b\u4e00\u6b65\uff08\u5bb9\u5668\uff09\u53ef\u4ee5\u83b7\u53d6\u4e0a\u4e00\u6b65\uff08\u5bb9\u5668\uff09\u7684\u7ed3\u679c\u3002\u7ed3\u679c\u4f20\u9012\u67092\u79cd\uff1a</p> <ol> <li> <p>\u6587\u4ef6\uff1a\u4e0a\u4e00\u6b65\u5bb9\u5668\u65b0\u751f\u6210\u7684\u6587\u4ef6\uff0c\u4f1a\u76f4\u63a5\u51fa\u73b0\u5728\u4e0b\u4e00\u6b65\u5bb9\u5668\u91cc\u9762\u3002</p> </li> <li> <p>\u4fe1\u606f\uff1a\u4e0a\u4e00\u6b65\u7684\u6267\u884c\u7ed3\u679c\u4fe1\u606f\uff08\u5982\u67d0\u6587\u4ef6\u5185\u5bb9\uff09\uff0c\u4e0b\u4e00\u6b65\u4e5f\u53ef\u4ee5\u62ff\u5230\u3002</p> </li> </ol> <p>\u4e2d\u8f6c\u6587\u4ef6\u7684\u7ea6\u675f\uff1a</p> <p>\uff081\uff09\u201c\u4e34\u65f6\u4e2d\u8f6c\u4ed3\u5e93\u201d\u9700\u8981\u5f15\u5165\u7b2c\u4e09\u65b9\u8f6f\u4ef6\uff08Minio\uff09</p> <p>\uff082\uff09\u6587\u4ef6\u4e0d\u80fd\u592a\u5927</p> <p>\uff083\uff09\u9700\u8981\u5728\u7528\u6237\u5bb9\u5668\u4fa7\uff0c\u589e\u52a0\u201c\u4ee3\u7406\u201d\u5e2e\u5fd9\u4e0a\u4f20&amp;\u4e0b\u8f7d\u6587\u4ef6\u3002</p> <p>\u4f20\u9012\u7ed3\u679c\u4fe1\u606f\uff08Information\uff09:</p> <ul> <li>Pod\u91cc\u9762\u7684Annotation\u5b57\u6bb5\uff0c\u5f53\u505a\u4e34\u65f6\u4e2d\u8f6c\u4ed3\u5e93\u3002\u5148\u628a\u4fe1\u606f\u8bb0\u8fd9\u91cc\uff0c\u4e0b\u4e00\u6b65\u5bb9\u5668\u60f3\u8981\uff0c\u5c31\u6765\u8fd9\u91cc\u53d6\uff0c\u7ea6\u675f\u6bd4\u8f83\u5927\uff08\u7279\u522b\u662fETCD\u7684\u5355\u4e2a\u5bf9\u8c61\u4e0d\u80fd\u8d85\u8fc71M\u5927\u5c0f\uff09</li> </ul>"},{"location":"scheduler_system/argoworkflow.html#_6","title":"\u81ea\u5b9a\u4e49\u8d44\u6e90","text":""},{"location":"scheduler_system/argoworkflow.html#workflow","title":"Workflow","text":""},{"location":"scheduler_system/argoworkflow.html#_7","title":"\u793a\u4f8b","text":""},{"location":"scheduler_system/argoworkflow.html#cli","title":"CLI","text":"<p>\u63d0\u4ea4\u8fd0\u884c</p> <pre><code>$ argo submit -n argo --watch https://raw.githubusercontent.com/argoproj/argo-workflows/master/examples/hello-world.yaml\n</code></pre> <p><code>hello-world.yaml</code>\u5982\u4e0b\uff1a</p> <pre><code>apiVersion: argoproj.io/v1alpha1\nkind: Workflow\nmetadata:\n  generateName: hello-world-\n  labels:\n    workflows.argoproj.io/archive-strategy: \"false\"\n  annotations:\n    workflows.argoproj.io/description: |\n      This is a simple hello world example.\n      You can also run it in Python: https://couler-proj.github.io/couler/examples/#hello-world\nspec:\n  entrypoint: whalesay\n  templates:\n  - name: whalesay\n    container:\n      image: docker/whalesay:latest\n      command: [cowsay]\n      args: [\"hello world\"]\n</code></pre>"},{"location":"scheduler_system/azkaban.html","title":"Azkaban","text":"<p>Azkaban\u662f\u7531Linkedin\u5f00\u6e90\u7684\u4e00\u4e2a\u6279\u91cf\u5de5\u4f5c\u6d41\u4efb\u52a1\u8c03\u5ea6\u5668\u3002\u7528\u4e8e\u5728\u4e00\u4e2a\u5de5\u4f5c\u6d41\u5185\u4ee5\u4e00\u4e2a\u7279\u5b9a\u7684\u987a\u5e8f\u8fd0\u884c\u4e00\u7ec4\u5de5\u4f5c\u548c\u6d41\u7a0b\u3002Azkaban\u5b9a\u4e49\u4e86\u4e00\u79cdKV\u6587\u4ef6\u683c\u5f0f\u6765\u5efa\u7acb\u4efb\u52a1\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u5e76\u63d0\u4f9b\u4e00\u4e2a\u6613\u4e8e\u4f7f\u7528\u7684web\u7528\u6237\u754c\u9762\u7ef4\u62a4\u548c\u8ddf\u8e2a\u4f60\u7684\u5de5\u4f5c\u6d41\u3002</p> <p>\u5de5\u4f5c\u7a7a\u95f4\uff1aproject\uff1b</p> <p>zip\u6587\u4ef6\u4e2d\u53ef\u4ee5\u5305\u542b\u591a\u4e2ajob\u5b9a\u4e49\uff0c\u89e3\u6790\u6210DAG\u6267\u884c\uff1b</p> <p>job\u7684type\u652f\u6301command\u7b49\uff1b</p>"},{"location":"scheduler_system/delay_scheduling.html","title":"Delay scheduling","text":"<p>[toc]</p>"},{"location":"scheduler_system/delay_scheduling.html#scheduler","title":"Scheduler","text":""},{"location":"scheduler_system/delay_scheduling.html#gang-scheduler","title":"Gang scheduler","text":"<p>\u7528\u6237\u63d0\u4ea4\u4e00\u4e2a batch job, \u8fd9\u4e2abatch job \u5305\u542b100\u4e2a\u4efb\u52a1\uff0c\u8981\u4e0d\u8fd9100\u4e2a\u4efb\u52a1\u5168\u90e8\u8c03\u5ea6\u6210\u529f\uff0c\u8981\u4e48\u4e00\u4e2a\u90fd\u8c03\u5ea6\u4e0d\u6210\u529f\u3002\u8fd9\u79cd<code>all or nothing</code>\u8c03\u5ea6\u573a\u666f\uff0c\u5c31\u88ab\u79f0\u4f5c:<code>gang-schedule</code>\u3002</p>"},{"location":"scheduler_system/delay_scheduling.html#delay-scheduling","title":"Delay Scheduling","text":"<p>TODO\uff1a\u770b\u8bba\u6587</p> <p>2010_eurosys_delay_scheduling</p> <p>Yarn\u4e2d\u7684\u8c03\u5ea6\u7b97\u6cd5\uff0c\u5ef6\u8fdf\u8c03\u5ea6\uff0c\u5b9e\u73b0\u6570\u636e\u672c\u5730\u6027</p> <p>Yarn\u7ea7\u522b\u7684Delay Scheduler</p> <ul> <li>spark\u7684executor\u5206\u914d\u5728\u54ea\u4e9bnodemanager\u4e0a</li> </ul> <p>Spark\u5185\u90e8\u7684Task\u7684Delay Scheduler</p> <ul> <li>task\u5206\u914d\u5230\u54ea\u4e2aexecutor\u4e0a</li> </ul> <p>\u601d\u8003\uff1aTODO\uff08</p> <ul> <li>\u5728\u8ba1\u7b97/\u5b58\u50a8\u5206\u79bb\u573a\u666f\u4e0b\uff0c\u5ef6\u8fdf\u8c03\u5ea6\u8fd8\u6709\u7528\u4e48\uff1f\u8be5\u7528\u4ec0\u4e48\u8c03\u5ea6\u7b97\u6cd5\u5462\uff1f</li> </ul>"},{"location":"scheduler_system/kueue.html","title":"Kueue","text":"<p>Kueue is a kubernetes-native system that manages quotas and how jobs consume them. Kueue decides when a job should wait, when a job should be admitted to start (as in pods can be created) and when a job should be preempted (as in active pods should be deleted).</p> <p>\u529f\u80fd\uff1a</p> <ul> <li>\u4f5c\u4e1a\uff08Job\uff09\u7ba1\u7406</li> <li>\u8d44\u6e90\u7ba1\u7406</li> <li>\u52a8\u6001\u8d44\u6e90\u56de\u6536\uff1a</li> <li>\u96c6\u6210\u6027\uff1a\u5185\u7f6e\u652f\u6301\u591a\u79cd Jobs\uff0c\u5982 BatchJob, Kubeflow training Job, RayJob \u7b49\uff1b</li> </ul>"},{"location":"scheduler_system/kueue.html#_1","title":"\u6846\u67b6","text":""},{"location":"scheduler_system/kueue.html#resource-flavor","title":"Resource Flavor","text":"<p>An object that you can define to describe what resources are available in a cluster.</p> <p>\u7528\u4e8e\u8868\u793a\u5f02\u6784\u7684\u8d44\u6e90\uff08\u5e76\u4e0d\u5b9e\u9645\u5b9a\u4e49\u8d44\u6e90\uff0c\u53ea\u662f\u7528\u6765\u533a\u5206\u5f02\u6784\u7684\u8d44\u6e90\u8282\u70b9\uff09\uff1a</p> <ul> <li><code>spec.nodeLabels</code>\uff1a\u5c06\u8d44\u6e90\u8ddf\u8282\u70b9\u5173\u8054\uff1b</li> </ul> <pre><code>apiVersion: kueue.x-k8s.io/v1beta1\nkind: ResourceFlavor\nmetadata:\n  name: \"spot\"\nspec:\n  # \u8d44\u6e90\u5173\u8054\u7684\u8282\u70b9\u7684\u6807\u7b7e\n  nodeLabels:\n    instance-type: spot\n  # \u8d44\u6e90\u5173\u8054\u7684\u8282\u70b9\u7684\u6c61\u70b9\uff0cWorkload PodSet\u5fc5\u987b\u80fd\u591f\u5bb9\u5fcd\u8fd9\u4e9b\u6c61\u70b9\uff0c\u624d\u53ef\u4ee5\u8c03\u5ea6\u5230\u8282\u70b9\u4e0a\n  nodeTaints:\n  - effect: NoSchedule\n    key: spot\n    value: \"true\"\n  // extra tolerations that will be added to the pods \n  tolerations:\n  - key: \"spot-taint\"\n    operator: \"Exists\"\n    effect: \"NoSchedule\"\n</code></pre> <p>kueue \u4f1a\u5bf9 Workload \u7684 Yaml \uff08\u5982 <code>batch.v1/job</code>\uff09\u8fdb\u884c\u4fee\u6539\uff0c\u6dfb\u52a0<code>nodeLabels</code>/<code>nodeTaints</code>\u3002</p>"},{"location":"scheduler_system/kueue.html#cluster-queue","title":"Cluster Queue","text":"<p>A cluster-scoped resource that governs a pool of resources, defining usage limits and fair sharing rules.</p> <p>\u4e3a\u4e00\u4e2a\u6216\u591a\u4e2a ResourceFlavor \u8bbe\u7f6e\u914d\u989d\u6765\u5b9a\u4e49\u8d44\u6e90\u6c60\u3002</p> <pre><code>apiVersion: kueue.x-k8s.io/v1alpha2\nkind: ClusterQueue\nmetadata:\n  name: research-pool\nspec:\n  namespaceSelector: {}\n  resourceGroups:\n  - coveredResources: [\"cpu\", \"memory\", \"pods\"]\n    flavors:\n    # \u5bf9\u5e94ResourceFlavor\u4e2d\u7684metadata.name\uff0c\n    # \u6309\u987a\u5e8f\u5206\u914d\uff0c\u5982\u679c\u5148\u524d\u5141\u8bb8\u7684\u4f5c\u4e1a\u6d88\u8017\u4e86\u6240\u6709\u73b0\u6709\u7684 on-demand \u914d\u989d\uff0c\u4f46\u4e0d\u662f\u6240\u6709\u7684 spot \u914d\u989d\uff0c\u5219 Kueue \u4f1a\u4f7f\u7528 spot \u914d\u989d\u6765\u5141\u8bb8\u4f5c\u4e1a\n    - name: ondemand\n      # \u5b9a\u4e49\u53ef\u7528\u7684\u8d44\u6e90\u5927\u5c0f\uff0c\u5982 cpu,memory,pods,quota\n      resources:\n      - name: \"cpu\"\n        nominalQuota: 9\n      - name: \"memory\"\n        nominalQuota: 36Gi\n      - name: \"pods\"\n        nominalQuota: 5\n    - name: spot\n      resources:\n      - name: \"cpu\"\n        nominalQuota: 18\n      - name: \"memory\"\n        nominalQuota: 72Gi\n      - name: \"pods\"\n        nominalQuota: 100\n</code></pre> <p>\u8d44\u6e90\u501f\u7528\uff1a</p> <ul> <li><code>spec.cohort</code>\uff1aClusterQueue \u5c5e\u4e8e\u540c\u4e00\u4e2a cohort \u7684\u53ef\u4ee5\u4e92\u76f8\u501f\u7528\u672a\u4f7f\u7528\u7684\u8d44\u6e90\uff1b</li> <li><code>spec.resourceGroups[].resources[]</code></li> <li><code>borrowingLimit</code>\uff1a\u5b9a\u4e49\u53ef\u4ee5\u501f\u7528\u7684\u6700\u5927\u9650\u5236</li> <li><code>lendingLimit</code>\uff1a\u5b9a\u4e49\u53ef\u4ee5\u501f\u51fa\u53bb\u7684\u6700\u5927\u9650\u5236</li> </ul>"},{"location":"scheduler_system/kueue.html#local-queue","title":"Local Queue","text":"<p>A namespaced resource that groups closely related workloads belonging to a single tenant.</p> <p><code>LocalQueue</code>\u7684\u5b9a\u4e49\u5982\u4e0b\u6240\u793a\uff1a\u6307\u5411 ClusterQueue\uff0c\u7ed9\u79df\u6237\u4f7f\u7528\uff1b</p> <pre><code>apiVersion: kueue.x-k8s.io/v1beta1\nkind: LocalQueue\nmetadata:\n  namespace: team-a \n  name: team-a-queue\nspec:\n  clusterQueue: cluster-queue \n</code></pre>"},{"location":"scheduler_system/kueue.html#workload","title":"Workload","text":"<p>\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5982 <code>batch/v1.job</code></p> <ul> <li>Kueue does not directly manipulate Job objects. Instead, Kueue manages Workload objects that represent the resource requirements of an arbitrary workload</li> <li>Kueue automatically creates a Workload for each Job object and syncs the decisions and statuses.</li> </ul> <pre><code>apiVersion: kueue.x-k8s.io/v1beta1\nkind: Workload\nmetadata:\n  name: sample-job\n  namespace: team-a\nspec:\n  active: true\n  # LocalQueue name\n  queueName: team-a-queue\n  podSets:\n  - count: 3\n    name: main\n    template:\n      spec:\n        containers:\n        - image: gcr.io/k8s-staging-perf-tests/sleep:latest\n          imagePullPolicy: Always\n          name: container\n          resources:\n            requests:\n              cpu: \"1\"\n              memory: 200Mi\n        restartPolicy: Never\n</code></pre>"},{"location":"scheduler_system/rl_learning_scheduler.html","title":"Rl learning scheduler","text":""},{"location":"scheduler_system/rl_learning_scheduler.html#learning-scheduling-algorithms-for-data-processing-clusters","title":"Learning Scheduling Algorithms for Data Processing Clusters","text":"<p>\u8bba\u6587: Learning Scheduling Algorithms for Data Processing Clusters</p>"},{"location":"scheduler_system/rl_learning_scheduler.html#todo","title":"\u80cc\u666f\u548c\u52a8\u673a\uff08TODO\uff09","text":"<p>\u8c03\u5ea6\u7cfb\u7edf\u7684\u4f18\u5316\u53ef\u4ee5\u8282\u7701\u5927\u91cf\u7684\u673a\u5668\u8d44\u6e90\u3002</p> <p>\u8bbe\u8ba1\u6700\u4f73\u8c03\u5ea6\u7a0b\u5e8f NP hard</p> <ul> <li>Best algorithm depends on specific workload and system</li> <li>\u4f7f\u7528 RL agent \u5c1d\u8bd5</li> </ul>"},{"location":"scheduler_system/volcano.html","title":"Volcano","text":"<p>Volcano\uff1a\u57fa\u4e8eKubernetes\u7684\u9ad8\u6027\u80fd\u5de5\u4f5c\u8d1f\u8f7d\u8c03\u5ea6\u5f15\u64ce\u3002</p> <ul> <li>\u4f5c\u4e3a\u4e00\u4e2a\u901a\u7528\u6279\u5904\u7406\u5e73\u53f0\uff0cVolcano\u4e0e\u51e0\u4e4e\u6240\u6709\u7684\u4e3b\u6d41\u8ba1\u7b97\u6846 \u67b6\u65e0\u7f1d\u5bf9\u63a5\uff0c\u5982Spark \u3001TensorFlow \u3001PyTorch \u3001 Flink \u3001Argo \u3001MindSpore \u3001 PaddlePaddle \u7b49\uff1b</li> <li>\u63d0\u4f9b\u4e86\u5305\u62ec\u57fa\u4e8e\u5404\u79cd\u4e3b\u6d41\u67b6\u6784\u7684CPU\u3001GPU\u5728\u5185\u7684\u5f02\u6784\u8bbe\u5907\u6df7\u5408\u8c03\u5ea6\u80fd\u529b\uff1b</li> </ul> <p>Volcano\u652f\u6301\u5404\u79cd\u8c03\u5ea6\u7b56\u7565\uff0c\u5305\u62ec\uff1a</p> <ul> <li>Gang-scheduling</li> <li>Fair-share scheduling</li> <li>Queue scheduling</li> <li>Preemption scheduling</li> <li>Topology-based scheduling</li> <li>Reclaims</li> <li>Backfill</li> <li>Resource Reservation</li> </ul> <p>\u5c40\u9650\uff1a</p> <ul> <li>\u90e8\u7f72\u5f62\u5f0f\u4e3a\u5982\u679c\u591a\u8c03\u5ea6\u5668\u5f62\u5f0f\uff08\u4e0eKubernetes\u539f\u751f\u8c03\u5ea6\u5668\u5171\u5b58\uff09\uff0c\u5219\u53ef\u80fd\u51fa\u73b0\u548c\u539f\u751f\u8c03\u5ea6\u5668\u7684\u8d44\u6e90\u8c03\u5ea6\u51b2\u7a81\u95ee\u9898\uff0c\u56e0\u6b64\u66f4\u9002\u5408\u4e8e\u5728\u4e13\u6709\u96c6\u7fa4\u90e8\u7f72\uff1b</li> <li>\u5f53\u524d\u7248\u672c\u4e2d\u4e0d\u652f\u6301\u591a\u7ea7\u5c42\u6b21\u5316\u7684\u8d44\u6e90\u961f\u5217\uff0c\u4f7f\u5f97\u5728\u4f01\u4e1a\u591a\u79df\u6237\u573a\u666f\u4e0b\u4e0d\u80fd\u591f\u5f88\u597d\u7684\u8fdb\u884c\u6620\u5c04\u3002</li> </ul>"},{"location":"scheduler_system/volcano.html#_1","title":"\u67b6\u6784","text":"<p>Volcano\u7531scheduler\u3001controllermanager\u3001admission\u548cvcctl\u7ec4\u6210:</p> <ul> <li>Scheduler\uff1a Volcano scheduler\u901a\u8fc7\u4e00\u7cfb\u5217\u7684action\u548cplugin\u8c03\u5ea6Job\uff0c\u5e76\u4e3a\u5b83\u627e\u5230\u4e00\u4e2a\u6700\u9002\u5408\u7684\u8282\u70b9\u3002\u4e0eKubernetes default-scheduler\u76f8\u6bd4\uff0cVolcano\u4e0e\u4f17\u4e0d\u540c\u7684 \u5730\u65b9\u662f\u5b83\u652f\u6301\u9488\u5bf9Job\u7684\u591a\u79cd\u8c03\u5ea6\u7b97\u6cd5\u3002</li> <li>Controllermanager\uff1a Volcano controllermanager\u7ba1\u7406CRD\u8d44\u6e90\u7684\u751f\u547d\u5468\u671f\u3002\u5b83\u4e3b\u8981\u7531Queue ControllerManager\u3001 PodGroupControllerManager\u3001 VCJob ControllerManager\u6784\u6210\u3002</li> <li>Admission\uff1a Volcano admission\u8d1f\u8d23\u5bf9CRD API\u8d44\u6e90\u8fdb\u884c\u6821\u9a8c\u3002</li> <li>Vcctl\uff1a Volcano vcctl\u662fVolcano\u7684\u547d\u4ee4\u884c\u5ba2\u6237\u7aef\u5de5\u5177\u3002</li> </ul>"},{"location":"scheduler_system/volcano.html#scheduler","title":"Scheduler","text":"<p>\u8d1f\u8d23Pod\u8c03\u5ea6\u7684\u7ec4\u4ef6\uff0c\u5b83\u7531\u4e00\u7cfb\u5217action\u548cplugin\u7ec4\u6210\u3002action\u5b9a\u4e49\u4e86\u8c03\u5ea6\u5404\u73af\u8282\u4e2d\u9700\u8981\u6267\u884c\u7684\u52a8\u4f5c\uff1bplugin\u6839\u636e\u4e0d\u540c\u573a\u666f\u63d0\u4f9b\u4e86action \u4e2d\u7b97\u6cd5\u7684\u5177\u4f53\u5b9e\u73b0\u7ec6\u8282\u3002</p> <p></p> <p>\u5de5\u4f5c\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u5ba2\u6237\u7aef\u63d0\u4ea4\u7684Job\u88abscheduler\u89c2\u5bdf\u5230\u5e76\u7f13\u5b58\u8d77\u6765\u3002</li> <li>\u5468\u671f\u6027\u7684\u5f00\u542f\u4f1a\u8bdd\uff0c\u4e00\u4e2a\u8c03\u5ea6\u5468\u671f\u5f00\u59cb\u3002</li> <li>\u5c06\u6ca1\u6709\u88ab\u8c03\u5ea6\u7684Job\u53d1\u9001\u5230\u4f1a\u8bdd\u7684\u5f85\u8c03\u5ea6\u961f\u5217\u4e2d\u3002</li> <li>\u904d\u5386\u6240\u6709\u7684\u5f85\u8c03\u5ea6Job\uff0c\u6309\u7167\u5b9a\u4e49\u7684\u6b21\u5e8f\u4f9d\u6b21\u6267\u884cenqueue\u3001allocate\u3001preempt\u3001reclaim\u3001backfill\u7b49\u52a8\u4f5c\uff0c\u4e3a\u6bcf\u4e2aJob\u627e\u5230\u4e00\u4e2a\u6700\u5408\u9002\u7684\u8282\u70b9\u3002\u5c06\u8be5Job \u7ed1\u5b9a\u5230\u8fd9\u4e2a\u8282\u70b9\u3002action\u4e2d\u6267\u884c\u7684\u5177\u4f53\u7b97\u6cd5\u903b\u8f91\u53d6\u51b3\u4e8e\u6ce8\u518c\u7684plugin\u4e2d\u5404\u51fd\u6570\u7684\u5b9e\u73b0\u3002</li> <li>\u5173\u95ed\u672c\u6b21\u4f1a\u8bdd\u3002</li> </ol>"},{"location":"scheduler_system/volcano.html#_2","title":"\u6982\u5ff5","text":""},{"location":"scheduler_system/volcano.html#podgroup","title":"PodGroup","text":"<p>\u5f3a\u5173\u8054pod\u7684\u96c6\u5408\uff0c\u4e3b\u8981\u7528\u4e8e\u6279\u5904\u7406\u5de5\u4f5c\u8d1f\u8f7d\u573a\u666f\uff0c\u6bd4\u5982Tensorflow\u4e2d\u7684\u4e00\u7ec4ps\u548cworker\u3002</p> <p></p>"},{"location":"scheduler_system/volcano.html#queue","title":"Queue","text":"<p>queue\u662f\u5bb9\u7eb3\u4e00\u7ec4podgroup\u7684\u961f\u5217\uff0c\u4e5f\u662f\u8be5\u7ec4podgroup\u83b7\u53d6\u96c6\u7fa4\u8d44\u6e90\u7684\u5212\u5206\u4f9d\u636e\u3002</p> <p><code>kubectl get Queue default</code></p> <ul> <li>volcano\u542f\u52a8\u540e\uff0c\u4f1a\u9ed8\u8ba4\u521b\u5efa\u540d\u4e3adefault\u7684queue\uff0cweight\u4e3a1\u3002\u540e\u7eed\u4e0b\u53d1\u7684job\uff0c\u82e5\u672a\u6307\u5b9aqueue\uff0c\u9ed8\u8ba4\u5c5e\u4e8edefault queue</li> </ul> <pre><code>apiVersion: scheduling.volcano.sh/v1beta1\nkind: Queue\nmetadata:\n  creationTimestamp: \"2020-08-10T11:54:36Z\"\n  generation: 1\n  name: default\n  resourceVersion: \"559\"\n  selfLink: /apis/scheduling.volcano.sh/v1beta1/queues/default\n  uid: 14082e4c-bef6-4248-a414-1e06d8352bf0\nspec:\n  # \u8be5queue\u5728\u8d44\u6e90\u4f7f\u7528\u91cf\u8d85\u8fc7\u8be5queue\u6240\u5e94\u5f97\u7684\u8d44\u6e90\u4efd\u989d\u65f6\uff0c\u662f\u5426\u5141\u8bb8\u5176\u4ed6queue\u56de\u6536\u8be5queue\u4f7f\u7528\u8d85\u989d\u7684\u8d44\u6e90\n  reclaimable: true\n  weight: 1\n  # \u6240\u6709podgroup\u4f7f\u7528\u8d44\u6e90\u91cf\u4e4b\u548c\u7684\u4e0a\u9650\uff0c\u5b83\u662f\u4e00\u4e2a\u786c\u7ea6\u675f\n  capability:\n    cpu: \"4\"\n    memory: \"4096Mi\"\nstatus:\n  state: Open\n</code></pre>"},{"location":"scheduler_system/volcano.html#volcanojob","title":"VolcanoJob","text":"<p>\u7b80\u79f0vcjob\uff0c\u662fVolcano\u81ea\u5b9a\u4e49\u7684Job\u8d44\u6e90\u7c7b\u578b\u3002</p> <p>\u53ef\u6307\u5b9a\u8c03\u5ea6\u5668\u3001\u652f\u6301\u6700\u5c0f\u8fd0\u884cpod\u6570\u3001 \u652f\u6301task\u3001\u652f\u6301\u751f\u547d\u5468\u671f\u7ba1\u7406\u3001\u652f\u6301\u6307\u5b9a\u961f\u5217\u3001\u652f\u6301\u4f18\u5148\u7ea7\u8c03\u5ea6\u7b49</p> <pre><code>apiVersion: batch.volcano.sh/v1alpha1\nkind: Job\nmetadata:\n  name: test-job\nspec:\n  minAvailable: 3\n  schedulerName: volcano\n  priorityClassName: high-priority\n  policies:\n    - event: PodEvicted\n      action: RestartJob\n  plugins:\n    ssh: []\n    env: []\n    svc: []\n  maxRetry: 5\n  queue: default\n  volumes:\n    - mountPath: \"/myinput\"\n    - mountPath: \"/myoutput\"\n      volumeClaimName: \"testvolumeclaimname\"\n      volumeClaim:\n        accessModes: [ \"ReadWriteOnce\" ]\n        storageClassName: \"my-storage-class\"\n        resources:\n          requests:\n            storage: 1Gi\n  tasks:\n    - replicas: 6\n      name: \"default-nginx\"\n      template:\n        metadata:\n          name: web\n        spec:\n          containers:\n            - image: nginx\n              imagePullPolicy: IfNotPresent\n              name: nginx\n              resources:\n                requests:\n                  cpu: \"1\"\n          restartPolicy: OnFailure\n</code></pre>"},{"location":"scheduler_system/volcano.html#_3","title":"\u5b89\u88c5","text":"<pre><code> $ kubectl create namespace volcano-system\n</code></pre>"},{"location":"scheduler_system/yarn/arch.html","title":"Yarn","text":"<p>Apache Hadoop YARN: Yet Another Resource Negotiator</p> <p>\u670d\u52a1\u5316\uff08Service\uff09+ \u4e8b\u4ef6\u9a71\u52a8\uff08Event/Dispatcher\uff09\uff0c\u6a21\u5757\u95f4\u901a\u8fc7\u4e8b\u4ef6\u8054\u7cfb\uff0c\u5f02\u6b65\u3001\u5e76\u53d1\uff0c\u66f4\u9002\u5408\u5927\u578b\u5206\u5e03\u5f0f\u7cfb\u7edf\u3002</p>"},{"location":"scheduler_system/yarn/arch.html#_1","title":"\u67b6\u6784","text":""},{"location":"scheduler_system/yarn/arch.html#_2","title":"\u7ec4\u4ef6","text":""},{"location":"scheduler_system/yarn/arch.html#resource-manager","title":"Resource Manager","text":"<ul> <li>\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42</li> <li>\u542f\u52a8/\u76d1\u63a7ApplicationMaster</li> <li>\u76d1\u63a7NodeManager</li> <li>\u8d44\u6e90\u5206\u914d\u4e0e\u8c03\u5ea6</li> </ul>"},{"location":"scheduler_system/yarn/arch.html#node-manager","title":"Node Manager","text":"<ul> <li>\u5355\u4e2a\u8282\u70b9\u4e0a\u7684\u8d44\u6e90\u7ba1\u7406</li> <li>\u5904\u7406\u6765\u81eaResourceManger\u7684\u547d\u4ee4</li> <li>\u5904\u7406\u6765\u81eaApplicationMaster\u7684\u547d\u4ee4</li> </ul>"},{"location":"scheduler_system/yarn/arch.html#yarn-shuffle-service","title":"Yarn Shuffle Service","text":"<p>Yarn Shuffle Service\u4f5c\u4e3a\u7ebf\u7a0b\u8fd0\u884c\u5728<code>NodeManager</code>\u8fdb\u7a0b\u4e2d\u3002</p>"},{"location":"scheduler_system/yarn/arch.html#application-master","title":"Application Master","text":"<ul> <li>\u4e3a\u5e94\u7528\u7a0b\u5e8f\u7533\u8bf7\u8d44\u6e90\uff0c\u5e76\u5206\u914d\u7ed9\u5185\u90e8\u4efb\u52a1</li> <li>\u4efb\u52a1\u8c03\u5ea6\u3001\u76d1\u63a7\u4e0e\u5bb9\u9519</li> </ul>"},{"location":"scheduler_system/yarn/arch.html#_3","title":"\u901a\u4fe1","text":""},{"location":"scheduler_system/yarn/arch.html#yarn_1","title":"Yarn\u95f4\u901a\u4fe1","text":"<p>AM\uff0cRM\uff0cNM\uff0cAdmin\u56db\u4e2a\u670d\u52a1</p> <ul> <li>ApplicationClientProtocol\uff08Client -&gt; RM\uff09 clients \u4e0e RM \u4e4b\u95f4\u7684\u534f\u8bae\uff0c\u5982MR JobClient \u901a\u8fc7\u8be5 RPC \u534f\u8bae\u63d0\u4ea4\u5e94\u7528\u7a0b\u5e8f\u3001 \u67e5\u8be2\u5e94\u7528\u7a0b\u5e8f\u72b6\u6001\u7b49\uff1b</li> <li> <p>ResourceTracker\uff08NM -&gt; RM\uff09NM \u4e0e RM \u4e4b\u95f4\u7684\u534f\u8bae\uff0c NM \u901a\u8fc7\u8be5 RPC \u534f\u8bae\u5411 RM \u6ce8\u518c\uff0c \u5e76\u5b9a\u65f6\u53d1\u9001\u5fc3\u8df3\u4fe1\u606f\u6c47\u62a5\u5f53\u524d\u8282\u70b9\u7684\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u548c   Container\u8fd0\u884c\u60c5\u51b5\u3002</p> </li> <li> <p>ApplicationMasterProtocol\uff08AM -&gt; RM\uff09AM \u4e0e RM \u4e4b\u95f4\u7684\u534f\u8bae\uff0c AM \u901a\u8fc7\u8be5 RPC \u534f\u8bae\u5411 RM \u6ce8\u518c\u548c\u64a4\u9500\u81ea\u5df1\uff0c \u5e76\u4e3a\u5404\u4e2a\u4efb\u52a1\u7533\u8bf7\u8d44\u6e90\u3002</p> </li> <li>ContainerManagementProtocol\uff08AM -&gt; NM\uff09AM \u4e0e NM \u4e4b\u95f4\u7684\u534f\u8bae\uff0c AM \u901a\u8fc7\u8be5 RPC \u8981\u6c42 NM \u542f\u52a8\u6216\u8005\u505c\u6b62 Container\uff0c \u83b7\u53d6\u5404\u4e2a   Container \u7684\u4f7f\u7528\u72b6\u6001\u7b49\u4fe1\u606f\u3002</li> <li>ResourceManagerAdministrationProtocol\uff08RM Admin -&gt; RM\uff09Admin \u4e0e RM \u4e4b\u95f4\u7684\u901a\u4fe1\u534f\u8bae\uff0c Admin \u901a\u8fc7\u8be5 RPC \u534f\u8bae\u66f4\u65b0\u7cfb\u7edf\u914d\u7f6e\u6587\u4ef6\uff0c   \u4f8b\u5982\u8282\u70b9\u9ed1\u767d\u540d\u5355\u7b49\u3002</li> <li>HAServiceProtocol\uff08Active RM HA Framework Standby RM\uff09Active RM \u548c Standby RM \u4e4b\u95f4\u7684\u901a\u4fe1\u534f\u8bae\uff0c\u63d0\u4f9b\u72b6\u6001\u76d1\u63a7\u548c fail over \u7684 HA \u670d   \u52a1\uff1b</li> </ul>"},{"location":"scheduler_system/yarn/arch.html#mapreduce","title":"MapReduce\u95f4\u901a\u4fe1","text":"<ul> <li>TaskUmbilicalProtocol\uff08YarnChild -&gt; MRAppMaster\uff09YarnChild \u548c MRAppMaster \u4e4b\u95f4\u7684\u901a\u4fe1\u534f\u8bae\uff0c\u7528\u4e8e MRAppMaster \u76d1\u63a7\u8ddf\u8e2a   YarnChild \u7684\u8fd0\u884c\u72b6\u6001\uff0cYarnChild \u5411 MRAppMaster \u62c9\u53d6 Task \u4efb\u52a1\u4fe1\u606f\u3002</li> <li>MRClientProtocol\uff08JobClient -&gt; ApplicationMaster\uff09JobClient \u548c ApplicationMaster \u4e4b\u95f4\u7684\u901a\u4fe1\u534f\u8bae\u3002\u7528\u4e8e\u5ba2\u6237\u7aef\u62c9\u53d6 Application \u7684\u6267\u884c\u72b6   \u6001\uff0c\u4ee5\u53ca Application \u8fd4\u56de\u6267\u884c\u7ed3\u679c\u7ed9 \u5ba2\u6237\u7aef\u3002</li> </ul>"},{"location":"scheduler_system/yarn/arch.html#_4","title":"\u4e8b\u4ef6","text":"<p>YARN \u5c06\u5404\u79cd\u5904\u7406\u903b\u8f91\u62bd\u8c61\u6210\u4e8b\u4ef6\u548c\u5bf9\u5e94\u4e8b\u4ef6\u8c03\u5ea6\u5668\uff0c\u5e76\u5c06\u6bcf\u7c7b\u4e8b\u4ef6\u7684\u5904\u7406\u8fc7\u7a0b\u5206\u5272\u6210\u591a\u4e2a\u6b65\u9aa4\uff0c\u7528\u6709\u9650\u72b6\u6001\u673a\u8868\u793a\u3002AsycDispatcher \u662f YARN \u7684\u4e2d\u592e\u5f02\u6b65\u8c03\u5ea6\u5668\u3002\u5728 ResourceManager\u4e2d\uff0c\u51e0\u4e4e\u6240\u6709\u7684\u4e8b\u4ef6\u90fd\u901a\u8fc7 AsyncDispatcher \u8fdb\u884c\u4e8b\u4ef6\u7684\u6d3e\u53d1\u3002</p> <p></p>"},{"location":"scheduler_system/yarn/arch.html#_5","title":"\u72b6\u6001\u673a","text":"<p>\u5728 YARN \u4e2d\uff0c\u6bcf\u79cd\u72b6\u6001\u8f6c\u6362\uff08doTransition \u65b9\u6cd5\u53bb\u6267\u884c\u72b6\u6001\u8f6c\u6362\uff0caddTransition \u6ce8\u518c\u72b6\u6001\u8f6c\u6362\uff09\u7531\u4e00\u4e2a\u56db\u5143\u7ec4\u8868\u793a\uff0c\u5206\u522b\u662f\u8f6c\u6362\u524d\u72b6\u6001\uff08preState\uff09\u3001 \u8f6c\u6362\u540e\u72b6\u6001\uff08postState\uff09\u3001\u4e8b\u4ef6\uff08event\uff09\u548c\u56de\u8c03\u51fd\u6570/\u8f6c\u6362\u5668\uff08hook = Transition\uff09\u3002</p> <p>YARN \u5b9a\u4e49\u4e86\u4e09\u79cd\u72b6\u6001\u8f6c\u6362\u65b9\u5f0f\uff0c\u5177\u4f53\u5982\u4e0b\uff1a</p> <ul> <li>\u4e00\u4e2a\u521d\u59cb\u72b6\u6001\u3001\u4e00\u4e2a\u6700\u7ec8\u72b6\u6001\u3001\u4e00\u79cd\u4e8b\u4ef6\uff1a\u7ecf\u8fc7\u5904\u7406\u4e4b\u540e\uff0c\u65e0\u8bba\u5982\u4f55\uff0c\u8fdb\u5165\u5230\u4e00\u4e2a\u552f\u4e00\u72b6\u6001\uff1b</li> <li>\u4e00\u4e2a\u521d\u59cb\u72b6\u6001\u3001\u591a\u4e2a\u6700\u7ec8\u72b6\u6001\u3001\u4e00\u79cd\u4e8b\u4ef6\uff1a\u4e0d\u540c\u7684\u903b\u8f91\u5904\u7406\u7ed3\u679c\uff0c\u53ef\u80fd\u5bfc\u81f4\u8fdb\u5165\u4e0d\u540c\u7684\u72b6\u6001\uff1b</li> <li>\u4e00\u4e2a\u521d\u59cb\u72b6\u6001\u3001\u4e00\u4e2a\u6700\u7ec8\u72b6\u6001\u3001\u591a\u79cd\u4e8b\u4ef6\uff1a\u591a\u4e2a\u4e0d\u7528\u7684\u4e8b\u4ef6\uff0c\u53ef\u80fd\u89e6\u53d1\u5230\u591a\u4e2a\u4e0d\u540c\u72b6\u6001\u7684\u8f6c\u6362\uff1b</li> </ul> <p>\u4e3a\u4e86\u4fbf\u4e8e\u7528\u6237\u67e5\u770b\u8fd9\u4e9b\u72b6\u6001\u673a\u7684\u72b6\u6001\u53d8\u5316\u4ee5\u53ca\u76f8\u5173\u4e8b\u4ef6\uff0cYARN \u63d0\u4f9b\u4e86\u4e00\u4e2a\u72b6\u6001\u673a\u53ef\u89c6\u5316\u5de5\u5177\uff0c\u5177\u4f53\u64cd\u4f5c\u6b65\u9aa4\u5982\u4e0b\u3002</p> <ol> <li>\u5c06\u72b6\u6001\u673a\u8f6c\u5316\u4e3a graphviz(.gv) \u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u5728\u6e90\u4ee3\u7801\u6839\u76ee\u5f55\u4e0b\u6267\u884c\u7f16\u8bd1\u547d\u4ee4\u5982\u4e0b\uff1a</li> </ol> <p><code>mvn compile -Pvisualize</code></p> <ol> <li>\u4f7f\u7528\u53ef\u89c6\u5316\u5305 graphviz \u4e2d\u7684\u76f8\u5173\u547d\u4ee4\u751f\u6210\u72b6\u6001\u673a\u56fe\uff0cShell \u547d\u4ee4\u5177\u4f53\u5982\u4e0b\uff1a</li> </ol> <pre><code># \u9700\u8981\u5148\u5b89\u88c5graphviz\n# yum install graphviz\ndot -Tpng ResourceManager.gv &gt; ResourceManager.png\ndot -Tpng NodeManager.gv &gt; NodeManager.png\ndot -Tpng MapReduce.gv &gt; MapReduce.png\n</code></pre>"},{"location":"scheduler_system/yarn/cgroup.html","title":"CGroup","text":""},{"location":"scheduler_system/yarn/cgroup.html#container","title":"\u5bb9\u5668\uff08Container\uff09","text":"<p>yarn container \u9ed8\u8ba4\u4e0d\u652f\u6301\u5bf9cpu\u8fdb\u884c\u8d44\u6e90\u9694\u79bb\uff0c\u4f8b\u5982\u7533\u8bf7\u76841\u4e2avcore\uff0c\u5b9e\u9645\u4e0a\u53c8\u542f\u52a8\u4e86\u591a\u7ebf\u7a0b\uff0c\u8fd8\u6709GC\u7ebf\u7a0b\u7b49\u90fd\u4f1a\u9020\u6210\u8d44\u6e90\u4f7f\u7528\u4e0d\u53ef\u63a7\u3002</p> <p>\u5185\u5b58\u9650\u5236\uff0c\u901a\u8fc7 Java \u542f\u52a8\u6307\u5b9a-Xmx\uff0c\u4e5f\u4e0d\u662fContainer\u771f\u5b9e\u7684\u5185\u5b58\u9650\u5236\u3002</p>"},{"location":"scheduler_system/yarn/cgroup.html#_1","title":"\u7c7b\u578b","text":""},{"location":"scheduler_system/yarn/cgroup.html#defaultcontainerexecutor","title":"DefaultContainerExecutor","text":"<ul> <li>\u9ed8\u8ba4\u7684executor\uff0c\u7ba1\u7406\u5bb9\u5668\u7684\u6267\u884c\uff1b</li> <li>\u5bb9\u5668\u8fdb\u7a0b\u7684\u7528\u6237\u662fNodeManager\u7684Unix User\uff1b</li> <li>\u5b89\u5168\u6027\u4f4e\u4e14\u6ca1\u6709\u4efb\u4f55CPU\u8d44\u6e90\u9694\u79bb\u673a\u5236\u3002</li> </ul>"},{"location":"scheduler_system/yarn/cgroup.html#linuxcontainerexecutor","title":"LinuxContainerExecutor","text":"<p>\u5bb9\u5668\u8fdb\u7a0b\u7684\u7528\u6237\uff1a</p> <ul> <li>\u5f00\u542f full security \u65f6\uff0c\u662f\u63d0\u4ea4\u5e94\u7528\u7684 Yarn User\uff08\u56e0\u6b64\u9700\u8981\u5728\u5bf9\u5e94\u7684NodeManager\u4e2d\uff0c\u8be5\u7528\u6237\u5b58\u5728\uff0c\u591a\u79df\u6237\u4e0b\u53ef\u80fd\u4f1a\u6709\u95ee\u9898\uff09\uff1b</li> <li>\u672a\u5f00\u542f full security\u65f6\uff0c\u9ed8\u8ba4\u4e3a nobody\u7528\u6237\uff0c\u901a\u8fc7\u914d\u7f6e\u53ef\u4ee5\u4fee\u6539\uff1a</li> <li><code>yarn.nodemanager.linux-container-executor.nonsecure-mode.limit-users</code>\uff1a\u662f\u5426\u5728\u975e\u5b89\u5168\u6a21\u5f0f\u4e0b\uff0c\u9650\u5236\u8fd0\u884c\u7528\u6237\u4e3a\u5355\u4e2a\u7528\u6237\uff1b</li> <li><code>yarn.nodemanager.linux-container-executor.nonsecure-mode.local-user</code>\uff1a\u975e\u5b89\u5168\u6a21\u5f0f\u4e0b\u7684\u8fd0\u884c\u7528\u6237\uff1b</li> </ul> yarn.nodemanager.linux-container-executor.nonsecure-mode.local-user yarn.nodemanager.linux-container-executor.nonsecure-mode.limit-users User running jobs (default\uff1anobody) (default\uff1atrue) nobody yarn (default\uff1atrue) yarn yarn false (User submitting the job)"},{"location":"scheduler_system/yarn/cgroup.html#cgroup_1","title":"Cgroup \u914d\u7f6e","text":"<p>\u524d\u63d0\uff1acgroup\u5df2\u7ecf\u5b89\u88c5\u597d\uff0c\u5728 <code>/sys/fs/cgroup</code> \u76ee\u5f55\u4e0b\u3002</p> <p>yarn-site.xml \uff08cgroup\u4e13\u5c5e\u914d\u7f6e\uff09</p> <pre><code>&lt;property&gt; &lt;!-- \u4f7f\u7528cgroup \u5fc5\u987b\u662f LinuxContainerExecutor --&gt;\n  &lt;name&gt;yarn.nodemanager.container-executor.class&lt;/name&gt;\n  &lt;value&gt;org.apache.hadoop.yarn.server.nodemanager.LinuxContainerExecutor&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt; &lt;!-- \u542f\u52a8cgroup \u8d44\u6e90\u9694\u79bb --&gt;\n  &lt;name&gt;yarn.nodemanager.linux-container-executor.resources-handler.class&lt;/name&gt;\n  &lt;value&gt;org.apache.hadoop.yarn.server.nodemanager.util.CgroupsLCEResourcesHandler&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt; &lt;!-- yarn\u4f7f\u7528\u7684cgroup\u7ec4,\u9ed8\u8ba4\u4e3a/hadoop-yarn --&gt;\n    &lt;name&gt;yarn.nodemanager.linux-container-executor.cgroups.hierarchy&lt;/name&gt;\n    &lt;value&gt;/hadoop-yarn&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt; &lt;!-- \u662f\u5426\u81ea\u52a8\u6302\u8f7dcgroup, centos 7\u65e0\u9700 --&gt;\n    &lt;name&gt;yarn.nodemanager.linux-container-executor.cgroups.mount&lt;/name&gt;\n    &lt;value&gt;false&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt; &lt;!-- cgroup\u6302\u8f7d\u76ee\u5f55, centos 7\u4e4b\u540e\u65e0\u9700\uff0c\u81ea\u52a8\u53d1\u73b0 --&gt;\n    &lt;name&gt;yarn.nodemanager.linux-container-executor.cgroups.mount-path&lt;/name&gt;\n    &lt;value&gt;/sys/fs/cgroup&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt; &lt;!-- NodeManager\u7684Unix\u7528\u6237\u7ec4\uff0c\u9700\u8981\u548ccontainer-executor.cfg\u4e2d\u914d\u7f6e\u4e00\u6837 --&gt;\n    &lt;name&gt;yarn.nodemanager.linux-container-executor.group&lt;/name&gt;\n    &lt;value&gt;hadoop&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;property&gt; &lt;!-- NodeManager \u53ef\u4ee5\u4f7f\u7528\u7684cpu\u5229\u7528\u7387\u7684\u4e0a\u9650\uff0c\u9ed8\u8ba4100%  --&gt;\n    &lt;name&gt;yarn.nodemanager.resource.percentage-physical-cpu-limit&lt;/name&gt;\n    &lt;value&gt;100&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt; &lt;!-- container\u662f\u5426\u4e25\u683c\u9650\u5236cpu\u4efd\u989d\uff08\u5373\u4f7f\u6709\u7a7a\u95f2\u7684cpu\uff09\uff0c\u9ed8\u8ba4false  --&gt;\n    &lt;name&gt;yarn.nodemanager.linux-container-executor.cgroups.strict-resource-usage&lt;/name&gt;\n    &lt;value&gt;false&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"scheduler_system/yarn/cgroup.html#cgroup_2","title":"Cgroup\u548c\u5b89\u5168","text":"<p>\u9ed8\u8ba4\u975e\u5b89\u5168\u6a21\u5f0f\uff0cLCE \u4ee5\u7528\u6237 \u201dnobody\u201c \u542f\u52a8\uff0c\u53ef\u4ee5\u914d\u7f6e\u4e3a\u7edf\u4e00\u7684\u9ed8\u8ba4\u7528\u6237<code>local-user</code>\u6216\u8005\u63d0\u4ea4\u5e94\u7528\u7684\u7528\u6237\u3002</p> yarn.nodemanager.linux-container-executor.nonsecure-mode.local-user yarn.nodemanager.linux-container-executor.nonsecure-mode.limit-users User running jobs (default\uff1anobody) (default\uff1atrue) nobody yarn (default\uff1atrue) yarn yarn false (User submitting the job)"},{"location":"scheduler_system/yarn/cgroup.html#yarn-secure-container","title":"Yarn Secure Container","text":"<p>Secure Containers work only in the context of secured YARN clusters</p> <p>secured YARN cluster \u662f\u4ec0\u4e48\uff1f\u8fd9\u53e5\u8bdd\u600e\u4e48\u7406\u89e3\uff1f</p> <p>Container \u5fc5\u987b\u4ee5\u63d0\u4ea4\u5e94\u7528\u7684\u7528\u6237\u6267\u884c\u3002</p> <p>\u7528\u6237\u548c\u7528\u6237\u7ec4\u914d\u7f6e\u793a\u4f8b\uff1aNodeManager\u4ee5 yarn \u7528\u6237\u542f\u52a8\uff0cyarn\u6240\u5c5e\u7ec4\u4e3a users \u548c hadoop\uff0cusers\u7ec4\u5305\u542byarn\u548c\u5176\u5b83\u7528\u6237\uff08\u5e94\u7528\u63d0\u4ea4\u8005\uff0c\u5982alice\uff09\uff0c\u4e14 alice \u4e0d\u5c5e\u4e8e hadoop \u7ec4\u3002</p>"},{"location":"scheduler_system/yarn/cgroup.html#_2","title":"\u524d\u63d0","text":"<p>Container executor \u5fc5\u987b\u80fd\u591f\u8bbf\u95eecontainer\u9700\u8981\u7684\u672c\u5730\u6587\u4ef6\u548c\u76ee\u5f55\uff08\u6bd4\u5982\u914d\u7f6e\u6587\u4ef6\uff0cjars\uff0c\u5171\u4eab\u5bf9\u8c61\u7b49\uff09\uff0c\u5e94\u8be5\u8bbe\u7f6e\u4e3a 755\u3002</p> <p><code>yarn.nodemanager.local-dirs</code>\u548c<code>yarn.nodemanager.log-dirs</code>\u5fc5\u987b\u662fNodeManger user\uff08yarn\uff09\u548c group\uff08hadoop\uff09 \u6240\u62e5\u6709\u3002</p> <ul> <li>NodeManager\u5982\u679c\u4e0d\u662f\u4ee5root\u7528\u6237\u542f\u52a8\uff0c\u9700\u8981\u914d\u7f6e/sys/fs/cgroup\u4e2d\u7684\u6743\u9650\u5fc5\u987b\u8be5\u7528\u6237\u53ef\u8bfb\u5199\uff1b</li> </ul>"},{"location":"scheduler_system/yarn/cgroup.html#linuxcontainerexecutor_1","title":"LinuxContainerExecutor","text":"<p><code>LinuxContainerExecutor</code> \u4f7f\u7528\u5916\u90e8\u7a0b\u5e8f <code>container-executor</code>\u542f\u52a8container\uff0c\u53ef\u4ee5\u6267\u884c<code>setuid</code>\u8bbf\u95ee\u6743\u9650\u3002</p>"},{"location":"scheduler_system/yarn/cgroup.html#_3","title":"\u914d\u7f6e","text":"<pre><code>&lt;property&gt;\n    &lt;name&gt;yarn.nodemanager.linux-container-executor.path&lt;/name&gt;\n    &lt;value&gt;&lt;/value&gt;\n    &lt;description&gt;container-executor\u7684\u8def\u5f84\uff0c\u9ed8\u8ba4\u5728$HADOOP_HOME/bin/container-executor&lt;/description&gt;\n&lt;/property&gt;\n</code></pre> <p>\u53ef\u6267\u884c\u6587\u4ef6<code>bin/container-executor</code>\u5fc5\u987b\u4e3aroot\u7528\u6237\u6240\u6709\uff0c\u6240\u5c5e\u7ec4\u5fc5\u987b\u4e3aNodeManager user\u7684\u7528\u6237\u7ec4\uff08hadoop\uff0c\u4e14\u4e0d\u662f\u5e94\u7528\u7528\u6237\u6240\u5c5e\u7684\u7ec4\uff09\uff0c\u4e14\u6743\u9650\u4e3a 6050\u3002</p> <p>container-executor.cfg \u5fc5\u987b\u8981\u4e3a<code>root</code>\u6240\u6709\uff0c\u7528\u6237\u7ec4\u4efb\u610f\uff0c\u4e14\u6743\u9650\u8bbe\u7f6e\u4e3a0400\u3002</p> <pre><code># configured value of yarn.nodemanager.linux-container-executor.group\nyarn.nodemanager.linux-container-executor.group=hadoop\nbanned.users=root\n# Prevent other super-users\nmin.user.id=1000\n# comma separated list of allowed system users\nallowed.system.users=yarn\n# Terminal feature (feature.terminal.enabled) allows restricted shell into secure container via YARN UI2.\nfeature.terminal.enabled=1\n</code></pre> <p>\u7cfb\u7edf\u8fd8\u8981\u6c42<code>etc/hadoop/container-executor.cfg</code> \u7684\u6240\u6709\u7236\u76ee\u5f55(\u4e00\u76f4\u5230<code>/</code> \u76ee\u5f55) owner \u90fd\u4e3a root\u3002</p> <pre><code># \u91cd\u65b0\u7f16\u8bd1\u653e\u7f6econtainer-executor.cfg \u6587\u4ef6\u76ee\u5f55\nmvn clean package -Dcontainer-executor.conf.dir=/etc/hadoop/ -DskipTests -Pnative\n</code></pre> <p>\u901a\u8fc7 <code>bin/container-executor --checksetup</code>\uff0c\u5982\u679c\u6ca1\u6709\u8f93\u51fa\uff0c\u8868\u793a\u914d\u7f6e\u6210\u529f\u3002</p>"},{"location":"scheduler_system/yarn/conf.html","title":"\u914d\u7f6e","text":""},{"location":"scheduler_system/yarn/conf.html#_2","title":"\u57fa\u672c\u914d\u7f6e","text":""},{"location":"scheduler_system/yarn/conf.html#gpu","title":"GPU\u57fa\u672c\u914d\u7f6e","text":"<p>\u89c1 GPU</p>"},{"location":"scheduler_system/yarn/conf.html#yarn","title":"yarn","text":""},{"location":"scheduler_system/yarn/conf.html#yarnschedulercapacityresource-calculator","title":"yarn.scheduler.capacity.resource-calculator","text":"<p><code>org.apache.hadoop.yarn.util.resource.DefaultResourceCalculator</code>\uff1a\u9ed8\u8ba4</p> <p><code>org.apache.hadoop.yarn.util.resource.DominantResourceCalculator</code>\uff1a\u4e00\u822c\u9700\u8981\u6539\u6210\u8fd9\u4e2a\uff0cweb ui\u663e\u793a\u7684\u548c\u5b9e\u9645\u7533\u8bf7\u7684\u4f1a\u4e00\u81f4\u3002</p>"},{"location":"scheduler_system/yarn/conf.html#_3","title":"\u65e5\u5fd7\u805a\u5408","text":"<p><code>yarn-site.xml</code></p> <ul> <li>\u8fdc\u7a0b\u7684\u65e5\u5fd7\u8def\u5f84\u662f <code>{yarn.nodemanager.remote-app-log-dir}/${user}/{yarn.nodemanager.remote-app-log-dir-suffix}</code></li> </ul> <pre><code>&lt;property&gt;\n    &lt;!-- \u4e0b\u9762\u8def\u5f84\u662f\u9ed8\u8ba4\u503c\uff0c\u4e0d\u9700\u8981\u914d\u7f6e--&gt;\n    &lt;name&gt;yarn.log.server.url&lt;/name&gt;\n    &lt;value&gt;http://node01:19888/jobhistory/logs&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;property&gt;\n    &lt;!-- \u9ed8\u8ba4\u4e0d\u5f00\u542f --&gt;\n    &lt;name&gt;yarn.log-aggregation-enable&lt;/name&gt;  \n    &lt;value&gt;true&lt;/value&gt;  \n&lt;/property&gt;  \n&lt;property&gt;  \n    &lt;!-- \u8bbe\u7f6e\u65e5\u5fd7\u4fdd\u7559\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u79d2\uff0c\u9ed8\u8ba4 -1\uff0c\u4e0d\u4f1a\u5220\u9664\u805a\u5408\u540e\u7684\u65e5\u5fd7 --&gt;\n    &lt;name&gt;yarn.log-aggregation.retain-seconds&lt;/name&gt;  \n    &lt;value&gt;640800&lt;/value&gt;  \n&lt;/property&gt;\n&lt;property&gt;  \n    &lt;!-- \u5220\u9664\u4efb\u52a1\u5728HDFS\u4e0a\u6267\u884c\u7684\u95f4\u9694\uff0c\u6267\u884c\u65f6\u5019\u5c06\u6ee1\u8db3\u6761\u4ef6\u7684\u65e5\u5fd7\u5220\u9664\uff08\u8d85\u8fc7\u53c2\u6570\u201cyarn.log-aggregation.retain-seconds\u201d\u8bbe\u7f6e\u7684\u65f6\u95f4\u7684\u65e5\u5fd7\uff09\uff0c\u9ed8\u8ba4 -1\uff0c\u4e0d\u68c0\u67e5 --&gt;\n    &lt;name&gt;yarn.log-aggregation.retain-check-interval-seconds&lt;/name&gt;  \n    &lt;value&gt;640800&lt;/value&gt;  \n&lt;/property&gt;\n&lt;property&gt;  \n    &lt;!-- \u5f53\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u675f\u540e\uff0c\u65e5\u5fd7\u88ab\u8f6c\u79fb\u5230\u7684HDFS\u76ee\u5f55\uff08\u542f\u7528\u65e5\u5fd7\u805a\u96c6\u529f\u80fd\u65f6\u6709\u6548\uff09\uff0c\u4fee\u6539\u4e3a\u4fdd\u5b58\u7684\u65e5\u5fd7\u6587\u4ef6\u5939\u3002\u9ed8\u8ba4\u662f /tmp/logs --&gt;\n    &lt;name&gt;yarn.nodemanager.remote-app-log-dir&lt;/name&gt;  \n    &lt;value&gt;/hdfs/path/to/logs&lt;/value&gt;  \n&lt;/property&gt;\n&lt;property&gt;\n    &lt;!-- \u4e3a\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u65e5\u5fd7\u76ee\u5f55\u6dfb\u52a0\u4e00\u4e2a\u540e\u7f00\u3002\u53ef\u4ee5\u66f4\u597d\u5730\u7ec4\u7ec7\u548c\u7ba1\u7406\u65e5\u5fd7 --&gt;\n    &lt;!-- logs \u65e5\u5fd7\u5c06\u88ab\u8f6c\u79fb\u5230\u76ee\u5f55`{yarn.nodemanager.remote\u2212app\u2212log\u2212dir}/{user}/${thisParam}`\u4e0b--&gt;\n    &lt;name&gt;yarn.nodemanager.remote-app-log-dir-suffix&lt;/name&gt;  \n    &lt;value&gt;logs-${user.name}&lt;/value&gt;  \n&lt;/property&gt;\n&lt;property&gt;\n    &lt;!-- aggregated log files per application per NM --&gt;\n    &lt;name&gt;yarn.nodemanager.log-aggregation.num-log-files-per-app&lt;/name&gt;\n    &lt;value&gt;30&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;property&gt;\n    &lt;!-- \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u65e5\u5fd7\u5c06\u5728\u5e94\u7528\u7a0b\u5e8f\u5b8c\u6210\u65f6\u4e0a\u4f20\u3002\u901a\u8fc7\u8bbe\u7f6e\u6b64\u914d\u7f6e\uff0c\u53ef\u4ee5\u5728\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u65f6\u5b9a\u671f\u4e0a\u4f20\u65e5\u5fd7\u3002\u9ed8\u8ba4 -1 --&gt;\n    &lt;name&gt;yarn.nodemanager.log-aggregation.roll-monitoring-interval-seconds&lt;/name&gt;\n    &lt;value&gt;3600&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"scheduler_system/yarn/gpu.html","title":"Yarn GPU","text":"<p>https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/UsingGpus.html</p>"},{"location":"scheduler_system/yarn/gpu.html#_1","title":"\u524d\u63d0","text":"<ul> <li>\u53ea\u652f\u6301Nvidia\u7684GPUs\u8c03\u5ea6\uff08\u53ef\u4ee5\u81ea\u5b9a\u4e49\u63d2\u4ef6\u652f\u6301Rocm GPU\uff09\uff1b</li> <li>YARN NodeManager \u6240\u5728\u673a\u5668\u5fc5\u987b\u9884\u5148\u5b89\u88c5\u4e86 Nvidia Driver\uff1b</li> <li>\u5982\u679c\u4f7f\u7528 Docker \u4f5c\u4e3a\u5bb9\u5668\u7684\u8fd0\u884c\u65f6\u4e0a\u4e0b\u6587\uff0c\u9700\u8981\u5b89\u88c5 nvidia-docker 1.0\u3002</li> </ul> <p>\u6ce8\uff1aGPU\u8d44\u6e90\u7684\u9694\u79bb\uff0c\u9700\u8981\u4f7f\u7528 LinuxContainerExecutor (YARN-9419)\uff0c</p> <p>\u672c\u8282\u53ea\u5173\u6ce8 \u975e docker \u7684\u914d\u7f6e\u3002</p>"},{"location":"scheduler_system/yarn/gpu.html#_2","title":"\u914d\u7f6e","text":"<p>\u4ee5 hadoop \u7528\u6237\u542f\u52a8</p>"},{"location":"scheduler_system/yarn/gpu.html#capacity-schedulerxml","title":"capacity-scheduler.xml","text":"<pre><code>&lt;!-- For Capacity Scheduler capacity-scheduler.xml --&gt;\n&lt;property&gt;\n  &lt;name&gt;yarn.scheduler.capacity.resource-calculator&lt;/name&gt; &lt;value&gt;org.apache.hadoop.yarn.util.resource.DominantResourceCalculator&lt;/value&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"scheduler_system/yarn/gpu.html#resource-typesxml","title":"resource-types.xml","text":"<pre><code>&lt;configuration&gt;\n  &lt;property&gt;\n     &lt;name&gt;yarn.resource-types&lt;/name&gt;\n     &lt;value&gt;yarn.io/gpu&lt;/value&gt;\n  &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> <p><code>yarn-site.xml</code>\u4e2d\u5fc5\u987b\u914d\u7f6e <code>yarn.scheduler.capacity.resource-calculator</code>\u4e3a<code>org.apache.hadoop.yarn.util.resource.DominantResourceCalculator</code>\u3002</p>"},{"location":"scheduler_system/yarn/gpu.html#yarn-sitexml","title":"yarn-site.xml","text":"<p>\u5728NodeManager\u7aef\u542f\u7528GPU\u9694\u79bb\u6a21\u5757\uff0c\u914d\u7f6e CGroup\u3002</p> <pre><code>&lt;property&gt;\n    &lt;name&gt;yarn.nodemanager.resource-plugins&lt;/name&gt;\n    &lt;value&gt;yarn.io/gpu&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- cgroup \u914d\u7f6e --&gt;\n&lt;property&gt;\n    &lt;name&gt;yarn.nodemanager.container-executor.class&lt;/name&gt;\n    &lt;value&gt;org.apache.hadoop.yarn.server.nodemanager.LinuxContainerExecutor&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- \u4f7f\u7528LinuxContainerExecutor\u4e0d\u4f1a\u5f3a\u5236\u4f7f\u7528CGroups\u3002\u5982\u679c\u5e0c\u671b\u4f7f\u7528CGroups\uff0c\u5219\u5fc5\u987b\u5c06resource-handler-class\u8bbe\u7f6e\u4e3aCGroupsLCEResourceHandler--&gt;\n&lt;property&gt;\n    &lt;name&gt;yarn.nodemanager.linux-container-executor.resources-handler.class&lt;/name&gt;\n    &lt;value&gt;org.apache.hadoop.yarn.server.nodemanager.util.CgroupsLCEResourcesHandler&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- \u9ed8\u8ba4\u4e3afalse\uff0c\u6302\u8f7dcgroup\u7684\u8def\u5f84\uff0c\u5f53\u901a\u8fc7df\u547d\u4ee4\u67e5\u770b\uff0c/sys/fs/cgroup\u76ee\u5f55\u6ca1\u6709\u88ab\u6302\u8f7d\u65f6\uff0c\u5c06\u5176\u8bbe\u7f6e\u4e3atrue\u53ef\u4ee5\u81ea\u52a8\u6302\u8f7d --&gt;\n&lt;property&gt;\n    &lt;name&gt;yarn.nodemanager.linux-container-executor.cgroups.mount&lt;/name&gt;\n    &lt;value&gt;false&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- Cgroup\u7684\u6240\u5728\u8def\u5f84 --&gt;\n&lt;property&gt;\n    &lt;name&gt;yarn.nodemanager.linux-container-executor.cgroups.mount-path&lt;/name&gt;\n    &lt;value&gt;/sys/fs/cgroup&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- Nodemanager\u7528\u6237\u7684\u6240\u5c5e\u4e3b\u7ec4\uff0c\u4e0econtainer-executor.cfg\u4e2d\u7684\u914d\u7f6e\u4fdd\u6301\u4e00\u81f4\uff0c\u7528\u4e8e\u9a8c\u8bc1\u6743\u9650 --&gt;\n&lt;property&gt;\n    &lt;name&gt;yarn.nodemanager.linux-container-executor.group&lt;/name&gt;\n    &lt;value&gt;hadoop&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- NM\u8fdb\u7a0b\u4f1a\u81ea\u52a8\u751f\u6210\u8be5\u76ee\u5f55\uff0c\u4e0econtainer-executor.cfg\u4e2d\u7684\u914d\u7f6e\u4fdd\u6301\u4e00\u81f4 --&gt;\n&lt;property&gt;\n    &lt;name&gt;yarn.nodemanager.linux-container-executor.cgroups.hierarchy&lt;/name&gt;\n    &lt;value&gt;/hadoop-yarn&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53\u8bbe\u7f6e\u4e86\u4e0a\u9762\u7684\u914d\u7f6e\u65f6\uff0cYARN\u4f1a\u81ea\u52a8\u68c0\u6d4b\u5e76\u914d\u7f6egpu\u3002</p> <p>\u53ea\u6709\u5f53\u7ba1\u7406\u5458\u6709\u7279\u6b8a\u8981\u6c42\u65f6\uff0c\u624d\u9700\u8981\u5728<code>yarn-site.xml</code>\u914d\u7f6e\u4ee5\u4e0b\u914d\u7f6e\u3002</p>"},{"location":"scheduler_system/yarn/gpu.html#gpu","title":"\u7ba1\u7406\u7684GPU\u8bbe\u5907","text":"<p><code>yarn.nodemanager.resource-plugins.gpu.allowed-gpu-devices</code>\uff1a\u9ed8\u8ba4auto\u3002</p> <ul> <li>\u6307\u5b9aNM\u7ba1\u7406\u7684GPU\u8bbe\u5907\uff0c\u9017\u53f7\u5206\u9694\uff1bGPU\u8bbe\u5907\u7684\u6570\u91cf\u4f1a\u4e0a\u62a5\u7ed9NM\u8fdb\u884c\u8c03\u5ea6\u51b3\u7b56\uff1b</li> <li>GPU\u8bbe\u5907\u662f\u901a\u8fc7\u5b83\u4eec\u7684\u526f\u8bbe\u5907\u53f7\u548c\u7d22\u5f15\u6765\u8bc6\u522b</li> <li>\u83b7\u53d6gpu minor\u8bbe\u5907\u53f7\u7684\u4e00\u79cd\u5e38\u7528\u65b9\u6cd5\u662f\u4f7f\u7528<code>nvidia-smi -q</code>\u5e76\u641c\u7d22Minor Number\u8f93\u51fa\uff1b</li> <li>GPU\u7684\u7d22\u5f15\u683c\u5f0f\u4e3a<code>index:minor_number[,index:minor_number...]</code>\uff1b</li> <li>\u793a\u4f8b\"0:0,1:1,2:2,3:4\"\uff0c\u7ba1\u7406\u7684GPU\u4e3aMinorNumber\u4e3a0,1,2,4\uff0c\u5176\u7d22\u5f15\u4e3a0,1,2,3</li> </ul>"},{"location":"scheduler_system/yarn/gpu.html#gpu_1","title":"\u53d1\u73b0GPU\u7684\u547d\u4ee4","text":"<p><code>yarn.nodemanager.resource-plugins.gpu.path-to-discovery-executables</code>\uff1aauto\u6a21\u5f0f\uff0c\u6307\u5b9a nvidia-smi \u547d\u4ee4\u7684\u7edd\u5bf9\u8def\u5f84</p>"},{"location":"scheduler_system/yarn/gpu.html#container-executorcfg","title":"container-executor.cfg","text":"<p>\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9</p> <pre><code># NM \u7684 Unix \u7528\u6237\u7ec4\uff0c\u8ddf yarn-site \u4e2d\u4fdd\u6301\u4e00\u81f4\nyarn.nodemanager.linux-container-executor.group=hadoop\n# \u5141\u8bb8\u4f7f\u7528\u7684\u7528\u6237\u7684 uid \u6700\u5c0f\u503c\uff0c\u9632\u6b62\u6709\u5176\u4ed6\u8d85\u7ea7\u7528\u6237\nmin.user.id=10\n[gpu]\nmodule.enabled=true\n[cgroups]\n# This should be same as yarn.nodemanager.linux-container-executor.cgroups.mount-path inside yarn-site.xml\nroot=/sys/fs/cgroup\n# This should be same as yarn.nodemanager.linux-container-executor.cgroups.hierarchy inside yarn-site.xml\nyarn-hierarchy=/hadoop-yarn\n</code></pre> <p>\u6ce8\u610f\u6743\u9650\u95ee\u9898</p> <ul> <li>\u8be5\u6587\u4ef6container-executor.cfg \u53ca\u5176\u7684\u6240\u6709\u7236\u76ee\u5f55(\u4e00\u76f4\u5230/ \u76ee\u5f55) owner \u90fd\u4e3a root\uff1b</li> <li> <p>\u4e8c\u8fdb\u5236\u7684 owner \u5fc5\u987b\u662f root\uff0c\u5c5e\u7ec4\u5fc5\u987b\u4e0e NM \u5c5e\u7ec4\u76f8\u540c (hadoop)\uff0c\u6743\u9650 0400\uff1b</p> </li> <li> <p><code>bin/container-executor</code>\u7684\u6743\u9650\u5fc5\u987b\u5355\u72ec\u914d\u7f6e</p> </li> <li>\u4e8c\u8fdb\u5236\u7684 owner \u5fc5\u987b\u662f root\uff0c\u5c5e\u7ec4\u5fc5\u987b\u4e0e NM \u5c5e\u7ec4\u76f8\u540c (hadoop)\uff0c\u6743\u9650 6050\uff1b</li> <li><code>chown root:hadoop bin/container-executor &amp;&amp; chmod 6050 bin/container-executor</code></li> </ul> <p>\u6216\u8005\u53ef\u4ee5\u901a\u8fc7<code>yarn.nodemanager.linux-container-executor.path</code>\u91cd\u65b0\u6307\u5b9a container-executor\u76ee\u5f55</p> <ul> <li><code>container-executor</code>\u662f\u6839\u636e\u76f8\u5bf9\u8def\u5f84\u641c\u7d22<code>container-executor.cfg</code></li> <li>\u8fd9\u6837\u76f8\u5173\u7684\u9012\u5f52\u6743\u9650\u5c31\u5bb9\u6613\u8bbe\u7f6e\uff1b</li> </ul> <pre><code>&lt;!-- yarn-site.xml --&gt; \n&lt;property&gt;\n    &lt;name&gt;yarn.nodemanager.linux-container-executor.path&lt;/name&gt;\n    &lt;value&gt;/hadoop/bin/container-executor&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \n/hadoop\n  - /bin\n    - container-executor\n  - /etc\n    - /hadoop\n      - container-executor.cfg\n--&gt;\n</code></pre>"},{"location":"scheduler_system/yarn/gpu.html#_3","title":"\u68c0\u67e5","text":"<p><code>container-executor --checksetup</code>\uff0c\u6ca1\u6709\u4efb\u4f55\u63d0\u793a\u8868\u793a\u914d\u7f6e\u6210\u529f\uff0c\u53ef\u4ee5\u6b63\u5e38\u542f\u52a8\u96c6\u7fa4\u4f7f\u7528</p>"},{"location":"scheduler_system/yarn/gpu.html#_4","title":"\u4f7f\u7528","text":""},{"location":"scheduler_system/yarn/gpu.html#distributed-shell-gpu","title":"Distributed-shell + GPU","text":"<p>\u5206\u5e03\u5f0fshell\u76ee\u524d\u652f\u6301\u6307\u5b9a\u5185\u5b58\u548cvcore\u4e4b\u5916\u7684\u5176\u4ed6\u8d44\u6e90\u7c7b\u578b\u3002</p>"},{"location":"scheduler_system/yarn/gpu.html#distributed-shell-gpu-without-docker","title":"Distributed-shell + GPU without Docker","text":"<p>\u4e0d\u4f7f\u7528docker\u5bb9\u5668\u8fd0\u884c\u5206\u5e03\u5f0fshell(\u8981\u6c422\u4e2a\u4efb\u52a1\uff0c\u6bcf\u4e2a\u4efb\u52a1\u67093GB\u5185\u5b58\uff0c1\u4e2avcore\uff0c2\u4e2aGPU\u8bbe\u5907\u8d44\u6e90):</p> <pre><code>yarn jar &lt;path/to/hadoop-yarn-applications-distributedshell.jar&gt; \\\n  -jar &lt;path/to/hadoop-yarn-applications-distributedshell.jar&gt; \\\n  -shell_command /bin/nvidia-smi \\\n  -container_resources memory-mb=3072,vcores=1,yarn.io/gpu=2 \\\n  -num_containers 2\n</code></pre> <p>\u5bf9\u4e8e\u542f\u52a8\u7684Container\u4efb\u52a1\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u4fe1\u606f\uff08\u5982\u679c\u8282\u70b9\u6709\u4e24\u4e2aGPU\uff0c\u7533\u8bf7\u4e24\u4e2aContainer\uff0c\u6bcf\u4e2aContainer\u4e00\u4e2aGPU\uff0c\u5219\u6bcf\u4e2aContainer\u53ea\u6253\u5370\u4e00\u4e2aGPU\u4fe1\u606f\uff09</p> <pre><code>Tue Dec  5 22:21:47 2017\n+-----------------------------------------------------------------------------+\n| NVIDIA-SMI 375.66                 Driver Version: 375.66                    |\n|-------------------------------+----------------------+----------------------+\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n|===============================+======================+======================|\n|   0  Tesla P100-PCIE...  Off  | 0000:04:00.0     Off |                    0 |\n| N/A   30C    P0    24W / 250W |      0MiB / 12193MiB |      0%      Default |\n+-------------------------------+----------------------+----------------------+\n|   1  Tesla P100-PCIE...  Off  | 0000:82:00.0     Off |                    0 |\n| N/A   34C    P0    25W / 250W |      0MiB / 12193MiB |      0%      Default |\n+-------------------------------+----------------------+----------------------+\n\n+-----------------------------------------------------------------------------+\n| Processes:                                                       GPU Memory |\n|  GPU       PID  Type  Process name                               Usage      |\n|=============================================================================|\n|  No running processes found                                                 |\n+-----------------------------------------------------------------------------+\n</code></pre>"},{"location":"scheduler_system/yarn/gpu.html#distributed-shell-gpu-with-docker","title":"Distributed-shell + GPU with Docker","text":"<p>\u4f7f\u7528Docker\u5bb9\u5668\u8fd0\u884c\u5206\u5e03\u5f0fshell\u3002</p> <p>\u5fc5\u987b\u6307\u5b9aYARN_CONTAINER_RUNTIME_TYPE/YARN_CONTAINER_RUNTIME_DOCKER_IMAGE\u624d\u80fd\u4f7f\u7528docker\u5bb9\u5668\u3002</p> <pre><code>yarn jar &lt;path/to/hadoop-yarn-applications-distributedshell.jar&gt; \\\n       -jar &lt;path/to/hadoop-yarn-applications-distributedshell.jar&gt; \\\n       -shell_env YARN_CONTAINER_RUNTIME_TYPE=docker \\\n       -shell_env YARN_CONTAINER_RUNTIME_DOCKER_IMAGE=&lt;docker-image-name&gt; \\\n       -shell_command nvidia-smi \\\n       -container_resources memory-mb=3072,vcores=1,yarn.io/gpu=2 \\\n       -num_containers 2\n</code></pre>"},{"location":"scheduler_system/yarn/gpu.html#_5","title":"\u6548\u679c","text":"<p>Yarn\u662f\u6ca1\u6709\u901a\u77e5container\uff0c\u53ef\u7528\u7684GPU\u5361\u53f7\uff0c\u800c\u662f\u901a\u8fc7cgroup device\u9694\u79bb\uff0c\u9650\u5b9aContainer\u53ef\u4ee5\u4f7f\u7528\u7684\u5361\u53f7\u3002</p> <pre><code>./bin/yarn jar share/hadoop/yarn/hadoop-yarn-applications-distributedshell-3.2.1.jar -jar share/hadoop/yarn/hadoop-yarn-applications-distributedshell-3.2.1.jar -shell_command '/home/experiment/anaconda3/bin/python /home/experiment/pytorch.py' -container_resources memory-mb=1024,vcores=1,yarn.io/gpu=1 -num_containers 2\n</code></pre> <p>python.sh</p> <pre><code># encoding: utf-8\nimport torch\nfrom torch import nn\n\nis_gpu = torch.cuda.is_available()\nprint(\"gpu\u662f\u5426\u53ef\u7528\uff1a\",is_gpu)\n\ngpu_nums = torch.cuda.device_count()\nprint(\"gpu\u7684\u6570\u91cf\uff1a\",gpu_nums)\n\nx=torch.Tensor([1,2,3])\nprint(x)\n\n# \u6307\u5b9a\u7b2c0\u53f7GPU\nx=x.cuda(0)\nprint(x)\n</code></pre> <p>\u4ece\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u4e24\u4e2aContainer\uff0c\u5404\u7533\u8bf7\u4e00\u4e2aGPU\uff0c\u4f46\u662f\u5206\u914d\u5728\u4e24\u4e2aGPU\u8bbe\u5907\u4e2d\uff0c\u5373\u4f7f\u5728\u4ee3\u7801\u4e2d\u6307\u5b9acuda(0)\u3002</p> <p></p> <p>\u5982\u679c\u6ca1\u6709\u914d\u7f6eLinuxContainerExecutor\uff0c\u5219\u8fd0\u884c\u7ed3\u679c\u5982\u4e0b\uff0c\u90fd\u8dd1\u5728\u4e00\u4e2aGPU\u5361\u4e0a\u3002</p> <p></p>"},{"location":"scheduler_system/yarn/graceful_decommission.html","title":"Yarn\u8282\u70b9\u4e0a\u4e0b\u7ebf","text":"<p>\u5b98\u65b9\u6587\u6863\uff1ahttps://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html</p>"},{"location":"scheduler_system/yarn/graceful_decommission.html#_1","title":"\u6982\u8ff0","text":"<p>YARN \u5f88\u5bb9\u6613\u6269\u5c55\uff1a\u4efb\u4f55\u65b0\u7684 NodeManager \u90fd\u53ef\u4ee5\u52a0\u5165\u914d\u7f6e\u7684 ResourceManager \u5e76\u5f00\u59cb\u6267\u884c\u4f5c\u4e1a\u3002\u3002\u4f46\u4e3a\u4e86\u5b9e\u73b0\u5b8c\u5168\u5f39\u6027\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u505c\u7528\u8fc7\u7a0b\uff0c\u8fd9\u6709\u52a9\u4e8e\u5220\u9664\u73b0\u6709\u8282\u70b9\u5e76\u7f29\u5c0f\u96c6\u7fa4\u89c4\u6a21\u3002</p> <p>\u8282\u70b9\u505c\u7528\u6709\u4e24\u79cd\u7b56\u7565\uff1a</p> <ul> <li><code>Normal Decommission</code> \uff1a\u7acb\u5373\u5173\u95ed</li> <li><code>GRACEFUL Decommission</code>\uff1a\u4e0d\u4f1a\u5728\u5176\u4e0a\u8c03\u5ea6\u65b0\u5bb9\u5668\u5e76\u7b49\u5f85\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u5b8c\u6210\uff08\u6216\u8d85\u65f6\uff09\uff0c\u518d\u5c06\u8282\u70b9\u8f6c\u6362\u4e3a DECOMMISSIONED</li> </ul>"},{"location":"scheduler_system/yarn/graceful_decommission.html#normal-decommission","title":"Normal Decommission","text":"<p>\u6b65\u9aa4\uff1a\uff08\u4e0d\u9700\u8981\u91cd\u542f ResourceManager\uff09</p> <ul> <li> <p>\u5c06\u5c5e\u6027<code>yarn.resourcemanager.nodes.exclude-path</code> \u6dfb\u52a0\u5230 <code>yarn-site.xml</code></p> </li> <li> <p>\u521b\u5efa\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\uff08\u4f4d\u7f6e\u5728\u4e0a\u4e00\u6b65\u4e2d\u5b9a\u4e49\uff09\uff0c\u5176\u4e2d\u4e00\u884c\u5305\u542b\u6240\u9009 NodeManager \u7684\u540d\u79f0</p> </li> <li>\u6267\u884c\u547d\u4ee4\uff1a<code>./bin/yarn rmadmin -refreshNode</code></li> </ul>"},{"location":"scheduler_system/yarn/graceful_decommission.html#graceful-decommission","title":"GRACEFUL Decommission","text":"<p>\u9ed8\u8ba4 client \u7aef\u64cd\u4f5c\uff0c\u963b\u585e\u3002</p> <p>\u540c <code>Normal Decommission</code>\uff0c \u53ea\u662f\u9700\u8981\u914d\u7f6e <code>-g timeout</code> \u53c2\u6570\u3002</p>"},{"location":"scheduler_system/yarn/node_label_attributes.html","title":"\u8282\u70b9\u6807\u7b7e\u4e0e\u5c5e\u6027","text":""},{"location":"scheduler_system/yarn/node_label_attributes.html#_2","title":"\u8282\u70b9\u6807\u7b7e","text":"<p>https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/NodeLabel.html</p> <p>\u7528\u4e8e\u96c6\u7fa4\u5206\u7ec4</p> <p>\u901a\u8fc7\u6807\u7b7e\u5c06\u96c6\u7fa4\u5206\u533a</p> <ul> <li>\u672a\u914d\u7f6e\u6807\u7b7e\u7684\u8282\u70b9\uff0c\u4f1a\u88ab\u5212\u5206\u5230 default \u5206\u533a\uff1b</li> <li>\u961f\u5217\u53ef\u4ee5\u5360\u636e\u4e0d\u540c\u7684\u5206\u533a\u7684\u4e0d\u540c\u767e\u5206\u6bd4\uff0c\u5269\u4f59\u7684\u4f1a\u88ab default \u961f\u5217\u5360\u636e\uff1b</li> <li>\u63d0\u4ea4\u4f5c\u4e1a\u5230\u961f\u5217\u4e0a\u65f6\uff0c\u5982\u679c\u961f\u5217\u53ef\u7528\u591a\u4e2a\u5206\u533a\uff0c\u53ef\u4ee5\u6307\u5b9a\u4f7f\u7528\u7279\u5b9a\u7684\u5206\u533a\uff1b</li> </ul> <p>\u8282\u70b9\u6807\u7b7e\u7b56\u7565</p> <ul> <li>Exclusive\uff1a\u5bb9\u5668\u5c06\u5206\u914d\u7ed9\u8282\u70b9\u5206\u533a\u5b8c\u5168\u5339\u914d\u7684\u8282\u70b9\uff1b</li> <li>Non-exclusive\uff1a\u5206\u533a\u975e\u72ec\u5360\uff0c\u5219\u4f1a\u5411DEFAULT\u5206\u533a\u5171\u4eab\u8d44\u6e90\uff0c\u5373Container\u7533\u8bf7DEFAULT\u5206\u533a\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5206\u533aA\u7684\u7a7a\u95f2\u8d44\u6e90</li> <li>\u5982\u679c DEFAULT \u5206\u533a\u4f7f\u7528\u5206\u533aA\u7684\u7a7a\u95f2\u8d44\u6e90\u540e\uff0c\u5206\u533aA\u6709\u4f5c\u4e1a\u63d0\u4ea4\uff0cDEFAULT\u5206\u533a\u4f7f\u7528\u7684\u8d44\u6e90\u4e0d\u4f1a\u9000\u8fd8\uff1b </li> </ul>"},{"location":"scheduler_system/yarn/node_label_attributes.html#_3","title":"\u4f5c\u4e1a\u63d0\u4ea4\u65f6\u7684\u5206\u533a\u9650\u5236","text":"<p>\u5bf9\u4e8eGPU\u4f5c\u4e1a\uff0c\u901a\u8fc7spark\u5c01\u88c5\u63d0\u4ea4\u5230yarn\u4e0a\uff0c\u5e76\u4e14\u901a\u8fc7\u8282\u70b9\u6807\u7b7e\u7684\u9650\u5236\uff0c\u5c06executor\u9650\u5236\u5230GPU\u5206\u533a\u4e0a\u8fd0\u884c\u3002</p> <p>\u540c\u4e00\u4e2a\u961f\u5217\uff0c\u914dCPU\u548cGPU\u5206\u533a\u7684\u5bb9\u91cf\uff0c\u5982\u4f55\u9650\u5236CPU\u4f5c\u4e1a\u8fd0\u884c\u5230GPU\u5206\u533a\u4e0a\uff1f</p> <p>Specify required node label in resource request, it will only be allocated when node has the same label. If no node label requirement specified, such Resource Request will only be allocated on nodes belong to DEFAULT partition.</p> <p>\u901a\u8fc7\u5b98\u65b9\u8bf4\u660e\uff0c\u9664\u4e86AI\u4f5c\u4e1a\uff08GPU label\uff09\u5916\uff0c\u5176\u5b83\u4f5c\u4e1a\u53ef\u4ee5\u901a\u8fc7\u4e0d\u6307\u5b9a\u6807\u7b7e\uff0c\u5c06\u4f5c\u4e1a\u76f4\u63a5\u9650\u5236\u5728default\u5206\u533a\u3002</p> <ul> <li>\u901a\u8fc7<code>yarn.scheduler.capacity.&lt;queue-path&gt;.default-node-label-expression</code>\uff0c\u53ef\u4ee5\u4fee\u6539\u9ed8\u8ba4\u65f6\u4e0d\u8bbe\u7f6e\u5206\u533a\u65f6\u7684\u9ed8\u8ba4\u5206\u533a\uff1b</li> </ul>"},{"location":"scheduler_system/yarn/node_label_attributes.html#am","title":"AM \u8bbe\u7f6e\u8282\u70b9\u6807\u7b7e","text":"<pre><code>val amRequest = Records.newRecord(classOf[ResourceRequest])\namRequest.setResourceName(ResourceRequest.ANY)\namRequest.setPriority(Priority.newInstance(0))\namRequest.setCapability(capability)\namRequest.setNumContainers(1)\namRequest.setNodeLabelExpression(expr)\nappContext.setAMContainerResourceRequest(amRequest)\n</code></pre>"},{"location":"scheduler_system/yarn/node_label_attributes.html#container","title":"Container \u8bbe\u7f6e\u8282\u70b9\u6807\u7b7e","text":"<pre><code>new ContainerRequest(..., nodeLabelExpresssion)\n</code></pre>"},{"location":"scheduler_system/yarn/node_label_attributes.html#api","title":"API","text":"<p>\u901a\u8fc7 CLI \u6216\u8005 Client API \u65b0\u589e\u6216\u4fee\u6539\u5206\u533a\u65f6\uff0c\u9700\u8981\u6ce8\u610f\u5206\u533a\u88ab\u7ed1\u5b9a\u7684\u6240\u6709\u8282\u70b9\uff08\u5305\u62ec\u9ed8\u8ba4default\u961f\u5217\uff09\u7684\u603b\u91cf\u4e3a 100%</p> <ul> <li>\u65b0\u589e\u5206\u533a\u65f6\uff0c</li> <li>\u8bbe\u7f6e\u5148\u8bbe\u7f6e root \u548c root.default \u5bf9\u8be5\u5206\u533a\u7684\u5bb9\u91cf\u4e3a100%\uff1b</li> <li>\u65b0\u589e\u961f\u5217\uff0c\u5bb9\u91cf\u4e3a0\uff1b</li> <li>\u4fee\u6539\u65b0\u589e\u961f\u5217\u548cdefault\u961f\u5217\u5bf9\u5206\u533a\u7684\u5bb9\u91cf\uff1b</li> </ul>"},{"location":"scheduler_system/yarn/node_label_attributes.html#_4","title":"\u8282\u70b9\u5c5e\u6027","text":"<p>https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/NodeAttributes.html</p> <p>\u7528\u4e8e Placement Constraint\uff0c\u961f\u5217\u4e0d\u9700\u8981\u505a\u4efb\u4f55\u914d\u7f6e\u3002</p> <p>\u7279\u6027\uff1a</p> <ul> <li>\u786c\u6027\u9650\u5236\uff0c\u4e0d\u50cfLocality\u5177\u5907Relax\uff1b</li> <li>\u53ef\u6301\u4e45\u5316\uff0cRM\u8fd0\u884c\u65f6\u53ef\u66f4\u65b0\uff1b</li> </ul> <p>\u8282\u70b9\u7684\u5c5e\u6027\u6765\u6e90\u652f\u6301\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li>Centralised\uff1a\u901a\u8fc7 RM \u7684 CLI \u6216\u8005 RPC\uff08REST\u6682\u4e0d\u652f\u6301\uff09\uff1b</li> <li>Distribtued\uff1a\u6bcf\u4e2aNM\u914d\u7f6eProvider\uff08scritp\u6216\u8005config\uff09\uff1b</li> </ul>"},{"location":"scheduler_system/yarn/node_label_attributes.html#_5","title":"\u8c03\u5ea6\u7b56\u7565","text":"<p><code>yarn.resourcemanager.placement-constraints.handler</code>\uff1a\u9ed8\u8ba4 disabled</p> <ul> <li>placement-processor\uff1a\u5148\u786e\u5b9a placement\uff0c\u7136\u540escheduler\u518d\u8c03\u5ea6\uff08a pre-processing step before the capacity or the fair scheduler is called\uff09</li> <li>\u652f\u6301\u6240\u6709\u9650\u5236\u7c7b\u578b\uff0c<code>affinity, anti-affinity, cardinality</code>\uff1b</li> <li>\u4e00\u6b21\u5904\u7406\u591a\u4e2acontainers\uff0c\u5bb9\u91cf/\u516c\u5e73\u8c03\u5ea6\u90fd\u652f\u6301\uff1b</li> <li>\u4e0d\u8003\u8651\u5e94\u7528\u5185\u7684 task \u4f18\u5148\u7ea7\uff08\u4e00\u4e2aAM\u53ef\u4ee5\u7533\u8bf7\u4e0d\u540c\u4f18\u5148\u7ea7\u7684Container\uff09\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u4f18\u5148\u7ea7\u53ef\u80fd\u4e0e\u653e\u7f6e\u7ea6\u675f\u76f8\u51b2\u7a81\uff1b</li> <li>scheduler\uff1a\u4ec5\u652f\u6301\u5bb9\u91cf\u8c03\u5ea6\uff0c\u5728\u8c03\u5ea6\u7684\u540c\u65f6\u8003\u8651 placement\uff1b</li> <li>\u4ec5\u652f\u6301 anti-affinity \u9650\u5236\uff1b</li> <li>\u5bf9\u961f\u5217\uff08\u6309\u5229\u7528\u7387\u3001\u4f18\u5148\u7ea7\u6392\u5e8f\uff09\u3001\u5e94\u7528\u7a0b\u5e8f\uff08\u6309FIFO/\u516c\u5e73\u6027/\u4f18\u5148\u7ea7\u6392\u5e8f\uff09\u548c\u540c\u4e00\u5e94\u7528\u7a0b\u5e8f\u5185\u7684\u4efb\u52a1\uff08\u4f18\u5148\u7ea7\uff09\u9075\u5faa\u76f8\u540c\u7684\u6392\u5e8f\u89c4\u5219</li> </ul>"},{"location":"scheduler_system/yarn/node_label_attributes.html#placement","title":"Placement\u8bed\u6cd5","text":"<p>https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/PlacementConstraints.html</p> <p>constraints can refer to allocation tags, as well as node labels and node attributes.</p> <pre><code>SingleConstraint  =&gt; \"IN\",Scope,TargetTag | \"NOTIN\",Scope,TargetTag | \"CARDINALITY\",Scope,TargetTag,MinCard,MaxCard | NodeAttributeConstraintExpr\nNodeAttributeConstraintExpr =&gt; NodeAttributeName=Value, NodeAttributeName!=Value\nScope                       =&gt; \"NODE\" | \"RACK\"\n</code></pre> <p>allocation tags\uff1aattached to allocations and not to nodes\uff1b</p> <ul> <li>\u7528\u4e8e IN\uff0cNOTIN \u548c CARDINALITY\uff1b</li> <li>APP \u7533\u8bf7Container\u65f6\uff0c\u914d\u7f6e\u7684 tags\uff0c\u6bd4\u5982\u53ef\u4ee5\u5bf9HBase Master Container \u6253 hbase-m\u7684tag\uff0cRegion Server\u6253 hbase-rs \u7684\u6807\u7b7e\uff1b</li> <li>\u53ef\u4f5c\u7528\u4e8e\u5e94\u7528\u7a0b\u5e8f\u5185\u90e8\u6216\u8005\u5e94\u7528\u7a0b\u5e8f\u95f4\uff0c\u9ed8\u8ba4\u662f\u5e94\u7528\u7a0b\u5e8f\u5185\u90e8\u7684\u5224\u65ad\uff1b</li> <li><code>self/${tag}, not-self/${tag}, all/${tag}</code></li> <li><code>app-id/${applicationID}/${allocationTag}</code>\uff0c<code>app-tag/application_tag_name/${allocationTag}</code></li> </ul> <p>node attributes\uff1aKV \u7684\u5f62\u5f0f</p>"},{"location":"scheduler_system/yarn/node_label_attributes.html#_6","title":"\u5e94\u7528\u914d\u7f6e","text":""},{"location":"scheduler_system/yarn/node_label_attributes.html#am_1","title":"AM \u4e0d\u652f\u6301\u914d\u7f6e\u8282\u70b9\u5c5e\u6027","text":"<p>https://issues.apache.org/jira/browse/YARN-10065</p>"},{"location":"scheduler_system/yarn/node_label_attributes.html#container_1","title":"Container \u8bbe\u7f6e\u8282\u70b9\u5c5e\u6027","text":"<ul> <li>\u914d\u7f6e\u4f7f\u7528<code>placement-processor</code> handler\uff0c\u9488\u5bf9\u6240\u6709\u7684 container\uff1b</li> </ul> <pre><code>val amClient = AMRMClient.createAMRMClient()\n...\namClient.registerApplicationMaster(..., placementConstraints)\n</code></pre> <ul> <li>\u914d\u7f6e\u4f7f\u7528 <code>scheduler</code>handler\uff0c\u9664\u4e86\u4e0a\u9762\u4e4b\u5916\uff0c\u53ef\u4ee5\u9488\u5bf9\u6bcf\u4e2a container \u8bbe\u7f6e\uff08\u4f18\u5148\u7ea7\u6700\u9ad8\uff0c\u8986\u76d6\u524d\u8005\uff09\uff0c\u4f7f\u7528 SchedulingRequest \u800c\u4e0d\u662f ContainerRequest</li> </ul> <pre><code>//requests for 1 container on nodes expression : AND(python!=3:java=1.8)\nSchedulingRequest schedulingRequest =\n    SchedulingRequest.newBuilder().executionType(\n        ExecutionTypeRequest.newInstance(ExecutionType.GUARANTEED))\n        .allocationRequestId(10L).priority(Priority.newInstance(1))\n        .placementConstraintExpression(\n            PlacementConstraints.and(\n                PlacementConstraints\n                    .targetNodeAttribute(PlacementConstraints.NODE,\n                        NodeAttributeOpCode.NE,\n                        PlacementConstraints.PlacementTargets\n                            .nodeAttribute(\"python\", \"3\")),\n                PlacementConstraints\n                    .targetNodeAttribute(PlacementConstraints.NODE,\n                        NodeAttributeOpCode.EQ,\n                        PlacementConstraints.PlacementTargets\n                            .nodeAttribute(\"java\", \"1.8\")))\n                .build()).resourceSizing(\n        ResourceSizing.newInstance(1, Resource.newInstance(1024, 1)))\n        .build();\n</code></pre>"},{"location":"scheduler_system/yarn/scheduler.html","title":"Scheduler","text":"<p>[toc]</p>"},{"location":"scheduler_system/yarn/scheduler.html#_1","title":"\u8c03\u5ea6\u7b56\u7565","text":""},{"location":"scheduler_system/yarn/scheduler.html#_2","title":"\u539f\u7406","text":"<p>\u961f\u5217\u5185\u5e94\u7528\u7684\u6392\u5e8f\u987a\u5e8f\uff0c</p> <p>ActiveApp\u7684OrderPolicy\uff1a\u9ed8\u8ba4\u662fFIFO\uff08FifoOrderingPolicy\uff09\uff0c\u53ef\u4ee5\u901a\u8fc7<code>yarn.scheduler.capacity.&lt;queue-name&gt;.ordering-policy</code>\u81ea\u5b9a\u4e49\u3002</p> <p>PendingApp\u7684OrderPolicy\uff1a\u56fa\u5b9a\u7684 FifoOrderingPolicyForPendingApps\u3002</p>"},{"location":"scheduler_system/yarn/scheduler.html#_3","title":"\u5bb9\u91cf\u8c03\u5ea6","text":"<p>CapacityScheduler\uff1a\u5141\u8bb8\u591a\u4e2a\u79df\u6237\u5b89\u5168\u5730\u5171\u4eab\u4e00\u4e2a\u5927\u578b\u96c6\u7fa4\uff0c\u4ee5\u4fbf\u5728\u5206\u914d\u7684\u5bb9\u91cf\u9650\u5236\u4e0b\u53ca\u65f6\u5730\u5206\u914d\u5176\u5e94\u7528\u7a0b\u5e8f\u7684\u8d44\u6e90\u3002</p> <p>CapacityScheduler\u5bf9\u6765\u81ea\u5355\u4e2a\u7528\u6237\u548c\u961f\u5217\u7684\u5df2\u521d\u59cb\u5316\u548c\u6302\u8d77\u7684\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u4e86\u9650\u5236\uff0c\u4ee5\u786e\u4fdd\u96c6\u7fa4\u7684\u516c\u5e73\u6027\u548c\u7a33\u5b9a\u6027\u3002</p>"},{"location":"scheduler_system/yarn/scheduler.html#_4","title":"\u7279\u6027","text":"<ul> <li>\u5206\u5c42\u961f\u5217\uff1a\u652f\u6301\u961f\u5217\u5c42\u6b21\u7ed3\u6784\uff0c\u4ee5\u786e\u4fdd\u5728\u5141\u8bb8\u5176\u4ed6\u961f\u5217\u4f7f\u7528\u7a7a\u95f2\u8d44\u6e90\u4e4b\u524d\uff0c\u5728\u7ec4\u7ec7\u7684\u5b50\u961f\u5217\u4e4b\u95f4\u5171\u4eab\u8d44\u6e90\uff0c\u4ece\u800c\u63d0\u4f9b\u66f4\u591a\u7684\u63a7\u5236\u548c\u53ef\u9884\u6d4b\u6027\uff1b</li> <li>\u5bb9\u91cf\u4fdd\u8bc1\uff1a\u961f\u5217\u88ab\u5206\u914d\u5230\u7f51\u683c\u5bb9\u91cf\u7684\u4e00\u5c0f\u90e8\u5206\uff0c\u8fd9\u610f\u5473\u7740\u5c06\u6709\u4e00\u5b9a\u7684\u8d44\u6e90\u5bb9\u91cf\u4f9b\u5176\u4f7f\u7528\u3002\u6240\u6709\u63d0\u4ea4\u5230\u961f\u5217\u7684\u5e94\u7528\u7a0b\u5e8f\u90fd\u53ef\u4ee5\u8bbf\u95ee\u5206\u914d\u7ed9\u961f\u5217\u7684\u5bb9\u91cf\u3002\u7ba1\u7406\u5458\u53ef\u4ee5\u914d\u7f6e\u5206\u914d\u7ed9\u6bcf\u4e2a\u961f\u5217\u7684\u5bb9\u91cf\u7684\u8f6f\u9650\u5236\u548c\u53ef\u9009\u7684\u786c\u9650\u5236\u3002</li> <li>\u5b89\u5168\u6027\uff1a\u6bcf\u4e2a\u961f\u5217\u90fd\u6709\u4e25\u683c\u7684acl\uff0c\u7528\u4e8e\u63a7\u5236\u54ea\u4e9b\u7528\u6237\u53ef\u4ee5\u5411\u5355\u4e2a\u961f\u5217\u63d0\u4ea4\u5e94\u7528\u7a0b\u5e8f\u3002\u53e6\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u5b89\u5168\u4fdd\u62a4\u63aa\u65bd\u53ef\u4ee5\u786e\u4fdd\u7528\u6237\u4e0d\u80fd\u67e5\u770b\u548c/\u6216\u4fee\u6539\u6765\u81ea\u5176\u4ed6\u7528\u6237\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u6b64\u5916\uff0c\u8fd8\u652f\u6301\u6bcf\u4e2a\u961f\u5217\u548c\u7cfb\u7edf\u7ba1\u7406\u5458\u89d2\u8272\u3002</li> <li>\u5f39\u6027\uff1a\u53ef\u4ee5\u5c06\u7a7a\u95f2\u8d44\u6e90\u5206\u914d\u7ed9\u8d85\u51fa\u5176\u5bb9\u91cf\u7684\u4efb\u4f55\u961f\u5217\u3002\u5f53\u672a\u6765\u67d0\u4e2a\u65f6\u95f4\u70b9\u4e0a\u8fd0\u884c\u7684\u5bb9\u91cf\u4e0d\u8db3\u7684\u961f\u5217\u5bf9\u8fd9\u4e9b\u8d44\u6e90\u6709\u9700\u6c42\u65f6\uff0c\u968f\u7740\u5728\u8fd9\u4e9b\u8d44\u6e90\u4e0a\u8c03\u5ea6\u7684\u4efb\u52a1\u5b8c\u6210\uff0c\u5b83\u4eec\u5c06\u88ab\u5206\u914d\u7ed9\u5bb9\u91cf\u4e0d\u8db3\u7684\u961f\u5217\u4e0a\u7684\u5e94\u7528\u7a0b\u5e8f(\u4e5f\u652f\u6301\u62a2\u5360)\u3002\u8fd9\u786e\u4fdd\u4e86\u8d44\u6e90\u4ee5\u53ef\u9884\u6d4b\u7684\u3001\u5f39\u6027\u7684\u65b9\u5f0f\u53ef\u7528\u4e8e\u961f\u5217\uff0c\u4ece\u800c\u9632\u6b62\u4e86\u96c6\u7fa4\u4e2d\u8d44\u6e90\u7684\u4eba\u5de5\u7ad6\u4e95\uff08artificial silos\uff09\uff0c\u4ece\u800c\u6709\u52a9\u4e8e\u5229\u7528\u8d44\u6e90\u3002</li> <li>\u591a\u79df\u6237\uff1a\u63d0\u4f9b\u4e86\u4e00\u7ec4\u5168\u9762\u7684\u9650\u5236\uff0c\u4ee5\u9632\u6b62\u5355\u4e2a\u5e94\u7528\u7a0b\u5e8f\u3001\u7528\u6237\u548c\u961f\u5217\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u5784\u65ad\u961f\u5217\u6216\u96c6\u7fa4\u7684\u8d44\u6e90\uff0c\u4ee5\u786e\u4fdd\u96c6\u7fa4\u4e0d\u4f1a\u8fc7\u8f7d\u3002</li> <li>\u53ef\u64cd\u4f5c\u6027\uff1a</li> <li>\u8fd0\u884c\u65f6\u914d\u7f6e\uff1a\u7ba1\u7406\u5458\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u4ee5\u5b89\u5168\u7684\u65b9\u5f0f\u66f4\u6539\u961f\u5217\u5b9a\u4e49\u548c\u5c5e\u6027(\u5982\u5bb9\u91cf\u3001acl)\uff0c\u4ee5\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bf9\u7528\u6237\u7684\u5e72\u6270\u3002\u6b64\u5916\uff0c\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u63a7\u5236\u53f0\uff0c\u4f9b\u7528\u6237\u548c\u7ba1\u7406\u5458\u67e5\u770b\u7cfb\u7edf\u4e2d\u5404\u79cd\u961f\u5217\u7684\u5f53\u524d\u8d44\u6e90\u5206\u914d\u60c5\u51b5\u3002\u7ba1\u7406\u5458\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u6dfb\u52a0\u5176\u4ed6\u961f\u5217\uff0c\u4f46\u4e0d\u80fd\u5728\u8fd0\u884c\u65f6\u5220\u9664\u961f\u5217\uff0c\u9664\u975e\u961f\u5217\u88ab\u505c\u6b62\uff0c\u5e76\u4e14\u6ca1\u6709\u6302\u8d77/\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</li> <li>\u91ca\u653e\u5e94\u7528\u7a0b\u5e8f\uff1a\u7ba1\u7406\u5458\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u505c\u6b62\u961f\u5217\uff0c\u4ee5\u786e\u4fdd\u5728\u73b0\u6709\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u5230\u5b8c\u6210\u65f6\uff0c\u4e0d\u4f1a\u63d0\u4ea4\u65b0\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u5982\u679c\u961f\u5217\u5904\u4e8e\u505c\u6b62\u72b6\u6001\uff0c\u5219\u65e0\u6cd5\u5c06\u65b0\u5e94\u7528\u7a0b\u5e8f\u63d0\u4ea4\u7ed9\u961f\u5217\u672c\u8eab\u6216\u5176\u4efb\u4f55\u5b50\u961f\u5217\u3002\u73b0\u6709\u7684\u5e94\u7528\u7a0b\u5e8f\u5c06\u7ee7\u7eed\u5b8c\u6210\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f18\u96c5\u5730\u91ca\u653e\u961f\u5217\u3002\u7ba1\u7406\u5458\u8fd8\u53ef\u4ee5\u542f\u52a8\u5df2\u505c\u6b62\u7684\u961f\u5217\u3002</li> <li>\u57fa\u4e8e\u8d44\u6e90\u7684\u8c03\u5ea6\uff1a\u652f\u6301\u8d44\u6e90\u5bc6\u96c6\u578b\u5e94\u7528\u7a0b\u5e8f\uff0c\u5176\u4e2d\u5e94\u7528\u7a0b\u5e8f\u4e2d\u53ef\u4ee5\u9009\u62e9\u6027\u5730\u6307\u5b9a\u6bd4\u9ed8\u8ba4\u503c\u66f4\u9ad8\u7684\u8d44\u6e90\u9700\u6c42\uff0c\u4ece\u800c\u9002\u5e94\u4e0d\u540c\u8d44\u6e90\u9700\u6c42\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</li> <li>\u4f18\u5148\u7ea7\u8c03\u5ea6\uff1a\u4ee5\u4e0d\u540c\u7684\u4f18\u5148\u7ea7\u63d0\u4ea4\u548c\u8c03\u5ea6\u5e94\u7528\u7a0b\u5e8f\u3002\u8f83\u9ad8\u7684\u6574\u6570\u503c\u8868\u793a\u5e94\u7528\u7a0b\u5e8f\u7684\u4f18\u5148\u7ea7\u8f83\u9ad8\u3002\u76ee\u524d\uff0c\u5e94\u7528\u7a0b\u5e8f\u4f18\u5148\u7ea7\u4ec5\u652f\u6301FIFO\u6392\u5e8f\u7b56\u7565\u3002</li> <li>\u57fa\u4e8e\u9ed8\u8ba4\u6216\u7528\u6237\u5b9a\u4e49\u7684\u653e\u7f6e\u89c4\u5219\u7684\u961f\u5217\u6620\u5c04\u63a5\u53e3\uff1a\u5141\u8bb8\u7528\u6237\u57fa\u4e8e\u67d0\u4e9b\u9ed8\u8ba4\u653e\u7f6e\u89c4\u5219\u5c06\u4f5c\u4e1a\u6620\u5c04\u5230\u7279\u5b9a\u961f\u5217\u3002\u4f8b\u5982\uff0c\u6839\u636e\u7528\u6237\u548c\u7ec4\u6216\u5e94\u7528\u7a0b\u5e8f\u540d\u79f0\u3002\u7528\u6237\u4e5f\u53ef\u4ee5\u5b9a\u4e49\u81ea\u5df1\u7684\u653e\u7f6e\u89c4\u5219\uff08Hadoop 3.x\uff09\u3002</li> <li>\u7edd\u5bf9\u7684\u8d44\u6e90\u914d\u7f6e\uff08Hadoop 3.x\uff09\uff1a\u7ba1\u7406\u5458\u53ef\u4ee5\u4e3a\u961f\u5217\u6307\u5b9a\u7edd\u5bf9\u8d44\u6e90\uff0c\u800c\u4e0d\u662f\u63d0\u4f9b\u57fa\u4e8e\u767e\u5206\u6bd4\u7684\u503c\u3002</li> <li>Leaf Queue\u7684\u52a8\u6001\u81ea\u52a8\u521b\u5efa\u548c\u7ba1\u7406\uff08Hadoop 3.x\uff09\uff1a\u652f\u6301\u81ea\u52a8\u521b\u5efa\u53f6\u961f\u5217\u548c\u961f\u5217\u6620\u5c04\uff0c\u961f\u5217\u6620\u5c04\u76ee\u524d\u652f\u6301\u57fa\u4e8e\u7528\u6237\u7ec4\u7684\u961f\u5217\u6620\u5c04\uff0c\u7528\u4e8e\u5c06\u5e94\u7528\u7a0b\u5e8f\u653e\u7f6e\u5230\u961f\u5217\u4e2d\u3002\u8c03\u5ea6\u5668\u8fd8\u652f\u6301\u57fa\u4e8e\u7236\u961f\u5217\u4e0a\u914d\u7f6e\u7684\u7b56\u7565\u5bf9\u8fd9\u4e9b\u961f\u5217\u8fdb\u884c\u5bb9\u91cf\u7ba1\u7406\u3002</li> </ul>"},{"location":"scheduler_system/yarn/scheduler.html#_5","title":"\u914d\u7f6e","text":"<p><code>yarn.resourcemanager.scheduler.class</code>\uff1a\u9ed8\u8ba4\uff0c<code>org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler</code></p> <p><code>etc/hadoop/capacity-scheduler.xml</code>\u662f\u5bb9\u91cf\u8c03\u5ea6\u7684\u914d\u7f6e\u6587\u4ef6\u3002</p>"},{"location":"scheduler_system/yarn/scheduler.html#_6","title":"\u8bbe\u7f6e\u961f\u5217","text":"<p><code>root</code>\u662f\u5bb9\u91cf\u8c03\u5ea6\u9884\u5148\u5b9a\u4e49\u597d\u7684\u961f\u5217\uff0c\u7cfb\u7edf\u4e2d\u6240\u6709\u7684\u961f\u5217\u90fd\u662froot\u961f\u5217\u7684\u5b50\u961f\u5217\u3002</p> <p>queue path\u7528\u6765\u8868\u793a\u5206\u5c42\u961f\u5217\uff0c\u662f\u961f\u5217\u5c42\u6b21\u7684\u5168\u8def\u5f84\uff0c\u4ee5<code>root</code>\u5f00\u59cb\uff0c<code>.</code>\u4f5c\u4e3a\u5206\u9694\u3002</p> <p><code>yarn.scheduler.capacity.root.queues</code>\u5b9a\u4e49root\u7684\u5b50\u961f\u5217\uff0c<code>yarn.scheduler.capacity.&lt;queue-path&gt;.queues</code>\u8868\u793a\u7279\u5b9a\u961f\u5217\u7684\u5b50\u961f\u5217\u3002</p> <p>\u9664\u975e\u53e6\u6709\u8bf4\u660e\uff0c\u5b50\u961f\u5217\u4e0d\u4f1a\u76f4\u63a5\u4ece\u7236\u961f\u5217\u7ee7\u627f\u5c5e\u6027\u3002</p> <pre><code>&lt;property&gt;\n  &lt;name&gt;yarn.scheduler.capacity.root.queues&lt;/name&gt;\n  &lt;value&gt;a,b,c&lt;/value&gt;\n  &lt;description&gt;root queue has three sub queue a, b and c.&lt;/description&gt;\n&lt;/property&gt;\n\n&lt;property&gt;\n  &lt;name&gt;yarn.scheduler.capacity.root.a.queues&lt;/name&gt;\n  &lt;value&gt;a1,a2&lt;/value&gt;\n  &lt;description&gt;queue a has sub queues a1 and a2 &lt;/description&gt;\n&lt;/property&gt;\n\n&lt;property&gt;\n  &lt;name&gt;yarn.scheduler.capacity.root.b.queues&lt;/name&gt;\n  &lt;value&gt;b1,b2,b3&lt;/value&gt;\n  &lt;description&gt;queue b has sub queues b1 b2 and b3&lt;/description&gt;\n&lt;/property&gt;\n</code></pre>"},{"location":"scheduler_system/yarn/scheduler.html#_7","title":"\u961f\u5217\u5c5e\u6027","text":"Property Description <code>yarn.scheduler.capacity.&lt;queue-path&gt;.capacity</code> \u961f\u5217\u7684\u5bb9\u91cf\uff0cfloat\u578b\u767e\u5206\u6bd4\u6216\u8005\u7edd\u5bf9\u7684\u5bb9\u91cf\u3002\u6bcf\u4e00\u5c42\u7684\u6240\u6709\u961f\u5217\u7684\u5bb9\u91cf\u548c\u5fc5\u987b\u4e3a100\u3002\u4f46\u5982\u679c\u914d\u7f6e\u7edd\u5bf9\u8d44\u6e90\u5bb9\u91cf\uff0c\u5219\u5b50\u961f\u5217\u7684\u7edd\u5bf9\u8d44\u6e90\u5bb9\u91cf\u548c\u53ef\u4ee5\u5c0f\u4e8e\u7236\u961f\u5217\u7684\u7edd\u5bf9\u8d44\u6e90\u5bb9\u91cf\u3002\u5982\u679c\u6709\u7a7a\u95f2\u8d44\u6e90\uff0c\u961f\u5217\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u6d88\u8017\u7684\u8d44\u6e90\u53ef\u80fd\u8d85\u8fc7\u961f\u5217\u7684\u5bb9\u91cf\uff0c\u4ece\u800c\u63d0\u4f9b\u7075\u6d3b\u6027\u3002 <code>yarn.scheduler.capacity.&lt;queue-path&gt;.maximum-capacity</code> \u6700\u5927\u961f\u5217\u7684\u5bb9\u91cf\u767e\u5206\u6bd4\u6216\u8005\u5217\u961f\u7684\u7edd\u5bf9\u8d44\u6e90\u6700\u5927\u5bb9\u91cf\u3002\u9650\u5236\u961f\u5217\u5e94\u7528\u7684\u7075\u6d3b\u6027\u3002-1\u8868\u793a\u57282.x\u8868\u793a\u7981\u7528\uff0c\u57283.x\u8868\u793a100% <code>yarn.scheduler.capacity.&lt;queue-path&gt;.minimum-user-limit-percent</code> \u5982\u679c\u6709\u8d44\u6e90\u9700\u6c42\uff0c\u6bcf\u4e2a\u961f\u5217\u5728\u4efb\u4f55\u7ed9\u5b9a\u65f6\u95f4\u90fd\u5bf9\u5206\u914d\u7ed9\u7528\u6237\u7684\u8d44\u6e90\u767e\u5206\u6bd4\u65bd\u52a0\u9650\u5236\u3002\u7528\u6237\u9650\u5236\u53ef\u4ee5\u5728\u6700\u5c0f\u503c\u548c\u6700\u5927\u503c\u4e4b\u95f4\u53d8\u5316\u3002\u524d\u8005(\u6700\u5c0f\u503c)\u8bbe\u7f6e\u4e3a\u6b64\u5c5e\u6027\u503c\uff0c\u540e\u8005(\u6700\u5927\u503c)\u53d6\u51b3\u4e8e\u63d0\u4ea4\u5e94\u7528\u7a0b\u5e8f\u7684\u7528\u6237\u6570\u91cf\u3002\u4f8b\u5982\uff0c\u5047\u8bbe\u8fd9\u4e2a\u5c5e\u6027\u7684\u503c\u662f25\u3002\u5982\u679c\u4e24\u4e2a\u7528\u6237\u5411\u4e00\u4e2a\u961f\u5217\u63d0\u4ea4\u4e86\u5e94\u7528\u7a0b\u5e8f\uff0c\u90a3\u4e48\u4efb\u4f55\u4e00\u4e2a\u7528\u6237\u90fd\u4e0d\u80fd\u4f7f\u7528\u8d85\u8fc750%\u7684\u961f\u5217\u8d44\u6e90\u3002\u5982\u679c\u7b2c\u4e09\u4e2a\u7528\u6237\u63d0\u4ea4\u5e94\u7528\u7a0b\u5e8f\uff0c\u4efb\u4f55\u4e00\u4e2a\u7528\u6237\u90fd\u4e0d\u80fd\u4f7f\u7528\u8d85\u8fc733%\u7684\u961f\u5217\u8d44\u6e90\u3002\u5bf9\u4e8e4\u4e2a\u62164\u4e2a\u4ee5\u4e0a\u7684\u7528\u6237\uff0c\u4efb\u4f55\u7528\u6237\u90fd\u4e0d\u80fd\u4f7f\u7528\u8d85\u8fc725%\u7684\u961f\u5217\u8d44\u6e90\u3002\u503c\u4e3a100\u610f\u5473\u7740\u6ca1\u6709\u65bd\u52a0\u4efb\u4f55\u7528\u6237\u9650\u5236\u3002\u9ed8\u8ba4\u503c\u662f100\u3002\u503c\u6307\u5b9a\u4e3a\u6574\u6570\u3002 <code>yarn.scheduler.capacity.&lt;queue-path&gt;.user-limit-factor</code> \u961f\u5217\u5bb9\u91cf\u7684\u500d\u6570\uff0c\u53ef\u914d\u7f6e\u4e3a\u5141\u8bb8\u5355\u4e2a\u7528\u6237\u83b7\u53d6\u66f4\u591a\u8d44\u6e90\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u503c\u88ab\u8bbe\u7f6e\u4e3a1\uff0c\u8fd9\u786e\u4fdd\u4e86\u65e0\u8bba\u96c6\u7fa4\u6709\u591a\u7a7a\u95f2\uff0c\u5355\u4e2a\u7528\u6237\u90fd\u4e0d\u4f1a\u5360\u7528\u8d85\u8fc7\u961f\u5217\u914d\u7f6e\u7684\u5bb9\u91cf\u3002\u503c\u88ab\u6307\u5b9a\u4e3a\u4e00\u4e2a\u6d6e\u70b9\u6570\u3002 <code>yarn.scheduler.capacity.&lt;queue-path&gt;.maximum-allocation-mb</code> \u8d44\u6e90\u7ba1\u7406\u5668\u4e0a\u5206\u914d\u7ed9\u6bcf\u4e2a\u5bb9\u5668\u8bf7\u6c42\u7684\u6bcf\u4e2a\u961f\u5217\u7684\u6700\u5927\u5185\u5b58\u9650\u5236\u3002\u6b64\u8bbe\u7f6e\u8986\u76d6\u96c6\u7fa4\u914d\u7f6e<code>yarn.scheduler.maximum-allocation-mb</code>\u3002\u8fd9\u4e2a\u503c\u5fc5\u987b\u5c0f\u4e8e\u6216\u7b49\u4e8e\u96c6\u7fa4\u7684\u6700\u5927\u503c\u3002 <code>yarn.scheduler.capacity.&lt;queue-path&gt;.maximum-allocation-vcores</code> \u8d44\u6e90\u7ba1\u7406\u5668\u4e0a\u5206\u914d\u7ed9\u6bcf\u4e2a\u5bb9\u5668\u8bf7\u6c42\u7684\u6bcf\u4e2a\u961f\u5217\u865a\u62df\u6838\u7684\u6700\u5927\u9650\u5236\u3002\u6b64\u8bbe\u7f6e\u8986\u76d6\u96c6\u7fa4\u914d\u7f6e<code>yarn.scheduler.maximum-allocation-vcores</code>\u3002\u8fd9\u4e2a\u503c\u5fc5\u987b\u5c0f\u4e8e\u6216\u7b49\u4e8e\u96c6\u7fa4\u7684\u6700\u5927\u503c\u3002 <code>yarn.scheduler.capacity.&lt;queue-path&gt;.user-settings.&lt;user-name&gt;.weight</code> \u5728\u4e3a\u961f\u5217\u4e2d\u7684\u7528\u6237\u8ba1\u7b97\u7528\u6237\u9650\u5236\u8d44\u6e90\u503c\u65f6\u4f7f\u7528\u6b64\u6d6e\u70b9\u503c\u3002\u8fd9\u4e2a\u503c\u5c06\u4f7f\u6bcf\u4e2a\u7528\u6237\u7684\u6743\u91cd\u5927\u4e8e\u6216\u5c0f\u4e8e\u961f\u5217\u4e2d\u7684\u5176\u4ed6\u7528\u6237\u3002\u4f8b\u5982\uff0c\u5982\u679c\u7528\u6237A\u5728\u961f\u5217\u4e2d\u63a5\u6536\u5230\u7684\u8d44\u6e90\u6bd4\u7528\u6237B\u548cC\u591a50%\uff0c\u90a3\u4e48\u5bf9\u4e8e\u7528\u6237A\uff0c\u8fd9\u4e2a\u5c5e\u6027\u5c06\u88ab\u8bbe\u7f6e\u4e3a1.5\u3002\u7528\u6237B\u548cC\u9ed8\u8ba4\u4e3a1.0\u3002 <p>\u5bb9\u91cf\u8c03\u5ea6\u5668\u652f\u6301\u4ee5\u4e0b\u53c2\u6570\u6765\u63a7\u5236\u8fd0\u884c\u548c\u6302\u8d77\u7684\u5e94\u7528\u7a0b\u5e8f:</p> Property Description <code>yarn.scheduler.capacity.maximum-applications</code> / <code>yarn.scheduler.capacity.&lt;queue-path&gt;.maximum-applications</code> Integer\u3002\u7cfb\u7edf\u4e2d\u53ef\u4ee5\u540c\u65f6\u6d3b\u52a8\u3001\u8fd0\u884c\u548c\u6302\u8d77\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u6700\u5927\u6570\u91cf\u3002\u6bcf\u4e2a\u961f\u5217\u4e0a\u7684\u9650\u5236\u4e0e\u5b83\u4eec\u7684\u961f\u5217\u5bb9\u91cf\u548c\u7528\u6237\u9650\u5236\u6210\u6b63\u6bd4\u3002\u8fd9\u662f\u4e00\u4e2a\u786c\u9650\u5236\uff0c\u5f53\u8fbe\u5230\u8fd9\u4e2a\u9650\u5236\u65f6\u63d0\u4ea4\u7684\u4efb\u4f55\u7533\u8bf7\u90fd\u5c06\u88ab\u62d2\u7edd\u3002\u9ed8\u8ba4\u662f10000\u3002\u53ef\u4ee5\u8bbe\u7f6e\u6240\u6709\u961f\u5217\u6216\u5355\u4e2a\u961f\u5217\u3002 <code>yarn.scheduler.capacity.maximum-am-resource-percent</code> / <code>yarn.scheduler.capacity.&lt;queue-path&gt;.maximum-am-resource-percent</code> \u96c6\u7fa4\u4e2d\u53ef\u7528\u4e8e\u8fd0\u884cam\u7684\u6700\u5927\u8d44\u6e90\u767e\u5206\u6bd4\u2014\u63a7\u5236\u5e76\u53d1\u6d3b\u52a8\u5e94\u7528\u7a0b\u5e8f\u7684\u6570\u91cf\u3002\u6bcf\u4e2a\u961f\u5217\u4e0a\u7684\u9650\u5236\u4e0e\u5b83\u4eec\u7684\u961f\u5217\u5bb9\u91cf\u548c\u7528\u6237\u9650\u5236\u6210\u6b63\u6bd4\u3002\u6307\u5b9a\u4e3a\u6d6e\u70b9\u6570-\u53730.5 = 50%\u3002\u9ed8\u8ba4\u662f10%\u3002 Property Description <code>yarn.scheduler.capacity.&lt;queue-path&gt;.state</code> \u961f\u5217\u7684\u72b6\u6001\uff0c\u53ef\u4ee5\u662f <code>RUNNING</code> or <code>STOPPED</code>\u3002 \u5982\u679c\u4e00\u4e2a\u961f\u5217\u5904\u4e8e\u201c\u505c\u6b62\u201d\u72b6\u6001\uff0c\u65b0\u7684\u5e94\u7528\u7a0b\u5e8f\u4e0d\u80fd\u63d0\u4ea4\u5230\u201c\u81ea\u8eab\u201d\u6216\u201c\u5176\u5b50\u961f\u5217\u201d\u3002\u73b0\u6709\u7684\u5e94\u7528\u7a0b\u5e8f\u7ee7\u7eed\u5b8c\u6210\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f18\u96c5\u5730\u201c\u8017\u5c3d\u201d\u961f\u5217\u3002 <code>yarn.scheduler.capacity.root.&lt;queue-path&gt;.acl_submit_applications</code> ACL\uff0c\u7528\u4e8e\u63a7\u5236\u8c01\u53ef\u4ee5\u5411\u7ed9\u5b9a\u961f\u5217\u63d0\u4ea4\u5e94\u7528\u7a0b\u5e8f\u3002\u5982\u679c\u7ed9\u5b9a\u7528\u6237/\u7ec4\u5bf9\u7ed9\u5b9a\u961f\u5217\u6216\u5c42\u6b21\u7ed3\u6784\u4e2d\u7684\u4e00\u4e2a\u7236\u961f\u5217\u5177\u6709\u5fc5\u8981\u7684acl\uff0c\u5219\u53ef\u4ee5\u63d0\u4ea4\u5e94\u7528\u7a0b\u5e8f\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0c\u6b64\u5c5e\u6027\u7684acl\u5c06\u4ece\u7236\u961f\u5217\u7ee7\u627f\u3002 <code>yarn.scheduler.capacity.root.&lt;queue-path&gt;.acl_administer_queue</code> ACL\uff0c\u7528\u4e8e\u63a7\u5236\u8c01\u53ef\u4ee5\u7ba1\u7406\u7ed9\u5b9a\u961f\u5217\u4e0a\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u5982\u679c\u7ed9\u5b9a\u7528\u6237/\u7ec4\u5bf9\u7ed9\u5b9a\u961f\u5217\u6216\u5c42\u6b21\u7ed3\u6784\u4e2d\u7684\u7236\u961f\u5217\u5177\u6709\u5fc5\u8981\u7684acl\uff0c\u5219\u53ef\u4ee5\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0c\u6b64\u5c5e\u6027\u7684acl\u5c06\u4ece\u7236\u961f\u5217\u7ee7\u627f\u3002 <p>Note\uff1aACL\u7684\u5f62\u5f0f\u662fuser1,user2 space group1,group2\u3002\u901a\u914d\u7b26*\u8868\u793a\u4efb\u610f\u3002\u7a7a\u683c\u8868\u793a\u6ca1\u6709\u3002\u9ed8\u8ba4root queue\u662f*\u3002</p> Property Description <code>yarn.scheduler.capacity.queue-mappings</code> \u6307\u5b9a\u7528\u6237\u6216\u7ec4\u5230\u7279\u5b9a\u961f\u5217\u7684\u6620\u5c04\u3002\u5c06\u5355\u4e2a\u7528\u6237\u6216\u7528\u6237\u5217\u8868\u6620\u5c04\u5230\u961f\u5217\u3002\u8bed\u6cd5: <code>[u or g]:[name]:[queue_name][,next_mapping]*</code>\u3002u or g \u8868\u793a\u6620\u5c04\u662f\u9488\u5bf9\u7528\u6237\u8fd8\u662f\u9488\u5bf9\u7ec4\u3002name \u8868\u793a\u7528\u6237\u540d\u6216\u7ec4\u540d\u3002 \u8981\u6307\u5b9a\u63d0\u4ea4\u5e94\u7528\u7a0b\u5e8f\u7684\u7528\u6237\uff0c\u53ef\u4ee5\u4f7f\u7528 %user\u3002queue_name \u8868\u793a\u5e94\u7528\u7a0b\u5e8f\u5fc5\u987b\u4e3a\u5176\u6620\u5c04\u7684\u961f\u5217\u540d\u79f0\u3002\u82e5\u8981\u6307\u5b9a\u961f\u5217\u540d\u4e0e\u7528\u6237\u540d\u76f8\u540c\uff0c\u53ef\u4ee5\u4f7f\u7528%user\u3002\u82e5\u8981\u6307\u5b9a\u4e0e\u7528\u6237\u6240\u5c5e\u7684\u4e3b\u7ec4\u540d\u79f0\u76f8\u540c\u7684\u961f\u5217\u540d\u79f0\uff0c\u53ef\u4ee5\u4f7f\u7528%primary_group\u3002 <code>yarn.scheduler.queue-placement-rules.app-name</code> \u6307\u5b9aapplication_name\u5230\u7279\u5b9a\u961f\u5217\u7684\u6620\u5c04\u3002\u53ef\u4ee5\u5c06\u5355\u4e2a\u5e94\u7528\u7a0b\u5e8f\u6216\u5e94\u7528\u7a0b\u5e8f\u5217\u8868\u6620\u5c04\u5230\u961f\u5217\u3002\u8bed\u6cd5: <code>[app_name]:[queue_name][,next_mapping]*</code>. app_name \u8868\u793a\u8981\u8fdb\u884c\u6620\u5c04\u7684\u5e94\u7528\u7a0b\u5e8f\u540d\u79f0\u3002 queue_name \u8868\u793a\u5e94\u7528\u7a0b\u5e8f\u5fc5\u987b\u4e3a\u5176\u6620\u5c04\u7684\u961f\u5217\u540d\u79f0\u3002\u8981\u5c06\u5f53\u524d\u5e94\u7528\u7a0b\u5e8f\u7684\u540d\u79f0\u6307\u5b9a\u4e3aapp_name\uff0c\u53ef\u4ee5\u4f7f\u7528%application\u3002 <code>yarn.scheduler.capacity.queue-mappings-override.enable</code> \u6307\u5b9a\u662f\u5426\u53ef\u4ee5\u8986\u76d6\u7528\u6237\u6307\u5b9a\u7684\u961f\u5217\u3002\u8fd9\u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u9ed8\u8ba4\u503c\u4e3afalse\u3002 <p>\u793a\u4f8b\uff1a</p> <pre><code>&lt;property&gt;\n   &lt;name&gt;yarn.scheduler.capacity.queue-mappings&lt;/name&gt;\n   &lt;value&gt;u:user1:queue1,g:group1:queue2,u:%user:%user,u:user2:%primary_group&lt;/value&gt;\n   &lt;description&gt;\n     Here, &lt;user1&gt; is mapped to &lt;queue1&gt;, &lt;group1&gt; is mapped to &lt;queue2&gt;, \n     maps users to queues with the same name as user, &lt;user2&gt; is mapped \n     to queue name same as &lt;primary group&gt; respectively. The mappings will be \n     evaluated from left to right, and the first valid mapping will be used.\n   &lt;/description&gt;\n &lt;/property&gt;\n\n  &lt;property&gt;\n    &lt;name&gt;yarn.scheduler.queue-placement-rules.app-name&lt;/name&gt;\n    &lt;value&gt;appName1:queue1,%application:%application&lt;/value&gt;\n    &lt;description&gt;\n      Here, &lt;appName1&gt; is mapped to &lt;queue1&gt;, maps applications to queues with\n      the same name as application respectively. The mappings will be\n      evaluated from left to right, and the first valid mapping will be used.\n    &lt;/description&gt;\n  &lt;/property&gt;\n</code></pre> <p>\u539f\u7406\uff1a</p> <p><code>yarn.scheduler.queue-placement-rules</code>\u9ed8\u8ba4\u914d\u7f6e\u662f<code>user-group</code>\uff0c\u4f7f\u7528<code>UserGroupMappingPlacementRule</code>\uff0c\u6307\u5b9a\u7528\u6237\u63d0\u4ea4\u4f5c\u4e1a\u7684\u4f5c\u4e1a\u653e\u7f6e\u89c4\u5219\u3002</p> <p>\u5f53\u524d\u5185\u7f6e\u652f\u6301<code>user-group</code>\u548c<code>app-name</code>\uff0c\u4e5f\u652f\u6301\u81ea\u5b9a\u4e49\u7684\u7c7b\uff08\u5b9e\u73b0<code>PlacementRule</code>\uff09</p> Property Description <code>yarn.scheduler.capacity.&lt;queue-path&gt;.maximum-application-lifetime</code> \u63d0\u4ea4\u5230\u961f\u5217\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u6700\u5927\u751f\u5b58\u671f(\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002\u4efb\u4f55\u5c0f\u4e8e\u6216\u7b49\u4e8e0\u7684\u503c\u90fd\u88ab\u8ba4\u4e3a\u662f\u7981\u7528\u7684\u3002\u5982\u679c\u914d\u7f6e\u4e3a\u6b63\u503c\uff0c\u90a3\u4e48\u63d0\u4ea4\u5230\u6b64\u961f\u5217\u7684\u4efb\u4f55\u5e94\u7528\u7a0b\u5e8f\u90fd\u5c06\u5728\u8d85\u8fc7\u914d\u7f6e\u7684\u751f\u5b58\u671f\u540e\u7ec8\u6b62\u3002\u7528\u6237\u8fd8\u53ef\u4ee5\u5728\u5e94\u7528\u7a0b\u5e8f\u63d0\u4ea4\u4e0a\u4e0b\u6587\u4e2d\u6307\u5b9a\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u751f\u5b58\u671f\u3002\u4f46\u662f\u5982\u679c\u7528\u6237\u751f\u547d\u5468\u671f\u8d85\u8fc7\u961f\u5217\u6700\u5927\u751f\u547d\u5468\u671f\uff0c\u5219\u4f1a\u88ab\u8986\u76d6\u3002\u6ce8\u610f:\u914d\u7f6e\u8fc7\u4f4e\u7684\u503c\u4f1a\u5bfc\u81f4\u66f4\u5feb\u5730\u7ec8\u6b62\u5e94\u7528\u7a0b\u5e8f\u3002\u8be5\u7279\u6027\u4ec5\u9002\u7528\u4e8e\u53f6\u961f\u5217\u3002 <code>yarn.scheduler.capacity.root.&lt;queue-path&gt;.default-application-lifetime</code> \u63d0\u4ea4\u5230\u961f\u5217\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u9ed8\u8ba4\u751f\u5b58\u671f\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002\u4efb\u4f55\u5c0f\u4e8e\u6216\u7b49\u4e8e0\u7684\u503c\u90fd\u88ab\u8ba4\u4e3a\u662f\u7981\u7528\u7684\u3002\u5982\u679c\u7528\u6237\u6ca1\u6709\u63d0\u4ea4\u5177\u6709\u751f\u5b58\u671f\u503c\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u90a3\u4e48\u5c06\u53d6\u6b64\u503c\u3002\u6ce8\u610f:\u9ed8\u8ba4\u751f\u5b58\u671f\u4e0d\u80fd\u8d85\u8fc7\u6700\u5927\u751f\u5b58\u671f\u3002\u8be5\u7279\u6027\u4ec5\u9002\u7528\u4e8e\u53f6\u961f\u5217\u3002"},{"location":"scheduler_system/yarn/scheduler.html#_8","title":"\u8d44\u6e90\u5206\u914d","text":""},{"location":"scheduler_system/yarn/scheduler.html#runningpending","title":"Running\u548cPending\u7684\u5e94\u7528\u9650\u5236","text":""},{"location":"scheduler_system/yarn/scheduler.html#_9","title":"\u961f\u5217\u7ba1\u7406\u548c\u6743\u9650","text":""},{"location":"scheduler_system/yarn/scheduler.html#_10","title":"\u57fa\u4e8e\u7528\u6237\u6216\u7ec4\u3001\u5e94\u7528\u7a0b\u5e8f\u540d\u79f0\u6216\u7528\u6237\u5b9a\u4e49\u7684\u653e\u7f6e\u89c4\u5219\u7684\u961f\u5217\u6620\u5c04\u3002","text":""},{"location":"scheduler_system/yarn/scheduler.html#_11","title":"\u5e94\u7528\u7a0b\u5e8f\u7684\u961f\u5217\u751f\u5b58\u671f","text":""},{"location":"scheduler_system/yarn/scheduler.html#_12","title":"\u5e94\u7528\u4f18\u5148\u7ea7","text":"<p>\u5e94\u7528\u7a0b\u5e8f\u4f18\u5148\u7ea7\u53ea\u4e0eFIFO\u6392\u5e8f\u7b56\u7565\u4e00\u8d77\u5de5\u4f5c\u3002\u9ed8\u8ba4\u7684\u6392\u5e8f\u7b56\u7565\u662fFIFO\u3002</p> <p>\u5e94\u7528\u7a0b\u5e8f\u7684\u9ed8\u8ba4\u4f18\u5148\u7ea7\u53ef\u4ee5\u662f\u96c6\u7fa4\u7ea7\u548c\u961f\u5217\u7ea7\u3002\u5f53\u5e94\u7528\u7a0b\u5e8f\u79fb\u52a8\u5230\u4e0d\u540c\u961f\u5217\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u7684\u4f18\u5148\u7ea7\u4e0d\u4f1a\u6539\u53d8\u3002</p> Property Description <code>yarn.cluster.max-application-priority</code> \u5b9a\u4e49\u96c6\u7fa4\u4e2d\u7684\u6700\u5927\u5e94\u7528\u7a0b\u5e8f\u4f18\u5148\u7ea7\u3002 <code>yarn.scheduler.capacity.root.&lt;leaf-queue-path&gt;.default-application-priority</code> \u5b9a\u4e49\u53f6\u961f\u5217\u4e2d\u7684\u9ed8\u8ba4\u5e94\u7528\u7a0b\u5e8f\u4f18\u5148\u7ea7\u3002 <ul> <li>\u96c6\u7fa4\u7ea7\u4f18\u5148\u7ea7\uff1a\u4efb\u4f55\u4f18\u5148\u7ea7\u5927\u4e8e\u96c6\u7fa4\u6700\u5927\u4f18\u5148\u7ea7\u7684\u63d0\u4ea4\u5e94\u7528\u7a0b\u5e8f\u7684\u4f18\u5148\u7ea7\u5c06\u88ab\u91cd\u7f6e\u4e3a\u96c6\u7fa4\u6700\u5927\u4f18\u5148\u7ea7\u3002yarn-site.xml\u662f\u96c6\u7fa4\u6700\u5927\u4f18\u5148\u7ea7\u7684\u914d\u7f6e\u6587\u4ef6\u3002</li> <li>\u53f6\u961f\u5217\u7ea7\u4f18\u5148\u7ea7\uff1a\u6bcf\u4e2a\u53f6\u961f\u5217\u7531\u7ba1\u7406\u5458\u63d0\u4f9b\u9ed8\u8ba4\u4f18\u5148\u7ea7\u3002\u961f\u5217\u7684\u9ed8\u8ba4\u4f18\u5148\u7ea7\u5c06\u7528\u4e8e\u63d0\u4ea4\u7684\u4efb\u4f55\u6ca1\u6709\u6307\u5b9a\u4f18\u5148\u7ea7\u7684\u5e94\u7528\u7a0b\u5e8f\u3002capacity-scheduler.xml \u662f\u961f\u5217\u7ea7\u4f18\u5148\u7ea7\u7684\u914d\u7f6e\u6587\u4ef6\u3002</li> </ul>"},{"location":"scheduler_system/yarn/scheduler.html#_13","title":"\u5bb9\u91cf\u8c03\u5ea6\u7a0b\u5e8f\u5bb9\u5668\u62a2\u5360","text":"<p>\u5bb9\u91cf\u8c03\u5ea6\u5668\u652f\u6301\u4ece\u8d44\u6e90\u4f7f\u7528\u8d85\u8fc7\u5176\u4fdd\u8bc1\u5bb9\u91cf\u7684\u961f\u5217\u4e2d\u62a2\u5360\u5bb9\u5668\u3002yarn-site.xml \u914d\u7f6e\u3002</p> Property Description <code>yarn.resourcemanager.scheduler.monitor.enable</code> \u542f\u7528\u4e00\u7ec4\u5f71\u54cd\u8c03\u5ea6\u5668\u7684\u5b9a\u671f\u76d1\u89c6\u5668(\u5728yarn.resourcemanager.scheduler.monitor.policies\u4e2d\u6307\u5b9a)\u3002\u9ed8\u8ba4\u503c\u4e3afalse\u3002 <code>yarn.resourcemanager.scheduler.monitor.policies</code> \u4e0e\u8c03\u5ea6\u5668\u4ea4\u4e92\u7684SchedulingEditPolicy\u7c7b\u5217\u8868\u3002\u914d\u7f6e\u7684\u7b56\u7565\u9700\u8981\u4e0e\u8c03\u5ea6\u5668\u517c\u5bb9\u3002\u9ed8\u8ba4\u503c\u4e3a<code>org.apache.hadoop.yarn.server.resourcemanager.monitor.capacity.ProportionalCapacityPreemptionPolicy</code> Property Description <code>yarn.resourcemanager.monitor.capacity.preemption.observe_only</code> \u5982\u679c\u4e3a\u771f\uff0c\u8fd0\u884c\u7b56\u7565\uff0c\u4f46\u4e0d\u5f71\u54cd\u4f7f\u7528\u62a2\u5360\u548c\u6740\u6b7b\u4e8b\u4ef6\u7684\u96c6\u7fa4\u3002\u9ed8\u8ba4\u503c\u4e3afalse <code>yarn.resourcemanager.monitor.capacity.preemption.monitoring_interval</code> \u8c03\u7528\u8be5\u6bd4\u4f8b\u5bb9\u91cf\u62a2\u5360\u7b56\u7565\u4e4b\u95f4\u7684\u65f6\u95f4(\u6beb\u79d2)\u3002\u9ed8\u8ba4\u503c\u662f3000 <code>yarn.resourcemanager.monitor.capacity.preemption.max_wait_before_kill</code> \u4ece\u5e94\u7528\u7a0b\u5e8f\u8bf7\u6c42\u62a2\u5360\u5230\u7ec8\u6b62\u5bb9\u5668\u4e4b\u95f4\u7684\u65f6\u95f4(\u6beb\u79d2)\u3002\u9ed8\u8ba4\u503c\u662f15000 <code>yarn.resourcemanager.monitor.capacity.preemption.total_preemption_per_round</code> \u5355\u4e2a\u56de\u5408\u4e2d\u88ab\u62a2\u5360\u7684\u8d44\u6e90\u7684\u6700\u5927\u767e\u5206\u6bd4\u3002\u901a\u8fc7\u63a7\u5236\u8fd9\u4e2a\u503c\uff0c\u53ef\u4ee5\u63a7\u5236\u5bb9\u5668\u4ece\u96c6\u7fa4\u4e2d\u56de\u6536\u7684\u901f\u5ea6\u3002\u5728\u8ba1\u7b97\u6240\u9700\u7684\u603b\u4f18\u5148\u8d2d\u4e70\u91cf\u4e4b\u540e\uff0c\u7b56\u7565\u5c06\u5176\u4f38\u7f29\u56de\u8fd9\u4e2a\u9650\u5236\u5185\u3002\u9ed8\u8ba4\u503c\u4e3a0.1 <code>yarn.resourcemanager.monitor.capacity.preemption.max_ignored_over_capacity</code> \u62a2\u5360\u65f6\u8d85\u8fc7\u76ee\u6807\u5bb9\u91cf\u7684\u6700\u5927\u8d44\u6e90\u4f1a\u88ab\u5ffd\u7565\u3002\u8fd9\u5728\u76ee\u6807\u5bb9\u91cf\u5468\u56f4\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6b7b\u533a\uff0c\u5b83\u6709\u52a9\u4e8e\u9632\u6b62\u5728\u8ba1\u7b97\u7684\u76ee\u6807\u5e73\u8861\u5468\u56f4\u53d1\u751f\u98a0\u7c38\u548c\u632f\u8361\u3002\u8f83\u9ad8\u7684\u503c\u4f1a\u51cf\u6162\u5230\u5bb9\u91cf\u7684\u65f6\u95f4\uff0c\u5e76\u4e14\u5b83\u53ef\u80fd\u4f1a\u963b\u6b62\u6536\u655b\u5230\u4fdd\u8bc1\u7684\u5bb9\u91cf\u3002\u9ed8\u8ba4\u503c\u4e3a0.1 <code>yarn.resourcemanager.monitor.capacity.preemption.natural_termination_factor</code> \u7ed9\u5b9a\u4e00\u4e2a\u8ba1\u7b97\u7684\u62a2\u5360\u76ee\u6807\uff0c\u8003\u8651\u5bb9\u5668\u81ea\u7136\u8fc7\u671f\u5e76\u53ea\u62a2\u5360\u589e\u91cf\u7684\u8fd9\u4e2a\u767e\u5206\u6bd4\u3002\u8fd9\u51b3\u5b9a\u4e86\u51e0\u4f55\u6536\u655b\u5230\u6b7b\u533a(MAX_IGNORED_OVER_CAPACITY)\u7684\u901f\u5ea6\u3002\u4f8b\u5982\uff0c\u503c\u4e3a0.5\u65f6\uff0c\u57285 * #WAIT_TIME_BEFORE_KILL\u8303\u56f4\u5185\uff0c\u5373\u4f7f\u6ca1\u6709\u81ea\u7136\u7ec8\u6b62\uff0c\u4e5f\u4f1a\u56de\u6536\u5c06\u8fd195%\u7684\u8d44\u6e90\u3002\u9ed8\u8ba4\u503c\u662f0.2 <p>capacity-scheduler.xml\u914d\u7f6e</p> Property Description <code>yarn.scheduler.capacity.&lt;queue-path&gt;.disable_preemption</code> \u53ef\u4ee5\u5c06\u6b64\u914d\u7f6e\u8bbe\u7f6e\u4e3atrue\uff0c\u4ee5\u7981\u7528\u63d0\u4ea4\u5230\u7ed9\u5b9a\u961f\u5217\u7684\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u7684\u62a2\u5360\u3002\u5982\u679c\u672a\u4e3a\u961f\u5217\u8bbe\u7f6e\u6b64\u5c5e\u6027\uff0c\u5219\u8be5\u5c5e\u6027\u503c\u5c06\u4ece\u961f\u5217\u7684\u7236\u961f\u5217\u7ee7\u627f\u3002\u9ed8\u8ba4\u503c\u4e3afalse\u3002 <code>yarn.scheduler.capacity.&lt;queue-path&gt;.intra-queue-preemption.disable_preemption</code> \u6b64\u914d\u7f6e\u8bbe\u7f6e\u4e3atrue\uff0c\u4ee5\u7981\u7528\u63d0\u4ea4\u5230\u7ed9\u5b9a\u961f\u5217\u7684\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u7684\u961f\u5217\u5185\u62a2\u5360\u3002\u5982\u679c\u672a\u4e3a\u961f\u5217\u8bbe\u7f6e\u6b64\u5c5e\u6027\uff0c\u5219\u8be5\u5c5e\u6027\u503c\u5c06\u4ece\u961f\u5217\u7684\u7236\u961f\u5217\u7ee7\u627f\u3002\u9ed8\u8ba4\u503c\u4e3afalse\u3002 <ul> <li>\u4e0a\u9762\u4e24\u4e2a\u914d\u7f6e\u90fd\u9700\u8981 <code>monitor.enable</code>\u4e3atrue\uff0c\u4e14<code>monitor.policies</code>\u4e3a<code>ProportionalCapacityPreemptionPolicy</code>\u624d\u4f1a\u8d77\u4f5c\u7528\uff1b</li> <li><code>intra-queue-preemption.disable_preemption</code> \u8fd8\u9700\u8981 <code>yarn.resourcemanager.monitor.capacity.preemption.intra-queue-preemption.enabled</code> \u4e3a true\u65f6\uff0c\u624d\u4f1a\u8d77\u4f5c\u7528\u3002</li> </ul>"},{"location":"scheduler_system/yarn/scheduler.html#_14","title":"\u9884\u8ba2\u5c5e\u6027","text":"<p>\u63a7\u5236\u9884\u8ba2\u7684\u521b\u5efa\u3001\u5220\u9664\u3001\u66f4\u65b0\u548c\u5217\u8868\u3002\u6ce8\u610f\uff0c\u4efb\u4f55\u7528\u6237\u90fd\u53ef\u4ee5\u66f4\u65b0\u3001\u5220\u9664\u6216\u5217\u51fa\u4ed6\u4eec\u81ea\u5df1\u7684\u9884\u8ba2\u3002\u5982\u679c\u542f\u7528\u4e86\u9884\u8ba2acl\u4f46\u6ca1\u6709\u5b9a\u4e49\uff0c\u90a3\u4e48\u6bcf\u4e2a\u4eba\u90fd\u53ef\u4ee5\u8bbf\u95ee\u3002</p> Property Description <code>yarn.scheduler.capacity.root.&lt;queue&gt;.acl_administer_reservations</code> ACL\u63a7\u5236\u8c01\u53ef\u4ee5\u7ba1\u7406\u7ed9\u5b9a\u961f\u5217\u7684\u9884\u8ba2\u3002\u5982\u679c\u7ed9\u5b9a\u7528\u6237/\u7ec4\u5728\u7ed9\u5b9a\u961f\u5217\u4e0a\u6709\u5fc5\u8981\u7684acl\uff0c\u4ed6\u4eec\u53ef\u4ee5\u63d0\u4ea4\u3001\u5220\u9664\u3001\u66f4\u65b0\u548c\u5217\u51fa\u6240\u6709\u9884\u8ba2\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0c\u6b64\u5c5e\u6027\u7684acl\u4e0d\u4f1a\u4ece\u7236\u961f\u5217\u7ee7\u627f\u3002 <code>yarn.scheduler.capacity.root.&lt;queue&gt;.acl_list_reservations</code> ACL\u7528\u4e8e\u63a7\u5236\u8c01\u53ef\u4ee5<code>list</code>\u9884\u8ba2\u5230\u7ed9\u5b9a\u961f\u5217\u3002\u5982\u679c\u7ed9\u5b9a\u7528\u6237/\u7ec4\u5728\u7ed9\u5b9a\u961f\u5217\u4e0a\u6709\u5fc5\u8981\u7684acl\uff0c\u5219\u53ef\u4ee5\u5217\u51fa\u6240\u6709\u5e94\u7528\u7a0b\u5e8f\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0c\u5219\u4e0d\u4f1a\u4ece\u7236\u961f\u5217\u7ee7\u627f\u6b64\u5c5e\u6027\u7684acl\u3002 <code>yarn.scheduler.capacity.root.&lt;queue&gt;.acl_submit_reservations</code> ACL\uff0c\u7528\u4e8e\u63a7\u5236\u8c01\u53ef\u4ee5\u5411\u7ed9\u5b9a\u961f\u5217\u63d0\u4ea4\u9884\u8ba2\u3002\u5982\u679c\u7ed9\u5b9a\u7528\u6237/\u7ec4\u5728\u7ed9\u5b9a\u961f\u5217\u4e0a\u6709\u5fc5\u8981\u7684acl\uff0c\u5219\u53ef\u4ee5\u63d0\u4ea4\u9884\u8ba2\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0c\u5219\u4e0d\u4f1a\u4ece\u7236\u961f\u5217\u7ee7\u627f\u6b64\u5c5e\u6027\u7684acl\u3002"},{"location":"scheduler_system/yarn/scheduler.html#_15","title":"\u5bb9\u91cf\u8c03\u5ea6\u5668\u914d\u7f6e\u9884\u7559\u7cfb\u7edf","text":"<p>\u5bb9\u91cf\u8c03\u5ea6\u5668\u652f\u6301\u9884\u7559\u7cfb\u7edf\uff0c\u5141\u8bb8\u7528\u6237\u63d0\u524d\u9884\u7559\u8d44\u6e90\u3002\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u901a\u8fc7\u5728\u63d0\u4ea4\u671f\u95f4\u6307\u5b9areservationId\u6765\u8bf7\u6c42\u4fdd\u7559\u7684\u8d44\u6e90\u3002\u53ef\u4ee5\u5728yarn-site.xml\u4e2d\u914d\u7f6eReservationSystem\u7684\u53c2\u6570\u3002</p> roperty Description <code>yarn.resourcemanager.reservation-system.enable</code> \u9ed8\u8ba4false\uff0c\u4e0d\u542f\u7528 <code>yarn.resourcemanager.reservation-system.class</code> <code>ReservationSystem</code>\u7684\u7c7b\u540d\uff0c<code>CapacityScheduler</code>\u8c03\u5ea6\u5668\u5219\u662f<code>CapacityReservationSystem</code> <code>yarn.resourcemanager.reservation-system.plan.follower</code> \u5728\u5b9a\u65f6\u5668\u4e0a\u8fd0\u884c\u7684PlanFollower\u7684\u7c7b\u540d\uff0c\u5b83\u5c06<code>Plan</code>\u548c\u5bb9\u91cf\u8c03\u5ea6\u5668\u540c\u6b65\u3002<code>CapacityScheduler</code>\u8c03\u5ea6\u5668\u5219\u662f<code>CapacitySchedulerPlanFollower</code> <code>yarn.resourcemanager.reservation-system.planfollower.time-step</code> \u9ed8\u8ba41000\uff0c<code>PlanFollower</code>\u5b9a\u65f6\u7684\u9891\u7387\uff0c\u6beb\u79d2 <p>ReservationSystem\u53ef\u4ee5\u4e3a\u4efb\u4f55Leaf Queue\u914d\u7f6e\uff0c\u652f\u6301\u4ee5\u4e0b\u53c2\u6570</p> Property Description <code>yarn.scheduler.capacity.&lt;queue-path&gt;.reservable</code> \u9ed8\u8ba4\u503c\u4e3afalse\uff0c\u5373\u9ed8\u8ba4\u60c5\u51b5\u4e0bLeafQueues\u4e2d\u4e0d\u542f\u7528\u9884\u8ba2\u3002 <code>yarn.scheduler.capacity.&lt;queue-path&gt;.reservation-agent</code> ReservationAgent\u7684\u5b9e\u73b0\u7684\u7c7b\u540d\uff0c\u5c1d\u8bd5\u5c06\u7528\u6237\u7684\u9884\u8ba2\u8bf7\u6c42\u653e\u5165<code>Plan</code>\u4e2d\uff0c\u9ed8\u8ba4org.apache.hadoop.yarn.server.resourcemanager.reservation.planning.AlignedPlannerWithGreedy <code>yarn.scheduler.capacity.&lt;queue-path&gt;.reservation-move-on-expiry</code> \u5f53\u76f8\u5173\u7684\u9884\u7ea6\u5230\u671f\u65f6\uff0c\u662f\u5426\u5e94\u8be5\u5c06\u5e94\u7528\u7a0b\u5e8f\u79fb\u52a8\u6216\u7ec8\u6b62\u5230\u7236\u53ef\u9884\u7ea6\u961f\u5217\u3002\u9ed8\u8ba4\u503c\u4e3atrue\uff0c\u8868\u793a\u5e94\u7528\u7a0b\u5e8f\u5c06\u79fb\u52a8\u5230\u53ef\u4fdd\u7559\u961f\u5217\u3002 <code>yarn.scheduler.capacity.&lt;queue-path&gt;.show-reservations-as-queues</code> \u9ed8\u8ba4\u503c\u4e3afalse\uff0c\u5373\u5728\u8c03\u5ea6\u5668UI\u4e2d\u663e\u793a\u6216\u9690\u85cf\u9884\u8ba2\u961f\u5217 <code>yarn.scheduler.capacity.&lt;queue-path&gt;.reservation-policy</code> \u786e\u5b9aSharingPolicy\u5b9e\u73b0\u7684\u7c7b\u540d\uff0c\u5982\u679c\u65b0\u7684\u4fdd\u7559\u6ca1\u6709\u8fdd\u53cd\u4efb\u4f55\u4e0d\u53d8\u91cf\uff0c\u8be5\u7b56\u7565\u5c06\u9a8c\u8bc1\u3002\u9ed8\u8ba4org.apache.hadoop.yarn.server.resourcemanager.reservation.CapacityOverTimePolicy <code>yarn.scheduler.capacity.&lt;queue-path&gt;.reservation-window</code> \u9ed8\u8ba4\u503c\u662f\u4e00\u5929\u3002\u8868\u793a\u5982\u679c\u6ee1\u8db3\u8ba1\u5212\u4e2d\u7684\u7ea6\u675f\uff0c\u5171\u4eab\u7b56\u7565\u5c06\u9a8c\u8bc1\u7684\u6beb\u79d2\u65f6\u95f4\u3002 <code>yarn.scheduler.capacity.&lt;queue-path&gt;.instantaneous-max-capacity</code> \u4ee5\u767e\u5206\u6bd4(%)\u8868\u793a\u5171\u4eab\u7b56\u7565\u5141\u8bb8\u5355\u4e2a\u7528\u6237\u4fdd\u7559\u7684\u6700\u5927\u5bb9\u91cf\u3002\u9ed8\u8ba4\u503c\u4e3a1\uff0c\u5373100%\u3002 <code>yarn.scheduler.capacity.&lt;queue-path&gt;.average-capacity</code> \u5728ReservationWindow\u4e0a\u4ee5\u767e\u5206\u6bd4(%)\u805a\u5408\u7684\u5141\u8bb8\u5355\u4e2a\u7528\u6237\u4fdd\u7559\u7684\u5e73\u5747\u5bb9\u91cf\u3002\u9ed8\u8ba4\u503c\u4e3a1\uff0c\u5373100%\u3002 <code>yarn.scheduler.capacity.&lt;queue-path&gt;.reservation-planner</code> \u786e\u5b9a\u8ba1\u5212\u5668\u5b9e\u73b0\u7684\u7c7b\u540d\uff0c\u5982\u679c\u8ba1\u5212\u5bb9\u91cf\u4f4e\u4e8e\u7528\u6237\u4fdd\u7559\u8d44\u6e90(\u7531\u4e8e\u8ba1\u5212\u7ef4\u62a4\u6216\u8282\u70b9\u6545\u969c)\uff0c\u5c06\u8c03\u7528\u8be5\u5b9e\u73b0\u3002org.apache.hadoop.yarn.server.resourcemanager.reservation.planning.SimpleCapacityReplanner\u626b\u63cf\u8ba1\u5212\uff0c\u5e76\u4ee5\u9006\u5411\u63a5\u53d7\u987a\u5e8f(LIFO)\u8d2a\u5a6a\u5730\u5220\u9664\u4fdd\u7559/\u9884\u5b9a\uff0c\u76f4\u5230\u4fdd\u7559\u7684\u8d44\u6e90\u5728\u8ba1\u5212\u7684\u80fd\u529b\u4e4b\u5185 <code>yarn.scheduler.capacity.&lt;queue-path&gt;.reservation-enforcement-window</code> \u8868\u793a\u5982\u679c\u6ee1\u8db3\u8ba1\u5212\u4e2d\u7684\u7ea6\u675f\uff0c\u8ba1\u5212\u8005\u5c06\u9a8c\u8bc1\u7684\u6beb\u79d2\u65f6\u95f4\u3002\u9ed8\u8ba4\u503c\u662f1\u5c0f\u65f6\u3002"},{"location":"scheduler_system/yarn/scheduler.html#leafqueue","title":"\u52a8\u6001\u521b\u5efa\u548c\u7ba1\u7406LeafQueue","text":"<p>CapacityScheduler\u652f\u6301\u5728\u7236\u961f\u5217\u4e0b\u81ea\u52a8\u521b\u5efa\u53f6\u961f\u5217\uff0c\u7236\u961f\u5217\u5df2\u914d\u7f6e\u4e3a\u652f\u6301\u6b64\u7279\u6027\u3002</p> <ul> <li>\u901a\u8fc7\u961f\u5217\u6620\u5c04\u8bbe\u7f6e\u52a8\u6001\u81ea\u52a8\u521b\u5efa\u7684\u53f6\u961f\u5217</li> </ul> <p><code>yarn.scheduler.capacity.queue-mappings</code>\u4e2d\u7684user-group queue mapping(s) \u9700\u8981\u6307\u5b9a\u4e00\u4e2a\u989d\u5916\u7684\u7236\u961f\u5217\u53c2\u6570\uff0c\u4ee5\u6807\u8bc6\u9700\u8981\u5728\u54ea\u4e2a\u7236\u961f\u5217\u4e0b\u521b\u5efa\u81ea\u52a8\u521b\u5efa\u7684\u53f6\u961f\u5217\u3002</p> <p>\u793a\u4f8b\uff1a\u6ce8\u610f<code>u:%user:parent1.%user</code>\u8fd9\u79cd\u5199\u6cd5</p> <pre><code> &lt;property&gt;\n   &lt;name&gt;yarn.scheduler.capacity.queue-mappings&lt;/name&gt;\n   &lt;value&gt;u:user1:queue1,u:user2:%primary_group,u:%user:parent1.%user&lt;/value&gt;\n   &lt;description&gt;\n     Here, u:%user:parent1.%user mapping allows any &lt;user&gt; other than user1,\n     user2 to be mapped to its own user specific leaf queue which\n     will be auto-created under &lt;parent1&gt;.\n   &lt;/description&gt;\n &lt;/property&gt;\n</code></pre> <ul> <li>\u7528\u4e8e\u52a8\u6001\u53f6\u961f\u5217\u81ea\u52a8\u521b\u5efa\u548c\u7ba1\u7406\u7684\u7236\u961f\u5217\u914d\u7f6e</li> </ul> Property Description <code>yarn.scheduler.capacity.&lt;queue-path&gt;.auto-create-child-queue.enabled</code> \u4e3a\u6307\u5b9a\u7684\u7236\u961f\u5217\u542f\u7528\u81ea\u52a8\u53f6\u961f\u5217\u521b\u5efa\uff0c\u9ed8\u8ba4false\uff0c\u5373\u592b\u961f\u5217\u4e0d\u4f1a\u81ea\u52a8\u521b\u5efa\u5b50\u961f\u5217\u3002 <code>yarn.scheduler.capacity.&lt;queue-path&gt;.auto-create-child-queue.management-policy</code> \u786e\u5b9a\u201cAutoCreatedQueueManagementPolicy\u201d\u7684\u5b9e\u73b0\uff0c\u5c06\u52a8\u6001\u7ba1\u7406\u7236\u961f\u5217\u4e0b\u7684\u53f6\u961f\u5217\u53ca\u5176\u5bb9\u91cf\u3002\u9ed8\u8ba4\u662forg.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.queuemanagement.GuaranteedOrZeroCapacityOverTimePolicy\uff0c\u7528\u6237\u6216\u7ec4\u53ef\u80fd\u5728\u6709\u9650\u7684\u65f6\u95f4\u5185\u5411\u81ea\u52a8\u521b\u5efa\u7684\u53f6\u961f\u5217\u63d0\u4ea4\u5e94\u7528\u7a0b\u5e8f\u5e76\u505c\u6b62\u4f7f\u7528\u5b83\u4eec\u3002\u56e0\u6b64\uff0c\u5728\u7236\u961f\u5217\u4e0b\u81ea\u52a8\u521b\u5efa\u7684\u53f6\u961f\u5217\u6570\u91cf\u53ef\u80fd\u8d85\u8fc7\u5176\u4fdd\u8bc1\u7684\u5bb9\u91cf\u3002\u5f53\u524d\u7b56\u7565\u5b9e\u73b0\u6839\u636e\u7236\u961f\u5217\u4e0a\u7684\u5bb9\u91cf\u53ef\u7528\u6027\u548c\u8de8\u53f6\u961f\u5217\u7684\u5e94\u7528\u7a0b\u5e8f\u63d0\u4ea4\u987a\u5e8f\u6309\u6700\u4f73\u52aa\u529b\u5206\u914d\u5df2\u914d\u7f6e\u6216\u96f6\u5bb9\u91cf\u3002 <ul> <li>\u4f7f\u7528CapacityScheduler\u914d\u7f6e\u81ea\u52a8\u521b\u5efa\u7684\u53f6\u961f\u5217</li> </ul> <p>\u652f\u6301\u4e3a\u81ea\u52a8\u521b\u5efa\u53f6\u961f\u5217\u7684\u81ea\u52a8\u914d\u7f6e\u914d\u7f6e\u6a21\u677f\u53c2\u6570\u3002\u81ea\u52a8\u521b\u5efa\u7684\u961f\u5217\u652f\u6301\u9664\u961f\u5217ACL\u3001\u7edd\u5bf9\u8d44\u6e90\u914d\u7f6e\u4e4b\u5916\u7684\u6240\u6709\u53f6\u961f\u5217\u914d\u7f6e\u53c2\u6570\u3002\u5f53\u524d\u4ece\u7236\u961f\u5217i\u7ee7\u627f\u961f\u5217acl\u3002</p> Property Description <code>yarn.scheduler.capacity.&lt;queue-path&gt;.leaf-queue-template.capacity</code> \u6307\u5b9a\u81ea\u52a8\u521b\u5efa\u7684\u53f6\u961f\u5217\u7684\u6700\u5c0f\u4fdd\u8bc1\u5bb9\u91cf\u3002\u76ee\u524d\uff0c\u81ea\u52a8\u521b\u5efa\u7684\u53f6\u961f\u5217\u4e0d\u652f\u6301\u7edd\u5bf9\u8d44\u6e90\u914d\u7f6e <code>yarn.scheduler.capacity.&lt;queue-path&gt;.leaf-queue-template.&lt;leaf-queue-property&gt;</code> \u53ef\u4ee5\u5728\u81ea\u52a8\u521b\u5efa\u7684\u53f6\u961f\u5217\u4e0a\u914d\u7f6e\u7684\u5176\u4ed6\u961f\u5217\u53c2\u6570\uff0c\u5982\u6700\u5927\u5bb9\u91cf\u3001\u7528\u6237\u9650\u5236\u56e0\u5b50\u3001\u6700\u5927\u8d44\u6e90\u767e\u5206\u6bd4\u7b49\u3002 <p>\u793a\u4f8b\uff1a</p> <pre><code>&lt;property&gt;\n   &lt;name&gt;yarn.scheduler.capacity.root.parent1.auto-create-child-queue.enabled&lt;/name&gt;\n   &lt;value&gt;true&lt;/value&gt;\n &lt;/property&gt;\n &lt;property&gt;\n    &lt;name&gt;yarn.scheduler.capacity.root.parent1.leaf-queue-template.capacity&lt;/name&gt;\n    &lt;value&gt;5&lt;/value&gt;\n &lt;/property&gt;\n &lt;property&gt;\n    &lt;name&gt;yarn.scheduler.capacity.root.parent1.leaf-queue-template.maximum-capacity&lt;/name&gt;\n    &lt;value&gt;100&lt;/value&gt;\n &lt;/property&gt;\n &lt;property&gt;\n    &lt;name&gt;yarn.scheduler.capacity.root.parent1.leaf-queue-template.user-limit-factor&lt;/name&gt;\n    &lt;value&gt;3.0&lt;/value&gt;\n &lt;/property&gt;\n &lt;property&gt;\n    &lt;name&gt;yarn.scheduler.capacity.root.parent1.leaf-queue-template.ordering-policy&lt;/name&gt;\n    &lt;value&gt;fair&lt;/value&gt;\n &lt;/property&gt;\n &lt;property&gt;\n    &lt;name&gt;yarn.scheduler.capacity.root.parent1.GPU.capacity&lt;/name&gt;\n    &lt;value&gt;50&lt;/value&gt;\n &lt;/property&gt;\n &lt;property&gt;\n     &lt;name&gt;yarn.scheduler.capacity.root.parent1.accessible-node-labels&lt;/name&gt;\n     &lt;value&gt;GPU,SSD&lt;/value&gt;\n   &lt;/property&gt;\n &lt;property&gt;\n     &lt;name&gt;yarn.scheduler.capacity.root.parent1.leaf-queue-template.accessible-node-labels&lt;/name&gt;\n     &lt;value&gt;GPU&lt;/value&gt;\n  &lt;/property&gt;\n &lt;property&gt;\n    &lt;name&gt;yarn.scheduler.capacity.root.parent1.leaf-queue-template.accessible-node-labels.GPU.capacity&lt;/name&gt;\n    &lt;value&gt;5&lt;/value&gt;\n &lt;/property&gt;\n</code></pre> <ul> <li>\u4e3a\u81ea\u52a8\u521b\u5efa\u7684\u961f\u5217\u7ba1\u7406\u8c03\u5ea6\u7f16\u8f91\u7b56\u7565\u914d\u7f6e</li> </ul> <p>\u7ba1\u7406\u5458\u9700\u8981\u5728<code>yarn.resourcemanager.scheduler.monitor.policies</code>\u4e2d\u4ee5\u9017\u53f7\u5206\u9694\u7684\u5b57\u7b26\u4e32\u5f62\u5f0f\u5411\u5f53\u524d\u8c03\u5ea6\u7f16\u8f91\u7b56\u7565\u5217\u8868\u6307\u5b9a\u989d\u5916\u7684<code>org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.QueueManagementDynamicEditPolicy</code>\u8c03\u5ea6\u7f16\u8f91\u7b56\u7565\u3002</p> Property Description <code>yarn.resourcemanager.monitor.capacity.queue-management.monitoring-interval</code> <code>QueueManagementDynamicEditPolicy</code>\u7b56\u7565\u8c03\u7528\u4e4b\u95f4\u7684\u65f6\u95f4(\u6beb\u79d2)\u3002\u9ed8\u8ba4\u503c\u662f1500"},{"location":"scheduler_system/yarn/scheduler.html#_16","title":"\u5176\u5b83\u5c5e\u6027","text":"<ul> <li>\u8d44\u6e90\u8ba1\u7b97\u5668</li> </ul> Property Description <code>yarn.scheduler.capacity.resource-calculator</code> \u9ed8\u8ba4\u662f<code>org.apache.hadoop.yarn.util.resource.DefaultResourceCalculator</code> \uff0c\u4ec5\u4f7f\u7528\u5185\u5b58\u3002<code>DominantResourceCalculator</code> \u4f7f\u7528\u652f\u914d\u8d44\u6e90\u6bd4\u8f83\u591a\u7ef4\u8d44\u6e90\uff0c\u5982\u5185\u5b58\uff0cCPU\u7b49\u3002 <ul> <li>\u6570\u636e\u672c\u5730\u6027</li> </ul> Property Description <code>yarn.scheduler.capacity.node-locality-delay</code> \u5bb9\u91cf\u8c03\u5ea6\u5668\u5c1d\u8bd5\u8c03\u5ea6\u673a\u67b6\u672c\u5730\u5bb9\u5668\u800c\u9519\u8fc7\u7684\u8c03\u5ea6\u673a\u4f1a\u7684\u6570\u91cf\u3002\u901a\u5e38\uff0c\u8fd9\u5e94\u8be5\u8bbe\u7f6e\u4e3a\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u6570\u3002\u9ed8\u8ba4-1\uff0c\u7981\u7528\u6570\u636e\u672c\u5730\u6027\u7279\u6027\u3002 <code>yarn.scheduler.capacity.rack-locality-additional-delay</code> 3.x\u7248\u672c\u3002\u8d85\u8fc7<code>node-locality-delay</code>\u7684\u989d\u5916\u9519\u8fc7\u8c03\u5ea6\u673a\u4f1a\u7684\u6570\u91cf\uff0c\u5728\u6b64\u4e4b\u540e\uff0c\u5bb9\u91cf\u8c03\u5ea6\u5668\u5c1d\u8bd5\u8c03\u5ea6off-switch\u5bb9\u5668\u3002\u9ed8\u8ba4-1\uff0c\u6b64\u65f6\u8ba1\u7b97\u516c\u5f0f\u4e3aL*C/N\uff0cL\u662f\u8282\u70b9\u6570\u6216\u673a\u67b6\u6570\uff0cC\u662f\u8bf7\u6c42\u5bb9\u5668\u6570\uff0cN\u662f\u96c6\u7fa4\u7684\u89c4\u6a21\u3002 <p>Note\uff1a\u5c06YARN\u4e0e\u6587\u4ef6\u7cfb\u7edf\u5206\u5f00\u90e8\u7f72\uff0c\u5e94\u8be5\u7981\u7528\u8be5\u7279\u6027\u3002</p> <ul> <li>\u6bcf\u4e2aNodeManager\u5fc3\u8df3\u7684\u5bb9\u5668\u5206\u914d</li> </ul> Property Description <code>yarn.scheduler.capacity.per-node-heartbeat.multiple-assignments-enabled</code> \u662f\u5426\u5141\u8bb8\u5728\u4e00\u4e2aNodeManager\u5fc3\u8df3\u4e2d\u5206\u914d\u591a\u4e2a\u5bb9\u5668\u3002\u9ed8\u8ba4\u503c\u4e3atrue\u3002 <code>yarn.scheduler.capacity.per-node-heartbeat.maximum-container-assignments</code> \u5982\u679c<code>multiple-assignments-enabled</code>\u4e3atrue\uff0c\u8868\u793a\u5728\u4e00\u4e2aNodeManager\u5fc3\u8df3\u4e2d\u53ef\u4ee5\u5206\u914d\u7684\u5bb9\u5668\u7684\u6700\u5927\u6570\u91cf\u3002\u9ed8\u8ba4\u503c\u4e3a100\uff0c\u5b83\u5c06\u6bcf\u4e2a\u5fc3\u8df3\u5206\u914d\u7684\u5bb9\u5668\u7684\u6700\u5927\u6570\u91cf\u9650\u5236\u4e3a100\u3002\u5c06\u6b64\u503c\u8bbe\u7f6e\u4e3a-1\u5c06\u7981\u7528\u6b64\u9650\u5236\u3002 <code>yarn.scheduler.capacity.per-node-heartbeat.maximum-offswitch-assignments</code> \u5982\u679c<code>multiple-assignments-enabled</code>\u4e3atrue\uff0c\u8868\u793a\u5728\u4e00\u4e2aNodeManager\u5fc3\u8df3\u4e2d\u53ef\u4ee5\u5206\u914d\u7684off-switch\u5bb9\u5668\u7684\u6700\u5927\u6570\u91cf\u3002\u9ed8\u8ba4\u503c\u4e3a1\uff0c\u8868\u793a\u5728\u4e00\u4e2a\u5fc3\u8df3\u4e2d\u53ea\u5141\u8bb8\u4e00\u4e2aoff-switch\u5206\u914d\u3002"},{"location":"scheduler_system/yarn/scheduler.html#_17","title":"\u961f\u5217\u914d\u7f6e\u53d8\u66f4","text":"<p>\u66f4\u6539\u961f\u5217/\u8c03\u5ea6\u5668\u5c5e\u6027\u548c\u6dfb\u52a0/\u5220\u9664\u961f\u5217\u53ef\u4ee5\u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u5b8c\u6210\uff0c\u901a\u8fc7\u6587\u4ef6\u6216\u901a\u8fc7API\u3002</p> <p><code>yarn.scheduler.configuration.store.class</code></p> <ul> <li><code>file</code>\uff1a\u901a\u8fc7\u6587\u4ef6\uff0c\u9ed8\u8ba4\u3002</li> <li><code>memory</code>\uff1a\u901a\u8fc7API\uff0c\u4f46\u662f\u91cd\u542f\u65f6\u4e0d\u4f1a\u6301\u4e45\u5316\u6539\u52a8\u3002</li> <li><code>leveldb</code>\uff1a\u901a\u8fc7API\uff0c\u5e76\u6301\u4e45\u5316\u6539\u52a8\u5230leveldb\u3002</li> <li><code>zk</code>\uff1a\u901a\u8fc7API\uff0c\u5e76\u6301\u4e45\u5316\u6539\u52a8\u5230zookeeper\u3002</li> </ul>"},{"location":"scheduler_system/yarn/scheduler.html#_18","title":"\u901a\u8fc7\u6587\u4ef6\u53d8\u66f4","text":"<p>\u624b\u52a8\u66f4\u6539conf/capacity-scheduler.xml\uff0c\u5e76\u8fd0\u884c <code>yarn rmadmin -refreshQueues</code>\u3002</p> <p>\u5982\u679c\u901a\u8fc7\u6587\u4ef6\u5220\u9664\u961f\u5217\uff0c\u9700\u8981</p> <p>1\uff09\u5148\u505c\u6b62\u961f\u5217\uff1a\u961f\u5217\u72b6\u6001\u9700\u8981\u6539\u53d8\u4e3a<code>STOPPED</code>\uff0c\u5220\u9664\u7236\u961f\u5217\u524d\uff0c\u6240\u6709\u5176\u5b50\u961f\u5217\u5fc5\u987b\u4e3a<code>STOPPED</code>\uff1b</p> <p>2\uff09\u518d\u5220\u9664\u961f\u5217\uff1a\u5c06\u961f\u5217\u914d\u7f6e\u4ece\u6587\u4ef6\u4e2d\u79fb\u9664\uff1b</p>"},{"location":"scheduler_system/yarn/scheduler.html#api","title":"\u901a\u8fc7API\u53d8\u66f4","text":"<p>Note\uff1aalpha\u7248\u672c\uff0c\u540e\u7eed\u53ef\u80fd\u4f1a\u53d8\u66f4\u3002yarn-site.xml \u4e2d\u914d\u7f6e\u4ee5\u4e0b\u53c2\u6570</p> Property Description <code>yarn.scheduler.configuration.store.class</code> backing store\u7684\u7c7b\u578b <code>yarn.scheduler.configuration.mutation.acl-policy.class</code> \u914d\u7f6eACL\u7b56\u7565\u6765\u9650\u5236\u54ea\u4e9b\u7528\u6237\u53ef\u4ee5\u4fee\u6539\u54ea\u4e9b\u961f\u5217\u3002\u9ed8\u8ba4\u662forg.apache.hadoop.yarn.server.resourcemanager.scheduler.DefaultConfigurationMutationACLPolicy\uff0c\u53ea\u5141\u8bb8yarn\u7ba1\u7406\u5458\u53d8\u66f4\u914d\u7f6e\u3002\u53ef\u9009org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.conf.QueueAdminConfigurationMutationACLPolicy\uff0c\u5141\u8bb8\u961f\u5217\u7ba1\u7406\u5458\u53d8\u66f4\u8be5\u961f\u5217\u914d\u7f6e\u3002 <code>yarn.scheduler.configuration.store.max-logs</code> \u5982\u679c\u4f7f\u7528leveldb\u6216zookeeper\uff0c\u914d\u7f6e\u66f4\u6539\u4f1a\u5728\u5907\u4efd\u5b58\u50a8\u4e2d\u88ab\u5ba1\u6838\u8bb0\u5f55\u3002\u6b64\u914d\u7f6e\u63a7\u5236\u8981\u5b58\u50a8\u7684\u5ba1\u8ba1\u65e5\u5fd7\u7684\u6700\u5927\u6570\u91cf\uff0c\u8d85\u8fc7\u6700\u5927\u6570\u91cf\u65f6\u5c06\u5220\u9664\u6700\u8001\u7684\u65e5\u5fd7\u3002\u9ed8\u8ba4\u662f1000\u3002 <code>yarn.scheduler.configuration.leveldb-store.path</code> \u4f7f\u7528leveldb\u65f6\u914d\u7f6e\u7684\u5b58\u50a8\u8def\u5f84\u3002\u9ed8\u8ba4\u503c\u662f${hadoop.tmp.dir}/yarn/system/confstore\u3002 <code>yarn.scheduler.configuration.leveldb-store.compaction-interval-secs</code> \u5f53\u4f7f\u7528leveldb\u65f6\uff0c\u538b\u7f29\u914d\u7f6e\u7684\u65f6\u95f4\u95f4\u9694\u4ee5\u79d2\u4e3a\u5355\u4f4d\u5b58\u50a8\u3002\u9ed8\u8ba4\u503c\u662f86400\uff0c\u6216\u8005\u4e00\u5929\u3002 <code>yarn.scheduler.configuration.zk-store.parent-path</code> \u4f7f\u7528zookeeper\u65f6\uff0c\u914d\u7f6e\u7684zookeeper\u6839\u8282\u70b9\u8def\u5f84\u5b58\u50a8\u76f8\u5173\u4fe1\u606f\u3002\u9ed8\u8ba4\u503c\u4e3a/confstore\u3002 <p>\u901a\u8fc7 <code>yarn schedulerconf</code>\u547d\u4ee4\u884c\u8fdb\u884c\u961f\u5217\u914d\u7f6e\u4fee\u6539\uff0c\u6216\u901a\u8fc7<code>http://rm-http-address:port/ws/v1/cluster/scheduler-conf</code>\u7684REST API\u3002</p>"},{"location":"scheduler_system/yarn/scheduler.html#containerexperimental","title":"Container\u66f4\u65b0(Experimental)","text":"<p>\u4e00\u65e6AM\u4eceRM\u63a5\u6536\u5230\u5bb9\u5668\uff0c\u5b83\u53ef\u4ee5\u8bf7\u6c42RM\u66f4\u65b0\u5bb9\u5668\u7684\u67d0\u4e9b\u5c5e\u6027\u3002</p> <p>\u76ee\u524d\u53ea\u652f\u6301\u4e24\u79cd\u7c7b\u578b\u7684\u5bb9\u5668\u66f4\u65b0\uff1a</p> <ul> <li>\u8d44\u6e90\u66f4\u65b0\uff1aAM\u53ef\u4ee5\u8bf7\u6c42RM\u66f4\u65b0\u5bb9\u5668\u7684\u8d44\u6e90\u5927\u5c0f\u3002\u4f8b\u5982\u5c06\u5bb9\u5668\u4ece2GB 2vcore\u5bb9\u5668\u66f4\u6539\u4e3a4GB 2vcore\u5bb9\u5668\uff1b</li> <li>\u6267\u884c\u7c7b\u578b\u66f4\u65b0\uff1aAM\u53ef\u4ee5\u8bf7\u6c42RM\u66f4\u65b0\u5bb9\u5668\u7684\u6267\u884c\u7c7b\u578b\u3002\u5982\u5c06\u6267\u884c\u7c7b\u578b\u4eceGUARANTEED \u6539\u4e3aOPPORTUNISTIC \u3002</li> </ul> <p>\u66f4\u65b0\u7c7b\u578b\u6709\u56db\u79cd\uff1a</p> <pre><code>enum ContainerUpdateTypeProto {\n  INCREASE_RESOURCE = 0;\n  DECREASE_RESOURCE = 1;\n  PROMOTE_EXECUTION_TYPE = 2;\n  DEMOTE_EXECUTION_TYPE = 3;\n}\n</code></pre> <p>DECREASE_RESOURCE \u548cDEMOTE_EXECUTION_TYPE \u7684\u5bb9\u5668\u66f4\u65b0\u662f\u81ea\u52a8\u7684\uff0cAM\u4e0d\u5fc5\u663e\u5f0f\u5730\u8981\u6c42NM\u51cf\u5c11\u5bb9\u5668\u7684\u8d44\u6e90\uff0c\u5176\u4ed6\u66f4\u65b0\u7c7b\u578b\u8981\u6c42AM\u663e\u5f0f\u5730\u8bf7\u6c42NM\u66f4\u65b0\u5bb9\u5668\u3002</p> <p>\u5982\u679c<code>yarn.resourcemanager.auto-update.containers</code>\u53c2\u6570\u8bbe\u7f6e\u4e3atrue(\u9ed8\u8ba4\u4e3afalse)\uff0c RM\u5c06\u786e\u4fdd\u6240\u6709\u5bb9\u5668\u66f4\u65b0\u90fd\u662f\u81ea\u52a8\u7684\uff0c\u6240\u6709container\u66f4\u65b0\u4f1a\u5728\u4e0b\u4e2a\u5fc3\u8df3\u65f6\u53d1\u9001\u7ed9NM\u3002</p>"},{"location":"scheduler_system/yarn/scheduler.html#_19","title":"\u516c\u5e73\u8c03\u5ea6","text":"<p>\u4e0e\u9ed8\u8ba4\u7684Hadoop\u8c03\u5ea6\u5668\u5f62\u6210\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u961f\u5217\u4e0d\u540c\uff0c\u5b83\u5141\u8bb8\u77ed\u5e94\u7528\u7a0b\u5e8f\u5728\u5408\u7406\u7684\u65f6\u95f4\u5185\u5b8c\u6210\uff0c\u800c\u4e0d\u4f1a\u997f\u6b7b\u957f\u5e94\u7528\u7a0b\u5e8f\u3002\u8fd9\u4e5f\u662f\u5728\u591a\u4e2a\u7528\u6237\u4e4b\u95f4\u5171\u4eab\u96c6\u7fa4\u7684\u4e00\u79cd\u5408\u7406\u65b9\u5f0f\u3002\u6700\u540e\uff0c\u516c\u5e73\u5206\u4eab\u4e5f\u4e0e\u5e94\u7528\u7a0b\u5e8f\u7684\u4f18\u5148\u7ea7\u6709\u5173\u2014\u4f18\u5148\u7ea7\u88ab\u7528\u4f5c\u6743\u91cd\u6765\u786e\u5b9a\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5e94\u8be5\u83b7\u5f97\u7684\u603b\u8d44\u6e90\u7684\u6bd4\u4f8b\u3002</p> <p>\u8c03\u5ea6\u5668\u5c06\u5e94\u7528\u7a0b\u5e8f\u8fdb\u4e00\u6b65\u7ec4\u7ec7\u5230\u201c\u961f\u5217\u201d\u4e2d\uff0c\u5e76\u5728\u8fd9\u4e9b\u961f\u5217\u4e4b\u95f4\u516c\u5e73\u5730\u5171\u4eab\u8d44\u6e90\u3002</p> <ul> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6240\u6709\u7528\u6237\u5171\u4eab\u4e00\u4e2a\u540d\u4e3a\u201cdefault\u201d\u7684\u961f\u5217\uff1b</li> <li>\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u5728\u5bb9\u5668\u8d44\u6e90\u8bf7\u6c42\u4e2d\u7279\u522b\u5217\u51fa\u4e00\u4e2a\u961f\u5217\uff0c\u5219\u8be5\u8bf7\u6c42\u88ab\u63d0\u4ea4\u5230\u8be5\u961f\u5217\u3002\u8fd8\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6839\u636e\u8bf7\u6c42\u4e2d\u5305\u542b\u7684\u7528\u6237\u540d\u5206\u914d\u961f\u5217\u3002</li> <li>\u5728\u6bcf\u4e2a\u961f\u5217\u4e2d\uff0c\u4f7f\u7528\u8c03\u5ea6\u7b56\u7565\u5728\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u5171\u4eab\u8d44\u6e90\u3002\u9ed8\u8ba4\u662f\u57fa\u4e8e\u5185\u5b58\u7684\u516c\u5e73\u5171\u4eab\uff0c\u4f46\u662f\u4e5f\u53ef\u4ee5\u914d\u7f6eFIFO\u548c\u5177\u6709\u4f18\u52bf\u8d44\u6e90\u516c\u5e73\u6027\u7684\u591a\u8d44\u6e90\u3002</li> <li>\u961f\u5217\u53ef\u4ee5\u5b89\u6392\u5728\u5c42\u6b21\u7ed3\u6784\u4e2d\u4ee5\u5212\u5206\u8d44\u6e90\uff0c\u5e76\u914d\u7f6e\u6743\u91cd\u4ee5\u6309\u7279\u5b9a\u6bd4\u4f8b\u5171\u4eab\u96c6\u7fa4\u3002</li> </ul>"},{"location":"scheduler_system/yarn/scheduler.html#_20","title":"\u5206\u5c42\u961f\u5217\u548c\u63d2\u4ef6\u5316\u7b56\u7565","text":"<p><code>root</code>\u662f\u9ed8\u8ba4\u961f\u5217\uff0c\u53ef\u7528\u8d44\u6e90\u6309\u7167\u5178\u578b\u7684\u516c\u5e73\u8c03\u5ea6\u65b9\u5f0f\u5206\u5e03\u5728\u6839\u961f\u5217\u7684\u5b50\u961f\u5217\u4e2d\uff0c\u5b50\u961f\u5217\u540c\u6837\u5c06\u8d44\u6e90\u516c\u5e73\u5206\u914d\u7ed9\u5176\u5b50\u961f\u5217\u3002\u5e94\u7528\u7a0b\u5e8f\u53ea\u80fd\u5728\u53f6\u961f\u5217\u4e0a\u8c03\u5ea6\u3002</p> <p>\u961f\u5217\u540d\u79f0\u4ee5\u5176\u7236\u961f\u5217\u7684\u540d\u79f0\u5f00\u59cb\uff0c<code>.</code>\u4f5c\u4e3a\u5206\u9694\u7b26\u3002\u56e0\u6b64\u6839\u961f\u5217\u4e0b\u540d\u4e3a\u201cqueue1\u201d\u7684\u961f\u5217\u5c06\u88ab\u79f0\u4e3a\u201croot\u201d\u3002\u800c\u5728\u540d\u4e3aparent1\u7684\u961f\u5217\u4e0b\u7684\u540d\u4e3aqueue2\u7684\u961f\u5217\u79f0\u4e3aroot.parent1.queue2\u3002</p> <p>\u5728\u5f15\u7528\u961f\u5217\u65f6\uff0c\u540d\u79f0\u7684\u6839\u90e8\u5206\u662f\u53ef\u9009\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u4ec5\u5c06queue1\u79f0\u4e3a\u201cqueue1\u201d\uff0c\u5c06queue2\u79f0\u4e3a\u201cparent1.queue2\u201d\u3002</p> <p>Fair scheduler\u5141\u8bb8\u4e3a\u6bcf\u4e2a\u961f\u5217\u8bbe\u7f6e\u4e0d\u540c\u7684\u81ea\u5b9a\u4e49\u7b56\u7565\uff0c\u4ee5\u5141\u8bb8\u4ee5\u7528\u6237\u5e0c\u671b\u7684\u4efb\u4f55\u65b9\u5f0f\u5171\u4eab\u961f\u5217\u7684\u8d44\u6e90\u3002</p> <p>\u901a\u8fc7\u6269\u5c55<code>org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.SchedulingPolicy</code>\u53ef\u4ee5\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7b56\u7565\u3002\u5185\u7f6e\u7b56\u7565\u6709 <code>FifoPolicy</code>\uff0c<code>FairSharePolicy</code> (default) \u548c <code>DominantResourceFairnessPolicy</code>\u3002</p>"},{"location":"scheduler_system/yarn/scheduler.html#_21","title":"\u81ea\u52a8\u5c06\u5e94\u7528\u653e\u5230\u961f\u5217","text":"<p>Fair Scheduler\u5141\u8bb8\u7ba1\u7406\u5458\u914d\u7f6e\u81ea\u52a8\u5c06\u63d0\u4ea4\u7684\u5e94\u7528\u7a0b\u5e8f\u653e\u5165\u9002\u5f53\u961f\u5217\u7684\u7b56\u7565\u3002\u4f4d\u7f6e\u53d6\u51b3\u4e8e\u63d0\u4ea4\u8005\u7684\u7528\u6237\u548c\u7ec4\u4ee5\u53ca\u5e94\u7528\u7a0b\u5e8f\u4f20\u9012\u7684\u8bf7\u6c42\u961f\u5217\u3002\u7b56\u7565\u7531\u4e00\u7ec4\u89c4\u5219\u7ec4\u6210\uff0c\u6309\u987a\u5e8f\u5e94\u7528\u8fd9\u4e9b\u89c4\u5219\u5bf9\u4f20\u5165\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u5206\u7c7b\u3002\u6bcf\u4e2a\u89c4\u5219\u8981\u4e48\u5c06\u5e94\u7528\u7a0b\u5e8f\u653e\u5165\u961f\u5217\uff0c\u8981\u4e48\u62d2\u7edd\u5b83\uff0c\u8981\u4e48\u7ee7\u7eed\u6267\u884c\u4e0b\u4e00\u4e2a\u89c4\u5219\u3002</p>"},{"location":"scheduler_system/yarn/scheduler.html#_22","title":"\u914d\u7f6e","text":"<p>Fair-Schedule\u7684\u8c03\u5ea6\u6d89\u53ca\u5230\u4e24\u4e2a\u6587\u4ef6\uff1a</p> <ul> <li>yarn-site.xml\u6587\u4ef6\u4e2d\u6dfb\u52a0\u914d\u7f6e\u5c5e\u6027\u6765\u8bbe\u7f6e\u8c03\u5ea6\u5668\u8303\u56f4\u7684\u9009\u9879\uff1b</li> <li>\u5206\u914d\u6587\u4ef6\uff0c\u5217\u51fa\u5b58\u5728\u54ea\u4e9b\u961f\u5217\u4ee5\u53ca\u5b83\u4eec\u5404\u81ea\u7684\u6743\u91cd\u548c\u5bb9\u91cf\u3002</li> </ul> <p>\u5206\u914d\u6587\u4ef6\u6bcf10\u79d2\u91cd\u65b0\u52a0\u8f7d\u4e00\u6b21\uff0c\u5141\u8bb8\u52a8\u6001\u5730\u8fdb\u884c\u66f4\u6539\u3002</p>"},{"location":"scheduler_system/yarn/scheduler.html#yarn-sitexml","title":"yarn-site.xml","text":"<pre><code>&lt;property&gt;\n  &lt;name&gt;yarn.resourcemanager.scheduler.class&lt;/name&gt;\n  &lt;value&gt;org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> Property Description <code>yarn.scheduler.fair.allocation.file</code> \u5206\u914d\u6587\u4ef6\u7684\u8def\u5f84\u3002\u5982\u679c\u7ed9\u51fa\u4e86\u76f8\u5bf9\u8def\u5f84\uff0c\u5219\u5728\u7c7b\u8def\u5f84(\u901a\u5e38\u5305\u62ecHadoop conf\u76ee\u5f55)\u4e0a\u641c\u7d22\u8be5\u6587\u4ef6\u3002\u9ed8\u8ba4\u4e3afair-scheduler.xml\u3002 <code>yarn.scheduler.fair.user-as-default-queue</code> \u9ed8\u8ba4\u503c\u4e3atrue\u3002\u5728\u6ca1\u6709\u6307\u5b9a\u961f\u5217\u540d\u79f0\u7684\u60c5\u51b5\u4e0b\uff0c\u662f\u5426\u4f7f\u7528\u4e0e\u5206\u914d\u5173\u8054\u7684\u7528\u6237\u540d\u4f5c\u4e3a\u9ed8\u8ba4\u961f\u5217\u540d\u79f0\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a\u201cfalse\u201d\u6216\u672a\u8bbe\u7f6e\uff0c\u5219\u6240\u6709\u4f5c\u4e1a\u90fd\u6709\u4e00\u4e2a\u5171\u4eab\u7684\u9ed8\u8ba4\u961f\u5217\uff0c\u540d\u4e3a\u201cdefault\u201d\u3002\u5982\u679c\u5728\u5206\u914d\u6587\u4ef6\u4e2d\u7ed9\u51fa\u4e86\u961f\u5217\u653e\u7f6e\u7b56\u7565\uff0c\u5219\u5ffd\u7565\u6b64\u5c5e\u6027\u3002 <code>yarn.scheduler.fair.preemption</code> \u662f\u5426\u4f7f\u7528\u62a2\u5360\u3002\u9ed8\u8ba4\u503c\u4e3afalse\u3002 <code>yarn.scheduler.fair.preemption.cluster-utilization-threshold</code> \u5f53\u5229\u7528\u7387\u9ad8\u4e8e\u6b64\u9608\u503c\u65f6\uff0c\u5c1d\u8bd5\u62a2\u5360\u3002\u5229\u7528\u7387\u8ba1\u7b97\u4e3a\u6240\u6709\u8d44\u6e90\u7684\u6700\u5927\u4f7f\u7528\u7387\u4e0e\u5bb9\u91cf\u6bd4\u7387\u3002\u9ed8\u8ba4\u4e3a0.8f\u3002 <code>yarn.scheduler.fair.sizebasedweight</code> \u662f\u5426\u6839\u636e\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u5927\u5c0f\u5206\u914d\u4efd\u989d\uff0c\u800c\u4e0d\u662f\u4e0d\u5206\u5927\u5c0f\u7ed9\u6240\u6709\u5e94\u7528\u7a0b\u5e8f\u76f8\u540c\u7684\u4efd\u989d\u3002\u5f53\u8bbe\u7f6e\u4e3atrue\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u7684\u52a0\u6743\u503c\u4e3a1\u7684\u81ea\u7136\u5bf9\u6570\u52a0\u4e0a\u5e94\u7528\u7a0b\u5e8f\u7684\u603b\u8bf7\u6c42\u5185\u5b58\uff0c\u518d\u9664\u4ee52\u7684\u81ea\u7136\u5bf9\u6570\u3002\u9ed8\u8ba4\u503c\u4e3afalse\u3002 <code>yarn.scheduler.fair.assignmultiple</code> \u662f\u5426\u5141\u8bb8\u5728\u4e00\u4e2a\u5fc3\u8df3\u4e2d\u5206\u914d\u591a\u4e2a\u5bb9\u5668\u3002\u9ed8\u8ba4\u503c\u4e3afalse\u3002 <code>yarn.scheduler.fair.dynamic.max.assign</code> \u5982\u679cassignmultiple\u4e3atrue\uff0c\u662f\u5426\u52a8\u6001\u5730\u786e\u5b9a\u5728\u4e00\u4e2a\u5fc3\u8df3\u4e2d\u53ef\u4ee5\u5206\u914d\u7684\u8d44\u6e90\u6570\u91cf\u3002\u5f53\u6253\u5f00\u65f6\uff0c\u8282\u70b9\u4e0a\u5927\u7ea6\u6709\u4e00\u534a\u7684\u672a\u5206\u914d\u8d44\u6e90\u5728\u5355\u4e2a\u5fc3\u8df3\u4e2d\u5206\u914d\u7ed9\u5bb9\u5668\u3002\u9ed8\u8ba4\u503c\u4e3atrue\u3002 <code>yarn.scheduler.fair.max.assign</code> \u5982\u679cassignmultiple\u4e3atrue\u4e14dynamic.max.assign\u4e3afalse\uff0c\u8868\u793a\u4e00\u6b21\u5fc3\u8df3\u53ef\u4ee5\u5206\u914d\u7684\u5bb9\u5668\u7684\u6700\u5927\u6570\u91cf\u30020\u52301\u4e4b\u95f4\u7684\u6d6e\u70b9\u6570\uff0c\u9ed8\u8ba4\u503c\u4e3a-1\uff0c\u6ca1\u6709\u9650\u5236\u3002 <code>yarn.scheduler.fair.locality.threshold.node</code> \u5bf9\u4e8e\u8bf7\u6c42\u7279\u5b9a\u8282\u70b9\u4e0a\u7684\u5bb9\u5668\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u81ea\u6700\u540e\u4e00\u6b21\u5bb9\u5668\u5206\u914d\u540e\u5728\u63a5\u53d7\u53e6\u4e00\u4e2a\u8282\u70b9\u4e0a\u7684\u653e\u7f6e\u4e4b\u524d\u7b49\u5f85\u7684\u8c03\u5ea6\u673a\u4f1a\u7684\u6570\u91cf\u3002\u9ed8\u8ba4\u503c-1.0\u8868\u793a\u4e0d\u8981\u9519\u8fc7\u4efb\u4f55\u8c03\u5ea6\u673a\u4f1a\u3002 <code>yarn.scheduler.fair.locality.threshold.rack</code> \u5bf9\u4e8e\u8bf7\u6c42\u7279\u5b9a\u673a\u67b6\u4e0a\u7684\u5bb9\u5668\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u81ea\u6700\u540e\u4e00\u6b21\u5bb9\u5668\u5206\u914d\u540e\u5728\u63a5\u53d7\u53e6\u4e00\u4e2a\u673a\u67b6\u4e0a\u7684\u653e\u7f6e\u4e4b\u524d\u7b49\u5f85\u7684\u8c03\u5ea6\u673a\u4f1a\u7684\u6570\u91cf\u3002\u8868\u793a\u4e3a0\u52301\u4e4b\u95f4\u7684\u6d6e\u70b9\u6570\uff0c\u9ed8\u8ba4\u503c-1.0\u8868\u793a\u4e0d\u8981\u9519\u8fc7\u4efb\u4f55\u8c03\u5ea6\u673a\u4f1a\u3002 <code>yarn.scheduler.fair.allow-undeclared-pools</code> \u5982\u679ctrue\uff0c\u53ef\u4ee5\u5728\u5e94\u7528\u7a0b\u5e8f\u63d0\u4ea4\u65f6\u521b\u5efa\u65b0\u7684\u961f\u5217\uff1bfalse\u65f6\uff0c\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u6ca1\u6709\u5728\u5206\u914d\u6587\u4ef6\u4e2d\u6307\u5b9a\u961f\u5217\uff0c\u5219\u5728\u201cdefault\"\u961f\u5217\u3002\u9ed8\u8ba4\u503c\u4e3atrue\u3002\u5982\u679c\u5728\u5206\u914d\u6587\u4ef6\u4e2d\u7ed9\u51fa\u4e86\u961f\u5217\u653e\u7f6e\u7b56\u7565\uff0c\u5219\u5ffd\u7565\u6b64\u5c5e\u6027\u3002 <code>yarn.scheduler.fair.update-interval-ms</code> \u9ed8\u8ba4\u503c\u4e3a500\u6beb\u79d2\u3002\u9501\u5b9a\u8c03\u5ea6\u5668\u548c\u91cd\u65b0\u8ba1\u7b97\u516c\u5e73\u4efd\u989d\uff0c\u91cd\u8ba1\u7b97\u9700\u6c42\u548c\u68c0\u67e5\u662f\u5426\u9700\u8981\u5148\u62a2\u5360\u7684\u95f4\u9694\u3002 <code>yarn.resource-types.memory-mb.increment-allocation</code> fairscheduler\u6309\u6b64\u503c\u7684\u589e\u91cf\u6388\u4e88\u5185\u5b58\u3002\u5982\u679c\u60a8\u63d0\u4ea4\u7684\u4efb\u52a1\u7684\u8d44\u6e90\u8bf7\u6c42\u4e0d\u662f\u5176\u500d\u6570\uff0c\u5219\u8bf7\u6c42\u5c06\u56db\u820d\u4e94\u5165\u5230\u6700\u63a5\u8fd1\u7684\u589e\u91cf\u3002\u9ed8\u8ba4\u503c\u4e3a1024 MB\u3002 <code>yarn.resource-types.vcores.increment-allocation</code> fairscheduler\u6309\u6b64\u503c\u7684\u589e\u91cf\u6388\u4e88vcores\u3002\u5982\u679c\u60a8\u63d0\u4ea4\u7684\u4efb\u52a1\u7684\u8d44\u6e90\u8bf7\u6c42\u4e0d\u662f\u5176\u500d\u6570\u3002\u589e\u91cf\u5206\u914d\u65f6\uff0c\u8bf7\u6c42\u5c06\u56db\u820d\u4e94\u5165\u5230\u6700\u63a5\u8fd1\u7684\u589e\u91cf\u3002\u9ed8\u8ba4\u4e3a1\u3002 <code>yarn.resource-types.&lt;resource&gt;.increment-allocation</code> fairscheduler\u6309\u6b64\u503c\u7684\u589e\u91cf\u6388\u4e88\u3002\u5982\u679c\u60a8\u63d0\u4ea4\u7684\u4efb\u52a1\u7684\u8d44\u6e90\u8bf7\u6c42\u4e0d\u662f\u5176\u500d\u6570\u3002\u589e\u91cf\u5206\u914d\u65f6\uff0c\u8bf7\u6c42\u5c06\u56db\u820d\u4e94\u5165\u5230\u6700\u63a5\u8fd1\u7684\u589e\u91cf\u3002 <code>yarn.scheduler.increment-allocation-mb</code> \u4f7f\u7528yarn.resource-types.memory-mb.increment-allocation\u66ff\u4ee3 <code>yarn.scheduler.increment-allocation-vcores</code> \u4f7f\u7528yarn.resource-types.vcores.increment-allocation\u66ff\u4ee3"},{"location":"scheduler_system/yarn/scheduler.html#_23","title":"\u5206\u914d\u6587\u4ef6\u7684\u683c\u5f0f","text":"<p>XML\u683c\u5f0f\uff0c\u4e3b\u8981\u5305\u542b5\u79cd\u5143\u7d20\u7c7b\u578b</p> <ul> <li>Queue elements\uff1a\u8868\u793a\u961f\u5217\uff0c\u5c5e\u6027<code>type</code>\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u4e3a<code>parent</code>\u4f5c\u4e3a\u7236\u961f\u5217\u3002\u6bcf\u4e2a\u961f\u5217\u5305\u542b\u4ee5\u4e0b\u914d\u7f6e\uff1a</li> <li>minResources\uff1a\u961f\u5217\u6709\u6743\u83b7\u5f97\u7684\u6700\u5c0f\u8d44\u6e90\u3002\u5982\u679c\u4e00\u4e2a\u961f\u5217\u7684\u6700\u5c0f\u5171\u4eab\u6ca1\u6709\u5f97\u5230\u6ee1\u8db3\uff0c\u90a3\u4e48\u5b83\u5c06\u5728\u540c\u4e00\u7236\u961f\u5217\u4e0b\u7684\u4efb\u4f55\u5176\u4ed6\u961f\u5217\u4e4b\u524d\u88ab\u63d0\u4f9b\u53ef\u7528\u8d44\u6e90\u3002</li> <li>maxResources\uff1a\u961f\u5217\u53ef\u4ee5\u5206\u914d\u7684\u6700\u5927\u8d44\u6e90\u3002\u4e0d\u4f1a\u4e3a\u961f\u5217\u5206\u914d\u4e00\u4e2a\u5bb9\u5668\uff0c\u4f7f\u5176\u603b\u4f7f\u7528\u91cf\u8d85\u8fc7\u6b64\u9650\u5236\u3002\u6b64\u9650\u5236\u662f\u9012\u5f52\u5f3a\u5236\u6267\u884c\u7684\uff0c\u5982\u679c\u8be5\u5206\u914d\u5c06\u4f7f\u961f\u5217\u6216\u5176\u7236\u961f\u5217\u8d85\u8fc7\u6700\u5927\u8d44\u6e90\uff0c\u5219\u4e0d\u4f1a\u7ed9\u961f\u5217\u5206\u914d\u5bb9\u5668\u3002</li> <li>maxContainerAllocation\uff1a\u961f\u5217\u53ef\u4ee5\u5206\u914d\u7ed9\u5355\u4e2a\u5bb9\u5668\u7684\u6700\u5927\u8d44\u6e90\uff0c\u5982\u679c\u672a\u8bbe\u7f6e\u8be5\u5c5e\u6027\uff0c\u5219\u5176\u503c\u4ece\u7236\u961f\u5217\u7ee7\u627f\u3002\u9ed8\u8ba4\u65f6maximum-allocation-mb\u548cmaximum-allocation-vcores\u3002\u6b64\u5c5e\u6027\u5bf9\u6839\u961f\u5217\u65e0\u6548\u3002</li> <li>maxChildResources\uff1a\u7279\u5b9a\u5b50\u961f\u5217\u53ef\u4ee5\u5206\u914d\u7684\u6700\u5927\u8d44\u6e90\u3002<ul> <li>\u524d\u56db\u4e2a\u7684\u914d\u7f6e\u683c\u5f0f\uff1a\u201cvcores=X, memory-mb=Y\u201d\uff08\u5355\u4f4d\u4ece\u8d44\u6e90\u7684\u9ed8\u8ba4\u914d\u7f6e\u5355\u5143\u63a8\u65ad\uff09 \u6216\u8005 \u201cvcores=X%, memory-mb=Y%\u201d\u3002</li> </ul> </li> <li>maxRunningApps\uff1a\u9650\u5236\u961f\u5217\u4e2d\u8981\u540c\u65f6\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u6570\u91cf</li> <li>maxAMShare\uff1a\u9650\u5236\u5728\u961f\u5217\u7528\u4e8e\u8fd0\u884cAM\u7684\u7684\u516c\u5e73\u4efd\u989d\u3002\u6b64\u5c5e\u6027\u53ea\u80fd\u7528\u4e8e\u53f6\u961f\u5217\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a1.0f\uff0c\u90a3\u4e48\u53f6\u961f\u5217\u4e2d\u7684AMs\u53ef\u4ee5\u5360\u7528100%\u7684\u5185\u5b58\u548cCPU\u516c\u5e73\u4efd\u989d\u3002-1.0f\u5c06\u7981\u7528\u6b64\u529f\u80fd\uff0camShare\u5c06\u4e0d\u4f1a\u88ab\u68c0\u67e5\u3002\u9ed8\u8ba4\u503c\u4e3a0.5f\u3002</li> <li>weight\uff1a\u4e0e\u5176\u4ed6\u961f\u5217\u975e\u6bd4\u4f8b\u5730\u5171\u4eab\u96c6\u7fa4\uff0c\u9ed8\u8ba41.</li> <li>schedulingPolicy\uff1a\u8bbe\u7f6e\u4efb\u4f55\u961f\u5217\u7684\u8c03\u5ea6\u7b56\u7565\uff0c\u9ed8\u8ba4\u4e3afair</li> <li>aclSubmitApps\uff1a\u53ef\u4ee5\u5411\u961f\u5217\u63d0\u4ea4\u5e94\u7528\u7a0b\u5e8f\u7684\u7528\u6237\u548c/\u6216\u7ec4\u5217\u8868\u3002</li> <li>aclAdministerApps\uff1a\u53ef\u4ee5\u7ba1\u7406\u961f\u5217\u7684\u7528\u6237\u548c/\u6216\u7ec4\u7684\u5217\u8868\u3002\u76ee\u524d\u552f\u4e00\u7684\u7ba1\u7406\u884c\u4e3a\u662f\u7ec8\u6b62\u5e94\u7528\u7a0b\u5e8f\u3002</li> <li>minSharePreemptionTimeout\uff1a\u5728\u5c1d\u8bd5\u62a2\u5360\u5bb9\u5668\u4ee5\u4ece\u5176\u4ed6\u961f\u5217\u83b7\u53d6\u8d44\u6e90\u4e4b\u524d\uff0c\u961f\u5217\u4f4e\u4e8e\u5176\u6700\u5c0f\u5171\u4eab\u7684\u79d2\u6570\u3002\u5982\u679c\u672a\u8bbe\u7f6e\uff0c\u5219\u961f\u5217\u5c06\u4ece\u5176\u7236\u961f\u5217\u7ee7\u627f\u8be5\u503c\u3002\u9ed8\u8ba4\u503c\u662fLong.MAX_VALUE\uff0c\u8fd9\u610f\u5473\u7740\u5728\u60a8\u8bbe\u7f6e\u6709\u610f\u4e49\u7684\u503c\u4e4b\u524d\uff0c\u5b83\u4e0d\u4f1a\u62a2\u5360\u5bb9\u5668\u3002</li> <li>fairSharePreemptionTimeout\uff1a\u5728\u5c1d\u8bd5\u62a2\u5360\u5bb9\u5668\u4ee5\u4ece\u5176\u4ed6\u961f\u5217\u83b7\u53d6\u8d44\u6e90\u4e4b\u524d\uff0c\u961f\u5217\u4f4e\u4e8e\u5176\u516c\u5e73\u5171\u4eab\u9608\u503c\u7684\u79d2\u6570\u3002\u5982\u679c\u672a\u8bbe\u7f6e\uff0c\u5219\u961f\u5217\u5c06\u4ece\u5176\u7236\u961f\u5217\u7ee7\u627f\u8be5\u503c\u3002\u9ed8\u8ba4\u503c\u662fLong.MAX_VALUE\uff0c\u8fd9\u610f\u5473\u7740\u5728\u60a8\u8bbe\u7f6e\u6709\u610f\u4e49\u7684\u503c\u4e4b\u524d\uff0c\u5b83\u4e0d\u4f1a\u62a2\u5360\u5bb9\u5668\u3002</li> <li>fairSharePreemptionThreshold\uff1a\u961f\u5217\u7684\u516c\u5e73\u5171\u4eab\u62a2\u5360\u9608\u503c\uff0c\u5982\u679c\u961f\u5217\u7b49\u5f85fairSharePreemptionTimeout\u800c\u6ca1\u6709\u63a5\u6536fairSharePreemptionThreshold*fairShare\u8d44\u6e90\uff0c\u5219\u5141\u8bb8\u5b83\u62a2\u5360\u5bb9\u5668\u4ee5\u4ece\u5176\u4ed6\u961f\u5217\u83b7\u53d6\u8d44\u6e90\u3002\u5982\u679c\u672a\u8bbe\u7f6e\uff0c\u5219\u961f\u5217\u5c06\u4ece\u5176\u7236\u961f\u5217\u7ee7\u627f\u8be5\u503c\u3002\u9ed8\u8ba4\u503c\u4e3a0.5f\u3002</li> <li>allowPreemptionFrom\uff1a\u786e\u5b9a\u662f\u5426\u5141\u8bb8\u8c03\u5ea6\u7a0b\u5e8f\u62a2\u5360\u961f\u5217\u4e2d\u7684\u8d44\u6e90\u3002\u9ed8\u8ba4\u503c\u4e3atrue\u3002\u5982\u679c\u961f\u5217\u5c06\u6b64\u5c5e\u6027\u8bbe\u7f6e\u4e3afalse\uff0c\u5219\u6b64\u5c5e\u6027\u5c06\u9012\u5f52\u5e94\u7528\u4e8e\u6240\u6709\u5b50\u961f\u5217\u3002</li> <li>reservation\uff1a\u5411ReservationSystem\u8868\u793a\u961f\u5217\u7684\u8d44\u6e90\u53ef\u4f9b\u7528\u6237\u9884\u7559\u3002\u8fd9\u53ea\u9002\u7528\u4e8e\u53f6\u961f\u5217\u3002\u5982\u679c\u6ca1\u6709\u914d\u7f6e\u6b64\u5c5e\u6027\uff0c\u5219\u4e0d\u80fd\u4fdd\u7559\u53f6\u961f\u5217\u3002</li> <li>User elements\uff1a\u7ba1\u7406\u5355\u4e2a\u7528\u6237\u884c\u4e3a\u7684\u8bbe\u7f6e\uff0c\u5305\u542b\u5355\u4e2a\u5c5e\u6027<code>maxRunningApps</code>\uff0c\u5bf9\u7279\u5b9a\u7528\u6237\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u6570\u91cf\u7684\u9650\u5236\u3002</li> <li>A userMaxAppsDefault element\uff1a\u6ca1\u6709\u6307\u5b9a\u9650\u5236\u7684\u7528\u6237\u8bbe\u7f6e\u9ed8\u8ba4\u7684\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u9650\u5236\u3002</li> <li>A defaultFairSharePreemptionTimeout element</li> <li>A defaultMinSharePreemptionTimeout element</li> <li>A defaultFairSharePreemptionThreshold element</li> <li>A queueMaxAppsDefault element</li> <li>A queueMaxResourcesDefault element</li> <li>A queueMaxAMShareDefault element</li> <li>A defaultQueueSchedulingPolicy element</li> <li>A reservation-agent element\uff1aReservationAgent\u5b9e\u73b0\u7684\u7c7b\u540d\uff0c\u8bd5\u56fe\u5c06\u7528\u6237\u7684\u9884\u8ba2\u8bf7\u6c42\u653e\u5165<code>Plan</code>\u4e2d\uff0c\u9ed8\u8ba4org.apache.hadoop.yarn.server.resourcemanager.reservation.planning.AlignedPlannerWithGreedy</li> <li>A reservation-policy element\uff1aSharingPolicy\u5b9e\u73b0\u7684\u7c7b\u540d\uff0c\u9a8c\u8bc1\u65b0\u7684\u4fdd\u7559\u662f\u5426\u6ca1\u6709\u8fdd\u53cd\u4efb\u4f55\u4e0d\u53d8\u91cf\uff0c\u9ed8\u8ba4org.apache.hadoop.yarn.server.resourcemanager.reservation.CapacityOverTimePolicy</li> <li>A reservation-planner element\uff1aPlanner\u5b9e\u73b0\u7684\u7c7b\u540d\uff0c\u5982\u679c\u8ba1\u5212\u5bb9\u91cf\u4f4e\u4e8e\u7528\u6237\u4fdd\u7559\u8d44\u6e90(\u7531\u4e8e\u8ba1\u5212\u7ef4\u62a4\u6216\u8282\u70b9\u6545\u969c)\uff0c\u5219\u8c03\u7528\u8be5\u7c7b\u3002\u9ed8\u8ba4org.apache.hadoop.yarn.server.resourcemanager.reservation.planning.SimpleCapacityReplanne\uff0c\u626b\u63cf\u8ba1\u5212\uff0c\u5e76\u4ee5\u540e\u8fdb\u5148\u51fa(LIFO)\u7684\u987a\u5e8f\u8d2a\u5a6a\u5730\u5220\u9664\u4fdd\u7559\uff0c\u76f4\u5230\u4fdd\u7559\u7684\u8d44\u6e90\u5728\u8ba1\u5212\u5bb9\u91cf\u4e4b\u5185\u3002</li> <li>A queuePlacementPolicy element\uff1a\u5305\u542b\u89c4\u5219\u5143\u7d20\u5217\u8868\uff0c\u544a\u8bc9\u8c03\u5ea6\u5668\u5982\u4f55\u5c06\u4f20\u5165\u7684\u5e94\u7528\u7a0b\u5e8f\u653e\u5165\u961f\u5217\u4e2d\u3002\u6240\u6709\u89c4\u5219\u90fd\u63a5\u53d7\u201ccreate\u201d\u53c2\u6570\uff08\u9ed8\u8ba4\u4e3atrue\uff09\uff0c\u8be5\u53c2\u6570\u6307\u793a\u89c4\u5219\u662f\u5426\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u65b0\u961f\u5217\u3002\u5982\u679c\u8bbe\u7f6e\u4e3afalse\uff0c\u5e76\u4e14\u8be5\u89c4\u5219\u5c06\u628a\u5e94\u7528\u7a0b\u5e8f\u653e\u5728\u5206\u914d\u6587\u4ef6\u4e2d\u672a\u914d\u7f6e\u7684\u961f\u5217\u4e2d\uff0c\u5c06\u7ee7\u7eed\u6267\u884c\u4e0b\u4e00\u4e2a\u89c4\u5219\u3002\u6700\u540e\u4e00\u4e2a\u89c4\u5219\u5fc5\u987b\u662f\u4e0d\u80fd\u53d1\u51facontinue\u7684\u89c4\u5219\u3002\u6709\u6548\u7684\u89c4\u5219\uff1a</li> <li>specified\uff1a\u5e94\u7528\u7a0b\u5e8f\u88ab\u653e\u7f6e\u5230\u5b83\u8bf7\u6c42\u7684\u961f\u5217\u4e2d\u3002\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u6ca1\u6709\u8bf7\u6c42\u961f\u5217\uff0c\u5373\u6307\u5b9a\u201cdefault\u201d\u3002\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u8bf7\u6c42\u4e00\u4e2a\u4ee5\u53e5\u70b9\u5f00\u5934\u6216\u7ed3\u5c3e\u7684\u961f\u5217\u540d\u79f0\uff0c\u4f8b\u5982\".q1\"\u6216\"q1.\"\u5c06\u88ab\u62d2\u7edd\uff1b</li> <li>user\uff1a\u5e94\u7528\u7a0b\u5e8f\u88ab\u653e\u5165\u4e00\u4e2a\u5e26\u6709\u63d0\u4ea4\u5b83\u7684\u7528\u6237\u540d\u79f0\u7684\u961f\u5217\u4e2d\uff0c\u7528\u6237\u540d\u4e2d\u7684<code>.</code>\u4f1a\u88ab\u66ff\u6362\u6210<code>__dot__</code>\uff1b</li> <li>primaryGroup\uff1a\u5e94\u7528\u7a0b\u5e8f\u88ab\u653e\u7f6e\u5230\uff0c\u5177\u6709\u63d0\u4ea4\u5e94\u7528\u7a0b\u5e8f\u7684\u7528\u6237\u7684\u4e3b\u7ec4\u7684\u961f\u5217\uff0c\u7ec4\u540d\u4e2d\u7684<code>.</code>\u4f1a\u88ab\u66ff\u6362\u6210<code>__dot__</code>\uff1b</li> <li>secondaryGroupExistingQueue\uff1a\u5e94\u7528\u7a0b\u5e8f\u88ab\u653e\u5165\u4e0e\u63d0\u4ea4\u5b83\u7684\u7528\u6237\u7684 secondary\u7ec4\u76f8\u5339\u914d\u7684\u961f\u5217\uff0c\u9009\u62e9\u4e0e\u5df2\u914d\u7f6e\u961f\u5217\u5339\u914d\u7684\u7b2c\u4e00\u4e2asecondary\u7ec4\uff0c\u7ec4\u540d\u4e2d\u7684<code>.</code>\u4f1a\u88ab\u66ff\u6362\u6210<code>__dot__</code>\uff1b</li> <li>nestedUserQueue\uff1a\u5e94\u7528\u7a0b\u5e8f\u88ab\u653e\u7f6e\u5230\u4e00\u4e2a\u5177\u6709\u7528\u6237\u540d\u7684\u961f\u5217\u4e2d\uff0c\u8be5\u961f\u5217\u4f4d\u4e8e\u5d4c\u5957\u89c4\u5219\u5efa\u8bae\u7684\u961f\u5217\u4e4b\u4e0b\u3002' nestedUserQueue '\u89c4\u5219\uff0c\u7528\u6237\u961f\u5217\u53ef\u4ee5\u5728\u4efb\u4f55\u7236\u961f\u5217\u4e0b\u521b\u5efa\uff0c\u800c' user '\u89c4\u5219\u53ea\u5728\u6839\u961f\u5217\u4e0b\u521b\u5efa\u7528\u6237\u961f\u5217\u3002\u6ce8\u610f\uff0c\u53ea\u6709\u5f53\u5d4c\u5957\u89c4\u5219\u8fd4\u56de\u7236\u961f\u5217\u65f6\uff0c\u624d\u4f1a\u5e94\u7528nestedUserQueue\u89c4\u5219\u3002</li> <li>default\uff1a\u5e94\u7528\u7a0b\u5e8f\u88ab\u653e\u7f6e\u5728\u5176\u201cqueue\u201d\u5c5e\u6027\u4e2d\u6307\u5b9a\u7684\u961f\u5217\u4e2d\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a' queue '\u5c5e\u6027\uff0c\u5e94\u7528\u7a0b\u5e8f\u5c06\u88ab\u653e\u7f6e\u5230' root.default '\u961f\u5217\u4e2d\u3002</li> <li>reject\uff1a\u62d2\u7edd\u8fd9\u4e2aapp</li> </ul> <p>\u793a\u4f8b</p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;allocations&gt;\n  &lt;queue name=\"sample_queue\"&gt;\n    &lt;minResources&gt;10000 mb,1vcores&lt;/minResources&gt;\n    &lt;maxResources&gt;vcores=2000, memory-mb=2&lt;/maxResources&gt;\n    &lt;maxRunningApps&gt;50&lt;/maxRunningApps&gt;\n    &lt;maxAMShare&gt;0.1&lt;/maxAMShare&gt;\n    &lt;weight&gt;2.0&lt;/weight&gt;\n    &lt;schedulingPolicy&gt;fair&lt;/schedulingPolicy&gt;\n    &lt;queue name=\"sample_sub_queue\"&gt;\n      &lt;aclSubmitApps&gt;charlie&lt;/aclSubmitApps&gt;\n      &lt;minResources&gt;5000 mb,0vcores&lt;/minResources&gt;\n    &lt;/queue&gt;\n    &lt;queue name=\"sample_reservable_queue\"&gt;\n      &lt;reservation&gt;&lt;/reservation&gt;\n    &lt;/queue&gt;\n  &lt;/queue&gt;\n\n  &lt;queueMaxAMShareDefault&gt;0.5&lt;/queueMaxAMShareDefault&gt;\n  &lt;queueMaxResourcesDefault&gt;40000 mb,0vcores&lt;/queueMaxResourcesDefault&gt;\n\n  &lt;!-- Queue 'secondary_group_queue' is a parent queue and may have\n       user queues under it --&gt;\n  &lt;queue name=\"secondary_group_queue\" type=\"parent\"&gt;\n  &lt;weight&gt;3.0&lt;/weight&gt;\n  &lt;maxChildResources&gt;4096 mb,4vcores&lt;/maxChildResources&gt;\n  &lt;/queue&gt;\n\n  &lt;user name=\"sample_user\"&gt;\n    &lt;maxRunningApps&gt;30&lt;/maxRunningApps&gt;\n  &lt;/user&gt;\n  &lt;userMaxAppsDefault&gt;5&lt;/userMaxAppsDefault&gt;\n\n  &lt;queuePlacementPolicy&gt;\n    &lt;rule name=\"specified\" /&gt;\n    &lt;rule name=\"primaryGroup\" create=\"false\" /&gt;\n    &lt;rule name=\"nestedUserQueue\"&gt;\n        &lt;rule name=\"secondaryGroupExistingQueue\" create=\"false\" /&gt;\n    &lt;/rule&gt;\n    &lt;rule name=\"default\" queue=\"sample_queue\"/&gt;\n  &lt;/queuePlacementPolicy&gt;\n&lt;/allocations&gt;\n</code></pre>"},{"location":"scheduler_system/yarn/scheduler.html#acl","title":"ACL","text":"<p>\u961f\u5217\u8bbf\u95ee\u63a7\u5236\u5217\u8868(acl)\u5141\u8bb8\u7ba1\u7406\u5458\u63a7\u5236\u8c01\u53ef\u4ee5\u5bf9\u7279\u5b9a\u961f\u5217\u91c7\u53d6\u64cd\u4f5c\u3002</p> <p>\u5b83\u4eec\u914d\u7f6e\u4e86<code>aclSubmitApps</code>\u548c<code>aclAdministerApps</code>\u5c5e\u6027\uff0c\u53ef\u4ee5\u5bf9\u6bcf\u4e2a\u961f\u5217\u8fdb\u884c\u8bbe\u7f6e\u3002\u76ee\u524d\u552f\u4e00\u652f\u6301\u7684\u7ba1\u7406\u64cd\u4f5c\u662f\u7ec8\u6b62\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u5c5e\u6027\u7684\u503c\u683c\u5f0f\u7c7b\u4f3c\u4e8e<code>user1,user2 group1,group2</code>\u6216<code>group1,group2</code>\u3002</p> <p>\u5177\u6709\u7236\u961f\u5217\u7684ACL\u6743\u9650\u53ef\u4ee5\u64cd\u4f5c\u5b50\u961f\u5217\u3002</p> <p>\u6839\u961f\u5217\u7684acl\u9ed8\u8ba4\u4e3a\u201c*\u201d\uff0c\u56e0\u4e3aacl\u662f\u5411\u4e0b\u4f20\u9012\u7684\uff0c\u8fd9\u610f\u5473\u7740\u6bcf\u4e2a\u4eba\u90fd\u53ef\u4ee5\u5411\u6bcf\u4e2a\u961f\u5217\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u63d0\u4ea4\u548c\u7ec8\u6b62\u5e94\u7528\u7a0b\u5e8f\u3002\u8981\u5f00\u59cb\u9650\u5236\u8bbf\u95ee\uff0c\u8bf7\u5c06\u6839\u961f\u5217\u7684acl\u66f4\u6539\u4e3a\"*\"\u4ee5\u5916\u7684\u5185\u5bb9\u3002</p>"},{"location":"scheduler_system/yarn/scheduler.html#acl_1","title":"\u9884\u7ea6ACL","text":"<p>\u9884\u7ea6\u8bbf\u95ee\u63a7\u5236\u5217\u8868\u5141\u8bb8\u7ba1\u7406\u5458\u63a7\u5236\u8c01\u53ef\u4ee5\u5bf9\u7279\u5b9a\u961f\u5217\u91c7\u53d6\u9884\u7ea6\u64cd\u4f5c\u3002</p> <p>\u914d\u7f6e\u4e86<code>acladministerreservation</code>\u3001<code>aclListReservations</code>\u548c<code>aclsubmitreservation</code>\u5c5e\u6027\uff0c\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u961f\u5217\u8bbe\u7f6e\u8fd9\u4e9b\u5c5e\u6027\u3002\u76ee\u524d\u652f\u6301\u7684\u7ba1\u7406\u64cd\u4f5c\u662f\u66f4\u65b0\u548c\u5220\u9664\u9884\u8ba2\u3002\u7ba1\u7406\u5458\u8fd8\u53ef\u4ee5\u63d0\u4ea4\u5e76\u5728\u961f\u5217\u4e2d\u5217\u51fa\u6240\u6709\u9884\u8ba2\u3002</p> <p>\u5c5e\u6027\u7684\u503c\u683c\u5f0f\u7c7b\u4f3c\u4e8e<code>user1,user2 group1,group2</code>\u6216<code>group1,group2</code>\u3002</p> <p>\u5982\u679c\u7528\u6237/\u7ec4\u662f\u9884\u7ea6ACL\u7684\u6210\u5458\uff0c\u5219\u5141\u8bb8\u5bf9\u961f\u5217\u8fdb\u884c\u64cd\u4f5c\u3002\u6ce8\u610f\uff0c\u4efb\u4f55\u7528\u6237\u90fd\u53ef\u4ee5\u66f4\u65b0\u3001\u5220\u9664\u6216\u5217\u51fa\u4ed6\u4eec\u81ea\u5df1\u7684\u9884\u8ba2\u3002\u5982\u679c\u542f\u7528\u4e86\u9884\u8ba2acl\u4f46\u6ca1\u6709\u5b9a\u4e49\uff0c\u90a3\u4e48\u6bcf\u4e2a\u4eba\u90fd\u53ef\u4ee5\u8bbf\u95ee\u3002</p>"},{"location":"scheduler_system/yarn/scheduler.html#reservationsystem","title":"\u914d\u7f6e <code>ReservationSystem</code>","text":"<p>Fair Scheduler\u652f\u6301ReservationSystem\uff0c\u5141\u8bb8\u7528\u6237\u63d0\u524d\u9884\u7559\u8d44\u6e90\u3002\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u901a\u8fc7\u5728\u63d0\u4ea4\u671f\u95f4\u6307\u5b9areservationId\u6765\u8bf7\u6c42\u4fdd\u7559\u7684\u8d44\u6e90\u3002\u53ef\u4ee5\u5728ReservationSystem\u7684yarn-site.xml\u4e2d\u914d\u7f6e\u4ee5\u4e0b\u914d\u7f6e\u53c2\u6570\u3002</p> Property Description <code>yarn.resourcemanager.reservation-system.enable</code> \u5728ResourceManager\u4e2d\u542f\u7528ReservationSystem\uff0c\u9ed8\u8ba4false <code>yarn.resourcemanager.reservation-system.class</code> ReservationSystem \u7684\u7c7b\u540d\uff0cFairScheduler\u7684\u9ed8\u8ba4\u662fFairReservationSystem <code>yarn.resourcemanager.reservation-system.plan.follower</code> \u5728\u5b9a\u65f6\u5668\u4e0a\u8fd0\u884c\u5e76\u548cResourceScheduler\u548cPlan\u540c\u6b65\u3002FairScheduler\u9ed8\u8ba4FairSchedulerPlanFollower <code>yarn.resourcemanager.reservation-system.planfollower.time-step</code> PlanFollower\u5b9a\u65f6\u5668\u9891\u7387(\u6beb\u79d2)\u7684\u3002\u9ed8\u8ba41000\u3002 <p>ReservationSystem\u96c6\u6210\u4e86Fair Scheduler\u961f\u5217\u5c42\u6b21\u7ed3\u6784\uff0c\u53ef\u4ee5\u4e3a\u53f6\u961f\u5217(\u4e14\u4ec5\u4e3a\u53f6\u961f\u5217)\u914d\u7f6e\u3002</p>"},{"location":"scheduler_system/yarn/scheduler.html#administration","title":"\u7ba1\u7406\uff08Administration\uff09","text":"<p>fair scheduler\u901a\u8fc7\u4e00\u4e9b\u673a\u5236\u63d0\u4f9b\u5bf9\u8fd0\u884c\u65f6\u7ba1\u7406\u7684\u652f\u6301:</p>"},{"location":"scheduler_system/yarn/scheduler.html#_24","title":"\u8fd0\u884c\u65f6\u66f4\u6539\u914d\u7f6e","text":"<p>\u901a\u8fc7\u7f16\u8f91\u5206\u914d\u6587\u4ef6\uff0c\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u4fee\u6539\u6700\u5c0f\u5171\u4eab\u3001\u9650\u5236\u3001\u6743\u91cd\u3001\u62a2\u5360\u8d85\u65f6\u548c\u961f\u5217\u8c03\u5ea6\u7b56\u7565\u3002\u8c03\u5ea6\u5668\u5c06\u5728\u770b\u5230\u8be5\u6587\u4ef6\u88ab\u4fee\u6539\u540e10-15\u79d2\u91cd\u65b0\u52a0\u8f7d\u8be5\u6587\u4ef6\u3002</p>"},{"location":"scheduler_system/yarn/scheduler.html#web-ui","title":"\u901a\u8fc7web UI\u8fdb\u884c\u76d1\u63a7","text":"<p>http://*ResourceManager URL*/cluster/scheduler \u53ef\u4ee5\u67e5\u770b\u5f53\u524d\u5e94\u7528\uff0c\u961f\u5217\u548c\u5171\u4eab\u4efd\u989d\u3002</p> <p>\u5728web\u754c\u9762\u4e0a\uff0c\u53ef\u4ee5\u770b\u5230\u6bcf\u4e2a\u961f\u5217\u7684\u4ee5\u4e0b\u5b57\u6bb5\uff1a</p> <ul> <li>Used Resources - \u5206\u914d\u7ed9\u961f\u5217\u5185\u5bb9\u5668\u7684\u8d44\u6e90\u603b\u548c\u3002</li> <li>Num Active Applications - \u961f\u5217\u4e2d\u5df2\u63a5\u6536\u81f3\u5c11\u4e00\u4e2a\u5bb9\u5668\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u6570\u91cf\u3002</li> <li>Num Pending Applications - \u961f\u5217\u4e2d\u5c1a\u672a\u63a5\u6536\u5230\u4efb\u4f55\u5bb9\u5668\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u6570\u91cf\u3002</li> <li>Min Resources - \u4fdd\u8bc1\u961f\u5217\u914d\u7f6e\u7684\u6700\u5c0f\u8d44\u6e90\u3002</li> <li>Max Resources - \u5df2\u914d\u7f6e\u7684\u961f\u5217\u5141\u8bb8\u4f7f\u7528\u7684\u6700\u5927\u8d44\u6e90\u3002</li> <li>Instantaneous Fair Share - \u961f\u5217\u8d44\u6e90\u7684\u77ac\u65f6\u516c\u5e73\u5171\u4eab\u3002\u8fd9\u4e9b\u5171\u4eab\u53ea\u8003\u8651\u6d3b\u52a8\u961f\u5217(\u90a3\u4e9b\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u7684\u961f\u5217)\uff0c\u5e76\u7528\u4e8e\u8c03\u5ea6\u51b3\u7b56\u3002\u5f53\u5176\u4ed6\u961f\u5217\u4e0d\u4f7f\u7528\u4efd\u989d\u65f6\uff0c\u53ef\u4ee5\u4e3a\u961f\u5217\u5206\u914d\u8d85\u51fa\u5176\u5171\u4eab\u7684\u8d44\u6e90\u3002\u5982\u679c\u961f\u5217\u7684\u8d44\u6e90\u6d88\u8017\u5904\u4e8e\u6216\u4f4e\u4e8e\u5b83\u7684\u77ac\u65f6\u516c\u5e73\u5171\u4eab\uff0c\u90a3\u4e48\u5b83\u7684\u5bb9\u5668\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u62a2\u5360\u3002</li> <li>Steady Fair Share -\u961f\u5217\u4e2d\u8d44\u6e90\u7684\u7a33\u5b9a\u516c\u5e73\u7684\u4efd\u989d\u3002\u8fd9\u4e9b\u5171\u4eab\u4f1a\u8003\u8651\u6240\u6709\u961f\u5217\uff0c\u800c\u4e0d\u7ba1\u5b83\u4eec\u662f\u5426\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001(\u662f\u5426\u6709\u6b63\u5728\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f)\u3002\u8fd9\u4e9b\u8ba1\u7b97\u9891\u7387\u8f83\u4f4e\uff0c\u53ea\u6709\u5728\u914d\u7f6e\u6216\u5bb9\u91cf\u66f4\u6539\u65f6\u624d\u4f1a\u66f4\u6539\u3002\u5b83\u4eec\u65e8\u5728\u4e3a\u7528\u6237\u63d0\u4f9b\u5bf9\u9884\u671f\u8d44\u6e90\u7684\u53ef\u89c1\u6027\uff0c\u5e76\u56e0\u6b64\u663e\u793a\u5728Web UI\u4e2d\u3002</li> </ul>"},{"location":"scheduler_system/yarn/scheduler.html#_25","title":"\u961f\u5217\u4e2d\u79fb\u52a8\u5e94\u7528","text":"<p>Fair Scheduler\u652f\u6301\u5c06\u6b63\u5728\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u79fb\u52a8\u5230\u53e6\u4e00\u4e2a\u961f\u5217\u3002\u8fd9\u5bf9\u4e8e\u5c06\u91cd\u8981\u7684\u5e94\u7528\u7a0b\u5e8f\u79fb\u52a8\u5230\u9ad8\u4f18\u5148\u7ea7\u961f\u5217\u6216\u5c06\u4e0d\u91cd\u8981\u7684\u5e94\u7528\u7a0b\u5e8f\u79fb\u52a8\u5230\u4f4e\u4f18\u5148\u7ea7\u961f\u5217\u975e\u5e38\u6709\u7528\u3002</p> <pre><code> yarn application -movetoqueue appID -queue targetQueueName\n</code></pre> <p>\u5f53\u5e94\u7528\u7a0b\u5e8f\u79fb\u52a8\u5230\u961f\u5217\u65f6\uff0c\u5b83\u7684\u73b0\u6709\u5206\u914d\u5c06\u4e0e\u65b0\u961f\u5217\u7684\u5206\u914d\u4e00\u8d77\u8ba1\u7b97\uff0c\u800c\u4e0d\u662f\u4e0e\u65e7\u961f\u5217\u4e00\u8d77\u8ba1\u7b97\uff0c\u4ee5\u786e\u5b9a\u516c\u5e73\u6027\u3002\u5982\u679c\u5411\u961f\u5217\u4e2d\u6dfb\u52a0\u5e94\u7528\u7a0b\u5e8f\u7684\u8d44\u6e90\u4f1a\u8fdd\u53cd\u5176maxRunningApps\u6216maxResources\u7ea6\u675f\uff0c\u90a3\u4e48\u5c06\u5e94\u7528\u7a0b\u5e8f\u79fb\u52a8\u5230\u961f\u5217\u7684\u5c1d\u8bd5\u5c06\u4f1a\u5931\u8d25\u3002</p>"},{"location":"scheduler_system/yarn/scheduler.html#_26","title":"\u8f6c\u50a8\u516c\u5e73\u8c03\u5ea6\u7a0b\u5e8f\u72b6\u6001","text":"<p>\u516c\u5e73\u8c03\u5ea6\u7a0b\u5e8f\u80fd\u591f\u5b9a\u671f\u8f6c\u50a8\u5176\u72b6\u6001\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u7981\u7528\u7684\u3002\u53ef\u4ee5\u5c06<code>org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler.statedump</code>\u7684\u65e5\u5fd7\u754c\u522b\u6539\u4e3a<code>DEBUG</code>\u3002</p> <p>\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u516c\u5e73\u8c03\u5ea6\u7a0b\u5e8f\u7684\u65e5\u5fd7\u4f1a\u5b58\u50a8\u5230RM\u7684\u65e5\u5fd7\u6587\u4ef6\u4e2d\u3002\u516c\u5e73\u8c03\u5ea6\u7a0b\u5e8f\u72b6\u6001\u8f6c\u50a8\u53ef\u80fd\u4f1a\u751f\u6210\u5927\u91cf\u65e5\u5fd7\u6570\u636e\u3002\u5728log4j.properties\u4e2d\u53d6\u6d88\u6ce8\u91ca\"Fair scheduler state dump\"\u533a\u57df\u4f1a\u5c06\u65e5\u5fd7\u5199\u5230\u4e0d\u540c\u7684\u6587\u4ef6\u3002</p>"},{"location":"scheduler_system/yarn/scheduler.html#_27","title":"\u5b9e\u73b0","text":"<p>Capacity Scheduler\uff0c\u5b83\u6839\u636e\u5229\u7528\u7387\u5bf9\u961f\u5217\u8fdb\u884c\u6392\u5e8f\uff0c\u5e76\u9996\u5148\u5c06 containers \u5206\u914d\u7ed9\u5229\u7528\u7387\u6700\u4f4e\u7684\u961f\u5217\u3002\u96c6\u7fa4\u7684\u8c03\u5ea6\u901f\u5ea6\uff1a</p> <ul> <li>\u5047\u8bbe\u6709\u4e24\u4e2a\u961f\u5217 A \u548c B\uff0c A \u7684\u5229\u7528\u7387\u4e3a 10%\uff0cB \u7684\u5229\u7528\u7387\u4e3a 20%\uff0c\u8c03\u5ea6\u5668\u5c06\u9996\u5148\u4e3a\u961f\u5217 A \u8c03\u5ea6 containers\uff0c\u7136\u540e\u518d\u79fb\u52a8\u5230 B \u961f\u5217\uff0c\u5e76\u4e3a\u63d0\u4f9b\u5176\u670d\u52a1\uff1b</li> <li>\u5728\u5bb9\u5668\u6d41\u5931\u7387\u9ad8\u7684\u73af\u5883\u4e2d\u53ef\u80fd\u4f1a\u51fa\u73b0\u77ed\u6682\u7684\u6b7b\u9501\uff0c\u5728\u961f\u5217\u5229\u7528\u7387\u6536\u655b\u5e76\u4e14\u961f\u5217 A \u7684\u5229\u7528\u7387\u8d85\u8fc7\u961f\u5217 B \u4e4b\u524d\uff0c\u8c03\u5ea6\u7a0b\u5e8f\u4e0d\u4f1a\u63a5\u6536\u63d0\u4ea4\u5230\u961f\u5217 B \u7684\u5de5\u4f5c\u8d1f\u8f7d\uff1b</li> <li>Linkin\u7684PR\u6709\u6ca1\u6709\u88ab\u5408\u5e76\uff1f</li> </ul> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cYARN \u8d44\u6e90\u7ba1\u7406\u5668\u4f7f\u7528\u540c\u6b65\u8c03\u5ea6\uff1a</p> <ul> <li>\u8282\u70b9\u5fc3\u8df3\u5230\u8d44\u6e90\u7ba1\u7406\u5668\uff0c\u8fd9\u4f1a\u89e6\u53d1\u8c03\u5ea6\u5668\u5728\u8be5\u8282\u70b9\u4e0a\u8c03\u5ea6\u672a\u5b8c\u6210\u7684 container\uff1b</li> <li>\u5982\u679c container \u7684\u5206\u533a\u548c\u8282\u70b9\u7684\u5206\u533a\u4e0d\u5339\u914d\uff0c\u5219\u4e0d\u4f1a\u5728\u8be5\u8282\u70b9\u4e0a\u5206\u914d container\uff1b</li> <li>Linkin\u7684PR\u6709\u6ca1\u6709\u88ab\u5408\u5e76\uff1f</li> </ul>"},{"location":"scheduler_system/yarn/scheduler.html#33","title":"\u5168\u5c40\u8c03\u5ea6\uff083.3\u7248\u672c\u672a\u5b9e\u73b0\uff09","text":"<p>https://issues.apache.org/jira/browse/YARN-5139</p> <p>\u73b0\u6709\u7684\u8c03\u5ea6\u6a21\u5f0f\u662f\u57fa\u4e8eNM\uff08NodeManager\uff09\u7684\u5fc3\u8df3\u7684\u65b9\u5f0f\u8fdb\u884c\u8c03\u5ea6\u7684\uff08\u4e0d\u8003\u8651\u6301\u7eed\u8c03\u5ea6\u6a21\u5f0f\uff09\uff0c\u8fdb\u884c\u8c03\u5ea6\u65f6\uff0c\u4e00\u6b21\u53ea\u8003\u8651\u4e00\u4e2a\u8282\u70b9\uff0c\u8fd9\u5f88\u5bb9\u6613\u9020\u6210\u975e\u6700\u4f18\u7684\u8c03\u5ea6\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e00\u4e2a\u8bf7\u6c42\u8981\u5230\u7b2c100\u4e2a\u8282\u70b9\u7684\u5fc3\u8df3\u8fc7\u6765\u624d\u662f\u4ed6\u6700\u5408\u9002\u7684\u8282\u70b9\uff0c\u90a3\u4e48\u5f88\u53ef\u80fd\u5230\u4e2d\u95f4\u67d0\u4e00\u6b21\u5fc3\u8df3\u5c31\u5206\u7ed9\u4ed6\u8d44\u6e90\u4e86\uff0c\u4e0d\u662f\u4ed6\u6700\u6ee1\u610f\u7684\u8282\u70b9\u3002</p> <pre><code>// \u9996\u5148\u6536\u5230NM\u7684\u5fc3\u8df3\uff0c\u5982\u6709\u7a7a\u95f2Container\u5219\u8fdb\u884c\u8c03\u5ea6\uff0c\u8c03\u5ea6\u7684\u5c42\u6b21\u662f\u4ece\u7236\u961f\u5217\u5230\u5b50\u961f\u5217\uff0c\u518d\u5230\u5bf9\u5e94\u7684app\uff0c\u6700\u7ec8\u628a\u5e94\u8be5\u8c03\u5ea6\u7684\u8d44\u6e90\u8bf7\u6c42\u5728\u8be5\u5fc3\u8df3\u7684\u8282\u70b9\u4e0a\u8fdb\u884c\u8d44\u6e90\u5206\u914d\u3002\nfor node in allNodes:\n    Go to parentQueue\n    Go to leafQueue\n      for application in leafQueue.applications:\n        for resource-request in application.resource-requests\n          try to schedule on node\n</code></pre> <p>\u5168\u5c40\u8c03\u5ea6\u7684\u8c03\u5ea6\u903b\u8f91\u4e3a\uff08\u63d0\u51fa\u5019\u9009\u8282\u70b9\u7684\u6982\u5ff5\uff0c\u4e0d\u518d\u662f\u53ea\u8003\u8651\u5fc3\u8df3\u7684\u8282\u70b9\uff09\uff1a</p> <pre><code>Go to parentQueue\n  Go to leafQueue\n    for application in leafQueue.applications:\n      for resource-request in application.resource-requests\n        for node in nodes (node candidates sorted according to resource-request)\n          try to schedule on node\n</code></pre>"},{"location":"scheduler_system/yarn/write_applications.html","title":"Yarn Application","text":""},{"location":"scheduler_system/yarn/write_applications.html#_1","title":"\u539f\u751f","text":"<p>https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/WritingYarnApplications.html</p>"},{"location":"scheduler_system/yarn/write_applications.html#_2","title":"\u63a5\u53e3\u7c7b","text":"<ul> <li> <p>Client ** &lt;--&gt; ResourceManager** \uff1a<code>YarnClient</code> </p> </li> <li> <p>ApplicationMaster&lt;--&gt;ResourceManager</p> </li> <li> <p>\u901a\u8fc7 <code>AMRMClientAsync</code> \u5bf9\u8c61\uff0c\u901a\u8fc7 <code>AMRMClientAsync.CallbackHandler</code> \u5f02\u6b65\u5904\u7406\u4e8b\u4ef6\uff1b</p> </li> <li> <p><code>AMRMClient</code> \u5bf9\u8c61\uff0c\u901a\u8fc7 <code>allocate</code> \u51fd\u6570\u540c\u6b65\u83b7\u53d6\u5206\u914d\u7684container\uff1b</p> </li> <li> <p>ApplicationMaster&lt;--&gt;NodeManager</p> </li> </ul> <p>\u542f\u52a8Container\uff0c\u901a\u8fc7 <code>NMClientAsync</code> \u548cNodeManager\u901a\u4fe1\uff0c\u901a\u8fc7 <code>NMClientAsync.CallbackHandler</code>\u5904\u7406container\u4e8b\u4ef6</p> <p>\u66f4\u5e95\u5c42\u7684API\uff0c\u4e00\u822c\u4e0d\u63a8\u8350\u4f7f\u7528</p> <p>ApplicationClientProtocol \uff1aClient ** &lt;--&gt; ResourceManager**</p> <p>ApplicationMasterProtocol \uff1aApplicationMaster&lt;--&gt;ResourceManager</p> <p>ContainerManagementProtocol \uff1aApplicationMaster&lt;--&gt;NodeManager</p>"},{"location":"scheduler_system/yarn/write_applications.html#client","title":"Client","text":"<pre><code>// \u542f\u52a8YarnClient\nYarnClient yarnClient = YarnClient.createYarnClient();\nyarnClient.init(conf);\nyarnClient.start();\n// \u521b\u5efa\u5e94\u7528\uff0c\u83b7\u53d6\u5e94\u7528id\nYarnClientApplication app = yarnClient.createApplication();\nGetNewApplicationResponse appResponse = app.getNewApplicationResponse();\nApplicationSubmissionContext appContext = app.getApplicationSubmissionContext();\nApplicationId appId = appContext.getApplicationId();\n\n// \u6784\u5efa AM Container\nContainerLaunchContext amContainer = ContainerLaunchContext.newInstance(localResources, env, commands, null, null, null);\nappContext.setAMContainerSpec(amContainer);\n\n// \u63d0\u4ea4\u5e94\u7528\nyarnClient.submitApplication(appContext);\n</code></pre>"},{"location":"scheduler_system/yarn/write_applications.html#am","title":"AM","text":"<pre><code>String containerIdString = envs.get(ApplicationConstants.AM_CONTAINER_ID_ENV);\n// \u5f02\u6b65Client\uff0c\u914d\u7f6e CallBack\uff0c\u5904\u7406 onContainersAllocated \nAMRMClientAsync.CallbackHandler allocListener = new RMCallbackHandler();\namRMClient = AMRMClientAsync.createAMRMClientAsync(1000, allocListener);\namRMClient.init(conf);\namRMClient.start();\n\ncontainerListener = createNMCallbackHandler();\nnmClientAsync = new NMClientAsyncImpl(containerListener);\nnmClientAsync.init(conf);\nnmClientAsync.start();\n\n// \u6ce8\u518c AM\nappMasterHostname = NetUtils.getHostname();\nRegisterApplicationMasterResponse response = amRMClient.registerApplicationMaster(appMasterHostname, appMasterRpcPort,\n        appMasterTrackingUrl);\n\nList&lt;Container&gt; previousAMRunningContainers =  response.getContainersFromPreviousAttempts();\nint numTotalContainersToRequest =\n    numTotalContainers - previousAMRunningContainers.size();\n// \u8bf7\u6c42 RM \u5206\u914d Container\nfor (int i = 0; i &lt; numTotalContainersToRequest; ++i) {\n  // \u6784\u5efa ContainerRequest \n  ContainerRequest containerAsk = setupContainerAskForRM();\n  amRMClient.addContainerRequest(containerAsk);\n}\n// Keep looping until all the containers are launched and shell script executed on them ( regardless of success/failure).\n</code></pre> <pre><code>@Override\npublic void onContainersAllocated(List&lt;Container&gt; allocatedContainers) {\n  LOG.info(\"Got response from RM for container ask, allocatedCnt=\"\n      + allocatedContainers.size());\n  numAllocatedContainers.addAndGet(allocatedContainers.size());\n  for (Container allocatedContainer : allocatedContainers) {\n    // \u6784\u5efa ContainerLaunchContext \n    LaunchContainerRunnable runnableLaunchContainer =\n        new LaunchContainerRunnable(allocatedContainer, containerListener);\n    Thread launchThread = new Thread(runnableLaunchContainer);\n\n    // launch and start the container on a separate thread to keep\n    // the main thread unblocked\n    // as all containers may not be allocated at one go.\n    launchThreads.add(launchThread);\n    launchThread.start();\n  }\n}\n</code></pre>"},{"location":"scheduler_system/yarn/write_applications.html#unmanaged-am","title":"Unmanaged AM","text":"<p>YARN\u5f15\u5165\u4e86\u4e00\u79cd\u65b0\u7684ApplicationMaster\u2014Unmanaged AM\uff0c\u8fd9\u79cdAM\u8fd0\u884c\u5728\u5ba2\u6237\u7aef\uff0c\u4e0d\u518d\u7531ResourceManager\u542f\u52a8\u548c\u9500\u6bc1\uff08\u5373 RM \u4e0d\u5206\u914d AM\u8d44\u6e90\uff09\u3002</p> <p>Unmanaged AM\u8fd0\u884c\u6b65\u9aa4\u5982\u4e0b\uff1a\uff08\u5177\u4f53\u53ef\u53c2\u8003 Spark \u5bf9 Unmanaged AM \u7684\u4f7f\u7528\u6d41\u7a0b\uff09</p> <ul> <li>\u901a\u8fc7RPC\u51fd\u6570<code>ClientRMProtocol.getNewApplication()</code>\u83b7\u53d6\u4e00\u4e2aApplicationId</li> <li>\u521b\u5efa\u4e00\u4e2a<code>ApplicationSubmissionContext</code>\u5bf9\u8c61\uff0c\u586b\u5145\u5404\u4e2a\u5b57\u6bb5\uff0c\u5e76\u901a\u8fc7\u8c03\u7528\u51fd\u6570<code>ApplicationSubmissionContext.setUnmanagedAM(true)</code>\u542f\u7528Unmanaged AM\u3002</li> <li>\u901a\u8fc7RPC\u51fd\u6570<code>ClientRMProtocol.submitApplication()</code>\u5c06application\u63d0\u4ea4\u5230ResourceManage\u4e0a\uff0c\u5e76\u76d1\u63a7application\u8fd0\u884c\u72b6\u6001\uff0c\u76f4\u5230\u5176\u72b6\u6001\u53d8\u4e3a<code>YarnApplicationState.ACCEPTED</code>\u3002</li> <li>\u5728\u5ba2\u6237\u7aef\u4e2d\u7684\u4e00\u4e2a\u72ec\u7acb\u7ebf\u7a0b\u4e2d\u542f\u52a8 ApplicationMaster\uff0c\u7136\u540e\u7b49\u5f85ApplicationMaster\u8fd0\u884c\u7ed3\u675f\uff0c\u63a5\u7740\u518d\u7b49\u5f85ResourceManage\u62a5\u544aapplication\u8fd0\u884c\u7ed3\u675f\u3002</li> </ul>"},{"location":"scheduler_system/yarn/write_applications.html#skein","title":"\u7b2c\u4e09\u65b9skein","text":"<p>A tool(cli) and library (python) for easily deploying applications on Apache YARN.</p>"},{"location":"scheduler_system/yarn/write_applications.html#_3","title":"\u539f\u7406","text":"<p>Java \u5199\u7684 Driver \u670d\u52a1\uff0c\u4f5c\u4e3a Yarn Client \u8ddf Yarn RM\u901a\u4fe1\uff1b</p> <p>Java \u5199\u7684 Application Master \u670d\u52a1\uff1a</p> <ul> <li>\u8d1f\u8d23\u89e3\u6790 Skin App Yaml\uff0c\u5411Yarn\u7533\u8bf7/\u91ca\u653eContainer\uff0c\u540c\u65f6\u53ef\u4ee5\u8fd0\u884c\u4e00\u4e2a\u7528\u6237\u5b9a\u4e49\u7684\u8fdb\u7a0b\uff08application driver\uff09\uff1b</li> <li>\u5305\u542b KV Store\uff0c\u53ef\u7528\u4e8econtainer\u95f4\u4fe1\u606f\u5171\u4eab\u6216\u8005\u534f\u8c03\u72b6\u6001\u7b49\uff1b</li> </ul>"},{"location":"scheduler_system/yarn/write_applications.html#_4","title":"\u89c4\u8303","text":"<p>\u652f\u6301 Master \u548c Service\uff1b</p>"},{"location":"scheduler_system/yarn/write_applications.html#_5","title":"\u4f7f\u7528","text":"<ol> <li>\u5b89\u88c5</li> </ol> <pre><code>$ conda install -c conda-forge skein\n</code></pre> <ol> <li>\u542f\u52a8 driver\uff0c\u5168\u5c40driver\uff0c\u5982\u679c\u4e0d\u542f\u52a8\u5168\u5c40\uff0c\u5219\u6bcf\u6b21\u63d0\u4ea4\u65f6\u4f1a\u542f\u52a8\u4e34\u65f6\u7684driver\uff1b</li> </ol> <pre><code>$ skein driver start\n</code></pre> <ol> <li>\u5199\u5e94\u7528\u7a0b\u5e8f\u5b9a\u4e49</li> </ol> <pre><code>name: hello_world\nqueue: default\n\nmaster:\n  resources:\n    vcores: 1\n    memory: 512 MiB\n  script: |\n    sleep 60\n    echo \"Hello World!\"\n</code></pre> <ol> <li>\u63d0\u4ea4\u7a0b\u5e8f</li> </ol> <pre><code>$ skein application submit hello_world.yaml\n</code></pre>"},{"location":"scheduler_system/yarn/yarn_action.html","title":"Yarn\u5b9e\u6218\u4f18\u5316","text":"<p>Apache YARN \u5728 B \u7ad9\u7684\u4f18\u5316\u5b9e\u8df5</p>"},{"location":"scheduler_system/yarn/yarn_action.html#rm","title":"RM\u8c03\u5ea6\u4f18\u5316","text":"<p>Yarn\u8c03\u5ea6\u903b\u8f91\u4f2a\u7801\uff1a\uff08TODO\uff1aCheck\uff09</p> <ul> <li>\u8c03\u5ea6\u9501\u7684\u5360\u7528\u65f6\u95f4\u8fc7\u957f\uff0c</li> </ul> <pre><code>scheduler.lock\nsortNodes;\nfor( node : Nodes ) {\n   sortQueues;\n   for (queue : Queues) {\n     sortApps;\n     assignContainer;\n   }\n}\nscheduler.unlock\n</code></pre> <p>\u5fc3\u8df3\u9a71\u52a8\u8c03\u5ea6\uff08Heartbeat-Driven Scheduler\uff09\uff1aRM\u7ba1\u63a7\u7684\u8282\u70b9\u6570\u91cf\u8d85\u8fc74000\uff0c\u65e0\u6cd5\u5c06\u96c6\u7fa4\u7684\u5229\u7528\u7387\u6301\u7eed\u6253\u6ee1</p> <p>\u4f18\u5316\u601d\u8def\uff1aGlobal Scheduling\uff0cYARN-5139\uff0c\u672a\u89e3\u51b3</p> <ul> <li>\u591a\u7ebf\u7a0b\u8c03\u5ea6\uff1a\u201c\u63d0\u51faProposal\u201d\uff08\u591a\u7ebf\u7a0b\uff09\u3001\u201c\u6d88\u8d39Proposal\u201d\uff08\u5355\u7ebf\u7a0b\uff09</li> <li>\u6279\u91cf\u8282\u70b9\u8c03\u5ea6</li> </ul> <p></p>"},{"location":"scheduler_system/yarn/yarn_action.html#_1","title":"Yarn\u5b9e\u6218\u4f18\u5316","text":""},{"location":"scheduler_system/yarn/yarn_resource_model.html","title":"Yarn\u8d44\u6e90\u6a21\u578b\u548c\u81ea\u5b9a\u4e49\u8bbe\u5907\u63d2\u4ef6","text":""},{"location":"scheduler_system/yarn/yarn_resource_model.html#resource-model","title":"Resource Model","text":"<p>https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/ResourceModel.html</p> <p>YARN \u652f\u6301\u53ef\u6269\u5c55\u7684\u8d44\u6e90\u6a21\u578b\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cYARN\u4f1a\u8ddf\u8e2a\u6240\u6709\u8282\u70b9\uff0c\u5e94\u7528\u7a0b\u5e8f\u548c\u961f\u5217\u7684CPU\u548c\u5185\u5b58\uff0c\u4f46\u8d44\u6e90\u5b9a\u4e49\u53ef\u4ee5\u6269\u5c55\u4e3a\u5305\u542b\u4efb\u610f \u201ccountable\u201d \u8d44\u6e90\u3002</p>"},{"location":"scheduler_system/yarn/yarn_resource_model.html#_1","title":"\u81ea\u5b9a\u4e49\u8d44\u6e90\u7c7b\u578b","text":"<p>\u9488\u5bf9\u666e\u901a\u7684\u8d44\u6e90\u7c7b\u578b\uff0c\u4e0d\u9700\u8981\u88ab CGroup \u9694\u79bb\u3002</p> <p>resource-types.xml\uff08\u6240\u6709\u8282\u70b9\u90fd\u8981\u914d\u7f6e\uff09</p> <ul> <li>\u53c2\u6570\uff1a<code>yarn.resource-types</code>\uff0c\u9017\u53f7\u5206\u9694\u7684\u9644\u52a0\u8d44\u6e90\u5217\u8868\uff1b</li> <li>\u53c2\u6570\uff1a<code>yarn.resource-types.&lt;resource&gt;.units</code>\uff0c\u6307\u5b9a\u8d44\u6e90\u7c7b\u578b\u7684\u9ed8\u8ba4\u5355\u4f4d\uff1b</li> <li>\u53c2\u6570\uff1a<code>yarn.resource-types.&lt;resource&gt;.minimum-allocation</code>\uff0c\u6307\u5b9a\u8d44\u6e90\u7c7b\u578b\u7684\u6700\u5c0f\u8bf7\u6c42\uff1b</li> <li>\u53c2\u6570\uff1a<code>yarn.resource-types.&lt;resource&gt;.maximum-allocation</code>\uff0c\u6307\u5b9a\u8d44\u6e90\u7c7b\u578b\u7684\u6700\u5927\u8bf7\u6c42\uff1b</li> </ul> <p>node-resources.xml\uff08\u6240\u6709NM\u8282\u70b9\u90fd\u8981\u914d\u7f6e\uff09</p> <ul> <li>\u53c2\u6570\uff1a<code>yarn.nodemanager.resource-type.&lt;resource&gt;</code>\uff0c\u8282\u70b9\u7ba1\u7406\u5668\u4e2d\u53ef\u7528\u7684\u6307\u5b9a\u8d44\u6e90\u7684\u6570\u91cf\uff1b</li> </ul>"},{"location":"scheduler_system/yarn/yarn_resource_model.html#resource-profiles","title":"Resource Profiles","text":""},{"location":"scheduler_system/yarn/yarn_resource_model.html#_2","title":"\u914d\u7f6e","text":"<p>yarn-site.xml</p> <ul> <li><code>yarn.resourcemanager.resource-profiles.enabled</code>\uff0c\u662f\u5426\u542f\u7528\u8d44\u6e90\u914d\u7f6e\u6587\u4ef6\u652f\u6301\uff0c\u9ed8\u8ba4\u4e3a false\uff1b</li> <li><code>yarn.resourcemanager.resource-profiles.source-file</code>\uff1a\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff0c\u652f\u6301 json\uff1b</li> </ul> <p>resource-profiles.json</p> <ul> <li>minimum \u548c maximum \u662f\u4e0d\u53ef\u4ee5\u88ab\u5b9a\u4e49\uff0c\u5728<code>resource-types.xml</code>\u4e2d\u88ab\u5b9a\u4e49\uff1b</li> </ul> <pre><code>{\n    \"small\": {\n        \"memory-mb\" : 1024,\n        \"vcores\" : 1\n    },\n    \"default\" : {\n        \"memory-mb\" : 2048,\n        \"vcores\" : 2\n    },\n    \"large\" : {\n        \"memory-mb\": 4096,\n        \"vcores\" : 4\n    },\n    \"compute\" : {\n        \"memory-mb\" : 2048,\n        \"vcores\" : 2,\n        \"gpu\" : 1\n    }\n}\n</code></pre>"},{"location":"scheduler_system/yarn/yarn_resource_model.html#_3","title":"\u8bf7\u6c42","text":"<p>\u7533\u8bf7 AM \u65f6\u4e0d\u652f\u6301\u76f4\u63a5\u4f7f\u7528 Resource Profile\u3002</p> <ul> <li>\u53ef\u4ee5\u901a\u8fc7 YarnClient \u83b7\u53d6\u7279\u5b9a\u7684 Resource Profile\uff0c\u8f6c\u5316\u4e3a Resource\uff0c\u6784\u5efa ResourceRequest\uff1b</li> </ul> <p>AM \u5411 RM \u7533\u8bf7 Container \u65f6\uff1b</p> <ul> <li>ContainerRequest\uff1a\u53ef\u540c\u65f6\u6307\u5b9a Resource \u6216\u8005 ResourceProfile Name</li> <li>Resource \u4e2d\u7684\u8d44\u6e90\u4f1a\u8986\u76d6 Resource Profile \u4e2d\u7684\u5b9a\u4e49\uff1b</li> <li>SchedulingRequest\uff1a\u4e0d\u652f\u6301 Resource Profile\uff1b</li> </ul>"},{"location":"scheduler_system/yarn/yarn_resource_model.html#_4","title":"\u81ea\u5b9a\u4e49\u8bbe\u5907\u63d2\u4ef6","text":"<p>https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/PluggableDeviceFramework.html</p> <p>\u63d2\u4ef6\u5f0f\u7684\u9002\u914d\u652f\u6301\uff1a\u7528\u4e8e\u9700\u8981\u88ab Cgroup \u9694\u79bb\u7684\u8bbe\u5907\uff0c\u63d0\u4f9b\u901a\u7528\u7684\u89e3\u51b3\u65b9\u6848</p> <ul> <li>\u4f9d\u8d56 <code>LinuxContainerExecutor</code> \u8fdb\u884c Cgroup \u9694\u79bb</li> </ul>"},{"location":"scheduler_system/yarn/yarn_resource_model.html#_5","title":"\u914d\u7f6e","text":"<p><code>capacity-scheduler.xml</code></p> <pre><code>&lt;property&gt;\n  &lt;name&gt;yarn.scheduler.capacity.resource-calculator&lt;/name&gt;\n  &lt;value&gt;org.apache.hadoop.yarn.util.resource.DominantResourceCalculator&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p><code>yarn-site.xml</code>\uff1a\u5f00\u542f\u8bbe\u5907\u63d2\u4ef6\u6846\u67b6</p> <pre><code>&lt;property&gt;\n  &lt;name&gt;yarn.nodemanager.pluggable-device-framework.enabled&lt;/name&gt;\n  &lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\u81ea\u5b9a\u4e49\u8bbe\u5907\u8d44\u6e90\u548c\u5904\u7406\u7684\u7c7b\uff1a</p> <pre><code>&lt;property&gt;\n  &lt;name&gt;yarn.resource-types&lt;/name&gt;\n  &lt;value&gt;nvidia.com/gpu&lt;/value&gt;\n&lt;/property&gt;\n&lt;property&gt;\n  &lt;name&gt;yarn.nodemanager.pluggable-device-framework.device-classes&lt;/name&gt;            &lt;value&gt;org.apache.hadoop.yarn.server.nodemanager.containermanager.resourceplugin.com.nvidia.NvidiaGPUPluginForRuntimeV2&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> <p>\u901a\u8fc7<code>yarn node -list -showDetails</code>\u53ef\u4ee5\u67e5\u770b\u8bbe\u5907\u8d44\u6e90\u4fe1\u606f\u3002</p>"},{"location":"scheduler_system/yarn/yarn_resource_model.html#_6","title":"\u5f00\u53d1\u63d2\u4ef6","text":""},{"location":"scheduler_system/yarn/yarn_resource_model.html#_7","title":"\u63d2\u4ef6\u539f\u7406","text":""},{"location":"scheduler_system/yarn/yarn_resource_model.html#demo","title":"Demo","text":"<p>maven \u4f9d\u8d56</p> <pre><code>&lt;dependencies&gt;\n  &lt;dependency&gt;\n    &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;\n      &lt;artifactId&gt;hadoop-yarn-server-nodemanager&lt;/artifactId&gt;\n      &lt;version&gt;3.3.0&lt;/version&gt;\n      &lt;scope&gt;provided&lt;/scope&gt;\n  &lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre>"},{"location":"scheduler_system/yarn/yarn_service.html","title":"Yarn Service","text":"<p>\u4e00\u4e2a\u5bb9\u5668\u7f16\u6392\u5e73\u53f0\uff0c\u7528\u4e8e\u7ba1\u7406YARN\u4e0a\u7684\u5bb9\u5668\u5316\u670d\u52a1\u3002\u5b83\u65e2\u652f\u6301docker\u5bb9\u5668\uff0c\u4e5f\u652f\u6301\u4f20\u7edf\u7684\u57fa\u4e8e\u8fdb\u7a0b\u7684\u5bb9\u5668\u3002</p> <p>https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/yarn-service/YarnServiceAPI.html#Examples</p> <ul> <li>\u6267\u884c\u914d\u7f6e\u89e3\u6790\u548c\u6302\u8f7d\uff1b</li> <li>\u751f\u547d\u5468\u671f\u7ba1\u7406(\u5982\u505c\u6b62/\u542f\u52a8/\u5220\u9664\u670d\u52a1)\uff1b</li> <li>\u4f38\u7f29\u670d\u52a1\u7ec4\u4ef6\uff1b</li> <li>\u5728YARN\u4e0a\u6eda\u52a8\u5347\u7ea7\u670d\u52a1\uff1b</li> <li>\u76d1\u63a7\u670d\u52a1\u7684\u5065\u5eb7\u548c\u5c31\u7eea\u60c5\u51b5\u7b49\u7b49\u3002</li> </ul> <p>\u63d0\u4f9b Json \u914d\u7f6e\u6587\u4ef6\uff0c\u6765\u8fd0\u884cLong Time Service\uff0c\u4e0d\u9700\u8981\u5199\u590d\u6742\u7684AM\u3002</p> <ol> <li>\u4e00\u4e2a\u6838\u5fc3\u6846\u67b6\uff08AM\uff09\u626e\u6f14\u5bb9\u5668\u7f16\u6392\uff0c\u8d1f\u8d23\u6240\u6709\u7684\u670d\u52a1\u7684\u751f\u547d\u5468\u671f\u7ba1\u7406\u3002</li> <li>RESTful\u670d\u52a1\u5668\u7528\u4e8e\u7528\u6237\u4ea4\u4e92 \uff0c\u90e8\u7f72\u3001\u7ba1\u7406\u670d\u52a1\u3002</li> <li>DNS\u670d\u52a1\u4f9d\u8d56YARN Service Registry\u5141\u8bb8\u53d1\u73b0\u670d\u52a1\u3002</li> </ol>"},{"location":"scheduler_system/yarn/yarn_service.html#_1","title":"\u914d\u7f6e","text":"<p><code>yarn-site.xml</code></p> <pre><code>    &lt;property&gt;\n        &lt;description&gt;\n            Enable services rest api on ResourceManager.\n        &lt;/description&gt;\n        &lt;name&gt;yarn.webapp.api-service.enable&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/property&gt;\n</code></pre>"},{"location":"scheduler_system/yarn/yarn_service.html#cli","title":"CLI","text":"<pre><code># \u542f\u52a8\u4e00\u4e2aService\uff0c\u5bf9\u4e8e\u5f53\u524d\u7528\u6237\uff0cSERVICE_NAME\u5fc5\u987b\u552f\u4e00\n$ yarn app -launch ${SERVICE_NAME} ${PATH_TO_SERVICE_DEFINE_FILE}\n# \u5bf9Service\u7684\u7ec4\u4ef6\u8fdb\u884c\u6269\u5145/\u7f29\u51cf\uff0c\u652f\u6301\u7edd\u5bf9\u503c\u548c\u76f8\u5bf9\u503c(+2, -2)\n$ yarn app -flex ${SERVICE_NAME} -component ${COMPONENT_NAME} ${NUMBER_OF_CONTAINERS}\n# \u505c\u6b62\u670d\u52a1\n$ yarn app -stop ${SERVICE_NAME}\n# \u91cd\u542f\u4e00\u4e2a\u505c\u6389\u7684\u670d\u52a1\n$ yarn app -start ${SERVICE_NAME}\n# \u5220\u6389\u670d\u52a1\uff08\u4f1a\u5220\u9664HDFS\u8be5\u670d\u52a1\u7684\u76ee\u5f55\u4ee5\u53caYarn Service Registry\u8bb0\u5f55\n$ yarn app -destroy ${SERVICE_NAME}\n</code></pre>"},{"location":"scheduler_system/yarn/yarn_service.html#restful-api","title":"Restful API","text":"<p>\u89c1\u5b98\u7f51 http://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/yarn-service/QuickStart.html#Manage_services_on_YARN_via_REST_API</p>"},{"location":"scheduler_system/yarn/yarn_service.html#service-registrytodo","title":"\u670d\u52a1\u6ce8\u518c\uff08Service Registry\uff09TODO","text":""},{"location":"scheduler_system/yarn/yarn_service.html#service-discovery","title":"\u670d\u52a1\u53d1\u73b0\uff08Service Discovery)","text":"<p>DNS Server \u7684 DNS lookup \u5b9e\u73b0 Yarn \u4e0a\u7684\u670d\u52a1\u53d1\u73b0\uff0c\u6bd4\u5982HBase\u96c6\u7fa4\u90e8\u7f72\u5728Yarn\u4e0a\u65f6\u7684master-region\u901a\u4fe1\u3002</p> <ul> <li>container\u5206\u914d\u7684\u8282\u70b9\u662f\u968f\u673a\u7684\uff0c\u5728\u521b\u5efa\u65f6\u65e0\u6cd5\u6307\u5b9amaster/region\u5728\u54ea\u4e2a\u8282\u70b9\uff0c\u56e0\u6b64\u9700\u8981\u4e00\u79cd\u89c4\u8303\u673a\u5236\u3002</li> </ul> <p>\u6846\u67b6\u7684AM\u4f1a\u5c06Container\u7684\u4fe1\u606f\uff08\u5982hostname\u548cip\uff09\u6ce8\u518c\u5230Yarn Service Registry\uff0cDNS Server\u5c06Yarn Service Registry\u4e2d\u7684\u4fe1\u606f\u8f6c\u6362\u6210DNS record\uff0cClient\u5c31\u53ef\u4ee5\u901a\u8fc7\u6807\u51c6\u7684DNS\u67e5\u8be2\u53d1\u73b0container\u7684ip\u4fe1\u606f\u3002</p> <ul> <li>\u5bf9\u4e8e\u975eDocker\u5bb9\u5668\uff0c\u652f\u6301forward DNS lookup\uff0c\u4e0d\u652f\u6301 reverse DNS lookup\uff1b</li> <li>\u5bf9\u4e8eDocker\u5bb9\u5668\uff0c\u652f\u6301forward DNS lookup \u548c reverse DNS lookup\uff1b</li> <li>\u6b64\u5916\uff0cDNS\u652f\u6301\u914d\u7f6e static zone files \u8fdb\u884c forward\u548creverse lookup\uff1b</li> </ul>"},{"location":"scheduler_system/yarn/yarn_service.html#todo-registry-dns","title":"\u914d\u7f6e\uff08TODO-Registry DNS\uff09","text":""},{"location":"scheduler_system/yarn/yarn_service.html#_2","title":"\u7cfb\u7edf\u670d\u52a1","text":"<p>\u7cfb\u7edf\u670d\u52a1\u662f\u7ba1\u7406\u5458\u914d\u7f6e\u7684\u670d\u52a1\uff0c\u5728ResourceManager\u7684bootstrap\u8fc7\u7a0b\u4e2d\u81ea\u52a8\u90e8\u7f72\u3002</p> <pre><code>    &lt;property&gt;\n        &lt;name&gt;yarn.service.system-service.dir&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/property&gt;\n</code></pre> <p>YarnFiles\u914d\u7f6e\u6587\u4ef6\u5b58\u50a8\uff1a<code>${yarn.service.system-service.dir}/&lt;Launch-Mode&gt;/&lt;Users&gt;/&lt;Yarnfiles&gt;</code></p> <ul> <li>Launch-Mode \u5206\u4e3a <code>sync</code>\u548c<code>async</code>\uff1b</li> <li>Users \u6307\u7684\u64cd\u4f5c\u7cfb\u7edf\u7528\u6237\uff1b</li> <li>Yarnfiles\u6307\u7684\u662f\u914d\u7f6e\u6587\u4ef6\uff0c\u5fc5\u987b\u662f\u4ee5<code>.yarnfile</code>\u7ed3\u5c3e\uff1b</li> </ul>"},{"location":"scheduler_system/yarn/yarn_service.html#_3","title":"\u4f7f\u7528","text":""},{"location":"scheduler_system/yarn/yarn_service.html#_4","title":"\u914d\u7f6e\u6587\u4ef6","text":"<p><code>sleeper.json</code></p> <pre><code>{\n  \"name\": \"sleeper-service\",\n  \"version\": \"1.0\",\n  \"components\" : \n    [\n      {\n        \"name\": \"sleeper\",\n        \"number_of_containers\": 1,\n        \"launch_command\": \"sleep 900000\",\n        \"resource\": {\n          \"cpus\": 1, \n          \"memory\": \"256\"\n       },\n        \"configuration\": {\n          \"properties\": {\n            \"yarn.service.container-health-threshold.percent\": \"90\",\n            \"yarn.service.container-health-threshold.window-secs\": \"400\",\n            \"yarn.service.container-health-threshold.init-delay-secs\": \"800\"\n          }\n        }\n      }\n    ]\n}\n</code></pre> <p>\u542f\u52a8</p> <pre><code># launch a sleeper service named as my-sleeper on YARN.\n$ yarn app -launch my-sleeper sleeper\n</code></pre>"},{"location":"tools/DynamoRIO.html","title":"DynamoRIO","text":""},{"location":"tools/DynamoRIO.html#dynamorio","title":"DynamoRIO","text":"<p>\u7a0b\u5e8f\u8fd0\u884c\u65f6Trace\uff0cDynamoRIO\u662f\u4e00\u4e2a\u8fd0\u884c\u65f6\u4ee3\u7801\u63a7\u5236\u7cfb\u7edf\uff08runtime code manipulation system\uff09\uff0c\u652f\u6301\u7a0b\u5e8f\u8fd0\u884c\u65f6\u5bf9\u7a0b\u5e8f\u7684\u4efb\u4e00\u90e8\u5206\u8fdb\u884c\u4fee\u6539\u3002</p>"},{"location":"tools/conda.html","title":"Conda","text":"<p>conda \u662f\u4e00\u4e2a\u5305\u7ba1\u7406\u5668\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u5b83\u4e0d\u4ec5\u4ec5\u662f Python \u7684\u5305\u7ba1\u7406\u5668\uff0c\u800c\u662f\u4e00\u4e2a\u901a\u7528\u7684\u5305\u7ba1\u7406\u5668\uff0c\u5f53\u521d\u8bbe\u8ba1\u65f6\u88ab\u7528\u6765\u7ba1\u7406\u4efb\u4f55\u8bed\u8a00\u7684\u5305\u3002\u5728\u76ee\u524d\u6765\u770b\uff0cconda \u73af\u5883\u4e2d\u6240\u6709\u8bed\u8a00\u7684\u5305\u7ba1\u7406\uff0c\u90fd\u662f\u4e3a\u4e86 Python \u800c\u670d\u52a1\u7684\u3002</p> <p>Anaconda \u662f\u4e00\u4e2a Python \u7684\u53d1\u884c\u7248\uff0c\u5185\u7f6e\u4e86\u4f17\u591a Python \u5305\u548c\u9644\u52a0\u8f6f\u4ef6\uff08pydata \u751f\u6001\u5708\u91cc\u7684\u8f6f\u4ef6\uff09\uff0c\u6240\u4ee5 Anaconda \u81ea\u7136\u5185\u7f6e\u4e86 conda\u3002</p> <p>\u800c Miniconda \u5219\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6700\u5c0f\u7684 conda \u5b89\u88c5\u73af\u5883\uff0c\u5341\u5206\u5e72\u51c0\u8f7b\u5de7\u3002</p> <p>conda \u548c virtualenv \u90fd\u53ef\u4ee5\u521b\u5efa\u865a\u62df\u73af\u5883\uff0c\u8fdb\u884c Python \u8fd0\u884c\u73af\u5883\u7684\u9694\u79bb\u3002</p> <p>\u7531\u4e8e Conda \u7ba1\u7406\u4e0d\u540c\u7248\u672c\u7684 Python\uff0c\u662f\u628a Python \u89c6\u4e3a\u5305\u8fdb\u884c\u7ba1\u7406\u7684\uff0c\u6240\u4ee5\u8fd9\u91cc\u6307\u5b9a Python \u7248\u672c\uff0c\u76f8\u5f53\u4e8e\u6307\u5b9a\u4e86\u521d\u59cb\u5316 Conda \u73af\u5883\u7684\u5305</p>"},{"location":"tools/conda.html#_1","title":"\u6e90\u4fee\u6539","text":"<p>\u5177\u4f53\u53ef\u4ee5\u67e5\u770b https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/ \u914d\u7f6e\u66f4\u591achannel</p> <pre><code>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/\n</code></pre> <p>\u8bbe\u7f6e\u641c\u7d22\u65f6\u663e\u793a\u901a\u9053\u5730\u5740\uff1a</p> <pre><code>conda config --set show_channel_urls yes\n</code></pre>"},{"location":"tools/conda.html#_2","title":"\u73af\u5883\u9694\u79bb","text":"<ul> <li>Conda create \u521b\u5efa\u7684\u73af\u5883\uff0c\u4f1a\u5728 Conda \u5b89\u88c5\u76ee\u5f55\u4e0b\u8fdb\u884c\u96c6\u4e2d\u7ba1\u7406</li> </ul> <pre><code>conda create -n $NAME_OF_ENV python=3.7\n\nconda install package_name\n\nconda env list\n\nconda activate $ENV_NAME\n\nconda deactivate\n\nconda remove -n your_env_name --all\n</code></pre>"},{"location":"tools/file_watch.html","title":"\u6587\u4ef6\u76d1\u63a7","text":""},{"location":"tools/file_watch.html#java","title":"Java","text":"<p>\u91c7\u7528commons-io</p> <pre><code>&lt;dependency&gt;\n  &lt;groupId&gt;commons-io&lt;/groupId&gt;\n  &lt;artifactId&gt;commons-io&lt;/artifactId&gt;\n  &lt;version&gt;2.6&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u901a\u8fc7\u5b9e\u73b0\u7c7b FileAlterationListener \u6216\u8005\u7ee7\u627f FileAlterationListenerAdaptor\uff0c\u901a\u8fc7\u89c2\u5bdf\u8005\u6a21\u5f0f\uff0c\u5b9e\u73b0\u5bf9\u6587\u4ef6\u4fee\u6539\u7b49\u4e8b\u4ef6\u7684\u5904\u7406\u3002</p> <pre><code>// \u521b\u5efa\u8fc7\u6ee4\u5668\nIOFileFilter directories = FileFilterUtils.and(FileFilterUtils.directoryFileFilter(),HiddenFileFilter.VISIBLE);\nIOFileFilter files       = FileFilterUtils.and(FileFilterUtils.fileFileFilter(),FileFilterUtils.suffixFileFilter(\".txt\"));\nIOFileFilter filter = FileFilterUtils.or(directories, files);\n\n// \u6784\u9020\u89c2\u5bdf\u7c7b\u4e3b\u8981\u63d0\u4f9b\u8981\u89c2\u5bdf\u7684\u6587\u4ef6\u6216\u76ee\u5f55\uff0c\u5f53\u7136\u8fd8\u6709\u8be6\u7ec6\u4fe1\u606f\u7684filter\nFileAlterationObserver observer = new FileAlterationObserver(\"f:/1\", filter);\n\nFileListenerAdaptor listener = new FileListenerAdaptor();\n// \u4e3a\u89c2\u5bdf\u5bf9\u8c61\u6dfb\u52a0\u76d1\u542c\u5bf9\u8c61\nobserver.addListener(listener);\n// \u914d\u7f6eMonitor\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u5355\u4f4d\u662f\u6beb\u79d2\uff0c\u662f\u76d1\u542c\u7684\u95f4\u9694\uff1b\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u662f\u7ed1\u5b9a\u6211\u4eec\u4e4b\u524d\u7684\u89c2\u5bdf\u5bf9\u8c61\uff08\u652f\u6301\u591a\u4e2a\uff09\u3002\nFileAlterationMonitor fileMonitor = new FileAlterationMonitor(10000, observer);\n// \u542f\u52a8\u5f00\u59cb\u76d1\u542c\nfileMonitor.start();\n</code></pre> <p>\u66f4\u52a0\u8be6\u7ec6\u6587\u4ef6\u3001\u76ee\u5f55\u7684\u4e8b\u4ef6\u89e6\u53d1\u673a\u5236\uff0cTODO</p>"},{"location":"tools/file_watch.html#python","title":"Python","text":"<p>\u91c7\u7528\u8de8\u5e73\u53f0\u7684watchdog\uff0c pip install watchdog</p> <pre><code>import time\nfrom watchdog.observers import Observer\nfrom watchdog.events import FileSystemEventHandler\n\nclass MyHandler(FileSystemEventHandler):\n    def on_moved(self, event):\n        super(MyHandler, self).on_moved(event)\n\n    def on_deleted(self, event):\n        super(MyHandler, self).on_deleted(event)\n\n    def on_modified(self, event):\n        super(MyHandler, self).on_modified(event)\n\n    def on_created(self, event):\n        super(MyHandler, self).on_moved(event)\n\nif __name__ == \"__main__\":\n    event_handler = MyHandler()\n    observer = Observer()\n    observer.schedule(event_handler, path='.', recursive=False)\n    observer.start()\n    try:\n        while True:\n            time.sleep(1)\n    except KeyboardInterrupt:\n        observer.stop()\n    observer.join()\n</code></pre>"},{"location":"tools/idea.html","title":"\u5f00\u53d1\u5de5\u5177","text":""},{"location":"tools/idea.html#vscode","title":"VSCode","text":"<p>\u672c\u5730\u548c\u8fdc\u7a0b\u5f00\u53d1\u3002</p>"},{"location":"tools/idea.html#jetbrains-gateway","title":"JetBrains Gateway","text":"<p>\u8fdc\u7a0b\u5f00\u53d1</p>"},{"location":"tools/idea.html#fleet","title":"Fleet","text":"<p>\u7c7b\u4f3c VSCode.</p>"},{"location":"tools/idea.html#ideajavascala","title":"IDEA\uff08Java/Scala\uff09","text":"<p>maven helper </p> <ul> <li>\u67e5\u770b maven\u6811\u5f62\u4f9d\u8d56\u4ee5\u53ca\u51b2\u7a81\u3002</li> </ul> <p>SequenceDiagram</p> <ul> <li>\u81ea\u52a8\u751f\u6210\u9879\u76ee\u8c03\u7528\u7684\u65f6\u5e8f\u56fe</li> </ul> <p>BytecodeViewer\u3001jclasslib </p> <ul> <li>\u5b57\u8282\u7801\u67e5\u770b\u5668</li> </ul> <p>Edit Bytecode</p> <ul> <li>\u5b57\u8282\u7801\u7f16\u8f91\u5de5\u5177\uff1a</li> </ul> <p>Statistic</p> <ul> <li>\u4ee3\u7801\u884c\u6570\u3001\u6ce8\u91ca\u884c\u6570\u7edf\u8ba1\u5de5\u5177\uff1b</li> </ul>"},{"location":"tools/idea.html#clionc","title":"CLION\uff08C++\uff09","text":""},{"location":"tools/idea.html#include","title":"include\u7b2c\u4e09\u65b9\u5934\u6587\u4ef6","text":"<p>\u5982jni.h\uff0c\u9700\u8981\u5728CMakeList.txt\u4e2d\u5305\u542b\uff0c\u6ce8\u610f\u7a7a\u683c\u548c\u5f15\u53f7</p> <p>include_directories(\"D:/Program Files/Java/jdk1.8.0_211/include\")</p> <p>include_directories(\"D:/Program Files/Java/jdk1.8.0_211/include/win32\")</p>"},{"location":"tools/idea.html#pycharmpython","title":"PyCharm\uff08Python\uff09","text":"<ul> <li>pycharm\u6dfb\u52a0\u6587\u4ef6\u5934\u6ce8\u91ca</li> </ul> <p>File-&gt;settings-&gt;Editor-&gt;File and Code Templates-&gt;Python Script</p> <p>\u6dfb\u52a0\u4ee5\u4e0b\u4ee3\u7801\uff1a</p> <pre><code>#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# @Time  : ${DATE} ${TIME}\n# @Author : Aries\n# @Site  : ${SITE}\n# @File  : ${NAME}.py\n# @Software: ${PRODUCT_NAME}\n</code></pre>"},{"location":"tools/idea.html#golandgo","title":"GoLand\uff08GO\uff09","text":""},{"location":"tools/idea.html#_2","title":"\u95ee\u9898","text":""},{"location":"tools/idea.html#testclass-not-found","title":"\u8fd0\u884cTest\uff0c\u4e0d\u751f\u6210\u5bf9\u5e94\u7684\u6d4b\u8bd5\u4ee3\u7801\uff0c\u62a5Class Not Found\uff01","text":"<p>\u5728\u591a\u9879\u76ee\u7ed3\u6784\u4e2d\uff0c\u6ce8\u610f\u7236pom\uff08packaging\u662fpom\uff09\u7684\u914d\u7f6e\uff0c\u4e0d\u5e94\u8be5\u914d\u7f6e<code>source</code>\u7b49\uff0c\u66f4\u4e0d\u80fd\u8ddfserver\u7b49\u5b50module\u4e00\u6837\u3002</p> <p></p>"},{"location":"tools/inter_vtune.html","title":"Intel Vtune","text":"<p>\u7528\u4e8e\u4e32\u884c\u548c\u591a\u7ebf\u7a0b\u5e94\u7528\u7a0b\u5e8f\u7684\u6027\u80fd\u5206\u6790\u5de5\u5177.</p> <p>https://software.intel.com/en-us/vtune-install-guide-linux-user-interface-install#7A6B784C-7E0C-4034-982A-5879CE460832</p> <p>\u6267\u884c</p> <pre><code>./vtune_profiler/bin64/vtune-gui\n</code></pre>"},{"location":"tools/licenses.html","title":"\u5f00\u6e90\u534f\u8bae\u58f0\u660e","text":"<p>[toc]</p>"},{"location":"tools/licenses.html#_1","title":"\u5f00\u6e90\u534f\u8bae\u8bf4\u660e","text":""},{"location":"tools/licenses.html#agpl-affero-general-public-license","title":"AGPL \u534f\u8bae\uff08Affero General Public License\uff09","text":"<p>GPL\uff082.x ~ 3.x\uff09 \u534f\u8bae\u8fd8\u6709\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u201c\u6f0f\u6d1e\u201d\uff0c\u5c31\u662f\u8f6f\u4ef6\u201c\u53d1\u5e03\u201d \u624d\u5fc5\u987b\u5f00\u6e90\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u7684\u8f6f\u4ef6\u4e0d\u53d1\u5e03\uff0c\u5373\u4f7f\u4f7f\u7528 GPL (2.x ~ 3.x) \u4e5f\u53ef\u4ee5\u4e0d\u7528\u5f00\u6e90\u3002</p> <p>\u5728GPL\u4e0a\u589e\u52a0\u4e00\u6761\u9650\u5236\uff1a\u5982\u679c\u4f7f\u7528AGPL\u8bb8\u53ef\u7684\u8f6f\u4ef6\u4e0e\u7528\u6237\u901a\u8fc7\u7f51\u7edc\u8fdb\u884c\u4ea4\u4e92\uff0c\u4e5f\u9700\u8981\u63d0\u4f9b\u6e90\u4ee3\u7801\u7ed9\u7528\u6237\uff0c\u6240\u6709\u7684\u4fee\u6539\u4e5f\u8981\u7ed9\u7528\u6237\u3002</p>"},{"location":"tools/mkdocs.html","title":"mkdocs","text":"<p>\u4e00\u822c\u4f7f\u7528 material \u6837\u5f0f\u3002</p>","tags":["mkdocs"]},{"location":"tools/mkdocs.html#_1","title":"\u5b89\u88c5","text":"<pre><code>pip install mkdocs-material -i https://pypi.tuna.tsinghua.edu.cn/simple\npip install mkdocs-material -i https://pypi.tuna.tsinghua.edu.cn/simple\n</code></pre>","tags":["mkdocs"]},{"location":"tools/mkdocs.html#_2","title":"\u914d\u7f6e","text":"","tags":["mkdocs"]},{"location":"tools/mkdocs.html#github","title":"\u914d\u7f6e Github \u4ed3\u5e93\u94fe\u63a5","text":"<pre><code>repo_url: https://github.com/xliuqq/blog_md\nrepo_name: xliuqq/blog_md\ntheme:\n    icon:\n        repo: fontawesome/brands/github\n</code></pre>","tags":["mkdocs"]},{"location":"tools/mkdocs.html#_3","title":"\u591a\u8bed\u8a00\u652f\u6301","text":"<p>https://squidfunk.github.io/mkdocs-material/setup/changing-the-language/#site-language-selector</p> <pre><code>extra:\n  alternate:\n    - name: English\n      link: /en/ \n      lang: en\n    - name: Deutsch\n      link: /zh/\n      lang: zh\n</code></pre>","tags":["mkdocs"]},{"location":"tools/mkdocs.html#_4","title":"\u56fe\u7247","text":"<p>\u901a\u8fc7\u5728<code>docs</code>\u5efa\u7acb<code>img</code>\u76ee\u5f55\uff0c\u91cc\u9762\u653e\u5165\u56fe\u7247\uff0c\u5728md\u6587\u4ef6\u4e2d\u901a\u8fc7<code>img/a.png</code>\u5f15\u5165\u3002</p> <p>\u901a\u8fc7 <code>&lt;img&gt;</code>\u6807\u7b7e\u5f15\u5165\u65f6\uff0c\u9700\u8981\u8fdb\u884c\u5982\u4e0b\u8bbe\u7f6e\uff1a</p> <ul> <li>\u76f8\u5173\u95ee\u9898\u548c\u89e3\u91ca\u53ef\u89c1\uff1amarkdown - configuring image filepaths correctly in mkdocs - Stack Overflow</li> </ul> <pre><code># \u6839\u7ea7\u522b\nuse_directory_urls: false\n</code></pre>","tags":["mkdocs"]},{"location":"tools/mkdocs.html#pymdown-extensions","title":"PyMdown Extensions","text":"<p>python markdown \u63d2\u4ef6\uff0c\u652f\u6301\u66f4\u591a\u7684markdown\u683c\u5f0f\u3002</p> <pre><code>markdown_extensions:\n  - pymdownx.highlight:\n      anchor_linenums: true\n  - pymdownx.inlinehilite\n  - pymdownx.snippets\n  - pymdownx.superfences\n</code></pre> <p>snippets:</p> <ul> <li>adds the ability to embed content from arbitrary files into a document,</li> </ul>","tags":["mkdocs"]},{"location":"tools/mkdocs.html#mathjax","title":"\u6570\u5b66\u516c\u5f0fMathJax","text":"<p><code>mkdocs.yaml</code></p> <pre><code>markdown_extensions:\n  - pymdownx.arithmatex:\n      generic: true\n\nextra_javascript:\n  - javascripts/mathjax.js\n  - https://polyfill.io/v3/polyfill.min.js?features=es6\n  - https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\n</code></pre> <p><code>javascripts/mathjax.js</code></p> <pre><code>window.MathJax = {\n  tex: {\n    inlineMath: [[\"\\\\(\", \"\\\\)\"]],\n    displayMath: [[\"\\\\[\", \"\\\\]\"]],\n    processEscapes: true,\n    processEnvironments: true\n  },\n  options: {\n    ignoreHtmlClass: \".*|\",\n    processHtmlClass: \"arithmatex\"\n  }\n};\n\ndocument$.subscribe(() =&gt; { \n  MathJax.typesetPromise()\n})\n</code></pre>","tags":["mkdocs"]},{"location":"tools/mkdocs.html#diagrams","title":"Diagrams","text":"<p>\u652f\u6301 mermaid</p> <pre><code>markdown_extensions:\n  - pymdownx.superfences:\n      custom_fences:\n        - name: mermaid\n          class: mermaid\n          format: !!python/name:pymdownx.superfences.fence_code_format\n</code></pre>","tags":["mkdocs"]},{"location":"tools/mkdocs.html#tabbed","title":"Tabbed","text":"<p>\u914d\u7f6e</p> <pre><code>markdown_extensions:\n  - pymdownx.superfences\n  - pymdownx.tabbed:\n      alternate_style: true \n</code></pre> CC++ <pre><code>#include &lt;stdio.h&gt;\n\nint main(void) {\n  printf(\"Hello world!\\n\");\n  return 0;\n}\n</code></pre> <pre><code>#include &lt;iostream&gt;\n\nint main(void) {\n  std::cout &lt;&lt; \"Hello world!\" &lt;&lt; std::endl;\n  return 0;\n}\n</code></pre>","tags":["mkdocs"]},{"location":"tools/mkdocs.html#plugins","title":"plugins","text":"<p>\u96c6\u5408\u5217\u8868</p> <p>https://github-wiki-see.page/m/mkdocs/mkdocs/wiki/MkDocs-Plugins#navigation--page-building</p>","tags":["mkdocs"]},{"location":"tools/mkdocs.html#search","title":"search\uff08\u5185\u7f6e\uff09","text":"<p>https://www.mkdocs.org/</p> <p>\u91c7\u7528lunr\u8fdb\u884c\u4e2d\u6587\u641c\u7d22\uff0c\u5f53\u524d\u4e0d\u652f\u6301\u4e2d\u6587\uff082021-05-17\uff09\u3002</p>","tags":["mkdocs"]},{"location":"tools/mkdocs.html#mkdocs-markdownextradata-plugin","title":"mkdocs-markdownextradata-plugin","text":"<p>A MkDocs plugin that injects the mkdocs.yml extra variables into the markdown template\u3002</p>","tags":["mkdocs"]},{"location":"tools/mkdocs.html#mkdocs-git-revision-date-localized-plugin","title":"mkdocs-git-revision-date-localized-plugin","text":"<p>support for adding the date of last update and creation of a document at the bottom of each page</p>","tags":["mkdocs"]},{"location":"tools/mkdocs.html#_5","title":"\u535a\u5ba2\u652f\u6301","text":"<p>https://squidfunk.github.io/mkdocs-material/setup/setting-up-a-blog/#posts</p>","tags":["mkdocs"]},{"location":"tools/qrcode.html","title":"\u4e8c\u7ef4\u7801","text":"<p>\u4e8c\u7ef4\u7801\u53c8\u79f0QR Code\uff0cQR\u5168\u79f0Quick Response</p> <p></p>"},{"location":"tools/ssh_pass.html","title":"SSH Pass","text":"<p>Linux\u9ed8\u8ba4\u7684SSH\u662f\u4e0d\u652f\u6301\u901a\u8fc7\u5bc6\u7801\u4f5c\u4e3a\u53c2\u6570\u8fdb\u884c\u767b\u5f55\uff1b</p> <p>https://sourceforge.net/p/sshpass/code-git/ci/main/tree/</p>"},{"location":"tools/supervisor.html","title":"Supervisor: A Process Control System","text":"<p>Supervisor is a client/server system that allows its users to control a number of processes on UNIX-like operating systems.</p> <p>\u4e00\u4e2aPython\u5f00\u53d1\u7684\u901a\u7528\u7684\u8fdb\u7a0b\u7ba1\u7406\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u7ba1\u7406\u548c\u76d1\u63a7Linux\u4e0a\u9762\u7684\u8fdb\u7a0b\uff0c\u80fd\u5c06\u4e00\u4e2a\u666e\u901a\u7684\u547d\u4ee4\u884c\u8fdb\u7a0b\u53d8\u4e3a\u540e\u53f0daemon\uff0c\u5e76\u76d1\u63a7\u8fdb\u7a0b\u72b6\u6001\uff0c\u5f02\u5e38\u9000\u51fa\u65f6\u80fd\u81ea\u52a8\u91cd\u542f\uff0c\u4f46\u5b83\u4e0d\u80fd\u7ba1\u7406\u539f\u672c\u5c31\u662fdaemon\u7684\u8fdb\u7a0b\u3002</p>"},{"location":"tools/supervisor.html#_1","title":"\u5b89\u88c5","text":"<pre><code>pip install supervisor\n</code></pre> <p>\u751f\u6210\u4e09\u4e2a\u6267\u884c\u7a0b\u5e8f\uff1a</p> <ul> <li>supervisortd \uff1asupervisor\u7684\u5b88\u62a4\u8fdb\u7a0b\u670d\u52a1\uff08\u7528\u4e8e\u63a5\u6536\u8fdb\u7a0b\u7ba1\u7406\u547d\u4ee4\uff09</li> <li>supervisorctl \uff1a\u5ba2\u6237\u7aef\uff08\u7528\u4e8e\u548c\u5b88\u62a4\u8fdb\u7a0b\u901a\u4fe1\uff0c\u53d1\u9001\u7ba1\u7406\u8fdb\u7a0b\u7684\u6307\u4ee4\uff09</li> <li>echo_supervisord_conf \uff1a\u751f\u6210\u521d\u59cb\u914d\u7f6e\u6587\u4ef6\u7a0b\u5e8f</li> </ul>"},{"location":"tools/supervisor.html#_2","title":"\u914d\u7f6e","text":""},{"location":"tools/supervisor.html#supervisor","title":"supervisor\u914d\u7f6e","text":"<p>\u521b\u5efa\u76ee\u5f55\uff0c\u521d\u59cb\u5316\u914d\u7f6e\u6587\u4ef6\uff0c\u914d\u7f6e\u6587\u4ef6\u7684\u641c\u7d22\u8def\u5f84\u5982\u4e0b\uff1a</p> <ul> <li><code>../etc/supervisord.conf</code> (Relative to the executable)</li> <li><code>../supervisord.conf</code> (Relative to the executable)</li> <li><code>CWD/supervisord.conf</code>(Current Work Directory)</li> <li><code>CWD/etc/supervisord.conf</code></li> <li>`/etc/supervisord.conf</li> <li><code>/etc/supervisor/supervisord.conf (since Supervisor 3.3.0)</code></li> </ul> <pre><code>mkdir /etc/supervisor \necho_supervisord_conf &gt;  /etc/supervisor/supervisord.conf\n</code></pre> <p>\u4e3b\u914d\u7f6e\u6587\u4ef6\u53c2\u6570</p> <pre><code>[unix_http_server]\nfile=/tmp/supervisor.sock   ; UNIX socket \u6587\u4ef6\uff0csupervisorctl \u4f1a\u4f7f\u7528\n;chmod=0700                 ; socket \u6587\u4ef6\u7684 mode\uff0c\u9ed8\u8ba4\u662f 0700\n;chown=nobody:nogroup       ; socket \u6587\u4ef6\u7684 owner\uff0c\u683c\u5f0f\uff1a uid:gid\n\n;[inet_http_server]         ; HTTP \u670d\u52a1\u5668\uff0c\u63d0\u4f9b web \u7ba1\u7406\u754c\u9762\n;port=127.0.0.1:9001        ; Web \u7ba1\u7406\u540e\u53f0\u8fd0\u884c\u7684 IP \u548c\u7aef\u53e3\uff0c\u5982\u679c\u5f00\u653e\u5230\u516c\u7f51\uff0c\u9700\u8981\u6ce8\u610f\u5b89\u5168\u6027\n;username=user              ; \u767b\u5f55\u7ba1\u7406\u540e\u53f0\u7684\u7528\u6237\u540d\n;password=123               ; \u767b\u5f55\u7ba1\u7406\u540e\u53f0\u7684\u5bc6\u7801\n\n[supervisord]\nlogfile=/tmp/supervisord.log ; \u65e5\u5fd7\u6587\u4ef6\uff0c\u9ed8\u8ba4\u662f $CWD/supervisord.log\nlogfile_maxbytes=50MB        ; \u65e5\u5fd7\u6587\u4ef6\u5927\u5c0f\uff0c\u8d85\u51fa\u4f1a rotate\uff0c\u9ed8\u8ba4 50MB\nlogfile_backups=10           ; \u65e5\u5fd7\u6587\u4ef6\u4fdd\u7559\u5907\u4efd\u6570\u91cf\u9ed8\u8ba4 10\nloglevel=info                ; \u65e5\u5fd7\u7ea7\u522b\uff0c\u9ed8\u8ba4 info\uff0c\u5176\u5b83: debug,warn,trace\npidfile=/tmp/supervisord.pid ; pid \u6587\u4ef6\nnodaemon=false               ; \u662f\u5426\u5728\u524d\u53f0\u542f\u52a8\uff0c\u9ed8\u8ba4\u662f false\uff0c\u5373\u4ee5 daemon \u7684\u65b9\u5f0f\u542f\u52a8\nminfds=1024                  ; \u53ef\u4ee5\u6253\u5f00\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u6700\u5c0f\u503c\uff0c\u9ed8\u8ba4 1024\nminprocs=200                 ; \u53ef\u4ee5\u6253\u5f00\u7684\u8fdb\u7a0b\u6570\u7684\u6700\u5c0f\u503c\uff0c\u9ed8\u8ba4 200\n\n; the below section must remain in the config file for RPC\n; (supervisorctl/web interface) to work, additional interfaces may be\n; added by defining them in separate rpcinterface: sections\n[rpcinterface:supervisor]\nsupervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface\n\n[supervisorctl]\nserverurl=unix:///tmp/supervisor.sock ; \u901a\u8fc7 UNIX socket \u8fde\u63a5 supervisord\uff0c\u8def\u5f84\u4e0e unix_http_server \u90e8\u5206\u7684 file \u4e00\u81f4\n;serverurl=http://127.0.0.1:9001 ; \u901a\u8fc7 HTTP \u7684\u65b9\u5f0f\u8fde\u63a5 supervisord\n\n; \u5305\u542b\u5176\u4ed6\u7684\u914d\u7f6e\u6587\u4ef6\n[include]\nfiles = /etc/supervisor.d/*.conf    ; \u53ef\u4ee5\u662f *.conf \u6216 *.ini\n</code></pre>"},{"location":"tools/supervisor.html#rpcinterface","title":"rpcinterface","text":"<p>\u5b9a\u5236rpc\u7684\u5b9e\u73b0\uff0c\u6210\u5458\u51fd\u6570\u53ef\u4ee5\u901a\u8fc7<code>xmlrpc.client</code>\u8fdb\u884cRPC\u8c03\u7528\u3002</p> <pre><code>[rpcinterface:deployment]\ndata_dirs=/home/work/data\nsupervisor.rpcinterface_factory = deployment.rpcinterface:deployment_rpcinterface\n</code></pre> <p>client\u8c03\u7528\uff1a</p> <pre><code>self.proxy = xmlrpclib.ServerProxy('http://%s:%s@%s:%d' % (user, passwd, host, port))\nmessage = self.proxy.deployment.stop(self.service, self.cluster, self.job, dict())\n</code></pre>"},{"location":"tools/supervisor.html#_3","title":"\u76d1\u63a7\u8fdb\u7a0b\u7684\u914d\u7f6e","text":"<p>\u5728<code>/etc/supervisord.d/</code>\u76ee\u5f55\u4e0b\u65b0\u589e\u4e00\u4e2aconf\u6587\u4ef6</p> <pre><code>[program:project_name]\ndirectory = \u5de5\u4f5c\u76ee\u5f55\ncommand = \u811a\u672c\u7684\u542f\u52a8\u547d\u4ee4\nautostart = true\nautorestart = true\nuser = loanward\nstdout_logfile = /data/log/pro_stdout.log\n</code></pre> <ol> <li>project_name \u5fc5\u987b\u662f\u552f\u4e00\u7684\uff0c\u5426\u5219\u5c06\u4f1a\u51fa\u73b0\u9519\u4e71</li> <li>directory \u586b\u5199\u4f60\u542f\u52a8\u811a\u672c\u65f6\u7684\u5de5\u4f5c\u76ee\u5f55\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u811a\u672c\u7684\u7edd\u5bf9\u76ee\u5f55\uff0c\u90a3\u4e48directory\u53ef\u4ee5\u4e0d\u8bbe\u7f6e</li> <li>command\u662f\u6267\u884c\u811a\u672c\u7684\u547d\u4ee4\uff0c\u4e0d\u9700\u8981\u4f7f\u7528nohup\u8ba9\u5176\u53d8\u4e3a\u540e\u4ee3\u8fdb\u7a0b\uff0csupervisor\u4f1a\u81ea\u52a8\u5c06\u5176\u53d8\u4e3a\u540e\u53f0\u8fdb\u7a0b</li> <li>autostart \u914d\u7f6e\u4e3aTrue\uff0c supervisor \u542f\u52a8\u65f6\uff0c\u4efb\u52a1\u8ddf\u968f\u542f\u52a8</li> <li>autorestart \u914d\u7f6e\u4e3aTrue\uff0c \u8fdb\u7a0b\u4e0d\u5b58\u5728\u65f6\u4f1a\u81ea\u52a8\u91cd\u542f\uff0c \u9ed8\u8ba4\u91cd\u542f3\u6b21\uff0c\u60f3\u4fee\u6539\u91cd\u542f\u6b21\u6570\uff0c\u53ef\u4ee5\u914d\u7f6estartretries\uff0c \u8bbe\u7f6e\u6700\u591a\u91cd\u542f\u7684\u6b21\u6570</li> <li>user \u8bbe\u7f6e\u542f\u52a8\u4efb\u52a1\u65f6\u6240\u7528\u7684\u7528\u6237\uff0csupervisor \u6709\u5fc5\u8981\u4f7f\u7528root\u8d26\u53f7\u542f\u52a8\uff0c\u8fd9\u6837\u624d\u6709\u6743\u9650\u914d\u7f6e\u5176\u4ed6\u542f\u52a8\u8d26\u53f7</li> <li>stdout_logfile \u914d\u7f6e\u8f93\u51fa\u65e5\u5fd7</li> </ol>"},{"location":"tools/supervisor.html#_4","title":"\u4f7f\u7528","text":""},{"location":"tools/supervisor.html#supervisorctl","title":"supervisorctl","text":"<p>supervisorctl \u662f supervisord \u7684\u4e00\u4e2a\u547d\u4ee4\u884c\u5ba2\u6237\u7aef\u5de5\u5177\uff0c\u4f7f\u7528supervisorctl\u53ef\u4ee5\u904d\u5386\u7684\u5bf9\u8fdb\u7a0b\u8fdb\u884c\u7ba1\u7406\uff0c\u652f\u6301\u7684\u547d\u4ee4\u5982\u4e0b</p> <pre><code>supervisorctl status                         # \u67e5\u770b\u8fdb\u7a0b\u72b6\u6001\nsupervisorctl stop project_name              # \u7ec8\u6b62\u67d0\u4e2a\u8fdb\u7a0b\nsupervisorctl start project_name             # \u542f\u52a8\u67d0\u4e2a\u8fdb\u7a0b\nsupervisorctl restart project_name           # \u91cd\u542f\u67d0\u4e2a\u8fdb\u7a0b\nsupervisorctl reread                         # \u66f4\u65b0\u914d\u7f6e\uff0c\u6839\u636e\u6700\u65b0\u7684\u914d\u7f6e\u542f\u52a8\u7a0b\u5e8f\uff0c\u4f1a\u542f\u52a8\u5df2\u7ecf\u8fd0\u884c\u7684\u7a0b\u5e8f\nsupervisorctl update                         # \u66f4\u65b0\u914d\u7f6e\uff0c\u91cd\u542f\u914d\u7f6e\u6709\u53d8\u5316\u7684\u8fdb\u7a0b\n</code></pre>"},{"location":"tools/supervisor.html#_5","title":"\u63d2\u4ef6","text":""},{"location":"tools/supervisor.html#supervisordevent","title":"Supervisord\u652f\u6301\u7684Event","text":"<ul> <li>PROCESS_STATE \u8fdb\u7a0b\u72b6\u6001\u53d1\u751f\u6539\u53d8</li> <li>PROCESS_STATE_STARTING \u8fdb\u7a0b\u72b6\u6001\u4ece\u5176\u4ed6\u72b6\u6001\u8f6c\u6362\u4e3a\u6b63\u5728\u542f\u52a8(Supervisord\u7684\u914d\u7f6e\u9879\u4e2d\u6709startsecs\u914d\u7f6e\u9879\uff0c\u662f\u6307\u7a0b\u5e8f\u542f\u52a8\u65f6\u9700\u8981\u7a0b\u5e8f\u81f3\u5c11\u7a33\u5b9a\u8fd0\u884cx\u79d2\u624d\u8ba4\u4e3a\u7a0b\u5e8f\u8fd0\u884c\u6b63\u5e38\uff0c\u5728\u8fd9x\u79d2\u4e2d\u7a0b\u5e8f\u72b6\u6001\u4e3a\u6b63\u5728\u542f\u52a8)</li> <li>PROCESS_STATE_RUNNING \u8fdb\u7a0b\u72b6\u6001\u7531\u6b63\u5728\u542f\u52a8\u8f6c\u6362\u4e3a\u6b63\u5728\u8fd0\u884c</li> <li>PROCESS_STATE_BACKOFF \u8fdb\u7a0b\u72b6\u6001\u7531\u6b63\u5728\u542f\u52a8\u8f6c\u6362\u4e3a\u5931\u8d25</li> <li>PROCESS_STATE_STOPPING \u8fdb\u7a0b\u72b6\u6001\u7531\u6b63\u5728\u8fd0\u884c\u8f6c\u6362\u4e3a\u6b63\u5728\u505c\u6b62</li> <li>PROCESS_STATE_EXITED \u8fdb\u7a0b\u72b6\u6001\u7531\u6b63\u5728\u8fd0\u884c\u8f6c\u6362\u4e3a\u9000\u51fa</li> <li>PROCESS_STATE_STOPPED \u8fdb\u7a0b\u72b6\u6001\u7531\u6b63\u5728\u505c\u6b62\u8f6c\u6362\u4e3a\u5df2\u7ecf\u505c\u6b62(exited\u548cstopped\u7684\u533a\u522b\u662fexited\u662f\u7a0b\u5e8f\u81ea\u884c\u9000\u51fa\uff0c\u800cstopped\u4e3a\u4eba\u4e3a\u63a7\u5236\u5176\u9000\u51fa)</li> <li>PROCESS_STATE_FATAL \u8fdb\u7a0b\u72b6\u6001\u7531\u6b63\u5728\u8fd0\u884c\u8f6c\u6362\u4e3a\u5931\u8d25</li> <li>PROCESS_STATE_UNKNOWN \u672a\u77e5\u7684\u8fdb\u7a0b\u72b6\u6001</li> <li>REMOTE_COMMUNICATION \u4f7f\u7528Supervisord\u7684RPC\u63a5\u53e3\u4e0eSupervisord\u8fdb\u884c\u901a\u4fe1</li> <li>PROCESS_LOG \u8fdb\u7a0b\u4ea7\u751f\u65e5\u5fd7\u8f93\u51fa\uff0c\u5305\u62ec\u6807\u51c6\u8f93\u51fa\u548c\u6807\u51c6\u9519\u8bef\u8f93\u51fa</li> <li>PROCESS_LOG_STDOUT \u8fdb\u7a0b\u4ea7\u751f\u6807\u51c6\u8f93\u51fa</li> <li>PROCESS_LOG_STDERR \u8fdb\u7a0b\u4ea7\u751f\u6807\u51c6\u9519\u8bef\u8f93\u51fa</li> <li>PROCESS_COMMUNICATION \u8fdb\u7a0b\u7684\u65e5\u5fd7\u8f93\u51fa\u5305\u542b \u548c</li> <li>PROCESS_COMMUNICATION_STDOUT \u8fdb\u7a0b\u7684\u6807\u51c6\u8f93\u51fa\u5305\u542b \u548c</li> <li>PROCESS_COMMUNICATION_STDERR\u8fdb\u7a0b\u7684\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u5305\u542b \u548c</li> <li>SUPERVISOR_STATE_CHANGE_RUNNING Supervisord \u542f\u52a8</li> <li>SUPERVISOR_STATE_CHANGE_STOPPING Supervisord \u505c\u6b62</li> <li>TICK_5 \u6bcf\u96945\u79d2\u89e6\u53d1</li> <li>TICK_60 \u6bcf\u969460\u79d2\u89e6\u53d1</li> <li>TICK_3600 \u6bcf\u96943600\u89e6\u53d1</li> <li>PROCESS_GROUP Supervisord\u7684\u8fdb\u7a0b\u7ec4\u53d1\u751f\u53d8\u5316</li> <li>PROCESS_GROUP_ADDED \u65b0\u589e\u4e86Supervisord\u7684\u8fdb\u7a0b\u7ec4</li> <li>PROCESS_GROUP_REMOVED \u5220\u9664\u4e86Supervisord\u7684\u8fdb\u7a0b\u7ec4</li> </ul>"},{"location":"tools/supervisor.html#superlance","title":"superlance","text":"<p>monitoring and controlling processes that run under supervisor.</p> <p>\u57fa\u4e8esupervisor\u7684\u4e8b\u4ef6\u673a\u5236\u5b9e\u73b0\u7684\u4e00\u7cfb\u5217\u547d\u4ee4\u884c\u7684\u5de5\u5177\u96c6\uff0c\u76d1\u63a7\u5e76\u5904\u7406 supervisor \u7684\u4e8b\u4ef6\uff0c\u6bd4\u5982\u53d1\u90ae\u4ef6\uff0c\u7279\u5b9a\u72b6\u6001\u4e0b\u6267\u884c\u7279\u5b9a\u7684\u811a\u672c\u7b49\u3002</p>"},{"location":"tools/website.html","title":"\u5de5\u5177\u96c6\u5408","text":"<ul> <li>\u4ee3\u7801\u751f\u6210\u597d\u770b\u7684\u56fe\u7247  https://carbon.now.sh/</li> <li>\u4e2d\u56fd\u53e4\u8bd7\u8bcd\u96c6\u5408  https://github.com/chinese-poetry/chinese-poetry</li> <li>\u4eba\u8138\u8bc6\u522b\u7cfb\u7edf\uff08\u57fa\u4e8edlib\uff09   https://github.com/ageitgey/face_recognition</li> <li>500\u884c\u4ee3\u7801   https://github.com/aosabook/500lines</li> <li>python\u6253\u5305\u53ef\u6267\u884c  https://github.com/Nuitka/Nuitka</li> <li>taichi\uff08\u7269\u7406\u6a21\u62df\u7f16\u7a0b\u8bed\u8a00\uff09 https://github.com/taichi-dev/taichi</li> </ul>"},{"location":"tools/git/conf.html","title":"Git \u914d\u7f6e","text":"<p>git status\u663e\u793a\u4fee\u6539\u4e86\u5927\u91cf\u6587\u4ef6\uff0cgit diff \u63d0\u793a filemode\u53d8\u5316</p> <pre><code>diff --git a/Android.mk b/Android.mk\nold mode 100644\nnew mode 10075\n</code></pre> <p>\u539f\u6765\u662ffilemode\u7684\u53d8\u5316\uff0c\u6587\u4ef6chmod\u540e\u5176\u6587\u4ef6\u67d0\u4e9b\u4f4d\u662f\u6539\u53d8\u4e86\u7684\uff0c\u5982\u679c\u4e25\u683c\u7684\u6bd4\u8f83\u539f\u6587\u4ef6\u548cchmod\u540e\u7684\u6587\u4ef6\uff0c\u4e24\u8005\u662f\u6709\u533a\u522b\u7684\uff0c\u4f46\u662f\u6e90\u4ee3\u7801\u901a\u5e38\u53ea\u5173\u5fc3\u6587\u672c\u5185\u5bb9\uff0c\u56e0\u6b64chmod\u4ea7\u751f\u7684\u53d8\u5316\u5e94\u8be5\u5ffd\u7565\uff0c\u6240\u4ee5\u8bbe\u7f6e\u4e00\u4e0b\uff1a</p> <p>\u5207\u5230\u6e90\u7801\u7684\u6839\u76ee\u5f55\u4e0b\uff1a</p> <pre><code>git config --add core.filemode false\n</code></pre>"},{"location":"tools/git/conf.html#coreautocrlf","title":"core.autocrlf","text":"<ul> <li>git config --global core.autocrlf true</li> </ul> <p>\u63d0\u4ea4\u65f6\u81ea\u52a8\u5730\u628a\u884c\u7ed3\u675f\u7b26CRLF\u8f6c\u6362\u6210LF\uff0c\u800c\u5728\u7b7e\u51fa\u4ee3\u7801\u65f6\u628aLF\u8f6c\u6362\u6210CRLF\u3002</p> <ul> <li>git config --global core.autocrlf input</li> </ul> <p>Git\u5728\u63d0\u4ea4\u65f6\u628aCRLF\u8f6c\u6362\u6210LF\uff0c\u7b7e\u51fa\u65f6\u4e0d\u8f6c\u6362</p> <ul> <li>git config --global core.autocrlf false</li> </ul> <p>\u90fd\u4e0d\u8fdb\u884c\u8f6c\u6362</p>"},{"location":"tools/git/conf.html#git-file-name-too-long","title":"GIT \u62c9\u53d6\u6216\u8005\u63d0\u4ea4\u9879\u76ee\u65f6\uff0c \u9047\u5230\u957f\u8def\u5f84\u63d0\u793afile name too long","text":"<p>git config --system core.longpaths true</p>"},{"location":"tools/git/gitbook.html","title":"Gitbook","text":"<p>[toc]</p>"},{"location":"tools/git/gitbook.html#gitbook","title":"GitBook","text":"<p>\u4f7f\u7528markdown\u7f16\u5199\u4e66\u7c4d\u3002https://github.com/GitbookIO/gitbook/issues</p> <p>GitBook\u7684\u4ee3\u7801\u57282019\u5e74\u505c\u6b62\u66f4\u65b0\uff0c\u53ef\u4ee5\u4f7f\u7528mdbook\u8fdb\u884c\u66ff\u4ee3</p>"},{"location":"tools/git/gitbook.html#_1","title":"\u5b89\u88c5","text":"<pre><code># \u5b89\u88c5nodejs\uff0cnodejs.org\n# \u67e5\u770b\u7248\u672c\u68c0\u67e5\u662f\u5426\u5b89\u88c5\u6210\u529f\n$ sudo node -v\n$ sudo npm -v\n# \u901a\u8fc7npm\u5b89\u88c5GitBook\n$ npm install gitbook-cli -g\n# \u67e5\u770bGitBook\u7248\u672c\u540c\u65f6\u5b89\u88c5\n$ gitbook -V\n# \u65b0\u5efa\u6587\u4ef6\u5939\u6765\u4f5c\u4e3a\u4e00\u672c\u4e66\n$ mkdir mybook\n# \u8fdb\u5165\u8be5\u76ee\u5f55\uff0c\u521d\u59cb\u5316gitbook\n$ cd mybook\n$ gitbook init\n# \u7f16\u8f91\u76ee\u5f55\u4e0b\u7684SUMMARY.md\u6587\u4ef6\uff0c\u5f62\u6210\u7ae0\u8282\u7ed3\u6784\uff0c\u5982\u4e0b\n#   * [\u5e8f\u8a00](README.md)\n#   * [\u7b2c1\u7ae0](chapter1/README.md)\n#    * [\u7b2c1\u8282](chapter1/c1s1.md)\n#    * [\u7b2c2\u8282](chapter1/c1s2.md)\n#   * [\u7b2c2\u7ae0](chapter2/README.md)\n#    * [\u7b2c1\u8282](chapter2/c1s1.md)\n#    * [\u7b2c2\u8282](chapter2/c1s2.md)\n#   * [\u7ed3\u675f](end/README.md)\n# \u8fd0\u884c\u4e0b\u9762\u547d\u4ee4\u6765\u6784\u5efa\u7ae0\u8282\u7ed3\u6784\n$ gitbook build\n# \u6216\u8005\u76f4\u63a5\u8fd0\u884c\u4e0b\u9762\u547d\u4ee4\u53ef\u5728\u6d4f\u89c8\u5668\u67e5\u770b\u4e66\u672c\u4fe1\u606f\n$ gitbook serve\n#\u00a0\u6d4f\u89c8\u5668\u4e2d\u8f93\u5165 http://localhost:4000 \uff0c\u5373\u53ef\u67e5\u770b\n</code></pre>"},{"location":"tools/git/gitbook.html#_2","title":"\u7ed3\u6784","text":"<p>\u5728gitbook\u6587\u4ef6\u5939\u4e2d\u6253\u5f00git bash\u547d\u4ee4\u7a97\u53e3\u6267\u884cgitbook init\u547d\u4ee4\u521d\u59cb\u5316\u4e66\u7c4d\u76ee\u5f55\u751f\u6210README.md\u548cSUMMARY.md\u4e24\u4e2a\u6587\u4ef6</p> <p>README.md</p> <ul> <li>REAME\u76f8\u5f53\u4e8e\u4e66\u7c4d\u7684\u524d\u8a00\u90e8\u5206, \u53ef\u4ee5\u5ffd\u7565</li> </ul> <p>SUMMARY.md</p> <ul> <li>SUMMARY\u662f\u6700\u91cd\u8981\u7684\u4e00\u4e2a\u90e8\u5206, \u5b83\u521b\u5efa\u7684\u662f\u6574\u4e66\u7684\u7d22\u5f15\uff0c\u5b9a\u4e49\u4e86\u4f60\u7684\u56fe\u4e66\u7684\u7ed3\u6784</li> </ul>"},{"location":"tools/git/gitbook.html#_3","title":"\u63d2\u4ef6","text":"<p>\u6d41\u7a0b\u56fe</p> <p><code>npm install gitbook-plugin-mermaid</code></p>"},{"location":"tools/git/patch.html","title":"Git Patch &amp; Diff","text":"<p>Git \u63d0\u4f9b\u4e24\u79cd\u8865\u4e01\u65b9\u6848\uff1a</p> <ul> <li>git diff \u751f\u6210\u7684 UNIX \u6807\u51c6\u8865\u4e01 .diff \u6587\u4ef6\uff1a</li> <li>.diff\u6587\u4ef6\u53ea\u662f\u8bb0\u5f55\u6587\u4ef6\u6539\u53d8\u7684\u5185\u5bb9\uff0c\u4e0d\u5e26\u6709commit\u8bb0\u5f55\u4fe1\u606f\uff0c\u591a\u4e2acommit\u53ef\u4ee5\u5408\u5e76\u6210\u4e00\u4e2adiff\u6587\u4ef6\u3002</li> <li>git format-patch\u751f\u6210\u7684Git\u4e13\u7528.patch \u6587\u4ef6\uff1a</li> <li>.patch\u6587\u4ef6\u5e26\u6709\u8bb0\u5f55\u6587\u4ef6\u6539\u53d8\u7684\u5185\u5bb9\uff0c\u4e5f\u5e26\u6709commit\u8bb0\u5f55\u4fe1\u606f\uff0c\u6bcf\u4e2acommit\u5bf9\u5e94\u4e00\u4e2apatch\u6587\u4ef6\u3002</li> </ul>"},{"location":"tools/git/patch.html#git-patch","title":"Git Patch","text":"<p>\u67d0\u6b21\u63d0\u4ea4\u7684patch</p> <pre><code>git format-patch [commit sha1 id] -1\n</code></pre> <p>\u67d0\u4e24\u6b21\u63d0\u4ea4\uff08\u542b\uff09\u4e4b\u95f4\u7684\u6240\u6709patch</p> <pre><code>git format-patch [commit sha1 id]..[commit sha1 id]\n</code></pre>"},{"location":"tools/git/patch.html#git-diff","title":"Git Diff","text":"<pre><code>git diff [commit id 1] [commit id 2] &gt; [diff\u6587\u4ef6\u540d]\n</code></pre> <p>\"-\"\u53f7\u5f00\u5934\u7684\u8868\u793a <code>commit-id-2</code> \u76f8\u5bf9 <code>commit-id-1</code> \u51cf\u5c11\u4e86\u7684\u5185\u5bb9\u3002 \"+\"\u53f7\u5f00\u5934\u7684\u8868\u793a <code>commit-id-2</code> \u76f8\u5bf9 <code>commit-id-1</code> \u589e\u52a0\u4e86\u7684\u5185\u5bb9\u3002</p>"},{"location":"tools/git/patch.html#patchdiff","title":"\u5e94\u7528Patch\u6216Diff","text":"<p>\u68c0\u67e5patch/diff\u662f\u5426\u80fd\u6b63\u5e38\u6253\u5165:</p> <pre><code>git apply --check [path/to/xxx.patch]\ngit apply --check [path/to/xxx.diff]\n</code></pre> <p>\u6253\u5165patch/diff\uff1a</p> <pre><code>git apply [path/to/xxx.patch]\ngit apply [path/to/xxx.diff]\n</code></pre>"},{"location":"tools/git/patch.html#_1","title":"\u51b2\u7a81\u89e3\u51b3","text":"<p>\u6253\u8865\u4e01\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u51fa\u73b0\u51b2\u7a81\u7684\u60c5\u51b5\uff0c\u663e\u793a\u6253\u5165\u5931\u8d25\uff0c\u5982\u56fe\uff1a</p> <p></p> <p>\u89e3\u51b3\u51b2\u7a81\uff1a</p> <ol> <li>\u4f7f\u7528 \u4ee5\u4e0b\u547d\u4ee4\u884c\uff0c\u81ea\u52a8\u5408\u5165 patch \u4e2d\u4e0d\u51b2\u7a81\u7684\u4ee3\u7801\u6539\u52a8\uff0c\u540c\u65f6\u4fdd\u7559\u51b2\u7a81\u7684\u90e8\u5206\uff1a</li> </ol> <pre><code>git  apply --reject  xxxx.patch\n</code></pre> <p>\u53ef\u4ee5\u5728\u7ec8\u7aef\u4e2d\u663e\u793a\u51fa\u51b2\u7a81\u7684\u5927\u81f4\u4ee3\u7801\uff1a</p> <p></p> <p>\u540c\u65f6\u4f1a\u751f\u6210\u540e\u7f00\u4e3a .rej \u7684\u6587\u4ef6\uff0c\u4fdd\u5b58\u6ca1\u6709\u5408\u5e76\u8fdb\u53bb\u7684\u90e8\u5206\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u53c2\u8003\u8fd9\u4e2a\u8fdb\u884c\u51b2\u7a81\u89e3\u51b3\uff08\u53ef\u4ee5\u91cd\u65b0\u751f\u6210patch\u6587\u4ef6\uff0c\u6216\u8005\u6267\u884c\u540e\u7eed\u7b49\u624b\u5de5\u4fee\u6539rej\u6587\u4ef6\uff09</p> <ol> <li> <p>\u89e3\u51b3\u5b8c\u51b2\u7a81\u540e\u5220\u9664\u540e\u7f00\u4e3a .rej \u7684\u6587\u4ef6\uff0c\u5e76\u6267\u884c<code>git add.</code>\u6dfb\u52a0\u6539\u52a8\u5230\u6682\u5b58\u533a\uff1b</p> </li> <li> <p>\u63a5\u7740\u6267\u884c<code>git am --resolved</code>\u6216\u8005<code>git am --continue</code></p> </li> </ol> <p>\u8bf4\u660e\uff1a\u5728\u6253\u5165patch\u51b2\u7a81\u65f6\uff0c\u53ef\u4ee5\u6267\u884c<code>git am --skip</code>\u8df3\u8fc7\u6b64\u6b21\u51b2\u7a81\uff0c\u4e5f\u53ef\u4ee5\u6267\u884c<code>git am --abort</code>\u56de\u9000\u6253\u5165patch\u7684\u52a8\u4f5c\uff0c\u8fd8\u539f\u5230\u64cd\u4f5c\u524d\u7684\u72b6\u6001\u3002</p>"},{"location":"tools/git/usage.html","title":"Usage","text":"<p>[toc]</p>"},{"location":"tools/git/usage.html#git","title":"Git","text":""},{"location":"tools/git/usage.html#rebase","title":"rebase","text":"<p>\u4e24\u4e2a\u5206\u652fmaster\u548cfeature\uff0c\u5176\u4e2dfeature\u662f\u5728\u63d0\u4ea4\u70b9B\u5904\u4ecemaster\u4e0a\u62c9\u51fa\u7684\u5206\u652f</p> <p>master\u4e0a\u6709\u4e00\u4e2a\u65b0\u63d0\u4ea4M\uff0cfeature\u4e0a\u6709\u4e24\u4e2a\u65b0\u63d0\u4ea4C\u548cD</p> <p></p> <p>\u628amaster\u5206\u652f\u5408\u5e76\u5230feature\u5206\u652f\uff08\u8fd9\u4e00\u6b65\u7684\u573a\u666f\u5c31\u53ef\u4ee5\u7c7b\u6bd4\u4e3a\u6211\u4eec\u5728\u81ea\u5df1\u7684\u5206\u652ffeature\u4e0a\u5f00\u53d1\u4e86\u4e00\u6bb5\u65f6\u95f4\u4e86\uff0c\u51c6\u5907\u4ece\u4e3b\u5e72master\u4e0a\u62c9\u4e00\u4e0b\u6700\u65b0\u6539\u52a8\uff09</p> <pre><code>git checkout feature\ngit rebase master\n\n# \u8fd9\u4e24\u6761\u547d\u4ee4\u7b49\u4ef7\u4e8egit rebase master feature\n</code></pre> <p>\u4e0b\u56fe\u4e3a\u53d8\u57fa\u540e\u7684\u63d0\u4ea4\u8282\u70b9\u56fe\uff0c\u89e3\u91ca\u4e00\u4e0b\u5176\u5de5\u4f5c\u539f\u7406\uff1a</p> <p></p> <ul> <li>feature\uff1a\u5f85\u53d8\u57fa\u5206\u652f\u3001\u5f53\u524d\u5206\u652f</li> <li>master\uff1a\u57fa\u5206\u652f\u3001\u76ee\u6807\u5206\u652f</li> </ul> <p>\u5f53\u6267\u884crebase\u64cd\u4f5c\u65f6\uff0cgit\u4f1a\u4ece\u4e24\u4e2a\u5206\u652f\u7684\u5171\u540c\u7956\u5148\u5f00\u59cb\u63d0\u53d6\u5f85\u53d8\u57fa\u5206\u652f\u4e0a\u7684\u4fee\u6539\uff0c\u7136\u540e\u5c06\u5f85\u53d8\u57fa\u5206\u652f\u6307\u5411\u57fa\u5206\u652f\u7684\u6700\u65b0\u63d0\u4ea4\uff0c\u6700\u540e\u5c06\u521a\u624d\u63d0\u53d6\u7684\u4fee\u6539\u5e94\u7528\u5230\u57fa\u5206\u652f\u7684\u6700\u65b0\u63d0\u4ea4\u7684\u540e\u9762\u3002</p> <p>\u62c9\u516c\u5171\u5206\u652f\u6700\u65b0\u4ee3\u7801\u7684\u65f6\u5019\u4f7f\u7528rebase\uff0c\u5f80\u516c\u5171\u5206\u652f\u4e0a\u5408\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u4f7f\u7528merge\u3002</p>"},{"location":"tools/git/usage.html#_1","title":"\u547d\u4ee4","text":"<pre><code>git checkout name #\u8fdb\u5165name\u7684branch\n</code></pre>"},{"location":"tools/git/usage.html#clone","title":"clone","text":"<pre><code># \u514b\u9686&lt;branch&gt;\u5206\u652f\uff0c\u53ea\u5305\u542b\u6700\u65b0\u7684\u4e00\u4e2a\u7684commit\ngit clone -b &lt;branch&gt; &lt;remote_repo&gt; --depth=1\n</code></pre>"},{"location":"tools/git/usage.html#branch","title":"branch","text":"<pre><code>git branch name  #\u521b\u5efa\u540d\u4e3aname\u7684branch\ngit branch &lt;new-branch-name&gt; &lt;tag-name&gt; #\u57fa\u4e8etag\u521b\u5efabranch\ngit branch -d name #\u5220\u9664\u672c\u5730\u5206\u652fname\ngit branch -m A B #\u5c06A\u5206\u652f\u91cd\u547d\u540d\u4e3aB\n</code></pre>"},{"location":"tools/git/usage.html#tag","title":"tag","text":"<pre><code>git tag name -m \"infos\"     #\u521b\u5efa\u540d\u4e3aname\u7684tag\ngit tag -d name             #\u5220\u9664\u672c\u5730\u540d\u4e3aname\u7684tag\n</code></pre>"},{"location":"tools/git/usage.html#pull","title":"pull","text":"<pre><code># \u53d6\u56deorigin\u4e3b\u673a\u7684next\u5206\u652f\uff0c\u4e0e\u672c\u5730\u7684master\u5206\u652f\u5408\u5e76\uff0c\u9700\u8981\u5199\u6210\u4e0b\u9762\u8fd9\u6837\u3002\ngit pull origin next:master\n</code></pre>"},{"location":"tools/git/usage.html#push","title":"push","text":"<pre><code>git push origin name  #\u5c06name\u7684tag push\u5230\u8fdc\u7aef\ngit push origin :name #\u5220\u9664\u8fdc\u7a0b\u5206\u652fname\ngit push origin --delete tag &lt;tagname&gt;  #\u5220\u9664\u8fdc\u7aef\u7684tag\n</code></pre>"},{"location":"tools/git/usage.html#cherry-pick","title":"cherry-pick","text":"<p>git cherry-pick\u53ef\u4ee5\u7406\u89e3\u4e3a\u201d\u6311\u62e3\u201d\u63d0\u4ea4\uff0c\u5b83\u4f1a\u83b7\u53d6\u67d0\u4e00\u4e2a\u5206\u652f\u7684\u5355\u7b14\u63d0\u4ea4\uff0c\u5e76\u4f5c\u4e3a\u4e00\u4e2a\u65b0\u7684\u63d0\u4ea4\u5f15\u5165\u5230\u4f60\u5f53\u524d\u5206\u652f\u4e0a\u3002 \u5f53\u6211\u4eec\u9700\u8981\u5728\u672c\u5730\u5408\u5165\u5176\u4ed6\u5206\u652f\u7684\u63d0\u4ea4\u65f6\uff0c\u5982\u679c\u6211\u4eec\u4e0d\u60f3\u5bf9\u6574\u4e2a\u5206\u652f\u8fdb\u884c\u5408\u5e76\uff0c\u800c\u662f\u53ea\u60f3\u5c06\u67d0\u4e00\u6b21\u63d0\u4ea4\u5408\u5165\u5230\u672c\u5730\u5f53\u524d\u5206\u652f\u4e0a\uff0c\u90a3\u4e48\u5c31\u8981\u4f7f\u7528git cherry-pick\u3002</p> <p>\u4f8b\u5982\u8981\u5c06A\u5206\u652f\u7684\u4e00\u4e2acommit\u5408\u5e76\u5230B\u5206\u652f\uff1a</p> <p>\u9996\u5148\u5207\u6362\u5230A\u5206\u652f</p> <ul> <li>git checkout A</li> <li>git log</li> </ul> <p>\u627e\u51fa\u8981\u5408\u5e76\u7684commit ID :</p> <p>\u4f8b\u5982  0128660c08e325d410cb845616af355c0c19c6fe</p> <p>\u7136\u540e\u5207\u6362\u5230B\u5206\u652f\u4e0a</p> <ul> <li> <p>git checkout B</p> </li> <li> <p>git cherry-pick  0128660c08e325d410cb845616af355c0c19c6fe</p> </li> </ul> <p>\u7136\u540e\u5c31\u5c06A\u5206\u652f\u7684\u67d0\u4e2acommit\u5408\u5e76\u5230\u4e86B\u5206\u652f\u4e86</p>"},{"location":"tools/git/usage.html#merge","title":"merge","text":"<pre><code>git merge dev         # \u5c06\u6240\u5728\u5206\u652f\u548cdev\u5206\u652f\u5408\u5e76\n</code></pre> <p>\u5728 merge pull request \u7684\u65f6\u5019\uff0c\u9ed8\u8ba4\u662f\u6709\u4e09\u79cd\u9009\u9879\u7684\uff0c\u5206\u522b\u662f</p> <ul> <li>\u666e\u901a\u7684 merge (fast-forward)</li> <li>\u522b\u4eba\u7684commit\u8bb0\u5f55\u4f1a\u4ee5\u6b64\u51fa\u73b0</li> </ul> <p></p> <ul> <li>squash merge \uff08 git merge --squash devel \uff09</li> <li>\u522b\u4eba\u7684\u591a\u4e2acommit\u8bb0\u5f55\u4f1a\u5408\u5e76\u6210\u4e00\u4e2a\u672a\u63d0\u4ea4\u7684\u4fee\u6539\uff0c\u9700\u8981\u624b\u5de5commit\uff08\u65e0\u6cd5\u4fdd\u7559\u539f\u4f5c\u8005\u4fe1\u606f\uff09</li> </ul> <p></p> <ul> <li>rebase merge\uff08git\u4e0a\u7684merge request\u4e2d\u7684squash commit\uff09</li> <li>\u5148\u5207\u6362\u5230 devel \u5206\u652f\uff08\u4e0d\u4e00\u6837\u54af\uff09\uff1agit checkout devel</li> <li>\u53d8\u57fa\uff1agit rebase -i master</li> <li>\u5207\u6362\u56de\u76ee\u6807\u5206\u652f\uff1agit checkout master</li> <li>\u5408\u5e76: git merge devel</li> <li>\uff08H\uff09\u662f\u5408\u5e76\u7684merge\u8bb0\u5f55\u3002</li> </ul> <p></p>"},{"location":"tools/git/usage.html#ignore","title":"ignore","text":"<pre><code># git ignore\u4e0d\u751f\u6548\uff0c\u56e0\u4e3a\u6587\u4ef6\u4e4b\u524d\u52a0\u5165\u4e86\u7248\u672c\u63a7\u5236\u4e2d\uff0c\u9700\u8981\u5c06\u8be5\u6587\u4ef6\u5220\u9664\uff0c\u5148\u628a\u672c\u5730\u7f13\u5b58\u5220\u9664\uff08\u6539\u53d8\u6210\u672atrack\u72b6\u6001\uff09\uff0c\u7136\u540e\u518d\u63d0\u4ea4\uff1a\ngit rm -r --cached .\ngit add .\ngit commit -m 'update .gitignore'\n\n# .gitkeep\u6587\u4ef6\uff1a\u56e0\u4e3aGit\u4f1a\u5ffd\u7565\u7a7a\u7684\u6587\u4ef6\u5939\uff0c\u4f46\u662f\u6587\u4ef6\u5939\u5185\u6709\u5185\u5bb9\uff0c\u5219\u4f1a\u7eb3\u5165\u7248\u672c\u63a7\u5236\uff0c.gitkeep\u540d\u5b57\u53ea\u662f\u4e60\u60ef\uff1b\n</code></pre>"},{"location":"tools/git/usage.html#config","title":"config","text":"<pre><code># git\u4ee3\u7406\u7684\u914d\u7f6e\ngit config --global  http.sslVerify  false\ngit config --global http.proxy $$ \ngit config --global https.proxy $$ \ngit config --global url.https://github.com/.insteadOf git://github.com/\n</code></pre> <p>.git/config\u4e2d\u6dfb\u52a0</p> <pre><code># \u4fdd\u5b58\u7528\u6237\u540d\u548c\u5bc6\u7801\n[credential]\nhelper = store\n</code></pre>"},{"location":"tools/markdown/math.html","title":"\u516c\u5f0f","text":""},{"location":"tools/markdown/math.html#markdown","title":"Markdown\u516c\u5f0f","text":""},{"location":"tools/markdown/math.html#_1","title":"\u884c\u5185\u4e0e\u72ec\u884c","text":"<ol> <li>\u884c\u5185\u516c\u5f0f\uff1a\u5c06\u516c\u5f0f\u63d2\u5165\u5230\u672c\u884c\u5185\uff0c\u7b26\u53f7\uff1a<code>$\u516c\u5f0f\u5185\u5bb9$</code>\uff0c\u5982\uff1a\\(xyz\\)</li> <li>\u72ec\u884c\u516c\u5f0f\uff1a\u5c06\u516c\u5f0f\u63d2\u5165\u5230\u65b0\u7684\u4e00\u884c\u5185\uff0c\u5e76\u4e14\u5c45\u4e2d\uff0c\u7b26\u53f7\uff1a<code>$$\u516c\u5f0f\u5185\u5bb9$$</code>\uff0c\u5982\uff1a\\(\\(xyz\\)\\)</li> </ol>"},{"location":"tools/markdown/math.html#_2","title":"\u4e0a\u6807\u3001\u4e0b\u6807\u4e0e\u7ec4\u5408","text":"<ol> <li>\u4e0a\u6807\u7b26\u53f7\uff0c\u7b26\u53f7\uff1a<code>^</code>\uff0c\u5982\uff1a\\(x^4\\)</li> <li>\u4e0b\u6807\u7b26\u53f7\uff0c\u7b26\u53f7\uff1a<code>_</code>\uff0c\u5982\uff1a\\(x_1\\)</li> <li>\u7ec4\u5408\u7b26\u53f7\uff0c\u7b26\u53f7\uff1a<code>{}</code>\uff0c\u5982\uff1a\\({16}_{8}O{2+}_{2}\\)</li> </ol>"},{"location":"tools/markdown/math.html#_3","title":"\u6c49\u5b57\u3001\u5b57\u4f53\u4e0e\u683c\u5f0f","text":"<ol> <li>\u6c49\u5b57\u5f62\u5f0f\uff0c\u7b26\u53f7\uff1a<code>\\mbox{}</code>\uff0c\u5982\uff1a\\(V_{\\mbox{\u521d\u59cb}}\\)</li> <li>\u5b57\u4f53\u63a7\u5236\uff0c\u7b26\u53f7\uff1a<code>\\displaystyle</code>\uff0c\u5982\uff1a\\(\\displaystyle \\frac{x+y}{y+z}\\)</li> <li>\u4e0b\u5212\u7ebf\u7b26\u53f7\uff0c\u7b26\u53f7\uff1a<code>\\underline</code>\uff0c\u5982\uff1a\\(\\underline{x+y}\\)</li> <li>\u6807\u7b7e\uff0c\u7b26\u53f7<code>\\tag{\u6570\u5b57}</code>\uff0c\u5982\uff1a\\(\\tag{11}\\)</li> <li>\u4e0a\u5927\u62ec\u53f7\uff0c\u7b26\u53f7\uff1a<code>\\overbrace{\u7b97\u5f0f}</code>\uff0c\u5982\uff1a\\(\\overbrace{a+b+c+d}^{2.0}\\)</li> <li>\u4e0b\u5927\u62ec\u53f7\uff0c\u7b26\u53f7\uff1a<code>\\underbrace{\u7b97\u5f0f}</code>\uff0c\u5982\uff1a\\(a+\\underbrace{b+c}_{1.0}+d\\)</li> <li>\u4e0a\u4f4d\u7b26\u53f7\uff0c\u7b26\u53f7\uff1a<code>\\stacrel{\u4e0a\u4f4d\u7b26\u53f7}{\u57fa\u4f4d\u7b26\u53f7}</code>\uff0c\u5982\uff1a\\(\\vec{x}\\stackrel{\\mathrm{def}}{=}{x_1,\\dots,x_n}\\)</li> </ol>"},{"location":"tools/markdown/math.html#_4","title":"\u5360\u4f4d\u7b26","text":"<ol> <li>\u4e24\u4e2aquad\u7a7a\u683c\uff0c\u7b26\u53f7\uff1a<code>\\qquad</code>\uff0c\u5982\uff1a\\(x \\qquad y\\)</li> <li>quad\u7a7a\u683c\uff0c\u7b26\u53f7\uff1a<code>\\quad</code>\uff0c\u5982\uff1a\\(x \\quad y\\)</li> <li>\u5927\u7a7a\u683c\uff0c\u7b26\u53f7<code>\\</code>\uff0c\u5982\uff1a\\(x \\  y\\)</li> <li>\u4e2d\u7a7a\u683c\uff0c\u7b26\u53f7<code>\\:</code>\uff0c\u5982\uff1a\\(x : y\\)</li> <li>\u5c0f\u7a7a\u683c\uff0c\u7b26\u53f7<code>\\,</code>\uff0c\u5982\uff1a\\(x , y\\)</li> <li>\u6ca1\u6709\u7a7a\u683c\uff0c\u7b26\u53f7``\uff0c\u5982\uff1a\\(xy\\)</li> <li>\u7d27\u8d34\uff0c\u7b26\u53f7<code>\\!</code>\uff0c\u5982\uff1a\\(x ! y\\)</li> </ol>"},{"location":"tools/markdown/math.html#_5","title":"\u5b9a\u754c\u7b26\u4e0e\u7ec4\u5408","text":"<ol> <li>\u62ec\u53f7\uff0c\u7b26\u53f7\uff1a<code>\uff08\uff09\\big(\\big) \\Big(\\Big) \\bigg(\\bigg) \\Bigg(\\Bigg)</code>\uff0c\u5982\uff1a\\(\uff08\uff09\\big(\\big) \\Big(\\Big) \\bigg(\\bigg) \\Bigg(\\Bigg)\\)</li> <li>\u4e2d\u62ec\u53f7\uff0c\u7b26\u53f7\uff1a<code>[]</code>\uff0c\u5982\uff1a\\([x+y]\\)</li> <li>\u5927\u62ec\u53f7\uff0c\u7b26\u53f7\uff1a<code>\\{ \\}</code>\uff0c\u5982\uff1a\\(\\{x+y\\}\\)</li> <li>\u81ea\u9002\u5e94\u62ec\u53f7\uff0c\u7b26\u53f7\uff1a<code>\\left \\right</code>\uff0c\u5982\uff1a\\(\\(f(x,y,z) = 3y^2z \\left( 3+\\frac{7x+5}{1+y^2} \\right)\\)\\)</li> <li>\u7ec4\u5408\u516c\u5f0f\uff0c\u7b26\u53f7\uff1a<code>{\u4e0a\u4f4d\u516c\u5f0f \\choose \u4e0b\u4f4d\u516c\u5f0f}</code>\uff0c\u5982\uff1a\\({n+1 \\choose k}={n \\choose k}+{n \\choose k-1}\\)</li> <li>\u7ec4\u5408\u516c\u5f0f\uff0c\u7b26\u53f7\uff1a<code>{\u4e0a\u4f4d\u516c\u5f0f \\atop \u4e0b\u4f4d\u516c\u5f0f}</code>\uff0c\u5982\uff1a\\(\\sum_{k_0,k_1,\\ldots&gt;0 \\atop k_0+k_1+\\cdots=n}A_{k_0}A_{k_1}\\cdots\\)</li> </ol>"},{"location":"tools/markdown/math.html#_6","title":"\u56db\u5219\u8fd0\u7b97","text":"<ol> <li>\u52a0\u6cd5\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>+</code>\uff0c\u5982\uff1a\\(x+y=z\\)</li> <li>\u51cf\u6cd5\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>-</code>\uff0c\u5982\uff1a\\(x-y=z\\)</li> <li>\u52a0\u51cf\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\pm</code>\uff0c\u5982\uff1a\\(x \\pm y=z\\)</li> <li>\u51cf\u7532\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\mp</code>\uff0c\u5982\uff1a\\(x \\mp y=z\\)</li> <li>\u4e58\u6cd5\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\times</code>\uff0c\u5982\uff1a\\(x \\times y=z\\)</li> <li>\u70b9\u4e58\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\cdot</code>\uff0c\u5982\uff1a\\(x \\cdot y=z\\)</li> <li>\u661f\u4e58\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\ast</code>\uff0c\u5982\uff1a\\(x \\ast y=z\\)</li> <li>\u9664\u6cd5\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\div</code>\uff0c\u5982\uff1a\\(x \\div y=z\\)</li> <li>\u659c\u6cd5\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>/</code>\uff0c\u5982\uff1a\\(x/y=z\\)</li> <li>\u5206\u5f0f\u8868\u793a\uff0c\u7b26\u53f7\uff1a<code>\\frac{\u5206\u5b50}{\u5206\u6bcd}</code>\uff0c\u5982\uff1a\\(\\frac{x+y}{y+z}\\)</li> <li>\u5206\u5f0f\u8868\u793a\uff0c\u7b26\u53f7\uff1a<code>{\u5206\u5b50} \\voer {\u5206\u6bcd}</code>\uff0c\u5982\uff1a\\({x+y} \\over {y+z}\\)</li> <li>\u7edd\u5bf9\u503c\u8868\u793a\uff0c\u7b26\u53f7\uff1a<code>||</code>\uff0c\u5982\uff1a\\(|x+y|\\)</li> </ol>"},{"location":"tools/markdown/math.html#_7","title":"\u9ad8\u7ea7\u8fd0\u7b97","text":"<ol> <li>\u5e73\u5747\u6570\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\overline{\u7b97\u5f0f}</code>\uff0c\u5982\uff1a\\(\\overline{xyz}\\)</li> <li>\u5f00\u4e8c\u6b21\u65b9\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\sqrt</code>\uff0c\u5982\uff1a\\(\\sqrt x\\)</li> <li>\u5f00\u65b9\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\sqrt[\u5f00\u65b9\u6570]{\u88ab\u5f00\u65b9\u6570}</code>\uff0c\u5982\uff1a\\(\\sqrt[3]{x+y}\\)</li> <li>\u5bf9\u6570\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\log</code>\uff0c\u5982\uff1a\\(\\log(x)\\)</li> <li>\u6781\u9650\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\lim</code>\uff0c\u5982\uff1a\\(\\lim^{x \\to \\infty}_{y \\to 0}{\\frac{x}{y}}\\)</li> <li>\u6781\u9650\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\displaystyle \\lim</code>\uff0c\u5982\uff1a\\(\\displaystyle \\lim^{x \\to \\infty}_{y \\to 0}{\\frac{x}{y}}\\)</li> <li>\u6c42\u548c\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\sum</code>\uff0c\u5982\uff1a\\(\\sum^{x \\to \\infty}_{y \\to 0}{\\frac{x}{y}}\\)</li> <li>\u6c42\u548c\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\displaystyle \\sum</code>\uff0c\u5982\uff1a\\(\\displaystyle \\sum^{x \\to \\infty}_{y \\to 0}{\\frac{x}{y}}\\)</li> <li>\u79ef\u5206\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\int</code>\uff0c\u5982\uff1a\\(\\int^{\\infty}_{0}{xdx}\\)</li> <li>\u79ef\u5206\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\displaystyle \\int</code>\uff0c\u5982\uff1a\\(\\displaystyle \\int^{\\infty}_{0}{xdx}\\)</li> <li>\u5fae\u5206\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\partial</code>\uff0c\u5982\uff1a\\(\\frac{\\partial x}{\\partial y}\\)</li> <li>\u65b9\u7a0b\u5f0f\u62ec\u53f7\uff0c\u7b26\u53f7\uff1a<code>\\begin{cases} A \\\\ B \\end{cases}</code>\uff0c\u5982\\(x=\\begin{cases}1 \\\\ 2\\end{cases}\\)</li> <li>\u77e9\u9635\u8868\u793a\uff0c\u7b26\u53f7\uff1a<code>\\begin{matrix} \\end{matrix}</code>\uff0c\u5982\uff1a\\(\\left[ \\begin{matrix} 1 &amp;2 &amp;\\cdots &amp;4\\\\5 &amp;6 &amp;\\cdots &amp;8\\\\ \\vdots &amp;\\vdots &amp;\\ddots &amp;\\vdots\\\\13 &amp;14 &amp;\\cdots &amp;16\\end{matrix}\\right]\\)</li> </ol>"},{"location":"tools/markdown/math.html#_8","title":"\u903b\u8f91\u8fd0\u7b97","text":"<ol> <li>\u7b49\u4e8e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>=</code>\uff0c\u5982\uff1a\\(x+y=z\\)</li> <li>\u5927\u4e8e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>&gt;</code>\uff0c\u5982\uff1a\\(x+y&gt;z\\)</li> <li>\u5c0f\u4e8e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>&lt;</code>\uff0c\u5982\uff1a\\(x+y&lt;z\\)</li> <li>\u5927\u4e8e\u7b49\u4e8e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\geq</code>\uff0c\u5982\uff1a\\(x+y \\geq z\\)</li> <li>\u5c0f\u4e8e\u7b49\u4e8e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\leq</code>\uff0c\u5982\uff1a\\(x+y \\leq z\\)</li> <li>\u4e0d\u7b49\u4e8e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\neq</code>\uff0c\u5982\uff1a\\(x+y \\neq z\\)</li> <li>\u4e0d\u5927\u4e8e\u7b49\u4e8e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\ngeq</code>\uff0c\u5982\uff1a\\(x+y \\ngeq z\\)</li> <li>\u4e0d\u5927\u4e8e\u7b49\u4e8e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\not\\geq</code>\uff0c\u5982\uff1a\\(x+y \\not\\geq z\\)</li> <li>\u4e0d\u5c0f\u4e8e\u7b49\u4e8e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\nleq</code>\uff0c\u5982\uff1a\\(x+y \\nleq z\\)</li> <li>\u4e0d\u5c0f\u4e8e\u7b49\u4e8e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\not\\leq</code>\uff0c\u5982\uff1a\\(x+y \\not\\leq z\\)</li> <li>\u7ea6\u7b49\u4e8e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\approx</code>\uff0c\u5982\uff1a\\(x+y \\approx z\\)</li> <li>\u6052\u5b9a\u7b49\u4e8e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\equiv</code>\uff0c\u5982\uff1a\\(x+y \\equiv z\\)</li> </ol>"},{"location":"tools/markdown/math.html#_9","title":"\u96c6\u5408\u8fd0\u7b97","text":"<ol> <li>\u5c5e\u4e8e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\in</code>\uff0c\u5982\uff1a\\(x \\in y\\)</li> <li>\u4e0d\u5c5e\u4e8e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\notin</code>\uff0c\u5982\uff1a\\(x \\notin y\\)</li> <li>\u4e0d\u5c5e\u4e8e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\not\\in</code>\uff0c\u5982\uff1a\\(x \\not\\in y\\)</li> <li>\u5b50\u96c6\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\subset</code>\uff0c\u5982\uff1a\\(x \\subset y\\)</li> <li>\u5b50\u96c6\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\supset</code>\uff0c\u5982\uff1a\\(x \\supset y\\)</li> <li>\u771f\u5b50\u96c6\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\subseteq</code>\uff0c\u5982\uff1a\\(x \\subseteq y\\)</li> <li>\u975e\u771f\u5b50\u96c6\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\subsetneq</code>\uff0c\u5982\uff1a\\(x \\subsetneq y\\)</li> <li>\u771f\u5b50\u96c6\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\supseteq</code>\uff0c\u5982\uff1a\\(x \\supseteq y\\)</li> <li>\u975e\u771f\u5b50\u96c6\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\supsetneq</code>\uff0c\u5982\uff1a\\(x \\supsetneq y\\)</li> <li>\u975e\u5b50\u96c6\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\not\\subset</code>\uff0c\u5982\uff1a\\(x \\not\\subset y\\)</li> <li>\u975e\u5b50\u96c6\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\not\\supset</code>\uff0c\u5982\uff1a\\(x \\not\\supset y\\)</li> <li>\u5e76\u96c6\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\cup</code>\uff0c\u5982\uff1a\\(x \\cup y\\)</li> <li>\u4ea4\u96c6\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\cap</code>\uff0c\u5982\uff1a\\(x \\cap y\\)</li> <li>\u5dee\u96c6\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\setminus</code>\uff0c\u5982\uff1a\\(x \\setminus y\\)</li> <li>\u540c\u6216\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\bigodot</code>\uff0c\u5982\uff1a\\(x \\bigodot y\\)</li> <li>\u540c\u4e0e\u8fd0\u7b97\uff0c\u7b26\u53f7\uff1a<code>\\bigotimes</code>\uff0c\u5982\uff1a\\(x \\bigotimes y\\)</li> <li>\u5b9e\u6570\u96c6\u5408\uff0c\u7b26\u53f7\uff1a<code>\\mathbb{R}</code>\uff0c\u5982\uff1a\\(\\mathbb{R}\\)</li> <li>\u81ea\u7136\u6570\u96c6\u5408\uff0c\u7b26\u53f7\uff1a<code>\\mathbb{Z}</code>\uff0c\u5982\uff1a\\(\\mathbb{Z}\\)</li> <li>\u7a7a\u96c6\uff0c\u7b26\u53f7\uff1a<code>\\emptyset</code>\uff0c\u5982\uff1a\\(\\emptyset\\)</li> </ol>"},{"location":"tools/markdown/math.html#_10","title":"\u6570\u5b66\u7b26\u53f7","text":"<ol> <li>\u65e0\u7a77\uff0c\u7b26\u53f7\uff1a<code>\\infty</code>\uff0c\u5982\uff1a\\(\\infty\\)</li> <li>\u7b26\u5408\uff0c\u7b26\u53f7\uff1a<code>\\sim</code>\uff0c\u5982 \\(u \\sim N(0, 1)\\)</li> <li>\u865a\u6570\uff0c\u7b26\u53f7\uff1a<code>\\imath</code>\uff0c\u5982\uff1a\\(\\imath\\)</li> <li>\u865a\u6570\uff0c\u7b26\u53f7\uff1a<code>\\jmath</code>\uff0c\u5982\uff1a\\(\\jmath\\)</li> <li>\u6570\u5b66\u7b26\u53f7\uff0c\u7b26\u53f7<code>\\hat{a}</code>\uff0c\u5982\uff1a\\(\\hat{a}\\)</li> <li>\u6570\u5b66\u7b26\u53f7\uff0c\u7b26\u53f7<code>\\check{a}</code>\uff0c\u5982\uff1a\\(\\check{a}\\)</li> <li>\u6570\u5b66\u7b26\u53f7\uff0c\u7b26\u53f7<code>\\breve{a}</code>\uff0c\u5982\uff1a\\(\\breve{a}\\)</li> <li>\u6570\u5b66\u7b26\u53f7\uff0c\u7b26\u53f7<code>\\tilde{a}</code>\uff0c\u5982\uff1a\\(\\tilde{a}\\)</li> <li>\u6570\u5b66\u7b26\u53f7\uff0c\u7b26\u53f7<code>\\bar{a}</code>\uff0c\u5982\uff1a\\(\\bar{a}\\)</li> <li>\u77e2\u91cf\u7b26\u53f7\uff0c\u7b26\u53f7<code>\\vec{a}</code>\uff0c\u5982\uff1a\\(\\vec{a}\\)</li> <li>\u6570\u5b66\u7b26\u53f7\uff0c\u7b26\u53f7<code>\\acute{a}</code>\uff0c\u5982\uff1a\\(\\acute{a}\\)</li> <li>\u6570\u5b66\u7b26\u53f7\uff0c\u7b26\u53f7<code>\\grave{a}</code>\uff0c\u5982\uff1a\\(\\grave{a}\\)</li> <li>\u6570\u5b66\u7b26\u53f7\uff0c\u7b26\u53f7<code>\\mathring{a}</code>\uff0c\u5982\uff1a\\(\\mathring{a}\\)</li> <li>\u4e00\u9636\u5bfc\u6570\u7b26\u53f7\uff0c\u7b26\u53f7<code>\\dot{a}</code>\uff0c\u5982\uff1a\\(\\dot{a}\\)</li> <li>\u4e8c\u9636\u5bfc\u6570\u7b26\u53f7\uff0c\u7b26\u53f7<code>\\ddot{a}</code>\uff0c\u5982\uff1a\\(\\ddot{a}\\)</li> <li>\u4e0a\u7bad\u5934\uff0c\u7b26\u53f7\uff1a<code>\\uparrow</code>\uff0c\u5982\uff1a\\(\\uparrow\\)</li> <li>\u4e0a\u7bad\u5934\uff0c\u7b26\u53f7\uff1a<code>\\Uparrow</code>\uff0c\u5982\uff1a\\(\\Uparrow\\)</li> <li>\u4e0b\u7bad\u5934\uff0c\u7b26\u53f7\uff1a<code>\\downarrow</code>\uff0c\u5982\uff1a\\(\\downarrow\\)</li> <li>\u4e0b\u7bad\u5934\uff0c\u7b26\u53f7\uff1a<code>\\Downarrow</code>\uff0c\u5982\uff1a\\(\\Downarrow\\)</li> <li>\u5de6\u7bad\u5934\uff0c\u7b26\u53f7\uff1a<code>\\leftarrow</code>\uff0c\u5982\uff1a\\(\\leftarrow\\)</li> <li>\u5de6\u7bad\u5934\uff0c\u7b26\u53f7\uff1a<code>\\Leftarrow</code>\uff0c\u5982\uff1a\\(\\Leftarrow\\)</li> <li>\u53f3\u7bad\u5934\uff0c\u7b26\u53f7\uff1a<code>\\rightarrow</code>\uff0c\u5982\uff1a\\(\\rightarrow\\)</li> <li>\u53f3\u7bad\u5934\uff0c\u7b26\u53f7\uff1a<code>\\Rightarrow</code>\uff0c\u5982\uff1a\\(\\Rightarrow\\)</li> <li>\u5e95\u7aef\u5bf9\u9f50\u7684\u7701\u7565\u53f7\uff0c\u7b26\u53f7\uff1a<code>\\ldots</code>\uff0c\u5982\uff1a\\(1,2,\\ldots,n\\)</li> <li>\u4e2d\u7ebf\u5bf9\u9f50\u7684\u7701\u7565\u53f7\uff0c\u7b26\u53f7\uff1a<code>\\cdots</code>\uff0c\u5982\uff1a\\(x_1^2 + x_2^2 + \\cdots + x_n^2\\)</li> <li>\u7ad6\u76f4\u5bf9\u9f50\u7684\u7701\u7565\u53f7\uff0c\u7b26\u53f7\uff1a<code>\\vdots</code>\uff0c\u5982\uff1a\\(\\vdots\\)</li> <li>\u659c\u5bf9\u9f50\u7684\u7701\u7565\u53f7\uff0c\u7b26\u53f7\uff1a<code>\\ddots</code>\uff0c\u5982\uff1a\\(\\ddots\\)</li> <li>\u4e09\u89d2\u53f7\uff0c\u7b26\u53f7\uff1a<code>\\triangle</code>\uff0c\u5982\uff1a\\(\\triangle\\)</li> </ol>"},{"location":"tools/markdown/math.html#_11","title":"\u5e0c\u814a\u5b57\u6bcd","text":"\u5b57\u6bcd \u5b9e\u73b0 \u5b57\u6bcd \u5b9e\u73b0 A <code>A</code> \u03b1 <code>\\alhpa</code> B <code>B</code> \u03b2 <code>\\beta</code> \u0393 <code>\\Gamma</code> \u03b3 <code>\\gamma</code> \u0394 <code>\\Delta</code> \u03b4 <code>\\delta</code> E <code>E</code> \u03f5 <code>\\epsilon</code> Z <code>Z</code> \u03b6 <code>\\zeta</code> H <code>H</code> \u03b7 <code>\\eta</code> \u0398 <code>\\Theta</code> \u03b8 <code>\\theta</code> I <code>I</code> \u03b9 <code>\\iota</code> K <code>K</code> \u03ba <code>\\kappa</code> \u039b <code>\\Lambda</code> \u03bb <code>\\lambda</code> M <code>M</code> \u03bc <code>\\mu</code> N <code>N</code> \u03bd <code>\\nu</code> \u039e <code>\\Xi</code> \u03be <code>\\xi</code> O <code>O</code> \u03bf <code>\\omicron</code> \u03a0 <code>\\Pi</code> \u03c0 <code>\\pi</code> P <code>P</code> \u03c1 <code>\\rho</code> \u03a3 <code>\\Sigma</code> \u03c3 <code>\\sigma</code> T <code>T</code> \u03c4 <code>\\tau</code> \u03a5 <code>\\Upsilon</code> \u03c5 <code>\\upsilon</code> \u03a6 <code>\\Phi</code> \u03d5 <code>\\phi</code> X <code>X</code> \u03c7 <code>\\chi</code> \u03a8 <code>\\Psi</code> \u03c8 <code>\\psi</code> \u03a9 <code>\\v</code> \u03c9 <code>\\omega</code>"},{"location":"tools/markdown/mermaid.html","title":"mermaid","text":""},{"location":"tools/markdown/mermaid.html#_1","title":"\u6d41\u7a0b\u56fe","text":"<p>\u57fa\u672c\u8bed\u6cd5\uff1a</p> <ul> <li><code>graph</code> \u6307\u5b9a\u6d41\u7a0b\u56fe\u65b9\u5411\uff1a<code>graph LR</code> \u6a2a\u5411\uff0c<code>graph TD</code> \u7eb5\u5411</li> <li>\u5143\u7d20\u7684\u5f62\u72b6\u5b9a\u4e49\uff1a</li> <li><code>id[\u63cf\u8ff0]</code> \u4ee5\u76f4\u89d2\u77e9\u5f62\u7ed8\u5236</li> <li><code>id(\u63cf\u8ff0)</code> \u4ee5\u5706\u89d2\u77e9\u5f62\u7ed8\u5236</li> <li><code>id{\u63cf\u8ff0}</code> \u4ee5\u83f1\u5f62\u7ed8\u5236</li> <li><code>id&gt;\u63cf\u8ff0]</code> \u4ee5\u4e0d\u5bf9\u79f0\u77e9\u5f62\u7ed8\u5236</li> <li><code>id((\u63cf\u8ff0))</code> \u4ee5\u5706\u5f62\u7ed8\u5236</li> <li>\u7ebf\u6761\u5b9a\u4e49\uff1a</li> <li><code>A--&gt;B</code> \u5e26\u7bad\u5934\u6307\u5411</li> <li><code>A---B</code> \u4e0d\u5e26\u7bad\u5934\u8fde\u63a5</li> <li><code>A-.-B</code> \u865a\u7ebf\u8fde\u63a5</li> <li><code>A-.-&gt;B</code> \u865a\u7ebf\u6307\u5411</li> <li><code>A==&gt;B</code> \u52a0\u7c97\u7bad\u5934\u6307\u5411</li> <li><code>A--\u63cf\u8ff0---B</code> \u4e0d\u5e26\u7bad\u5934\u6307\u5411\u5e76\u5728\u7ebf\u6bb5\u4e2d\u95f4\u6dfb\u52a0\u63cf\u8ff0</li> <li><code>A--\u63cf\u8ff0--&gt;B</code> \u5e26\u63cf\u8ff0\u7684\u7bad\u5934\u6307\u5411</li> <li><code>A-.\u63cf\u8ff0.-&gt;B</code> \u5e26\u63cf\u8ff0\u7684\u865a\u7ebf\u8fde\u6307\u5411</li> <li><code>A==\u63cf\u8ff0==&gt;B</code> \u5e26\u63cf\u8ff0\u7684\u52a0\u7c97\u7bad\u5934\u6307\u5411</li> </ul> <pre><code>graph LR\n    A(\u5f00\u59cb) --\u8d77\u5f97\u6765--&gt;B(\u8d77\u5e8a) \n    A(\u5f00\u59cb) --\u8d77\u4e0d\u6765--&gt;H(\u7761\u89c9) \n    B --\u5929\u6c14\u4e0d\u597d--- C&gt;\u5e72\u6d3b]\n    C ==&gt; D{\u4f11\u606f\u65f6\u95f4\u5230\u4e86}\n    D -.yes.-&gt; E((\u4f11\u606f))\n    D -.no.-&gt; C\n    E --&gt; F(\u5403\u996d)</code></pre>"},{"location":"tools/markdown/mermaid.html#_2","title":"\u65f6\u5e8f\u56fe","text":"<p>\u7ebf\u6bb5\u6837\u5f0f</p> <ul> <li><code>-&gt;</code> \uff1a \u5b9e\u7ebf\u8fde\u63a5</li> <li><code>--&gt;</code> \uff1a\u865a\u7ebf\u8fde\u63a5</li> <li><code>-&gt;&gt;</code> \uff1a\u5b9e\u7ebf\u7bad\u5934\u6307\u5411</li> <li><code>--&gt;&gt;</code> \uff1a\u865a\u7ebf\u7bad\u5934\u6307\u5411</li> </ul> <pre><code>sequenceDiagram\n\u5bf9\u8c61A-&gt;\u5bf9\u8c61B:\u4e2d\u5348\u5403\u4ec0\u4e48\uff1f\n\u5bf9\u8c61B-&gt;&gt;\u5bf9\u8c61A: \u968f\u4fbf\nloop \u601d\u8003\n    \u5bf9\u8c61A-&gt;\u5bf9\u8c61A: \u52aa\u529b\u641c\u7d22\nend\n\u5bf9\u8c61A--&gt;&gt;\u5bf9\u8c61B: \u706b\u9505\uff1f\n\u5bf9\u8c61B-&gt;&gt;\u5bf9\u8c61A: \u53ef\u4ee5\nNote left of \u5bf9\u8c61A: \u6211\u662f\u4e00\u4e2a\u5bf9\u8c61A\nNote right of \u5bf9\u8c61B: \u6211\u662f\u4e00\u4e2a\u5bf9\u8c61B\nparticipant \u5bf9\u8c61C\nNote over \u5bf9\u8c61C: \u6211\u81ea\u5df1\u8bf4\u4e86\u7b97</code></pre>"},{"location":"tools/markdown/typora.html","title":"Typora","text":"<p>[toc]</p>"},{"location":"tools/markdown/typora.html#markdown","title":"Markdown \u5bfc\u51fa","text":"<p>Typora\u6682\u65f6\u4e0d\u652f\u6301\u901a\u8fc7\u547d\u4ee4\u884c\u7684\u5f62\u5f0f\u8fdb\u884c\u6587\u4ef6\u7684\u5bfc\u51fa\u3002https://github.com/typora/typora-issues/issues/1999</p> <p>pandoc \u5c06md\u8f6c\u4e3apdf\u65f6\uff0c\u4e0d\u662f\u5b8c\u5168\u517c\u5bb9Typora\u4e2d\u7684md\uff0c\u8f93\u51fa\u7684\u683c\u5f0f\u4f1a\u4e0d\u5bf9\u3002</p>"},{"location":"tools/maven/index.html","title":"MAVEN","text":""},{"location":"tools/maven/index.html#_1","title":"\u63d2\u4ef6","text":"<ul> <li>\u5e38\u7528\u7684\u63d2\u4ef6</li> </ul>"},{"location":"tools/maven/index.html#_2","title":"\u53c2\u6570","text":"<pre><code># -T\u591a\u7ebf\u7a0b 1C \u4e00\u6838\u4e00\u7ebf\u7a0b\nmvn clean -DskipTests -T 1C package  \n</code></pre>"},{"location":"tools/maven/index.html#_3","title":"\u751f\u547d\u5468\u671f","text":"<p>[ validate, initialize, generate-sources, process-sources, generate-resources, process-resources, compile, process-classes, generate-test-sources, process-test-sources, generate-test-resources, process-test-resources, test-compile, process-test-classes, test, prepare-package, package, pre-integration-test, integration-test, post-integration-test, verify, install, deploy ]</p>"},{"location":"tools/maven/index.html#_4","title":"\u63d2\u4ef6\u6267\u884c\u987a\u5e8f","text":"<p>maven\u5bf9\u4e8e\u7ed1\u5b9a\u5230\u540c\u4e00phase\u4e0a\u7684\u591a\u4e2a\u63d2\u4ef6\u7684\u6267\u884c\u987a\u5e8f\u662f\u6309\u7167\u5b83\u4eec\u5728pom.xml\u58f0\u660e\u7684\u987a\u5e8f\u6765\u7684\u3002</p> <p>\u5982\u679c\u5728\u7236 pom \u4e2d\u5b9a\u4e49\uff0c\u6216\u8005\u5728 profile \u7684 plugins \u5b9a\u4e49\uff0c\u9700\u8981\u5728\u5b50pom\u4e2d\u91cd\u65b0\u58f0\u660e\uff0c\u4ee5\u6307\u5b9a\u6267\u884c\u987a\u5e8f\u3002</p> <p>Parent pom.xml</p> <pre><code>&lt;plugins&gt;\n    &lt;plugin&gt;\n        &lt;groupId&gt;groupid.maven.1&lt;/groupId&gt;\n        &lt;artifactId&gt;maven-plugin-1&lt;/artifactId&gt;\n        &lt;version&gt;1.0&lt;/version&gt;\n        &lt;executions&gt;\n            &lt;execution&gt;\n                &lt;phase&gt;package&lt;/phase&gt;\n            &lt;/execution&gt;\n        &lt;/executions&gt;\n    &lt;/plugin&gt;\n&lt;/plugins&gt;\n</code></pre> <p>Child pom.xml</p> <pre><code>&lt;plugins&gt;\n    &lt;plugin&gt;\n        &lt;groupId&gt;groupid.maven.2&lt;/groupId&gt;\n        &lt;artifactId&gt;maven-plugin-2&lt;/artifactId&gt;\n        &lt;version&gt;1.0&lt;/version&gt;\n        &lt;executions&gt;\n            &lt;execution&gt;\n                &lt;phase&gt;package&lt;/phase&gt;\n            &lt;/execution&gt;\n        &lt;/executions&gt;\n    &lt;/plugin&gt;\n    &lt;plugin&gt;\n        &lt;groupId&gt;groupid.maven.1&lt;/groupId&gt;\n        &lt;artifactId&gt;maven-plugin-1&lt;/artifactId&gt;\n    &lt;/plugin&gt;\n&lt;/plugins&gt;\n</code></pre>"},{"location":"tools/maven/index.html#_5","title":"\u914d\u7f6e","text":""},{"location":"tools/maven/index.html#_6","title":"\u4f9d\u8d56\u7ba1\u7406","text":"<p>\u51b2\u7a81\u89e3\u51b3</p> <p>\u5728\u914d\u7f6e\u6587\u4ef6pom.xml\u4e2d\u5148\u58f0\u660e\u8981\u4f7f\u7528\u54ea\u4e2a\u7248\u672c\u7684\u76f8\u5e94jar\u5305\uff0c\u58f0\u660e\u540e\u5176\u4ed6\u7248\u672c\u7684jar\u5305\u4e00\u5f8b\u4e0d\u4f9d\u8d56\u3002\uff08type\u548cimport\u8868\u793a\u4ece\u8be5pom\u6587\u4ef6\u4e2d\u7ee7\u627f\u4f9d\u8d56\u7ba1\u7406\uff09</p> <pre><code>&lt;properties&gt;\n    &lt;spring.version&gt;4.2.4.RELEASE&lt;/spring.version&gt;\n    &lt;hibernate.version&gt;5.0.7.Final&lt;/hibernate.version&gt;\n    &lt;struts.version&gt;2.3.24&lt;/struts.version&gt;\n&lt;/properties&gt;\n&lt;dependencyManagement&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-context&lt;/artifactId&gt;\n            &lt;version&gt;${spring.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.cbm.stu&lt;/groupId&gt;\n            &lt;artifactId&gt;maven-parent-a&lt;/artifactId&gt;\n            &lt;version&gt;1.0.0&lt;/version&gt;\n            &lt;type&gt;pom&lt;/type&gt;\n            &lt;scope&gt;import&lt;/scope&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n&lt;/dependencyManagement&gt;\n</code></pre>"},{"location":"tools/maven/index.html#_7","title":"\u6784\u5efa","text":""},{"location":"tools/maven/index.html#maven_1","title":"Maven\u5355\u72ec\u6784\u5efa\u591a\u6a21\u5757\u9879\u76ee\u4e2d\u7684\u5355\u4e2a\u6a21\u5757","text":"<p>\u8bf4\u660e\uff1a</p> <p>1\u3001\u53ef\u80fd\u5b58\u5728\u7684\u573a\u666f\uff0c\u591a\u6a21\u5757\u9879\u76ee\u6ca1\u6709\u4e92\u76f8\u5f15\u7528\uff0c\u90a3\u4e48\u6b64\u65f6\u53ef\u4ee5\u5355\u72ec\u6784\u5efa\u5355\u4e2a\u9879\u76ee\uff0c\u6307\u5b9a\u5230\u5b50\u6a21\u5757\u7684pom.xml\u6587\u4ef6\u5373\u53ef\u5b8c\u6210\u7f16\u8bd1\u3002</p> <p>2\u3001\u5982\u679c\u591a\u6a21\u5757\u9879\u76ee\u5404\u81ea\u90fd\u5f15\u7528\u4e86\uff0c\u90a3\u4e48\u5355\u72ec\u7f16\u8bd1\u5b50\u6a21\u5757\u7684pom.xml\u6587\u4ef6\u4f1a\u76f4\u63a5\u62a5\u9519\uff0c\u89e3\u51b3\u65b9\u6cd5\u5c31\u662f\u7f16\u8bd1\u7236\u9879\u76eepom.xml\u3002</p> <p>3\u3001\u5982\u679c\u7f16\u8bd1\u7236\u9879\u76ee\uff0c\u90a3\u4e48\u53ef\u80fd\u4f1a\u9020\u6210\u7f16\u8bd1\u65f6\u95f4\u5f88\u6162\uff0c\u5176\u4e2d\u6709\u4e9b\u9879\u76ee\u4e5f\u4e0d\u9700\u8981\u7f16\u8bd1\uff0c\u89e3\u51b3\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <p>Maven\u9009\u9879\uff1a</p> <pre><code>-pl, --projects\n        Build specified reactor projects instead of all projects\n-am, --also-make\n        If project list is specified, also build projects required by the list\n-amd, --also-make-dependents\n        If project list is specified, also build projects that depend on projects on the list\n</code></pre> <p>\u9996\u5148\u5207\u6362\u5230\u5de5\u7a0b\u7684\u6839\u76ee\u5f55</p> <p>\u5355\u72ec\u6784\u5efa\u6a21\u5757jsoft-web\uff0c\u540c\u65f6\u4f1a\u6784\u5efajsoft-web\u6a21\u5757\u4f9d\u8d56\u7684\u5176\u4ed6\u6a21\u5757</p> <pre><code>mvn install -pl jsoft-web -am\n</code></pre> <p>\u5355\u72ec\u6784\u5efa\u6a21\u5757jsoft-common\uff0c\u540c\u65f6\u6784\u5efa\u4f9d\u8d56\u6a21\u5757jsoft-common\u7684\u5176\u4ed6\u6a21\u5757 </p> <pre><code>mvn install -pl jsoft-common -am -amd\n</code></pre>"},{"location":"tools/maven/index.html#resources","title":"Resources","text":"<ul> <li>\u9ed8\u8ba4\u4f1a\u628asrc/main/resources\u4e0b\u7684\u6587\u4ef6\u548cclass\u6587\u4ef6\u4e00\u8d77\u6253\u5305\u5230jar\u5185\u90e8\uff0c\u53ef\u4ee5\u901a\u8fc7</li> </ul> <pre><code>&lt;build&gt;\n    &lt;resources&gt;\u00a0\u00a0\n        &lt;resource&gt;\u00a0\u00a0\n            &lt;directory&gt;src/main/resources&lt;/directory&gt;\u00a0\u00a0\n            &lt;includes&gt;\u00a0\u00a0\n                &lt;include&gt;*.txt&lt;/include&gt;\u00a0\u00a0\n            &lt;/includes&gt;\u00a0\u00a0\n            &lt;excludes&gt;\u00a0\u00a0\n                &lt;exclude&gt;*.xml&lt;/exclude&gt;\u00a0\u00a0\n            &lt;/excludes&gt;\u00a0\u00a0\n        &lt;/resource&gt;\u00a0\u00a0\n        &lt;!-- \u628asrc/main/resources\u76ee\u5f55\u4e0b\u6240\u6709\u7684\u6587\u4ef6\u62f7\u8d1d\u5230conf\u76ee\u5f55\u4e2d --&gt;\n        &lt;resource&gt;\n            &lt;directory&gt;src/main/resources&lt;/directory&gt;\n            &lt;targetPath&gt;${project.build.directory}/conf&lt;/targetPath&gt;\n        &lt;/resource&gt;\n        &lt;!-- \u628alib\u76ee\u5f55\u4e0b\u6240\u6709\u7684\u6587\u4ef6\u62f7\u8d1d\u5230lib\u76ee\u5f55\u4e2d\n            \uff08\u53ef\u80fd\u6709\u4e9bjar\u5305\u6ca1\u6709\u529e\u6cd5\u5728maven\u4e2d\u627e\u5230\uff0c\u9700\u8981\u653e\u5728lib\u76ee\u5f55\u4e2d\uff09 --&gt;\n        &lt;resource&gt;\n            &lt;directory&gt;lib&lt;/directory&gt;\n            &lt;targetPath&gt;${project.build.directory}/lib&lt;/targetPath&gt;\n        &lt;/resource&gt;\n        &lt;!-- \u628a\u653e\u5728\u6839\u76ee\u5f55\u4e0b\u7684\u811a\u672c\u6587\u4ef6.sh,.bat\u62f7\u8d1d\u5230bin\u76ee\u5f55\u4e2d --&gt;\n        &lt;resource&gt;\n            &lt;directory&gt;.&lt;/directory&gt;\n            &lt;includes&gt;\n                &lt;include&gt;**/*.sh&lt;/include&gt;\n                &lt;include&gt;**/*.bat&lt;/include&gt;\n            &lt;/includes&gt;\n            &lt;targetPath&gt;${project.build.directory}/bin&lt;/targetPath&gt;\n        &lt;/resource&gt;\n    &lt;/resources&gt;\u00a0\u00a0\n&lt;/build&gt;\n</code></pre>"},{"location":"tools/maven/plugins.html","title":"\u63d2\u4ef6","text":"<p>[toc]</p>"},{"location":"tools/maven/plugins.html#maven-plugins","title":"Maven Plugins","text":""},{"location":"tools/maven/plugins.html#_1","title":"\u5b98\u65b9\u6e05\u5355","text":"<p>http://maven.apache.org/plugins/index.html</p>"},{"location":"tools/maven/plugins.html#flatten-maven-plugin","title":"flatten-maven-plugin\uff08\u591a\u6a21\u5757\u7248\u672c\u53f7\uff09","text":"<p>Releases \u00b7 mojohaus/flatten-maven-plugin (github.com)</p> <p>\u7528\u4e8e\u5927\u578b\u7684\u591amaven\u6a21\u5757\u7684\u9879\u76ee\uff0c\u7528\u4e8e\u7248\u672c\u53f7\u7684\u7ba1\u7406\u3002</p> <ul> <li>\u6253\u5305\u7684\u65f6\u5019\uff08package\u3001install\u3001deploy\uff09\u5c06\u751f\u6210 <code>.flattened-pom.xml</code>\u505a\u4e3a\u5f53\u524d\u9879\u76ee\u7684 pom \u6587\u4ef6</li> </ul> <p>\u7236 pom</p> <pre><code>&lt;!-- \u5728 \u7236 pom \u4e2d\u5b9a\u4e49 ${revision} \u53d8\u91cf--&gt;\n&lt;version&gt;${revision}&lt;/version&gt;\n&lt;packaging&gt;pom&lt;/packaging&gt;\n\n&lt;properties&gt;\n    &lt;revision&gt;1.0.2&lt;/revision&gt;\n&lt;/properties&gt;\n\n\n\n&lt;plugin&gt;\n    &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;\n    &lt;artifactId&gt;flatten-maven-plugin&lt;/artifactId&gt;\n    &lt;version&gt;1.5.0&lt;/version&gt;\n    &lt;configuration&gt;\n        &lt;!-- \u5bf9\u4e8e packaging \u4e3a pom \u7c7b\u578b\u7684\u9879\u76ee\u4e5f\u4f7f\u7528\u751f\u6210\u7684 .flattened-pom.xml --&gt;\n        &lt;updatePomFile&gt;true&lt;/updatePomFile&gt;\n        &lt;flattenMode&gt;resolveCiFriendliesOnly&lt;/flattenMode&gt;\n    &lt;/configuration&gt;\n    &lt;executions&gt;\n        &lt;execution&gt;\n            &lt;id&gt;flatten&lt;/id&gt;\n            &lt;phase&gt;process-resources&lt;/phase&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;flatten&lt;/goal&gt;\n            &lt;/goals&gt;\n        &lt;/execution&gt;\n        &lt;execution&gt;\n            &lt;id&gt;flatten.clean&lt;/id&gt;\n            &lt;phase&gt;clean&lt;/phase&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;clean&lt;/goal&gt;\n            &lt;/goals&gt;\n        &lt;/execution&gt;\n    &lt;/executions&gt;\n&lt;/plugin&gt;\n</code></pre> <p>\u5b50 pom</p> <pre><code>&lt;parent&gt;\n  &lt;version&gt;${revision}&lt;/version&gt;\n&lt;/parent&gt;\n&lt;!-- \u5b50\u6a21\u5757\u7684\u7248\u672c\u5e94\u8be5\u4f7f\u7528\u7236\u5de5\u7a0b\u7684\u7248\u672c\uff0c\u5355\u72ec\u8bbe\u7f6e\u7248\u672c\u7684\u8bdd\u4f1a\u5bfc\u81f4\u7248\u672c\u6df7\u4e71\uff0c\u5373\u4e0d\u8bbe\u7f6e version --&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.maven.ci&lt;/groupId&gt;\n    &lt;artifactId&gt;child2&lt;/artifactId&gt;\n    &lt;!-- \u4ee5\u6765\u5176\u5b83\u5b50\u6a21\u5757\u65f6\uff0c\u4f7f\u7528 ${project.version} \u6216\u8005 ${revision} \u90fd\u53ef\u4ee5 --&gt;\n    &lt;version&gt;${project.version}&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"tools/maven/plugins.html#dependency-plugin","title":"dependency-plugin","text":"<p>\u5c06\u4f9d\u8d56\u7684\u5305\u9012\u5f52\u4e0b\u8f7d\uff0c\u5e76\u62f7\u8d1d\u5230\u6307\u5b9a\u76ee\u5f55</p> <pre><code>&lt;plugin&gt;\n    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n    &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;\n    &lt;executions&gt;\n        &lt;execution&gt;\n            &lt;id&gt;copy-dependencies&lt;/id&gt;\n            &lt;phase&gt;package&lt;/phase&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;copy-dependencies&lt;/goal&gt;\n            &lt;/goals&gt;\n            &lt;configuration&gt;\n                &lt;outputDirectory&gt;${project.build.directory}&lt;/outputDirectory&gt;\n                &lt;overWriteReleases&gt;true&lt;/overWriteReleases&gt;\n                &lt;overWriteSnapshots&gt;true&lt;/overWriteSnapshots&gt;\n                &lt;overWriteIfNewer&gt;true&lt;/overWriteIfNewer&gt;\n                &lt;useSubDirectoryPerType&gt;true&lt;/useSubDirectoryPerType&gt;\n                &lt;!--                        &lt;includeArtifactIds&gt;--&gt;\n                &lt;!--                            Rserve,breeze_${scala.binary.version},breeze-natives_${scala.binary.version}--&gt;\n                &lt;!--                        &lt;/includeArtifactIds&gt;--&gt;\n                &lt;silent&gt;true&lt;/silent&gt;\n            &lt;/configuration&gt;\n        &lt;/execution&gt;\n    &lt;/executions&gt;\n&lt;/plugin&gt;\n</code></pre>"},{"location":"tools/maven/plugins.html#assembly-plugin","title":"assembly plugin","text":"<p>http://maven.apache.org/plugins/maven-assembly-plugin/usage.html</p> <ul> <li>maven-assembly-plugin\uff0c\u652f\u6301\u81ea\u5b9a\u4e49\u7684\u6253\u5305\u7ed3\u6784\uff0c\u4e5f\u53ef\u4ee5\u5b9a\u5236\u4f9d\u8d56\u9879\u7b49\u3002</li> </ul> <p>Maven\u9884\u5148\u5b9a\u4e49\u597d\u7684\u63cf\u8ff0\u7b26\u6709bin\uff0csrc\uff0cproject\uff0cjar-with-dependencies\u7b49\u3002\u6bd4\u8f83\u5e38\u7528\u7684\u662fjar-with-dependencies\uff0c\u5b83\u662f\u5c06\u6240\u6709\u5916\u90e8\u4f9d\u8d56JAR\u90fd\u52a0\u5165\u751f\u6210\u7684JAR\u5305</p> <pre><code>    &lt;plugin&gt;\n        &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;\n        &lt;version&gt;3.3.0&lt;/version&gt;\n        &lt;configuration&gt;\n            &lt;descriptorRefs&gt;\n                &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;\n            &lt;/descriptorRefs&gt;\n        &lt;/configuration&gt;\n        &lt;executions&gt;\n            &lt;execution&gt;\n                &lt;id&gt;make-assembly&lt;/id&gt;\n                &lt;phase&gt;package&lt;/phase&gt;\n                &lt;goals&gt;\n                    &lt;goal&gt;single&lt;/goal&gt;\n                &lt;/goals&gt;\n            &lt;/execution&gt;\n        &lt;/executions&gt;\n    &lt;/plugin&gt;\n</code></pre>"},{"location":"tools/maven/plugins.html#shade-plugin","title":"shade plugin","text":"<ul> <li>maven-jar-plugin\uff0c\u9ed8\u8ba4\u7684\u6253\u5305\u63d2\u4ef6\uff0c\u7528\u6765\u6253\u666e\u901a\u7684project JAR\u5305\uff1b</li> <li>maven-shade-plugin\uff0c\u7528\u6765\u6253\u53ef\u6267\u884cJAR\u5305\uff0c\u4e5f\u5c31\u662f\u6240\u8c13\u7684fat JAR\u5305\uff1b</li> <li>maven-assembly-plugin\uff0c\u652f\u6301\u5b9a\u5236\u5316\u6253\u5305\u65b9\u5f0f\uff0c\u4f8b\u5982 apache \u9879\u76ee\u7684\u6253\u5305\u65b9\u5f0f</li> </ul> <p>\u4f7f\u7528 maven-shade-plugin \u65f6\u9700\u8981\u5c0f\u5fc3\u5904\u7406\u5b57\u7b26\u4e32</p> <p>\u4e0b\u9762\u7684\u793a\u4f8b\u5c06jedis \u6253\u8fdb\u4e86 jar \u5305\u4e2d\uff0c\u5e76\u4e14\u5c06\u5305\u540d\u524d\u7f00\u6539\u4e3a <code>scyuan.maven.shaded.redis</code></p> <pre><code>&lt;plugin&gt;\n     &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n     &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;\n     &lt;version&gt;3.1.1&lt;/version&gt;\n     &lt;configuration&gt;\n         &lt;artifactSet&gt;\n             &lt;includes&gt;\n                 &lt;include&gt;redis.clients:jedis&lt;/include&gt;\n                 &lt;include&gt;org.apache.commons:commons-pool2&lt;/include&gt;\n             &lt;/includes&gt;\n         &lt;/artifactSet&gt;\n         &lt;filters&gt;\n             &lt;filter&gt;\n                 &lt;artifact&gt;*:*&lt;/artifact&gt;\n                 &lt;excludes&gt;\n                     &lt;exclude&gt;META-INF/*.SF&lt;/exclude&gt;\n                     &lt;exclude&gt;META-INF/*.DSA&lt;/exclude&gt;\n                     &lt;exclude&gt;META-INF/*.RSA&lt;/exclude&gt;\n                 &lt;/excludes&gt;\n             &lt;/filter&gt;\n         &lt;/filters&gt;\n         &lt;relocations&gt;\n             &lt;relocation&gt;\n                 &lt;pattern&gt;redis&lt;/pattern&gt;\n                 &lt;shadedPattern&gt;scyuan.maven.shaded.redis&lt;/shadedPattern&gt;\n             &lt;/relocation&gt;\n             &lt;relocation&gt;\n                 &lt;pattern&gt;org.apache.commons&lt;/pattern&gt;\n                 &lt;shadedPattern&gt;scyuan.maven.shaded.org.apache.commons&lt;/shadedPattern&gt;\n             &lt;/relocation&gt;\n         &lt;/relocations&gt;\n     &lt;/configuration&gt;\n     &lt;executions&gt;\n         &lt;execution&gt;\n             &lt;phase&gt;package&lt;/phase&gt;\n             &lt;goals&gt;\n                 &lt;goal&gt;shade&lt;/goal&gt;\n             &lt;/goals&gt;\n         &lt;/execution&gt;\n     &lt;/executions&gt;\n&lt;/plugin&gt;\n</code></pre>"},{"location":"tools/maven/plugins.html#maven-checkstyle-plugin","title":"maven-checkstyle-plugin","text":"<p>java\u4ee3\u7801\u98ce\u683c\u7684checkstyle</p> <pre><code>&lt;plugin&gt;\n    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n    &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;\n    &lt;version&gt;3.1.1&lt;/version&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.puppycrawl.tools&lt;/groupId&gt;\n            &lt;artifactId&gt;checkstyle&lt;/artifactId&gt;\n            &lt;version&gt;8.36&lt;/version&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n    &lt;configuration&gt;\n        &lt;configLocation&gt;Build/hongcheng_checkstyle.xml&lt;/configLocation&gt;\n    &lt;/configuration&gt;\n&lt;/plugin&gt;\n</code></pre>"},{"location":"tools/maven/plugins.html#maven-clean-plugin","title":"maven-clean-plugin","text":"<p>mvn clean\u65f6\u8c03\u7528\u7684\u5c31\u662f\u8fd9\u4e2a\u63d2\u4ef6\uff0c\u4e3b\u8981\u4f5c\u7528\u5c31\u662f\u6e05\u7406\u6784\u5efa\u76ee\u5f55\u4e0b\u5f97\u5168\u90e8\u5185\u5bb9,\u6784\u5efa\u76ee\u5f55\u9ed8\u8ba4\u662ftarget\uff1b</p> <p>\u6784\u5efa\u65f6\u9700\u8981\u6e05\u7406\u6784\u5efa\u76ee\u5f55\u4ee5\u5916\u7684\u6587\u4ef6\uff0c\u6bd4\u5982\u5236\u5b9a\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u914d\u7f6e<code>&lt;filesets&gt;</code>\u6765\u5b9e\u73b0\u4e86\u3002</p>"},{"location":"tools/maven/plugins.html#maven-compile-plugin","title":"maven-compile-plugin","text":"<p>\u6307\u5b9a\u7f16\u8bd1\u7528\u7684java\u7248\u672c\u53f7</p> <pre><code>&lt;plugin&gt;\n    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n    &lt;configuration&gt;\n        &lt;source&gt;1.8&lt;/source&gt;\n        &lt;target&gt;1.8&lt;/target&gt;\n    &lt;/configuration&gt;\n&lt;/plugin&gt;\n</code></pre>"},{"location":"tools/maven/plugins.html#maven-dependency-plugin","title":"maven-dependency-plugin","text":"<p>dependency:copy\uff1a\u5c06\u4e00\u7cfb\u5217\u5728\u6b64\u63d2\u4ef6\u5185\u5217\u51fa\u7684artifacts \uff0c\u5c06\u4ed6\u4eeccopy\u5230\u4e00\u4e2a\u7279\u6b8a\u7684\u5730\u65b9\uff0c\u91cd\u547d\u540d\u6216\u8005\u53bb\u9664\u5176\u7248\u672c\u4fe1\u606f\u3002</p> <p>\u8fd9\u4e2a\u53ef\u4ee5\u89e3\u51b3\u8fdc\u7a0b\u4ed3\u5e93\u5b58\u5728\u4f46\u662f\u672c\u5730\u4ed3\u5e93\u4e0d\u5b58\u5728\u7684\u4f9d\u8d56\u95ee\u9898\uff0ccopy\u64cd\u4f5c\u53ef\u4ee5\u7528\u6765\u5c06\u67d0\u4e2a\uff08\u4e9b\uff09maven artifact(s)\u62f7\u8d1d\u5230\u67d0\u4e2a\u76ee\u5f55\u3002</p>"},{"location":"tools/maven/plugins.html#maven-enforcer-plugin","title":"maven-enforcer-plugin","text":"<p>jar\u51b2\u7a81\uff0c\u8fdb\u884cmvn clean package\u7684\u65f6\u5019\uff0c\u4f1a\u5728console\u4e2d\u6253\u5370\u51fa\u6765\u51b2\u7a81\u7684jar\u7248\u672c\u548c\u5176\u7236pom\u3002</p>"},{"location":"tools/maven/plugins.html#maven-antrun-plugin","title":"maven-antrun-plugin","text":"<p>\u4eceMaven\u5185\u8fd0\u884cAnt\u4efb\u52a1\u7684\u529f\u80fd\uff0c\u5c06ant\u9879\u76ee\u8fc1\u79fb\u5230maven\u3002</p> <pre><code>&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n&lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;\n&lt;version&gt;1.8&lt;/version&gt;\n</code></pre>"},{"location":"tools/maven/plugins.html#maven-source-plugin","title":"maven-source-plugin","text":"<p>\u63d0\u4f9b\u9879\u76ee\u81ea\u52a8\u5c06\u6e90\u7801\u6253\u5305\u5e76\u53d1\u5e03\u7684\u529f\u80fd</p>"},{"location":"tools/maven/plugins.html#maven-javadoc-plugin","title":"maven-javadoc-plugin","text":"<p>maven install \u65f6\u4e00\u76f4\u62a5\u9519\uff0cjavadoc \u63d0\u793aN\u591a\u8b66\u544a\uff0c\u914d\u7f6e<code>additionalparam\u53c2\u6570\u4e3aXdoclint:none</code>\u3002</p> <pre><code>&lt;plugin&gt;\n    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n    &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;\n    &lt;version&gt;3.2.0&lt;/version&gt;\n    &lt;executions&gt;\n        &lt;execution&gt;\n            &lt;phase&gt;package&lt;/phase&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;jar&lt;/goal&gt;\n            &lt;/goals&gt;\n            &lt;configuration&gt;\n\n                &lt;additionalJOption&gt;-Xdoclint:none&lt;/additionalJOption&gt;\n            &lt;/configuration&gt;\n        &lt;/execution&gt;\n    &lt;/executions&gt;\n&lt;/plugin&gt;\n</code></pre>"},{"location":"tools/maven/plugins.html#maven-jar-plugin","title":"maven-jar-plugin","text":"<p>\u6253\u5305\u7684\u63d2\u4ef6\u3002</p> <pre><code>&lt;!-- \u7528\u4e8e\u751f\u6210jar\u5305\u7684plugin --&gt;\n&lt;plugin&gt;\n    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n    &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;\n    &lt;version&gt;2.6&lt;/version&gt;\n    &lt;configuration&gt;\n        &lt;!-- \u628a\u751f\u6210\u7684jar\u5305\u653e\u5728lib\u76ee\u5f55\u4e0b\uff08\u548c\u5176\u4ed6\u6240\u6709jar\u5305\u4e00\u8d77\uff09 --&gt;\n        &lt;outputDirectory&gt;${project.build.directory}/lib&lt;/outputDirectory&gt;\n        &lt;archive&gt;\n            &lt;manifest&gt;\n                &lt;addClasspath&gt;true&lt;/addClasspath&gt;\n                &lt;classpathPrefix&gt;lib/&lt;/classpathPrefix&gt;\n            &lt;/manifest&gt;\n        &lt;/archive&gt;\n        &lt;excludes&gt;\n            &lt;!-- \u6392\u9664\u6389\u4e00\u4e9b\u6587\u4ef6,\u4e0d\u8981\u653e\u5230jar\u5305\u4e2d\uff0c\n                    \u8fd9\u91cc\u662f\u4e3a\u4e86\u6392\u9664\u6389src/main/resources\u4e2d\u7684\u6587\u4ef6\uff08\u5b83\u4eec\u5e94\u8be5\u653e\u5230conf\u76ee\u5f55\uff09\n                    \u8fd9\u91cc\u53ea\u80fd\u6307\u5b9a\u8981\u6392\u9664\u7684\u76ee\u6807\u6587\u4ef6\uff0c\u800c\u4e0d\u80fd\u6307\u5b9a\u6e90\u6587\u4ef6\uff0c\u867d\u7136\u4e0d\u591f\u5b8c\u7f8e\uff0c\u4f46\u662f\u57fa\u672c\u80fd\u8fbe\u5230\u76ee\u7684\u3002 --&gt;\n            &lt;exclude&gt;*.xml&lt;/exclude&gt;\n            &lt;exclude&gt;*.properties&lt;/exclude&gt;\n        &lt;/excludes&gt;\n    &lt;/configuration&gt;\n&lt;/plugin&gt;\n</code></pre>"},{"location":"tools/maven/plugins.html#maven-install-plugin","title":"maven-install-plugin","text":"<p>The Install Plugin is used during the install phase to add artifact(s) to the local repository.</p> <p>The local repository is the local cache where all artifacts needed for the build are stored. By default, it is located within the user's home directory (~/.m2/repository) but the location can be configured in ~/.m2/settings.xml using the  element."},{"location":"tools/maven/plugins.html#maven-deploy-plugin","title":"maven-deploy-plugin","text":"<p>\u6253\u5305\u53d1\u5e03\u5230maven\u4ed3\u5e93\u4e2d\uff0c\u53ef\u4ee5\u914d\u7f6e\u53d1\u5e03\u5230\u79c1\u670d\u4e2d\uff1b</p>"},{"location":"tools/maven/plugins.html#maven-surefire-pluginjava-test","title":"maven-surefire-plugin(java test)","text":"<p>Maven\u6240\u505a\u7684\u53ea\u662f\u5728\u6784\u5efa\u6267\u884c\u5230\u7279\u5b9a\u751f\u547d\u5468\u671f\u9636\u6bb5\u7684\u65f6\u5019\uff0c\u901a\u8fc7\u63d2\u4ef6\u6765\u6267\u884cJUnit\u6216\u8005TestNG\u7684\u6d4b\u8bd5\u7528\u4f8b\uff1b</p> <p>test\u9636\u6bb5\u4e0e maven-surefire-plugin \u7684test\u76ee\u6807\u76f8\u7ed1\u5b9a\u4e86\uff0c \u8fd9\u662f\u4e00\u4e2a\u5185\u7f6e\u7684\u7ed1\u5b9a\u3002</p> <pre><code> &lt;plugin&gt;\n     &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n     &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;\n     &lt;version&gt;3.0.0-M5&lt;/version&gt;\n     &lt;configuration&gt;\n         &lt;argLine&gt;\n             -javaagent:${settings.localRepository}/com/alibaba/testable/testable-agent/${testable.version}/testable-agent-${testable.version}.jar\n         &lt;/argLine&gt;\n     &lt;/configuration&gt;\n&lt;/plugin&gt;\n</code></pre>"},{"location":"tools/maven/plugins.html#mvn-scalafmt","title":"mvn-scalafmt","text":"<p>\u5728validate\u9636\u6bb5\u5bf9scala\u4ee3\u7801\u8fdb\u884c\u683c\u5f0f\u5316\u3002</p>"},{"location":"tools/maven/plugins.html#build-helper-maven-plugin","title":"build-helper-maven-plugin","text":"<p>Maven\u9ed8\u8ba4\u53ea\u5141\u8bb8\u6307\u5b9a\u4e00\u4e2a\u4e3bJava\u4ee3\u7801\u76ee\u5f55\u548c\u4e00\u4e2a\u6d4b\u8bd5Java\u4ee3\u7801\u76ee\u5f55\u3002 </p> <p>\u867d\u7136\u8fd9\u5176\u5b9e\u662f\u4e2a\u5e94\u5f53\u5c3d\u91cf\u9075\u5b88\u7684\u7ea6\u5b9a\uff0c\u4f46\u5076\u5c14\u4f60\u8fd8\u662f\u4f1a\u5e0c\u671b\u80fd\u591f\u6307\u5b9a\u591a\u4e2a\u6e90\u7801\u76ee\u5f55\uff08\u4f8b\u5982\u4e3a\u4e86\u5e94\u5bf9\u9057\u7559\u9879\u76ee\uff09\uff0cbuild-helper-maven-plugin\u7684add-source\u76ee\u6807\u5c31\u662f\u670d\u52a1\u4e8e\u8fd9\u4e2a\u76ee\u7684\uff0c\u901a\u5e38\u5b83\u88ab\u7ed1\u5b9a\u5230\u9ed8\u8ba4\u751f\u547d\u5468\u671f\u7684generate-sources\u9636\u6bb5\u4ee5\u6dfb\u52a0\u989d\u5916\u7684\u6e90\u7801\u76ee\u5f55\u3002</p>"},{"location":"tools/maven/plugins.html#exec-maven-plugin","title":"exec-maven-plugin","text":"<p>\u6307\u5b9a\u5728maven\u7684\u67d0\u4e2a\u9636\u6bb5(phase)\u6267\u884c\u4e00\u4e9b\u547d\u4ee4\uff0c\u5982\u8fd0\u884cjava\u7a0b\u5e8f\uff0cR install\u7b49\uff1b</p>"},{"location":"tools/maven/plugins.html#jacoco-maven-pluginjava","title":"jacoco-maven-plugin\uff08Java\u4ee3\u7801\u8986\u76d6\u7387\uff09","text":"<p>Testable Mock\u63d2\u4ef6</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.alibaba.testable&lt;/groupId&gt;\n    &lt;artifactId&gt;testable-all&lt;/artifactId&gt;\n    &lt;version&gt;0.6.0&lt;/version&gt;\n    &lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n\n&lt;plugins&gt;\n    &lt;plugin&gt;\n        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;\n        &lt;configuration&gt;\n            &lt;argLine&gt; @{argLine} -javaagent:${settings.localRepository}/com/alibaba/testable/testable-agent/${testable.version}/testable-agent-${testable.version}.jar&lt;/argLine&gt;\n        &lt;/configuration&gt;\n    &lt;/plugin&gt;\n&lt;/plugins&gt;\n</code></pre> <p>https://mvnrepository.com/artifact/org.jacoco/jacoco-maven-plugin</p> <pre><code>&lt;plugin&gt;\n  &lt;groupId&gt;org.jacoco&lt;/groupId&gt;\n  &lt;artifactId&gt;jacoco-maven-plugin&lt;/artifactId&gt;\n  &lt;version&gt;0.8.7&lt;/version&gt;\n&lt;/plugin&gt;\n</code></pre>"},{"location":"tools/maven/plugins.html#scalastyle-maven-plugin","title":"scalastyle-maven-plugin","text":"<p>Scala style \u68c0\u67e5\uff0c</p>"},{"location":"tools/maven/plugins.html#scala-pluginscala-maven-scala-test-maven","title":"scala plugin\uff08scala-maven, scala-test-maven\uff09","text":"<pre><code>&lt;plugin&gt;\n    &lt;groupId&gt;net.alchim31.maven&lt;/groupId&gt;\n    &lt;artifactId&gt;scala-maven-plugin&lt;/artifactId&gt;\n                &lt;version&gt;4.8.1&lt;/version&gt;\n    &lt;executions&gt;\n        &lt;execution&gt;\n            &lt;id&gt;eclipse-add-source&lt;/id&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;add-source&lt;/goal&gt;\n            &lt;/goals&gt;\n        &lt;/execution&gt;\n        &lt;!-- Run scala compiler in the process-resources phase, so that dependencies on scala classes can be resolved later in the (Java) compile phase --&gt;\n        &lt;execution&gt;\n            &lt;id&gt;scala-compile-first&lt;/id&gt;\n            &lt;phase&gt;process-resources&lt;/phase&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;compile&lt;/goal&gt;\n            &lt;/goals&gt;\n        &lt;/execution&gt;\n\n        &lt;!-- Run scala compiler in the process-test-resources phase, so that dependencies on scala classes can be resolved later in the (Java) test-compile phase --&gt;\n        &lt;execution&gt;\n            &lt;id&gt;scala-test-compile&lt;/id&gt;\n            &lt;phase&gt;process-test-resources&lt;/phase&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;testCompile&lt;/goal&gt;\n            &lt;/goals&gt;\n        &lt;/execution&gt;\n        &lt;execution&gt;\n            &lt;id&gt;attach-scaladocs&lt;/id&gt;\n            &lt;phase&gt;verify&lt;/phase&gt; &lt;!-- \u9ed8\u8ba4\u662fpackage\u9636\u6bb5!--&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;doc-jar&lt;/goal&gt;\n            &lt;/goals&gt;\n        &lt;/execution&gt;\n    &lt;/executions&gt;\n    &lt;configuration&gt;\n        &lt;scalaVersion&gt;${scala.version}&lt;/scalaVersion&gt;\n        &lt;checkMultipleScalaVersions&gt;true&lt;/checkMultipleScalaVersions&gt;\n        &lt;failOnMultipleScalaVersions&gt;true&lt;/failOnMultipleScalaVersions&gt;\n        &lt;!--  compile both Scala and Java sources !--&gt;\n        &lt;recompileMode&gt;incremental&lt;/recompileMode&gt;\n        &lt;args&gt;\n            &lt;arg&gt;-unchecked&lt;/arg&gt;\n            &lt;arg&gt;-deprecation&lt;/arg&gt;\n            &lt;arg&gt;-feature&lt;/arg&gt;\n            &lt;arg&gt;-explaintypes&lt;/arg&gt;\n            &lt;arg&gt;-Yno-adapted-args&lt;/arg&gt; &lt;!-- !--&gt;\n            &lt;arg&gt;-target:jvm-1.8&lt;/arg&gt;\n        &lt;/args&gt;\n        &lt;jvmArgs&gt;\n            &lt;jvmArg&gt;-Xms1024m&lt;/jvmArg&gt;\n            &lt;jvmArg&gt;-Xmx1024m&lt;/jvmArg&gt;\n            &lt;jvmArg&gt;-XX:ReservedCodeCacheSize=${CodeCacheSize}&lt;/jvmArg&gt;\n        &lt;/jvmArgs&gt;\n        &lt;javacArgs&gt;\n            &lt;javacArg&gt;-source&lt;/javacArg&gt;\n            &lt;javacArg&gt;${java.version}&lt;/javacArg&gt;\n            &lt;javacArg&gt;-target&lt;/javacArg&gt;\n            &lt;javacArg&gt;${java.version}&lt;/javacArg&gt;\n            &lt;javacArg&gt;-Xlint:all,-serial,-path,-try&lt;/javacArg&gt;\n        &lt;/javacArgs&gt;\n    &lt;/configuration&gt;\n&lt;/plugin&gt;\n\n&lt;plugin&gt;\n    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n    &lt;version&gt;3.8.0&lt;/version&gt;\n    &lt;configuration&gt;\n        &lt;source&gt;${java.version}&lt;/source&gt;\n        &lt;target&gt;${java.version}&lt;/target&gt;\n    &lt;/configuration&gt;\n&lt;/plugin&gt;\n\n&lt;!-- Scalatest runs all Scala tests --&gt;\n&lt;plugin&gt;\n    &lt;groupId&gt;org.scalatest&lt;/groupId&gt;\n    &lt;artifactId&gt;scalatest-maven-plugin&lt;/artifactId&gt;\n    &lt;version&gt;2.0.0&lt;/version&gt;\n    &lt;configuration&gt;\n        &lt;reportsDirectory&gt;${project.build.directory}/surefire-reports\n        &lt;/reportsDirectory&gt;\n        &lt;junitxml&gt;.&lt;/junitxml&gt;\n        &lt;filereports&gt;SparkTestSuite.txt&lt;/filereports&gt;\n        &lt;argLine&gt;-ea -Xmx4g -Xss4m -XX:ReservedCodeCacheSize=${CodeCacheSize}\n        &lt;/argLine&gt;\n        &lt;stderr/&gt;\n        &lt;environmentVariables&gt;\n            &lt;!--\n       Setting SPARK_DIST_CLASSPATH is a simple way to make sure any child processes\n       launched by the tests have access to the correct test-time classpath.\n     --&gt;\n            &lt;SPARK_DIST_CLASSPATH&gt;${test_classpath}&lt;/SPARK_DIST_CLASSPATH&gt;\n            &lt;SPARK_PREPEND_CLASSES&gt;1&lt;/SPARK_PREPEND_CLASSES&gt;\n            &lt;SPARK_SCALA_VERSION&gt;${scala.binary.version}&lt;/SPARK_SCALA_VERSION&gt;\n            &lt;SPARK_TESTING&gt;1&lt;/SPARK_TESTING&gt;\n            &lt;JAVA_HOME&gt;${test.java.home}&lt;/JAVA_HOME&gt;\n        &lt;/environmentVariables&gt;\n        &lt;systemProperties&gt;\n            &lt;log4j.configuration&gt;file:src/test/resources/log4j.properties\n            &lt;/log4j.configuration&gt;\n            &lt;spark.test.home&gt;${spark.test.home}&lt;/spark.test.home&gt;\n            &lt;spark.testing&gt;1&lt;/spark.testing&gt;\n        &lt;/systemProperties&gt;\n    &lt;/configuration&gt;\n    &lt;executions&gt;\n        &lt;execution&gt;\n            &lt;id&gt;test&lt;/id&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;test&lt;/goal&gt;\n            &lt;/goals&gt;\n        &lt;/execution&gt;\n    &lt;/executions&gt;\n&lt;/plugin&gt;\n</code></pre>"},{"location":"tools/webank/dss_framework.html","title":"DSS\u6846\u67b6","text":"<p>DSS\u63d2\u62d4\u5f0f\u7684\u6846\u67b6\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u5141\u8bb8\u7528\u6237\u5feb\u901f\u66ff\u6362DSS\u5df2\u96c6\u6210\u7684\u5404\u4e2aWeb\u7cfb\u7edf\u3002\u5982\uff1a\u5c06 Scriptis \u66ff\u6362\u6210Zeppelin\uff0c\u5c06 Schedulis \u66ff\u6362\u6210DolphinScheduler\u3002</p>"},{"location":"tools/webank/dss_framework.html#appconn","title":"AppConn","text":"<p>AppConn\u2014\u2014\u5e94\u7528\u8fde\u63a5\u5668\uff0c\u5b9a\u4e49\u4e86\u4e00\u5957\u7edf\u4e00\u7684\u524d\u540e\u53f0\u63a5\u5165\u534f\u8bae\uff0c\u603b\u5171\u5206\u4e3a\u4e09\u7ea7\u89c4\u8303\uff0c\u53ef\u8ba9\u5916\u90e8\u6570\u636e\u5e94\u7528\u7cfb\u7edf\u5feb\u901f\u7b80\u5355\u5730\u63a5\u5165\uff0c\u6210\u4e3aDSS\u6570\u636e\u5e94\u7528\u5f00\u53d1\u4e2d\u7684\u4e00\u73af\u3002</p> <p>AppConn\u7684\u4e09\u7ea7\u89c4\u8303\u5373\uff1a\u4e00\u7ea7SSO\u89c4\u8303\uff0c\u4e8c\u7ea7\u7ec4\u7ec7\u7ed3\u6784\u89c4\u8303\uff0c\u4e09\u7ea7\u5f00\u53d1\u6d41\u7a0b\u89c4\u8303\uff1b</p> <p>DSS\u901a\u8fc7\u4e32\u8054\u591a\u4e2a AppConn\uff0c\u7f16\u6392\u6210\u4e00\u6761\u652f\u6301\u5b9e\u65f6\u6267\u884c\u548c\u5b9a\u65f6\u8c03\u5ea6\u7684\u5de5\u4f5c\u6d41\uff0c\u7528\u6237\u53ea\u9700\u7b80\u5355\u62d6\u62fd\u5373\u53ef\u5b8c\u6210\u6570\u636e\u5e94\u7528\u7684\u5168\u6d41\u7a0b\u5f00\u53d1\u3002</p> <p>\u7531\u4e8e AppConn \u5bf9\u63a5\u4e86Linkis\uff0c\u5916\u90e8\u6570\u636e\u5e94\u7528\u7cfb\u7edf\u56e0\u6b64\u5177\u5907\u4e86\u8d44\u6e90\u7ba1\u63a7\u3001\u5e76\u53d1\u9650\u6d41\u3001\u7528\u6237\u8d44\u6e90\u7ba1\u7406\u7b49\u80fd\u529b\uff0c\u4e14\u5141\u8bb8\u4e0a\u4e0b\u6587\u4fe1\u606f\u8de8\u7cfb\u7edf\u7ea7\u5171\u4eab\uff0c\u5f7b\u5e95\u544a\u522b\u5e94\u7528\u5b64\u5c9b\u3002</p> <p>dss\u5de5\u7a0b\u7684<code>appconn_install.sh</code>\uff1a</p> <ol> <li>\u6307\u5b9a\u63d2\u4ef6\u670d\u52a1\u7684 IP \u548c Port\uff0c\u8fd9\u91cc\u4e00\u822c\u5199Nginx\u7684IP\u548c\u7aef\u53e3\u53f7\uff08\u5373\u4f7f\u662f\u672c\u673a\uff0c\u4e5f\u4e0d\u8981\u5199127.0.0.1\uff09\uff1b</li> <li>\u6267\u884c\u5237\u5e93\u811a\u672c\uff1b</li> <li>\u5728<code>dss-appconns/${APPCONN_NAME}/db</code>\uff0c\u5c06<code>init.sql</code>\u8fdb\u884c\u53d8\u91cf\u66ff\u6362\uff0c\u5f62\u6210\u6700\u7ec8\u7684\u5237\u5e93\u811a\u672c\uff0c\u901a\u8fc7<code>mysql</code>\u6267\u884c\u5237\u5e93\uff1b</li> <li>APPCONN_INSTALL_IP \u3001APPCONN_INSTALL_PORT\u3001DSS_INSTALL_HOME_VAL</li> <li>\u6570\u636e\u5e93\u8868\uff1a<ul> <li>dss_application</li> <li>dss_menu</li> <li>dss_onestop_menu_application</li> <li>dss_appconn</li> <li>dss_appconn_instance</li> <li>dss_workflow_node</li> <li>dss_workflow_node_to_group</li> <li>dss_workflow_node_to_ui</li> <li></li> </ul> </li> <li>\u8c03\u7528<code>http://${GATEWAY_INSTALL_IP}:${GATEWAY_PORT}/api/rest_j/v1/dss/framework/project/appconn/${APPCONN_NAME}/load</code>\u901a\u77e5\u52a0\u8f7d\u670d\u52a1\uff1b</li> <li>dss-framework-project-server  =&gt;  linkis gateway =&gt; ?</li> </ol> <p>\u6570\u636e\u5e93\u89e3\u8026\uff08\u5237\u7684\u90fd\u662fdss\u7684\u5e93\uff09\uff1a</p> <ul> <li>\u5237\u5e93\u811a\u672c =&gt; Restful \u8c03\u7528</li> </ul>"},{"location":"tools/webank/dss_framework.html#_1","title":"\u7528\u6237","text":""},{"location":"tools/webank/dss_framework.html#linkis","title":"Linkis","text":"<p>linkis \u7684\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u5f62\u5f0f\u63d0\u4f9b\u8ba4\u8bc1\u670d\u52a1\uff0c\u9700\u8981\u5b9e\u73b0 login\u63a5\u53e3</p> <pre><code>{\n    \"method\": null,\n    \"status\": 0,\n    \"message\": \"login successful(\u767b\u5f55\u6210\u529f)\uff01\",\n    \"data\": {\n        \"isAdmin\": false,\n        \"userName\": \"\"\n    }\n}\n</code></pre> <ul> <li>isAdmin: Linkis\u53ea\u6709admin\u7528\u6237\u548c\u975eadmin\u7528\u6237\uff0cadmin\u7528\u6237\u7684\u552f\u4e00\u7279\u6743\uff0c\u5c31\u662f\u652f\u6301\u5728Linkis\u7ba1\u7406\u53f0\u67e5\u770b\u6240\u6709\u7528\u6237\u7684\u5386\u53f2\u4efb\u52a1\u3002</li> </ul>"},{"location":"tools/webank/dss_framework.html#_2","title":"\u9879\u76ee","text":"<p>linkis \u4e0d\u652f\u6301\u5355\u4e2a\u9879\u76ee\u7ea7\u522b\u7684\u914d\u7f6e\uff0c\u6bd4\u5982\u961f\u5217\u4fe1\u606f\uff0cspark\u7b49\u914d\u7f6e\u4fe1\u606f\u3002</p> <p>Java/Scala API \u652f\u6301\u6307\u5b9a\u961f\u5217\uff0c\u6ca1\u6709\u771f\u5b9e\u4f7f\u7528\uff01</p> <p>label\u7684\u6982\u5ff5\uff1f</p>"},{"location":"tools/webank/services.html","title":"Services","text":"<p>\u91c7\u7528Eureka\u4f5c\u4e3a\u670d\u52a1\u6ce8\u518c/\u53d1\u73b0\u4e2d\u5fc3\uff0c</p> <ul> <li>@EnableEurekaServer</li> <li>@EnableDiscoveryClient</li> </ul>"},{"location":"tools/webank/services.html#linkis","title":"Linkis","text":""},{"location":"tools/webank/services.html#linkisgatewayapplication","title":"LinkisGatewayApplication\uff08\u7f51\u5173\u670d\u52a1\uff09","text":"<p>LINKIS-MG-GATEWAY</p>"},{"location":"tools/webank/services.html#springcloudeurekaapplication","title":"SpringCloudEurekaApplication\uff08\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\uff09","text":"<p>LINKIS-MG-EUREKA</p>"},{"location":"tools/webank/services.html#linkisecmapplication","title":"LinkisECMApplication\uff08\u5f15\u64ce\u8fde\u63a5\u7ba1\u7406\uff09","text":"<p>LINKIS-CG-ENGINECONNMANAGER</p>"},{"location":"tools/webank/services.html#linkisengineconnpluginserver","title":"LinkisEngineConnPluginServer\uff08\u5f15\u64ce\u8fde\u63a5\u63d2\u4ef6\u670d\u52a1\uff09","text":"<p>LINKIS-CG-ENGINEPLUGIN</p>"},{"location":"tools/webank/services.html#linkisentranceapplicationcomputing-governance-entrance-service","title":"LinkisEntranceApplication\uff08computing governance entrance service\uff09","text":"<p>LINKIS-CG-ENTRANCE</p>"},{"location":"tools/webank/services.html#linkismanagerapplicationcomputing-governance-management-service","title":"LinkisManagerApplication\uff08computing governance management service\uff09","text":"<p>LINKIS-CG-LINKISMANAGER</p>"},{"location":"tools/webank/services.html#linkiscsapplication","title":"LinkisCSApplication\uff08\u4e0a\u4e0b\u6587\u670d\u52a1\uff09","text":"<p>LINKIS-PS-CS</p>"},{"location":"tools/webank/services.html#linkispublicserviceapp","title":"LinkisPublicServiceApp\uff08\u516c\u7528\u670d\u52a1\uff09","text":"<p>LINKIS-PS-PUBLICSERVICE</p> <p>\u5c5e\u4e8e link-jobhistory \u5de5\u7a0b</p>"},{"location":"tools/webank/services.html#linkisdatasourceapplication","title":"LinkisDataSourceApplication\uff08\uff1f\u672a\u542f\u52a8\uff09","text":""},{"location":"tools/webank/services.html#linkisbmlapplication","title":"LinkisBMLApplication\uff08\uff1f\u672a\u542f\u52a8\uff09","text":""},{"location":"tools/webank/services.html#dss","title":"DSS","text":""},{"location":"tools/webank/services.html#dssapiserviceserverapplication","title":"DSSApiServiceServerApplication","text":"<p>DSS-APISERVICE-SERVER</p>"},{"location":"tools/webank/services.html#dssdatapipeserverapplication","title":"DSSDatapipeServerApplication","text":"<p>DSS-DATAPIPE-SERVER</p>"},{"location":"tools/webank/services.html#dssfowexecutionserverapplication","title":"DSSFowExecutionServerApplication","text":"<p>DSS-FLOW-ENTRANCE</p>"},{"location":"tools/webank/services.html#dssorchestratorserverapplication","title":"DSSOrchestratorServerApplication","text":"<p>DSS-FRAMEWORK-ORCHESTRATOR-SERVER-DEV</p>"},{"location":"tools/webank/services.html#dssprojectserverapplication","title":"DSSProjectServerApplication","text":"<p>DSS-FRAMEWORK-PROJECT-SERVER</p>"},{"location":"tools/webank/services.html#dssworkflowserverapplication","title":"DSSWorkflowServerApplication","text":"<p>DSS-WORKFLOW-SERVER-DEV</p>"},{"location":"tools/webank/services.html#_1","title":"\u63d2\u4ef6\u670d\u52a1","text":""},{"location":"tools/webank/services.html#visualis","title":"Visualis","text":"<ul> <li>Visualis \u76f8\u5bf9 Davince \u7684\u6e90\u7801\u7684\u6539\u52a8\u70b9</li> <li>\u4f9d\u8d56 linkis-gateway </li> <li>\u9ed8\u8ba4\u5185\u7f6ehive\u6e90\uff08hivedatasource\uff09\uff0c\u7c7b\u578b\u662fhive\uff0c\u800c\u4e0d\u662fjdbc\uff0c\u53ef\u4ee5\u76f4\u63a5\u663e\u793a\uff0c\u4e0d\u9700\u8981\u914d\u7f6e</li> <li>\u6e90\u5b9a\u5236\u4ee3\u7801\uff0c\u4f9d\u8d56 linkis-datasource \u83b7\u53d6 hive \u7684db, table, column\uff1b</li> <li> <p>\u6267\u884cSQL\u65f6\uff0c\u901a\u8fc7Spark-SQL ujesjob(linkis 0.9.1)\u6267\u884c\uff0c\u8c03\u7528EntracenServer.execute</p> </li> <li> <p>\u7ec4\u7ec7\u548c\u6743\u9650\u529f\u80fd\u88ab\u79fb\u9664</p> </li> <li>\u4e0d\u518d\u652f\u6301Davinci\u539f\u751f\u7684\u767b\u5f55\u548c\u7528\u6237\u7ba1\u7406\u65b9\u5f0f</li> <li>Visualis\u4e0eDataSphere Studio\u5171\u4eab\u7528\u6237session\uff0c\u4eceDSS\u7684\u767b\u5f55\u9875\u9762\u767b\u5f55\u540e\uff0c\u5373\u53ef\u65e0\u7f1d\u8df3\u8f6c\u5230Visualis\u3002   </li> <li>\u5728\u6570\u636e\u5e93\u5c42\u9762\uff0cVisualis\u7684\u7528\u6237\u6539\u4e3a\u4ecelinkis_user\u8868\u4e2d\u8bfb\u53d6\u3002\uff08linkis\u8868\u662fdss\u521b\u5efa\u7684\uff09</li> <li> <p>\u539f\u751f\u7684user\u8868\u4e0d\u518d\u4f7f\u7528</p> </li> <li> <p>Visualis\u7684\u9879\u76ee\u53ef\u4ee5\u6ca1\u6709\u6240\u5c5e\u7ec4\u7ec7\uff0c\u5141\u8bb8\u53ea\u5c5e\u4e8e\u4e2a\u4eba\u7684\u9879\u76ee\u5b58\u5728\u3002   Visualis\u7684\u9879\u76ee\u4e0eDSS\u7684\u9879\u76ee\u4fdd\u6301\u5b8c\u5168\u540c\u6b65\uff0c\u5728\u6570\u636e\u5e93\u5c42\u9762\uff0c\u4ecedss_project\u8868\u4e2d\u8bfb\u53d6\u3002</p> </li> <li>\u539f\u751f\u7684project\u8868\u4e0d\u518d\u4f7f\u7528\uff08\u4e0edss_project\u5f3a\u8026\u5408\uff09</li> </ul>"},{"location":"tools/webank/services.html#qualitis","title":"Qualitis","text":""},{"location":"tools/webank/services.html#schedulis","title":"Schedulis","text":""},{"location":"tools/webank/services.html#exchangeis","title":"ExchangeIs","text":""},{"location":"tools/webank/linkis/entrance.html","title":"\u8ba1\u7b97\u5f15\u64ce\u542f\u52a8","text":""},{"location":"tools/webank/linkis/gateway.html","title":"\u7f51\u5173","text":""},{"location":"tools/webank/linkis/gateway.html#_2","title":"\u8def\u7531\u8f6c\u53d1","text":"<p><code>/api/rest_[a-zA-Z]+/(v\\\\d+)/([^/]+)/.+</code>\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u8fdb\u884c\u4e0d\u540c\u670d\u52a1\u95f4\u7684\u8def\u7531\u5339\u914d\uff1a</p> <ul> <li> <p>\u5982<code>/api/rest_j/v1/entrance/</code>\u5bf9\u5e94<code>entrance</code>\u670d\u52a1\uff1b</p> </li> <li> <p><code>linkis-ps-publicservice</code>\u5305\u542b\u5f88\u591a\u5b50\u670d\u52a1\uff1a</p> </li> <li><code>query,jobhistory,application,configuration,filesystem,udf,variable,microservice,errorcode,bml,datasource</code></li> <li></li> </ul>"},{"location":"tools/webank/linkis/gateway.html#_3","title":"\u7528\u6237\u548c\u8ba4\u8bc1","text":"<p>\u5916\u90e8\u7684\u63a5\u53e3\uff0c\u5168\u90e8\u7ecf\u8fc7\u7f51\u5173\uff0c\u56e0\u6b64\u5728\u7f51\u5173\u91cc\u8fdb\u884c\u8ba4\u8bc1\u3002</p>"},{"location":"tools/webank/linkis/gateway.html#_4","title":"\u8bf7\u6c42\u62e6\u622a","text":"<p>SpringCloudGatewayConfiguration\u91cc\u914d\u7f6e\u4e86<code>GatewayAuthorizationFilter</code>\uff08\u5b9e\u73b0\u4e86SpringCloud\u7684GlobalFilter\uff09</p> <ul> <li>filter\u7684\u65f6\u5019\uff0c\u8c03\u7528<code>SecurityFilter</code>\u7684<code>doFilter</code></li> </ul>"},{"location":"tools/webank/linkis/gateway.html#securityfilter","title":"SecurityFilter","text":"<p>com.webank.wedatasphere.linkis.gateway.security.SecurityFilter</p> <p><code>doFilter</code>\u6d41\u7a0b\uff08\u8fdb\u884c\u5b89\u5168\u8ba4\u8bc1\uff0c\u5305\u62ec\u767b\u5f55\u3001Token\u7b49\uff09</p> <ul> <li><code>wds.linkis.enable.gateway.auth</code>\uff08\u9ed8\u8ba4false\uff09\uff0c\u4e3atrue\u65f6\uff0c\u5219\u8fdb\u884cip\u767d\u540d\u5355\u6821\u9a8c\uff08<code>wds.linkis.gateway.auth.file</code>\u914d\u7f6e\u6587\u4ef6\uff09\uff1b</li> <li><code>wds.linkis.server.security.referer.validate</code>\uff08\u9ed8\u8ba4\u4e3afalse\uff09\uff0c\u4e3atrue\u65f6\uff0c\u8fdb\u884c<code>Referer</code>\u57df\u6821\u9a8c\uff08<code>wds.linkis.server.address</code>\uff0c\u9ed8\u8ba4\u4e3b\u673a\u540d\uff09\uff1b</li> <li>\u65e0\u9700\u9274\u6743\u7684URI\uff0c<code>wds.linkis.gateway.conf.url.pass.auth</code>\u9ed8\u8ba4\u4e3a<code>/dss/</code>\uff1b</li> <li>\u5982\u679curi\u4ee5<code>/api/rest_j/v1/user</code>\u5f00\u5934\uff0c\u5219\u8fdb\u884c\u7528\u6237\u6821\u9a8c\u5e76\u8fd4\u56de\u6d88\u606f\uff08LDAPUserRestful\uff09\uff0c\u8fd4\u56defalse\uff1b</li> <li>\u5982\u679curi\u65e0\u9700\u9274\u6743(\u4ee5/dss\u5f00\u5934)\u4e14<code>wds.linkis.gateway.conf.enable.sso</code>\u4e3afalse\uff08\u9ed8\u8ba4false\uff09\uff0c\u5219\u8fd4\u56detrue\uff1b</li> <li>\u5982\u679c\u9700\u8981Token\u9274\u6743\uff08Header/Cookie\u4e2d\u5305\u542b<code>Token-Code</code>\u548c<code>Token-User</code>\uff0c\u5219\u9274\u6743Token\uff1b</li> <li><code>wds.linkis.gateway.conf.enable.token.auth</code>\uff08\u9ed8\u8ba4false\uff09\uff0cfalse\u65f6\u76f4\u63a5\u8fd4\u56defalse\uff0c\u8f93\u51fagateway\u672a\u91c7\u7528token\u8ba4\u8bc1\u7684\u6d88\u606f\uff1b</li> <li><code>wds.linkis.gateway.conf.token.auth.config</code>\uff08\u9ed8\u8ba4<code>token.properties</code>\uff09\uff0c\u914d\u7f6e\u4e86token-code\u5bf9\u5e94\u7684\u7528\u6237\uff0c\u5982\u679c\u5305\u542b<code>Token-User</code>\u5219\u8fd4\u56detrue\uff1b</li> <li>\u6700\u540e\uff0c\u5224\u65ad\u662f\u5426\u5df2\u767b\u5f55\uff0c\u83b7\u53d6\u7528\u6237\u4fe1\u606f\uff08\u5982\u679c<code>bdp-user-ticket-id</code>\u8fc7\u671f\uff0c\u5219\u5224\u65ad\u5982\u679cCookie\u4e2d\u5e26<code>dataworkcloud_inner_request=true</code>\u4e14<code>bdp-user-ticket-id</code>\u89e3\u5bc6\u51fa\u6765\u7684\u7528\u6237\u540d\u4e0d\u662f<code>dataworkcloud_rpc_user</code>\uff0c\u5219\u8fd4\u56de\u8be5\u7528\u6237\u540d\uff1b</li> <li>\u82e5\u672a\u767b\u5f55\uff08\u5373\u672a\u83b7\u53d6\u5230\u7528\u6237\u540d\uff09\uff0c\u5982\u679c\u5f00\u542f\u5355\u70b9\u767b\u5f55\uff08\u9ed8\u8ba4false\uff0c<code>wds.linkis.gateway.conf.enable.sso</code>\uff09\uff0c\u5219\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5e76\u8bbe\u7f6e\u767b\u5f55\u7528\u6237\uff0c\u5982\u679c\u6ca1\u6709\u7528\u6237\u4fe1\u606f\uff0c\u82e5uri\u65e0\u9700\u9274\u6743\uff0c\u5219\u8fd4\u56de\u91cd\u5b9a\u5411\u5230\u5355\u70b9\u767b\u5f55\u5730\u5740\uff0c\u5982\u679c\u9700\u8981\u9274\u6743\uff0c\u5219\u8fd4\u56de\u5355\u70b9\u767b\u5f55\u7684\u5730\u5740<ul> <li>\u6ce8\uff1a\u5f53\u524d\u6ca1\u6709\u5b9e\u73b0\u5355\u70b9\u767b\u5f55\u7684\u63a5\u53e3\uff08\u914d\u7f6e<code>wds.linkis.gateway.conf.sso.interceptor</code>\uff09\uff0c</li> </ul> </li> <li></li> </ul>"},{"location":"tools/webank/linkis/gateway.html#ldapuserrestful","title":"LDAPUserRestful","text":"<p><code>GatewaySpringConfiguration</code>\u4e2d\u914d\u7f6eSpring\u7684\u9ed8\u8ba4<code>UserRestful</code>\u7684\u5b9e\u73b0\uff0c\u540e\u7eed\u53ef\u4ee5\u81ea\u5b9a\u4e49\uff1a</p> <p><code>/api/rest_j/v1/user/XXX</code> =&gt; <code>XXX</code>\uff0c\u8fdb\u884c\u8def\u7531\u5904\u7406</p> <ul> <li> <p><code>login</code></p> </li> <li> <p><code>Cookie</code>\u4e2d<code>bdp-user-ticket-id</code>\u4f5c\u4e3a\u767b\u5f55\u6807\u8bc6\uff0c\u5df2\u767b\u5f55\uff0c\u5219\u8fd4\u56de\uff1b</p> </li> <li> <p>\u83b7\u53d6<code>\u7528\u6237\u540d/\u5bc6\u7801/\u52a0\u5bc6\u5bc6\u94a5</code></p> </li> <li> <p>\u7ba1\u7406\u5458\u7528\u6237\uff08\u5373\u90e8\u7f72\u7528\u6237hadoop/\u5bc6\u7801\u548c\u7528\u6237\u540d\u4e00\u81f4\uff0c<code>wds.linkis.admin.user</code>\uff09\uff0c\u5219\u767b\u5f55\u6210\u529f\uff0c\u4e14<code>isAdmin</code>\u4e3atrue\uff1b</p> </li> <li> <p>\u82e5<code>wds.linkis.gateway.usercontrol_switch_on</code>\u5f00\u542f\uff08\u9ed8\u8ba4false\uff09\uff0c\u5c06\u767b\u5f55\u8bf7\u6c42\u53d1\u9001\u5230<code>wds.linkis.usercontrol.application.name</code>\uff08\u9ed8\u8ba4<code>cloud-usercontrol</code>\uff0clinkis\u6ca1\u6709\u8be5\u670d\u52a1\uff09\uff0c\u5982\u679c\u8fd4\u56de\u6210\u529f\uff0c\u5219\u521b\u5efa\u968f\u673a\u4ee3\u7406\u7528\u6237\uff08<code>wds.linkis.gateway.conf.proxy.user.list</code>\u7684\u914d\u7f6e\u968f\u673a\u9009\uff09\u4f5c\u4e3a\u767b\u5f55\u7528\u6237</p> </li> <li> <p>\u82e5<code>wds.linkis.gateway.redirect_switch_on</code>\u5f00\u542f\uff08\u9ed8\u8ba4\u4e0d\u5f00\u542f\uff09\uff0c\u5411<code>dss-framework-project-server</code>\u5de5\u7a0b\u83b7\u53d6\uff08dss\u7684<code>ProjectReceiver.scala</code>\uff09<code>wds.linkis.gateway.control.workspace.ids</code>\uff08\u9ed8\u8ba4224\uff09\u4e0b\u7684\u7528\u6237\u5217\u8868\uff08\u6570\u636e\u5e93\u8868<code>dss_workspace_user</code>\uff09\uff0c\u653e\u5165\u5230\u7f13\u5b58\u4e2d\uff1a</p> <ul> <li>\u5982\u679c\u767b\u5f55\u7528\u6237\u5728\u5176\u4e2d\uff0c\u5219\u8d70LDAP\u7684login\u6d41\u7a0b\uff1b</li> <li> <p>\u767b\u5f55\u7528\u6237\u4e0d\u518d\u5176\u4e2d\uff0c\u8d70\u53e6\u5916\u7684gateway(<code>wds.linkis.gateway.redirect.url</code>)\u7684\u8fdb\u884c\u767b\u5f55\uff1b</p> </li> <li> <p>\u6570\u636e\u5e93\u6570\u636e\u9ed8\u8ba4\u662f\u5b89\u88c5dss\u7528\u6237\uff08hadoop\uff09dss_workspace\u7684id\u7684\u81ea\u589e\u952e\u662f224\uff0c\u56e0\u6b64\u7b2c\u4e00\u4e2aworkspace\u7684id\u5c31\u662f224\uff1b</p> </li> </ul> </li> <li> <p>LDAP login</p> <pre><code>wds.linkis.ldap.proxy.url=ldap://127.0.0.1:389/ # \u60a8\u7684LDAP\u670d\u52a1URL\nwds.linkis.ldap.proxy.baseDN=dc=webank,dc=com # \u60a8\u7684LDAP\u670d\u52a1\u7684\u914d\u7f6e    \n</code></pre> </li> <li> <p>\u767b\u9646\u6210\u529f\u540e\uff0c<code>GatewaySSOUtils.setLoginUser</code></p> <ul> <li>\u82e5<code>wds.linkis.gateway.conf.enable.proxy.use</code>\u4e3atrue\uff08\u9ed8\u8ba4false\uff09\uff0c\u5219\u5c06\u767b\u9646\u7528\u6237\u8f6c\u4e3a\u4ee3\u7406\u7528\u6237\uff1b</li> <li>\u4ee3\u7406\u7528\u6237\u5728<code>wds.linkis.gateway.conf.proxy.user.config</code>\uff08\u9ed8\u8ba4<code>proxy.propetie</code>\uff09\u7684\u914d\u7f6e\u6587\u4ef6\u91cc\uff0c\u4e14\u5b9a\u65f6\uff08\u9ed8\u8ba410\u5206\u949f\uff09\u626b\u63cf\u6587\u4ef6\u66f4\u65b0\uff1b</li> <li>\u6587\u4ef6\u683c\u5f0f\u4e3a   <code>user=proxyUser</code></li> <li>\u8bbe\u7f6eResponse\u7684Cookie\uff0c\u9700\u8981\u8bbe\u7f6e<code>bdp-user-ticket-id</code>\uff0c\u5c06\u7528\u6237\u548c\u65f6\u95f4\u6233\u52a0\u5bc6\u540e\u4f5c\u4e3a\u767b\u5f55\u6807\u8bc6\uff0c\u653e\u5165\u5230\u5185\u5b58Map\u4e2d\uff08\u6807\u8bc6\u548c\u8fc7\u671f\u65f6\u95f4\uff09</li> </ul> </li> <li> <p>\u518d\uff0c\u6709\u4e2a<code>securityHooks</code>\u7684<code>postLogin</code>\u5904\u7406\uff1b</p> </li> <li> <p><code>proxy</code></p> </li> <li>\u8bbe\u7f6e\u4ee3\u7406\u7528\u6237\uff0c\u9700\u8981<code>wds.linkis.gateway.conf.enable.proxy.use</code>\u7b49\u914d\u7f6e\uff1b</li> <li><code>register</code>\uff08\u7528\u6237\u6ce8\u518c\uff1f\uff09</li> <li><code>wds.linkis.gateway.usercontrol_switch_on</code>\u5f00\u542f\u65f6\uff0c\u8bf7\u6c42\u5bf9\u5e94\u7684\u5fae\u670d\u52a1\uff08\u9ed8\u8ba4<code>cloud-usercontrol</code>\uff09\uff1b</li> <li>\u5426\u5219\uff0c\u6ca1\u6709\u5b9e\u73b0\uff0c\u8fd4\u56de\u9519\u8bef</li> <li><code>logout</code></li> <li><code>userInfo</code></li> <li>\u83b7\u53d6\u7528\u6237\u540d</li> <li><code>publicKey</code></li> <li>\u65e0\u9700\u8ba4\u8bc1\uff0c\u83b7\u53d6\u52a0\u5bc6\u5bc6\u94a5</li> <li><code>heartbeat</code></li> <li>\u7ef4\u6301session\u5fc3\u8df3\uff0c\u6bcf\u6b21\u4ececookie\u4e2d\u83b7\u53d6\u7528\u6237\u540d\u7684\u65f6\u5019\uff0c\u4f1a\u5224\u65ad\u662f\u5426session\u8d85\u65f6\uff08\u9ed8\u8ba42h\uff09\uff0c\u5982\u679c\u65f6\u95f4\u8d85\u8fc7session\u4e00\u534a\u65f6\u95f4\uff0c\u5219\u4f1a\u7eed\u671f\uff1b</li> </ul>"},{"location":"tools/webank/linkis/gateway.html#token","title":"Token\u8ba4\u8bc1","text":""},{"location":"tools/webank/linkis/linkis.html","title":"LinkIs","text":"<p>\u63d0\u4f9bscala/java\u7684api\uff0cjdbc\uff0c\u548crestful \u63a5\u53e3\u3002</p> <p>https://github.com/WeBankFinTech/Linkis-Doc/blob/master/zh_CN/User_Manual/Linkis1.0%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3.md</p>"},{"location":"tools/webank/linkis/linkis.html#_1","title":"\u67b6\u6784","text":""},{"location":"tools/webank/linkis/linkis.html#publicenhencementserviceps","title":"PublicEnhencementService\uff08PS\uff09\u67b6\u6784\u8bbe\u8ba1","text":"<p>\u516c\u5171\u589e\u5f3a\u670d\u52a1\uff0c\u4e3a\u5176\u4ed6\u5fae\u670d\u52a1\u6a21\u5757\u63d0\u4f9b\u7edf\u4e00\u914d\u7f6e\u7ba1\u7406\u3001\u4e0a\u4e0b\u6587\u670d\u52a1\u3001\u7269\u7406\u5e93\u3001\u6570\u636e\u6e90\u7ba1\u7406\u3001\u5fae\u670d\u52a1\u7ba1\u7406\u548c\u5386\u53f2\u4efb\u52a1\u67e5\u8be2\u7b49\u529f\u80fd\u7684\u6a21\u5757\u3002</p> <p>https://github.com/WeBankFinTech/Linkis-Doc/blob/master/zh_CN/Architecture_Documents/Public_Enhancement_Services/README.md</p>"},{"location":"tools/webank/linkis/linkis.html#_2","title":"\u5fae\u670d\u52a1\u6cbb\u7406","text":"<p>Gateway\u3001Eureka\u3001Open Feign\u7b49\u4e09\u4e2a\u4e3b\u8981\u7684\u5fae\u670d\u52a1\u3002\u7528\u6765\u89e3\u51b3Linkis\u7684\u670d\u52a1\u53d1\u73b0\u4e0e\u6ce8\u518c\u3001\u7edf\u4e00\u7f51\u5173\u3001\u8bf7\u6c42\u8f6c\u53d1\u3001\u670d\u52a1\u95f4\u901a\u4fe1\u3001\u8d1f\u8f7d\u5747\u8861\u7b49\u95ee\u9898\u3002</p> <ul> <li> <p>Linkis Gateway\u4f5c\u4e3aLinkis\u7684\u7f51\u5173\u5165\u53e3\uff0c\u4e3b\u8981\u627f\u62c5\u4e86\u8bf7\u6c42\u8f6c\u53d1\u3001\u7528\u6237\u8bbf\u95ee\u8ba4\u8bc1\u3001WebSocket\u901a\u4fe1\u7b49\u804c\u8d23\uff0c\u57fa\u4e8eLabel\u7684\u8def\u7531\u8f6c\u53d1\u80fd\u529b\uff1b</p> </li> <li> <p>\u57fa\u4e8eFeign\u5b9e\u73b0\u4e86\u4e00\u5957\u81ea\u5df1\u7684\u5e95\u5c42RPC\u901a\u4fe1\u65b9\u6848\uff0c\u63d0\u4f9bSDK\u96c6\u6210\u5230\u6709\u9700\u8981\u7684\u5fae\u670d\u52a1\u4e4b\u4e2d\u3002\u4e00\u4e2a\u5fae\u670d\u52a1\u65e2\u53ef\u4ee5\u4f5c\u4e3a\u8bf7\u6c42\u8c03\u7528\u65b9\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u8bf7\u6c42\u63a5\u6536\u65b9\u3002\u4f5c\u4e3a\u8bf7\u6c42\u8c03\u7528\u65b9\u65f6\uff0c\u5c06\u901a\u8fc7Sender\u8bf7\u6c42\u76ee\u6807\u63a5\u6536\u65b9\u5fae\u670d\u52a1\u7684Receiver\uff0c\u4f5c\u4e3a\u8bf7\u6c42\u63a5\u6536\u65b9\u65f6\uff0c\u5c06\u63d0\u4f9bReceiver\u7528\u6765\u5904\u7406\u8bf7\u6c42\u63a5\u6536\u65b9Sender\u53d1\u9001\u8fc7\u6765\u7684\u8bf7\u6c42\uff0c\u4ee5\u4fbf\u5b8c\u6210\u540c\u6b65\u54cd\u5e94\u6216\u5f02\u6b65\u54cd\u5e94\u3002</p> </li> </ul>"},{"location":"tools/webank/linkis/linkis.html#_3","title":"\u8ba1\u7b97\u6cbb\u7406\u670d\u52a1","text":""},{"location":"tools/webank/linkis/linkis.html#entrance","title":"Entrance","text":"<ul> <li>\u8d1f\u8d23\u8ba1\u7b97\u4efb\u52a1\u7684\u63a5\u6536\u3001\u8c03\u5ea6\u3001\u8f6c\u53d1\u6267\u884c\u8bf7\u6c42\u3001\u751f\u547d\u5468\u671f\u7ba1\u7406\u7684\u670d\u52a1\uff0c\u5e76\u4e14\u80fd\u628a\u8ba1\u7b97\u7ed3\u679c\u3001\u65e5\u5fd7\u3001\u8fdb\u5ea6\u8fd4\u56de\u7ed9\u8c03\u7528\u65b9\uff1b</li> </ul>"},{"location":"tools/webank/linkis/linkis.html#orchestrator","title":"Orchestrator","text":"<ul> <li>\u51c6\u5907\u9636\u6bb5\u7684\u5165\u53e3\uff0c\u89e3\u6790Job\u3001\u7533\u8bf7Engine\u548c\u63d0\u4ea4\u6267\u884c\u7684\u80fd\u529b\uff1b</li> <li>\u7f16\u6392\u548c\u8ba1\u7b97\u7b56\u7565\u80fd\u529b\uff0c\u6ee1\u8db3\u591a\u6d3b\u3001\u4e3b\u5907\u3001\u4e8b\u52a1\u3001\u91cd\u653e\u3001\u9650\u6d41\u3001\u5f02\u6784\u548c\u6df7\u7b97\u7b49\u591a\u79cd\u5e94\u7528\u573a\u666f\u7684\u9700\u6c42\u3002</li> </ul>"},{"location":"tools/webank/linkis/linkis.html#linkismanager","title":"LinkisManager","text":"<p>Linkis\u7684\u7ba1\u7406\u5927\u8111\uff0c\u4e3b\u8981\u7531AppManager\u3001ResourceManager\u3001LabelManager\u548cEngineConnPlugin\u7ec4\u6210\u3002</p> <ol> <li>ResourceManager \u5177\u5907  \u5bf9 Yarn \u548c Linkis EngineManager\u7684\u8d44\u6e90\u7ba1\u7406\u80fd\u529b\uff0c\u8fd8\u5c06\u63d0\u4f9b\u57fa\u4e8e\u6807\u7b7e\u7684\u591a\u7ea7\u8d44\u6e90\u5206\u914d\u548c\u56de\u6536\u80fd\u529b\uff0c\u8ba9ResourceManager\u5177\u5907\u8de8\u96c6\u7fa4\u3001\u8de8\u8ba1\u7b97\u8d44\u6e90\u7c7b\u578b\u7684\u5168\u8d44\u6e90\u7ba1\u7406\u80fd\u529b\uff1b</li> <li>AppManager \u5c06\u7edf\u7b79\u7ba1\u7406\u6240\u6709\u7684 EngineConnManager \u548c EngineConn\uff0cEngineConn \u7684\u7533\u8bf7\u3001\u590d\u7528\u3001\u521b\u5efa\u3001\u5207\u6362\u3001\u9500\u6bc1\u7b49\u751f\u547d\u5468\u671f\u5168\u4ea4\u4e88 AppManager \u8fdb\u884c\u7ba1\u7406\uff1b\u800c LabelManager \u5c06\u57fa\u4e8e\u591a\u7ea7\u7ec4\u5408\u6807\u7b7e\uff0c\u63d0\u4f9b\u8de8IDC\u3001\u8de8\u96c6\u7fa4\u7684 EngineConn \u548c EngineConnManager \u8def\u7531\u548c\u7ba1\u63a7\u80fd\u529b\uff1b</li> <li>EngineConnPlugin \u4e3b\u8981\u7528\u4e8e\u964d\u4f4e\u65b0\u8ba1\u7b97\u5b58\u50a8\u7684\u63a5\u5165\u6210\u672c\uff0c\u771f\u6b63\u505a\u5230\u8ba9\u7528\u6237\u53ea\u9700\u8981\u5b9e\u73b0\u4e00\u4e2a\u7c7b\uff0c\u5c31\u80fd\u63a5\u5165\u4e00\u4e2a\u5168\u65b0\u7684\u8ba1\u7b97\u5b58\u50a8\u5f15\u64ce\u3002</li> </ol>"},{"location":"tools/webank/linkis/linkis.html#engineconnmanager","title":"EngineConnManager","text":"<ul> <li>\u805a\u7126\u4e8e\u652f\u6301\u5404\u7c7b EngineConn \u7684\u542f\u52a8\u548c\u9500\u6bc1</li> </ul>"},{"location":"tools/webank/linkis/linkis.html#engineconn","title":"EngineConn","text":"<p>\u63d0\u4f9b EngineConn \u548c Executor \u4e24\u5927\u6a21\u5757\uff1a</p> <ul> <li>EngineConn \u7528\u4e8e\u8fde\u63a5\u5e95\u5c42\u7684\u8ba1\u7b97\u5b58\u50a8\u5f15\u64ce\uff0c\u63d0\u4f9b\u4e00\u4e2a\u6253\u901a\u4e86\u5e95\u5c42\u5404\u8ba1\u7b97\u5b58\u50a8\u5f15\u64ce\u7684 Session \u4f1a\u8bdd\uff1b</li> <li>Executor \u5219\u57fa\u4e8e\u8fd9\u4e2a Session \u4f1a\u8bdd\uff0c\u63d0\u4f9b\u4ea4\u4e92\u5f0f\u8ba1\u7b97\u3001\u6d41\u5f0f\u8ba1\u7b97\u3001\u79bb\u7ebf\u8ba1\u7b97\u3001\u6570\u636e\u5b58\u50a8\u7684\u5168\u6808\u8ba1\u7b97\u80fd\u529b\u652f\u6301\u3002</li> </ul>"},{"location":"tools/webank/linkis/linkis.html#_4","title":"\u8ba4\u8bc1","text":"<p>linkis \u6ca1\u6709\u7528\u6237\u8868\uff0c<code>linkis_user</code>\u8868\u662fdataspherestudio\u5efa\u7acb\u7684\u3002</p> <p>LDAP\u7684\u8ba4\u8bc1\u673a\u5236</p> <p>Linkis\u53ea\u6709admin\u7528\u6237\u548c\u975eadmin\u7528\u6237\uff0cadmin\u7528\u6237\u7684\u552f\u4e00\u7279\u6743\uff0c\u5c31\u662f\u652f\u6301\u5728Linkis\u7ba1\u7406\u53f0\u67e5\u770b\u6240\u6709\u7528\u6237\u7684\u5386\u53f2\u4efb\u52a1\u3002</p>"},{"location":"tools/webank/linkis/linkis.html#gateway","title":"\u8def\u7531\uff08Gateway\uff09","text":"<p>\u5728<code>linkis_ps_instance_info</code>\u4e2d\u5b9a\u4e49<code>linkis-cg-entrance</code>\u3001<code>linkis-cg-entrance</code>\u7b49\u670d\u52a1\u7684\u5b9e\u4f8b</p> <ul> <li>\u542f\u52a8\u65f6\u6ce8\u518c\uff0c</li> </ul>"},{"location":"tools/webank/prophecis/install.html","title":"\u4f7f\u7528","text":""},{"location":"tools/webank/prophecis/install.html#_2","title":"\u5b89\u88c5","text":"<p>LDAP</p> <p>K8s\u3001Helm</p> <p>MySQL</p> <p>NFS</p> <ul> <li><code>/cosdata/mlss-test</code>\uff1aceph host path</li> <li><code>/cosdata/mlss-test/prophecis/etcd</code></li> <li><code>/cosdata/mlss-test/prophecis/localstack</code></li> <li><code>/cosdata/mlss-test/prophecis/mongo</code></li> <li> <p><code>/cosdata/mlss-test/prophecis/minio</code>\uff1aMinio \u6302\u8f7d</p> </li> <li> <p><code>/mlss/di/jobs/prophecis</code>\uff1a</p> </li> <li> <p>\u5bf9\u5e94\u5bb9\u5668\u5185\u7684<code>/job</code>\u76ee\u5f55\uff0c\u7528\u4e8e\uff1f</p> </li> <li> <p><code>/data/bdap-ss/mlss-data/tmp</code>\uff1a</p> </li> <li></li> </ul> <p>Prophecis\u4f7f\u7528nfs\u6765\u5b58\u50a8\u5bb9\u5668\u8fd0\u884c\u6570\u636e\uff0c\u9700\u8981\u6302\u8f7dnfs</p>"},{"location":"tools/webank/prophecis/prophecis.html","title":"Prophecis","text":""},{"location":"tools/webank/prophecis/prophecis.html#_1","title":"\u67b6\u6784","text":""},{"location":"tools/webank/prophecis/prophecis.html#machinelearningflow","title":"MachineLearningFlow","text":"<ul> <li> <p>\u5206\u5e03\u5f0f\u673a\u5668\u5b66\u4e60\u6a21\u578b\u5de5\u5177\uff0c\u5355\u673a\u548c\u5206\u5e03\u5f0f\u6a21\u5f0f\u7684\u6a21\u578b\u8bad\u7ec3\u51fd\u6570\uff1b</p> </li> <li> <p>\u673a\u5668\u5b66\u4e60\u6a21\u578b\u5230\u90e8\u7f72\u7684\u5168\u6d41\u6c34\u7ebf\uff1b</p> </li> <li>\u652f\u6301Tensorflow\uff0cPython\uff0cXGBoost\u7b49\u673a\u5668\u5b66\u4e60\u6846\u67b6\uff1b</li> </ul>"},{"location":"tools/webank/prophecis/prophecis.html#mllabis","title":"MLLabis","text":"<ul> <li>\u673a\u5668\u5b66\u4e60\u5f00\u53d1\u548c\u63a2\u7d22\u5de5\u5177\uff1b</li> <li>\u57fa\u4e8eJupyter Lab\u7684\u5728\u7ebfIDE\uff1b</li> <li>\u652f\u6301GPU\u548cHadoop\u96c6\u7fa4\uff0c\u652f\u6301R\u3001Python\u3001Julia\uff0c\u4ee5\u53caDebug\u548cTensorBoard\u63d2\u4ef6\uff1b</li> </ul>"},{"location":"tools/webank/prophecis/prophecis.html#model-factory","title":"Model Factory","text":"<ul> <li>\u6a21\u578b\u5b58\u50a8\uff0c\u6a21\u578b\u90e8\u7f72\uff0cAB \u6d4b\u8bd5\uff0c\u6a21\u578b\u7ba1\u7406\u7b49\u670d\u52a1\uff1b</li> </ul>"},{"location":"tools/webank/prophecis/prophecis.html#data-factory","title":"Data Factory","text":"<ul> <li>\u7279\u5f81\u5de5\u7a0b\u5de5\u5177\uff0c\u6570\u636e\u6807\u7b7e\u5de5\u5177\uff0c\u7269\u6599\u7ba1\u7406\u7b49\uff1b</li> </ul>"},{"location":"tools/webank/prophecis/prophecis.html#application-factory","title":"Application Factory","text":"<ul> <li>\u57fa\u4e8e\u9752\u4e91\u7684\u5f00\u6e90\u7cfb\u7edfKubeSphere\u5b9a\u5236\u5f00\u53d1\uff0c\u63d0\u4f9bCI/CD\u548cDevOps\u5de5\u5177\uff0cGPU\u96c6\u7fa4\u76d1\u63a7\u548c\u9884\u8b66\u529f\u80fd\u3002</li> </ul>"},{"location":"tools/webank/prophecis/prophecis.html#cc","title":"cc","text":""},{"location":"tools/webank/prophecis/prophecis.html#configcentercc","title":"configcenter(cc)","text":""},{"location":"tools/webank/prophecis/prophecis.html#cc-gateway","title":"cc-gateway","text":"<p>/cc  =&gt; controllercenter</p> <p>/aide  =&gt; aide</p> <p>/di =&gt; di-restapi</p> <p>/mf =&gt; mf  (model factory\uff1a\u5f53\u524d\u8fd8\u672a\u63d0\u4f9b)</p> <p>\u8def\u7531\u6ce8\u518c\u7684\u539f\u7406\uff0c\u8ba4\u8bc1\u7684\u539f\u7406\uff0c</p>"},{"location":"tools/webank/prophecis/prophecis.html#di","title":"di","text":""},{"location":"tools/webank/prophecis/prophecis.html#trainingdata","title":"trainingdata","text":""},{"location":"tools/webank/prophecis/prophecis.html#trainer","title":"trainer","text":""},{"location":"tools/webank/prophecis/prophecis.html#storage","title":"storage","text":""},{"location":"tools/webank/prophecis/prophecis.html#restapi","title":"restapi","text":""},{"location":"tools/webank/prophecis/prophecis.html#lcm","title":"lcm","text":""},{"location":"tools/webank/prophecis/prophecis.html#jobmonitor","title":"jobmonitor","text":""},{"location":"tools/webank/prophecis/prophecis.html#infrastructure","title":"infrastructure","text":""},{"location":"tools/webank/prophecis/prophecis.html#ectd","title":"ectd","text":""},{"location":"tools/webank/prophecis/prophecis.html#mango","title":"mango","text":""},{"location":"tools/webank/prophecis/prophecis.html#storage_1","title":"storage","text":""},{"location":"tools/webank/prophecis/prophecis.html#mllabis_1","title":"mllabis","text":""},{"location":"tools/webank/prophecis/prophecis.html#aide","title":"aide","text":"<p>\u5373/notebook-server</p>"},{"location":"tools/webank/prophecis/prophecis.html#ui","title":"ui","text":""},{"location":"tools/webank/prophecis/prophecis.html#bdap-ui","title":"bdap-ui","text":""},{"location":"tools/webank/prophecis/prophecis.html#minio","title":"minio(?)","text":""},{"location":"tools/webank/prophecis/prophecis.html#notebook-controller","title":"notebook-controller(?)","text":""},{"location":"tools/webank/prophecis/prophecis.html#notebook-controller_1","title":"notebook-controller","text":""},{"location":"tools/webank/prophecis/prophecis.html#metacontroller","title":"metacontroller","text":""},{"location":"tools/webnotebook/jupyterlab.html","title":"Jupyterlab","text":"<p>JUPYTER_RUNTIME_DIR\uff0cJUPYTER_DATA_DIR</p>"},{"location":"tools/webnotebook/jupyterlab.html#_1","title":"\u914d\u7f6e","text":""},{"location":"tools/webnotebook/jupyterlab.html#application-directory","title":"Application Directory","text":"<p>stores the main build of JupyterLab with associated data, including extensions built into JupyterLab.</p> <ul> <li>\u9ed8\u8ba4\u662f<code>&lt;sys-prefix&gt;/share/jupyter/lab</code>\uff0c\u5176\u4e2d<code>&lt;sys-prefix&gt;</code>\u662fpython\u73af\u5883\u7684site\u8def\u5f84\uff1b</li> <li>\u53ef\u4ee5\u88ab<code>JUPYTERLAB_DIR</code>\u8986\u76d6\uff0c\u6216\u8005JupyterLab\u547d\u4ee4\u53c2\u6570<code>--app-dir</code>\u8986\u76d6\u3002</li> </ul> <p>\u901a\u8fc7<code>jupyter lab path</code>\u67e5\u770b\u3002</p> <pre><code>$ jupyter lab path\n(HXJupyterhub) [root@master01 ~]# jupyter lab path \nApplication directory:   /opt/miniconda/envs/HXJupyterhub/share/jupyter/lab   # \u53ea\u6709\u5b89\u88c5jupyterlab\u7684\u7528\u6237\u53ef\u5199\uff0c\u5176\u4ed6\u4eba\u53ea\u8bfb\nUser Settings directory: /root/.jupyter/lab/user-settings\n</code></pre>"},{"location":"tools/webnotebook/jupyterlab.html#user-settings-directory","title":"User Settings Directory","text":"<p>user-level settings for JupyterLab extensions</p> <ul> <li>\u9ed8\u8ba4\u5728\uff1a$HOME/.jupyter/lab/user-settings/\uff1b</li> <li>\u53ef\u4ee5\u88ab<code>JUPYTERLAB_SETTINGS_DIR</code>\u73af\u5883\u53d8\u91cf\u8986\u76d6\uff1b</li> </ul>"},{"location":"tools/webnotebook/jupyterlab.html#workspaces-directory","title":"Workspaces Directory","text":"<p>stores workspaces\uff0ccontain the state of JupyterLab: the files that are currently open, the layout of the application areas and tabs, etc. </p> <ul> <li>\u9ed8\u8ba4\u5728\uff1a$HOME/.jupyter/lab/workspaces/\uff1b</li> <li>\u53ef\u4ee5\u88ab<code>JUPYTERLAB_WORKSPACES_DIR</code>\u73af\u5883\u53d8\u91cf\u8986\u76d6\uff1b</li> </ul>"},{"location":"tools/webnotebook/jupyterlab.html#notebook","title":"NoteBook\u7684\u5de5\u4f5c\u76ee\u5f55","text":"<pre><code># \u5355\u72ec\u7684Jupyterlab\uff0c\u901a\u8fc7jupyter-lab --genereate-config\uff0c\u751f\u6210\u914d\u7f6e\u6587\u4ef6\u540e\u4fee\u6539\nc.NotebookApp.notebook_dir\n\n# \u5982\u679c\u662fjupyterhub\uff0c\u4fee\u6539/etc/jupyterhub/jupyterhub_config.py\nc.Spawner.notebook_dir = '~'\n</code></pre>"},{"location":"tools/webnotebook/jupyterlab.html#kernel","title":"\u5b89\u88c5kernel","text":""},{"location":"tools/webnotebook/jupyterlab.html#kernel_1","title":"\u652f\u6301\u7684kernel","text":"<p>sql\uff1f</p>"},{"location":"tools/webnotebook/jupyterlab.html#_2","title":"\u6269\u5c55","text":"<p>jupyter-resource-usage </p>"},{"location":"tools/webnotebook/jupyterlab.html#jupterhub","title":"jupterhub","text":""},{"location":"tools/webnotebook/jupyterlab.html#_3","title":"\u914d\u7f6e","text":"<p>c.Spawner.notebook_dir = Unicode('')</p> <ul> <li>jupyterlab\u5de6\u4fa7\u7684\u9ed8\u8ba4\u76ee\u5f55\u7ed3\u6784\u6811\u7684\u6839\u76ee\u5f55</li> </ul>"},{"location":"tools/webnotebook/jupyterlab.html#_4","title":"\u591a\u7528\u6237\u65b9\u6848","text":""},{"location":"tools/webnotebook/jupyterlab.html#k8s","title":"k8s","text":""},{"location":"tools/webnotebook/zeeplin.html","title":"Zeeplin","text":""},{"location":"tools/webnotebook/zeeplin.html#_1","title":"\u539f\u7406","text":""},{"location":"tools/webnotebook/zeeplin.html#_2","title":"\u90e8\u7f72","text":""},{"location":"tools/webnotebook/zeeplin.html#docker","title":"docker","text":"<pre><code>docker run -p 8080:8080 --rm --name zeppelin apache/zeppelin:0.9.0\n\n# To persist logs and notebook directories, use the volume option for docker container.\ndocker run -p 8080:8080 --rm -v $PWD/logs:/logs -v $PWD/notebook:/notebook -e ZEPPELIN_LOG_DIR='/logs' -e ZEPPELIN_NOTEBOOK_DIR='/notebook' --name zeppelin apache/zeppelin:0.9.0\n</code></pre>"},{"location":"tools/webnotebook/zeeplin.html#_3","title":"\u5355\u673a\u6a21\u5f0f","text":""},{"location":"tools/webnotebook/zeeplin.html#_4","title":"\u96c6\u7fa4\u6a21\u5f0f\uff08\u5f53\u524d\u5b98\u7f51\u6ca1\u6709\u8bf4\u660e)","text":"<p>[Umbrella] Distributed zeppelin cluster services</p>"},{"location":"tools/webnotebook/zeeplin.html#_5","title":"\u89e3\u91ca\u5668","text":""},{"location":"tools/webnotebook/zeeplin.html#_6","title":"\u7ed1\u5b9a","text":"<p>Shared Mode\uff0cScoped Mode\uff0cIsolated Mode</p> Mode Each notebook... Benefits Disadvantages Sharing objects shared Shares a single session in a single interpreter process (JVM) Low resource utilization and it's easy to share data between notebooks All notebooks are affected if the interpreter process dies Can share directly scoped Has its own session in the same interpreter process (JVM) Less resource utilization than isolated mode All notebooks are affected if the interpreter process dies Can't share directly, but it's possible to share objects via ResourcePool isolated Has its own Interpreter Process One notebook is not affected directly by other notebooks (per note) Can't share data between notebooks easily (per note) Can't share directly, but it's possible to share objects via ResourcePool <p>In the case of the per user scope (available in a multi-user environment), Zeppelin manages interpreter sessions on a per user basis rather than a per note basis. For example:</p> <ul> <li>In scoped + per user mode, <code>User A</code>'s notes might be affected by <code>User B</code>'s notes. (e.g JVM dies, ...) Because all notes are running on the same JVM</li> <li>On the other hand, isolated + per user mode, <code>User A</code>'s notes will not be affected by others' notes which running on separated JVMs</li> </ul>"},{"location":"tools/webnotebook/zeeplin.html#_7","title":"\u8fd0\u884c\u6a21\u5f0f","text":""},{"location":"tools/webnotebook/zeeplin.html#local","title":"local","text":""},{"location":"tools/webnotebook/zeeplin.html#k8s-pod","title":"k8s pod","text":""},{"location":"tools/webnotebook/zeeplin.html#yarn","title":"yarn","text":""},{"location":"tools/webnotebook/zeeplin.html#gpu","title":"GPU\u7684\u652f\u6491","text":"<p>yarn\u6a21\u5f0f\u6682\u65f6\uff080.9\u7248\u672c\uff09\u4e0d\u652f\u6301\u7533\u8bf7gpu\u8d44\u6e90\uff0c\u9700\u8981\u5b9a\u5236\uff1b</p> <p>k8s\u6a21\u5f0f\uff0c\u901a\u8fc7\u4fee\u6539pod\u7684yml\u914d\u7f6e\uff0c\u53ef\u4ee5\u7533\u8bf7gpu\u8d44\u6e90\uff1b</p>"},{"location":"tools/webnotebook/zeeplin.html#_8","title":"\u591a\u7528\u6237","text":""},{"location":"tools/webnotebook/zeeplin.html#shiro","title":"Shiro\u8ba4\u8bc1","text":""},{"location":"tools/webnotebook/zeeplin.html#notebook","title":"Notebook\u6743\u9650","text":"<p>\u9ed8\u8ba4note\u521b\u5efa\u540e\u662fpublic\u53ef\u89c1\uff0c\u53ef\u4ee5\u914d\u7f6eprivate\u3002</p> <p>Note\u7684\u6743\u9650\u5206\u4e3a\"Read, Run, Write, Manage\"\u3002</p>"},{"location":"tools/webnotebook/zeeplin.html#_9","title":"\u7528\u6237\u6a21\u62df","text":"<p>User impersonation enables to run zeppelin interpreter process as a web frontend user.</p> <p>Impersonation\u6a21\u5f0f\u652f\u6301\u4ee5\u5176\u5b83\u7528\u6237\u8fd0\u884c\u89e3\u91ca\u5668\u8fdb\u7a0b\uff08\u5176\u4ed6\u7528\u6237\u9700\u8981\u771f\u5b9e\u5b58\u5728\uff0c\u4e14\u53ef\u4ee5\u514d\u5bc6ssh\uff09\u3002</p>"},{"location":"web/authentication.html","title":"\u8ba4\u8bc1","text":""},{"location":"web/authentication.html#kerberos","title":"Kerberos","text":"<p>Kerberos\u662f\u4e00\u4e2a\u5e38\u7528\u7684\u8ba4\u8bc1\u4e0e\u6388\u6743\u534f\u8bae\uff0c\u4e3b\u8981\u7528\u4e8e\u8ba1\u7b97\u673a\u7f51\u7edc\u7684\u8eab\u4efd\u9274\u522b(Authentication)\uff0c\u5176\u7279\u70b9\u662f\u7528\u6237\u53ea\u9700\u8f93\u5165\u4e00\u6b21\u8eab\u4efd\u9a8c\u8bc1\u4fe1\u606f\u5c31\u53ef\u4ee5\u51ed\u501f\u6b64\u9a8c\u8bc1\u83b7\u5f97\u7684\u7968\u636e(ticket-granting ticket)\u8bbf\u95ee\u591a\u4e2a\u670d\u52a1\uff0c\u5373SSO(Single Sign On)\u3002\u7531\u4e8e\u5728\u6bcf\u4e2aClient\u548cService\u4e4b\u95f4\u5efa\u7acb\u4e86\u5171\u4eab\u5bc6\u94a5\uff0c\u4f7f\u5f97\u8be5\u534f\u8bae\u5177\u6709\u76f8\u5f53\u7684\u5b89\u5168\u6027\u3002</p>"},{"location":"web/authentication.html#gssapi","title":"GSSAPI","text":"<p>GSSAPI\u4e3a Generic Security Services Application Program Interface \u7684\u7f29\u5199\uff0c\u5373\uff1a\u901a\u7528\u5b89\u5168\u670d\u52a1\u5e94\u7528\u7a0b\u5e8f\u63a5\u53e3\uff0cGSSAPI\u662f\u4e00\u4e2aIETF\u6807\u51c6\u3002</p>"},{"location":"web/authentication.html#spnego","title":"SPNEGO","text":"<p>Simple and Protected GSSAPI Negotiation Mechanism (SPNEGO) \u5373\u7b80\u5355\u4e14\u53d7\u4fdd\u62a4\u7684GSSAPI\u534f\u5546\u673a\u5236\uff0c\u662f\u5ba2\u6237\u7aef-\u670d\u52a1\u5668\u8f6f\u4ef6\u7528\u4e8e\u534f\u5546\u5b89\u5168\u6280\u672f\u9009\u62e9\u7684GSSAPI\u8fc7\u7a0b\u3002</p> <p>\u5f53\u5ba2\u6237\u7aef\u60f3\u8981\u5411\u670d\u52a1\u5668\u8ba4\u8bc1\u8eab\u4efd\uff0c\u4f46\u662f\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u90fd\u4e0d\u77e5\u9053\u5bf9\u65b9\u652f\u6301\u4ec0\u4e48\u8ba4\u8bc1\u534f\u8bae\u3002\u8fd9\u65f6\u9700\u8981\u4f7f\u7528SPNEGO\u6765\u9009\u62e9\u53cc\u65b9\u90fd\u652f\u6301\u7684GSSAPI \uff0c\u4ee5\u4fbf\u63a5\u4e0b\u6765\u7684\u8ba4\u8bc1\u8fc7\u7a0b\u4ee5\u53ca\u540e\u7eed\u5b89\u5168\u4fe1\u606f\u4f20\u8f93\u7684\u6b63\u5e38\u8fdb\u884c\u3002</p>"},{"location":"web/authentication.html#_2","title":"\u57fa\u672c\u6982\u5ff5","text":"<p>Princal(\u5b89\u5168\u4e2a\u4f53)\uff1a\u88ab\u8ba4\u8bc1\u7684\u4e2a\u4f53\uff0c\u6709\u4e00\u4e2a\u540d\u5b57\u548c\u53e3\u4ee4</p> <p>KDC(key distribution center ) : \u662f\u4e00\u4e2a\u7f51\u7edc\u670d\u52a1\uff0c\u63d0\u4f9bticket \u548c\u4e34\u65f6\u4f1a\u8bdd\u5bc6\u94a5</p> <ul> <li>AS (Authentication Server)\uff1a \u8ba4\u8bc1\u670d\u52a1\u5668\uff0cAS \u7684\u4f5c\u7528\u5c31\u662f\u9a8c\u8bc1 Client \u7aef\u7684\u8eab\u4efd\uff0c\u9a8c\u8bc1\u901a\u8fc7\u5c31\u4f1a\u7ed9\u4e00\u5f20 TGT\uff08Ticket Granting Ticket\uff09\u7968\u7ed9 Client\u3002</li> <li>Ticket Granting Server\uff08TGS\uff09\uff1aTGS \u7684\u4f5c\u7528\u662f\u901a\u8fc7 AS \u53d1\u9001\u7ed9 Client \u7684\u7968\uff08TGT\uff09\u6362\u53d6\u8bbf\u95ee Server \u7aef\u7684\u7968\u3002</li> </ul>"},{"location":"web/authentication.html#_3","title":"\u6d41\u7a0b","text":"<p>\u4f7f\u7528Kerberos\u65f6\uff0c\u4e00\u4e2a\u5ba2\u6237\u7aef\u9700\u8981\u7ecf\u8fc7\u4e09\u4e2a\u6b65\u9aa4\u6765\u83b7\u53d6\u670d\u52a1:</p> <p>\u8ba4\u8bc1\uff1a\u5ba2\u6237\u7aef\u5411\u8ba4\u8bc1\u670d\u52a1\u5668\u53d1\u9001\u4e00\u6761\u62a5\u6587\uff0c\u5e76\u83b7\u53d6\u4e00\u4e2a\u542b\u65f6\u95f4\u6233\u7684Ticket-Granting Ticket\uff08TGT\uff09\u3002</p> <p>\u6388\u6743\uff1a\u5ba2\u6237\u7aef\u4f7f\u7528TGT\u5411Ticket-Granting Server\uff08TGS\uff09\u8bf7\u6c42\u4e00\u4e2a\u670d\u52a1Ticket\u3002</p> <p>\u670d\u52a1\u8bf7\u6c42\uff1a\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u51fa\u793a\u670d\u52a1Ticket\uff0c\u4ee5\u8bc1\u5b9e\u81ea\u5df1\u7684\u5408\u6cd5\u6027\u3002\u8be5\u670d\u52a1\u5668\u63d0\u4f9b\u5ba2\u6237\u7aef\u6240\u9700\u670d\u52a1\uff0c\u5728Hadoop\u5e94\u7528\u4e2d\uff0c\u670d\u52a1\u5668\u53ef\u4ee5\u662fnamenode\u6216jobtracker\u3002</p> <p></p> <p>\u7528\u6237\u8eab\u4efd\u8ba4\u8bc1\u4e0e\u670d\u52a1\u6388\u6743\u90fd\u662f\u4e0d\u540c\u7684\u670d\u52a1\u89d2\u8272\u63d0\u4f9b\u7684\u3002\u53c2\u4e0e\u7684\u5404\u65b9\u89d2\u8272\u5305\u62ec\uff1a</p> <ul> <li>Client: Application Client \u5e94\u7528\u5ba2\u6237\u7aef</li> <li>AS: Authentication Server \u7528\u6765\u8ba4\u8bc1\u7528\u6237\u8eab\u4efd</li> <li>TGS: Ticket-Granting Service \u7528\u6765\u6388\u6743\u670d\u52a1\u8bbf\u95ee</li> <li>SS: Service Server \u7528\u6237\u6240\u8bf7\u6c42\u7684\u670d\u52a1</li> </ul> <p>http://www.nosqlnotes.com/technotes/kerberos-protocol/</p> <p>Kerberos\u8ba4\u8bc1\u4e0e\u6388\u6743\u7684\u51e0\u4e2a\u5173\u952e\u6b65\u9aa4\uff1a</p> <ol> <li>[Login] \u7528\u6237\u8f93\u5165\u7528\u6237\u540d/\u5bc6\u7801\u4fe1\u606f\u8fdb\u884c\u767b\u5f55\u3002</li> <li>[Client/AS] Client\u5230AS\u8fdb\u884c\u8ba4\u8bc1\uff0c\u83b7\u53d6TGT\u3002</li> <li>[Client/TGS] Client\u57fa\u4e8eTGT\u4ee5\u53caClient/TGS Session Key\u53bbTGS\u53bb\u83b7\u53d6Service Ticket(Client-To-Server Ticket)\u3002</li> <li>[Client/Server] Client\u57fa\u4e8e Client-To-Server Ticket\u4ee5\u53caClient/Server SessionKey\u53bbServer\u7aef\u8bf7\u6c42\u5efa\u7acb\u8fde\u63a5\uff0c\u8be5\u8fc7\u7a0bClient/Server\u53ef\u76f8\u4e92\u8fdb\u884c\u8ba4\u8bc1\u3002</li> <li>[Client/Server] \u8fde\u63a5\u5efa\u7acb\u4e4b\u540e\uff0cClient\u53ef\u6b63\u5e38\u5f80Server\u7aef\u53d1\u9001\u670d\u52a1\u8bf7\u6c42\u3002</li> </ol> <p>\u7b2c1\u6b65\uff0c\u5728Client\u7aef\u5b8c\u6210\u5bf9\u5bc6\u7801\u4fe1\u606f\u7684\u5355\u5411\u52a0\u5bc6\u3002</p> <p>\u7b2c2\u6b65\uff0c\u57fa\u4e8eJAAS\u8fdb\u884c\u8ba4\u8bc1\u3002</p> <p>\u7b2c3\uff0c4\u6b65\uff0c\u5219\u57fa\u4e8eGSS-API\u8fdb\u884c\u4ea4\u4e92\u3002</p> <p>\u7b2c4\uff0c5\u6b65\u5efa\u7acb\u8fde\u63a5\u4e0e\u53d1\u9001\u670d\u52a1\u8bf7\u6c42\u7684\u8fc7\u7a0b\uff0c\u5219\u901a\u5e38\u57fa\u4e8eSASL\u6846\u67b6\u3002</p>"},{"location":"web/authentication.html#_4","title":"\u5b89\u88c5","text":"<pre><code>yum install krb5-server krb5-libs krb5-auth-dialog\n</code></pre> <p>\u4f1a\u5728KDC\u4e3b\u673a\u4e0a\u751f\u6210\u914d\u7f6e\u6587\u4ef6/etc/krb5.conf\u548c/var/kerberos/krb5kdc/kdc.conf\uff0c\u5b83\u4eec\u5206\u522b\u53cd\u6620\u4e86realm name \u4ee5\u53ca domain-to-realm mappings\u3002</p> <p><code>kinit</code>\uff1a\u547d\u4ee4\u884c\u7528\u6237\u8ba4\u8bc1</p> <ul> <li>\u5728\u540c\u4e00\u4e2aOS\u7528\u6237\u4e0b\uff0c\u6240\u4ee5\u4e24\u4e2a\u4e0d\u540c\u7684Kerberos\u7528\u6237\u5728\u8fdb\u884cKinit\u64cd\u4f5c\u540e\u90fd\u4f1a\u8986\u76d6<code>/tmp/krb5cc_{uid}</code>\u6587\u4ef6\uff0c\u5bfc\u81f4Kerberos\u7684\u7968\u636e\u4fe1\u606f\u4e32\u6389\u3002</li> </ul>"},{"location":"web/authentication.html#ldap","title":"LDAP","text":"<p>LDAP\uff08Light Directory Access Portocol\uff09\uff0c\u5b83\u662f\u57fa\u4e8eX.500\u6807\u51c6\u7684\u8f7b\u91cf\u7ea7\u76ee\u5f55\u8bbf\u95ee\u534f\u8bae\u3002</p> <p>\u76ee\u5f55\u6570\u636e\u5e93\u548c\u5173\u7cfb\u6570\u636e\u5e93\u4e0d\u540c\uff0c\u5b83\u6709\u4f18\u5f02\u7684\u8bfb\u6027\u80fd\uff0c\u4f46\u5199\u6027\u80fd\u5dee\uff0c\u5e76\u4e14\u6ca1\u6709\u4e8b\u52a1\u5904\u7406\u3001\u56de\u6eda\u7b49\u590d\u6742\u529f\u80fd\uff0c\u4e0d\u9002\u4e8e\u5b58\u50a8\u4fee\u6539\u9891\u7e41\u7684\u6570\u636e\u3002</p> <p>\u76ee\u524d\u6709 OpenLDAP \u548c Apache DS \uff1b</p>"},{"location":"web/authentication.html#_5","title":"\u57fa\u672c\u6a21\u578b","text":""},{"location":"web/authentication.html#_6","title":"\u76ee\u5f55\u6811\u6982\u5ff5","text":"<ul> <li> <p>\u76ee\u5f55\u6811\uff1a\u5728\u4e00\u4e2a\u76ee\u5f55\u670d\u52a1\u7cfb\u7edf\u4e2d\uff0c\u6574\u4e2a\u76ee\u5f55\u4fe1\u606f\u96c6\u53ef\u4ee5\u8868\u793a\u4e3a\u4e00\u4e2a\u76ee\u5f55\u4fe1\u606f\u6811\uff0c\u6811\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u662f\u4e00\u4e2a\u6761\u76ee\u3002</p> </li> <li> <p>\u6761\u76ee\uff1a\u6bcf\u4e2a\u6761\u76ee\u5c31\u662f\u4e00\u6761\u8bb0\u5f55\uff0c\u6bcf\u4e2a\u6761\u76ee\u6709\u81ea\u5df1\u7684\u552f\u4e00\u53ef\u533a\u522b\u7684\u540d\u79f0\uff08DN\uff09\u3002</p> </li> <li> <p>\u5bf9\u8c61\u7c7b\uff1a\u4e0e\u67d0\u4e2a\u5b9e\u4f53\u7c7b\u578b\u5bf9\u5e94\u7684\u4e00\u7ec4\u5c5e\u6027\uff0c\u5bf9\u8c61\u7c7b\u662f\u53ef\u4ee5\u7ee7\u627f\u7684\uff0c\u8fd9\u6837\u7236\u7c7b\u7684\u5fc5\u987b\u5c5e\u6027\u4e5f\u4f1a\u88ab\u7ee7\u627f\u4e0b\u6765\u3002</p> </li> <li> <p>\u5c5e\u6027\uff1a\u63cf\u8ff0\u6761\u76ee\u7684\u67d0\u4e2a\u65b9\u9762\u7684\u4fe1\u606f\uff0c\u4e00\u4e2a\u5c5e\u6027\u7531\u4e00\u4e2a\u5c5e\u6027\u7c7b\u578b\u548c\u4e00\u4e2a\u6216\u591a\u4e2a\u5c5e\u6027\u503c\u7ec4\u6210\uff0c\u5c5e\u6027\u6709\u5fc5\u987b\u5c5e\u6027\u548c\u975e\u5fc5\u987b\u5c5e\u6027\u3002</p> </li> </ul> \u5173\u952e\u5b57 \u82f1\u6587\u5168\u79f0 \u542b\u4e49 dc Domain Component \u57df\u540d\u7684\u90e8\u5206\uff0c\u5176\u683c\u5f0f\u662f\u5c06\u5b8c\u6574\u7684\u57df\u540d\u5206\u6210\u51e0\u90e8\u5206\uff0c\u5982\u57df\u540d\u4e3aexample.com\u53d8\u6210dc=example,dc=com\uff08\u4e00\u6761\u8bb0\u5f55\u7684\u6240\u5c5e\u4f4d\u7f6e\uff09 uid User Id \u7528\u6237ID songtao.xu\uff08\u4e00\u6761\u8bb0\u5f55\u7684ID\uff09 ou Organization Unit \u7ec4\u7ec7\u5355\u4f4d\uff0c\u7ec4\u7ec7\u5355\u4f4d\u53ef\u4ee5\u5305\u542b\u5176\u4ed6\u5404\u79cd\u5bf9\u8c61\uff08\u5305\u62ec\u5176\u4ed6\u7ec4\u7ec7\u5355\u5143\uff09\uff0c\u5982\u201coa\u7ec4\u201d\uff08\u4e00\u6761\u8bb0\u5f55\u7684\u6240\u5c5e\u7ec4\u7ec7\uff09 cn Common Name \u516c\u5171\u540d\u79f0\uff0c\u5982\u201cThomas Johansson\u201d\uff08\u4e00\u6761\u8bb0\u5f55\u7684\u540d\u79f0\uff09 sn Surname \u59d3\uff0c\u5982\u201c\u8bb8\u201d dn Distinguished Name \u201cuid=songtao.xu,ou=oa\u7ec4,dc=example,dc=com\u201d\uff0c\u4e00\u6761\u8bb0\u5f55\u7684\u4f4d\u7f6e\uff08\u552f\u4e00\uff09 rdn Relative dn \u76f8\u5bf9\u8fa8\u522b\u540d\uff0c\u7c7b\u4f3c\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u76f8\u5bf9\u8def\u5f84\uff0c\u5b83\u662f\u4e0e\u76ee\u5f55\u6811\u7ed3\u6784\u65e0\u5173\u7684\u90e8\u5206\uff0c\u5982\u201cuid=tom\u201d\u6216\u201ccn= Thomas Johansson\u201d"},{"location":"web/authentication.html#_7","title":"\u6570\u636e\u7ec4\u7ec7\u65b9\u5f0f","text":""},{"location":"web/authorization.html","title":"\u6388\u6743","text":"<p>\u6388\u6743\u53d1\u751f\u5728\u7cfb\u7edf\u6210\u529f\u9a8c\u8bc1\u60a8\u7684\u8eab\u4efd\u540e\uff0c\u6700\u7ec8\u4f1a\u6388\u4e88\u60a8\u8bbf\u95ee\u8d44\u6e90\uff08\u5982\u4fe1\u606f\uff0c\u6587\u4ef6\uff0c\u6570\u636e\u5e93\uff0c\u8d44\u91d1\uff0c\u4f4d\u7f6e\uff0c\u51e0\u4e4e\u4efb\u4f55\u5185\u5bb9\uff09\u7684\u5b8c\u5168\u6743\u9650\u3002</p>"},{"location":"web/authorization.html#_2","title":"\u6743\u9650\u6a21\u578b","text":""},{"location":"web/authorization.html#dac","title":"\u81ea\u4e3b\u8bbf\u95ee\u63a7\u5236 DAC","text":"<p>\u6700\u65e9\u51fa\u73b0\u7684\u662f DAC\uff08Discretionary Access Control\uff09\uff0c\u5728 DAC \u4e2d object owner \u6709\u6743\u8bbe\u7f6e\u8be5 object \u7684\u8bbf\u95ee\u6743\u9650\u3002</p> <ul> <li>\u901a\u8fc7\u6388\u4e88 individuals/groups \u4ee5 read/write/execute \u6743\u9650\uff0c object (file) \u7684\u521b\u5efa\u8005\u80fd\u5b8c\u5168\u63a7\u5236\u8be5 object \u7684\u5185\u5bb9\u548c\u6743\u9650\u3002</li> <li>\u9002\u7528\u4e8e\u666e\u901a\u7528\u6237\u7684\u6587\u4ef6\u6743\u9650\u63a7\u5236</li> </ul> <p></p> <p>\u95ee\u9898\uff1a\u5176\u6743\u9650\u4f20\u64ad\u53ef\u63a7\u6027\u5dee\uff0c\u5408\u89c4\u6027\u5f88\u96be\u4fdd\u8bc1\uff0c\u673a\u5bc6\u6587\u4ef6\u5f88\u5bb9\u6613\u88ab\u6076\u610f reshare \u51fa\u53bb\u3002</p>"},{"location":"web/authorization.html#mac","title":"MAC\uff08\u5f3a\u5236\u8bbf\u95ee\u63a7\u5236\uff09","text":"<p>\u6570\u5b57\u7cfb\u7edf\u4e2d\uff0cMAC \u5728\u7406\u8bba\u8981\u6bd4\u5728\u5b9e\u9645\u4e2d\u7b80\u5355 \uff08easier in theory than in practice\uff09</p> <ul> <li>\u4e00\u4e2a\u529f\u80fd\u5b8c\u6574\u7684\uff08full-on\uff09MAC \u7cfb\u7edf\u662f\u5f88\u96be\u771f\u6b63\u5b9e\u73b0\u7684\u3002</li> </ul> <p>\u7531 administrator\uff08\u7ba1\u7406\u5458\uff09\u6216 administrative rule\uff08\u7ba1\u7406\u5458\u7ea7\u522b\u7684\u89c4\u5219\uff09 \u6765\u5b9a\u4e49 rules\u3002</p> <p></p> <p>MAC\uff1a\u6587\u4ef6 owner \u53ea\u80fd\u8bbe\u7f6e\u4e00\u4e2a\u6587\u4ef6 type\uff0c\u8fd9\u4e2a type \u5305\u542b\u4e86\u54ea\u4e9b\u6743\u9650\u662f\u7531 admin \u6216 policy \u8bbe\u7f6e\u7684\u3002 \u7528\u6237\u80fd\u7f16\u8f91\u6587\u4ef6\u5185\u5bb9\uff0c\u4f46\u65e0\u6cd5\u4fee\u6539\u6587\u4ef6\u6743\u9650\u3002</p> <p>\u56e0\u6b64\u5728 MAC \u6a21\u578b\u4e2d\uff0c\u4e00\u4e2a\u4eba\u505a\u67d0\u4e9b\u4e8b\u60c5\u7684 \u80fd\u529b\u662f\u65e0\u6cd5\u518d\u5206\u4eab\u7ed9\u5176\u4ed6\u4eba\u7684\uff0c\u4ece\u800c\u907f\u514d\u4e86\u6587\u4ef6\u88ab reshare \u7684\u95ee\u9898\u3002</p> <p>\u53cc\u56e0\u7d20\u767b\u5f55\uff1a2FA as MAC</p> <ul> <li>\u5bc6\u7801\u53ef\u4ee5\u5171\u4eab\uff0c\u4f46\u786c\u4ef6 token \u4e0d\u80fd\u3002\u5bc6\u7801\u662f DAC\uff0c\u800c\u786c\u4ef6 token \u662f MAC\u3002\u5047\u8bbe\u4e86\u7b2c\u4e8c\u56e0\u7d20\uff08the second factor\uff0c\u5373\u786c\u4ef6 token\uff09\u662f\u4e0d\u53ef\u5206\u4eab\u7684\u3002</li> </ul>"},{"location":"web/authorization.html#rbac","title":"RBAC","text":"<p>RBAC \u662f MAC \u7684\u4e00\u4e2a\u5b50\u96c6\uff0c\u5b83\u662f\u4e00\u79cd\u7279\u6b8a\u7c7b\u578b\u7684 MAC\u3002</p> <p>\u57fa\u4e8e\u8d44\u6e90\u7684\u6743\u9650\u63a7\u5236\uff0c\u7528\u6237 -&gt; \u89d2\u8272 -&gt; \u8d44\u6e90 \u7684\u6620\u5c04\u5173\u7cfb\u3002</p> <p>RBAC0\uff1a\u7528\u6237\u4e0e\u89d2\u8272\u3001\u89d2\u8272\u4e0e\u6743\u9650\u95f4\u5efa\u7acb\u5173\u7cfb\uff0c\u6bcf\u79cd\u5173\u7cfb\u5747\u4e3a\u591a\u5bf9\u591a\uff1b</p> <p>RBAC1\uff1a\u5728RBAC-0\u7684\u57fa\u7840\u4e0a\uff0c\u589e\u52a0\u89d2\u8272\u7684\u7ee7\u627f\u5173\u7cfb\uff08\u7528\u4e8e\u90e8\u95e8\u7684\u4e0a\u4e0b\u7ea7\u7684\u6743\u9650\u8303\u56f4\uff09\uff1b</p> <p>RBAC2\uff1a\u57fa\u4e8eRBAC0\u6a21\u578b\uff0c\u589e\u52a0\u5bf9\u89d2\u8272\u7684\u4e00\u4e9b\u9650\u5236\uff1a\u89d2\u8272\u4e92\u65a5\u3001\u57fa\u6570\u7ea6\u675f\u3001\u5148\u51b3\u6761\u4ef6\u89d2\u8272\u7b49\uff1b</p> <p>RBAC3\uff1a\u7edf\u4e00\u6a21\u578b\uff0c\u5305\u542bRBAC1\u548cRBAC2\uff1b</p>"},{"location":"web/authorization.html#abac","title":"ABAC","text":"<p>\u5bf9 RBAC \u7684\u6539\u8fdb\uff0c\u52a0\u4e86\u4e00\u4e9b\u7ec6\u8282\uff08\u5c5e\u6027\uff0cAttributes\uff09</p> <p><code>\u57fa\u4e8e\u5c5e\u6027\u7684\u8bbf\u95ee\u63a7\u5236</code>\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e3b\u4f53\u3001\u5ba2\u4f53\u6216\u52a8\u4f5c\u7684\u5c5e\u6027\uff0c\u800c\u4e0d\u662f\u5b57\u7b26\u4e32\u672c\u8eab\u6765\u63a7\u5236\u8bbf\u95ee\u3002</p> <ul> <li>\u652f\u6301\u52a8\u6001\u7684\u5c5e\u6027\u5224\u65ad\u7b49\uff1b</li> <li>\u5c5e\u6027\u53ef\u4ee5\u662f\u4f4d\u7f6e\u3001\u5ba2\u6237\u7aef\u8bbe\u5907\u5e73\u53f0\u3001\u8ba4\u8bc1\u7c7b\u578b\u3001\u7528\u6237\u7684 http cookies \u7b49</li> <li>\u5c5e\u6027\u7684\u89e3\u6790\u548c\u8ba4\u8bc1\u5de5\u4f5c\u662f\u4e2d\u5fc3\u5f0f\u7684\uff0c\u5927\u90e8\u5206\u90fd\u5b9e\u73b0 \u5728\u5404\u5bb6\u7684 identity provider \u4e2d</li> <li>\u5f53\u7cfb\u7edf\u5224\u65ad\u662f\u5426\u6388\u4e88\u67d0\u4e2a\u7528\u6237\u5bf9\u67d0\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650\u65f6\uff0cABAC \u7cfb\u7edf \u9664\u4e86\u68c0\u67e5\u4ed6\u4eec\u7684 RBAC role\uff08group\uff09\uff0c\u8fd8\u4f1a\u68c0\u67e5\u8fd9\u4e2a\u4eba\u643a\u5e26\u7684\u5404\u79cd\u5c5e\u6027\u3002</li> </ul>"},{"location":"web/authorization.html#sso","title":"\u5355\u70b9\u767b\u5f55 SSO","text":"\u529f\u80fd\u70b9 SSO\u5355\u70b9\u767b\u5f55 OAuth2.0 \u7edf\u4e00\u8ba4\u8bc1 \u652f\u6301\u5ea6\u9ad8 \u652f\u6301\u5ea6\u9ad8 \u7edf\u4e00\u6ce8\u9500 \u652f\u6301\u5ea6\u9ad8 \u652f\u6301\u5ea6\u4f4e \u591a\u4e2a\u7cfb\u7edf\u4f1a\u8bdd\u4e00\u81f4\u6027 \u5f3a\u4e00\u81f4 \u5f31\u4e00\u81f4 \u7b2c\u4e09\u65b9\u5e94\u7528\u6388\u6743\u7ba1\u7406 \u4e0d\u652f\u6301 \u652f\u6301\u5ea6\u9ad8 \u81ea\u6709\u7cfb\u7edf\u6388\u6743\u7ba1\u7406 \u652f\u6301\u5ea6\u9ad8 \u652f\u6301\u5ea6\u4f4e Client\u7ea7\u7684\u6743\u9650\u6821\u9a8c \u4e0d\u652f\u6301 \u652f\u6301\u5ea6\u9ad8 \u96c6\u6210\u7b80\u6613\u5ea6 \u6bd4\u8f83\u7b80\u5355 \u96be\u5ea6\u4e2d\u7b49"},{"location":"web/authorization.html#oauth-20","title":"OAuth 2.0","text":"<p>OAuth2.0\u7684\u5e94\u7528\u573a\u666f\u53ef\u4ee5\u7406\u89e3\u4e3a\u5355\u70b9\u767b\u5f55\u7684\u5347\u7ea7\u7248\uff0c\u5355\u70b9\u767b\u5f55\u89e3\u51b3\u4e86\u591a\u4e2a\u7cfb\u7edf\u95f4\u4f1a\u8bdd\u7684\u5171\u4eab\uff0cOAuth2.0\u5728\u6b64\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u5e94\u7528\u4e4b\u95f4\u7684\u6743\u9650\u63a7\u5236\u3002</p> <p>\u6570\u636e\u7684\u6240\u6709\u8005\u544a\u8bc9\u7cfb\u7edf\uff0c\u540c\u610f\u6388\u6743\u7b2c\u4e09\u65b9\u5e94\u7528\u8fdb\u5165\u7cfb\u7edf\uff0c\u83b7\u53d6\u8fd9\u4e9b\u6570\u636e\u3002\u7cfb\u7edf\u4ece\u800c\u4ea7\u751f\u4e00\u4e2a\u77ed\u671f\u7684\u8fdb\u5165\u4ee4\u724c\uff08token\uff09\uff0c\u7528\u6765\u4ee3\u66ff\u5bc6\u7801\uff0c\u4f9b\u7b2c\u4e09\u65b9\u5e94\u7528\u4f7f\u7528\u3002</p>"},{"location":"web/authorization.html#_3","title":"\u6388\u6743\u6a21\u5f0f","text":"<p>\u6388\u6743\u7801\uff08Authorization Code\uff09\uff1a\u7b2c\u4e09\u65b9\u5e94\u7528\u5148\u7533\u8bf7\u4e00\u4e2a\u6388\u6743\u7801\uff0c\u7136\u540e\u518d\u7528\u8be5\u7801\u83b7\u53d6\u4ee4\u724c\u3002</p> <ul> <li>OAuth2.0\u6807\u51c6\u6388\u6743\u6b65\u9aa4\uff0cServer\u7aef\u5411Client\u7aef\u4e0b\u653eCode\u7801\uff0cClient\u7aef\u518d\u7528Code\u7801\u6362\u53d6\u6388\u6743Token\uff1b</li> </ul> <p>\u9690\u85cf\u5f0f\uff08Implicit\uff09\uff1a\u7eaf\u524d\u7aef\u5e94\u7528\uff0c\u76f4\u63a5\u5411\u524d\u7aef\u9881\u53d1\u4ee4\u724c</p> <ul> <li>\u65e0\u6cd5\u4f7f\u7528\u6388\u6743\u7801\u6a21\u5f0f\u65f6\u7684\u5907\u7528\u9009\u62e9\uff0cServer\u7aef\u4f7f\u7528URL\u91cd\u5b9a\u5411\u65b9\u5f0f\u76f4\u63a5\u5c06Token\u4e0b\u653e\u5230Client\u7aef\u9875\u9762\uff1b</li> </ul> <p>\u5bc6\u7801\u5f0f\uff08Password\uff09\uff1a\u53ea\u9002\u7528\u4e8e\u5176\u4ed6\u6388\u6743\u65b9\u5f0f\u90fd\u65e0\u6cd5\u91c7\u7528\u7684\u60c5\u51b5\uff0c\u800c\u4e14\u5fc5\u987b\u662f\u7528\u6237\u9ad8\u5ea6\u4fe1\u4efb\u7684\u5e94\u7528\u3002</p> <ul> <li>Client\u76f4\u63a5\u62ff\u7740\u7528\u6237\u7684\u8d26\u53f7\u5bc6\u7801\u6362\u53d6\u6388\u6743Token\uff1b</li> </ul> <p>\u5ba2\u6237\u7aef\u51ed\u8bc1\uff08Client Credentials\uff09\uff1a\u9002\u7528\u4e8e\u6ca1\u6709\u524d\u7aef\u7684\u547d\u4ee4\u884c\u5e94\u7528\uff0c\u5373\u5728\u547d\u4ee4\u884c\u4e0b\u8bf7\u6c42\u4ee4\u724c\u3002</p> <ul> <li>Server\u7aef\u9488\u5bf9Client\u7ea7\u522b\u7684Token\uff0c\u4ee3\u8868\u5e94\u7528\u81ea\u8eab\u7684\u8d44\u6e90\u6388\u6743\uff1b</li> </ul>"},{"location":"web/authorization.html#casbin","title":"Casbin","text":"<p>\u5f00\u6e90\u7684\u8bbf\u95ee\u63a7\u5236\u5e93\uff0c\u652f\u6301\u5404\u79cd\u8bbf\u95ee\u63a7\u5236\u6a21\u578b\u4ee5\u5f3a\u5236\u5168\u9762\u6267\u884c\u6388\u6743\u3002</p> <ul> <li>\u4e0d\u505a\u8eab\u4efd\u8ba4\u8bc1\uff1b</li> <li>\u4e0d\u7ba1\u7406\u7528\u6237\u5217\u8868\u6216\u89d2\u8272\u5217\u8868\u3002</li> <li>\u57fa\u4e8e\u5185\u5b58\u505a\u5feb\u901f\u5339\u914d\uff1b</li> </ul>"},{"location":"web/authorization.html#_4","title":"\u8bbf\u95ee\u6a21\u578b","text":"<p><code>model.conf</code> \u5b9a\u4e49\u6743\u9650\u6a21\u578b\uff0c\u652f\u6301</p> <ul> <li>ACL (Access Control List, \u8bbf\u95ee\u63a7\u5236\u5217\u8868)</li> <li>\u5177\u6709 \u8d85\u7ea7\u7528\u6237 \u7684 ACL</li> <li>\u6ca1\u6709\u7528\u6237\u7684 ACL: \u5bf9\u4e8e\u6ca1\u6709\u8eab\u4efd\u9a8c\u8bc1\u6216\u7528\u6237\u767b\u5f55\u7684\u7cfb\u7edf\u5c24\u5176\u6709\u7528\u3002</li> <li>\u6ca1\u6709\u8d44\u6e90\u7684 ACL: \u67d0\u4e9b\u573a\u666f\u53ef\u80fd\u53ea\u9488\u5bf9\u8d44\u6e90\u7684\u7c7b\u578b, \u800c\u4e0d\u662f\u5355\u4e2a\u8d44\u6e90, \u8bf8\u5982 <code>write-article</code>, <code>read-log</code>\u7b49\u6743\u9650\u3002 \u5b83\u4e0d\u63a7\u5236\u5bf9\u7279\u5b9a\u6587\u7ae0\u6216\u65e5\u5fd7\u7684\u8bbf\u95ee\u3002</li> <li>RBAC (\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236)</li> <li>\u652f\u6301\u8d44\u6e90\u89d2\u8272\u7684RBAC: \u7528\u6237\u548c\u8d44\u6e90\u53ef\u4ee5\u540c\u65f6\u5177\u6709\u89d2\u8272 (\u6216\u7ec4)\u3002</li> <li>\u652f\u6301\u57df/\u79df\u6237\u7684RBAC: \u7528\u6237\u53ef\u4ee5\u4e3a\u4e0d\u540c\u7684\u57df/\u79df\u6237\u8bbe\u7f6e\u4e0d\u540c\u7684\u89d2\u8272\u96c6\u3002</li> <li>ABAC (\u57fa\u4e8e\u5c5e\u6027\u7684\u8bbf\u95ee\u63a7\u5236): \u652f\u6301\u5229\u7528<code>resource.Owner</code>\u8fd9\u79cd\u8bed\u6cd5\u7cd6\u83b7\u53d6\u5143\u7d20\u7684\u5c5e\u6027\u3002</li> <li>RESTful: \u652f\u6301\u8def\u5f84, \u5982 <code>/res/*</code>, <code>/res/: id</code> \u548c HTTP \u65b9\u6cd5, \u5982 <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>\u3002</li> <li>\u62d2\u7edd\u4f18\u5148: \u652f\u6301\u5141\u8bb8\u548c\u62d2\u7edd\u6388\u6743, \u62d2\u7edd\u4f18\u5148\u4e8e\u5141\u8bb8\u3002</li> <li>\u4f18\u5148\u7ea7: \u7b56\u7565\u89c4\u5219\u6309\u7167\u5148\u540e\u6b21\u5e8f\u786e\u5b9a\u4f18\u5148\u7ea7\uff0c\u7c7b\u4f3c\u4e8e\u9632\u706b\u5899\u89c4\u5219\u3002</li> </ul>"},{"location":"web/authorization.html#_5","title":"\u5b58\u50a8","text":"<p>model \u53ea\u80fd\u52a0\u8f7d\uff0c\u4e0d\u80fd\u4fdd\u5b58\uff0c\u56e0\u4e3amodel \u4e0d\u662f\u52a8\u6001\u7ec4\u4ef6\uff0c\u4e0d\u5e94\u8be5\u5728\u8fd0\u884c\u65f6\u8fdb\u884c\u4fee\u6539\u3002</p> <ul> <li>\u652f\u6301\u4ece\u6587\u4ef6\u3001\u4ee3\u7801\u3001\u5b57\u7b26\u4e32\u52a0\u8f7d</li> </ul>"},{"location":"web/authorization.html#_6","title":"\u7528\u6237\u6743\u9650\u914d\u7f6e","text":"<p>\u4e0d\u540c\u8bed\u8a00\u652f\u6301\u7684\u914d\u7f6e\u6e90\u89c1\u5b98\u7f51</p> <ul> <li>\u62bd\u8c61\u63a5\u53e3\u89c1 \u5982\u4f55\u7f16\u5199 Adapter</li> </ul>"},{"location":"web/authorization.html#_7","title":"\u81ea\u52a8\u4fdd\u5b58","text":"<ul> <li>\u652f\u6301\u81ea\u52a8\u4fdd\u5b58\u673a\u5236\u7684adapter\u53ef\u4ee5\u81ea\u52a8\u5411\u5b58\u50a8\u56de\u5199\u5185\u5b58\u4e2d\u5355\u4e2apolicy\u89c4\u5219\u7684\u53d8\u66f4\uff08\u5220\u9664/\u66f4\u65b0\uff09\uff1b</li> <li>\u901a\u8fc7<code>Enforcer.EnableAutoSave()</code> \u51fd\u6570\u6765\u5f00\u542f\u6216\u5173\u95ed\u8be5\u673a\u5236\uff0c\u9ed8\u8ba4\u5f00\u542f\uff1b</li> </ul> <p>\u6ce8\uff1a\u4e0e\u81ea\u52a8\u56de\u5199\u673a\u5236\u4e0d\u540c\uff0c\u8c03\u7528<code>SavePolicy()</code>\u4f1a\u76f4\u63a5\u5220\u9664\u6240\u6709\u5b58\u50a8\u4e2d\u7684policy\u89c4\u5219\u5e76\u5c06\u5f53\u524d<code>Casbin enforcer</code>\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\u7684policy\u89c4\u5219\u6089\u6570\u6301\u4e45\u5316\u5230\u5b58\u50a8\u4e2d\u3002</p>"},{"location":"web/authorization.html#_8","title":"\u6a21\u578b\u8bed\u6cd5","text":""},{"location":"web/authorization.html#common","title":"Common","text":"<p>\u81f3\u5c11\u5e94\u5305\u542b\u56db\u4e2a\u90e8\u5206: <code>[request_definition], [policy_definition], [policy_effect], [matchers]</code></p> <ul> <li>\u5982\u679c model \u4f7f\u7528 RBAC\uff0c\u8fd8\u9700\u8981\u6dfb\u52a0<code>[role_definition]</code>\u90e8\u5206\u3002</li> </ul> <p><code>[request_definition]</code> \u662f\u8bbf\u95ee\u8bf7\u6c42\u7684\u5b9a\u4e49\u3002</p> <pre><code>[request_definition]\nr = sub, obj, act\n</code></pre> <ul> <li><code>sub, obj, act</code> \u8868\u793a\u7ecf\u5178\u4e09\u5143\u7ec4: \u8bbf\u95ee\u5b9e\u4f53 (Subject)\uff0c\u8bbf\u95ee\u8d44\u6e90 (Object) \u548c\u8bbf\u95ee\u52a8\u4f5c (Action)\u3002</li> </ul> <p><code>[policy_definition]</code> \u662f\u7b56\u7565\u7684\u5b9a\u4e49\u3002\uff08\u7528\u6237\u6743\u9650\u914d\u7f6e\u7684\u6bcf\u6761\u4f1a\u8ddf\u8fd9\u91cc\u7684\u67d0\u4e2a\u7b56\u7565\u5339\u914d\uff09</p> <ul> <li>\u5982\u6743\u9650 <code>p, alice, data1, read</code> \u8868\u793a\u5339\u914d\u7b56\u7565<code>p</code>\uff1b</li> </ul> <pre><code>[policy_definition]\n# eft \u8868\u793a\u51b3\u7b56\u7ed3\u679c\uff08\u5f53\u4e0d\u6307\u5b9a\u89c4\u5219\u7684\u51b3\u7b56\u7ed3\u679c\u65f6,\u53d6\u9ed8\u8ba4\u503callow\uff09\n# p = sub, obj, act, eft\n\np = sub, obj, act\np2 = sub, act\n</code></pre> <p><code>[policy_effect]</code> \u90e8\u5206\u662f\u5bf9policy\u751f\u6548\u8303\u56f4\u7684\u5b9a\u4e49\uff0c</p> <ul> <li>\u591a\u4e2apolicy rule\u540c\u65f6\u5339\u914d\u8bbf\u95ee\u8bf7\u6c42request\u65f6,\u8be5\u5982\u4f55\u5bf9\u591a\u4e2a\u51b3\u7b56\u7ed3\u679c\u8fdb\u884c\u96c6\u6210\u4ee5\u5b9e\u73b0\u7edf\u4e00\u51b3\u7b56\uff1b</li> </ul> <pre><code>[policy_effect]\n# p.eft \u8868\u793a\u7b56\u7565\u89c4\u5219\u7684\u51b3\u7b56\u7ed3\u679c\uff0c\u53ef\u4ee5\u4e3aallow \u6216\u8005deny\ne = some(where (p.eft == allow))\n</code></pre> <p><code>[matchers]</code> \u662f\u7b56\u7565\u5339\u914d\u5668\u7684\u5b9a\u4e49\uff08\u5339\u914d\u89c4\u5219\u7684\u5b9a\u4e49\u662f\u5f71\u54cd\u6027\u80fd\u7684\u56e0\u7d20\uff0c\u77ed\u8def\u6c42\u503c\u4f18\u5316\uff09</p> <pre><code>[matchers]\nm = r.sub == p.sub &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act\n</code></pre>"},{"location":"web/authorization.html#_9","title":"\u5185\u7f6e\u7684\u5339\u914d\u51fd\u6570","text":"<p>\u5bf9\u4e8e matcher\uff0c\u5185\u7f6e\u5f88\u591a\u7684\u5339\u914d\u51fd\u6570\uff0c\u5bf9\u4e8e jcasbin\uff0c\u5305\u62ec</p> <pre><code>fm.addFunction(\"keyMatch\", new KeyMatchFunc());\nfm.addFunction(\"keyMatch2\", new KeyMatch2Func());\nfm.addFunction(\"keyMatch3\", new KeyMatch3Func());\nfm.addFunction(\"keyMatch4\", new KeyMatch4Func());\nfm.addFunction(\"keyMatch5\", new KeyMatch5Func());\nfm.addFunction(\"keyGet\", new KeyGetFunc());\nfm.addFunction(\"keyGet2\", new KeyGet2Func());\nfm.addFunction(\"regexMatch\", new RegexMatchFunc());\nfm.addFunction(\"ipMatch\", new IPMatchFunc());\nfm.addFunction(\"eval\", new EvalFunc());\nfm.addFunction(\"globMatch\", new GlobMatchFunc());\n</code></pre>"},{"location":"web/authorization.html#rbac_1","title":"RBAC\u7684\u89d2\u8272","text":"<p><code>[role_definition]</code>\u539f\u8bed\u5b9a\u4e49 RBAC 1\u2018s \u4e2d\u7684\u89d2\u8272\u7ee7\u627f\u5173\u7cfb</p> <pre><code>[role_definition]\n# \u524d\u9879\u7ee7\u627f\u540e\u9879\u89d2\u8272\u7684\u6743\u9650\ng = _, _\ng2 = _, _\n</code></pre> <p>\u4ee5policy\u8868\u793a\u4e2d\u5b9e\u9645\u7684\u7528\u6237\u89d2\u8272\u6620\u5c04\u5173\u7cfb (\u6216\u662f\u8d44\u6e90-\u89d2\u8272\u6620\u5c04\u5173\u7cfb)\uff0c\u4f8b\u5982:</p> <pre><code>p, data2_admin, data2, read\ng, alice, data2_admin\n</code></pre> <p>\u8fd9\u610f\u5473\u7740 <code>alice</code> \u662f\u89d2\u8272 <code>data2_admin</code>\u7684\u4e00\u4e2a\u6210\u5458\u3002 <code>alice</code> \u5728\u8fd9\u91cc\u53ef\u4ee5\u662f\u7528\u6237\u3001\u8d44\u6e90\u6216\u89d2\u8272\u3002 </p> <p>\u5728matcher\u4e2d\uff0c\u5e94\u8be5\u50cf\u4e0b\u9762\u7684\u4f8b\u5b50\u4e00\u6837\u68c0\u67e5\u89d2\u8272\u4fe1\u606f\uff1a</p> <pre><code>[matchers]\nm = g(r.sub, p.sub) &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act\n</code></pre> <p>\u8fd9\u610f\u5473\u7740\u5728\u8bf7\u6c42\u4e2d\u7684<code>sub</code>\u9700\u8981\u5177\u5907policy\u4e2d\u7684role <code>sub</code>\u3002</p> <p>\u6ce8\u610f\uff1a</p> <ul> <li>RBAC \u7cfb\u7edf\u4e2d\u7684\u7528\u6237\u540d\u79f0\u548c\u89d2\u8272\u540d\u79f0\u4e0d\u5e94\u76f8\u540c\uff08\u53ef\u4ee5\u901a\u8fc7\u201du::\" \u6216 \"r::\" \u7684\u524d\u7f00\uff0c\u533a\u5206\u7528\u6237\u8fd8\u662f\u89d2\u8272\uff1b</li> </ul>"},{"location":"web/authorization.html#_10","title":"\u57df\u79df\u6237\u7684\u89d2\u8272\u5b9a\u4e49","text":"<p>RBAC\u89d2\u8272\u53ef\u4ee5\u662f\u5168\u5c40\u6216\u662f\u57fa\u4e8e\u7279\u5b9a\u4e8e\u57df\u7684\u3002 \u7279\u5b9a\u57df\u7684\u89d2\u8272\u610f\u5473\u7740\u5f53\u7528\u6237\u5904\u4e8e\u4e0d\u540c\u7684\u57df/\u79df\u6237\u7fa4\u4f53\u65f6\uff0c\u7528\u6237\u6240\u8868\u73b0\u7684\u89d2\u8272\u4e5f\u4e0d\u5c3d\u76f8\u540c\u3002</p> <ul> <li>\u8fd9\u5bf9\u4e8e\u50cf\u4e91\u670d\u52a1\u8fd9\u6837\u7684\u5927\u578b\u7cfb\u7edf\u975e\u5e38\u6709\u7528\uff0c\u56e0\u4e3a\u7528\u6237\u901a\u5e38\u5206\u5c5e\u4e8e\u4e0d\u540c\u7684\u79df\u6237\u7fa4\u4f53\u3002</li> </ul> <pre><code>[request_definition]\nr = sub, dom, obj, act\n\n[policy_definition]\np = sub, dom, obj, act\n\n[role_definition]\n# \u7b2c\u4e09\u4e2a _ \u8868\u793a\u57df/\u79df\u6237\u7684\u540d\u79f0, \u6b64\u90e8\u5206\u4e0d\u5e94\u66f4\u6539\u3002\ng = _, _, _\n\n[policy_effect]\ne = some(where (p.eft == allow))\n\n[matchers]\nm = g(r.sub, p.sub, r.dom) &amp;&amp; r.dom == p.dom &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act\n</code></pre> <p>policy\u6570\u636e\u53ef\u4ee5\u662f\uff1a</p> <pre><code>p, admin, tenant1, data1, read\np, admin, tenant2, data2, read\n\n# alice\u5728tenant1\u57df\u4e2d\u5177\u6709admin\u89d2\u8272\uff0c\u4f46\u5728tenant2\u57df\u4e2d\u5177\u6709user\u89d2\u8272\ng, alice, admin, tenant1\ng, alice, user, tenant2\n</code></pre>"},{"location":"web/authorization.html#rbac_2","title":"RBAC \u793a\u4f8b","text":"<pre><code>[request_definition]\nr = sub, obj, act\n\n[policy_definition]\np = sub, obj, act\n\n[role_definition]\ng = _, _\n\n[policy_effect]\ne = some(where (p.eft == allow))\n\n[matchers]\nm = g(r.sub, p.sub) &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act\n</code></pre>"},{"location":"web/authorization.html#rbac_3","title":"RBAC\u7684\u652f\u6301\u8bf4\u660e","text":"RBAC\u7248\u672c \u652f\u6301\u7ea7\u522b \u8bf4\u660e RBAC0 \u5b8c\u5168\u652f\u6301 RBAC0 \u662f RBAC96 \u7684\u57fa\u672c\u7248\u672c\u3002 \u5b83\u6f84\u6e05\u4e86\u4f7f\u7528\u8005\u3001\u89d2\u8272\u548c\u6743\u9650\u4e4b\u95f4\u7684\u5173\u7cfb\u3002 RBAC1 \u5b8c\u5168\u652f\u6301 Casbin \u7684 RBAC \u652f\u6301 RBAC1 \u7684\u89d2\u8272\u5c42\u6b21\u7ed3\u6784\u529f\u80fd\uff0c\u5982\u679c <code>alice</code>\u5177\u6709<code>role1</code>, <code>role1</code>\u5177\u6709<code>role2</code>\uff0c\u5219 <code>alice</code> \u4e5f\u5c06\u62e5\u6709 <code>role2</code> \u5e76\u7ee7\u627f\u5176\u6743\u9650\u3002 RBAC2 \u652f\u6301\u4e92\u65a5\u5904\u7406(\u793a\u4f8b)\uff0c\u4f46quantitative \u9650\u5236\u4e0d\u652f\u6301 RBAC2 \u5728RBAC0 \u7684\u57fa\u7840\u4e0a\u6dfb\u52a0\u4e86\u7ea6\u675f\u3002\u56e0\u6b64\uff0cRBAC2\u53ef\u4ee5\u5904\u7406\u653f\u7b56\u4e2d\u76f8\u4e92\u6392\u65a5\u7684\u95ee\u9898\u3002 RBAC3 \u652f\u6301\u4e92\u65a5\u5904\u7406(\u793a\u4f8b)\uff0c\u4f46quantitative \u9650\u5236\u4e0d\u652f\u6301 RBAC3 \u662f RBAC1 \u548c RBAC2 \u7684\u7ec4\u5408\u3002 RBAC3 \u652f\u6301 RBAC1 \u548c RBAC2 \u4e2d\u7684\u89d2\u8272\u7b49\u7ea7\u548c\u5236\u7ea6\u56e0\u7d20\u3002"},{"location":"web/authorization.html#abac_1","title":"ABAC \u7684\u652f\u6301\u8bf4\u660e","text":"<p>https://casbin.org/zh/docs/abac</p>"},{"location":"web/authorization.html#_11","title":"\u4f7f\u7528","text":"<p>\u89c1 Casbin SpringBoot \u4f7f\u7528\u3002</p> <ul> <li>Go \u7684\u652f\u6301\u5ea6\u6700\u597d\uff0cJava \u6b21\u4e4b\u3002</li> </ul>"},{"location":"web/authorization.html#_12","title":"\u6267\u884c\u5668","text":"<p>Enforce \u52a0\u8f7d\u65f6\uff0c\u4f1a\u5c06\u6240\u6709\u7684\u6570\u636e\u90fd\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff08<code>loadPolicy</code>\uff09\u3002</p> <p>\u7c7b\u578b\uff08\u4ee5Go\u8bed\u8a00\u4e3a\u4e3b\uff0cJava \u65e0 CachedEnforcer\uff09\uff1a</p> <ul> <li>Enforce\uff1a\u975e\u7ebf\u7a0b\u5b89\u5168\uff0c\u5bf9\u4e8e\u7b56\u7565\u7684\u6539\u52a8\uff0c\u4f1a\u89e6\u53d1<code>Watch</code>/<code>WatchEx</code>\uff1b</li> <li>CachedEnforcer\uff1a\u5c06\u7ed3\u679c\u7f13\u5b58\uff08\u901a\u8fc7rw\u9501\u4fdd\u8bc1\u5e76\u53d1\u5b89\u5168\uff09\uff0c\u5185\u90e8\u4f7f\u7528<code>Enforce</code>\uff09\uff08\u56e0\u6b64\u4ecd\u4e0d\u662f\u5e76\u53d1\u5b89\u5168\uff09\uff1b</li> <li>SyncedEnforcer\uff1a\u4f7f\u7528 rw \u9501\u63d0\u4f9b\u540c\u6b65\u8bbf\u95ee\uff0c\u7ebf\u7a0b\u5b89\u5168\uff1b</li> <li>DistributedEnforcer\uff1a\u57fa\u4e8e<code>SyncedEnforcer</code>\uff1b</li> </ul>"},{"location":"web/authorization.html#_13","title":"\u9002\u914d\u5668","text":"<p>\u81ea\u52a8\u4fdd\u5b58\u673a\u5236\uff08<code>Auto-Save</code>\uff09\uff0c\u652f\u6301\u81ea\u52a8\u5411\u5b58\u50a8\u56de\u5199\u5185\u5b58\u4e2d\u5355\u4e2apolicy\u89c4\u5219\u7684\u53d8\u66f4\uff08\u5220\u9664/\u66f4\u65b0\uff09</p> <p>\u8c03\u7528<code>SavePolicy()</code>\u4f1a\u76f4\u63a5\u5220\u9664\u6240\u6709\u5b58\u50a8\u4e2d\u7684policy\u89c4\u5219\u5e76\u5c06\u5f53\u524d<code>Casbin enforcer</code>\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\u7684policy\u89c4\u5219\u6089\u6570\u6301\u4e45\u5316\u5230\u5b58\u50a8\u4e2d\u3002 \u56e0\u6b64\uff0c\u5f53\u5185\u5b58\u4e2d\u7684policy\u89c4\u5219\u8fc7\u591a\u65f6\uff0c\u76f4\u63a5\u8c03\u7528<code>SavePolicy()</code>\u4f1a\u5f15\u8d77\u4e00\u4e9b\u6027\u80fd\u95ee\u9898\u3002</p>"},{"location":"web/authorization.html#_14","title":"\u76d1\u89c6\u5668","text":"<p>https://casbin.org/zh/docs/watchers</p> <p>\u4fdd\u6301\u591a\u4e2aCasbin\u6267\u884c\u5668\u5b9e\u4f8b\u4e4b\u95f4\u7684\u4e00\u81f4\u6027</p> <ul> <li>Java \u7684 RedisWatch \u901a\u8fc7<code>loadPolicy</code>\u91cd\u65b0\u6784\u9020\u5185\u5b58\u4fdd\u8bc1\u4e00\u81f4\u6027\uff08Redis\u4ec5\u7528\u4e8e\u53d1\u9001\u66f4\u65b0\u6d88\u606f\uff09\uff0c\u5bf9\u4e8e\u5927\u91cfRules\u53ef\u80fd\u5b58\u5728\u6027\u80fd\u95ee\u9898\uff1b</li> </ul> <p>WatcherEx\uff1a\u652f\u6301\u591a\u4e2a\u5b9e\u4f8b\u4e4b\u95f4\u7684\u589e\u91cf\u540c\u6b65\uff0c\u4f46\u76ee\u524d\u5c1a\u672a\u5b9e\u73b0 <code>WatcherEx</code>\u3002 </p> <ul> <li>Go \u7684 RedisWatchEx \u652f\u6301\u589e\u91cf\u540c\u6b65\uff0cRedis\u7684\u6d88\u606f\u63d0\u4f9b\u4e0d\u540c\u7c7b\u578b\u7684\u4e8b\u4ef6\uff1b</li> <li>\u5bf9\u4e8e Java \u800c\u8a00\uff0c\u6682\u65f6\u6ca1\u6709\u7b2c\u4e09\u65b9\u5e93\u5b9e\u73b0 <code>WatcherEx</code>\uff0c\u4e14\u9700\u8981\u914d\u5408DistributedEnforcer\uff08\u63d0\u4f9bSelf\u76f8\u5173\u65b9\u6cd5\uff0c\u66f4\u65b0\u7b56\u7565\u4e0d\u4f1a\u5faa\u73af\u89e6\u53d1Watch\uff09\uff1b</li> <li>\u4e0d\u63a8\u8350\u4f7f\u7528 WatchEx\uff0c\u56e0\u4e3a\u5f53\u670d\u52a1\u5f02\u5e38\u65f6\u6ca1\u6cd5\u4fdd\u8bc1\u4e00\u81f4\u6027\uff0c\u63a8\u8350\u4f7f\u7528 Dispatcher \u5b9e\u73b0\uff1b</li> </ul>"},{"location":"web/authorization.html#_15","title":"\u5206\u53d1\u5668","text":"<p>Users need to ensure that the state of all instances is consistent before using dispatcher.</p> <p>\u63d0\u4f9b\u540c\u6b65\u9012\u589e\u7b56\u7565\u53d8\u5316\u7684\u65b9\u6cd5\uff0c\u4ee5<code>raft</code>\u4e00\u81f4\u6027\u534f\u8bae\u4e3a\u57fa\u7840\u4fdd\u8bc1\u591a\u4e2acasbin\u5b9e\u4f8b\u95f4\u7684\u4e00\u81f4\u6027\u3002</p> <p>\u5f53\u524d\u53ea\u6709 Go \u8bed\u8a00\u63d0\u4f9b Hashicorp Raft Dispatcher\u3002</p> <p></p>"},{"location":"web/authorization.html#casdoor","title":"Casdoor","text":"<p>An open-source Identity and Access Management (IAM) / Single-Sign-On (SSO) platform with web UI supporting OAuth 2.0, OIDC, SAML and CAS.</p> <p>\u652f\u6301 OAuth 2.0\u3001OIDC \u548c SAML \u7684 UI \u4f18\u5148\u96c6\u4e2d\u5f0f\u8eab\u4efd\u9a8c\u8bc1/\u5355\u70b9\u767b\u5f55 (SSO) \u5e73\u53f0\uff0c\u4e0e Casbin RBAC \u548c ABAC \u6743\u9650\u7ba1\u7406\u96c6\u6210</p> <ul> <li>\u5bf9\u5b50\u5e94\u7528\u7684\u9274\u6743\uff0c\u901a\u8fc7<code>/api/enforce</code>\uff0c\u4e0d\u80fd\u83b7\u53d6\u6240\u6709\u7684\u6743\u9650id\uff0c\u4f9b\u524d\u7aef\u8fdb\u884c\u83dc\u5355/\u6309\u94ae\u663e\u793a\uff1b</li> </ul>"},{"location":"web/cdn.html","title":"CDN","text":"<p>varnish \u662fHTTP\u52a0\u901f\u5668\uff0c\u4e3b\u8981\u7528CDN\u7f13\u5b58\u52a0\u901f\u3002 </p> <p>varnish \u6bd4 squid\u901f\u5ea6\u6700\u5c11\u8981\u5feb4\u500d\uff0c\u800c\u4e14\u5360\u7528\u670d\u52a1\u5668\u8d44\u6e90\u5c11\u3002</p> <p>Nginx \u4e3b\u8981\u7528\u4e8eWeb\u670d\u52a1\u5668\u548c\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\u3002</p>"},{"location":"web/security.html","title":"\u5b89\u5168","text":""},{"location":"web/security.html#_2","title":"\u4fe1\u606f\u5b89\u5168","text":""},{"location":"web/security.html#sql","title":"SQL\u6ce8\u5165","text":"<ul> <li>SQL \u62fc\u63a5\uff1b</li> </ul>"},{"location":"web/security.html#xss","title":"XSS","text":"<p>Cross-Site Scripting\uff1a\u8de8\u7ad9\u811a\u672c\u653b\u51fb\uff0c\u5728HTML\u9875\u9762\u4e2d\u6ce8\u5165\u6076\u610f\u4ee3\u7801\u3002</p> <ul> <li>\u53cd\u5c04\u578b\uff1a\u8bf1\u5bfc\u7528\u6237\u8bbf\u95ee\u4e00\u4e2a\u7cbe\u5fc3\u8bbe\u8ba1\u7684URL\uff08\u6076\u610f\u94fe\u63a5\uff09\uff1b</li> <li>\u5b58\u50a8\u578b\uff1a\u653b\u51fb\u811a\u672c\u5c06\u88ab\u6c38\u4e45\u5730\u5b58\u653e\u5728\u76ee\u6807\u670d\u52a1\u5668\u7aef\uff0c\u5982\u53d1\u5e16\u65f6\u7684\u5185\u5bb9\uff1b</li> <li>DOM\u578b\uff1a\u6076\u610f\u811a\u672c\u4fee\u6539\u9875\u9762\u7684DOM\u8282\u70b9</li> </ul>"},{"location":"web/security.html#csrf","title":"CSRF","text":"<p>CSRF\uff08Cross-site request forgery\uff09\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020\uff1a\u653b\u51fb\u8005\u8bf1\u5bfc\u53d7\u5bb3\u8005\u8fdb\u5165\u7b2c\u4e09\u65b9\u7f51\u7ad9\uff0c\u5728\u7b2c\u4e09\u65b9\u7f51\u7ad9\u4e2d\uff0c\u5411\u88ab\u653b\u51fb\u7f51\u7ad9\u53d1\u9001\u8de8\u7ad9\u8bf7\u6c42\u3002\u5229\u7528\u53d7\u5bb3\u8005\u5728\u88ab\u653b\u51fb\u7f51\u7ad9\u5df2\u7ecf\u83b7\u53d6\u7684\u6ce8\u518c\u51ed\u8bc1\uff0c\u7ed5\u8fc7\u540e\u53f0\u7684\u7528\u6237\u9a8c\u8bc1\uff0c\u8fbe\u5230\u5192\u5145\u7528\u6237\u5bf9\u88ab\u653b\u51fb\u7684\u7f51\u7ad9\u6267\u884c\u67d0\u9879\u64cd\u4f5c\u7684\u76ee\u7684\u3002</p> <p>CSRF\u7684\u4e24\u4e2a\u7279\u70b9\uff1a</p> <ul> <li>CSRF\uff08\u901a\u5e38\uff09\u53d1\u751f\u5728\u7b2c\u4e09\u65b9\u57df\u540d\u3002</li> <li>CSRF\u653b\u51fb\u8005\u4e0d\u80fd\u83b7\u53d6\u5230Cookie\u7b49\u4fe1\u606f\uff0c\u53ea\u662f\u4f7f\u7528\u3002</li> </ul> <p>\u9488\u5bf9\u8fd9\u4e24\u70b9\uff0c\u53ef\u4ee5\u4e13\u95e8\u5236\u5b9a\u9632\u62a4\u7b56\u7565\uff0c\u5982\u4e0b\uff1a</p> <ul> <li> <p>\u963b\u6b62\u4e0d\u660e\u5916\u57df\u7684\u8bbf\u95ee</p> </li> <li> <p>\u540c\u6e90\u68c0\u6d4b\uff1a</p> <ul> <li>Origin Header\uff1aIE11\u540c\u6e90\u7b56\u7565\u548c302\u91cd\u5b9a\u5411\u4e0d\u4f1a\u5b58\u5728Origin Header\uff1b</li> <li>Referer Header\uff1a\u5b89\u5168\u6027\u4f9d\u8d56\u4e8e\u6d4f\u89c8\u5668\uff1b\u4e14\u53ef\u80fd\u4f1a\u4e0d\u5b58\u5728</li> <li>\u4e24\u8005\u90fd\u4e0d\u5168\u5907\uff0c\u53ef\u80fd\u4e22\u5931\u3002</li> </ul> </li> <li> <p>Samesite Cookie\uff1a\u4e3aSet-Cookie\u54cd\u5e94\u5934\u65b0\u589eSamesite\u5c5e\u6027</p> <ul> <li>Strict\uff1a\u4e25\u683c\u6a21\u5f0f\uff0c\u8868\u660e\u8fd9\u4e2a Cookie \u5728\u4efb\u4f55\u60c5\u51b5\u4e0b\u90fd\u4e0d\u53ef\u80fd\u4f5c\u4e3a\u7b2c\u4e09\u65b9 Cookie\uff1b</li> <li>Lax\uff1a\u5bbd\u677e\u6a21\u5f0f\uff0c\u5047\u5982\u8fd9\u4e2a\u8bf7\u6c42\u662f\u8fd9\u79cd\u8bf7\u6c42\uff08\u6539\u53d8\u4e86\u5f53\u524d\u9875\u9762\u6216\u8005\u6253\u5f00\u4e86\u65b0\u9875\u9762\uff09\u4e14\u540c\u65f6\u662f\u4e2aGET\u8bf7\u6c42\uff0c\u5219\u8fd9\u4e2aCookie\u53ef\u4ee5\u4f5c\u4e3a\u7b2c\u4e09\u65b9Cookie\u3002</li> <li>\u95ee\u9898\uff1a\u5b50\u57df\u540d\u4e4b\u95f4\u7684\u5355\u70b9\u767b\u5f55\u95ee\u9898\uff1f\u517c\u5bb9\u6027\u76ee\u524d\u662f\u95ee\u9898</li> </ul> </li> <li> <p>\u63d0\u4ea4\u65f6\u8981\u6c42\u9644\u52a0\u672c\u57df\u624d\u80fd\u83b7\u53d6\u7684\u4fe1\u606f</p> </li> <li> <p>\u53cc\u91cdCookie\u9a8c\u8bc1</p> <ul> <li>\u767b\u9646\u65f6\u5411\u8bf7\u6c42\u57df\u540d\u6ce8\u518ccookie\uff0c\u53d1\u8d77\u8bf7\u6c42\u65f6\uff0c\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\uff0c\u540e\u7aef\u6821\u9a8ccookie\u548curl\u4e2d\u662f\u5426\u4e00\u81f4\uff1b</li> <li>\u95ee\u9898\uff1a\u4efb\u4f55\u8de8\u57df\u90fd\u4f1a\u5bfc\u81f4\u524d\u7aef\u65e0\u6cd5\u83b7\u53d6Cookie\u4e2d\u7684\u5b57\u6bb5\uff08\u5305\u62ec\u5b50\u57df\u540d\u4e4b\u95f4\uff09\uff0c\u6240\u4ee5cookie\u8981\u8bbe\u7f6e\u518d\u6839\u57df\u540d\u4e0b\uff0c\u6240\u6709\u5b50\u57df\u540d\u90fd\u53ef\u4ee5\u53bb\u4fee\u6539\u8be5cookie\uff0c\u5bfc\u81f4XSS+CSRF\u653b\u51fb\uff1b</li> <li>cookie\u8bbe\u7f6e\u6210httponly\u9632\u6b62XSS\u653b\u51fb\uff1f</li> </ul> </li> <li> <p>CSRF Token</p> <ul> <li> <p>\u767b\u9646\u65f6\uff0c\u8fd4\u56decsrftoken\uff0c\u540e\u7eed\u8bf7\u6c42\u90fd\u9700\u8981\u4f20\u5165\u8be5token\u5728Header\u4e2d\uff1b</p> </li> <li> <p>\u5206\u5e03\u5f0f\u4e0b\uff0ctoken\u4e0d\u5b58\u5728session\u4e2d\uff0c\u91c7\u7528Encrypted Token Pattern\uff0c\u901a\u8fc7UserID\uff0c\u65f6\u95f4\u6233\u548c\u968f\u673a\u6570\uff0c\u901a\u8fc7\u52a0\u5bc6\u7684\u65b9\u5f0f\u751f\u6210\uff0c\u4fdd\u8bc1\u552f\u4e00\u548c\u5b89\u5168\u6027\uff1b</p> </li> </ul> </li> </ul> <p>Cookie: http-only</p> <p>HttpOnly\u662f\u5305\u542b\u5728Set-Cookie HTTP\u54cd\u5e94\u5934\u6587\u4ef6\u4e2d\u7684\u9644\u52a0\u6807\u5fd7\uff0c\u82e5\u67d0\u4e00\u4e2aCookie \u9009\u9879\u88ab\u8bbe\u7f6e\u6210 HttpOnly = true \u7684\u8bdd\uff0c\u90a3\u6b64Cookie \u53ea\u80fd\u901a\u8fc7\u670d\u52a1\u5668\u7aef\u4fee\u6539\uff0cJS\u662f\u64cd\u4f5c\u4e0d\u4e86\u7684\uff0c\u5bf9\u4e8e document.cookie \u6765\u8bf4\u662f\u900f\u660e\u7684\u3002</p> <p>\u8de8\u57df\u62e6\u622a\u662f\u524d\u7aef\u8bf7\u6c42\u5df2\u7ecf\u53d1\u51fa\uff0c\u5e76\u4e14\u5728\u540e\u7aef\u8fd4\u56de\u54cd\u5e94\u65f6\u68c0\u67e5\u76f8\u5173\u53c2\u6570\uff0c\u662f\u5426\u5141\u8bb8\u63a5\u6536\u540e\u7aef\u8bf7\u6c42\u3002</p> <p>\u901a\u8fc7CORS\uff08\u8de8\u57df\u8d44\u6e90\u5171\u4eab\uff09\u6807\u51c6\u548ctoken\u6765\u89e3\u51b3\u8d44\u6e90\u5171\u4eab\u548c\u5b89\u5168\u95ee\u9898\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6eb.com\u7684\u54cd\u5e94\u9996\u90e8\u5b57\u6bb5\u4e3a\uff1a</p> <p>Access-Control-Allow-Origin: http://a.com</p> <p>Access-Control-Allow-Headers: Authorization, X-Requested-With, Content-Type, Accept</p> <p>Access-Control-Allow-Methods: GET, POST, PUT,DELETE</p> <p>\u7b2c\u4e00\u884c\u6307\u5b9a\u4e86\u5141\u8bb8\u8bbf\u95ee\u8be5\u8d44\u6e90\u7684\u5916\u57df URI</p> <p>\u7b2c\u4e8c\u884c\u6307\u660e\u4e86\u5b9e\u9645\u8bf7\u6c42\u4e2d\u5141\u8bb8\u643a\u5e26\u7684\u9996\u90e8\u5b57\u6bb5\uff0c\u8fd9\u91cc\u52a0\u5165\u4e86Authorization\uff0c\u7528\u6765\u5b58\u653etoken</p> <p>\u7b2c\u4e09\u884c\u7528\u4e8e\u9884\u68c0\u8bf7\u6c42\u7684\u54cd\u5e94\u3002\u5176\u6307\u660e\u4e86\u5b9e\u9645\u8bf7\u6c42\u6240\u5141\u8bb8\u4f7f\u7528\u7684 HTTP \u65b9\u6cd5\u3002</p> <p>\u7136\u540e\u7528\u6237\u4ecea.com\u643a\u5e26\u6709\u4e00\u4e2a\u901a\u8fc7\u4e86\u9a8c\u8bc1\u7684token\u8bbf\u95eeB\u57df\u540d\uff0c\u6570\u636e\u548c\u8d44\u6e90\u5c31\u80fd\u591f\u5728\u4efb\u4f55\u57df\u4e0a\u88ab\u8bf7\u6c42\u5230\u3002 </p>"},{"location":"web/security.html#https","title":"HTTPS","text":"<ul> <li>HTTP + Secure Socket Layer(SSL) \u6216 Transport Layer Security\uff0c\u5728\u4f20\u8f93\u5c42\u5bf9\u7f51\u7edc\u8fde\u63a5\u8fdb\u884c\u52a0\u5bc6\uff1b</li> <li>SSL\u4f7f\u7528\u8bc1\u4e66\u6765\u521b\u5efa\u5b89\u5168\u8fde\u63a5\uff1b</li> </ul>"},{"location":"web/security.html#_3","title":"\u52a0\u5bc6\u89e3\u5bc6","text":"<ul> <li>\u5bf9\u79f0\u52a0\u5bc6\uff1a\u52a0\u5bc6\u548c\u89e3\u5bc6\u5bc6\u94a5\u76f8\u540c\uff0c\u5982DES\u548cAES\uff1b\u5bc6\u94a5\u7684\u5b89\u5168\u6027\u5f88\u91cd\u8981\uff1b</li> <li>\u975e\u5bf9\u79f0\u52a0\u5bc6\uff1a\u516c\u94a5\u548c\u79c1\u94a5\uff0c\u53ea\u80fd\u4e92\u76f8\u52a0\u5bc6\u3001\u89e3\u5bc6\uff1b\u5982RSA</li> </ul>"},{"location":"web/security.html#aesadvanced-encryption-standard","title":"AES(Advanced Encryption Standard)","text":"<ul> <li> <p>\u5206\u7ec4\u52a0\u5bc6\u6807\u51c6\uff0c\u6bcf\u4e2a\u52a0\u5bc6\u5757\u5927\u5c0f\u4e3a128\u4f4d\uff0c\u5141\u8bb8\u7684\u5bc6\u94a5\u957f\u5ea6\u4e3a128\u3001192\u548c256\u4f4d\uff1b</p> </li> <li> <p>ECB\uff1a\u7535\u5b50\u5bc6\u7801\u672c\u6a21\u5f0f\uff1aElectronic codebook</p> </li> <li> <p>\u6bcf\u5757\u6570\u636e\u7684\u52a0\u5bc6\u72ec\u7acb\uff0c\u56e0\u6b64\u52a0\u5bc6\u548c\u89e3\u5bc6\u90fd\u53ef\u4ee5\u5e76\u884c\u8ba1\u7b97\uff0c\u6700\u5927\u7684\u7f3a\u70b9\u662f\u76f8\u540c\u7684\u660e\u6587\u5757\u4f1a\u88ab\u52a0\u5bc6\u6210\u76f8\u540c\u7684\u5bc6\u6587\u5757\uff0c\u5728\u67d0\u4e9b\u73af\u5883\u4e0d\u80fd\u63d0\u4f9b\u4e25\u683c\u7684\u6570\u636e\u4fdd\u5bc6\u6027\uff1b</p> </li> <li> <p>CBC\u6a21\u5f0f\uff1a\u5bc6\u7801\u5206\u7ec4\u94fe\u63a5\uff1aCipher-block     chaining</p> </li> <li> <p>\u6bcf\u4e2a\u5f85\u52a0\u5bc6\u7684\u5bc6\u7801\u5757\u5728\u52a0\u5bc6\u524d\u4f1a\u5148\u4e0e\u524d\u4e00\u4e2a\u5bc6\u7801\u5757\u7684\u5bc6\u6587\u5f02\u6216\u7136\u540e\u518d\u7528\u52a0\u5bc6\u5668\u52a0\u5bc6\uff0c\u7b2c\u4e00\u4e2a\u660e\u6587\u5757\u4e0e\u4e00\u4e2a\u53eb\u521d\u59cb\u5316\u5411\u91cf\u7684\u6570\u636e\u5757\u5f02\u6216\uff1b</p> </li> <li> <p>CFB\u6a21\u5f0f\uff1a\u5bc6\u6587\u53cd\u9988:Cipher feedback</p> </li> <li> <p>\u5757\u5bc6\u6587\uff08Block Cipher\uff09\u8f6c\u6362\u4e3a\u6d41\u5bc6\u6587\uff08Stream Cipher\uff09\uff0c\u9002\u5408\u5bf9\u6d41\u6570\u636e\u8fdb\u884c\u52a0\u5bc6\uff0c\u89e3\u5bc6\u53ef\u4ee5\u5e76\u884c\u8ba1\u7b97</p> </li> <li> <p>OFB\u6a21\u5f0f\uff08\u8f93\u51fa\u53cd\u9988\uff1aOutput feedback\uff09</p> </li> <li>\u5757\u52a0\u5bc6\u5668\u751f\u6210\u5bc6\u94a5\u6d41\uff08Keystream\uff09\uff0c\u7136\u540e\u518d\u5c06\u5bc6\u94a5\u6d41\u4e0e\u660e\u6587\u6d41\u5f02\u6216\u5f97\u5230\u5bc6\u6587\u6d41\uff0c\u89e3\u5bc6\u662f\u5148\u7528\u5757\u52a0\u5bc6\u5668\u751f\u6210\u5bc6\u94a5\u6d41\uff0c\u518d\u5c06\u5bc6\u94a5\u6d41\u4e0e\u5bc6\u6587\u6d41\u5f02\u6216\u5f97\u5230\u660e\u6587\uff1b</li> <li>\u52a0\u5bc6\u548c\u89e3\u5bc6\u90fd\u4e0d\u80fd\u5e76\u884c</li> </ul>"},{"location":"web/security.html#rsa","title":"RSA\u7b97\u6cd5","text":"<p>\u4f7f\u7528\u4e0d\u540c\u7684\u52a0\u5bc6\u5bc6\u94a5\u4e0e\u89e3\u5bc6\u5bc6\u94a5\uff0c\u201c\u7531\u5df2\u77e5\u52a0\u5bc6\u5bc6\u94a5\u63a8\u5bfc\u51fa\u89e3\u5bc6\u5bc6\u94a5\u5728\u8ba1\u7b97\u4e0a\u662f\u4e0d\u53ef\u884c\u7684\u201d\u5bc6\u7801\u4f53\u5236\u3002</p> <p>\u52a0\u5bc6\u7b97\u6cd5E\u548c\u89e3\u5bc6\u7b97\u6cd5D\u4e5f\u90fd\u662f\u516c\u5f00\u7684\u3002\u867d\u7136\u89e3\u5bc6\u5bc6\u94a5SK\u662f\u7531\u516c\u5f00\u5bc6\u94a5PK\u51b3\u5b9a\u7684\uff0c\u4f46\u5374\u4e0d\u80fd\u6839\u636ePK\u8ba1\u7b97\u51faSK\u3002</p> <p>\u539f\u7406\uff1a\u6839\u636e\u6570\u8bba\uff0c\u5bfb\u6c42\u4e24\u4e2a\u5927\u7d20\u6570\u6bd4\u8f83\u7b80\u5355\uff0c\u800c\u5c06\u5b83\u4eec\u7684\u4e58\u79ef\u8fdb\u884c\u56e0\u5f0f\u5206\u89e3\u5374\u6781\u5176\u56f0\u96be\uff0c\u56e0\u6b64\u53ef\u4ee5\u5c06\u4e58\u79ef\u516c\u5f00\u4f5c\u4e3a\u52a0\u5bc6\u5bc6\u94a5\u3002</p> <p>\u6b65\u9aa4\uff1a</p> <ol> <li>\u4efb\u610f\u9009\u53d6\u4e24\u4e2a\u4e0d\u540c\u7684\u5927\u7d20\u6570p\u548cq\u8ba1\u7b97\u4e58\u79ef\\(n=pq\\), \\(\\phi(n)=(p-1)(q-1)\\)\uff1b</li> <li>\u4efb\u610f\u9009\u53d6\u4e00\u4e2a\u5927\u6574\u6570e\uff0c\u6ee1\u8db3\\(gcd(e,\\phi(n)) = 1\\)\uff0c\u6574\u6570e\u4f5c\u4e3a\u52a0\u5bc6\u5bc6\u94a5\uff1b</li> <li>\u786e\u5b9a\u89e3\u5bc6\u5bc6\u94a5d\uff0c\u6ee1\u8db3$ (de) mod \\phi(n) =1\\(\uff0c\u5373\\)de=k\\phi(n)+1,k&gt;=1\\(\uff0c\u6839\u636e\\)e\\(\u548c\\)\\phi(n)$\u5f88\u5bb9\u6613\u8ba1\u7b97\u51fad\uff1b</li> <li>\u516c\u5f00\u6574\u6570n\u548ce\uff0c\u79d8\u5bc6\u4fdd\u5b58d\uff1b</li> <li>\u5c06\u660e\u6587m\uff08m&lt;n\u662f\u4e00\u4e2a\u6574\u6570\uff09\u52a0\u5bc6\u6210\u5bc6\u6587c\uff0c\u52a0\u5bc6\u7b97\u6cd5\u4e3a\\(c=E(m)=m^e mod n\\)</li> <li>\u89e3\u5bc6\u5bc6\u6587c\uff0c\u7b97\u6cd5\u4e3a\\(m=D(c)=c^d mod n\\)</li> </ol> <p>\u6ce8\uff1a\u53ea\u6839\u636en\u548ce\uff08\u6ce8\u610f\uff1a\u4e0d\u662fp\u548cq\uff09\u8981\u8ba1\u7b97\u51fad\u662f\u4e0d\u53ef\u80fd\u7684</p> <p>RSA\u7b97\u6cd5\u672c\u8eab\u8981\u6c42\u52a0\u5bc6\u5185\u5bb9\u4e5f\u5c31\u662f\u660e\u6587\u957f\u5ea6m\u5fc5\u987b0&lt;m&lt;\u5bc6\u94a5\u957f\u5ea6n:</p> <ul> <li>\u5982\u679c\u5c0f\u4e8e\u8fd9\u4e2a\u957f\u5ea6\u5c31\u9700\u8981\u8fdb\u884cpadding\uff0c\u56e0\u4e3a\u5982\u679c\u6ca1\u6709padding\uff0c\u5c31\u65e0\u6cd5\u786e\u5b9a\u89e3\u5bc6\u540e\u5185\u5bb9\u7684\u771f\u5b9e\u957f\u5ea6\uff1b</li> <li>\u5982\u679c\u8981\u5bf9\u4efb\u610f\u957f\u5ea6\u7684\u6570\u636e\u8fdb\u884c\u52a0\u5bc6\uff0c\u5c31\u9700\u8981\u5c06\u6570\u636e\u5206\u6bb5\u540e\u8fdb\u884c\u9010\u4e00\u52a0\u5bc6\uff0c\u5e76\u5c06\u7ed3\u679c\u8fdb\u884c\u62fc\u63a5\u3002</li> </ul>"},{"location":"web/security.html#hash","title":"\u6458\u8981\uff08\u6563\u5217\uff0cHash\uff09\u7b97\u6cd5","text":"<ul> <li>\u4e0d\u540c\u5185\u5bb9\u7684\u6563\u5217\u503c\uff0c\u76f8\u540c\u7684\u6982\u7387\u6781\u4f4e\uff1b\u76f8\u540c\u5185\u5bb9\u7684\u6563\u5217\u503c\u4e00\u5b9a\u4e00\u6837\uff1b</li> <li>MD5\uff0cSHA-1</li> </ul>"},{"location":"web/security.html#_4","title":"\u6570\u5b57\u7b7e\u540d","text":"<ul> <li>\u57fa\u4e8e\u975e\u5bf9\u79f0\u52a0\u5bc6\uff0c\u4f7f\u7528\u79c1\u94a5\u8fdb\u884c\u52a0\u5bc6\uff1b</li> <li>\u52a0\u5bc6\u901f\u5ea6\u6162\uff0c\u4f7f\u7528\u6458\u8981\u7b97\u6cd5\u548c\u975e\u5bf9\u79f0\u7b97\u6cd5\u7ed3\u5408\uff08\u6570\u5b57\u7b7e\u540d\uff09\u6216\u5bf9\u79f0\u52a0\u5bc6\u4e0e\u975e\u5bf9\u79f0\u52a0\u5bc6\u7ed3\u5408\uff08\u52a0\u5bc6\u4f20\u8f93\u6587\u4ef6\uff0c\u5bf9\u5bf9\u79f0\u5bc6\u94a5\u52a0\u5bc6\uff09\u529e\u6cd5\uff1b</li> <li>\u660e\u6587+\u5bc6\u6587\uff0c\u5185\u5bb9\u88ab\u7a83\u53d6\u4e0d\u91cd\u8981\uff0c\u76ee\u7684\u662f\u9a8c\u8bc1\u660e\u6587\u7684\u6709\u6548\u6b63\u786e\uff1b</li> </ul>"},{"location":"web/security.html#_5","title":"\u6570\u5b57\u8bc1\u4e66","text":"<p>\u89e3\u51b3\u4fe1\u4efb\u7684\u95ee\u9898\uff0c\u9632\u6b62\u4e2d\u95f4\u4eba\u653b\u51fb\u3002</p> <ul> <li>\u6570\u5b57\u8bc1\u4e66\u662f\u7531\u4e00\u4e2a\u6743\u5a01\u673a\u6784\u53d1\u884c\u7684\uff0c\u81f3\u5c11\u5305\u542b\u4e00\u4e2a\u516c\u5f00\u5bc6\u94a5\u3001\u8bc1\u4e66\u6301\u6709\u4eba\uff08\u6216\u5355\u4f4d\uff09\u7684\u540d\u79f0\u4ee5\u53ca\u8bc1\u4e66\u6388\u6743\u4e2d\u5fc3\u5bf9\u8fd9\u4e9b\u4fe1\u606f\u7684\u6570\u5b57\u7b7e\u540d\u7684\u6587\u4ef6\uff1b</li> <li>pfx\u8bc1\u4e66\u6587\u4ef6\u662f\u5e26\u516c\u94a5\u548c\u79c1\u94a5\uff0c\u800ccer\u6587\u4ef6\u53ea\u5e26\u516c\u94a5\uff1b</li> <li>jks\uff08Java Key Store\uff09\uff0cjdk/bin/keytool.exe\u8fdb\u884c\u67e5\u770b\u3001\u5bfc\u5165\u3001\u5bfc\u51fa\u3001\u5220\u9664\uff1b</li> <li>key\u901a\u5e38\u6307\u79c1\u94a5\uff1bCSR\u8bc1\u4e66\u7b7e\u540d\u8bf7\u6c42\uff0c\u7b80\u5355\u7406\u89e3\u6210\u516c\u94a5\uff1bCRT\uff0cCER\uff0c\u8bc1\u4e66\uff0c\u7f16\u7801\u53ef\u4ee5\u662f\uff08PEM\u683c\u5f0f\u53ef\u8bfb\uff0cDER\u683c\u5f0f\u4e8c\u8fdb\u5236\u4e0d\u53ef\u8bfb\uff09\uff1b</li> <li>pem\u6587\u4ef6\u4e00\u822c\u662f\u6587\u672c\u683c\u5f0f\u7684\uff0c\u53ef\u4ee5\u653e\u8bc1\u4e66\u6216\u8005\u79c1\u94a5\uff0c\u6216\u8005\u4e24\u8005\u90fd\u6709\uff1bpem\u5982\u679c\u53ea\u542b\u79c1\u94a5\u7684\u8bdd\uff0c\u4e00\u822c\u7528.key\u6269\u5c55\u540d\uff0c\u800c\u4e14\u53ef\u4ee5\u6709\u5bc6\u7801\u4fdd\u62a4\uff1b</li> <li>\u6700\u9876\u5c42\u7684\u6743\u5a01\u5b89\u5168\u7684\u53eb\u6839\u8bc1\u4e66\uff1b</li> </ul>"},{"location":"web/security.html#_6","title":"\u81ea\u7b7e\u540d\u7684\u8bc1\u4e66","text":"<ul> <li>\u4f7f\u7528\u8bc1\u4e66\u751f\u6210\u5de5\u5177\u5982OpenSSL\uff0cjdk\u7684keytool\u4e3a\u81ea\u5df1\u7684https\u7ad9\u70b9\u751f\u6210\u7684\u8bc1\u4e66\uff1b</li> <li>\u53cc\u5411\u8ba4\u8bc1\uff1a\u670d\u52a1\u7aef\u4fdd\u5b58\u7740\u5ba2\u6237\u7aef\u7684\u8bc1\u4e66\u5e76\u4fe1\u4efb\u8be5\u8bc1\u4e66\uff0c\u5ba2\u6237\u7aef\u4fdd\u5b58\u7740\u670d\u52a1\u7aef\u7684\u8bc1\u4e66\u5e76\u4fe1\u4efb\u8be5\u8bc1\u4e66\uff0c\u5982\u7f51\u4e0a\u94f6\u884c\u3001\u4f01\u4e1a\u5e94\u7528\u5bf9\u63a5\uff1b</li> <li>\u5355\u9879\u8ba4\u8bc1\uff1a\u5ba2\u6237\u7aef\u4fdd\u5b58\u670d\u52a1\u7aef\u7684\u8bc1\u4e66\u5e76\u4fe1\u4efb\u8be5\u8bc1\u4e66\uff1b</li> </ul>"},{"location":"web/streamlint.html","title":"Streamlint","text":"<p>\u4e3b\u8981\u5b9a\u4f4d\u4e8e\u5b9e\u73b0\u673a\u5668\u5b66\u4e60\u548c\u6570\u636e\u79d1\u5b66\u7684web\u5e94\u7528\u7684\u5de5\u5177\u3002</p> <p>Streamlit \u662f\u53ef\u4ee5\u7528\u4e8e\u5feb\u901f\u642d\u5efaWeb\u5e94\u7528\u7684Python\u5e93\u3002</p>"},{"location":"web/streamlint.html#_1","title":"\u7279\u8272","text":"<ul> <li>API\u7b80\u5355\u660e\u4e86\uff0c\u6613\u4e0a\u624b</li> </ul> <p>API\u975e\u5e38\u53cb\u597d\uff0c\u4e8b\u5b9e\u4e0a\u4e00\u5929\u5c31\u80fd\u5b66\u4f1a\u3002</p> <ul> <li>\u65e0\u987b\u5b66\u4e60\u524d\u7aef\u77e5\u8bc6\uff08html\u3001css\u3001javascript\uff09</li> </ul> <p>Streamlit \u57fa\u4e8etornado\u6846\u67b6\uff0c\u5c01\u88c5\u4e86\u5927\u91cf\u4e92\u52a8\u7ec4\u4ef6\uff0c\u540c\u65f6\u4e5f\u652f\u6301\u5927\u91cf\u8868\u683c\u3001\u56fe\u8868\u3001\u6570\u636e\u8868\u7b49\u5bf9\u8c61\u7684\u6e32\u67d3\uff0c\u5e76\u4e14\u652f\u6301\u6805\u683c\u5316\u54cd\u5e94\u5f0f\u5e03\u5c40\u3002</p> <ul> <li>\u652f\u6301markdown\u548chtml\u6587\u672c\u7684\u6e32\u67d3</li> </ul> <p>Streamlit\u7684\u9ed8\u8ba4\u6e32\u67d3\u8bed\u8a00\u5c31\u662fmarkdown\uff1b\u9664\u6b64\u4ee5\u5916\uff0cStreamlit\u4e5f\u652f\u6301html\u6587\u672c\u7684\u6e32\u67d3\uff0c\u8fd9\u610f\u5473\u7740\u4f60\u4e5f\u53ef\u4ee5\u5c06\u4efb\u4f55html\u4ee3\u7801\u5d4c\u5165\u5230streamlit\u5e94\u7528\u91cc</p>"},{"location":"web/streamlint.html#_2","title":"\u4f7f\u7528","text":""},{"location":"web/streamlint.html#_3","title":"\u5feb\u901f\u5f00\u59cb","text":"<pre><code>pip install streamlit\nstreamlint hello\n</code></pre>"},{"location":"web/streamlint.html#my-first-app","title":"My First App","text":"<pre><code>import streamlint as st\nimport pandas as pd\n\nst.write(\"\"\"\n# My first app Hello *world*\n\"\"\")\n\ndf = pd.read_csv(\"my_data.csv\")\nst.line_chart(df)\n</code></pre>"},{"location":"web/action/barrage.html","title":"\u5f39\u5e55\u8bbe\u8ba1","text":""},{"location":"web/action/barrage.html#b","title":"\u89c6\u9891\u7684\u5f39\u5e55\u8bbe\u8ba1\uff08B\u7ad9\uff09","text":""},{"location":"web/action/barrage.html#_2","title":"\u76f4\u64ad\u7684\u5f39\u5e55\u8bbe\u8ba1","text":"<p>\u5982\u4f55\u8bbe\u8ba1\u4e00\u4e2a 70w \u5728\u7ebf\u4eba\u6570\u7684\u5f39\u5e55\u7cfb\u7edf \uff1fCSDN\u535a\u5ba2</p>"},{"location":"web/action/barrage.html#_3","title":"\u9700\u6c42\u5206\u6790","text":"<p>70w \u5728\u7ebf\u4eba\u6570\u7684\u5f39\u5e55\u7cfb\u7edf</p> <p>\u5e26\u5bbd\u538b\u529b</p> <p>\u5047\u5982\u8bf4\u6bcf3\u79d2\u4fc3\u8fbe\u7528\u6237\u4e00\u6b21\uff0c\u90a3\u4e48\u6bcf\u6b21\u5185\u5bb9\u81f3\u5c11\u9700\u8981\u670915\u6761\u624d\u80fd\u505a\u5230\u89c6\u89c9\u65e0\u5361\u987f\u300215\u6761\u5f39\u5e55+http\u5305\u5934\u7684\u5927\u5c0f\u5c06\u8d85\u8fc73k\uff0c\u90a3\u4e48\u6bcf\u79d2\u7684\u6570\u636e\u5927\u5c0f\u7ea6\u4e3a8Gbps\uff0c</p>"},{"location":"web/action/barrage.html#_4","title":"\u5e26\u5bbd\u4f18\u5316","text":"<ul> <li>Http \u538b\u7f29\uff08\u5c0f\u6570\u636e\u7684 Http \u538b\u7f29\u7684\u6027\u4ef7\u6bd4\uff1f\uff09</li> </ul> <p>\u901a\u8fc7\u67e5\u9605\u8d44\u6599\uff0chttp gzip\u538b\u7f29\u6bd4\u7387\u53ef\u4ee5\u8fbe\u523040%\u4ee5\u4e0a\uff08gzip\u6bd4deflate\u8981\u9ad8\u51fa4%~5%\uff09</p> <ul> <li> <p>\u5f39\u5e55\u7684 Response \u7ed3\u6784\u7b80\u5316\uff0c\u964d\u4f4e\u4f20\u8f93\u5b57\u8282\u6570</p> </li> <li> <p>\u5185\u5bb9\u6392\u5217\u987a\u5e8f\u4f18\u5316\uff0c\u5c06\u5b57\u7b26\u4e32\u548c\u6570\u5b57\u5185\u5bb9\u653e\u5728\u4e00\u8d77\u6446\u653e\uff0c\u589e\u52a0\u538b\u7f29\u6bd4\uff1b</p> </li> <li> <p>\u9891\u7387\u63a7\u5236</p> </li> <li> <p>\u5e26\u6b3e\u63a7\u5236\uff1a\u901a\u8fc7\u6dfb\u52a0\u8bf7\u6c42\u95f4\u9694\u53c2\u6570\uff08\u4e0b\u6b21\u8bf7\u6c42\u65f6\u95f4\uff09\uff0c\u4fdd\u8bc1\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u9891\u7387\u670d\u52a1\u7aef\u53ef\u63a7</p> </li> <li>\u901a\u8fc7\u6dfb\u52a0\u8bf7\u6c42\u95f4\u9694\u53c2\u6570\uff08\u4e0b\u6b21\u8bf7\u6c42\u65f6\u95f4\uff09\uff0c\u4fdd\u8bc1\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u9891\u7387\u670d\u52a1\u7aef\u53ef\u63a7</li> </ul>"},{"location":"web/action/barrage.html#_5","title":"\u5f39\u5e55\u5361\u987f\u3001\u4e22\u5931\u5206\u6790","text":"<p>\u6839\u636e\u4e86\u89e3\u817e\u8baf\u4e91\u7684\u5f39\u5e55\u7cfb\u7edf\uff0c\u5728300\u4eba\u4ee5\u4e0b\u4f7f\u7528\u7684\u662f\u63a8\u9001\u6a21\u5f0f\uff0c300\u4eba\u4ee5\u4e0a\u5219\u662f\u91c7\u7528\u7684\u8f6e\u8bad\u6a21\u5f0f\u3002</p> <p>\u4fc3\u8fbe\u673a\u5236\uff0c\u63a8\u9001 vs \u62c9\u53d6</p> <ul> <li>Long Pulling</li> <li>\u51cf\u5c11\u8f6e\u8be2\u6b21\u6570\uff0c\u4f4e\u5ef6\u8fdf\uff0c\u6d4f\u89c8\u5668\u517c\u5bb9\u6027\u8f83\u597d</li> <li>\u670d\u52a1\u5668\u9700\u8981\u4fdd\u6301\u5927\u91cf\u8fde\u63a5</li> <li>WebSocket\uff1a</li> <li>\u8f83\u5c11\u7684\u63a7\u5236\u5f00\u9500\uff08\u76f8\u5bf9\u4e8e HTTP \u8bf7\u6c42\u6bcf\u6b21\u90fd\u8981\u643a\u5e26\u5b8c\u6574\u7684\u5934\u90e8\uff09\uff0c\u66f4\u5f3a\u7684\u5b9e\u65f6\u6027\uff1b</li> <li>\u6bcf\u4e2a\u5ba2\u6237\u7aef\u4f7f\u7528\u4e00\u4e2a\u6301\u4e45\u5316\u7684\u8fde\u63a5</li> </ul> <p>Long Polling \u80fd\u53d1\u73b0\u8fde\u63a5\u5f02\u5e38\u7684\u6700\u77ed\u95f4\u9694\u4e3a\uff1a\\(min(keepalive\\_intvl, polling\\_interval)\\) </p> <p>Websockets\u80fd\u53d1\u73b0\u8fde\u63a5\u5f02\u5e38\u7684\u6700\u77ed\u95f4\u9694\u4e3a\uff1a\\(min(keepalive\\_intvl, client\\_sending\\_interval)\\)</p> <p>\u5f31\u7f51\u60c5\u51b5\u4e0bWebsockets\u5176\u5b9e\u5df2\u7ecf\u4e0d\u80fd\u4f5c\u4e3a\u4e00\u4e2a\u5019\u9009\u9879</p> <ul> <li>\u5373\u4f7fWebsockets\u670d\u52a1\u7aef\u5df2\u7ecf\u53d1\u73b0\u8fde\u63a5\u65ad\u5f00\uff0c\u4ecd\u7136\u6ca1\u6709\u529e\u6cd5\u63a8\u9001\u6570\u636e\uff0c\u53ea\u80fd\u88ab\u52a8\u7b49\u5f85\u5ba2\u6237\u7aef\u91cd\u65b0\u5efa\u7acb\u597d\u8fde\u63a5\u624d\u80fd\u63a8\u9001\uff0c\u5728\u6b64\u4e4b\u524d\u6570\u636e\u5c06\u53ef\u80fd\u4f1a\u88ab\u91c7\u53d6\u4e22\u5f03\u7684\u63aa\u65bd\u5904\u7406\u6389\uff1b\uff08\u6ca1\u6709\u7f13\u5b58/\u5165\u5e93\uff1f\uff09</li> <li>\u5728\u6bcf\u6b21\u65ad\u5f00\u540e\u5747\u9700\u8981\u518d\u6b21\u53d1\u9001\u5e94\u7528\u5c42\u7684\u534f\u8bae\u8fdb\u884c\u8fde\u63a5\u5efa\u7acb\u3002</li> </ul>"},{"location":"web/action/barrage.html#_6","title":"\u53ef\u9760\u4e0e\u6027\u80fd","text":"<p>\u5c06\u903b\u8f91\u8f83\u4e3a\u590d\u6742\u3001\u8c03\u7528\u8f83\u5c11\u7684\u53d1\u9001\u5f39\u5e55\u4e1a\u52a1\u4e0e\u903b\u8f91\u7b80\u5355\u3001\u8c03\u7528\u91cf\u9ad8\u7684\u5f39\u5e55\u62c9\u53d6\u670d\u52a1\u62c6\u5206\u5f00\u6765\u3002</p> <ul> <li>\u4e0d\u540c\u670d\u52a1\u7684QPS\u5f80\u5f80\u662f\u4e0d\u5bf9\u7b49\u7684\uff0c\u4f8b\u5982\u50cf\u62c9\u53d6\u5f39\u5e55\u7684\u670d\u52a1\u7684\u8bf7\u6c42\u9891\u7387\u548c\u8d1f\u8f7d\u901a\u5e38\u4f1a\u6bd4\u53d1\u9001\u5f39\u5e55\u670d\u52a1\u9ad81\u52302\u4e2a\u6570\u91cf\u7ea7</li> </ul> <p>\u62c9\u53d6\u5f39\u5e55</p> <ul> <li>\u6570\u636e\u66f4\u65b0\u7684\u7b56\u7565\u662f\u670d\u52a1\u4f1a\u5b9a\u671f\u53d1\u8d77RPC\u8c03\u2f64\u4ece\u5f39\u5e55\u670d\u52a1\u62c9\u53d6\u6570\u636e\uff0c\u62c9\u53d6\u5230\u7684\u5f39\u5e55\u7f13\u5b58\u5230\u5185\u5b58\u4e2d</li> <li>\u7f13\u5b58\uff1a\u6309\u7167\u65f6\u95f4\u8fdb\u884c\u5206\u7247\uff08\u91c7\u7528 RingBuffer\uff09\uff0c\u6700\u591a\u4fdd\u755960\u79d2\u7684\u6570\u636e\uff0c\u53ea\u4fdd\u7559\u4e86\u5c3e\u6307\u9488\uff0c\u5b83\u968f\u7740\u65f6\u95f4\u5411\u524d\u79fb\u52a8\uff0c\u6bcf\u2f00\u79d2\u5411\u524d\u79fb\u52a8\u4e00\u683c</li> <li> <p>\u8bfb\u8bf7\u6c42\uff1a\u7f13\u51b2\u73af\u4f1a\u6839\u636e\u5ba2\u6237\u7aef\u4f20\u5165\u7684\u65f6\u95f4\u6233\u8ba1\u7b97\u51fa\u6307\u9488\u7684\u7d22\u5f15\u4f4d\u7f6e\uff0c\u5e76\u4ece\u5c3e\u6307\u9488\u7684\u526f\u672c\u533a\u57df\u5f80\u56de\u904d\u5386\u76f4\u81f3\u8ddf\u7d22\u5f15\u91cd\u53e0\uff0c\u6536\u96c6\u5230\u4e00\u5b9a\u6570\u91cf\u7684\u5f39\u5e55\u5217\u8868\u8fd4\u56de</p> </li> <li> <p>\u5199\u64cd\u4f5c\u662f\u5355\u7ebf\u7a0b\uff0c\u8bfb\u548c\u5199\u662f\u76f8\u53cd\u7684\u65b9\u5411\uff0c\u2f7d\u51b3\u5b9a\u8bfb\u548c\u5199\u7684\u4f4d\u7f6e\u662f\u5426\u51fa\u73b0\u91cd\u53e0\u53d6\u51b3\u4e8eindex\u7684\u4f4d\u7f6e\uff0c</p> </li> <li>\u4fdd\u8bc1\u8bfb\u64cd\u4f5c\u6700\u591a\u53ea\u80fd\u8bfb\u523030\u79d2\u5185\u7684\u6570\u636e\uff0c\u56e0\u6b64\u7f13\u51b2\u73af\u5b8c\u5168\u53ef\u4ee5\u505a\u5230\u65e0\u9501\u8bfb\u5199</li> </ul> <p>\u53d1\u9001\u5f39\u5e55</p> <ul> <li>\u7528\u6237\u4e00\u5b9a\u65f6\u95f4\u80fd\u770b\u5f97\u8fc7\u6765\u5f39\u5e55\u603b\u91cf\u662f\u6709\u9650</li> <li>\u5bf9\u5f39\u5e55\u8fdb\u884c\u9650\u6d41\uff0c\u6709\u9009\u62e9\u7684\u4e22\u5f03\u591a\u4f59\u7684\u5f39\u5e55</li> </ul>"},{"location":"web/action/breakpoint_resume.html","title":"\u65ad\u70b9\u7eed\u4f20","text":""},{"location":"web/action/breakpoint_resume.html#_2","title":"\u4e0a\u4f20","text":"<p>\u6570\u636e\u5206\u7247\uff0c\u6bcf\u6b21\u4e0a\u4f20\u65f6\u6307\u5b9a\u4f20\u8f93\u7684\u8303\u56f4\uff0c\u4e0a\u4f20\u65f6\uff0c\u7531\u524d\u540e\u7aef\u63a7\u5236\uff0c\u57fa\u672c\u90fd\u9700\u8981\u5b9a\u5236\u3002</p>"},{"location":"web/action/breakpoint_resume.html#_3","title":"\u4e0b\u8f7d","text":"<p>HTTP1.1\u534f\u8bae\uff08RFC2616\uff09\u4e2d\u5b9a\u4e49\u4e86\u65ad\u70b9\u7eed\u4f20\u76f8\u5173\u7684HTTP\u5934 Range\u548cContent-Range\u5b57\u6bb5\uff0c\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u65ad\u70b9\u7eed\u4f20\u5b9e\u73b0\u5927\u6982\u5982\u4e0b\uff1a</p> <ol> <li> <p>\u5ba2\u6237\u7aef\u4e0b\u8f7d\u4e00\u4e2a1024K\uff08K=1000\uff09\u7684\u6587\u4ef6\uff0c\u5df2\u7ecf\u4e0b\u8f7d\u4e86\u5176\u4e2d512K</p> </li> <li> <p>\u7f51\u7edc\u4e2d\u65ad\uff0c\u5ba2\u6237\u7aef\u8bf7\u6c42\u7eed\u4f20\uff0c\u56e0\u6b64\u9700\u8981\u5728HTTP\u5934\u4e2d\u7533\u660e\u672c\u6b21\u9700\u8981\u7eed\u4f20\u7684\u7247\u6bb5\uff1a<code>Range:bytes=512000-</code>\uff0c\u8fd9\u4e2a\u5934\u901a\u77e5\u670d\u52a1\u7aef\u4ece\u6587\u4ef6\u7684512K\u4f4d\u7f6e\u5f00\u59cb\u4f20\u8f93\u6587\u4ef6\uff1b</p> </li> <li> <p>\u670d\u52a1\u7aef\u6536\u5230\u65ad\u70b9\u7eed\u4f20\u8bf7\u6c42\uff0c\u6839\u636e\u8bf7\u6c42\u5934\u7684Content-Range\u6765\u51b3\u5b9a\u4ece\u6587\u4ef6\u6d41\u7684\u54ea\u4e2a\u4f4d\u7f6e\u4e0a\u5f00\u59cb\u8bfb\uff0c\u6bd4\u5982\u4ece\u6587\u4ef6\u7684512K\u4f4d\u7f6e\u5f00\u59cb\u4f20\u8f93\uff0c\u5e76\u4e14\u5728HTTP\u5934\u4e2d\u589e\u52a0\uff1a<code>Content-Range:bytes 512000-/1024000</code>\uff0c\u5e76\u4e14\u6b64\u65f6\u670d\u52a1\u7aef\u8fd4\u56de\u7684HTTP\u72b6\u6001\u7801\u5e94\u8be5\u662f206\uff0c\u800c\u4e0d\u662f200\u3002</p> </li> </ol> <p>\u5047\u5982\u6240\u8bf7\u6c42\u7684\u8303\u56f4\u4e0d\u5408\u6cd5\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u4f1a\u8fd4\u56de<code>416 Range Not Satisfiable</code>\u72b6\u6001\u7801\uff0c\u8868\u793a\u5ba2\u6237\u7aef\u9519\u8bef\u3002</p> <p>\u670d\u52a1\u5668\u5141\u8bb8\u5ffd\u7565 Range \u9996\u90e8\uff0c\u4ece\u800c\u8fd4\u56de\u6574\u4e2a\u6587\u4ef6\uff0c\u72b6\u6001\u7801\u7528<code>200</code>\u3002</p>"},{"location":"web/action/breakpoint_resume.html#1","title":"\u95ee\u98981\uff1a\u7eed\u4f20\u65f6\u4e0b\u8f7d\u7684\u6587\u4ef6\u53d1\u751f\u53d8\u5316\uff1f","text":"<p>\u5728\u7ec8\u7aef\u53d1\u8d77\u7eed\u4f20\u8bf7\u6c42\u65f6\uff0cURL\u5bf9\u5e94\u7684\u6587\u4ef6\u5185\u5bb9\u5728\u670d\u52a1\u7aef\u5df2\u7ecf\u53d1\u751f\u53d8\u5316\uff0c\u6b64\u65f6\u7eed\u4f20\u7684\u6570\u636e\u80af\u5b9a\u662f\u9519\u8bef\u7684\u3002</p> <p>\u9700\u8981\u6709\u4e00\u4e2a\u6807\u8bc6\u6587\u4ef6\u552f\u4e00\u6027\u7684\u65b9\u6cd5\uff1aRFC2616\u4e2d\u76f8\u5173\u5b9a\u4e49</p> <ul> <li>Last-Modified \u6765\u6807\u8bc6\u6587\u4ef6\u7684\u6700\u540e\u4fee\u6539\u65f6\u95f4\uff0c\u8fd9\u6837\u5373\u53ef\u5224\u65ad\u51fa\u7eed\u4f20\u6587\u4ef6\u65f6\u662f\u5426\u5df2\u7ecf\u53d1\u751f\u8fc7\u6539\u52a8\u3002</li> <li>ETag\u7684\u5934\u57df\u5b57\u6bb5\uff0c\u53ef\u4ee5\u4f7f\u7528 ETag \u5934\u6765\u653e\u7f6e\u6587\u4ef6\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u6bd4\u5982\u6587\u4ef6\u7684MD5\u503c\u3002</li> <li>\u7eed\u4f20\u65f6\u5ba2\u6237\u7aef\u4f7f\u7528If-Range\uff0c\u5185\u5bb9\u53ef\u4ee5\u4e3a\u6700\u521d\u6536\u5230\u7684ETag\u5934\u6216\u8005\u662fLast-Modfied\u4e2d\u7684\u6700\u540e\u4fee\u6539\u65f6\u95f4\u3002</li> <li>\u670d\u52a1\u7aef\u5728\u6536\u5230\u7eed\u4f20\u8bf7\u6c42\u65f6\uff0c\u901a\u8fc7If-Range\u4e2d\u7684\u5185\u5bb9\u8fdb\u884c\u6821\u9a8c\uff0c\u6821\u9a8c\u4e00\u81f4\u65f6\u8fd4\u56de206\u7684\u7eed\u4f20\u56de\u5e94\uff0c\u4e0d\u4e00\u81f4\u65f6\u670d\u52a1\u7aef\u5219\u8fd4\u56de200\u56de\u5e94\uff0c\u56de\u5e94\u7684\u5185\u5bb9\u4e3a\u65b0\u7684\u6587\u4ef6\u7684\u5168\u90e8\u6570\u636e\u3002</li> </ul>"},{"location":"web/action/collaborative_editor.html","title":"\u534f\u540c\u7f16\u8f91","text":"<p>\u591a\u4e2a\u7528\u6237\u5bf9\u540c\u4e00\u4e2a\u6587\u672c\u57df\u7684\u540c\u4e00\u4e2a\u7248\u672c\u8fdb\u884c\u7f16\u8f91\u65f6\u5982\u4f55\u5904\u7406\u3002</p>"},{"location":"web/action/collaborative_editor.html#_2","title":"\u65b9\u6848","text":""},{"location":"web/action/collaborative_editor.html#otoperation-transform","title":"OT\uff08Operation Transform\uff09","text":"<p>OT\u7684\u6570\u636e\u7c7b\u578b</p> <p>https://github.com/ottypes</p> <p>OT\u7684\u95ee\u9898\uff1a\u4f9d\u8d56\u4e8e\u4e2d\u5fc3\u5316\u7684\u670d\u52a1\u5668</p>"},{"location":"web/action/collaborative_editor.html#crdtconflict-free-replicated-data-type","title":"CRDT\uff08Conflict-Free Replicated Data Type\uff09","text":"<p>CRDT(Conflict-Free Replicated Data Type)\u662f\u5404\u79cd\u57fa\u7840\u6570\u636e\u7ed3\u6784\u6700\u7ec8\u4e00\u81f4\u7b97\u6cd5\u7684\u7406\u8bba\u603b\u7ed3\uff0c\u80fd\u6839\u636e\u4e00\u5b9a\u7684\u89c4\u5219\u81ea\u52a8\u5408\u5e76\uff0c\u89e3\u51b3\u51b2\u7a81\uff0c\u8fbe\u5230\u5f3a\u6700\u7ec8\u4e00\u81f4\u7684\u6548\u679c\u3002</p> <p>\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u7b26\u5408CRDT\u7684\u6761\u4ef6\u662fupdate\u64cd\u4f5c\u548cmerge\u64cd\u4f5c\u9700\u6ee1\u8db3\u4ea4\u6362\u5f8b\u3001\u7ed3\u5408\u5f8b\u548c\u5e42\u7b49\u5f8b\u3002</p> <ul> <li>\u5982\u679cupdate\u64cd\u4f5c\u672c\u8eab\u6ee1\u8db3\u4ee5\u4e0a\u4e09\u5f8b\uff0cmerge\u64cd\u4f5c\u4ec5\u9700\u8981\u5bf9update\u64cd\u4f5c\u8fdb\u884c\u56de\u653e\u5373\u53ef\uff0c\u8fd9\u79cd\u5f62\u5f0f\u79f0\u4e3aop-based CRDT\uff0c\u6700\u7b80\u5355\u7684\u4f8b\u5b50\u662f\u96c6\u5408\u6c42\u5e76\u96c6\u3002</li> <li>\u5982\u679cupdate\u64cd\u4f5c\u65e0\u6cd5\u6ee1\u8db3\u6761\u4ef6\uff0c\u5219\u53ef\u4ee5\u8003\u8651\u540c\u6b65\u526f\u672c\u6570\u636e\uff0c\u540c\u65f6\u9644\u5e26\u989d\u5916\u5143\u4fe1\u606f\uff0c\u901a\u8fc7\u5143\u4fe1\u606f\u8ba9update\u548cmerge\u64cd\u4f5c\u5177\u5907\u4ee5\u4e0a\u4e09\u5f8b\uff0c\u8fd9\u79cd\u5f62\u5f0f\u79f0\u4e3astate-based CRDT\u3002</li> </ul> <p>CRDT \u6709\u4ee5\u4e0b\u51e0\u79cd\u5e38\u89c1\u7684\u5b9e\u73b0</p> <p>Counter\uff08\u8ba1\u6570\u5668\uff09\uff1a</p> <ul> <li>G-Counter(Grow-Only Set)\uff1astate-based CRDT</li> <li>\u53ea\u589e\u4e0d\u51cf\u7684\u8ba1\u6570\u5668\uff0c\u5bf9\u4e8e N \u4e2a\u8282\u70b9\uff0c\u6bcf\u4e2a\u8282\u70b9\u4e0a\u7ef4\u62a4\u4e00\u4e2a\u957f\u5ea6\u4e3a N \u7684\u5411\u91cf V\uff1b</li> <li>update\u65f6\u53ea\u64cd\u4f5c\u5f53\u524d\u8282\u70b9\u5728\u6570\u7ec4\u4e2d\u5bf9\u5e94\u9879\u5373\u53ef\uff1b</li> <li>merge\u65f6\u5bf9\u6570\u7ec4\u6bcf\u4e00\u9879\u6c42max\u8fdb\u884c\u5408\u5e76\uff1b</li> <li>query\u65f6\u8fd4\u56de\u6570\u7ec4\u7684\u548c\uff0c\u5373\u4e3acounter\u7684\u5f53\u524d\u7ed3\u679c</li> <li>PN-Counter(Positive-Negative Counter)</li> <li>\u4f7f\u7528\u4e24\u4e2a\u8ba1\u6570\u5668\u6765\u5b9e\u73b0\u4e00\u4e2a\u65e2\u80fd\u589e\u52a0\u4e5f\u80fd\u51cf\u5c11\u8ba1\u6570\u5668\uff1b</li> <li>\u4e00\u4e2a G-Counter \u6765\u8bb0\u5f55\u6240\u6709\u7d2f\u52a0\u7ed3\u679c\uff0c\u53e6\u4e00\u4e2a G-Counter \u6765\u8bb0\u5f55\u7d2f\u51cf\u7ed3\u679c\uff1b</li> </ul> <p>Register\uff1a\u672c\u8d28\u5c71\u662f\u4e2aString\uff0c\u4ec5\u652f\u6301assign\u64cd\u4f5c</p> <ul> <li>Last-Writer-Wins Register (LWW Register)</li> <li>\u540eassign\u7684\u8986\u76d6\u5148assign\u7684(last write wins)\uff0c\u65b9\u5f0f\u662f\u6bcf\u6b21\u4fee\u6539\u90fd\u9644\u5e26\u65f6\u95f4\u6233\uff0cupdate\u65f6\u901a\u8fc7\u65f6\u95f4\u6233\u751f\u6210\u504f\u5e8f\u5173\u7cfb\uff0cmerge\u65f6\u53ea\u53d6\u8f83\u5927\u65f6\u95f4\u6233\u9644\u5e26\u7684\u7ed3\u679c</li> </ul> <p>Set\uff08\u96c6\u5408\uff09\uff1aadd\u548cremove\uff08\u591a\u8282\u70b9\u5e76\u53d1\u8fdb\u884cadd\u548cremove\u64cd\u4f5c\u662f\u65e0\u6cd5\u6ee1\u8db3\u4ea4\u6362\u5f8b\uff09</p> <ul> <li>G-Set(Grow-only Set)\uff1a\u4ec5\u652f\u6301add\uff0cOp-based CRDT</li> <li>add\u64cd\u4f5c\u672c\u8d28\u4e0a\u662f\u6c42\u5e76\uff0c\u5929\u7136\u6ee1\u8db3\u4ea4\u6362\u5f8b\u3001\u7ed3\u5408\u5f8b\u548c\u5e42\u7b49\u5f8b\uff1b</li> <li>2P-Set(Two-Phase Set)\uff1a\u652f\u6301add/remove\uff0cOp-based CRDT</li> <li>\u4f7f\u7528\u4e24\u4e2aG-Set\uff0cset A\u53ea\u8d1f\u8d23\u6dfb\u52a0\uff0cset R\u8d1f\u8d23\u5220\u9664\u7684\u5143\u7d20\uff1b</li> <li>\u5341\u5206\u4e0d\u5b9e\u7528\uff0c\u5220\u9664\u7684\u5143\u7d20\u4e0d\u80fd\u518d\u88ab\u6dfb\u52a0\uff0c\u4e14\u5220\u9664\u7684\u5143\u7d20\u5360\u7528\u7a7a\u95f4\uff1b</li> <li>LWW-Element-Set(Last Write Wins element Set)</li> <li>\u89e3\u51b3\u5220\u9664\u5143\u7d20\u4e0d\u80fd\u518d\u6b21\u6dfb\u52a0\u7684\u95ee\u9898\uff0c\u7ed92P-Set\u4e2dA\u548cR\u7684\u6bcf\u4e2a\u5143\u7d20\u52a0\u4e00\u4e2a\u66f4\u65b0\u65f6\u95f4\u6233</li> <li>OR-Set(Observed-Removed Set)</li> <li>\u6bcf\u6b21add(e)\u7684\u65f6\u5019\u90fd\u4e3a\u5143\u7d20e\u52a0\u4e00\u4e2a\u552f\u4e00\u7684tag\uff0cremove(e)\u5c06\u5f53\u524d\u8282\u70b9\u4e0a\u7684\u6240\u6709e\u548c\u5bf9\u5e94\u7684tag\u90fd\u5220\u9664</li> </ul>"},{"location":"web/action/collaborative_editor.html#_3","title":"\u5de5\u5177","text":""},{"location":"web/action/collaborative_editor.html#sharedbot","title":"ShareDB\uff08OT\uff09","text":"<p>ShareDB is a full-stack library for realtime JSON document collaboration.</p> <p>ShareDB is a realtime database backend based on Operational Transformation (OT) of JSON documents.</p> <ul> <li>It provides a Node.js server for coordinating and committing edits from multiple clients. </li> <li>It also provides a JavaScript client for manipulating documents, which can be run either in Node.js or in the browser.</li> </ul>"},{"location":"web/action/collaborative_editor.html#yjscrdt","title":"Yjs\uff08CRDT)","text":"<p>Yjs is a modular framework for syncing things in real-time - like editors!</p>"},{"location":"web/action/collaborative_editor.html#ymodel","title":"YModel","text":"<p>Yjs \u5bf9\u4f7f\u7528\u8005\u63d0\u4f9b\u4e86\u5982 YText\u3001YArray \u548c YMap \u7b49\u5e38\u7528\u6570\u636e\u7c7b\u578b\uff0c\u5373\u6240\u8c13\u7684 Shared Types\uff1b</p> <p>YModel \u5b9e\u4f8b\u4e2d\u7684\u6570\u636e\u90fd\u5b58\u50a8\u5728\u4e00\u6761\u53cc\u5411\u94fe\u8868\u91cc\u3002\u7c97\u7565\u5730\u8bf4\uff0c\u8fd9\u6761\u94fe\u8868\u4e2d\u7684\u6bcf\u4e00\u9879\uff08\u6216\u8005\u8bf4\u6bcf\u4e2a item\uff09\u90fd\u552f\u4e00\u5730\u8bb0\u5f55\u4e86\u67d0\u6b21\u7528\u6237\u64cd\u4f5c\u6240\u4fee\u6539\u7684\u6570\u636e\uff0c\u5bf9 YModel \u7684\u64cd\u4f5c\uff0c\u6700\u540e\u90fd\u4f1a\u8f6c\u4e3a\u5bf9\u8fd9\u6761\u94fe\u8868\u7684 append\u3001insert\u3001split\u3001merge \u7b49\u7ed3\u6784\u53d8\u6362\u3002</p> <p>\u57fa\u4e8e\u4e0a\u8ff0\u624b\u6bb5\u5b9e\u73b0\u7684 CRDT \u7ed3\u6784\u662f CRDT \u6d41\u6d3e\u4e2d\u7684\u4e00\u79cd\uff0c\u53ef\u4ee5\u5c06\u5176\u79f0\u4e3a operation-based CRDT\u3001list CRDT \u6216 sequence CRDT\u3002</p> <p>\u6bcf\u4e2a item \u5206\u914d\u4e00\u4e2a\u552f\u4e00 ID(\u552f\u4e00\u786e\u5b9a\u5176\u5728\u903b\u8f91\u65f6\u95f4\u8f74\u4e0a\u7684\u4f4d\u7f6e)\uff0c\u5176\u7ed3\u6784\u4e3a <code>ID(clientID, clock)</code></p> <ul> <li>clientID\uff1a\u552f\u4e00\u6807\u8bc6\u67d0\u4e2a YDoc \u5bf9\u5e94\u7684\u5ba2\u6237\u7aef\uff1b</li> <li>clock\uff1aLamport timestamp \u7684\u903b\u8f91\u65f6\u95f4\u6233</li> </ul>"},{"location":"web/action/collaborative_editor.html#_4","title":"\u539f\u7406","text":"<ul> <li>\u57fa\u4e8e\u53cc\u5411\u94fe\u8868\u548c StructStore \u7684\u57fa\u7840\u6570\u636e\u7ed3\u6784</li> <li>\u57fa\u4e8e YATA \u7b97\u6cd5\u7684\u5e76\u53d1\u51b2\u7a81\u89e3\u51b3\u673a\u5236</li> <li>\u57fa\u4e8e DeleteSet \u548c Transaction \u673a\u5236\u7684\u64a4\u9500\u91cd\u505a</li> <li> <p>\u57fa\u4e8e\u4e24\u9636\u6bb5\u5212\u5206\u7684\u540c\u6b65\u673a\u5236</p> </li> <li> <p>\u6587\u5b57\u5185\u5bb9\u7684\u5feb\u901f\u63d2\u5165\uff1ahttps://josephg.com/blog/crdts-go-brrr/</p> </li> </ul>"},{"location":"web/action/collaborative_editor.html#diamond-types","title":"Diamond-Types","text":"<p>https://github.com/josephg/diamond-types</p>"},{"location":"web/action/collaborative_editor.html#_5","title":"\u53c2\u8003\u6587\u732e\uff1a","text":"<p>shareDB\u4f5c\u8005 CRDTs are the future</p>"},{"location":"web/action/cookie_session.html","title":"\u4f1a\u8bdd\u4fdd\u6301","text":""},{"location":"web/action/cookie_session.html#cookie-session","title":"Cookie-Session","text":"<p>\u670d\u52a1\u7aef\u6839\u636e\u8fd9\u4e2aCookie\u5c31\u80fd\u627e\u5230\u5bf9\u5e94\u7684session\uff0c\u4ecesession\u4e2d\u53d6\u5f97\u7528\u6237\u7684\u4fe1\u606f\u3002</p> <p>\u540c\u6e90\u662f\u6307\uff1a</p> <ul> <li>\u534f\u8bae\u76f8\u540c\uff1ahttp \u6216 https</li> <li>\u57df\u540d\u76f8\u540c</li> <li>\u7aef\u53e3\u76f8\u540c</li> </ul> <p>\u5728\u505a\u524d\u540e\u7aef\u5206\u79bb\u65f6\uff0c\u524d\u7aef\u548c\u540e\u7aef\u90e8\u7f72\u5728\u540c\u4e00\u57df\u4e0b\uff0c\u6ee1\u8db3\u6d4f\u89c8\u5668\u7684\u540c\u6e90\u7b56\u7565\uff0c\u767b\u5f55\u4e0d\u9700\u8981\u505a\u7279\u6b8a\u7684\u5904\u7406\u3002</p> <p>\u524d\u540e\u7aef\u4e0d\u540c\u57df\u65f6\uff0c\u9700\u8981\u901a\u8fc7CORS\u7684\u65b9\u5f0f\u6216\u8005JSONP\u7684\u65b9\u5f0f\u5b9e\u73b0Cookie-Session\u767b\u5f55\u3002</p> <p>\u524d\u540e\u7aef\u5206\u79bb\uff1a</p> <ul> <li> <p>\u4e0d\u540c\u8282\u70b9\u90e8\u7f72\uff0c\u4f1a\u5b58\u5728\u8de8\u8d8a\u8bbf\u95eecookie\u7684\u95ee\u9898\u3002  </p> </li> <li> <p>sessionId\u53ef\u4ee5\u901a\u8fc7 response.setHeader(\"Access-Control-Expose-Headers\", \"TK\") \u5141\u8bb8\u6d4f\u89c8\u5668\u53ef\u4ee5\u8bfb\u53d6\u54ea\u4e9b\u670d\u52a1\u5668\u53d1\u9001\u7684\u8bf7\u6c42\u5934</p> </li> </ul> <p>\u793a\u4f8b\uff1a\u534e\u4e3a\u4e91</p> <p>\u7528\u6237\u4e2d\u5fc3\uff08 JS + Java\uff09\uff1a\u524d\u540e\u7aef\u90fd\u5b58\u5728\uff0c\u8d77\u6821\u9a8c\uff08\u6839\u636eCookie\u4e2dSessionID\u53bb\u5206\u5e03\u5f0f\u7f13\u5b58\u4e2d\u83b7\u53d6token\uff09\u3001\u8f6c\u53d1\uff08\u8bf7\u6c42\u8f6c\u53d1\u5230\u540e\u7aef\u670d\u52a1\uff0c\u6dfb\u52a0token\u5728Header\u4e2d\uff09\u7684\u4f5c\u7528</p> <p>\u4e0d\u9700\u8981Session\uff0c\u4f46\u8fd8\u662f\u9700\u8981Cookie\uff1f</p> <ul> <li>jwt token\u4e4b\u7c7b\uff0c\u8fd8\u662f\u9700\u8981\u5ba2\u6237\u7aef\u5b58\u50a8</li> </ul>"},{"location":"web/action/cookie_session.html#token","title":"Token","text":""},{"location":"web/action/cookie_session.html#jwt-token","title":"Jwt Token","text":"<p>token\u7684\u7eed\u671f\u95ee\u9898\uff1arefresh token + access token</p> <ul> <li>access token \u6709\u6548\u65f6\u95f4\u77ed\uff0c\u5373\u4f7f\u88ab\u622a\u83b7\uff0c\u5f71\u54cd\u65f6\u95f4\u8303\u56f4\u6709\u9650\uff1b</li> <li>refresh token \u4e0d\u5e38\u7528\uff0c\u4e0d\u662f\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u4f1a\u643a\u5e26\uff0c\u6240\u4ee5\u66f4\u52a0\u5b89\u5168\uff1b</li> <li>\u524d\u7aef\u9632\u6b62\u5e76\u53d1\u7eed\u671f\uff0c\u5176\u5b83\u8bf7\u6c42\u7b49\u5f85\u5f53\u524d\u7eed\u671f\u7684\u8bf7\u6c42\u8fd4\u56de\u65b0\u7684token\uff0c\u518d\u6267\u884c\uff1b</li> <li>\u5982\u679c\u4e0d\u6b62\u524d\u7aef\u8bbf\u95ee\uff0c\u540e\u7aef\u53ef\u4ee5\u901a\u8fc7\u7f13\u5b58\uff0c\u9632\u6b62\u7b7e\u53d1\u591a\u4e2aaccess token\uff1b</li> </ul>"},{"location":"web/action/data_permission.html","title":"\u6570\u636e\u6743\u9650","text":"<p>\u793a\u4f8b\u4ee3\u7801\uff1a\u6ce8\u89e3\u5b9e\u73b0\u6570\u636e\u6743\u9650</p>"},{"location":"web/action/data_permission.html#_2","title":"\u573a\u666f","text":"<ul> <li>\uff08Get\uff09\u67e5\u770b\u67d0\u4e2a/\u67d0\u591a\u4e2a\u8d44\u6e90\u65f6\uff0c\u662f\u5426\u80fd\u591f\u8bbf\u95ee\uff1f</li> <li>\uff08List\uff09\u5217\u51fa\u6240\u6709\u8d44\u6e90\u65f6\uff0c\u80fd\u591f\u8bbf\u95ee\u54ea\u4e9b\uff1f</li> </ul> <p>\u9488\u5bf9 Get \u7684\u573a\u666f\uff0c\u56e0\u4e3a\u8bf7\u6c42\u4f53\u4e2d\u4f1a\u643a\u5e26 \u8d44\u6e90 ids\uff0c\u56e0\u6b64\u53ef\u4ee5\u8fdb\u884cPreCheck\u3002</p> <p>\u9488\u5bf9 List \u7684\u573a\u666f\uff0c\u8bf7\u6c42\u4f53\u4e2d\u4e0d\u5305\u542b \u8d44\u6e90 ids</p> <ul> <li>\u6570\u636e\u5e93\u65e0\u4fb5\u5165\uff08PostFilter\uff09\uff1a\u67e5\u8be2\u51fa\u6240\u6709\u8d44\u6e90\uff0c\u518d\u8fdb\u884c\u8fc7\u6ee4\uff1b</li> <li>\u5982\u679c\u8d44\u6e90\u5f88\u591a\u65f6\uff0c\u6027\u80fd\u6709\u95ee\u9898\uff1b</li> <li>\u5bf9\u4e8e\u5206\u9875\u67e5\u8be2\uff0c\u65e0\u6cd5\u786e\u5b9a\u67e5\u8be2\u6570\u636e\u91cf\uff0c\u53ea\u80fd\u5168\u67e5\uff0c\u5426\u5219\u8fc7\u6ee4\u65f6\u7684\u6570\u636e\u4e0d\u51c6\u786e\uff1b</li> <li>\u6570\u636e\u5e93\u4fb5\u5165\uff08SqlWhere\uff09\uff1a\u67e5\u8be2\u8be5\u7528\u6237\u53ef\u67e5\u770b\u7684\u8d44\u6e90 ids\uff0c\u62fc\u63a5\u5230 SQL \u8bed\u53e5\u540e\u9762\uff1b</li> </ul> <p>\u7f51\u4e0a\u7684\u4e00\u4e9b\u6570\u636e\u6743\u9650\uff08Ruoyi\u7b49\uff09\uff0c\u901a\u8fc7\u5185\u7f6e\u51e0\u79cd\u7b56\u7565\u6765\u5b9e\u73b0\uff0c\u4e0d\u5177\u5907\u901a\u7528\u6027\uff08TODO\uff1a\u540e\u7eed\u8bba\u8bc1\uff09\uff1a</p> <ul> <li>\u672c\u4eba\uff0c\u672c\u90e8\u95e8\uff0c\u90e8\u95e8\u53ca\u6240\u6709\u5b50\u90e8\u95e8\uff1b</li> <li>\u9488\u5bf9\u5206\u4eab\uff0c\u5f88\u96be\u505a\u5904\u7406\uff1b</li> </ul> <p>\u56e0\u4e3a\u8d44\u6e90\u7c7b\u578b\u6709\u5f88\u591a\uff0c\u5982\u201d\u7528\u6237\u201c\uff0c\u201d\u7528\u6237\u7ec4\u201c\uff0c\u201d\u9879\u76ee\u201c\u548c\u5404\u79cd\u4e1a\u52a1\u8d44\u6e90\uff1b</p> <ul> <li></li> </ul> <p>\u9488\u5bf9\u7ba1\u7406\u5458\uff1a\u63d0\u4f9b\u7279\u6b8a\u6743\u9650\uff0c\u4e0d\u9700\u8981\u5c06\u6240\u6709\u8d44\u6e90 ids \u8d4b\u503c</p> <ul> <li>AUTH_ALL\uff0c\u5373 \"*\"\uff1a\u6307\u5b9a\u4efb\u610f\u8d44\u6e90 ids\uff0c\u90fd\u53ef\u4ee5\u67e5\u8be2\uff1b</li> </ul>"},{"location":"web/action/data_permission.html#_3","title":"\u65b9\u6848","text":"<p>\u7531\u4e8e\u5bf9\u4e8e List \u7684\u573a\u666f\uff0c\u91c7\u7528 SQL \u4fb5\u5165\u5f0f\u7684\u65b9\u6848\u3002\u5982\u679c\u6ca1\u6709\u8bf7\u6c42\u4f53\uff0c\u5219\u65e0\u6cd5\u5c06\u7528\u6237\u5177\u5907\u7684\u8d44\u6e90 ids \u901a\u8fc7 SPEL \u4fee\u6539\u5e76\u8fd4\u56de\uff08\u4e0d\u6253\u7b97\u91c7\u7528 ThreadLocal \u7b49\u65b9\u5f0f\uff0c\u9632\u6b62\u591a\u7ebf\u7a0b\u7684\u672c\u5730\u53d8\u91cf\u7ee7\u627f\u7b49\u95ee\u9898\uff09\u3002</p> <ul> <li>\u5c06 \u591a\u4e2aGet \u548c List \u7684\u573a\u666f\uff0c\u7edf\u4e00\u6210\u4e00\u4e2a\u63a5\u53e3\uff1b</li> <li>\u5982\u679c\u5e26\u8d44\u6e90 ids \uff0c\u5219\u662f  \u591a\u4e2aGet\uff1b</li> <li>\u5982\u679c\u4e0d\u5e26 \u8d44\u6e90 ids\uff08\u5373\u4e3a null\uff09\uff0c\u5219\u4e3a List\uff1b</li> </ul> <p>\u9488\u5bf9\u5355\u4e2aGet \u7684\u573a\u666f\uff0c\u56e0\u4e3a\u8bf7\u6c42\u4f53\u4e2d\u4f1a\u643a\u5e26 \u8d44\u6e90 id\uff0c\u56e0\u6b64\u53ef\u4ee5\u8fdb\u884cPreCheck\uff1a</p> <ul> <li>\u83b7\u53d6\u7528\u6237\u7684\u6240\u6709\u8d44\u6e90\uff0c\u67e5\u770b\u662f\u5426\u5177\u5907\u6743\u9650\uff1b</li> <li>\uff08\u6216\uff09\u76f4\u63a5\u67e5\u8be2\u7528\u6237\u662f\u5426\u5177\u5907\u8be5\u8d44\u6e90\u7684\u6743\u9650\uff1b</li> </ul> <p>\u9488\u5bf9 \u591a\u4e2aGet \u7684\u573a\u666f\uff0c\u56e0\u4e3a\u8bf7\u6c42\u4f53\u4e2d\u4f1a\u643a\u5e26 \u8d44\u6e90 id\uff0c\u56e0\u6b64\u53ef\u4ee5\u8fdb\u884cPreCheck\uff1a</p> <ul> <li>\u83b7\u53d6\u7528\u6237\u7684\u6240\u6709\u8d44\u6e90\uff0c\u67e5\u770b\u662f\u5426\u5177\u5907\u6743\u9650\u5e76\u8fc7\u6ee4\u6709\u6743\u9650\u7684\u8d44\u6e90\uff1b</li> <li>\uff08\u6216\uff09\u76f4\u63a5\u67e5\u8be2\u7528\u6237\u662f\u5426\u5177\u5907\u8fd9\u4e00\u6279\u8d44\u6e90\u7684\u6743\u9650\uff1b</li> <li>\u6700\u540e\uff0c\u5c06\u6709\u6743\u9650\u7684\u8d44\u6e90ids\uff0c\u901a\u8fc7 SPEL \u56de\u5199\u53c2\u6570\uff0c\u62fc\u63a5\u5230SQL\uff1b</li> </ul> <p>\u9488\u5bf9 List \u7684\u573a\u666f\uff0c\u56e0\u4e3a\u8bf7\u6c42\u4f53\u4e2d\u4f1a\u643a\u5e26 \u8d44\u6e90 id\uff0c\u56e0\u6b64\u53ef\u4ee5\u8fdb\u884cPreCheck\uff1a</p> <ul> <li>\u83b7\u53d6\u7528\u6237\u7684\u6240\u6709\u8d44\u6e90\uff0c\u901a\u8fc7 SPEL \u56de\u5199\u53c2\u6570\uff0c\u62fc\u63a5\u5230SQL\uff1b</li> </ul>"},{"location":"web/action/lcdp.html","title":"LCDP","text":"<p>\u53c2\u8003\uff1a\u300a\u4e00\u79cd\u5173\u4e8e\u4f4e\u4ee3\u7801\u5e73\u53f0(LCDP)\u5efa\u8bbe\u5b9e\u8df5\u4e0e\u8bbe\u8ba1\u601d\u8def\u300b</p> <p>Low Code Development Platform.</p> <p>\u65e0\u9700\u7f16\u7801\uff080\u4ee3\u7801\uff09\u6216\u901a\u8fc7\u5c11\u91cf\u4ee3\u7801\u5c31\u53ef\u4ee5\u5feb\u901f\u751f\u6210\u5e94\u7528\u7a0b\u5e8f\u7684\u5f00\u53d1\u5e73\u53f0\u3002</p> <p>\u80cc\u666f\uff1a</p>"},{"location":"web/action/lcdp.html#-","title":"- \u4e1a\u52a1\u7ebf\u7279\u522b\u591a\uff0c\u6bcf\u4e2a\u4e1a\u52a1\u7ebf\u5bf9\u540c\u4e00\u4e2a\u9875\u9762\u90fd\u6709\u4e2a\u6027\u5316\u5e03\u5c40\u548c\u4e0d\u540c\u7684\u5b57\u6bb5\u9700\u6c42\uff1b","text":"<p>\u901a\u8fc7\u53ef\u89c6\u5316\u8fdb\u884c\u5e94\u7528\u7a0b\u5e8f\u5f00\u53d1\u7684\u65b9\u6cd5\uff08\u53c2\u8003\u53ef\u89c6\u7f16\u7a0b\u8bed\u8a00\uff09\uff0c\u4f7f\u5177\u6709\u4e0d\u540c\u7ecf\u9a8c\u6c34\u5e73\u7684\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u901a\u8fc7\u56fe\u5f62\u5316\u7684\u7528\u6237\u754c\u9762\uff0c\u4f7f\u7528\u62d6\u62fd\u7ec4\u4ef6\u548c\u6a21\u578b\u9a71\u52a8\u7684\u903b\u8f91\u6765\u521b\u5efa\u7f51\u9875\u548c\u79fb\u52a8\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u6838\u5fc3\u80fd\u529b\uff1a</p> <ul> <li>\u9875\u9762\u7684\u5343\u4eba\u5343\u9762\uff0c\u5305\u542b\u540c\u4e00\u4e2a\u9875\u9762\u4e0d\u540c\u5e03\u5c40\u3001\u4e0d\u540c\u5b57\u6bb5\u3001\u4e0d\u540c\u6837\u5f0f\uff1b</li> <li>\u6570\u636e\u6a21\u5757\u7684\u5343\u884c\u5343\u9762(\u5343\u4eba\u5343\u9762)\uff0c\u6839\u636e\u4e0d\u540c\u8eab\u4efd\u6267\u884c\u4e0d\u540c\u7684\u4e1a\u52a1\u6280\u672f\u903b\u8f91\u548c\u670d\u52a1\u7f16\u6392\uff1b</li> <li>page\u4e00\u952e\u521b\u5efa\uff0c\u6ca1\u6709\u65b0\u7684\u4e1a\u52a1\u7ec4\u5efa\u548c\u65b0\u7684module\u60c5\u51b5\u65e0\u9700\u5f00\u53d1\u63a5\u5165\uff0c0\u4ee3\u7801\u4e0a\u7ebf\uff0c\u8fd0\u8425\u540c\u5b66\u81ea\u884c\u914d\u7f6e\u9875\u9762\uff1b</li> <li>\u524d\u7aef\u7ec4\u4ef6\u590d\u7528\uff0c\u5728\u6ca1\u6709\u65b0\u524d\u7aef\u7ec4\u4ef6\uff0c\u524d\u7aef\u65e0\u9700\u53c2\u4e0e\u5f00\u53d1\uff0c\u540e\u7aef\u53ea\u9700\u7f16\u5199module\u5bf9\u5e94\u7684\u4e1a\u52a1\u63a5\u53e3\uff1b</li> <li>\u5b9e\u73b0module\u53ef\u590d\u7528\uff0cmodule\u6570\u636e\u6e32\u67d3\u3001\u6570\u636e\u5199\u5165\uff0c\u67e5\u8be2\u6761\u4ef6\u3001\u6d6e\u5c42\u3001\u534a\u63a8\u9875\u9762\u3001\u9875\u9762\u64cd\u4f5c\uff1b</li> <li>\u65b0\u589e\u5b57\u6bb5\u6269\u5c550\u4ee3\u7801\uff0c\u6a21\u578b\u5b57\u6bb5\u53ef\u4ee5\u81ea\u5b9a\u4e49\uff0c\u52a8\u6001\u6269\u5c55\uff0c\u53ef\u5b9a\u4e49\u6765\u81ea\u672c\u5730\u6570\u636e\u5e93\u3001\u8fdc\u7a0b\u63a5\u53e3\u6570\u636e\uff1b</li> <li>\u73af\u5883\u53ef\u9694\u79bb\uff0c\u6d4b\u8bd5\u3001\u9884\u53d1\u3001\u751f\u4ea7\uff1b</li> <li>\u5e73\u53f0\u548c\u4e1a\u52a1\u4ee3\u7801\u5206\u79bb\uff0c\u4e1a\u52a1\u4e0a\u7ebf\u53ea\u9700\u5173\u6ce8\u4e1a\u52a1\u903b\u8f91\u672c\u8eab\u7684\u4ee3\u7801\uff1b</li> <li>DO DTO\u53ef\u5b9a\u4e49\uff0c\u52a8\u6001\u6620\u5c04\uff1b</li> <li>\u6570\u636e\u679a\u4e3e\u52a8\u6001\u5b9a\u4e49\uff0c\u52a8\u6001\u7ed1\u5b9a\uff1b</li> </ul>"},{"location":"web/action/lcdp.html#_1","title":"\u8bbe\u8ba1","text":"<p>\u4e00\u822c\u4f4e\u4ee3\u7801\u5e73\u53f0\uff0c\u4e3b\u8981\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u524d\u7aef\u9875\u9762\u7684\u6e32\u67d3\u548c\u540e\u7aef\u670d\u52a1\u63a5\u53e3\u7ed1\u5b9a\uff08\u670d\u52a1\u7f16\u6392\u7b49\uff09\u3002</p> <p>\u5343\u4eba\u5343\u9762\uff1a</p> <ul> <li>\u540e\u7aef\u901a\u8fc7\u8bc6\u522b\u51fa\u7528\u6237\u7684\u8eab\u4efd\uff0c\u901a\u8fc7\u63a5\u53e3\u8f93\u51fa\u7ed9\u524d\u7aef\u5343\u4eba\u5343\u9762\u7684\u4e2a\u6027\u5316schema\uff0c\u524d\u7aef\u5c31\u901a\u8fc7schema\u914d\u7f6e\u52a8\u6001\u53bb\u6e32\u67d3\u3002</li> </ul> <p>\u6bcf\u6b21\u65b0\u589e\u4e1a\u52a1\u7ebf\uff08\u79df\u6237\uff09\u540e\u5c31\u6709\u65b0\u589e\u5b57\u6bb5\u9700\u6c42\uff0c\u800c\u4e14\u5b57\u6bb5\u7684\u5dee\u5f02\u8fd8\u633a\u591a\uff0c\u7ea6\u536080%\uff1a</p> <ul> <li>\u901a\u8fc7\u5b9a\u4e49\u4e00\u4e2a\u7279\u6b8afeature\u5b57\u6bb5\uff0c\u5b58\u50a8\u7c7b\u578b\u4e3ajson\uff0c\u7ea6\u5b9a\u597d\u534f\u8bae\uff0c\u6269\u5c55\u5b57\u6bb5\u6309\u7167\u4e0d\u540c\u884c\u4e1a\u5b58\u50a8\u5728json\u5185</li> <li>mysql5.7\u4e0a\uff0c\u5728\u76f8\u540c\u6570\u636e\u91cf\u7684\u60c5\u51b5\u4e0b\uff0c\u865a\u62df\u7d22\u5f15\u548c\u666e\u901a\u7d22\u5f15\u67e5\u8be2\u6548\u7387\u57fa\u672c\u4e00\u81f4\uff0c\u805a\u5408\u64cd\u4f5c\u4f7f\u7528\u865a\u62df\u5217\uff1b</li> </ul>"},{"location":"web/action/lcdp.html#db","title":"DB\u8bbe\u8ba1","text":"<p>DO\u7684\u5b9a\u4e49\u3001DTO\u7684\u5b9a\u4e49\u3001module\u5b9a\u4e49\uff08\u7b49\u540cVO\u5b9a\u4e49\uff09\u3001\u539f\u59cb\u9875\u9762\u5b9a\u4e49\uff08originalPage\uff09\u3001\u5b9e\u4f8b\u5316\u9875\u9762\u914d\u7f6e(instancePage)</p> <p></p>"},{"location":"web/action/lcdp.html#_2","title":"\u6e32\u67d3\u9875\u9762\u903b\u8f91","text":"<p>\u9875\u9762\u5728\u6e32\u67d3\u7684\u65f6\u5019\uff0c\u53ea\u9700\u4e24\u4e2a\u63a5\u53e3\uff1a</p> <p>1\u3001\u5b9e\u4f8b\u9875\u9762\u6570\u636e\u7ed3\u6784 \uff1b2\u3001\u4e1a\u52a1\u6570\u636e\u3002</p> <p>\u524d\u7aef\u6839\u636e\u4e24\u4e2a\u63a5\u53e3\u5206\u6210\u4e24\u6b65\u6e32\u67d3\uff1a</p> <p>1\u3001\u521d\u59cb\u5316\u9875\u9762\u5e03\u5c40\uff1b2\u3001\u586b\u5145\u4e1a\u52a1\u6570\u636e\u3002</p> <p>template\u5b9a\u4e49</p> <p>\u5373\u662f\u5bf9\u9875\u9762\u7c7b\u578b\u7684\u5b9a\u4e49</p> <ul> <li>\u5217\u8868\u9875\u9762</li> <li>\u8be6\u60c5\u9875\u9762</li> <li>\u534a\u5f00\u9875\u9762</li> <li>\u8868\u5355\u63d0\u4ea4\u9875\u9762</li> </ul> <p>page\u5b9a\u4e49</p> <p>\u5b9a\u4e49\u4e00\u5f20\u524d\u7aef\u9875\u9762\uff0c\u5206\u6210\u4e24\u4e2a\u9636\u6bb5\uff1aorigin\uff1binstance\u3002</p> <p>origin\u662f\u5b9a\u4e49\u7684\u539f\u59cb\u9875\u9762\uff0c\u53ef\u4ee5\u7406\u89e3\u6210java \u7684Class\u7c7b\uff0c\u53ef\u4ee5\u6784\u5efa\u591a\u4e2a\u5b9e\u4f8b\u9875\u9762\u3002</p> <p>instance page\u662f\u6700\u7ec8\u6e32\u67d3\u7684\u8fd0\u884c\u6001\u3002</p> <p>\u9875\u9762\u7ed3\u6784\uff1a\u4e00\u4e2apage \u7531N\u4e2amodule\u7ec4\u6210\u3001\u4e00\u4e2amodule\u7531N\u4e2afield\u7ec4\u6210\u3002</p> <p></p> <p>module\u5b9a\u4e49</p> <ul> <li>\u4ee3\u8868\u9875\u9762\u663e\u793a\u533a\u57df\u5355\u5143\uff0c\u6709\u591a\u4e2a\u524d\u7aef\u7ec4\u4ef6\u7ec4\u6210\uff0c\u662f\u9875\u9762\u5bb9\u5668\u7684\u5e03\u5c40\u5355\u5143\uff1b</li> <li>module_code \u5168\u5c40\u552f\u4e00\uff0c\u5b9e\u4f8b\u5316\u540e\u7684module\u53ef\u88ab\u590d\u7528\u3001\u91cd\u5199\u3001\u5b9e\u73b0\u591a\u6001\uff1b</li> <li>modules \u6570\u636e\u7ed3\u6784\u4e3a\u4e00\u4e2a B+tree\uff0c\u53ea\u6709\u53f6\u5b50\u8282\u70b9\u662f\u6709\u5177\u4f53\u7684\u5b9e\u4f53\u6570\u636e\ufeff\uff08\u5b57\u6bb5\u548c\u5c5e\u6027\u914d\u7f6e\uff09\u3002</li> </ul> <p></p> <p>module_type \u5b9a\u4e49</p> <p>\u5bf9module\u7c7b\u578b\u7684\u5b9a\u4e49</p> <p>1\u3001\u4e3b\u5217\u8868\u67e5\u8be2\u6a21\u5757 MAIN_LIST_MODULE</p> <p>2\u3001\u5bfc\u51fa\u6a21\u5757 EXPORT_MODULE</p> <p>3\u3001\u5f39\u51fa\u9875\u9762\u6a21\u5757 FLOAT_PAGE_MODULE</p> <p>4\u3001\u641c\u7d22\u6761\u4ef6\u533a\u57df SEARCH_ARE_MODULE</p> <p>5\u3001\u5b50\u5217\u8868\u67e5\u8be2\u6a21\u5757 SUB_LIST_MODULE</p> <p>6\u3001\u7f16\u8f91\u8868\u5355\u6a21\u5757 EDIT_MODULE</p> <p>7\u3001\u4fe1\u606f\u5e73\u94fa\u5448\u73b0 DISPLAY_FLAT_MODULE</p> <p>\u6267\u884c\u5355\u5143\uff08moduleGroup executor\uff09</p> <p>\u4e3a\u4e86\u4fdd\u8bc1\u9875\u9762\u7684\u6570\u636e\u586b\u5145\u6548\u7387\uff0c\u6240\u4ee5\u5e76\u4e0d\u662f\u4e00\u4e2amodule\u7ed1\u5b9a\u4e00\u4e2a\u670d\u52a1\u63a5\u53e3\uff1a</p> <ul> <li>\u4e00\u4e2a\u6267\u884c\u5355\u5143\u5bf9\u5e94\u4e00\u4e2a\u6216\u591a\u4e2amodule\uff0c\u8d1f\u8d23\u591a\u4e2amodule\u7684\u6570\u636e\u6e32\u67d3\u548c\u6570\u636e\u5199\u5165\uff1b</li> <li>moduleGroup executor\u662f\u4e00\u4e2a\u9875\u9762\u8ba1\u7b97\u5355\u5143\uff1b</li> <li>\u901a\u8fc7moduleCode\u52a8\u6001\u8def\u7531\u5bf9\u5e94\u7684module group\uff0c\u6267\u884c\u76f8\u5e94\u7684\u8ba1\u7b97\u5355\u5143\uff1b</li> <li>\u6bcf\u4e2amodule \u6267\u884c\u5355\u5143\u81f3\u5c11\u90fd\u5305\u542b\u8bfb\u3001\u65b0\u589e\u3001\u7f16\u8f91\u548c\u5220\u9664\u63a5\u53e3</li> </ul> <p>\u9875\u9762\u4e0a\u7684\u6bcf\u4e00\u4e2amodule\u5c31\u81ea\u52a8\u7ed1\u5b9a\u4e86\u540e\u7aef\u7684\u4e1a\u52a1\u63a5\u53e3\uff0c\u5b9e\u73b0\u4e86\u524d\u540e\u7aef\u4e00\u4f53\u5316\u642d\u5efa\u3002</p> <p>field\u5b9a\u4e49</p> <p>\u4e00\u4e2amodule\u5bf9\u5e94\u591a\u4e2afield\u3002\u5982\u679c\u8981\u652f\u6301\u52a8\u6001\u6269\u5c55\uff0cmodule\u9700\u8981\u5bf9\u5e94\u4e00\u4e2a\u5b9e\u4f53\u6a21\u578b\u3002</p> <p>module\u53ea\u4ee3\u8868\u4e00\u4e2aVO\u5c42\u7684\u90e8\u5206\u663e\u793a\u7247\u6bb5\uff0c\u8981\u60f3\u8fbe\u5230\u5b57\u6bb5\u53ef\u4ee5\u52a8\u6001\u6269\u5c55\u9700\u8981\u5b9a\u4e49\u4e00\u5c42\u5b9e\u4f53\u6a21\u578b\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u8fd9\u6837\u624d\u80fd\u627e\u5230\u7edf\u4e00\u7684feature\u5bf9\u8c61\u53bb\u89e3\u6790\uff0c\u5b8c\u6210DO\u3001DTO\u3001VO\u7684\u76f8\u4e92\u81ea\u52a8\u8f6c\u6362\u3002</p> <p>\u5f53module\u9700\u8981\u52a8\u6001\u6269\u5c55\u7684\u65f6\u5019\uff0c\u4ece\u5b9e\u4f53\u6a21\u578b\u4e2d\u53bb\u9009\u62e9\u5df2\u7ecf\u5b9a\u4e49\u597d\u7684field\u3002</p> <p>\u56e0\u4e3a\u6211\u4eec\u7684VO\u4e5f\u662f\u52a8\u6001\u751f\u6210\u7684\uff0c\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u56e0\u4e3a\u65b0\u589e\u4e00\u4e2a\u5b57\u6bb5\u800c\u8fdb\u884c\u6a21\u578b\u53d8\u66f4\u6216\u8005\u4ee3\u7801\u53d1\u5e03\u3002\u5373\u5b9e\u73b00\u4ee3\u7801\u4e0a\u7ebf\u3002</p> <p>\u8fd0\u884c\u65f6\u7c7b\u8bbe\u8ba1\u56fe</p> <p></p> <p>\u6bcf\u4e00\u4e2a\u6a21\u5757\u80cc\u540e\u90fd\u4f1a\u7ed1\u5b9a\u4e00\u4e2a moduleGroup executor \uff0c\u4e1a\u52a1\u5f00\u53d1\u53ea\u9700\u901a\u8fc7\u5bf9\u8fd9\u4e2aexecutor\u5b9e\u73b0\uff0c\u5373\u53ef\u5feb\u901f\u5b8c\u6210\u5f00\u53d1\u4e0a\u7ebf\uff0c\u6574\u4e2a\u8fc7\u7a0b\u65e0\u9700\u524d\u7aef\u53c2\u4e0e\u3002\u7b80\u5355\u7684\u5b57\u6bb5\u6dfb\u52a0\u4e5f\u65e0\u9700\u53d1\u5e03\u4e0a\u7ebf\uff0c\u6211\u4eec\u4f1a\u901a\u8fc7\u52a8\u6001\u6269\u5c55\u6620\u5c04\u80cc\u540e\u7684DO\u6269\u5c55\u3002</p> <p>\ufeff\ufeff</p> <p></p>"},{"location":"web/action/msg_notify.html","title":"\u6d88\u606f\u5b9e\u65f6\u63a8\u9001\u65b9\u6848","text":"<p>\u9700\u6c42\uff1a\u5ba2\u6237\u7aef\u53ca\u65f6\u6536\u5230\u670d\u52a1\u7aef\u7684\u6d88\u606f\u901a\u77e5</p> <ul> <li>\u5bf9\u4e8e Gitee \u7b49\u7f51\u7ad9\uff0c\u5176\u6d88\u606f\u90fd\u662f\u754c\u9762\u5237\u65b0\u65f6\u624d\u901a\u77e5\uff0c\u6ce8\u610f\u5b9e\u65f6\u7684\u6027\u4ef7\u6bd4</li> </ul>"},{"location":"web/action/msg_notify.html#_2","title":"\u77ed\u8f6e\u8be2","text":"<p>\u77ed\u8f6e\u8be2\uff1a\u6307\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u7531\u6d4f\u89c8\u5668\u5411\u670d\u52a1\u5668\u53d1\u51fa<code>HTTP</code>\u8bf7\u6c42\uff0c\u670d\u52a1\u5668\u5b9e\u65f6\u8fd4\u56de\u672a\u8bfb\u6d88\u606f\u6570\u636e\u7ed9\u5ba2\u6237\u7aef\uff0c\u6d4f\u89c8\u5668\u518d\u505a\u6e32\u67d3\u663e\u793a\u3002</p> <ul> <li>\u5b9e\u73b0\uff1aJS\u5b9a\u65f6\u5668\uff1b</li> <li>\u7f3a\u70b9\uff1a\u63a8\u9001\u6570\u636e\u5e76\u4e0d\u4f1a\u9891\u7e41\u53d8\u66f4\uff0c\u65e0\u8bba\u540e\u7aef\u6b64\u65f6\u662f\u5426\u6709\u65b0\u7684\u6d88\u606f\u4ea7\u751f\uff0c\u5ba2\u6237\u7aef\u90fd\u4f1a\u8fdb\u884c\u8bf7\u6c42\uff0c\u52bf\u5fc5\u4f1a\u5bf9\u670d\u52a1\u7aef\u9020\u6210\u5f88\u5927\u538b\u529b\uff0c\u6d6a\u8d39\u5e26\u5bbd\u548c\u670d\u52a1\u5668\u8d44\u6e90\u3002</li> </ul>"},{"location":"web/action/msg_notify.html#comet","title":"\u957f\u8f6e\u8be2(Comet)","text":"<p>\u793a\u4f8b\u4ee3\u7801\u89c1\uff1aLongPullingCode</p> <p>\u5ba2\u6237\u7aef\u4e3b\u52a8\u62c9<code>pull</code>\u6a21\u578b\uff0c\u5e94\u7528\u957f\u8f6e\u8be2\uff08<code>Long Polling</code>\uff09</p> <ul> <li>\u7531\u670d\u52a1\u7aef\u63a7\u5236\u54cd\u5e94\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u8fd4\u56de\u65f6\u95f4\uff0c\u6765\u51cf\u5c11\u5ba2\u6237\u7aef\u65e0\u6548\u8bf7\u6c42\u7684\u4e00\u79cd\u4f18\u5316\u624b\u6bb5\uff1b</li> <li>\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42\u540e\uff0c\u670d\u52a1\u7aef\u4e0d\u4f1a\u7acb\u5373\u8fd4\u56de\u8bf7\u6c42\u7ed3\u679c\uff0c\u800c\u662f\u5c06\u8bf7\u6c42\u6302\u8d77\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff0c\u5982\u679c\u6b64\u6bb5\u65f6\u95f4\u5185\u670d\u52a1\u7aef\u6570\u636e\u53d8\u66f4\uff0c\u7acb\u5373\u54cd\u5e94\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u82e5\u662f\u4e00\u76f4\u65e0\u53d8\u5316\u5219\u7b49\u5230\u6307\u5b9a\u7684\u8d85\u65f6\u65f6\u95f4\u540e\u54cd\u5e94\u8bf7\u6c42\uff0c\u5ba2\u6237\u7aef\u91cd\u65b0\u53d1\u8d77\u957f\u94fe\u63a5\uff1b</li> </ul> <p></p>"},{"location":"web/action/msg_notify.html#_3","title":"\u5b9e\u73b0","text":"<ul> <li><code>DeferredResult</code> \u5728<code>servelet3.0</code>\u540e\u7ecf\u8fc7Spring\u5c01\u88c5\u63d0\u4f9b\u7684\u4e00\u79cd\u5f02\u6b65\u8bf7\u6c42\u673a\u5236</li> <li>\u5141\u8bb8\u5bb9\u5668\u7ebf\u7a0b\u5feb\u901f\u91ca\u653e\u5360\u7528\u7684\u8d44\u6e90\uff0c\u4e0d\u963b\u585e\u8bf7\u6c42\u7ebf\u7a0b\uff0c\u4ee5\u6b64\u63a5\u53d7\u66f4\u591a\u7684\u8bf7\u6c42\u63d0\u5347\u7cfb\u7edf\u7684\u541e\u5410\u91cf\u3002</li> <li>\u542f\u52a8\u5f02\u6b65\u5de5\u4f5c\u7ebf\u7a0b\u5904\u7406\u771f\u6b63\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u5904\u7406\u5b8c\u6210\u8c03\u7528<code>DeferredResult.setResult(200)</code>\u63d0\u4ea4\u54cd\u5e94\u7ed3\u679c\u3002</li> <li>\u4e00\u4e2aID\u53ef\u80fd\u4f1a\u88ab\u591a\u4e2a\u957f\u8f6e\u8be2\u8bf7\u6c42\u76d1\u542c\uff0c\u4f7f\u7528<code>guava</code>\u5305\u7684<code>Multimap</code>\u7ed3\u6784\uff0c\u4e00\u4e2akey\u5bf9\u5e94\u591a\u4e2avalue\u3002\u4e00\u65e6\u76d1\u542c\u5230key\u53d8\u5316\uff0c\u5bf9\u5e94\u7684\u6240\u6709\u957f\u8f6e\u8be2\u90fd\u4f1a\u54cd\u5e94\uff1b</li> <li>\u8bf7\u6c42\u8d85\u8fc7\u8bbe\u7f6e\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4f1a\u629b\u51fa<code>AsyncRequestTimeoutException</code>\u5f02\u5e38\uff0c\u5168\u5c40\u6355\u83b7\u7edf\u4e00\u8fd4\u56de\uff0c\u524d\u7aef\u83b7\u53d6\u7ea6\u5b9a\u597d\u7684\u72b6\u6001\u7801\u540e\u518d\u6b21\u53d1\u8d77\u957f\u8f6e\u8be2\u8bf7\u6c42\u3002</li> <li>\u524d\u7aef\u5f97\u5230\u975e\u8bf7\u6c42\u8d85\u65f6\u7684\u72b6\u6001\u7801\uff0c\u77e5\u6653\u6570\u636e\u53d8\u66f4\uff0c\u4e3b\u52a8\u67e5\u8be2\u672a\u8bfb\u6d88\u606f\u6570\u63a5\u53e3\uff0c\u66f4\u65b0\u9875\u9762\u6570\u636e\uff1b</li> </ul> <p>\u6ce8\u610f\uff1a</p> <ul> <li>\u7ade\u6001\u5206\u6790\uff1a\u5982\u679c\u5728\u524d\u7aef\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u540e\u7aef\u63a5\u6536\u5230\u65b0\u6d88\u606f\uff0c\u6b64\u65f6\u524d\u7aef\u8fd8\u6ca1\u6709\u5efa\u7acb\u8fde\u63a5\uff0c\u8be5\u6d88\u606f\u4f1a\u4e22\u5931\uff0c\u9700\u8981\u6839\u636e\u4e1a\u52a1\u8bbe\u8ba1\u76f8\u5e94\u65b9\u6848\uff1b</li> </ul>"},{"location":"web/action/msg_notify.html#_4","title":"\u7f3a\u70b9","text":"<p>\u957f\u8f6e\u8be2\u76f8\u6bd4\u4e8e\u77ed\u8f6e\u8be2\u5728\u6027\u80fd\u4e0a\u63d0\u5347\u4e86\u5f88\u591a\uff0c\u4f46\u4f9d\u7136\u4f1a\u4ea7\u751f\u8f83\u591a\u7684\u8bf7\u6c42\uff0c\u5728\u54cd\u5e94\u4e4b\u540e\uff0c\u4f1a\u5f15\u8d77\u8bf7\u6c42\u7a81\u7136\u6fc0\u589e\u3002</p>"},{"location":"web/action/msg_notify.html#sse","title":"SSE","text":"<p>\u4e0d\u5e94\u8be5\u8bbe\u7f6e WriteTimeOut\uff0c\u793a\u4f8b\u4ee3\u7801\u89c1\uff1aSSE \u4ee3\u7801</p> <p>\u670d\u52a1\u5668\u53d1\u9001\u4e8b\u4ef6(<code>Server-sent events</code>)\uff0c\u7b80\u79f0<code>SSE</code>\u3002</p> <p>SSE\u5728\u670d\u52a1\u5668\u548c\u5ba2\u6237\u7aef\u4e4b\u95f4\u6253\u5f00\u4e00\u4e2a\u5355\u5411\u901a\u9053\uff0c\u670d\u52a1\u7aef\u54cd\u5e94\u7684\u4e0d\u518d\u662f\u4e00\u6b21\u6027\u7684\u6570\u636e\u5305\u800c\u662f<code>text/event-stream</code>\u7c7b\u578b\u7684\u6570\u636e\u6d41\u4fe1\u606f\uff0c\u5728\u6709\u6570\u636e\u53d8\u66f4\u65f6\u4ece\u670d\u52a1\u5668\u6d41\u5f0f\u4f20\u8f93\u5230\u5ba2\u6237\u7aef\u3002</p> <p>\u6ce8\uff1aSSE\u4e0d\u652f\u6301<code>IE</code>\u6d4f\u89c8\u5668\uff0c\u5bf9\u5176\u4ed6\u4e3b\u6d41\u6d4f\u89c8\u5668\u517c\u5bb9\u6027\u505a\u7684\u8fd8\u4e0d\u9519\u3002</p>"},{"location":"web/action/msg_notify.html#ssewebsocket","title":"SSE\u4e0eWebsocket\u7684\u533a\u522b","text":"WebSocket SSE \u5168\u53cc\u5de5\uff0c\u53ef\u4ee5\u540c\u65f6\u53d1\u9001\u548c\u63a5\u6536\u6d88\u606f \u5355\u5de5\uff0c\u53ea\u80fd\u670d\u52a1\u7aef\u5355\u5411\u53d1\u9001\u6d88\u606f \u72ec\u7acb\u7684\u534f\u8bae \u57fa\u4e8eHTTP\u534f\u8bae \u9700\u8981\u4ee3\u7406\u670d\u52a1\u5668\u5355\u72ec\u652f\u6301 \u4ee3\u7406\u670d\u52a1\u5668\u76f4\u63a5\u652f\u6301 \u534f\u8bae\u76f8\u5bf9\u590d\u6742 \u534f\u8bae\u76f8\u5bf9\u7b80\u5355\uff0c\u6613\u4e8e\u7406\u89e3\u548c\u4f7f\u7528 \u9ed8\u8ba4\u4e0d\u652f\u6301\u65ad\u7ebf\u91cd\u8fde \u9ed8\u8ba4\u652f\u6301\u65ad\u7ebf\u91cd\u8fde \u9ed8\u8ba4\u652f\u6301\u4f20\u9001\u4e8c\u8fdb\u5236\u6570\u636e \u4e00\u822c\u53ea\u7528\u6765\u4f20\u9001\u6587\u672c\uff0c\u4e8c\u8fdb\u5236\u6570\u636e\u9700\u8981\u7f16\u7801\u540e\u4f20\u9001 \u4e0d\u652f\u6301\u81ea\u5b9a\u4e49\u53d1\u9001\u7684\u6570\u636e\u7c7b\u578b \u652f\u6301\u81ea\u5b9a\u4e49\u53d1\u9001\u7684\u6570\u636e\u7c7b\u578b \u652f\u6301CORS \u4e0d\u652f\u6301CORS\uff0c\u534f\u8bae\u548c\u7aef\u53e3\u90fd\u5fc5\u987b\u76f8\u540c <ul> <li>\u4ee51\u6b21/\u79d2\u6216\u8005\u66f4\u5feb\u7684\u9891\u7387\u5411\u670d\u52a1\u7aef\u4f20\u8f93\u6570\u636e\uff0c\u90a3\u5e94\u8be5\u7528WebSocket\uff1b</li> <li>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u811a\u672c\u4e4b\u95f4\u5177\u6709\u7f51\u7edc\u670d\u52a1\u5668\u60c5\u51b5\u65f6\uff0c\u4e00\u4e2aSSE\u8fde\u63a5\u4e0d\u4ec5\u4f7f\u7528\u4e00\u4e2a\u5957\u63a5\u5b57\uff0c\u8fd8\u4f1a\u5360\u7528\u4e00\u4e2aApache\u7ebf\u7a0b\u6216\u8fdb\u7a0b\uff1b</li> </ul>"},{"location":"web/action/msg_notify.html#_5","title":"\u5b9e\u73b0","text":"<p>\u5ba2\u6237\u7aef\uff1a\u901a\u8fc7 <code>EventSource</code>\u5efa\u7acb\u8fde\u63a5\uff1b</p> <ul> <li>\u4f1a\u81ea\u52a8\u65ad\u7ebf\u91cd\u8fde\uff08\u5982\u8d85\u65f6\u91cd\u8fde\uff09\uff0c\u5e76\u4e14\u4f1a\u53d1\u9001<code>Last-Event-ID</code> header</li> </ul> <p>\u670d\u52a1\u7aef\uff1aSpringboot \u901a\u8fc7 <code>SseEmitter</code>\u5b9e\u73b0\uff1b</p> <ul> <li>SSE\u6d88\u606f\u7684\u683c\u5f0f\u4e3a<code>field:value\\nfield:value\\n\\n</code>\uff0c field \u652f\u6301\u5982\u4e0b</li> </ul> <pre><code>\u7a7a: \u5373\u4ee5:\u5f00\u5934\uff0c\u8868\u793a\u6ce8\u91ca\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u670d\u52a1\u7aef\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u5fc3\u8df3\uff0c\u786e\u4fdd\u8fde\u63a5\u4e0d\u4e2d\u65ad\ndata\uff1a\u6570\u636e\nevent: \u4e8b\u4ef6\uff0c\u9ed8\u8ba4\u503c\u4e3a message\uff0c\u5982\u679c\u662f\u5176\u5b83\u4e8b\u4ef6\uff0c\u524d\u7aef\u53ef\u4ee5\u901a\u8fc7 addEventListener \u76d1\u542c\u4e0d\u540c\u7684\u4e8b\u4ef6\nid: \u6570\u636e\u6807\u8bc6\u7b26\u7528 id \u5b57\u6bb5\u8868\u793a\uff0c\u76f8\u5f53\u4e8e\u6bcf\u4e00\u6761\u6570\u636e\u7684\u7f16\u53f7\nretry: \u91cd\u8fde\u65f6\u95f4\n</code></pre>"},{"location":"web/action/msg_notify.html#nginx-sse","title":"Nginx \u8f6c\u53d1 SSE","text":"<ul> <li>nginx upstream \u8d85\u65f6\u8fde\u63a5\u5173\u95ed\uff08upstream timeout\uff09\u65f6\uff0c\u524d\u7aef\u4f1a\u81ea\u52a8\u8fdb\u884c\u91cd\u8fde\uff1b</li> </ul> <pre><code>proxy_set_header Upgrade $http_upgrade;\nproxy_set_header Connection \"upgrade\";\nproxy_http_version 1.1;\n\n# Nginx \u9ed8\u8ba4 OFF\nproxy_cache off;\n\n# \u5e94\u8be5\u7531 server \u7aef\u53d1\u9001 X-Accel-Buffering: no; \n# \u9488\u5bf9 proxy_pass \u7684\u540e\u7aef\u914d\u7f6e\uff0c\u597d\u50cf\u4e0d\u9700\u8981\u914d\u7f6e\uff0c\u5373\u4f7f\u5f00\u542f\u524d\u7aef\u4e5f\u4f1a\u5b9e\u65f6\u54cd\u5e94\n# proxy_buffering off;\n\n# \u8be5\u914d\u7f6e\u5bf9\u4e8eSSE\u4e0d\u9700\u8981\n# chunked_transfer_encoding off;\n</code></pre>"},{"location":"web/action/msg_notify.html#mqtt","title":"MQTT","text":"<p><code>MQTT</code> \u5168\u79f0(Message Queue Telemetry Transport)\uff1a\u4e00\u79cd\u57fa\u4e8e\u53d1\u5e03/\u8ba2\u9605\uff08<code>publish</code>/<code>subscribe</code>\uff09\u6a21\u5f0f\u7684<code>\u8f7b\u91cf\u7ea7</code>\u901a\u8baf\u534f\u8bae\uff0c\u901a\u8fc7\u8ba2\u9605\u76f8\u5e94\u7684\u4e3b\u9898\u6765\u83b7\u53d6\u6d88\u606f\uff0c\u662f\u7269\u8054\u7f51\uff08<code>Internet of Thing</code>\uff09\u4e2d\u7684\u4e00\u4e2a\u6807\u51c6\u4f20\u8f93\u534f\u8bae\u3002</p> <p>\u5c06\u6d88\u606f\u7684\u53d1\u5e03\u8005\uff08<code>publisher</code>\uff09\u4e0e\u8ba2\u9605\u8005\uff08<code>subscriber</code>\uff09\u8fdb\u884c\u5206\u79bb\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728\u4e0d\u53ef\u9760\u7684\u7f51\u7edc\u73af\u5883\u4e2d\uff0c\u4e3a\u8fdc\u7a0b\u8fde\u63a5\u7684\u8bbe\u5907\u63d0\u4f9b\u53ef\u9760\u7684\u6d88\u606f\u670d\u52a1\uff0c\u4f7f\u7528\u65b9\u5f0f\u4e0e\u4f20\u7edf\u7684MQ\u6709\u70b9\u7c7b\u4f3c\u3002</p>"},{"location":"web/action/msg_notify.html#_6","title":"\u5b9e\u73b0","text":"<p>https://mp.weixin.qq.com/s/U-fUGr9i1MVa4PoVyiDFCg</p>"},{"location":"web/action/msg_notify.html#websocket","title":"WebSocket","text":"<p>\u5728<code>TCP</code>\u8fde\u63a5\u4e0a\u8fdb\u884c\u5168\u53cc\u5de5\u901a\u4fe1\u7684\u534f\u8bae</p>"},{"location":"web/action/msg_notify.html#sockjs","title":"SOCKJS","text":"<p>\u5f53\u4eca\u4e3b\u6d41\u6d4f\u89c8\u5668\u90fd\u652f\u6301 Websocket\uff0c\u56e0\u6b64 SOCKJS \u4e0d\u518d\u9700\u8981</p> <ul> <li>\u9664\u975e\u53cd\u5411\u4ee3\u7406\uff08\u5982Nginx\uff09\u7684\u914d\u7f6e\u4e0d\u652f\u6301WebSocket.</li> </ul> <p>\u4f7f\u7528 SOCKJS \uff08\u6a21\u62df Websocket \u534f\u8bae\uff09</p> <ul> <li>sockjs-client \u63d0\u4f9b\u6d4f\u89c8\u5668\u517c\u5bb9\u6027\uff0c\u4f18\u5148\u4f7f\u7528\u539f\u751f\u7684WebSocket\uff0c\u5982\u679c\u67d0\u4e2a\u6d4f\u89c8\u5668\u4e0d\u652f\u6301WebSocket\uff0cSockJS\u4f1a\u81ea\u52a8\u964d\u7ea7\u4e3aSSE \u6216\u8005 \u957f\u8f6e\u8be2\uff1b</li> </ul> <p>\u5fc3\u8df3</p> <ul> <li>SockJS \u534f\u8bae\u8981\u6c42 servers \u53d1\u9001\u5fc3\u8df3\u6d88\u606f\uff0c\u6392\u9664\u4ee3\u7406\u5bfc\u81f4\u7684\u8fde\u63a5\u6302\u8d77\u3002\uff08Spring SockJS \u9ed8\u8ba4 <code>heartbeatTime</code> \u4e3a 25s\uff09\uff1b</li> <li>When using STOMP over WebSocket and SockJS, if the STOMP client and server negotiate heartbeats to be exchanged, the SockJS heartbeats are disabled.</li> </ul>"},{"location":"web/action/msg_notify.html#stomp","title":"STOMP","text":"<p>\u4f7f\u7528 STOMP\uff08\u5b9a\u4e49Websocket\u7684\u6570\u636e\u683c\u5f0f\uff09\uff0c\u6d88\u606f\u7684\u8ba2\u9605\u548c\u53d1\u9001\u3002</p> <ul> <li>STOMP\u5373Simple Text Orientated Messaging Protocol\uff0c\u7b80\u5355\u6587\u672c\u5b9a\u5411\u6d88\u606f\u534f\u8bae\uff1b</li> <li>stompjs \u5ba2\u6237\u7aef\uff0c1.1 \u7248\u672c\u63d0\u4f9b\u5fc3\u8df3\u673a\u5236\uff08\u9ed8\u8ba410s\uff0c\u4f46\u4f1a\u8ddf broker \u8fde\u63a5\u65f6\u534f\u8c03\u51fa\u6700\u7ec8\u7684in/out\u5fc3\u8df3\uff09\uff1b</li> <li>\u8fde\u63a5\u7a33\u5b9a\u6027\uff0c\u652f\u6301\u81ea\u52a8\u91cd\u8fde\uff1b</li> </ul> <p>\u4e8b\u52a1\u652f\u6301</p> <pre><code>// start the transaction\nconst tx = client.begin();\n// send the message in a transaction\nclient.publish({\n  destination: '/queue/test',\n  headers: { transaction: tx.id },\n  body: 'message in a transaction',\n});\n// commit the transaction to effectively send the message\ntx.commit();\n</code></pre>"},{"location":"web/action/msg_notify.html#spring","title":"Spring","text":"<p>https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#websocket-server</p> <p>On the Servlet stack, the Spring Framework provides both server (and also client) support for the SockJS protocol\uff1b</p> <ul> <li>\u8de8\u57df\u95ee\u9898\uff0cthe default behavior for WebSocket and SockJS is to accept only same-origin requests. \uff1b</li> <li>nginx \u914d\u7f6e <code>proxy_set_header Host $host;</code></li> <li> <p>\u6216\u8005 spring \u914d\u7f6e <code>setAllowedOriginPatterns(\"*\")</code>\uff1b</p> </li> <li> <p>\u4e8b\u4ef6\u95ee\u9898\uff1a</p> </li> <li><code>SessionDisconnectEvent</code>\u9700\u8981\u5e42\u7b49\u5904\u7406\uff0c\u4e00\u4e2aWS\u8fde\u63a5(Session)\u53ef\u80fd\u4f1a\u88ab\u53d1\u9001\u591a\u6b21\uff1b</li> </ul>"},{"location":"web/action/msg_notify.html#simple-broker","title":"Simple Broker","text":"<p>The built-in simple message broker handles subscription requests from clients, stores them in memory, and broadcasts messages to connected clients that have matching destinations. </p> <p>\u7eaf WebSocket \u7684\u5fc3\u8df3\u95ee\u9898\uff08\u4e0d\u4f7f\u7528 SockJS\uff09\uff1a</p> <ul> <li>\u663e\u5f0f\u5b9a\u4e49Client/Server\u7684\u5fc3\u8df3</li> </ul>"},{"location":"web/action/msg_notify.html#broker","title":"\u5916\u90e8 Broker","text":"<p>\u652f\u6301 RabbitMQ, ActiveMQ \u7b49</p>"},{"location":"web/action/msg_notify.html#_7","title":"\u8ba4\u8bc1","text":"<p>\u901a\u8fc7<code>configureClientInboundChannel()</code>\u6ce8\u518c\u6d88\u606f\u5904\u7406\uff0c\u8fdb\u884c\u9a8c\u8bc1\u3002</p>"},{"location":"web/action/msg_notify.html#nginx-websocket","title":"nginx \u8f6c\u53d1 Websocket","text":"<pre><code>proxy_set_header Upgrade $http_upgrade;\nproxy_set_header Connection \"upgrade\";\nproxy_http_version 1.1;\n</code></pre> <p>proxied server \u7aef\u9700\u8981\u5b9a\u65f6\u53d1\u9001 PING \u6d88\u606f\u4fdd\u8bc1 nginx \u4e0d\u4f1a\u5173\u95ed\u8fde\u63a5\u3002</p>"},{"location":"web/action/peerjs.html","title":"PeerJS","text":"<p>\u7b80\u5316 WebRTC \u7684\u70b9\u5bf9\u70b9\u901a\u4fe1\u3001\u89c6\u9891\u3001\u97f3\u9891\u8c03\u7528\u3002</p>"},{"location":"web/action/peerjs.html#webrtc","title":"WebRTC","text":"<p>WebRTC\uff08Web Real Time Communication\uff09\u4e5f\u53eb\u505a \u7f51\u7edc\u5b9e\u65f6\u901a\u4fe1\uff0c\u5b83\u53ef\u4ee5 \u5141\u8bb8\u7f51\u9875\u5e94\u7528\u4e0d\u901a\u8fc7\u4e2d\u95f4\u670d\u52a1\u5668\u5c31\u80fd\u4e92\u76f8\u76f4\u63a5\u4f20\u8f93\u4efb\u610f\u6570\u636e\uff0c\u6bd4\u5982\u89c6\u9891\u6d41\u3001\u97f3\u9891\u6d41\u3001\u6587\u4ef6\u6d41\u3001\u666e\u901a\u6570\u636e\u7b49</p> <ul> <li>\u6355\u83b7\u89c6\u9891\u548c\u97f3\u9891\u6d41</li> <li>\u8fdb\u884c\u97f3\u9891\u548c\u89c6\u9891\u901a\u4fe1</li> <li>\u8fdb\u884c\u4efb\u610f\u6570\u636e\u7684\u901a\u4fe1</li> </ul>"},{"location":"web/action/peerjs.html#peerjs-server","title":"PeerJS Server","text":"<p>peers/peerjs-server: Server for PeerJS (github.com)</p>"},{"location":"web/action/peerjs.html#_1","title":"\u8fd0\u884c","text":"<p>Native</p> <pre><code># Install the package globally\n$ npm install peer -g\n# Run the server\n$ peerjs --port 9000 --key peerjs --path /myapp\n</code></pre> <p>Docker</p> <pre><code>$ docker run -p 9000:9000 -d peerjs/peerjs-server\n</code></pre> <p>Kubernetes</p> <pre><code>$ kubectl run peerjs-server --image=peerjs/peerjs-server --port 9000 --expose -- --port 9000 --path /myapp\n</code></pre> <p>Server \u8fd0\u884c\u7684\u4ee3\u7801</p> <pre><code>const { PeerServer } = require('peer');\n\nconst peerServer = PeerServer({ port: 9000, path: '/myapp' });\n</code></pre>"},{"location":"web/action/peerjs.html#_2","title":"\u8fde\u63a5","text":"<p>Connecting to the server from client PeerJS</p> <pre><code>&lt;script&gt;\n    const peer = new Peer('someid', {\n      host: 'localhost',\n      port: 9000,\n      path: '/myapp'\n    });\n&lt;/script&gt;\n</code></pre>"},{"location":"web/action/peerjs.html#peerjs-client","title":"PeerJS Client","text":""},{"location":"web/action/peerjs.html#_3","title":"\u793a\u4f8b","text":""},{"location":"web/action/peerjs.html#_4","title":"\u6d88\u606f\u53d1\u9001","text":"<pre><code>// \u521b\u5efa\u8fde\u63a5\uff0c\u521d\u59cb\u4f1a\u8ddf PeerServer \u901a\u4fe1\nconst peer = new Peer({ host: 'localhost', port: 9000, path: '/myapp' });\n// \u53d1\u9001\nconst conn = peer.current.connect(friendId);\nconn.on('open', () =&gt; {\n  console.log('Connected.');\n  conn.send({ id, msg: 'Hello, my friend!' });\n});\n\n// \u63a5\u6536\npeer.current.on('connection', conn =&gt; {\n  conn.on('data', data =&gt; {\n    const received = data as SendData;\n      console.log(`Data from Peer(id: ${received.id}) =&gt; ${received.msg}`);\n    });\n});\n</code></pre>"},{"location":"web/action/peerjs.html#_5","title":"\u5171\u4eab\u684c\u9762\u89c6\u9891\u6d41\u6355\u83b7\u53ca\u4f20\u8f93","text":"<p>\u5173\u952e\u4ee3\u7801</p> <pre><code>// \u53d1\u9001\u684c\u9762\u89c6\u9891\u6d41\nconst sendMediaStream = () =&gt; {\n  try {\n    window.navigator.mediaDevices.getDisplayMedia({ video: true })\n      .then(mediaStream =&gt; {\n        peer.current.call(friendId, mediaStream);\n      });\n  } catch (e) {\n    console.error(e);\n    alert('Send failed.');\n  }\n};\n\n// \u63a5\u6536\u684c\u9762\u89c6\u9891\u6d41\u4fe1\u606f\npeer.current.on('call', call =&gt; {\n  call.answer();\n  call.on('stream', remoteStream =&gt; {\n    if (myVideo.current) {\n      myVideo.current.srcObject = remoteStream;\n      myVideo.current.play();\n    }\n  });\n});\n</code></pre>"},{"location":"web/action/permission.html","title":"\u8ba4\u8bc1\u6388\u6743","text":""},{"location":"web/action/permission.html#rbac","title":"RBAC \u5b9e\u8df5","text":"<p>[\u8bd1] \u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff08RBAC\uff09\uff1a\u6f14\u8fdb\u5386\u53f2\u3001\u8bbe\u8ba1\u7406\u5ff5\u53ca\u7b80\u6d01\u5b9e\u73b0\uff08Tailscale, 2021\uff09 (arthurchiao.art)</p> <p>\u6839\u636e\u7528\u6237\u7c7b\u578b\uff08user types\uff09\u800c\u975e \u6587\u4ef6\u7c7b\u578b\uff08file types\uff09\u6765\u521b\u5efa user groups</p> <p>\u8fd8\u6ca1\u6709\u8c01\u5b9e\u73b0\u8fc7\u5b8c\u6574\u7684 RBAC \u6a21\u578b\uff1a</p> <ol> <li>\u6bcf\u4e2a\u4eba\u90fd\u662f\u4e00\u4e2a User (subject)\u3002</li> <li>\u6bcf\u4e2a user \u90fd\u6709\u4e00\u4e2a\u6216\u591a\u4e2a Roles\u3002</li> <li>\u6bcf\u4e2a object\uff08resource\uff09 \u90fd\u6709\u4e00\u4e2a\u6216\u591a\u4e2a Tags\u3002</li> <li>\u4e00\u6761 \u201csecurity policy\u201d \u5b9a\u4e49\u4e00\u4e2a\u5c06 <code>(Role, Tag)</code> \u8f6c\u6362\u6210 Entitlements \u7684 \u516c\u5f0f\u3002</li> <li>\u4e00\u4e2a\u6267\u884c\u5c42\uff08enforcement layer\uff09\u8d1f\u8d23 enforce security policy\uff0c\u5e76\u4e3a\u6bcf\u4e2a object \u751f\u6210\u6709\u6548 entitlements \u5217\u8868\uff08ACL\uff09\u3002</li> </ol> <p>\u6700\u7ec8\u7684\u4ea7\u54c1\u5728\u7406\u5ff5\u8bbe\u8ba1\u4e0a\u5f88\u7b80\u6d01\uff1a</p> <ol> <li>Device \u6216 container \u7684 owner \u53ef\u4ee5\u8bbe\u7f6e tag\uff1b</li> <li>\u5b89\u5168\u56e2\u961f\u51b3\u5b9a\u8c01 own \u54ea\u4e9b tag\u3001\u6bcf\u4e2a tag \u5173\u8054\u4e86\u54ea\u4e9b permissions\u3001tags \u4f1a\u6388\u6743\u7ed9\u54ea\u4e9b roles\uff1b</li> <li>Identity/HR \u56e2\u961f\u51b3\u5b9a\u54ea\u4e9b users \u5e94\u8be5\u5c5e\u4e8e\u54ea\u4e9b roles\u3002</li> </ol>"},{"location":"web/action/permission.html#_2","title":"\u9274\u6743\u914d\u7f6e","text":"<p>\u5982\u4f55\u5728\u63a5\u53e3\u4fe1\u606f\u4e0a\uff0c\u751f\u6210\u63a5\u53e3\uff08\u6570\u636e\uff09\u6743\u9650\u4fe1\u606f</p> <ul> <li>\u63a5\u53e3\u6743\u9650\u901a\u8fc7\u6ce8\u89e3\uff0c\u5728Controller\u7684\u65b9\u6cd5\u4e0a\uff0c\u6bcf\u4e2a\u670d\u52a1\u5171\u7528\u540c\u6837\u7684\u62e6\u622a\u5668\u7edf\u4e00\u9274\u6743\uff1a</li> <li>\u63a5\u53e3\u6743\u9650\u901a\u8fc7\u6570\u636e\u5e93\uff0c\u4ec5\u5728\u7f51\u5173\u4e0a\u5355\u72ec\u62e6\u622a\u5668\u7edf\u4e00\u9274\u6743\uff1a</li> <li>\u542f\u52a8\u65f6\uff0c\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u6240\u6709\u63a5\u53e3\u6743\u9650\uff1b</li> </ul>"},{"location":"web/action/permission.html#_3","title":"\u83dc\u5355\u6743\u9650","text":"<p>\u9875\u9762\u4ece\u5f62\u5f0f\u4e0a\uff0c\u5206\u4e3a <code>\u76ee\u5f55</code>\uff0c<code>\u83dc\u5355</code>\uff0c<code>\u6309\u94ae</code>\u4e09\u79cd</p> <ul> <li>\u76ee\u5f55\uff1a\u4e00\u822c\u6765\u8bf4\uff0c\u76ee\u5f55\u4e0d\u5173\u8054\u5177\u4f53\u7684\u9875\u9762\uff08\u5373\u65e0\u6cd5\u70b9\u51fb\u5230\u9875\u9762\uff09\uff0c\u5305\u542b\u83dc\u5355\u6216\u8005\u5b50\u76ee\u5f55\uff1b</li> <li>\u76ee\u5f55\u4e5f\u53ef\u4ee5\u8df3\u8f6c\u5230\u76f8\u5e94\u7684\u8def\u7531\u5730\u5740\uff08\u5916\u94fe\u60c5\u5f62\uff09\uff1b</li> <li>\u83dc\u5355\uff1a\u53ef\u70b9\u51fb\u8df3\u8f6c\u5230\u5bf9\u5e94\u7684\u8def\u7531\u9875\u9762</li> <li>\u53ef\u5bf9\u5e94\u6743\u9650\u6807\u8bc6</li> <li>\u6309\u94ae</li> <li>\u6309\u94ae\u5bf9\u5e94\u76f8\u5173\u7684\u6743\u9650\u6807\u8bc6</li> </ul> <p>\u63a5\u53e3\u5bf9\u5e94\u76f8\u5e94\u7684\u6309\u94ae</p> <ul> <li>\u67e5\u8be2\uff1a\u53ef\u80fd\u4e0d\u63d0\u4f9b\u6309\u94ae\uff0c\u70b9\u51fb\u9875\u9762\u65f6\u9ed8\u8ba4\u67e5\u8be2\uff1b\uff08\u4e00\u822c\u6765\u8bf4\uff0c\u67e5\u8be2\u4e0d\u505a\u63a5\u53e3\u6743\u9650\u9a8c\u8bc1\uff09</li> <li>\u4fee\u6539\u548c\u5220\u9664\u7b49\uff1a\u5177\u4f53\u7684\u6309\u94ae\u64cd\u4f5c\uff1b</li> </ul> <p>\u53ef\u80fd\u4f1a\u51fa\u73b0\u63a5\u53e3 A \u5728\u5185\u90e8\u8c03\u7528\u5176\u4ed6\u670d\u52a1 \u63a5\u53e3\uff0c\u56e0\u6b64\u670d\u52a1\u5185\u90e8\u95f4\u4e0d\u9700\u8981\u63a5\u53e3\u6743\u9650\u7684\u9a8c\u8bc1\uff1a</p> <ul> <li>\u5177\u5907\u63a5\u53e3A\u7684\u6743\u9650\uff0c\u5219\u9ed8\u8ba4\u5176\u6240\u6709\u8c03\u7528\u7684\u5b50\u63a5\u53e3\u90fd\u5e94\u8be5\u5177\u5907\u8bbf\u95ee\u7684\u6743\u9650\uff1b</li> <li>\u6bcf\u4e2a\u670d\u52a1\u5355\u72ec\u8fdb\u884c\u63a5\u53e3\u9274\u6743\uff1a</li> <li>\u670d\u52a1\u5bf9\u5916\u63a5\u53e3\u91c7\u7528REST\u5e76\u914d\u7f6e\u62e6\u622a\u9274\u6743\uff1b</li> <li>\u670d\u52a1\u95f4\u8c03\u7528\u4f7f\u7528Dubbo\u7b49\u5b9a\u4e49\u65b0\u7684\u63a5\u53e3\uff0c\u4e0d\u8fdb\u884c\u9274\u6743\uff1b</li> <li>\u7edf\u4e00\u7f51\u5173\u5904\u8fdb\u884c\u63a5\u53e3\u9274\u6743\uff1a</li> <li>\u670d\u52a1\u5185\u90e8\u4e0d\u9700\u8981\u914d\u7f6e\u62e6\u622a\u9274\u6743\uff0c\u5185\u90e8\u901a\u4fe1\u76f4\u8fde\uff1b</li> </ul>"},{"location":"web/action/permission.html#_4","title":"\u6570\u636e\u6743\u9650","text":"<ul> <li>\u7528\u6237\u80fd\u591f\u67e5\u770b\u7ec4\u7ec7\u4e0b\u7684\u7528\u6237\uff0c\u5e76\u8fdb\u884c\u76f8\u5e94\u7684\u4fee\u6539\uff1b</li> <li>\u5f53\u524d\u7528\u6237\u521b\u5efa\u7684\u8d44\u6e90\uff0c\u5176\u5b83\u4eba\u662f\u5426\u80fd\u591f\u770b\u5230\uff1f</li> <li></li> </ul> <p>\u6570\u636e\u6743\u9650\u5206\u4e3a\uff1a</p> <ul> <li>\u662f\u5426\u80fd\u591f\u64cd\u4f5c\u5177\u4f53\u7684\u6570\u636e\uff1b\uff08\u4e8b\u524d\u6821\u9a8c\uff09</li> <li>\u80fd\u591f\u67e5\u770b\u54ea\u4e9b\u5177\u4f53\u7684\u6570\u636e\uff1b\uff08\u4e8b\u540e\u8fc7\u6ee4\uff09</li> </ul> <p>\u57fa\u4e8e Mybatis plus interceptor + \u81ea\u5b9a\u4e49\u6ce8\u89e3\u5b9e\u73b0\u3002</p> <ul> <li>\u5728\u8fdb\u884c<code>Select/Update/Delete</code>\u65f6\uff0c\u5bf9 <code>where</code> \u8bed\u53e5\u8fdb\u884c\u6269\u5145\uff0c\u5b9e\u73b0\u6570\u636e\u6743\u9650\uff1b</li> </ul> <p>\u6ce8\uff1amybatis plus 3.5 \u7248\u672c\u63d0\u4f9b<code>DataPermissionInterceptor</code>\uff0c\u4f46\u5b98\u7f51\u672a\u63d0\u53ca\u5982\u4f55\u4f7f\u7528 </p> <pre><code>@Bean\npublic MybatisPlusInterceptor mybatisPlusInterceptor() {\n    MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();\n\n    // \u6dfb\u52a0\u6570\u636e\u6743\u9650\u63d2\u4ef6\n    DataPermissionInterceptor dataPermissionInterceptor=new DataPermissionInterceptor();\n    MyDataPermissionHandler myDataPermissionHandler=new MyDataPermissionHandler();\n    // \u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684\u6570\u636e\u6743\u9650\u5904\u7406\u5668\n    dataPermissionInterceptor.setDataPermissionHandler(myDataPermissionHandler);\n    interceptor.addInnerInterceptor(dataPermissionInterceptor);\n\n    return interceptor;\n}\n\n// \u7ee7\u627f DataPermissionHandler\uff0c\u5b9e\u73b0 getSqlSegment\n// MultiDataPermissionHandler (\u652f\u6301\u591a\u8868\u7684\u6570\u636e\u6743\u9650\u5904\u7406\u5668)\npublic class MyDataPermissionHandler implements DataPermissionHandler {\n\n    /**\n     * @param where             \u539fSQL Where \u6761\u4ef6\u8868\u8fbe\u5f0f\n     * @param mappedStatementId Mapper\u63a5\u53e3\u65b9\u6cd5ID\n     * @return\n     */\n    @SneakyThrows\n    @Override\n    public Expression getSqlSegment(Expression where, String mappedStatementId) {\n        log.info(\"=========================== start MyDataPermissionHandler\");\n        // 1. \u6a21\u62df\u83b7\u53d6\u767b\u5f55\u7528\u6237\uff0c\u4ece\u7528\u6237\u4fe1\u606f\u4e2d\u83b7\u53d6\u90e8\u95e8ID\n        Random random = new Random();\n        int userDeptId = random.nextInt(9) + 1; // \u968f\u673a\u90e8\u95e8ID 1-10 \u968f\u673a\u6570\n        Expression expression = null;\n        log.info(\"=============== userDeptId:{}\", userDeptId);\n        if (userDeptId == DeptEnum.BOOS.getType()) {\n            // 2.userDeptId\u4e3a1\uff0c\u8bf4\u660e\u662f\u8001\u603b\uff0c\u53ef\u67e5\u770b\u6240\u6709\u6570\u636e\u65e0\u9700\u5904\u7406\n            return where;\n\n        } else if (userDeptId == DeptEnum.MANAGER_02.getType()) {\n            // 3. userDeptId\u4e3a2\uff0c\u8bf4\u660e\u662f02\u90e8\u95e8\u7ecf\u7406\uff0c\u53ef\u67e5\u770b02\u90e8\u95e8\u53ca\u4e0b\u5c5e\u90e8\u95e8\u6240\u6709\u6570\u636e\n            // \u521b\u5efaIN \u8868\u8fbe\u5f0f\n            Set&lt;String&gt; deptIds = Sets.newLinkedHashSet(); // \u521b\u5efaIN\u8303\u56f4\u7684\u5143\u7d20\u96c6\u5408\n            deptIds.add(\"2\");\n            deptIds.add(\"3\");\n            deptIds.add(\"4\");\n            deptIds.add(\"5\");\n            ItemsList itemsList = new ExpressionList(deptIds.stream().map(StringValue::new).collect(Collectors.toList())); // \u628a\u96c6\u5408\u8f6c\u53d8\u4e3aJSQLParser\u9700\u8981\u7684\u5143\u7d20\u5217\u8868\n            InExpression inExpression = new InExpression(new Column(\"order_tbl.dept_id\"), itemsList); //  order_tbl.dept_id IN ('2', '3', '4', '5')\n            return new AndExpression(where, inExpression);\n        } else if (userDeptId == DeptEnum.MANAGER_06.getType()) {\n            // 4. userDeptId\u4e3a6\uff0c\u8bf4\u660e\u662f06\u90e8\u95e8\u7ecf\u7406\uff0c\u53ef\u67e5\u770b06\u90e8\u95e8\u53ca\u4e0b\u5c5e\u90e8\u95e8\u6240\u6709\u6570\u636e\n            // \u521b\u5efaIN \u8868\u8fbe\u5f0f\n            Set&lt;String&gt; deptIds = Sets.newLinkedHashSet(); // \u521b\u5efaIN\u8303\u56f4\u7684\u5143\u7d20\u96c6\u5408\n            deptIds.add(\"6\");\n            deptIds.add(\"7\");\n            deptIds.add(\"8\");\n            deptIds.add(\"9\");\n            ItemsList itemsList = new ExpressionList(deptIds.stream().map(StringValue::new).collect(Collectors.toList())); // \u628a\u96c6\u5408\u8f6c\u53d8\u4e3aJSQLParser\u9700\u8981\u7684\u5143\u7d20\u5217\u8868\n            InExpression inExpression = new InExpression(new Column(\"order_tbl.dept_id\"), itemsList);\n            return new AndExpression(where, inExpression);\n        } else {\n            // 5. userDeptId\u4e3a\u5176\u4ed6\u65f6\uff0c\u8868\u793a\u4e3a\u5458\u5de5\u7ea7\u522b\u6ca1\u6709\u4e0b\u5c5e\u673a\u6784\uff0c\u53ea\u80fd\u67e5\u770b\u5f53\u524d\u90e8\u95e8\u7684\u6570\u636e\n            //  = \u8868\u8fbe\u5f0f\n            EqualsTo equalsTo = new EqualsTo(); // order_tbl.dept_id = userDeptId\n            equalsTo.setLeftExpression(new Column(\"order_tbl.dept_id\"));\n            equalsTo.setRightExpression(new LongValue(userDeptId));\n            // \u521b\u5efa AND \u8868\u8fbe\u5f0f \u62fc\u63a5Where \u548c = \u8868\u8fbe\u5f0f\n            return new AndExpression(where, equalsTo); // WHERE user_id = 2 AND order_tbl.dept_id = 3\n        }\n    }\n}\n</code></pre>"},{"location":"web/action/permission.html#db","title":"DB \u7528\u6237/\u7ec4\u7ec7/\u83dc\u5355","text":""},{"location":"web/action/permission.html#_5","title":"\u90e8\u95e8\uff08\u7ec4\u7ec7\uff09","text":"<pre><code>-- ----------------------------\n-- 1\u3001\u90e8\u95e8\u8868\n-- ----------------------------\ndrop table if exists sys_dept;\ncreate table sys_dept (\n  dept_id           bigint(20)      not null                   comment '\u90e8\u95e8id',\n  parent_id         bigint(20)      default 0                  comment '\u7236\u90e8\u95e8id',\n  ancestors         varchar(500)    default ''                 comment '\u7956\u7ea7\u5217\u8868',\n  dept_name         varchar(30)     default ''                 comment '\u90e8\u95e8\u540d\u79f0',\n  order_num         int(4)          default 0                  comment '\u663e\u793a\u987a\u5e8f',\n  leader            varchar(20)     default null               comment '\u8d1f\u8d23\u4eba',\n  phone             varchar(11)     default null               comment '\u8054\u7cfb\u7535\u8bdd',\n  email             varchar(50)     default null               comment '\u90ae\u7bb1',\n  status            char(1)         default '0'                comment '\u90e8\u95e8\u72b6\u6001\uff080\u6b63\u5e38 1\u505c\u7528\uff09',\n  del_flag          char(1)         default '0'                comment '\u5220\u9664\u6807\u5fd7\uff080\u4ee3\u8868\u5b58\u5728 2\u4ee3\u8868\u5220\u9664\uff09',\n  create_by         varchar(64)     default ''                 comment '\u521b\u5efa\u8005',\n  create_time       datetime                                   comment '\u521b\u5efa\u65f6\u95f4',\n  update_by         varchar(64)     default ''                 comment '\u66f4\u65b0\u8005',\n  update_time       datetime                                   comment '\u66f4\u65b0\u65f6\u95f4',\n  primary key (dept_id)\n) engine=innodb comment = '\u90e8\u95e8\u8868';\n</code></pre>"},{"location":"web/action/permission.html#_6","title":"\u7528\u6237","text":"<pre><code>-- ----------------------------\n-- 2\u3001\u7528\u6237\u4fe1\u606f\u8868\n-- ----------------------------\ncreate table sys_user (\n  user_id           bigint(20)      not null                   comment '\u7528\u6237ID',\n  dept_id           bigint(20)      default null               comment '\u90e8\u95e8ID',\n  user_name         varchar(30)     not null                   comment '\u7528\u6237\u8d26\u53f7',\n  nick_name         varchar(30)     not null                   comment '\u7528\u6237\u6635\u79f0',\n  user_type         varchar(10)     default 'sys_user'         comment '\u7528\u6237\u7c7b\u578b\uff08sys_user\u7cfb\u7edf\u7528\u6237\uff09',\n  email             varchar(50)     default ''                 comment '\u7528\u6237\u90ae\u7bb1',\n  phone_number       varchar(11)     default ''                comment '\u624b\u673a\u53f7\u7801',\n  sex               char(1)         default '0'                comment '\u7528\u6237\u6027\u522b\uff080\u7537 1\u5973 2\u672a\u77e5\uff09',\n  avatar            varchar(100)    default ''                 comment '\u5934\u50cf\u5730\u5740',\n  password          varchar(100)    default ''                 comment '\u5bc6\u7801',\n  status            char(1)         default '0'                comment '\u5e10\u53f7\u72b6\u6001\uff080\u6b63\u5e38 1\u505c\u7528\uff09',\n  login_date        datetime                                   comment '\u6700\u540e\u767b\u5f55\u65f6\u95f4',\n  create_by         varchar(64)     default ''                 comment '\u521b\u5efa\u8005',\n  create_time       datetime                                   comment '\u521b\u5efa\u65f6\u95f4',\n  update_by         varchar(64)     default ''                 comment '\u66f4\u65b0\u8005',\n  update_time       datetime                                   comment '\u66f4\u65b0\u65f6\u95f4',\n  remark            varchar(500)    default null               comment '\u5907\u6ce8',\n  primary key (user_id)\n) engine=innodb comment = '\u7528\u6237\u4fe1\u606f\u8868';\n</code></pre>"},{"location":"web/action/permission.html#_7","title":"\u5c97\u4f4d\uff08\u53ef\u9009\uff09","text":"<pre><code>-- ----------------------------\n-- 3\u3001\u5c97\u4f4d\u4fe1\u606f\u8868\n-- ----------------------------\ndrop table if exists sys_post;\ncreate table sys_post\n(\n  post_id       bigint(20)      not null                   comment '\u5c97\u4f4dID',\n  post_code     varchar(64)     not null                   comment '\u5c97\u4f4d\u7f16\u7801',\n  post_name     varchar(50)     not null                   comment '\u5c97\u4f4d\u540d\u79f0',\n  post_sort     int(4)          not null                   comment '\u663e\u793a\u987a\u5e8f',\n  status        char(1)         not null                   comment '\u72b6\u6001\uff080\u6b63\u5e38 1\u505c\u7528\uff09',\n  create_by     varchar(64)     default ''                 comment '\u521b\u5efa\u8005',\n  create_time   datetime                                   comment '\u521b\u5efa\u65f6\u95f4',\n  update_by     varchar(64)     default ''                 comment '\u66f4\u65b0\u8005',\n  update_time   datetime                                   comment '\u66f4\u65b0\u65f6\u95f4',\n  remark        varchar(500)    default null               comment '\u5907\u6ce8',\n  primary key (post_id)\n) engine=innodb comment = '\u5c97\u4f4d\u4fe1\u606f\u8868';\n</code></pre>"},{"location":"web/action/permission.html#_8","title":"\u89d2\u8272","text":"<pre><code>-- ----------------------------\n-- 4\u3001\u89d2\u8272\u4fe1\u606f\u8868\n-- ----------------------------\ndrop table if exists sys_role;\ncreate table sys_role (\n  role_id              bigint(20)      not null                   comment '\u89d2\u8272ID',\n  role_name            varchar(30)     not null                   comment '\u89d2\u8272\u540d\u79f0',\n  role_key             varchar(100)    not null                   comment '\u89d2\u8272\u6743\u9650\u5b57\u7b26\u4e32',\n  role_sort            int(4)          not null                   comment '\u663e\u793a\u987a\u5e8f',\n  data_scope           char(1)         default '1'                comment '\u6570\u636e\u8303\u56f4\uff081\uff1a\u5168\u90e8\u6570\u636e\u6743\u9650 2\uff1a\u81ea\u5b9a\u6570\u636e\u6743\u9650 3\uff1a\u672c\u90e8\u95e8\u6570\u636e\u6743\u9650 4\uff1a\u672c\u90e8\u95e8\u53ca\u4ee5\u4e0b\u6570\u636e\u6743\u9650\uff09',\n  menu_check_strictly  tinyint(1)      default 1                  comment '\u83dc\u5355\u6811\u9009\u62e9\u9879\u662f\u5426\u5173\u8054\u663e\u793a',\n  dept_check_strictly  tinyint(1)      default 1                  comment '\u90e8\u95e8\u6811\u9009\u62e9\u9879\u662f\u5426\u5173\u8054\u663e\u793a',\n  status               char(1)         not null                   comment '\u89d2\u8272\u72b6\u6001\uff080\u6b63\u5e38 1\u505c\u7528\uff09',\n  create_by            varchar(64)     default ''                 comment '\u521b\u5efa\u8005',\n  create_time          datetime                                   comment '\u521b\u5efa\u65f6\u95f4',\n  update_by            varchar(64)     default ''                 comment '\u66f4\u65b0\u8005',\n  update_time          datetime                                   comment '\u66f4\u65b0\u65f6\u95f4',\n  remark               varchar(500)    default null               comment '\u5907\u6ce8',\n  primary key (role_id)\n) engine=innodb comment = '\u89d2\u8272\u4fe1\u606f\u8868';\n</code></pre>"},{"location":"web/action/permission.html#_9","title":"\u83dc\u5355\u6743\u9650","text":"<pre><code>-- ----------------------------\n-- 5\u3001\u83dc\u5355\u6743\u9650\u8868\n-- ----------------------------\ncreate table sys_menu (\n  menu_id           bigint(20)      not null                   comment '\u83dc\u5355ID',\n  menu_name         varchar(50)     not null                   comment '\u83dc\u5355\u540d\u79f0',\n  parent_id         bigint(20)      default 0                  comment '\u7236\u83dc\u5355ID',\n  order_num         int(4)          default 0                  comment '\u663e\u793a\u987a\u5e8f',\n  path              varchar(200)    default ''                 comment '\u8def\u7531\u5730\u5740',\n  component         varchar(255)    default null               comment '\u7ec4\u4ef6\u8def\u5f84',\n  query_param       varchar(255)    default null               comment '\u8def\u7531\u53c2\u6570',\n  is_frame          int(1)          default 1                  comment '\u662f\u5426\u4e3a\u5916\u94fe\uff080\u662f 1\u5426\uff09',\n  is_cache          int(1)          default 0                  comment '\u662f\u5426\u7f13\u5b58\uff080\u7f13\u5b58 1\u4e0d\u7f13\u5b58\uff09',\n  menu_type         char(1)         default ''                 comment '\u83dc\u5355\u7c7b\u578b\uff08M\u76ee\u5f55 C\u83dc\u5355 F\u6309\u94ae\uff09',\n  visible           char(1)         default 0                  comment '\u663e\u793a\u72b6\u6001\uff080\u663e\u793a 1\u9690\u85cf\uff09',\n  status            char(1)         default 0                  comment '\u83dc\u5355\u72b6\u6001\uff080\u6b63\u5e38 1\u505c\u7528\uff09',\n  perms             varchar(100)    default null               comment '\u6743\u9650\u6807\u8bc6',\n  icon              varchar(100)    default '#'                comment '\u83dc\u5355\u56fe\u6807',\n  create_by         varchar(64)     default ''                 comment '\u521b\u5efa\u8005',\n  create_time       datetime                                   comment '\u521b\u5efa\u65f6\u95f4',\n  update_by         varchar(64)     default ''                 comment '\u66f4\u65b0\u8005',\n  update_time       datetime                                   comment '\u66f4\u65b0\u65f6\u95f4',\n  remark            varchar(500)    default ''                 comment '\u5907\u6ce8',\n  primary key (menu_id)\n) engine=innodb comment = '\u83dc\u5355\u6743\u9650\u8868';\n</code></pre>"},{"location":"web/action/permission.html#_10","title":"\u89d2\u8272\u83dc\u5355\u5173\u8054\u8868","text":"<pre><code>-- ----------------------------\n-- 7\u3001\u89d2\u8272\u548c\u83dc\u5355\u5173\u8054\u8868  \u89d2\u82721-N\u83dc\u5355\n-- ----------------------------\ncreate table sys_role_menu (\n  role_id   bigint(20) not null comment '\u89d2\u8272ID',\n  menu_id   bigint(20) not null comment '\u83dc\u5355ID',\n  primary key(role_id, menu_id)\n) engine=innodb comment = '\u89d2\u8272\u548c\u83dc\u5355\u5173\u8054\u8868';\n</code></pre>"},{"location":"web/action/permission.html#_11","title":"\u7528\u6237\u89d2\u8272\u5173\u8054\u8868","text":"<pre><code>-- ----------------------------\n-- 6\u3001\u7528\u6237\u548c\u89d2\u8272\u5173\u8054\u8868  \u7528\u6237N-1\u89d2\u8272\n-- ----------------------------\ncreate table sys_user_role (\n  user_id   bigint(20) not null comment '\u7528\u6237ID',\n  role_id   bigint(20) not null comment '\u89d2\u8272ID',\n  primary key(user_id, role_id)\n) engine=innodb comment = '\u7528\u6237\u548c\u89d2\u8272\u5173\u8054\u8868';\n</code></pre>"},{"location":"web/action/permission.html#_12","title":"\u89d2\u8272\u90e8\u95e8\u5173\u8054\u8868","text":"<pre><code>-- ----------------------------\n-- 8\u3001\u89d2\u8272\u548c\u90e8\u95e8\u5173\u8054\u8868  \u89d2\u82721-N\u90e8\u95e8\n-- ----------------------------\ncreate table sys_role_dept (\n  role_id   bigint(20) not null comment '\u89d2\u8272ID',\n  dept_id   bigint(20) not null comment '\u90e8\u95e8ID',\n  primary key(role_id, dept_id)\n) engine=innodb comment = '\u89d2\u8272\u548c\u90e8\u95e8\u5173\u8054\u8868';\n</code></pre>"},{"location":"web/action/permission.html#_13","title":"\u7528\u6237\u5c97\u4f4d\u5173\u8054\u8868\uff08\u53ef\u9009\uff09","text":"<pre><code>-- ----------------------------\n-- 9\u3001\u7528\u6237\u4e0e\u5c97\u4f4d\u5173\u8054\u8868  \u7528\u62371-N\u5c97\u4f4d\n-- ----------------------------\ncreate table sys_user_post\n(\n  user_id   bigint(20) not null comment '\u7528\u6237ID',\n  post_id   bigint(20) not null comment '\u5c97\u4f4dID',\n  primary key (user_id, post_id)\n) engine=innodb comment = '\u7528\u6237\u4e0e\u5c97\u4f4d\u5173\u8054\u8868';\n</code></pre>"},{"location":"web/action/skills.html","title":"\u6280\u5de7","text":""},{"location":"web/action/skills.html#_2","title":"\u6e05\u7406","text":""},{"location":"web/action/skills.html#_3","title":"\u4e34\u65f6\u6587\u4ef6\u7684\u6e05\u9664\uff08\u4e0a\u4f20\u540e\u4e0d\u7528\uff09","text":"<p>\u4e00\u822c\u6765\u8bf4\uff1a\u5148\u4e0a\u4f20\u6587\u4ef6\uff0c\u7136\u540e\u5728\u5c06\u8fd4\u56de\u7684 ID \u4f5c\u4e3a\u5b57\u6bb5\u5b58\u50a8\u5230\u6570\u636e\u5e93\u4e2d\uff1b</p> <p>\u95ee\u9898\uff1a\u4e0a\u4f20\u5b8c\u6587\u4ef6\u540e\uff0c\u5982\u4f55\u77e5\u9053\u8be5\u6587\u4ef6\u662f\u5426\u88ab\u7cfb\u7edf\u4f7f\u7528\uff0c\u9632\u6b62\u5783\u573e\u65e0\u9650\u589e\u957f\uff1f</p>"},{"location":"web/action/skills.html#_4","title":"\u88ab\u8986\u76d6\u6587\u4ef6\u7684\u5220\u9664\uff08\u4e0a\u4f20\u540e\u88ab\u8986\u76d6\uff09","text":"<p>\u5bf9\u4e8e\u7528\u6237\u7684\u5934\u50cf\uff0c\u591a\u6b21\u4e0a\u4f20\u4e4b\u540e\uff0c\u4e4b\u524d\u7684\u56fe\u7247\u5e94\u8be5\u88ab\u5220\u6389\u3002</p>"},{"location":"web/action/skills.html#_5","title":"\u6b63\u5e38\u5220\u9664","text":"<p>\u8981\u6c42\uff1a\u7528\u6237\u4e00\u81f4\u6027\uff0c\u5373\u7528\u6237\u4e0d\u80fd\u770b\u5230\u90e8\u5206\u5220\u9664\u7684\u573a\u666f\u3002</p> <p>\u5982\uff1a\u5220\u9664\u7528\u6237\u65f6\uff0c\u7528\u6237\u76f8\u5173\u7684\u56fe\u7247\u6570\u636e\u5e94\u8be5\u88ab\u5220\u6389\u3002</p> <ul> <li>\u8fd9\u662f\u4e24\u6b65\u64cd\u4f5c\uff0c\u5206\u522b\u662f\u6570\u636e\u5e93\u64cd\u4f5c\u548c\u56fe\u7247\u64cd\u4f5c\u3002</li> </ul> \u95ee\u9898 \u540e\u679c \u89e3\u51b3\u65b9\u6848 \u5148\u5220\u6570\u636e\u5e93\uff0c\u518d\u5220\u56fe\u7247 \u6570\u636e\u5e93\u5220\u9664\u6210\u529f\uff0c\u56fe\u7247\u5220\u9664\u5931\u8d25 \u7528\u6237\u53ef\u4ee5\u767b\u5f55\uff0c\u4f46\u65e0\u6cd5\u770b\u5230\u56fe\u7247 \u52a0\u5165\u4e8b\u52a1\uff0c\u6570\u636e\u5e93\u56de\u6eda \u5148\u5220\u6570\u636e\u5e93\uff0c\u518d\u5220\u56fe\u7247 \u56fe\u7247\u5220\u9664\u6210\u529f\uff0c\u6570\u636e\u5e93\u5220\u9664\u5931\u8d25 \u56fe\u7247\u65e0\u6cd5\u6e05\u9664\uff0c\u5b58\u7559\u5783\u573e \u56fe\u7247\u5220\u9664\u4e8b\u4ef6\uff0c\u5355\u72ecGC\u7ebf\u7a0b\u5904\u7406"},{"location":"web/action/video_play.html","title":"\u89c6\u9891\u64ad\u653e","text":"<p>\u793a\u4f8b\u4ee3\u7801\uff1a</p>"},{"location":"web/action/video_play.html#hls","title":"HLS","text":"<p>HLS (HTTP Live Streaming\uff09\u662fApple\u7684\u52a8\u6001\u7801\u7387\u81ea\u9002\u5e94\u6280\u672f\u3002\u4e3b\u8981\u7528\u4e8ePC\u548cApple\u7ec8\u7aef\u7684\u97f3\u89c6\u9891\u670d\u52a1\u3002\u5305\u62ec\u4e00\u4e2am3u(8)\u7684\u7d22\u5f15\u6587\u4ef6\uff0cTS\u5a92\u4f53\u5206\u7247\u6587\u4ef6\u548ckey\u52a0\u5bc6\u4e32\u6587\u4ef6\u3002</p>"},{"location":"web/action/video_play.html#m3u8","title":"m3u8\u683c\u5f0f","text":"<p>M3U8\u6587\u4ef6\u662f\u6307UTF-8\u7f16\u7801\u683c\u5f0f\u7684M3U\u6587\u4ef6\u3002M3U\u6587\u4ef6\u662f\u8bb0\u5f55\u4e86\u4e00\u4e2a\u7d22\u5f15\u7eaf\u6587\u672c\u6587\u4ef6\uff0c\u6253\u5f00\u5b83\u65f6\u64ad\u653e\u8f6f\u4ef6\u5e76\u4e0d\u662f\u64ad\u653e\u5b83\uff0c\u800c\u662f\u6839\u636e\u5b83\u7684\u7d22\u5f15\u627e\u5230\u5bf9\u5e94\u7684\u97f3\u89c6\u9891\u6587\u4ef6\u7684\u7f51\u7edc\u5730\u5740\u8fdb\u884c\u5728\u7ebf\u64ad\u653e\u3002</p> <pre><code>#EXTM3U\n#EXT-X-VERSION:3\n#EXT-X-MEDIA-SEQUENCE:35232\n#EXT-X-TARGETDURATION:10\n#EXT-X-KEY:METHOD=AES-128,URI=\"encryption.key\"\n#EXTINF:10.000,\n</code></pre> <ul> <li>EXTM3U\uff1a\u8fd9\u4e2a\u662fM3U8\u6587\u4ef6\u5fc5\u987b\u5305\u542b\u7684\u6807\u7b7e\uff0c\u5e76\u4e14\u5fc5\u987b\u5728\u6587\u4ef6\u7684\u7b2c\u4e00\u884c\uff0c\u6240\u6709\u7684M3U8\u6587\u4ef6\u4e2d\u5fc5\u987b\u5305\u542b\u8fd9\u4e2a\u6807\u7b7e\u3002</li> <li>EXT-X-VERSION\uff1aM3U8\u6587\u4ef6\u7684\u7248\u672c\uff0c\u5e38\u89c1\u7684\u662f3\uff08\u76ee\u524d\u6700\u9ad8\u7248\u672c\u5e94\u8be5\u662f7\uff09\u3002</li> <li>EXT-X-TARGETDURATION\uff1a\u8be5\u6807\u7b7e\u6307\u5b9a\u4e86\u5a92\u4f53\u6587\u4ef6\u6301\u7eed\u65f6\u95f4\u7684\u6700\u5927\u503c\uff0c\u64ad\u653e\u6587\u4ef6\u5217\u8868\u4e2d\u7684\u5a92\u4f53\u6587\u4ef6\u5728EXTINF\u6807\u7b7e\u4e2d\u5b9a\u4e49\u7684\u6301\u7eed\u65f6\u95f4\u5fc5\u987b\u5c0f\u4e8e\u6216\u8005\u7b49\u4e8e\u8be5\u6807\u7b7e\u6307\u5b9a\u7684\u6301\u7eed\u65f6\u95f4\u3002\u8be5\u6807\u7b7e\u5728\u64ad\u653e\u5217\u8868\u6587\u4ef6\u4e2d\u5fc5\u987b\u51fa\u73b0\u4e00\u6b21\u3002</li> <li>EXT-X-MEDIA-SEQUENCE\uff1aM3U8\u76f4\u64ad\u662f\u7684\u76f4\u64ad\u5207\u6362\u5e8f\u5217\uff0c\u5f53\u64ad\u653e\u6253\u5f00M3U8\u65f6\uff0c\u4ee5\u8fd9\u4e2a\u6807\u7b7e\u7684\u503c\u4f5c\u4e3a\u53c2\u8003\uff0c\u64ad\u653e\u5bf9\u5e94\u7684\u5e8f\u5217\u53f7\u7684\u5207\u7247\u3002</li> <li>EXT-X-KEY\uff1a\u89c6\u9891\u7684\u52a0\u5bc6\u65b9\u5f0f\uff0c\u793a\u4f8b\u91c7\u7528AES-128\u52a0\u5bc6\uff0c\u5bc6\u94a5\u5728\u5bf9\u5e94\u7684URL\u8def\u5f84\u4e2d\uff0c\u65e0IV\u503c</li> <li>METHOD \u8868\u793a\u4f7f\u7528 AES-128 \u52a0\u89e3\u5bc6\uff0c\u5982\u679c\u4e3a NONE \u5219\u8868\u660e\u4e0d\u52a0\u5bc6\uff1b</li> <li>IV \u6ca1\u6709\uff0c\u9ed8\u8ba4\u4e3a <code>00000000000000000000000000000000</code>\uff1b</li> <li>\u5176\u5bc6\u94a5\u5730\u5740\u4e3a <code>encryption.key</code>\uff0c\u901a\u8fc7\u8be5\u8bf7\u6c42\u53ef\u4ee5\u83b7\u5f97\u5bc6\u94a5<code>a041c4c59b89b6c37aa3703fbe3851cc</code></li> <li> <p>Salt \u6ca1\u6709\uff1b</p> </li> <li> <p>EXTINF\uff1aEXTINF\u4e3aM3U8\u5217\u8868\u4e2d\u6bcf\u4e00\u4e2a\u5206\u7247\u7684duration\uff0c\u5982\u4e0a\u9762\u4f8b\u5b50\u8f93\u51fa\u4fe1\u606f\u4e2d\u7684\u7b2c\u4e00\u7247\u7684duration\u4e3a10\u79d2\u3002\u5728EXTINF\u6807\u7b7e\u4e2d\uff0c\u9664\u4e86duration\u503c\uff0c\u8fd8\u53ef\u4ee5\u5305\u542b\u53ef\u9009\u7684\u63cf\u8ff0\u4fe1\u606f\uff0c\u4e3b\u8981\u4e3a\u6807\u6ce8\u5207\u7247\u4fe1\u606f\uff0c\u4f7f\u7528\u9017\u53f7\u5206\u9694\u5f00\u3002</p> </li> <li> <p>EXT-X-PLAYLIST-TYPE\uff1a.</p> </li> <li>VOD\uff0c\u5373\u4e3a\u70b9\u64ad\u89c6\u9891\uff0c\u670d\u52a1\u5668\u4e0d\u80fd\u6539\u53d8 Playlist \u2f42\u4ef6\uff0c\u6362\u53e5\u8bdd\u8bf4\u5c31\u662f\u8be5\u89c6\u9891\u5168\u90e8\u7684 ts \u2f42\u4ef6\u5df2\u7ecf\u88ab\u2f63\u6210\u597d\uff1b</li> <li>EVENT\uff0c\u5c31\u662f\u5b9e\u65f6\u2f63\u6210 m3u8 \u548c ts \u2f42\u4ef6\u3002\u670d\u52a1\u5668\u4e0d\u80fd\u6539\u53d8\u6216\u662f\u5220\u9664 Playlist \u2f42\u4ef6\u4e2d\u7684\u4efb\u4f55\u90e8\u5206\uff0c\u4f46\u662f\u53ef\u4ee5\u5411\u8be5\u2f42\u4ef6\u4e2d\u589e\u52a0\u65b0\u7684\u2f00\u2f8f\u5185\u5bb9\u3002\u5b83\u7684\u7d22\u5f15\u2f42\u4ef6\u2f00\u76f4\u5904\u4e8e\u52a8\u6001\u53d8\u5316\u4e2d\uff0c\u64ad\u653e\u7684\u65f6\u5019\u9700\u8981\u4e0d\u65ad\u4e0b\u8f7d\u2f06\u7ea7 index \u2f42\u4ef6</li> </ul>"},{"location":"web/action/video_play.html#mp4-m3u8","title":"mp4 \u5206\u7247 m3u8","text":"<p>\u4f7f\u7528 ffmpeg \u547d\u4ee4\uff1a</p> <ul> <li><code>ffmpeg -y -i test-hoo.mp4 -hls_time 12 -hls_key_info_file enc.keyinfo -hls_playlist_type vod -hls_segment_filename \"file%d.ts\" playlist.m3u8</code></li> </ul>"},{"location":"web/action/video_play.html#m3u8_1","title":"m3u8 \u4e0b\u8f7d","text":"<p>\u4f7f\u7528  ffmpeg \u5199\u5728 m3u8 \u5e76\u5408\u6210 mp4\uff1b</p> <ul> <li><code>ffmpeg -i http://a.com/test.m3u8 a.mp4</code></li> </ul> <p>TODO\uff08\u5982\u4f55\u9632\u6b62\u4e0b\u8f7d\uff09</p>"},{"location":"web/action/video_play.html#openssl","title":"openssl \u89c6\u9891\u52a0\u89e3\u5bc6","text":"<p>\u9664\u4e86 m3u8 \u7684\u52a0\u5bc6\u65b9\u5f0f\u4e4b\u5916\uff0c\u53ef\u4ee5\u4f7f\u7528 openssl \u5bf9\u6574\u4e2a\u6587\u4ef6\u8fdb\u884c\u52a0\u89e3\u5bc6\u3002</p> <ul> <li>\u670d\u52a1\u7aef\u4fdd\u5b58\u52a0\u5bc6\u7684\u6587\u4ef6\uff0c\u5ba2\u6237\u7aef\u83b7\u53d6\u5230\u52a0\u5bc6\u7684\u6587\u4ef6\uff0c\u7136\u540e\u83b7\u53d6\u5bc6\u94a5\uff0c\u672c\u5730\u89e3\u6790\u540e\u518d\u5c55\u793a\uff1b</li> <li>\u6548\u7387\u6bd4\u8f83\u6162\uff1f</li> <li>\u524d\u7aef\u7684\u89c6\u9891\u7ec4\u4ef6\u652f\u6301\u4f7f\u7528 \u4e8c\u8fdb\u5236\u6d41 \u4f5c\u4e3a\u8f93\u5165\uff1b</li> </ul>"},{"location":"web/action/video_play.html#_2","title":"\u89e3\u5bc6","text":"<p><code>openssl aes-128-cbc -d -in seg-1-v1-a1.ts -out seg-1-v1-a1_decode.ts -nosalt -iv 00000000000000000000000000000000  -K a041c4c59b89b6c37aa3703fbe3851cc</code></p>"},{"location":"web/action/video_play.html#_3","title":"\u52a0\u5bc6","text":"<p><code>openssl aes-128-cbc -e -in seg-1-v1-a1_decode.ts -out seg-1-v1-a1.ts -nosalt -iv 00000000000000000000000000000000  -K a041c4c59b89b6c37aa3703fbe3851cc</code></p>"},{"location":"web/action/video_play.html#ts","title":"TS\u683c\u5f0f\u89c6\u9891","text":"<p>TS \u662f\u9ad8\u6e05\u683c\u5f0f\uff0c\u5168\u79f0\u4e3a MPEG2-TS</p> <ul> <li>\u4ece\u89c6\u9891\u6d41\u7684\u4efb\u4e00\u7247\u6bb5\u5f00\u59cb\u90fd\u53ef\u4ee5\u72ec\u7acb\u89e3\u7801\u3002</li> </ul>"},{"location":"web/action/video_play.html#_4","title":"\u524d\u7aef","text":""},{"location":"web/action/video_play.html#videojs","title":"video.js","text":"<p>Video.js - open source HTML5 video player</p> <ul> <li>\u539f\u751f\u652f\u6301 mp4, webm, ogg \u683c\u5f0f\uff1b</li> <li>flv \u683c\u5f0f\u9700\u8981\u5f15\u5165 videojs-flvjs \u548c flv.js\uff1b</li> <li>rtmp\uff1avideo-js x6\u53ca\u4ee5\u4e0a\u7248\u672c\u4e0d\u652f\u6301\uff0c\u56e0\u4e3a\u4e0d\u652f\u6301<code>flash</code>\uff1b</li> <li>... ...</li> </ul> <p>\u63d2\u4ef6\uff1a</p> <ul> <li><code>@videojs/http-streaming</code> \uff1a\u64ad\u653e hls \u6d41\u63d2\u4ef6\uff0cvideojs 7\u7248\u672c\u4ee5\u4e0a\u5b89\u88c5\u65f6\u4f1a\u81ea\u52a8\u5b89\u88c5\uff1b</li> </ul>"},{"location":"web/action/video_play.html#dashjs","title":"Dash.js","text":"<p>A reference client implementation for the playback of MPEG DASH via Javascript and compliant browsers.</p>"},{"location":"web/action/video_play.html#_5","title":"\u540e\u7aef","text":""},{"location":"web/action/video_play.html#byte-range","title":"Byte-Range","text":"<p>\u901a\u8fc7\u8bf7\u6c42\u5934\u7684 Range \u7b49\u5b57\u6bb5\uff0c\u83b7\u53d6\u90e8\u5206\u5b57\u8282\u6d41\uff1b</p> <ul> <li>\u9002\u7528\u573a\u666f\uff1a\u524d\u7aef\u53ef\u4ee5\u8bc6\u522b\u76f8\u5173\u7684\u89c6\u9891\u683c\u5f0f\uff1b</li> <li>\u5c40\u9650\uff1a\u65e0\u6cd5\u8fdb\u884c\u89c6\u9891\u52a0\u5bc6\uff0c\u53ef\u6a21\u62df\u8bf7\u6c42\u83b7\u53d6\u6570\u636e\u5e76\u62fc\u63a5\u5f62\u6210\u89c6\u9891\uff1b</li> <li>\u4f7f\u7528\uff1aSpring \u7684 <code>ResourceHttpRequestHandler</code>\u7684<code>handleRequest</code>\u7528\u4e8e\u5904\u7406\uff1a</li> </ul>"},{"location":"web/action/video_play.html#m3u8_2","title":"m3u8\u5206\u7247\u63a8\u9001","text":"<p>\u901a\u8fc7 ffmpeg\uff0c\u7528 m3u8 \u5207\u7247\u64ad\u653e\uff1b</p> <p>\u6570\u636e\u751f\u6210\uff1a\u4f7f\u7528 <code>org.bytedeco.javacv.FFmpegFrameRecorder</code>\u7c7b\u8fdb\u884c\u751f\u6210</p> <ul> <li> <p>\u8f93\u5165\uff1a<code>test.info</code> \u6587\u4ef6</p> </li> <li> <p>test.info\u5185\u5bb9\u5982\u4e0b:</p> <p>1\uff09\u5916\u90e8\u8bbf\u95ee key\u6587\u4ef6\u7684\u5730\u5740</p> <p>2\uff09\u6267\u884c\u65f6\u8bbf\u95ee key \u7684\u5730\u5740</p> <p>3\uff09IV \u503c\uff0816\u8fdb\u5236\uff09</p> <pre><code>http://127.0.0.1/m3u8/test.key\n./video_play/resources/m3u8/test.key\n682f5033538cf71567e1bdb38f5f9a07\n</code></pre> </li> <li> <p>\u8f93\u5165\uff1a<code>test.key</code> \u6587\u4ef6</p> </li> <li> <p>\u4e00\u884c\u8868\u793a\u5bc6\u94a5\uff0c\u5982<code>n4DHLX7kMPeewvW3</code>\uff0816 \u4e2a Byte\uff0c\u4e0a\u8ff0\u4e3a ASCII \u6587\u672c\u5f62\u5f0f\u7684\u5c55\u793a\uff09</p> </li> <li> <p>\u8f93\u51fa\uff1a<code>test.m3u8</code></p> </li> </ul> <pre><code>#EXTM3U\n#EXT-X-VERSION:3\n#EXT-X-TARGETDURATION:60\n#EXT-X-MEDIA-SEQUENCE:0\n#EXT-X-KEY:METHOD=AES-128,URI=\"http://127.0.0.1/m3u8/test.key\",IV=0x682f5033538cf71567e1bdb38f5f9a07\n#EXTINF:60.320000,\ntest-0.ts\n#EXTINF:60.000000,\ntest-1.ts\n</code></pre> <ul> <li>\u8f93\u51fa\uff1a<code>test-%n.ts</code> \uff0c\u52a0\u5bc6\u540e\u7684 ts \u6587\u4ef6\u3002</li> </ul>"},{"location":"web/action/video_play.html#_6","title":"\u65ad\u70b9\u64ad\u653e","text":"<p>\u8bb0\u5f55\u4e4b\u524d\u89c2\u770b\u7684\u4f4d\u7f6e\uff0c\u5e76\u7ee7\u7eed\u64ad\u653e\u3002</p> <ul> <li>\u8bb0\u5f55\u64ad\u653e\u4f4d\u7f6e\uff0c\u5199\u5165 local storage\uff1b</li> <li>\u5237\u65b0\u9875\u9762\uff0c\u83b7\u53d6\u64ad\u653e\u4f4d\u7f6e\uff1b</li> <li>\u4ece\u6307\u5b9a\u4f4d\u7f6e\u64ad\u653e\uff1b</li> </ul> <p>TODO\uff1a\u5b9e\u73b0</p>"},{"location":"web/action/video_play.html#_7","title":"\u76f4\u64ad\u534f\u8bae","text":"<p>\u76ee\u524d\u4e3b\u6d41\u7684\u51e0\u79cd\u76f4\u64ad\u534f\u8bae</p> \u534f\u8bae \u4f20\u8f93\u65b9\u5f0f \u89c6\u9891\u5c01\u88c5\u683c\u5f0f \u5ef6\u65f6 \u6570\u636e\u5206\u6bb5 html\u64ad\u653e httpflv http flv \u4f4e \u8fde\u7eed \u53ef\u901a\u8fc7html5\u89e3\u5c01\u5305\u64ad\u653e(flv.js) rtmp tcp flv tag \u4f4e \u8fde\u7eed \u4e0d\u652f\u6301 dash http ts\u6587\u4ef6 \u9ad8 \u5207\u7247 \u53ef\u901a\u8fc7html5\u89e3\u5c01\u5305\u64ad\u653e(hls.js) hls $1 mp4 3gp webm \u9ad8 \u5207\u7247 \u5982\u679cdash\u6587\u4ef6\u5217\u8868\u662fmp4webm\u6587\u4ef6\uff0c\u53ef\u76f4\u63a5\u64ad\u653e <p>RTMP\uff08Real Time Messaging Protocol\uff09\uff1a\u57fa\u4e8eTCP\u7684\uff0c\u7531Adobe\u516c\u53f8\u4e3aFlash\u64ad\u653e\u5668\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u97f3\u9891\u3001\u89c6\u9891\u4f20\u8f93\u5f00\u53d1\u7684\u5f00\u653e\u534f\u8bae\u3002</p> <p>HLS\uff08HTTP Live Streaming\uff09\uff1a\u57fa\u4e8eHTTP\u7684\uff0c\u662fApple\u516c\u53f8\u5f00\u653e\u7684\u97f3\u89c6\u9891\u4f20\u8f93\u534f\u8bae\u3002</p> <p>HTTP FLV\uff1a\u5c06RTMP\u5c01\u88c5\u5728HTTP\u534f\u8bae\u4e4b\u4e0a\u7684\uff0c\u53ef\u4ee5\u66f4\u597d\u7684\u7a7f\u900f\u9632\u706b\u5899\u7b49\u3002</p>"},{"location":"web/action/web_mail_notify.html","title":"\u7ad9\u5185\u4fe1\u8bbe\u8ba1","text":"<p>\u5b9e\u73b0\u4e00\u4e2a\u7ad9\u5185\u4fe1web\u6d88\u606f\u63a8\u9001\u7684\u529f\u80fd</p> <p></p> <p>\u6d88\u606f\u63a8\u9001(<code>push</code>) \u901a\u5e38\u662f\u6307\u7f51\u7ad9\u7684\u8fd0\u8425\u5de5\u4f5c\u7b49\u4eba\u5458\uff0c\u901a\u8fc7\u67d0\u79cd\u5de5\u5177\u5bf9\u7528\u6237\u5f53\u524d\u7f51\u9875\u6216\u79fb\u52a8\u8bbe\u5907APP\u8fdb\u884c\u7684\u4e3b\u52a8\u6d88\u606f\u63a8\u9001\u3002</p> <p>\u6d88\u606f\u63a8\u9001\u4e00\u822c\u53c8\u5206\u4e3a<code>web\u7aef\u6d88\u606f\u63a8\u9001</code>\u548c<code>\u79fb\u52a8\u7aef\u6d88\u606f\u63a8\u9001</code>\u3002</p> <p>web\u7aef\u6d88\u606f\u63a8\u9001\u5e38\u89c1\u7684\u8bf8\u5982\u7ad9\u5185\u4fe1\u3001\u672a\u8bfb\u90ae\u4ef6\u6570\u91cf\u3001\u76d1\u63a7\u62a5\u8b66\u6570\u91cf\u7b49\uff0c\u5e94\u7528\u7684\u4e5f\u975e\u5e38\u5e7f\u6cdb\u3002</p>"},{"location":"web/action/web_mail_notify.html#_2","title":"\u975e\u5b9e\u65f6\u65b9\u6848","text":"<p>\u7c7b\u4f3c Gitee\uff0c\u5176\u7ad9\u5185\u4fe1\u662f\u975e\u5b9e\u65f6\u7684\uff0c\u9700\u8981\u754c\u9762\u5237\u65b0\u624d\u53ef\u4ee5\u83b7\u53d6\u3002</p> <ul> <li><code>unread</code>\u63a5\u53e3\uff0c\u83b7\u53d6\u672a\u8bfb\u6d88\u606f\uff1b</li> </ul>"},{"location":"web/action/web_mail_notify.html#_3","title":"\u5b9e\u65f6\u65b9\u6848","text":"<p>\u89e6\u53d1\u67d0\u4e2a\u4e8b\u4ef6\uff08\u4e3b\u52a8\u5206\u4eab\u4e86\u8d44\u6e90\u6216\u8005\u540e\u53f0\u4e3b\u52a8\u63a8\u9001\u6d88\u606f\uff09\uff0cweb\u9875\u9762\u7684\u901a\u77e5\u5c0f\u7ea2\u70b9\u5c31\u4f1a\u5b9e\u65f6\u7684<code>+1</code>\u3002</p> <p>\u5728\u670d\u52a1\u7aef\u4f1a\u6709\u82e5\u5e72\u5f20\u6d88\u606f\u63a8\u9001\u8868\uff0c\u7528\u6765\u8bb0\u5f55\u7528\u6237\u89e6\u53d1\u4e0d\u540c\u4e8b\u4ef6\u6240\u63a8\u9001\u4e0d\u540c\u7c7b\u578b\u7684\u6d88\u606f\uff0c\u524d\u7aef\u4e3b\u52a8\u67e5\u8be2\uff08\u62c9\uff09\u6216\u8005\u88ab\u52a8\u63a5\u6536\uff08\u63a8\uff09\u7528\u6237\u6240\u6709\u672a\u8bfb\u7684\u6d88\u606f\u6570\u3002</p> <p>\u9700\u6c42\uff1a\u7ad9\u5185\u4fe1</p> <ul> <li> <p>\u7ba1\u7406\u5458\u53ef\u4ee5\u53d1\u5e03\u591a\u79cd\u4e0d\u540c\u7684\u6d88\u606f\uff0c\u7528\u6237\u5728\u754c\u9762\u53ef\u4ee5\u53ca\u65f6\u6536\u5230\u901a\u77e5\uff1b</p> </li> <li> <p>\u6bcf\u4e2a client\uff0c\u9700\u8981\u6709\u81ea\u5df1\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u9632\u6b62\u7528\u6237\u5bf9\u4e00\u4e2a\u754c\u9762\u540c\u65f6\u591a\u5f00\uff0c\u6b64\u65f6\u6bcf\u4e2a\u754c\u9762\u90fd\u4f1a\u6709\u4e00\u4e2a\u72ec\u7acb\u7684\u8fde\u63a5\uff1b</p> </li> <li>\u5373\u4ec5\u7528\u7528\u6237ID\u4f5c\u4e3a ClientId \u4e0d\u884c\uff0c\u56e0\u4e3a Server \u7aef\u5bf9\u540c\u4e00\u4e2aID\uff0c\u53ea\u4f1a\u4fdd\u7559\u4e00\u4e2a\u8fde\u63a5\uff0c\u4f46\u662f\u5bf9\u5e94\u591a\u4e2a\u524d\u7aef\u9875\u9762\u8fde\u63a5\uff0c\u4f1a\u51fa\u9519\uff1b</li> </ul>"},{"location":"web/backend/index.html","title":"\u540e\u7aef\u5f00\u53d1\u6280\u672f\u6808","text":"<p>\u5fae\u670d\u52a1\u67b6\u6784\uff1a\u5c06\u8f6f\u4ef6\u5e94\u7528\u7a0b\u5e8f\u6784\u5efa\u4e3a\u4e00\u7ec4\u72ec\u7acb\u3001\u81ea\u6cbb\uff08\u961f\u91cc\u5f00\u53d1\u3001\u90e8\u7f72\u548c\u6269\u5c55\uff09\u3001\u677e\u8026\u5408\u3001\u9762\u5411\u4e1a\u52a1\u80fd\u529b\u7684\u670d\u52a1\u3002</p>"},{"location":"web/backend/index.html#_2","title":"\u8d1f\u8f7d\u5747\u8861","text":"<p>\u6d41\u91cf\u7684\u5747\u5300\u8f6c\u53d1\uff0c\u591a\u4e2a\u540e\u7aef\u670d\u52a1\u5668\uff0c\u9700\u8981\u5206\u5e03\u5f0f\u7f13\u5b58\u8fdb\u884c\u4f1a\u8bdd\u6807\u8bc6\u6216\u8005\u65e0\u72b6\u6001\u670d\u52a1\u3002</p> <p>\u5e38\u7528\u7684\u662f4\u5c42\u548c7\u5c42\u8d1f\u8f7d\uff1a</p> <ul> <li> <p>4\u5c42\u8d1f\u8f7d\uff1a\u5728TCP\u5c42\u8fdb\u884c\u8d1f\u8f7d\uff1b</p> </li> <li> <p>7\u5c42\u8d1f\u8f7d\uff1a\u5728HTTP\u5c42\u8fdb\u884c\u8d1f\u8f7d\uff1b</p> </li> </ul> <p>\u4e00\u822c\u6709LVS\uff0cNginx\u7b49\uff1b</p>"},{"location":"web/backend/index.html#_3","title":"\u7f51\u5173","text":"<p>\u5fae\u670d\u52a1\u7684\u5165\u53e3\uff0c\u53ef\u4ee5\u8fdb\u884c\u7edf\u4e00\u7684\u6743\u9650\u63a7\u5236\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u6d41\u91cf\u63a7\u5236\u7b49\u529f\u80fd\u3002</p> <p>\u4e00\u822c\u6709Nginx\u7cfb\u5217\uff08Nginx/Openresty/Kong/ApiSix\uff09\uff0cZuul\uff0cSpring Cloud Gateway\u7b49\u3002</p>"},{"location":"web/backend/index.html#_4","title":"\u5fae\u670d\u52a1\u751f\u6001","text":"<p>\u5fae\u670d\u52a1\u6846\u67b6\u4e2d\uff0c\u4e00\u822c\u6709\u4e2a\u7edf\u4e00\u7684\u5bf9\u5916\u670d\u52a1\uff0c\u53ef\u4ee5\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861/\u6743\u9650\u63a7\u5236\u7b49\u529f\u80fd\u3002</p> <p>\u5982\u534e\u4e3a\u8d21\u732e\u7684Apache ServiceComb\uff0cSpring Cloud\uff0cK8s + Istio\u3002</p> <p>\u91cd\u8981\u7684\u6784\u6210\uff1a</p> <ul> <li>\u670d\u52a1\u53d1\u73b0\uff08\u670d\u52a1\u6ce8\u518c\uff09\u548c\u670d\u52a1\u95f4\u901a\u4fe1</li> </ul>"},{"location":"web/backend/index.html#_5","title":"\u6570\u636e\u5e93","text":"<p>PostgreSQL\u662f\u5f00\u6e90\u754c\u7528\u7684\u6700\u591a\u7684\u6570\u636e\u5e93\u3002</p> <p></p>"},{"location":"web/backend/index.html#_6","title":"\u7f13\u5b58","text":"<p>Redis</p>"},{"location":"web/backend/index.html#_7","title":"\u5206\u5e03\u5f0f\u6570\u636e\u5e93","text":"<p>HBase\u3001TiDB</p>"},{"location":"web/backend/index.html#_8","title":"\u6d88\u606f\u961f\u5217","text":"<p>\u6d88\u606f\u4e2d\u95f4\u4ef6\uff0c\u89e3\u8026\u670d\u52a1\u8c03\u7528\u95f4\u5173\u7cfb</p> <p>rocketmq\uff0ckafka\uff0cApache Pulsar\u3002</p>"},{"location":"web/backend/index.html#_9","title":"\u5bf9\u8c61\u5b58\u50a8","text":"<p>\u6587\u4ef6\u5b58\u50a8\u3001\u56fe\u7247\u5b58\u50a8\uff0c\u5728\u4e00\u822c\u7684\u540e\u7aef\u670d\u52a1\u4e2d\uff0c\u6587\u4ef6\u89c4\u6a21\u4e0d\u5927\uff0c\u4f46\u6570\u91cf\u8f83\u591a\u3002</p> <p>\u5982OSS\uff0cApache Ozone\uff0cMinIO\u3002</p>"},{"location":"web/backend/api_manager.html","title":"\u63a5\u53e3\u7ba1\u7406","text":""},{"location":"web/backend/api_manager.html#_2","title":"\u63a5\u53e3\u7248\u672c\u95f4\u6539\u52a8","text":"<p>\u5fae\u670d\u52a1\u7684\u4e0d\u540c\u7248\u672c\u95f4\uff0c\u53ef\u4ee5\u67e5\u770b\u63a5\u53e3\u7684\u6539\u52a8\u3002</p> <p>\u57fa\u672c\u601d\u8def\uff1a\u6bcf\u4e2a\u7248\u672c\u90fd\u6709\u5bf9\u5e94\u7684 OpenAPI \u89c4\u8303\u7684 Yaml \u63cf\u8ff0\u6587\u4ef6\uff0c\u901a\u8fc7OpenAPI Tools\u8fdb\u884c\u63a5\u53e3\u7248\u672c\u6bd4\u5bf9\uff1b</p> <p>\u6bcf\u4e2a\u7248\u672c\u5982\u4f55\u5177\u5907\u5bf9\u5e94\u7684OpenAPI\u7684yaml\u63cf\u8ff0\u6587\u4ef6\uff1f</p>"},{"location":"web/backend/api_manager.html#1yamlcontroller","title":"\u601d\u8def1\uff1a\u6839\u636eYaml\u751f\u6210Controller\u5c42\u6ce8\u89e3\u4ee3\u7801","text":"<p>\u5f00\u53d1\u63a5\u53e3\u5148\u5199OpenAPI 3 \u7684 yaml \u6587\u4ef6\uff0c\u7136\u540e\u751f\u6210\u5bf9\u5e94\u7684Controller\u5c42\u7684\u63a5\u53e3\u3002\uff08\u53ef\u884c\uff0c\u4f46\u5bf9\u4e8e\u5f00\u53d1\u4e0d\u592a\u53cb\u597d\uff0c\u6ce8\u89e3\u6bd4yaml\u5bb9\u6613\u5199\uff09</p> <ul> <li>openapi-generator\u548cmaven-plugin: \u6839\u636eYaml\u751f\u6210\u5ba2\u6237\u7aef/\u670d\u52a1\u7aef\u7684\u6869\u4ee3\u7801\uff0c\u4e14\u4e0d\u751f\u6210\u8f85\u52a9\u4ee3\u7801</li> </ul> <pre><code>&lt;generateApiDocumentation&gt;false&lt;/generateApiDocumentation&gt;\n&lt;generateSupportingFiles&gt;false&lt;/generateSupportingFiles&gt;\n&lt;skipOperationExample&gt;true&lt;/skipOperationExample&gt;\n</code></pre> <p>\u5177\u4f53\u4ee3\u7801\u89c1 \u6839\u636eYaml\u751f\u6210SpringBoot\u63a5\u53e3</p>"},{"location":"web/backend/api_manager.html#2controlleryaml","title":"\u601d\u8def2\uff1a\u6839\u636eController\u5c42\u6ce8\u89e3\u4ee3\u7801\u751f\u6210Yaml","text":"<p>github\u4e0a\u6709\u76f4\u63a5\u6839\u636e\u6ce8\u89e3\u8fdb\u884c\u9759\u6001\u89e3\u6790\uff0c\u751f\u6210\u5bf9\u5e94\u7684yaml\u63a5\u53e3\u6587\u6863\uff0c\u5982 https://github.com/UbiqueInnovation/springboot-swagger3 \uff0c\u4f46\u662f\u9c81\u68d2\u6027\u4e0d\u591f\uff1b</p> <p>\u5de5\u5177\uff1a</p> <ul> <li> <p>springdoc-openapi : \u5728SpringBoot\u4e2d\u4f7f\u7528OpenAPI 3\u7684\u6ce8\u89e3\uff1b</p> </li> <li> <p>springdoc-openapi-maven-plugin : \u6839\u636e OpenAPI 3\u7684\u6ce8\u89e3\u751f\u6210OpenAPI 3\u7684Yaml\uff0c\u4f9d\u8d56\u4e8e <code>spring-boot-maven</code> \u63d2\u4ef6</p> </li> <li>Maven\u5728\u96c6\u6210\u6d4b\u8bd5\u9636\u6bb5\uff08integration-test\uff09\u8fd0\u884c openapi \u63d2\u4ef6\uff08\u901a\u8fc7<code>mvn verify</code>\uff09\u3002</li> </ul> <p>\u95ee\u9898\u70b9\uff1a</p> <ul> <li>\u4f46\u662f\u5728CI\u9636\u6bb5\uff0c\u4e00\u822c\u4e0d\u8fdb\u884cverify\uff0c\u4ec5package\u4e0d\u4f1a\u8fd0\u884cspring\uff0c\u4e5f\u5c31\u65e0\u6cd5\u751f\u6210 Yaml\uff1b</li> </ul> <p>\u5177\u4f53\u4ee3\u7801\u89c1 \u6839\u636e\u6ce8\u89e3\u751f\u6210Yaml</p>"},{"location":"web/backend/api_manager.html#_3","title":"\u63a5\u53e3\u6587\u6863\u6ce8\u89e3\u751f\u6210","text":""},{"location":"web/backend/api_manager.html#openapiswagger-3","title":"OpenAPI/Swagger 3\u89c4\u8303","text":"<p>https://github.com/swagger-api/swagger-codegen</p> <ul> <li>\u652f\u6301json\u548cyaml\u6587\u4ef6\u89e3\u6790\uff0c\u81ea\u52a8\u751f\u6210\u591a\u79cd\u8bed\u8a00\u7684API\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668stub\uff1b</li> <li>swagger\u914d\u7f6e\u89c4\u8303\u8bf4\u660e\uff0chttps://swagger.io/specification\uff1b</li> <li>swagger maven plugin\uff0chttps://github.com/garethjevans/swagger-codegen-maven-plugin\uff1b</li> </ul> <p></p>"},{"location":"web/backend/api_manager.html#springboot-springdoc","title":"springboot \u96c6\u6210\uff08springdoc\uff09","text":"<p>springfox \u4e0d\u652f\u6301 springboot 2.4 \u4ee5\u4e0a\u7684\u7248\u672c\uff0c\u6700\u65b0\u66f4\u65b0\u65f6\u95f4\u4e3a 2020/10/14\u53f7\u3002</p> <p>[springdoc \u4e0e springboot \u7684\u7248\u672c\u517c\u5bb9\u6027](https://springdoc.org/v2/#what-is-the-compatibility-matrix-of-springdoc-openapi-with-spring-boot\uff1a</p> spring-boot Versions Minimum springdoc-openapi Versions <code>3.0.x</code> <code>2.0.x</code>+ <code>2.7.x</code>, <code>1.5.x</code> <code>1.6.0</code>+ <code>2.6.x</code>, <code>1.5.x</code> <code>1.6.0</code>+ <code>2.5.x</code>, <code>1.5.x</code> <code>1.5.9</code>+ <code>2.4.x</code>, <code>1.5.x</code> <code>1.5.0</code>+ <code>2.3.x</code>, <code>1.5.x</code> <code>1.4.0</code>+ <code>2.2.x</code>, <code>1.5.x</code> <code>1.2.1</code>+ <code>2.0.x</code>, <code>1.5.x</code> <code>1.0.0</code>+ <p><code>SpringFox - SpringDoc</code> \u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b</p> <ul> <li><code>@Api</code> \u2192 <code>@Tag</code></li> <li><code>@ApiIgnore</code> \u2192 <code>@Parameter(hidden = true)</code> or <code>@Operation(hidden = true)</code> or <code>@Hidden</code></li> <li><code>@ApiImplicitParam</code> \u2192 <code>@Parameter</code></li> <li><code>@ApiImplicitParams</code> \u2192 <code>@Parameters</code></li> <li><code>@ApiModel</code> \u2192 <code>@Schema</code></li> <li><code>@ApiModelProperty(hidden = true)</code> \u2192 <code>@Schema(accessMode = READ_ONLY)</code></li> <li><code>@ApiModelProperty</code> \u2192 <code>@Schema</code></li> <li><code>@ApiOperation(value = \"foo\", notes = \"bar\")</code> \u2192 <code>@Operation(summary = \"foo\", description = \"bar\")</code></li> <li><code>@ApiParam</code> \u2192 <code>@Parameter</code></li> <li><code>@ApiResponse(code = 404, message = \"foo\")</code> \u2192 <code>@ApiResponse(responseCode = \"404\", description = \"foo\")</code></li> </ul> <p>\u793a\u4f8b\u9879\u76ee\u89c1</p> <ul> <li>\u6839\u636eYaml\u751f\u6210SpringBoot\u63a5\u53e3</li> <li>\u6839\u636e\u6ce8\u89e3\u751f\u6210Yaml</li> </ul>"},{"location":"web/backend/api_manager.html#swagger-todo","title":"Swagger \u6dfb\u52a0\u81ea\u5b9a\u4e49\u6ce8\u89e3\u7684\u4fe1\u606f\uff08TODO\uff09","text":""},{"location":"web/backend/code_action.html","title":"\u4ee3\u7801\u5b9e\u6218","text":""},{"location":"web/backend/code_action.html#java","title":"Java \u4ee3\u7801\u98ce\u683c","text":"<p>IDEA \u6b63\u5e38\u7684\u4ee3\u7801\u683c\u5f0f</p> <p>\u5e38\u91cf\u548c\u53d8\u91cf</p> <ul> <li>\u6709\u610f\u4e49\u7684\u547d\u540d\uff1b</li> <li>\u7981\u6b62\u9b54\u6cd5\u503c\uff0c\u5b9a\u4e49\u6709\u610f\u4e49\u7684\u5e38\u91cf/\u679a\u4e3e\uff1b</li> </ul> <p>\u6362\u884c\u4e0e\u9ad8\u5ea6</p> <ul> <li>\u5355\u65b9\u6cd5\u957f\u5ea6\u4e0d\u8d85\u8fc780\u884c\uff0c\u5355\u884c\u957f\u5ea6 120\u5b57\u7b26\uff1b</li> </ul> <p>\u63a7\u5236\u8bed\u53e5</p> <ul> <li>\u591a\u5c42\u5d4c\u5957\u4e0d\u8d85\u8fc7\u4e09\u5c42\uff0c\u56e0\u6761\u4ef6\u5224\u65ad\u548c\u5206\u652f\u903b\u8f91\u5448\u6307\u6570\u5173\u7cfb\uff0c\uff08\u536b\u8bed\u53e5\uff0c\u7b56\u7565\u6a21\u5f0f\uff0c\u72b6\u6001\u6a21\u5f0f\uff09\uff1b</li> </ul> <p>\u6ce8\u91ca</p> <ul> <li>Nothing is strange\uff1a\u9700\u8981\u6ce8\u91ca\uff1b</li> <li>Less is more\uff1a\u4ee3\u7801\u81ea\u89e3\u91ca\uff1b</li> <li>Advance with the time\uff1a\u8ddf\u4ee3\u7801\u65f6\u523b\u4fdd\u6301\u4e00\u81f4\uff1b</li> </ul>"},{"location":"web/backend/code_action.html#pojo","title":"POJO","text":"<p>Plain Ordinary Java Object\uff1a\u53ea\u542b get, set, toString \u65b9\u6cd5 \u7684\u7b80\u5355\u7c7b</p> <p>DO: Domain Object</p> <p>BO: Bussiness Object</p> <p>DTO: Data Transfer Object</p> <p>VO: Viewer Object</p> <p>AO: Application Object</p>"},{"location":"web/backend/code_action.html#_2","title":"\u57fa\u672c\u7c7b\u578b\u548c\u5305\u88c5\u7c7b\u578b","text":"<p>\u4f7f\u7528\u57fa\u672c\u7c7b\u578b\u8fd8\u662f\u5305\u88c5\u7c7b\u578b\uff1a</p> <ul> <li>\u6240\u6709\u7684 POJO \u7c7b\u5c5e\u6027\u5fc5\u987b\u4f7f\u7528\u5305\u88c5\u6570\u636e\u7c7b\u578b\uff08\u533a\u5206\u9ed8\u8ba4\u503c\u548cNULL\uff09\uff1b</li> <li>RPC\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u548c\u53c2\u6570\u5fc5\u987b\u4f7f\u7528\u5305\u88c5\u6570\u636e\u7c7b\u578b\uff1b</li> <li>\u6240\u6709\u7684\u5c40\u90e8\u53d8\u91cf\u63a8\u8350\u4f7f\u7528\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff1b</li> </ul>"},{"location":"web/backend/code_action.html#ddd","title":"DDD(\u9886\u57df\u9a71\u52a8\u8bbe\u8ba1)","text":"<p>DDD: Domain Driven Design</p> <p>\u53c2\u8003\u6587\u732e\uff1a\u6bb7\u6d69\u8be6\u89e3DDD\uff1a\u5982\u4f55\u907f\u514d\u5199\u6d41\u6c34\u8d26\u4ee3\u7801\uff1f</p> <p>\u9762\u5bf9\u8001\u7cfb\u7edf\u91cd\u6784\u548c\u8fc1\u79fb\u573a\u666f\uff0c\u6709\u5927\u91cf\u4ee3\u7801\u5c5e\u4e8e\u6d41\u6c34\u8d26\u4ee3\u7801\uff0c\u901a\u5e38\u80fd\u770b\u5230\u5f00\u53d1\u5728\u5bf9\u5916\u7684API\u63a5\u53e3\u91cc\u76f4\u63a5\u5199\u4e1a\u52a1\u903b\u8f91\u4ee3\u7801\uff0c\u6216\u8005\u5728\u4e00\u4e2a\u670d\u52a1\u91cc\u5927\u91cf\u7684\u5806\u63a5\u53e3\uff0c\u5bfc\u81f4\u4e1a\u52a1\u903b\u8f91\u5b9e\u9645\u65e0\u6cd5\u6536\u655b\uff0c\u63a5\u53e3\u590d\u7528\u6027\u6bd4\u8f83\u5dee\u3002</p>"},{"location":"web/backend/code_action.html#_3","title":"\u793a\u4f8b","text":"<p>\u8ba2\u5355\u573a\u666f</p> <pre><code>@RestController\n@RequestMapping(\"/\")\npublic class CheckoutController {\n    @Resource\n    private ItemService itemService;\n    @Resource\n    private InventoryService inventoryService;\n    @Resource\n    private OrderRepository orderRepository;\n\n    @PostMapping(\"checkout\")\n    public Result&lt;OrderDO&gt; checkout(Long itemId, Integer quantity) {\n        // 1) Session\u7ba1\u7406\n        Long userId = SessionUtils.getLoggedInUserId();\n        if (userId &lt;= 0) {\n            return Result.fail(\"Not Logged In\");\n        }\n\n        // 2\uff09\u53c2\u6570\u6821\u9a8c\n        if (itemId &lt;= 0 || quantity &lt;= 0 || quantity &gt;= 1000) {\n            return Result.fail(\"Invalid Args\");\n        }\n\n        // 3\uff09\u5916\u90e8\u6570\u636e\u8865\u5168\n        ItemDO item = itemService.getItem(itemId);\n        if (item == null) {\n            return Result.fail(\"Item Not Found\");\n        }\n\n        // 4\uff09\u8c03\u7528\u5916\u90e8\u670d\u52a1\n        boolean withholdSuccess = inventoryService.withhold(itemId, quantity);\n        if (!withholdSuccess) {\n            return Result.fail(\"Inventory not enough\");\n        }\n\n        // 5\uff09\u9886\u57df\u8ba1\u7b97\n        Long cost = item.getPriceInCents() * quantity;\n\n        // 6\uff09\u9886\u57df\u5bf9\u8c61\u64cd\u4f5c\n        OrderDO order = new OrderDO();\n        order.setItemId(itemId);\n        order.setBuyerId(userId);\n        order.setSellerId(item.getSellerId());\n        order.setCount(quantity);\n        order.setTotalCost(cost);\n\n        // 7\uff09\u6570\u636e\u6301\u4e45\u5316\n        orderRepository.createOrder(order);\n\n        // 8\uff09\u8fd4\u56de\n        return Result.success(order);\n    }\n}\n</code></pre>"},{"location":"web/backend/code_action.html#_4","title":"\u95ee\u9898","text":"<p>\u8fdd\u80cc\u4e86<code>SRP\uff08Single Responsbility Principle\uff09</code>\u5355\u4e00\u804c\u8d23\u539f\u5219\u3002\u8fd9\u6bb5\u4ee3\u7801\u91cc\u6df7\u6742\u4e86\u4e1a\u52a1\u8ba1\u7b97\u3001\u6821\u9a8c\u903b\u8f91\u3001\u57fa\u7840\u8bbe\u65bd\u3001\u548c\u901a\u4fe1\u534f\u8bae\u7b49\uff0c\u5728\u672a\u6765\u65e0\u8bba\u54ea\u4e00\u90e8\u5206\u7684\u903b\u8f91\u53d8\u66f4\u90fd\u4f1a\u76f4\u63a5\u5f71\u54cd\u5230\u8fd9\u6bb5\u4ee3\u7801\uff0c\u5f53\u540e\u4eba\u4e0d\u65ad\u5730\u5728\u4e0a\u9762\u53e0\u52a0\u65b0\u7684\u903b\u8f91\u65f6\uff0c\u4f1a\u4f7f\u4ee3\u7801\u590d\u6742\u5ea6\u589e\u52a0\u3001\u903b\u8f91\u5206\u652f\u8d8a\u6765\u8d8a\u591a\uff0c\u6700\u7ec8\u9020\u6210bug\u6216\u8005\u6ca1\u4eba\u6562\u91cd\u6784\u7684\u5386\u53f2\u5305\u88b1\u3002</p>"},{"location":"web/backend/code_action.html#_5","title":"\u5206\u5c42\u601d\u60f3","text":"<p>\u901a\u8fc7\u4e0d\u540c\u7684\u4ee3\u7801\u5206\u5c42\u548c\u89c4\u8303\uff0c\u62c6\u5206\u51fa\u903b\u8f91\u6e05\u6670\u3001\u804c\u8d23\u660e\u786e\u7684\u5206\u5c42\u548c\u6a21\u5757\uff0c\u4e5f\u4fbf\u4e8e\u4e00\u4e9b\u901a\u7528\u80fd\u529b\u7684\u6c89\u6dc0\u3002</p> <p>\u4e3b\u8981\u7684\u51e0\u4e2a\u6b65\u9aa4\u5206\u4e3a\uff1a</p> <ul> <li> <p>\u5206\u79bb\u51fa\u72ec\u7acb\u7684Interface\u63a5\u53e3\u5c42\uff0c\u8d1f\u8d23\u5904\u7406\u7f51\u7edc\u534f\u8bae\u76f8\u5173\u7684\u903b\u8f91\u3002</p> </li> <li> <p>\u4ece\u771f\u5b9e\u4e1a\u52a1\u573a\u666f\u4e2d\uff0c\u627e\u51fa\u5177\u4f53\u7528\u4f8b\uff08Use Cases\uff09\uff0c\u7136\u540e\u5c06\u5177\u4f53\u7528\u4f8b\u901a\u8fc7\u4e13\u7528\u7684Command\u6307\u4ee4\u3001Query\u67e5\u8be2\u3001\u548cEvent\u4e8b\u4ef6\u5bf9\u8c61\u6765\u627f\u63a5\u3002</p> </li> <li> <p>\u5206\u79bb\u51fa\u72ec\u7acb\u7684Application\u5e94\u7528\u5c42\uff0c\u8d1f\u8d23\u4e1a\u52a1\u6d41\u7a0b\u7684\u7f16\u6392\uff0c\u54cd\u5e94Command\u3001Query\u548cEvent\u3002\u6bcf\u4e2a\u5e94\u7528\u5c42\u7684\u65b9\u6cd5\u5e94\u8be5\u4ee3\u8868\u6574\u4e2a\u4e1a\u52a1\u6d41\u7a0b\u4e2d\u7684\u4e00\u4e2a\u8282\u70b9\u3002</p> </li> <li> <p>\u5904\u7406\u4e00\u4e9b\u8de8\u5c42\u7684\u6a2a\u5207\u5173\u6ce8\u70b9\uff0c\u5982\u9274\u6743\u3001\u5f02\u5e38\u5904\u7406\u3001\u6821\u9a8c\u3001\u7f13\u5b58\u3001\u65e5\u5fd7\u7b49\u3002</p> </li> </ul>"},{"location":"web/backend/code_action.html#interface","title":"Interface\u63a5\u53e3\u5c42","text":"<p>\u7f51\u7edc\u534f\u8bae\u548c\u4e1a\u52a1\u903b\u8f91\u89e3\u8026\uff1a\u4e1a\u52a1\u4ee3\u7801\u548c\u7f51\u7edc\u534f\u8bae\u6df7\u6742\u5728\u4e00\u8d77\uff0c\u5219\u4f1a\u76f4\u63a5\u5bfc\u81f4\u4ee3\u7801\u8ddf\u7f51\u7edc\u534f\u8bae\u7ed1\u5b9a\uff0c\u65e0\u6cd5\u88ab\u590d\u7528\u3002</p> <p>\u63a5\u53e3\u5c42\u7684\u7ec4\u6210\uff1a</p> <ul> <li> <p>\u7f51\u7edc\u534f\u8bae\u7684\u8f6c\u5316\uff1a\u901a\u5e38\u8fd9\u4e2a\u5df2\u7ecf\u7531\u5404\u79cd\u6846\u67b6\u7ed9\u5c01\u88c5\u6389\u4e86\uff0c\u6211\u4eec\u9700\u8981\u6784\u5efa\u7684\u7c7b\u8981\u4e48\u662f\u88ab\u6ce8\u89e3\u7684bean\uff0c\u8981\u4e48\u662f\u7ee7\u627f\u4e86\u67d0\u4e2a\u63a5\u53e3\u7684bean\u3002</p> </li> <li> <p>\u7edf\u4e00\u9274\u6743\uff1a\u6bd4\u5982\u5728\u4e00\u4e9b\u9700\u8981AppKey+Secret\u7684\u573a\u666f\uff0c\u9700\u8981\u9488\u5bf9\u67d0\u4e2a\u79df\u6237\u505a\u9274\u6743\u7684\uff0c\u5305\u62ec\u4e00\u4e9b\u52a0\u5bc6\u4e32\u7684\u6821\u9a8c</p> </li> <li> <p>Session\u7ba1\u7406\uff1a\u4e00\u822c\u5728\u9762\u5411\u7528\u6237\u7684\u63a5\u53e3\u6216\u8005\u6709\u767b\u9646\u6001\u7684\uff0c\u901a\u8fc7Session\u6216\u8005RPC\u4e0a\u4e0b\u6587\u53ef\u4ee5\u62ff\u5230\u5f53\u524d\u8c03\u7528\u7684\u7528\u6237\uff0c\u4ee5\u4fbf\u4f20\u9012\u7ed9\u4e0b\u6e38\u670d\u52a1\u3002</p> </li> <li> <p>\u9650\u6d41\u914d\u7f6e\uff1a\u5bf9\u63a5\u53e3\u505a\u9650\u6d41\u907f\u514d\u5927\u6d41\u91cf\u6253\u5230\u4e0b\u6e38\u670d\u52a1</p> </li> <li> <p>\u524d\u7f6e\u7f13\u5b58\uff1a\u9488\u5bf9\u53d8\u66f4\u4e0d\u662f\u5f88\u9891\u7e41\u7684\u53ea\u8bfb\u573a\u666f\uff0c\u53ef\u4ee5\u524d\u7f6e\u7ed3\u679c\u7f13\u5b58\u5230\u63a5\u53e3\u5c42</p> </li> <li> <p>\u5f02\u5e38\u5904\u7406\uff1a\u901a\u5e38\u5728\u63a5\u53e3\u5c42\u8981\u907f\u514d\u5c06\u5f02\u5e38\u76f4\u63a5\u66b4\u9732\u7ed9\u8c03\u7528\u7aef\uff0c\u6240\u4ee5\u9700\u8981\u5728\u63a5\u53e3\u5c42\u505a\u7edf\u4e00\u7684\u5f02\u5e38\u6355\u83b7\uff0c\u8f6c\u5316\u4e3a\u8c03\u7528\u7aef\u53ef\u4ee5\u7406\u89e3\u7684\u6570\u636e\u683c\u5f0f\uff1b</p> </li> <li> <p>\u65e5\u5fd7\uff1a\u5728\u63a5\u53e3\u5c42\u6253\u8c03\u7528\u65e5\u5fd7\uff0c\u7528\u6765\u505a\u7edf\u8ba1\u548cdebug\u7b49\u3002\u4e00\u822c\u5fae\u670d\u52a1\u6846\u67b6\u53ef\u80fd\u90fd\u76f4\u63a5\u5305\u542b\u4e86\u8fd9\u4e9b\u529f\u80fd\u3002</p> </li> </ul> <p>\u5728Interface\u5c42\uff0c\u9274\u6743\u3001Session\u3001\u9650\u6d41\u3001\u7f13\u5b58\u3001\u65e5\u5fd7\u7b49\u90fd\u6bd4\u8f83\u76f4\u63a5\uff0c\u53ea\u6709\u4e00\u4e2a\u5f02\u5e38\u5904\u7406\u7684\u70b9\u9700\u8981\u91cd\u70b9\u8bf4\u4e0b\u3002</p> <p>Result VS Exception</p> <p>Interface\u5c42\u7684HTTP\u548cRPC\u63a5\u53e3\uff0c\u8fd4\u56de\u503c\u4e3aResult\uff0c\u6355\u6349\u6240\u6709\u5f02\u5e38</p> <p>Application\u5c42\u7684\u6240\u6709\u63a5\u53e3\u8fd4\u56de\u503c\u4e3aDTO\uff0c\u4e0d\u8d1f\u8d23\u5904\u7406\u5f02\u5e38</p> <p>AOP\u5f02\u5e38\u5904\u7406\u6ce8\u89e3</p> <p>\u66f4\u7b80\u6d01\u7684\u65b9\u5f0f\uff1a\u901a\u8fc7\u5bf9Controller\u7684\u63a5\u53e3\u505a\u5f02\u5e38\u7edf\u4e00\u5904\u7406\uff0c\u907f\u514d\u6bcf\u4e2a\u63a5\u53e3\u90fd\u9700\u8981\u5199\u6ce8\u89e3\u3002</p> <pre><code>@PostMapping(\"checkout\")\n@ResultHandler\npublic Result&lt;OrderDTO&gt; checkout(Long itemId, Integer quantity) {\n    CheckoutCommand cmd = new CheckoutCommand();\n    OrderDTO orderDTO = checkoutService.checkout(cmd);\n    return Result.success(orderDTO);\n}\n</code></pre> <p>\u63a5\u53e3\u5c42\u7684\u63a5\u53e3\u7684\u6570\u91cf\u548c\u4e1a\u52a1\u95f4\u7684\u9694\u79bb</p> <p>\u4e00\u4e2aInterface\u5c42\u7684\u7c7b\u5e94\u8be5\u662f\u201c\u5c0f\u800c\u7f8e\u201d\u7684\uff0c\u5e94\u8be5\u662f\u9762\u5411\u201c\u4e00\u4e2a\u5355\u4e00\u7684\u4e1a\u52a1\u201d\u6216\u201c\u4e00\u7c7b\u540c\u6837\u9700\u6c42\u7684\u4e1a\u52a1\u201d\uff0c\u9700\u8981\u5c3d\u91cf\u907f\u514d\u7528\u540c\u4e00\u4e2a\u7c7b\u627f\u63a5\u4e0d\u540c\u7c7b\u578b\u4e1a\u52a1\u7684\u9700\u6c42\u3002</p> <p>\u523b\u610f\u53bb\u8ffd\u6c42\u63a5\u53e3\u7684\u7edf\u4e00\u901a\u5e38\u4f1a\u5bfc\u81f4\u65b9\u6cd5\u4e2d\u7684\u53c2\u6570\u81a8\u80c0\uff0c\u6216\u8005\u5bfc\u81f4\u65b9\u6cd5\u7684\u81a8\u80c0\u3002</p> <p>\u4f8b\u5b50\uff1a\u5047\u8bbe\u6709\u4e00\u4e2a\u5ba0\u7269\u5361\u548c\u4e00\u4e2a\u4eb2\u5b50\u5361\u7684\u4e1a\u52a1\u5171\u7528\u4e00\u4e2a\u5f00\u5361\u670d\u52a1\uff0c\u4f46\u662f\u5ba0\u7269\u9700\u8981\u4f20\u5165\u5ba0\u7269\u7c7b\u578b\uff0c\u4eb2\u5b50\u7684\u9700\u8981\u4f20\u5165\u5b9d\u5b9d\u5e74\u9f84\u3002</p> <pre><code>// \u53ef\u4ee5\u662fRPC Provider \u6216\u8005 Controller\npublic interface CardService {\n    // 1\uff09\u7edf\u4e00\u63a5\u53e3\uff0c\u53c2\u6570\u81a8\u80c0\n    Result openCard(int petType, int babyAge);\n    // 2\uff09\u7edf\u4e00\u6cdb\u5316\u63a5\u53e3\uff0c\u53c2\u6570\u8bed\u610f\u4e22\u5931\n    Result openCardV2(Map&lt;String, Object&gt; params);\n    // 3\uff09\u4e0d\u6cdb\u5316\uff0c\u540c\u4e00\u4e2a\u7c7b\u91cc\u7684\u63a5\u53e3\u81a8\u80c0\n    Result openPetCard(int petType);\n    Result openBabyCard(int babyAge);\n}\n</code></pre> <p>\u4e00\u4e2a\u5efa\u8bae\u662f\u5f53\u4e00\u4e2a\u73b0\u6709\u7684\u63a5\u53e3\u7c7b\u8fc7\u5ea6\u81a8\u80c0\u65f6\uff0c\u53ef\u4ee5\u8003\u8651\u5bf9\u63a5\u53e3\u7c7b\u505a\u62c6\u5206\uff0c\u62c6\u5206\u539f\u5219\u548cSRP\u4e00\u81f4\u3002</p> <pre><code>public interface PetCardService {\n    Result openPetCard(int petType);\n}\n\npublic interface BabyCardService {\n    Result openBabyCard(int babyAge);\n}\n</code></pre> <p>\u5728DDD\u5206\u5c42\u67b6\u6784\u91cc\uff0c\u63a5\u53e3\u7c7b\u7684\u6838\u5fc3\u4f5c\u7528\u4ec5\u4ec5\u662f\u534f\u8bae\u5c42\uff0c\u6bcf\u7c7b\u4e1a\u52a1\u7684\u534f\u8bae\u53ef\u4ee5\u662f\u4e0d\u540c\u7684\uff0c\u800c\u771f\u5b9e\u7684\u4e1a\u52a1\u903b\u8f91\u4f1a\u6c89\u6dc0\u5230\u5e94\u7528\u5c42\u3002Interface\u548cApplication\u7684\u5173\u7cfb\u662f\u591a\u5bf9\u591a\u7684\u3002\u5e0c\u671b\u76f8\u5bf9\u7a33\u5b9a\u7684\u662fApplication\u5c42\u7684\u903b\u8f91\u3002</p> <p></p>"},{"location":"web/backend/code_action.html#application","title":"Application\u5c42","text":"<p>ApplicationService\u7684\u63a5\u53e3\u5165\u53c2\u53ea\u80fd\u662f\u4e00\u4e2aCommand\u3001Query\u6216Event\u5bf9\u8c61\uff0cCQE\u5bf9\u8c61\u9700\u8981\u80fd\u4ee3\u8868\u5f53\u524d\u65b9\u6cd5\u7684\u8bed\u610f\u3002\u552f\u4e00\u53ef\u4ee5\u7684\u4f8b\u5916\u662f\u6839\u636e\u5355\u4e00ID\u67e5\u8be2\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u7701\u7565\u6389\u4e00\u4e2aQuery\u5bf9\u8c61\u7684\u521b\u5efa\u3002</p> <p>Application\u5c42\u7684\u51e0\u4e2a\u6838\u5fc3\u7c7b\uff1a</p> <ul> <li> <p>ApplicationService\u5e94\u7528\u670d\u52a1\uff1a\u6700\u6838\u5fc3\u7684\u7c7b\uff0c\u8d1f\u8d23\u4e1a\u52a1\u6d41\u7a0b\u7684\u7f16\u6392\uff0c\u4f46\u672c\u8eab\u4e0d\u8d1f\u8d23\u4efb\u4f55\u4e1a\u52a1\u903b\u8f91\u3002</p> </li> <li> <p>DTO Assembler\uff1a\u8d1f\u8d23\u5c06\u5185\u90e8\u9886\u57df\u6a21\u578b\u8f6c\u5316\u4e3a\u53ef\u5bf9\u5916\u7684DTO\u3002</p> </li> <li> <p>Command\u3001Query\u3001Event\u5bf9\u8c61\uff1a\u4f5c\u4e3aApplicationService\u7684\u5165\u53c2\u3002</p> </li> <li> <p>\u8fd4\u56de\u7684DTO\uff1a\u4f5c\u4e3aApplicationService\u7684\u51fa\u53c2\u3002</p> </li> </ul> <p>CQE</p> <p></p> <p>\u793a\u4f8b\uff1a</p> <pre><code>List&lt;OrderDO&gt; queryByItemId(Long itemId);\nList&lt;OrderDO&gt; queryBySellerId(Long sellerId);\nList&lt;OrderDO&gt; queryBySellerIdWithPage(Long sellerId, int currentPage, int pageSize);\n</code></pre> <p>\u95ee\u9898\u5728\u4e8e\uff1a</p> <ul> <li>\u96be\u4ee5\u6269\u5c55\uff1a\u6bcf\u65b0\u589e\u4e00\u4e2a\u53c2\u6570\u90fd\u6709\u53ef\u80fd\u9700\u8981\u8c03\u7528\u65b9\u5347\u7ea7\u3002</li> <li>\u96be\u4ee5\u6d4b\u8bd5\uff1a\u63a5\u53e3\u4e00\u591a\uff0c\u804c\u8d23\u968f\u4e4b\u53d8\u5f97\u7e41\u6742\uff0c\u4e1a\u52a1\u573a\u666f\u5404\u5f02\uff0c\u6d4b\u8bd5\u7528\u4f8b\u96be\u4ee5\u7ef4\u62a4\u3002</li> <li>\u8fd9\u79cd\u7c7b\u578b\u7684\u53c2\u6570\u7f57\u5217\uff0c\u672c\u8eab\u6ca1\u6709\u4efb\u4f55\u4e1a\u52a1\u4e0a\u7684\u201d\u8bed\u610f\u201c\uff0c\u53ea\u662f\u4e00\u5806\u53c2\u6570\u800c\u5df2\uff0c\u65e0\u6cd5\u660e\u786e\u7684\u8868\u8fbe\u51fa\u6765\u610f\u56fe\u3002</li> </ul> <pre><code>public interface CheckoutService {\n    OrderDTO checkout(@Valid CheckoutCommand cmd);\n    List&lt;OrderDTO&gt; query(OrderQuery query);\n    OrderDTO getOrder(Long orderId); // \u6ce8\u610f\u5355\u4e00ID\u67e5\u8be2\u53ef\u4ee5\u4e0d\u7528Query\n}\n\n@Data\npublic class CheckoutCommand {\n    private Long userId;\n    private Long itemId;\n    private Integer quantity;\n}\n\n@Data\npublic class OrderQuery {\n    private Long sellerId;\n    private Long itemId;\n    private int currentPage;\n    private int pageSize;\n}\n</code></pre> <p>\u8fd9\u4e2a\u89c4\u8303\u7684\u597d\u5904\u662f\uff1a\u63d0\u5347\u4e86\u63a5\u53e3\u7684\u7a33\u5b9a\u6027\u3001\u964d\u4f4e\u4f4e\u7ea7\u7684\u91cd\u590d\uff0c\u5e76\u4e14\u8ba9\u63a5\u53e3\u5165\u53c2\u66f4\u52a0\u8bed\u610f\u5316\u3002</p> <p>CQE vs DTO</p> <ul> <li>CQE\u662f\u201d\u610f\u56fe\u201c\uff0c\u6240\u4ee5CQE\u5bf9\u8c61\u5728\u7406\u8bba\u4e0a\u53ef\u4ee5\u6709\u201d\u65e0\u9650\u201c\u4e2a\uff0c\u6bcf\u4e2a\u4ee3\u8868\u4e0d\u540c\u7684\u610f\u56fe\uff1b</li> <li>DTO\u4f5c\u4e3a\u6a21\u578b\u6570\u636e\u5bb9\u5668\uff0c\u548c\u6a21\u578b\u4e00\u4e00\u5bf9\u5e94\uff0c\u6240\u4ee5\u662f\u6709\u9650</li> </ul> <p>CQE\u7684\u6821\u9a8c</p> <p>\u5229\u7528java\u6807\u51c6JSR303\u6216JSR380\u7684Bean Validation\u6765\u524d\u7f6e\u8fd9\u4e2a\u6821\u9a8c\u903b\u8f91\u3002</p> <p>CQE\u5bf9\u8c61\u7684\u6821\u9a8c\u5e94\u8be5\u524d\u7f6e\uff0c\u907f\u514d\u5728ApplicationService\u91cc\u505a\u53c2\u6570\u7684\u6821\u9a8c\u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7JSR303/380\u548cSpring Validation\u6765\u5b9e\u73b0\u3002</p> <p>\u524d\u9762\u793a\u4f8b\u6539\u4e3a\uff1a</p> <pre><code>@Validated // Spring\u7684\u6ce8\u89e3\npublic class CheckoutServiceImpl implements CheckoutService {\n    OrderDTO checkout(@Valid CheckoutCommand cmd) { // \u8fd9\u91cc@Valid\u662fJSR-303/380\u7684\u6ce8\u89e3\n        // \u5982\u679c\u6821\u9a8c\u5931\u8d25\u4f1a\u629b\u5f02\u5e38\uff0c\u5728interface\u5c42\u88ab\u6355\u6349\n    }\n}\n@Data\npublic class CheckoutCommand {\n    @NotNull(message = \"\u7528\u6237\u672a\u767b\u9646\")\n    private Long userId;\n    @NotNull\n    @Positive(message = \"\u9700\u8981\u662f\u5408\u6cd5\u7684itemId\")\n    private Long itemId;\n    @NotNull\n    @Min(value = 1, message = \"\u6700\u5c111\u4ef6\")\n    @Max(value = 1000, message = \"\u6700\u591a\u4e0d\u80fd\u8d85\u8fc71000\u4ef6\")\n    private Integer quantity;\n}\n</code></pre> <p>\u907f\u514d\u590d\u7528CQE</p> <p>CQE\u662f\u6709\u201c\u610f\u56fe\u201d\u548c\u201c\u8bed\u610f\u201d\u7684\uff0c\u6211\u4eec\u9700\u8981\u5c3d\u91cf\u907f\u514dCQE\u5bf9\u8c61\u7684\u590d\u7528\uff0c\u54ea\u6015\u6240\u6709\u7684\u53c2\u6570\u90fd\u4e00\u6837\uff0c\u53ea\u8981\u4ed6\u4eec\u7684\u8bed\u610f\u4e0d\u540c\uff0c\u5c3d\u91cf\u8fd8\u662f\u8981\u7528\u4e0d\u540c\u7684\u5bf9\u8c61\u3002\u6bd4\u5982\u5bf9\u4e8eCreate\u548cUpdate\uff0c\u867d\u7136\u53ea\u6709Id\u7684\u533a\u522b\uff0c\u4f46\u4e24\u4e2a\u64cd\u4f5c\u7684\u8bed\u610f\u5b8c\u5168\u4e0d\u4e00\u6837\uff0c\u4ed6\u4eec\u7684\u6821\u9a8c\u6761\u4ef6\u53ef\u80fd\u4e5f\u5b8c\u5168\u4e0d\u4e00\u6837\uff0c\u6240\u4ee5\u4e0d\u5e94\u8be5\u590d\u7528\u540c\u4e00\u4e2a\u5bf9\u8c61\u3002</p> <p>\u89c4\u8303\uff1a\u9488\u5bf9\u4e8e\u4e0d\u540c\u8bed\u610f\u7684\u6307\u4ee4\uff0c\u8981\u907f\u514dCQE\u5bf9\u8c61\u7684\u590d\u7528\u3002</p> <p>DTO Assembler\uff08mapstruct\u5e93\uff09</p> <p>ApplicationService\u5e94\u8be5\u6c38\u8fdc\u8fd4\u56deDTO\u800c\u4e0d\u662fEntity\u3002</p> <ul> <li> <p>\u6784\u5efa\u9886\u57df\u8fb9\u754c\uff1aApplicationService\u7684\u5165\u53c2\u662fCQE\u5bf9\u8c61\uff0c\u51fa\u53c2\u662fDTO\uff0c\u8fd9\u4e9b\u57fa\u672c\u4e0a\u90fd\u5c5e\u4e8e\u7b80\u5355\u7684POJO\uff0c\u6765\u786e\u4fddApplication\u5c42\u7684\u5185\u5916\u4e92\u76f8\u4e0d\u5f71\u54cd\u3002</p> </li> <li> <p>\u964d\u4f4e\u89c4\u5219\u4f9d\u8d56\uff1aEntity\u91cc\u9762\u901a\u5e38\u4f1a\u5305\u542b\u4e1a\u52a1\u89c4\u5219\uff0c\u5982\u679cApplicationService\u8fd4\u56deEntity\uff0c\u5219\u4f1a\u5bfc\u81f4\u8c03\u7528\u65b9\u76f4\u63a5\u4f9d\u8d56\u4e1a\u52a1\u89c4\u5219\u3002\u5982\u679c\u5185\u90e8\u89c4\u5219\u53d8\u66f4\u53ef\u80fd\u76f4\u63a5\u5f71\u54cd\u5230\u5916\u90e8\u3002</p> </li> <li> <p>\u901a\u8fc7DTO\u7ec4\u5408\u964d\u4f4e\u6210\u672c\uff1aEntity\u662f\u6709\u9650\u7684\uff0cDTO\u53ef\u4ee5\u662f\u591a\u4e2aEntity\u3001VO\u7684\u81ea\u7531\u7ec4\u5408\uff0c\u4e00\u6b21\u6027\u5c01\u88c5\u6210\u590d\u6742DTO\uff0c\u6216\u8005\u6709\u9009\u62e9\u7684\u62bd\u53d6\u90e8\u5206\u53c2\u6570\u5c01\u88c5\u6210DTO\u53ef\u4ee5\u964d\u4f4e\u5bf9\u5916\u7684\u6210\u672c\u3002</p> </li> </ul> <p>DTO\u3001Entity\u548cDataObject\u4e4b\u95f4\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>Result vs Exception</p> <p>Application\u5c42\u53ea\u8fd4\u56deDTO\uff0c\u53ef\u4ee5\u76f4\u63a5\u629b\u5f02\u5e38\uff0c\u4e0d\u7528\u7edf\u4e00\u5904\u7406\u3002\u6240\u6709\u8c03\u7528\u5230\u7684\u670d\u52a1\u4e5f\u90fd\u53ef\u4ee5\u76f4\u63a5\u629b\u5f02\u5e38\uff0c\u9664\u975e\u9700\u8981\u7279\u6b8a\u5904\u7406\uff0c\u5426\u5219\u4e0d\u9700\u8981\u523b\u610f\u6355\u6349\u5f02\u5e38\u3002</p> <p>\u907f\u514d\u4e86Result\u7684\u4e00\u4e9b\u5e38\u89c1\u4e14\u7e41\u6742\u7684<code>Result.isSuccess</code>\u5224\u65ad\u3002</p> <p>Anti-Corruption Layer\u9632\u8150\u5c42</p> <pre><code>ItemDO item = itemService.getItem(cmd.getItemId());boolean withholdSuccess = inventoryService.withhold(cmd.getItemId(), cmd.getQuantity());\n</code></pre> <p>\u53d1\u73b0\u6211\u4eec\u7684ApplicationService\u4f1a\u5f3a\u4f9d\u8d56ItemService\u3001InventoryService\u4ee5\u53caItemDO\u8fd9\u4e2a\u5bf9\u8c61\u3002\u5982\u679c\u4efb\u4f55\u4e00\u4e2a\u670d\u52a1\u7684\u65b9\u6cd5\u53d8\u66f4\uff0c\u6216\u8005ItemDO\u5b57\u6bb5\u53d8\u66f4\uff0c\u90fd\u4f1a\u6709\u53ef\u80fd\u5f71\u54cd\u5230ApplicationService\u7684\u4ee3\u7801\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u81ea\u5df1\u7684\u4ee3\u7801\u4f1a\u56e0\u4e3a\u5f3a\u4f9d\u8d56\u4e86\u5916\u90e8\u7cfb\u7edf\u7684\u53d8\u5316\u800c\u53d8\u66f4\uff0c\u8fd9\u4e2a\u5728\u590d\u6742\u7cfb\u7edf\u4e2d\u5e94\u8be5\u662f\u5c3d\u91cf\u907f\u514d\u7684\u3002</p> <p>ACL\u9632\u8150\u5c42\u7684\u7b80\u5355\u539f\u7406\u5982\u4e0b\uff1a</p> <ul> <li> <p>\u5bf9\u4e8e\u4f9d\u8d56\u7684\u5916\u90e8\u5bf9\u8c61\uff0c\u6211\u4eec\u62bd\u53d6\u51fa\u6240\u9700\u8981\u7684\u5b57\u6bb5\uff0c\u751f\u6210\u4e00\u4e2a\u5185\u90e8\u6240\u9700\u7684VO\u6216DTO\u7c7b\u3002</p> </li> <li> <p>\u6784\u5efa\u4e00\u4e2a\u65b0\u7684Facade\uff0c\u5728Facade\u4e2d\u5c01\u88c5\u8c03\u7528\u94fe\u8def\uff0c\u5c06\u5916\u90e8\u7c7b\u8f6c\u5316\u4e3a\u5185\u90e8\u7c7b\u3002</p> </li> <li> <p>\u9488\u5bf9\u5916\u90e8\u7cfb\u7edf\u8c03\u7528\uff0c\u540c\u6837\u7684\u7528Facade\u65b9\u6cd5\u5c01\u88c5\u5916\u90e8\u8c03\u7528\u94fe\u8def</p> </li> </ul> <p></p> <p>Repository\u53ef\u4ee5\u8ba4\u4e3a\u662f\u4e00\u79cd\u7279\u6b8a\u7684ACL\uff0c\u5c4f\u853d\u4e86\u5177\u4f53\u6570\u636e\u64cd\u4f5c\u7684\u7ec6\u8282\uff0c\u5373\u4f7f\u5e95\u5c42\u6570\u636e\u5e93\u7ed3\u6784\u53d8\u66f4\uff0c\u6570\u636e\u5e93\u7c7b\u578b\u53d8\u66f4\uff0c\u6216\u8005\u52a0\u5165\u5176\u4ed6\u7684\u6301\u4e45\u5316\u65b9\u5f0f\uff0cRepository\u7684\u63a5\u53e3\u4fdd\u6301\u7a33\u5b9a\uff0cApplicationService\u5c31\u80fd\u4fdd\u6301\u4e0d\u53d8\u3002</p>"},{"location":"web/backend/code_action.html#_6","title":"\u547d\u4ee4\u9a71\u52a8/\u4e8b\u4ef6\u9a71\u52a8","text":"<p>\u4ee3\u7801\u4f9d\u8d56\u5173\u7cfb\u6765\u770b\uff1a</p> <ul> <li> <p>Orchestration\uff1a\u6d89\u53ca\u5230\u4e00\u4e2a\u670d\u52a1\u8c03\u7528\u5230\u53e6\u5916\u7684\u670d\u52a1\uff0c\u5bf9\u4e8e\u8c03\u7528\u65b9\u6765\u8bf4\uff0c\u662f\u5f3a\u4f9d\u8d56\u7684\u670d\u52a1\u63d0\u4f9b\u65b9\u3002</p> </li> <li> <p>Choreography\uff1a\u6bcf\u4e00\u4e2a\u670d\u52a1\u53ea\u662f\u505a\u597d\u81ea\u5df1\u7684\u4e8b\uff0c\u7136\u540e\u901a\u8fc7\u4e8b\u4ef6\u89e6\u53d1\u5176\u4ed6\u7684\u670d\u52a1\uff0c\u670d\u52a1\u4e4b\u95f4\u6ca1\u6709\u76f4\u63a5\u8c03\u7528\u4e0a\u7684\u4f9d\u8d56\u3002\u4f46\u8981\u6ce8\u610f\u7684\u662f\u4e0b\u6e38\u8fd8\u662f\u4f1a\u4f9d\u8d56\u4e0a\u6e38\u7684\u4ee3\u7801\uff08\u6bd4\u5982\u4e8b\u4ef6\u7c7b\uff09\uff0c\u6240\u4ee5\u53ef\u4ee5\u8ba4\u4e3a\u662f\u4e0b\u6e38\u5bf9\u4e0a\u6e38\u6709\u4f9d\u8d56\u3002</p> </li> </ul> <p></p> <p></p> <p>\u867d\u7136Orchestration \u548c Choreography\u662f\u4e24\u79cd\u5b8c\u5168\u4e0d\u540c\u7684\u4e1a\u52a1\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u4f46\u6700\u7ec8\u843d\u5230Application\u5c42\u7684\u4ee3\u7801\u5e94\u8be5\u662f\u4e00\u81f4\u7684\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48Application\u5c42\u662f\u201c\u7528\u4f8b\u201d\u800c\u4e0d\u662f\u201c\u63a5\u53e3\u201d\uff0c\u662f\u76f8\u5bf9\u7a33\u5b9a\u7684\u5b58\u5728\u3002</p>"},{"location":"web/backend/code_action.html#_7","title":"\u7ed3\u8bba","text":"<p>Interface\u5c42\uff1a</p> <ul> <li> <p>\u804c\u8d23\uff1a\u4e3b\u8981\u8d1f\u8d23\u627f\u63a5\u7f51\u7edc\u534f\u8bae\u7684\u8f6c\u5316\u3001Session\u7ba1\u7406\u7b49\u3002</p> </li> <li> <p>\u63a5\u53e3\u6570\u91cf\uff1a\u907f\u514d\u6240\u8c13\u7684\u7edf\u4e00API\uff0c\u4e0d\u5fc5\u4eba\u4e3a\u9650\u5236\u63a5\u53e3\u7c7b\u7684\u6570\u91cf\uff0c\u6bcf\u4e2a/\u6bcf\u7c7b\u4e1a\u52a1\u5bf9\u5e94\u4e00\u5957\u63a5\u53e3\u5373\u53ef\uff0c\u63a5\u53e3\u53c2\u6570\u5e94\u8be5\u7b26\u5408\u4e1a\u52a1\u9700\u6c42\uff0c\u907f\u514d\u5927\u800c\u5168\u7684\u5165\u53c2\u3002</p> </li> <li> <p>\u63a5\u53e3\u51fa\u53c2\uff1a\u7edf\u4e00\u8fd4\u56deResult\u3002</p> </li> <li> <p>\u5f02\u5e38\u5904\u7406\uff1a\u5e94\u8be5\u6355\u6349\u6240\u6709\u5f02\u5e38\uff0c\u907f\u514d\u5f02\u5e38\u4fe1\u606f\u7684\u6cc4\u6f0f\u3002\u53ef\u4ee5\u901a\u8fc7AOP\u7edf\u4e00\u5904\u7406\uff0c\u907f\u514d\u4ee3\u7801\u91cc\u6709\u5927\u91cf\u91cd\u590d\u4ee3\u7801\u3002</p> </li> </ul> <p>Application\u5c42\uff1a</p> <ul> <li> <p>\u5165\u53c2\uff1a\u5177\u50cf\u5316Command\u3001Query\u3001Event\u5bf9\u8c61\u4f5c\u4e3aApplicationService\u7684\u5165\u53c2\uff0c\u552f\u4e00\u53ef\u4ee5\u7684\u4f8b\u5916\u662f\u5355ID\u67e5\u8be2\u7684\u573a\u666f\u3002</p> </li> <li> <p>CQE\u7684\u8bed\u610f\u5316\uff1aCQE\u5bf9\u8c61\u6709\u8bed\u610f\uff0c\u4e0d\u540c\u7528\u4f8b\u4e4b\u95f4\u8bed\u610f\u4e0d\u540c\uff0c\u5373\u4f7f\u53c2\u6570\u4e00\u6837\u4e5f\u8981\u907f\u514d\u590d\u7528\u3002</p> </li> <li> <p>\u5165\u53c2\u6821\u9a8c\uff1a\u57fa\u7840\u6821\u9a8c\u901a\u8fc7Bean Validation api\u89e3\u51b3\u3002Spring Validation\u81ea\u5e26Validation\u7684AOP\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5df1\u5199AOP\u3002</p> </li> <li> <p>\u51fa\u53c2\uff1a\u7edf\u4e00\u8fd4\u56deDTO\uff0c\u800c\u4e0d\u662fEntity\u6216DO\u3002</p> </li> <li> <p>DTO\u8f6c\u5316\uff1a\u7528DTO Assembler\u8d1f\u8d23Entity/VO\u5230DTO\u7684\u8f6c\u5316\u3002</p> </li> <li> <p>\u5f02\u5e38\u5904\u7406\uff1a\u4e0d\u7edf\u4e00\u6355\u6349\u5f02\u5e38\uff0c\u53ef\u4ee5\u968f\u610f\u629b\u5f02\u5e38\u3002</p> </li> </ul>"},{"location":"web/backend/db.html","title":"DB \u64cd\u4f5c","text":""},{"location":"web/backend/db.html#jpaorm","title":"JPA\u4e0eORM","text":"<p>ORM(Object Relation Mapping) \u601d\u60f3\u662f\u5efa\u7acb\u5b9e\u4f53\u7c7b\u548c\u6570\u636e\u5e93\u5143\u6570\u636e\u7684\u81ea\u52a8\u6620\u5c04\u5173\u7cfb\uff0c\u51cf\u5c11\u6570\u636e\u5e93\u8bbf\u95ee\u5c42\u7684\u4ee3\u7801\u7f16\u5199\uff1b</p> <p>JPA(Java Persistence API) \u662fJava EE5.0\u7684\u5e73\u53f0\u6807\u51c6\u7684ORM\u89c4\u8303\uff0cHibernate\u517c\u5bb9\u3002</p> <ul> <li>@Entity\u4ee3\u8868\u662f\u4e00\u4e2a\u5b9e\u4f53\uff0c\u8868\u793a\u4e0e\u6570\u636e\u5e93\u6709\u6620\u5c04\u5173\u7cfb\uff1b</li> <li>@Table\u8868\u793a\u4e0e\u4e4b\u5bf9\u5e94\u7684\u6570\u636e\u8868\uff0c\u53ef\u4ee5\u770b\u5230\u7c7b\u5c5e\u6027\u4e0e\u6570\u636e\u8868\u7684\u5217\u662f\u987a\u5e8f\u5bf9\u5e94\u7684\u5173\u7cfb\uff0c\u5c5e\u6027\u4e0a\u7684\u6ce8\u89e3\u8868\u660e\u4e86\u5217\u7684\u7c7b\u578b\u4e0e\u72b6\u6001\uff1b</li> <li>@Column\u8868\u793a\u662f\u8868\u4e2d\u7684\u67d0\u4e2a\u5b57\u6bb5\uff1b</li> <li> <p>@Id\u8868\u660e\u662f\u4e3b\u952e\u3002\u5f53\u7136\u4e5f\u53ef\u4ee5\u4e0d\u4f7f\u7528\u6ce8\u89e3\uff0c\u5728xml\u4e2d\u914d\u7f6e\uff1b</p> </li> <li> <p>@Transient\u8868\u793a\u6210\u5458\u4e0d\u662f\u6570\u636e\u5e93\u4e2d\u7684\u5b57\u6bb5\uff1b</p> </li> </ul>"},{"location":"web/backend/db.html#mybatis","title":"Mybatis","text":"<p>\u901a\u8fc7 SQL \u64cd\u4f5c</p> <pre><code># Mysql \u4e0d\u7ba1\u7528=\u8fd8\u662f!=\u90fd\u662f\u4f1a\u628anull\u8fc7\u6ee4\u6389\u7684\uff0c\u53ea\u80fd\u901a\u8fc7 is null \u6216 is not null\nid != ''\n</code></pre>"},{"location":"web/backend/db.html#_1","title":"\u57fa\u7840","text":"<p><code>#</code>\u548c<code>$</code>\u7684\u533a\u522b\uff1a</p> <ul> <li><code>#</code>\u5c06\u4f20\u5165\u7684\u6570\u636e\u90fd\u5f53\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4f1a\u5bf9\u81ea\u52a8\u4f20\u5165\u7684\u6570\u636e\u52a0\u4e00\u4e2a\u53cc\u5f15\u53f7\u3002\u5982\uff1a<code>order by #user_id#</code>\uff0c\u5982\u679c\u4f20\u5165\u7684\u503c\u662f111,\u90a3\u4e48\u89e3\u6790\u6210sql\u65f6\u7684\u503c\u4e3a<code>order by \"111\"</code>, \u5982\u679c\u4f20\u5165\u7684\u503c\u662fid\uff0c\u5219\u89e3\u6790\u6210\u7684sql\u4e3a<code>order by \"id\"</code>.</li> <li><code>$</code>\u5c06\u4f20\u5165\u7684\u6570\u636e\u76f4\u63a5\u663e\u793a\u751f\u6210\u5728sql\u4e2d\u3002\u5982\uff1a<code>order by $user_id$</code>\uff0c\u5982\u679c\u4f20\u5165\u7684\u503c\u662fuser_id\uff0c\u90a3\u4e48\u89e3\u6790\u6210sql\u65f6\u7684\u503c\u4e3a<code>order by user_id</code>, \u5982\u679c\u4f20\u5165\u7684\u503c\u662fid\uff0c\u5219\u89e3\u6790\u6210\u7684sql\u4e3a<code>order by id</code>.</li> <li><code>#</code>\u65b9\u5f0f\u80fd\u591f\u5f88\u5927\u7a0b\u5ea6\u9632\u6b62sql\u6ce8\u5165\uff0c<code>$</code>\u65b9\u5f0f\u65e0\u6cd5\u9632\u6b62Sql\u6ce8\u5165\u3002</li> <li><code>$</code>\u65b9\u5f0f\u4e00\u822c\u7528\u4e8e\u4f20\u5165\u6570\u636e\u5e93\u5bf9\u8c61\uff0c\u4f8b\u5982\u4f20\u5165\u8868\u540d\u3002</li> <li>\u4e00\u822c\u80fd\u7528<code>#</code>\u7684\u5c31\u522b\u7528<code>$</code>.</li> </ul>"},{"location":"web/backend/db.html#_2","title":"\u793a\u4f8b","text":"<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n&lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\" &gt;\n&lt;mapper namespace=\"com.test.mapper.IndividualCustomerMapper\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;update id=\"updateAttributeGrayByID\" parameterType=\"com.test.entity.CustomerDO\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0UPDATE t_individualcustomer\n\u00a0\u00a0\u00a0\u00a0    SET IsGray = #{isGray}\n\u00a0\u00a0\u00a0\u00a0    WHERE CustomerID IN\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;foreach collection=\"customerID\" item=\"smid\" index=\"index\" open=\"(\" separator=\",\" close=\")\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0          #{smid}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/foreach&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/update&gt;\n&lt;/mapper&gt;\n</code></pre> <p>Springboot\u914d\u7f6e</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;\n    &lt;version&gt;2.1.3&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <pre><code># application.yml\nmybatis:\n    type-aliases-package: com.example.domain.model\n    type-handlers-package: com.example.typehandler\n    configuration:\n        map-underscore-to-camel-case: true\n        default-fetch-size: 100\n        default-statement-timeout: 30\n...\n</code></pre> <p>Mybatis \u7684\u5177\u4f53\u914d\u7f6e</p> Property Description <code>config-location</code> Location of MyBatis xml config file. <code>check-config-location</code> Indicates whether perform presence check of the MyBatis xml config file. <code>mapper-locations</code> Locations of Mapper xml config file. <code>type-aliases-package</code> Packages to search for type aliases. (Package delimiters are \u201c<code>,; \\t\\n</code>\u201d) <code>type-aliases-super-type</code> The super class for filtering type alias. If this not specifies, the MyBatis deal as type alias all classes that searched from <code>type-aliases-package</code>. <code>type-handlers-package</code> Packages to search for type handlers. (Package delimiters are \u201c<code>,; \\t\\n</code>\u201d) <code>executor-type</code> Executor type: <code>SIMPLE</code>, <code>REUSE</code>, <code>BATCH</code> <code>default-scripting-language-driver</code> The default scripting language driver class. This feature requires to use together with mybatis-spring 2.0.2+. <code>configuration-properties</code> Externalized properties for MyBatis configuration. Specified properties can be used as placeholder on MyBatis config file and Mapper file. For detail see the MyBatis reference page. <code>lazy-initialization</code> Whether enable lazy initialization of mapper bean. Set <code>true</code> to enable lazy initialization. This feature requires to use together with mybatis-spring 2.0.2+. <code>mapper-default-scope</code> Default scope for mapper bean that scanned by auto-configure. This feature requires to use together with mybatis-spring 2.0.6+. <code>configuration.*</code> Property keys for <code>Configuration</code> bean provided by MyBatis Core. About available nested properties see the MyBatis reference page. NOTE: This property cannot be used at the same time with the <code>config-location</code>. <code>scripting-language-driver.thymeleaf.*</code> Property keys for <code>ThymeleafLanguageDriverConfig</code> bean provided by MyBatis Thymeleaf. About available nested properties see the MyBatis Thymeleaf reference page. <code>scripting-language-driver.freemarker.*</code> Properties keys for <code>FreeMarkerLanguageDriverConfig</code> bean provided by MyBatis FreeMarker. About available nested properties see the MyBatis FreeMarker reference page. This feature requires to use together with mybatis-freemarker 1.2.0+. <code>scripting-language-driver.velocity.*</code> Properties keys for <code>VelocityLanguageDriverConfig</code> bean provided by MyBatis Velocity. About available nested properties see the MyBatis Velocity reference page. This feature requires to use together with mybatis-velocity 2.1.0+."},{"location":"web/backend/db.html#mybatis-plus","title":"Mybatis-plus","text":"<p>\u7528\u4e8e\u5355\u8868\u64cd\u4f5c</p>"},{"location":"web/backend/db.html#_3","title":"\u8fd4\u56de\u81ea\u589e\u4e3b\u952e","text":"<p>\u5b9e\u4f53\u5bf9\u8c61 \u4e3b\u952e<code>IdType</code>\u8981\u8bbe\u7f6e\u4e3a<code>AUTO</code> \u8868\u793a\u6570\u636e\u5e93ID\u81ea\u589e\uff0c\u7136\u540e\u4f7f\u7528Mapper\u8fdb\u884c\u63d2\u5165\u65f6\uff0c\u8fd4\u56de\u7684\u5b9e\u4f53\u5c31\u4f1a\u5305\u542b\u4e3b\u952e\u503c\u3002</p> <pre><code>// employee \u5728\u63d2\u5165\u540e\uff0c\u5c31\u4f1a\u81ea\u52a8\u63d2\u5165\u4e3b\u952e\u5230\u5bf9\u8c61\u4e2d\nemployeeService.saveOrUpdate(employee);\nbaseMapper.insert(employee);\n</code></pre>"},{"location":"web/backend/db.html#null","title":"\u5b57\u6bb5\u4e3anull\u65f6\u4e0d\u66f4\u65b0","text":"<p>\u4e0b\u9762\u7684\u65b9\u6cd5\uff0c\u4e0d\u4f1a\u5bf9\u5b9e\u4f53\u4e2d\u503c\u4e3aNull\u7684\u5c5e\u6027\uff08\u5b57\u6bb5\uff09\u8fdb\u884c\u66f4\u65b0\u3002</p> <pre><code>mapper.updateById(entity); \n</code></pre> <p>Mybatis-plus\u9ed8\u8ba4\u914d\u7f6e\u4e2d\uff0c\u5bf9\u4e8e\u53c2\u6570\u5b57\u6bb5\u4e3anull\u65f6\uff0c\u4f1a\u81ea\u52a8\u5ffd\u7565\u3002\u5bfc\u81f4\u8fdb\u884cupdate\u64cd\u4f5c\u65f6\uff0c\u65e0\u6cd5\u5c06\u5b57\u6bb5\u66f4\u65b0\u4e3anull\u503c\u3002</p> <ul> <li>\u5355\u4e2a\u914d\u7f6e\uff0c\u6bcf\u4e2a\u53c2\u6570\u4e0a\u52a0\u6ce8\u89e3\u3002\uff08\u4f46\u662f\u5982\u679c\u5176\u5b83\u573a\u666f\u4e0d\u4f20\u5165\u8be5\u503c\u65f6\uff0c\u4f1a\u5bfc\u81f4\u4f1a\u88ab\u66f4\u65b0\uff0c\u53ef\u80fd\u4f1a\u51fa\u95ee\u9898\uff09</li> </ul> <pre><code>@TableField(updateStrategy = FieldStrategy.IGNORED)\n</code></pre> <ul> <li>\u4f7f\u7528LambdaUpdateWrapper\uff08\u63a8\u8350\uff09</li> </ul> <pre><code>LambdaUpdateWrapper&lt;BizFile&gt; lambdaUpdateWrapper = new LambdaUpdateWrapper&lt;&gt;();\n//\u8fc7\u6ee4\u6761\u4ef6\nlambdaUpdateWrapper.eq(BizFile::getId, bizFile.getId());\n\n//\u4e0b\u9762\u4e3a\u8bbe\u7f6e\u503c          \n//\u7531\u4e8eparentId\u4f1a\u4e3a\u7a7a\uff0c\u6240\u4ee5\u8981\u4f7f\u7528LambdaUpdateWrapper\nlambdaUpdateWrapper.set(BizFile::getParentId, parentId);\nlambdaUpdateWrapper.set(BizFile::getPath, newDirPath);\n\n//\u66f4\u65b0\nthis.update(null, lambdaUpdateWrapper);\n</code></pre>"},{"location":"web/backend/db.html#mybatis-plus-join","title":"Mybatis-plus-join","text":"<p>https://github.com/yulichang/mybatis-plus-join</p> <p>\u591a\u8868\u8fde\u63a5\u7684\u65b9\u6848\u3002</p>"},{"location":"web/backend/db.html#beansearch","title":"BeanSearch","text":"<p>\u4e13\u6ce8\u9ad8\u7ea7\u67e5\u8be2\u7684\u53ea\u8bfb ORM\uff0c\u5929\u751f\u652f\u6301\u8054\u8868\uff0c\u514d DTO/VO \u8f6c\u6362\uff0c\u4f7f\u4e00\u884c\u4ee3\u7801\u5b9e\u73b0\u590d\u6742\u5217\u8868\u68c0\u7d22\u6210\u4e3a\u53ef\u80fd\uff01</p> <ul> <li> <p>\u63a8\u8350 \u5728 \u975e\u4e8b\u52a1\u6027 \u7684 \u52a8\u6001 \u68c0\u7d22\u573a\u666f\u4e2d\u4f7f\u7528\uff1a\u5982\u7ba1\u7406\u540e\u53f0\u7684\u8ba2\u5355\u67e5\u8be2\u7b49\uff1b</p> </li> <li> <p>\u4e0d\u5efa\u8bae \u5728 \u4e8b\u52a1\u6027 \u7684 \u9759\u6001 \u67e5\u8be2\u573a\u666f\u4e2d\u4f7f\u7528\uff1a\u5982\u7528\u6237\u6ce8\u518c\u63a5\u53e3\u7684\u67e5\u8be2\u8d26\u53f7\u5df2\u5b58\u5728\u7684\u573a\u666f\uff1b</p> </li> </ul> <p>Bean Searcher \u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u6570\u636e\u5e93\u6761\u4ef6\u68c0\u7d22\u5f15\u64ce\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u4ece\u5df2\u6709\u7684\u6570\u636e\u5e93\u8868\u4e2d\u68c0\u7d22\u6570\u636e\uff0c\u5b83\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u51cf\u5c11\u540e\u7aef\u6a21\u677f\u4ee3\u7801\u7684\u5f00\u53d1\uff0c\u6781\u5927\u63d0\u9ad8\u5f00\u53d1\u6548\u7387\uff0c\u8282\u7701\u5f00\u53d1\u65f6\u95f4\uff0c\u4f7f\u5f97\u4e00\u884c\u4ee3\u7801\u5b8c\u6210\u4e00\u4e2a\u5217\u8868\u67e5\u8be2\u63a5\u53e3\u6210\u4e3a\u53ef\u80fd\uff01</p> <ul> <li>\u4e0d\u4f9d\u8d56\u5177\u4f53\u7684 Web \u6846\u67b6\uff08\u5373\u53ef\u4ee5\u5728\u4efb\u610f\u7684 Java Web \u6846\u67b6\u5185\u4f7f\u7528\uff09</li> <li>\u4e0d\u4f9d\u8d56\u5177\u4f53\u7684 ORM \u6846\u67b6\uff08\u5373\u53ef\u4ee5\u4e0e\u4efb\u610f\u7684 ORM \u6846\u67b6\u914d\u5408\u4f7f\u7528\uff0c\u6ca1\u6709 ORM \u4e5f\u53ef\u5355\u72ec\u4f7f\u7528\uff09</li> </ul>"},{"location":"web/backend/db.html#_4","title":"\u67b6\u6784","text":""},{"location":"web/backend/db.html#hibernate-mybatis","title":"\u4e0e Hibernate MyBatis \u7684\u533a\u522b","text":"<p>\u9996\u5148\uff0cBean Searcher \u5e76\u4e0d\u662f\u4e00\u4e2a\u5b8c\u5168\u7684 <code>ORM</code> \u6846\u67b6\uff0c\u5f25\u8865\u4ed6\u4eec\u5728 <code>\u5217\u8868\u68c0\u7d22\u9886\u57df</code> \u7684\u4e0d\u8db3\u3002</p> \u533a\u522b\u70b9 Bean Searcher Hibernate MyBatis ORM \u53ea\u8bfb ORM \u5168\u81ea\u52a8 ORM \u534a\u81ea\u52a8 ORM \u5b9e\u4f53\u7c7b\u53ef\u591a\u8868\u6620\u5c04 \u652f\u6301 \u4e0d\u652f\u6301 \u4e0d\u652f\u6301 \u5b57\u6bb5\u8fd0\u7b97\u7b26 \u52a8\u6001 \u9759\u6001 \u9759\u6001 CRUD Only R CRUD CRUD"},{"location":"web/backend/db.html#_5","title":"\u5237\u5e93","text":""},{"location":"web/backend/db.html#_6","title":"\u4f5c\u7528","text":"<ol> <li>\u7ef4\u62a4\u7ba1\u7406\u6570\u636e\u5e93\u7684\u7248\u672c\u4fe1\u606f\uff0c\u8bb0\u5f55\u5f53\u524d\u670d\u52a1\u6570\u636e\u5e93\u7248\u672c\u3002</li> <li>\u652f\u6301\u5b9e\u73b0\u8fde\u7eed\u591a\u7248\u672c\u81ea\u52a8\u5347\u7ea7\u3002</li> <li>\u5bf9\u6570\u636e\u5e93\u64cd\u4f5c\u8fdb\u884c\u63a7\u5236\uff0c\u53ef\u5c06\u591a\u4e2a\u6570\u636e\u5e93\u64cd\u4f5c\u58f0\u660e\u6210\u4e8b\u52a1\u3002</li> </ol>"},{"location":"web/backend/db.html#flyway","title":"\u5f00\u6e90Flyway","text":""},{"location":"web/backend/db.html#_7","title":"\u4ecb\u7ecd","text":"<ol> <li>\u53ef\u6267\u884c\u6570\u636e\u5e93\u811a\u672c\u8bed\u53e5\uff0c\u8fdb\u884c\u6570\u636e\u5e93\u5347\u7ea7</li> <li>\u7ba1\u7406\u6570\u636e\u7248\u672c\uff0c\u8bb0\u5f55\u5f53\u524d\u6570\u636e\u7684\u7248\u672c\u4fe1\u606f</li> <li>\u7248\u672c\u5347\u7ea7\u652f\u6301\u4e8b\u52a1\uff0c\u4e00\u4e2a\u7248\u672c\u82e5\u5931\u8d25\u5219\u56de\u6eda</li> <li>\u5237\u5e93\u9700\u8981\u5728\u670d\u52a1\u505c\u6b62\u7684\u60c5\u51b5\u4e0b\u8fdb\u884c</li> </ol>"},{"location":"web/backend/db.html#_8","title":"\u81ea\u5b9a\u4e49\u5b9e\u73b0","text":""},{"location":"web/backend/db.html#_9","title":"\u6838\u5fc3\u4e1a\u52a1\u5b9e\u73b0\u903b\u8f91","text":"<ul> <li>\u4ecesql_version.json \u4e2d\u83b7\u53d6\u6240\u6709\u7684\u7248\u672c\u53f7\u53ca\u5bf9\u5e94\u7684\u811a\u672c\u8def\u5f84</li> <li>\u8bfb\u53d6\u9879\u76ee\u7684\u6570\u636e\u5e93\u8fde\u63a5\u914d\u7f6e\uff0c\u8fde\u63a5\u6570\u636e\u5e93</li> <li>\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u5f53\u524d\u7684\u7248\u672c\u53f7</li> <li>\u5982\u679cversion\u8868\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efaversion\u8868\uff0c\u8bbe\u7f6e\u521d\u59cb\u7248\u672c0.0\uff0c\u5426\u5219\uff0c\u83b7\u53d6version\u8868\u7684\u7248\u672c\u53f7\u5b57\u6bb5\u5bf9\u5e94\u7684\u503c</li> <li>\u5faa\u73af\u5224\u65ad sql_version.json \u4e2d\u83b7\u53d6\u6240\u6709\u7684\u7248\u672c\u53f7</li> <li>\u5982\u679cjson\u7248\u672c\u53f7 &gt; \u8868\u4e2d\u7684\u7248\u672c\u53f7\uff0c\u5219\u6309\u5e8f\u6267\u884c\u5bf9\u5e94\u7684sql\u8bed\u53e5\uff0c\u59823.0\u7248\u672c\u7684\u65f6\u5019\uff0c\u4e0d\u9700\u8981\u6267\u884c2.0\u7684sql</li> <li>sql\u6267\u884c\u5168\u90e8\u6210\u529f\uff0c\u5219\u8fd4\u56detrue\uff0c\u5426\u5219\u4ee5\u5f02\u5e38\u7684\u5f62\u5f0f\u629b\u51fa</li> </ul>"},{"location":"web/backend/db.html#_10","title":"\u5237\u5e93\u89c4\u8303\u5b9a\u4e49","text":"<p>bin\u76ee\u5f55\u4e0b\u5efaupgrade_db.sh\u6587\u4ef6</p> <pre><code>#!/usr/bin/env bash\n\napp_class_name=com.hongcheng.aibigdata.userservice.UserServiceApplication\npid=`jps -vm |grep ${app_class_name} |awk '{print $1}'`\nBASE_HOME=$(cd `dirname $0`/../; pwd)\n\ndb_class=com.hongcheng.aibigdata.common.db.Upgrade\nif [ $pid ]\nthen\necho \"\u6d77\u661f\u670d\u52a1\u6b63\u5728\u8fd0\u884c\uff0c\u8bf7\u505c\u6b62\u670d\u52a1\u540e\u8fdb\u884c\u5237\u5e93\"\nelse\n# \u5355\u72ec\u901a\u8fc7java\u6267\u884c\nSQL_PATH=$BASE_HOME/scripts/sql_version.json\n\njava -Dbase.dir=${BASE_HOME} -cp BASE_HOME/lib/*:BASE_HOME/conf/. -Dloader.main=${db_class} org.springframework.boot.loader.PropertiesLauncher $SQL_PATH\n\nif [ $? -eq 0 ]; then\necho \"\u5237\u5e93\u6210\u529f\"\nelse\necho \"\u5237\u5e93\u5931\u8d25\uff0c\u8bf7\u67e5\u770b\u5177\u4f53\u5f02\u5e38\"\nfi\nfi\n</code></pre> <p>\u96c6\u6210common.util\u5305</p> <p>\u6838\u5fc3\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>import java.io.File;\nimport java.io.IOException;\nimport java.io.InputStreamReader;\nimport java.io.Reader;\nimport java.nio.charset.StandardCharsets;\nimport java.sql.Connection;\nimport java.sql.DatabaseMetaData;\nimport java.sql.DriverManager;\nimport java.sql.PreparedStatement;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport java.sql.Statement;\nimport java.util.List;\nimport java.util.Properties;\nimport com.hongcheng.aibigdata.common.util.JsonUtil;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.config.YamlPropertiesFactoryBean;\nimport org.springframework.core.io.ClassPathResource;\nimport org.springframework.core.io.FileSystemResource;\nimport org.springframework.core.io.Resource;\nimport org.springframework.util.FileCopyUtils;\n\n/**\n* \u6570\u636e\u5e93\u5347\u7ea7\u811a\u672c\u6267\u884c\n*/\npublic class Upgrade {\n    private static final Logger LOG = LoggerFactory.getLogger(Upgrade.class);\n\n    /**\n    * Version\u8868\u53ea\u6709\u4e24\u4e2a\u5b57\u6bb5\uff08property\u548cvalue\u7ec4\u6210\uff0c\u957f\u5ea6\u9650\u5236\u4e3a char(64)\n    */\n    private static final String VERSION_TABLE_NAME = \"version\";\n\n    private static final String APPLICATION_PATH = \"application.yml\";\n\n    /**\n    * \u53c2\u6570\u683c\u5f0f\uff1a --script-path $SCRIPT_HOME\n    */\n    public static void main(String[] args) {\n        // \u83b7\u53d6\u811a\u672c\u7684\u6839\u76ee\u5f55\n        String sqlInfoJsonPath = args[0];\n        LOG.info(\"***********************************sql flush appliction start***********************************\");\n        LOG.info(\"SQL description file is {}\", sqlInfoJsonPath);\n        // \u8fdb\u884csql\u5347\u7ea7\n        try {\n            //\u4f20\u5165StarFish HOME\u8def\u5f84\n            new Upgrade().upgrade(sqlInfoJsonPath);\n        } catch (SQLException e) {\n            LOG.error(\"sql error\", e);\n        } catch (Exception e) {\n            LOG.error(\"execute error:\", e);\n        }\n    }\n\n    private Connection getConnection() {\n        YamlPropertiesFactoryBean yaml = new YamlPropertiesFactoryBean();\n        yaml.setResources(new ClassPathResource(APPLICATION_PATH));\n        Properties properties = yaml.getObject();\n        if (properties == null) {\n            LOG.error(\"init dataSource error , please check the config yml\");\n            throw new NullPointerException(\"init dataSource properties error\");\n        }\n        try {\n            Class.forName(properties.getProperty(\"spring.datasource.driver-class-name\"));\n            return DriverManager.getConnection(properties.getProperty(\"spring.datasource.url\"),\n                                               properties.getProperty(\"spring.datasource.username\"),\n                                               properties.getProperty(\"spring.datasource.password\"));\n        } catch (ClassNotFoundException | SQLException e) {\n            LOG.error(\"Find sql driver failed for:{}, exception: {}\", properties.getProperty(\"spring.datasource.driver-class-name\"), e);\n            System.exit(-1);\n        }\n        return null;\n    }\n\n    public boolean upgrade(String sqlInfoJsonPath) throws SQLException, IOException {\n        try (Connection conn = getConnection()) {\n            //\u4ecejson\u4e2d\u83b7\u53d6\u6240\u6709\u7684\u7248\u672c\u53f7\u53ca\u5bf9\u5e94\u7684\u811a\u672c\u8def\u5f84\n            VersionJsonEntity versionJsonEntity = getVersionJsonEntity(sqlInfoJsonPath);\n            if (versionJsonEntity == null) {\n                return false;\n            }\n            List&lt;VersionScriptEntity&gt; versionScriptEntities = versionJsonEntity.getData();\n\n            // 2. \u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u5f53\u524d\u7684\u7248\u672c\u53f7\n            String versionDb = \"0.0\";\n\n            //SQL\u8bed\u53e5\u5177\u5907\u91cd\u590d\u6267\u884c\u4e0d\u62a5\u9519\uff0c\u4e0d\u9700\u8981\u8bbe\u7f6eautoCommit\n            if (!existVersion(conn, VERSION_TABLE_NAME)) {\n                // 2.1 \u5982\u679cversion\u8868\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efaversion\u8868\uff0c\u8bbe\u7f6e\u521d\u59cb\u7248\u672c0.0\n                createVersionTable(conn);\n                insertVersion(conn, versionDb);\n            } else {\n                // 2.2 \u5426\u5219\uff0c\u83b7\u53d6version\u8868\u7684\u7248\u672c\u53f7\u5b57\u6bb5\u5bf9\u5e94\u7684\u503c\n                versionDb = getVersion(conn);\n            }\n            LOG.info(\"current database version is {}\", versionDb);\n            //for\u5faa\u73af\u5224\u65ad\uff083.0\u7684\u65f6\u5019\uff0c\u4e0d\u9700\u8981\u6267\u884c2.0\u7684sql\uff09\n            for (VersionScriptEntity versionScriptEntity : versionScriptEntities) {\n                String versionValue = versionScriptEntity.getVersion();\n                List&lt;String&gt; sqlPaths = versionScriptEntity.getSql();\n                if (compareVersionNum(versionValue, versionDb)) {\n                    // 3. \u5982\u679cjson\u7248\u672c\u53f7 &gt; \u8868\u4e2d\u7684\u7248\u672c\u53f7\uff0c\u5219\u6267\u884c\u5bf9\u5e94\u7684sql\u8bed\u53e5\n                    LOG.info(\"start to init database version : {}\", versionValue);\n                    run(conn, sqlPaths, sqlInfoJsonPath);\n                    updateVersion(conn, versionValue);\n                    versionDb = versionValue;\n                }\n            }\n            LOG.info(\"update sql finish\");\n            // sql\u6267\u884c\u5168\u90e8\u6210\u529f\uff0c\u5219\u8fd4\u56detrue\uff0c\u5426\u5219\u4ee5\u5f02\u5e38\u7684\u5f62\u5f0f\u629b\u51fa\n        }\n\n        return true;\n    }\n\n    private String loadJson(String fileName) throws IOException {\n        LOG.info(\"load json file {}\", fileName);\n        File file = new File(fileName);\n        Resource resource = new FileSystemResource(file);\n        byte[] bytes;\n        try {\n            bytes = FileCopyUtils.copyToByteArray(resource.getInputStream());\n            return new String(bytes);\n        } catch (IOException e) {\n            LOG.error(\"load json error {}:\", fileName);\n            throw e;\n        }\n\n    }\n\n\n    private VersionJsonEntity getVersionJsonEntity(String jsonPath) throws IOException {\n        String jsonString = loadJson(jsonPath);\n        //\u91c7\u7528Java\u7c7b\u89e3\u6790\uff0c\u4e0d\u89e3\u6790\u6210JsonNode\n        return JsonUtil.decode(jsonString, VersionJsonEntity.class);\n    }\n\n    /**\n    * \u5224\u65ad\u662f\u5426\u5b58\u5728version\u8868\n    */\n    private boolean existVersion(Connection conn, String tableName) throws SQLException {\n        boolean flag;\n        DatabaseMetaData meta = conn.getMetaData();\n        String[] type = {\"TABLE\"};\n        String catalog = conn.getCatalog();\n        LOG.info(\"catalog is {} \", conn.getCatalog());\n        ResultSet rs = meta.getTables(catalog, null, tableName, type);\n        flag = rs.next();\n        LOG.info(\"check version is :{}\", flag);\n        return flag;\n\n    }\n\n    /**\n    * \u83b7\u53d6\u7248\u672c\u53f7\n    */\n    private String getVersion(Connection conn) throws SQLException {\n        //\u9884\u7f16\u8bd1\u8bed\u53e5\n        // where property=version\u7684\u6761\u4ef6\uff08\u9632\u6b62\u4e07\u4e00\u540e\u9762version\u8868\u52a0\u5176\u5b83\u7684\u884c\uff09\n        String sql = \"select value from version where property='version'\";\n        try (PreparedStatement statement = conn.prepareStatement(sql)) {\n            ResultSet rs = statement.executeQuery();\n            // 4.\u5904\u7406\u6570\u636e\u5e93\u7684\u8fd4\u56de\u7ed3\u679c(\u4f7f\u7528ResultSet\u7c7b)\n            if (rs.next()) {\n                return rs.getString(\"value\");\n            }\n\n        } catch (SQLException e) {\n            LOG.error(\"get version table error\");\n            throw e;\n        }\n        return \"\";\n    }\n\n    /**\n    * \u66f4\u65b0\u7248\u672c\u53f7\n    */\n    private boolean updateVersion(Connection conn, String value) throws SQLException {\n        //\u9884\u7f16\u8bd1\u8bed\u53e5\n        String sql = \"update version set value=? where property = 'version'\";\n        try (PreparedStatement statement = conn.prepareStatement(sql)) {\n            statement.setString(1, value);\n            int i = statement.executeUpdate();\n            return i == 1;\n        } catch (SQLException e) {\n            LOG.error(\"update version table error\");\n            throw e;\n        }\n    }\n\n    /**\n    * \u63d2\u5165\u7248\u672c\u53f7\n    */\n    private boolean insertVersion(Connection conn, String value) throws SQLException {\n        //\u9884\u7f16\u8bd1\u8bed\u53e5\n        String sql = \"insert into version(property,value) values('version',?)\";\n        try (PreparedStatement statement = conn.prepareStatement(sql)) {\n            statement.setString(1, value);\n            int i = statement.executeUpdate();\n            return i == 1;\n        } catch (SQLException e) {\n            LOG.error(\"insert version table error\");\n            throw e;\n        }\n\n    }\n\n    /**\n    * \u5efaversion\u8868\n    */\n    private boolean createVersionTable(Connection conn) throws SQLException {\n        LOG.info(\"create version table\");\n        String sql = \"CREATE TABLE version(\" +\n            \" `property` VARCHAR(64) NOT NULL,\" +\n            \" `value` VARCHAR(64) NOT NULL,\" +\n            \"PRIMARY KEY (`property`));\";\n        try (Statement statement = conn.createStatement()) {\n            int i = statement.executeUpdate(sql);\n            return i == 1;\n        } catch (SQLException e) {\n            LOG.error(\"create version table error\");\n            throw e;\n        }\n    }\n\n\n    /**\n    * \u8fd0\u884c\u6307\u5b9a\u7684sql\u811a\u672c\n    *\n    * @param sqlPaths \u9700\u8981\u6267\u884c\u7684sql\u811a\u672c\u7684\u8def\u5f84\u96c6\u5408\n    */\n    private boolean run(Connection conn, List&lt;String&gt; sqlPaths, String sqlPathHome) throws IOException {\n        // \u521b\u5efaScriptRunner\uff0c\u7528\u4e8e\u6267\u884cSQL\u811a\u672c\n        ScriptRunner runner = new ScriptRunner(conn);\n        runner.setErrorLogWriter(null);\n        runner.setLogWriter(null);\n        // \u6267\u884cSQL\u811a\u672c\n        for (String sqlPath : sqlPaths) {\n            String filePath = sqlPathHome + sqlPath;\n            File file = new File(filePath);\n            Resource resource = new FileSystemResource(file);\n            Reader inputStreamReader = new InputStreamReader(resource.getInputStream(), StandardCharsets.UTF_8);\n            runner.runScript(inputStreamReader);\n            LOG.info(\"excute sql \uff1a{}\", sqlPath);\n        }\n        return true;\n    }\n\n\n    /**\n    * \u6bd4\u8f83\u7248\u672c\n    *\n    * @return true : first &gt; second, otherwise false\n    */\n    public boolean compareVersionNum(String versionValue, String versionDb) {\n        if (versionValue == null || versionDb == null) {\n            return false;\n        }\n        String[] versionChars = versionValue.split(\"\\\\.\");\n        String[] dbChars = versionDb.split(\"\\\\.\");\n        for (int i = 0; i &lt; versionChars.length; i++) {\n            int versionInt = Integer.parseInt(versionChars[i]);\n            int versionDbInt = Integer.parseInt(dbChars[i]);\n            if (versionInt &gt; versionDbInt) {\n                return true;\n            } else if (versionInt &lt; versionDbInt) {\n                return false;\n            }\n        }\n        return false;\n    }\n}\n</code></pre> <p>\u65b0\u5efascript\u6587\u4ef6\u5939</p> <p>\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a</p> <p></p> <p>sql_version.json</p> <pre><code>{\n  \"data\": [\n    {\n      //\u6309\u7248\u672c\u53f7\u6267\u884c\n      \"version\": \"1.0\",\n      \"sql\": [\n        //\u6309\u5e8f\u6267\u884c\u5bf9\u5e94\u5730\u5740\u7684sql\u811a\u672c\n        \"/v1.0/001-createDataBase.sql\",\n        \"/v1.0/002-initDataBase.sql\"\n      ]\n    }\n  ]\n}\n</code></pre> <p>\u5bf9\u5e94\u5b9e\u4f53\u7c7b\u5982\u4e0b\uff1a</p> <pre><code>public class VersionJsonEntity {\n\n    private List&lt;VersionScriptEntity&gt; data;\n\n    public List&lt;VersionScriptEntity&gt; getData() {\n        return data;\n    }\n\n    public void setData(List&lt;VersionScriptEntity&gt; data) {\n        this.data = data;\n    }\n\n}\n\npublic class VersionScriptEntity {\n    private String version;\n    private List&lt;String&gt; sql;\n\n    public String getVersion() {\n        return version;\n    }\n\n    public void setVersion(String version) {\n        this.version = version;\n    }\n\n    public List&lt;String&gt; getSql() {\n        return sql;\n    }\n\n    public void setSql(List&lt;String&gt; sql) {\n        this.sql = sql;\n    }\n}\n</code></pre>"},{"location":"web/backend/event_bus.html","title":"\u4e8b\u4ef6\u5904\u7406","text":"<p>Guava \u4e2d EventBus \uff1a\u4e8b\u4ef6\u5904\u7406\u673a\u5236\uff0c\u89c2\u5bdf\u8005\u6a21\u5f0f\uff08\u751f\u4ea7/\u6d88\u8d39\u8005\u7f16\u7a0b\u6a21\u578b\uff09\uff0c\u5904\u7406\u4e00\u4e9b\u5f02\u6b65\u4efb\u52a1\uff0c\u5e94\u7528\u4e8e\u8fdb\u7a0b\u5185\u901a\u4fe1\u3002</p>"},{"location":"web/backend/event_bus.html#listener","title":"Listener","text":"<p>Receive and handle events.</p> <p>\u901a\u8fc7<code>@Subscribe</code> \u6ce8\u89e3\u5c06\u4efb\u610f\u7684\u7c7b\u7684\u65b9\u6cd5\u53d8\u4e3a\u4e00\u4e2aListener</p> <ul> <li>\u65b9\u6cd5\u53ea\u80fd\u6709\u4e00\u4e2a\u53c2\u6570\u8868\u793a Event\uff0c\u4e0d\u540c\u7c7b\u578b\u7684\u53c2\u6570\u8868\u660e\u76d1\u542c\u4e0d\u540c\u7684\u7c7b\u578b\u7684\u4e8b\u4ef6\uff1b</li> <li><code>AllowConcurrentEvents</code>\u6ce8\u89e3\uff0c\u6807\u8bb0\u65b9\u6cd5\u662f\u5426\u7ebf\u7a0b\u5b89\u5168\uff1b</li> </ul> <pre><code>@Subscribe\n@AllowConcurrentEvents\npublic void onEvent(ServiceRemoveEvent event) {\n}\n</code></pre>"},{"location":"web/backend/event_bus.html#eventbus","title":"EventBus","text":"<p>\u4e8b\u4ef6\u603b\u7ebf\uff0c\u7ebf\u7a0b\u5b89\u5168\u3002</p> <p>register \u65b9\u6cd5\u6ce8\u518c listener\uff1a\u4e3a\u4ec0\u4e48\u901a\u8fc7\u53cd\u5c04\uff0c\u800c\u4e0d\u662f\u901a\u8fc7\u63a5\u53e3\uff1f</p> <ul> <li>\u83b7\u53d6\u7c7b\u7684\u6240\u6709public \u65b9\u6cd5\uff0c\u7f13\u5b58\u6240\u6709\u6807\u8bb0\u4e86  @Subscribe \u6ce8\u89e3\u7684\u65b9\u6cd5\uff1b</li> <li>\u5c06 method \u7684\u7b2c\u4e00\u4e2a\u5165\u53c2\uff0c\u4f5c\u4e3a\u4e8b\u4ef6\u7c7b\u578b\uff0c\u533a\u5206\u4e0d\u540c\u7684 listener\uff1b</li> <li>\u6839\u636e Listener \u7684\u53c2\u6570\u7c7b\u578b\u7684\u4e0d\u540c\uff0c\u5206\u522b\u5411\u4e0d\u540c\u7684Subscribe\u53d1\u9001\u4e0d\u540c\u7684\u6d88\u606f\u3002</li> </ul> <pre><code>public static void main(String[] args) {\n    final EventBus eventBus = new EventBus();    // \u6ce8\u518cListener\uff0c\u83b7\u53d6 @Subscribe \u7684 method \u6ce8\u89e3\n    eventBus.register(new SimpleListener());\n    System.out.println(\"post the simple event.\");\n    // \u5411\u8ba2\u9605\u8005\u53d1\u9001\u6d88\u606f\n    eventBus.post(new ServiceRemoveEvent(\"Service removed Event\"));\n}\n</code></pre>"},{"location":"web/backend/event_bus.html#dispatcher","title":"Dispatcher","text":"<p>Handler for dispatching events to subscribers, providing different event ordering guarantees that make sense for different situations.</p> <p>EventBus \u7684 post \u65b9\u6cd5\u8c03\u7528\uff0c\u4f1a\u8c03\u7528 <code>Subscriber</code> \u7684 <code>dispatchEvent</code> \u65b9\u6cd5\uff1b</p> <p>\u4e0d\u540c\u7ebf\u7a0b Post Event \u4e8b\u4ef6\u7684\u987a\u5e8f\u4fdd\u8bc1\uff1a\u8ddf Executor \u662f\u6b63\u4ea4\u7684\u5173\u7cfb\uff08Executor \u63a7\u5236\u7684\u662f\u6267\u884c\u987a\u5e8f\uff0cDispatcher\u63a7\u5236\u7684\u662f\u5904\u7406\u7684\u987a\u5e8f\uff09</p> <ul> <li><code>PerThreadQueuedDispatcher</code>\uff1a\u5bf9\u5df2\u5728\u8c03\u5ea6\u4e8b\u4ef6\u7684\u7ebf\u7a0b\u4e0a\u91cd\u65b0\u53d1\u5e03\u7684\u4e8b\u4ef6\u8fdb\u884c\u6392\u961f\uff0c\u4ee5\u4fdd\u8bc1\u5728\u5355\u4e2a\u7ebf\u7a0b\u4e0a\u53d1\u5e03\u7684\u6240\u6709\u4e8b\u4ef6\u90fd\u6309\u53d1\u5e03\u987a\u5e8f\u53d1\u9001\u7ed9\u6240\u6709\u8ba2\u9605\u8005\u3002</li> <li><code>\u901a\u8fc7 ThreadLocal&lt;Queue&gt; + ThreadLocal&lt;Boolean&gt;</code> \u5b9e\u73b0\uff0c\u5982\u679c\u7ebf\u7a0b\u5728\u5904\u7406\u4e8b\u4ef6\u65f6\u518d\u53d1\u4e8b\u4ef6\uff0c\u5219\u4e8b\u4ef6\u4f1a\u6309\u7167\u5e7f\u5ea6\u4f18\u5148\u7684\u987a\u5e8f\u5904\u7406\uff1b</li> <li>bool \u53d8\u91cf\u7528\u4e8e <code>avoid reentrant event dispatching</code>\uff0c\u5373\u9012\u5f52\u4e8b\u4ef6\u5904\u7406\u65f6\u76f4\u63a5\u8fd4\u56de\uff0c\u518d\u7b2c\u4e00\u6b21\u4e8b\u4ef6\u5904\u7406\u901a\u8fc7 queue \u904d\u5386\u518d\u5904\u7406\uff1b</li> <li><code>ImmediateDispatcher</code>\uff1a\u7acb\u5373\u7ed9 Subscriber \u6267\u884c\uff0c\u4f46\u6ca1\u6709\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u7684\u8c03\u7528\u65b9\u6cd5\uff1b</li> <li>\u5982\u679c\u7ebf\u7a0b\u5728\u5904\u7406\u4e8b\u4ef6\u65f6\u518d\u53d1\u4e8b\u4ef6\uff0c\u6309\u7167\u6df1\u5ea6\u4f18\u5148\u7684\u987a\u5e8f\u5904\u7406\uff0c</li> <li><code>LegacyAsyncDispatcher</code>\uff1aconcurrentHashMap \u7f13\u5b58\u4e8b\u4ef6\uff0c\u6ca1\u6709\u4efb\u4f55\u5e76\u53d1\u4fdd\u8bc1\uff1b</li> <li>For async dispatch, an immediate dispatcher should generally be preferable</li> </ul> <p>\u5f53\u4f7f\u7528 <code>PerThreadQueuedDispatcher</code>\u548c<code>directExecutor</code>\u65f6\uff08\u5728\u53d1\u5e03\u4e8b\u4ef6\u7684\u540c\u4e00\u7ebf\u7a0b\u4e0a\u8fdb\u884c\u8c03\u5ea6\uff09\uff0cyields a breadth-first dispatch order on each thread</p> <ul> <li>\u5982\u679c \u4e8b\u4ef6A\u7684\u8ba2\u9605\u8005 post \u4e8b\u4ef6B\u548cC\uff0c\u90a3\u4e48\u6240\u6709\u4e8b\u4ef6A\u7684\u8ba2\u9605\u8005\u90fd\u4f1a\u5728\u4efb\u4f55\u4e8b\u4ef6B\u548cC\u7684\u8ba2\u9605\u8005\u4e4b\u524d\u88ab\u8c03\u7528\uff1b</li> <li>all subscribers to a single event A will be called before any subscribers to any events B and C that are posted to the event bus by the subscribers to A.</li> </ul>"},{"location":"web/backend/event_bus.html#subscriber","title":"Subscriber","text":"<p>A subscriber method on a specific object, plus the executor that should be used for dispatching events to it.</p> <p>\u5c01\u88c5 <code>@Subscribe</code> \u6ce8\u89e3\u7684\u65b9\u6cd5\uff0c</p> <ul> <li> <p>\u65b9\u6cd5\u4e2d\u662f\u5426\u6709 <code>@AllowConcurrentEvents</code> \u6ce8\u89e3\uff0c\u5219\u4e3a <code>SynchronizedSubscriber</code> \u7c7b\uff1b</p> </li> <li> <p>\u63d0\u4f9b <code>dispatchEvent</code> \u65b9\u6cd5\uff0c\u7528\u4e8e\u5728 Executor \u4e2d\u6267\u884c\u88ab\u6ce8\u89e3\u7684\u65b9\u6cd5\uff1b</p> </li> </ul>"},{"location":"web/backend/event_bus.html#executor","title":"Executor","text":"<p>\u6267\u884c @Subscribe \u7684\u7ebf\u7a0b\u3002</p> <p>\u9ed8\u8ba4\u4e3a <code>MoreExecutors.directExecutor()</code>\uff1a</p> <ul> <li>\u679a\u4e3e\u5b9e\u73b0\u7684\u5355\u4f8b\uff0c\u5728\u8c03\u7528\u65b9\u7684\u7ebf\u7a0b\u4e2d\u76f4\u63a5\u6267\u884c\uff1b</li> </ul>"},{"location":"web/backend/event_bus.html#asynceventbus","title":"AsyncEventBus","text":"<ul> <li>\u5c06 Dispatcher \u7684\u5b9e\u4f8b\u53d8\u6210 LegacyAsyncDispatcher\uff1b</li> <li>\u9700\u8981\u663e\u5f0f\u4f20\u5165 Executor\uff1b</li> </ul>"},{"location":"web/backend/event_bus.html#_2","title":"\u793a\u4f8b","text":""},{"location":"web/backend/expression_engine.html","title":"\u8868\u8fbe\u5f0f\u5f15\u64ce","text":""},{"location":"web/backend/expression_engine.html#janino","title":"Janino","text":"<p>Janino is a super-small, super-fast Java compiler.</p> <ul> <li>\u8868\u8fbe\u5f0f\u6267\u884c\uff1b</li> <li>\u9759\u6001\u4ee3\u7801\u5206\u6790\uff1b</li> <li>\u4ee3\u7801\u751f\u6210\uff1b</li> </ul>"},{"location":"web/backend/expression_engine.html#jexlapache-commons","title":"JEXL(Apache Commons)","text":"<p>Java Expression Language (JEXL) \u662f\u4e00\u4e2a\u8868\u8fbe\u5f0f\u8bed\u8a00\u5f15\u64ce\uff0c\u53ef\u4ee5\u7528\u6765\u6821\u9a8c\u6570\u636e\u3002</p>"},{"location":"web/backend/expression_engine.html#_2","title":"\u539f\u7406","text":"<p>Engine\uff1a\u521b\u5efaexpression\uff1b</p> <p>Context\uff1a\u5305\u542b\u53d8\u91cf\uff1b</p> <p>Expression\uff1a\u8bed\u6cd5\u8868\u8fbe\u5f0f\u3002</p>"},{"location":"web/backend/expression_engine.html#_3","title":"\u8bed\u6cd5","text":""},{"location":"web/backend/expression_engine.html#_4","title":"\u8bed\u8a00\u5143\u7d20","text":""},{"location":"web/backend/expression_engine.html#_5","title":"\u6ce8\u91ca","text":"<p>\u652f\u6301<code>##</code>\uff0c<code>//</code>\u5355\u884c\u6ce8\u91ca\uff0c\u4ee5\u53ca<code>/* */</code>\u591a\u884c\u6ce8\u91ca\u3002</p>"},{"location":"web/backend/expression_engine.html#_6","title":"\u53d8\u91cf\u540d","text":"<p>\u4ee5<code>a-z</code>, <code>A-Z</code>, <code>_</code> \u6216<code>$</code>\u5f00\u5934\uff0c\u540e\u7eed\u652f\u6301 <code>0-9</code>, <code>a-z</code>, <code>A-Z</code>, <code>_</code> \u6216<code>$</code>\u3002\u5927\u5c0f\u5199\u654f\u611f\u3002</p>"},{"location":"web/backend/expression_engine.html#_7","title":"\u5e38\u91cf","text":"<p>Int, Float, Long, Double, BigInteger, BigDecimal, Octal, Hex, Real, String, Boolean, Null\uff1b</p> <p>Multiline format literals\uff1a\u7c7b\u4f3c<code>Hello world</code>\uff1b</p> <p>\u6b63\u5219\u5339\u914d\u5e38\u91cf\uff1a\u7c7b\u4f3c<code>~/ABC.*/</code>\uff1b</p> <p>Array\u5e38\u91cf\uff1a<code>[ 1, 2, \"three\",...]</code>\uff0c <code>[]</code>\u8868\u793a\u7a7a\u6570\u7ec4\uff1b</p> <p>List\u5e38\u91cf\uff1a<code>[ 1, 2, \"three\",...]</code>\uff0c <code>[...]</code>\u8868\u793a\u7a7a\u5217\u8868\uff1b</p> <p>Set\u5e38\u91cf\uff1a<code>{ \"one\" , 2, \"more\"}</code>\uff1b</p> <p>Map\u5e38\u91cf\uff1a<code>{ \"one\" : 1, \"two\" : 2, \"three\" : 3, \"more\": \"many more\" }\uff1b</code></p> <p>Range\u53d8\u91cf\uff1a<code>1 .. 42</code>\uff0c\u53ef\u4ee5\u7528\u4f5cfor\u5faa\u73af\u53d8\u91cf\u4e2d\u3002</p>"},{"location":"web/backend/expression_engine.html#operatorstodo","title":"Operators\uff08TODO\uff09","text":""},{"location":"web/backend/expression_engine.html#_8","title":"\u51fd\u6570","text":"<p><code>empty\u3001size\u3001new\u3001ns:function</code></p> <p><code>JexlEngine</code>\u5141\u8bb8\u6ce8\u518c\u5bf9\u8c61\u6216\u8005\u7c7b\u88ab\u7528\u4f5c\u51fd\u6570\u540d\u7a7a\u95f4\uff0c\u5141\u8bb8\u7c7b\u4f3c<code>math:cosinus(23.0)</code>\u7684\u8868\u8fbe\u5f0f\u3002</p> <p>\u53ef\u4ee5\u6ce8\u518c\u6ca1\u6709\u540d\u7a7a\u95f4\u7684\u51fd\u6570\uff0c\u5373\u4f5c\u4e3a\u9876\u5c42\u7684\u51fd\u6570\u3002</p>"},{"location":"web/backend/expression_engine.html#access","title":"\u8bbf\u95ee\uff08Access\uff09","text":""},{"location":"web/backend/expression_engine.html#_9","title":"\u65b9\u6cd5","text":"<p>\u540c\u6837\u7684\u65b9\u5f0f\u8c03\u7528\u5bf9\u8c61\u7684\u65b9\u6cd5</p>"},{"location":"web/backend/expression_engine.html#javabean","title":"JavaBean\u5c5e\u6027","text":"<pre><code>// \u901a\u8fc7getter/setters\u8fdb\u884c\u5c5e\u6027\u7684\u8bfb\u5199\u6216\u8005public\u5c5e\u6027\uff0c\u5bf9\u4e8egetBar()\u65b9\u6cd5\nfoo['bar']; foo.bar;\n\n// \u9488\u5bf9Foo.getAttribute(String index) \uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u8c03\u7528\nx.attribute['name']; x.attribute.name;\n\n// \u9488\u5bf9Object get(String name) \uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u8c03\u7528\nfoo['bar']; foo.bar;\n</code></pre>"},{"location":"web/backend/expression_engine.html#_10","title":"\u6570\u7ec4/\u5217\u8868","text":"<pre><code>// array \u6216\u8005 list \u83b7\u53d6\u5143\u7d20\narr[0]\narr.0\n</code></pre>"},{"location":"web/backend/expression_engine.html#_11","title":"\u6620\u5c04","text":"<pre><code>// map \u83b7\u53d6\u5143\u7d20\uff08key\u4e0d\u4e00\u5b9a\u662fstring\uff0c\u53ea\u8981\u662fjava object\u5373\u53ef\uff09\nmap[0]; map['name']; map[var];\n</code></pre>"},{"location":"web/backend/expression_engine.html#_12","title":"\u6761\u4ef6\u8bed\u53e5","text":""},{"location":"web/backend/expression_engine.html#if","title":"if","text":"<pre><code>if ((x * 2) == 5) { y = 1; } else { y = 2; }\n</code></pre>"},{"location":"web/backend/expression_engine.html#for","title":"for","text":"<pre><code>// item\u662fcontext\u5168\u5c40\u53d8\u91cf\nfor (item : list) { x = x + item; }\n// item\u662f\u672c\u5730\u4e34\u65f6\u53d8\u91cf\uff0c\u4f46\u662f\u5728for\u5faa\u73af\u6267\u884c\u540e\uff0c\u4ecd\u7136\u53ef\u4ee5\u8bbf\u95ee\nfor (var item : list) { x = x + item; }\n</code></pre>"},{"location":"web/backend/expression_engine.html#while","title":"while","text":"<pre><code>while (x lt 10) { x = x + 2; }\ndo { x = x + 2; } while (x lt 10)\n</code></pre>"},{"location":"web/backend/expression_engine.html#continuebreak","title":"continue/break","text":"<p>\u652f\u6301\u7c7b\u4f3cjava\u7684continue\u548cbreak\u8bed\u53e5</p>"},{"location":"web/backend/expression_engine.html#example","title":"Example","text":"<pre><code>// Create or retrieve an engine\nJexlEngine jexl = new JexlBuilder().create();\n\n// Create an expression\nString jexlExp = \"foo.innerFoo.bar()\";\nJexlExpression e = jexl.createExpression( jexlExp );\n\n// Create a context and add data\nJexlContext jc = new MapContext();\njc.set(\"foo\", new Foo() );\n\n// Now evaluate the expression, getting the result\nObject o = e.evaluate(jc);\n</code></pre>"},{"location":"web/backend/flow_engine.html","title":"\u6d41\u7a0b\u5f15\u64ce","text":""},{"location":"web/backend/id_generator.html","title":"Id Generator","text":"<p>\u53c2\u8003\uff1a</p> <p>[1]. Leaf\u2014\u2014\u7f8e\u56e2\u70b9\u8bc4\u5206\u5e03\u5f0fID\u751f\u6210\u7cfb\u7edf</p> <p>\u5168\u5c40\u552f\u4e00ID\u5e94\u8be5\u5177\u5907\u7684\u5c5e\u6027\uff1a</p> <ol> <li>\u5168\u5c40\u552f\u4e00\u6027\uff1a\u4e0d\u80fd\u51fa\u73b0\u91cd\u590d\u7684 ID \u53f7\uff0c\u65e2\u7136\u662f\u552f\u4e00\u6807\u8bc6\uff0c\u8fd9\u662f\u6700\u57fa\u672c\u7684\u8981\u6c42\uff1b</li> <li>\u8d8b\u52bf\u9012\u589e\uff1a\u5728 MySQL InnoDB \u5f15\u64ce\u4e2d\u4f7f\u7528\u7684\u662f\u805a\u96c6\u7d22\u5f15\uff0c\u7531\u4e8e\u591a\u6570 RDBMS \u4f7f\u7528 B-tree \u7684\u6570\u636e\u7ed3\u6784\u6765\u5b58\u50a8\u7d22\u5f15\u6570\u636e\uff0c\u5728\u4e3b\u952e\u7684\u9009\u62e9\u4e0a\u9762\u6211\u4eec\u5e94\u8be5\u5c3d\u91cf\u4f7f\u7528\u6709\u5e8f\u7684\u4e3b\u952e\u4fdd\u8bc1\u5199\u5165\u6027\u80fd\uff1b</li> <li>\u5355\u8c03\u9012\u589e\uff1a\u4fdd\u8bc1\u4e0b\u4e00\u4e2a ID \u4e00\u5b9a\u5927\u4e8e\u4e0a\u4e00\u4e2a ID\uff0c\u4f8b\u5982\u4e8b\u52a1\u7248\u672c\u53f7\u3001IM \u589e\u91cf\u6d88\u606f\u3001\u6392\u5e8f\u7b49\u7279\u6b8a\u9700\u6c42\uff1b</li> <li>\u4fe1\u606f\u5b89\u5168\uff1a\u5982\u679c ID \u662f\u8fde\u7eed\u7684\uff0c\u6076\u610f\u7528\u6237\u7684\u722c\u53d6\u5de5\u4f5c\u5c31\u975e\u5e38\u5bb9\u6613\u505a\u4e86\uff0c\u76f4\u63a5\u6309\u7167\u987a\u5e8f\u4e0b\u8f7d\u6307\u5b9a URL \u5373\u53ef\uff1b\u5982\u679c\u662f\u8ba2\u5355\u53f7\u5c31\u66f4\u5371\u9669\u4e86\uff0c\u7ade\u4e89\u5bf9\u624b\u53ef\u4ee5\u76f4\u63a5\u77e5\u9053\u6211\u4eec\u4e00\u5929\u7684\u5355\u91cf\u3002\u6240\u4ee5\u5728\u4e00\u4e9b\u5e94\u7528\u573a\u666f\u4e0b\uff0c\u4f1a\u9700\u8981 ID \u65e0\u89c4\u5219\u3001\u4e0d\u89c4\u5219\u3002</li> </ol>"},{"location":"web/backend/id_generator.html#uuid","title":"UUID","text":"<p>UUID(Universally Unique Identifier)\u7684\u6807\u51c6\u578b\u5f0f\u5305\u542b32\u4e2a16\u8fdb\u5236\u6570\u5b57\uff0c\u4ee5\u8fde\u5b57\u53f7\u5206\u4e3a\u4e94\u6bb5\uff0c\u5f62\u5f0f\u4e3a8-4-4-4-12\u768436\u4e2a\u5b57\u7b26\uff0c\u793a\u4f8b\uff1a<code>550e8400-e29b-41d4-a716-446655440000</code>\uff0c\u5230\u76ee\u524d\u4e3a\u6b62\u4e1a\u754c\u4e00\u5171\u67095\u79cd\u65b9\u5f0f\u751f\u6210UUID\u3002</p> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u6027\u80fd\u975e\u5e38\u9ad8\uff1a\u672c\u5730\u751f\u6210\uff0c\u6ca1\u6709\u7f51\u7edc\u6d88\u8017\u3002</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u4e0d\u6613\u4e8e\u5b58\u50a8\uff1aUUID\u592a\u957f\uff0c16\u5b57\u8282128\u4f4d\uff0c\u901a\u5e38\u4ee536\u957f\u5ea6\u7684\u5b57\u7b26\u4e32\u8868\u793a\uff0c\u5f88\u591a\u573a\u666f\u4e0d\u9002\u7528\u3002</li> <li>\u4fe1\u606f\u4e0d\u5b89\u5168\uff1a\u57fa\u4e8eMAC\u5730\u5740\u751f\u6210UUID\u7684\u7b97\u6cd5\u53ef\u80fd\u4f1a\u9020\u6210MAC\u5730\u5740\u6cc4\u9732\uff0c\u8fd9\u4e2a\u6f0f\u6d1e\u66fe\u88ab\u7528\u4e8e\u5bfb\u627e\u6885\u4e3d\u838e\u75c5\u6bd2\u7684\u5236\u4f5c\u8005\u4f4d\u7f6e\u3002</li> <li>ID\u4f5c\u4e3a\u4e3b\u952e\u65f6\u5728\u7279\u5b9a\u7684\u73af\u5883\u4f1a\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff0c\u6bd4\u5982\u505aDB\u4e3b\u952e\u7684\u573a\u666f\u4e0b\uff0cUUID\u5c31\u975e\u5e38\u4e0d\u9002\u7528\uff1a</li> <li>MySQL\u5b98\u65b9\u6709\u660e\u786e\u7684\u5efa\u8bae\u4e3b\u952e\u8981\u5c3d\u91cf\u8d8a\u77ed\u8d8a\u597d\uff0c36\u4e2a\u5b57\u7b26\u957f\u5ea6\u7684UUID\u4e0d\u7b26\u5408\u8981\u6c42\uff1b</li> <li>\u5bf9MySQL\u7d22\u5f15\u4e0d\u5229\uff1a\u5982\u679c\u4f5c\u4e3a\u6570\u636e\u5e93\u4e3b\u952e\uff0c\u5728InnoDB\u5f15\u64ce\u4e0b\uff0cUUID\u7684\u65e0\u5e8f\u6027\u53ef\u80fd\u4f1a\u5f15\u8d77\u6570\u636e\u4f4d\u7f6e\u9891\u7e41\u53d8\u52a8\uff0c\u4e25\u91cd\u5f71\u54cd\u6027\u80fd\u3002</li> </ul>"},{"location":"web/backend/id_generator.html#snowflaketwitter","title":"Snowflake\uff08Twitter\uff09","text":"<p>Snowflake\u7b97\u6cd5\u63cf\u8ff0\uff1a\u6307\u5b9a\u673a\u5668 &amp; \u540c\u4e00\u65f6\u523b &amp; \u67d0\u4e00\u5e76\u53d1\u5e8f\u5217\uff0c\u662f\u552f\u4e00\u7684\u3002\u636e\u6b64\u53ef\u751f\u6210\u4e00\u4e2a64 bits\u7684\u552f\u4e00ID\uff08long\uff09\u3002\u9ed8\u8ba4\u91c7\u7528\u4e0a\u56fe\u5b57\u8282\u5206\u914d\u65b9\u5f0f\uff1a</p> <ul> <li>sign(1bit)   \u56fa\u5b9a1bit\u7b26\u53f7\u6807\u8bc6\uff0c\u5373\u751f\u6210\u7684UID\u4e3a\u6b63\u6570\u3002</li> <li>delta seconds (\u7cbe\u786e\u5230\u6beb\u79d2\uff0c41 \u4f4d\u7684\u957f\u5ea6\u53ef\u4ee5\u4f7f\u7528 69 \u5e74)   \u5355\u4f4d\uff1a\u79d2\uff0c\u6700\u591a\u53ef\u652f\u6301\u7ea670\u5e74</li> <li>worker id (10 bits)   \u673a\u5668id\uff0c\u6700\u591a\u53ef\u652f\u6301\u7ea61024\u4e2a\u3002</li> <li>sequence (12 bits)   \u6bcf\u6beb\u79d2\u4e0b\u7684\u5e76\u53d1\u5e8f\u5217\uff0c12 bits\u53ef\u652f\u6301\u6bcf\u6beb\u79d2 4096\u4e2a\u5e76\u53d1\u3002</li> </ul> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u6beb\u79d2\u6570\u5728\u9ad8\u4f4d\uff0c\u81ea\u589e\u5e8f\u5217\u5728\u4f4e\u4f4d\uff0c\u6574\u4e2aID\u90fd\u662f\u8d8b\u52bf\u9012\u589e\u7684\u3002</li> <li>\u4e0d\u4f9d\u8d56\u6570\u636e\u5e93\u7b49\u7b2c\u4e09\u65b9\u7cfb\u7edf\uff0c\u4ee5\u670d\u52a1\u7684\u65b9\u5f0f\u90e8\u7f72\uff0c\u7a33\u5b9a\u6027\u66f4\u9ad8\uff0c\u751f\u6210ID\u7684\u6027\u80fd\u4e5f\u662f\u975e\u5e38\u9ad8\u7684\u3002</li> <li>\u53ef\u4ee5\u6839\u636e\u81ea\u8eab\u4e1a\u52a1\u7279\u6027\u5206\u914dbit\u4f4d\uff0c\u975e\u5e38\u7075\u6d3b\u3002</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u5f3a\u4f9d\u8d56\u673a\u5668\u65f6\u949f\uff0c\u5982\u679c\u673a\u5668\u4e0a\u65f6\u949f\u56de\u62e8\u6216\u8005\u95f0\u79d2\uff0c\u4f1a\u5bfc\u81f4\u53d1\u53f7\u91cd\u590d\u6216\u8005\u670d\u52a1\u4f1a\u5904\u4e8e\u4e0d\u53ef\u7528\u72b6\u6001\u3002</li> </ul>"},{"location":"web/backend/id_generator.html#leaf","title":"Leaf\uff08\u7f8e\u56e2\uff09","text":""},{"location":"web/backend/id_generator.html#leaf-segment","title":"Leaf-segment\u6570\u636e\u5e93\u65b9\u6848","text":"<p>\u6bcf\u6b21\u83b7\u53d6\u4e00\u4e2asegment(step\u51b3\u5b9a\u5927\u5c0f)\u53f7\u6bb5\u7684\u503c\u3002\u7528\u5b8c\u4e4b\u540e\u518d\u53bb\u6570\u636e\u5e93\u83b7\u53d6\u65b0\u7684\u53f7\u6bb5\uff0c\u53ef\u4ee5\u5927\u5927\u7684\u51cf\u8f7b\u6570\u636e\u5e93\u7684\u538b\u529b\u3002</p> <p>\u4f18\u70b9\uff1a</p> <ul> <li>Leaf\u670d\u52a1\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u7ebf\u6027\u6269\u5c55\uff0c\u6027\u80fd\u5b8c\u5168\u80fd\u591f\u652f\u6491\u5927\u591a\u6570\u4e1a\u52a1\u573a\u666f\u3002</li> <li>ID\u53f7\u7801\u662f\u8d8b\u52bf\u9012\u589e\u76848byte\u768464\u4f4d\u6570\u5b57\uff0c\u6ee1\u8db3\u4e0a\u8ff0\u6570\u636e\u5e93\u5b58\u50a8\u7684\u4e3b\u952e\u8981\u6c42\u3002</li> <li>\u5bb9\u707e\u6027\u9ad8\uff1aLeaf\u670d\u52a1\u5185\u90e8\u6709\u53f7\u6bb5\u7f13\u5b58\uff0c\u5373\u4f7fDB\u5b95\u673a\uff0c\u77ed\u65f6\u95f4\u5185Leaf\u4ecd\u80fd\u6b63\u5e38\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002</li> <li>\u53ef\u4ee5\u81ea\u5b9a\u4e49max_id\u7684\u5927\u5c0f\uff0c\u975e\u5e38\u65b9\u4fbf\u4e1a\u52a1\u4ece\u539f\u6709\u7684ID\u65b9\u5f0f\u4e0a\u8fc1\u79fb\u8fc7\u6765\u3002</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>ID\u53f7\u7801\u4e0d\u591f\u968f\u673a\uff0c\u80fd\u591f\u6cc4\u9732\u53d1\u53f7\u6570\u91cf\u7684\u4fe1\u606f\uff0c\u4e0d\u592a\u5b89\u5168\u3002</li> <li>TP999\u6570\u636e\u6ce2\u52a8\u5927\uff0c\u5f53\u53f7\u6bb5\u4f7f\u7528\u5b8c\u4e4b\u540e\u8fd8\u662f\u4f1ahang\u5728\u66f4\u65b0\u6570\u636e\u5e93\u7684I/O\u4e0a\uff0ctg999 \u6570\u636e\u4f1a\u51fa\u73b0\u5076\u5c14\u7684\u5c16\u523a\u3002</li> <li>DB \u5b95\u673a\u4f1a\u9020\u6210\u6574\u4e2a\u7cfb\u7edf\u4e0d\u53ef\u7528\u3002</li> </ul>"},{"location":"web/backend/id_generator.html#leaf-snowflake","title":"Leaf-snowflake\u65b9\u6848","text":"<p>workerId\u7684\u751f\u6210\uff1a</p> <ul> <li>\u901a\u8fc7zk\u7684\u6301\u4e45\u5316\u8282\u70b9\uff0c\u83b7\u53d6\u5e8f\u53f7\uff0c\u5e76\u4e14\u901a\u8fc7\u672c\u5730\u6587\u4ef6\u7f13\u5b58id\uff0c\u5f31\u4f9d\u8d56ZK\uff1b</li> </ul> <p>\u65f6\u95f4\u6233\u95ee\u9898\uff1a</p> <ul> <li>\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4(3s)\u4e0a\u62a5\u81ea\u8eab\u7cfb\u7edf\u65f6\u95f4\u5199\u5165ZK\u7684 leaf_forever/${self}\uff1b</li> <li>\u673a\u5668\u542f\u52a8\u65f6\uff0c\u6bd4\u8f83\u5176\u4ed6\u673a\u5668\u6ce8\u518c\u5728zk\u4e0a\u7684\u65f6\u95f4\uff0c\u5c0f\u4e8e\u4e00\u5b9a\u9608\u503c\uff0c\u5219\u8ba4\u4e3a\u65f6\u95f4\u6ca1\u95ee\u9898\uff0c\u6210\u529f\u542f\u52a8\uff0c\u5426\u5219\u542f\u52a8\u5931\u8d25\uff1b</li> <li>\u505a\u4e00\u5c42\u91cd\u8bd5\uff0c\u7136\u540e\u4e0a\u62a5\u62a5\u8b66\u7cfb\u7edf\uff0c\u66f4\u6216\u8005\u662f\u53d1\u73b0\u6709\u65f6\u949f\u56de\u62e8\u4e4b\u540e\u81ea\u52a8\u6458\u9664\u672c\u8eab\u8282\u70b9\u5e76\u62a5\u8b66\uff0c\u901a\u8fc7\u6bd4\u8f83\u5f53\u524d\u65f6\u95f4\u548c\u4e0a\u6b21\u53d1\u53f7\u7684\u65f6\u95f4\uff1b</li> </ul>"},{"location":"web/backend/log.html","title":"\u65e5\u5fd7","text":"<ul> <li>\u65e5\u5fd7\u662f\u5426\u6709\u4eba\u770b</li> <li>\u770b\u5230\u8fd9\u6761\u65e5\u5fd7\u80fd\u505a\u4ec0\u4e48</li> <li>\u80fd\u4e0d\u80fd\u63d0\u5347\u95ee\u9898\u6392\u67e5\u6548\u7387</li> </ul> <ul> <li>\u4f7f\u7528\u5360\u4f4d\u7b26\u6216\u8005\u6761\u4ef6\u8f93\u51fa\u7684\u65b9\u5f0f\u6253\u5370\uff0c\u907f\u514d\u989d\u5916\u7684\u5b57\u7b26\u4e32\u62fc\u63a5\u7b49\u6027\u80fd\u5f00\u9500\uff1b</li> <li>\u751f\u4ea7\u73af\u5883\u7981\u6b62\u8f93\u51fa DEBUG \u65e5\u5fd7\uff0c\u5e76\u6709\u9009\u62e9\u8f93\u51fa INFO \u65e5\u5fd7\uff1b</li> <li>\u907f\u514d\u65e0\u6548/\u91cd\u590d\u65e5\u5fd7\u6253\u5370\uff0c\u4e3a\u6587\u4ef6\u8bbe\u7f6e\u5408\u7406\u7684\u751f\u547d\u5468\u671f\uff1b</li> <li>\u533a\u522b\u5bf9\u5f85 WARN \u548c ERROR \u65e5\u5fd7\uff0cERROR\u8868\u793a\u9519\u8bef\u9700\u8981\u4eba\u4e3a\u4ecb\u5165\uff1b</li> <li> <p>WARN \u8bb0\u5f55\u53ef\u4ee5\u901a\u8fc7\u5f15\u5bfc\u91cd\u8bd5\u5c31\u80fd\u6062\u590d\u7684\u4e1a\u52a1\u5f02\u5e38\uff0c\u5982\u7528\u6237\u8f93\u5165\u53c2\u6570\u9519\u8bef\uff0c\u7528\u4e8e\u7528\u6237\u54a8\u8be2\u65f6\u8fd8\u539f\u73b0\u573a\uff1b</p> </li> <li> <p>\u4fdd\u8bc1\u65e5\u5fd7\u8bb0\u5f55\u8bb0\u5f55\u5b8c\u6574\uff0c\u5982\u5305\u542b\u5b8c\u6574\u7684\u5806\u6808\u4fe1\u606f\u548c\u4e0a\u4e0b\u6587\u4fe1\u606f\uff1b</p> </li> </ul>"},{"location":"web/backend/metrics.html","title":"Metrics","text":"<p>\u793a\u4f8b\u4ee3\u7801</p>"},{"location":"web/backend/metrics.html#dropwizard-metrics","title":"Dropwizard Metrics","text":"<p>Spark \u4f7f\u7528\u5176\u4f5c\u4e3a\u6307\u6807\u6846\u67b6\u3002</p> <p>Dropwizard Metrics \u80fd\u591f\u4ece\u5404\u4e2a\u89d2\u5ea6\u5ea6\u91cf\u5df2\u5b58\u5728\u7684java\u5e94\u7528\u7684\u6210\u719f\u6846\u67b6\uff0c\u7b80\u4fbf\u5730\u4ee5jar\u5305\u7684\u65b9\u5f0f\u96c6\u6210\u8fdb\u7cfb\u7edf\uff0c\u53ef\u4ee5\u4ee5http\u3001ganglia\u3001graphite\u3001log4j\u7b49\u65b9\u5f0f\u63d0\u4f9b\u5168\u6808\u5f0f\u7684\u76d1\u63a7\u89c6\u91ce\u3002</p> <p>2023/3/15\u7248\u672c\uff1a4.2.17</p>"},{"location":"web/backend/metrics.html#maven","title":"Maven","text":"<pre><code>&lt;dependencies&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;io.dropwizard.metrics&lt;/groupId&gt;\n        &lt;artifactId&gt;metrics-core&lt;/artifactId&gt;\n        &lt;version&gt;${metrics.version}&lt;/version&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n        &lt;groupId&gt;io.dropwizard.metrics&lt;/groupId&gt;\n        &lt;artifactId&gt;metrics-healthchecks&lt;/artifactId&gt;\n        &lt;version&gt;${metrics.version}&lt;/version&gt;\n    &lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre>"},{"location":"web/backend/metrics.html#registry","title":"Registry","text":"<p>\u5ea6\u91cf\u7684\u6838\u5fc3\u662fMetricRegistry\u7c7b\uff0c\u5b83\u662f\u6240\u6709\u5e94\u7528\u7a0b\u5e8f\u5ea6\u91cf\u7684\u5bb9\u5668\uff0cMetricRegistry\u662f\u7ebf\u7a0b\u5b89\u5168\u7c7b\u3002</p> <p>\u6bcf\u4e2aregistry\u91cc\u7684metric\u90fd\u6709\u552f\u4e00\u7684\u540d\uff0c\u4ee5 '.' \u5206\u9694\uff0c\u5982\"thing.count\"\uff0c\u540c\u4e00\u4e2a\u540d\u5b57\u5bf9\u5e94\u540c\u4e00\u4e2ametric</p> <pre><code>// \u9759\u6001\u65b9\u6cd5\uff0c\u751f\u6210\u552f\u4e00\u7684\u540d\uff0c\"key.jobs.size\"\nString count = MetricRegistry.name(\"key\", \"jobs\", \"size\")\n// \u6ce8\u518c\u6307\u6807\nMetricRegistry metrics = new MetricRegistry();\n// 1. register \u6ce8\u518c\nmetrics.register(count, (Gauge&lt;Integer&gt;) () -&gt; 5)\n// 2. \u901a\u8fc7 gauge, meter, counter \u7b49\u6ce8\u518c\nmetrics.gauge(\"key.jobs.size\")\n</code></pre>"},{"location":"web/backend/metrics.html#_1","title":"\u6307\u6807\u7c7b\u578b","text":"<pre><code>2023-03-22 17:09:02.016 [INFO ] c.c.m.Slf4jReporter$InfoLoggerProxy.log[473 line]- type=GAUGE, name=call.times, value=10\n2023-03-22 17:09:02.016 [INFO ] c.c.m.Slf4jReporter$InfoLoggerProxy.log[473 line]- type=COUNTER, name=count, count=-10\n2023-03-22 17:09:02.016 [INFO ] c.c.m.Slf4jReporter$InfoLoggerProxy.log[473 line]- type=HISTOGRAM, name=histogram, count=10, min=0, max=2, mean=0.9639057667940371, stddev=0.7820338303861577, p50=1.0, p75=2.0, p95=2.0, p98=2.0, p99=2.0, p999=2.0\n2023-03-22 17:09:02.016 [INFO ] c.c.m.Slf4jReporter$InfoLoggerProxy.log[473 line]- type=METER, name=requests, count=10, m1_rate=0.38646381163615817, m5_rate=0.3968026648037416, m15_rate=0.398904212905539, mean_rate=0.3524120972991338, rate_unit=events/second\n</code></pre>"},{"location":"web/backend/metrics.html#meters","title":"Meters","text":"<p>meter\uff1a\u6d4b\u91cf\u4e8b\u4ef6\u968f\u65f6\u95f4\u53d8\u5316\u7684\u901f\u7387\uff0c\u4ee5\u53ca1\u5206\u949f\u30015\u5206\u949f\u300115\u5206\u949f\u5185\u7684\u79fb\u52a8\u5e73\u5747\u503c\uff1b</p> <pre><code>private final MetricRegistry metrics = new MetricRegistry();\nprivate final Meter requests = metrics.meter(\"requests\");\n\n// \u6d4b\u8bd5\u6bcf\u5206\u949f\u8bf7\u6c42\u7684\u9891\u7387\npublic void handleRequest(Request request, Response response) {\n    requests.mark();\n    // etc\n}\n</code></pre>"},{"location":"web/backend/metrics.html#gauges","title":"Gauges","text":"<p>gauge: \u91cf\u8868\u662f\u5bf9\u4e00\u4e2a\u503c\u7684\u77ac\u65f6\u6d4b\u91cf\u3002\uff08\u6bd4\u5982 CPU \u7684\u4f7f\u7528\u7387\u7b49\uff09</p> <pre><code>// \u53ea\u662f\u6ce8\u518cGuage\u8fd9\u4e2ametric\uff0cReporter\u83b7\u53d6\u7684\u65f6\u5019\u624d\u4f1a\u89e6\u53d1\u8ba1\u7b97\uff08\u5373\u6bcf\u6b21\u90fd\u4f1a\u8fdb\u884c\u8c03\u7528\uff0c\u83b7\u53d6\u6700\u65b0\u7684\u503c\uff09\nmetrics.register(MetricRegistry.name(String.class, \"test\", \"size\"),\n        (Gauge&lt;Integer&gt;) () -&gt; 5);\n</code></pre> <p>\u9ed8\u8ba4\u63d0\u4f9b<code>JmxAttributeGauge</code>\uff0c<code>RatioGauge</code>\uff0c<code>CachedGauge</code>\uff0c<code>DerivativeGauge</code></p>"},{"location":"web/backend/metrics.html#counters","title":"Counters","text":"<p>\u53ef\u7528\u4e8e\u7edf\u8ba1\u5355\u6b21\u65f6\u95f4\uff0c\u4e00\u822c\u7528\u6765\u7edf\u8ba1\u4e00\u76f4\u589e\u957f\u7684\u6307\u6807\u3002</p> <p>\u662f\u4e00\u4e2a<code>AtomicLong</code>\u5b9e\u4f8b\u7684gauge\uff0c\u53ef\u4ee5\u6267\u884cincrement \u548c decrement\u51fd\u6570\u3002</p> <pre><code>// \u4f7f\u7528 #counter(String) \u800c\u4e0d\u662f #register(String, Metric)\nCounter pendingJobs = metrics.counter(name(String.class, \"pending-jobs\"));\npendingJobs.inc(); pendingJobs.dec();\n</code></pre>"},{"location":"web/backend/metrics.html#histograms","title":"Histograms","text":"<p>reservoir sampling\uff1a\u84c4\u6c34\u6c60\u91c7\u6837\u7b97\u6cd5\uff08\u907f\u514d\u7edf\u8ba1\u6240\u6709\u7684\u6570\u636e\uff09</p> <ul> <li>UniformReservoir\uff1a\u968f\u673a\u91c7\u6837</li> <li> <p>SlidingWindowReservoir\uff1a\u53ea\u4fdd\u7559\u6700\u540e\u7684 N \u4e2a\u503c\uff1b</p> </li> <li> <p>SlidingTimeWindowArrayReservoir \uff1a\u6ed1\u52a8\u7a97\u53e3\u91c7\u6837</p> </li> <li>ExponentiallyDecayingReservoir\uff1a\u9ed8\u8ba4\uff0c\u6307\u6570\u91c7\u6837</li> </ul> <p>\u76f4\u65b9\u56fe\u6d4b\u91cf\u6570\u636e\u6d41\u4e2d\u503c\u7684\u7edf\u8ba1\u5206\u5e03\u3002\u9664\u4e86\u6700\u5c0f\u503c\u3001\u6700\u5927\u503c\u3001\u5e73\u5747\u503c\u7b49\uff0c\u5b83\u8fd8\u6d4b\u91cf\u4e2d\u4f4d\u6570\u3001\u7b2c75\u300190\u300195\u300198\u300199\u548c99.9\u4e2a\u767e\u5206\u70b9\u3002</p> <pre><code>private final Histogram responseSizes = metrics.histogram(name(String.class, \"rsizes\"));\n\npublic void handleRequest(Request request, Response response) {\n    // etc\n    responseSizes.update(response.getContent().length);\n}\n</code></pre>"},{"location":"web/backend/metrics.html#timers","title":"Timers","text":"<p>\u7528\u4e8e\u7edf\u8ba1\u51fd\u6570\u7684\u8c03\u7528\u6b21\u6570\u548c\u5e73\u5747\u6267\u884c\u65f6\u95f4</p> <p>\u8ba1\u65f6\u5668\u6d4b\u91cf\u8c03\u7528\u7279\u5b9a\u4ee3\u7801\u6bb5\u7684\u901f\u7387\u53ca\u5176\u6301\u7eed\u65f6\u95f4\u7684\u5206\u5e03\uff0c\u5305\u542b Meter \u548c Historm\u3002</p> <pre><code>private final Timer responses = metrics.timer(name(RequestHandler.class, \"responses\"));\n// \u8ba1\u65f6\u5668\u5c06\u4ee5\u7eb3\u79d2\u4e3a\u5355\u4f4d\u6d4b\u91cf\u5904\u7406\u6bcf\u4e2a\u8bf7\u6c42\u6240\u9700\u7684\u65f6\u95f4\uff0c\u5e76\u63d0\u4f9b\u6bcf\u79d2\u8bf7\u6c42\u7684\u901f\u7387\npublic String handleRequest(Request request, Response response) {\n    try(final Timer.Context context = responses.time()) {\n        // etc;\n        return \"OK\";\n    } // catch and final logic goes here\n}\n</code></pre>"},{"location":"web/backend/metrics.html#health-checks","title":"Health Checks","text":"<p>\u68c0\u67e5\u7528\u6237\u670d\u52a1\u7684\u5065\u5eb7\u72b6\u6001</p> <pre><code>// \u7ee7\u627fHealthCheck\u7c7b\uff0c\u5b9e\u73b0check\u65b9\u6cd5\n// \u5f02\u6b65\u6267\u884c\uff0c\u6bcf 2s \u6267\u884c\u4e00\u6b21\n@Async(period = 2000)\npublic class ServerHealthCheck extends HealthCheck {\n    @Override\n    public HealthCheck.Result check() throws Exception {\n        double value = Math.random();\n\n        if (value &gt; 0.5) {\n            return HealthCheck.Result.healthy();\n        } else {\n            return HealthCheck.Result.unhealthy(\"error random\");\n        }\n    }\n}\n\n// \u5b9a\u4e49HealthCheckRegistry\uff0c\u9ed8\u8ba4 2\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u6c60\u8fd0\u884c\u5f02\u6b65\u7684check\nfinal HealthCheckRegistry healthChecks = new HealthCheckRegistry();\nhealthChecks.register(\"server.healthy\", new ServerHealthCheck());\n// \u8fd0\u884c\u6240\u6709\u6ce8\u518c\u7684\u5065\u5eb7\u68c0\u67e5\nfinal Map&lt;String, HealthCheck.Result&gt; results = healthChecks.runHealthChecks();\nfor (Entry&lt;String, HealthCheck.Result&gt; entry : results.entrySet()) {\n    if (entry.getValue().isHealthy()) {\n        System.out.println(entry.getKey() + \" is healthy\");\n    } else {\n        System.err.println(entry.getKey() + \" is UNHEALTHY: \" + entry.getValue().getMessage());\n        final Throwable e = entry.getValue().getError();\n        if (e != null) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre> <p>Metrics\u5185\u7f6e<code>ThreadDeadlockHealthCheck</code>\u5065\u5eb7\u68c0\u67e5\uff0c\u4f7f\u7528Java\u5185\u7f6e\u7684\u7ebf\u7a0b\u6b7b\u9501\u68c0\u6d4b\u3002</p>"},{"location":"web/backend/metrics.html#reporter","title":"Reporter","text":"<p>core \u5185\u7f6e <code>ConsoleReporter</code>, <code>CsvReporter</code> \u548c <code>Slf4jReporter</code></p>"},{"location":"web/backend/metrics.html#console-reporter","title":"Console Reporter","text":"<p>Reporter\u4f1a\u5b9a\u65f6\u53bbMetricRegistry\u4e2d\u83b7\u53d6metric\u7ed3\u679c\u3002</p> <pre><code>ConsoleReporter reporter = ConsoleReporter.forRegistry(metrics)\n       .convertRatesTo(TimeUnit.SECONDS)\n       .convertDurationsTo(TimeUnit.MILLISECONDS)\n       .build();\nreporter.start(1, TimeUnit.SECONDS); // \u6bcf\u79d2\u5c06\u7ed3\u679c\u8f93\u51fa\u5230\u63a7\u5236\u53f0\n</code></pre>"},{"location":"web/backend/metrics.html#reporting-via-jmx","title":"Reporting Via JMX","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;io.dropwizard.metrics&lt;/groupId&gt;\n    &lt;artifactId&gt;metrics-jmx&lt;/artifactId&gt;\n    &lt;version&gt;${metrics.version}&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <pre><code>final JmxReporter reporter = JmxReporter.forRegistry(registry).build();\nreporter.start();\n</code></pre> <p>\u4e00\u65e6reporter\u5f00\u59cb\uff0c\u6240\u6709\u6ce8\u518c\u7684metrics\u90fd\u53ef\u4ee5\u901a\u8fc7JConsole\u6216\u8005VisualVM\u67e5\u770b\u3002</p>"},{"location":"web/backend/metrics.html#reporting-via-http","title":"Reporting Via HTTP","text":"<p>AdminServlet \u63d0\u4f9b \u6240\u6709\u6ce8\u518cmetrics\u7684Json\u8868\u793a\uff1b\u4e5f\u4f1a\u8fd0\u884c\u5065\u5eb7\u68c0\u67e5\uff1b\u6253\u5370thread dump\uff1b\u5bf9load-balancers\u63d0\u4f9b\u7b80\u5355\u7684'ping'\u8fd4\u56de\u3002</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;io.dropwizard.metrics&lt;/groupId&gt;\n    &lt;artifactId&gt;metrics-servlets&lt;/artifactId&gt;\n    &lt;version&gt;${metrics.version}&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"web/backend/metrics.html#other-reporting","title":"Other Reporting","text":"<ul> <li>Graphite, using GraphiteReporter from <code>metrics-graphite</code></li> </ul>"},{"location":"web/backend/metrics.html#instrumenting","title":"Instrumenting","text":"<p>https://metrics.dropwizard.io/4.2.0/manual/servlet.html</p> <p>\u5bf9\u5e38\u89c1\u7684\u6846\u67b6\uff0c\u63d0\u4f9b\u6ce8\u5165\uff0c\u81ea\u52a8\u8bb0\u5f55Metrics\uff0c\u5982<code>Ehcache</code>\uff0c<code>Caffine</code>\uff0c<code>Apache HttpClient</code>\uff0c<code>JDBI</code>\uff0c<code>Log4j</code>\uff0c<code>LogBack</code>\uff0c<code>Jetty</code>\uff0c<code>Jersey 2.x</code>\uff0c<code>JVM</code>\u3002</p> <p>Web-Application\u7684 metrics\uff08<code>metrics-servlet</code>\uff09\uff1a status codes(meters), the number of active requests(counter), request duration(timer)</p> <ul> <li>\u901a\u8fc7Filter(<code>com.codahale.metrics.servlet.InstrumentedFilter</code>)</li> </ul>"},{"location":"web/backend/metrics.html#_2","title":"\u4e09\u65b9\u5e93","text":"<p>https://metrics.dropwizard.io/4.2.0/manual/third-party.html</p>"},{"location":"web/backend/metrics.html#prometheus-metrics-client","title":"Prometheus Metrics Client","text":"<p>Prometheus instrumentation library for JVM applications</p>"},{"location":"web/backend/metrics.html#_3","title":"\u6307\u6807\u7c7b\u578b","text":""},{"location":"web/backend/metrics.html#counter","title":"Counter","text":"<p>Counters go up, and reset when the process restarts.</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>import io.prometheus.client.Counter;\nclass YourClass {\n  static final Counter requests = Counter.build()\n     .name(\"requests_total\").help(\"Total requests.\").register();\n\n  void processRequest() {\n    requests.inc();\n    // Your code here.\n  }\n}\n</code></pre>"},{"location":"web/backend/metrics.html#gauge","title":"Gauge","text":"<p>Gauges can go up and down.</p> <p>\u793a\u4f8b</p> <pre><code>class YourClass {\n  static final Gauge inprogressRequests = Gauge.build()\n     .name(\"inprogress_requests\").help(\"Inprogress requests.\").register();\n\n  void processRequest() {\n    inprogressRequests.inc();\n    // Your code here.\n    inprogressRequests.dec();\n  }\n}\n</code></pre>"},{"location":"web/backend/metrics.html#summary","title":"Summary","text":"<p>monitor distributions, like latencies or request sizes.</p> <p>\u9ed8\u8ba4\u63d0\u4f9b sum\u3001count \u6307\u6807\uff0c\u53ef\u6dfb\u52a0 95%, 90% \u7684\u7edf\u8ba1\u4fe1\u606f\u3002</p> <p>\u793a\u4f8b</p> <pre><code>private static final Summary requestLatency = Summary.build()\n    .name(\"requests_latency_seconds\")\n    .help(\"request latency in seconds\")\n    .quantile(0.5, 0.01)    // 0.5 quantile (median) with 0.01 allowed error\n    .quantile(0.95, 0.005)  // 0.95 quantile with 0.005 allowed error\n    .register();\n\nprivate static final Summary receivedBytes = Summary.build()\n    .name(\"requests_size_bytes\")\n    .help(\"request size in bytes\")\n    .register();\n\npublic void processRequest(Request req) {\n    // \u8ba1\u65f6\n    Summary.Timer requestTimer = requestLatency.startTimer();\n    try {\n        // Your code here.\n    } finally {\n        requestTimer.observeDuration();\n        // \u6570\u91cf\u7edf\u8ba1\n        receivedBytes.observe(req.size());\n    }\n}\n</code></pre> <p>\u65f6\u7a97\uff1a\u4e00\u5b9a\u65f6\u95f4\u5185\u7684 Summary \u800c\u4e0d\u662f\u6574\u4e2aAPP\u751f\u547d\u5468\u671f\uff0c\u53ef\u4ee5\u901a\u8fc7\u6ed1\u52a8\u7a97\u53e3\u914d\u7f6e</p> <pre><code>Summary requestLatency = Summary.build()\n    .name(\"requests_latency_seconds\")\n    .help(\"Request latency in seconds.\")\n    .maxAgeSeconds(10 * 60)\n    .ageBuckets(5)\n    // ...\n    .register();\n</code></pre> <p>10\u5206\u949f\u7684\u65f6\u95f4\u7a97\u53e3\uff0c5\u4e2abucket\uff0c\u5373\u6bcf2\u5206\u949f\u6ed1\u52a8\u4e00\u6b21\u3002</p>"},{"location":"web/backend/metrics.html#histogram","title":"Histogram","text":"<p>monitor distributions, like latencies or request sizes.</p> <p>\u6bcf\u4e2a\u6876\u4e2d\u7d2f\u79ef\u503c\u7684\u6570\u91cf\uff0cbucket \u53ef\u4ee5\u914d\u7f6e\uff0c\u5f62\u6210\u67f1\u72b6\u56fe\u3002</p> <p>\u5982\u679c\u9700\u8981\u8ba1\u7b97 \u03c6-quantiles\uff0c\u9700\u8981\u5728server\u7aef\u901a\u8fc7histogram_quantile()\u51fd\u6570\u5b9e\u73b0\u3002</p>"},{"location":"web/backend/metrics.html#labels","title":"Labels","text":"<p>\u6240\u6709\u7684\u6307\u6807\u53ef\u4ee5\u6709\u6807\u7b7e\uff0c\u8fdb\u884c\u7ec4\u5408\u3002</p> <pre><code>class YourClass {\n  static final Counter requests = Counter.build()\n     .name(\"my_library_requests_total\").help(\"Total requests.\")\n     .labelNames(\"method\").register();\n\n  void processGetRequest() {\n    requests.labels(\"get\").inc();\n    // Your code here.\n  }\n}\n</code></pre>"},{"location":"web/backend/metrics.html#_4","title":"\u6307\u6807\u6ce8\u518c","text":"<p>\u63a8\u8350\u4f7f\u7528\u9759\u6001\u53d8\u91cf\u7684\u65b9\u5f0f\u8fdb\u884c\u6ce8\u518c\uff08\u6709\u5168\u5c40\u7684\u9ed8\u8ba4registry\uff09\u3002</p> <pre><code>static final Counter requests = Counter.build()\n   .name(\"my_library_requests_total\").help(\"Total requests.\").labelNames(\"path\").register();\n</code></pre>"},{"location":"web/backend/metrics.html#exemplars","title":"Exemplars","text":"<p>supported for <code>Counter</code> and <code>Histogram</code></p> <p>OpenMetrics \u683c\u5f0f\u7279\u6027\uff0c\u5141\u8bb8\u5c06 metrics \u8ddf traces \u5173\u8054\u3002</p> <p>DefaultExemplarSampler \u5185\u7f6e\u652f\u6301 OpenTelemetry tracing</p>"},{"location":"web/backend/metrics.html#collectors","title":"Collectors","text":"<p>\u9ed8\u8ba4\u5305\u542b GC\uff0c\u5185\u5b58\u6c60\uff0c\u7c7b\u52a0\u8f7d\u548c\u7ebf\u7a0b\u6570\u91cf\u7684\u6307\u6807\u3002</p> <pre><code>DefaultExports.initialize();\n</code></pre>"},{"location":"web/backend/metrics.html#logging","title":"Logging","text":"<p>logging collectors for log4j, log4j2 and logback.</p>"},{"location":"web/backend/metrics.html#caches","title":"Caches","text":"<p>Guava/Caffeine  cache collector</p>"},{"location":"web/backend/metrics.html#hibernate","title":"Hibernate","text":""},{"location":"web/backend/metrics.html#jetty","title":"Jetty","text":""},{"location":"web/backend/metrics.html#servlet-filter","title":"Servlet Filter","text":""},{"location":"web/backend/metrics.html#spring-aop","title":"Spring AOP","text":"<p>add <code>simpleclient_spring_web</code> as a dependency, annotate a configuration class with <code>@EnablePrometheusTiming</code>, then annotate your Spring components as such:</p> <pre><code>@Controller\npublic class MyController {\n  @RequestMapping(\"/\")\n  @PrometheusTimeMethod(name = \"my_controller_path_duration_seconds\", help = \"Some helpful info here\")\n  public Object handleMain() {\n    // Do something\n  }\n}\n</code></pre>"},{"location":"web/backend/metrics.html#dropwizardexports-collector","title":"DropwizardExports Collector","text":"<p>\u5c06 Dropwizard \u7684\u6307\u6807\uff0c\u8f6c\u6362\u6210 prometheus \u7684\u6307\u6807\u3002</p> <pre><code>// Dropwizard MetricRegistry\nMetricRegistry metricRegistry = new MetricRegistry();\nnew DropwizardExports(metricRegistry).register();\n</code></pre> <ul> <li>\u5c06\u4e0d\u652f\u6301\u7684\u5b57\u7b26\uff0c\u8f6c\u6362\u4e3a\"_\"\uff0c\u5982</li> </ul> <pre><code>Dropwizard metric name:\norg.company.controller.save.status.400\nPrometheus metric:\norg_company_controller_save_status_400\n</code></pre>"},{"location":"web/backend/metrics.html#exporting","title":"Exporting","text":""},{"location":"web/backend/metrics.html#http","title":"HTTP","text":"<p>client library \u4e2d\uff0c\u63d0\u4f9b<code>HTTP</code>, <code>Servlet</code>, <code>SpringBoot</code>, <code>Vert.x</code> \u96c6\u6210\u3002</p> <pre><code>HTTPServer server = new HTTPServer.Builder()\n    .withPort(1234)\n    .build();\n</code></pre>"},{"location":"web/backend/mqtt.html","title":"Mqtt","text":""},{"location":"web/backend/mqtt.html#_1","title":"\u4f7f\u7528","text":"<p>MqttClient VS MqttClient</p> <ul> <li>The Async version will connect and publish without blocking\uff1b</li> <li>The message processing in CallBack or Listener is synchronous\uff1b</li> </ul> <p><code>maven</code></p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.eclipse.paho&lt;/groupId&gt;\n    &lt;artifactId&gt;org.eclipse.paho.client.mqttv3&lt;/artifactId&gt;\n    &lt;version&gt;1.2.5&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u8ba2\u9605</p> <pre><code>MqttConnectOptions connOpt = new MqttConnectOptions();\nconnOpt.setCleanSession(true);\nconnOpt.setKeepAliveInterval(30);\nString serverUri = \"tcp://iot.eclipse.org:1883\";\nString clientId = UUID.randomUUID().toString();\n\nMqttClient myClient = new MqttClient(serverUri, clientId);\nmyClient.connect(connOpt);\nmyClient.subscribe(\"topic/foo\");\nmyClient.setCallback(new FooCallbackListener());\n</code></pre> <p>\u5bf9\u4e8e\u8ba2\u9605\u6d88\u606f\u4e24\u79cd\u5904\u7406\u65b9\u5f0f\uff1a</p> <pre><code>// default\uff0c\u5904\u7406 messageArrived \u4ee5\u53ca connectionLost \u7b49\nvoid setCallback(MqttCallback callback);\n\n// \u9488\u5bf9\u6bcf\u4e2a\u4e3b\u9898\uff0c\u53ea\u5904\u7406 messageArrived\nvoid subscribe(String topicFilter, int qos, IMqttMessageListener messageListener) throws MqttException;\n</code></pre> <p>\u6e90\u7801\uff1a<code>CommsCallback.java</code></p> <pre><code>protected boolean deliverMessage(String topicName, int messageId, MqttMessage aMessage) throws Exception\n{       \n    boolean delivered = false;\n\n    Enumeration&lt;String&gt; keys = callbacks.keys();\n    while (keys.hasMoreElements()) {\n        String topicFilter = (String)keys.nextElement();\n        // callback may already have been removed in the meantime, so a null check is necessary\n        IMqttMessageListener callback = callbacks.get(topicFilter);\n        if(callback == null) {\n            continue;\n        }\n        if (MqttTopic.isMatched(topicFilter, topicName)) {\n            aMessage.setId(messageId);\n            ((IMqttMessageListener)callback).messageArrived(topicName, aMessage);\n            delivered = true;\n        }\n    }\n\n    /* if the message hasn't been delivered to a per subscription handler, give it to the default handler */\n    if (mqttCallback != null &amp;&amp; !delivered) {\n        aMessage.setId(messageId);\n        mqttCallback.messageArrived(topicName, aMessage);\n        delivered = true;\n    }\n\n    return delivered;\n}\n</code></pre>"},{"location":"web/backend/rule_engine.html","title":"\u89c4\u5219\u5f15\u64ce","text":""},{"location":"web/backend/rule_engine.html#groovy","title":"Groovy","text":"<p>\u57fa\u4e8eJVM\u7684\u52a8\u6001\u8bed\u8a00\uff0c\u8ddfJava\u65e0\u7f1d\u517c\u5bb9\u3002</p>"},{"location":"web/backend/rule_engine.html#drools","title":"Drools","text":"<p>\u57fa\u4e8eJava\u7684\u5f00\u6e90\u89c4\u5219\u5f15\u64ce\uff0c\u5c06\u89c4\u5219\u4e0e\u4e1a\u52a1\u4ee3\u7801\u89e3\u8026\u3002\u89c4\u5219\u4ee5\u811a\u672c\u7684\u5f62\u5f0f\u5b58\u50a8\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u4f7f\u89c4\u5219\u7684\u53d8\u5316\u4e0d\u9700\u8981\u4fee\u6539\u4ee3\u7801\uff0c\u91cd\u65b0\u542f\u52a8\u673a\u5668\u5373\u53ef\u5728\u7ebf\u4e0a\u73af\u5883\u4e2d\u751f\u6548\u3002</p>"},{"location":"web/backend/rule_engine.html#_2","title":"\u8bed\u6cd5","text":"<p><code>drl</code>\u6587\u4ef6</p> <ul> <li>package\uff1a\u5305\u540d\uff0c\u53ea\u9650\u4e8e\u903b\u8f91\u4e0a\u7684\u7ba1\u7406\uff0c\u82e5\u81ea\u5b9a\u4e49\u7684\u67e5\u8be2\u6216\u51fd\u6570\u4f4d\u4e8e\u540c\u4e00\u5305\u540d\uff0c\u4e0d\u7ba1\u7269\u7406\u4f4d\u7f6e\u5982\u4f55\uff0c\u90fd\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u3002</li> <li>import\uff1a\u89c4\u5219\u5f15\u7528\u95ee\u9898\uff0c\u5bfc\u5165\u7c7b\u6216\u9759\u6001\u65b9\u6cd5\u3002</li> <li>global\uff1a\u5168\u5c40\u53d8\u91cf\uff0c\u4f7f\u7528\u65f6\u9700\u8981\u5355\u72ec\u5b9a\u4e49\u53d8\u91cf\u7c7b\u578b</li> <li>function\uff1a\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3aJava\u9759\u6001\u65b9\u6cd5\u7684\u4e00\u79cd\u53d8\u5f62\uff0c\u4e0eJavaScript\u51fd\u6570\u5b9a\u4e49\u76f8\u4f3c\u3002</li> <li>queried\uff1a\u67e5\u8be2\u3002</li> <li>rule  end\uff1a\u89c4\u5219\u5185\u5bb9\u4e2d\u7684\u89c4\u5219\u4f53\uff0c\u662f\u8fdb\u884c\u4e1a\u52a1\u89c4\u5219\u5224\u65ad\u3001\u5904\u7406\u4e1a\u52a1\u7ed3\u679c\u7684\u90e8\u5206\u3002</li> </ul>"},{"location":"web/backend/rule_engine.html#_3","title":"\u89c4\u5219\u4f53","text":"<pre><code>rule \"name\"\nattributes\n    when\n        LHS(\u6761\u4ef6\u90e8\u5206)\n    Then\n        RHS\uff08\u7ed3\u679c\u90e8\u5206)\nend\n</code></pre> <ul> <li>rule\uff1a\u89c4\u5219\u5f00\u59cb\uff0c\u53c2\u6570\u662f\u89c4\u5219\u7684\u552f\u4e00\u540d\u79f0</li> <li>attributes\uff1a\u89c4\u5219\u5c5e\u6027\uff0c\u662frule\u4e0ewhen\u4e4b\u95f4\u7684\u53c2\u6570\uff0c\u4e3a\u53ef\u9009\u9879</li> <li>when\uff1a\u89c4\u5219\u6761\u4ef6\u90e8\u5206\uff0c\u9ed8\u8ba4\u4e3atrue</li> <li>then\uff1a\u89c4\u5219\u7ed3\u679c\u90e8\u5206</li> <li>end\uff1a\u5f53\u524d\u89c4\u5219\u7ed3\u675f</li> </ul>"},{"location":"web/backend/rule_engine.html#fact","title":"Fact\u5bf9\u8c61","text":"<p>Fact \u662f\u6307\u5728Drools \u89c4\u5219\u5e94\u7528\u5f53\u4e2d\uff0c\u5c06\u4e00\u4e2a\u666e\u901a\u7684JavaBean \u63d2\u5165\u5230\u89c4\u5219\u7684WorkingMemory\u5f53\u4e2d\u540e\u7684\u5bf9\u8c61\u3002</p>"},{"location":"web/backend/satoken.html","title":"SaToken","text":""},{"location":"web/backend/satoken.html#java-rbac","title":"\u8f7b\u91cf\u7ea7 Java \u6743\u9650\u8ba4\u8bc1\u6846\u67b6\uff0c\u57fa\u4e8e RBAC \u6743\u9650\u6a21\u578b\u3002","text":"<p>\u4e3b\u8981\u89e3\u51b3\uff1a\u767b\u5f55\u8ba4\u8bc1\u3001\u6743\u9650\u8ba4\u8bc1\u3001\u5355\u70b9\u767b\u5f55\u3001OAuth2.0\u3001\u5206\u5e03\u5f0fSession\u4f1a\u8bdd\u3001\u5fae\u670d\u52a1\u7f51\u5173\u9274\u6743 \u7b49\u4e00\u7cfb\u5217\u6743\u9650\u76f8\u5173\u95ee\u9898</p>"},{"location":"web/backend/satoken.html#_1","title":"\u767b\u5f55\u4e0e\u6ce8\u9500","text":"<p>Sa-Token \u4e3a\u8fd9\u4e2a\u8d26\u53f7\u521b\u5efa\u4e86\u4e00\u4e2aToken\u51ed\u8bc1\uff0c\u4e14\u901a\u8fc7 Cookie \u4e0a\u4e0b\u6587\u8fd4\u56de\u7ed9\u4e86\u524d\u7aef\uff1a</p> <pre><code>// \u4f1a\u8bdd\u767b\u5f55\uff1a\u53c2\u6570\u586b\u5199\u8981\u767b\u5f55\u7684\u8d26\u53f7id\uff0c\u5efa\u8bae\u7684\u6570\u636e\u7c7b\u578b\uff1along | int | String\uff0c \u4e0d\u53ef\u4ee5\u4f20\u5165\u590d\u6742\u7c7b\u578b\uff0c\u5982\uff1aUser\u3001Admin \u7b49\u7b49\nStpUtil.login(Object id); \n// \u5f53\u524d\u4f1a\u8bdd\u6ce8\u9500\u767b\u5f55\nStpUtil.logout();\n\n// \u83b7\u53d6\u5f53\u524d\u4f1a\u8bdd\u8d26\u53f7id, \u5982\u679c\u672a\u767b\u5f55\uff0c\u5219\u629b\u51fa\u5f02\u5e38\uff1a`NotLoginException`\nStpUtil.getLoginId();\n</code></pre>"},{"location":"web/backend/satoken.html#_2","title":"\u591a\u8d26\u53f7\u8ba4\u8bc1","text":"<p>https://sa-token.dev33.cn/doc.html#/up/many-account</p> <p>\u5728\u4e00\u4e2a\u9879\u76ee\u4e2d\u8bbe\u8ba1\u4e24\u5957\u8d26\u53f7\u4f53\u7cfb\uff0c\u6bd4\u5982\u4e00\u4e2a\u7535\u5546\u7cfb\u7edf\u7684 <code>user\u8868</code> \u548c <code>admin\u8868</code>\uff1a</p> <ul> <li>\u590d\u5236\u53e6\u5199<code>StpUtil.java</code>\uff0c\u66f4\u6539\u5b57\u6bb5<code>LoginType</code>\uff1b</li> <li>\u5bf9<code>@SaCheckLogin</code>\uff08\u68c0\u9a8c\u662f\u5426\u767b\u5f55\uff09\u3001<code>@SaCheckRole</code>\u3001<code>@SaCheckPermission</code>\uff0c\u6307\u5b9a<code>type</code>\u4e3a\u4e0a\u9762\u4fee\u6539\u7684<code>LoginType</code>\uff1b</li> </ul>"},{"location":"web/backend/satoken.html#_3","title":"\u540c\u7aef\u591a\u767b\u9646","text":"<p>\u5047\u8bbe\u4e0d\u4ec5\u9700\u8981\u5728\u540e\u53f0\u540c\u65f6\u96c6\u6210\u4e24\u5957\u8d26\u53f7\uff0c\u8fd8\u9700\u8981\u5728\u4e00\u4e2a\u5ba2\u6237\u7aef\u540c\u65f6\u767b\u9646\u4e24\u5957\u8d26\u53f7\uff08\u4e1a\u52a1\u573a\u666f\u4e3e\u4f8b\uff1a\u4e00\u4e2aAPP\u4e2d\u53ef\u4ee5\u540c\u65f6\u767b\u9646\u5546\u5bb6\u8d26\u53f7\u548c\u7528\u6237\u8d26\u53f7\uff09\u3002\u5728\u5ba2\u6237\u7aef\u4f1a\u53d1\u751f<code>token\u8986\u76d6</code>\uff0c\u65b0\u767b\u5f55\u7684token\u4f1a\u8986\u76d6\u6389\u65e7\u767b\u5f55\u7684token\u4ece\u800c\u5bfc\u81f4\u65e7\u767b\u5f55\u5931\u6548\uff1b</p> <ul> <li>\u9488\u5bf9\u65b0\u5199\u7684<code>StpUserUtil</code>\uff0c\u91cd\u5199\u5176<code>TokenName</code>\uff1b</li> </ul> <pre><code>public class StpUserUtil {\n    // \u4f7f\u7528\u533f\u540d\u5b50\u7c7b \u91cd\u5199`stpLogic\u5bf9\u8c61`\u7684\u4e00\u4e9b\u65b9\u6cd5 \n    public static StpLogic stpLogic = new StpLogic(\"user\") {\n        // \u91cd\u5199 StpLogic \u7c7b\u4e0b\u7684 `splicingKeyTokenName` \u51fd\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a\u4e0e `StpUtil` \u4e0d\u540c\u7684token\u540d\u79f0, \u9632\u6b62\u51b2\u7a81 \n        @Override\n        public String splicingKeyTokenName() {\n            return super.splicingKeyTokenName() + \"-user\";\n        }\n        // \u540c\u7406\u4f60\u53ef\u4ee5\u6309\u9700\u91cd\u5199\u4e00\u4e9b\u5176\u5b83\u65b9\u6cd5 ... \n    }; \n    // ... \n}\n</code></pre>"},{"location":"web/backend/satoken.html#_4","title":"\u591a\u7c7b\u578b/\u8bbe\u5907\u767b\u5f55","text":"<p>\u5f3a\u5236\u6ce8\u9500 \u548c \u8e22\u4eba\u4e0b\u7ebf \u7684\u533a\u522b\u5728\u4e8e\uff1a</p> <ul> <li>\u5f3a\u5236\u6ce8\u9500\u7b49\u4ef7\u4e8e\u5bf9\u65b9\u4e3b\u52a8\u8c03\u7528\u4e86\u6ce8\u9500\u65b9\u6cd5\uff0c\u518d\u6b21\u8bbf\u95ee\u4f1a\u63d0\u793a\uff1aToken\u65e0\u6548\u3002</li> <li>\u8e22\u4eba\u4e0b\u7ebf\u4e0d\u4f1a\u6e05\u9664Token\u4fe1\u606f\uff0c\u800c\u662f\u5c06\u5176\u6253\u4e0a\u7279\u5b9a\u6807\u8bb0\uff0c\u518d\u6b21\u8bbf\u95ee\u4f1a\u63d0\u793a\uff1aToken\u5df2\u88ab\u8e22\u4e0b\u7ebf\u3002</li> </ul>"},{"location":"web/backend/satoken.html#_5","title":"\u8e22\u4eba\u4e0b\u7ebf","text":"<pre><code>StpUtil.kickout(10001);                    // \u5c06\u6307\u5b9a\u8d26\u53f7\u8e22\u4e0b\u7ebf \nStpUtil.kickout(10001, \"PC\");              // \u5c06\u6307\u5b9a\u8d26\u53f7\u6307\u5b9a\u7aef\u8e22\u4e0b\u7ebf\nStpUtil.kickoutByTokenValue(\"token\");      // \u5c06\u6307\u5b9a Token \u8e22\u4e0b\u7ebf\n</code></pre>"},{"location":"web/backend/satoken.html#_6","title":"\u5f3a\u5236\u6ce8\u9500","text":"<pre><code>// \u6307\u5b9a`\u8d26\u53f7id`\u548c`\u8bbe\u5907\u7c7b\u578b`\u8fdb\u884c\u5f3a\u5236\u6ce8\u9500 \nStpUtil.logout(10001, \"PC\");    \n</code></pre>"},{"location":"web/backend/satoken.html#_7","title":"\u540c\u8bbe\u5907\u4e92\u65a5\u767b\u5f55","text":"<p>\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5c06 <code>isConcurrent</code> \u914d\u7f6e\u4e3afalse\uff0c\u7136\u540e\u8c03\u7528\u767b\u5f55\u7b49\u76f8\u5173\u63a5\u53e3\u65f6\u58f0\u660e\u8bbe\u5907\u7c7b\u578b</p> <pre><code>// \u6307\u5b9a`\u8d26\u53f7id`\u548c`\u8bbe\u5907\u7c7b\u578b`\u8fdb\u884c\u767b\u5f55\nStpUtil.login(10001, \"PC\");    \n</code></pre> <p>\u8c03\u7528\u6b64\u65b9\u6cd5\u767b\u5f55\u540e\uff0c\u540c\u8bbe\u5907\u7684\u4f1a\u88ab\u9876\u4e0b\u7ebf\uff08\u4e0d\u540c\u8bbe\u5907\u4e0d\u53d7\u5f71\u54cd\uff09\uff0c\u518d\u6b21\u8bbf\u95ee\u7cfb\u7edf\u65f6\u4f1a\u629b\u51fa <code>NotLoginException</code> \u5f02\u5e38(\u573a\u666f\u503c=<code>-4</code>)</p>"},{"location":"web/backend/satoken.html#_8","title":"\u8d26\u53f7\u5c01\u7981","text":""},{"location":"web/backend/satoken.html#_9","title":"\u8d26\u53f7\u5c01\u7981","text":"<p>\u5bf9\u4e8e\u6b63\u5728\u767b\u5f55\u7684\u8d26\u53f7\uff0c\u5c06\u5176\u5c01\u7981\u5e76\u4e0d\u4f1a\u4f7f\u5b83\u7acb\u5373\u6389\u7ebf\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u5b83\u5373\u523b\u4e0b\u7ebf\uff0c\u53ef\u91c7\u7528\u5148\u8e22\u518d\u5c01\u7981\u7684\u7b56\u7565</p> <ul> <li>\u6821\u9a8c\u5c01\u7981 \u548c \u767b\u5f55\uff08<code>StpUtil.login</code>\uff09\u4e24\u4e2a\u52a8\u4f5c\u5206\u79bb\u6210\u4e24\u4e2a\u65b9\u6cd5\uff0c\u767b\u5f55\u65f6\u4e0d\u518d\u81ea\u52a8\u6821\u9a8c\u662f\u5426\u5c01\u7981</li> </ul> <pre><code>// \u5c01\u7981\u6307\u5b9a\u8d26\u53f71\u5929\u65f6\u95f4\uff0c-1\u8868\u793a\u6c38\u4e45\u5c01\u7981\nStpUtil.disable(10001, 86400); \n// \u6821\u9a8c\u6307\u5b9a\u8d26\u53f7\u662f\u5426\u5df2\u88ab\u5c01\u7981\uff0c\u5982\u679c\u88ab\u5c01\u7981\u5219\u629b\u51fa\u5f02\u5e38 `DisableServiceException`\nStpUtil.checkDisable(10001); \n// \u89e3\u9664\u5c01\u7981\nStpUtil.untieDisable(10001); \n</code></pre>"},{"location":"web/backend/satoken.html#_10","title":"\u5206\u7c7b\u5c01\u7981","text":"<p>\u53ea\u7981\u6b62\u5176\u8bbf\u95ee\u90e8\u5206\u670d\u52a1\uff0c\u5373\u7981\u6b62\u90e8\u5206\u63a5\u53e3\u7684\u8c03\u7528\u3002</p> <pre><code>// \u5c01\u7981\u6307\u5b9a \u7528\u6237 \u8bc4\u8bba \u80fd\u529b\uff0c\u671f\u9650\u4e3a 1\u5929\nStpUtil.disable(10001, \"comment\", 86400);\n\n// \u5728\u8bc4\u8bba\u63a5\u53e3\uff0c\u6821\u9a8c\u4e00\u4e0b\uff0c\u4f1a\u629b\u51fa\u5f02\u5e38\uff1a`DisableServiceException`\uff0c\u4f7f\u7528 e.getService() \u53ef\u83b7\u53d6\u4e1a\u52a1\u6807\u8bc6 `comment` \nStpUtil.checkDisable(10001, \"comment\");\n</code></pre>"},{"location":"web/backend/satoken.html#_11","title":"\u9636\u68af\u5c01\u7981","text":"<p>\u591a\u6b21\u8fdd\u89c4\uff0c\u5c01\u7981\u65f6\u95f4\u4e0d\u4e00\u6837\uff0c\u6216\u8005\u4e0d\u540c\u7684\u8fdd\u89c4\u884c\u4e3a\uff0c\u5904\u7f5a\u529b\u5ea6\u4e0d\u4e00\u6837\uff1a</p> <pre><code>// \u9636\u68af\u5c01\u7981\uff0c\u53c2\u6570\uff1a\u5c01\u7981\u8d26\u53f7\u3001\u5c01\u7981\u7ea7\u522b\u3001\u5c01\u7981\u65f6\u95f4 \nStpUtil.disableLevel(10001, 3, 10000);\n\n// \u83b7\u53d6\uff1a\u6307\u5b9a\u8d26\u53f7\u5c01\u7981\u7684\u7ea7\u522b \uff08\u5982\u679c\u6b64\u8d26\u53f7\u672a\u88ab\u5c01\u7981\u5219\u8fd4\u56de -2\uff09\nStpUtil.getDisableLevel(10001);\n\n// \u5224\u65ad\uff1a\u6307\u5b9a\u8d26\u53f7\u662f\u5426\u5df2\u88ab\u5c01\u7981\u5230\u6307\u5b9a\u7ea7\u522b\uff0c\u8fd4\u56de true \u6216 false\nStpUtil.isDisableLevel(10001, 3);\n\n// \u6821\u9a8c\uff1a\u6307\u5b9a\u8d26\u53f7\u662f\u5426\u5df2\u88ab\u5c01\u7981\u5230\u6307\u5b9a\u7ea7\u522b\uff0c\u5982\u679c\u5df2\u8fbe\u5230\u6b64\u7ea7\u522b\uff08\u4f8b\u5982\u5df2\u88ab3\u7ea7\u5c01\u7981\uff0c\u8fd9\u91cc\u6821\u9a8c\u662f\u5426\u8fbe\u52302\u7ea7\uff09\uff0c\u5219\u629b\u51fa\u5f02\u5e38 `DisableServiceException`\nStpUtil.checkDisableLevel(10001, 2);\n</code></pre>"},{"location":"web/backend/satoken.html#cookie","title":"\u65e0Cookie\u6a21\u5f0f","text":"<p>\u65e0 Cookie \u6a21\u5f0f\uff1a\u7279\u6307\u4e0d\u652f\u6301 Cookie \u529f\u80fd\u7684\u7ec8\u7aef\uff0c\u901a\u4fd7\u6765\u8bb2\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684 \u2014\u2014 \u524d\u540e\u53f0\u5206\u79bb\u6a21\u5f0f\uff0c\u5982app\u3001\u5c0f\u7a0b\u5e8f\u3002</p> <ul> <li>\u652f\u6301\u914d\u7f6e\u4ece<code>body</code>\u3001<code>header</code>\u3001<code>cookie</code>\u4e2d\u83b7\u53d6 token value\uff1b</li> </ul> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li>\u4e0d\u80fd\u540e\u7aef\u63a7\u5236\u5199\u5165\u4e86\uff0c\u5c31\u524d\u7aef\u81ea\u5df1\u5199\u5165\u3002\uff08\u96be\u70b9\u5728\u540e\u7aef\u5982\u4f55\u5c06 Token \u4f20\u9012\u5230\u524d\u7aef\uff09</li> <li>\u6bcf\u6b21\u8bf7\u6c42\u4e0d\u80fd\u81ea\u52a8\u63d0\u4ea4\u4e86\uff0c\u90a3\u5c31\u624b\u52a8\u63d0\u4ea4\u3002\uff08\u96be\u70b9\u5728\u524d\u7aef\u5982\u4f55\u5c06 Token \u4f20\u9012\u5230\u540e\u7aef\uff0c\u540c\u65f6\u540e\u7aef\u5c06\u5176\u8bfb\u53d6\u51fa\u6765\uff09</li> </ul>"},{"location":"web/backend/satoken.html#token","title":"\u540e\u7aef\u5982\u4f55\u5c06 Token \u4f20\u9012\u5230\u524d\u7aef","text":"<ol> <li>\u8c03\u7528 <code>StpUtil.login(id)</code> \u8fdb\u884c\u767b\u5f55\u3002</li> <li>\u8c03\u7528 <code>StpUtil.getTokenInfo()</code> \u8fd4\u56de\u5f53\u524d\u4f1a\u8bdd\u7684 token \u8be6\u7ec6\u53c2\u6570\uff0c\u524d\u7aef\u4eba\u5458\u5c06<code>tokenName</code>\u548c<code>tokenValue</code>\u8fd9\u4e24\u4e2a\u503c\u4fdd\u5b58\u5230\u672c\u5730\u3002</li> </ol>"},{"location":"web/backend/satoken.html#token_1","title":"\u524d\u7aef\u5c06 token \u63d0\u4ea4\u5230\u540e\u7aef","text":"<p>\u5c06 token \u585e\u5230\u8bf7\u6c42<code>header</code>\u91cc \uff0c\u683c\u5f0f\u4e3a\uff1a<code>{tokenName: tokenValue}</code>\uff1a</p> <ul> <li>\u4f7f\u7528 \u7edf\u4e00\u62e6\u622a\u5668\uff0c\u6ce8\u5165\u8be5header\u5b57\u6bb5\uff1b</li> </ul>"},{"location":"web/backend/satoken.html#_12","title":"\u6a21\u62df\u4ed6\u4eba\u548c\u8eab\u4efd\u5207\u6362","text":""},{"location":"web/backend/satoken.html#api","title":"\u64cd\u4f5c\u5176\u5b83\u8d26\u53f7\u7684api","text":"<p><code>StpUtil</code>\u63d0\u4f9b\u4e00\u7cfb\u5217\u65b9\u6cd5\u6307\u5b9a loginId \u8fdb\u884c\u64cd\u4f5c\u3002</p> <pre><code>// \u83b7\u53d6\u6307\u5b9a\u8d26\u53f710001\u7684`tokenValue`\u503c \nStpUtil.getTokenValueByLoginId(10001);\n</code></pre>"},{"location":"web/backend/satoken.html#_13","title":"\u4e34\u65f6\u8eab\u4efd\u5207\u6362","text":"<pre><code>// \u5c06\u5f53\u524d\u4f1a\u8bdd[\u8eab\u4efd\u4e34\u65f6\u5207\u6362]\u4e3a\u5176\u5b83\u8d26\u53f7\uff08\u672c\u6b21\u8bf7\u6c42\u5185\u6709\u6548\uff09\nStpUtil.switchTo(10044);\n\n// \u6b64\u65f6\u518d\u8c03\u7528\u6b64\u65b9\u6cd5\u4f1a\u8fd4\u56de 10044 (\u6211\u4eec\u4e34\u65f6\u5207\u6362\u5230\u7684\u8d26\u53f7id)\nStpUtil.getLoginId();\n\n// \u7ed3\u675f [\u8eab\u4efd\u4e34\u65f6\u5207\u6362]\nStpUtil.endSwitch();\n</code></pre>"},{"location":"web/backend/satoken.html#token_2","title":"\u4e34\u65f6Token\u4ee4\u724c\u8ba4\u8bc1","text":"<p>[sa-token-temp\u4e34\u65f6\u8ba4\u8bc1\u6a21\u5757] \u5df2\u5185\u5d4c\u5230\u6838\u5fc3\u5305\uff0c\u65e0\u9700\u5f15\u5165\u5176\u5b83\u4f9d\u8d56\u5373\u53ef\u4f7f\u7528</p> <ul> <li>SaTempUtil \u521b\u5efa\u4e34\u65f6token\u540e\u767b\u9646\u7684\u7528\u6237id\u4e0eSaToken\u6846\u67b6\u4e2dStpUtil\u767b\u9646\u7684\u7528\u6237id\u5e76\u4e0d\u5173\u8054\uff0c\u4e24\u8005\u76f8\u4e92\u72ec\u7acb\u540c\u65f6\u5b58\u5728</li> </ul> <pre><code>// \u6839\u636e value \u521b\u5efa\u4e00\u4e2a token \nString token = SaTempUtil.createToken(\"10014\", 200);\n\n// \u89e3\u6790 token \u83b7\u53d6 value\uff0c\u5e76\u8f6c\u6362\u4e3a\u6307\u5b9a\u7c7b\u578b \nString value = SaTempUtil.parseToken(token, String.class);\n\n// \u83b7\u53d6\u6307\u5b9a token \u7684\u5269\u4f59\u6709\u6548\u671f\uff0c\u5355\u4f4d\uff1a\u79d2 \nSaTempUtil.getTimeout(token);\n\n// \u5220\u9664\u6307\u5b9a token\nSaTempUtil.deleteToken(token);\n</code></pre>"},{"location":"web/backend/satoken.html#_14","title":"\u6570\u636e\u5b58\u50a8","text":"<p>Sa-Token \u6570\u636e\u5b58\u50a8\u6709\u4e09\u5927\u4f5c\u7528\u57df\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li><code>SaStorage</code> - \u8bf7\u6c42\u4f5c\u7528\u57df\uff1a\u5b58\u50a8\u7684\u6570\u636e\u53ea\u5728\u4e00\u6b21\u8bf7\u6c42\u5185\u6709\u6548\uff0c\u65e0\u9700\u5904\u4e8e\u767b\u5f55\u72b6\u6001\uff1b</li> <li><code>SaSession</code> - \u4f1a\u8bdd\u4f5c\u7528\u57df\uff1a\u5b58\u50a8\u7684\u6570\u636e\u5728\u4e00\u6b21\u4f1a\u8bdd\u8303\u56f4\u5185\u6709\u6548\uff0c\u5fc5\u987b\u767b\u5f55\u540e\uff1b</li> <li><code>SaApplication</code> - \u5168\u5c40\u4f5c\u7528\u57df\uff1a\u5b58\u50a8\u7684\u6570\u636e\u5728\u5168\u5c40\u8303\u56f4\u5185\u6709\u6548\uff0c\u65e0\u9700\u5904\u4e8e\u767b\u5f55\u72b6\u6001\u3002</li> <li>\u5728 SaApplication \u5b58\u50a8\u7684\u6570\u636e\u5728\u5168\u5c40\u8303\u56f4\u5185\u6709\u6548\uff0c\u5e94\u7528\u5173\u95ed\u540e\u6570\u636e\u81ea\u52a8\u6e05\u9664\uff08\u5982\u679c\u96c6\u6210\u4e86 Redis \u90a3\u5219\u662f Redis \u5173\u95ed\u540e\u6570\u636e\u81ea\u52a8\u6e05\u9664\uff09\u3002</li> </ul> <pre><code>SaStorage storage = SaHolder.getStorage();\nSaSession session = StpUtil.getSession();\nSaApplication application = SaHolder.getApplication();\n</code></pre>"},{"location":"web/backend/satoken.html#sastorage","title":"SaStorage","text":"<p>\u5728 SaStorage \u4e2d\u5b58\u50a8\u7684\u6570\u636e\u53ea\u5728\u4e00\u6b21\u8bf7\u6c42\u8303\u56f4\u5185\u6709\u6548\uff0c\u8bf7\u6c42\u7ed3\u675f\u540e\u6570\u636e\u81ea\u52a8\u6e05\u9664\u3002\u4f7f\u7528 SaStorage \u65f6\u65e0\u9700\u5904\u4e8e\u767b\u5f55\u72b6\u6001\uff1a</p> <ul> <li>\u901a\u8fc7 HttpServletRequest \u7684 <code>get/set</code>\u65b9\u6cd5\uff1b</li> </ul>"},{"location":"web/backend/satoken.html#session","title":"Session\u4f1a\u8bdd","text":"<p>Session\u662f\u4f1a\u8bdd\u4e2d\u4e13\u4e1a\u7684\u6570\u636e\u7f13\u5b58\u7ec4\u4ef6\uff0c\u901a\u8fc7 Session \u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u7f13\u5b58\u4e00\u4e9b\u9ad8\u9891\u8bfb\u5199\u6570\u636e\uff0c\u63d0\u9ad8\u7a0b\u5e8f\u6027\u80fd\uff0c\u4f8b\u5982\uff1a</p> <pre><code>// \u5728\u767b\u5f55\u65f6\u7f13\u5b58user\u5bf9\u8c61 \nStpUtil.getSession().set(\"user\", user);\n\n// \u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4efb\u610f\u5904\u4f7f\u7528\u8fd9\u4e2auser\u5bf9\u8c61\nSysUser user = (SysUser) StpUtil.getSession().get(\"user\");\n</code></pre> <p>\u5728 Sa-Token \u4e2d\uff0cSession \u5206\u4e3a\u4e09\u79cd\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li><code>User-Session</code>: \u6307\u7684\u662f\u6846\u67b6\u4e3a\u6bcf\u4e2a \u8d26\u53f7id \u5206\u914d\u7684 Session</li> <li><code>Token-Session</code>: \u6307\u7684\u662f\u6846\u67b6\u4e3a\u6bcf\u4e2a token \u5206\u914d\u7684 Session</li> <li><code>Custom-Session</code>: \u6307\u7684\u662f\u4ee5\u4e00\u4e2a \u7279\u5b9a\u7684\u503c \u4f5c\u4e3aSessionId\uff0c\u6765\u5206\u914d\u7684 Session</li> </ul> <p>session\u7684\u64cd\u4f5c</p> <pre><code>session.get(\"name\");\nsession.set(\"name\", \"zhang\"); \n// \u8fd4\u56de\u6b64 Session \u4f1a\u8bdd\u4e0a\u7684\u5e95\u5c42\u6570\u636e\u5bf9\u8c61\uff08\u5982\u679c\u66f4\u65b0map\u91cc\u7684\u503c\uff0c\u8bf7\u8c03\u7528session.update()\u65b9\u6cd5\u907f\u514d\u4ea7\u751f\u810f\u6570\u636e\uff09\nsession.getDataMap();   \n// \u5c06\u8fd9\u4e2a Session \u4ece\u6301\u4e45\u5e93\u66f4\u65b0\u4e00\u4e0b\nsession.update();  \n// \u6ce8\u9500\u6b64 Session \u4f1a\u8bdd (\u4ece\u6301\u4e45\u5e93\u5220\u9664\u6b64Session)\nsession.logout();      \n</code></pre>"},{"location":"web/backend/satoken.html#http-session","title":"\u4e0eHTTP Session\u533a\u522b","text":"<p>SaSession \u4e0e HttpSession \u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\uff0c\u5728<code>HttpSession</code>\u4e0a\u5199\u5165\u7684\u503c\uff0c\u5728<code>SaSession</code>\u4e2d\u65e0\u6cd5\u53d6\u51fa</p> <p>Servlet HttpSession\u7684\u539f\u7406\uff1a\u7531\u76f8\u5e94\u7684 Servlet Container \u5b9e\u73b0\uff08\u5982 Tomcat\u7b49\uff09</p> <ul> <li>\u5ba2\u6237\u7aef\u6bcf\u6b21\u4e0e\u670d\u52a1\u5668\u7b2c\u4e00\u6b21\u63e1\u624b\u65f6\uff0c\u4f1a\u88ab\u5f3a\u5236\u5206\u914d\u4e00\u4e2a <code>[\u552f\u4e00id]</code> \u4f5c\u4e3a\u8eab\u4efd\u6807\u8bc6\uff0c\u6ce8\u5165\u5230 Cookie \u4e4b\u4e2d\uff0c \u4e4b\u540e\u6bcf\u6b21\u53d1\u8d77\u8bf7\u6c42\u65f6\uff0c\u5ba2\u6237\u7aef\u90fd\u8981\u5c06\u5b83\u63d0\u4ea4\u5230\u540e\u53f0\uff0c\u670d\u52a1\u5668\u6839\u636e <code>[\u552f\u4e00id]</code> \u627e\u5230\u6bcf\u4e2a\u8bf7\u6c42\u4e13\u5c5e\u7684Session\u5bf9\u8c61\uff0c\u7ef4\u6301\u4f1a\u8bdd\uff1b</li> </ul> <p>Servlet HttpSession\u7684\u7f3a\u70b9\uff1a</p> <ul> <li>\u540c\u4e00\u8d26\u53f7\u5206\u522b\u5728PC\u3001APP\u767b\u5f55\uff0c\u4f1a\u88ab\u8bc6\u522b\u4e3a\u4e24\u4e2a\u4e0d\u76f8\u5e72\u7684\u4f1a\u8bdd</li> <li>\u4e00\u4e2a\u8bbe\u5907\u96be\u4ee5\u540c\u65f6\u767b\u5f55\u4e24\u4e2a\u8d26\u53f7</li> <li>\u6bcf\u6b21\u4e00\u4e2a\u65b0\u7684\u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\u5668\u65f6\uff0c\u90fd\u4f1a\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684Session\u5bf9\u8c61\uff0c\u5373\u4f7f\u8fd9\u4e2a\u5ba2\u6237\u7aef\u53ea\u8bbf\u95ee\u4e86\u4e00\u6b21\u9875\u9762</li> <li>\u5728\u4e0d\u652f\u6301Cookie\u7684\u5ba2\u6237\u7aef\u4e0b\uff0c\u8fd9\u79cd\u673a\u5236\u4f1a\u5931\u6548</li> </ul> <p>\u4e3a\u8d26\u53f7id\u5206\u914d\u7684Session\uff0c\u53eb\u505a <code>User-Session</code></p> <p>Sa-Token Session\u53ef\u4ee5\u7406\u89e3\u4e3a HttpSession \u7684\u5347\u7ea7\u7248\uff1a</p> <ul> <li>\u53ea\u5728\u8c03\u7528<code>StpUtil.login(id)</code>\u767b\u5f55\u4f1a\u8bdd\u65f6\u624d\u4f1a\u4ea7\u751fSession\uff0c\u8282\u7701\u6027\u80fd</li> <li>Session \u662f\u5206\u914d\u7ed9\u8d26\u53f7id\u7684\uff0c\u800c\u4e0d\u662f\u5206\u914d\u7ed9\u6307\u5b9a\u5ba2\u6237\u7aef\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728PC\u3001APP\u4e0a\u767b\u5f55\u7684\u540c\u4e00\u8d26\u53f7\u6240\u5f97\u5230\u7684Session\u4e5f\u662f\u540c\u4e00\u4e2a\uff1b</li> <li>Sa-Token\u652f\u6301Cookie\u3001Header\u3001body\u4e09\u4e2a\u9014\u5f84\u63d0\u4ea4Token</li> <li>\u505a\u5230\u4e00\u4e2a\u5ba2\u6237\u7aef\u540c\u65f6\u767b\u5f55\u591a\u4e2a\u8d26\u53f7</li> </ul> <p>\u4f1a\u9047\u5230\u4e00\u4e9b\u9700\u8981\u6570\u636e\u9694\u79bb\u7684\u573a\u666f\uff1a</p> <p>\u6307\u5b9a\u5ba2\u6237\u7aef\u8d85\u8fc7\u4e24\u5c0f\u65f6\u65e0\u64cd\u4f5c\u5c31\u81ea\u52a8\u4e0b\u7ebf\uff0c\u5982\u679c\u4e24\u5c0f\u65f6\u5185\u6709\u64cd\u4f5c\uff0c\u5c31\u518d\u7eed\u671f\u4e24\u5c0f\u65f6\uff0c\u76f4\u5230\u65b0\u7684\u4e24\u5c0f\u65f6\u65e0\u64cd\u4f5c\u3002</p> <ul> <li>\u653e\u5728 User-Session\uff0c\u5219\u7528\u6237\u5728PC\u7aef\u4e00\u76f4\u65e0\u64cd\u4f5c\uff0c\u53ea\u8981\u624b\u673a\u4e0a\u7528\u6237\u8fd8\u5728\u4e0d\u95f4\u65ad\u7684\u64cd\u4f5c\uff0c\u90a3PC\u7aef\u4e5f\u4e0d\u4f1a\u8fc7\u671f\uff01</li> </ul> <p>Sa-Token\u9488\u5bf9\u4f1a\u8bdd\u767b\u5f55\uff0c\u4e0d\u4ec5\u4e3a\u8d26\u53f7id\u5206\u914d\u4e86<code>User-Session</code>\uff0c\u540c\u65f6\u8fd8\u4e3a\u6bcf\u4e2atoken\u5206\u914d\u4e86\u4e0d\u540c\u7684<code>Token-Session</code></p> <ul> <li>\u867d\u7136\u4e24\u4e2a\u8bbe\u5907\u767b\u5f55\u7684\u662f\u540c\u4e00\u8d26\u53f7\uff0c\u4f46\u662f\u4e24\u4e2a\u5b83\u4eec\u5f97\u5230\u7684token\u662f\u4e0d\u4e00\u6837</li> </ul>"},{"location":"web/backend/satoken.html#user-session","title":"User-Session","text":"<pre><code>// \u83b7\u53d6\u5f53\u524d\u8d26\u53f7id\u7684Session (\u5fc5\u987b\u662f\u767b\u5f55\u540e\u624d\u80fd\u8c03\u7528)\nStpUtil.getSession();\n// \u83b7\u53d6\u8d26\u53f7id\u4e3a10001\u7684Session\nStpUtil.getSessionByLoginId(10001);\n</code></pre>"},{"location":"web/backend/satoken.html#token-session","title":"Token Session","text":"<p>\u9ed8\u8ba4\u573a\u666f\u4e0b\uff0c\u53ea\u6709\u767b\u5f55\u540e\u624d\u80fd\u83b7\u53d6\uff0c\u5728\u672a\u767b\u5f55\u573a\u666f\u4e0b\u83b7\u53d6 Token-Session \uff0c\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a</p> <p>\u65b9\u6cd5\u4e00\uff1a\u5c06\u5168\u5c40\u914d\u7f6e\u9879 tokenSessionCheckLogin \u6539\u4e3a false\uff1b \u65b9\u6cd5\u4e8c\uff1a\u4f7f\u7528\u533f\u540d Token-Session\uff1b</p> <pre><code>// \u83b7\u53d6\u5f53\u524d Token \u7684 Token-Session \u5bf9\u8c61\nStpUtil.getTokenSession();\n// \u83b7\u53d6\u6307\u5b9a Token \u7684 Token-Session \u5bf9\u8c61\nStpUtil.getTokenSessionByToken(token);\n// \u83b7\u53d6\u5f53\u524d Token \u7684\u533f\u540d Token-Session \uff08\u53ef\u5728\u672a\u767b\u5f55\u60c5\u51b5\u4e0b\u4f7f\u7528\u7684 Token-Session\uff09\nStpUtil.getAnonTokenSession();\n</code></pre>"},{"location":"web/backend/satoken.html#session_1","title":"\u81ea\u5b9a\u4e49Session","text":"<p>\u4ee5\u4e00\u4e2a<code>\u7279\u5b9a\u7684\u503c</code>\u4f5c\u4e3aSessionId\u6765\u5206\u914d\u7684<code>Session</code></p> <pre><code>// \u67e5\u8be2\u6307\u5b9akey\u7684Session\u662f\u5426\u5b58\u5728\nSaSessionCustomUtil.isExists(\"goods-10001\");\n// \u83b7\u53d6\u6307\u5b9akey\u7684Session\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5219\u65b0\u5efa\u5e76\u8fd4\u56de\nSaSessionCustomUtil.getSessionById(\"goods-10001\");\n// \u5220\u9664\u6307\u5b9akey\u7684Session\nSaSessionCustomUtil.deleteSessionById(\"goods-10001\");\n</code></pre>"},{"location":"web/backend/satoken.html#session_2","title":"\u5206\u5e03\u5f0fSession","text":"<p>Sa-Token \u9ed8\u8ba4\u5c06\u6570\u636e\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u4f46\u91cd\u542f\u540e\u6570\u636e\u4f1a\u4e22\u5931\uff0c\u4e14\u65e0\u6cd5\u5728\u5206\u5e03\u5f0f\u73af\u5883\u4e2d\u5171\u4eab\u6570\u636e\u3002</p> <p>\u76ee\u524d\u7684\u4e3b\u6d41\u65b9\u6848\u6709\u56db\u79cd\uff1a</p> <ol> <li>Session\u540c\u6b65\uff1a\u53ea\u8981\u4e00\u4e2a\u8282\u70b9\u7684\u6570\u636e\u53d1\u751f\u4e86\u6539\u53d8\uff0c\u5c31\u5f3a\u5236\u540c\u6b65\u5230\u5176\u5b83\u6240\u6709\u8282\u70b9\uff08\u6027\u80fd\u6d88\u8017\u592a\u5927\uff0c\u4e0d\u592a\u8003\u8651\uff09</li> <li>Session\u7c98\u6ede\uff1a\u901a\u8fc7\u4e00\u5b9a\u7684\u7b97\u6cd5\uff0c\u4fdd\u8bc1\u4e00\u4e2a\u7528\u6237\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u7a33\u5b9a\u7684\u843d\u5728\u4e00\u4e2a\u8282\u70b9\u4e4b\u4e0a\uff08\u4ece\u7f51\u5173\u5904\u52a8\u624b\uff0c\u4e0e\u6846\u67b6\u65e0\u5173\uff09</li> <li>\u5efa\u7acb\u4f1a\u8bdd\u4e2d\u5fc3\uff1a\u5c06Session\u5b58\u50a8\u5728\u4e13\u4e1a\u7684\u7f13\u5b58\u4e2d\u95f4\u4ef6\u4e0a\uff0c\u4f7f\u6bcf\u4e2a\u8282\u70b9\u90fd\u53d8\u6210\u4e86\u65e0\u72b6\u6001\u670d\u52a1\uff0c\u4f8b\u5982\uff1a<code>Redis</code></li> <li>\u9881\u53d1\u65e0\u72b6\u6001token\uff1a\u653e\u5f03Session\u673a\u5236\uff0c\u5c06\u7528\u6237\u6570\u636e\u76f4\u63a5\u5199\u5165\u5230\u4ee4\u724c\u672c\u8eab\u4e0a\uff0c\u4f7f\u4f1a\u8bdd\u6570\u636e\u505a\u5230\u4ee4\u724c\u81ea\u89e3\u91ca\uff0c\u4f8b\u5982\uff1a<code>jwt</code></li> </ol> <p>\u7531\u4e8e<code>jwt</code>\u6a21\u5f0f\u4e0d\u5728\u670d\u52a1\u7aef\u5b58\u50a8\u6570\u636e\uff0c\u5bf9\u4e8e\u6bd4\u8f83\u590d\u6742\u7684\u4e1a\u52a1\u53ef\u80fd\u4f1a\u529f\u80fd\u53d7\u9650\uff0c\u56e0\u6b64\u66f4\u52a0\u63a8\u8350\u4f7f\u7528\u65b9\u6848\u4e09</p> <p>\u96c6\u6210Redis\uff1a</p> <pre><code>&lt;!-- Sa-Token \u6574\u5408 Redis \uff08\u4f7f\u7528 jdk \u9ed8\u8ba4\u5e8f\u5217\u5316\u65b9\u5f0f\uff0c 2\u90091 \uff09 --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;cn.dev33&lt;/groupId&gt;\n    &lt;artifactId&gt;sa-token-dao-redis&lt;/artifactId&gt;\n    &lt;version&gt;1.33.0&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;!-- Sa-Token \u6574\u5408 Redis \uff08\u4f7f\u7528 jackson \u5e8f\u5217\u5316\u65b9\u5f0f\uff0c 2\u90091 \uff09 --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;cn.dev33&lt;/groupId&gt;\n    &lt;artifactId&gt;sa-token-dao-redis-jackson&lt;/artifactId&gt;\n    &lt;version&gt;1.33.0&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;!-- \u63d0\u4f9bRedis\u8fde\u63a5\u6c60 --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;\n    &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <p>application.yml \u914d\u7f6e</p> <pre><code>spring: \n    # redis\u914d\u7f6e \n    redis:\n        # Redis\u6570\u636e\u5e93\u7d22\u5f15\uff08\u9ed8\u8ba4\u4e3a0\uff09\n        database: 1\n        # Redis\u670d\u52a1\u5668\u5730\u5740\n        host: 127.0.0.1\n        # Redis\u670d\u52a1\u5668\u8fde\u63a5\u7aef\u53e3\n        port: 6379\n        # Redis\u670d\u52a1\u5668\u8fde\u63a5\u5bc6\u7801\uff08\u9ed8\u8ba4\u4e3a\u7a7a\uff09\n        # password: \n        # \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\n        timeout: 10s\n        lettuce:\n            pool:\n                # \u8fde\u63a5\u6c60\u6700\u5927\u8fde\u63a5\u6570\n                max-active: 200\n                # \u8fde\u63a5\u6c60\u6700\u5927\u963b\u585e\u7b49\u5f85\u65f6\u95f4\uff08\u4f7f\u7528\u8d1f\u503c\u8868\u793a\u6ca1\u6709\u9650\u5236\uff09\n                max-wait: -1ms\n                # \u8fde\u63a5\u6c60\u4e2d\u7684\u6700\u5927\u7a7a\u95f2\u8fde\u63a5\n                max-idle: 10\n                # \u8fde\u63a5\u6c60\u4e2d\u7684\u6700\u5c0f\u7a7a\u95f2\u8fde\u63a5\n                min-idle: 0\n</code></pre>"},{"location":"web/backend/satoken.html#saapplication","title":"SaApplication","text":"<p>\u5728 SaApplication \u5b58\u50a8\u7684\u6570\u636e\u5728\u5168\u5c40\u8303\u56f4\u5185\u6709\u6548\uff0c\u5e94\u7528\u5173\u95ed\u540e\u6570\u636e\u81ea\u52a8\u6e05\u9664\uff08\u5982\u679c\u96c6\u6210\u4e86 Redis \u90a3\u5219\u662f Redis \u5173\u95ed\u540e\u6570\u636e\u81ea\u52a8\u6e05\u9664\uff09\u3002\u4f7f\u7528 SaApplication \u65f6\u65e0\u9700\u5904\u4e8e\u767b\u5f55\u72b6\u6001\u3002</p> <pre><code>SaApplication application = SaHolder.getApplication();\napplication.get(\"key\");   // \u53d6\u503c\napplication.set(\"key\", \"value\");   // \u5199\u503c \napplication.delete(\"key\");   // \u5220\u503c \n</code></pre>"},{"location":"web/backend/satoken.html#satokendao","title":"SaTokenDao\u7684\u5b9e\u73b0","text":"<p>SaTokenDao \u662f\u6570\u636e\u6301\u4e45\u5c42\u63a5\u53e3\uff0c\u8d1f\u8d23\u6240\u6709\u4f1a\u8bdd\u6570\u636e\u7684\u5e95\u5c42\u5199\u5165\u548c\u8bfb\u53d6\uff0c\u5b58\u50a8\u7684\u5185\u5bb9</p> <ul> <li>Session \u672c\u8eab\u7684 set \u7684\u503c\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\uff0c\u4e0d\u540c\u7684\u5fae\u670d\u52a1\u4e0d\u5efa\u8bae\u4f7f\u7528\u5176\u8fdb\u884c\u6570\u636e\u5171\u4eab\uff1b</li> <li><code>tokenValue</code>\u5230<code>loginId</code>\u7684\u6620\u5c04\u5173\u7cfb\uff1b</li> <li>\u6807\u8bb0\u8be5token\u662f\u5426\u6ce8\u9500\u3001\u5f3a\u5236\u4e0b\u7ebf\u7b49\u573a\u666f\uff1b</li> </ul> <p>Sa-Token\u9ed8\u8ba4\u7684Redis\u96c6\u6210\u65b9\u5f0f\u4f1a\u628a\u6743\u9650\u6570\u636e\u548c\u4e1a\u52a1\u7f13\u5b58\uff08spring redis template\uff09\u653e\u5728\u4e00\u8d77\uff0cSa-Token-Alone-Redis \u4ec5\u5bf9\u4ee5\u4e0b\u63d2\u4ef6\u6709 Redis \u5206\u79bb\u6548\u679c\uff1a</p> <ul> <li>sa-token-dao-redis \uff1aRedis\u96c6\u6210\u5305\uff0c\u4f7f\u7528 jdk \u9ed8\u8ba4\u5e8f\u5217\u5316\u65b9\u5f0f\u3002</li> <li>sa-token-dao-redis-jackson \uff1aRedis\u96c6\u6210\u5305\uff0c\u4f7f\u7528 jackson \u5e8f\u5217\u5316\u65b9\u5f0f\u3002</li> <li>sa-token-dao-redis-fastjson \uff1aRedis\u96c6\u6210\u5305\uff0c\u4f7f\u7528 fastjson \u5e8f\u5217\u5316\u65b9\u5f0f\u3002</li> <li>sa-token-dao-redis-fastjson2 \uff1aRedis\u96c6\u6210\u5305\uff0c\u4f7f\u7528 fastjson2 \u5e8f\u5217\u5316\u65b9\u5f0f\u3002</li> </ul> <pre><code>&lt;!-- Sa-Token\u63d2\u4ef6\uff1a\u6743\u9650\u7f13\u5b58\u4e0e\u4e1a\u52a1\u7f13\u5b58\u5206\u79bb --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;cn.dev33&lt;/groupId&gt;\n    &lt;artifactId&gt;sa-token-alone-redis&lt;/artifactId&gt;\n    &lt;version&gt;1.33.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>application.yml\u4e2d\u589e\u52a0\u914d\u7f6e</p> <pre><code># Sa-Token \u914d\u7f6e\nsa-token: \n    # Token\u540d\u79f0\n    token-name: satoken\n    # Token\u6709\u6548\u671f\n    timeout: 2592000\n    # Token\u98ce\u683c\n    token-style: uuid\n\n    # \u914d\u7f6e Sa-Token \u5355\u72ec\u4f7f\u7528\u7684 Redis \u8fde\u63a5 \n    alone-redis: \n        # Redis\u6570\u636e\u5e93\u7d22\u5f15\uff08\u9ed8\u8ba4\u4e3a0\uff09\n        database: 2\n        # Redis\u670d\u52a1\u5668\u5730\u5740\n        host: 127.0.0.1\n        # Redis\u670d\u52a1\u5668\u8fde\u63a5\u7aef\u53e3\n        port: 6379\n        # Redis\u670d\u52a1\u5668\u8fde\u63a5\u5bc6\u7801\uff08\u9ed8\u8ba4\u4e3a\u7a7a\uff09\n        password: \n        # \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\n        timeout: 10s\nspring: \n    # \u914d\u7f6e\u4e1a\u52a1\u4f7f\u7528\u7684 Redis \u8fde\u63a5 \n    redis: \n        # Redis\u6570\u636e\u5e93\u7d22\u5f15\uff08\u9ed8\u8ba4\u4e3a0\uff09\n        database: 0\n        # Redis\u670d\u52a1\u5668\u5730\u5740\n        host: 127.0.0.1\n        # Redis\u670d\u52a1\u5668\u8fde\u63a5\u7aef\u53e3\n        port: 6379\n        # Redis\u670d\u52a1\u5668\u8fde\u63a5\u5bc6\u7801\uff08\u9ed8\u8ba4\u4e3a\u7a7a\uff09\n        password: \n        # \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\n        timeout: 10s\n</code></pre>"},{"location":"web/backend/satoken.html#jwt","title":"JWT \u96c6\u6210","text":"<pre><code>&lt;!-- Sa-Token \u6574\u5408 jwt \u663e\u5f0f\u4f9d\u8d56 hutool-jwt 5.7.14 \u7248\u672c --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;cn.dev33&lt;/groupId&gt;\n    &lt;artifactId&gt;sa-token-jwt&lt;/artifactId&gt;\n    &lt;version&gt;1.33.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u5728 <code>application.yml</code> \u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e jwt \u751f\u6210\u79d8\u94a5\uff1a</p> <pre><code>sa-token:\n    # jwt\u79d8\u94a5 \n    jwt-secret-key: asdasdasifhueuiwyurfewbfjsdafjk\n</code></pre> <p>\u6ce8\u5165\uff1a</p> <pre><code>@Configuration\npublic class SaTokenConfigure {\n    @Bean\n    public StpLogic getStpLogicJwt() {\n        // Sa-Token \u6574\u5408 jwt (Simple \u7b80\u5355\u6a21\u5f0f)\n        return new StpLogicJwtForSimple();\n        // Sa-Token \u6574\u5408 jwt (Mixin \u6df7\u5165\u6a21\u5f0f)\n        return new StpLogicJwtForMixin();\n        // Sa-Token \u6574\u5408 jwt (Stateless \u65e0\u72b6\u6001\u6a21\u5f0f)\n        return new StpLogicJwtForStateless();\n    }\n}\n</code></pre>"},{"location":"web/backend/satoken.html#_15","title":"\u6ce8\u5165\u4e0d\u540c\u6a21\u5f0f\u7684\u5bf9\u6bd4","text":"<p>\u6ce8\u5165\u4e0d\u540c\u6a21\u5f0f\u4f1a\u8ba9\u6846\u67b6\u5177\u6709\u4e0d\u540c\u7684\u884c\u4e3a\u7b56\u7565\uff0c\u4ee5\u4e0b\u662f\u4e09\u79cd\u6a21\u5f0f\u7684\u5dee\u5f02\u70b9\uff08\u4e3a\u65b9\u4fbf\u53d9\u8ff0\uff0c\u4ee5\u4e0b\u6bd4\u8f83\u4ee5\u540c\u65f6\u5f15\u5165 jwt \u4e0e Redis \u4f5c\u4e3a\u524d\u63d0\uff09\uff1a</p> \u529f\u80fd\u70b9 Simple \u7b80\u5355\u6a21\u5f0f Mixin \u6df7\u5165\u6a21\u5f0f Stateless \u65e0\u72b6\u6001\u6a21\u5f0f Token\u98ce\u683c jwt\u98ce\u683c jwt\u98ce\u683c jwt\u98ce\u683c \u767b\u5f55\u6570\u636e\u5b58\u50a8 Redis\u4e2d Token\u4e2d Token\u4e2d Session\u5b58\u50a8 Redis\u4e2d Redis\u4e2d \u65e0Session \u6ce8\u9500\u4e0b\u7ebf \u524d\u540e\u7aef\u53cc\u6e05\u6570\u636e \u524d\u540e\u7aef\u53cc\u6e05\u6570\u636e \u524d\u7aef\u6e05\u9664\u6570\u636e \u8e22\u4eba\u4e0b\u7ebfAPI \u652f\u6301 \u4e0d\u652f\u6301 \u4e0d\u652f\u6301 \u9876\u4eba\u4e0b\u7ebfAPI \u652f\u6301 \u4e0d\u652f\u6301 \u4e0d\u652f\u6301 \u767b\u5f55\u8ba4\u8bc1 \u652f\u6301 \u652f\u6301 \u652f\u6301 \u89d2\u8272\u8ba4\u8bc1 \u652f\u6301 \u652f\u6301 \u652f\u6301 \u6743\u9650\u8ba4\u8bc1 \u652f\u6301 \u652f\u6301 \u652f\u6301 timeout \u6709\u6548\u671f \u652f\u6301 \u652f\u6301 \u652f\u6301 activity-timeout \u6709\u6548\u671f \u652f\u6301 \u652f\u6301 \u4e0d\u652f\u6301 id\u53cd\u67e5Token \u652f\u6301 \u652f\u6301 \u4e0d\u652f\u6301 \u4f1a\u8bdd\u7ba1\u7406 \u652f\u6301 \u90e8\u5206\u652f\u6301 \u4e0d\u652f\u6301 \u6ce8\u89e3\u9274\u6743 \u652f\u6301 \u652f\u6301 \u652f\u6301 \u8def\u7531\u62e6\u622a\u9274\u6743 \u652f\u6301 \u652f\u6301 \u652f\u6301 \u8d26\u53f7\u5c01\u7981 \u652f\u6301 \u652f\u6301 \u4e0d\u652f\u6301 \u8eab\u4efd\u5207\u6362 \u652f\u6301 \u652f\u6301 \u652f\u6301 \u4e8c\u7ea7\u8ba4\u8bc1 \u652f\u6301 \u652f\u6301 \u652f\u6301 \u6a21\u5f0f\u603b\u7ed3 Token\u98ce\u683c\u66ff\u6362 jwt \u4e0e Redis \u903b\u8f91\u6df7\u5408 \u5b8c\u5168\u820d\u5f03Redis\uff0c\u53ea\u7528jwt"},{"location":"web/backend/satoken.html#jwt_1","title":"\u5728\u591a\u8d26\u6237\u6a21\u5f0f\u4e2d\u96c6\u6210 jwt","text":"<p>sa-token-jwt \u63d2\u4ef6\u9ed8\u8ba4\u53ea\u4e3a <code>StpUtil</code> \u6ce8\u5165 <code>StpLogicJwtFoxXxx</code> \u5b9e\u73b0\uff0c\u81ea\u5b9a\u4e49\u7684 <code>StpUserUtil</code> \u662f\u4e0d\u4f1a\u81ea\u52a8\u6ce8\u5165\u7684\uff0c\u6211\u4eec\u9700\u8981\u5e2e\u5176\u624b\u52a8\u6ce8\u5165\uff1a</p> <pre><code>/**\n * \u4e3a StpUserUtil \u6ce8\u5165 StpLogicJwt \u5b9e\u73b0 \n */\n@Autowired\npublic void setUserStpLogic() {\n    StpUserUtil.setStpLogic(new StpLogicJwtForSimple(StpUserUtil.TYPE));\n}\n</code></pre>"},{"location":"web/backend/satoken.html#satokencontext","title":"SaTokenContext\u7684\u5b9e\u73b0","text":"<p>\u76ee\u524d Sa-Token \u4ec5\u5bf9 SpringBoot\u3001SpringMVC\u3001WebFlux\u3001Solon \u7b49\u90e8\u5206 Web \u6846\u67b6\u5236\u4f5c\u4e86 Starter \u96c6\u6210\u5305\uff0c \u5982\u679c\u6211\u4eec\u4f7f\u7528\u7684 Web \u6846\u67b6\u4e0d\u5728\u4e0a\u8ff0\u5217\u8868\u4e4b\u4e2d\uff0c\u5219\u9700\u8981\u81ea\u5b9a\u4e49 SaTokenContext \u63a5\u53e3\u7684\u5b9e\u73b0\u5b8c\u6210\u6574\u5408\u5de5\u4f5c\u3002</p> <p>\u4ece <code>HttpServletRequest</code> \u4e2d\u8bfb\u53d6 Token\uff0c\u4f46\u4e0d\u662f\u6240\u6709\u6846\u67b6\u90fd\u5177\u6709 HttpServletRequest \u5bf9\u8c61\uff0c\u4f8b\u5982\u5728 WebFlux \u4e2d\uff0c\u53ea\u6709 <code>ServerHttpRequest</code>\uff0c \u5728\u4e00\u4e9b\u5176\u5b83Web\u6846\u67b6\u4e2d\uff0c\u53ef\u80fd\u8fde <code>Request</code> \u7684\u6982\u5ff5\u90fd\u6ca1\u6709\u3002</p> <ul> <li><code>SaTokenContext</code>\u5b9a\u4e49\u63a5\u53e3\uff0c<code>sa-token-spring-boot-starter</code>\u96c6\u6210\u5305\u4e2d\u5df2\u7ecf\u5185\u7f6e\u4e86<code>SaTokenContext</code>\u7684\u5b9e\u73b0\uff1aSaTokenContextForSpring;</li> <li>\u5176\u5b83\u6846\u67b6\uff0c\u9700\u8981\u81ea\u5b9a\u4e49\u5b9e\u73b0<code>SaTokenContext</code>\u3002</li> </ul>"},{"location":"web/backend/satoken.html#_16","title":"\u6743\u9650","text":""},{"location":"web/backend/satoken.html#_17","title":"\u6743\u9650\u8ba4\u8bc1","text":""},{"location":"web/backend/satoken.html#_18","title":"\u63a5\u53e3\u5b9a\u4e49","text":"<p><code>StpInterface</code> \u63d0\u4f9b\u83b7\u53d6\u89d2\u8272\u548c\u83b7\u53d6\u6743\u9650\u7684\u63a5\u53e3\u5b9a\u4e49\uff0c\u6839\u636e\u81ea\u5df1\u7684\u4e1a\u52a1\u903b\u8f91\u8fdb\u884c\u91cd\u5199\u3002</p> <ul> <li><code>loginType</code>\u5b57\u6bb5\u89c1<code>\u591a\u8d26\u6237\u8ba4\u8bc1</code>\u90e8\u5206\uff1b</li> </ul> <pre><code>public interface StpInterface {\n   /** \u8fd4\u56de\u6307\u5b9a\u8d26\u53f7\u8d26\u53f7\u7c7b\u578b\u7684id\u7684\u6240\u62e5\u6709\u7684\u6743\u9650\u7801\u96c6\u5408 */\n   public List&lt;String&gt; getPermissionList(Object loginId, String loginType);\n   /** \u8fd4\u56de\u6307\u5b9a\u8d26\u53f7\u8d26\u53f7\u7c7b\u578b\u7684id\u6240\u62e5\u6709\u7684\u89d2\u8272\u6807\u8bc6\u96c6\u5408 */\n   public List&lt;String&gt; getRoleList(Object loginId, String loginType);\n}\n</code></pre>"},{"location":"web/backend/satoken.html#_19","title":"\u6743\u9650/\u89d2\u8272\u6821\u9a8c","text":"<p><code>StpUtil</code>\u63d0\u4f9b\u5de5\u5177\uff0c\u4e5f\u53ef\u901a\u8fc7\u6ce8\u89e3+\u62e6\u622a\u5668\u5b9e\u73b0\uff1b</p> <pre><code>// \u83b7\u53d6\uff1a\u5f53\u524d\u8d26\u53f7\u6240\u62e5\u6709\u7684\u6743\u9650\u96c6\u5408\nStpUtil.getPermissionList();\n\n// \u5224\u65ad\uff1a\u5f53\u524d\u8d26\u53f7\u662f\u5426\u542b\u6709\u6307\u5b9a\u6743\u9650, \u8fd4\u56de true \u6216 false\nStpUtil.hasPermission(\"user.add\");        \n\n// \u6821\u9a8c\uff1a\u5f53\u524d\u8d26\u53f7\u662f\u5426\u542b\u6709\u6307\u5b9a\u6743\u9650, \u5982\u679c\u9a8c\u8bc1\u672a\u901a\u8fc7\uff0c\u5219\u629b\u51fa\u5f02\u5e38: NotPermissionException \nStpUtil.checkPermission(\"user.add\");        \n\n// \u6821\u9a8c\uff1a\u5f53\u524d\u8d26\u53f7\u662f\u5426\u542b\u6709\u6307\u5b9a\u6743\u9650 [\u6307\u5b9a\u591a\u4e2a\uff0c\u5fc5\u987b\u5168\u90e8\u9a8c\u8bc1\u901a\u8fc7]\nStpUtil.checkPermissionAnd(\"user.add\", \"user.delete\", \"user.get\");        \n\n// \u6821\u9a8c\uff1a\u5f53\u524d\u8d26\u53f7\u662f\u5426\u542b\u6709\u6307\u5b9a\u6743\u9650 [\u6307\u5b9a\u591a\u4e2a\uff0c\u53ea\u8981\u5176\u4e00\u9a8c\u8bc1\u901a\u8fc7\u5373\u53ef]\nStpUtil.checkPermissionOr(\"user.add\", \"user.delete\", \"user.get\");    \n\n// \u83b7\u53d6\uff1a\u5f53\u524d\u8d26\u53f7\u6240\u62e5\u6709\u7684\u89d2\u8272\u96c6\u5408\nStpUtil.getRoleList();\n\n// \u5224\u65ad\uff1a\u5f53\u524d\u8d26\u53f7\u662f\u5426\u62e5\u6709\u6307\u5b9a\u89d2\u8272, \u8fd4\u56de true \u6216 false\nStpUtil.hasRole(\"super-admin\");        \n\n// \u6821\u9a8c\uff1a\u5f53\u524d\u8d26\u53f7\u662f\u5426\u542b\u6709\u6307\u5b9a\u89d2\u8272\u6807\u8bc6, \u5982\u679c\u9a8c\u8bc1\u672a\u901a\u8fc7\uff0c\u5219\u629b\u51fa\u5f02\u5e38: NotRoleException\nStpUtil.checkRole(\"super-admin\");        \n\n// \u6821\u9a8c\uff1a\u5f53\u524d\u8d26\u53f7\u662f\u5426\u542b\u6709\u6307\u5b9a\u89d2\u8272\u6807\u8bc6 [\u6307\u5b9a\u591a\u4e2a\uff0c\u5fc5\u987b\u5168\u90e8\u9a8c\u8bc1\u901a\u8fc7]\nStpUtil.checkRoleAnd(\"super-admin\", \"shop-admin\");        \n\n// \u6821\u9a8c\uff1a\u5f53\u524d\u8d26\u53f7\u662f\u5426\u542b\u6709\u6307\u5b9a\u89d2\u8272\u6807\u8bc6 [\u6307\u5b9a\u591a\u4e2a\uff0c\u53ea\u8981\u5176\u4e00\u9a8c\u8bc1\u901a\u8fc7\u5373\u53ef] \nStpUtil.checkRoleOr(\"super-admin\", \"shop-admin\");        \n</code></pre>"},{"location":"web/backend/satoken.html#_20","title":"\u4e8c\u7ea7\u8ba4\u8bc1","text":"<p>\u5728\u67d0\u4e9b\u654f\u611f\u64cd\u4f5c\u4e0b\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u5df2\u767b\u5f55\u7684\u4f1a\u8bdd\u8fdb\u884c\u4e8c\u6b21\u9a8c\u8bc1\u3002\u5373\uff1a\u5728\u5df2\u767b\u5f55\u4f1a\u8bdd\u7684\u57fa\u7840\u4e0a\uff0c\u8fdb\u884c\u518d\u6b21\u9a8c\u8bc1\uff0c\u63d0\u9ad8\u4f1a\u8bdd\u7684\u5b89\u5168\u6027\u3002</p> <p><code>Sa-Token</code>\u4e2d\u8fdb\u884c\u4e8c\u7ea7\u8ba4\u8bc1\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u8981\u4f7f\u7528\u4ee5\u4e0bAPI\uff1a</p> <ul> <li>\u4e14\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u4e1a\u52a1\u6807\u8bc6\u6765\u5206\u8fa8\u4e0d\u540c\u7684\u4e1a\u52a1\u7ebf\uff1a</li> </ul> <pre><code>// \u5728\u5f53\u524d\u4f1a\u8bdd \u5f00\u542f\u4e8c\u7ea7\u8ba4\u8bc1\uff0c\u4e1a\u52a1\u6807\u8bc6\u4e3aclient\uff0c\u65f6\u95f4\u4e3a600\u79d2\nStpUtil.openSafe(\"client\", 600); \n\n// \u83b7\u53d6\uff1a\u5f53\u524d\u4f1a\u8bdd\u662f\u5426\u5df2\u5b8c\u6210\u6307\u5b9a\u4e1a\u52a1\u7684\u4e8c\u7ea7\u8ba4\u8bc1 \nStpUtil.isSafe(\"client\"); \n\n// \u6821\u9a8c\uff1a\u5f53\u524d\u4f1a\u8bdd\u662f\u5426\u5df2\u5b8c\u6210\u6307\u5b9a\u4e1a\u52a1\u7684\u4e8c\u7ea7\u8ba4\u8bc1 \uff0c\u5982\u672a\u8ba4\u8bc1\u5219\u629b\u51fa\u5f02\u5e38\nStpUtil.checkSafe(\"client\"); \n\n// \u83b7\u53d6\u5f53\u524d\u4f1a\u8bdd\u6307\u5b9a\u4e1a\u52a1\u4e8c\u7ea7\u8ba4\u8bc1\u5269\u4f59\u6709\u6548\u65f6\u95f4 (\u5355\u4f4d: \u79d2, \u8fd4\u56de-2\u4ee3\u8868\u5c1a\u672a\u901a\u8fc7\u4e8c\u7ea7\u8ba4\u8bc1)\nStpUtil.getSafeTime(\"client\"); \n\n// \u5728\u5f53\u524d\u4f1a\u8bdd \u7ed3\u675f\u6307\u5b9a\u4e1a\u52a1\u6807\u8bc6\u7684\u4e8c\u7ea7\u8ba4\u8bc1\nStpUtil.closeSafe(\"client\"); \n</code></pre> <p>\u8c03\u7528\u6b65\u9aa4\uff1a</p> <ol> <li>\u524d\u7aef\u8c03\u7528 <code>deleteProject</code> \u63a5\u53e3\uff0c\u5c1d\u8bd5\u5220\u9664\u4ed3\u5e93\u3002</li> <li>\u540e\u7aef\u6821\u9a8c\u4f1a\u8bdd\u5c1a\u672a\u5b8c\u6210\u4e8c\u7ea7\u8ba4\u8bc1\uff0c\u8fd4\u56de\uff1a <code>\u4ed3\u5e93\u5220\u9664\u5931\u8d25\uff0c\u8bf7\u5b8c\u6210\u4e8c\u7ea7\u8ba4\u8bc1\u540e\u518d\u6b21\u8bbf\u95ee\u63a5\u53e3</code>\u3002</li> <li>\u524d\u7aef\u5c06\u4fe1\u606f\u63d0\u793a\u7ed9\u7528\u6237\uff0c\u7528\u6237\u8f93\u5165\u5bc6\u7801\uff0c\u8c03\u7528 <code>openSafe</code> \u63a5\u53e3\u3002</li> <li>\u540e\u7aef\u6bd4\u5bf9\u7528\u6237\u8f93\u5165\u7684\u5bc6\u7801\uff0c\u5b8c\u6210\u4e8c\u7ea7\u8ba4\u8bc1\uff0c\u6709\u6548\u671f\u4e3a\uff1a120\u79d2\u3002</li> <li>\u524d\u7aef\u5728 120 \u79d2\u5185\u518d\u6b21\u8c03\u7528 <code>deleteProject</code> \u63a5\u53e3\uff0c\u5c1d\u8bd5\u5220\u9664\u4ed3\u5e93\u3002</li> <li>\u540e\u7aef\u6821\u9a8c\u4f1a\u8bdd\u5df2\u5b8c\u6210\u4e8c\u7ea7\u8ba4\u8bc1\uff0c\u8fd4\u56de\uff1a<code>\u4ed3\u5e93\u5220\u9664\u6210\u529f</code>\u3002</li> </ol>"},{"location":"web/backend/satoken.html#_21","title":"\u5355\u670d\u52a1\u8def\u7531\u62e6\u622a\u9274\u6743","text":"<p>\u57fa\u4e8e <code>StpUtil.checkLogin()</code> \u7684\u767b\u5f55\u6821\u9a8c\u62e6\u622a\u5668\uff0c\u5e76\u4e14\u6392\u9664\u4e86<code>/user/doLogin</code>\u63a5\u53e3\u7528\u6765\u5f00\u653e\u767b\u5f55\uff1a</p> <ul> <li>\u5185\u90e8\u901a\u8fc7<code>SaHolder</code>\u83b7\u53d6 <code>request</code>\u4fe1\u606f\uff0c\u8fdb\u884c\u8def\u7531\u5339\u914d\uff1b</li> <li>\u66f4\u591a\u7528\u6cd5\u53c2\u8003\uff1ahttps://sa-token.dev33.cn/doc.html#/use/route-check</li> </ul> <pre><code>@Configuration\npublic class SaTokenConfigure implements WebMvcConfigurer {\n    // \u6ce8\u518c\u62e6\u622a\u5668\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        // \u6ce8\u518c Sa-Token \u62e6\u622a\u5668\n        registry.addInterceptor(new SaInterceptor(handle -&gt; {\n              // \u6307\u5b9a\u4e00\u6761 match \u89c4\u5219\n            SaRouter\n                .match(\"/**\")                           // \u62e6\u622a\u7684 path \u5217\u8868\uff0c\u53ef\u4ee5\u5199\u591a\u4e2a */\n                .notMatch(\"/user/doLogin\")              // \u6392\u9664\u6389\u7684 path \u5217\u8868\uff0c\u53ef\u4ee5\u5199\u591a\u4e2a \n                .check(r -&gt; StpUtil.checkLogin());      // \u8981\u6267\u884c\u7684\u6821\u9a8c\u52a8\u4f5c\uff0c\u53ef\u4ee5\u5199\u5b8c\u6574\u7684 lambda \u8868\u8fbe\u5f0f\n\n            // \u6839\u636e\u8def\u7531\u5212\u5206\u6a21\u5757\uff0c\u4e0d\u540c\u6a21\u5757\u4e0d\u540c\u9274\u6743 \n            SaRouter.match(\"/user/**\", r -&gt; StpUtil.checkPermission(\"user\"));\n            SaRouter.match(\"/admin/**\", r -&gt; StpUtil.checkPermission(\"admin\"));\n        })).addPathPatterns(\"/**\");\n    }\n}\n</code></pre>"},{"location":"web/backend/satoken.html#_22","title":"\u7f51\u5173\u7edf\u4e00\u9274\u6743","text":"<p>\u4ee5<code>[SpringCloud Gateway]</code>\u4e3a\u4f8b</p> <pre><code>&lt;!-- Sa-Token \u6743\u9650\u8ba4\u8bc1\uff08Reactor\u54cd\u5e94\u5f0f\u96c6\u6210\uff09, \u5728\u7ebf\u6587\u6863\uff1ahttps://sa-token.cc --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;cn.dev33&lt;/groupId&gt;\n    &lt;artifactId&gt;sa-token-reactor-spring-boot-starter&lt;/artifactId&gt;\n    &lt;version&gt;1.33.0&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;!-- Sa-Token \u6574\u5408 Redis \uff08\u4f7f\u7528 jackson \u5e8f\u5217\u5316\u65b9\u5f0f\uff09 --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;cn.dev33&lt;/groupId&gt;\n    &lt;artifactId&gt;sa-token-dao-redis-jackson&lt;/artifactId&gt;\n    &lt;version&gt;1.33.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;\n    &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"web/backend/satoken.html#_23","title":"\u5b9e\u73b0\u9274\u6743\u63a5\u53e3","text":"<p>\u5173\u4e8e\u6570\u636e\u7684\u83b7\u53d6\uff0c\u5efa\u8bae\u4ee5\u4e0b\u65b9\u6848\u4e09\u9009\u4e00\uff1a</p> <ol> <li>\u5728\u7f51\u5173\u5904\u96c6\u6210ORM\u6846\u67b6\uff0c\u76f4\u63a5\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u6570\u636e</li> <li>\u5148\u4eceRedis\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u83b7\u53d6\u4e0d\u5230\u65f6\u8d70ORM\u6846\u67b6\u67e5\u8be2\u6570\u636e\u5e93</li> <li>\u5148\u4eceRedis\u4e2d\u83b7\u53d6\u7f13\u5b58\u6570\u636e\uff0c\u83b7\u53d6\u4e0d\u5230\u65f6\u8d70RPC\u8c03\u7528\u5b50\u670d\u52a1 (\u4e13\u95e8\u7684\u6743\u9650\u6570\u636e\u63d0\u4f9b\u670d\u52a1) \u83b7\u53d6</li> </ol> <pre><code>/**\n * \u81ea\u5b9a\u4e49\u6743\u9650\u9a8c\u8bc1\u63a5\u53e3\u6269\u5c55 \n */\n@Component   \npublic class StpInterfaceImpl implements StpInterface {\n\n    @Override\n    public List&lt;String&gt; getPermissionList(Object loginId, String loginType) {\n        // \u8fd4\u56de\u6b64 loginId \u62e5\u6709\u7684\u6743\u9650\u5217\u8868 \n        return ...;\n    }\n\n    @Override\n    public List&lt;String&gt; getRoleList(Object loginId, String loginType) {\n        // \u8fd4\u56de\u6b64 loginId \u62e5\u6709\u7684\u89d2\u8272\u5217\u8868\n        return ...;\n    }\n}\n</code></pre>"},{"location":"web/backend/satoken.html#_24","title":"\u6ce8\u518c\u5168\u5c40\u8fc7\u6ee4\u5668","text":"<pre><code>@Configuration\npublic class SaTokenConfigure {\n    // \u6ce8\u518c Sa-Token\u5168\u5c40\u8fc7\u6ee4\u5668 \n    @Bean\n    public SaReactorFilter getSaReactorFilter() {\n        return new SaReactorFilter()\n            // \u62e6\u622a\u5168\u90e8path\n            .addInclude(\"/**\")\n            // \u5f00\u653e\u5730\u5740 \n            .addExclude(\"/favicon.ico\")\n            // \u9274\u6743\u65b9\u6cd5\uff1a\u6bcf\u6b21\u8bbf\u95ee\u8fdb\u5165 \n            .setAuth(obj -&gt; {\n                // \u767b\u5f55\u6821\u9a8c -- \u62e6\u622a\u6240\u6709\u8def\u7531\uff0c\u5e76\u6392\u9664/user/doLogin \u7528\u4e8e\u5f00\u653e\u767b\u5f55 \n                SaRouter.match(\"/**\", \"/user/doLogin\", r -&gt; StpUtil.checkLogin());\n                // \u6743\u9650\u8ba4\u8bc1 -- \u4e0d\u540c\u6a21\u5757, \u6821\u9a8c\u4e0d\u540c\u6743\u9650 \n                SaRouter.match(\"/user/**\", r -&gt; StpUtil.checkPermission(\"user\"));\n                SaRouter.match(\"/admin/**\", r -&gt; StpUtil.checkPermission(\"admin\"));\n                SaRouter.match(\"/goods/**\", r -&gt; StpUtil.checkPermission(\"goods\"));\n                SaRouter.match(\"/orders/**\", r -&gt; StpUtil.checkPermission(\"orders\"));\n\n                // \u66f4\u591a\u5339\u914d ...  */\n            })\n            // \u5f02\u5e38\u5904\u7406\u65b9\u6cd5\uff1a\u6bcf\u6b21setAuth\u51fd\u6570\u51fa\u73b0\u5f02\u5e38\u65f6\u8fdb\u5165 \n            .setError(e -&gt; {\n                return SaResult.error(e.getMessage());\n            });\n    }\n}\n</code></pre>"},{"location":"web/backend/satoken.html#todo","title":"\u5355\u70b9\u767b\u5f55\uff08TODO\uff09","text":""},{"location":"web/backend/satoken.html#_25","title":"\u5176\u5b83","text":""},{"location":"web/backend/satoken.html#_26","title":"\u5168\u5c40\u76d1\u542c\u5668","text":"<p>\u63d0\u4f9b\u4e00\u79cd\u4fa6\u542c\u5668\u673a\u5236\uff0c\u901a\u8fc7\u6ce8\u518c\u4fa6\u542c\u5668\uff0c\u4f60\u53ef\u4ee5\u8ba2\u9605\u6846\u67b6\u7684\u4e00\u4e9b\u5173\u952e\u6027\u4e8b\u4ef6\uff0c\u4f8b\u5982\uff1a\u7528\u6237\u767b\u5f55\u3001\u9000\u51fa\u3001\u88ab\u8e22\u4e0b\u7ebf\u7b49\u3002</p> <ul> <li>\u540c\u6b65\u8c03\u7528\uff0c\u5373\u5728\u7528\u6237\u767b\u5f55\u7684\u51fd\u6570\u5904\u7406\u8fc7\u7a0b\u4e2d\u8c03\u7528\u76d1\u542c\u5668\u7684\u4e8b\u4ef6\u5904\u7406\uff1b</li> <li>\u8fdb\u7a0b\u7ea7\u522b\uff0c\u4e0d\u63d0\u4f9b\u5206\u5e03\u5f0f\u573a\u666f\u4e0b\u7684\u76d1\u542c\u5904\u7406\uff1b</li> </ul>"},{"location":"web/backend/satoken.html#_27","title":"\u5de5\u5177\u7c7b","text":"<p>https://sa-token.dev33.cn/doc.html#/more/common-action</p>"},{"location":"web/backend/satoken.html#_28","title":"\u914d\u7f6e","text":""},{"location":"web/backend/satoken.html#faq","title":"FAQ","text":""},{"location":"web/backend/satoken.html#_29","title":"\u4f9d\u8d56\u5f15\u5165\u8bf4\u660e","text":"<p><code>sa-token-spring-boot-starter</code> </p> <ul> <li>\u5185\u90e8\u57fa\u7840\u670d\u52a1\u4e00\u822c\u4f7f\u7528SpringBoot\u9ed8\u8ba4\u7684web\u6a21\u5757\uff1aSpringMVC\uff0c \u57fa\u4e8eServlet\u6a21\u578b\u7684\uff0c\u5f15\u5165<code>sa-token-spring-boot-starter</code></li> </ul> <p><code>sa-token-reactor-spring-boot-starter</code></p> <ul> <li><code>SpringCloud Gateway\u3001ShenYu</code> \u7b49\u57fa\u4e8eReactor\u6a21\u578b\u5f15\u5165\u7684\u662f\uff1a<code>sa-token-reactor-spring-boot-starter</code></li> </ul>"},{"location":"web/backend/satoken.html#uri","title":"\u53cd\u5411\u4ee3\u7406 uri \u4e22\u5931\u7684\u95ee\u9898","text":"<p>\u4f7f\u7528 <code>request.getRequestURL()</code> \u53ef\u83b7\u53d6\u5f53\u524d\u7a0b\u5e8f\u6240\u5728\u5916\u7f51\u7684\u8bbf\u95ee\u5730\u5740\uff0c\u5728 Sa-Token \u4e2d\uff0c\u5176 <code>SaHolder.getRequest().getUrl()</code> \u4e5f\u6b63\u662f\u501f\u52a9\u6b64API\u5b8c\u6210\uff0c \u6709\u5f88\u591a\u6a21\u5757\u90fd\u7528\u5230\u4e86\u8fd9\u4e2a\u80fd\u529b\uff0c\u6bd4\u5982SSO\u5355\u70b9\u767b\u5f55\u3002</p> <ul> <li>\u90e8\u7f72\u65f6\u4f7f\u7528 Nginx \u505a\u4e86\u4e00\u5c42\u53cd\u5411\u4ee3\u7406\u540e\uff0c\u83b7\u53d6\u5230\u7684 Url \u8def\u5f84\u53ef\u80fd\u4f1a\u51fa\u95ee\u9898\uff1b</li> </ul> <p>https://sa-token.dev33.cn/doc.html#/fun/curr-domain</p>"},{"location":"web/backend/servlet_container.html","title":"Servlet \u5bb9\u5668","text":"<p>HTTP \u670d\u52a1</p> <p>\u5e38\u89c1\u7684Servlet \u5bb9\u5668\u6709\uff1aTomcat\uff0cJetty\uff0cUndertow\u7b49\u3002</p> <p>Tomcat\u8d1f\u8d23\u8bf7\u6c42\u8fde\u63a5\uff0c\u65ad\u5f00\u8fde\u63a5\uff0c\u8fde\u63a5\u6821\u9a8c\u7b49\u64cd\u4f5c\uff0cServlet\u4e3b\u8981\u5904\u7406\u5185\u90e8\u6570\u636e\u64cd\u4f5c\u3002</p> <ul> <li>Tomcat \u53ef\u4ee5\u7406\u89e3\u6210\u7528\u4e8e http\u5e73\u53f0\u7684\u670d\u52a1\u5668\uff0c\u80fd\u63a5\u53d7http\u7684\u8bf7\u6c42\u5e76\u5206\u6790\uff1b</li> <li>Servlet\u662fjava\u5185\u90e8\u7684\u4e00\u79cd\u89c4\u8303\uff0c\u51c6\u786e\u7684\u8bf4\uff0c\u53ef\u4ee5\u5bf9\u53c2\u6570\u8fdb\u884c\u5206\u6790\uff0c\u521b\u5efa\u5bf9\u8c61\u7136\u540e\u8fd4\u56de\u6570\u636e\u3002</li> </ul>"},{"location":"web/backend/servlet_container.html#_1","title":"\u5e38\u89c1\u7684\u7f51\u7edc\u5bb9\u5668","text":"<ul> <li>Servlet \uff1aJava Servlet\u548c Java Server Page\uff0c\u52a8\u6001\u751f\u6210\u7f51\u9875\uff1b</li> <li> <p>\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\uff0cservlet\u4e0d\u662f\u7ebf\u7a0b\uff0c\u901a\u8fc7\u7ebf\u7a0b\u6c60\u8fd0\u884cservlet\u4e2d\u7684\u5904\u7406\u8bf7\u6c42\u7684\u65b9\u6cd5\uff1b</p> </li> <li> <p>Tomcat\u3001Jetty \uff1aservlet\u5f15\u64ce\uff0c\u652f\u6301\u6807\u51c6\u7684servlet\u89c4\u8303\u548cjavaEE\u89c4\u8303\uff1b\u8ba4\u4e3a\u5e94\u7528\u670d\u52a1\u5668\uff0c\u642d\u914d\u5177\u4f53\u7684\u8fd0\u884c\u73af\u5883\uff1b</p> </li> <li>Jetty\uff1a\u57fa\u4e8eHandler\u8bbe\u8ba1\uff0c\u6613\u6269\u5c55\uff0c\u6309\u9700\u52a0\u8f7d\u7ec4\u4ef6\uff1bHTTP\u5ba2\u6237\u7aef\u662f\u975e\u963b\u585e\u548c\u5f02\u6b65\u7684\uff1b</li> <li> <p>Tomcat\uff1a\u57fa\u4e8e\u5bb9\u91cf\u8bbe\u8ba1\uff0c\u4e0d\u6613\u6269\u5c55\uff1b</p> </li> <li> <p>Apache\u3001Nginx \uff1aHTTP \u670d\u52a1\u5668\u8f6f\u4ef6</p> </li> <li>\u9759\u6001\u8d44\u6e90\u8bbf\u95ee\uff0c\u53ef\u4ee5\u901a\u8fc7\u811a\u672c\u65b9\u5f0f\u8fdb\u884c\u6269\u5c55\uff1b</li> <li>Tomcat\u4e5f\u53ef\u4ee5\u8ba4\u4e3a\u662fHTTP\u670d\u52a1\u5668\uff0c\u4f46\u901a\u5e38\u5b83\u4ecd\u7136\u4f1a\u548cApache\u6216Nginx\u914d\u5408\u5728\u4e00\u8d77\u4f7f\u7528\uff0c\u7528\u4e8e\u52a8\u6001\u3001\u9759\u6001\u8d44\u6e90\u5206\u79bb\u4ee5\u53ca\u8d1f\u8f7d\u5747\u8861\uff1b</li> </ul> <p>NIO\u3001Netty\u3001Grizzly</p> <ul> <li>NIO\uff1aNetwork IO\uff0c\u5982java.nio\uff1b</li> <li>Netty\uff1aNIO\u7684\u5ba2\u6237\u6bb5/\u670d\u52a1\u5668\u6846\u67b6\uff0c\u5f02\u6b65\u7684\u4e8b\u4ef6\u9a71\u52a8\u7684\u7f51\u7edc\u5e94\u7528\u6846\u67b6\uff1b</li> <li>Akka\uff1aScala\u7f16\u5199\u7684\u7528\u4e8e\u7b80\u5316\u7f16\u5199\u5bb9\u9519\u7684\u3001\u9ad8\u53ef\u4f38\u7f29\u6027\u7684 Java \u548c Scala \u7684 Actor \u6a21\u578b\u5e94\u7528\uff1bAkka\u9488\u5bf9IO\u64cd\u4f5c\u6709\u4e00\u4e2a\u62bd\u8c61\uff0c\u548cnetty\u4e00\u6837\u3002\u4f7f\u7528Akka\u53ef\u4ee5\u7528\u6765\u521b\u5efa\u8ba1\u7b97\u96c6\u7fa4,Actor\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e4b\u95f4\u4f20\u9012\u6d88\u606f\u3002\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u770b,Akka\u76f8\u5bf9\u4e8eNetty\u6765\u8bf4\uff0c\u662f\u4e00\u4e2a\u66f4\u9ad8\u5c42\u6b21\u7684\u62bd\u8c61\u3002</li> </ul>"},{"location":"web/backend/servlet_container.html#_2","title":"\u4ee3\u7406","text":"<p>\u5ba2\u6237\u7aef -&gt; \u4ee3\u7406 -&gt; \u670d\u52a1\u5668</p> <p>\u53cd\u5411\u4ee3\u7406 \uff1a\u4ee3\u7406\u90e8\u7f72\u5728\u5ba2\u6237\u7aef\uff0c\u5c5e\u4e8e\u5ba2\u6237\u7aef\uff1b</p> <p>\u6b63\u5411\u4ee3\u7406 \uff1a\u4ee3\u7406\u90e8\u7f72\u5728\u670d\u52a1\u7aef\uff0c\u5c5e\u4e8e\u670d\u52a1\u7aef\uff1b</p>"},{"location":"web/backend/servlet_container.html#restful-api","title":"Restful API \u53ca\u5f00\u6e90\u6846\u67b6","text":""},{"location":"web/backend/servlet_container.html#rest","title":"REST","text":"<ul> <li>REpresentational State Transfer\uff1a\u8868\u73b0\u5c42\u72b6\u6001\u8f6c\u79fb\u3002URL\u5b9a\u4f4d\u8d44\u6e90\uff0c\u7528HTTP\u52a8\u8bcd\uff08GET,POST,DELETE,PUT\uff09\u63cf\u8ff0\u64cd\u4f5c\uff1b</li> <li>\u64cd\u4f5c\u65e0\u72b6\u6001\uff0c\u65e0\u9700\u4e0a\u4e0b\u6587\u4fe1\u606f\uff1b</li> <li>\u5ba2\u6237\u7684\u8ba4\u8bc1\u5982\u4f55\u5b9e\u73b0\uff1f\u8ba9\u6240\u6709\u7684\u670d\u52a1\u90fd\u80fd\u8bc6\u522b\uff08Token\uff09\uff1b</li> <li>\u4e0d\u540c\u4e8e\u4f20\u7edf\u7684PHP\u3001JSP\u67b6\u6784\uff08Servlet\uff09\uff0c\u524d\u540e\u7aef\u8fdb\u884c\u5206\u79bb\uff0c\u7edf\u4e00\u7684\u63a5\u53e3\u4e3aWeb\u3001IOS\u3001Android\u670d\u52a1\uff1b</li> <li>JAX-RS -- Java API for RESTful Web Services\uff0c\u4e8eJava EE 6\u5f15\u5165\uff08\u5305javax.ws.rs\uff09\uff0c\u63d0\u4f9b\u56fa\u5b9a\u7684\u63a5\u53e3\u5f00\u53d1REST\u5e94\u7528\uff0c\u907f\u514d\u7b2c\u4e09\u65b9\u6846\u67b6\u4f9d\u8d56\uff1b</li> <li>JAXB\uff08Java Architecture for XML Binding) \u662f\u4e00\u4e2a\u4e1a\u754c\u7684\u6807\u51c6\uff0c\u662f\u4e00\u9879\u53ef\u4ee5\u5c06XML Schema\u548cJava\u7c7b\u4e92\u8f6c\u7684\u6280\u672f\uff0c\u6210\u4e3aJDK\u4e00\u90e8\u5206\uff1b</li> </ul>"},{"location":"web/backend/servlet_container.html#restlet-jersey","title":"Restlet \u548c Jersey","text":"<ul> <li>JAX-RS\u89c4\u8303\u7684\u5b9e\u73b0\uff1b</li> <li>\u901a\u8fc7SPI\u673a\u5236\uff0c\u63a5\u53e3\u5230\u5b9e\u73b0\uff08ServiceLoader.load\uff09\uff0c\u53ef\u4ee5\u624b\u52a8\u914d\u7f6e\u4ee3\u66ff\u81ea\u52a8\u626b\u63cf\uff1b</li> <li>org.glassfish.jersey.media \u7684 jersey-media-json-binding \u5b9e\u73b0json\u5230Java\u7c7b\u7684\u8f6c\u6362\uff08writer\u7c7b\u7684load\uff09\uff1b</li> <li>\u901a\u8fc7\u81ea\u5e26\u7684Servlet\u914d\u7f6eTomcat\u8fd0\u884c\uff1b(Spring\u662f\u975e\u6807\u51c6\u7684JAX-RS\u7684Servlet\u5b9e\u73b0)</li> </ul>"},{"location":"web/backend/servlet_container.html#jax-rs","title":"JAX-RS\u63a5\u53e3\u6ce8\u89e3","text":"<ul> <li> <p>@GET, @POST, @PUT, @DELETE</p> </li> <li> <p>@Path(\"\")</p> </li> <li> <ul> <li>\u5f15\u53f7\u4e2d\u82e5\u662f{year}\u5219\u8868\u660e\u8be5\u503c\u662f\u4e2a\u53d8\u91cf\uff0c\u5728\u51fd\u6570\u7684\u5f62\u53c2\u4e2d\u51fa\u73b0\uff0c\u53d8\u91cf\u540d\u4e3ayear\u5e76\u6307\u5b9a\u7c7b\u578b\uff1b</li> </ul> </li> <li> <p>@PathParam()\uff0c@QueryParam(), @DefaultValue(String), @FormParam()</p> </li> <li> <ul> <li>@DefaultValue\u4e2dString\u4f1a\u81ea\u52a8\u7c7b\u578b\u8f6c\u6362\u6210int\u7b49\u57fa\u672c\u7c7b\u578b\uff0c\u5e94\u8be5\u662f\u8c03\u7528valueOf\u65b9\u6cd5\uff1b</li> </ul> </li> <li>@FormParam\u662f\u5c06HTML\u4e2d\u7684\u8868\u5355\u7ed1\u5b9a\u5230\u65b9\u6cd5\u4e0a\uff0c\u8fdb\u884c\u53d6\u503c\uff1b</li> </ul>"},{"location":"web/backend/servlet_container.html#java","title":"Java\u5fae\u670d\u52a1\u4f53\u7cfb","text":""},{"location":"web/backend/servlet_container.html#springcloud","title":"SpringCloud","text":""},{"location":"web/backend/servlet_container.html#vertxservicecomb","title":"Vert.x\uff08ServiceComb\uff09","text":"<p>\u5728JVM\u4e0a\u6784\u5efa\u54cd\u5e94\u5f0f\u5e94\u7528\u7a0b\u5e8f\u7684\u5de5\u5177\u5305\u3002</p> <p>Apache ServiceComb\u5c31\u662f\u4ee5Vert.x\u4e3a\u5e95\u5c42\u6846\u67b6\u5b9e\u73b0</p> <ul> <li>Vert.x\u5355\u4e2a\u670d\u52a1\u6253\u5305\u5b8c\u6210\u540e\u5927\u7ea67M\u5de6\u53f3\u7684JAR\uff0c\u4e0d\u4f9d\u8d56Tomcat\u3001Jetty\u4e4b\u7c7b\u7684\u5bb9\u5668\uff0c\u76f4\u63a5\u5728JVM\u4e0a\u8dd1\uff1b</li> <li>Vert.x\u5b9e\u73b0\u7684\u5f00\u6e90\u7f51\u5173- VX-API-Gateway\u5e2e\u52a9\u6587\u6863\uff08https://github.com/EliMirren/VX-API-Gateway\uff09\uff1b</li> </ul>"},{"location":"web/backend/servlet_container.html#servlet_1","title":"Servlet","text":"<p>javax.servlet \u89c4\u8303\uff0c\u7528\u4e8e\u5904\u7406 HTTP \u8bf7\u6c42\u3002</p> <ul> <li>\u5b9e\u73b0 Servlet \u63a5\u53e3\uff0c\u5904\u7406\u8bf7\u6c42\uff1b</li> <li>\u5b9a\u4e49<code>web.xml</code>\uff0c\u914d\u7f6e URL \u5bf9\u5e94\u7684\u5904\u7406\u7684\u7c7b\u5168\u540d\uff1b</li> </ul> <p>\u4e00\u822c\u76f4\u63a5\u7ee7\u627f HttpServlet\u3002</p> <ul> <li>\u975e\u7ebf\u7a0b\u5b89\u5168\uff1b</li> </ul>"},{"location":"web/backend/servlet_container.html#tomcat","title":"Tomcat","text":"<p>Tomcat 9</p>"},{"location":"web/backend/servlet_container.html#_3","title":"\u57fa\u7840","text":"<ul> <li> <p>CATALINA_HOME\u6307\u5b9a\u7684\u662ftomcat\u4e3b\u76ee\u5f55\uff0cCATALINA_BASE\u6307\u5b9a\u7684\u662f\u5b9e\u4f8b\u7684\u76ee\u5f55\uff0c\u6dfb\u52a0\u811a\u672c\u914d\u7f6e\u4e0a\u9762\u73af\u5883\u53d8\u91cf\uff0c\u901a\u8fc7CATALINA_HOME/bin/catalina.sh\u811a\u672c\u6267\u884c\uff1b</p> </li> <li> <p>\u4e00\u4e2aTomcat\u662f\u4e00\u4e2aJVM\u8fdb\u7a0b\uff0c\u4f1a\u52a0\u8f7dwebapps\u4e0b\u9762\u7684\u6240\u6709\u9879\u76ee\uff0c\u53ef\u4ee5\u5355\u673a\u90e8\u7f72\u591a\u4e2aTomcat\u5b9e\u4f8b\uff1b</p> </li> <li> <p>Tomcat\u7c7b\u52a0\u8f7d\u5668\u8bf4\u660e\uff1acatalina.sh\u542f\u52a8</p> </li> <li> <p>Bootstrap\u3001Extension\u52a0\u8f7d\u5668\uff1a<code>$JAVA_HOME/jre/lib/rt.jar</code>, \u200b<code>$JAVA_HOME/jre/lib/ext</code></p> </li> <li> <p>System\u52a0\u8f7d\u5668\uff1a$CATALINA_HOME/bin\u4e0b\u9762\u7684jar\u5305</p> </li> <li> <p>Common\u52a0\u8f7d\u5668\uff1a\\(CATALINA_BASE/lib\uff0c\u7136\u540e\u662f\\)CATALINA_HOME/lib\uff1b\u4e0a\u8ff0webapps\u90fd\u53ef\u89c1</p> </li> <li> <p>WebappX\u52a0\u8f7d\u5668\uff1awebapp/classes, webapp/lib\uff1b\u4ec5\u5f53\u524dwebapp\u53ef\u89c1</p> </li> </ul> <p>\u9ed8\u8ba4\u7684\u52a0\u8f7d\u987a\u5e8f\u662fBootstrap\uff0cWebappX\uff0c System\uff0c Common\uff1b\u82e5\u8bbe\u7f6e\u52a0\u8f7d\u5668delegate='true'\uff0c\u5219\u6309\u7167\u4ece\u4e0a\u5230\u4e0b\u987a\u5e8f\u52a0\u8f7d\uff1b</p> <p>\u4e0d\u540c\u7684webapp\u4e0d\u540c\u7684WebappX\u52a0\u8f7d\u5668\uff1b</p> <ul> <li> <p>Tomcat\u7684\u9ed8\u8ba4\u8bbf\u95ee\u8def\u5f84\u4ee5webapps\u7684\u6587\u4ef6\u540d\u4e3abase url\uff0c\u91cc\u9762\u7684web.xml\u914d\u7f6e\u7684\u4e3a\u76f8\u5bf9\u8def\u5f84\uff1b</p> </li> <li> <p>\u70ed\u90e8\u7f72\uff1a \u6574\u4e2a\u9879\u76ee\u91cd\u65b0\u90e8\u7f72\uff0c\u5305\u62ec\u4f60\u4ece\u65b0\u6253\u4e0a.war \u6587\u4ef6\u3002 \u4f1a\u6e05\u7a7asession \uff0c\u91ca\u653e\u5185\u5b58\u3002\u9879\u76ee\u6253\u5305\u7684\u65f6\u5019\u7528\u7684\u591a\u3002</p> </li> <li> <p>\u5728server.xml -&gt; context \u5c5e\u6027\u4e2d \u8bbe\u7f6e autoDeploy=\"true\"</p> </li> <li> <p>\u70ed\u52a0\u8f7d\uff1a\u670d\u52a1\u5668\u4f1a\u76d1\u542c class \u6587\u4ef6\u6539\u53d8\uff0c\u5305\u62ecweb-inf/class,web-inf/lib,web-inf/web.xml\u7b49\u6587\u4ef6\uff0c\u82e5\u53d1\u751f\u66f4\u6539\uff0c\u5219\u5c40\u90e8\u8fdb\u884c\u52a0\u8f7d\uff0c\u4e0d\u6e05\u7a7asession \uff0c\u4e0d\u91ca\u653e\u5185\u5b58\u3002\u5f00\u53d1\u4e2d\u7528\u7684\u591a\uff0c\u4f46\u662f\u8981\u8003\u8651\u5185\u5b58\u6ea2\u51fa\u7684\u60c5\u51b5\u3002</p> </li> <li> <p>\u5728server.xml -&gt; context \u5c5e\u6027\u4e2d \u8bbe\u7f6e reloadable=\"true\"</p> </li> </ul>"},{"location":"web/backend/servlet_container.html#_4","title":"\u65e5\u5fd7","text":"<ul> <li> <p>\u5982\u679clog4j\u4f9d\u8d56jar\u5728Tomcat\u76ee\u5f55\uff0c\u5219Tomcat\u8be5\u8fdb\u7a0b\u53ea\u4f1a\u6709\u4e00\u4e2a\u8be5\u7c7b\u7684\u52a0\u8f7d\uff0c\u4e0d\u540c\u7684webapps\u7684log\uff08\u65e0\u8bba\u662f\u5426\u58f0\u660e\u4e3astatic\uff09\u5373\u4f7f\u914d\u7f6e\u4e0d\u540c\u7684\u8f93\u51fa\u6587\u4ef6\uff0c\u4e5f\u4f1a\u8f93\u51fa\u5230\u540c\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff1b</p> </li> <li> <p>\u4f7f\u7528log4j\u65e5\u5fd7\u8f93\u51fa\uff0chttp://tomcat.apache.org/tomcat-8.0-doc/logging.html#Using_Log4j \uff08Tomcat     8.5\u4e4b\u540elog4j2\u548clogback\u53ef\u4ee5\u76f4\u63a5\u63d2\u5165\u5230java.util.logging\u4e2d\uff09</p> </li> <li> <ul> <li>\u5c06 log4j.properties \u548c log4j-1.2.17.jar\u653e\u5230tomcat/lib\u76ee\u5f55\u4e0b\uff1b</li> </ul> </li> <li>\u5c06tomcat-juli-adapters.jar\u5305\u653e\u5230tomcat/lib\u76ee\u5f55\u4e0b\uff1b</li> <li>\u5c06tomcat-juli.jar\u5305\u653e\u5230tomcat/bin\u76ee\u5f55\uff1b\u56e0\u4e3a\u5b83\u662f\u7528\u4f5c\u5f15\u5bfc\u8fdb\u7a0b\u7684\uff0c\u800c\u5f15\u5bfc\u7c7b\u90fd\u662f\u4ece bin \u52a0\u8f7d\u7684\uff1b</li> <li> <p>\u5220\u9664\u6216\u91cd\u547d\u540dtomcat/conf\u76ee\u5f55\u4e0b\u7684logging.properties\u6587\u4ef6\uff1b</p> </li> <li> <p>Tomcat \u7684\u5185\u90e8\u65e5\u5fd7\u4f7f\u7528 JULI \u7ec4\u4ef6\uff0c\u8fd9\u662f\u4e00\u4e2a Apache Commons \u65e5\u5fd7\u7684\u91cd\u547d\u540d\u7684\u6253\u5305\u5206\u652f\uff0c\u9ed8\u8ba4\u88ab\u786c\u7f16\u7801\uff0c\u4f7f\u7528 java.util.logging \u67b6\u6784\u3002\u8fd9\u80fd\u4fdd\u8bc1Tomcat \u5185\u90e8\u65e5\u5fd7\u4e0e Web \u5e94\u7528\u7684\u65e5\u5fd7\u4fdd\u6301\u72ec\u7acb\uff0c\u5373\u4f7f Web \u5e94\u7528\u4f7f\u7528\u7684\u662f Apache Commons Logging\u3002</p> </li> </ul>"},{"location":"web/backend/servlet_container.html#nio","title":"NIO","text":"<ul> <li>tomcat \u7684 org.apache.coyote.http11.Http11NioProtocol \u7684Connector\u662f\u4e00\u4e2a\u4f7f\u7528 Java NIO \u5b9e\u73b0\u7684\u5f02\u6b65 accept \u8bf7\u6c42\u7684 connector\uff1b</li> <li>\u5c06 IO \u7ebf\u7a0b\u548c \u4e1a\u52a1\u7ebf\u7a0b\u5206\u5f00\uff1b</li> <li>\u4f7f\u7528\u56fa\u5b9a\u7684 acceptThread (\u7f51\u7edc IO \u7ebf\u7a0b, \u8d1f\u8d23 accept, read, write) \u6765\u5f02\u6b65\u5904\u7406(nio accept, read, write) n \u4e2a\u8bf7\u6c42, \u7136\u540e\u5c06\u8bf7\u6c42\u5165\u961f, \u6700\u540e\u4f7f\u7528\u56fa\u5b9a\u7684requestProcessingThread (\u4e1a\u52a1\u7ebf\u7a0b) \u6765\u5904\u7406\u4e1a\u52a1\u903b\u8f91, \u4e1a\u52a1\u903b\u8f91\u7684\u5904\u7406\u5b9e\u9645\u4e0a\u4e5f\u662f\u540c\u6b65\u7684\uff1b</li> </ul>"},{"location":"web/backend/servlet_container.html#undertow","title":"UnderTow","text":"<p>\u91c7\u7528 Java \u5f00\u53d1\u7684\u7075\u6d3b\u7684\u9ad8\u6027\u80fd Web \u670d\u52a1\u5668\uff0c\u63d0\u4f9b\u5305\u62ec\u963b\u585e\u548c\u57fa\u4e8e NIO \u7684\u975e\u5835\u585e\u673a\u5236\u3002</p>"},{"location":"web/backend/statemachine.html","title":"\u72b6\u6001\u673a","text":"<p>\u6709\u9650\u72b6\u6001\u673a\uff08FSM\uff09\uff1aFinite State Machine</p> <p><code>StateMachine&lt;States, Events&gt;</code></p> <ul> <li>States\uff1a\u72b6\u6001</li> <li>Events\uff1a\u4e8b\u4ef6</li> </ul> <p>\u5b9a\u4e49 transitions \uff1a</p> <ul> <li>\u5f53\u524d\u72b6\u6001 + \u4e8b\u4ef6 =&gt; \u4e0b\u4e00\u4e2a\u72b6\u6001</li> </ul> <p>\u5b9a\u4e49\u52a8\u4f5c\uff1a</p> <ul> <li>\u8fdb\u5165\u72b6\u6001\u7684\u52a8\u4f5c\u3001\u79bb\u5f00\u72b6\u6001\u7684\u52a8\u4f5c\u3001\u6267\u884c\u4e8b\u4ef6\u7684\u52a8\u4f5c\uff1b</li> </ul>"},{"location":"web/backend/statemachine.html#stateless4j","title":"stateless4j","text":"<p>Lightweight Java State Machine.</p> <ul> <li>\u65e0\u5176\u4ed6\u4f9d\u8d56\uff1b</li> <li>\u8db3\u591f\u8f7b\u91cf\uff0c\u521b\u5efaStateMachine\u5b9e\u4f8b\u5f00\u9500\u5c0f\uff1b</li> <li>\u652f\u6301\u76ee\u6807\u72b6\u6001\u7684\u52a8\u6001\u8bbe\u7f6e\uff08\u5373\u7531\u51fd\u6570\u786e\u5b9a\uff1b</li> <li>Action \u540c\u6b65\u4e14\u5728\u8c03\u7528\u7ebf\u7a0b\u4e2d\u6267\u884c\uff08\u5373\u65e0\u7ebf\u7a0b\u6c60\uff09\uff1b</li> <li>\u6301\u4e45\u5316\u72b6\u6001\u9700\u5e94\u7528\u7aef\u5b9e\u73b0\uff0c\u5b9e\u73b0\u6bd4\u8f83\u9ebb\u70e6\uff1b</li> </ul>"},{"location":"web/backend/statemachine.html#spring-statemachine","title":"Spring Statemachine","text":"<p>a common infrastructure to work with state machine concepts in Spring applications.</p> <ul> <li>\u652f\u6301\u6301\u4e45\u5316\uff1b</li> <li>\u5206\u5c42\u72b6\u6001\u673a\u7ed3\u6784\uff1b</li> <li>\u652f\u6301\u5206\u5e03\u5f0f\u72b6\u6001\u673a\uff1b</li> <li>\u6ce8\u89e3\u58f0\u660e\uff0c\u529f\u80fd\u4e30\u5bcc\uff0c\u540c\u65f6\u4e0a\u624b\u8f83\u590d\u6742\uff1b</li> <li>\u72b6\u6001\u673a\u5b9e\u4f8b\u4e0d\u80fd\u5355\u4f8b\u4f7f\u7528\uff0c\u7ebf\u7a0b\u4e0d\u5b89\u5168\uff0c\u914d\u5408\u5de5\u5382\u6a21\u5f0f\uff1b</li> </ul> <p>\u6bcf\u6b21\u8bf7\u6c42\u90fd\u8981\u5148\u6784\u9020\u51fa\u4e00\u4e2a\u72b6\u6001\u673a\u5b9e\u4f8b\uff08\u56e0\u4e3a\u6709\u72b6\u6001\uff09\uff0c\u5e76\u91cd\u7f6e\u4e3a\u4e4b\u524d\u7684\u72b6\u6001\uff0c\u7136\u540e\u518d\u8fdb\u884c\u72b6\u6001\u6d41\u8f6c\uff0c\u5982\u679c\u6784\u9020\u72b6\u6001\u673a\u590d\u6742\uff0c\u4f1a\u5f71\u54cd\u7cfb\u7edf\u7684QPS\uff0c\u5927\u91cf\u7684\u72b6\u6001\u673a\u5b9e\u4f8b\u4e5f\u53ef\u80fd\u4f1a\u5e26\u6765GC\u7b49\u95ee\u9898\u3002</p> <ul> <li>\u4f7f\u7528\u5de5\u5382\u65b9\u5f0f\u5bf9\u4e8e\u7c7b\u4f3c\u8ba2\u5355\u7b49\u573a\u666fStateMachineFactory\u7f13\u5b58\u8ba2\u5355\u5bf9\u5e94\u7684\u72b6\u6001\u673a\u5b9e\u4f8b\u610f\u4e49\u4e0d\u5927</li> </ul>"},{"location":"web/backend/statemachine.html#squirrel","title":"squirrel","text":"<p>a State Machine library, which provided a lightweight, easy use, type safe and programmable state machine implementation for Java.</p> <ul> <li>StateMachine\u5b9e\u4f8b\u521b\u5efa\u5f00\u9500\u5c0f\uff0c\u8bbe\u8ba1\u4e0a\u5c31\u4e0d\u652f\u6301\u5355\u4f8b\u590d\u7528\uff1b</li> <li>\u652f\u6301\u5c42\u6b21\u5316\u72b6\u6001\u673a\uff1b</li> <li>\u652f\u6301 \u5916\u90e8\u72b6\u6001\u8f6c\u6362\uff08\u5373\u72b6\u6001\u53d1\u751f\u53d8\u66f4\uff09\u548c\u5185\u90e8\u72b6\u6001\u8f6c\u6362\uff08\u5373\u53d1\u751f\u4e8b\u4ef6\u4f46\u72b6\u6001\u4e0d\u53d8\u66f4\uff09\uff1b</li> <li>\u652f\u6301\u6761\u4ef6\u8f6c\u6362\uff0c\u65e2\u6ee1\u8db3\u67d0\u4e2a\u6761\u4ef6\uff0c\u624d\u8fdb\u884c\u72b6\u6001\u8f6c\u6362\uff1b</li> <li>Action \u7684\u6267\u884c\uff0c\u652f\u6301\u540c\u6b65\u548c\u5f02\u6b65\uff1b</li> <li>\u652f\u6301\u6ce8\u89e3\u914d\u7f6e onEntry/OnExit \u548c Transition\uff1b</li> <li>\u5bf9 Action \u7684\u6267\u884c\uff0c\u548cTransition\u7684\u6267\u884c\uff0c\u90fd\u5b9a\u4e49\u76f8\u5173\u7684Before/After\u7684Hook\uff1b</li> </ul> <p>\u914d\u7f6e\uff1a</p> <ul> <li>\u9ed8\u8ba4\u662f\u4e00\u4e2a\u7ebf\u7a0b\u7684ExecutorServices\uff0c\u4e14 Action \u9ed8\u8ba4\u4e3a\u540c\u6b65\uff1b</li> </ul>"},{"location":"web/backend/template_engine.html","title":"\u6a21\u677f\u5f15\u64ce","text":""},{"location":"web/backend/template_engine.html#apache-velocity","title":"Apache Velocity","text":"<p>\"#\"\uff1a\u7528\u6765\u6807\u8bc6Velocity\u7684\u811a\u672c\u8bed\u53e5\uff0c\u6bd4\u5982\uff1a<code>#set\u3001#if \u3001#else\u3001#end\u3001#foreach\u3001#end\u3001#iinclude\u3001#parse\u3001#macro</code>\u7b49\uff1b</p> <p>\u201d$\"\uff1a\u53d8\u91cf\u4f7f\u7528\uff0c\u5982<code>$name</code></p> <p>\u4f7f\u7528\u793a\u4f8b\uff1avelocity</p>"},{"location":"web/backend/template_engine.html#apache-freemarker","title":"Apache FreeMarker","text":""},{"location":"web/backend/template_engine.html#go-template","title":"Go Template","text":"<p>go \u539f\u751f\u7684 <code>text/template</code>\u5305</p> <p>\u4f7f\u7528\u793a\u4f8b\uff1ago template</p>"},{"location":"web/backend/shiro/shiro.html","title":"Apache Shiro","text":"<p>\u5f00\u6e90\u5b89\u5168\u6846\u67b6\uff0c\u5904\u7406\u8eab\u4efd\u9a8c\u8bc1\uff0c\u6388\u6743\uff0c\u4f01\u4e1a\u4f1a\u8bdd\u7ba1\u7406\u548c\u52a0\u5bc6\u3002</p> <p></p> <p>\u521b\u5efa<code>SecurityManager</code>\u5b89\u5168\u7ba1\u7406\u5668 -&gt; \u4e3b\u4f53<code>Subject</code>\u63d0\u4ea4\u8ba4\u8bc1\u4fe1\u606f -&gt; <code>SecurityManager</code>\u5b89\u5168\u7ba1\u7406\u5668\u8ba4\u8bc1 -&gt;  <code>SecurityManager</code>\u8c03\u7528<code>Authenticator</code>\u8ba4\u8bc1\u5668\u8ba4\u8bc1 -&gt;<code>Realm</code>\u9a8c\u8bc1</p> <p>Subject</p> <p>\u4e3b\u4f53\uff0c\u4ee3\u8868\u4e86\u5f53\u524d\u201c\u7528\u6237\u201d\uff1b\u6240\u6709<code>Subject</code>\u90fd\u7ed1\u5b9a\u5230<code>SecurityManager</code>\uff0c\u4e0e<code>Subject</code>\u7684\u6240\u6709\u4ea4\u4e92\u90fd\u4f1a\u59d4\u6258\u7ed9<code>SecurityManager</code>\uff1b</p> <p>SecurityManager</p> <p>\u6240\u6709\u4e0e\u5b89\u5168\u6709\u5173\u7684\u64cd\u4f5c\u90fd\u4f1a\u4e0e<code>SecurityManager</code>\u4ea4\u4e92\uff1b\u4e14\u5b83\u7ba1\u7406\u7740\u6240\u6709<code>Subject</code>\uff1b\u8d1f\u8d23\u4e0e\u540e\u8fb9\u4ecb\u7ecd\u7684\u5176\u4ed6\u7ec4\u4ef6\u8fdb\u884c\u4ea4\u4e92\u3002</p> <p>Realms</p> <p>\u57df\uff0cShiro\u4ece\u4ece<code>Realm</code>\u83b7\u53d6\u5b89\u5168\u6570\u636e\uff08\u5982\u7528\u6237\u3001\u89d2\u8272\u3001\u6743\u9650\uff09\uff0c\u5c31\u662f\u8bf4<code>SecurityManager</code>\u8981\u9a8c\u8bc1\u7528\u6237\u8eab\u4efd\uff0c\u90a3\u4e48\u5b83\u9700\u8981\u4ece<code>Realm</code>\u83b7\u53d6\u76f8\u5e94\u7684\u7528\u6237\u8fdb\u884c\u6bd4\u8f83\u4ee5\u786e\u5b9a\u7528\u6237\u8eab\u4efd\u662f\u5426\u5408\u6cd5\uff1b\u4e5f\u9700\u8981\u4ece<code>Realm</code>\u5f97\u5230\u7528\u6237\u76f8\u5e94\u7684\u89d2\u8272/\u6743\u9650\u8fdb\u884c\u9a8c\u8bc1\u7528\u6237\u662f\u5426\u80fd\u8fdb\u884c\u64cd\u4f5c\uff1b\u53ef\u4ee5\u628aRealm\u770b\u6210<code>DataSource</code>\uff0c\u5373\u5b89\u5168\u6570\u636e\u6e90\u3002</p>"},{"location":"web/backend/shiro/shiro.html#_1","title":"\u5185\u7f6e\u7684\u8fc7\u6ee4\u5668","text":"<p>authc\uff1a\u6240\u6709\u5df2\u767b\u9646\u7528\u6237\u53ef\u8bbf\u95ee</p> <p>roles\uff1a\u6709\u6307\u5b9a\u89d2\u8272\u7684\u7528\u6237\u53ef\u8bbf\u95ee\uff0c\u901a\u8fc7[ ]\u6307\u5b9a\u5177\u4f53\u89d2\u8272\uff0c\u8fd9\u91cc\u7684\u89d2\u8272\u540d\u79f0\u4e0e\u6570\u636e\u5e93\u4e2d\u914d\u7f6e\u4e00\u81f4</p> <p>perms\uff1a\u6709\u6307\u5b9a\u6743\u9650\u7684\u7528\u6237\u53ef\u8bbf\u95ee\uff0c\u901a\u8fc7[ ]\u6307\u5b9a\u5177\u4f53\u6743\u9650\uff0c\u8fd9\u91cc\u7684\u6743\u9650\u540d\u79f0\u4e0e\u6570\u636e\u5e93\u4e2d\u914d\u7f6e\u4e00\u81f4</p> <p>anon\uff1a\u6240\u6709\u7528\u6237\u53ef\u8bbf\u95ee\uff0c\u901a\u5e38\u4f5c\u4e3a\u6307\u5b9a\u9875\u9762\u7684\u9759\u6001\u8d44\u6e90\u65f6\u4f7f\u7528</p>"},{"location":"web/backend/spring/basic.html","title":"\u57fa\u7840","text":""},{"location":"web/backend/spring/basic.html#bean","title":"Bean","text":""},{"location":"web/backend/spring/basic.html#_2","title":"\u6ce8\u518c","text":""},{"location":"web/backend/spring/basic.html#configuration-bean","title":"@Configuration + @Bean","text":"<pre><code>@Configuration\npublic class MyConfiguration {\n    @Bean\n    public Person person() {\n        Person person = new Person();\n        person.setName(\"spring\");\n        return person;\n    }\n}\n</code></pre>"},{"location":"web/backend/spring/basic.html#componet-componentscan","title":"@Componet + @ComponentScan","text":"<pre><code>@Component\n@Data\npublic class Person {\n    private String name;\n}\n\n@ComponentScan(basePackages = \"com.springboot.initbean.*\")\npublic class Demo1 {\n    public static void main(String[] args) {\n        AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(Demo1.class);\n        Person bean = applicationContext.getBean(Person.class);\n        System.out.println(bean);\n    }\n}\n</code></pre>"},{"location":"web/backend/spring/basic.html#import","title":"@Import\u6ce8\u89e3\u5bfc\u5165","text":"<p>\u76f4\u63a5\u4f7f\u7528</p> <pre><code>// Person\u7c7b\u4e0a\u4e0d\u9700\u8981@Component\u6ce8\u89e3\n@Data\npublic class Person {\n    private String name;\n}\n/**\n* \u76f4\u63a5\u4f7f\u7528@Import\u5bfc\u5165person\u7c7b\uff0c\u7136\u540e\u5c1d\u8bd5\u4eceapplicationContext\u4e2d\u53d6\uff0c\u6210\u529f\u62ff\u5230\n**/\n@Import(Person.class)\npublic class Demo1 {\n    public static void main(String[] args) {\n        AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(Demo1.class);\n        Person bean = applicationContext.getBean(Person.class);\n        System.out.println(bean);\n    }\n}\n</code></pre> <p>@ImportSelector\u5b9a\u4e49\u52a0\u8f7d\u7684\u7c7b</p> <pre><code>@Import(MyImportSelector.class)\npublic class Demo1 {\n\n    public static void main(String[] args) {\n        AnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(Demo1.class);\n        Person bean = applicationContext.getBean(Person.class);\n        System.out.println(bean);\n    }\n}\nclass MyImportSelector implements ImportSelector {\n    @Override\n    public String[] selectImports(AnnotationMetadata importingClassMetadata) {\n        return new String[]{\"com.springboot.pojo.Person\"};\n    }\n}\n</code></pre>"},{"location":"web/backend/spring/basic.html#_3","title":"\u8d44\u6e90\u6e05\u7406","text":"<p>\u9000\u51fa\u5bb9\u5668\u65f6\u6267\u884c\u64cd\u4f5c\uff0c\u901a\u8fc7</p> <ul> <li>\u7ee7\u627fDisposableBean\u5b9e\u73b0\uff0c\u6216</li> <li>\u6ce8\u89e3@PreDestory\u5b9e\u73b0</li> </ul>"},{"location":"web/backend/spring/basic.html#_4","title":"\u6821\u9a8c","text":""},{"location":"web/backend/spring/basic.html#valid-validated","title":"@Valid \u548c @Validated \u6bd4\u8f83","text":"<ul> <li>@Valid \u548c @Validated \u4e24\u8005\u90fd\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u6821\u9a8c\uff0c\u5f85\u6821\u9a8c\u5b57\u6bb5\u4e0a\u6253\u7684\u89c4\u5219\u6ce8\u89e3\uff08@NotNull, @NotEmpty\u7b49\uff09\u90fd\u53ef\u4ee5\u5bf9 @Valid \u548c @Validated \u751f\u6548\uff1b</li> <li>@Valid \u8fdb\u884c\u6821\u9a8c\u7684\u65f6\u5019\uff0c\u9700\u8981\u7528 BindingResult \u6765\u505a\u4e00\u4e2a\u6821\u9a8c\u7ed3\u679c\u63a5\u6536\u3002\u5f53\u6821\u9a8c\u4e0d\u901a\u8fc7\u7684\u65f6\u5019\uff0c\u5982\u679c\u624b\u52a8\u4e0d return \uff0c\u5219\u5e76\u4e0d\u4f1a\u963b\u6b62\u7a0b\u5e8f\u7684\u6267\u884c\uff1b</li> <li>@Validated \u5f53\u6821\u9a8c\u4e0d\u901a\u8fc7\u7684\u65f6\u5019\uff0c\u7a0b\u5e8f\u4f1a\u629b\u51faBindException\uff0c\u963b\u6b62\u65b9\u6cd5\u4e2d\u7684\u4ee3\u7801\u6267\u884c\uff0c\u9700\u8981\u518d\u5199\u4e00\u4e2a\u5168\u5c40\u6821\u9a8c\u5f02\u5e38\u6355\u83b7\u5904\u7406\u7c7b\uff0c\u7136\u540e\u8fd4\u56de\u6821\u9a8c\u63d0\u793a\u3002</li> </ul> <pre><code>@RestControllerAdvice\n@ResponseBody\npublic class ValidExceptionHandler {\n\n    @ExceptionHandler(BindException.class)\n    public  Result&lt;String&gt; validExceptionHandler(BindException exception) {\n        return Result.fail(HttpStatus.BAD_REQUEST.value(), e.getAllErrors().get(0).getDefaultMessage());\n    }\n}\n</code></pre>"},{"location":"web/backend/spring/reactor.html","title":"Reactor","text":"<p>Reactive\uff08\u53cd\u5e94\u5f0f\u7f16\u7a0b\uff09\uff1a\u89c2\u5bdf\u8005\u6a21\u5f0f\uff0c\u201c\u63a8\u201d \u673a\u5236\uff1b</p> <p>Imperative\uff08\u6307\u4ee4\u5f0f\u7f16\u7a0b\uff09\uff1a\u8fed\u4ee3\u5668\u6a21\u5f0f\uff0c\u201c\u62c9\u201d\u673a\u5236\uff1b</p> <p>\u4e24\u4e2a\u4e3b\u8981\u7684\u6a21\u5757\uff1areactor-core \u548c reactor-ipc\u3002\u524d\u8005\u4e3b\u8981\u8d1f\u8d23 Reactive Programming \u76f8\u5173\u7684\u6838\u5fc3 API \u7684\u5b9e\u73b0\uff0c\u540e\u8005\u8d1f\u8d23\u9ad8\u6027\u80fd\u7f51\u7edc\u901a\u4fe1\u7684\u5b9e\u73b0\uff0c\u76ee\u524d\u662f\u57fa\u4e8e Netty \u5b9e\u73b0\u7684\u3002</p>"},{"location":"web/backend/spring/reactor.html#_1","title":"\u6982\u5ff5","text":"<p>Reactive Streams \u662f\u89c4\u8303\uff0cReactor \u5b9e\u73b0\u4e86 Reactive Streams\u3002Web Flux \u4ee5 Reactor \u4e3a\u57fa\u7840\uff0c\u5b9e\u73b0 Web \u9886\u57df\u7684\u53cd\u5e94\u5f0f\u7f16\u7a0b\u6846\u67b6\u3002</p> <p>\u5728 Java \u5e73\u53f0\u4e0a\uff0cNetflix\uff08\u5f00\u53d1\u4e86 RxJava\uff09\u3001TypeSafe\uff08\u5f00\u53d1\u4e86 Scala\u3001Akka\uff09\u3001Pivatol\uff08\u5f00\u53d1\u4e86 Spring\u3001Reactor\uff09\u5171\u540c\u5236\u5b9a\u4e86\u4e00\u4e2a\u88ab\u79f0\u4e3a Reactive Streams \u9879\u76ee\uff08\u89c4\u8303\uff09\uff0c\u7528\u4e8e\u5236\u5b9a\u53cd\u5e94\u5f0f\u7f16\u7a0b\u76f8\u5173\u7684\u89c4\u8303\u4ee5\u53ca\u63a5\u53e3\u3002\u5176\u4e3b\u8981\u7684\u63a5\u53e3\u6709\u8fd9\u4e09\u4e2a\uff1a</p> <ul> <li><code>Publisher</code></li> <li><code>Subscriber</code></li> <li><code>Subcription</code></li> <li><code>Processor</code></li> </ul> <p>\u5176\u4e2d\uff0c<code>Subcriber</code> \u4e2d\u5305\u542b <code>onNext</code>\u3001<code>onError</code>\u3001<code>onCompleted</code> \u8fd9\u4e09\u4e2a\u65b9\u6cd5\u3002</p> <ul> <li>\u5982\u679c Publisher \u53d1\u5e03\u6d88\u606f\u592a\u5feb\u4e86\uff0c\u8d85\u8fc7\u4e86 Subscriber \u7684\u5904\u7406\u901f\u5ea6\uff0c Backpressure \u63a7\u5236\u6d88\u8d39\u6d88\u606f\u7684\u901f\u5ea6\uff1b</li> <li><code>Scheduler</code> \u8868\u793a\u80cc\u540e\u9a71\u52a8\u53cd\u5e94\u5f0f\u6d41\u7684\u8c03\u5ea6\u5668\uff0c\u901a\u5e38\u7531\u5404\u79cd\u7ebf\u7a0b\u6c60\u5b9e\u73b0</li> </ul>"},{"location":"web/backend/spring/reactor.html#_2","title":"\u4f7f\u7528","text":"<p><code>Mono</code> \u5b9e\u73b0\u4e86 <code>org.reactivestreams.Publisher</code> \u63a5\u53e3\uff0c\u4ee3\u88680\u52301\u4e2a\u5143\u7d20\u7684\u53d1\u5e03\u8005\u3002</p> <p><code>Flux</code> \u540c\u6837\u5b9e\u73b0\u4e86 <code>org.reactivestreams.Publisher</code> \u63a5\u53e3\uff0c\u4ee3\u88680\u5230N\u4e2a\u5143\u7d20\u7684\u53d1\u8868\u8005\u3002</p>"},{"location":"web/backend/spring/reactor.html#_3","title":"\u521b\u5efa","text":"<p><code>just</code>\u3001<code>fromXXX</code>\u3001<code>create</code>\u3002</p> <pre><code>Mono&lt;String&gt; helloWorld = Mono.just(\"Hello World\");\nFlux&lt;String&gt; fewWords = Flux.just(\"Hello\", \"World\");\nFlux&lt;String&gt; manyWords = Flux.fromIterable(words);\n</code></pre>"},{"location":"web/backend/spring/reactor.html#_4","title":"\u8f6c\u6362","text":"<p>\u4e2d\u95f4\u9636\u6bb5\u7684 Mono \u548c Flux \u7684\u65b9\u6cd5\u4e3b\u8981\u6709 <code>filter</code>\u3001<code>map</code>\u3001<code>flatMap</code>\u3001<code>then</code>\u3001<code>zip</code>\u3001<code>reduce</code> \u7b49</p> <ul> <li><code>zip</code>\uff1a\u5e76\u53d1\u6267\u884c\uff0c\u5982\u5bf9\u4e24\u4e2a Mono \u7684\u6267\u884c\u5e76\u53d1\uff0c\u5e76\u505a\u5904\u7406\uff1b</li> </ul>"},{"location":"web/backend/spring/reactor.html#_5","title":"\u5206\u652f","text":"<p><code>switchIfEmpty</code>\uff1aFallback to an alternative Mono if this mono is completed without data\u3002</p> <p>\u4f7f\u7528 flatmap \u548c then \u6a21\u62df \u987a\u5e8f+\u5206\u652f \u4ee3\u7801\uff1b</p> <pre><code>status\n    .flatMap(s -&gt; {\n        System.out.println(\"handle status\");\n        if (s != 0) {\n            return Mono.error(new RuntimeException(\"status is not illegal\"));\n        }\n\n        return Mono.empty();\n    })\n    .then(Mono.just(0)\n            .flatMap(s -&gt; {\n                System.out.println(\"handle right\");\n                if (s != 0) {\n                    return Mono.error(new RuntimeException(\"token is expired\"));\n                }\n\n                return Mono.empty();\n            }));\n</code></pre>"},{"location":"web/backend/spring/reactor.html#_6","title":"\u7ed3\u675f","text":"<p>\u76f4\u63a5\u6d88\u8d39\u7684 Mono \u6216 Flux \u7684\u65b9\u5f0f\u5c31\u662f\u8c03\u7528 <code>subscribe</code> \u65b9\u6cd5\u3002</p>"},{"location":"web/backend/spring/spel.html","title":"Spring Expression Language","text":"<p>\u8868\u8fbe\u5f0f\u8bed\u8a00\u7ed9\u9759\u6001Java\u8bed\u8a00\u589e\u52a0\u4e86\u52a8\u6001\u529f\u80fd\u3002</p> <p>SpEL\u662f\u5355\u72ec\u6a21\u5757\uff0c\u53ea\u4f9d\u8d56\u4e8ecore\u6a21\u5757\uff0c\u4e0d\u4f9d\u8d56\u4e8e\u5176\u4ed6\u6a21\u5757\uff0c\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\u3002</p> <p>SpEL\u652f\u6301\u5982\u4e0b\u8868\u8fbe\u5f0f\uff1a</p> <p>\u4e00\u3001\u57fa\u672c\u8868\u8fbe\u5f0f\uff1a \u5b57\u9762\u91cf\u8868\u8fbe\u5f0f\u3001\u5173\u7cfb\uff0c\u903b\u8f91\u4e0e\u7b97\u6570\u8fd0\u7b97\u8868\u8fbe\u5f0f\u3001\u5b57\u7b26\u4e32\u8fde\u63a5\u53ca\u622a\u53d6\u8868\u8fbe\u5f0f\u3001\u4e09\u76ee\u8fd0\u7b97\u53caElivis\u8868\u8fbe\u5f0f\u3001\u6b63\u5219\u8868\u8fbe\u5f0f\u3001\u62ec\u53f7\u4f18\u5148\u7ea7\u8868\u8fbe\u5f0f\uff1b</p> <p>\u4e8c\u3001\u7c7b\u76f8\u5173\u8868\u8fbe\u5f0f\uff1a \u7c7b\u7c7b\u578b\u8868\u8fbe\u5f0f\u3001\u7c7b\u5b9e\u4f8b\u5316\u3001instanceof\u8868\u8fbe\u5f0f\u3001\u53d8\u91cf\u5b9a\u4e49\u53ca\u5f15\u7528\u3001\u8d4b\u503c\u8868\u8fbe\u5f0f\u3001\u81ea\u5b9a\u4e49\u51fd\u6570\u3001\u5bf9\u8c61\u5c5e\u6027\u5b58\u53d6\u53ca\u5b89\u5168\u5bfc\u822a\u8868\u8fbe\u5f0f\u3001\u5bf9\u8c61\u65b9\u6cd5\u8c03\u7528\u3001Bean\u5f15\u7528\uff1b</p> <p>\u4e09\u3001\u96c6\u5408\u76f8\u5173\u8868\u8fbe\u5f0f\uff1a \u5185\u8054List\u3001\u5185\u8054\u6570\u7ec4\u3001\u96c6\u5408\uff0c\u5b57\u5178\u8bbf\u95ee\u3001\u5217\u8868\uff0c\u5b57\u5178\uff0c\u6570\u7ec4\u4fee\u6539\u3001\u96c6\u5408\u6295\u5f71\u3001\u96c6\u5408\u9009\u62e9\uff1b\u4e0d\u652f\u6301\u591a\u7ef4\u5185\u8054\u6570\u7ec4\u521d\u59cb\u5316\uff1b\u4e0d\u652f\u6301\u5185\u8054\u5b57\u5178\u5b9a\u4e49\uff1b</p> <p>\u56db\u3001\u5176\u4ed6\u8868\u8fbe\u5f0f\uff1a\u6a21\u677f\u8868\u8fbe\u5f0f\u3002</p> <p>\u6ce8\uff1aSpEL\u8868\u8fbe\u5f0f\u4e2d\u7684\u5173\u952e\u5b57\u662f\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\u3002</p>"},{"location":"web/backend/spring/spel.html#_1","title":"\u793a\u4f8b","text":"<pre><code>import org.junit.Test;\nimport org.springframework.expression.EvaluationContext;\nimport org.springframework.expression.Expression;\nimport org.springframework.expression.ExpressionParser;\nimport org.springframework.expression.spel.standard.SpelExpressionParser;\nimport org.springframework.expression.spel.support.StandardEvaluationContext;\n\npublic class SpelTest {\n    @Test\n    public void test1() {\n        ExpressionParser parser = new SpelExpressionParser();\n        Expression expression = parser.parseExpression(\"('Hello' + ' World').concat(#end)\");\n        EvaluationContext context = new StandardEvaluationContext();\n        context.setVariable(\"end\", \"!\");\n        System.out.println(expression.getValue(context));\n    }\n}\n</code></pre> <p>1\uff09\u521b\u5efa\u89e3\u6790\u5668\uff1aSpEL\u4f7f\u7528ExpressionParser\u63a5\u53e3\u8868\u793a\u89e3\u6790\u5668\uff0c\u63d0\u4f9bSpelExpressionParser\u9ed8\u8ba4\u5b9e\u73b0\uff1b</p> <p>2\uff09\u89e3\u6790\u8868\u8fbe\u5f0f\uff1a\u4f7f\u7528ExpressionParser\u7684parseExpression\u6765\u89e3\u6790\u76f8\u5e94\u7684\u8868\u8fbe\u5f0f\u4e3aExpression\u5bf9\u8c61\u3002</p> <p>3\uff09\u6784\u9020\u4e0a\u4e0b\u6587\uff1a\u51c6\u5907\u6bd4\u5982\u53d8\u91cf\u5b9a\u4e49\u7b49\u7b49\u8868\u8fbe\u5f0f\u9700\u8981\u7684\u4e0a\u4e0b\u6587\u6570\u636e\u3002</p> <p>4\uff09\u6c42\u503c\uff1a\u901a\u8fc7Expression\u63a5\u53e3\u7684getValue\u65b9\u6cd5\u6839\u636e\u4e0a\u4e0b\u6587\u83b7\u5f97\u8868\u8fbe\u5f0f\u503c\u3002</p>"},{"location":"web/backend/spring/spel.html#_2","title":"\u539f\u7406","text":"<ol> <li>\u9996\u5148\u5b9a\u4e49\u8868\u8fbe\u5f0f\uff1a\u201c1+2\u201d\uff1b</li> <li>\u5b9a\u4e49\u89e3\u6790\u5668<code>ExpressionParser</code>\u5b9e\u73b0\uff0cSpEL\u63d0\u4f9b\u9ed8\u8ba4\u5b9e\u73b0<code>SpelExpressionParser</code>\uff1b</li> <li><code>SpelExpressionParser</code>\u89e3\u6790\u5668\u5185\u90e8\u4f7f\u7528<code>Tokenizer</code>\u7c7b\u8fdb\u884c\u8bcd\u6cd5\u5206\u6790\uff0c\u5373\u628a\u5b57\u7b26\u4e32\u6d41\u5206\u6790\u4e3a\u8bb0\u53f7\u6d41\uff0c\u8bb0\u53f7\u5728SpEL\u4f7f\u7528<code>Token</code>\u7c7b\u6765\u8868\u793a\uff1b</li> <li>\u6709\u4e86\u8bb0\u53f7\u6d41\u540e\uff0c\u89e3\u6790\u5668\u4fbf\u53ef\u6839\u636e\u8bb0\u53f7\u6d41\u751f\u6210\u5185\u90e8\u62bd\u8c61\u8bed\u6cd5\u6811\uff1b\u5728SpEL\u4e2d\u8bed\u6cd5\u6811\u8282\u70b9\u7531<code>SpelNode</code>\u63a5\u53e3\u5b9e\u73b0\u4ee3\u8868\uff1a\u5982<code>OpPlus</code>\u8868\u793a\u52a0\u64cd\u4f5c\u8282\u70b9\u3001<code>IntLiteral</code>\u8868\u793aint\u578b\u5b57\u9762\u91cf\u8282\u70b9\uff1b\u4f7f\u7528<code>SpelNodel</code>\u5b9e\u73b0\u7ec4\u6210\u4e86\u62bd\u8c61\u8bed\u6cd5\u6811\uff1b</li> <li>\u5bf9\u5916\u63d0\u4f9bExpression\u63a5\u53e3\u6765\u7b80\u5316\u8868\u793a\u62bd\u8c61\u8bed\u6cd5\u6811\uff0c\u4ece\u800c\u9690\u85cf\u5185\u90e8\u5b9e\u73b0\u7ec6\u8282\uff0c\u5e76\u63d0\u4f9b<code>getValue</code>\u7b80\u5355\u65b9\u6cd5\u7528\u4e8e\u83b7\u53d6\u8868\u8fbe\u5f0f\u503c\uff1bSpEL\u63d0\u4f9b\u9ed8\u8ba4\u5b9e\u73b0\u4e3aSpelExpression\uff1b</li> <li>3.\u5b9a\u4e49\u8868\u8fbe\u5f0f\u4e0a\u4e0b\u6587\u5bf9\u8c61\uff08\u53ef\u9009\uff09\uff0cSpEL\u4f7f\u7528<code>EvaluationContext</code>\u63a5\u53e3\u8868\u793a\u4e0a\u4e0b\u6587\u5bf9\u8c61\uff0c\u7528\u4e8e\u8bbe\u7f6e\u6839\u5bf9\u8c61\u3001\u81ea\u5b9a\u4e49\u53d8\u91cf\u3001\u81ea\u5b9a\u4e49\u51fd\u6570\u3001\u7c7b\u578b\u8f6c\u6362\u5668\u7b49\uff0cSpEL\u63d0\u4f9b\u9ed8\u8ba4\u5b9e\u73b0<code>StandardEvaluationContext</code>\uff1b</li> <li>4.\u4f7f\u7528\u8868\u8fbe\u5f0f\u5bf9\u8c61\u6839\u636e\u4e0a\u4e0b\u6587\u5bf9\u8c61\uff08\u53ef\u9009\uff09\u6c42\u503c\uff08\u8c03\u7528\u8868\u8fbe\u5f0f\u5bf9\u8c61\u7684<code>getValue</code>\u65b9\u6cd5\uff09\u83b7\u5f97\u7ed3\u679c\u3002</li> </ol>"},{"location":"web/backend/spring/spel.html#expressionparser","title":"ExpressionParser\u63a5\u53e3","text":"<pre><code>public interface ExpressionParser {\n Expression parseExpression(String expressionString) throws ParseException;\n // \u81ea\u5b9a\u4e49ParseContext\uff0c\u5185\u7f6e\u6709TemplateParserContext\u5b9e\u73b0\u7c7b\n Expression parseExpression(String expressionString, ParserContext context) throws ParseException;\n}\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>@Test\npublic void testParserContext() {\n    ExpressionParser parser = new SpelExpressionParser();\n    // \u5b9a\u4e49\u8868\u8fbe\u5f0f\u662f\u6a21\u5757\uff0c\u8868\u8fbe\u5f0f\u524d\u7f00\u4e3a\u201c#{\u201d\uff0c\u540e\u7f00\u4e3a\u201c}\u201d\uff1b\n    // \u4f7f\u7528parseExpression\u89e3\u6790\u65f6\u4f20\u5165\u7684\u6a21\u677f\u5fc5\u987b\u4ee5\u201c#{\u201d\u5f00\u5934\uff0c\u4ee5\u201c}\u201d\u7ed3\u5c3e\uff0c\u5982\"#{'Hello '}#{'World!'}\"\u3002\n    ParserContext parserContext = new ParserContext() {\n        @Override\n        public boolean isTemplate() {\n            return true;\n        }\n\n        @Override\n        public String getExpressionPrefix() {\n            return \"#{\";\n        }\n\n        @Override\n        public String getExpressionSuffix() {\n            return \"}\";\n        }\n    };\n    String template = \"#{'Hello '}#{'World!'}\";\n    Expression expression = parser.parseExpression(template, parserContext);\n    System.out.println(expression.getValue());\n}\n</code></pre>"},{"location":"web/backend/spring/spel.html#evaluationcontext","title":"EvaluationContext\u63a5\u53e3","text":"<p>\u8868\u793a\u4e0a\u4e0b\u6587\u73af\u5883\uff0c\u9ed8\u8ba4\u5b9e\u73b0\u662f<code>org.springframework.expression.spel.support.StandardEvaluationContext</code>\u7c7b\uff0c\u4f7f\u7528<code>setRootObject</code>\u65b9\u6cd5\u6765\u8bbe\u7f6e\u6839\u5bf9\u8c61\uff0c\u4f7f\u7528<code>setVariable</code>\u65b9\u6cd5\u6765\u6ce8\u518c\u81ea\u5b9a\u4e49\u53d8\u91cf\uff0c\u4f7f\u7528<code>registerFunction</code>\u6765\u6ce8\u518c\u81ea\u5b9a\u4e49\u51fd\u6570\u7b49\u7b49\u3002</p>"},{"location":"web/backend/spring/spel.html#expression","title":"Expression\u63a5\u53e3","text":"<p>\u8868\u793a\u8868\u8fbe\u5f0f\u5bf9\u8c61\uff0c\u9ed8\u8ba4\u5b9e\u73b0\u662f<code>org.springframework.expression.spel.standard.SpelExpression</code>\uff0c\u63d0\u4f9b<code>getValue</code>\u65b9\u6cd5\u7528\u4e8e\u83b7\u53d6\u8868\u8fbe\u5f0f\u503c\uff0c\u63d0\u4f9b<code>setValue</code>\u65b9\u6cd5\u7528\u4e8e\u8bbe\u7f6e\u5bf9\u8c61\u503c\u3002</p>"},{"location":"web/backend/spring/spel.html#_3","title":"\u8bed\u6cd5","text":""},{"location":"web/backend/spring/spel.html#_4","title":"\u57fa\u672c\u8868\u8fbe\u5f0f","text":""},{"location":"web/backend/spring/spel.html#_5","title":"\u5b57\u9762\u91cf\u8868\u8fbe\u5f0f","text":"<p>\u5b57\u9762\u91cf\u5305\u62ec\uff1a\u5b57\u7b26\u4e32\u3001\u6570\u5b57\u7c7b\u578b\uff08int\u3001long\u3001float\u3001double\uff09\u3001\u5e03\u5c14\u7c7b\u578b\u3001null\u7c7b\u578b\u3002</p> <pre><code>@Test\npublic void test2() {\n    ExpressionParser parser = new SpelExpressionParser();\n\n    String str1 = parser.parseExpression(\"'Hello World!'\").getValue(String.class);\n    int int1 = parser.parseExpression(\"1\").getValue(Integer.class);\n    long long1 = parser.parseExpression(\"-1L\").getValue(long.class);\n    double double1 = parser.parseExpression(\"1.1E+2\").getValue(double.class);\n    Object null1 = parser.parseExpression(\"null\").getValue(Object.class);\n}\n</code></pre>"},{"location":"web/backend/spring/spel.html#_6","title":"\u7b97\u6570\u8fd0\u7b97\u8868\u8fbe\u5f0f","text":"<p>SpEL\u652f\u6301\u52a0(+)\u3001\u51cf(-)\u3001\u4e58(*)\u3001\u9664(/)\u3001\u6c42\u4f59\uff08%\uff09\u3001\u5e42\uff08^\uff09\u8fd0\u7b97\u3002</p> <pre><code>int result1 = parser.parseExpression(\"1+2-3*4/2\").getValue(Integer.class);\n// \u6c42\u4f59\nint result2 = parser.parseExpression(\"4%3\").getValue(Integer.class);\n//\u5e42\u8fd0\u7b97\nint result3 = parser.parseExpression(\"2^3\").getValue(Integer.class);\n</code></pre>"},{"location":"web/backend/spring/spel.html#_7","title":"\u5173\u7cfb\u8868\u8fbe\u5f0f","text":"<p>\u7b49\u4e8e\uff08==\uff09\u3001\u4e0d\u7b49\u4e8e(!=)\u3001\u5927\u4e8e(&gt;)\u3001\u5927\u4e8e\u7b49\u4e8e(&gt;=)\u3001\u5c0f\u4e8e(&lt;)\u3001\u5c0f\u4e8e\u7b49\u4e8e(&lt;=)\uff0c\u533a\u95f4\uff08between\uff0c\u95ed\u533a\u95f4\uff09\u8fd0\u7b97\u3002</p> <pre><code>boolean result = parser.parseExpression(\"1 between {1, 2}\").getValue(boolean.class);\n</code></pre>"},{"location":"web/backend/spring/spel.html#_8","title":"\u903b\u8f91\u8868\u8fbe\u5f0f","text":"<p>\u4e14\uff08and\u6216\u8005&amp;&amp;\uff09\u3001\u6216(or\u6216\u8005||)\u3001\u975e(!\u6216NOT)\u3002</p>"},{"location":"web/backend/spring/spel.html#_9","title":"\u5b57\u7b26\u4e32\u8fde\u63a5\u53ca\u622a\u53d6\u8868\u8fbe\u5f0f","text":"<p>\u4f7f\u7528<code>+</code>\u8fdb\u884c\u5b57\u7b26\u4e32\u8fde\u63a5\uff0c\u4f7f\u7528<code>'value'[0]</code>\u6765\u622a\u53d6\u4e00\u4e2a\u5b57\u7b26\uff1b</p>"},{"location":"web/backend/spring/spel.html#_10","title":"\u4e09\u76ee\u8fd0\u7b97","text":"<p>\u4e09\u76ee\u8fd0\u7b97\u7b26 \u201c\u8868\u8fbe\u5f0f1?\u8868\u8fbe\u5f0f2:\u8868\u8fbe\u5f0f3\u201d\u7528\u4e8e\u6784\u9020\u4e09\u76ee\u8fd0\u7b97\u8868\u8fbe\u5f0f</p>"},{"location":"web/backend/spring/spel.html#elivis","title":"Elivis\u8fd0\u7b97\u7b26","text":"<p>\u201c\u8868\u8fbe\u5f0f1?:\u8868\u8fbe\u5f0f2\u201d\uff0c\u5f53\u8868\u8fbe\u5f0f1\u4e3a\u975enull\u65f6\u5219\u8fd4\u56de\u8868\u8fbe\u5f0f1\uff0c\u5f53\u8868\u8fbe\u5f0f1\u4e3anull\u65f6\u5219\u8fd4\u56de\u8868\u8fbe\u5f0f2</p>"},{"location":"web/backend/spring/spel.html#_11","title":"\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>\u4f7f\u7528<code>str matches regex</code>\uff0c\u5982<code>'123' matches '\\d{3}'</code>\u5c06\u8fd4\u56detrue\uff1b</p>"},{"location":"web/backend/spring/spel.html#_12","title":"\u62ec\u53f7\u4f18\u5148\u7ea7\u8868\u8fbe\u5f0f","text":"<p>\u4f7f\u7528\u201c(\u8868\u8fbe\u5f0f)\u201d\u6784\u9020\uff0c\u62ec\u53f7\u91cc\u7684\u5177\u6709\u9ad8\u4f18\u5148\u7ea7\u3002</p>"},{"location":"web/backend/spring/spel.html#_13","title":"\u7c7b\u76f8\u5173\u8868\u8fbe\u5f0f","text":""},{"location":"web/backend/spring/spel.html#_14","title":"\u7c7b\u7c7b\u578b\u8868\u8fbe\u5f0f","text":"<p>\u4f7f\u7528\u7c7b\u7c7b\u578b\u8868\u8fbe\u5f0f\u8fd8\u53ef\u4ee5\u8fdb\u884c\u8bbf\u95ee\u7c7b\u9759\u6001\u65b9\u6cd5\u53ca\u7c7b\u9759\u6001\u5b57\u6bb5\u3002</p> <p><code>T(Type)</code>\u6765\u8868\u793a<code>java.lang.Class</code>\u5b9e\u4f8b\uff0c<code>Type</code>\u5fc5\u987b\u662f\u7c7b\u5168\u9650\u5b9a\u540d\uff0c<code>java.lang</code>\u5305\u9664\u5916\uff0c\u5373\u8be5\u5305\u4e0b\u7684\u7c7b\u53ef\u4ee5\u4e0d\u6307\u5b9a\u5305\u540d\uff1b</p> <pre><code>@Test\npublic void testClassTypeExpression() {\n    ExpressionParser parser = new SpelExpressionParser();\n    //java.lang\u5305\u7c7b\u8bbf\u95ee\n    Class&lt;String&gt; result1 = parser.parseExpression(\"T(String)\").getValue(Class.class);\n    //\u5176\u4ed6\u5305\u7c7b\u8bbf\u95ee\n    String expression2 = \"T(com.javacode2018.spel.SpelTest)\";\n    Class&lt;SpelTest&gt; value = parser.parseExpression(expression2).getValue(Class.class);\n    //\u7c7b\u9759\u6001\u5b57\u6bb5\u8bbf\u95ee\n    int result3 = parser.parseExpression(\"T(Integer).MAX_VALUE\").getValue(int.class);\n    //\u7c7b\u9759\u6001\u65b9\u6cd5\u8c03\u7528\n    int result4 = parser.parseExpression(\"T(Integer).parseInt('1')\").getValue(int.class);\n}\n</code></pre>"},{"location":"web/backend/spring/spel.html#_15","title":"\u7c7b\u5b9e\u4f8b\u5316","text":"<p>\u7c7b\u5b9e\u4f8b\u5316\u540c\u6837\u4f7f\u7528java\u5173\u952e\u5b57<code>new</code>\uff0c\u7c7b\u540d\u5fc5\u987b\u662f\u5168\u9650\u5b9a\u540d\uff0c\u4f46java.lang\u5305\u5185\u7684\u7c7b\u578b\u9664\u5916</p> <pre><code>@Test\npublic void testConstructorExpression() {\n    ExpressionParser parser = new SpelExpressionParser();\n    String result1 = parser.parseExpression(\"new String('\u8def\u4eba\u7532java')\").getValue(String.class\n    Date result2 = parser.parseExpression(\"new java.util.Date()\").getValue(Date.class);\n}\n</code></pre>"},{"location":"web/backend/spring/spel.html#instanceof","title":"instanceof\u8868\u8fbe\u5f0f","text":"<p>\u8ddfJava\u5185\u4f7f\u7528\u540c\u4e49</p> <pre><code>@Test\npublic void testInstanceOfExpression() {\n    ExpressionParser parser = new SpelExpressionParser();\n    Boolean value = parser.parseExpression(\"'\u8def\u4eba\u7532' instanceof T(String)\").getValue(Boolean.class);\n    System.out.println(value);\n}\n</code></pre>"},{"location":"web/backend/spring/spel.html#_16","title":"\u53d8\u91cf\u5b9a\u4e49\u53ca\u5f15\u7528","text":"<p>\u5b9a\u4e49\uff1aEvaluationContext\u63a5\u53e3\u7684<code>setVariable(variableName, value)</code>\u65b9\u6cd5\u5b9a\u4e49\uff1b</p> <p>\u4f7f\u7528\uff1a<code>#variableName</code>\u5f15\u7528\uff0c\u901a\u8fc7<code>.</code>\u8c03\u7528\u7c7b\u5b9e\u4f8b\u7684\u65b9\u6cd5\uff0c\u4f7f\u7528<code>#root</code>\u5f15\u7528\u6839\u5bf9\u8c61\uff0c\u4f7f\u7528<code>#this</code>\u5f15\u7528\u5f53\u524d\u4e0a\u4e0b\u6587\u5bf9\u8c61\uff1b</p> <pre><code>@Test\npublic void testVariableExpression() {\n    ExpressionParser parser = new SpelExpressionParser();\n    EvaluationContext context = new StandardEvaluationContext();\n    context.setVariable(\"name\", \"\u8def\u4eba\u7532java\");\n    context.setVariable(\"lesson\", \"Spring\u7cfb\u5217\");\n\n    //\u83b7\u53d6name\u53d8\u91cf\uff0clesson\u8c03\u7528\u7c7b\u5b9e\u4f8b\u65b9\u6cd5\n    String name = parser.parseExpression(\"#name\").getValue(context, String.class);\n    System.out.println(name);\n    int lesson = parser.parseExpression(\"#lesson.length\").getValue(context, Integer.class);\n    System.out.println(lesson);\n\n    //StandardEvaluationContext\u6784\u9020\u5668\u4f20\u5165root\u5bf9\u8c61\uff0c\u53ef\u4ee5\u901a\u8fc7#root\u6765\u8bbf\u95eeroot\u5bf9\u8c61\n    context = new StandardEvaluationContext(\"\u6211\u662froot\u5bf9\u8c61\");\n    String rootObj = parser.parseExpression(\"#root\").getValue(context, String.class);\n    System.out.println(rootObj);  // \u6211\u662froot\u5bf9\u8c61\n\n    //#this\u7528\u6765\u8bbf\u95ee\u5f53\u524d\u4e0a\u7ebf\u6587\u4e2d\u7684\u5bf9\u8c61\n    String thisObj = parser.parseExpression(\"#this\").getValue(context, String.class);\n    System.out.println(thisObj);  // \u6211\u662froot\u5bf9\u8c61\n}\n</code></pre>"},{"location":"web/backend/spring/spel.html#_17","title":"\u81ea\u5b9a\u4e49\u51fd\u6570","text":"<p>\u53ea\u652f\u6301\u7c7b\u9759\u6001\u65b9\u6cd5\u6ce8\u518c\u4e3a\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u4f7f\u7528<code>StandardEvaluationContext</code>\u7684<code>registerFunction</code>\u65b9\u6cd5\u8fdb\u884c\u6ce8\u518c\u81ea\u5b9a\u4e49\u51fd\u6570</p> <pre><code>@Test\npublic void testFunctionExpression() throws SecurityException, NoSuchMethodException {\n    //\u5b9a\u4e492\u4e2a\u51fd\u6570,registerFunction\u548csetVariable\u90fd\u53ef\u4ee5\uff0c\u4e0d\u8fc7\u4ece\u8bed\u4e49\u4e0a\u9762\u6765\u770b\u7528registerFunction\u66f4\u6070\u5f53\n    StandardEvaluationContext context = new StandardEvaluationContext();\n    Method parseInt = Integer.class.getDeclaredMethod(\"parseInt\", String.class);\n    context.registerFunction(\"parseInt1\", parseInt);\n\n    ExpressionParser parser = new SpelExpressionParser();\n    System.out.println(parser.parseExpression(\"#parseInt1('3')\").getValue(context, int.class));\n\n    String expression1 = \"#parseInt1('3')\";\n    System.out.println(parser.parseExpression(expression1).getValue(context, boolean.class));\n}\n</code></pre>"},{"location":"web/backend/spring/spel.html#_18","title":"\u8868\u8fbe\u5f0f\u8d4b\u503c","text":"<p>\u4f7f\u7528<code>Expression#setValue</code>\u65b9\u6cd5\u53ef\u4ee5\u7ed9\u8868\u8fbe\u5f0f\u8d4b\u503c</p> <pre><code>@Test\npublic void testAssignExpression1() {\n    Object user = new Object() {\n        private String name;\n\n        public String getName() {\n            return name;\n        }\n\n        public void setName(String name) {\n            this.name = name;\n        }\n\n        @Override\n        public String toString() {\n            return \"$classname{\" +\n                    \"name='\" + name + '\\'' +\n                    '}';\n        }\n    };\n    {\n        //user\u4e3aroot\u5bf9\u8c61\n        ExpressionParser parser = new SpelExpressionParser();\n        EvaluationContext context = new StandardEvaluationContext(user);\n        parser.parseExpression(\"#root.name\").setValue(context, \"\u8def\u4eba\u7532java\");\n        System.out.println(parser.parseExpression(\"#root\").getValue(context, user.getClass()));\n    }\n    {\n        //user\u4e3a\u53d8\u91cf\n        ExpressionParser parser = new SpelExpressionParser();\n        EvaluationContext context = new StandardEvaluationContext();\n        context.setVariable(\"user\", user);\n        parser.parseExpression(\"#user.name\").setValue(context, \"\u8def\u4eba\u7532java\");\n        System.out.println(parser.parseExpression(\"#user\").getValue(context, user.getClass()));\n    }\n}\n</code></pre>"},{"location":"web/backend/spring/spel.html#_19","title":"\u5bf9\u8c61\u5c5e\u6027\u5b58\u53d6\u53ca\u5b89\u5168\u5bfc\u822a\u8868\u8fbe\u5f0f","text":"<p>\u5982<code>a.property.property</code>\u8fd9\u79cd\u70b9\u7f00\u5f0f\u83b7\u53d6\uff1b</p> <p>\u4fee\u6539\u5bf9\u8c61\u5c5e\u6027\u503c\u5219\u53ef\u4ee5\u901a\u8fc7\u8d4b\u503c\u8868\u8fbe\u5f0f\u6216Expression\u63a5\u53e3\u7684<code>setValue</code>\u65b9\u6cd5\u4fee\u6539\u3002</p> <ul> <li>\u5bf9\u4e8e\u5c5e\u6027\u540d\u9996\u5b57\u6bcd\u662f\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\uff1b</li> <li>\u5b89\u5168\u5bfc\u822a\u8fd0\u7b97\u7b26<code>(\u5bf9\u8c61|\u5c5e\u6027)?.\u5c5e\u6027</code>\uff0c\u7528\u6765\u907f\u514d<code>?.</code>\u524d\u8fb9\u7684\u8868\u8fbe\u5f0f\u4e3anull\u65f6\u629b\u51fa\u7a7a\u6307\u9488\u5f02\u5e38\uff0c\u800c\u662f\u8fd4\u56denull\uff1b</li> </ul> <pre><code>public static class Car {\n    private String name;\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    @Override\n    public String toString() {\n        return \"Car{\" +\n                \"name='\" + name + '\\'' +\n                '}';\n    }\n}\n\npublic static class User {\n    private Car car;\n\n    public Car getCar() {\n        return car;\n    }\n\n    public void setCar(Car car) {\n        this.car = car;\n    }\n\n    @Override\n    public String toString() {\n        return \"User{\" +\n                \"car=\" + car +\n                '}';\n    }\n}\n\n@Test\npublic void test5() {\n    User user = new User();\n    EvaluationContext context = new StandardEvaluationContext();\n    context.setVariable(\"user\", user);\n\n    ExpressionParser parser = new SpelExpressionParser();\n    //\u4f7f\u7528.\u7b26\u53f7\uff0c\u8bbf\u95eeuser.car.name\u4f1a\u62a5\u9519\uff0c\u539f\u56e0\uff1auser.car\u4e3a\u7a7a\n    try {\n        System.out.println(parser.parseExpression(\"#user.car.name\").getValue(context, String.class));\n    } catch (EvaluationException | ParseException e) {\n        System.out.println(\"\u51fa\u9519\u4e86\uff1a\" + e.getMessage());\n    }\n    //\u4f7f\u7528\u5b89\u5168\u8bbf\u95ee\u7b26\u53f7?.\uff0c\u53ef\u4ee5\u89c4\u907fnull\u9519\u8bef\n    System.out.println(parser.parseExpression(\"#user?.car?.name\").getValue(context, String.class));\n\n    Car car = new Car();\n    car.setName(\"\u4fdd\u65f6\u6377\");\n    user.setCar(car);\n\n    System.out.println(parser.parseExpression(\"#user?.car?.toString()\").getValue(context, String.class));\n}\n</code></pre>"},{"location":"web/backend/spring/spel.html#_20","title":"\u5bf9\u8c61\u65b9\u6cd5\u8c03\u7528","text":"<p>\u8ddfJava\u8bed\u6cd5\u4e00\u6837\uff1b\u5982<code>'haha'.substring(2,4)</code>\u5c06\u8fd4\u56de\u201cha\u201d\uff1b\u800c\u5bf9\u4e8e\u6839\u5bf9\u8c61\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u65b9\u6cd5\uff1b</p>"},{"location":"web/backend/spring/spel.html#bean","title":"Bean\u5f15\u7528","text":"<p>SpEL\u652f\u6301\u4f7f\u7528<code>@</code>\u7b26\u53f7\u6765\u5f15\u7528Bean\uff0c\u5728\u5f15\u7528Bean\u65f6\u9700\u8981\u4f7f\u7528<code>BeanResolver</code>\u63a5\u53e3\u5b9e\u73b0\u6765\u67e5\u627eBean\uff0cSpring\u63d0\u4f9b<code>BeanFactoryResolver</code>\u5b9e\u73b0\u3002</p> <pre><code>@Test\npublic void test6() {\n    DefaultListableBeanFactory factory = new DefaultListableBeanFactory();\n    User user = new User();\n    Car car = new Car();\n    car.setName(\"\u4fdd\u65f6\u6377\");\n    user.setCar(car);\n    factory.registerSingleton(\"user\", user);\n\n    StandardEvaluationContext context = new StandardEvaluationContext();\n    context.setBeanResolver(new BeanFactoryResolver(factory));\n\n    ExpressionParser parser = new SpelExpressionParser();\n    User userBean = parser.parseExpression(\"@user\").getValue(context, User.class);\n    System.out.println(userBean);\n    System.out.println(userBean == factory.getBean(\"user\"));\n}\n</code></pre>"},{"location":"web/backend/spring/spel.html#_21","title":"\u96c6\u5408\u76f8\u5173\u8868\u8fbe\u5f0f","text":""},{"location":"web/backend/spring/spel.html#list","title":"\u5185\u8054List","text":"<p>\u4f7f\u7528<code>{\u8868\u8fbe\u5f0f\uff0c\u2026\u2026}</code>\u5b9a\u4e49\u5185\u8054List\uff0c\u5982<code>{1,2,3}</code>\u5c06\u8fd4\u56de\u4e00\u4e2a\u6574\u578b\u7684ArrayList\uff0c\u800c\u201c{}\u201d\u5c06\u8fd4\u56de\u7a7a\u7684List\uff1a</p> <ul> <li>\u5b57\u9762\u91cf\u8868\u8fbe\u5f0f\u5217\u8868\uff0c\u4e0d\u53ef\u4fee\u6539\uff1b</li> </ul> <pre><code>@Test\npublic void test7() {\n    ExpressionParser parser = new SpelExpressionParser();\n    //\u5c06\u8fd4\u56de\u4e0d\u53ef\u4fee\u6539\u7684\u7a7aList\n    List&lt;Integer&gt; result2 = parser.parseExpression(\"{}\").getValue(List.class);\n    //\u5bf9\u4e8e\u5b57\u9762\u91cf\u5217\u8868\u4e5f\u5c06\u8fd4\u56de\u4e0d\u53ef\u4fee\u6539\u7684List\n    List&lt;Integer&gt; result1 = parser.parseExpression(\"{1,2,3}\").getValue(List.class);\n\n    //\u5bf9\u4e8e\u5217\u8868\u4e2d\u53ea\u8981\u6709\u4e00\u4e2a\u4e0d\u662f\u5b57\u9762\u91cf\u8868\u8fbe\u5f0f\uff0c\u5c06\u53ea\u8fd4\u56de\u539f\u59cbList\uff0c\u4e0d\u4f1a\u8fdb\u884c\u4e0d\u53ef\u4fee\u6539\u5904\u7406\n    String expression3 = \"{{1+2,2+4},{3,4+4}}\";\n    List&lt;List&lt;Integer&gt;&gt; result3 = parser.parseExpression(expression3).getValue(List.class);\n    result3.get(0).set(0, 1);\n}\n</code></pre>"},{"location":"web/backend/spring/spel.html#_22","title":"\u5185\u8054\u6570\u7ec4","text":"<p>\u548c Java \u6570\u7ec4\u5b9a\u4e49\u7c7b\u4f3c\uff0c\u53ea\u662f\u5728\u5b9a\u4e49\u65f6\u8fdb\u884c\u591a\u7ef4\u6570\u7ec4\u521d\u59cb\u5316\u3002</p> <pre><code>int[][][] result4 = parser.parseExpression(\"new int[1][2][3]{{1}{2}{3}}\").getValue(int[][][].class);\n</code></pre>"},{"location":"web/backend/spring/spel.html#_23","title":"\u96c6\u5408\uff0c\u5b57\u5178\u5143\u7d20\u8bbf\u95ee","text":"<p>\u4f7f\u7528<code>\u96c6\u5408[\u7d22\u5f15]</code>\u8bbf\u95ee\u96c6\u5408\u5143\u7d20\uff0c\u4f7f\u7528<code>map[key]</code>\u8bbf\u95ee\u5b57\u5178\u5143\u7d20\uff1b</p> <pre><code>//SpEL\u5185\u8054List\u8bbf\u95ee  \nint result1 = parser.parseExpression(\"{1,2,3}[0]\").getValue(int.class);  \n\n//SpEL\u76ee\u524d\u652f\u6301\u6240\u6709\u96c6\u5408\u7c7b\u578b\u7684\u8bbf\u95ee  \nCollection&lt;Integer&gt; collection = new HashSet&lt;Integer&gt;();  \ncollection.add(1);  \ncollection.add(2);  \n\nEvaluationContext context2 = new StandardEvaluationContext();  \ncontext2.setVariable(\"collection\", collection);  \nint result2 = parser.parseExpression(\"#collection[1]\").getValue(context2, int.class);  \n\n//SpEL\u5bf9Map\u5b57\u5178\u5143\u7d20\u8bbf\u95ee\u7684\u652f\u6301  \nMap&lt;String, Integer&gt; map = new HashMap&lt;String, Integer&gt;();  \nmap.put(\"a\", 1);  \n\nEvaluationContext context3 = new StandardEvaluationContext();  \ncontext3.setVariable(\"map\", map);  \nint result3 = parser.parseExpression(\"#map['a']\").getValue(context3, int.class);\n</code></pre>"},{"location":"web/backend/spring/spel.html#_24","title":"\u5217\u8868\uff0c\u5b57\u5178\uff0c\u6570\u7ec4\u5143\u7d20\u4fee\u6539","text":"<p>\u53ef\u4ee5\u4f7f\u7528\u8d4b\u503c\u8868\u8fbe\u5f0f\u6216Expression\u63a5\u53e3\u7684<code>setValue</code>\u65b9\u6cd5\u4fee\u6539\uff1b</p> <pre><code>@Test\npublic void test8() {\n    ExpressionParser parser = new SpelExpressionParser();\n\n    //\u4fee\u6539list\u5143\u7d20\u503c\n    List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();\n    list.add(1);\n    list.add(2);\n\n    EvaluationContext context1 = new StandardEvaluationContext();\n    context1.setVariable(\"collection\", list);\n    parser.parseExpression(\"#collection[1]\").setValue(context1, 4);\n    int result1 = parser.parseExpression(\"#collection[1]\").getValue(context1, int.class);\n    System.out.println(result1);\n\n    //\u4fee\u6539map\u5143\u7d20\u503c\n    Map&lt;String, Integer&gt; map = new HashMap&lt;String, Integer&gt;();\n    map.put(\"a\", 1);\n    EvaluationContext context2 = new StandardEvaluationContext();\n    context2.setVariable(\"map\", map);\n    parser.parseExpression(\"#map['a']\").setValue(context2, 4);\n    Integer result2 = parser.parseExpression(\"#map['a']\").getValue(context2, int.class);\n    System.out.println(result2);\n}\n</code></pre>"},{"location":"web/backend/spring/spel.html#_25","title":"\u96c6\u5408\u6295\u5f71","text":"<p>\u6839\u636e\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e2d\u901a\u8fc7\u9009\u62e9\u6765\u6784\u9020\u53e6\u4e00\u4e2a\u96c6\u5408\uff0c\u8be5\u96c6\u5408\u548c\u539f\u96c6\u5408\u5177\u6709\u76f8\u540c\u6570\u91cf\u7684\u5143\u7d20\uff1b</p> <p>SpEL\u4f7f\u7528<code>(list|map).![\u6295\u5f71\u8868\u8fbe\u5f0f]</code>\u6765\u8fdb\u884c\u6295\u5f71\u8fd0\u7b97\uff0c\u7c7b\u4f3c\u6267\u884c<code>map</code>\u6620\u5c04\uff1a</p> <ul> <li>\u201c#this\u201d\u4ee3\u8868\u6bcf\u4e2a\u96c6\u5408\u6216\u6570\u7ec4\u5143\u7d20\uff1b</li> <li>Map\u6295\u5f71\u6700\u7ec8\u53ea\u80fd\u5f97\u5230List\u7ed3\u679c\uff0c\u5bf9\u4e8e\u6295\u5f71\u8868\u8fbe\u5f0f\u4e2d\u7684<code>#this</code>\u5c06\u662f<code>Map.Entry</code>\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528<code>value</code>\u6765\u83b7\u53d6\u503c\uff0c\u4f7f\u7528<code>key</code>\u6765\u83b7\u53d6\u952e\u3002</li> </ul> <pre><code>@Test\npublic void test9() {\n    ExpressionParser parser = new SpelExpressionParser();\n\n    //1.\u6d4b\u8bd5\u96c6\u5408\u6216\u6570\u7ec4\n    List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();\n    list.add(4);\n    list.add(5);\n    EvaluationContext context1 = new StandardEvaluationContext();\n    context1.setVariable(\"list\", list);\n    // \u6240\u6709\u5143\u7d20 + 1\n    Collection&lt;Integer&gt; result1 = parser.parseExpression(\"#list.![#this+1]\").getValue(context1, Collection.class);\n    result1.forEach(System.out::println);\n\n    System.out.println(\"------------\");\n    //2.\u6d4b\u8bd5\u5b57\u5178\n    Map&lt;String, Integer&gt; map = new HashMap&lt;String, Integer&gt;();\n    map.put(\"a\", 1);\n    map.put(\"b\", 2);\n    EvaluationContext context2 = new StandardEvaluationContext();\n    context2.setVariable(\"map\", map);\n    // \"#map.![#this.value+1]\"\n    List&lt;Integer&gt; result2 = parser.parseExpression(\"#map.![value+1]\").getValue(context2, List.class);\n    result2.forEach(System.out::println);\n}\n</code></pre>"},{"location":"web/backend/spring/spel.html#_26","title":"\u96c6\u5408\u9009\u62e9","text":"<p>\u6839\u636e\u539f\u96c6\u5408\u901a\u8fc7\u6761\u4ef6\u8868\u8fbe\u5f0f\u9009\u62e9\u51fa\u6ee1\u8db3\u6761\u4ef6\u7684\u5143\u7d20\u5e76\u6784\u9020\u4e3a\u65b0\u7684\u96c6\u5408\uff1b</p> <p>SpEL\u4f7f\u7528<code>(list|map).?[\u9009\u62e9\u8868\u8fbe\u5f0f]</code>\uff0c\u5176\u4e2d\u9009\u62e9\u8868\u8fbe\u5f0f\u7ed3\u679c\u5fc5\u987b\u662fboolean\u7c7b\u578b\uff0c\u5982\u679ctrue\u5219\u9009\u62e9\u7684\u5143\u7d20\u5c06\u6dfb\u52a0\u5230\u65b0\u96c6\u5408\u4e2d\uff0cfalse\u5c06\u4e0d\u6dfb\u52a0\u5230\u65b0\u96c6\u5408\u4e2d\u3002</p> <ul> <li>Map\u7684\u9009\u62e9\u7ed3\u679c\u8fd8\u662fMap\uff0c\u8ddf\u6295\u5f71\u4e0d\u4e00\u6837\uff1b</li> </ul> <pre><code>@Test\npublic void test10() {\n    ExpressionParser parser = new SpelExpressionParser();\n\n    //1.\u6d4b\u8bd5\u96c6\u5408\u6216\u6570\u7ec4\n    List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();\n    list.add(4);\n    list.add(7);\n    EvaluationContext context1 = new StandardEvaluationContext();\n    context1.setVariable(\"list\", list);\n    Collection&lt;Integer&gt; result1 = parser.parseExpression(\"#list.?[#this&gt;4]\").getValue(context1, Collection.class);\n    result1.forEach(System.out::println);\n\n}\n//2.\u6d4b\u8bd5\u5b57\u5178\nMap&lt;String, Integer&gt; map = new HashMap&lt;String, Integer&gt;();\nmap.put(\"a\", 1);\nmap.put(\"b\", 2);\nmap.put(\"c\", 3);\nEvaluationContext context2 = new StandardEvaluationContext();\ncontext2.setVariable(\"map\", map);\nMap&lt;String, Integer&gt; result2 = parser.parseExpression(\"#map.?[key!='a']\").getValue(context2, Map.class);\n</code></pre>"},{"location":"web/backend/spring/spel.html#_27","title":"\u8868\u8fbe\u5f0f\u6a21\u677f","text":"<p>\u6a21\u677f\u8868\u8fbe\u5f0f\u5c31\u662f\u7531\u5b57\u9762\u91cf\u4e0e\u4e00\u4e2a\u6216\u591a\u4e2a\u8868\u8fbe\u5f0f\u5757\u7ec4\u6210\u3002\u6bcf\u4e2a\u8868\u8fbe\u5f0f\u5757\u7531<code>\u524d\u7f00+\u8868\u8fbe\u5f0f+\u540e\u7f00</code>\u5f62\u5f0f\u7ec4\u6210\uff0c\u5982${1+2}\u5373\u8868\u8fbe\u5f0f\u5757\u3002</p> <ul> <li><code>Error ${#v0} $\u200b{#v1}</code>\u8868\u8fbe\u5f0f\u8868\u793a\u7531\u5b57\u9762\u91cf\u201cError \u201d\u3001\u6a21\u677f\u8868\u8fbe\u5f0f\u201c#v0\u201d\u3001\u6a21\u677f\u8868\u8fbe\u5f0f\u201c#v1\u201d\u7ec4\u6210\uff0c\u5176\u4e2dv0\u548cv1\u8868\u793a\u81ea\u5b9a\u4e49\u53d8\u91cf\uff0c\u9700\u8981\u5728\u4e0a\u4e0b\u6587\u5b9a\u4e49\u3002</li> </ul> <pre><code>@Test\npublic void test11() {\n    //\u521b\u5efa\u89e3\u6790\u5668\n    SpelExpressionParser parser = new SpelExpressionParser();\n    //\u521b\u5efa\u89e3\u6790\u5668\u4e0a\u4e0b\u6587\n    ParserContext context = new TemplateParserContext(\"%{\", \"}\");\n    Expression expression = parser.parseExpression(\"\u4f60\u597d:%{#name},\u6211\u4eec\u6b63\u5728\u5b66\u4e60:%{#lesson}\", context);\n\n    //\u521b\u5efa\u8868\u8fbe\u5f0f\u8ba1\u7b97\u4e0a\u4e0b\u6587\n    EvaluationContext evaluationContext = new StandardEvaluationContext();\n    evaluationContext.setVariable(\"name\", \"\u8def\u4eba\u7532java\");\n    evaluationContext.setVariable(\"lesson\", \"spring\u9ad8\u624b\u7cfb\u5217!\");\n    //\u83b7\u53d6\u503c\n    String value = expression.getValue(evaluationContext, String.class);\n    System.out.println(value);\n}\n</code></pre>"},{"location":"web/backend/spring/spel.html#_28","title":"\u4f7f\u7528","text":"<p>maven\u914d\u7f6e\uff0c\u9ed8\u8ba4\u5df2\u7ecf\u96c6\u6210\u5728<code>spring-boot-starter-web</code>\u4e2d\uff1a</p> <pre><code>&lt;dependency&gt;\n  &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n  &lt;artifactId&gt;spring-expression&lt;/artifactId&gt;\n  &lt;version&gt;5.3.9&lt;/version&gt;\n  &lt;scope&gt;compile&lt;/scope&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"web/backend/spring/spel.html#_29","title":"\u6ce8\u89e3\u98ce\u683c\u7684\u914d\u7f6e","text":"<p>\u57fa\u4e8e\u6ce8\u89e3\u98ce\u683c\u7684SpEL\u914d\u7f6e\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u4f7f\u7528@Value\u6ce8\u89e3\u6765\u6307\u5b9aSpEL\u8868\u8fbe\u5f0f\uff0c\u8be5\u6ce8\u89e3\u53ef\u4ee5\u653e\u5230\u5b57\u6bb5\u3001\u65b9\u6cd5\u53ca\u65b9\u6cd5\u53c2\u6570\u4e0a\u3002</p> <p>\u6d4b\u8bd5Bean\u7c7b\u5982\u4e0b\uff0c\u4f7f\u7528@Value\u6765\u6307\u5b9aSpEL\u8868\u8fbe\u5f0f\uff1a</p> <pre><code>public class SpELBean {  \n    @Value(\"#{'Hello' + world}\")  \n    private String value;  \n}\n</code></pre>"},{"location":"web/backend/spring/spel.html#beanspel","title":"\u5728Bean\u5b9a\u4e49\u4e2dSpEL\u7684\u95ee\u9898","text":"<p>\u201c#{\u6211\u4e0d\u662fSpEL\u8868\u8fbe\u5f0f}\u201d\u4e0d\u662fSpEL\u8868\u8fbe\u5f0f\uff0c\u800c\u662f\u516c\u53f8\u5185\u90e8\u7684\u6a21\u677f\uff0c\u60f3\u6362\u4e2a\u524d\u7f00\u548c\u540e\u7f00\u8be5\u5982\u4f55\u5b9e\u73b0\u5462\uff1f</p> <p><code>BeanFactoryPostProcessor</code>\u63a5\u53e3\u63d0\u4f9b<code>postProcessBeanFactory</code>\u56de\u8c03\u65b9\u6cd5\uff0c\u5b83\u662f\u5728IoC\u5bb9\u5668\u521b\u5efa\u597d\u4f46\u8fd8\u672a\u8fdb\u884c\u4efb\u4f55Bean\u521d\u59cb\u5316\u65f6\u88abApplicationContext\u5b9e\u73b0\u8c03\u7528\uff0c\u56e0\u6b64\u5728\u8fd9\u4e2a\u9636\u6bb5\u628aSpEL\u524d\u7f00\u53ca\u540e\u7f00\u4fee\u6539\u6389\u662f\u5b89\u5168\u7684</p> <pre><code>import org.springframework.beans.BeansException;\nimport org.springframework.beans.factory.config.BeanExpressionResolver;\nimport org.springframework.beans.factory.config.BeanFactoryPostProcessor;\nimport org.springframework.beans.factory.config.ConfigurableListableBeanFactory;\nimport org.springframework.context.expression.StandardBeanExpressionResolver;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class SpelBeanFactoryPostProcessor implements BeanFactoryPostProcessor {\n    @Override\n    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {\n        BeanExpressionResolver beanExpressionResolver = beanFactory.getBeanExpressionResolver();\n        if (beanExpressionResolver instanceof StandardBeanExpressionResolver) {\n            StandardBeanExpressionResolver resolver = (StandardBeanExpressionResolver) beanExpressionResolver;\n            resolver.setExpressionPrefix(\"%{\");\n            resolver.setExpressionSuffix(\"}\");\n        }\n    }\n}\n</code></pre>"},{"location":"web/backend/spring/springaop.html","title":"Spring AOP","text":""},{"location":"web/backend/spring/springaop.html#iocinverse-of-control","title":"IoC\uff1aInverse of Control","text":"<ul> <li>\u901a\u8fc7\u63a5\u53e3\u62bd\u8c61\u548c\u5b9e\u73b0\uff0c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5b9a\u4e49\u5177\u4f53\u5b9e\u73b0\u7c7b\uff0c\u901a\u8fc7\u53cd\u5c04\u673a\u5236\u6784\u9020\u5b9e\u4f8b\uff1b</li> <li>IOC\u7684\u5b9e\u73b0\u65b9\u5f0f\u6709\u4e24\u79cd\uff1a\u4f9d\u8d56\u67e5\u627e(DL)\u548c\u4f9d\u8d56\u6ce8\u5165(DI)\uff1b</li> </ul>"},{"location":"web/backend/spring/springaop.html#spring","title":"Spring\u62e6\u622a\u5bf9\u6bd4","text":"\u62e6\u622a\u65b9\u5f0f \u7279\u70b9 servlet\u7684\u8fc7\u6ee4\u5668Filter \u53ef\u4ee5\u62ff\u5230\u539f\u59cb\u7684http\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u4fe1\u606f\uff0c\u4f46\u662f\u62ff\u4e0d\u5230\u771f\u6b63\u5904\u7406\u8fd9\u4e2a\u8bf7\u6c42\u7684\u65b9\u6cd5\u7684\u4fe1\u606f\u3002\u5728Filter\u4e2d\u662f\u4e0d\u77e5\u9053\u8fd9\u4e2a\u8bf7\u6c42\u662f\u54ea\u4e2a\u63a7\u5236\u5668\u7684\u54ea\u4e2a\u65b9\u6cd5\u6765\u5904\u7406\u7684\u3002\u5982\u679c\u4f60\u9700\u8981\u8fd9\u4e2a\u4fe1\u606f\u7684\u8bdd\uff0c\u90a3\u4e48\u9700\u8981\u4f7f\u7528springmvc\u7684interceptor\u3002 springmvc\u7684interceptor \u62e6\u622a\u5668\u53ef\u4ee5\u62ff\u5230\u539f\u59cb\u7684http\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u4fe1\u606f\uff0c\u4e5f\u80fd\u62ff\u5230\u771f\u6b63\u5904\u7406\u8fd9\u4e2a\u8bf7\u6c42\u7684\u65b9\u6cd5\u7684\u4fe1\u606f\uff0c\u4f46\u662f\u5176\u62ff\u4e0d\u5230\u8fd9\u4e2a\u65b9\u6cd5\u88ab\u8c03\u7528\u7684\u65f6\u5019\u771f\u6b63\u8c03\u7528\u7684\u53c2\u6570\u7684\u503c spring\u7684\u5207\u7247Aspect \u53ef\u4ee5\u62ff\u5230\u65b9\u6cd5\u88ab\u8c03\u7528\u7684\u65f6\u5019\u771f\u6b63\u8c03\u7528\u7684\u53c2\u6570\u7684\u503c\uff0c\u4f46\u662f\u62ff\u4e0d\u5230\u539f\u59cb\u7684http\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u4fe1\u606f"},{"location":"web/backend/spring/springaop.html#aopaspect-oriented-programming","title":"AOP\uff1aAspect Oriented Programming","text":""},{"location":"web/backend/spring/springaop.html#_1","title":"\u4ecb\u7ecd","text":"<p>\u4f7f\u7528 Jdk Proxy\uff08\u76ee\u6807\u7c7b\u6709\u63a5\u53e3\uff09 \u6216\u8005 CGLIB Proxy\uff08\u76ee\u6807\u7c7b\u6ca1\u6709\u63a5\u53e3\uff09</p> <ul> <li>spring aop \u5185\u7f6e cglib \u6e90\u7801\uff08\u4f46\u4e0d\u540c\u5305\u540d\uff09</li> </ul>"},{"location":"web/backend/spring/springaop.html#_2","title":"\u6982\u5ff5","text":"<ul> <li> <p>OOP\u5173\u6ce8\u7eb5\u5411\uff0cAOP\u5173\u6ce8\u6a2a\u5411\uff0c\u5982\u65e5\u5fd7\u3001\u5b89\u5168\u578b\u3001\u5f02\u5e38\u5904\u7406\uff0c\u6563\u5e03\u5728\u6240\u6709\u5bf9\u8c61\u5c42\u6b21\u4e2d\uff1b</p> </li> <li> <p>\u6a2a\u5207\u5173\u6ce8\u70b9\uff1a\u5bf9\u54ea\u4e9b\u65b9\u6cd5\u8fdb\u884c\u62e6\u622a\uff0c\u62e6\u622a\u540e\u600e\u4e48\u5904\u7406\uff1f</p> </li> <li>\u5207\u9762(aspect)\uff1a\u5bf9\u6a2a\u5207\u5173\u6ce8\u70b9\u7684\u62bd\u8c61\uff1b</li> <li>\u8fde\u63a5\u70b9(joinpoint)\uff1a\u88ab\u62e6\u622a\u5230\u7684\u70b9\uff0cSpring\u53ea\u652f\u6301\u65b9\u6cd5\u7c7b\u578b\u7684\u8fde\u63a5\u70b9\uff0c\u5b9e\u9645\u8fde\u63a5\u70b9\u8fd8\u53ef\u4ee5\u662f\u5b57\u6bb5\u6216\u6784\u9020\u5668\uff1b</li> <li>\u5207\u5165\u70b9(pointcut)\uff1a\u5bf9\u8fde\u63a5\u70b9\u8fdb\u884c\u62e6\u622a\u7684\u5b9a\u4e49\uff1b</li> <li>\u901a\u77e5(advice)\uff1a\u6307\u62e6\u622a\u5230\u8fde\u63a5\u70b9\u4e4b\u540e\u8981\u6267\u884c\u7684\u4ee3\u7801\uff0c\u901a\u77e5\u5206\u4e3a\u524d\u7f6e\u3001\u540e\u7f6e\u3001\u5f02\u5e38\u3001\u8fd4\u56de\u3001\u73af\u7ed5\u901a\u77e5\u4e94\u7c7b\uff1b</li> <li>\u5f15\u5165(introcution)\uff1a\u5728\u4e0d\u6539\u4ee3\u7801\u524d\u63d0\uff0c\u5f15\u5165\u53ef\u4ee5\u5728\u8fd0\u884c\u671f\u4e3a\u7c7b\u52a8\u6001\u5730\u6dfb\u52a0\u65b9\u6cd5\u548c\u5b57\u6bb5\uff1b</li> <li> <p>\u7ec7\u5165(weaveing)\uff1aSpring\u4f7f\u7528\u52a8\u6001\u4ee3\u7406\u7ec7\u5165\uff0cAspectJ\u91c7\u7528\u7f16\u8bd1\u5668\u7ec7\u5165\u548c\u7c7b\u88c5\u8f7d\u5668\u7ec7\u5165\uff1b</p> </li> <li> <p>Pointcut\u53ef\u4ee5\u6709args()\uff0cexecution()\uff0cthis()\uff0cwithin()\uff0c\u5e76\u53ef\u4ee5\u901a\u8fc7&amp;&amp; || ! \u65b9\u5f0f\u7ec4\u5408</p> </li> <li> <p>execution\uff1a\u5339\u914d\u6ee1\u8db3\u6761\u4ef6\u7684\u65b9\u6cd5\u79f0\u4e3a\u8fde\u63a5\u70b9</p> </li> <li>this(a)\uff1a\u5b9e\u73b0\u63a5\u53e3a\u7684\u6240\u6709\u7c7b\uff0c\u82e5a\u4e0d\u662f\u63a5\u53e3\uff0c\u5219\u9650\u5b9aa\u5355\u4e2a\u7c7b</li> <li>within(a..*)\uff1a\u6ee1\u8db3a\u7684\u5305\u4ee5\u53ca\u5b50\u5305\u7684\u4efb\u610f\u7c7b</li> <li>args()\uff1a\u53ef\u4ee5\u6307\u5b9a\u65b9\u6cd5\u7684\u53c2\u6570\u540d\uff0c\u53ef\u4ee5\u4f20\u5165\u5230advice\u4e2d\uff1b</li> <li> <p>target()\uff1a\u4e0d\u540c\u4e8ethis\uff0cthis\u6307\u5411\u771f\u6b63\u5bf9\u8c61\uff0ctarge\u6267\u884c\u4ee3\u7406\u5bf9\u8c61\uff0c\u56e0\u4e3aSpring      AOP\u662f\u57fa\u4e8e\u4ee3\u7406\u7684\uff0c\u53ef\u9009JDK      proxy\u6216CGLIB\uff1b</p> </li> <li> <p><code>execution(modifiers-pattern? ret-type-pattern declaring-type-pattern? name-pattern(param-pattern) throws-pattern?)</code>\uff1a</p> </li> <li> <p>\u5176\u4e2d\uff0c\u9664\u4e86\u8fd4\u56de\u503c\u7c7b\u578bret-type-pattern\uff0c\u65b9\u6cd5\u540dname-pattern\uff0c\u53c2\u6570param-pattern\uff0c\u5176\u4f59\u662f\u53ef\u4ee5\u7701\u7565\u7684\uff1b</p> </li> <li> <p>*\u8868\u793a\u6240\u6709\uff08\u4efb\u4f55\u90fd\u5339\u914d\u6210\u529f\uff09\uff0c\u5982\u53ef\u4ee5\u8868\u793a\u4efb\u4f55\u8fd4\u56de\u7c7b\u578b\uff0c\u4efb\u4f55\u65b9\u6cd5\u540d\uff0c\u4efb\u4f55\u53c2\u6570\u7c7b\u578b\uff1b</p> </li> <li> <p>\u5bf9\u4e8e\u65b9\u6cd5\u540d\uff0cabc.\u8868\u793a\u5305abc\u4e0b\u7684\u6240\u6709\u65b9\u6cd5\uff0cabc..\u8868\u793a\u5305abc\u4ee5\u53ca\u5176\u5b50\u5305\u4e0b\u7684\u65b9\u6cd5\uff1b</p> </li> <li> <p>\u5bf9\u4e8e\u53c2\u6570\uff0c()\u8868\u793a\u5339\u914d\u65e0\u4efb\u4f55\u53c2\u6570\u7684\u65b9\u6cd5\uff0c(*)\u8868\u793a\u5339\u914d\u4efb\u4f55\u7c7b\u578b\u7684\u5355\u53c2\u6570\u65b9\u6cd5\uff0c(..)\u5339\u914d\u6240\u6709\u65b9\u6cd5\uff1b</p> </li> <li> <p>advice</p> </li> <li> <p>before\uff1a\u8fde\u63a5\u70b9\u6267\u884c\u524d</p> </li> <li>around\uff1a\u5236\u5b9a\u65b9\u6cd5\u6267\u884c\uff0c\u7b49\u4ef7\u4e8ebefore      + \u6267\u884c +      after</li> <li>after\uff1a\u8fde\u63a5\u70b9\u6267\u884c\u540e\uff0cfinally\u7279\u6027</li> <li>after-returning\uff1a\u8fde\u63a5\u70b9\u6b63\u5e38\u8fd4\u56de\u65f6\uff0creturning\u5236\u5b9a\u8fd4\u56de\u503c\u7684\u540d\u79f0\uff0c\u4e0eadvice\u7684\u53c2\u6570\u540d\u4e00\u81f4\uff1b</li> <li>after-throwing\uff1a\u8fde\u63a5\u70b9\u629b\u51fa\u6307</li> <li>\u5b9a\u5f02\u5e38\u65f6\uff0c\u6267\u884cadvice</li> </ul>"},{"location":"web/backend/spring/springaop.html#_3","title":"\u9759\u6001\u65b9\u6cd5\u5207\u70b9","text":"<p><code>org.springframework.aop.support.StaticMethodMatcherPointcut</code></p> <p><code>StaticMethodMatcherPointcut</code>\u662f\u9759\u6001\u65b9\u6cd5\u5207\u70b9\u7684\u62bd\u8c61\u57fa\u7c7b\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5339\u914d\u6240\u6709\u7684\u7c7b\u3002<code>StaticMethodMatcherPointcut</code>\u6709\u4e24\u4e2a\u91cd\u8981\u7684\u5b50\u7c7b\uff1a<code>NameMethodMatcherPointcut</code>\u548c<code>AbstractRegexMethodPoint</code>\u3002\u524d\u8005\u63d0\u4f9b\u7b80\u5355\u7684\u5b57\u7b26\u4e32\u5339\u914d\u65b9\u6cd5\u7b7e\u540d\uff0c\u540e\u8005\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u65b9\u6cd5\u7b7e\u540d\u3002</p>"},{"location":"web/backend/spring/springaop.html#springboot-aop","title":"SpringBoot AOP","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <p>Java\u4ee3\u7801\uff1a</p> <pre><code>@Aspect\n\n@Pointcut(\"execution(public * com.stuPayment.controller..*.*(..))\")//\u5207\u5165\u70b9\u63cf\u8ff0 \u8fd9\u4e2a\u662fcontroller\u5305\u7684\u5207\u5165\u70b9\n\n@Before(\"controllerLog() || uiControllerLog()\")\n</code></pre>"},{"location":"web/backend/spring/springboot.html","title":"\u57fa\u7840","text":"<p>\u7248\u672c\u652f\u6301\u65f6\u95f4\uff1ahttps://spring.io/projects/spring-boot#support</p> <ul> <li>springboot 3.x \u8981\u6c42 JDK 17</li> </ul>"},{"location":"web/backend/spring/springboot.html#_2","title":"\u914d\u7f6e","text":""},{"location":"web/backend/spring/springboot.html#_3","title":"\u6587\u4ef6\u52a0\u8f7d\u987a\u5e8f","text":"<p>SpringBoot \u542f\u52a8\u4f1a\u626b\u63cf\u4ee5\u4e0b\u4f4d\u7f6e\u7684 application.yml \u6216\u8005 application.properties \u6587\u4ef6\u4f5c\u4e3aSpringBoot\u7684\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u3002</p> <pre><code># \u4f18\u5148\u7ea7\u7531\u9ad8\u5230\u4f4e\n-file:./config/\n-file:./\n-classpath:/config/\n-classpath:/\n</code></pre> <p>\u8fd8\u53ef\u4ee5\u901a\u8fc7spring.config.location\u6765\u6539\u53d8\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e\u3002</p> <pre><code>java -jar spring-boot-02-config-02.0.0.1-SNAPSHOT.jar  --spring.config.location=G:/application.properties \n</code></pre>"},{"location":"web/backend/spring/springboot.html#tomcat","title":"\u5185\u7f6eTomcat\u914d\u7f6e","text":"<pre><code># \u6700\u5927\u5de5\u4f5c\u7ebf\u7a0b\u6570\uff0c\u9ed8\u8ba4200\u3002\n# \u7ebf\u7a0b\u6570\u7684\u7ecf\u9a8c\u503c\u4e3a\uff1a1\u68382G\u5185\u5b58\uff0c\u7ebf\u7a0b\u6570\u7ecf\u9a8c\u503c200\uff1b4\u68388G\u5185\u5b58\uff0c \u7ebf\u7a0b\u6570\u7ecf\u9a8c\u503c800\u3002\nserver.tomcat.max-threads=200\n\n# \u6700\u5927\u8fde\u63a5\u6570\u9ed8\u8ba4\u662f10000\nserver.tomcat.max-connections=10000\n\n# \u7b49\u5f85\u961f\u5217\u957f\u5ea6\uff0c\u9ed8\u8ba4100\u3002\nserver.tomcat.accept-count=100\n\n# \u6700\u5c0f\u5de5\u4f5c\u7a7a\u95f2\u7ebf\u7a0b\u6570\uff0c\u9ed8\u8ba410\u3002\nserver.tomcat.min-spare-threads=100\n</code></pre>"},{"location":"web/backend/spring/springboot.html#_4","title":"\u6ce8\u89e3","text":""},{"location":"web/backend/spring/springboot.html#_5","title":"\u5e38\u7528\u6ce8\u89e3","text":"<p>@Controller\uff0c@RestController</p> <p>@GetMapping\uff0c@PostMapping</p> <p>@RequestBody\uff0c@ResponseBody</p> <p>@ControllerAdvice</p> <ul> <li>\u548c<code>@ExceptionHandler</code>\u3001<code>@InitBinder</code>\u4ee5\u53ca<code>@ModelAttribute</code>\u6ce8\u89e3\u642d\u914d\u4f7f\u7528\uff0c\u4e3b\u8981\u662f\u7528\u6765\u5904\u7406\u63a7\u5236\u5668\u6240\u629b\u51fa\u7684\u5f02\u5e38\u4fe1\u606f\uff1b</li> </ul> <p>@ExceptionHandler</p> <p>@RequestParam\uff0c@PathVariable</p> <p>@CrossOrigin</p> <p>@Component\uff0c@ComponentScan</p> <p>Spring DI\u6ce8\u89e3\uff1a</p> <p>@DependsOn</p> <p>@Bean</p> <p>@Scope</p> <ul> <li>singleton\u3001prototype\u3001request\u3001session\u3001globalSession</li> </ul> <p>@Autowired</p> <p>@Primary</p> <ul> <li>\u5b9a\u4e49\u8fd9\u4e9bBean\u7684\u4f18\u5148\u7ea7</li> </ul>"},{"location":"web/backend/spring/springboot.html#springboot","title":"SpringBoot\u6ce8\u89e3","text":"<p>@SpringBootApplication</p> <p>@EnableAutoConfiguration</p> <p>@ConditionalOnClass\u4e0e@ConditionalOnMissingClass</p> <p>@ConditionalOnMissingBean\uff0c@ConditionalOnMissingBean</p> <p>@ConditionalOnProperty\uff0c@ConditionalOnResource</p>"},{"location":"web/backend/spring/springboot.html#_6","title":"\u7b2c\u4e09\u65b9\u5305\u7684\u6ce8\u89e3\u751f\u6548","text":""},{"location":"web/backend/spring/springboot.html#componentscan","title":"@ComponentScan","text":"<p>@SpringBootApplication\u6ce8\u89e3\u9ed8\u8ba4\u626b\u63cf\u53ea\u662f\u5f53\u524d\u9879\u76ee\u7684\u672c\u5305\u548c\u5b83\u7684\u5b50\u5305\uff0c@ComponentScan\u4e3b\u8981\u5c31\u662f\u5b9a\u4e49\u626b\u63cf\u7684\u8def\u5f84\u4ece\u4e2d\u627e\u51fa\u6807\u8bc6\u4e86\u9700\u8981\u88c5\u914d\u7684\u7c7b\u81ea\u52a8\u88c5\u914d\u5230spring\u7684bean\u5bb9\u5668\u4e2d\u3002</p>"},{"location":"web/backend/spring/springboot.html#import","title":"@Import","text":"<p>@ComponentScan\u662f\u626b\u63cf\u6574\u4e2a\u5305,\u4f46\u5176\u5b9e\u4f60\u53ef\u80fd\u53ea\u9700\u6ce8\u5165\u4e00\u4e2a\u6216\u8005\u51e0\u4e2a\u6307\u5b9a\u7684Bean\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u7528 @Import \u6ce8\u89e3\u3002</p> <ul> <li>\u53ef\u4ee5\u901a\u8fc7\u6ce8\u89e3\uff0c\u8868\u660e\u662f\u5426\u9700\u8981\u5f15\u5165\uff1b</li> </ul> <pre><code>@Retention(value = RetentionPolicy.RUNTIME)\n@Target(value = {ElementType.TYPE})\n@Documented\n// \u6309\u5b9e\u9645\u5f15\u5165\n@Import(XXX.class)\npublic @interface EnableDataPermission {\n}\n</code></pre> <p>\u5728 Application\u4e2d\u6dfb\u52a0\uff0c\u5373\u53ef\u5f00\u542f</p> <pre><code>@EnableDataPermission\n@SpringBootApplication\npublic class Main {\n    public static void main(String[] args) {\n        SpringApplication.run(Main.class, args);\n    }\n}\n</code></pre>"},{"location":"web/backend/spring/springboot.html#enableautoconfiguration","title":"@EnableAutoConfiguration","text":"<pre><code>@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Inherited\n// \u81ea\u52a8\u914d\u7f6e\u5305\n@AutoConfigurationPackage\n// \u7ed9IOC\u5bb9\u5668\u5bfc\u5165\u7ec4\u4ef6\n@Import(AutoConfigurationImportSelector.class)\npublic @interface EnableAutoConfiguration {\n    String ENABLED_OVERRIDE_PROPERTY = \"spring.boot.enableautoconfiguration\";\n    Class&lt;?&gt;[] exclude() default {};\n\n    String[] excludeName() default {};\n}\n</code></pre> <p>\u4e0a\u9762\u4e24\u79cd\u6ce8\u5165\u65b9\u5f0f\u90fd\u6709\u4e2a\u5f88\u660e\u663e\u7f3a\u70b9\uff0c\u5c31\u662f\u5982\u679c\u6211\u9700\u8981\u5f15\u7528\u5916\u90e8jar\u5305\u7684Bean\u7684\u65f6\u5019\uff0c\u90fd\u9700\u8981\u5728\u5f53\u524d\u9879\u76ee\u914d\u7f6e @ComponentScan \u6216\u8005 @Import \u53bb\u626b\u63cf\u624d\u80fd\u6ce8\u5165\u5f53\u524dBean\uff0c\u8fd9\u6837\u663e\u7136\u4e0d\u591f\u53cb\u597d\u3002</p> <p>\u53ea\u9700\u8981\u5728\u5c06\u914d\u7f6e\u653e\u5728\u7b2c\u4e09\u65b9jar\u6307\u5b9a\u7684\u6587\u4ef6\u4e2d\u5373\u53ef\uff0c\u4f7f\u7528\u8005\u4f1a\u81ea\u52a8\u52a0\u8f7d\uff0c\u4ece\u800c\u907f\u514d\u7684\u4ee3\u7801\u7684\u4fb5\u5165</p> <ul> <li>\u5728\u8d44\u6e90\u76ee\u5f55\u4e0b\u65b0\u5efa\u76ee\u5f55 META-INF</li> <li>\u5728 META-INF \u76ee\u5f55\u4e0b\u65b0\u5efa\u6587\u4ef6 spring.factories</li> <li>\u5728\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e0b\u9762\u914d\u7f6e</li> </ul> <pre><code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.third.bean.ConfigurationBean\n</code></pre> <p>Spring Boot 3\u5c06\u79fb\u9664\u5bf9/META-INF/spring.factories\u7684\u652f\u6301\u3002</p> <p>\u65b0\u7684\u5199\u6cd5\u662f\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6587\u4ef6\uff1a</p> <p><code>/META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code></p> <p>\u5185\u5bb9\u76f4\u63a5\u653e\u914d\u7f6e\u7c7b\u5373\u53ef\uff0c\u5982\uff1a</p> <pre><code>com.example.swagger.SwaggerAutoConfiguration\n</code></pre>"},{"location":"web/backend/spring/springboot.html#spring","title":"Spring \u5168\u5c40\u8d44\u6e90\u7684\u52a0\u8f7d","text":"<p>\u5b9e\u73b0CommandLIneRunner \u6216\u8005 ApplicationRunner\uff0c\u5b9e\u73b0 run \u65b9\u6cd5</p>"},{"location":"web/backend/spring/springboot.html#runner","title":"Runner","text":"<p>\u9879\u76ee\u542f\u52a8\u540e\u7acb\u9a6c\u6267\u884c\u4e00\u4e9b\u903b\u8f91\uff1a</p> <pre><code>@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)\npublic class Agent {\n    public static void main(String[] args) {\n        SpringApplication.run(Agent.class, args);\n        // Want to execute other logic\n    }\n}\n</code></pre> <p>\u5982\u679c\u91c7\u7528tomcat\u670d\u52a1\uff0c\u5219\u8fd0\u884c\u7684\u65f6\u5019\uff0crun\u540e\u9762\u7684\u903b\u8f91\u4e0d\u4f1a\u6267\u884c\u3002</p> <p>\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <p>CommandLineRunner \u662f Spring Boot \u63d0\u4f9b\u7684\u4e00\u4e2a\u63a5\u53e3\uff0c\u5f53\u4f60\u5b9e\u73b0\u8be5\u63a5\u53e3\u5e76\u5c06\u4e4b\u6ce8\u5165Spring IoC\u5bb9\u5668\u540e\uff0cSpring Boot\u5e94\u7528\u542f\u52a8\u540e\u5c31\u4f1a\u6267\u884c\u5176run\u65b9\u6cd5\u3002</p> <ul> <li>ApplicationRunner \u63a5\u6536\u4e00\u4e2a\u5c01\u88c5\u597d\u7684\u5bf9\u8c61\u53c2\u6570ApplicationArguments\u3002\u9664\u6b64\u4e4b\u5916\u5b83\u4eec\u529f\u80fd\u5b8c\u5168\u4e00\u6837</li> </ul> <pre><code>@Slf4j\n@Component\npublic class HighOrderCommandLineRunner implements CommandLineRunner, Ordered {\n    @Override\n    public void run(String... args) throws Exception {\n        // \u4e0d\u5e94\u8be5\u963b\u585e\uff0c\u5982\u679c\u9700\u8981\u963b\u585e\uff0c\u5219\u53e6\u8d77\u7ebf\u7a0b\n        for (String arg : args) {\n            log.info(\"arg = \" + arg);\n        }\n        log.info(\"i am highOrderRunner\");\n    }\n\n    @Override\n    public int getOrder() {\n        return Integer.MIN_VALUE+1;\n    }\n}\n</code></pre>"},{"location":"web/backend/spring/springsecurity.html","title":"Spring Security","text":""},{"location":"web/backend/spring/springsecurity.html#_1","title":"\u8ba4\u8bc1\u6d41\u7a0b","text":"<p>\u5176\u4e2dUsernamePasswordAuthenticationFilter\u548cBasicAuthenticationFilter\u662f\u4e24\u4e2a\u6838\u5fc3\u8fc7\u6ee4\u5668\u3002</p> <p>FilterSecurityInterceptor\u4f1a\u5bf9\u4e4b\u524d\u8fd9\u4e9b\u6838\u5fc3\u8fc7\u6ee4\u5668\u8fdb\u884c\u76f8\u5e94\u5224\u65ad\uff0c\u5e76\u629b\u51fa\u5f02\u5e38\uff08\u4f8b\u5982\u8eab\u4efd\u8ba4\u8bc1\u6ca1\u6709\u901a\u8fc7\uff09\u3002</p> <p>\u7136\u540e\u7531ExceptionTranslationFilter\u6355\u83b7\u629b\u51fa\u6765\u7684\u5f02\u5e38\uff0c\u8fdb\u884c\u76f8\u5e94\u5904\u7406\u3002</p> <p></p> <p>AuthenticationManager\u8c03\u7528DaoAuthenticationProvider\u53bb\u8ba4\u8bc1\u3002DaoAuthenticationProvider\u901a\u8fc7\u8c03\u7528UserDetailsService\u7684loadUserByUsername\u65b9\u6cd5\u6765\u83b7\u53d6UserDetails\u5bf9\u8c61\u3002\u7136\u540e\u6bd4\u5bf9UserDetails\u7684\u5bc6\u7801\u4e0e\u8ba4\u8bc1\u8bf7\u6c42\u7684\u5bc6\u7801\u662f\u5426\u4e00\u81f4\uff0c\u4e00\u81f4\u5219\u8868\u793a\u8ba4\u8bc1\u901a\u8fc7\u3002</p> <p>AuthenticationManager</p> <p>\u7528\u6237\u8ba4\u8bc1\u7684\u7ba1\u7406\u7c7b\uff0c\u6240\u6709\u7684\u8ba4\u8bc1\u8bf7\u6c42\uff08\u6bd4\u5982login\uff09\u90fd\u4f1a\u901a\u8fc7\u63d0\u4ea4\u4e00\u4e2atoken\u7ed9AuthenticationManager\u7684authenticate()\u65b9\u6cd5\u6765\u5b9e\u73b0\u3002\u5177\u4f53\u6821\u9a8c\u52a8\u4f5c\u4f1a\u7531AuthenticationManager\u5c06\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u5177\u4f53\u7684\u5b9e\u73b0\u7c7b\u6765\u505a\u3002\u6839\u636e\u5b9e\u73b0\u53cd\u9988\u7684\u7ed3\u679c\u518d\u8c03\u7528\u5177\u4f53\u7684Handler\u6765\u7ed9\u7528\u6237\u4ee5\u53cd\u9988\u3002</p> <p>AuthenticationProvider</p> <p>\u8ba4\u8bc1\u7684\u5177\u4f53\u5b9e\u73b0\u7c7b\uff0c\u4e00\u4e2aprovider\u662f\u4e00\u79cd\u8ba4\u8bc1\u65b9\u5f0f\u7684\u5b9e\u73b0\uff0c\u6bd4\u5982\u63d0\u4ea4\u7684\u7528\u6237\u540d\u5bc6\u7801\u662f\u901a\u8fc7\u548cDB\u4e2d\u67e5\u51fa\u7684user\u8bb0\u5f55\u505a\u6bd4\u5bf9\u5b9e\u73b0\u7684\uff0c\u90a3\u5c31\u6709\u4e00\u4e2aDaoProvider\uff1b\u5982\u679c\u6211\u662f\u901a\u8fc7CAS\u8bf7\u6c42\u5355\u70b9\u767b\u5f55\u7cfb\u7edf\u5b9e\u73b0\uff0c\u90a3\u5c31\u6709\u4e00\u4e2aCASProvider\u3002</p> <p>\u4e00\u4e2aAuthenticationManager\u53ef\u4ee5\u5305\u542b\u591a\u4e2aProvider\uff0c\u6bcf\u4e2aprovider\u901a\u8fc7\u5b9e\u73b0\u4e00\u4e2asupport\u65b9\u6cd5\u6765\u8868\u793a\u81ea\u5df1\u652f\u6301\u90a3\u79cdToken\u7684\u8ba4\u8bc1\u3002AuthenticationManager\u9ed8\u8ba4\u7684\u5b9e\u73b0\u7c7b\u662fProviderManager\u3002</p> <p>UserDetailService</p> <p>\u7528\u6237\u8ba4\u8bc1\u901a\u8fc7Provider\u6765\u505a\uff0c\u6240\u4ee5Provider\u9700\u8981\u62ff\u5230\u7cfb\u7edf\u5df2\u7ecf\u4fdd\u5b58\u7684\u8ba4\u8bc1\u4fe1\u606f\uff0c\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u7684\u63a5\u53e3spring-security\u62bd\u8c61\u6210UserDetailService\u3002getAuthorities()\u65b9\u6cd5\u5c06\u8fd4\u56de\u6b64\u7528\u6237\u7684\u6240\u62e5\u6709\u7684\u6743\u9650</p> <p>AuthenticationToken</p> <p>\u6240\u6709\u63d0\u4ea4\u7ed9AuthenticationManager\u7684\u8ba4\u8bc1\u8bf7\u6c42\u90fd\u4f1a\u88ab\u5c01\u88c5\u6210\u4e00\u4e2aToken\u7684\u5b9e\u73b0\uff0c\u6bd4\u5982\u6700\u5bb9\u6613\u7406\u89e3\u7684UsernamePasswordAuthenticationToken\u3002</p> <p>SecurityContext</p> <p>\u5f53\u7528\u6237\u901a\u8fc7\u8ba4\u8bc1\u4e4b\u540e\uff0c\u5c31\u4f1a\u4e3a\u8fd9\u4e2a\u7528\u6237\u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684SecurityContext\uff0c\u91cc\u9762\u5305\u542b\u7528\u6237\u7684\u8ba4\u8bc1\u4fe1\u606fAuthentication\u3002\u901a\u8fc7SecurityContext\u6211\u4eec\u53ef\u4ee5\u83b7\u53d6\u5230\u7528\u6237\u7684\u6807\u8bc6Principle\u548c\u6388\u6743\u4fe1\u606fGrantedAuthrity\u3002\u5728\u7cfb\u7edf\u7684\u4efb\u4f55\u5730\u65b9\u53ea\u8981\u901a\u8fc7SecurityHolder.getSecruityContext()\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230SecurityContext\u3002</p> <p>Security\u624d\u4e0d\u7ba1\u4f60\u662f\u89d2\u8272\uff0c\u8fd8\u662f\u6743\u9650\u3002\u5b83\u53ea\u6bd4\u5bf9\u5b57\u7b26\u4e32\u3002</p> <p>\u6bd4\u5982\u5b83\u6709\u4e2a\u8868\u8fbe\u5f0fhasRole(\"ADMIN\")\u3002\u90a3\u5b83\u5b9e\u9645\u4e0a\u67e5\u8be2\u7684\u662f\u7528\u6237\u6743\u9650\u96c6\u5408\u4e2d\u662f\u5426\u5b58\u5728\u5b57\u7b26\u4e32\"ROLE_ADMIN\"\u3002</p> <p>\u7c92\u5ea6\u8bbf\u95ee\u63a7\u5236\uff0c\u6240\u6709URL\u4ee5\"/admin\"\u5f00\u5934\u7684\u7528\u6237\u5fc5\u987b\u62e5\u6709\u89d2\u8272\"ADMIN\"\u624d\u80fd\u8bbf\u95ee\u3002</p> <pre><code>protected void configure(HttpSecurity http) throws Exception {\n        http.authorizeRequests()\n                .antMatchers(\"/admin/**\").access(\"hasRole('ADMIN')\")\n                .antMatchers(\"/user/**\").access(\"hasRole('USER')\")\n                .anyRequest().authenticated();\n\n}\n</code></pre>"},{"location":"web/backend/springcloud/index.html","title":"SpringCloud","text":"<ul> <li>SpringCloud \u793a\u4f8b\u9879\u76ee</li> </ul>"},{"location":"web/backend/springcloud/index.html#springcloud-ailibaba","title":"Springcloud Ailibaba","text":"<ul> <li>\u670d\u52a1\u6ce8\u518c\u548c\u53d1\u73b0\uff1a Alibaba Nacos</li> <li>\u670d\u52a1\u591a\u5b9e\u4f8b\u95f4\u8d1f\u8f7d\u5747\u8861\uff1a\u652f\u6301Ribbon\uff0cSpring Cloud LoadBalance?</li> <li>\u7f51\u5173\uff1aSpring Cloud Gateway</li> <li>\u6d41\u63a7\u548c\u964d\u7ea7\uff1aAlibaba Sentinel</li> <li>\u5206\u5e03\u5f0f\u914d\u7f6e\u4e2d\u5fc3\uff1a Alibaba Nacos</li> <li>\u4e8b\u4ef6\u9a71\u52a8\u548c\u6d88\u606f\u603b\u7ebf\uff1aRocketMQ </li> <li>\u5206\u5e03\u5f0f\u4e8b\u52a1\uff1a Seata</li> <li>RPC\uff1aDubbo RPC</li> </ul>"},{"location":"web/backend/springcloud/discovery.html","title":"\u670d\u52a1\u53d1\u73b0\u4e0e\u6ce8\u518c","text":""},{"location":"web/backend/springcloud/discovery.html#_2","title":"\u5bf9\u6bd4","text":"<p>\u9664\u4e86Nacos\uff0cEureka\uff0cConsul\u5916\uff0c\u4ecd\u53ef\u4ee5\u57fa\u4e8eZookeeper/Etcd \u81ea\u884c\u5b9e\u73b0\u4e00\u5957\u670d\u52a1\u53d1\u73b0\u673a\u5236\u3002</p> <p>DNS\u670d\u52a1\u53d1\u73b0\uff0c\u56e0\u4e3a\u56fa\u6709\u7684\u7f13\u5b58\u7f3a\u9677\uff0c\u6682\u4e0d\u8003\u8651\u3002</p> \u7279\u6027 Nacos Eureka Consul Etcd CAP CP: \u914d\u7f6e\u4e2d\u5fc3AP: \u6ce8\u518c\u4e2d\u5fc3 AP CP CP \u8d1f\u8f7d\u5747\u8861\u7b56\u7565 \u6743\u91cd /metadata/Selector Ribbon Fabio ? \u96ea\u5d29\u4fdd\u62a4 \u6709 \u6709 \u65e0 ? \u670d\u52a1\u5065\u5eb7\u68c0\u67e5 TCP/HTTP/MYSQL/Client Beat Client Beat TCP/HTTP/gRPC/Cmd \u8fde\u63a5\u5fc3\u8df3 \u591a\u6570\u636e\u4e2d\u5fc3 \u652f\u6301 \u652f\u6301 \u652f\u6301 ? \u8de8\u6ce8\u518c\u4e2d\u5fc3\u540c\u6b65 \u652f\u6301 \u4e0d\u652f\u6301 \u652f\u6301 ? \u81ea\u52a8\u6ce8\u9500\u5b9e\u4f8b \u652f\u6301 \u652f\u6301 \u652f\u6301 ? \u96ea\u5d29\u4fdd\u62a4 \u6709 \u6709 \u65e0 ? \u8bbf\u95ee\u534f\u8bae HTTP/DNS HTTP HTTP/DNS ? watch\u652f\u6301 \u652f\u6301 long polling/\u5927\u90e8\u5206\u589e\u91cf \u652f\u6301 long polling/\u5927\u90e8\u5206\u589e\u91cf \u5168\u91cf/\u652f\u6301long polling \u652f\u6301 long polling \u7f16\u7a0b\u8bed\u8a00 Java/go/python Java go Java/go/python/lua Spring Cloud \u96c6\u6210 \u652f\u6301 \u652f\u6301 \u652f\u6301 \u652f\u6301\uff0c2019\u5e74\u6700\u65b0 Dubbo\u96c6\u6210 \u652f\u6301 \u4e0d\u652f\u6301 \u652f\u6301 ? K8s\u96c6\u6210 \u652f\u6301 \u4e0d\u652f\u6301 \u652f\u6301 ?"},{"location":"web/backend/springcloud/discovery.html#consul","title":"Consul","text":"<p>Consul \u4f7f\u7528 Raft \u7b97\u6cd5\u6765\u4fdd\u8bc1\u4e00\u81f4\u6027\uff08\u9700\u8981\u5355\u72ec\u90e8\u7f72\u670d\u52a1\uff09</p> <ul> <li>Service Discovery : \u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0\uff0cConsul \u7684\u5ba2\u6237\u7aef\u53ef\u4ee5\u505a\u4e3a\u4e00\u4e2a\u670d\u52a1\u6ce8\u518c\u5230 Consul\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 Consul \u6765\u67e5\u627e\u7279\u5b9a\u7684\u670d\u52a1\u63d0\u4f9b\u8005\uff0c\u5e76\u4e14\u6839\u636e\u63d0\u4f9b\u7684\u4fe1\u606f\u8fdb\u884c\u8c03\u7528\u3002</li> <li>Health Checking: Consul \u5ba2\u6237\u7aef\u4f1a\u5b9a\u671f\u53d1\u9001\u4e00\u4e9b\u5065\u5eb7\u68c0\u67e5\u6570\u636e\u548c\u670d\u52a1\u7aef\u8fdb\u884c\u901a\u8baf\uff0c\u5224\u65ad\u5ba2\u6237\u7aef\u7684\u72b6\u6001\u3001\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u662f\u5426\u6b63\u5e38\uff0c\u7528\u6765\u76d1\u63a7\u6574\u4e2a\u96c6\u7fa4\u7684\u72b6\u6001\uff0c\u9632\u6b62\u670d\u52a1\u8f6c\u53d1\u5230\u6545\u969c\u7684\u670d\u52a1\u4e0a\u9762\u3002</li> <li>KV Store: Consul \u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5bb9\u6613\u4f7f\u7528\u7684\u952e\u503c\u5b58\u50a8\u3002\u8fd9\u53ef\u4ee5\u7528\u6765\u4fdd\u6301\u52a8\u6001\u914d\u7f6e\uff0c\u534f\u52a9\u670d\u52a1\u534f\u8c03\u3001\u5efa\u7acb Leader \u9009\u4e3e\uff0c\u4ee5\u53ca\u5f00\u53d1\u8005\u60f3\u6784\u9020\u7684\u5176\u5b83\u4e00\u4e9b\u4e8b\u52a1\u3002</li> <li>Secure Service Communication: Consul \u53ef\u4ee5\u4e3a\u670d\u52a1\u751f\u6210\u5206\u5e03\u5f0f\u7684 TLS \u8bc1\u4e66\uff0c\u4ee5\u5efa\u7acb\u76f8\u4e92\u7684 TLS \u8fde\u63a5\u3002 \u53ef\u4ee5\u4f7f\u7528 intentions \u5b9a\u4e49\u5141\u8bb8\u54ea\u4e9b\u670d\u52a1\u8fdb\u884c\u901a\u4fe1\u3002 \u53ef\u4ee5\u4f7f\u7528 intentions \u8f7b\u677e\u7ba1\u7406\u670d\u52a1\u9694\u79bb\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u590d\u6742\u7684\u7f51\u7edc\u62d3\u6251\u548c\u9759\u6001\u9632\u706b\u5899\u89c4\u5219\u3002</li> <li>Multi Datacenter: Consul \u652f\u6301\u5f00\u7bb1\u5373\u7528\u7684\u591a\u6570\u636e\u4e2d\u5fc3\uff0c\u8fd9\u610f\u5473\u7740\u7528\u6237\u4e0d\u9700\u8981\u62c5\u5fc3\u9700\u8981\u5efa\u7acb\u989d\u5916\u7684\u62bd\u8c61\u5c42\u8ba9\u4e1a\u52a1\u6269\u5c55\u5230\u591a\u4e2a\u533a\u57df\u3002</li> </ul>"},{"location":"web/backend/springcloud/discovery.html#euerka","title":"Euerka","text":"<p>Euerka 2.0 \u672a\u53d1\u5e03\u8fc7\uff0c1.0 \u4ecd\u5728\u7ef4\u62a4\uff0c\u4f46\u4e0d\u518d\u5f00\u53d1\u3002</p> <p></p> <p>Eureka\u7684\u96c6\u7fa4\u4e2d\uff0c\u53ea\u8981\u6709\u4e00\u53f0Eureka\u8fd8\u5728\uff0c\u5c31\u80fd\u4fdd\u8bc1\u6ce8\u518c\u670d\u52a1\u53ef\u7528\uff08\u4fdd\u8bc1\u53ef\u7528\u6027\uff09\uff0c\u53ea\u4e0d\u8fc7\u67e5\u5230\u7684\u4fe1\u606f\u53ef\u80fd\u4e0d\u662f\u6700\u65b0\u7684\uff08\u4e0d\u4fdd\u8bc1\u5f3a\u4e00\u81f4\u6027\uff09\u3002</p>"},{"location":"web/backend/springcloud/discovery.html#eureka-server","title":"Eureka Server","text":"<p>Eureka server\u548cclient\u4e4b\u95f4\u6bcf\u969430\u79d2\u4f1a\u8fdb\u884c\u4e00\u6b21\u5fc3\u8df3\u901a\u4fe1\uff0c\u544a\u8bc9server\uff0cclient\u8fd8\u6d3b\u7740\u3002\u7531\u6b64\u5f15\u51fa\u4e24\u4e2a\u540d\u8bcd\uff1a </p> <ul> <li>Renews threshold\uff1aserver\u671f\u671b\u5728\u6bcf\u5206\u949f\u4e2d\u6536\u5230\u7684\u5fc3\u8df3\u6b21\u6570 </li> <li>Renews (last min)\uff1a\u4e0a\u4e00\u5206\u949f\u5185\u6536\u5230\u7684\u5fc3\u8df3\u6b21\u6570\u3002</li> </ul> <p>client\u4e2a\u6570\u4e3an\uff0c\u9608\u503c\u4e3a1+2*n\uff08\u6b64\u4e3a\u4e00\u4e2aserver\u4e14\u7981\u6b62\u81ea\u6ce8\u518c\u7684\u60c5\u51b5\uff09 </p> <p>Eurake\u6709\u4e00\u4e2a\u914d\u7f6e\u53c2\u6570<code>eureka.server.renewalPercentThreshold</code>\uff0c\u5b9a\u4e49\u4e86renews \u548crenews threshold\u7684\u6bd4\u503c\uff0c\u9ed8\u8ba4\u503c\u4e3a0.85\u3002\u5f53server\u572815\u5206\u949f\u5185\uff0c\u6bd4\u503c\u4f4e\u4e8epercent\uff0c\u5373\u5c11\u4e8615%\u7684\u5fae\u670d\u52a1\u5fc3\u8df3\uff0cserver\u4f1a\u8fdb\u5165\u81ea\u6211\u4fdd\u62a4\u72b6\u6001\uff0c<code>Self-Preservation</code>\u3002\u5728\u6b64\u72b6\u6001\u4e0b\uff0cserver\u4e0d\u4f1a\u5220\u9664\u6ce8\u518c\u4fe1\u606f\uff0c\u8fd9\u5c31\u6709\u53ef\u80fd\u5bfc\u81f4\u5728\u8c03\u7528\u5fae\u670d\u52a1\u65f6\uff0c\u5b9e\u9645\u4e0a\u670d\u52a1\u5e76\u4e0d\u5b58\u5728\u3002 </p> <p>\u8fd9\u79cd\u4fdd\u62a4\u72b6\u6001\u5b9e\u9645\u4e0a\u662f\u8003\u8651\u4e86client\u548cserver\u4e4b\u95f4\u7684\u5fc3\u8df3\u662f\u56e0\u4e3a\u7f51\u7edc\u95ee\u9898\uff0c\u800c\u975e\u670d\u52a1\u672c\u8eab\u95ee\u9898\uff0c\u4e0d\u80fd\u7b80\u5355\u7684\u5220\u9664\u6ce8\u518c\u4fe1\u606f\u3002</p>"},{"location":"web/backend/springcloud/discovery.html#eureka-client","title":"Eureka Client","text":"<p>TODO\uff1a health check</p> <p>Net\ufb02ix Ribbon\u662f\u4e00\u4e2a\u548cEureka\u5171\u540c\u5de5\u4f5c\u7684<code>IPC</code>\u5ba2\u6237\u7aef\uff0c\u5b83\u8d1f\u8d23\u5c06\u8bf7\u6c42\u8d1f\u8f7d\u5747\u8861\u5230\u53ef\u7528\u7684\u670d\u52a1\u5b9e\u4f8b\u4e0a\u3002\uff08\u7ef4\u62a4\u72b6\u6001\uff0cSpring Cloud LoadBalancer\u4f5c\u4e3a\u66ff\u4ee3\uff09\u3002</p>"},{"location":"web/backend/springcloud/discovery.html#nacos","title":"Nacos","text":"<p>Nacos \u652f\u6301\u57fa\u4e8e DNS \u548c\u57fa\u4e8e RPC \u7684\u670d\u52a1\u53d1\u73b0\uff0c\u8fd8\u652f\u6301\u52a8\u6001\u914d\u7f6e\u670d\u52a1\u3002</p> <ul> <li>\u914d\u7f6e\u4e3b\u8981\u7528\u4e8e\u5fae\u670d\u52a1\u573a\u666f\uff0c\u57fa\u4e8e groupId \u548c dataId \u8fdb\u884c\u76d1\u542c\uff1b</li> </ul>"},{"location":"web/backend/springcloud/discovery.html#etcd","title":"Etcd","text":"<p>Etcd \u5206\u5e03\u5f0f\u7684\u952e\u503c\u5bf9\u6570\u636e\u5b58\u50a8\u7cfb\u7edf\uff0c\u57fa\u4e8eRaft\u7b97\u6cd5\u3002</p> <ul> <li>\u91c7\u7528\u5c42\u6b21\u5316\u76ee\u5f55\u7ec4\u7ec7\u5b58\u50a8\u6570\u636e\uff0c\u7c7b\u4f3c\u6807\u51c6\u7684\u6587\u4ef6\u7cfb\u7edf\uff1b</li> <li>\u53ef\u4ee5\u76d1\u542c\u7279\u5b9a\u7684Key\u6216\u8005\u76ee\u5f55\u7684\u53d8\u5316\uff1b</li> </ul> <p>\u57fa\u4e8eEtcd\uff0c\u5c01\u88c5\u63d0\u4f9b\u5171\u4eab\u914d\u7f6e\u3001\u670d\u52a1\u7684\u6ce8\u518c\u548c\u53d1\u73b0\u3002</p>"},{"location":"web/backend/springcloud/feign.html","title":"\u670d\u52a1\u95f4\u8c03\u7528","text":""},{"location":"web/backend/springcloud/gateway.html","title":"SpringCloudGateway","text":"<p>Spring Cloud Gateway \u57fa\u4e8e Spring Boot 2.x, Spring WebFlux, and Project Reactor \u3002</p> <p>\u56e0\u6b64\u4e00\u4e9b\u540c\u6b65\u5e93\uff08Spring Data and Spring Security\u7b49\uff09\u65e0\u6cd5\u4e00\u8d77\u4f7f\u7528\u3002</p> <p>\u4f9d\u8d56\u8fd0\u884c\u65f6\u7684Netty\u3002</p>"},{"location":"web/backend/springcloud/gateway.html#eureka","title":"Eureka \u81ea\u52a8\u670d\u52a1\u53d1\u73b0\u914d\u7f6e","text":"<p>\u5982\u679c<code>Eureka Server</code>\u4e0a\u6709\u4e24\u4e2a\u76f8\u540c<code>serviceId</code>\u7684\u670d\u52a1\u65f6\uff0c<code>SpringCloud Gateway</code>\u4f1a\u81ea\u52a8\u5b8c\u6210\u8d1f\u8f7d\u5747\u8861\u3002</p> <pre><code># \u670d\u52a1\u540d\u79f0\nspring:\n  application:\n    name: spring-cloud-gateway\n  # \u5f00\u542f Gateway \u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u670d\u52a1\u53d1\u73b0\uff08\u5bf9\u5185\u7f6e\u652f\u6301\u7684\u670d\u52a1\u53d1\u73b0\u901a\u7528\uff09\n  cloud:\n    gateway:\n      discovery:\n        locator:\n          enabled: true\n# Eureka Server \u914d\u7f6e\uff0c\u4e0d\u540c\u7684\u670d\u52a1\u53d1\u73b0\u4e0d\u540c\u673a\u5236\neureka:\n  client:\n    service-url:\n      defaultZone: http://localhost:10000/eureka/\n# \u914d\u7f6eGateway\u65e5\u5fd7\u7b49\u7ea7\uff0c\u8f93\u51fa\u8f6c\u53d1\u7ec6\u8282\u4fe1\u606f\nlogging:\n  level:\n    org.springframework.cloud.gateway: debug\n</code></pre> <p><code>spring.cloud.gateway.discovery.locator.enabled</code>\u8bbe\u7f6e\u4e3atrue\u65f6\uff0c\u5c06 <code>/serviceId/**</code>\u5339\u914d\u5230\u5bf9\u5e94\u7684\u670d\u52a1\uff1b\u5e76\u4e14\u5c06 <code>/serviceId/(?&lt;remaining&gt;.*)</code>URL\u91cd\u5199\u4e3a <code>/${remaining}</code>\u3002</p>"},{"location":"web/backend/springcloud/gateway.html#_1","title":"\u8fc7\u6ee4","text":"<p>gateway \u53ea\u6709\u4fe9\u79cd\u8fc7\u6ee4\u5668\uff1a\u201cpre\u201d \u548c \u201cpost\u201d\u3002</p> <ul> <li>PRE\uff1a \u8fd9\u79cd\u8fc7\u6ee4\u5668\u5728\u8bf7\u6c42\u88ab\u8def\u7531\u4e4b\u524d\u8c03\u7528\u3002</li> <li>POST\uff1a\u8fd9\u79cd\u8fc7\u6ee4\u5668\u5728\u8def\u7531\u5230\u5fae\u670d\u52a1\u4ee5\u540e\u6267\u884c\u3002</li> </ul> <p>GatewayFilter \u4e0e GlobalFilter\u3002</p> <ul> <li>GlobalFilter\uff1a \u5168\u5c40\u8fc7\u6ee4\u5668</li> <li>GatewayFilter\uff1a \u5c06\u5e94\u7528\u5230\u5355\u4e2a\u8def\u7531\u6216\u8005\u4e00\u4e2a\u5206\u7ec4\u7684\u8def\u7531\u4e0a\u3002</li> </ul>"},{"location":"web/backend/springcloud/gateway.html#websocket","title":"Websocket \u914d\u7f6e","text":"<p>spring \u9ed8\u8ba4\u652f\u6301 websocket</p> <pre><code># websocket \u7684frame\u6700\u5927\u914d\u7f6e\uff0c\u9ed8\u8ba464K\nspring.cloud.gateway.httpclient.websocket.max-frame-payload-length\n# Proxy ping frames to downstream services, defaults to true\nspring.cloud.gateway.httpclient.websocket.proxy-ping\n</code></pre>"},{"location":"web/backend/springcloud/gateway.html#swagger","title":"Swagger\u96c6\u6210","text":"<p>\u91c7\u7528 SpringDoc\uff0c\u91cd\u5199 SwaggerUiConfigProperties \u7684\u914d\u7f6e\u4fe1\u606f\u3002</p> <ul> <li>\u5f15\u5165 <code>springdoc-openapi-webflux-ui</code>\u4f9d\u8d56\uff0c\u800c\u975e<code>springdoc-openapi-ui</code>\u3002</li> </ul> <pre><code>@Bean\npublic List&lt;GroupedOpenApi&gt; apis(SwaggerUiConfigProperties configProperties, RouteDefinitionLocator routeLocator) {\n    List&lt;GroupedOpenApi&gt; groups = new ArrayList&lt;&gt;();\n    // \u83b7\u53d6\u6240\u6709\u53ef\u7528\u7684\u670d\u52a1\u5730\u5740\n    List&lt;RouteDefinition&gt; definitions = routeLocator.getRouteDefinitions().collectList().block();\n    if (CollectionUtils.isEmpty(definitions)) {\n        return groups;\n    }\n    Set&lt;AbstractSwaggerUiConfigProperties.SwaggerUrl&gt; urls = new HashSet&lt;&gt;();\n    definitions.stream().filter(route -&gt; route.getUri().getHost() != null)\n        .distinct()\n        .forEach(route -&gt; {\n                // service low case\n                String name = route.getUri().getHost().toLowerCase(Locale.ROOT);\n                // \u6392\u67e5 Eureka \u548c\u7f51\u5173\u670d\u52a1\n                if (!name.contains(\"eureka\") &amp;&amp; !name.contains(\"gateway\")) {\n                    AbstractSwaggerUiConfigProperties.SwaggerUrl swaggerUrl = new AbstractSwaggerUiConfigProperties.SwaggerUrl();\n                    swaggerUrl.setName(name);\n                    swaggerUrl.setUrl(String.format(API_URI, name));\n                    urls.add(swaggerUrl);\n                }\n            }\n        );\n    configProperties.setUrls(urls);\n    return groups;\n}\n</code></pre>"},{"location":"web/backend/trace/Jaeger.html","title":"Jaeger","text":"<p>CNCF \u57fa\u91d1\u4f1a\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7cfb\u7edf\u3002</p> <p>open source, end-to-end distributed tracing</p> <p>Monitor and troubleshoot transactions in complex distributed systems</p>"},{"location":"web/backend/trace/Jaeger.html#_1","title":"\u67b6\u6784","text":"<p>jaeger-client\uff1ajaeger \u7684\u5ba2\u6237\u7aef\uff0c\u5b9e\u73b0\u4e86opentracing\u534f\u8bae\uff1b</p> <p>jaeger-agent\uff1ajaeger client\u7684\u4e00\u4e2a\u4ee3\u7406\u7a0b\u5e8f\uff0cclient\u5c06\u6536\u96c6\u5230\u7684\u8c03\u7528\u94fe\u6570\u636e\u53d1\u7ed9agent\uff0c\u7136\u540e\u7531agent\u53d1\u7ed9collector\uff1b</p> <p>jaeger-collector\uff1a\u8d1f\u8d23\u63a5\u6536jaeger client\u6216\u8005jaeger agent\u4e0a\u62a5\u4e0a\u6765\u7684\u8c03\u7528\u94fe\u6570\u636e\uff0c\u7136\u540e\u505a\u4e00\u4e9b\u6821\u9a8c\uff0c\u6bd4\u5982\u65f6\u95f4\u8303\u56f4\u662f\u5426\u5408\u6cd5\u7b49\uff0c\u6700\u7ec8\u4f1a\u7ecf\u8fc7\u5185\u90e8\u7684\u5904\u7406\u5b58\u50a8\u5230\u540e\u7aef\u5b58\u50a8\uff1b</p> <p>jaeger-query\uff1a\u4e13\u95e8\u8d1f\u8d23\u8c03\u7528\u94fe\u67e5\u8be2\u7684\u4e00\u4e2a\u670d\u52a1\uff0c\u6709\u81ea\u5df1\u72ec\u7acb\u7684UI\uff1b</p> <p>jaeger-ingester\uff1a\u4e2d\u6587\u540d\u79f0\u201c\u6444\u98df\u8005\u201d\uff0c\u53ef\u7528\u4ecekafka\u8bfb\u53d6\u6570\u636e\u7136\u540e\u5199\u5230jaeger\u7684\u540e\u7aef\u5b58\u50a8\uff0c\u6bd4\u5982Cassandra\u548cElasticsearch\uff1b</p> <p>spark-job\uff1a\u57fa\u4e8espark\u7684\u8fd0\u7b97\u4efb\u52a1\uff0c\u53ef\u4ee5\u8ba1\u7b97\u670d\u52a1\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u8c03\u7528\u6b21\u6570\u7b49\uff1b</p>"},{"location":"web/backend/trace/Jaeger.html#api","title":"API","text":"<p>\u4f7f\u7528 OpenTelemetry</p>"},{"location":"web/backend/trace/OpenTelemetry.html","title":"OpenTelemetry","text":"<p>OpenTelemetry\u7684\u53d1\u8d77\u8005\u90fd\u662fOpenTracing\u548cOpenCensus\u7684\u4eba\uff0c\u6240\u4ee5\u9879\u76ee\u7684\u7b2c\u4e00\u5b97\u65e8\u5c31\u662f\uff1a\u517c\u5bb9OpenTracing\u548cOpenCensus\u3002\u5bf9\u4e8e\u4f7f\u7528OpenTracing\u6216OpenCensus\u7684\u5e94\u7528\u4e0d\u9700\u8981\u91cd\u65b0\u6539\u52a8\u5c31\u53ef\u4ee5\u63a5\u5165OpenTelemetry\u3002</p> <p>\u6838\u5fc3\u5de5\u4f5c\u4e3b\u8981\u96c6\u4e2d\u57283\u4e2a\u90e8\u5206\uff1a</p> <ol> <li>\u89c4\u8303\u7684\u5236\u5b9a\uff0c\u5305\u62ec\u6982\u5ff5\u3001\u534f\u8bae\u3001API\uff0c\u9664\u4e86\u81ea\u8eab\u7684\u534f\u8bae\u5916\uff0c\u8fd8\u9700\u8981\u628a\u8fd9\u4e9b\u89c4\u8303\u548cW3C\u3001GRPC\u8fd9\u4e9b\u534f\u8bae\u8fbe\u6210\u4e00\u81f4\uff1b</li> <li>\u76f8\u5173SDK\u3001Tool\u7684\u5b9e\u73b0\u548c\u96c6\u6210\uff0c\u5305\u62ec\u5404\u7c7b\u8bed\u8a00\u7684SDK\u3001\u4ee3\u7801\u81ea\u52a8\u6ce8\u5165\u3001\u5176\u4ed6\u4e09\u65b9\u5e93\uff08Log4j\u3001LogBack\u7b49\uff09\u7684\u96c6\u6210\uff1b</li> <li>\u91c7\u96c6\u7cfb\u7edf\u7684\u5b9e\u73b0\uff0c\u76ee\u524d\u8fd8\u662f\u91c7\u7528OpenCensus\u7684\u91c7\u96c6\u67b6\u6784\uff0c\u5305\u62ecAgent\u548cCollector\u3002</li> </ol>"},{"location":"web/backend/trace/OpenTelemetry.html#_1","title":"\u67b6\u6784","text":"<p>\u5b98\u65b9\u76ee\u524d\u63a8\u8350\u7684\u662f\u7528Prometheus\u53bb\u505aMetrics\u7684Backend\u3001\u7528 Jaeger \u53bb\u505aTracing\u7684Backend\u3002</p> <p>OpenTelemetry\u7684\u7ec8\u6001\u5c31\u662f\u5b9e\u73b0Metrics\u3001Tracing\u3001Logging\u7684\u878d\u5408\uff0c\u4f5c\u4e3aCNCF\u53ef\u89c2\u5bdf\u6027\u7684\u7ec8\u6781\u89e3\u51b3\u65b9\u6848\u3002</p> <p>Tracing\uff1a\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8bf7\u6c42\u4ece\u63a5\u6536\u5230\u5904\u7406\u5b8c\u6bd5\u6574\u4e2a\u751f\u547d\u5468\u671f\u7684\u8ddf\u8e2a\u8def\u5f84\uff0c\u901a\u5e38\u8bf7\u6c42\u90fd\u662f\u5728\u5206\u5e03\u5f0f\u7684\u7cfb\u7edf\u4e2d\u5904\u7406\uff0c\u6240\u4ee5\u4e5f\u53eb\u505a\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a\u3002</p> <p>Metrics\uff1a\u63d0\u4f9b\u91cf\u5316\u7684\u7cfb\u7edf\u5185/\u5916\u90e8\u5404\u4e2a\u7ef4\u5ea6\u7684\u6307\u6807\uff0c\u4e00\u822c\u5305\u62ecCounter\u3001Gauge\u3001Histogram\u7b49\u3002</p> <p>Logging\uff1a\u63d0\u4f9b\u7cfb\u7edf/\u8fdb\u7a0b\u6700\u7cbe\u7ec6\u5316\u7684\u4fe1\u606f\uff0c\u4f8b\u5982\u67d0\u4e2a\u5173\u952e\u53d8\u91cf\u3001\u4e8b\u4ef6\u3001\u8bbf\u95ee\u8bb0\u5f55\u7b49\u3002</p>"},{"location":"web/backend/trace/apache_skywalking.html","title":"Apache SkyWalking","text":"<p>\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\u76d1\u89c6\u5de5\u5177\uff0c\u4e13\u4e3a\u5fae\u670d\u52a1\u3001\u4e91\u539f\u751f\u67b6\u6784\u548c\u57fa\u4e8e\u5bb9\u5668\uff08Docker\u3001K8s\u3001Mesos\uff09\u67b6\u6784\u800c\u8bbe\u8ba1\u3002</p> <p>\u63d0\u4f9b\u5206\u5e03\u5f0f\u8ffd\u8e2a\u3001\u670d\u52a1\u7f51\u683c\u9065\u6d4b\u5206\u6790\u3001\u5ea6\u91cf\u805a\u5408\u548c\u53ef\u89c6\u5316\u4e00\u4f53\u5316\u89e3\u51b3\u65b9\u6848\u3002</p>"},{"location":"web/backend/trace/apache_skywalking.html#_1","title":"\u67b6\u6784","text":"<p>\u8003\u8651\u5230\u8ba9\u63cf\u8ff0\u66f4\u7b80\u5355\uff0c\u6211\u4eec\u820d\u5f03\u6389 Metric \u6307\u6807\u76f8\u5173\uff0c\u800c\u7740\u91cd\u5728 Tracing \u94fe\u8def\u76f8\u5173\u529f\u80fd\u3002</p> <ul> <li> <p>\u4e0a\u90e8\u5206 Agent \uff1a\u8d1f\u8d23\u4ece\u5e94\u7528\u4e2d\uff0c\u6536\u96c6\u94fe\u8def\u4fe1\u606f\uff0c\u53d1\u9001\u7ed9 SkyWalking OAP \u670d\u52a1\u5668\u3002\u76ee\u524d\u652f\u6301 SkyWalking\u3001Zikpin\u3001Jaeger \u7b49\u63d0\u4f9b\u7684 Tracing \u6570\u636e\u4fe1\u606f\u3002\u800c\u6211\u4eec\u76ee\u524d\u91c7\u7528\u7684\u662f\uff0cSkyWalking Agent \u6536\u96c6 SkyWalking Tracing \u6570\u636e\uff0c\u4f20\u9012\u7ed9\u670d\u52a1\u5668\u3002</p> </li> <li> <p>\u4e0b\u90e8\u5206 SkyWalking OAP \uff1a\u8d1f\u8d23\u63a5\u6536 Agent \u53d1\u9001\u7684 Tracing \u6570\u636e\u4fe1\u606f\uff0c\u7136\u540e\u8fdb\u884c\u5206\u6790(Analysis Core) \uff0c\u5b58\u50a8\u5230\u5916\u90e8\u5b58\u50a8\u5668( Storage )\uff0c\u6700\u7ec8\u63d0\u4f9b\u67e5\u8be2( Query )\u529f\u80fd\u3002</p> </li> <li>\u53f3\u90e8\u5206 Storage \uff1aTracing \u6570\u636e\u5b58\u50a8\u3002\u76ee\u524d\u652f\u6301 ES\u3001MySQL\u3001Sharding Sphere\u3001TiDB\u3001H2 \u591a\u79cd\u5b58\u50a8\u5668\u3002\u800c\u6211\u4eec\u76ee\u524d\u91c7\u7528\u7684\u662f ES \uff0c\u4e3b\u8981\u8003\u8651\u662f SkyWalking \u5f00\u53d1\u56e2\u961f\u81ea\u5df1\u7684\u751f\u4ea7\u73af\u5883\u91c7\u7528 ES \u4e3a\u4e3b\u3002</li> <li>\u5de6\u90e8\u5206 SkyWalking UI \uff1a\u8d1f\u8d23\u63d0\u4f9b\u63a7\u53f0\uff0c\u67e5\u770b\u94fe\u8def\u7b49\u7b49\u3002</li> </ul>"},{"location":"web/backend/trace/apache_skywalking.html#java-agent","title":"Java Agent","text":"<p>https://github.com/apache/skywalking/tree/v8.2.0/docs/en/setup/service-agent/java-agent</p>"},{"location":"web/backend/trace/apache_skywalking.html#log","title":"log","text":""},{"location":"web/backend/trace/apache_skywalking.html#_2","title":"\u4f7f\u7528","text":""},{"location":"web/backend/trace/apache_skywalking.html#_3","title":"\u96c6\u7fa4","text":"<p>SkyWalking \u96c6\u7fa4\u73af\u5883\uff0c\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b65\uff0c\u642d\u5efa\u4e00\u4e2a Elasticsearch \u670d\u52a1\u7684\u96c6\u7fa4\u3002</li> <li>\u7b2c\u4e8c\u6b65\uff0c\u642d\u5efa\u4e00\u4e2a\u6ce8\u518c\u4e2d\u5fc3\u7684\u96c6\u7fa4\u3002\u76ee\u524d SkyWalking \u652f\u6301 Zookeeper\u3001Kubernetes\u3001Consul\u3001Nacos \u4f5c\u4e3a\u6ce8\u518c\u4e2d\u5fc3\u3002</li> <li>\u7b2c\u4e09\u6b65\uff0c\u642d\u5efa\u4e00\u4e2a SkyWalking OAP \u670d\u52a1\u7684\u96c6\u7fa4\uff0c\u540c\u65f6\u53c2\u8003\u300aSkyWalking \u6587\u6863 \u2014\u2014 \u96c6\u7fa4\u7ba1\u7406\u300b\uff0c\u5c06 SkyWalking OAP \u670d\u52a1\u6ce8\u518c\u5230\u6ce8\u518c\u4e2d\u5fc3\u4e0a\u3002</li> <li>\u7b2c\u56db\u6b65\uff0c\u542f\u52a8\u4e00\u4e2a Spring Boot \u5e94\u7528\uff0c\u5e76\u914d\u7f6e SkyWalking Agent\u3002\u53e6\u5916\uff0c\u5728\u8bbe\u7f6e SkyWaling Agent \u7684 <code>SW_AGENT_COLLECTOR_BACKEND_SERVICES</code> \u5730\u5740\u65f6\uff0c\u9700\u8981\u8bbe\u7f6e\u591a\u4e2a SkyWalking OAP \u670d\u52a1\u7684\u5730\u5740\u6570\u7ec4\u3002</li> <li>\u7b2c\u4e94\u6b65\uff0c\u642d\u5efa\u4e00\u4e2a SkyWalking UI \u670d\u52a1\u7684\u96c6\u7fa4\uff0c\u540c\u65f6\u4f7f\u7528 Nginx \u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\u3002\u53e6\u5916\uff0c\u5728\u8bbe\u7f6e SkyWalking UI \u7684 <code>collector.ribbon.listOfServers</code> \u5730\u5740\u65f6\uff0c\u4e5f\u9700\u8981\u8bbe\u7f6e\u591a\u4e2a SkyWalking OAP \u670d\u52a1\u7684\u5730\u5740\u6570\u7ec4\u3002</li> </ul> <p></p>"},{"location":"web/backend/trace/sentry.html","title":"Sentry","text":"<p>Sentry is cross-platform application monitoring, with a focus on error reporting.</p>"},{"location":"web/backend/trace/tracing.html","title":"Trace","text":"<p>Logging\uff1a</p> <ul> <li>\u4e00\u6761\u4e00\u6761\u7684\u8bb0\u5f55\uff0c\u800c\u8bb0\u5f55\u672c\u8eab\u662f\u79bb\u6563\u4e8b\u4ef6\uff0c\u6ca1\u6709\u4efb\u4f55\u76f4\u63a5\u5173\u7cfb\u3002Logging \u53ef\u4ee5\u5728 Console\u3001ElasticSearch\u3001Kafka\u3001File \u7b49\u5404\u79cd\u5a92\u4ecb\u4e2d\u663e\u793a\u3002\u800c Logging \u7684\u683c\u5f0f\u53c8\u53ef\u4ee5\u901a\u8fc7\u5404\u79cd Logging \u7684\u5b9e\u73b0\u53bb\u5b9a\u4e49 Logging \u7684\u683c\u5f0f\u3002</li> </ul> <p>Tracing\uff1a</p> <ul> <li>\u6574\u4e2a\u5904\u7406\u94fe\u6761\u7684\u95f4\u63a5\u5173\u7cfb\uff0c\u628a\u5404\u79cd\u79bb\u6563\u7684 Logging \u4ea7\u751f\u8054\u7cfb\uff0c\u8ba9\u5404\u79cd\u5904\u7406\u4e8b\u4ef6\u4ea7\u751f\u4e00\u5b9a\u8303\u56f4\u3002</li> </ul>"},{"location":"web/backend/trace/tracing.html#_1","title":"\u4ecb\u7ecd","text":"<ul> <li>Trace\uff1a\u4e00\u6b21\u5b8c\u6574\u7684\u5206\u5e03\u5f0f\u8c03\u7528\u8ddf\u8e2a\u94fe\u8def\u3002</li> <li>Span\uff1a\u8de8\u670d\u52a1\u7684\u4e00\u6b21\u8c03\u7528\uff1b \u591a\u4e2a Span \u7ec4\u5408\u6210\u4e00\u6b21 Trace \u8ffd\u8e2a\u8bb0\u5f55\u3002</li> </ul> <p>\u4e00\u4e2a\u5b8c\u6574\u7684\u8c03\u7528\u94fe\u8ddf\u8e2a\u7cfb\u7edf\uff0c\u5305\u62ec\u8c03\u7528\u94fe\u57cb\u70b9\uff0c\u8c03\u7528\u94fe\u6570\u636e\u6536\u96c6\uff0c\u8c03\u7528\u94fe\u6570\u636e\u5b58\u50a8\u548c\u5904\u7406\uff0c\u8c03\u7528\u94fe\u6570\u636e\u68c0\u7d22\uff08\u9664\u4e86\u63d0\u4f9b\u68c0\u7d22\u7684 APIServer\uff0c\u4e00\u822c\u8fd8\u8981\u5305\u542b\u4e00\u4e2a\u9177\u70ab\u7684\u8c03\u7528\u94fe\u524d\u7aef\uff09\u7b49\u82e5\u5e72\u91cd\u8981\u7ec4\u4ef6\u3002</p> <p></p> <p>\u6309\u7167\u8c03\u7528\u65f6\u95f4\u8fdb\u884c\u6392\u5e8f\u7684\u8c03\u7528\u8fc7\u7a0b\u56fe\u793a\uff1a</p> <p></p>"},{"location":"web/backend/trace/tracing.html#_2","title":"\u76f8\u5173\u5de5\u4f5c","text":"<ul> <li>Dapper\uff1aGoogle \u751f\u4ea7\u73af\u5883\u4e0b\u7684\u5206\u5e03\u5f0f\u8ddf\u8e2a\u7cfb\u7edf\uff0c\u9f3b\u7956\uff1b</li> <li>Zipkin\uff1a\u5206\u5e03\u5f0f\u65e5\u5fd7\u94fe\u8def\u8ddf\u8e2a\u7cfb\u7edf\uff0cOpenZipkin \u793e\u533a\u7ba1\u7406\uff1b</li> <li>Sleuth\uff1aSpring Cloud\uff0c\u5206\u5e03\u5f0f\u8ffd\u8e2a\u89e3\u51b3\u65b9\u6848\uff0c\u5176\u517c\u5bb9\u4e86Zipkin\u3001OpenTracing\uff1b</li> <li>Jaeger\uff1aCNCF\uff0c\u5206\u5e03\u5f0f\u8ddf\u8e2a\u7cfb\u7edf\uff1b</li> <li>SkyWalking\uff1aApache\uff0cTracing + Metrics + Logging\uff1b</li> <li>OpenTelemetry\uff1aCNCF\uff0c\u96c6\u6210OpenTracing\u548cOpenCensus\u4e24\u4e2a\u9879\u76ee\u5f62\u6210\uff0cTracing + Metrics + Logging\uff1b</li> </ul>"},{"location":"web/front/javascript.html","title":"JavaScript","text":"<p>ECMAScript \u662f javascript \u6807\u51c6\uff0cTypeScript\u662fJavascript\u7684\u8d85\u96c6\uff0c\u5b9e\u73b0\u4ee5\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\u7684\u65b9\u5f0f\u4f7f\u7528Javascript\u3002\u5f53\u7136\u6700\u540e\u4ee3\u7801\u8fd8\u662f\u7f16\u8bd1\u4e3aJavascript\u3002</p>"},{"location":"web/front/javascript.html#_1","title":"\u5f02\u6b65","text":""},{"location":"web/front/javascript.html#export-default-export","title":"export default \u548c export \u533a\u522b","text":"<ul> <li>export\u4e0eexport default\u5747\u53ef\u7528\u4e8e\u5bfc\u51fa\u5e38\u91cf\u3001\u51fd\u6570\u3001\u6587\u4ef6\u3001\u6a21\u5757\u7b49</li> <li>\u4f60\u53ef\u4ee5\u5728\u5176\u5b83\u6587\u4ef6\u6216\u6a21\u5757\u4e2d\u901a\u8fc7import+(\u5e38\u91cf | \u51fd\u6570 | \u6587\u4ef6 | \u6a21\u5757)\u540d\u7684\u65b9\u5f0f\uff0c\u5c06\u5176\u5bfc\u5165\uff0c\u4ee5\u4fbf\u80fd\u591f\u5bf9\u5176\u8fdb\u884c\u4f7f\u7528</li> <li>\u5728\u4e00\u4e2a\u6587\u4ef6\u6216\u6a21\u5757\u4e2d\uff0cexport\u3001import\u53ef\u4ee5\u6709\u591a\u4e2a\uff0cexport default \u4ec5\u6709\u4e00\u4e2a</li> <li>\u901a\u8fc7export\u65b9\u5f0f\u5bfc\u51fa\uff0c\u5728\u5bfc\u5165\u65f6\u8981\u52a0{ }\uff0cexport default\u5219\u4e0d\u9700\u8981</li> </ul>"},{"location":"web/front/ui_auto_test.html","title":"Web \u81ea\u52a8\u5316\u6d4b\u8bd5","text":""},{"location":"web/front/ui_auto_test.html#google-chrome-record","title":"Google Chrome Record","text":"<p>Google Chrome Web \u811a\u672c\u5f55\u5236\u56de\u653e\u529f\u80fd</p> <p>\u5b9e\u9645\u4e0a\u57fa\u4e8e\u300c puppeteer \u300d\u6765\u5b9e\u73b0\u7684\uff0c\u53ef\u4ee5\u5bfc\u51fa\u4e3a json \u683c\u5f0f \u6216\u8005 puppeteer/replay \u811a\u672c\uff1b</p> <ul> <li>puppeteer/replay \u7684\u811a\u672c\uff0c\u5305\u542b\u5bf9\u5e94\u7684json \u683c\u5f0f\u5185\u5bb9\u3002</li> </ul>"},{"location":"web/front/ui_auto_test.html#puppeteerreplay","title":"puppeteer/replay","text":"<p>Puppeteer Replay is a library that provides an API to replay and stringify recordings created using Chrome DevTools Recorder</p>"},{"location":"web/front/ui_auto_test.html#automa","title":"Automa","text":"<p>An extension for automating your browser by connecting blocks.</p> <p>\u62d6\u62fd\u5f0f\u6784\u5efaweb\u81ea\u52a8\u5316</p>"},{"location":"web/front/micro_front/qiankun.html","title":"\u4e7e\u5764\u6846\u67b6","text":"<p>\u57fa\u4e8e single-spa \u7684\u5fae\u524d\u7aef\u5b9e\u73b0\u5e93\u3002</p> <p>\u5fae\u524d\u7aef\u67b6\u6784\u5177\u5907\u4ee5\u4e0b\u51e0\u4e2a\u6838\u5fc3\u4ef7\u503c\uff1a</p> <ul> <li> <p>\u6280\u672f\u6808\u65e0\u5173   \u4e3b\u6846\u67b6\u4e0d\u9650\u5236\u63a5\u5165\u5e94\u7528\u7684\u6280\u672f\u6808\uff0c\u5fae\u5e94\u7528\u5177\u5907\u5b8c\u5168\u81ea\u4e3b\u6743</p> </li> <li> <p>\u72ec\u7acb\u5f00\u53d1\u3001\u72ec\u7acb\u90e8\u7f72   \u5fae\u5e94\u7528\u4ed3\u5e93\u72ec\u7acb\uff0c\u524d\u540e\u7aef\u53ef\u72ec\u7acb\u5f00\u53d1\uff0c\u90e8\u7f72\u5b8c\u6210\u540e\u4e3b\u6846\u67b6\u81ea\u52a8\u5b8c\u6210\u540c\u6b65\u66f4\u65b0</p> </li> <li> <p>\u589e\u91cf\u5347\u7ea7</p> </li> </ul> <p>\u5728\u9762\u5bf9\u5404\u79cd\u590d\u6742\u573a\u666f\u65f6\uff0c\u6211\u4eec\u901a\u5e38\u5f88\u96be\u5bf9\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684\u7cfb\u7edf\u505a\u5168\u91cf\u7684\u6280\u672f\u6808\u5347\u7ea7\u6216\u91cd\u6784\uff0c\u800c\u5fae\u524d\u7aef\u662f\u4e00\u79cd\u975e\u5e38\u597d\u7684\u5b9e\u65bd\u6e10\u8fdb\u5f0f\u91cd\u6784\u7684\u624b\u6bb5\u548c\u7b56\u7565</p> <ul> <li>\u72ec\u7acb\u8fd0\u884c\u65f6   \u6bcf\u4e2a\u5fae\u5e94\u7528\u4e4b\u95f4\u72b6\u6001\u9694\u79bb\uff0c\u8fd0\u884c\u65f6\u72b6\u6001\u4e0d\u5171\u4eab</li> </ul>"},{"location":"web/front/micro_front/qiankun.html#_2","title":"\u4f7f\u7528","text":""},{"location":"web/front/micro_front/qiankun.html#_3","title":"\u4e3b\u5e94\u7528","text":""},{"location":"web/front/micro_front/qiankun.html#qiankun","title":"\u5b89\u88c5 qiankun","text":"<pre><code>$ yarn add qiankun # \u6216\u8005 npm i qiankun -S\n</code></pre>"},{"location":"web/front/micro_front/qiankun.html#_4","title":"\u5728\u4e3b\u5e94\u7528\u4e2d\u6ce8\u518c\u5fae\u5e94\u7528","text":"<pre><code>import { registerMicroApps, start } from 'qiankun';\n\nregisterMicroApps([\n  {\n    name: 'react app', // app name registered\n    entry: '//localhost:7100',\n    container: '#yourContainer',\n    activeRule: '/yourActiveRule',\n  },\n  {\n    name: 'vue app',\n    entry: { scripts: ['//localhost:7100/main.js'] },\n    container: '#yourContainer2',\n    activeRule: '/yourActiveRule2',\n  },\n]);\n\nstart();\n</code></pre> <p>\u5f53\u5fae\u5e94\u7528\u4fe1\u606f\u6ce8\u518c\u5b8c\u4e4b\u540e\uff0c\u4e00\u65e6\u6d4f\u89c8\u5668\u7684 url \u53d1\u751f\u53d8\u5316\uff0c\u4fbf\u4f1a\u81ea\u52a8\u89e6\u53d1 qiankun \u7684\u5339\u914d\u903b\u8f91\uff0c\u6240\u6709 activeRule \u89c4\u5219\u5339\u914d\u4e0a\u7684\u5fae\u5e94\u7528\u5c31\u4f1a\u88ab\u63d2\u5165\u5230\u6307\u5b9a\u7684 container \u4e2d\uff0c\u540c\u65f6\u4f9d\u6b21\u8c03\u7528\u5fae\u5e94\u7528\u66b4\u9732\u51fa\u7684\u751f\u547d\u5468\u671f\u94a9\u5b50\u3002</p> <p>\u5982\u679c\u5fae\u5e94\u7528\u4e0d\u662f\u76f4\u63a5\u8ddf\u8def\u7531\u5173\u8054\u7684\u65f6\u5019\uff0c\u4f60\u4e5f\u53ef\u4ee5\u9009\u62e9\u624b\u52a8\u52a0\u8f7d\u5fae\u5e94\u7528\u7684\u65b9\u5f0f\uff1a</p> <pre><code>import { loadMicroApp } from 'qiankun';\n\nloadMicroApp(\n  { \n    name: 'app', \n    entry: '//localhost:7100',\n    container: '#yourContainer', \n  }\n);\n</code></pre>"},{"location":"web/front/micro_front/qiankun.html#_5","title":"\u5fae\u5e94\u7528","text":"<p>\u5fae\u5e94\u7528\u4e0d\u9700\u8981\u989d\u5916\u5b89\u88c5\u4efb\u4f55\u5176\u4ed6\u4f9d\u8d56\u5373\u53ef\u63a5\u5165 qiankun \u4e3b\u5e94\u7528\u3002</p>"},{"location":"web/front/micro_front/qiankun.html#_6","title":"\u5bfc\u51fa\u76f8\u5e94\u7684\u751f\u547d\u5468\u671f\u94a9\u5b50","text":"<p>\u5fae\u5e94\u7528\u9700\u8981\u5728\u81ea\u5df1\u7684\u5165\u53e3 js (\u901a\u5e38\u5c31\u662f\u4f60\u914d\u7f6e\u7684 webpack \u7684 entry js) \u5bfc\u51fa <code>bootstrap</code>\u3001<code>mount</code>\u3001<code>unmount</code> \u4e09\u4e2a\u751f\u547d\u5468\u671f\u94a9\u5b50\uff0c\u4ee5\u4f9b\u4e3b\u5e94\u7528\u5728\u9002\u5f53\u7684\u65f6\u673a\u8c03\u7528\u3002</p> <pre><code>/**\n * bootstrap \u53ea\u4f1a\u5728\u5fae\u5e94\u7528\u521d\u59cb\u5316\u7684\u65f6\u5019\u8c03\u7528\u4e00\u6b21\uff0c\u4e0b\u6b21\u5fae\u5e94\u7528\u91cd\u65b0\u8fdb\u5165\u65f6\u4f1a\u76f4\u63a5\u8c03\u7528 mount \u94a9\u5b50\uff0c\u4e0d\u4f1a\u518d\u91cd\u590d\u89e6\u53d1 bootstrap\u3002\n * \u901a\u5e38\u6211\u4eec\u53ef\u4ee5\u5728\u8fd9\u91cc\u505a\u4e00\u4e9b\u5168\u5c40\u53d8\u91cf\u7684\u521d\u59cb\u5316\uff0c\u6bd4\u5982\u4e0d\u4f1a\u5728 unmount \u9636\u6bb5\u88ab\u9500\u6bc1\u7684\u5e94\u7528\u7ea7\u522b\u7684\u7f13\u5b58\u7b49\u3002\n */\nexport async function bootstrap() {\n  console.log('react app bootstraped');\n}\n\n/**\n * \u5e94\u7528\u6bcf\u6b21\u8fdb\u5165\u90fd\u4f1a\u8c03\u7528 mount \u65b9\u6cd5\uff0c\u901a\u5e38\u6211\u4eec\u5728\u8fd9\u91cc\u89e6\u53d1\u5e94\u7528\u7684\u6e32\u67d3\u65b9\u6cd5\n */\nexport async function mount(props) {\n  console.log(props);\n  ReactDOM.render(&lt;App /&gt;, document.getElementById('react15Root'));\n}\n\n/**\n * \u5e94\u7528\u6bcf\u6b21 \u5207\u51fa/\u5378\u8f7d \u4f1a\u8c03\u7528\u7684\u65b9\u6cd5\uff0c\u901a\u5e38\u5728\u8fd9\u91cc\u6211\u4eec\u4f1a\u5378\u8f7d\u5fae\u5e94\u7528\u7684\u5e94\u7528\u5b9e\u4f8b\n */\nexport async function unmount() {\n  ReactDOM.unmountComponentAtNode(document.getElementById('react15Root'));\n}\n\n/**\n * \u53ef\u9009\u751f\u547d\u5468\u671f\u94a9\u5b50\uff0c\u4ec5\u4f7f\u7528 loadMicroApp \u65b9\u5f0f\u52a0\u8f7d\u5fae\u5e94\u7528\u65f6\u751f\u6548\n */\nexport async function update(props) {\n  console.log('update props', props);\n}\n</code></pre> <p>qiankun \u57fa\u4e8e single-spa\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\u66f4\u591a\u5173\u4e8e\u5fae\u5e94\u7528\u751f\u547d\u5468\u671f\u76f8\u5173\u7684\u6587\u6863\u8bf4\u660e\u3002</p> <p>\u65e0 webpack \u7b49\u6784\u5efa\u5de5\u5177\u7684\u5e94\u7528\u63a5\u5165\u65b9\u5f0f\u8bf7\u89c1\u8fd9\u91cc</p>"},{"location":"web/front/micro_front/qiankun.html#_7","title":"\u914d\u7f6e\u5fae\u5e94\u7528\u7684\u6253\u5305\u5de5\u5177","text":"<p>\u9664\u4e86\u4ee3\u7801\u4e2d\u66b4\u9732\u51fa\u76f8\u5e94\u7684\u751f\u547d\u5468\u671f\u94a9\u5b50\u4e4b\u5916\uff0c\u4e3a\u4e86\u8ba9\u4e3b\u5e94\u7528\u80fd\u6b63\u786e\u8bc6\u522b\u5fae\u5e94\u7528\u66b4\u9732\u51fa\u6765\u7684\u4e00\u4e9b\u4fe1\u606f\uff0c\u5fae\u5e94\u7528\u7684\u6253\u5305\u5de5\u5177webpack\u9700\u8981\u589e\u52a0\u5982\u4e0b\u914d\u7f6e\uff1a</p> <pre><code>const packageName = require('./package.json').name;\n\nmodule.exports = {\n  output: {\n    library: `${packageName}-[name]`,\n    libraryTarget: 'umd',\n    jsonpFunction: `webpackJsonp_${packageName}`,\n  },\n};\n</code></pre> <p>\u76f8\u5173\u914d\u7f6e\u4ecb\u7ecd\u53ef\u4ee5\u67e5\u770b webpack \u76f8\u5173\u6587\u6863\u3002</p>"},{"location":"web/front/node/cmd.html","title":"NPM CMD","text":""},{"location":"web/front/node/cmd.html#node","title":"node","text":"<p>node \u547d\u4ee4\u53ef\u4ee5\u76f4\u63a5\u6267\u884c js \u6587\u4ef6\u3002</p>"},{"location":"web/front/node/cmd.html#npm-run","title":"npm run","text":"<p>npm run\u662fnpm run-script\u7684\u7b80\u5199\uff0c\u6267\u884c\u7684\u811a\u672c\u914d\u7f6e\u5728 package.json \u4e2d\u7684 scripts \u5bf9\u8c61\u3002</p> <pre><code>// package.json\n{\n    \"scripts\": {\n        \"sayHello\": \"echo hello world\"\n    }\n}\n</code></pre> <p><code>npm run sasyHello</code> \u4f1a\u6267\u884c\u8fd9\u4e2a\u547d\u4ee4\u3002</p> <p>\u9664\u4e86\u7cfb\u7edf\u7684$PATH\uff0c<code>npm run</code>\u4f1a\u5c06<code>node_modules/.bin</code>\u52a0\u5230PATH\u53d8\u91cf\u4e2d\u3002</p>"},{"location":"web/front/node/cmd.html#npm-install","title":"npm install","text":"<p>npm install module_name -S  \u5373  npm install module_name --save  \u5199\u5165dependencies</p> <p>npm install module_name -D  \u5373  npm install module_name --save-dev \u5199\u5165devDependencies</p>"},{"location":"web/front/node/cmd.html#registry","title":"registry","text":"<pre><code>npm --registry https://registry.npm.taobao.org install express\n</code></pre> <pre><code>npm config set registry https://registry.npm.taobao.org\n</code></pre>"},{"location":"web/front/node/conf.html","title":"Conf","text":""},{"location":"web/front/node/conf.html#devdependenciesdependencies","title":"devDependencies\u548cdependencies\u7684\u533a\u522b","text":"<p>devDependencies\u91cc\u9762\u7684\u63d2\u4ef6\u53ea\u7528\u4e8e\u5f00\u53d1\u73af\u5883\uff0c\u4e0d\u7528\u4e8e\u751f\u4ea7\u73af\u5883\uff0c\u5373\u8f85\u52a9\u4f5c\u7528\uff0c\u6253\u5305\u7684\u65f6\u5019\u9700\u8981\uff0c\u6253\u5305\u5b8c\u6210\u5c31\u4e0d\u9700\u8981\u4e86\u3002\u800cdependencies\u662f\u9700\u8981\u53d1\u5e03\u5230\u751f\u4ea7\u73af\u5883\u7684\uff0c\u81ea\u59cb\u81f3\u7ec8\u90fd\u5728\u3002\u6bd4\u5982wepack\u7b49\u53ea\u662f\u5728\u5f00\u53d1\u4e2d\u4f7f\u7528\u7684\u5305\u5c31\u5199\u5165\u5230devDependencies\uff0c\u800c\u50cfvue\u8fd9\u79cd\u9879\u76ee\u5168\u7a0b\u4f9d\u8d56\u7684\u5305\u8981\u5199\u5165\u5230devDependencies\u3002</p>"},{"location":"web/front/node/nodejs.html","title":"Nodejs","text":"<p>Node.js\u00ae is a JavaScript runtime built on Chrome's V8 JavaScript engine. NodeJS\u662fJavaScript\u7684\u8fd0\u884c\u73af\u5883\u3002</p>"},{"location":"web/front/node/nodejs.html#npm","title":"npm\u4fee\u6539\u6e90","text":"<p><code>npm config set registry https://registry.npm.taobao.org</code></p>"},{"location":"web/front/node/nodejs.html#npm_1","title":"npm\u6307\u5b9a\u5b89\u88c5\u8def\u5f84","text":"<p><pre><code>npm config set prefix \"D:\\AppData\\npm\\node_modules\"\nnpm config set cache \"D:\\AppData\\npm\\node_cache\"\n</code></pre> \u540c\u65f6\u5c06<code>$prefix</code>\u7684\u503c\u52a0\u5165\u5230\u73af\u5883\u53d8\u91cf<code>PATH</code>\u4e2d\u3002</p>"},{"location":"web/front/node/nodejs.html#_1","title":"\u4f9d\u8d56\u7ec4\u4ef6\u7684\u7248\u672c","text":"<ul> <li>\u5fc5\u987b\u5339\u914d\u67d0\u4e2a\u7248\u672c</li> <li> <p>\u5982\uff1a1.1.2\uff0c\u8868\u793a\u5fc5\u987b\u4f9d\u8d561.1.2\u7248</p> </li> <li> <p>&gt;version</p> </li> </ul> <pre><code>\u5fc5\u987b\u5927\u4e8e\u67d0\u4e2a\u7248\u672c\n\u5982\uff1a&gt;1.1.2\uff0c\u8868\u793a\u5fc5\u987b\u5927\u4e8e1.1.2\u7248\n</code></pre> <ul> <li>~version</li> </ul> <pre><code>\u5927\u6982\u5339\u914d\u67d0\u4e2a\u7248\u672c\n\u5982\u679cminor\u7248\u672c\u53f7\u6307\u5b9a\u4e86\uff0c\u90a3\u4e48minor\u7248\u672c\u53f7\u4e0d\u53d8\uff0c\u800cpatch\u7248\u672c\u53f7\u4efb\u610f\n\u5982\u679cminor\u548cpatch\u7248\u672c\u53f7\u672a\u6307\u5b9a\uff0c\u90a3\u4e48minor\u548cpatch\u7248\u672c\u53f7\u4efb\u610f\n\u5982\uff1a~1.1.2\uff0c\u8868\u793a&gt;=1.1.2&lt;1.2.0\uff0c\u53ef\u4ee5\u662f1.1.2\uff0c1.1.3\uff0c1.1.4\uff0c\u2026\uff0c1.1.n\n\u5982\uff1a~1.1\uff0c\u8868\u793a&gt;=1.1.0 &lt;1.2.0\uff0c\u53ef\u4ee5\u662f\u540c\u4e0a\n\u5982\uff1a~1\uff0c\u8868\u793a&gt;=1.0.0&lt;2.0.0\uff0c\u53ef\u4ee5\u662f1.0.0\uff0c1.0.1\uff0c1.0.2\uff0c\u2026\uff0c1.0.n\uff0c1.1.n\uff0c1.2.n\uff0c\u2026\uff0c1.n.n\n</code></pre> <ul> <li>^version</li> </ul> <pre><code>\u517c\u5bb9\u67d0\u4e2a\u7248\u672c\n\u7248\u672c\u53f7\u4e2d\u6700\u5de6\u8fb9\u7684\u975e0\u6570\u5b57\u7684\u53f3\u4fa7\u53ef\u4ee5\u4efb\u610f\n\u5982\u679c\u7f3a\u5c11\u67d0\u4e2a\u7248\u672c\u53f7\uff0c\u5219\u8fd9\u4e2a\u7248\u672c\u53f7\u7684\u4f4d\u7f6e\u53ef\u4ee5\u4efb\u610f\n\u5982\uff1a^1.1.2 \uff0c\u8868\u793a&gt;=1.1.2\n&lt;2.0.0\uff0c\u53ef\u4ee5\u662f1.1.2\uff0c1.1.3\uff0c\u2026\uff0c1.1.n\uff0c1.2.n\uff0c\u2026\uff0c1.n.n\n\u5982\uff1a^0.2.3 \uff0c\u8868\u793a&gt;=0.2.3 &lt;0.3.0\uff0c\u53ef\u4ee5\u662f0.2.3\uff0c0.2.4\uff0c\u2026\uff0c0.2.n\n\u5982\uff1a^0.0\uff0c\u8868\u793a &gt;=0.0.0 &lt;0.1.0\uff0c\u53ef\u4ee5\u662f0.0.0\uff0c0.0.1\uff0c\u2026\uff0c0.0.n\n</code></pre>"},{"location":"web/front/pack/vite.html","title":"Vite","text":"<p>[toc]</p>"},{"location":"web/front/pack/vite.html#vite","title":"Vite","text":"<p>\u4e0b\u4e00\u4ee3\u524d\u7aef\u5f00\u53d1\u4e0e\u6784\u5efa\u5de5\u5177\uff08https://cn.vitejs.dev/\uff09</p>"},{"location":"web/front/pack/webpack.html","title":"WebPack","text":"<p>webpack \u662f\u4e00\u4e2a\u6a21\u5757\u6253\u5305\u5de5\u5177\u3002\u5b83\u5c06\u4e00\u5806\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e2a\u6587\u4ef6\u90fd\u4f5c\u4e3a\u4e00\u4e2a\u6a21\u5757\uff0c\u627e\u51fa\u5b83\u4eec\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u5c06\u5b83\u4eec\u6253\u5305\u4e3a\u53ef\u90e8\u7f72\u7684\u9759\u6001\u8d44\u6e90\u3002</p> <p></p>"},{"location":"web/front/package/lib.html","title":"Library","text":""},{"location":"web/front/package/lib.html#pdf-lib","title":"PDF-LIB","text":"<p>Create and modify PDF documents in any JavaScript environment.</p> <p>https://pdf-lib.js.org/</p>"},{"location":"web/front/vue/basic.html","title":"Vue","text":"<p>Vue (\u53d1\u97f3\u4e3a /vju\u02d0/\uff0c\u7c7b\u4f3c view) \u662f\u4e00\u6b3e\u7528\u4e8e\u6784\u5efa\u7528\u6237\u754c\u9762\u7684 JavaScript \u6846\u67b6\u3002\u5b83\u57fa\u4e8e\u6807\u51c6 HTML\u3001CSS \u548c JavaScript \u6784\u5efa\uff0c\u5e76\u63d0\u4f9b\u4e86\u4e00\u5957\u58f0\u660e\u5f0f\u7684\u3001\u7ec4\u4ef6\u5316\u7684\u7f16\u7a0b\u6a21\u578b\u3002</p>"},{"location":"web/front/vue/basic.html#props","title":"props","text":"<p>\u4f5c\u4e3a\u7ec4\u4ef6\u7684\u5c5e\u6027key\uff0c\u8fdb\u884c\u4f7f\u7528\u3002</p> <pre><code>&lt;blog-post title=\"My journey with Vue\"&gt;&lt;/blog-post&gt;\n\nVue.component('blog-post', {\n  props: {\n    value: {\n      type: String,\n      default: ''\n    }\n  },\n  template: '&lt;h3&gt;{{ title }}&lt;/h3&gt;'\n})\n</code></pre>"},{"location":"web/front/vue/basic.html#data","title":"data","text":"<p>\u4e00\u4e2a\u7ec4\u4ef6\u7684 <code>data</code> \u9009\u9879\u5fc5\u987b\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u56e0\u6b64\u6bcf\u4e2a\u5b9e\u4f8b\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4efd\u88ab\u8fd4\u56de\u5bf9\u8c61\u7684\u72ec\u7acb\u7684\u62f7\u8d1d\uff0c\u4f5c\u4e3avalue\u4f7f\u7528\uff1a</p> <pre><code>data() {\n    return {\n      editor: null\n    }\n},\n</code></pre> <p>async</p> <p>await</p> <p>./ \u8868\u793a\u76f8\u5bf9\u8def\u5f84\uff0c\u5177\u4f53\u4ee3\u8868\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u540c\u7ea7\u76ee\u5f55\uff0c\u9075\u4ece\u7684\u662f\u4ece\u540e\u5f80\u524d\u627e\u6587\u4ef6</p> <p>@/ \u7684\u610f\u601d\uff1a \u8868\u793a\u7684\u662f\u76f8\u5bf9\u8def\u5f84(\u5f53\u7136\u8fd9\u4e5f\u662f\u7b80\u5199\u5566)\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u5728\u6839\u76ee\u5f55/build/webpack.base.conf.js\u6587\u4ef6\u4e2d@\u662f\u914d\u7f6e\u7684\uff0c \u6bd4\u5982\u6211\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d@\u5c31\u4ee3\u8868src\u76ee\u5f55\uff0c\u9075\u4ece\u7684\u662f\u4ece\u524d\u5f80\u540e\u627e\uff0c\u6bd4\u5982\u2019@/components/login\u2019 \u5c31\u8868\u793a\u7684\u662fsrc/components/login\u6587\u4ef6</p>"},{"location":"web/front/vue/basic.html#export","title":"export","text":"<p>export \u7528\u6765\u5bfc\u51fa\u6a21\u5757\uff0cVue \u7684\u5355\u6587\u4ef6\u7ec4\u4ef6\u901a\u5e38\u9700\u8981\u5bfc\u51fa\u4e00\u4e2a\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u662f Vue \u5b9e\u4f8b\u7684\u9009\u9879\u5bf9\u8c61\uff0c\u4ee5\u4fbf\u4e8e\u5728\u5176\u5b83\u5730\u65b9\u53ef\u4ee5\u4f7f\u7528 import \u5f15\u5165\u3002</p> <p>\u4e00\u4e2ajs\u6587\u4ef6\u4e2d\uff0c\u53ea\u80fd\u6709\u4e00\u4e2aexport default\uff1b\u4f46\u662f\u53ef\u4ee5\u591a\u4e2aexport</p>"},{"location":"web/front/vue/basic.html#vue-cli-30-vue","title":"vue cli 3.0 \u663e\u793a vue \u6e90\u7801","text":"<p>https://blog.csdn.net/u010341392/article/details/90209946</p> <p>keep-alive\u662fVue\u63d0\u4f9b\u7684\u4e00\u4e2a\u62bd\u8c61\u7ec4\u4ef6\uff0c\u7528\u6765\u5bf9\u7ec4\u4ef6\u8fdb\u884c\u7f13\u5b58\uff0c\u88ab\u5305\u88f9\u5728keep-alive\u4e2d\u7684\u7ec4\u4ef6\u7684\u72b6\u6001\u5c06\u4f1a\u88ab\u4fdd\u7559\u3002</p>"},{"location":"web/front/vue/deploy.html","title":"\u90e8\u7f72","text":"<p>\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u4f1a\u628avue\u9879\u76ee\u6253\u5305\u6210\u9759\u6001\u8d44\u6e90\uff0c\u7136\u540e\u653e\u5230nginx\u4e2d\u63d0\u4f9b\u8bbf\u95ee\u3002</p>"},{"location":"web/front/vue/deploy.html#_2","title":"\u591a\u524d\u7aef\u9879\u76ee\u90e8\u7f72","text":""},{"location":"web/front/vue/deploy.html#vue","title":"vue\u7684\u57fa\u7840\u8def\u5f84","text":"<ul> <li> <p>\u524d\u7aefvue\u7684\u5730\u5740\uff0c\u52a0\u7edf\u4e00\u524d\u7f00\uff1b</p> </li> <li> <p>vue-router\u7684basepath\u5b57\u6bb5\uff1b</p> </li> <li> <p>\u7981\u6b62\u901a\u8fc7windows.location_href \u7b49\u5f3a\u884c\u6539\u53d8\u6d4f\u89c8\u5668\u7684\u8def\u7531\uff1b</p> </li> <li> <p>\u901a\u8fc7vue-router\u7684push\u7b49\u65b9\u5f0f\u6539\u53d8\u8def\u7531</p> </li> </ul>"},{"location":"web/front/vue/deploy.html#nginxmodehistory","title":"nginx\u7684\u8def\u5f84\u533a\u5206\uff08mode=\"history\"\uff09","text":"<p>\u8bf7\u6c42 127.0.0.1/images/test.gif \u4f1a\u4f9d\u6b21\u67e5\u627e </p> <ol> <li>\u6587\u4ef6/opt/html/images/test.gif   </li> <li>\u6587\u4ef6\u5939 /opt/html/images/test.gif/\u4e0b\u7684index\u6587\u4ef6  </li> <li>\u8bf7\u6c42127.0.0.1/images/index.html</li> </ol> <pre><code>location /images {\n    root /opt/html/;\n    index  index.html;\n    # web\u8def\u7531\u5237\u65b0\u65f6\uff0c\u5982/images/liuyifei/show\uff0c\u4f1a\u6839\u636e\u76f8\u5bf9\u8def\u5f84\u53bb\u641c\u7d22/images/liuyifei/show\u6587\u4ef6\uff0c\u7136\u540e\u641c\u7d22\u4e0d\u5230\uff0c\u4f1a\u7ee7\u7eed\u641c\u7d22/images/index.html\n    # vue\u8def\u7531\u5fc5\u987b\u5148\u52a0\u8f7d index.html \u6216\u8005XX.js \u624d\u80fd\u8bc6\u522b\u5230\u8def\u7531\uff0c\u6545\u76f4\u63a5\u5237\u65b0\u9875\u9762\u4f1a\u51fa\u73b0404\uff0c\u8fd9\u65f6\u5019\u6700\u597d\u5230\u505a\u6cd5\uff0c\u662f\u4f7f\u7528try_files \u8fdb\u884c\u5c1d\u8bd5\uff0c\u5982\u679c\u83b7\u53d6\u4e0d\u5230\u8d44\u6e90\uff0c\u52a0\u8f7dindex.html \n    try_files $uri  $uri/  /images/index.html; \n}\n</code></pre>"},{"location":"web/front/vue/example.html","title":"\u793a\u4f8b","text":"<p>\u7b80\u5355\u793a\u4f8b</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;meta charset=\"utf-8\" /&gt;\n    &lt;title&gt; Simple Vue Example&lt;/title&gt;\n    &lt;script src=\"js/vue.js\" type=\"text/javascript\" charset=\"utf-8\"&gt;&lt;/script&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;div id=\"app-2\"&gt;\n      &lt;span v-bind:title=\"message\"&gt;\n        \u9f20\u6807\u60ac\u505c\u51e0\u79d2\u949f\u67e5\u770b\u6b64\u5904\u52a8\u6001\u7ed1\u5b9a\u7684\u63d0\u793a\u4fe1\u606f\uff01\n      &lt;/span&gt;\n    &lt;/div&gt;\n  &lt;/body&gt;\n  &lt;script&gt;\n    var app2 = new Vue({\n      el: '#app-2',\n      data: {\n        message: '\u9875\u9762\u52a0\u8f7d\u4e8e ' + new Date().toLocaleString()\n      }\n    })\n  &lt;/script&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"web/front/vue/vue_cli.html","title":"Vue cli","text":"<p>[toc]</p>"},{"location":"web/front/vue/vue_cli.html#vue-cli","title":"Vue CLI","text":"<p>Vue CLI \u662f\u4e00\u4e2a\u57fa\u4e8e Vue.js \u8fdb\u884c\u5feb\u901f\u5f00\u53d1\u7684\u5b8c\u6574\u7cfb\u7edf\u3002</p> <ul> <li> <p>\u901a\u8fc7 <code>@vue/cli</code> \u642d\u5efa\u4ea4\u4e92\u5f0f\u7684\u9879\u76ee\u811a\u624b\u67b6\u3002</p> </li> <li> <p>\u901a\u8fc7 <code>@vue/cli</code> + <code>@vue/cli-service-global</code> \u5feb\u901f\u5f00\u59cb\u96f6\u914d\u7f6e\u539f\u578b\u5f00\u53d1\u3002</p> </li> <li> <p>\u4e00\u4e2a\u8fd0\u884c\u65f6\u4f9d\u8d56 (</p> </li> </ul> <pre><code>@vue/cli-service\n</code></pre> <p>)\uff0c\u8be5\u4f9d\u8d56\uff1a</p> <ul> <li>\u53ef\u5347\u7ea7\uff1b</li> <li>\u57fa\u4e8e webpack \u6784\u5efa\uff0c\u5e76\u5e26\u6709\u5408\u7406\u7684\u9ed8\u8ba4\u914d\u7f6e\uff1b</li> <li>\u53ef\u4ee5\u901a\u8fc7\u9879\u76ee\u5185\u7684\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u914d\u7f6e\uff1b</li> <li> <p>\u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u8fdb\u884c\u6269\u5c55\u3002</p> </li> <li> <p>\u4e00\u4e2a\u4e30\u5bcc\u7684\u5b98\u65b9\u63d2\u4ef6\u96c6\u5408\uff0c\u96c6\u6210\u4e86\u524d\u7aef\u751f\u6001\u4e2d\u6700\u597d\u7684\u5de5\u5177\u3002</p> </li> <li> <p>\u4e00\u5957\u5b8c\u5168\u56fe\u5f62\u5316\u7684\u521b\u5efa\u548c\u7ba1\u7406 Vue.js \u9879\u76ee\u7684\u7528\u6237\u754c\u9762\u3002</p> </li> </ul> <p>Vue CLI \u81f4\u529b\u4e8e\u5c06 Vue \u751f\u6001\u4e2d\u7684\u5de5\u5177\u57fa\u7840\u6807\u51c6\u5316\u3002</p>"},{"location":"web/front/vue/vue_cli.html#_1","title":"\u7ec4\u4ef6","text":""},{"location":"web/front/vue/vue_cli.html#cli","title":"CLI","text":"<p>CLI (<code>@vue/cli</code>) \u662f\u4e00\u4e2a\u5168\u5c40\u5b89\u88c5\u7684 npm \u5305\uff0c\u63d0\u4f9b\u4e86\u7ec8\u7aef\u91cc\u7684 <code>vue</code> \u547d\u4ee4\u3002</p> <pre><code>npm install -g @vue/cli\n# OR\nyarn global add @vue/cli\n</code></pre>"},{"location":"web/front/vue/vue_cli.html#vue-serve","title":"vue serve","text":"<p><code>vue serve</code> \u548c <code>vue build</code> \u547d\u4ee4\u5bf9\u5355\u4e2a <code>*.vue</code> \u6587\u4ef6\u8fdb\u884c\u5feb\u901f\u539f\u578b\u5f00\u53d1\uff0c\u4f46\u662f\u9700\u8981\u5148\u5b89\u88c5\u5168\u5c40\u6269\u5c55\uff1a</p> <pre><code>npm install -g @vue/cli-service-global\n</code></pre> <p><code>vue serve</code> \u7684\u7f3a\u70b9\u5c31\u662f\u5b83\u9700\u8981\u5b89\u88c5\u5168\u5c40\u4f9d\u8d56\uff0c\u8fd9\u4f7f\u5f97\u5b83\u5728\u4e0d\u540c\u673a\u5668\u4e0a\u7684\u4e00\u81f4\u6027\u4e0d\u80fd\u5f97\u5230\u4fdd\u8bc1\u3002\u56e0\u6b64\u8fd9\u53ea\u9002\u7528\u4e8e\u5feb\u901f\u539f\u578b\u5f00\u53d1\u3002</p> <pre><code>Usage: serve [options] [entry]\n\u5728\u5f00\u53d1\u73af\u5883\u6a21\u5f0f\u4e0b\u96f6\u914d\u7f6e\u4e3a .js \u6216 .vue \u6587\u4ef6\u542f\u52a8\u4e00\u4e2a\u670d\u52a1\u5668\nOptions:\n  -o, --open  \u6253\u5f00\u6d4f\u89c8\u5668\n  -c, --copy  \u5c06\u672c\u5730 URL \u590d\u5236\u5230\u526a\u5207\u677f\n  -h, --help  \u8f93\u51fa\u7528\u6cd5\u4fe1\u606f\n</code></pre> <p><code>vue serve</code> \u4f7f\u7528\u4e86\u548c <code>vue create</code> \u521b\u5efa\u7684\u9879\u76ee\u76f8\u540c\u7684\u9ed8\u8ba4\u8bbe\u7f6e (webpack\u3001Babel\u3001PostCSS \u548c ESLint)\u3002\u5b83\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u81ea\u52a8\u63a8\u5bfc\u5165\u53e3\u6587\u4ef6\u2014\u2014\u5165\u53e3\u53ef\u4ee5\u662f <code>main.js</code>\u3001<code>index.js</code>\u3001<code>App.vue</code> \u6216 <code>app.vue</code> \u4e2d\u7684\u4e00\u4e2a\u3002\u4e5f\u53ef\u4ee5\u663e\u5f0f\u5730\u6307\u5b9a\u5165\u53e3\u6587\u4ef6\uff1a</p> <pre><code>vue serve MyComponent.vue\n</code></pre>"},{"location":"web/front/vue/vue_cli.html#vue-build","title":"vue build","text":"<pre><code>Usage: build [options] [entry]\n\u5728\u751f\u4ea7\u73af\u5883\u6a21\u5f0f\u4e0b\u96f6\u914d\u7f6e\u6784\u5efa\u4e00\u4e2a .js \u6216 .vue \u6587\u4ef6\nOptions:\n  -t, --target &lt;target&gt;  \u6784\u5efa\u76ee\u6807 (app | lib | wc | wc-async, \u9ed8\u8ba4\u503c\uff1aapp)\n  -n, --name &lt;name&gt;      \u5e93\u7684\u540d\u5b57\u6216 Web Components \u7ec4\u4ef6\u7684\u540d\u5b57 (\u9ed8\u8ba4\u503c\uff1a\u5165\u53e3\u6587\u4ef6\u540d)\n  -d, --dest &lt;dir&gt;       \u8f93\u51fa\u76ee\u5f55 (\u9ed8\u8ba4\u503c\uff1adist)\n  -h, --help             \u8f93\u51fa\u7528\u6cd5\u4fe1\u606f\n</code></pre>"},{"location":"web/front/vue/vue_cli.html#vue-create","title":"vue create","text":"<pre><code>vue create hello-world\n</code></pre> <p>\u901a\u8fc7\u547d\u4ee4\u884c\u521b\u5efa\u9879\u76ee</p>"},{"location":"web/front/vue/vue_cli.html#vue-ui","title":"vue ui","text":"<p>\u901a\u8fc7UI\u754c\u9762\u521b\u5efa\u9879\u76ee</p>"},{"location":"web/front/vue/vue_cli.html#cli_1","title":"CLI \u670d\u52a1","text":"<p>CLI \u670d\u52a1 (<code>@vue/cli-service</code>) \u662f\u4e00\u4e2a\u5f00\u53d1\u73af\u5883\u4f9d\u8d56\u3002\u5728\u4e00\u4e2a Vue CLI \u9879\u76ee\u4e2d\uff0c<code>@vue/cli-service</code> \u5b89\u88c5\u4e86\u4e00\u4e2a\u540d\u4e3a <code>vue-cli-service</code> \u7684\u547d\u4ee4\u3002</p> <p>CLI \u670d\u52a1\u662f\u6784\u5efa\u4e8e webpack \u548c webpack-dev-server \u4e4b\u4e0a\u7684\u3002\u5b83\u5305\u542b\u4e86\uff1a</p> <ul> <li>\u52a0\u8f7d\u5176\u5b83 CLI \u63d2\u4ef6\u7684\u6838\u5fc3\u670d\u52a1\uff1b</li> <li>\u4e00\u4e2a\u9488\u5bf9\u7edd\u5927\u90e8\u5206\u5e94\u7528\u4f18\u5316\u8fc7\u7684\u5185\u90e8\u7684 webpack \u914d\u7f6e\uff1b</li> <li>\u9879\u76ee\u5185\u90e8\u7684 <code>vue-cli-service</code> \u547d\u4ee4\uff0c\u63d0\u4f9b <code>serve</code>\u3001<code>build</code> \u548c <code>inspect</code> \u547d\u4ee4\u3002</li> </ul> <p><code>@vue/cli-service</code> \u5b9e\u9645\u4e0a\u5927\u81f4\u7b49\u4ef7\u4e8e <code>react-scripts</code>\uff0c\u5c3d\u7ba1\u529f\u80fd\u96c6\u5408\u4e0d\u4e00\u6837\u3002</p>"},{"location":"web/front/vue/vue_cli.html#vue-cli-service-serve","title":"vue-cli-service serve","text":"<pre><code>\u7528\u6cd5\uff1avue-cli-service serve [options] [entry]\n\u9009\u9879\uff1a\n  --open    \u5728\u670d\u52a1\u5668\u542f\u52a8\u65f6\u6253\u5f00\u6d4f\u89c8\u5668\n  --copy    \u5728\u670d\u52a1\u5668\u542f\u52a8\u65f6\u5c06 URL \u590d\u5236\u5230\u526a\u5207\u7248\n  --mode    \u6307\u5b9a\u73af\u5883\u6a21\u5f0f (\u9ed8\u8ba4\u503c\uff1adevelopment)\n  --host    \u6307\u5b9a host (\u9ed8\u8ba4\u503c\uff1a0.0.0.0)\n  --port    \u6307\u5b9a port (\u9ed8\u8ba4\u503c\uff1a8080)\n  --https   \u4f7f\u7528 https (\u9ed8\u8ba4\u503c\uff1afalse)\n</code></pre> <p><code>vue-cli-service serve</code> \u547d\u4ee4\u4f1a\u542f\u52a8\u4e00\u4e2a\u5f00\u53d1\u670d\u52a1\u5668 (\u57fa\u4e8e webpack-dev-server) \u5e76\u9644\u5e26\u5f00\u7bb1\u5373\u7528\u7684\u6a21\u5757\u70ed\u91cd\u8f7d (Hot-Module-Replacement)\u3002</p>"},{"location":"web/front/vue/vue_cli.html#vue-cli-service-build","title":"vue-cli-service build","text":"<pre><code>\u7528\u6cd5\uff1avue-cli-service build [options] [entry|pattern]\n\u9009\u9879\uff1a\n  --mode        \u6307\u5b9a\u73af\u5883\u6a21\u5f0f (\u9ed8\u8ba4\u503c\uff1aproduction)\n  --dest        \u6307\u5b9a\u8f93\u51fa\u76ee\u5f55 (\u9ed8\u8ba4\u503c\uff1adist)\n  --modern      \u9762\u5411\u73b0\u4ee3\u6d4f\u89c8\u5668\u5e26\u81ea\u52a8\u56de\u9000\u5730\u6784\u5efa\u5e94\u7528\n  --target      app | lib | wc | wc-async (\u9ed8\u8ba4\u503c\uff1aapp)\n  --name        \u5e93\u6216 Web Components \u6a21\u5f0f\u4e0b\u7684\u540d\u5b57 (\u9ed8\u8ba4\u503c\uff1apackage.json \u4e2d\u7684 \"name\" \u5b57\u6bb5\u6216\u5165\u53e3\u6587\u4ef6\u540d)\n  --no-clean    \u5728\u6784\u5efa\u9879\u76ee\u4e4b\u524d\u4e0d\u6e05\u9664\u76ee\u6807\u76ee\u5f55\n  --report      \u751f\u6210 report.html \u4ee5\u5e2e\u52a9\u5206\u6790\u5305\u5185\u5bb9\n  --report-json \u751f\u6210 report.json \u4ee5\u5e2e\u52a9\u5206\u6790\u5305\u5185\u5bb9\n  --watch       \u76d1\u542c\u6587\u4ef6\u53d8\u5316\n</code></pre> <p><code>vue-cli-service build</code> \u4f1a\u5728 <code>dist/</code> \u76ee\u5f55\u4ea7\u751f\u4e00\u4e2a\u53ef\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u7684\u5305\uff0c\u5e26\u6709 JS/CSS/HTML \u7684\u538b\u7f29\uff0c\u548c\u4e3a\u66f4\u597d\u7684\u7f13\u5b58\u800c\u505a\u7684\u81ea\u52a8\u7684 vendor chunk splitting\u3002\u5b83\u7684 chunk manifest \u4f1a\u5185\u8054\u5728 HTML \u91cc\u3002</p>"},{"location":"web/front/vue/vue_cli.html#cli_2","title":"CLI \u63d2\u4ef6","text":"<p>CLI \u63d2\u4ef6\u662f\u5411\u4f60\u7684 Vue \u9879\u76ee\u63d0\u4f9b\u53ef\u9009\u529f\u80fd\u7684 npm \u5305\uff0c\u4f8b\u5982 Babel/TypeScript \u8f6c\u8bd1\u3001ESLint \u96c6\u6210\u3001\u5355\u5143\u6d4b\u8bd5\u548c end-to-end \u6d4b\u8bd5\u7b49\u3002Vue CLI \u63d2\u4ef6\u7684\u540d\u5b57\u4ee5 <code>@vue/cli-plugin-</code> (\u5185\u5efa\u63d2\u4ef6) \u6216 <code>vue-cli-plugin-</code> (\u793e\u533a\u63d2\u4ef6) \u5f00\u5934\uff0c\u975e\u5e38\u5bb9\u6613\u4f7f\u7528\u3002</p> <p>\u5f53\u4f60\u5728\u9879\u76ee\u5185\u90e8\u8fd0\u884c <code>vue-cli-service</code> \u547d\u4ee4\u65f6\uff0c\u5b83\u4f1a\u81ea\u52a8\u89e3\u6790\u5e76\u52a0\u8f7d <code>package.json</code> \u4e2d\u5217\u51fa\u7684\u6240\u6709 CLI \u63d2\u4ef6\u3002</p> <p>\u63d2\u4ef6\u53ef\u4ee5\u4f5c\u4e3a\u9879\u76ee\u521b\u5efa\u8fc7\u7a0b\u7684\u4e00\u90e8\u5206\uff0c\u6216\u5728\u540e\u671f\u52a0\u5165\u5230\u9879\u76ee\u4e2d\u3002\u5b83\u4eec\u4e5f\u53ef\u4ee5\u88ab\u5f52\u6210\u4e00\u7ec4\u53ef\u590d\u7528\u7684 preset\u3002\u6211\u4eec\u4f1a\u5728\u63d2\u4ef6\u548c preset \u7ae0\u8282\u8fdb\u884c\u6df1\u5165\u8ba8\u8bba</p>"},{"location":"web/front/vue/vue_cli.html#_2","title":"\u914d\u7f6e","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a Vue CLI \u9879\u76ee\u6709\u4e09\u4e2a\u6a21\u5f0f\uff1a</p> <ul> <li><code>development</code> \u6a21\u5f0f\u7528\u4e8e <code>vue-cli-service serve</code></li> <li><code>production</code> \u6a21\u5f0f\u7528\u4e8e <code>vue-cli-service build</code> \u548c <code>vue-cli-service test:e2e</code></li> <li><code>test</code> \u6a21\u5f0f\u7528\u4e8e <code>vue-cli-service test:unit</code></li> </ul> <p>\u6bcf\u4e2a\u6a21\u5f0f\u90fd\u4f1a\u5c06 <code>NODE_ENV</code> \u7684\u503c\u8bbe\u7f6e\u4e3a\u6a21\u5f0f\u7684\u540d\u79f0\u2014\u2014\u6bd4\u5982\u5728 development \u6a21\u5f0f\u4e0b <code>NODE_ENV</code> \u7684\u503c\u4f1a\u88ab\u8bbe\u7f6e\u4e3a <code>\"development\"</code></p>"},{"location":"web/front/vue/vue_cli.html#webstorm","title":"WebStorm \u914d\u7f6e\u81ea\u5b9a\u4e49\u8def\u5f84@","text":"<p><code>Vue CLI 3</code> \u91cc\uff0c\u662f\u6ca1\u6709\u4f20\u7edf\u7684 webpack \u914d\u7f6e\u6587\u4ef6\u7684\uff0c\u56e0\u4e3a\u4f7f\u7528\u53e6\u4e00\u79cd\u5199\u6cd5\u96c6\u6210\u5230\u4e86 <code>vue.config.js</code> \u91cc\u3002</p> <pre><code>/**\n * \u7531\u4e8e Vue CLI 3 \u4e0d\u518d\u4f7f\u7528\u4f20\u7edf\u7684 webpack \u914d\u7f6e\u6587\u4ef6\uff0c\u6545 WebStorm \u65e0\u6cd5\u8bc6\u522b\u522b\u540d\n * \u672c\u6587\u4ef6\u5bf9\u9879\u76ee\u65e0\u4efb\u4f55\u4f5c\u7528\uff0c\u4ec5\u4f5c\u4e3a WebStorm \u8bc6\u522b\u522b\u540d\u7528\n * \u8fdb\u5165 WebStorm preferences -&gt; Language &amp; Framework -&gt; JavaScript -&gt; Webpack\uff0c\u9009\u62e9\u8fd9\u4e2a\u6587\u4ef6\u5373\u53ef\n * */\nconst resolve = dir =&gt; require('path').join(__dirname, dir);\n\nmodule.exports = {\n    resolve: {\n        alias: {\n            '@': resolve('src')\n        }\n    }\n};\n</code></pre>"},{"location":"web/front/vue/vue_loader.html","title":"Vue loader","text":""},{"location":"web/front/vue/vue_loader.html#vue-loader","title":"Vue Loader","text":"<p>Vue Loader \u662f\u4e00\u4e2a webpack \u7684 loader\uff0c\u5b83\u5141\u8bb8\u4f60\u4ee5\u4e00\u79cd\u540d\u4e3a\u5355\u6587\u4ef6\u7ec4\u4ef6 (SFCs)\u7684\u683c\u5f0f\u64b0\u5199 Vue \u7ec4\u4ef6\uff1a</p> <pre><code>&lt;template&gt;\n  &lt;div class=\"example\"&gt;{{ msg }}&lt;/div&gt;\n&lt;/template&gt;\n\n&lt;script&gt;\nexport default {\n  data () {\n    return {\n      msg: 'Hello world!'\n    }\n  }\n}\n&lt;/script&gt;\n\n&lt;style&gt;\n.example {\n  color: red;\n}\n&lt;/style&gt;\n</code></pre> <p>Vue Loader \u8fd8\u63d0\u4f9b\u4e86\u5f88\u591a\u9177\u70ab\u7684\u7279\u6027\uff1a</p> <ul> <li>\u5141\u8bb8\u4e3a Vue \u7ec4\u4ef6\u7684\u6bcf\u4e2a\u90e8\u5206\u4f7f\u7528\u5176\u5b83\u7684 webpack loader\uff0c\u4f8b\u5982\u5728<code>&lt;style&gt;</code>\u7684\u90e8\u5206\u4f7f\u7528 Sass \u548c\u5728 <code>&lt;template&gt;</code>\u7684\u90e8\u5206\u4f7f\u7528 Pug\uff1b</li> <li>\u5141\u8bb8\u5728\u4e00\u4e2a <code>.vue</code> \u6587\u4ef6\u4e2d\u4f7f\u7528\u81ea\u5b9a\u4e49\u5757\uff0c\u5e76\u5bf9\u5176\u8fd0\u7528\u81ea\u5b9a\u4e49\u7684 loader \u94fe\uff1b</li> <li>\u4f7f\u7528 webpack loader \u5c06 <code>&lt;style&gt;</code>\u548c <code>&lt;template&gt;</code> \u4e2d\u5f15\u7528\u7684\u8d44\u6e90\u5f53\u4f5c\u6a21\u5757\u4f9d\u8d56\u6765\u5904\u7406\uff1b</li> <li>\u4e3a\u6bcf\u4e2a\u7ec4\u4ef6\u6a21\u62df\u51fa scoped CSS\uff1b</li> <li>\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u70ed\u91cd\u8f7d\u6765\u4fdd\u6301\u72b6\u6001\u3002</li> </ul>"},{"location":"web/front/vue/vue_router.html","title":"Vue router","text":"<p>[toc]</p>"},{"location":"web/front/vue/vue_router.html#vue-router","title":"Vue Router","text":"<p>\u5bf9\u4e8e TypeScript \u7528\u6237\u6765\u8bf4\uff0c<code>vue-router@3.0+</code> \u4f9d\u8d56 <code>vue@2.5+</code>\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002</p> <ul> <li>\u5d4c\u5957\u7684\u8def\u7531/\u89c6\u56fe\u8868</li> <li>\u6a21\u5757\u5316\u7684\u3001\u57fa\u4e8e\u7ec4\u4ef6\u7684\u8def\u7531\u914d\u7f6e</li> <li>\u8def\u7531\u53c2\u6570\u3001\u67e5\u8be2\u3001\u901a\u914d\u7b26</li> <li>\u57fa\u4e8e Vue.js \u8fc7\u6e21\u7cfb\u7edf\u7684\u89c6\u56fe\u8fc7\u6e21\u6548\u679c</li> <li>\u7ec6\u7c92\u5ea6\u7684\u5bfc\u822a\u63a7\u5236</li> <li>\u5e26\u6709\u81ea\u52a8\u6fc0\u6d3b\u7684 CSS class \u7684\u94fe\u63a5</li> <li>HTML5 \u5386\u53f2\u6a21\u5f0f\u6216 hash \u6a21\u5f0f\uff0c\u5728 IE9 \u4e2d\u81ea\u52a8\u964d\u7ea7</li> <li>\u81ea\u5b9a\u4e49\u7684\u6eda\u52a8\u6761\u884c\u4e3a</li> </ul>"},{"location":"web/front/vue/vue_router.html#demo","title":"Demo","text":""},{"location":"web/front/vue/vue_router.html#html","title":"HTML","text":"<pre><code>&lt;script src=\"https://unpkg.com/vue/dist/vue.js\"&gt;&lt;/script&gt;\n&lt;script src=\"https://unpkg.com/vue-router/dist/vue-router.js\"&gt;&lt;/script&gt;\n\n&lt;div id=\"app\"&gt;\n  &lt;h1&gt;Hello App!&lt;/h1&gt;\n  &lt;p&gt;\n    &lt;!-- \u4f7f\u7528 router-link \u7ec4\u4ef6\u6765\u5bfc\u822a. --&gt;\n    &lt;!-- \u901a\u8fc7\u4f20\u5165 `to` \u5c5e\u6027\u6307\u5b9a\u94fe\u63a5. --&gt;\n    &lt;!-- &lt;router-link&gt; \u9ed8\u8ba4\u4f1a\u88ab\u6e32\u67d3\u6210\u4e00\u4e2a `&lt;a&gt;` \u6807\u7b7e --&gt;\n    &lt;router-link to=\"/foo\"&gt;Go to Foo&lt;/router-link&gt;\n    &lt;router-link to=\"/bar\"&gt;Go to Bar&lt;/router-link&gt;\n  &lt;/p&gt;\n  &lt;!-- \u8def\u7531\u51fa\u53e3 --&gt;\n  &lt;!-- \u8def\u7531\u5339\u914d\u5230\u7684\u7ec4\u4ef6\u5c06\u6e32\u67d3\u5728\u8fd9\u91cc --&gt;\n  &lt;router-view&gt;&lt;/router-view&gt;\n&lt;/div&gt;\n</code></pre>"},{"location":"web/front/vue/vue_router.html#javascript","title":"JavaScript","text":"<pre><code>// 0. \u5982\u679c\u4f7f\u7528\u6a21\u5757\u5316\u673a\u5236\u7f16\u7a0b\uff0c\u5bfc\u5165Vue\u548cVueRouter\uff0c\u8981\u8c03\u7528 Vue.use(VueRouter)\n\n// 1. \u5b9a\u4e49 (\u8def\u7531) \u7ec4\u4ef6\u3002\n// \u53ef\u4ee5\u4ece\u5176\u4ed6\u6587\u4ef6 import \u8fdb\u6765\nconst Foo = { template: '&lt;div&gt;foo&lt;/div&gt;' }\nconst Bar = { template: '&lt;div&gt;bar&lt;/div&gt;' }\n\n// 2. \u5b9a\u4e49\u8def\u7531\n// \u6bcf\u4e2a\u8def\u7531\u5e94\u8be5\u6620\u5c04\u4e00\u4e2a\u7ec4\u4ef6\u3002 \u5176\u4e2d\"component\" \u53ef\u4ee5\u662f\n// \u901a\u8fc7 Vue.extend() \u521b\u5efa\u7684\u7ec4\u4ef6\u6784\u9020\u5668\uff0c\n// \u6216\u8005\uff0c\u53ea\u662f\u4e00\u4e2a\u7ec4\u4ef6\u914d\u7f6e\u5bf9\u8c61\u3002\n// \u6211\u4eec\u665a\u70b9\u518d\u8ba8\u8bba\u5d4c\u5957\u8def\u7531\u3002\nconst routes = [\n  { path: '/foo', component: Foo },\n  { path: '/bar', component: Bar }\n]\n\n// 3. \u521b\u5efa router \u5b9e\u4f8b\uff0c\u7136\u540e\u4f20 `routes` \u914d\u7f6e\n// \u4f60\u8fd8\u53ef\u4ee5\u4f20\u522b\u7684\u914d\u7f6e\u53c2\u6570, \u4e0d\u8fc7\u5148\u8fd9\u4e48\u7b80\u5355\u7740\u5427\u3002\nconst router = new VueRouter({\n  routes // (\u7f29\u5199) \u76f8\u5f53\u4e8e routes: routes\n})\n\n// 4. \u521b\u5efa\u548c\u6302\u8f7d\u6839\u5b9e\u4f8b\u3002\n// \u8bb0\u5f97\u8981\u901a\u8fc7 router \u914d\u7f6e\u53c2\u6570\u6ce8\u5165\u8def\u7531\uff0c\n// \u4ece\u800c\u8ba9\u6574\u4e2a\u5e94\u7528\u90fd\u6709\u8def\u7531\u529f\u80fd\nconst app = new Vue({\n  router\n}).$mount('#app')\n\n// \u73b0\u5728\uff0c\u5e94\u7528\u5df2\u7ecf\u542f\u52a8\u4e86\uff01\n</code></pre> <p>\u4efb\u4f55\u7ec4\u4ef6\u5185\u901a\u8fc7 <code>this.$router</code> \u8bbf\u95ee\u8def\u7531\u5668\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>this.$route</code> \u8bbf\u95ee\u5f53\u524d\u8def\u7531</p> <pre><code>// Home.vue\nexport default {\n  computed: {\n    username() {\n      // \u6211\u4eec\u5f88\u5feb\u5c31\u4f1a\u770b\u5230 `params` \u662f\u4ec0\u4e48\n      return this.$route.params.username\n    }\n  },\n  methods: {\n    goBack() {\n      window.history.length &gt; 1 ? this.$router.go(-1) : this.$router.push('/')\n    }\n  }\n}\n</code></pre>"},{"location":"web/front/vue/vue_router.html#_1","title":"\u52a8\u6001\u8def\u7531\u5339\u914d","text":"<p>\u8def\u5f84\u4e2d\u5e26\u53d8\u91cf\u7684\u63a5\u53e3\u5339\u914d</p> <pre><code>const User = {\n  template: '&lt;div&gt;{{ $route.params.id }}&lt;/div&gt;'\n}\n\nconst router = new VueRouter({\n  routes: [\n    // \u52a8\u6001\u8def\u5f84\u53c2\u6570 \u4ee5\u5192\u53f7\u5f00\u5934\n    { path: '/user/:id', component: User }\n  ]\n})\n</code></pre> <p>\u5f53\u5339\u914d\u5230\u4e00\u4e2a\u8def\u7531\u65f6\uff0c\u53c2\u6570\u503c\u4f1a\u88ab\u8bbe\u7f6e\u5230 <code>this.$route.params</code>\uff0c\u53ef\u4ee5\u5728\u6bcf\u4e2a\u7ec4\u4ef6\u5185\u4f7f\u7528\u3002</p> <p>\u8bbe\u7f6e\u591a\u6bb5\u201c\u8def\u5f84\u53c2\u6570\u201d\uff0c\u5bf9\u5e94\u7684\u503c\u90fd\u4f1a\u8bbe\u7f6e\u5230 <code>$route.params</code>\u3002</p> \u6a21\u5f0f \u5339\u914d\u8def\u5f84 $route.params /user/:username /user/evan <code>{ username: 'evan' }</code> /user/:username/post/:post_id /user/evan/post/123 <code>{ username: 'evan', post_id: '123' }</code> <p>router\u5e38\u7528\u5185\u7f6e\u6210\u5458\uff1a</p> <ul> <li> <p>$route.path\uff0c\u5bf9\u5e94\u5f53\u524d\u8def\u7531\u7684\u8def\u5f84\uff0c\u7edd\u5bf9\u8def\u5f84\uff1b</p> </li> <li> <p>$route.query \uff0c\u5982\u679c URL \u4e2d\u6709\u67e5\u8be2\u53c2\u6570\uff1b</p> </li> <li>$route.hash\uff0c\u5f53\u524d\u8def\u7531\u7684 hash \u503c (\u5e26 <code>#</code>) \uff0c\u5982\u679c\u6ca1\u6709 hash \u503c\uff0c\u5219\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff1b</li> </ul>"},{"location":"web/front/vue/vue_router.html#_2","title":"\u54cd\u5e94\u8def\u7531\u53c2\u6570\u7684\u53d8\u5316","text":"<p>\u5f53\u4f7f\u7528\u8def\u7531\u53c2\u6570\u65f6\uff0c\u4f8b\u5982\u4ece <code>/user/foo</code> \u5bfc\u822a\u5230 <code>/user/bar</code>\uff0c\u539f\u6765\u7684\u7ec4\u4ef6\u5b9e\u4f8b\u4f1a\u88ab\u590d\u7528\u3002\u56e0\u4e3a\u4e24\u4e2a\u8def\u7531\u90fd\u6e32\u67d3\u540c\u4e2a\u7ec4\u4ef6\uff0c\u6bd4\u8d77\u9500\u6bc1\u518d\u521b\u5efa\uff0c\u590d\u7528\u5219\u663e\u5f97\u66f4\u52a0\u9ad8\u6548\u3002\u4e0d\u8fc7\uff0c\u8fd9\u4e5f\u610f\u5473\u7740\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u94a9\u5b50\u4e0d\u4f1a\u518d\u88ab\u8c03\u7528\u3002</p> <ul> <li>beforeRouteUpdate \u5bfc\u822a\u5b88\u536b\u5bf9\u8def\u7531\u53c2\u6570\u7684\u53d8\u5316\u505a\u51fa\u54cd\u5e94\uff1b</li> </ul>"},{"location":"web/front/vue/vue_router.html#404-not-found","title":"\u6355\u83b7\u6240\u6709\u8def\u7531\u6216 404 Not found \u8def\u7531","text":"<p>\u901a\u914d\u7b26 (<code>*</code>)\uff0c\u542b\u6709\u901a\u914d\u7b26\u7684\u8def\u7531\u5e94\u8be5\u653e\u5728\u6700\u540e\uff1b\u8def\u7531 <code>{ path: '*' }</code> \u901a\u5e38\u7528\u4e8e\u5ba2\u6237\u7aef 404 \u9519\u8bef\u3002</p> <p>\u5f53\u4f7f\u7528\u4e00\u4e2a\u901a\u914d\u7b26\u65f6\uff0c<code>$route.params</code> \u5185\u4f1a\u81ea\u52a8\u6dfb\u52a0\u4e00\u4e2a\u540d\u4e3a <code>pathMatch</code> \u53c2\u6570\u3002\u5b83\u5305\u542b\u4e86 URL \u901a\u8fc7\u901a\u914d\u7b26\u88ab\u5339\u914d\u7684\u90e8\u5206\uff1a</p>"},{"location":"web/front/vue/vue_router.html#_3","title":"\u9ad8\u7ea7\u5339\u914d\u6a21\u5f0f","text":"<p>\u4f7f\u7528 path-to-regexp \u4f5c\u4e3a\u8def\u5f84\u5339\u914d\u5f15\u64ce\uff0c\u9ad8\u7ea7\u7528\u6cd5\u67e5\u770b \u8fd9\u4e2a\u4f8b\u5b50  \u5c55\u793a <code>vue-router</code> \u600e\u4e48\u4f7f\u7528\u8fd9\u7c7b\u5339\u914d\u3002</p>"},{"location":"web/front/vue/vue_router.html#_4","title":"\u5339\u914d\u4f18\u5148\u7ea7","text":"<p>\u540c\u4e00\u4e2a\u8def\u5f84\u53ef\u4ee5\u5339\u914d\u591a\u4e2a\u8def\u7531\uff0c\u6b64\u65f6\uff0c\u5339\u914d\u7684\u4f18\u5148\u7ea7\u5c31\u6309\u7167\u8def\u7531\u7684\u5b9a\u4e49\u987a\u5e8f\u3002\uff08\u4e0d\u662f\u6700\u957f\u8def\u5f84\u5339\u914d\uff09</p>"},{"location":"web/front/vue/vue_router.html#_5","title":"\u5d4c\u5957\u8def\u7531","text":"<p>URL \u4e2d\u5404\u6bb5\u52a8\u6001\u8def\u5f84\u4e5f\u6309\u67d0\u79cd\u7ed3\u6784\u5bf9\u5e94\u5d4c\u5957\u7684\u5404\u5c42\u7ec4\u4ef6:</p> <pre><code>/user/foo/profile                     /user/foo/posts\n+------------------+                  +-----------------+\n| User             |                  | User            |\n| +--------------+ |                  | +-------------+ |\n| | Profile      | |  +------------&gt;  | | Posts       | |\n| |              | |                  | |             | |\n| +--------------+ |                  | +-------------+ |\n+------------------+                  +-----------------+\n</code></pre> <pre><code>&lt;div id=\"app\"&gt;\n  &lt;router-view&gt;&lt;/router-view&gt;\n&lt;/div&gt;\n</code></pre> <pre><code>const User = {\n  template: `\n    &lt;div class=\"user\"&gt;\n      &lt;h2&gt;User {{ $route.params.id }}&lt;/h2&gt;\n      &lt;router-view&gt;&lt;/router-view&gt;\n    &lt;/div&gt;\n  `\n}\n\nconst router = new VueRouter({\n  routes: [\n    { path: '/user/:id', component: User,\n      children: [\n        // \u5f53 /user/:id \u5339\u914d\u6210\u529f\uff0c\n        // UserHome \u4f1a\u88ab\u6e32\u67d3\u5728 User \u7684 &lt;router-view&gt; \u4e2d\n        { path: '', component: UserHome },\n        {\n          // \u5f53 /user/:id/profile \u5339\u914d\u6210\u529f\uff0c\n          // UserProfile \u4f1a\u88ab\u6e32\u67d3\u5728 User \u7684 &lt;router-view&gt; \u4e2d\n          path: 'profile',\n          component: UserProfile\n        },\n        {\n          // \u5f53 /user/:id/posts \u5339\u914d\u6210\u529f\n          // UserPosts \u4f1a\u88ab\u6e32\u67d3\u5728 User \u7684 &lt;router-view&gt; \u4e2d\n          path: 'posts',\n          component: UserPosts\n        }\n      ]\n    }\n  ]\n})\n</code></pre> <p>\u8981\u6ce8\u610f\uff0c\u4ee5 <code>/</code> \u5f00\u5934\u7684\u5d4c\u5957\u8def\u5f84\u4f1a\u88ab\u5f53\u4f5c\u6839\u8def\u5f84\u3002 \u8fd9\u8ba9\u4f60\u5145\u5206\u7684\u4f7f\u7528\u5d4c\u5957\u7ec4\u4ef6\u800c\u65e0\u987b\u8bbe\u7f6e\u5d4c\u5957\u7684\u8def\u5f84\u3002</p>"},{"location":"web/front/vue/vue_router.html#_6","title":"\u7f16\u7a0b\u5f0f\u7684\u5bfc\u822a","text":"<p><code>router.push(location, onComplete?, onAbort?)</code></p> <p>\u70b9\u51fb <code>&lt;router-link :to=\"...\"&gt;</code> \u7b49\u540c\u4e8e\u8c03\u7528 <code>router.push(...)</code>\u3002</p> <p>\u60f3\u8981\u5bfc\u822a\u5230\u4e0d\u540c\u7684 URL\uff0c\u5219\u4f7f\u7528 <code>router.push</code> \u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u5411 history \u6808\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\uff0c\u5f53\u7528\u6237\u70b9\u51fb\u6d4f\u89c8\u5668\u540e\u9000\u6309\u94ae\u65f6\uff0c\u5219\u56de\u5230\u4e4b\u524d\u7684 URL\u3002</p> <p><code>router.replace(location, onComplete?, onAbort?)</code></p> <p>\u4e0d\u4f1a\u5411 history \u6dfb\u52a0\u65b0\u8bb0\u5f55\uff0c\u800c\u662f\u8ddf\u5b83\u7684\u65b9\u6cd5\u540d\u4e00\u6837 \u2014\u2014 \u66ff\u6362\u6389\u5f53\u524d\u7684 history \u8bb0\u5f55\u3002</p>"},{"location":"web/front/vue/vue_router.html#_7","title":"\u547d\u540d\u8def\u7531","text":"<pre><code>const router = new VueRouter({\n  routes: [\n    {\n      path: '/user/:userId',\n      name: 'user',\n      component: User\n    }\n  ]\n})\n</code></pre> <p>\u8981\u94fe\u63a5\u5230\u4e00\u4e2a\u547d\u540d\u8def\u7531\uff0c\u53ef\u4ee5\u7ed9 <code>router-link</code> \u7684 <code>to</code> \u5c5e\u6027\u4f20\u4e00\u4e2a\u5bf9\u8c61\uff1a</p> <pre><code>&lt;router-link :to=\"{ name: 'user', params: { userId: 123 }}\"&gt;User&lt;/router-link&gt;\n</code></pre>"},{"location":"web/front/vue/vue_router.html#_8","title":"\u547d\u540d\u89c6\u56fe","text":"<p>\u5efa\u4e00\u4e2a\u5e03\u5c40\uff0c\u6709 <code>sidebar</code> (\u4fa7\u5bfc\u822a) \u548c <code>main</code> (\u4e3b\u5185\u5bb9) \u4e24\u4e2a\u89c6\u56fe\uff0c\u8fd9\u4e2a\u65f6\u5019\u547d\u540d\u89c6\u56fe\u5c31\u6d3e\u4e0a\u7528\u573a\u4e86\u3002\u4f60\u53ef\u4ee5\u5728\u754c\u9762\u4e2d\u62e5\u6709\u591a\u4e2a\u5355\u72ec\u547d\u540d\u7684\u89c6\u56fe\uff0c\u800c\u4e0d\u662f\u53ea\u6709\u4e00\u4e2a\u5355\u72ec\u7684\u51fa\u53e3\u3002\u5982\u679c <code>router-view</code> \u6ca1\u6709\u8bbe\u7f6e\u540d\u5b57\uff0c\u90a3\u4e48\u9ed8\u8ba4\u4e3a <code>default</code>\u3002</p> <pre><code>&lt;router-view class=\"view one\"&gt;&lt;/router-view&gt;\n&lt;router-view class=\"view two\" name=\"a\"&gt;&lt;/router-view&gt;\n&lt;router-view class=\"view three\" name=\"b\"&gt;&lt;/router-view&gt;\n</code></pre> <p>\u4e00\u4e2a\u89c6\u56fe\u4f7f\u7528\u4e00\u4e2a\u7ec4\u4ef6\u6e32\u67d3\uff0c\u56e0\u6b64\u5bf9\u4e8e\u540c\u4e2a\u8def\u7531\uff0c\u591a\u4e2a\u89c6\u56fe\u5c31\u9700\u8981\u591a\u4e2a\u7ec4\u4ef6\u3002\u786e\u4fdd\u6b63\u786e\u4f7f\u7528 <code>components</code> \u914d\u7f6e (\u5e26\u4e0a s)\uff1a</p> <pre><code>const router = new VueRouter({\n  routes: [\n    {\n      path: '/',\n      components: {\n        default: Foo,\n        a: Bar,\n        b: Baz\n      }\n    }\n  ]\n})\n</code></pre>"},{"location":"web/front/vue/vue_router.html#_9","title":"\u5d4c\u5957\u547d\u540d\u89c6\u56fe","text":"<p>\u4f7f\u7528\u547d\u540d\u89c6\u56fe\u521b\u5efa\u5d4c\u5957\u89c6\u56fe\u7684\u590d\u6742\u5e03\u5c40\uff0c\u4ee5\u4e00\u4e2a\u8bbe\u7f6e\u9762\u677f\u4e3a\u4f8b\uff1a</p> <pre><code>/settings/emails                                       /settings/profile\n+-----------------------------------+                  +------------------------------+\n| UserSettings                      |                  | UserSettings                 |\n| +-----+-------------------------+ |                  | +-----+--------------------+ |\n| | Nav | UserEmailsSubscriptions | |  +------------&gt;  | | Nav | UserProfile        | |\n| |     +-------------------------+ |                  | |     +--------------------+ |\n| |     |                         | |                  | |     | UserProfilePreview | |\n| +-----+-------------------------+ |                  | +-----+--------------------+ |\n+-----------------------------------+                  +------------------------------+\n</code></pre> <ul> <li><code>Nav</code> \u53ea\u662f\u4e00\u4e2a\u5e38\u89c4\u7ec4\u4ef6\u3002</li> <li><code>UserSettings</code> \u662f\u4e00\u4e2a\u89c6\u56fe\u7ec4\u4ef6\u3002</li> <li><code>UserEmailsSubscriptions</code>\u3001<code>UserProfile</code>\u3001<code>UserProfilePreview</code> \u662f\u5d4c\u5957\u7684\u89c6\u56fe\u7ec4\u4ef6\u3002</li> </ul> <p><code>UserSettings</code> \u7ec4\u4ef6\u7684 ` \u90e8\u5206\u5e94\u8be5\u662f\u7c7b\u4f3c\u4e0b\u9762\u7684\u8fd9\u6bb5\u4ee3\u7801\uff1a</p> <pre><code>&lt;!-- UserSettings.vue --&gt;\n&lt;div&gt;\n  &lt;h1&gt;User Settings&lt;/h1&gt;\n  &lt;NavBar/&gt;\n  &lt;router-view/&gt;\n  &lt;router-view name=\"helper\"/&gt;\n&lt;/div&gt;\n</code></pre> <p>\u7136\u540e\u53ef\u4ee5\u7528\u8fd9\u4e2a\u8def\u7531\u914d\u7f6e\u5b8c\u6210\u8be5\u5e03\u5c40\uff1a</p> <pre><code>{\n  path: '/settings',\n  // \u4f60\u4e5f\u53ef\u4ee5\u5728\u9876\u7ea7\u8def\u7531\u5c31\u914d\u7f6e\u547d\u540d\u89c6\u56fe\n  component: UserSettings,\n  children: [{\n    path: 'emails',\n    component: UserEmailsSubscriptions\n  }, {\n    path: 'profile',\n    components: {\n      default: UserProfile,\n      helper: UserProfilePreview\n    }\n  }]\n}\n</code></pre>"},{"location":"web/front/vue/vue_router.html#_10","title":"\u91cd\u5b9a\u5411\u548c\u522b\u540d","text":""},{"location":"web/front/vue/vue_router.html#_11","title":"\u91cd\u5b9a\u5411","text":"<pre><code>const router = new VueRouter({\n  routes: [\n    { path: '/a', redirect: '/b' },\n    { path: '/c', redirect: { name: 'foo' }},\n    { path: '/d', redirect: to =&gt; {\n      // \u65b9\u6cd5\u63a5\u6536 \u76ee\u6807\u8def\u7531 \u4f5c\u4e3a\u53c2\u6570\n      // return \u91cd\u5b9a\u5411\u7684 \u5b57\u7b26\u4e32\u8def\u5f84/\u8def\u5f84\u5bf9\u8c61\n    }}\n  ]\n})\n</code></pre> <p>\u5176\u5b83\u9ad8\u7ea7\u7528\u6cd5\uff0c\u8bf7\u53c2\u8003\u4f8b\u5b50\u3002</p>"},{"location":"web/front/vue/vue_router.html#_12","title":"\u522b\u540d","text":"<p><code>/a</code> \u7684\u522b\u540d\u662f <code>/b</code>\uff0c\u610f\u5473\u7740\uff0c\u5f53\u7528\u6237\u8bbf\u95ee <code>/b</code> \u65f6\uff0cURL \u4f1a\u4fdd\u6301\u4e3a <code>/b</code>\uff0c\u4f46\u662f\u8def\u7531\u5339\u914d\u5219\u4e3a <code>/a</code>\uff0c\u5c31\u50cf\u7528\u6237\u8bbf\u95ee <code>/a</code> \u4e00\u6837\u3002</p> <pre><code>const router = new VueRouter({\n  routes: [\n    { path: '/a', component: A, alias: '/b' }\n  ]\n})\n</code></pre> <p>\u201c\u522b\u540d\u201d\u7684\u529f\u80fd\u8ba9\u4f60\u53ef\u4ee5\u81ea\u7531\u5730\u5c06 UI \u7ed3\u6784\u6620\u5c04\u5230\u4efb\u610f\u7684 URL\uff0c\u800c\u4e0d\u662f\u53d7\u9650\u4e8e\u914d\u7f6e\u7684\u5d4c\u5957\u8def\u7531\u7ed3\u6784\u3002</p>"},{"location":"web/front/vue/vue_router.html#todo","title":"\u8def\u7531\u7ec4\u4ef6\u4f20\u53c2\uff08TODO\uff09","text":"<p>\u5728\u7ec4\u4ef6\u4e2d\u4f7f\u7528 <code>$route</code> \u4f1a\u4f7f\u4e4b\u4e0e\u5176\u5bf9\u5e94\u8def\u7531\u5f62\u6210\u9ad8\u5ea6\u8026\u5408\uff0c\u4ece\u800c\u4f7f\u7ec4\u4ef6\u53ea\u80fd\u5728\u67d0\u4e9b\u7279\u5b9a\u7684 URL \u4e0a\u4f7f\u7528\uff0c\u9650\u5236\u4e86\u5176\u7075\u6d3b\u6027\u3002</p> <p>\u4f7f\u7528 <code>props</code> \u5c06\u7ec4\u4ef6\u548c\u8def\u7531\u89e3\u8026\uff1a</p> <pre><code>const User = {\n  props: ['id'],\n  template: '&lt;div&gt;User {{ id }}&lt;/div&gt;'\n}\nconst router = new VueRouter({\n  routes: [\n    { path: '/user/:id', component: User, props: true },\n\n    // \u5bf9\u4e8e\u5305\u542b\u547d\u540d\u89c6\u56fe\u7684\u8def\u7531\uff0c\u4f60\u5fc5\u987b\u5206\u522b\u4e3a\u6bcf\u4e2a\u547d\u540d\u89c6\u56fe\u6dfb\u52a0 `props` \u9009\u9879\uff1a\n    {\n      path: '/user/:id',\n      components: { default: User, sidebar: Sidebar },\n      props: { default: true, sidebar: false }\n    }\n  ]\n})\n</code></pre>"},{"location":"web/front/vue/vue_router.html#html5-history","title":"HTML5 History \u6a21\u5f0f","text":"<p><code>vue-router</code> \u9ed8\u8ba4 hash \u6a21\u5f0f \u2014\u2014 \u4f7f\u7528 URL \u7684 hash \u6765\u6a21\u62df\u4e00\u4e2a\u5b8c\u6574\u7684 URL\uff0c\u4e8e\u662f\u5f53 URL \u6539\u53d8\u65f6\uff0c\u9875\u9762\u4e0d\u4f1a\u91cd\u65b0\u52a0\u8f7d\u3002\u5178\u578b\u8868\u73b0\u5c31\u662f\u53bb\u9664\u4e86<code>hash</code>\u6a21\u5f0f\u4e2durl\u8def\u5f84\u4e2d\u7684<code>#</code></p> <p>\u5f53\u4f60\u4f7f\u7528 history \u6a21\u5f0f\u65f6\uff0cURL \u5c31\u50cf\u6b63\u5e38\u7684 url\uff0c\u4f8b\u5982 <code>http://yoursite.com/user/id</code></p>"},{"location":"web/front/vue/vue_router.html#_13","title":"\u5bfc\u822a\u5b88\u536b","text":"<p>\u53c2\u6570\u6216\u67e5\u8be2\u7684\u6539\u53d8\u5e76\u4e0d\u4f1a\u89e6\u53d1\u8fdb\u5165/\u79bb\u5f00\u7684\u5bfc\u822a\u5b88\u536b\u3002</p>"},{"location":"web/front/vue/vue_router.html#_14","title":"\u5168\u5c40\u524d\u7f6e\u5b88\u536b","text":"<p>\u53ef\u4ee5\u4f7f\u7528 <code>router.beforeEach</code> \u6ce8\u518c\u4e00\u4e2a\u5168\u5c40\u524d\u7f6e\u5b88\u536b\uff1a</p> <pre><code>const router = new VueRouter({ ... })\n\nrouter.beforeEach((to, from, next) =&gt; {\n  // ...\n})\n</code></pre> <p>\u5168\u5c40\u524d\u7f6e\u5b88\u536b\u6309\u7167\u521b\u5efa\u987a\u5e8f\u8c03\u7528\u3002\u5b88\u536b\u662f\u5f02\u6b65\u89e3\u6790\u6267\u884c\uff0c\u6b64\u65f6\u5bfc\u822a\u5728\u6240\u6709\u5b88\u536b resolve \u5b8c\u4e4b\u524d\u4e00\u76f4\u5904\u4e8e \u7b49\u5f85\u4e2d\u3002</p> <ul> <li><code>to: Route</code>: \u5373\u5c06\u8981\u8fdb\u5165\u7684\u76ee\u6807 \u8def\u7531\u5bf9\u8c61</li> <li><code>from: Route</code>: \u5f53\u524d\u5bfc\u822a\u6b63\u8981\u79bb\u5f00\u7684\u8def\u7531</li> <li><code>next: Function</code>: \u4e00\u5b9a\u8981\u8c03\u7528\u8be5\u65b9\u6cd5\u6765 resolve \u8fd9\u4e2a\u94a9\u5b50\u3002\u6267\u884c\u6548\u679c\u4f9d\u8d56 <code>next</code> \u65b9\u6cd5\u7684\u8c03\u7528\u53c2\u6570\u3002</li> <li><code>next()</code>: \u8fdb\u884c\u7ba1\u9053\u4e2d\u7684\u4e0b\u4e00\u4e2a\u94a9\u5b50\u3002\u5982\u679c\u5168\u90e8\u94a9\u5b50\u6267\u884c\u5b8c\u4e86\uff0c\u5219\u5bfc\u822a\u7684\u72b6\u6001\u5c31\u662f confirmed (\u786e\u8ba4\u7684)\u3002</li> <li><code>next(false)</code>: \u4e2d\u65ad\u5f53\u524d\u7684\u5bfc\u822a\u3002\u5982\u679c\u6d4f\u89c8\u5668\u7684 URL \u6539\u53d8\u4e86 (\u53ef\u80fd\u662f\u7528\u6237\u624b\u52a8\u6216\u8005\u6d4f\u89c8\u5668\u540e\u9000\u6309\u94ae)\uff0c\u90a3\u4e48 URL \u5730\u5740\u4f1a\u91cd\u7f6e\u5230 <code>from</code> \u8def\u7531\u5bf9\u5e94\u7684\u5730\u5740\u3002</li> <li><code>next('/')</code> \u6216\u8005 <code>next({ path: '/' })</code>: \u8df3\u8f6c\u5230\u4e00\u4e2a\u4e0d\u540c\u7684\u5730\u5740\u3002\u5f53\u524d\u7684\u5bfc\u822a\u88ab\u4e2d\u65ad\uff0c\u7136\u540e\u8fdb\u884c\u4e00\u4e2a\u65b0\u7684\u5bfc\u822a\u3002\u4f60\u53ef\u4ee5\u5411 <code>next</code> \u4f20\u9012\u4efb\u610f\u4f4d\u7f6e\u5bf9\u8c61\uff0c\u4e14\u5141\u8bb8\u8bbe\u7f6e\u8bf8\u5982 <code>replace: true</code>\u3001<code>name: 'home'</code> \u4e4b\u7c7b\u7684\u9009\u9879\u4ee5\u53ca\u4efb\u4f55\u7528\u5728 <code>router-link</code> \u7684 <code>to</code> prop \u6216 <code>router.push</code> \u4e2d\u7684\u9009\u9879\u3002</li> <li><code>next(error)</code>: (2.4.0+) \u5982\u679c\u4f20\u5165 <code>next</code> \u7684\u53c2\u6570\u662f\u4e00\u4e2a <code>Error</code> \u5b9e\u4f8b\uff0c\u5219\u5bfc\u822a\u4f1a\u88ab\u7ec8\u6b62\u4e14\u8be5\u9519\u8bef\u4f1a\u88ab\u4f20\u9012\u7ed9 <code>router.onError()</code> \u6ce8\u518c\u8fc7\u7684\u56de\u8c03\u3002</li> </ul> <p>\u786e\u4fdd\u8981\u8c03\u7528 <code>next</code> \u65b9\u6cd5\uff0c\u5426\u5219\u94a9\u5b50\u5c31\u4e0d\u4f1a\u88ab resolved\u3002</p>"},{"location":"web/front/vue/vue_router.html#_15","title":"\u5168\u5c40\u89e3\u6790\u5b88\u536b","text":"<p>\u5728 2.5.0+ \u4f60\u53ef\u4ee5\u7528 <code>router.beforeResolve</code> \u6ce8\u518c\u4e00\u4e2a\u5168\u5c40\u5b88\u536b\u3002\u8fd9\u548c <code>router.beforeEach</code> \u7c7b\u4f3c\uff0c\u533a\u522b\u662f\u5728\u5bfc\u822a\u88ab\u786e\u8ba4\u4e4b\u524d\uff0c\u540c\u65f6\u5728\u6240\u6709\u7ec4\u4ef6\u5185\u5b88\u536b\u548c\u5f02\u6b65\u8def\u7531\u7ec4\u4ef6\u88ab\u89e3\u6790\u4e4b\u540e\uff0c\u89e3\u6790\u5b88\u536b\u5c31\u88ab\u8c03\u7528\u3002</p>"},{"location":"web/front/vue/vue_router.html#_16","title":"\u5168\u5c40\u540e\u7f6e\u94a9\u5b50","text":"<p>\u6ce8\u518c\u5168\u5c40\u540e\u7f6e\u94a9\u5b50\uff0c\u7136\u800c\u548c\u5b88\u536b\u4e0d\u540c\u7684\u662f\uff0c\u8fd9\u4e9b\u94a9\u5b50\u4e0d\u4f1a\u63a5\u53d7 <code>next</code> \u51fd\u6570\u4e5f\u4e0d\u4f1a\u6539\u53d8\u5bfc\u822a\u672c\u8eab\uff1a</p> <pre><code>router.afterEach((to, from) =&gt; {\n  // ...\n})\n</code></pre>"},{"location":"web/front/vue/vue_router.html#_17","title":"\u8def\u7531\u72ec\u4eab\u7684\u5b88\u536b","text":"<p>\u5728\u8def\u7531\u914d\u7f6e\u4e0a\u76f4\u63a5\u5b9a\u4e49 <code>beforeEnter</code> \u5b88\u536b\uff1a</p> <pre><code>const router = new VueRouter({\n  routes: [\n    {\n      path: '/foo',\n      component: Foo,\n      beforeEnter: (to, from, next) =&gt; {\n        // ...\n      }\n    }\n  ]\n})\n</code></pre>"},{"location":"web/front/vue/vue_router.html#_18","title":"\u7ec4\u4ef6\u5185\u7684\u5b88\u536b","text":"<p>\u5728\u8def\u7531\u7ec4\u4ef6\u5185\u76f4\u63a5\u5b9a\u4e49\u4ee5\u4e0b\u8def\u7531\u5bfc\u822a\u5b88\u536b\uff1a</p> <ul> <li><code>beforeRouteEnter</code></li> <li><code>beforeRouteUpdate</code> (2.2 \u65b0\u589e)</li> <li><code>beforeRouteLeave</code></li> </ul> <pre><code>const Foo = {\n  template: `...`,\n  beforeRouteEnter (to, from, next) {\n    // \u5728\u6e32\u67d3\u8be5\u7ec4\u4ef6\u7684\u5bf9\u5e94\u8def\u7531\u88ab confirm \u524d\u8c03\u7528\n    // \u4e0d\uff01\u80fd\uff01\u83b7\u53d6\u7ec4\u4ef6\u5b9e\u4f8b `this`\n    // \u56e0\u4e3a\u5f53\u5b88\u536b\u6267\u884c\u524d\uff0c\u7ec4\u4ef6\u5b9e\u4f8b\u8fd8\u6ca1\u88ab\u521b\u5efa\n  },\n  beforeRouteUpdate (to, from, next) {\n    // \u5728\u5f53\u524d\u8def\u7531\u6539\u53d8\uff0c\u4f46\u662f\u8be5\u7ec4\u4ef6\u88ab\u590d\u7528\u65f6\u8c03\u7528\n    // \u4e3e\u4f8b\u6765\u8bf4\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5e26\u6709\u52a8\u6001\u53c2\u6570\u7684\u8def\u5f84 /foo/:id\uff0c\u5728 /foo/1 \u548c /foo/2 \u4e4b\u95f4\u8df3\u8f6c\u7684\u65f6\u5019\uff0c\n    // \u7531\u4e8e\u4f1a\u6e32\u67d3\u540c\u6837\u7684 Foo \u7ec4\u4ef6\uff0c\u56e0\u6b64\u7ec4\u4ef6\u5b9e\u4f8b\u4f1a\u88ab\u590d\u7528\u3002\u800c\u8fd9\u4e2a\u94a9\u5b50\u5c31\u4f1a\u5728\u8fd9\u4e2a\u60c5\u51b5\u4e0b\u88ab\u8c03\u7528\u3002\n    // \u53ef\u4ee5\u8bbf\u95ee\u7ec4\u4ef6\u5b9e\u4f8b `this`\n  },\n  beforeRouteLeave (to, from, next) {\n    // \u5bfc\u822a\u79bb\u5f00\u8be5\u7ec4\u4ef6\u7684\u5bf9\u5e94\u8def\u7531\u65f6\u8c03\u7528\n    // \u53ef\u4ee5\u8bbf\u95ee\u7ec4\u4ef6\u5b9e\u4f8b `this`\n  }\n}\n</code></pre> <p>\u901a\u8fc7\u4f20\u4e00\u4e2a\u56de\u8c03\u7ed9 <code>next</code>\u6765\u8bbf\u95ee\u7ec4\u4ef6\u5b9e\u4f8b\u3002\u5728\u5bfc\u822a\u88ab\u786e\u8ba4\u7684\u65f6\u5019\u6267\u884c\u56de\u8c03\uff0c\u5e76\u4e14\u628a\u7ec4\u4ef6\u5b9e\u4f8b\u4f5c\u4e3a\u56de\u8c03\u65b9\u6cd5\u7684\u53c2\u6570\u3002</p> <pre><code>beforeRouteEnter (to, from, next) {\n  next(vm =&gt; {\n    // \u901a\u8fc7 `vm` \u8bbf\u95ee\u7ec4\u4ef6\u5b9e\u4f8b\n  })\n}\n</code></pre> <p>\u6ce8\u610f <code>beforeRouteEnter</code> \u662f\u652f\u6301\u7ed9 <code>next</code> \u4f20\u9012\u56de\u8c03\u7684\u552f\u4e00\u5b88\u536b\u3002\u5bf9\u4e8e <code>beforeRouteUpdate</code> \u548c <code>beforeRouteLeave</code> \u6765\u8bf4\uff0c<code>this</code> \u5df2\u7ecf\u53ef\u7528\u4e86\uff0c\u6240\u4ee5\u4e0d\u652f\u6301\u4f20\u9012\u56de\u8c03\uff0c\u56e0\u4e3a\u6ca1\u6709\u5fc5\u8981\u4e86\u3002</p> <p>\u79bb\u5f00\u5b88\u536b\u901a\u5e38\u7528\u6765\u7981\u6b62\u7528\u6237\u5728\u8fd8\u672a\u4fdd\u5b58\u4fee\u6539\u524d\u7a81\u7136\u79bb\u5f00\u3002\u8be5\u5bfc\u822a\u53ef\u4ee5\u901a\u8fc7 <code>next(false)</code> \u6765\u53d6\u6d88\u3002</p> <pre><code>beforeRouteLeave (to, from, next) {\n  const answer = window.confirm('Do you really want to leave? you have unsaved changes!')\n  if (answer) {\n    next()\n  } else {\n    next(false)\n  }\n}\n</code></pre>"},{"location":"web/front/vue/vue_router.html#_19","title":"\u5b8c\u6574\u7684\u5bfc\u822a\u89e3\u6790\u6d41\u7a0b","text":"<ol> <li>\u5bfc\u822a\u88ab\u89e6\u53d1\u3002</li> <li>\u5728\u5931\u6d3b\u7684\u7ec4\u4ef6\u91cc\u8c03\u7528\u79bb\u5f00\u5b88\u536b\u3002</li> <li>\u8c03\u7528\u5168\u5c40\u7684 <code>beforeEach</code> \u5b88\u536b\u3002</li> <li>\u5728\u91cd\u7528\u7684\u7ec4\u4ef6\u91cc\u8c03\u7528 <code>beforeRouteUpdate</code> \u5b88\u536b (2.2+)\u3002</li> <li>\u5728\u8def\u7531\u914d\u7f6e\u91cc\u8c03\u7528 <code>beforeEnter</code>\u3002</li> <li>\u89e3\u6790\u5f02\u6b65\u8def\u7531\u7ec4\u4ef6\u3002</li> <li>\u5728\u88ab\u6fc0\u6d3b\u7684\u7ec4\u4ef6\u91cc\u8c03\u7528 <code>beforeRouteEnter</code>\u3002</li> <li>\u8c03\u7528\u5168\u5c40\u7684 <code>beforeResolve</code> \u5b88\u536b (2.5+)\u3002</li> <li>\u5bfc\u822a\u88ab\u786e\u8ba4\u3002</li> <li>\u8c03\u7528\u5168\u5c40\u7684 <code>afterEach</code> \u94a9\u5b50\u3002</li> <li>\u89e6\u53d1 DOM \u66f4\u65b0\u3002</li> <li>\u7528\u521b\u5efa\u597d\u7684\u5b9e\u4f8b\u8c03\u7528 <code>beforeRouteEnter</code> \u5b88\u536b\u4e2d\u4f20\u7ed9 <code>next</code> \u7684\u56de\u8c03\u51fd\u6570\u3002</li> </ol>"},{"location":"web/front/vue/vue_router.html#_20","title":"\u8def\u7531\u5143\u4fe1\u606f","text":"<p>\u5b9a\u4e49\u8def\u7531\u7684\u65f6\u5019\u53ef\u4ee5\u914d\u7f6e <code>meta</code> \u5b57\u6bb5\uff1a</p> <pre><code>const router = new VueRouter({\n  routes: [\n    {\n      path: '/foo',\n      component: Foo,\n      children: [\n        {\n          path: 'bar',\n          component: Bar,\n          // a meta field\n          meta: { requiresAuth: true }\n        }\n      ]\n    }\n  ]\n})\n</code></pre> <p>\u79f0\u547c <code>routes</code> \u914d\u7f6e\u4e2d\u7684\u6bcf\u4e2a\u8def\u7531\u5bf9\u8c61\u4e3a \u8def\u7531\u8bb0\u5f55\u3002\u8def\u7531\u8bb0\u5f55\u53ef\u4ee5\u662f\u5d4c\u5957\u7684\uff0c\u56e0\u6b64\uff0c\u5f53\u4e00\u4e2a\u8def\u7531\u5339\u914d\u6210\u529f\u540e\uff0c\u4ed6\u53ef\u80fd\u5339\u914d\u591a\u4e2a\u8def\u7531\u8bb0\u5f55\uff0c\u8def\u7531\u5339\u914d\u5230\u7684\u6240\u6709\u8def\u7531\u8bb0\u5f55\u4f1a\u66b4\u9732\u4e3a <code>$route</code> \u5bf9\u8c61 (\u8fd8\u6709\u5728\u5bfc\u822a\u5b88\u536b\u4e2d\u7684\u8def\u7531\u5bf9\u8c61) \u7684 <code>$route.matched</code> \u6570\u7ec4\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u904d\u5386 <code>$route.matched</code> \u6765\u68c0\u67e5\u8def\u7531\u8bb0\u5f55\u4e2d\u7684 <code>meta</code> \u5b57\u6bb5\u3002</p> <pre><code>router.beforeEach((to, from, next) =&gt; {\n  if (to.matched.some(record =&gt; record.meta.requiresAuth)) {\n    // this route requires auth, check if logged in\n    // if not, redirect to login page.\n    if (!auth.loggedIn()) {\n      next({\n        path: '/login',\n        query: { redirect: to.fullPath }\n      })\n    } else {\n      next()\n    }\n  } else {\n    next() // \u786e\u4fdd\u4e00\u5b9a\u8981\u8c03\u7528 next()\n  }\n})\n</code></pre>"},{"location":"web/front/vue/vue_router.html#_21","title":"\u8fc7\u6e21\u52a8\u6548","text":"<p><code>&lt;router-view&gt;</code> \u662f\u57fa\u672c\u7684\u52a8\u6001\u7ec4\u4ef6\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528 <code>&lt;transition&gt;</code> \u7ec4\u4ef6\u7ed9\u5b83\u6dfb\u52a0\u4e00\u4e9b\u8fc7\u6e21\u6548\u679c\uff1a</p> <pre><code>&lt;transition&gt;\n  &lt;router-view&gt;&lt;/router-view&gt;\n&lt;/transition&gt;\n</code></pre> <p>Transition \u7684\u6240\u6709\u529f\u80fd \u5728\u8fd9\u91cc\u540c\u6837\u9002\u7528\u3002</p>"},{"location":"web/front/vue/vue_router.html#todo_1","title":"\u6570\u636e\u83b7\u53d6(TODO)","text":""},{"location":"web/front/vue/vue_router.html#todo_2","title":"\u6eda\u52a8\u884c\u4e3a(TODO)","text":""},{"location":"web/front/vue/vue_router.html#todo_3","title":"\u8def\u7531\u61d2\u52a0\u8f7d(TODO)","text":""},{"location":"web/front/vue/vue_x.html","title":"Vue-X","text":""},{"location":"web/front/vue/vue_x.html#_1","title":"\u672c\u5730\u5b58\u50a8","text":"<p>vuex\u5b58\u50a8\u5728\u5185\u5b58\uff0clocalstorage\uff08\u672c\u5730\u5b58\u50a8\uff09\u5219\u4ee5\u6587\u4ef6\u7684\u65b9\u5f0f\u5b58\u50a8\u5728\u672c\u5730\uff0c\u6c38\u4e45\u4fdd\u5b58\uff1bsessionstorage( \u4f1a\u8bdd\u5b58\u50a8 ) \uff0c\u4e34\u65f6\u4fdd\u5b58\u3002</p> <p>\u5f53\u5237\u65b0\u9875\u9762\uff08\u8fd9\u91cc\u7684\u5237\u65b0\u9875\u9762\u6307\u7684\u662f --&gt; F5\u5237\u65b0\uff0c\u5c5e\u4e8e\u6e05\u9664\u5185\u5b58\u4e86\uff09\u65f6vuex\u5b58\u50a8\u7684\u503c\u4f1a\u4e22\u5931\uff0csessionstorage\u9875\u9762\u5173\u95ed\u540e\u5c31\u6e05\u9664\u6389\u4e86\uff0clocalstorage\u4e0d\u4f1a\u3002 </p>"},{"location":"web/front/vue/vue_x.html#sessionstorage","title":"sessionStorage","text":"<p>sessionStorage \u65b9\u6cd5\u9488\u5bf9\u4e00\u4e2a session \u8fdb\u884c\u6570\u636e\u5b58\u50a8\u3002\u5f53\u7528\u6237\u5173\u95ed\u6d4f\u89c8\u5668\u7a97\u53e3\u540e\uff0c\u6570\u636e\u4f1a\u88ab\u5220\u9664\u3002</p>"},{"location":"web/front/vue/vue_x.html#localstorage","title":"localStorage","text":"<p>localStorage \u65b9\u6cd5\u5b58\u50a8\u7684\u6570\u636e\u6ca1\u6709\u65f6\u95f4\u9650\u5236\u3002\u7b2c\u4e8c\u5929\u3001\u7b2c\u4e8c\u5468\u6216\u4e0b\u4e00\u5e74\u4e4b\u540e\uff0c\u6570\u636e\u4f9d\u7136\u53ef\u7528\u3002</p>"},{"location":"web/front/vue/vue_x.html#_2","title":"\u4f7f\u7528","text":"<p>\u7b80\u5355\u7684 Vue \u8ba1\u6570\u5e94\u7528</p> <pre><code>new Vue({\n  // state\n  data () {\n    return {\n      count: 0\n    }\n  },\n  // view\n  template: `\n    &lt;div&gt;{{ count }}&lt;/div&gt;\n  `,\n  // actions\n  methods: {\n    increment () {\n      this.count++\n    }\n  }\n})\n</code></pre> <p>vuex\u7684\u7528\u6cd5</p> <pre><code>const store = new Vuex.Store({\n  state: {\n    count: 0\n  },\n  mutations: {\n    increment (state) {\n      state.count++\n    }\n  }\n})\n</code></pre> <p>\u4f7f\u7528</p> <pre><code>store.commit('increment')\n\nconsole.log(store.state.count) // -&gt; 1\n</code></pre> <p>\u901a\u8fc7\u63d0\u4ea4 mutation \u7684\u65b9\u5f0f\uff0c\u800c\u975e\u76f4\u63a5\u6539\u53d8 <code>store.state.count</code>\uff0c\u662f\u56e0\u4e3a\u6211\u4eec\u60f3\u8981\u66f4\u660e\u786e\u5730\u8ffd\u8e2a\u5230\u72b6\u6001\u7684\u53d8\u5316\u3002</p>"},{"location":"web/front/vue/vue_x.html#_3","title":"\u6982\u5ff5","text":""},{"location":"web/front/vue/vue_x.html#state","title":"State","text":""},{"location":"web/front/vue/vue_x.html#getter","title":"Getter","text":"<p>\u591a\u4e2a\u7ec4\u4ef6\u9700\u8981\u7528\u5230\u6b64\u5c5e\u6027\uff0c\u5728 store \u4e2d\u5b9a\u4e49\u201cgetter\u201d\uff08\u53ef\u4ee5\u8ba4\u4e3a\u662f store \u7684\u8ba1\u7b97\u5c5e\u6027\uff09\u3002\u5c31\u50cf\u8ba1\u7b97\u5c5e\u6027\u4e00\u6837\uff0cgetter \u7684\u8fd4\u56de\u503c\u4f1a\u6839\u636e\u5b83\u7684\u4f9d\u8d56\u88ab\u7f13\u5b58\u8d77\u6765\uff0c\u4e14\u53ea\u6709\u5f53\u5b83\u7684\u4f9d\u8d56\u503c\u53d1\u751f\u4e86\u6539\u53d8\u624d\u4f1a\u88ab\u91cd\u65b0\u8ba1\u7b97\u3002</p> <pre><code>const store = new Vuex.Store({\n  state: {\n    todos: [\n      { id: 1, text: '...', done: true },\n      { id: 2, text: '...', done: false }\n    ]\n  },\n  getters: {\n    doneTodos: state =&gt; {\n      return state.todos.filter(todo =&gt; todo.done)\n    },\n    // Getter \u4e5f\u53ef\u4ee5\u63a5\u53d7\u5176\u4ed6 getter \u4f5c\u4e3a\u7b2c\u4e8c\u4e2a\u53c2\u6570\u3002\n    doneTodosCount: (state, getters) =&gt; {\n      return getters.doneTodos.length\n    }\n  }\n})\n</code></pre> <p>Getter \u4f1a\u66b4\u9732\u4e3a <code>store.getters</code> \u5bf9\u8c61\uff0c\u4f60\u53ef\u4ee5\u4ee5\u5c5e\u6027\u7684\u5f62\u5f0f\u8bbf\u95ee\u8fd9\u4e9b\u503c\uff1a</p> <pre><code>store.getters.doneTodos // -&gt; [{ id: 1, text: '...', done: true }]\n</code></pre> <p>\u8ba9 getter \u8fd4\u56de\u4e00\u4e2a\u51fd\u6570\uff0c\u6765\u5b9e\u73b0\u7ed9 getter \u4f20\u53c2\u3002\u5728\u4f60\u5bf9 store \u91cc\u7684\u6570\u7ec4\u8fdb\u884c\u67e5\u8be2\u65f6\u975e\u5e38\u6709\u7528\u3002</p> <pre><code>getters: {\n  // ...\n  getTodoById: (state) =&gt; (id) =&gt; {\n    return state.todos.find(todo =&gt; todo.id === id)\n  }\n}\n\nstore.getters.getTodoById(2) // -&gt; { id: 2, text: '...', done: false }\n</code></pre> <p>getter \u5728\u901a\u8fc7\u65b9\u6cd5\u8bbf\u95ee\u65f6\uff0c\u6bcf\u6b21\u90fd\u4f1a\u53bb\u8fdb\u884c\u8c03\u7528\uff0c\u800c\u4e0d\u4f1a\u7f13\u5b58\u7ed3\u679c\u3002</p>"},{"location":"web/front/vue/vue_x.html#mutation","title":"Mutation","text":"<p>Vuex \u4e2d\u7684 mutation \u975e\u5e38\u7c7b\u4f3c\u4e8e\u4e8b\u4ef6\uff1a\u6bcf\u4e2a mutation \u90fd\u6709\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684 \u4e8b\u4ef6\u7c7b\u578b (type) \u548c \u4e00\u4e2a \u56de\u8c03\u51fd\u6570 (handler)\u3002\u4ee5\u76f8\u5e94\u7684 type \u8c03\u7528 store.commit \u65b9\u6cd5\uff1a</p> <pre><code>store.commit('increment')\n</code></pre> <p>dispatch\uff1a\u542b\u6709\u5f02\u6b65\u64cd\u4f5c\uff0c\u4f8b\u5982\u5411\u540e\u53f0\u63d0\u4ea4\u6570\u636e\uff0c\u5199\u6cd5\uff1a this.$store.dispatch('mutations\u65b9\u6cd5\u540d',\u503c)</p> <p>commit\uff1a\u540c\u6b65\u64cd\u4f5c\uff0c\u5199\u6cd5\uff1athis.$store.commit('mutations\u65b9\u6cd5\u540d',\u503c)</p> <pre><code>this.$store.commit('toShowLoginDialog', true);\nthis.$store.dispatch('toShowLoginDialog',false);\n</code></pre>"},{"location":"web/front/vue/vue_x.html#action","title":"Action","text":"<p>Action \u7c7b\u4f3c\u4e8e mutation\uff0c\u4e0d\u540c\u5728\u4e8e\uff1a</p> <ul> <li>Action \u63d0\u4ea4\u7684\u662f mutation\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u53d8\u66f4\u72b6\u6001\u3002</li> <li>Action \u53ef\u4ee5\u5305\u542b\u4efb\u610f\u5f02\u6b65\u64cd\u4f5c\u3002</li> </ul> <pre><code>const store = new Vuex.Store({\n  state: {\n    count: 0\n  },\n  mutations: {\n    increment (state) {\n      state.count++\n    }\n  },\n  actions: {\n    increment (context) {\n      context.commit('increment')\n    }\n  }\n})\n</code></pre> <p>Action \u51fd\u6570\u63a5\u53d7\u4e00\u4e2a\u4e0e store \u5b9e\u4f8b\u5177\u6709\u76f8\u540c\u65b9\u6cd5\u548c\u5c5e\u6027\u7684 context \u5bf9\u8c61\uff0c\u56e0\u6b64\u4f60\u53ef\u4ee5\u8c03\u7528 <code>context.commit</code> \u63d0\u4ea4\u4e00\u4e2a mutation\uff0c\u6216\u8005\u901a\u8fc7 <code>context.state</code> \u548c <code>context.getters</code> \u6765\u83b7\u53d6 state \u548c getters\u3002</p>"},{"location":"web/front/vue/vue_x.html#module","title":"Module","text":"<p>\u7531\u4e8e\u4f7f\u7528\u5355\u4e00\u72b6\u6001\u6811\uff0c\u5e94\u7528\u7684\u6240\u6709\u72b6\u6001\u4f1a\u96c6\u4e2d\u5230\u4e00\u4e2a\u6bd4\u8f83\u5927\u7684\u5bf9\u8c61\u3002\u5f53\u5e94\u7528\u53d8\u5f97\u975e\u5e38\u590d\u6742\u65f6\uff0cstore \u5bf9\u8c61\u5c31\u6709\u53ef\u80fd\u53d8\u5f97\u76f8\u5f53\u81c3\u80bf\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u4ee5\u4e0a\u95ee\u9898\uff0cVuex \u5141\u8bb8\u6211\u4eec\u5c06 store \u5206\u5272\u6210\u6a21\u5757\uff08module\uff09\u3002\u6bcf\u4e2a\u6a21\u5757\u62e5\u6709\u81ea\u5df1\u7684 state\u3001mutation\u3001action\u3001getter\u3001\u751a\u81f3\u662f\u5d4c\u5957\u5b50\u6a21\u5757\u2014\u2014\u4ece\u4e0a\u81f3\u4e0b\u8fdb\u884c\u540c\u6837\u65b9\u5f0f\u7684\u5206\u5272</p> <pre><code>const moduleA = {\n  state: { ... },\n  mutations: { ... },\n  actions: { ... },\n  getters: { ... }\n}\n\nconst moduleB = {\n  state: { ... },\n  mutations: { ... },\n  actions: { ... }\n}\n\nconst store = new Vuex.Store({\n  modules: {\n    a: moduleA,\n    b: moduleB\n  }\n})\n\nstore.state.a // -&gt; moduleA \u7684\u72b6\u6001\nstore.state.b // -&gt; moduleB \u7684\u72b6\u6001\n</code></pre> <p>\u5bf9\u4e8e\u6a21\u5757\u5185\u90e8\u7684 action\uff0c\u5c40\u90e8\u72b6\u6001\u901a\u8fc7 <code>context.state</code> \u66b4\u9732\u51fa\u6765\uff0c\u6839\u8282\u70b9\u72b6\u6001\u5219\u4e3a <code>context.rootState</code></p> <pre><code>const moduleA = {\n  // ...\n  actions: {\n    incrementIfOddOnRootSum ({ state, commit, rootState }) {\n      if ((state.count + rootState.count) % 2 === 1) {\n        commit('increment')\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"web/front/vue/vue_x.html#_4","title":"\u547d\u540d\u7a7a\u95f4","text":""},{"location":"web/front/vue/vue_x.html#global-assets","title":"\u5728\u5e26\u547d\u540d\u7a7a\u95f4\u7684\u6a21\u5757\u5185\u8bbf\u95ee\u5168\u5c40\u5185\u5bb9\uff08Global Assets\uff09","text":""},{"location":"web/front/vue/vue_x.html#action_1","title":"\u5728\u5e26\u547d\u540d\u7a7a\u95f4\u7684\u6a21\u5757\u6ce8\u518c\u5168\u5c40 action","text":""},{"location":"web/gateway/APISix.html","title":"APISix","text":"<p>[toc]</p>"},{"location":"web/gateway/APISix.html#apache-apisix","title":"Apache APISix","text":"<p>APISIX is built on top of Nginx and ngx_lua leveraging the power offered by LuaJIT.</p> <p>\u57fa\u4e8eEtcd\u7684watch\u673a\u5236\uff0c\u66f4\u65b0\u5728\u6beb\u79d2\u7ea7\uff08\u63a8\u9001\u7684\u5f62\u5f0f\uff09\uff0c\u800c\u5176\u4ed6\uff08\u5982Kong\uff09\u57285\u79d2\u7ea7\u522b\uff0c\u4e14\u662f\u62c9\u53d6\u7684\u5f62\u5f0f\u3002</p> <p></p> <p>APISIX has two main parts:</p> <ol> <li>APISIX core, Lua plugin, multi-language Plugin runtime, and the WASM plugin runtime.</li> <li>Built-in Plugins that adds features for observability, security, traffic control, etc.</li> </ol>"},{"location":"web/gateway/APISix.html#plugin","title":"Plugin","text":""},{"location":"web/gateway/websocket.html","title":"WebSocket \u8f6c\u53d1\u914d\u7f6e","text":""},{"location":"web/gateway/websocket.html#nginx","title":"Nginx \u4f53\u7cfb","text":"<p>\u53ea\u652f\u6301 websocket</p> <pre><code>location /websocket/ {\n        proxy_pass http://myserver;\n        proxy_read_timeout 360s;   \n        proxy_redirect off;   \n        # \u6838\u5fc3\u914d\u7f6e\u4e09\u884c\uff1a\u914d\u7f6e\u8fde\u63a5\u4e3a\u5347\u7ea7\u8fde\u63a5\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade; \n        proxy_set_header Connection \"upgrade\";    \n\n        proxy_set_header Host $host:$server_port;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header REMOTE-HOST $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n}\n</code></pre> <p>\u652f\u6301http\u53c8\u652f\u6301 ws\uff08\u53ef\u4ee5\u89c1 jupyterhub \u7684\u53cd\u5411\u4ee3\u7406\u914d\u7f6e\uff09</p> <pre><code>    #\u81ea\u5b9a\u4e49\u53d8\u91cf $connection_upgrade\n    map $http_upgrade $connection_upgrade { \n        default          keep-alive;  #\u9ed8\u8ba4\u4e3akeep-alive \u53ef\u4ee5\u652f\u6301\u4e00\u822chttp\u8bf7\u6c42\n        'websocket'      upgrade;     #\u5982\u679c\u4e3awebsocket \u5219\u4e3a upgrade \u53ef\u5347\u7ea7\u7684\u3002\n    }\n\n    server {\n        ...\n\n        location /chat/ {\n            proxy_pass http://backend;\n            proxy_http_version 1.1;\n            proxy_set_header Upgrade $http_upgrade; \n            # \u6b64\u5904\u914d\u7f6e\u4e0a\u9762\u5b9a\u4e49\u7684\u53d8\u91cf\n            proxy_set_header Connection $connection_upgrade;\n        }\n    }\n</code></pre>"},{"location":"web/gateway/openresty/openresty.html","title":"OpenResty","text":"<p>\u662f\u4e00\u6b3e\u57fa\u4e8e NGINX \u548c LuaJIT \u7684 Web \u5e73\u53f0\uff0c\u63d0\u4f9b\u4e30\u5bcc\u7684\u63d2\u4ef6\u3002</p>"},{"location":"web/gateway/openresty/openresty.html#_1","title":"\u5b89\u88c5","text":""},{"location":"web/gateway/openresty/openresty.html#_2","title":"\u6e90\u7801\u5b89\u88c5","text":"<p>\u53c2\u8003\u5b98\u7f51 http://openresty.org/cn/installation.html</p> <p>\u4f9d\u8d56</p> <pre><code>yum install pcre-devel openssl-devel gcc curl\n</code></pre> <p>\u7f16\u8bd1</p> <pre><code>./configure --prefix=/opt/openresty \\\n--with-luajit \\\n--with-http_iconv_module \n</code></pre> <p>--with-http_postgres_module \u9700\u8981\u5b89\u88c5 libpq</p> <p>\u5b89\u88c5</p> <pre><code>make -j4\nmake install\n</code></pre>"},{"location":"web/gateway/openresty/openresty.html#_3","title":"\u914d\u7f6e","text":""},{"location":"web/gateway/openresty/openresty.html#nginxconf","title":"nginx.conf","text":""},{"location":"web/gateway/openresty/openresty.html#_4","title":"\u65e5\u5fd7\u6e05\u7406","text":""},{"location":"web/lowcode/appsmith.html","title":"AppSmith","text":"<p>Low code project to build admin panels, internal tools, and dashboards. Integrates with 15+ databases and any API.</p>"},{"location":"web/lowcode/lowcode_engine.html","title":"\u4f4e\u4ee3\u7801\u5f15\u64ce","text":"<p>An enterprise-class low-code technology stack with scale-out design / \u4e00\u5957\u9762\u5411\u6269\u5c55\u8bbe\u8ba1\u7684\u4f01\u4e1a\u7ea7\u4f4e\u4ee3\u7801\u6280\u672f\u4f53\u7cfb\u3002</p>"},{"location":"web/servicemesh/Envoy.html","title":"Envoy","text":"<p>Cloud-native high-performance edge/middle/service proxy.</p> <p>\u5f00\u6e90\u7684\u8fb9\u7f18\u548c\u670d\u52a1\u4ee3\u7406\uff0c\u4e91\u539f\u751f\u5e94\u7528\uff0c\u4e91\u539f\u751f\u57fa\u91d1\u4f1a CNCF \u9879\u76ee\u3002</p>"},{"location":"web/servicemesh/linkerd.html","title":"Linkerd","text":"<p>Ultralight, security-first service mesh for Kubernetes. </p>"},{"location":"web/servicemesh/servicemesh.html","title":"Service Mesh","text":"<p>Apache ServiceComb\uff1a\u5fae\u670d\u52a1\u89e3\u51b3\u65b9\u6848</p> <p>lstio\uff1aConnect, secure, control, and observe services.</p> <p>linkerd\uff1aUltralight service mesh for Kubernetes and beyond</p> <p>SpringCloud\u5bf9\u6bd4Istio</p> <p></p>"},{"location":"web/servicemesh/servicemesh.html#_1","title":"\u5fae\u670d\u52a1\u901a\u4fe1","text":"<p>\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u968f\u7740\u5fae\u670d\u52a1\u7684\u589e\u591a\uff0c\u5fae\u670d\u52a1\u95f4\u7684\u901a\u4fe1\u9700\u8981</p> <p>1\uff09\u670d\u52a1\u53d1\u73b0\uff1a\u6d88\u8d39\u65b9Consumer\u5982\u4f55\u53d1\u73b0\u670d\u52a1\u65b9Provider\uff1f</p> <p>2\uff09\u8d1f\u8f7d\u5747\u8861\uff1a\u670d\u52a1\u65b9\u591a\u4e2a\u5b9e\u4f8b\u5982\u4f55\u80fd\u591f\u8d1f\u8f7d\u5747\u8861\uff1f</p>"},{"location":"web/servicemesh/servicemesh.html#_2","title":"\u65b9\u6848","text":"<p>\u5728\u670d\u52a1\u6d88\u8d39\u65b9\u548c\u670d\u52a1\u63d0\u4f9b\u65b9\u4e4b\u95f4\u52a0\u4e0a\u4e00\u5c42\u4ee3\u7406\uff0c\u7531\u4ee3\u7406\u8d1f\u8d23\u670d\u52a1\u53d1\u73b0\u548c\u8d1f\u8f7d\u5747\u8861\u529f\u80fd\uff0c\u6d88\u8d39\u65b9\u901a\u8fc7\u4ee3\u7406\u95f4\u63a5\u8bbf\u95ee\u76ee\u6807\u670d\u52a1\u3002</p>"},{"location":"web/servicemesh/servicemesh.html#_3","title":"\u4f20\u7edf\u96c6\u4e2d\u5f0f","text":"<p>\u5728\u670d\u52a1\u6d88\u8d39\u8005\u548c\u751f\u4ea7\u8005\u4e4b\u95f4\uff0c\u4ee3\u7406\u4f5c\u4e3a\u72ec\u7acb\u4e00\u5c42\u96c6\u4e2d\u90e8\u7f72\uff0c\u7531\u72ec\u7acb\u56e2\u961f(\u4e00\u822c\u662f\u8fd0\u7ef4\u6216\u6846\u67b6)\u8d1f\u8d23\u6cbb\u7406\u548c\u8fd0\u7ef4\u3002</p>"},{"location":"web/servicemesh/servicemesh.html#_4","title":"\u5ba2\u6237\u7aef\u5d4c\u5165\u5f0f","text":"<p>\u4ee3\u7406(\u5305\u62ec\u670d\u52a1\u53d1\u73b0\u548c\u8d1f\u8f7d\u5747\u8861\u903b\u8f91)\u4ee5\u5ba2\u6237\u5e93(\u5982 jar \u5305)\u7684\u5f62\u5f0f\u5d4c\u5165\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u3002</p> <p>\u4e00\u822c\u9700\u8981\u72ec\u7acb\u7684\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u7ec4\u4ef6\u914d\u5408\uff0c\u670d\u52a1\u542f\u52a8\u65f6\u81ea\u52a8\u6ce8\u518c\u5230\u6ce8\u518c\u4e2d\u5fc3\u5e76\u5b9a\u671f\u62a5\u5fc3\u8df3\uff0c\u5ba2\u6237\u7aef\u4ee3\u7406\u5219\u53d1\u73b0\u670d\u52a1\u5e76\u505a\u8d1f\u8f7d\u5747\u8861\u3002</p> <p>\u6848\u4f8b\uff1a\u5982\u963f\u91cc\u5f00\u6e90\u7684Dubbo\uff0c\u534e\u4e3a\u7684ServiceComb\u3002</p>"},{"location":"web/servicemesh/servicemesh.html#_5","title":"\u4e3b\u673a\u72ec\u7acb\u8fdb\u7a0b","text":"<p>\u6298\u4e2d\u6a21\u5f0f\uff0c\u4ee3\u7406\u4f5c\u4e3a\u72ec\u7acb\u8fdb\u7a0b\u90e8\u7f72\u5728\u6bcf\u4e00\u4e2a\u4e3b\u673a\u4e0a\uff0c\u4e3b\u673a\u4e0a\u7684\u591a\u4e2a\u6d88\u8d39\u8005\u5171\u7528\u4ee3\u7406\u3002\u8fd9\u4e2a\u6a21\u5f0f\u4e00\u822c\u4e5f\u9700\u8981\u72ec\u7acb\u7684\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u7ec4\u4ef6\u914d\u5408\u3002</p>"},{"location":"web/servicemesh/servicemesh.html#_6","title":"\u5bf9\u6bd4\u5206\u6790","text":"<p>\u6a21\u5f0f\u4e00\u76f8\u5bf9\u6bd4\u8f83\u91cd\uff0c\u6709\u5355\u70b9\u95ee\u9898\u548c\u6027\u80fd\u95ee\u9898\uff1b</p> <p>\u6a21\u5f0f\u4e8c\u5219\u6709\u5ba2\u6237\u7aef\u590d\u6742\uff0c\u652f\u6301\u591a\u8bed\u8a00\u56f0\u96be\uff0c\u65e0\u6cd5\u96c6\u4e2d\u6cbb\u7406\u7684\u95ee\u9898\u3002</p> <p>\u6a21\u5f0f\u4e09\u662f\u6298\u4e2d\uff0c\u5206\u5e03\u5f0f\u3001\u6ca1\u6709\u5355\u70b9\u95ee\u9898\uff0c\u8bed\u8a00\u548c\u4e1a\u52a1\u7a0b\u5e8f\u65e0\u5173\uff0c\u5206\u5e03\u5f0f\u90e8\u7f72\u8fd0\u7ef4\u7ba1\u7406\u5f00\u9500\u5927\u3002</p>"},{"location":"web/servicemesh/servicemesh.html#service-mesh_1","title":"Service Mesh\uff08\u670d\u52a1\u7f51\u683c\uff09","text":"<p>\u672c\u8d28\u4e0a\u5c31\u662f\u4e0a\u9762\u63d0\u5230\u7684\u4e3b\u673a\u72ec\u7acb\u8fdb\u7a0b\u6a21\u5f0f\uff0c\u4ee3\u7406\u9664\u4e86\u8d1f\u8d23\u670d\u52a1\u53d1\u73b0\u548c\u8d1f\u8f7d\u5747\u8861\uff0c\u8fd8\u8d1f\u8d23\u52a8\u6001\u8def\u7531\u3001\u5bb9\u9519\u9650\u6d41\u3001\u76d1\u63a7\u5ea6\u91cf\u548c\u5b89\u5168\u65e5\u5fd7\u7b49\u4e1a\u52a1\u65e0\u5173\u7684\u529f\u80fd\u3002</p> <p>\u5728\u5b9e\u8df5\u4e2d\uff0cService Mesh\u901a\u5e38\u7531\u670d\u52a1\u4e0e\u8f7b\u91cf\u7ea7\u7f51\u7edc\u4ee3\u7406\uff08Sidecar\uff0c\u4e0e\u670d\u52a1\u90e8\u7f72\u5728\u4e00\u8d77\uff09\u7ec4\u5408\u800c\u6210\u3002</p> <p>\u5bb9\u5668\u5316\u662fService Mesh\u9ad8\u6548\u843d\u5730\u7684\u57fa\u7840\uff0cKubernetes\u57fa\u4e8eETCD\u7684\u6ce8\u518c\u4e2d\u5fc3\u673a\u5236\u4f9d\u7136\u662f\u63a8\u8350\u7684\u5bb9\u5668\u5316+Service Mesh\u4e0b\u7684\u6ce8\u518c\u4e2d\u5fc3\u9009\u62e9</p>"},{"location":"tags.html","title":"Tags","text":"<p>\u6807\u7b7e\u7d22\u5f15</p>"},{"location":"tags.html#mkdocs","title":"mkdocs","text":"<ul> <li>mkdocs</li> </ul>"}]}