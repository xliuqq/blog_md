# 站内信设计

实现一个站内信web消息推送的功能

![img](pics/web_message_notify_demo.jpg)

消息推送(`push`) 通常是指网站的运营工作等人员，通过某种工具对用户当前网页或移动设备APP进行的主动消息推送。

消息推送一般又分为**`web端消息推送`**和**`移动端消息推送`**。



web端消息推送常见的诸如**站内信、未读邮件数量、监控报警数量**等，应用的也非常广泛。



## 非实时方案

类似 Gitee，其站内信是非实时的，需要界面刷新才可以获取。

- `unread`接口，获取未读消息；



## 实时方案

触发某个事件（主动分享了资源或者后台主动推送消息），web页面的通知小红点就会实时的`+1`。

在服务端会有**若干张消息推送表**，用来记录用户触发**不同事件所推送不同类型的消息**，前端**主动查询（拉）或者被动接收（推）用户所有未读的消息数**。



需求：站内信

- 管理员可以发布多种不同的消息，用户在界面可以及时收到通知；

- 每个 client，需要有自己的唯一标识，防止用户对一个界面同时多开，此时每个界面都会有一个独立的连接；
  - 即仅用用户ID作为 ClientId 不行，因为 Server 端对同一个ID，只会保留一个连接，但是对应多个前端页面连接，会出错；



## 长轮询实现

